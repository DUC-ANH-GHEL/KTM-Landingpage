const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:f,error:l}){const[$,O]=useState(""),[S,o]=useState(""),[g,y]=useState(!1),[D,u]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),l&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),l),React.createElement("form",{onSubmit:async q=>{q.preventDefault(),y(!0),await f($,S),y(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:$,onChange:q=>O(q.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:D?"text":"password",className:"form-control",value:S,onChange:q=>o(q.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>u(!D)},React.createElement("i",{className:`fas fa-eye${D?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:g},g?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:f,type:l,onClose:$}){return useEffect(()=>{const O=setTimeout($,3e3);return()=>clearTimeout(O)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${l} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},f),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:$})))}function Loading({show:f}){return f?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:f,onMenuChange:l,onLogout:$,currentUser:O}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(o=>React.createElement("a",{key:o.id,href:"#",className:`nav-link ${f===o.id?"active":""} ${o.disabled?"opacity-50":""} ${o.highlight?"text-warning":""}`,onClick:g=>{g.preventDefault(),o.disabled||l(o.id)}},React.createElement("i",{className:`fas ${o.icon}`})," ",o.label,o.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),o.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),$&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:$,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:f,onSelect:l,onCreate:$,onEdit:O,onDelete:S,loading:o,currentFolder:g,onBack:y,breadcrumb:D}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},g&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:y},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),g?g.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:$},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),D&&D.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:u=>{u.preventDefault(),y("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),D.map((u,V)=>React.createElement("li",{key:u.id,className:`breadcrumb-item ${V===D.length-1?"active":""}`},V===D.length-1?u.title:React.createElement("a",{href:"#",onClick:q=>{q.preventDefault(),y(u)},className:"text-warning"},u.title))))),o?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):f.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},g?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},f.map(u=>React.createElement("div",{key:u.uuid||u.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>l(u)},u.cover?React.createElement("img",{src:u.cover,className:"album-cover",alt:u.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},u.title),React.createElement("small",{className:"text-muted"},u.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),u.subfolderCount),u.subfolderCount>0&&u.count>0&&" \u2022 ",u.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),u.count),u.subfolderCount===0&&u.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:V=>{V.stopPropagation(),O(u)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:V=>{V.stopPropagation(),S(u)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:f,album:l,onClose:$,onSave:O,parentId:S}){const[o,g]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[y,D]=useState(!1),[u,V]=useState(!1),q=useRef(null);useEffect(()=>{g(l?{slug:l.id||"",title:l.title||"",description:l.description||"",cover_url:l.cover||"",parent_id:l.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:S||null})},[l,f,S]);const _=async I=>{I.preventDefault(),D(!0),await O(o),D(!1)},A=I=>I.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),H=async I=>{const j=I.type==="image/heic"||I.type==="image/heif"||/\.heic$/i.test(I.name);if(I.size<=2097152&&!j)return I;try{const Z=await createImageBitmap(I),Q=document.createElement("canvas");let p=Z.width,E=Z.height;const ee=800;return(p>ee||E>ee)&&(p>E?(E=Math.round(E/p*ee),p=ee):(p=Math.round(p/E*ee),E=ee)),Q.width=p,Q.height=E,Q.getContext("2d").drawImage(Z,0,0,p,E),Z.close(),new Promise((oe,B)=>{Q.toBlob(se=>{se?oe(new File([se],I.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):B(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Z){throw console.error("Compress cover error:",Z),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},U=async I=>{var Z;const v=I.target.files[0];if(!v)return;if(!(v.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(v.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}V(!0);try{const Q=await H(v),p=await window.KTM.cloudinary.uploadImage({file:Q,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!p.secure_url)throw console.error("Cloudinary error:",p),new Error(((Z=p.error)==null?void 0:Z.message)||"Upload failed");g(E=>({...E,cover_url:p.secure_url}))}catch(Q){console.error("Cover upload error:",Q),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Q.message)}V(!1),I.target.value=""};return f?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},l?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:_},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:o.title,onChange:I=>g({...o,title:I.target.value,slug:o.slug||A(I.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:o.slug,onChange:I=>g({...o,slug:I.target.value}),required:!0,disabled:!!l}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:o.description,onChange:I=>g({...o,description:I.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},o.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:o.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>g(I=>({...I,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:q,type:"file",accept:"image/*",className:"d-none",onChange:U}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var I;return(I=q.current)==null?void 0:I.click()},disabled:u},u?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:o.cover_url,onChange:I=>g({...o,cover_url:I.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:y||u},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:f,allAlbums:l,currentAlbumId:$,targetAlbum:O,onSelect:S,level:o=0}){const[g,y]=useState(!0),D=f.uuid||f.id,u=D===$,V=O===D,q=l.filter(A=>A.parentId===D),_=q.length>0;return React.createElement("div",{style:{marginLeft:o*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${V?"bg-info text-white":u?"bg-light text-muted":"hover-bg"}`,style:{cursor:u?"not-allowed":"pointer",opacity:u?.5:1,transition:"background 0.2s"},onClick:()=>!u&&S(D)},_&&React.createElement("i",{className:`fas fa-chevron-${g?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:A=>{A.stopPropagation(),y(!g)}}),!_&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${V?"-open":""} me-2 ${V?"":"text-warning"}`}),React.createElement("span",{className:"small"},f.title),u&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),f.count>0&&!u&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},f.count)),g&&_&&React.createElement("div",null,q.map(A=>React.createElement(FolderTreeItem,{key:A.uuid||A.id,folder:A,allAlbums:l,currentAlbumId:$,targetAlbum:O,onSelect:S,level:o+1}))))}function AlbumDetail({album:f,onBack:l,onRefresh:$,showToast:O,onNavigateToFolder:S,onEditSubfolder:o,parentAlbum:g}){const[y,D]=useState([]),[u,V]=useState([]),[q,_]=useState(!0),[A,H]=useState(!1),[U,I]=useState(""),[v,j]=useState([]),[Z,Q]=useState([]),[p,E]=useState({}),[ee,w]=useState(null),[oe,B]=useState(!1),[se,we]=useState(""),[ae,te]=useState(!1),de=useRef(null),X=useRef(null),[ue,ke]=useState(!1),[ne,ie]=useState([]),[$e,ge]=useState([]),[pe,Le]=useState(""),[t,s]=useState(!1),C=async(n,k=2)=>{const W=k*1024*1024,Ne=n.type==="image/heic"||n.type==="image/heif"||/\.heic$/i.test(n.name);if(n.size<=W&&!Ne)return n;try{const ve=await createImageBitmap(n),ye=document.createElement("canvas");let e=ve.width,d=ve.height;const c=1200;return(e>c||d>c)&&(e>d?(d=Math.round(d/e*c),e=c):(e=Math.round(e/d*c),d=c)),ye.width=e,ye.height=d,ye.getContext("2d").drawImage(ve,0,0,e,d),ve.close(),new Promise((J,le)=>{ye.toBlob(K=>{K?J(new File([K],n.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):le(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ve){throw console.error("Compress error:",ve),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{re(),be()},[f.id,f.uuid]);const re=async()=>{_(!0);try{const n=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${f.uuid||f.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");D(n.images||[]);const k=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${f.uuid||f.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");V(Array.isArray(k)?k:[])}catch(n){console.error(n),O("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}_(!1)},be=async()=>{try{const n=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");ge(Array.isArray(n)?n:[])}catch(n){console.error("Error loading albums:",n)}},Ae=n=>{ie(k=>k.includes(n)?k.filter(W=>W!==n):[...k,n])},fe=async()=>{if(!pe||ne.length===0){O("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}s(!0);let n=0;for(const k of ne)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${k}`,{album_id:pe},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),n++}catch(W){console.error("Move error:",W)}s(!1),ke(!1),ie([]),Le(""),n>0?(O("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),re(),$()):O("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[De,_e]=useState(!1),F=async()=>{if(ne.length===0||!confirm(`X\xF3a ${ne.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;_e(!0);let n=0;for(const k of ne)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${k}`,"L\u1ED7i x\xF3a \u1EA3nh"),n++}catch(W){console.error("Delete error:",W)}_e(!1),ie([]),n>0?(O(`\u0110\xE3 x\xF3a ${n} \u1EA3nh!`,"success"),re(),$()):O("X\xF3a th\u1EA5t b\u1EA1i","danger")},me=()=>{ne.length===y.length?ie([]):ie(y.map(n=>n.id))},Re=async()=>{if(se.trim()){te(!0);try{const n=se.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:n+"-"+Date.now(),title:se,parent_id:f.uuid||f.id},"L\u1ED7i t\u1EA1o folder"),O("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),we(""),B(!1),re(),$()}catch(n){O(n.message,"danger")}te(!1)}},Y=async n=>{if(confirm(`X\xF3a folder "${n.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${n.uuid||n.id}`,"L\u1ED7i x\xF3a folder"),O("\u0110\xE3 x\xF3a folder","success"),re(),$()}catch(k){O("L\u1ED7i x\xF3a folder","danger")}},x=n=>{const k=Array.from(n).filter(W=>W.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(W.name));j(W=>[...W,...k]),k.forEach(W=>{const Ne=new FileReader;Ne.onload=ve=>{Q(ye=>[...ye,{file:W,preview:ve.target.result}])},Ne.readAsDataURL(W)})},Fe=n=>{j(k=>k.filter((W,Ne)=>Ne!==n)),Q(k=>k.filter((W,Ne)=>Ne!==n))},Te=async n=>{var W;const k=await window.KTM.cloudinary.uploadImage({file:n,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${f.id}`});if(!k.secure_url)throw console.error("Cloudinary error:",k),new Error(((W=k.error)==null?void 0:W.message)||"Upload failed");return k},Pe=async()=>{if(v.length===0)return;H(!0);let n=0;for(let k=0;k<v.length;k++)try{I(`\u0110ang x\u1EED l\xFD ${k+1}/${v.length}...`);const W=await C(v[k],2);I(`\u0110ang upload ${k+1}/${v.length}...`);const Ne=await Te(W);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${f.id}`,{url:Ne.secure_url,caption:p[k]||v[k].name.replace(/\.[^/.]+$/,""),sort_order:y.length+k},"L\u1ED7i l\u01B0u \u1EA3nh"),n++}catch(W){console.error("Upload error:",W)}H(!1),I(""),j([]),Q([]),E({}),n>0?(O(`\u0110\xE3 upload ${n} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),re(),$()):O("Upload th\u1EA5t b\u1EA1i","danger")},Ve=async(n,k)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${n}`,"L\u1ED7i x\xF3a \u1EA3nh"),O("\u0110\xE3 x\xF3a \u1EA3nh","success"),re(),$()}catch(W){O("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Se=n=>{var k;n.preventDefault(),(k=X.current)==null||k.classList.add("dragover")},xe=()=>{var n;(n=X.current)==null||n.classList.remove("dragover")},Oe=n=>{var k;n.preventDefault(),(k=X.current)==null||k.classList.remove("dragover"),x(n.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:l},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},f.title),React.createElement("small",{className:"text-muted"},u.length>0&&React.createElement("span",null,u.length," folder \u2022 "),y.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>B(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),oe&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:se,onChange:n=>we(n.target.value),onKeyPress:n=>n.key==="Enter"&&Re(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Re,disabled:ae||!se.trim()},ae?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{B(!1),we("")}},"H\u1EE7y")))),u.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},u.map(n=>React.createElement("div",{key:n.uuid||n.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>S&&S(n)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},n.title),React.createElement("small",{className:"text-muted"},n.subfolderCount>0&&React.createElement("span",null,n.subfolderCount," folder"),n.subfolderCount>0&&n.count>0&&" \u2022 ",n.count>0&&React.createElement("span",null,n.count," \u1EA3nh"),n.subfolderCount===0&&n.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:k=>{k.stopPropagation(),o&&o(n)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:k=>{k.stopPropagation(),Y(n)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:X,className:"upload-zone",onClick:()=>{var n;return(n=de.current)==null?void 0:n.click()},onDragOver:Se,onDragLeave:xe,onDrop:Oe},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:de,type:"file",multiple:!0,accept:"image/*",onChange:n=>x(n.target.files)})),Z.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Z.map((n,k)=>React.createElement("div",{key:k,className:"upload-preview-item"},React.createElement("img",{src:n.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Fe(k)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Pe,disabled:A},A?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),U||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",v.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",y.length,")"),y.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:me},ne.length===y.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ne.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ne.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>ke(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:F,disabled:De},De?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ie([])},React.createElement("i",{className:"fas fa-times"})))),q?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):y.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},y.map((n,k)=>React.createElement("div",{key:k,className:`image-item ${ne.includes(n.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Ae(n.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ne.includes(n.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ne.includes(n.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ne.includes(n.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:n.src,alt:n.caption,style:{opacity:ne.includes(n.id)?.7:1,border:ne.includes(n.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:W=>{W.stopPropagation(),Ve(n.id,k)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),n.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},n.caption)))))),ue&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ne.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>ke(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},$e.filter(n=>!n.parentId).map(n=>React.createElement(FolderTreeItem,{key:n.uuid||n.id,folder:n,allAlbums:$e,currentAlbumId:f.uuid||f.id,targetAlbum:pe,onSelect:Le})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>ke(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:fe,disabled:!pe||t},t?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),ee&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>w(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>w(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:ee.src,alt:ee.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:n=>n.stopPropagation()}),ee.caption&&React.createElement("div",{className:"text-white text-center mt-2"},ee.caption)))))}function SearchCenter({showToast:f,onNavigate:l}){const[$,O]=useState(""),[S,o]=useState([]),[g,y]=useState([]),[D,u]=useState([]),[V,q]=useState("all"),[_,A]=useState(null),[H,U]=useState("list"),[I,v]=useState(!0),[j,Z]=useState([]),[Q,p]=useState([]),E=useRef(null),[ee,w]=useState(!0),[oe,B]=useState(!1),se=useRef(null),[we,ae]=useState(!1),[te,de]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[X,ue]=useState(""),[ke,ne]=useState(!1),ie=useRef(null),$e=useRef(null),[ge,pe]=useState(null),[Le,t]=useState(!1),[s,C]=useState(null),[re,be]=useState(!1),[Ae,fe]=useState(!1),[De,_e]=useState(null),[F,me]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),Re=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Y=a=>{a._type==="product"&&(C(a),me({name:a.name||"",code:a.code||"",price:a.price||"",image:a.image||"",category:a.category||"",note:a.note||""}),t(!0))},x=async()=>{if(s)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${s.id}`,F,"L\u1ED7i c\u1EADp nh\u1EADt"),f("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),t(!1),C(null),Se()}catch(a){f(a.message,"danger")}},Fe=async a=>{const i=a._type==="product"?"s\u1EA3n ph\u1EA9m":a._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${i} "${a.name}"?`))try{let b="";a._type==="product"?b=`${API_BASE}/api/products?id=${a.id}`:a._type==="album"?b=`${API_BASE}/api/images/${a.id}`:a._type==="video"&&(b=`${API_BASE}/api/videos/${a.id}`),await window.KTM.api.deleteJSON(b,"L\u1ED7i x\xF3a"),f(`\u0110\xE3 x\xF3a ${i}`,"success"),Se()}catch(b){f(b.message,"danger")}},Te=async a=>{try{const i=De?`${API_BASE}/api/products?id=${De.id}`:`${API_BASE}/api/products`;De?await window.KTM.api.putJSON(i,a,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(i,a,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),f(De?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),fe(!1),_e(null),Se()}catch(i){f(i.message,"danger")}},Pe="ktm_admin_data_cache_v1",Ve=1e3*60*10,Se=async()=>{let a=null,i=!1;const b=window.KTM.cache.read(Pe,{ttlMs:Ve,validate:Array.isArray});b.hit?(a=b.value,console.log("[CACHE] Using cache, items:",a.length),y(a),o(a),v(!1),i=!0):b.status==="miss"?console.log("[CACHE] No cache found"):b.status==="expired"||b.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):b.status==="error"&&console.error("[CACHE] Error parsing cache"),i||v(!0);try{const N=async(ce,he)=>{try{const Me=await window.KTM.api.getJSON(ce,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Me!=null?Me:he}catch(Me){return he}},[M,m,r]=await Promise.all([N(`${API_BASE}/api/products`,[]),N(`${API_BASE}/api/albums`,[]),N(`${API_BASE}/api/video-folders?withVideos=true`,[])]),T=Array.isArray(M)?M.map(ce=>({...ce,_type:"product",_source:"database"})):[];Z(m);let P=[];Array.isArray(m)&&m.length>0&&(await Promise.all(m.map(he=>N(`${API_BASE}/api/albums/${he.id}`,{})))).forEach((he,Me)=>{const je=m[Me];he.images&&he.images.length>0&&he.images.forEach(Ce=>{P.push({id:Ce.id,name:Ce.caption||"\u1EA2nh t\u1EEB "+je.title,image:Ce.src,folder:je.title,_type:"album",_source:"database"})})}),p(r);let z=[];Array.isArray(r)&&r.forEach(ce=>{ce.videos&&ce.videos.forEach(he=>{z.push({id:he.id,name:he.title,folder:ce.name,image:he.thumb,youtubeId:he.youtubeId,url:he.url,_type:"video",_source:"database"})})});const R=[...T,...P,...z];(!a||JSON.stringify(R)!==JSON.stringify(a))&&(y(R),o(R),window.KTM.cache.write(Pe,R))}catch(N){console.error("Song song fetch error:",N)}v(!1)};useEffect(()=>{Se(),setTimeout(()=>{var a;return(a=E.current)==null?void 0:a.focus()},100)},[]);const xe=a=>{try{return String(a!=null?a:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(i){return String(a!=null?a:"").toLowerCase()}},Oe=a=>{const b=xe(a).trim().split(/\s+/).filter(Boolean),N=b.includes("anh"),M=b.includes("video"),m=b.filter(P=>P!=="anh"&&P!=="video"),r=m.join(" "),T=new Set(["product"]);return N&&T.add("album"),M&&T.add("video"),{allowedTypes:T,includeAlbum:N,includeVideo:M,contentTokens:m,cleanedQuery:r}},n=(a,i,b)=>{var ce,he,Me,je,Ce;const N=Array.isArray(i)?i:[],M=xe(b).trim();if(!N.length&&!M)return 0;const m=xe((ce=a==null?void 0:a.name)!=null?ce:""),r=xe((he=a==null?void 0:a.code)!=null?he:""),T=xe((Me=a==null?void 0:a.category)!=null?Me:""),P=xe((je=a==null?void 0:a.note)!=null?je:""),z=xe((Ce=a==null?void 0:a.folder)!=null?Ce:"");if(!`${m} ${r} ${T} ${P} ${z}`.trim())return 0;let L=0;M&&(m===M&&(L+=220),m.includes(M)&&(L+=140),m.startsWith(M)&&(L+=160),r&&r===M&&(L+=180),r&&r.includes(M)&&(L+=90));for(const He of N){if(!He)continue;const Ue=new RegExp(`(?:^|\\s)${He.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);m.includes(He)&&(L+=35),Ue.test(m)&&(L+=25),r&&r.includes(He)&&(L+=20),r&&Ue.test(r)&&(L+=10),T&&T.includes(He)&&(L+=12),z&&z.includes(He)&&(L+=12),P&&P.includes(He)&&(L+=6)}return L>0&&m&&(L+=Math.max(0,10-Math.min(10,Math.floor(m.length/10)))),L},k=(a,i,b)=>{const N=Array.isArray(a)?a:[];return N.length?N.map((m,r)=>({it:m,idx:r,score:n(m,i,b)})).sort((m,r)=>r.score!==m.score?r.score-m.score:m.idx-r.idx).map(m=>m.it):[]},W=async(a,i)=>{if(!(!ee||i.length===0)){B(!0);try{const b=i.map(M=>({id:M.id,name:M.name,price:M.price,category:M.category,note:M.note,folder:M.folder,_type:M._type})),N=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:a,products:b},"AI Search error");if(N&&N.matchedIds&&N.matchedIds.length>0){const{contentTokens:M,cleanedQuery:m}=Oe(a),r=new Set(N.matchedIds),T=i.filter(P=>r.has(P.id)).sort((P,z)=>n(z,M,m)-n(P,M,m));T.length>0&&o(T)}else N&&N.matchedIds&&N.matchedIds.length===0&&o([])}catch(b){console.error("AI Search error:",b)}B(!1)}},Ne=a=>{if(O(a),se.current&&clearTimeout(se.current),!a.trim()){ve(V);return}const{allowedTypes:i,contentTokens:b,cleanedQuery:N}=Oe(a),M=g.filter(r=>{if(!i.has(r==null?void 0:r._type))return!1;if(b.length===0)return!0;const T=xe(Object.entries(r).filter(([P])=>!P.startsWith("_")).map(([,P])=>String(P||"")).join(" "));return b.some(P=>T.includes(P))});let m=M;V!=="all"&&(m=M.filter(r=>(r.category||r._type)===V)),o(k(m,b,N)),ee&&N.length>=3&&(se.current=setTimeout(()=>{W(N,m)},500))},ve=a=>{q(a);const{allowedTypes:i,contentTokens:b}=Oe($),{cleanedQuery:N}=Oe($);let M=g.filter(m=>i.has(m==null?void 0:m._type));a!=="all"&&(M=M.filter(m=>(m.category||m._type)===a)),$.trim()&&b.length>0&&(M=M.filter(m=>{const r=xe(Object.entries(m).filter(([T])=>!T.startsWith("_")).map(([,T])=>String(T||"")).join(" "));return b.every(T=>r.includes(T))})),o(k(M,b,N))},ye=(a,i)=>{window.KTM.clipboard.writeText(a).then(()=>{A(i),f("\u0110\xE3 copy!","success"),setTimeout(()=>A(null),1500)})},e=async(a,i)=>{try{await window.KTM.clipboard.writeImageFromUrl(a),A(i+"-img"),f("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>A(null),1500)}catch(b){ye(a,i+"-img")}},d=a=>{let i=a.toLowerCase();const b=[],N=g.filter(r=>r._type==="product");if(i.includes("ty")||i.includes("xy lanh")){if(i.includes("gi\u1EEFa")||i.includes("giua")){const r=N.find(T=>{var P;return(P=T.name)==null?void 0:P.toLowerCase().includes("xy lanh gi\u1EEFa")});r&&!b.find(T=>T.id===r.id)&&b.push(r)}if(i.includes("nghi\xEAng")||i.includes("nghieng")){const r=N.find(T=>{var P;return(P=T.name)==null?void 0:P.toLowerCase().includes("xy lanh nghi\xEAng")});r&&!b.find(T=>T.id===r.id)&&b.push(r)}if(i.includes("\u1EE7i")||i.includes("ui")){const r=N.find(T=>{var P;return(P=T.name)==null?void 0:P.toLowerCase().includes("xy lanh \u1EE7i")});r&&!b.find(T=>T.id===r.id)&&b.push(r)}}const M=i.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(M){const r=M[1],T=M[2],P=N.find(z=>{var L;const R=((L=z.name)==null?void 0:L.toLowerCase())||"";return R.includes("combo")&&R.includes(`${r} tay`)&&(R.includes(`${T} xy`)||R.includes(`${T} xylanh`))});if(P&&!b.find(z=>z.id===P.id))b.push(P);else{const z=N.find(R=>{var ce;const L=((ce=R.name)==null?void 0:ce.toLowerCase())||"";return L.includes("combo")&&L.includes(`${r} tay`)});z&&!b.find(R=>R.id===z.id)&&b.push(z)}}if(i.includes("combo")&&!M){const r=i.match(/combo.*?(\d+)\s*tay/);if(r){const T=r[1];N.filter(z=>{var L;const R=((L=z.name)==null?void 0:L.toLowerCase())||"";return R.includes("combo")&&R.includes(`${T} tay`)}).forEach(z=>{b.find(R=>R.id===z.id)||b.push(z)})}}const m=i.match(/van\s*(\d+)\s*tay/);if(m&&!i.includes("ty")&&!i.includes("combo")){const r=m[1],T=N.find(P=>{var R;const z=((R=P.name)==null?void 0:R.toLowerCase())||"";return z.includes(`van ${r} tay`)&&!z.includes("combo")});T&&!b.find(P=>P.id===T.id)&&b.push(T)}return b.slice(0,4)},c=async a=>{if(!a.trim())return;const i={role:"user",content:a,attachments:[]};de(N=>[...N,i]),ue(""),ne(!0);const b=d(a);setTimeout(()=>{var N;return(N=ie.current)==null?void 0:N.scrollIntoView({behavior:"smooth"})},100);try{const M=g.filter(R=>R._type==="product").map(R=>{let L=`- ${R.name}`;return R.code&&(L+=` (M\xE3: ${R.code})`),R.price&&(L+=` - Gi\xE1: ${R.price.replace(/[đ\s]/g,"")}\u0111`),R.category&&(L+=` [${R.category}]`),R.note&&(L+=` (${R.note})`),L}).join(`
`),r=te.slice(-6).map(R=>`${R.role==="user"?"Kh\xE1ch":"AI"}: ${R.content}`).join(`
`),T=r?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${r}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${M}`:M,z=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:a,context:T,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";de(R=>[...R,{role:"assistant",content:z,attachments:b}])}catch(N){console.error("AI Error:",N);const M=a.toLowerCase(),m=g.filter(T=>{const P=Object.values(T).join(" ").toLowerCase();return M.split(" ").some(z=>P.includes(z))});let r="";m.length>0?(r=`T\xECm th\u1EA5y ${m.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,m.slice(0,5).forEach(T=>{r+=`\u2022 ${T.name}`,T.price&&(r+=` - ${T.price.replace(/[đ\s]/g,"")}\u0111`),T.note&&(r+=` (${T.note})`),r+=`
`}),m.length>5&&(r+=`
...v\xE0 ${m.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):r='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',de(T=>[...T,{role:"assistant",content:r,attachments:m.slice(0,4)}])}ne(!1),setTimeout(()=>{var N,M;(N=ie.current)==null||N.scrollIntoView({behavior:"smooth"}),(M=$e.current)==null||M.focus()},100)};function h({show:a,product:i,categories:b,onClose:N,onSave:M}){const[m,r]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[T,P]=useState(!1),[z,R]=useState(!1),L=useRef(null),ce=G=>window.KTM.money.formatVNDInputDigits(G);useEffect(()=>{if(i)if(r({name:i.name||"",code:i.code||"",price:i.price||"",image:i.image||"",category:i.category||"",note:i.note||"",sort_order:i.sort_order||0}),i.price){const G=window.KTM.money.getDigits(i.price);Ce(G),r(Ke=>({...Ke,price:ce(G)}))}else Ce("");else r({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),Ce("")},[i,a]);const[he,Me]=React.useState(""),[je,Ce]=React.useState(""),He=G=>{const Ke=window.KTM.money.nextPriceInputState(G.target.value,je);Ce(Ke.digits),r({...m,price:Ke.price})},Ue=async(G,Ke=2)=>{const Be=Ke*1024*1024;if(G.size<=Be)return G;try{const qe=await createImageBitmap(G),Je=document.createElement("canvas");let Ie=qe.width,Ee=qe.height;const ze=1200;return(Ie>ze||Ee>ze)&&(Ie>Ee?(Ee=Math.round(Ee/Ie*ze),Ie=ze):(Ie=Math.round(Ie/Ee*ze),Ee=ze)),Je.width=Ie,Je.height=Ee,Je.getContext("2d").drawImage(qe,0,0,Ie,Ee),qe.close(),new Promise((Ge,Ye)=>{Je.toBlob(Qe=>{Qe?Ge(new File([Qe],G.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ye(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(qe){throw console.error("Compress error:",qe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Xe=async G=>{var qe;const Ke=G.target.files[0];if(!Ke)return;if(!(Ke.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Ke.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}R(!0);try{const Je=await Ue(Ke),Ie=await window.KTM.cloudinary.uploadImage({file:Je,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!Ie.secure_url)throw console.error("Cloudinary error:",Ie),new Error(((qe=Ie.error)==null?void 0:qe.message)||"Upload failed");r(Ee=>({...Ee,image:Ie.secure_url}))}catch(Je){console.error("Upload error:",Je),alert("L\u1ED7i upload \u1EA3nh: "+Je.message)}R(!1),G.target.value=""},We=async G=>{G.preventDefault(),P(!0),await M(m),P(!1)};return a?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),i?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:N})),React.createElement("form",{onSubmit:We},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:m.name,onChange:G=>r({...m,name:G.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:m.code,onChange:G=>r({...m,code:G.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:m.price,onChange:He,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:m.category,onChange:G=>r({...m,category:G.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),b.map(G=>React.createElement("option",{key:G,value:G},G)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:m.note,onChange:G=>r({...m,note:G.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},m.image?React.createElement(React.Fragment,null,React.createElement("img",{src:m.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>r({...m,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var G;return(G=L.current)==null?void 0:G.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:L,type:"file",accept:"image/*",className:"d-none",onChange:Xe}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var G;return(G=L.current)==null?void 0:G.click()},disabled:z,style:{borderRadius:"10px"}},z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:m.image,onChange:G=>r({...m,image:G.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:N,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:T,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},T?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const J=(a,i)=>{const b=a._type==="product",N=a._type==="album",M=a._type==="video",m=a.note&&(a.note.toLowerCase().includes("free")||a.note.toLowerCase().includes("gi\u1EA3m")||a.note.toLowerCase().includes("sale"));return H==="grid"?React.createElement("div",{key:a.id||i,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>pe({url:a.image,name:a.name,price:a.price,note:a.note,item:a})},a.image?React.createElement("img",{src:a.image,alt:a.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${M?"fa-video":"fa-image"} fa-2x text-muted`})),a.price&&React.createElement("div",{className:"price-overlay"},a.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${b?"product":N?"album":"video"}`},b?"SP":N?"\u1EA2nh":"Video"),m&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},a.name),a.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},a.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:_===a.id+"-img"?"copied":"",onClick:()=>e(a.image,a.id)},React.createElement("i",{className:"fas fa-image"})),a.price&&React.createElement("button",{className:_===a.id+"-price"?"copied":"",onClick:()=>ye(a.price.replace(/[đ\s]/g,""),a.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:a.id||i,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${b?"product":N?"album":"video"}`},b?"S\u1EA3n ph\u1EA9m":N?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},a.image?React.createElement("img",{src:a.image,alt:a.name,className:"thumb",loading:"lazy",onClick:()=>pe({url:a.image,name:a.name,price:a.price,note:a.note,item:a})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${M?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},a.name),React.createElement("div",{className:"price-row"},a.price&&React.createElement("span",{className:"price"},a.price.replace(/[đ\s]/g,""),"\u0111"),m&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},a.code&&React.createElement("span",{className:"meta-tag"},"#",a.code),a.category&&React.createElement("span",{className:"meta-tag"},a.category),a.note&&React.createElement("span",{className:"meta-tag highlight"},a.note),a.folder&&React.createElement("span",{className:"meta-tag"},a.folder),M&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},b&&React.createElement("button",{onClick:()=>l&&l("orders","create",{productId:a.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),a.price&&React.createElement("button",{className:_===a.id+"-price"?"copied":"",onClick:()=>ye(a.price.replace(/[đ\s]/g,""),a.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:_===a.id+"-name"?"copied":"",onClick:()=>ye(a.name,a.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),M&&a.youtubeId&&React.createElement("button",{className:_===a.id+"-yt"?"copied":"",onClick:()=>ye(`https://www.youtube.com/watch?v=${a.youtubeId}`,a.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),b&&React.createElement("button",{className:"action-edit",onClick:()=>Y(a)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Fe(a)},React.createElement("i",{className:"fas fa-trash"}))))},[le,K]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,S.length)," k\u1EBFt qu\u1EA3",ee&&$.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),V!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},V==="product"?"S\u1EA3n ph\u1EA9m":V==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${H==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>U("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${H==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>U("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},I?React.createElement("div",null,[...Array(8)].map((a,i)=>React.createElement("div",{key:i,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):S.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',$,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{O(""),Ne("")}},"Xem t\u1EA5t c\u1EA3")):H==="grid"?React.createElement("div",{className:"product-grid-mobile"},S.map((a,i)=>J(a,i))):React.createElement("div",null,S.map((a,i)=>J(a,i)))),le&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>K(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${V==="all"?"active":""}`,onClick:()=>{ve("all"),K(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${V==="product"?"active":""}`,onClick:()=>{ve("product"),K(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${V==="album"?"active":""}`,onClick:()=>{ve("album"),K(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${V==="video"?"active":""}`,onClick:()=>{ve("video"),K(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:ee,onChange:a=>w(a.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:E,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:$,onChange:a=>Ne(a.target.value)}),React.createElement("button",{className:`filter-btn ${le||V!=="all"?"active":""}`,onClick:()=>K(!le)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:re?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>ae(!0),onTouchStart:()=>ae(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),we&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>ae(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},te.map((a,i)=>React.createElement("div",{key:i,className:`mb-3 ${a.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${a.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:a.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},a.content,a.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:_===`chat-${i}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:_===`chat-${i}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(a.content),A(`chat-${i}`),setTimeout(()=>A(null),1500)}},React.createElement("i",{className:`fas ${_===`chat-${i}`?"fa-check":"fa-copy"}`})),a.attachments&&a.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},a.attachments.map((b,N)=>React.createElement("div",{key:N,style:{width:70},className:"text-center"},b.image&&React.createElement("img",{src:b.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>pe({url:b.image,name:b.name,price:b.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},b.name),b.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},b.price.replace(/[đ\s]/g,""),"\u0111"))))))),ke&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:ie})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(a=>React.createElement("button",{key:a,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>c(a),disabled:ke,style:{whiteSpace:"nowrap"}},a))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:a=>{a.preventDefault(),c(X)},className:"chat-input-wrap"},React.createElement("input",{ref:$e,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:X,onChange:a=>ue(a.target.value),disabled:ke}),React.createElement("button",{type:"submit",className:"send-btn",disabled:ke||!X.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),ge&&React.createElement("div",{className:"preview-modal",onClick:()=>pe(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>pe(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:a=>a.stopPropagation()},React.createElement("img",{src:ge.url,alt:ge.name})),React.createElement("div",{className:"preview-footer",onClick:a=>a.stopPropagation()},React.createElement("div",{className:"name"},ge.name),ge.price&&React.createElement("div",{className:"price"},ge.price.replace(/[đ\s]/g,""),"\u0111"),ge.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},ge.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:_==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:_==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>e(ge.url,"preview")},React.createElement("i",{className:`fas ${_==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),ge.price&&React.createElement("button",{className:_==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>ye(ge.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${_==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(h,{show:Ae,product:De,categories:D,onClose:()=>{fe(!1),_e(null)},onSave:Te}),React.createElement("div",{className:`fab-container mobile-only ${re?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{be(!1),fe(!0),_e(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{be(!1),l&&l("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${re?"open":""}`,onClick:()=>be(!re)},React.createElement("i",{className:"fas fa-plus"}))),Le&&s&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>t(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:F.name,onChange:a=>me({...F,name:a.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:F.code,onChange:a=>me({...F,code:a.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:F.price,onChange:a=>me({...F,price:a.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:F.category,onChange:a=>me({...F,category:a.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Re.map(a=>React.createElement("option",{key:a,value:a},a)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:F.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:a=>me({...F,note:a.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>t(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:x},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:f,showToast:l}){const[$,O]=useState([]),[S,o]=useState([]),[g,y]=useState(!0),[D,u]=useState(null),[V,q]=useState(!1),[_,A]=useState(null),[H,U]=useState(!1),[I,v]=useState(null),[j,Z]=useState(null),[Q,p]=useState([]);useEffect(()=>{E()},[]);const E=async(t=null)=>{y(!0);try{const s=t?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${t}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,C=await window.KTM.api.getJSON(s,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");O(Array.isArray(C)?C:[])}catch(s){console.error(s),l("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}y(!1)},ee=async t=>{try{const s=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${t}`,"L\u1ED7i t\u1EA3i video");o(Array.isArray(s)?s:[])}catch(s){console.error(s)}},w=async t=>{if(t===0)return;const s=[...$];[s[t-1],s[t]]=[s[t],s[t-1]],O(s),await B(s)},oe=async t=>{if(t===$.length-1)return;const s=[...$];[s[t],s[t+1]]=[s[t+1],s[t]],O(s),await B(s)},B=async t=>{try{await Promise.all(t.map((s,C)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${s.id}`,{sortOrder:C},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),l("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(s){l("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),E(j==null?void 0:j.id)}},se=async t=>{if(t===0)return;const s=[...S];[s[t-1],s[t]]=[s[t],s[t-1]],o(s),await ae(s)},we=async t=>{if(t===S.length-1)return;const s=[...S];[s[t],s[t+1]]=[s[t+1],s[t]],o(s),await ae(s)},ae=async t=>{try{await Promise.all(t.map((s,C)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${s.id}`,{sort_order:C},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),l("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(s){l("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ee(D.id)}},te=()=>{A(null),q(!0)},de=t=>{A(t),q(!0)},X=async t=>{try{!_&&j&&(t.parent_id=j.id);const s=_?`${API_BASE}/api/video-folders/${_.id}`:`${API_BASE}/api/video-folders`;_?await window.KTM.api.putJSON(s,t,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(s,t,"L\u1ED7i l\u01B0u folder"),l(_?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),q(!1),E(j==null?void 0:j.id)}catch(s){l(s.message,"danger")}},ue=async t=>{const s=t.subfolderCount>0?`X\xF3a folder "${t.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${t.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(s))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${t.id}`,"L\u1ED7i x\xF3a folder"),l("\u0110\xE3 x\xF3a folder","success"),u(null),E(j==null?void 0:j.id)}catch(C){l("L\u1ED7i x\xF3a folder","danger")}},ke=t=>{t.subfolderCount>0?(p(s=>[...s,t]),Z(t),E(t.id)):(u(t),o(t.videos||[]))},ne=t=>{if(t==="root")p([]),Z(null),E(null);else if(t){const s=Q.findIndex(C=>C.id===t.id);s>=0&&(p(Q.slice(0,s+1)),Z(t),E(t.id))}else{const s=[...Q];s.pop();const C=s[s.length-1]||null;p(s),Z(C),E(C==null?void 0:C.id)}},ie=()=>{v(null),U(!0)},$e=t=>{v(t),U(!0)},ge=async t=>{try{t.folder_id=D==null?void 0:D.id;const s=I?`${API_BASE}/api/videos/${I.id}`:`${API_BASE}/api/videos`;I?await window.KTM.api.putJSON(s,t,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(s,t,"L\u1ED7i l\u01B0u video"),l(I?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),U(!1),E(),D&&ee(D.id)}catch(s){l(s.message,"danger")}},pe=async t=>{if(confirm(`X\xF3a video "${t.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${t.id}`,"L\u1ED7i x\xF3a video"),l("\u0110\xE3 x\xF3a video","success"),E(),D&&ee(D.id)}catch(s){l("L\u1ED7i x\xF3a video","danger")}},Le=t=>{const s=`https://www.youtube.com/watch?v=${t.youtubeId}`;window.KTM.clipboard.writeText(s).then(()=>{l("\u0110\xE3 copy link!","success")}).catch(()=>{l("Kh\xF4ng th\u1EC3 copy link","danger")})};return D?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>u(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${D.slug==="shorts"?"text-danger":"text-warning"}`}),D.name)),React.createElement("button",{className:"btn btn-warning",onClick:ie},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),S.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},S.map((t,s)=>React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>se(s),disabled:s===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},s+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>we(s),disabled:s===S.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:t.thumb,className:"card-img-top",alt:t.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${t.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:t.title},t.title),React.createElement("small",{className:"text-muted"},t.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Le(t),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>$e(t),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>pe(t),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:H,video:I,onClose:()=>U(!1),onSave:ge})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},j&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ne()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),j?j.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:te},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Q.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:t=>{t.preventDefault(),ne("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Q.map((t,s)=>React.createElement("li",{key:t.id,className:`breadcrumb-item ${s===Q.length-1?"active":""}`},s===Q.length-1?t.name:React.createElement("a",{href:"#",onClick:C=>{C.preventDefault(),ne(t)},className:"text-warning"},t.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),g?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):$.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},j?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:te},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",j?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},$.map((t,s)=>{var C,re,be,Ae;return React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:fe=>{fe.stopPropagation(),w(s)},disabled:s===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},s+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:fe=>{fe.stopPropagation(),oe(s)},disabled:s===$.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>ke(t),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${t.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},t.name),React.createElement("p",{className:"text-muted mb-0"},t.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),t.subfolderCount," folder"),t.subfolderCount>0&&(t.videoCount>0||((C=t.videos)==null?void 0:C.length)>0)&&" \u2022 ",(t.videoCount>0||((re=t.videos)==null?void 0:re.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),t.videoCount||((be=t.videos)==null?void 0:be.length)||0," videos"),t.subfolderCount===0&&!t.videoCount&&!((Ae=t.videos)!=null&&Ae.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:fe=>{fe.stopPropagation(),de(t)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:fe=>{fe.stopPropagation(),ue(t)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:V,folder:_,onClose:()=>q(!1),onSave:X}))}function VideoFolderModal({show:f,folder:l,onClose:$,onSave:O}){const[S,o]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[g,y]=useState(!1),[D,u]=useState(!1);useEffect(()=>{o(l?{name:l.name||"",description:l.description||"",sortOrder:l.sortOrder||0,coverImage:l.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[l,f]);const V=async _=>{const A=_.target.files[0];if(A){u(!0);try{const H=await window.KTM.cloudinary.uploadImage({file:A,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});H.secure_url&&o(U=>({...U,coverImage:H.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(H){console.error("Cloudinary upload error:",H),alert("L\u1ED7i upload \u1EA3nh: "+(H.message||H))}finally{u(!1)}}},q=async _=>{_.preventDefault(),y(!0),await O(S),y(!1)};return f?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},l?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:q},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:S.name,onChange:_=>o({...S,name:_.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:S.description,onChange:_=>o({...S,description:_.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:S.sortOrder,onChange:_=>o({...S,sortOrder:parseInt(_.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},S.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:S.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>o({...S,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:V,disabled:D}),D&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:S.coverImage,onChange:_=>o({...S,coverImage:_.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:g},g?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:f}){const[l,$]=useState([]),[O,S]=useState(!0),[o,g]=useState(!1),[y,D]=useState(null),[u,V]=useState(""),[q,_]=useState(""),A=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{H()},[]);const H=async()=>{S(!0);try{const p=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");$(Array.isArray(p)?p:[])}catch(p){console.error(p),f("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}S(!1)},U=()=>{D(null),g(!0)},I=p=>{D(p),g(!0)},v=async p=>{if(!(!p||!p.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:p},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),f(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),H()}catch(E){f("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},j=async p=>{try{const E=y?`${API_BASE}/api/products?id=${y.id}`:`${API_BASE}/api/products`;y?await window.KTM.api.putJSON(E,p,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(E,p,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),f(y?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),g(!1),H()}catch(E){f(E.message,"danger")}},Z=async p=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${p.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${p.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),f("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),H()}catch(E){f(E.message,"danger")}},Q=l.filter(p=>{const E=!u||p.name.toLowerCase().includes(u.toLowerCase())||p.code&&p.code.toLowerCase().includes(u.toLowerCase()),ee=!q||p.category===q;return E&&ee});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:U},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:u,onChange:p=>V(p.target.value)})),React.createElement("span",{className:"product-count"},Q.length)),React.createElement("select",{className:"form-select",value:q,onChange:p=>_(p.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),A.map(p=>React.createElement("option",{key:p,value:p},p)))),O?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):Q.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:U},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},Q.map(p=>React.createElement("div",{key:p.id,className:"product-item d-flex align-items-center gap-3"},p.image?React.createElement("img",{src:p.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},p.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},p.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},p.category),p.code&&React.createElement("span",{className:"product-badge bg-secondary"},p.code)),React.createElement("div",{className:"product-price"},p.price?p.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),p.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},p.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>I(p),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>Z(p),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:o,product:y,categories:A,onClose:()=>g(!1),onSave:j}))}function ProductModal({show:f,product:l,categories:$,onClose:O,onSave:S}){const[o,g]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[y,D]=useState(!1),[u,V]=useState(!1);useEffect(()=>{g(l?{name:l.name||"",code:l.code||"",price:l.price||"",image:l.image||"",category:l.category||"",note:l.note||"",sort_order:l.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[l,f]);const[q,_]=React.useState(""),A=w=>window.KTM.money.formatVNDInputDigits(w),[H,U]=React.useState(""),I=w=>{const oe=window.KTM.money.nextPriceInputState(w.target.value,H);U(oe.digits),g({...o,price:oe.price})},[v,j]=React.useState("");React.useEffect(()=>{l!=null&&l.image&&j(l.image)},[l]);const Z=async w=>{if(!(!w||!w.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:w},"L\u1ED7i x\xF3a \u1EA3nh")}catch(oe){console.error("Delete cloudinary image error:",oe)}},Q=async(w,oe=2,B)=>{const se=oe*1024*1024,we=w.type==="image/heic"||w.type==="image/heif"||/\.heic$/i.test(w.name);if(w.size<=se&&!we)return w;B==null||B("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const ae=await createImageBitmap(w);B==null||B("\u0110ang n\xE9n \u1EA3nh...");const te=document.createElement("canvas");let de=ae.width,X=ae.height;const ue=1200;return(de>ue||X>ue)&&(de>X?(X=Math.round(X/de*ue),de=ue):(de=Math.round(de/X*ue),X=ue)),te.width=de,te.height=X,te.getContext("2d").drawImage(ae,0,0,de,X),ae.close(),new Promise((ne,ie)=>{te.toBlob($e=>{$e?(B==null||B("Ho\xE0n t\u1EA5t!"),ne(new File([$e],w.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):ie(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ae){throw console.error("createImageBitmap error:",ae),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},p=async w=>{var se,we;const oe=(se=w.target.files)==null?void 0:se[0];if(!oe)return;if(!(oe.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(oe.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}V(!0),_("\u0110ang chu\u1EA9n b\u1ECB...");try{const ae=(oe.size/1024/1024).toFixed(1);_(`File ${ae}MB - \u0110ang n\xE9n...`);const te=await Q(oe,2,ue=>{_(ue)}),de=(te.size/1024/1024).toFixed(1);_(`\u0110\xE3 n\xE9n: ${de}MB - \u0110ang upload...`);const X=await window.KTM.cloudinary.uploadImage({file:te,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});X.secure_url?(o.image&&o.image!==v&&Z(o.image),g(ue=>({...ue,image:X.secure_url})),_("")):(console.error("Cloudinary error:",X),alert("Upload th\u1EA5t b\u1EA1i: "+(((we=X.error)==null?void 0:we.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),_(""))}catch(ae){console.error("Upload error:",ae),alert("L\u1ED7i: "+ae.message),_("")}V(!1),w.target.value=""},E=()=>{o.image&&(o.image!==v&&Z(o.image),g(w=>({...w,image:""})))},ee=async w=>{w.preventDefault(),D(!0),v&&o.image&&v!==o.image&&await Z(v),v&&!o.image&&await Z(v),await S(o),D(!1)};return f?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${l?"fa-edit":"fa-plus-circle"} me-2`}),l?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:O})),React.createElement("form",{onSubmit:ee},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},o.image?React.createElement(React.Fragment,null,React.createElement("img",{src:o.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:E,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${u?"fa-spinner fa-spin":"fa-camera"} me-1`}),u?q||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:p,disabled:u,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),u&&q&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},q))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:o.name,onChange:w=>g({...o,name:w.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:o.code,onChange:w=>g({...o,code:w.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:o.price,onChange:I,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:o.category,onChange:w=>g({...o,category:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),$.map(w=>React.createElement("option",{key:w,value:w},w)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:o.note,onChange:w=>g({...o,note:w.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:o.image,onChange:w=>g({...o,image:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:O,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:y,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:f,video:l,onClose:$,onSave:O}){const[S,o]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[g,y]=useState(!1),[D,u]=useState("");useEffect(()=>{l?(o({title:l.title||"",youtube_url:`https://www.youtube.com/watch?v=${l.youtubeId}`,thumbnail_url:l.thumb||"",sort_order:l.sortOrder||0}),u(l.thumb)):(o({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),u(""))},[l,f]);const V=A=>{const H=A.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return H?H[1]:null},q=A=>{o({...S,youtube_url:A});const H=V(A);H&&u(`https://img.youtube.com/vi/${H}/hqdefault.jpg`)},_=async A=>{A.preventDefault(),y(!0),await O(S),y(!1)};return f?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},l?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:_},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:S.youtube_url,onChange:A=>q(A.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),D&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:D,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:S.title,onChange:A=>o({...S,title:A.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:S.sort_order,onChange:A=>o({...S,sort_order:parseInt(A.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:S.thumbnail_url,onChange:A=>o({...S,thumbnail_url:A.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:g},g?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[f,l]=useState(!1),[$,O]=useState(""),[S,o]=useState(null),[g,y]=useState("search"),[D,u]=useState(null),[V,q]=useState(""),[_,A]=useState([]),[H,U]=useState(null),[I,v]=useState(!1),[j,Z]=useState(null),[Q,p]=useState(!0),[E,ee]=useState([]),[w,oe]=useState(null),[B,se]=useState([]);useEffect(()=>{const t=localStorage.getItem("ktm_admin_session");if(t)try{const s=JSON.parse(t);s.expiry>Date.now()?(l(!0),o(s.user)):localStorage.removeItem("ktm_admin_session")}catch(s){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{f&&X()},[f]);const we=async(t,s)=>{O("");try{const C=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:t,password:s},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),re={user:C.user,token:C.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(re)),o(C.user),l(!0)}catch(C){O(C.message)}},ae=()=>{localStorage.removeItem("ktm_admin_session"),l(!1),o(null),A([]),U(null)},te=(t,s="success")=>{const C=Date.now();ee(re=>[...re,{id:C,message:t,type:s}])},de=t=>{ee(s=>s.filter(C=>C.id!==t))},X=async(t=null)=>{p(!0);try{const s=t?`${API_BASE}/api/albums?parent_id=${t}`:`${API_BASE}/api/albums?parent_id=root`,C=await window.KTM.api.getJSON(s,"L\u1ED7i t\u1EA3i danh s\xE1ch album");A(Array.isArray(C)?C:[])}catch(s){console.error(s),te("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}p(!1)},ue=()=>{Z(null),v(!0)},ke=t=>{Z(t),v(!0)},ne=async t=>{try{const s=j&&j.uuid;!s&&w&&(t.parent_id=w.uuid);const C=s?`${API_BASE}/api/albums/${j.uuid||j.id}`:`${API_BASE}/api/albums`;s?await window.KTM.api.putJSON(C,t,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(C,t,"L\u1ED7i t\u1EA1o"),te(s?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),v(!1),X(w==null?void 0:w.uuid)}catch(s){te(s.message,"danger")}},ie=t=>{U(t)},$e=t=>{if(t==="root")se([]),oe(null),X(null);else if(t){const s=B.findIndex(C=>C.uuid===t.uuid);s>=0&&(se(B.slice(0,s+1)),oe(t),X(t.uuid))}else{const s=[...B];s.pop();const C=s[s.length-1]||null;se(s),oe(C),X(C==null?void 0:C.uuid)}},ge=async t=>{const s=`X\xF3a folder "${t.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(s))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${t.uuid||t.id}`,"L\u1ED7i x\xF3a album"),te("\u0110\xE3 x\xF3a","success"),X(w==null?void 0:w.uuid)}catch(C){te("L\u1ED7i x\xF3a album","danger")}};if(!f)return React.createElement(LoginPage,{onLogin:we,error:$});const pe=()=>{const t=new Date,s=t.getFullYear(),C=String(t.getMonth()+1).padStart(2,"0");return`${s}-${C}`};function Le(){const[t,s]=useState(pe()),[C,re]=useState(!0),[be,Ae]=useState([]),{parseMoney:fe,parseShipFeeFromNote:De,getShipFeeForItems:_e,formatNumber:F,formatVND:me}=window.KTM.money,Re=async()=>{re(!0);try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(t)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA");Ae(Array.isArray(x)?x:[])}catch(x){console.error("Load stats error:",x),Ae([])}finally{re(!1)}};useEffect(()=>{Re()},[t]);const Y=React.useMemo(()=>{var le;const x={pending:0,processing:0,done:0,paid:0,other:0};let Fe=0,Te=0,Pe=0,Ve=0,Se=0;const xe=K=>K.customer_id||K.phone||"unknown",Oe=K=>window.KTM.orders.getOrderItems(K),n=new Map,k=new Map,W=new Map;for(const K of be){const a=Oe(K);let i=0,b=0;for(const L of a){const ce=Number((L==null?void 0:L.quantity)||0)||0,he=fe(L==null?void 0:L.product_price),Me=ce*he;i+=ce,b+=Me;const je=(L==null?void 0:L.product_id)||"unknown",Ce=n.get(je)||{product_id:je,product_name:(L==null?void 0:L.product_name)||"\u2014",product_code:(L==null?void 0:L.product_code)||"",orders:0,quantity:0,revenue:0};Ce.orders+=1,Ce.quantity+=ce,Ce.revenue+=Me,n.set(je,Ce)}const N=_e(a),M=Number((le=K==null?void 0:K.adjustment_amount)!=null?le:0)||0,m=b+(N.found?N.fee:0)+M,r=b+M;Fe+=i,Te+=m,Ve+=r;const T=K.status==="done"||K.status==="paid";K.status==="pending"?x.pending+=1:K.status==="processing"?x.processing+=1:K.status==="paid"?(x.paid+=1,x.done+=1,Pe+=m,Se+=r):K.status==="done"?(x.done+=1,Pe+=m,Se+=r):x.other+=1;const P=xe(K),z=k.get(P)||{key:P,customer_name:K.customer_name||"",phone:K.phone||"",orders:0,quantity:0,revenue:0};z.orders+=1,z.quantity+=i,z.revenue+=m,!z.customer_name&&K.customer_name&&(z.customer_name=K.customer_name),!z.phone&&K.phone&&(z.phone=K.phone),k.set(P,z);const R=K.created_at?new Date(K.created_at):null;if(R&&!Number.isNaN(R.getTime())){const L=`${R.getFullYear()}-${String(R.getMonth()+1).padStart(2,"0")}-${String(R.getDate()).padStart(2,"0")}`,ce=W.get(L)||{day:L,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};ce.orders+=1,ce.quantity+=i,ce.revenue+=m,T&&(ce.doneOrders+=1,ce.doneRevenue+=m),W.set(L,ce)}}const Ne=Array.from(n.values()).sort((K,a)=>a.revenue-K.revenue),ve=Array.from(k.values()).sort((K,a)=>a.revenue-K.revenue),ye=Array.from(W.values()).sort((K,a)=>K.day.localeCompare(a.day)),e=k.size,d=be.length?Math.round(Te/be.length):0,c=be.length?Fe/be.length:0,h=Math.round(Se*.05),J=Math.round(Ve*.05);return{statusCounts:x,totalQty:Fe,totalRevenue:Te,doneRevenue:Pe,tempCommission:h,tempCommissionAll:J,products:Ne,customers:ve,days:ye,uniqueCustomers:e,avgOrderValue:d,avgQtyPerOrder:c}},[be,t]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:C}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:Re,disabled:C},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:t,onChange:x=>s(x.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),F(be.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),F(Y.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),F(Y.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",F(Y.statusCounts.paid),"/",F(Y.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},F(be.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},me(Y.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},me(Y.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},me(Y.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},me(Y.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",Y.avgQtyPerOrder?Y.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},F(Y.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},F(Y.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},F(Y.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},F(Y.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},F(Y.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,F(Y.statusCounts.pending)),React.createElement("td",null,F(Y.statusCounts.processing)),React.createElement("td",null,F(Y.statusCounts.done)),React.createElement("td",null,F(Y.statusCounts.paid)),React.createElement("td",null,F(Y.statusCounts.other)),React.createElement("td",null,F(Y.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Y.products.slice(0,10).map(x=>React.createElement("div",{key:x.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},x.product_name),React.createElement("div",{className:"text-muted small text-truncate"},x.product_code?`#${x.product_code} \u2022 `:"",F(x.orders)," \u0111\u01A1n \u2022 ",F(x.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},me(x.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Y.products.slice(0,10).map(x=>React.createElement("tr",{key:x.product_id},React.createElement("td",null,x.product_name),React.createElement("td",null,x.product_code||"\u2014"),React.createElement("td",null,F(x.orders)),React.createElement("td",null,F(x.quantity)),React.createElement("td",{className:"fw-semibold"},me(x.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Y.customers.slice(0,10).map(x=>React.createElement("div",{key:x.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},x.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},x.phone||"\u2014"," \u2022 ",F(x.orders)," \u0111\u01A1n \u2022 ",F(x.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},me(x.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Y.customers.slice(0,10).map(x=>React.createElement("tr",{key:x.key},React.createElement("td",null,x.customer_name||"\u2014"),React.createElement("td",null,x.phone||"\u2014"),React.createElement("td",null,F(x.orders)),React.createElement("td",null,F(x.quantity)),React.createElement("td",{className:"fw-semibold"},me(x.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},Y.days.map(x=>React.createElement("div",{key:x.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},x.day),React.createElement("div",{className:"text-muted small"},F(x.orders)," \u0111\u01A1n \u2022 ",F(x.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",F(x.doneOrders)," \u2022 ",me(x.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},me(x.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,Y.days.map(x=>React.createElement("tr",{key:x.day},React.createElement("td",null,x.day),React.createElement("td",null,F(x.orders)),React.createElement("td",null,F(x.quantity)),React.createElement("td",{className:"fw-semibold"},me(x.revenue)),React.createElement("td",null,F(x.doneOrders)),React.createElement("td",{className:"fw-semibold"},me(x.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:g,onMenuChange:t=>{y(t),t==="albums"&&(oe(null),se([]),X(null))},onLogout:ae,currentUser:S}),React.createElement("div",{className:"main-content"},g==="albums"&&!H&&React.createElement(AlbumList,{albums:_,loading:Q,currentFolder:w,breadcrumb:B,onSelect:ie,onCreate:ue,onEdit:ke,onDelete:ge,onBack:$e}),g==="search"&&React.createElement(SearchCenter,{showToast:te,onNavigate:(t,s,C)=>{y(t),t==="orders"&&s==="create"&&(u(Date.now()),q((C==null?void 0:C.productId)||""))}}),g==="albums"&&H&&React.createElement(AlbumDetail,{album:H,parentAlbum:B.length>0?B[B.length-1]:null,onBack:()=>{if(H.parentId){const t=B.findIndex(s=>s.uuid===H.parentId);t>=0?U(B[t]):U(null)}else U(null)},onRefresh:()=>X(w==null?void 0:w.uuid),showToast:te,onNavigateToFolder:t=>{se(s=>[...s,H]),U(t)},onEditSubfolder:t=>{Z(t),v(!0)}}),g==="videos"&&React.createElement(VideoList,{showToast:te}),g==="products"&&React.createElement(ProductManager,{showToast:te}),g==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:D,autoOpenCreateProductId:V,showToast:te}),g==="stats"&&React.createElement(Le,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${g==="search"?"active":""}`,onClick:t=>{t.preventDefault(),y("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${g==="albums"?"active":""}`,onClick:t=>{t.preventDefault(),y("albums"),U(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${g==="videos"?"active":""}`,onClick:t=>{t.preventDefault(),y("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${g==="products"?"active":""}`,onClick:t=>{t.preventDefault(),y("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${g==="orders"?"active":""}`,onClick:t=>{t.preventDefault(),y("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${g==="stats"?"active":""}`,onClick:t=>{t.preventDefault(),y("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:I,album:j,parentId:w==null?void 0:w.uuid,onClose:()=>v(!1),onSave:ne}),React.createElement("div",{className:"toast-container"},E.map(t=>React.createElement(Toast,{key:t.id,message:t.message,type:t.type,onClose:()=>de(t.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:f,autoOpenCreateProductId:l,showToast:$}){const[O,S]=useState([]),[o,g]=useState(!0),[y,D]=useState(!1),[u,V]=useState(null),[q,_]=useState(""),[A,H]=useState(!1),[U,I]=useState(null),[v,j]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Z,Q]=useState([""]),[p,E]=useState(null),ee=useRef({}),[w,oe]=useState([]),[B,se]=useState(null),we=useRef(null),ae=useRef(null),te=useRef(0),de=useRef(null),X=useRef(0),ue=3;useEffect(()=>{const e=d=>{var h;if(p==null)return;const c=(h=ee.current)==null?void 0:h[p];c&&!c.contains(d.target)&&E(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[p]);const ke=e=>window.KTM.money.parseMoney(e),ne=e=>window.KTM.money.parseSignedMoney(e),ie=e=>window.KTM.money.formatVND(e),$e=e=>window.KTM.money.parseShipFeeFromNote(e),ge=e=>window.KTM.phone.isValid(e),pe=e=>window.KTM.phone.normalize(e),Le=async e=>{const d=pe(e);if(!d)return;const c=++te.current;I({status:"loading",phone:d});try{const h=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(d)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(te.current!==c)return;if(h&&h.exists&&h.customer){I({status:"found",phone:d,customer:h.customer}),j(J=>pe(J.phone)!==d?J:{...J,customer_name:h.customer.name||J.customer_name,address:h.customer.address||J.address});return}I({status:"not-found",phone:d})}catch(h){if(te.current!==c)return;console.error("Customer lookup error:",h),I({status:"error",phone:d})}},t=e=>{const d=pe(e);if(j(h=>({...h,phone:d})),ae.current&&(clearTimeout(ae.current),ae.current=null),d.length<ue){I(null);return}ae.current=setTimeout(()=>{Le(d)},350)},s=()=>{const e=pe(v.phone);e.length<ue||Le(e)};useEffect(()=>(A?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[A]);const C=Array.isArray(v.items)?v.items.length:0;useEffect(()=>{if(!A){X.current=C;return}C>X.current&&setTimeout(()=>{const e=de.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),X.current=C},[A,C]),useEffect(()=>()=>{ae.current&&(clearTimeout(ae.current),ae.current=null)},[]),useEffect(()=>{De()},[]),useEffect(()=>{_e()},[q]),useEffect(()=>{f&&we.current!==f&&(we.current=f,Re(l))},[f]);const re=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e||"",be=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":"bg-light text-dark",Ae=React.useMemo(()=>window.KTM.orders.sortOrders(O),[O]),fe=e=>window.KTM.date.formatDateTime(e),De=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");oe(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),oe([])}},_e=async()=>{g(!0);try{let e=`${API_BASE}/api/orders`;q&&(e+=`?month=${q}`);const d=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");S(Array.isArray(d)?d:[])}catch(e){console.error("Load orders error:",e),S([])}finally{g(!1)}},F=async()=>{const e=pe(v.phone),c=(Array.isArray(v.items)?v.items:[]).map(h=>{var J;return{product_id:(h==null?void 0:h.product_id)||"",quantity:Number((J=h==null?void 0:h.quantity)!=null?J:1)}}).filter(h=>h.product_id&&Number.isFinite(h.quantity)&&h.quantity>0);if(!v.customer_name||!e||c.length===0){alert("Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c");return}if(!ge(e)){alert("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)");return}D(!0);try{const h=B?`${API_BASE}/api/orders/${B}`:`${API_BASE}/api/orders`,J=c[0],le={customer_name:v.customer_name,phone:e,address:v.address,adjustment_amount:ne(v.adjustment_amount),adjustment_note:(v.adjustment_note||"").trim(),product_id:J.product_id,quantity:J.quantity,status:v.status,items:c,...B?{id:B}:{}};B?await window.KTM.api.putJSON(h,le,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng"):await window.KTM.api.postJSON(h,le,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng"),j({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),se(null),H(!1),_e()}catch(h){console.error(h),typeof $=="function"?$(h.message,"danger"):alert(h.message);return}finally{D(!1)}},me=e=>{var c;se(e.id);const d=Array.isArray(e.items)&&e.items.length?e.items.map(h=>{var J;return{product_id:(h==null?void 0:h.product_id)||"",quantity:Number((J=h==null?void 0:h.quantity)!=null?J:1)||1}}).filter(h=>h.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];j({customer_name:e.customer_name||"",phone:pe(e.phone||""),address:e.address||"",items:d.length?d:[{product_id:"",quantity:1}],adjustment_amount:Number((c=e==null?void 0:e.adjustment_amount)!=null?c:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),Q(new Array(d.length?d.length:1).fill("")),I(null),H(!0),e.phone&&Le(pe(e.phone))};function Re(e){se(null),j({customer_name:"",phone:"",address:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Q([""]),I(null),H(!0)}const Y=()=>{y||(H(!1),se(null),j({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Q([""]),E(null),I(null))},x=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const d=String(e),c=w.find(h=>String(h==null?void 0:h.id)===d);return c?`${c.name}${c.code?` (${c.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Fe=e=>{const d=String(Z[e]||"").trim().toLowerCase();return d?w.filter(c=>{const h=String((c==null?void 0:c.name)||"").toLowerCase(),J=String((c==null?void 0:c.code)||"").toLowerCase();return h.includes(d)||J.includes(d)}):w},Te=e=>{if(!e)return null;const d=String(e);return w.find(c=>String(c==null?void 0:c.id)===d)||null},Pe=e=>window.KTM.orders.getOrderItems(e),Ve=e=>window.KTM.orders.getOrderTotalQty(e),Se=e=>window.KTM.orders.getOrderProductSummary(e,Te),xe=e=>window.KTM.orders.getOrderItemRows(e,Te),Oe=e=>window.KTM.orders.getOrderAdjustmentMoney(e),n=e=>{var b;const d=Pe(e),c=xe(e),h=Ne(d),J=W(d),le=J.fee,K=Oe(e),a=h+le+K,i=[];if(i.push(`\u0110\u01A0N H\xC0NG #${(b=e==null?void 0:e.id)!=null?b:""}`.trim()),e!=null&&e.customer_name&&i.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&i.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&i.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),e!=null&&e.status&&i.push(`Tr\u1EA1ng th\xE1i: ${re(e.status)}`),e!=null&&e.created_at&&i.push(`Th\u1EDDi gian: ${fe(e.created_at)}`),i.push(""),i.push("S\u1EA3n ph\u1EA9m:"),c.length)for(const N of c)i.push(`- ${N.name} x${N.qty}`);else{const N=Se(e);N&&N!=="\u2014"&&i.push(`- ${N}`)}return i.push(""),i.push(`T\u1EA1m t\xEDnh: ${ie(h)}`),i.push(`Ship: ${ie(J.found?le:0)}`),K!==0&&i.push(`\u0110i\u1EC1u ch\u1EC9nh: ${ie(K)}`),e!=null&&e.adjustment_note&&i.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),i.push(`T\u1ED5ng: ${ie(a)}`),i.filter(Boolean).join(`
`)},k=async e=>{try{const d=n(e);await window.KTM.clipboard.writeText(d),typeof $=="function"?$("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(d){console.error(d),typeof $=="function"?$("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},W=e=>window.KTM.orders.getOrderShipInfo(e,Te),Ne=e=>window.KTM.orders.getItemsSubtotal(e,Te),ve=e=>window.KTM.orders.getOrderTotalMoney(e,Te),ye=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){V(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),_e()}catch(d){console.error(d),typeof $=="function"?$(d.message,"danger"):alert(d.message)}finally{V(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:o&&!A||y||!!u}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Re,disabled:y||!!u},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:q,onChange:e=>_(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),q&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{_("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:o},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:_e,disabled:o},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},O.length," \u0111\u01A1n")),o?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):O.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Ae.map(e=>React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"text-muted small"},e.phone),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address)),React.createElement("span",{className:`badge ${be(e.status)}`},re(e.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const d=xe(e);return d.length?React.createElement("div",{className:"mt-1"},d.map((c,h)=>React.createElement("div",{key:h,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},c.name),React.createElement("div",{className:"text-muted",style:{flexShrink:0}},"x",c.qty)))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Se(e))})()),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},Ve(e))),(Oe(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ie(Oe(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},ie(ve(e)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",fe(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>me(e),disabled:y||!!u},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>k(e),disabled:y||!!u},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>ye(e.id),disabled:y||u===e.id},u===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,Ae.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,Se(e)),React.createElement("td",null,Ve(e)),React.createElement("td",{className:"fw-semibold"},ie(ve(e))),React.createElement("td",null,React.createElement("span",{className:`badge ${be(e.status)}`},re(e.status))),React.createElement("td",null,fe(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>me(e),disabled:y||!!u},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>k(e),disabled:y||!!u},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>ye(e.id),disabled:y||u===e.id},u===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),A&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),B?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Y})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),F()}},React.createElement("div",{className:"modal-body",ref:de},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:v.customer_name,onChange:e=>j({...v,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",value:v.phone,onChange:e=>t(e.target.value),onBlur:s,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),(U==null?void 0:U.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(U==null?void 0:U.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(U==null?void 0:U.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(U==null?void 0:U.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:v.status,onChange:e=>j({...v,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:v.address,onChange:e=>j({...v,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:v.adjustment_amount,onChange:e=>j({...v,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm.")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:v.adjustment_note,onChange:e=>j({...v,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{j(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),Q(e=>[...Array.isArray(e)?e:[],""])},disabled:y},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(v.items)?v.items:[{product_id:"",quantity:1}]).map((e,d)=>React.createElement("div",{key:d,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:c=>{ee.current[d]=c}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{E(c=>c===d?null:d),setTimeout(()=>{const c=document.getElementById(`order-product-search-${d}`);c&&c.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},x(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),p===d&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${d}`,className:"form-control",value:Z[d]||"",onChange:c=>{const h=c.target.value;Q(J=>{const le=Array.isArray(J)?[...J]:[];return le[d]=h,le})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),Fe(d).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):Fe(d).map(c=>React.createElement("button",{key:c.id,type:"button",className:"dropdown-item",onClick:()=>{const h=String(c.id);j(J=>{const le=Array.isArray(J.items)?[...J.items]:[];return le[d]={...le[d]||{quantity:1},product_id:h},{...J,items:le}}),E(null)}},c.name,c.code?` (${c.code})`:""))),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),w.map(c=>React.createElement("option",{key:c.id,value:c.id},c.name))))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:c=>{const h=c.target.value;j(J=>{const le=Array.isArray(J.items)?[...J.items]:[];return le[d]={...le[d]||{product_id:""},quantity:h},{...J,items:le}})},min:"1",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{j(c=>{const h=Array.isArray(c.items)?[...c.items]:[];return h.splice(d,1),{...c,items:h.length?h:[{product_id:"",quantity:1}]}}),Q(c=>{const h=Array.isArray(c)?[...c]:[];return h.splice(d,1),h.length?h:[""]}),E(c=>c==null?c:c===d?null:c>d?c-1:c)},disabled:y||(Array.isArray(v.items)?v.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const d=(Array.isArray(v.items)?v.items:[]).filter(K=>K==null?void 0:K.product_id),c=Ne(d),h=W(d),J=ne(v.adjustment_amount),le=c+(h.found?h.fee:0)+J;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ie(c))),h.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ie(h.fee))),J!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ie(J))),(v.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(v.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ie(le)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Y,disabled:y,style:{borderRadius:10}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:y,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

