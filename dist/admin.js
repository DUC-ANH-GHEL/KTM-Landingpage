const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:N,error:x}){const[A,G]=useState(""),[E,$]=useState(""),[O,le]=useState(!1),[de,ee]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),x&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),x),React.createElement("form",{onSubmit:async $e=>{$e.preventDefault(),le(!0),await N(A,E),le(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:A,onChange:$e=>G($e.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:de?"text":"password",className:"form-control",value:E,onChange:$e=>$($e.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ee(!de)},React.createElement("i",{className:`fas fa-eye${de?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:N,type:x,onClose:A,actionLabel:G,onAction:E,durationMs:$}){return useEffect(()=>{const O=Number($),le=Number.isFinite(O)&&O>0?O:3e3,de=setTimeout(A,le);return()=>clearTimeout(de)},[A,$]),React.createElement("div",{className:`toast show align-items-center text-white bg-${x} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},N),G&&typeof E=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{E()}finally{A()}}},G),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:A})))}function Loading({show:N}){return N?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:N,title:x,subtitle:A,onClose:G,footer:E,children:$}){return useEffect(()=>{if(!N)return;const O=le=>{le.key==="Escape"&&(le.preventDefault(),typeof G=="function"&&G())};return document.addEventListener("keydown",O),()=>document.removeEventListener("keydown",O)},[N,G]),N?React.createElement("div",{className:`admin-drawer-root ${N?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:G,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},x),A?React.createElement("div",{className:"admin-drawer-subtitle"},A):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:G,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},$),E?React.createElement("div",{className:"admin-drawer-footer"},E):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(N){try{const x=localStorage.getItem(N);if(!x)return[];const A=JSON.parse(x);return Array.isArray(A)?A.map(G=>String(G||"").trim()).filter(Boolean):[]}catch(x){return[]}}function saveAdminMenuIdsToStorage(N,x){try{localStorage.setItem(N,JSON.stringify(Array.isArray(x)?x:[]))}catch(A){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(N){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,N),N}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(N){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,N),N}function Sidebar({activeMenu:N,onMenuChange:x,onLogout:A,currentUser:G,pinnedMenus:E,recentMenus:$,onTogglePin:O}){const le=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],de=(G==null?void 0:G.username)||(G==null?void 0:G.name)||(G==null?void 0:G.email)||"Admin",ee=useMemo(()=>{const ue=new Map;for(const M of le)ue.set(M.id,M);return ue},[]),ye=Array.isArray(E)?E:[],$e=Array.isArray($)?$:[],me=ye.map(ue=>ee.get(ue)).filter(Boolean),he=$e.filter(ue=>ue!==N).map(ue=>ee.get(ue)).filter(Boolean).slice(0,5),Ie=ue=>ye.includes(ue);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},de),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},me.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},me.map(ue=>React.createElement("a",{key:`pin-${ue.id}`,href:"#",className:`nav-link ${N===ue.id?"active":""} sidebar-quicklink`,onClick:M=>{M.preventDefault(),x(ue.id)}},React.createElement("i",{className:`fas ${ue.icon}`})," ",ue.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:M=>{M.preventDefault(),M.stopPropagation(),O&&O(ue.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),he.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},he.map(ue=>React.createElement("a",{key:`recent-${ue.id}`,href:"#",className:`nav-link ${N===ue.id?"active":""} sidebar-quicklink`,onClick:M=>{M.preventDefault(),x(ue.id)}},React.createElement("i",{className:`fas ${ue.icon}`})," ",ue.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),le.map(ue=>React.createElement("a",{key:ue.id,href:"#",className:`nav-link ${N===ue.id?"active":""} ${ue.disabled?"opacity-50":""} ${ue.highlight?"text-warning":""}`,onClick:M=>{M.preventDefault(),ue.disabled||x(ue.id)}},React.createElement("i",{className:`fas ${ue.icon}`})," ",ue.label,ue.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),ue.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${Ie(ue.id)?"pinned":""}`,onClick:M=>{M.preventDefault(),M.stopPropagation(),O&&O(ue.id)},title:Ie(ue.id)?"B\u1ECF ghim":"Ghim","aria-label":Ie(ue.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),A&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:A,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(N){const x=typeof N=="number"?N:parseFloat(String(N!=null?N:"").trim());return Number.isFinite(x)?Math.max(0,Math.min(100,x)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var N;try{const x=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!x)return{ship_percent:DEFAULT_SHIP_PERCENT};const A=JSON.parse(x);return{ship_percent:normalizeShipPercent((N=A==null?void 0:A.ship_percent)!=null?N:A==null?void 0:A.shipPercent)}}catch(x){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(N){var x;try{const A={ship_percent:normalizeShipPercent((x=N==null?void 0:N.ship_percent)!=null?x:N==null?void 0:N.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(A)),A}catch(A){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var x;const N=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((x=N==null?void 0:N.ship_percent)!=null?x:N==null?void 0:N.shipPercent)}}async function saveAdminSettingsToServer(N){var G,E,$;const x={ship_percent:normalizeShipPercent((G=N==null?void 0:N.ship_percent)!=null?G:N==null?void 0:N.shipPercent)},A=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,x,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent(($=(E=A==null?void 0:A.ship_percent)!=null?E:A==null?void 0:A.shipPercent)!=null?$:x.ship_percent)}}function AlbumList({albums:N,onSelect:x,onCreate:A,onEdit:G,onDelete:E,loading:$,currentFolder:O,onBack:le,breadcrumb:de}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},O&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:le},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),O?O.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:A},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),de&&de.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:ee=>{ee.preventDefault(),le("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),de.map((ee,ye)=>React.createElement("li",{key:ee.id,className:`breadcrumb-item ${ye===de.length-1?"active":""}`},ye===de.length-1?ee.title:React.createElement("a",{href:"#",onClick:$e=>{$e.preventDefault(),le(ee)},className:"text-warning"},ee.title))))),$?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):N.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},O?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},N.map(ee=>React.createElement("div",{key:ee.uuid||ee.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>x(ee)},ee.cover?React.createElement("img",{src:ee.cover,className:"album-cover",alt:ee.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},ee.title),React.createElement("small",{className:"text-muted"},ee.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),ee.subfolderCount),ee.subfolderCount>0&&ee.count>0&&" \u2022 ",ee.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),ee.count),ee.subfolderCount===0&&ee.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:ye=>{ye.stopPropagation(),G(ee)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:ye=>{ye.stopPropagation(),E(ee)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:N,album:x,onClose:A,onSave:G,parentId:E}){const[$,O]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[le,de]=useState(!1),[ee,ye]=useState(!1),$e=useRef(null);useEffect(()=>{O(x?{slug:x.id||"",title:x.title||"",description:x.description||"",cover_url:x.cover||"",parent_id:x.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:E||null})},[x,N,E]);const me=async M=>{M.preventDefault(),de(!0),await G($),de(!1)},he=M=>M.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Ie=async M=>{const We=M.type==="image/heic"||M.type==="image/heif"||/\.heic$/i.test(M.name);if(M.size<=2097152&&!We)return M;try{const He=await createImageBitmap(M),ve=document.createElement("canvas");let Ae=He.width,oe=He.height;const Ee=800;return(Ae>Ee||oe>Ee)&&(Ae>oe?(oe=Math.round(oe/Ae*Ee),Ae=Ee):(Ae=Math.round(Ae/oe*Ee),oe=Ee)),ve.width=Ae,ve.height=oe,ve.getContext("2d").drawImage(He,0,0,Ae,oe),He.close(),new Promise((ft,Se)=>{ve.toBlob(Ue=>{Ue?ft(new File([Ue],M.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Se(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(He){throw console.error("Compress cover error:",He),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ue=async M=>{var He;const Le=M.target.files[0];if(!Le)return;if(!(Le.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Le.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ye(!0);try{const ve=await Ie(Le),Ae=await window.KTM.cloudinary.uploadImage({file:ve,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Ae.secure_url)throw console.error("Cloudinary error:",Ae),new Error(((He=Ae.error)==null?void 0:He.message)||"Upload failed");O(oe=>({...oe,cover_url:Ae.secure_url}))}catch(ve){console.error("Cover upload error:",ve),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+ve.message)}ye(!1),M.target.value=""};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:me},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:$.title,onChange:M=>O({...$,title:M.target.value,slug:$.slug||he(M.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:$.slug,onChange:M=>O({...$,slug:M.target.value}),required:!0,disabled:!!x}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:$.description,onChange:M=>O({...$,description:M.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},$.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:$.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>O(M=>({...M,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:$e,type:"file",accept:"image/*",className:"d-none",onChange:ue}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var M;return(M=$e.current)==null?void 0:M.click()},disabled:ee},ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:$.cover_url,onChange:M=>O({...$,cover_url:M.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:A},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:le||ee},le?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:N,allAlbums:x,currentAlbumId:A,targetAlbum:G,onSelect:E,level:$=0}){const[O,le]=useState(!0),de=N.uuid||N.id,ee=de===A,ye=G===de,$e=x.filter(he=>he.parentId===de),me=$e.length>0;return React.createElement("div",{style:{marginLeft:$*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${ye?"bg-info text-white":ee?"bg-light text-muted":"hover-bg"}`,style:{cursor:ee?"not-allowed":"pointer",opacity:ee?.5:1,transition:"background 0.2s"},onClick:()=>!ee&&E(de)},me&&React.createElement("i",{className:`fas fa-chevron-${O?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:he=>{he.stopPropagation(),le(!O)}}),!me&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${ye?"-open":""} me-2 ${ye?"":"text-warning"}`}),React.createElement("span",{className:"small"},N.title),ee&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),N.count>0&&!ee&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},N.count)),O&&me&&React.createElement("div",null,$e.map(he=>React.createElement(FolderTreeItem,{key:he.uuid||he.id,folder:he,allAlbums:x,currentAlbumId:A,targetAlbum:G,onSelect:E,level:$+1}))))}function AlbumDetail({album:N,onBack:x,onRefresh:A,showToast:G,onNavigateToFolder:E,onEditSubfolder:$,parentAlbum:O}){const[le,de]=useState([]),[ee,ye]=useState([]),[$e,me]=useState(!0),[he,Ie]=useState(!1),[ue,M]=useState(""),[Le,We]=useState([]),[He,ve]=useState([]),[Ae,oe]=useState({}),[Ee,st]=useState(null),[ft,Se]=useState(!1),[Ue,ot]=useState(""),[g,f]=useState(!1),_=useRef(null),W=useRef(null),[X,H]=useState(!1),[q,ie]=useState([]),[b,S]=useState([]),[L,Y]=useState(""),[re,ne]=useState(!1),Ne=async(k,c=2)=>{const I=c*1024*1024,R=k.type==="image/heic"||k.type==="image/heif"||/\.heic$/i.test(k.name);if(k.size<=I&&!R)return k;try{const se=await createImageBitmap(k),xe=document.createElement("canvas");let K=se.width,Ke=se.height;const Xe=1200;return(K>Xe||Ke>Xe)&&(K>Ke?(Ke=Math.round(Ke/K*Xe),K=Xe):(K=Math.round(K/Ke*Xe),Ke=Xe)),xe.width=K,xe.height=Ke,xe.getContext("2d").drawImage(se,0,0,K,Ke),se.close(),new Promise((be,dt)=>{xe.toBlob(ea=>{ea?be(new File([ea],k.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):dt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(se){throw console.error("Compress error:",se),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{we(),Ve()},[N.id,N.uuid]);const we=async()=>{me(!0);try{const k=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");de(k.images||[]);const c=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ye(Array.isArray(c)?c:[])}catch(k){console.error(k),G("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}me(!1)},Ve=async()=>{try{const k=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");S(Array.isArray(k)?k:[])}catch(k){console.error("Error loading albums:",k)}},tt=k=>{ie(c=>c.includes(k)?c.filter(I=>I!==k):[...c,k])},ae=async()=>{if(!L||q.length===0){G("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}ne(!0);let k=0;for(const c of q)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${c}`,{album_id:L},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),k++}catch(I){console.error("Move error:",I)}ne(!1),H(!1),ie([]),Y(""),k>0?(G("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),we(),A()):G("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Oe,ut]=useState(!1),Be=async()=>{if(q.length===0||!confirm(`X\xF3a ${q.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;ut(!0);let k=0;for(const c of q)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${c}`,"L\u1ED7i x\xF3a \u1EA3nh"),k++}catch(I){console.error("Delete error:",I)}ut(!1),ie([]),k>0?(G(`\u0110\xE3 x\xF3a ${k} \u1EA3nh!`,"success"),we(),A()):G("X\xF3a th\u1EA5t b\u1EA1i","danger")},yt=()=>{q.length===le.length?ie([]):ie(le.map(k=>k.id))},pt=async()=>{if(Ue.trim()){f(!0);try{const k=Ue.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:k+"-"+Date.now(),title:Ue,parent_id:N.uuid||N.id},"L\u1ED7i t\u1EA1o folder"),G("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),ot(""),Se(!1),we(),A()}catch(k){G(k.message,"danger")}f(!1)}},jt=async k=>{if(confirm(`X\xF3a folder "${k.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${k.uuid||k.id}`,"L\u1ED7i x\xF3a folder"),G("\u0110\xE3 x\xF3a folder","success"),we(),A()}catch(c){G("L\u1ED7i x\xF3a folder","danger")}},St=k=>{const c=Array.from(k).filter(I=>I.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(I.name));We(I=>[...I,...c]),c.forEach(I=>{const R=new FileReader;R.onload=se=>{ve(xe=>[...xe,{file:I,preview:se.target.result}])},R.readAsDataURL(I)})},y=k=>{We(c=>c.filter((I,R)=>R!==k)),ve(c=>c.filter((I,R)=>R!==k))},P=async k=>{var I;const c=await window.KTM.cloudinary.uploadImage({file:k,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${N.id}`});if(!c.secure_url)throw console.error("Cloudinary error:",c),new Error(((I=c.error)==null?void 0:I.message)||"Upload failed");return c},je=async()=>{if(Le.length===0)return;Ie(!0);let k=0;for(let c=0;c<Le.length;c++)try{M(`\u0110ang x\u1EED l\xFD ${c+1}/${Le.length}...`);const I=await Ne(Le[c],2);M(`\u0110ang upload ${c+1}/${Le.length}...`);const R=await P(I);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${N.id}`,{url:R.secure_url,caption:Ae[c]||Le[c].name.replace(/\.[^/.]+$/,""),sort_order:le.length+c},"L\u1ED7i l\u01B0u \u1EA3nh"),k++}catch(I){console.error("Upload error:",I)}Ie(!1),M(""),We([]),ve([]),oe({}),k>0?(G(`\u0110\xE3 upload ${k} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),we(),A()):G("Upload th\u1EA5t b\u1EA1i","danger")},at=async(k,c)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${k}`,"L\u1ED7i x\xF3a \u1EA3nh"),G("\u0110\xE3 x\xF3a \u1EA3nh","success"),we(),A()}catch(I){G("L\u1ED7i x\xF3a \u1EA3nh","danger")}},bt=k=>{var c;k.preventDefault(),(c=W.current)==null||c.classList.add("dragover")},lt=()=>{var k;(k=W.current)==null||k.classList.remove("dragover")},wt=k=>{var c;k.preventDefault(),(c=W.current)==null||c.classList.remove("dragover"),St(k.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:x},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},N.title),React.createElement("small",{className:"text-muted"},ee.length>0&&React.createElement("span",null,ee.length," folder \u2022 "),le.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Se(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ft&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Ue,onChange:k=>ot(k.target.value),onKeyPress:k=>k.key==="Enter"&&pt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:pt,disabled:g||!Ue.trim()},g?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Se(!1),ot("")}},"H\u1EE7y")))),ee.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},ee.map(k=>React.createElement("div",{key:k.uuid||k.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>E&&E(k)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},k.title),React.createElement("small",{className:"text-muted"},k.subfolderCount>0&&React.createElement("span",null,k.subfolderCount," folder"),k.subfolderCount>0&&k.count>0&&" \u2022 ",k.count>0&&React.createElement("span",null,k.count," \u1EA3nh"),k.subfolderCount===0&&k.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:c=>{c.stopPropagation(),$&&$(k)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:c=>{c.stopPropagation(),jt(k)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:W,className:"upload-zone",onClick:()=>{var k;return(k=_.current)==null?void 0:k.click()},onDragOver:bt,onDragLeave:lt,onDrop:wt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:_,type:"file",multiple:!0,accept:"image/*",onChange:k=>St(k.target.files)})),He.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},He.map((k,c)=>React.createElement("div",{key:c,className:"upload-preview-item"},React.createElement("img",{src:k.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>y(c)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:je,disabled:he},he?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),ue||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Le.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",le.length,")"),le.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:yt},q.length===le.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),q.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},q.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>H(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Be,disabled:Oe},Oe?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ie([])},React.createElement("i",{className:"fas fa-times"})))),$e?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):le.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},le.map((k,c)=>React.createElement("div",{key:c,className:`image-item ${q.includes(k.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>tt(k.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:q.includes(k.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:q.includes(k.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},q.includes(k.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:k.src,alt:k.caption,style:{opacity:q.includes(k.id)?.7:1,border:q.includes(k.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:I=>{I.stopPropagation(),at(k.id,c)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),k.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},k.caption)))))),X&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",q.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>H(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},b.filter(k=>!k.parentId).map(k=>React.createElement(FolderTreeItem,{key:k.uuid||k.id,folder:k,allAlbums:b,currentAlbumId:N.uuid||N.id,targetAlbum:L,onSelect:Y})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>H(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ae,disabled:!L||re},re?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Ee&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>st(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>st(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Ee.src,alt:Ee.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:k=>k.stopPropagation()}),Ee.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Ee.caption)))))}function SearchCenter({showToast:N,onNavigate:x}){const[A,G]=useState(""),[E,$]=useState([]),[O,le]=useState([]),[de,ee]=useState([]),[ye,$e]=useState("all"),[me,he]=useState(null),[Ie,ue]=useState("list"),[M,Le]=useState(!0),[We,He]=useState([]),[ve,Ae]=useState([]),oe=useRef(null),[Ee,st]=useState(!0),[ft,Se]=useState(!1),Ue=useRef(null),ot=useRef(null),g=useRef(null),[f,_]=useState(!1),[W,X]=useState([]),[H,q]=useState([]),[ie,b]=useState(""),S=useRef(null),L=useRef(new Map),[Y,re]=useState("auto"),[ne,Ne]=useState({start:0,end:20}),[we,Ve]=useState(!1),[tt,ae]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[Oe,ut]=useState(""),[Be,yt]=useState(!1),pt=useRef(null),jt=useRef(null),St=r=>r?String(r).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",y=r=>r?String(r).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",P=(r,h)=>{if(!r||!h)return r;const T=new RegExp(`(${h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return r.replace(T,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const r=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),h=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");X(Array.isArray(r)?r.slice(0,10):[]),q(Array.isArray(h)?h:[])}catch(r){}},[]);const je=r=>{if(!r.trim())return;const h=[r,...W.filter(T=>T!==r)].slice(0,10);X(h);try{localStorage.setItem("ktm_search_history",JSON.stringify(h))}catch(T){}},at=r=>{if(!r.trim())return;const h=H.includes(r)?H.filter(T=>T!==r):[r,...H].slice(0,5);q(h);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(h))}catch(T){}},[bt,lt]=useState(null),[wt,k]=useState(!1),[c,I]=useState(null),[R,se]=useState(!1),[xe,K]=useState(!1),[Ke,Xe]=useState(null),[it,be]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),dt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ea=r=>{var h,T;r._type==="product"&&(I(r),be({name:r.name||"",code:r.code||"",price:r.price||"",image:r.image||"",category:r.category||"",note:r.note||"",commission_percent:(T=(h=r.commission_percent)!=null?h:r.commissionPercent)!=null?T:""}),k(!0))},_t=async()=>{if(c)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${c.id}`,it,"L\u1ED7i c\u1EADp nh\u1EADt"),N("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),k(!1),I(null),zt()}catch(r){N(r.message,"danger")}},ge=async r=>{const h=r._type==="product"?"s\u1EA3n ph\u1EA9m":r._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${h} "${r.name}"?`))try{let T="";r._type==="product"?T=`${API_BASE}/api/products?id=${r.id}`:r._type==="album"?T=`${API_BASE}/api/images/${r.id}`:r._type==="video"&&(T=`${API_BASE}/api/videos/${r.id}`),await window.KTM.api.deleteJSON(T,"L\u1ED7i x\xF3a"),N(`\u0110\xE3 x\xF3a ${h}`,"success"),zt()}catch(T){N(T.message,"danger")}},Ht=async r=>{try{const h=Ke?`${API_BASE}/api/products?id=${Ke.id}`:`${API_BASE}/api/products`;Ke?await window.KTM.api.putJSON(h,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(h,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(Ke?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),K(!1),Xe(null),zt()}catch(h){N(h.message,"danger")}},ta="ktm_admin_data_cache_v1",Rt=1e3*60*10,zt=async()=>{let r=null,h=!1;const T=window.KTM.cache.read(ta,{ttlMs:Rt,validate:Array.isArray});T.hit?(r=T.value,console.log("[CACHE] Using cache, items:",r.length),le(r),$(r),Le(!1),h=!0):T.status==="miss"?console.log("[CACHE] No cache found"):T.status==="expired"||T.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):T.status==="error"&&console.error("[CACHE] Error parsing cache"),h||Le(!0);try{const U=async(Qe,ze)=>{try{const Nt=await window.KTM.api.getJSON(Qe,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Nt!=null?Nt:ze}catch(Nt){return ze}},[te,j,w]=await Promise.all([U(`${API_BASE}/api/products?fields=search`,[]),U(`${API_BASE}/api/albums`,[]),U(`${API_BASE}/api/video-folders?withVideos=true`,[])]),Q=Array.isArray(te)?te.map(Qe=>({...Qe,_type:"product",_source:"database"})):[];He(j);let pe=[];Array.isArray(j)&&j.length>0&&(await Promise.all(j.map(ze=>U(`${API_BASE}/api/albums/${ze.id}`,{})))).forEach((ze,Nt)=>{const Mt=j[Nt];ze.images&&ze.images.length>0&&ze.images.forEach(ht=>{pe.push({id:ht.id,name:ht.caption||"\u1EA2nh t\u1EEB "+Mt.title,image:ht.src,folder:Mt.title,_type:"album",_source:"database"})})}),Ae(w);let ce=[];Array.isArray(w)&&w.forEach(Qe=>{Qe.videos&&Qe.videos.forEach(ze=>{ce.push({id:ze.id,name:ze.title,folder:Qe.name,image:ze.thumb,youtubeId:ze.youtubeId,url:ze.url,_type:"video",_source:"database"})})});const Z=[...Q,...pe,...ce];(!r||JSON.stringify(Z)!==JSON.stringify(r))&&(le(Z),$(Z),window.KTM.cache.write(ta,Z))}catch(U){console.error("Song song fetch error:",U)}Le(!1)};useEffect(()=>{zt(),setTimeout(()=>{var h;return(h=oe.current)==null?void 0:h.focus()},100);const r=h=>{var T,U;(h.ctrlKey||h.metaKey)&&h.key==="k"&&(h.preventDefault(),_(!0),setTimeout(()=>{var te;return(te=S.current)==null?void 0:te.focus()},0)),h.key==="/"&&!f&&((T=document.activeElement)==null?void 0:T.tagName)!=="INPUT"&&(h.preventDefault(),(U=oe.current)==null||U.focus()),h.key==="Escape"&&f&&_(!1)};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[f]);const Et=r=>{try{return String(r!=null?r:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(h){return String(r!=null?r:"").toLowerCase()}},xt=r=>{const T=Et(r).trim().split(/\s+/).filter(Boolean),U=T.includes("anh"),te=T.includes("video"),j=T.filter(pe=>pe!=="anh"&&pe!=="video"),w=j.join(" "),Q=new Set(["product"]);return U&&Q.add("album"),te&&Q.add("video"),{allowedTypes:Q,includeAlbum:U,includeVideo:te,contentTokens:j,cleanedQuery:w}},aa=(r,h,T)=>{var Qe,ze,Nt,Mt,ht;const U=Array.isArray(h)?h:[],te=Et(T).trim();if(!U.length&&!te)return 0;const j=Et((Qe=r==null?void 0:r.name)!=null?Qe:""),w=Et((ze=r==null?void 0:r.code)!=null?ze:""),Q=Et((Nt=r==null?void 0:r.category)!=null?Nt:""),pe=Et((Mt=r==null?void 0:r.note)!=null?Mt:""),ce=Et((ht=r==null?void 0:r.folder)!=null?ht:"");if(!`${j} ${w} ${Q} ${pe} ${ce}`.trim())return 0;let ke=0;te&&(j===te&&(ke+=220),j.includes(te)&&(ke+=140),j.startsWith(te)&&(ke+=160),w&&w===te&&(ke+=180),w&&w.includes(te)&&(ke+=90));for(const Ct of U){if(!Ct)continue;const ua=new RegExp(`(?:^|\\s)${Ct.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);j.includes(Ct)&&(ke+=35),ua.test(j)&&(ke+=25),w&&w.includes(Ct)&&(ke+=20),w&&ua.test(w)&&(ke+=10),Q&&Q.includes(Ct)&&(ke+=12),ce&&ce.includes(Ct)&&(ke+=12),pe&&pe.includes(Ct)&&(ke+=6)}return ke>0&&j&&(ke+=Math.max(0,10-Math.min(10,Math.floor(j.length/10)))),ke},ca=(r,h,T)=>{const U=Array.isArray(r)?r:[];return U.length?U.map((j,w)=>({it:j,idx:w,score:aa(j,h,T)})).sort((j,w)=>w.score!==j.score?w.score-j.score:j.idx-w.idx).map(j=>j.it):[]},ya=async(r,h)=>{if(!(!Ee||h.length===0)){Se(!0);try{const T=h.map(te=>({id:te.id,name:te.name,price:te.price,category:te.category,note:te.note,folder:te.folder,_type:te._type})),U=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:r,products:T},"AI Search error");if(U&&U.matchedIds&&U.matchedIds.length>0){const{contentTokens:te,cleanedQuery:j}=xt(r),w=new Set(U.matchedIds),Q=h.filter(pe=>w.has(pe.id)).sort((pe,ce)=>aa(ce,te,j)-aa(pe,te,j));Q.length>0&&$(Q)}else U&&U.matchedIds&&U.matchedIds.length===0&&$([])}catch(T){console.error("AI Search error:",T)}Se(!1)}},Jt=r=>{if(G(r),b(r),ot.current&&clearTimeout(ot.current),Ue.current&&clearTimeout(Ue.current),g.current&&g.current.abort(),!r.trim()){Gt(ye);return}const h=`${r}|${ye}`;if(L.current.has(h)){$(L.current.get(h));return}const{allowedTypes:T,contentTokens:U,cleanedQuery:te}=xt(r);ot.current=setTimeout(()=>{const j=O.filter(pe=>{if(!T.has(pe==null?void 0:pe._type))return!1;if(U.length===0)return!0;const ce=St(Object.entries(pe).filter(([Z])=>!Z.startsWith("_")).map(([,Z])=>String(Z||"")).join(" "));if(pe.phone){const Z=y(pe.phone);if(Z&&U.some(ke=>Z.includes(ke)))return!0}return U.some(Z=>ce.includes(Z))});let w=j;ye!=="all"&&(w=j.filter(pe=>(pe.category||pe._type)===ye));const Q=ca(w,U,te);if(L.current.size>20){const pe=L.current.keys().next().value;L.current.delete(pe)}L.current.set(h,Q),$(Q),Ee&&te.length>=3&&(Ue.current=setTimeout(()=>{ya(te,w)},500))},200)},Gt=r=>{$e(r);const{allowedTypes:h,contentTokens:T}=xt(A),{cleanedQuery:U}=xt(A);let te=O.filter(j=>h.has(j==null?void 0:j._type));r!=="all"&&(te=te.filter(j=>(j.category||j._type)===r)),A.trim()&&T.length>0&&(te=te.filter(j=>{const w=Et(Object.entries(j).filter(([Q])=>!Q.startsWith("_")).map(([,Q])=>String(Q||"")).join(" "));return T.every(Q=>w.includes(Q))})),$(ca(te,T,U))},na=(r,h)=>{window.KTM.clipboard.writeText(r).then(()=>{he(h),N("\u0110\xE3 copy!","success"),setTimeout(()=>he(null),1500)})},Fa=async(r,h)=>{try{await window.KTM.clipboard.writeImageFromUrl(r),he(h+"-img"),N("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>he(null),1500)}catch(T){na(r,h+"-img")}},Tt=r=>{let h=r.toLowerCase();const T=[],U=O.filter(w=>w._type==="product");if(h.includes("ty")||h.includes("xy lanh")){if(h.includes("gi\u1EEFa")||h.includes("giua")){const w=U.find(Q=>{var pe;return(pe=Q.name)==null?void 0:pe.toLowerCase().includes("xy lanh gi\u1EEFa")});w&&!T.find(Q=>Q.id===w.id)&&T.push(w)}if(h.includes("nghi\xEAng")||h.includes("nghieng")){const w=U.find(Q=>{var pe;return(pe=Q.name)==null?void 0:pe.toLowerCase().includes("xy lanh nghi\xEAng")});w&&!T.find(Q=>Q.id===w.id)&&T.push(w)}if(h.includes("\u1EE7i")||h.includes("ui")){const w=U.find(Q=>{var pe;return(pe=Q.name)==null?void 0:pe.toLowerCase().includes("xy lanh \u1EE7i")});w&&!T.find(Q=>Q.id===w.id)&&T.push(w)}}const te=h.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(te){const w=te[1],Q=te[2],pe=U.find(ce=>{var ke;const Z=((ke=ce.name)==null?void 0:ke.toLowerCase())||"";return Z.includes("combo")&&Z.includes(`${w} tay`)&&(Z.includes(`${Q} xy`)||Z.includes(`${Q} xylanh`))});if(pe&&!T.find(ce=>ce.id===pe.id))T.push(pe);else{const ce=U.find(Z=>{var Qe;const ke=((Qe=Z.name)==null?void 0:Qe.toLowerCase())||"";return ke.includes("combo")&&ke.includes(`${w} tay`)});ce&&!T.find(Z=>Z.id===ce.id)&&T.push(ce)}}if(h.includes("combo")&&!te){const w=h.match(/combo.*?(\d+)\s*tay/);if(w){const Q=w[1];U.filter(ce=>{var ke;const Z=((ke=ce.name)==null?void 0:ke.toLowerCase())||"";return Z.includes("combo")&&Z.includes(`${Q} tay`)}).forEach(ce=>{T.find(Z=>Z.id===ce.id)||T.push(ce)})}}const j=h.match(/van\s*(\d+)\s*tay/);if(j&&!h.includes("ty")&&!h.includes("combo")){const w=j[1],Q=U.find(pe=>{var Z;const ce=((Z=pe.name)==null?void 0:Z.toLowerCase())||"";return ce.includes(`van ${w} tay`)&&!ce.includes("combo")});Q&&!T.find(pe=>pe.id===Q.id)&&T.push(Q)}return T.slice(0,4)},Ha=async r=>{if(!r.trim())return;const h={role:"user",content:r,attachments:[]};ae(U=>[...U,h]),ut(""),yt(!0);const T=Tt(r);setTimeout(()=>{var U;return(U=pt.current)==null?void 0:U.scrollIntoView({behavior:"smooth"})},100);try{const te=O.filter(Z=>Z._type==="product").map(Z=>{let ke=`- ${Z.name}`;return Z.code&&(ke+=` (M\xE3: ${Z.code})`),Z.price&&(ke+=` - Gi\xE1: ${Z.price.replace(/[đ\s]/g,"")}\u0111`),Z.category&&(ke+=` [${Z.category}]`),Z.note&&(ke+=` (${Z.note})`),ke}).join(`
`),w=tt.slice(-6).map(Z=>`${Z.role==="user"?"Kh\xE1ch":"AI"}: ${Z.content}`).join(`
`),Q=w?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${w}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${te}`:te,ce=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:r,context:Q,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";ae(Z=>[...Z,{role:"assistant",content:ce,attachments:T}])}catch(U){console.error("AI Error:",U);const te=r.toLowerCase(),j=O.filter(Q=>{const pe=Object.values(Q).join(" ").toLowerCase();return te.split(" ").some(ce=>pe.includes(ce))});let w="";j.length>0?(w=`T\xECm th\u1EA5y ${j.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,j.slice(0,5).forEach(Q=>{w+=`\u2022 ${Q.name}`,Q.price&&(w+=` - ${Q.price.replace(/[đ\s]/g,"")}\u0111`),Q.note&&(w+=` (${Q.note})`),w+=`
`}),j.length>5&&(w+=`
...v\xE0 ${j.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):w='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',ae(Q=>[...Q,{role:"assistant",content:w,attachments:j.slice(0,4)}])}yt(!1),setTimeout(()=>{var U,te;(U=pt.current)==null||U.scrollIntoView({behavior:"smooth"}),(te=jt.current)==null||te.focus()},100)};function da({show:r,product:h,categories:T,onClose:U,onSave:te}){const[j,w]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Q,pe]=useState(!1),[ce,Z]=useState(!1),ke=useRef(null),Qe=D=>window.KTM.money.formatVNDInputDigits(D),ze=D=>{const V=window.KTM.money.getDigits(String(D!=null?D:"")),F=Number(V);return V&&Number.isFinite(F)?Math.trunc(F):0},Nt=(D,V)=>{if(D==null||D==="")return[];let F=D;if(typeof F=="string"){const B=F.trim();if(!B)return[];try{F=JSON.parse(B)}catch(fe){return[]}}if(!Array.isArray(F))return[];const m=ze(V);return F.map(B=>{var De;if(!B||typeof B!="object")return null;const fe=String((De=B.name)!=null?De:"").trim(),Te=(Array.isArray(B.options)?B.options:[]).map(Je=>{var Dt,kt,Pt,vt,Ut,ba,Xt;if(!Je||typeof Je!="object")return null;const mt=String((Dt=Je.label)!=null?Dt:"").trim();if(!mt)return null;const Ye=(Ut=(vt=(Pt=(kt=Je.price)!=null?kt:Je.priceValue)!=null?Pt:Je.unit_price)!=null?vt:Je.unitPrice)!=null?Ut:null,$t=Number(Ye);let Re=Number.isFinite($t)?Math.trunc($t):null;if(Re==null){const Ma=(Xt=(ba=Je.price_delta)!=null?ba:Je.priceDelta)!=null?Xt:null,Va=Number(Ma);Number.isFinite(Va)&&(Re=m+Math.trunc(Va))}Re==null&&(Re=m);const gt=String(Math.max(0,Math.trunc(Number(Re)||0)));return{label:mt,price:Math.max(0,Math.trunc(Number(Re)||0)),priceDigits:gt}}).filter(Boolean);return{name:fe||"Bi\u1EBFn th\u1EC3",options:Te}}).filter(Boolean)},Mt=D=>{if(D==null||D==="")return[];let V=D;if(typeof V=="string"){const F=V.trim();if(!F)return[];try{V=JSON.parse(F)}catch(m){return[]}}return V&&typeof V=="object"&&!Array.isArray(V)&&(V=Object.entries(V).map(([F,m])=>({key:F,value:m}))),Array.isArray(V)?V.map(F=>{var Te,De,Je,mt,Ye;if(!F||typeof F!="object")return null;const m=String((Je=(De=(Te=F.key)!=null?Te:F.name)!=null?De:F.label)!=null?Je:"").trim(),B=String((mt=F.value)!=null?mt:"").trim(),fe=String((Ye=F.unit)!=null?Ye:"").trim();return m?{key:m,value:B,unit:fe}:null}).filter(Boolean):[]};useEffect(()=>{var D,V;if(h)if(w({name:h.name||"",code:h.code||"",price:h.price||"",image:h.image||"",category:h.category||"",note:h.note||"",sort_order:h.sort_order||0,commission_percent:(V=(D=h.commission_percent)!=null?D:h.commissionPercent)!=null?V:5,variants:Nt(h.variants,h.price),attributes:Mt(h.attributes)}),h.price){const F=window.KTM.money.getDigits(h.price);oa(F),w(m=>({...m,price:Qe(F)}))}else oa("");else w({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),oa("")},[h,r]);const ht=D=>{w(V=>{var Te;const F=ze(V.price),m=String(F),B=Array.isArray(V.variants)?[...V.variants]:[],fe={...B[D]||{},options:Array.isArray((Te=B[D])==null?void 0:Te.options)?[...B[D].options]:[]};return fe.options=fe.options.map(De=>({label:String((De==null?void 0:De.label)||""),price:F,priceDigits:m})),B[D]=fe,{...V,variants:B}})},Ct=()=>{w(D=>{const V=ze(D.price),F=String(V),B=(Array.isArray(D.variants)?[...D.variants]:[]).map(fe=>{const Te=(Array.isArray(fe==null?void 0:fe.options)?fe.options:[]).map(De=>({label:String((De==null?void 0:De.label)||""),price:V,priceDigits:F}));return{name:String((fe==null?void 0:fe.name)||"Bi\u1EBFn th\u1EC3"),options:Te}});return{...D,variants:B}})},[ua,nt]=React.useState(""),[Wt,oa]=React.useState(""),Lt=D=>{const V=window.KTM.money.nextPriceInputState(D.target.value,Wt);oa(V.digits),w({...j,price:V.price})},pa=async(D,V=2)=>{const F=V*1024*1024;if(D.size<=F)return D;try{const m=await createImageBitmap(D),B=document.createElement("canvas");let fe=m.width,Te=m.height;const De=1200;return(fe>De||Te>De)&&(fe>Te?(Te=Math.round(Te/fe*De),fe=De):(fe=Math.round(fe/Te*De),Te=De)),B.width=fe,B.height=Te,B.getContext("2d").drawImage(m,0,0,fe,Te),m.close(),new Promise((mt,Ye)=>{B.toBlob($t=>{$t?mt(new File([$t],D.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ye(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(m){throw console.error("Compress error:",m),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ta=async D=>{var m;const V=D.target.files[0];if(!V)return;if(!(V.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(V.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Z(!0);try{const B=await pa(V),fe=await window.KTM.cloudinary.uploadImage({file:B,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!fe.secure_url)throw console.error("Cloudinary error:",fe),new Error(((m=fe.error)==null?void 0:m.message)||"Upload failed");w(Te=>({...Te,image:fe.secure_url}))}catch(B){console.error("Upload error:",B),alert("L\u1ED7i upload \u1EA3nh: "+B.message)}Z(!1),D.target.value=""},En=async D=>{D.preventDefault(),pe(!0);const V={...j,variants:Nt(j.variants,j.price),attributes:Mt(j.attributes)};await te(V),pe(!1)};return r?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),h?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:U})),React.createElement("form",{onSubmit:En},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:j.name,onChange:D=>w({...j,name:D.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:j.code,onChange:D=>w({...j,code:D.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:j.price,onChange:Lt,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:j.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:D=>w({...j,commission_percent:D.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:j.category,onChange:D=>w({...j,category:D.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),T.map(D=>React.createElement("option",{key:D,value:D},D)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:j.note,onChange:D=>w({...j,note:D.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(j.attributes)?j.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(j.attributes)?j.attributes:[]).map((D,V)=>React.createElement("div",{key:V,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.key)||"",onChange:F=>{const m=F.target.value;w(B=>{const fe=Array.isArray(B.attributes)?[...B.attributes]:[];return fe[V]={...fe[V]||{},key:m},{...B,attributes:fe}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.value)||"",onChange:F=>{const m=F.target.value;w(B=>{const fe=Array.isArray(B.attributes)?[...B.attributes]:[];return fe[V]={...fe[V]||{},value:m},{...B,attributes:fe}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.unit)||"",onChange:F=>{const m=F.target.value;w(B=>{const fe=Array.isArray(B.attributes)?[...B.attributes]:[];return fe[V]={...fe[V]||{},unit:m},{...B,attributes:fe}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{w(F=>{const m=Array.isArray(F.attributes)?[...F.attributes]:[];return m.splice(V,1),{...F,attributes:m}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{w(D=>{const V=Array.isArray(D.attributes)?[...D.attributes]:[];return V.push({key:"",value:"",unit:""}),{...D,attributes:V}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(j.variants)?j.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(j.variants)?j.variants:[]).map((D,V)=>React.createElement("div",{key:V,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.name)||"",onChange:F=>{const m=F.target.value;w(B=>{var Te;const fe=Array.isArray(B.variants)?[...B.variants]:[];return fe[V]={...fe[V]||{},name:m,options:Array.isArray((Te=fe[V])==null?void 0:Te.options)?fe[V].options:[]},{...B,variants:fe}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ht(V),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(D==null?void 0:D.options)||D.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{w(F=>{const m=Array.isArray(F.variants)?[...F.variants]:[];return m.splice(V,1),{...F,variants:m}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(D==null?void 0:D.options)?D.options:[]).map((F,m)=>{var B,fe;return React.createElement("div",{key:m,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(F==null?void 0:F.label)||"",onChange:Te=>{const De=Te.target.value;w(Je=>{var gt,Dt,kt,Pt,vt;const mt=Array.isArray(Je.variants)?[...Je.variants]:[],Ye={...mt[V]||{},options:Array.isArray((gt=mt[V])==null?void 0:gt.options)?[...mt[V].options]:[]},$t=Number((kt=(Dt=Ye.options[m])==null?void 0:Dt.price)!=null?kt:0)||0,Re=String((vt=(Pt=Ye.options[m])==null?void 0:Pt.priceDigits)!=null?vt:Math.max(0,Math.trunc($t)));return Ye.options[m]={...Ye.options[m]||{},label:De,price:Math.max(0,Math.trunc($t)),priceDigits:Re},mt[V]=Ye,{...Je,variants:mt}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Qe(String((fe=F==null?void 0:F.priceDigits)!=null?fe:window.KTM.money.getDigits(String((B=F==null?void 0:F.price)!=null?B:"")))),onChange:Te=>{w(De=>{var kt,Pt,vt,Ut,ba;const Je=String((Pt=F==null?void 0:F.priceDigits)!=null?Pt:window.KTM.money.getDigits(String((kt=F==null?void 0:F.price)!=null?kt:""))),mt=window.KTM.money.nextPriceInputState(Te.target.value,Je),Ye=String((vt=mt.digits)!=null?vt:""),$t=Number(Ye),Re=Number.isFinite($t)?Math.max(0,Math.trunc($t)):0,gt=Array.isArray(De.variants)?[...De.variants]:[],Dt={...gt[V]||{},options:Array.isArray((Ut=gt[V])==null?void 0:Ut.options)?[...gt[V].options]:[]};return Dt.options[m]={...Dt.options[m]||{},label:String(((ba=Dt.options[m])==null?void 0:ba.label)||""),price:Re,priceDigits:Ye},gt[V]=Dt,{...De,variants:gt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{w(Te=>{var mt;const De=Array.isArray(Te.variants)?[...Te.variants]:[],Je={...De[V]||{},options:Array.isArray((mt=De[V])==null?void 0:mt.options)?[...De[V].options]:[]};return Je.options.splice(m,1),De[V]=Je,{...Te,variants:De}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{w(F=>{var Te;const m=Array.isArray(F.variants)?[...F.variants]:[],B={...m[V]||{},options:Array.isArray((Te=m[V])==null?void 0:Te.options)?[...m[V].options]:[]},fe=ze(F.price);return B.options.push({label:"",price:fe,priceDigits:String(fe)}),m[V]=B,{...F,variants:m}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{w(D=>{const V=ze(D.price),F=Array.isArray(D.variants)?[...D.variants]:[],m=String(V);return F.push({name:"Size",options:[{label:"S",price:V,priceDigits:m},{label:"M",price:V,priceDigits:m},{label:"L",price:V,priceDigits:m}]}),{...D,variants:F}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Ct,disabled:!Array.isArray(j.variants)||j.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},j.image?React.createElement(React.Fragment,null,React.createElement("img",{src:j.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>w({...j,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var D;return(D=ke.current)==null?void 0:D.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:ke,type:"file",accept:"image/*",className:"d-none",onChange:Ta}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var D;return(D=ke.current)==null?void 0:D.click()},disabled:ce,style:{borderRadius:"10px"}},ce?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:j.image,onChange:D=>w({...j,image:D.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:U,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Q,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const sa=r=>window.KTM.money.formatVND(r),ma=r=>{if(r==null||r==="")return[];let h=r;if(typeof h=="string"){const T=h.trim();if(!T)return[];try{h=JSON.parse(T)}catch(U){return[]}}return Array.isArray(h)?h:[]},ia=r=>{if(r==null||r==="")return[];let h=r;if(typeof h=="string"){const T=h.trim();if(!T)return[];try{h=JSON.parse(T)}catch(U){return[]}}return h&&typeof h=="object"&&!Array.isArray(h)&&(h=Object.entries(h).map(([T,U])=>({key:T,value:U}))),Array.isArray(h)?h:[]},Na=(r,h={})=>{var j;const T=ia(r).map(w=>{var Q,pe,ce,Z,ke;return{key:String((ce=(pe=(Q=w==null?void 0:w.key)!=null?Q:w==null?void 0:w.name)!=null?pe:w==null?void 0:w.label)!=null?ce:"").trim(),value:String((Z=w==null?void 0:w.value)!=null?Z:"").trim(),unit:String((ke=w==null?void 0:w.unit)!=null?ke:"").trim()}}).filter(w=>!!w.key);if(!T.length)return null;const U=!!h.compact,te=String((j=h.className)!=null?j:"").trim();return React.createElement("div",{className:`ktm-variants-preview${U?" compact":""}${te?" "+te:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},T.map((w,Q)=>{const pe=w.key,ce=`${w.value||""}${w.unit?(w.value?" ":"")+w.unit:""}`.trim();return React.createElement("div",{key:`${pe}-${Q}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},pe),ce?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ce):null)})))},Ya=(r,h={})=>{var pe;const T=ma(r).map(ce=>{var Z;return{name:String((Z=ce==null?void 0:ce.name)!=null?Z:"").trim(),options:Array.isArray(ce==null?void 0:ce.options)?ce.options:[]}}).map(ce=>({...ce,options:ce.options.map(Z=>{var ke;return{label:String((ke=Z==null?void 0:Z.label)!=null?ke:"").trim(),price:Number(Z==null?void 0:Z.price)}}).filter(Z=>!!Z.label)})).filter(ce=>ce.options.length>0);if(!T.length)return null;const U=Number.isFinite(h.maxGroups)?Math.max(1,Math.trunc(h.maxGroups)):T.length,te=Number.isFinite(h.maxOptionsPerGroup)?Math.max(1,Math.trunc(h.maxOptionsPerGroup)):3,j=!!h.compact,w=String((pe=h.className)!=null?pe:"").trim(),Q=T.slice(0,U);return React.createElement("div",{className:`ktm-variants-preview${j?" compact":""}${w?" "+w:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Q.map((ce,Z)=>{const ke=ce.name||"Bi\u1EBFn th\u1EC3",Qe=ce.options.slice(0,te),ze=ce.options.length-Qe.length;return React.createElement("div",{key:`${ke}-${Z}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ke),Qe.map((Nt,Mt)=>{const ht=Nt.price,Ct=Number.isFinite(ht)&&ht>=0?sa(Math.trunc(ht)):"",ua=Ct?`${Nt.label} \xB7 ${Ct}`:Nt.label;return React.createElement("span",{key:`${ke}-${Z}-${Mt}`,className:"ktm-chip ktm-chip-option"},ua)}),ze>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",ze))})))},ra=(r,h)=>{const T=r._type==="product",U=r._type==="album",te=r._type==="video",j=r.note&&(r.note.toLowerCase().includes("free")||r.note.toLowerCase().includes("gi\u1EA3m")||r.note.toLowerCase().includes("sale")),w=T?Na(r.attributes,{compact:Ie==="grid",className:Ie==="grid"?"meta text-muted":"text-muted"}):null,Q=T?Ya(r.variants,{compact:Ie==="grid",maxOptionsPerGroup:999,className:Ie==="grid"?"meta text-muted":"text-muted"}):null;return Ie==="grid"?React.createElement("div",{key:r.id||h,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>lt({url:r.image,name:r.name,price:r.price,note:r.note,item:r})},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${te?"fa-video":"fa-image"} fa-2x text-muted`})),r.price&&React.createElement("div",{className:"price-overlay"},r.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${T?"product":U?"album":"video"}`},T?"SP":U?"\u1EA2nh":"Video"),j&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},r.name),r.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},r.note),w&&React.createElement("div",{style:{marginTop:2}},w),Q&&React.createElement("div",{style:{marginTop:2}},Q),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:me===r.id+"-img"?"copied":"",onClick:()=>Fa(r.image,r.id)},React.createElement("i",{className:"fas fa-image"})),r.price&&React.createElement("button",{className:me===r.id+"-price"?"copied":"",onClick:()=>na(r.price.replace(/[đ\s]/g,""),r.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:r.id||h,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${T?"product":U?"album":"video"}`},T?"S\u1EA3n ph\u1EA9m":U?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy",onClick:()=>lt({url:r.image,name:r.name,price:r.price,note:r.note,item:r})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${te?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},r.name),React.createElement("div",{className:"price-row"},r.price&&React.createElement("span",{className:"price"},r.price.replace(/[đ\s]/g,""),"\u0111"),j&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),w&&React.createElement("div",{style:{marginTop:4}},w),Q&&React.createElement("div",{style:{marginTop:4}},Q)),React.createElement("div",{className:"meta"},r.code&&React.createElement("span",{className:"meta-tag"},"#",r.code),r.category&&React.createElement("span",{className:"meta-tag"},r.category),r.note&&React.createElement("span",{className:"meta-tag highlight"},r.note),r.folder&&React.createElement("span",{className:"meta-tag"},r.folder),te&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},T&&React.createElement("button",{onClick:()=>x&&x("orders","create",{productId:r.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),r.price&&React.createElement("button",{className:me===r.id+"-price"?"copied":"",onClick:()=>na(r.price.replace(/[đ\s]/g,""),r.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:me===r.id+"-name"?"copied":"",onClick:()=>na(r.name,r.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),te&&r.youtubeId&&React.createElement("button",{className:me===r.id+"-yt"?"copied":"",onClick:()=>na(`https://www.youtube.com/watch?v=${r.youtubeId}`,r.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),T&&React.createElement("button",{className:"action-edit",onClick:()=>ea(r)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>ge(r)},React.createElement("i",{className:"fas fa-trash"}))))},[Ot,Vt]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,E.length)," k\u1EBFt qu\u1EA3",Ee&&A.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),ye!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},ye==="product"?"S\u1EA3n ph\u1EA9m":ye==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Ie==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ue("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Ie==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ue("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},M?React.createElement("div",null,[...Array(8)].map((r,h)=>React.createElement("div",{key:h,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):E.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',A,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{G(""),Jt("")}},"Xem t\u1EA5t c\u1EA3")):Ie==="grid"?React.createElement("div",{className:"product-grid-mobile"},E.map((r,h)=>ra(r,h))):React.createElement("div",null,E.map((r,h)=>ra(r,h)))),Ot&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Vt(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${ye==="all"?"active":""}`,onClick:()=>{Gt("all"),Vt(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${ye==="product"?"active":""}`,onClick:()=>{Gt("product"),Vt(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${ye==="album"?"active":""}`,onClick:()=>{Gt("album"),Vt(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${ye==="video"?"active":""}`,onClick:()=>{Gt("video"),Vt(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Ee,onChange:r=>st(r.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:oe,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:A,onChange:r=>Jt(r.target.value),onFocus:()=>{A.trim()&&Vt(!0)}}),React.createElement("button",{className:`filter-btn ${Ot||ye!=="all"?"active":""}`,onClick:()=>Vt(!Ot)},React.createElement("i",{className:"fas fa-filter"})))),f&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>_(!1)},React.createElement("div",{className:"search-palette",onClick:r=>r.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:S,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:ie,onChange:r=>Jt(r.target.value),onKeyDown:r=>{r.key==="Enter"&&E.length>0?(je(ie),_(!1)):r.key==="Escape"&&_(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>_(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((r,h)=>React.createElement("span",{key:r,className:`filter-chip ${ye===["all","product","album","video"][h]?"active":""}`,onClick:()=>{Gt(["all","product","album","video"][h])}},r)))),H.length>0&&!ie.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},H.map((r,h)=>React.createElement("div",{key:h,className:"palette-item",onClick:()=>{Jt(r),je(r)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,r),React.createElement("button",{className:"unsave-btn",onClick:T=>{T.stopPropagation(),at(r)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),W.length>0&&!ie.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},W.map((r,h)=>React.createElement("div",{key:h,className:"palette-item",onClick:()=>{Jt(r)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,r),React.createElement("button",{className:"save-btn",onClick:T=>{T.stopPropagation(),at(r)}},React.createElement("i",{className:`fas fa-star${H.includes(r)?"":"-o"}`})))))),ie.trim()&&E.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",E.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},E.slice(0,8).map((r,h)=>React.createElement("div",{key:r.id||h,className:"palette-result-item",onClick:()=>{je(ie),_(!1)}},r.image&&React.createElement("img",{src:r.image,alt:r.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},r.name),r.price&&React.createElement("div",{className:"result-meta"},r.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:T=>{T.stopPropagation(),at(ie)}},React.createElement("i",{className:`fas fa-star${H.includes(ie)?"":"-o"}`})))))),ie.trim()&&E.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',ie,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:R?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>Ve(!0),onTouchStart:()=>Ve(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),we&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>Ve(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},tt.map((r,h)=>React.createElement("div",{key:h,className:`mb-3 ${r.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${r.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:r.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},r.content,r.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:me===`chat-${h}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:me===`chat-${h}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(r.content),he(`chat-${h}`),setTimeout(()=>he(null),1500)}},React.createElement("i",{className:`fas ${me===`chat-${h}`?"fa-check":"fa-copy"}`})),r.attachments&&r.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},r.attachments.map((T,U)=>React.createElement("div",{key:U,style:{width:70},className:"text-center"},T.image&&React.createElement("img",{src:T.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>lt({url:T.image,name:T.name,price:T.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},T.name),T.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},T.price.replace(/[đ\s]/g,""),"\u0111"))))))),Be&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:pt})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(r=>React.createElement("button",{key:r,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Ha(r),disabled:Be,style:{whiteSpace:"nowrap"}},r))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:r=>{r.preventDefault(),Ha(Oe)},className:"chat-input-wrap"},React.createElement("input",{ref:jt,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:Oe,onChange:r=>ut(r.target.value),disabled:Be}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Be||!Oe.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),bt&&React.createElement("div",{className:"preview-modal",onClick:()=>lt(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>lt(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:r=>r.stopPropagation()},React.createElement("img",{src:bt.url,alt:bt.name})),React.createElement("div",{className:"preview-footer",onClick:r=>r.stopPropagation()},React.createElement("div",{className:"name"},bt.name),bt.price&&React.createElement("div",{className:"price"},bt.price.replace(/[đ\s]/g,""),"\u0111"),bt.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},bt.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:me==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:me==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Fa(bt.url,"preview")},React.createElement("i",{className:`fas ${me==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),bt.price&&React.createElement("button",{className:me==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>na(bt.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${me==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(da,{show:xe,product:Ke,categories:de,onClose:()=>{K(!1),Xe(null)},onSave:Ht}),React.createElement("div",{className:`fab-container mobile-only ${R?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{se(!1),K(!0),Xe(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{se(!1),x&&x("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${R?"open":""}`,onClick:()=>se(!R)},React.createElement("i",{className:"fas fa-plus"}))),wt&&c&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>k(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:it.name,onChange:r=>be({...it,name:r.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:it.code,onChange:r=>be({...it,code:r.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:it.price,onChange:r=>be({...it,price:r.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:it.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:r=>be({...it,commission_percent:r.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:it.category,onChange:r=>be({...it,category:r.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),dt.map(r=>React.createElement("option",{key:r,value:r},r)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:it.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:r=>be({...it,note:r.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>k(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:_t},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:N,showToast:x}){const[A,G]=useState([]),[E,$]=useState([]),[O,le]=useState(!0),[de,ee]=useState(null),[ye,$e]=useState(!1),[me,he]=useState(null),[Ie,ue]=useState(!1),[M,Le]=useState(null),[We,He]=useState(!1),[ve,Ae]=useState(null),[oe,Ee]=useState(!1),[st,ft]=useState(!1),[Se,Ue]=useState(null),[ot,g]=useState(!1),[f,_]=useState(null),[W,X]=useState([]);useEffect(()=>{H()},[]);const H=async(y=null)=>{le(!0);try{const P=y?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${y}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,je=await window.KTM.api.getJSON(P,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");G(Array.isArray(je)?je:[])}catch(P){console.error(P),x("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}le(!1)},q=async y=>{try{const P=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${y}`,"L\u1ED7i t\u1EA3i video");$(Array.isArray(P)?P:[])}catch(P){console.error(P)}},ie=async y=>{if(y===0)return;const P=[...A];[P[y-1],P[y]]=[P[y],P[y-1]],G(P),await S(P)},b=async y=>{if(y===A.length-1)return;const P=[...A];[P[y],P[y+1]]=[P[y+1],P[y]],G(P),await S(P)},S=async y=>{try{await Promise.all(y.map((P,je)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${P.id}`,{sortOrder:je},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),x("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(P){x("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),H(f==null?void 0:f.id)}},L=async y=>{if(y===0)return;const P=[...E];[P[y-1],P[y]]=[P[y],P[y-1]],$(P),await re(P)},Y=async y=>{if(y===E.length-1)return;const P=[...E];[P[y],P[y+1]]=[P[y+1],P[y]],$(P),await re(P)},re=async y=>{try{await Promise.all(y.map((P,je)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${P.id}`,{sort_order:je},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),x("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(P){x("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),q(de.id)}},ne=()=>{he(null),$e(!0)},Ne=y=>{Ue(y),ft(!0),g(!0)},we=async(y,P="modal")=>{try{!me&&f&&(y.parent_id=f.id);const je=me?`${API_BASE}/api/video-folders/${me.id}`:`${API_BASE}/api/video-folders`;me?await window.KTM.api.putJSON(je,y,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(je,y,"L\u1ED7i l\u01B0u folder"),x(me?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),P==="drawer"?(g(!1),he(null),H(f==null?void 0:f.id),me&&Se&&Ue({...Se,...y})):($e(!1),he(null),H(f==null?void 0:f.id))}catch(je){x(je.message,"danger")}},Ve=async y=>{const P=y.subfolderCount>0?`X\xF3a folder "${y.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${y.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(P))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${y.id}`,"L\u1ED7i x\xF3a folder"),x("\u0110\xE3 x\xF3a folder","success"),ee(null),H(f==null?void 0:f.id)}catch(je){x("L\u1ED7i x\xF3a folder","danger")}},tt=y=>{y.subfolderCount>0?(X(P=>[...P,y]),_(y),H(y.id)):(ee(y),$(y.videos||[]))},ae=y=>{if(y==="root")X([]),_(null),H(null);else if(y){const P=W.findIndex(je=>je.id===y.id);P>=0&&(X(W.slice(0,P+1)),_(y),H(y.id))}else{const P=[...W];P.pop();const je=P[P.length-1]||null;X(P),_(je),H(je==null?void 0:je.id)}},Oe=()=>{ft(!1),g(!1),Ue(null)},ut=()=>{He(!1),Ee(!1),Ae(null)},Be=()=>{Le(null),ue(!0)},yt=y=>{Ae(y),He(!0),Ee(!0)},pt=async(y,P="modal")=>{try{y.folder_id=de==null?void 0:de.id;const je=M?`${API_BASE}/api/videos/${M.id}`:`${API_BASE}/api/videos`;M?await window.KTM.api.putJSON(je,y,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(je,y,"L\u1ED7i l\u01B0u video"),x(M?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),P==="drawer"?(Ee(!1),Le(null),H(),de&&q(de.id),M&&ve&&Ae({...ve,...y})):(ue(!1),Le(null),H(),de&&q(de.id))}catch(je){x(je.message,"danger")}},jt=async y=>{if(confirm(`X\xF3a video "${y.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${y.id}`,"L\u1ED7i x\xF3a video"),x("\u0110\xE3 x\xF3a video","success"),H(),de&&q(de.id)}catch(P){x("L\u1ED7i x\xF3a video","danger")}},St=y=>{const P=`https://www.youtube.com/watch?v=${y.youtubeId}`;window.KTM.clipboard.writeText(P).then(()=>{x("\u0110\xE3 copy link!","success")}).catch(()=>{x("Kh\xF4ng th\u1EC3 copy link","danger")})};return de?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ee(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${de.slug==="shorts"?"text-danger":"text-warning"}`}),de.name)),React.createElement("button",{className:"btn btn-warning",onClick:Be},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),E.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},E.map((y,P)=>React.createElement("div",{key:y.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>L(P),disabled:P===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},P+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Y(P),disabled:P===E.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:y.thumb,className:"card-img-top",alt:y.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${y.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:y.title},y.title),React.createElement("small",{className:"text-muted"},y.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>St(y),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>yt(y),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>jt(y),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Ie,video:M,onClose:()=>ue(!1),onSave:pt}),React.createElement(AdminDrawer,{open:st,title:Se?Se.name:"Folder",subtitle:Se?`${Se.subfolderCount||0} subfolder \u2022 ${Se.videoCount||0} videos`:"",onClose:Oe,footer:ot?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:Oe},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Se&&we({name:Se.name||"",description:Se.description||"",sortOrder:Se.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Se?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Se.name),x("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{g(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Se.name}"?`)&&(Ve(Se),Oe())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ot&&Se?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Se.name||"",onChange:y=>Ue({...Se,name:y.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Se.description||"",onChange:y=>Ue({...Se,description:y.target.value})}))):Se?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Se.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Se.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Se.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Se.videoCount||0))),Se.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Se.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:We,title:ve?ve.title:"Video",subtitle:ve?`${ve.youtubeId}`:"",onClose:ut,footer:oe?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:ut},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{ve&&pt({youtube_url:`https://www.youtube.com/watch?v=${ve.youtubeId}`,title:ve.title||"",thumbnail_url:ve.thumb||"",sort_order:ve.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):ve?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const y=`https://www.youtube.com/watch?v=${ve.youtubeId}`;window.KTM.clipboard.writeText(y).then(()=>{x("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Ee(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${ve.title}"?`)&&(jt(ve),ut())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},oe&&ve?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:ve.title||"",onChange:y=>Ae({...ve,title:y.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:ve.youtubeId||"",onChange:y=>Ae({...ve,youtubeId:y.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ve.sortOrder||0,onChange:y=>Ae({...ve,sortOrder:parseInt(y.target.value)||0})}))):ve?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},ve.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},ve.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},ve.sortOrder||0))),ve.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:ve.thumb,alt:ve.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},f&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ae()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),f?f.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:ne},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),W.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:y=>{y.preventDefault(),ae("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),W.map((y,P)=>React.createElement("li",{key:y.id,className:`breadcrumb-item ${P===W.length-1?"active":""}`},P===W.length-1?y.name:React.createElement("a",{href:"#",onClick:je=>{je.preventDefault(),ae(y)},className:"text-warning"},y.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),O?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):A.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},f?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ne},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",f?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},A.map((y,P)=>{var je,at,bt,lt;return React.createElement("div",{key:y.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:wt=>{wt.stopPropagation(),ie(P)},disabled:P===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},P+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:wt=>{wt.stopPropagation(),b(P)},disabled:P===A.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>tt(y),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${y.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},y.name),React.createElement("p",{className:"text-muted mb-0"},y.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),y.subfolderCount," folder"),y.subfolderCount>0&&(y.videoCount>0||((je=y.videos)==null?void 0:je.length)>0)&&" \u2022 ",(y.videoCount>0||((at=y.videos)==null?void 0:at.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),y.videoCount||((bt=y.videos)==null?void 0:bt.length)||0," videos"),y.subfolderCount===0&&!y.videoCount&&!((lt=y.videos)!=null&&lt.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:wt=>{wt.stopPropagation(),Ne(y)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:wt=>{wt.stopPropagation(),Ve(y)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:ye,folder:me,onClose:()=>$e(!1),onSave:we}))}function VideoFolderModal({show:N,folder:x,onClose:A,onSave:G}){const[E,$]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[O,le]=useState(!1),[de,ee]=useState(!1);useEffect(()=>{$(x?{name:x.name||"",description:x.description||"",sortOrder:x.sortOrder||0,coverImage:x.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[x,N]);const ye=async me=>{const he=me.target.files[0];if(he){ee(!0);try{const Ie=await window.KTM.cloudinary.uploadImage({file:he,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Ie.secure_url&&$(ue=>({...ue,coverImage:Ie.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Ie){console.error("Cloudinary upload error:",Ie),alert("L\u1ED7i upload \u1EA3nh: "+(Ie.message||Ie))}finally{ee(!1)}}},$e=async me=>{me.preventDefault(),le(!0);const he={...E,variants:normalizeVariants(E.variants,E.price),attributes:normalizeAttributes(E.attributes)};await G(he),le(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:$e},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:E.name,onChange:me=>$({...E,name:me.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:E.description,onChange:me=>$({...E,description:me.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:E.sortOrder,onChange:me=>$({...E,sortOrder:parseInt(me.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},E.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:E.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>$({...E,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:ye,disabled:de}),de&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:E.coverImage,onChange:me=>$({...E,coverImage:me.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:A},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:N,settings:x}){const[A,G]=useState([]),[E,$]=useState(!0),[O,le]=useState(!1),[de,ee]=useState(null),[ye,$e]=useState(""),[me,he]=useState(""),[Ie,ue]=useState(!1),[M,Le]=useState(null),We=normalizeShipPercent(x==null?void 0:x.ship_percent),{parseMoney:He,formatVND:ve}=window.KTM.money,Ae=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{oe()},[]);const oe=async()=>{$(!0);try{const b=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");G(Array.isArray(b)?b:[])}catch(b){console.error(b),N("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}$(!1)},Ee=()=>{ee(null),le(!0)},st=b=>{ee(b),le(!0)},ft=b=>{b&&(Le(b),ue(!0))},Se=()=>{ue(!1)},Ue=async b=>{if(!(!b||!b.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:b},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),N(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),oe()}catch(S){N("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},ot=async b=>{try{const S=de?`${API_BASE}/api/products?id=${de.id}`:`${API_BASE}/api/products`;de?await window.KTM.api.putJSON(S,b,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(S,b,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(de?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),le(!1),oe()}catch(S){N(S.message,"danger")}},g=async b=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${b.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${b.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),N("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),oe()}catch(S){N(S.message,"danger")}},f=A.filter(b=>{const S=!ye||b.name.toLowerCase().includes(ye.toLowerCase())||b.code&&b.code.toLowerCase().includes(ye.toLowerCase()),L=!me||b.category===me;return S&&L}),_=b=>{var Y;const S=(Y=b==null?void 0:b.commission_percent)!=null?Y:b==null?void 0:b.commissionPercent,L=S===""||S==null?NaN:Number(S);return Number.isFinite(L)?Math.max(0,Math.min(100,L)):5},W=b=>{const S=_(b),L=Number.isInteger(S)?String(S):String(Math.round(S*100)/100),Y=He(b==null?void 0:b.price);if(!Number.isFinite(Y)||Y<=0)return`${L}%`;const re=(Number(S)||0)/100,Ne=window.KTM.money.parseShipFeeFromNote(b==null?void 0:b.note)!=null?0:We>0?Y*We/100:0,we=Y*re-Ne*re,Ve=Math.max(0,Math.round(we));return`${L}% - ${ve(Ve)}`},X=b=>{if(b==null||b==="")return[];let S=b;if(typeof S=="string"){const L=S.trim();if(!L)return[];try{S=JSON.parse(L)}catch(Y){return[]}}return Array.isArray(S)?S:[]},H=b=>{if(b==null||b==="")return[];let S=b;if(typeof S=="string"){const L=S.trim();if(!L)return[];try{S=JSON.parse(L)}catch(Y){return[]}}return S&&typeof S=="object"&&!Array.isArray(S)&&(S=Object.entries(S).map(([L,Y])=>({key:L,value:Y}))),Array.isArray(S)?S:[]},q=b=>{const S=H(b).map(L=>{var Y,re,ne,Ne,we;return{key:String((ne=(re=(Y=L==null?void 0:L.key)!=null?Y:L==null?void 0:L.name)!=null?re:L==null?void 0:L.label)!=null?ne:"").trim(),value:String((Ne=L==null?void 0:L.value)!=null?Ne:"").trim(),unit:String((we=L==null?void 0:L.unit)!=null?we:"").trim()}}).filter(L=>!!L.key);return S.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},S.map((L,Y)=>{const re=L.key,ne=`${L.value||""}${L.unit?(L.value?" ":"")+L.unit:""}`.trim();return React.createElement("div",{key:`${re}-${Y}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},re),ne?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ne):null)}))):null},ie=(b,S={})=>{const L=X(b).map(Ne=>{var we;return{name:String((we=Ne==null?void 0:Ne.name)!=null?we:"").trim(),options:Array.isArray(Ne==null?void 0:Ne.options)?Ne.options:[]}}).map(Ne=>({...Ne,options:Ne.options.map(we=>{var Ve;return{label:String((Ve=we==null?void 0:we.label)!=null?Ve:"").trim(),price:Number(we==null?void 0:we.price)}}).filter(we=>!!we.label)})).filter(Ne=>Ne.options.length>0);if(!L.length)return null;const Y=Number.isFinite(S.maxGroups)?Math.max(1,Math.trunc(S.maxGroups)):L.length,re=Number.isFinite(S.maxOptionsPerGroup)?Math.max(1,Math.trunc(S.maxOptionsPerGroup)):4,ne=L.slice(0,Y);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},ne.map((Ne,we)=>{const Ve=Ne.name||"Bi\u1EBFn th\u1EC3",tt=Ne.options.slice(0,re),ae=Ne.options.length-tt.length;return React.createElement("div",{key:`${Ve}-${we}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Ve),tt.map((Oe,ut)=>{const Be=Oe.price,yt=Number.isFinite(Be)&&Be>=0?ve(Math.trunc(Be)):"",pt=yt?`${Oe.label} \xB7 ${yt}`:Oe.label;return React.createElement("span",{key:`${Ve}-${we}-${ut}`,className:"ktm-chip ktm-chip-option"},pt)}),ae>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",ae))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Ee},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:ye,onChange:b=>$e(b.target.value)})),React.createElement("span",{className:"product-count"},f.length)),React.createElement("select",{className:"form-select",value:me,onChange:b=>he(b.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),Ae.map(b=>React.createElement("option",{key:b,value:b},b)))),E?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):f.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Ee},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},f.map(b=>React.createElement("div",{key:b.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>ft(b),onKeyDown:S=>{(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),ft(b))},title:"Xem chi ti\u1EBFt"},b.image?React.createElement("img",{src:b.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},b.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},b.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},b.category),b.code&&React.createElement("span",{className:"product-badge bg-secondary"},b.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),W(b))),React.createElement("div",{className:"product-price"},b.price?b.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),b.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},b.note),q(b.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},q(b.attributes)),ie(b.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},ie(b.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:S=>{S.stopPropagation(),st(b)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:S=>{S.stopPropagation(),g(b)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:Ie,title:String((M==null?void 0:M.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((M==null?void 0:M.code)||"").trim()||null,String((M==null?void 0:M.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Se,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const b=String((M==null?void 0:M.code)||"").trim();b&&window.KTM.clipboard.writeText(b).then(()=>N("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((M==null?void 0:M.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const b=String((M==null?void 0:M.price)||"").trim();b&&window.KTM.clipboard.writeText(b).then(()=>N("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((M==null?void 0:M.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>M&&st(M),disabled:!M},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>M&&g(M),disabled:!M},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},M?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const b=String((M==null?void 0:M.price)||"").trim(),S=He(b);return Number.isFinite(S)&&S>0?ve(Math.trunc(S)):b||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},W(M)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},M.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},M.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),M.image?React.createElement("img",{src:M.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(M.note||"").trim()||M.attributes||M.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(M.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(M.note||"").trim()),q(M.attributes)?React.createElement("div",{className:"mt-2"},q(M.attributes)):null,ie(M.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},ie(M.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:O,product:de,categories:Ae,onClose:()=>le(!1),onSave:ot}))}function ProductModal({show:N,product:x,categories:A,onClose:G,onSave:E}){const[$,O]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[le,de]=useState(!1),[ee,ye]=useState(!1),$e=g=>{const f=window.KTM.money.getDigits(String(g!=null?g:"")),_=Number(f);return f&&Number.isFinite(_)?Math.trunc(_):0},me=g=>{if(g==null||g==="")return[];let f=g;if(typeof f=="string"){const _=f.trim();if(!_)return[];try{f=JSON.parse(_)}catch(W){return[]}}return f&&typeof f=="object"&&!Array.isArray(f)&&(f=Object.entries(f).map(([_,W])=>({key:_,value:W}))),Array.isArray(f)?f.map(_=>{var q,ie,b,S,L;if(!_||typeof _!="object")return null;const W=String((b=(ie=(q=_.key)!=null?q:_.name)!=null?ie:_.label)!=null?b:"").trim(),X=String((S=_.value)!=null?S:"").trim(),H=String((L=_.unit)!=null?L:"").trim();return W?{key:W,value:X,unit:H}:null}).filter(Boolean):[]},he=(g,f)=>{if(g==null||g==="")return[];let _=g;if(typeof _=="string"){const X=_.trim();if(!X)return[];try{_=JSON.parse(X)}catch(H){return[]}}if(!Array.isArray(_))return[];const W=$e(f);return _.map(X=>{var ie;if(!X||typeof X!="object")return null;const H=String((ie=X.name)!=null?ie:"").trim(),q=(Array.isArray(X.options)?X.options:[]).map(b=>{var Ne,we,Ve,tt,ae,Oe,ut;if(!b||typeof b!="object")return null;const S=String((Ne=b.label)!=null?Ne:"").trim();if(!S)return null;const L=(ae=(tt=(Ve=(we=b.price)!=null?we:b.priceValue)!=null?Ve:b.unit_price)!=null?tt:b.unitPrice)!=null?ae:null,Y=Number(L);let re=Number.isFinite(Y)?Math.trunc(Y):null;if(re==null){const Be=(ut=(Oe=b.price_delta)!=null?Oe:b.priceDelta)!=null?ut:null,yt=Number(Be);Number.isFinite(yt)&&(re=W+Math.trunc(yt))}re==null&&(re=W);const ne=String(Math.max(0,Math.trunc(Number(re)||0)));return{label:S,price:Math.max(0,Math.trunc(Number(re)||0)),priceDigits:ne}}).filter(Boolean);return{name:H||"Bi\u1EBFn th\u1EC3",options:q}}).filter(Boolean)};useEffect(()=>{var g,f;O(x?{name:x.name||"",code:x.code||"",price:x.price||"",image:x.image||"",category:x.category||"",note:x.note||"",sort_order:x.sort_order||0,commission_percent:(f=(g=x.commission_percent)!=null?g:x.commissionPercent)!=null?f:5,variants:he(x.variants,x.price),attributes:me(x.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[x,N]);const Ie=g=>{O(f=>{var q;const _=$e(f.price),W=String(_),X=Array.isArray(f.variants)?[...f.variants]:[],H={...X[g]||{},options:Array.isArray((q=X[g])==null?void 0:q.options)?[...X[g].options]:[]};return H.options=H.options.map(ie=>({label:String((ie==null?void 0:ie.label)||""),price:_,priceDigits:W})),X[g]=H,{...f,variants:X}})},ue=()=>{O(g=>{const f=$e(g.price),_=String(f),X=(Array.isArray(g.variants)?[...g.variants]:[]).map(H=>{const q=(Array.isArray(H==null?void 0:H.options)?H.options:[]).map(ie=>({label:String((ie==null?void 0:ie.label)||""),price:f,priceDigits:_}));return{name:String((H==null?void 0:H.name)||"Bi\u1EBFn th\u1EC3"),options:q}});return{...g,variants:X}})},[M,Le]=React.useState(""),We=g=>window.KTM.money.formatVNDInputDigits(g),[He,ve]=React.useState(""),Ae=g=>{const f=window.KTM.money.nextPriceInputState(g.target.value,He);ve(f.digits),O({...$,price:f.price})},[oe,Ee]=React.useState("");React.useEffect(()=>{x!=null&&x.image&&Ee(x.image)},[x]);const st=async g=>{if(!(!g||!g.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:g},"L\u1ED7i x\xF3a \u1EA3nh")}catch(f){console.error("Delete cloudinary image error:",f)}},ft=async(g,f=2,_)=>{const W=f*1024*1024,X=g.type==="image/heic"||g.type==="image/heif"||/\.heic$/i.test(g.name);if(g.size<=W&&!X)return g;_==null||_("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const H=await createImageBitmap(g);_==null||_("\u0110ang n\xE9n \u1EA3nh...");const q=document.createElement("canvas");let ie=H.width,b=H.height;const S=1200;return(ie>S||b>S)&&(ie>b?(b=Math.round(b/ie*S),ie=S):(ie=Math.round(ie/b*S),b=S)),q.width=ie,q.height=b,q.getContext("2d").drawImage(H,0,0,ie,b),H.close(),new Promise((Y,re)=>{q.toBlob(ne=>{ne?(_==null||_("Ho\xE0n t\u1EA5t!"),Y(new File([ne],g.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):re(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(H){throw console.error("createImageBitmap error:",H),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Se=async g=>{var W,X;const f=(W=g.target.files)==null?void 0:W[0];if(!f)return;if(!(f.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(f.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ye(!0),Le("\u0110ang chu\u1EA9n b\u1ECB...");try{const H=(f.size/1024/1024).toFixed(1);Le(`File ${H}MB - \u0110ang n\xE9n...`);const q=await ft(f,2,S=>{Le(S)}),ie=(q.size/1024/1024).toFixed(1);Le(`\u0110\xE3 n\xE9n: ${ie}MB - \u0110ang upload...`);const b=await window.KTM.cloudinary.uploadImage({file:q,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});b.secure_url?($.image&&$.image!==oe&&st($.image),O(S=>({...S,image:b.secure_url})),Le("")):(console.error("Cloudinary error:",b),alert("Upload th\u1EA5t b\u1EA1i: "+(((X=b.error)==null?void 0:X.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Le(""))}catch(H){console.error("Upload error:",H),alert("L\u1ED7i: "+H.message),Le("")}ye(!1),g.target.value=""},Ue=()=>{$.image&&($.image!==oe&&st($.image),O(g=>({...g,image:""})))},ot=async g=>{g.preventDefault(),de(!0),oe&&$.image&&oe!==$.image&&await st(oe),oe&&!$.image&&await st(oe),await E($),de(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${x?"fa-edit":"fa-plus-circle"} me-2`}),x?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:G})),React.createElement("form",{onSubmit:ot},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},$.image?React.createElement(React.Fragment,null,React.createElement("img",{src:$.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Ue,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${ee?"fa-spinner fa-spin":"fa-camera"} me-1`}),ee?M||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Se,disabled:ee,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),ee&&M&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},M))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:$.name,onChange:g=>O({...$,name:g.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:$.code,onChange:g=>O({...$,code:g.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:$.price,onChange:Ae,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:$.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:g=>O({...$,commission_percent:g.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:$.category,onChange:g=>O({...$,category:g.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),A.map(g=>React.createElement("option",{key:g,value:g},g)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:$.note,onChange:g=>O({...$,note:g.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray($.attributes)?$.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray($.attributes)?$.attributes:[]).map((g,f)=>React.createElement("div",{key:f,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(g==null?void 0:g.key)||"",onChange:_=>{const W=_.target.value;O(X=>{const H=Array.isArray(X.attributes)?[...X.attributes]:[];return H[f]={...H[f]||{},key:W},{...X,attributes:H}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(g==null?void 0:g.value)||"",onChange:_=>{const W=_.target.value;O(X=>{const H=Array.isArray(X.attributes)?[...X.attributes]:[];return H[f]={...H[f]||{},value:W},{...X,attributes:H}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(g==null?void 0:g.unit)||"",onChange:_=>{const W=_.target.value;O(X=>{const H=Array.isArray(X.attributes)?[...X.attributes]:[];return H[f]={...H[f]||{},unit:W},{...X,attributes:H}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{O(_=>{const W=Array.isArray(_.attributes)?[..._.attributes]:[];return W.splice(f,1),{..._,attributes:W}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{O(g=>{const f=Array.isArray(g.attributes)?[...g.attributes]:[];return f.push({key:"",value:"",unit:""}),{...g,attributes:f}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray($.variants)?$.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray($.variants)?$.variants:[]).map((g,f)=>React.createElement("div",{key:f,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(g==null?void 0:g.name)||"",onChange:_=>{const W=_.target.value;O(X=>{var q;const H=Array.isArray(X.variants)?[...X.variants]:[];return H[f]={...H[f]||{},name:W,options:Array.isArray((q=H[f])==null?void 0:q.options)?H[f].options:[]},{...X,variants:H}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Ie(f),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(g==null?void 0:g.options)||g.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{O(_=>{const W=Array.isArray(_.variants)?[..._.variants]:[];return W.splice(f,1),{..._,variants:W}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(g==null?void 0:g.options)?g.options:[]).map((_,W)=>{var X,H;return React.createElement("div",{key:W,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(_==null?void 0:_.label)||"",onChange:q=>{const ie=q.target.value;O(b=>{var ne,Ne,we,Ve,tt;const S=Array.isArray(b.variants)?[...b.variants]:[],L={...S[f]||{},options:Array.isArray((ne=S[f])==null?void 0:ne.options)?[...S[f].options]:[]},Y=Number((we=(Ne=L.options[W])==null?void 0:Ne.price)!=null?we:0)||0,re=String((tt=(Ve=L.options[W])==null?void 0:Ve.priceDigits)!=null?tt:Math.max(0,Math.trunc(Y)));return L.options[W]={...L.options[W]||{},label:ie,price:Math.max(0,Math.trunc(Y)),priceDigits:re},S[f]=L,{...b,variants:S}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:We(String((H=_==null?void 0:_.priceDigits)!=null?H:window.KTM.money.getDigits(String((X=_==null?void 0:_.price)!=null?X:"")))),onChange:q=>{O(ie=>{var we,Ve,tt,ae,Oe;const b=String((Ve=_==null?void 0:_.priceDigits)!=null?Ve:window.KTM.money.getDigits(String((we=_==null?void 0:_.price)!=null?we:""))),S=window.KTM.money.nextPriceInputState(q.target.value,b),L=String((tt=S.digits)!=null?tt:""),Y=Number(L),re=Number.isFinite(Y)?Math.max(0,Math.trunc(Y)):0,ne=Array.isArray(ie.variants)?[...ie.variants]:[],Ne={...ne[f]||{},options:Array.isArray((ae=ne[f])==null?void 0:ae.options)?[...ne[f].options]:[]};return Ne.options[W]={...Ne.options[W]||{},label:String(((Oe=Ne.options[W])==null?void 0:Oe.label)||""),price:re,priceDigits:L},ne[f]=Ne,{...ie,variants:ne}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{O(q=>{var S;const ie=Array.isArray(q.variants)?[...q.variants]:[],b={...ie[f]||{},options:Array.isArray((S=ie[f])==null?void 0:S.options)?[...ie[f].options]:[]};return b.options.splice(W,1),ie[f]=b,{...q,variants:ie}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{O(_=>{var q;const W=Array.isArray(_.variants)?[..._.variants]:[],X={...W[f]||{},options:Array.isArray((q=W[f])==null?void 0:q.options)?[...W[f].options]:[]},H=$e(_.price);return X.options.push({label:"",price:H,priceDigits:String(H)}),W[f]=X,{..._,variants:W}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{O(g=>{const f=$e(g.price),_=Array.isArray(g.variants)?[...g.variants]:[],W=String(f);return _.push({name:"Size",options:[{label:"S",price:f,priceDigits:W},{label:"M",price:f,priceDigits:W},{label:"L",price:f,priceDigits:W}]}),{...g,variants:_}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ue,disabled:!Array.isArray($.variants)||$.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:$.image,onChange:g=>O({...$,image:g.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:G,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:le,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},le?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:N,video:x,onClose:A,onSave:G}){const[E,$]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[O,le]=useState(!1),[de,ee]=useState("");useEffect(()=>{x?($({title:x.title||"",youtube_url:`https://www.youtube.com/watch?v=${x.youtubeId}`,thumbnail_url:x.thumb||"",sort_order:x.sortOrder||0}),ee(x.thumb)):($({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),ee(""))},[x,N]);const ye=he=>{const Ie=he.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Ie?Ie[1]:null},$e=he=>{$({...E,youtube_url:he});const Ie=ye(he);Ie&&ee(`https://img.youtube.com/vi/${Ie}/hqdefault.jpg`)},me=async he=>{he.preventDefault(),le(!0),await G(E),le(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:me},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:E.youtube_url,onChange:he=>$e(he.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),de&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:de,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:E.title,onChange:he=>$({...E,title:he.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:E.sort_order,onChange:he=>$({...E,sort_order:parseInt(he.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:E.thumbnail_url,onChange:he=>$({...E,thumbnail_url:he.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:A},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[N,x]=useState(!1),[A,G]=useState(""),[E,$]=useState(null),[O,le]=useState("search"),[de,ee]=useState(()=>loadAdminPins()),[ye,$e]=useState(()=>loadAdminRecent()),[me,he]=useState(null),[Ie,ue]=useState(""),[M,Le]=useState([]),[We,He]=useState(null),[ve,Ae]=useState(!1),[oe,Ee]=useState(null),[st,ft]=useState(!0),[Se,Ue]=useState([]),[ot,g]=useState(!1),[f,_]=useState(null),[W,X]=useState(!1),[H,q]=useState(!1),[ie,b]=useState(""),[S,L]=useState(()=>loadAdminSettings()),[Y,re]=useState(null),[ne,Ne]=useState([]);useEffect(()=>{const c=localStorage.getItem("ktm_admin_session");if(c)try{const I=JSON.parse(c);I.expiry>Date.now()?(x(!0),$(I.user)):localStorage.removeItem("ktm_admin_session")}catch(I){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{N&&Be()},[N]),useEffect(()=>{const c=()=>{try{const R=document.querySelector(".admin-topbar");if(!R)return;const se=R.getBoundingClientRect(),xe=Math.max(0,Math.round(se.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${xe+10}px`)}catch(R){}};c(),window.addEventListener("resize",c);const I=setTimeout(c,0);return()=>{clearTimeout(I),window.removeEventListener("resize",c)}},[N,O]),useEffect(()=>{var R,se;const c=window.visualViewport,I=()=>{try{const xe=Number(window.innerHeight)||0,K=Number(c==null?void 0:c.height)||xe,Ke=Number(c==null?void 0:c.offsetTop)||0,Xe=Math.max(0,Math.round(xe-K-Ke));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${Xe}px`)}catch(xe){}};I(),window.addEventListener("resize",I);try{(R=c==null?void 0:c.addEventListener)==null||R.call(c,"resize",I),(se=c==null?void 0:c.addEventListener)==null||se.call(c,"scroll",I)}catch(xe){}return()=>{var xe,K;window.removeEventListener("resize",I);try{(xe=c==null?void 0:c.removeEventListener)==null||xe.call(c,"resize",I),(K=c==null?void 0:c.removeEventListener)==null||K.call(c,"scroll",I)}catch(Ke){}}},[]),useEffect(()=>{if(!N)return;const c=R=>{if(!R)return!1;const se=String(R.tagName||"").toLowerCase();return!!(se==="input"||se==="textarea"||se==="select"||R.isContentEditable)},I=R=>{if(!R||R.ctrlKey||R.metaKey||R.altKey||c(R.target))return;const se=R.key;(se==="/"||se==="N"||se==="n"||se==="Escape"||se==="j"||se==="J"||se==="k"||se==="K")&&(se==="/"&&R.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:se}})))};return document.addEventListener("keydown",I),()=>document.removeEventListener("keydown",I)},[N]),useEffect(()=>{N&&$e(c=>{const I=Array.isArray(c)?c:[],R=[O,...I.filter(se=>se!==O)].slice(0,8);return saveAdminRecent(R),R})},[N]);const we=c=>{const I=String(c||"").trim();I&&$e(R=>{const se=Array.isArray(R)?R:[],xe=[I,...se.filter(K=>K!==I)].slice(0,8);return saveAdminRecent(xe),xe})},Ve=c=>{const I=String(c||"").trim();I&&ee(R=>{const se=Array.isArray(R)?R:[],K=se.includes(I)?se.filter(Ke=>Ke!==I):[I,...se].slice(0,10);return saveAdminPins(K),K})};useEffect(()=>{if(!N)return;let c=!1;return(async()=>{try{const I=await fetchAdminSettingsFromServer();if(c)return;L(I),saveAdminSettings(I)}catch(I){}})(),()=>{c=!0}},[N]);const tt=async(c,I)=>{G("");try{const R=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:c,password:I},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),se={user:R.user,token:R.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(se)),$(R.user),x(!0)}catch(R){G(R.message)}},ae=()=>{localStorage.removeItem("ktm_admin_session"),x(!1),$(null),Le([]),He(null)},Oe=(c,I="success",R=null)=>{const se=Date.now()+Math.floor(Math.random()*1e3);if(c&&typeof c=="object"){const K=c;Ue(Ke=>[...Ke,{id:se,message:String(K.message||""),type:String(K.type||I||"success"),actionLabel:K.actionLabel||null,onAction:typeof K.onAction=="function"?K.onAction:null,durationMs:K.durationMs||null}]);return}const xe=R&&typeof R=="object"?R:null;Ue(K=>[...K,{id:se,message:String(c||""),type:String(I||"success"),actionLabel:(xe==null?void 0:xe.actionLabel)||null,onAction:typeof(xe==null?void 0:xe.onAction)=="function"?xe.onAction:null,durationMs:(xe==null?void 0:xe.durationMs)||null}])},ut=c=>{Ue(I=>I.filter(R=>R.id!==c))},Be=async(c=null)=>{ft(!0);try{const I=c?`${API_BASE}/api/albums?parent_id=${c}`:`${API_BASE}/api/albums?parent_id=root`,R=await window.KTM.api.getJSON(I,"L\u1ED7i t\u1EA3i danh s\xE1ch album");Le(Array.isArray(R)?R:[])}catch(I){console.error(I),Oe("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}ft(!1)},yt=()=>{Ee(null),Ae(!0)},pt=c=>{je(c),X(!0)},jt=async(c,I="modal")=>{try{const R=oe&&oe.uuid;!R&&Y&&(c.parent_id=Y.uuid);const se=R?`${API_BASE}/api/albums/${oe.uuid||oe.id}`:`${API_BASE}/api/albums`;R?await window.KTM.api.putJSON(se,c,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(se,c,"L\u1ED7i t\u1EA1o"),Oe(R?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),I==="drawer"?(X(!1),Ee(null),Be(Y==null?void 0:Y.uuid),R&&f&&_({...f,...c})):(Ae(!1),Ee(null),Be(Y==null?void 0:Y.uuid))}catch(R){Oe(R.message,"danger")}},St=c=>{He(c)},y=c=>{if(c==="root")Ne([]),re(null),Be(null);else if(c){const I=ne.findIndex(R=>R.uuid===c.uuid);I>=0&&(Ne(ne.slice(0,I+1)),re(c),Be(c.uuid))}else{const I=[...ne];I.pop();const R=I[I.length-1]||null;Ne(I),re(R),Be(R==null?void 0:R.uuid)}},P=async c=>{const I=`X\xF3a folder "${c.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(I))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${c.uuid||c.id}`,"L\u1ED7i x\xF3a album"),Oe("\u0110\xE3 x\xF3a","success"),Be(Y==null?void 0:Y.uuid)}catch(R){Oe("L\u1ED7i x\xF3a album","danger")}},je=async c=>{c&&(g(!0),b(""),q(!1),X(!1),_(c))},at=()=>{g(!1),q(!1),b(""),X(!1),_(null)},bt=c=>{X(!0)};if(!N)return React.createElement(LoginPage,{onLogin:tt,error:A});const lt=()=>{const c=new Date,I=c.getFullYear(),R=String(c.getMonth()+1).padStart(2,"0");return`${I}-${R}`};function wt(){const[c,I]=useState(()=>{var K;return String((K=S==null?void 0:S.ship_percent)!=null?K:DEFAULT_SHIP_PERCENT)}),[R,se]=useState(!1);return useEffect(()=>{var K;I(String((K=S==null?void 0:S.ship_percent)!=null?K:DEFAULT_SHIP_PERCENT))},[S==null?void 0:S.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async K=>{K.preventDefault(),se(!0);const Ke=saveAdminSettings({ship_percent:c});try{const Xe=await saveAdminSettingsToServer(Ke);L(Xe),saveAdminSettings(Xe),Oe("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Xe){L(Ke),Oe("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{se(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:c,min:"0",max:"100",step:"0.01",onChange:K=>I(K.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:R},R?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function k(){const[c,I]=useState(lt()),[R,se]=useState(!0),xe=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[K,Ke]=useState(xe),Xe=useRef(new Map),it=normalizeShipPercent(S==null?void 0:S.ship_percent),{formatNumber:be,formatVND:dt}=window.KTM.money,ea=async(ge,Ht=!1)=>{var ya,Jt;const ta=String(ge||"").trim();if(!ta)return xe();const Rt=`${ta}|${it}`,zt=(ya=Xe.current)==null?void 0:ya.get(Rt);if(!Ht&&zt)return zt;const Et=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(ta)}&ship_percent=${encodeURIComponent(it)}`,xt=await window.KTM.api.getJSON(Et,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),aa=xt!=null&&xt.stats&&(xt!=null&&xt.meta)?xt.stats:xt,ca=aa&&typeof aa=="object"?aa:xe();return(Jt=Xe.current)==null||Jt.set(Rt,ca),ca},_t=async(ge=!1)=>{se(!0);try{const Ht=await ea(c,ge);Ke(Ht)}catch(Ht){console.error("Load stats error:",Ht),Ke(xe())}finally{se(!1)}};return useEffect(()=>{_t()},[c,it]),React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:R}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>_t(!0),disabled:R},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:c,onChange:ge=>I(ge.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",it,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),be(K.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),be(K.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),be(K.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",be(K.statusCounts.paid),"/",be(K.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},be(K.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},dt(K.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},dt(K.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},dt(K.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},dt(K.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",K.avgQtyPerOrder?K.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},be(K.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},be(K.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},be(K.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},be(K.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},be(K.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},be(K.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},be(K.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,be(K.statusCounts.draft)),React.createElement("td",null,be(K.statusCounts.pending)),React.createElement("td",null,be(K.statusCounts.processing)),React.createElement("td",null,be(K.statusCounts.canceled)),React.createElement("td",null,be(K.statusCounts.done)),React.createElement("td",null,be(K.statusCounts.paid)),React.createElement("td",null,be(K.statusCounts.other)),React.createElement("td",null,be(K.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},K.products.slice(0,10).map(ge=>React.createElement("div",{key:ge.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},ge.product_name),React.createElement("div",{className:"text-muted small text-truncate"},ge.product_code?`#${ge.product_code} \u2022 `:"",be(ge.orders)," \u0111\u01A1n \u2022 ",be(ge.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},dt(ge.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,K.products.slice(0,10).map(ge=>React.createElement("tr",{key:ge.product_id},React.createElement("td",null,ge.product_name),React.createElement("td",null,ge.product_code||"\u2014"),React.createElement("td",null,be(ge.orders)),React.createElement("td",null,be(ge.quantity)),React.createElement("td",{className:"fw-semibold"},dt(ge.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},K.customers.slice(0,10).map(ge=>React.createElement("div",{key:ge.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},ge.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},ge.phone||"\u2014"," \u2022 ",be(ge.orders)," \u0111\u01A1n \u2022 ",be(ge.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},dt(ge.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,K.customers.slice(0,10).map(ge=>React.createElement("tr",{key:ge.key},React.createElement("td",null,ge.customer_name||"\u2014"),React.createElement("td",null,ge.phone||"\u2014"),React.createElement("td",null,be(ge.orders)),React.createElement("td",null,be(ge.quantity)),React.createElement("td",{className:"fw-semibold"},dt(ge.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},K.days.map(ge=>React.createElement("div",{key:ge.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},ge.day),React.createElement("div",{className:"text-muted small"},be(ge.orders)," \u0111\u01A1n \u2022 ",be(ge.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",be(ge.doneOrders)," \u2022 ",dt(ge.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},dt(ge.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,K.days.map(ge=>React.createElement("tr",{key:ge.day},React.createElement("td",null,ge.day),React.createElement("td",null,be(ge.orders)),React.createElement("td",null,be(ge.quantity)),React.createElement("td",{className:"fw-semibold"},dt(ge.revenue)),React.createElement("td",null,be(ge.doneOrders)),React.createElement("td",{className:"fw-semibold"},dt(ge.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:O,onMenuChange:c=>{we(c),le(c),c==="albums"&&(re(null),Ne([]),Be(null))},onLogout:ae,currentUser:E,pinnedMenus:de,recentMenus:ye,onTogglePin:Ve}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const I={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[O]||{title:"KTM Admin",icon:"fa-tractor",sub:""},R=(E==null?void 0:E.username)||(E==null?void 0:E.name)||(E==null?void 0:E.email)||"Admin",se=(()=>{if(O!=="albums")return"";const xe=[];return xe.push("Root"),Array.isArray(ne)&&ne.length>0&&xe.push(...ne.map(K=>K==null?void 0:K.title).filter(Boolean)),We!=null&&We.title&&xe.push(We.title),xe.length>0?xe.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${I.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},I.title),React.createElement("div",{className:"admin-page-subtitle"},se||I.sub))),React.createElement("div",{className:"admin-topbar-right"},O==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:yt,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:R},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},R)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:ae,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},O==="albums"&&!We&&React.createElement(AlbumList,{albums:M,loading:st,currentFolder:Y,breadcrumb:ne,onSelect:St,onCreate:yt,onEdit:pt,onDelete:P,onBack:y}),O==="search"&&React.createElement(SearchCenter,{showToast:Oe,onNavigate:(c,I,R)=>{le(c),c==="orders"&&I==="create"&&(he(Date.now()),ue((R==null?void 0:R.productId)||""))}}),O==="albums"&&We&&React.createElement(AlbumDetail,{album:We,parentAlbum:ne.length>0?ne[ne.length-1]:null,onBack:()=>{if(We.parentId){const c=ne.findIndex(I=>I.uuid===We.parentId);c>=0?He(ne[c]):He(null)}else He(null)},onRefresh:()=>Be(Y==null?void 0:Y.uuid),showToast:Oe,onNavigateToFolder:c=>{Ne(I=>[...I,We]),He(c)},onEditSubfolder:c=>{Ee(c),Ae(!0)}}),O==="videos"&&React.createElement(VideoList,{showToast:Oe}),O==="products"&&React.createElement(ProductManager,{showToast:Oe,settings:S}),O==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:me,autoOpenCreateProductId:Ie,showToast:Oe}),O==="stats"&&React.createElement(k,null),O==="settings"&&React.createElement(wt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${O==="search"?"active":""}`,onClick:c=>{c.preventDefault(),le("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${O==="albums"?"active":""}`,onClick:c=>{c.preventDefault(),le("albums"),He(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${O==="videos"?"active":""}`,onClick:c=>{c.preventDefault(),le("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${O==="products"?"active":""}`,onClick:c=>{c.preventDefault(),le("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${O==="orders"?"active":""}`,onClick:c=>{c.preventDefault(),le("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${O==="stats"?"active":""}`,onClick:c=>{c.preventDefault(),le("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:ve,album:oe,parentId:Y==null?void 0:Y.uuid,onClose:()=>Ae(!1),onSave:jt}),React.createElement(AdminDrawer,{open:ot,title:f?f.title:"Album",subtitle:f?`${f.subfolderCount||0} subfolder \u2022 ${f.count||0} \u1EA3nh`:"",onClose:at,footer:W?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{X(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{f&&(Ee(f),jt({slug:f.id||"",title:f.title||"",description:f.description||"",cover_url:f.cover||"",parent_id:f.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):f?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(f.title),Oe("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>bt(f)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{f&&confirm(`X\xF3a folder "${f.title}"?`)&&(P(f),at())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},W&&f?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:f.title,onChange:c=>_({...f,title:c.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:f.description,onChange:c=>_({...f,description:c.target.value})}))):f?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},f.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},f.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},f.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},f.count||0))),f.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,f.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Se.map(c=>React.createElement(Toast,{key:c.id,message:c.message,type:c.type,actionLabel:c.actionLabel,onAction:c.onAction,durationMs:c.durationMs,onClose:()=>ut(c.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:N,autoOpenCreateProductId:x,showToast:A}){const[G,E]=useState([]),[$,O]=useState(0),[le,de]=useState(!1),[ee,ye]=useState(!1),[$e,me]=useState([]),[he,Ie]=useState(!0),[ue,M]=useState(!1),[Le,We]=useState([]),[He,ve]=useState(!1),[Ae,oe]=useState(""),[Ee,st]=useState([]),[ft,Se]=useState(!1),[Ue,ot]=useState(""),[g,f]=useState(!1),[_,W]=useState(null),[X,H]=useState(null),[q,ie]=useState(!1),[b,S]=useState(()=>{const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${t}-${a}`}),[L,Y]=useState(""),[re,ne]=useState(!1),[Ne,we]=useState(!1),[Ve,tt]=useState(!1),[ae,Oe]=useState(null),[ut,Be]=useState(!1),[yt,pt]=useState(""),[jt,St]=useState(!1),y=useRef(0),[P,je]=useState(!1),[at,bt]=useState(null),[lt,wt]=useState(!1),[k,c]=useState(null),[I,R]=useState(()=>({left:12,top:12,placement:"bottom"})),se=useRef(null),xe=useRef(!1),K=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null}),[Ke,Xe]=useState(()=>({id:null,dir:null})),it=useRef(new Map),be=useRef(null),dt=useRef(null),ea="ktm_orders_status_sync_queue_v1",_t=useRef([]),ge=useRef(!1),[Ht,ta]=useState(()=>({})),[Rt,zt]=useState(!1),[Et,xt]=useState(!1),[aa,ca]=useState(!1),[ya,Jt]=useState(()=>new Set),[Gt,na]=useState(()=>({})),Fa="ktm_orders_pinned_v1",[Tt,Ha]=useState(()=>new Set),[da,sa]=useState(!1),[ma,ia]=useState(!1),[Na,Ya]=useState(!1),[ra,Ot]=useState(""),[Vt,r]=useState(()=>[]),h=useRef(null),T=useRef(null),U=useRef(!1),te=useRef({active:!1,startY:0,startX:0,fired:!1}),[j,w]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),Q=24,pe=20,[ce,Z]=useState(Q),ke=useRef(null),Qe=useRef(null),ze=useRef(!1),Nt=useRef(new Map),Mt=useRef({timer:null,events:[]}),ht=useRef(null),Ct="ktm_orders_phone_tip_v1",ua="ktm_orders_search_history_v1",[nt,Wt]=useState(null),[oa,Lt]=useState(!1),[pa,Ta]=useState([]),[En,D]=useState(!1),[V,F]=useState([]),[m,B]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[fe,Te]=useState([""]),[De,Je]=useState(null),mt=useRef({}),[Ye,$t]=useState([]),[Re,gt]=useState(null),Dt=useRef(null),kt=useRef(null),Pt=useRef(0),vt=useRef(null),Ut=useRef(0),ba=useRef(new Map),Xt=useRef(null),Ma=useRef(0),Va=useRef(new Map),$a=useRef(new Map),Ia=useRef(""),Pn=useRef(null),wn=useRef(null),xn=useRef(0),ws=useRef(null),Kn=9,xs=150,ks=250,Ss=3*60*1e3,Cs=24*60*60*1e3,As=5*60*1e3,Fn="ktm_customer_lookup_cache_v1",_s=200,fa=3,Qa=3,kn=1,Ts=24*60*60*1e3,Ms=120,$s=5*60*1e3,Hn=80,Vn=2,Bn=4,qn=60,Ce=React.useMemo(()=>String(Ae||"").trim().length>0,[Ae]),Za=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),zn=e=>{bt(e),je(!0)},Jn=(e,t)=>{var a,n,s,i;try{const d=(a=t==null?void 0:t.getBoundingClientRect)==null?void 0:a.call(t),o=window.innerWidth||360,v=window.innerHeight||640,u=230,l=280,p=Math.min(Math.max(10,Math.round((n=d==null?void 0:d.left)!=null?n:10)),Math.max(10,o-u-10));let C=Math.round(((s=d==null?void 0:d.bottom)!=null?s:10)+8),J="bottom";C+l>v-10&&(C=Math.max(10,Math.round(((i=d==null?void 0:d.top)!=null?i:10)-8-l)),J="top"),R({left:p,top:C,placement:J})}catch(d){R({left:12,top:12,placement:"bottom"})}c(e),wt(!0)},wa=()=>{wt(!1),setTimeout(()=>c(null),120)};useEffect(()=>{if(!lt)return;const e=t=>{t.key==="Escape"&&wa()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[lt]);const xa=()=>{je(!1),setTimeout(()=>bt(null),180)},Is=()=>{zt(!0)},en=()=>{zt(!1)},Gn=e=>{const t=String(e||"").trim();t&&Jt(a=>{const n=new Set(a);return n.has(t)?n.delete(t):n.add(t),n})};useEffect(()=>{try{const e=localStorage.getItem(Fa);if(!e)return;const t=JSON.parse(e);if(!Array.isArray(t))return;Ha(new Set(t.map(a=>String(a||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from(Tt||[]).map(t=>String(t||"").trim()).filter(Boolean);localStorage.setItem(Fa,JSON.stringify(e))}catch(e){}},[Tt]);const js=e=>{const t=String(e||"").trim();t&&Ha(a=>{const n=new Set(a);return n.has(t)?n.delete(t):n.add(t),n})};useEffect(()=>{try{const e=localStorage.getItem(ua);if(!e)return;const t=JSON.parse(e);if(!Array.isArray(t))return;r(t.map(a=>String(a||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Os=e=>{try{localStorage.setItem(ua,JSON.stringify(e))}catch(t){}},Ba=e=>{const t=String(e||"").trim();t&&r(a=>{const n=Array.isArray(a)?a:[],s=[t,...n.filter(i=>String(i||"").trim().toLowerCase()!==t.toLowerCase())].slice(0,10);return Os(s),s})},Wn=e=>{var a;const t=String((a=e!=null?e:Ae)!=null?a:"").trim();Ot(t),Ya(!0),setTimeout(()=>{var n,s;try{(s=(n=h.current)==null?void 0:n.focus)==null||s.call(n)}catch(i){}},0)},Bt=()=>{Ya(!1)};useEffect(()=>{if(!Na)return;const e=t=>{t.key==="Escape"&&Bt()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Na]),useEffect(()=>{if(!j)return;const e=n=>{if(Na||(window.scrollY||0)>6)return;const s=n.touches&&n.touches[0];s&&(te.current={active:!0,startY:s.clientY,startX:s.clientX,fired:!1})},t=n=>{const s=te.current;if(!(s!=null&&s.active)||s.fired||(window.scrollY||0)>6)return;const i=n.touches&&n.touches[0];if(!i)return;const d=i.clientY-s.startY,o=i.clientX-s.startX;Math.abs(o)>24||d>92&&(s.fired=!0,Wn(Ae))},a=()=>{te.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",t,{passive:!0}),window.addEventListener("touchend",a,{passive:!0}),window.addEventListener("touchcancel",a,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)}},[j,Na,Ae]);const Un=e=>{try{const t=It(e==null?void 0:e.status);if(!(t==="pending"||t==="processing"))return!1;const a=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(a.getTime()))return!1;const n=new Date;return a.getFullYear()===n.getFullYear()&&a.getMonth()===n.getMonth()&&a.getDate()===n.getDate()}catch(t){return!1}};useEffect(()=>{var a;let e;const t=()=>{try{w(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(n){w(!1)}};try{e=(a=window.matchMedia)==null?void 0:a.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",t):e!=null&&e.addListener&&e.addListener(t)}catch(n){e=null}return window.addEventListener("resize",t),t(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",t):e!=null&&e.removeListener&&e.removeListener(t)}catch(n){}window.removeEventListener("resize",t)}},[]),useEffect(()=>{const e="admin-sheet-open";return P||Rt||lt?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[P,Rt,lt]),useEffect(()=>{if(!P&&!Rt&&!lt)return;const e=t=>{t.key==="Escape"&&(P&&xa(),Rt&&en(),lt&&wa())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[P,Rt,lt]);const Ls=()=>{try{if(localStorage.getItem(Ct))return;localStorage.setItem(Ct,"1"),typeof A=="function"&&A("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},Xn=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),Yn=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),Qn=e=>{const t=et(String(e||"")).replace(/[^0-9+]/g,"");if(t)try{window.location.href=`tel:${t}`}catch(a){}},Ds=async e=>{var a,n,s;const t=et(String(e||"")).replace(/[^0-9+]/g,"");if(t)try{await((s=(n=(a=navigator.clipboard)==null?void 0:a.writeText)==null?void 0:n.call(a,t))!=null?s:Promise.reject(new Error("Clipboard not available"))),typeof A=="function"&&A("\u0110\xE3 copy S\u0110T","success")}catch(i){typeof A=="function"&&A("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Rs=()=>{try{const e=localStorage.getItem(ea),t=e?JSON.parse(e):[];return Array.isArray(t)?t:[]}catch(e){return[]}},Zn=e=>{try{localStorage.setItem(ea,JSON.stringify(Array.isArray(e)?e:[]))}catch(t){}},tn=(e,t)=>{const a=String(e||"").trim();a&&ta(n=>{const s={...n||{}};return t?s[a]=!0:delete s[a],s})},Es=(e,t,a)=>{const n=String(e||"").trim(),s=It(t),i=It(a);if(!n||!s)return;const d=Array.isArray(_t.current)?_t.current:[],o=new Map(d.map(u=>[String((u==null?void 0:u.orderId)||""),u]));o.set(n,{orderId:n,nextStatus:s,prevStatus:i,ts:Date.now()});const v=Array.from(o.values()).sort((u,l)=>(Number(u.ts)||0)-(Number(l.ts)||0));_t.current=v,Zn(v),tn(n,!0)},Sn=async()=>{if(ge.current||!navigator.onLine)return;const e=Array.isArray(_t.current)?_t.current.slice():[];if(e.length){ge.current=!0;try{for(const t of e){const a=String((t==null?void 0:t.orderId)||"").trim(),n=It(t==null?void 0:t.nextStatus);if(!(!a||!n)){tn(a,!0);try{await Aa({id:a,status:(t==null?void 0:t.prevStatus)||""},n,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const s=(Array.isArray(_t.current)?_t.current:[]).filter(i=>String((i==null?void 0:i.orderId)||"")!==a);_t.current=s,Zn(s),tn(a,!1)}catch(s){if(!navigator.onLine)break}}}}finally{ge.current=!1}}};useEffect(()=>{const e=Rs();_t.current=e;try{const t={};for(const a of e){const n=String((a==null?void 0:a.orderId)||"").trim();n&&(t[n]=!0)}ta(t)}catch(t){}setTimeout(()=>Sn(),600)},[]),useEffect(()=>{const e=()=>Sn();window.addEventListener("online",e);const t=setInterval(()=>Sn(),8e3);return()=>{clearInterval(t),window.removeEventListener("online",e)}},[]);const Ps=(e,t)=>{var a;(a=e==null?void 0:e.stopPropagation)==null||a.call(e),ze.current=!1,Ls();try{Qe.current&&clearTimeout(Qe.current)}catch(n){}Qe.current=setTimeout(()=>{ze.current=!0,Ds(t)},520)},an=e=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e);try{Qe.current&&clearTimeout(Qe.current)}catch(a){}Qe.current=null},Ks=e=>{const t=String(e||"").trim();if(!t)return;na(s=>({...s,[t]:Date.now()}));const a=Nt.current;try{const s=a.get(t);s&&clearTimeout(s)}catch(s){}const n=setTimeout(()=>{na(s=>{const i={...s||{}};return delete i[t],i});try{a.delete(t)}catch(s){}},9e3);a.set(t,n)},es=e=>String(e||"").replace(/\s+/g," ").trim(),Fs=e=>String(e||"").replace(/[^0-9]+/g,""),qa=e=>{try{const t=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(t))return 0;const a=Date.now()-t;return!Number.isFinite(a)||a<=0?0:Math.floor(a/Ts)}catch(t){return 0}},nn=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:qa(e)>=fa,It=e=>{const t=String(e!=null?e:"").trim().toLowerCase();return t==="cancelled"?"canceled":t},sn=e=>{if(It(e==null?void 0:e.status)!=="draft")return null;const a=Qa-qa(e);return Number.isFinite(a)?a:null},rn=e=>{const t=sn(e);return Number.isFinite(t)?t>0&&t<=kn:!1},ka=e=>{B({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Te([""]),Wt(null),Je(null)};useEffect(()=>{const e=t=>{var n;if(De==null)return;const a=(n=mt.current)==null?void 0:n[De];a&&!a.contains(t.target)&&Je(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[De]);const ts=e=>window.KTM.money.parseMoney(e),as=e=>window.KTM.money.parseSignedMoney(e),Ge=e=>window.KTM.money.formatVND(e),Yt=e=>{const a=(Array.isArray(e)?e:[]).map(n=>{var s,i;return{amount:String((s=n==null?void 0:n.amount)!=null?s:""),note:String((i=n==null?void 0:n.note)!=null?i:"")}});return a.length?a:[{amount:"",note:""}]},Hs=e=>{try{const t=window.KTM.orders.getOrderAdjustmentItems(e),a=(Array.isArray(t)?t:[]).map(n=>{var s,i;return{amount:(n==null?void 0:n.amount)===0?"":String((s=n==null?void 0:n.amount)!=null?s:""),note:String((i=n==null?void 0:n.note)!=null?i:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return a.length?a:[{amount:"",note:""}]}catch(t){return[{amount:"",note:""}]}},ja=e=>(Array.isArray(e)?e:[]).map(a=>({amount:as(a==null?void 0:a.amount),note:String((a==null?void 0:a.note)||"").trim()})).filter(a=>a.amount!==0||!!a.note),Cn=e=>{const t=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],a=ja(t),n=Oa(a),s=(()=>{if(!a.length)return"";const i=a.map(d=>String((d==null?void 0:d.note)||"").trim()).filter(Boolean);return i.length?i.join(" \u2022 "):a.length>1?`${a.length} m\u1EE5c`:""})();return{cleanAdjItems:a,amount:n,summaryText:s}},Oa=e=>(Array.isArray(e)?e:[]).reduce((a,n)=>a+(Number(n==null?void 0:n.amount)||0),0),An=e=>{const t=Array.isArray(e)?e:[];return t.length?JSON.stringify(t):""},di=e=>window.KTM.money.parseShipFeeFromNote(e),La=e=>window.KTM.phone.isValid(e),et=e=>window.KTM.phone.normalize(e),_n=async e=>{if(!e)return null;const t=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return t&&typeof t=="object"&&t.order&&typeof t.order=="object"?t.order:t},Vs=(e,t)=>{var i;const a=Array.isArray(e)?e:[],n=Array.isArray(t)?t:[];if(!a.length)return n;if(!n.length)return a;const s=new Map(a.map(d=>{var o;return[String((o=d==null?void 0:d.id)!=null?o:""),d]}));for(const d of n){const o=String((i=d==null?void 0:d.id)!=null?i:"");o&&s.set(o,d)}return Array.from(s.values())},on=async e=>{var t,a,n,s;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const i=(a=(t=it.current)==null?void 0:t.get)==null?void 0:a.call(t,String(e.id));if(i&&typeof i=="object"&&Array.isArray(i.items)&&i.items.length)return i}catch(i){}try{const i=await _n(e.id);if(i&&typeof i=="object"){try{(s=(n=it.current)==null?void 0:n.set)==null||s.call(n,String(e.id),i)}catch(d){}return E(d=>Array.isArray(d)?d.map(o=>String(o==null?void 0:o.id)===String(e.id)?i:o):d),i}}catch(i){console.error("Fetch order by id error:",i)}return e},Bs=()=>{var e;try{const t=localStorage.getItem(Fn);if(!t)return;const a=JSON.parse(t);if(!a||typeof a!="object")return;const n=Object.entries(a);for(const[s,i]of n)!s||!i||typeof i!="object"||(e=$a.current)==null||e.set(String(s),i)}catch(t){}},Tn=()=>{try{const e=$a.current;if(!e||typeof e.entries!="function")return;const t=Array.from(e.entries()).filter(([n,s])=>n&&s&&typeof s=="object"&&Number.isFinite(s.ts)).sort((n,s)=>(Number(s[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,_s),a={};for(const[n,s]of t)a[n]=s;localStorage.setItem(Fn,JSON.stringify(a))}catch(e){}};useEffect(()=>{Bs()},[]);const ns=e=>{const t=et(e);if(!t)return null;const a=Array.isArray(G)?G:[];let n=null,s=-1;for(const i of a){if(!i||et(i.phone||"")!==t)continue;const d=new Date(i.created_at).getTime(),o=Number.isFinite(d)?d:0;o>=s&&(s=o,n=i)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},ss=(e,t)=>{e&&B(a=>t&&et(a.phone)!==t?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},qs=e=>{const t=ns(e);if(!t)return;const a=et(e);B(n=>{if(a&&et(n.phone)!==a)return n;const s={...n};return!String(n.customer_name||"").trim()&&t.name&&(s.customer_name=t.name),!String(n.address||"").trim()&&t.address&&(s.address=t.address),s})},zs=(e,t,a)=>{var n;try{const s=et(e);if(!s)return;const i=String(t||"").trim(),d=String(a||"").trim();if(!i&&!d)return;(n=$a.current)==null||n.set(s,{ts:Date.now(),status:"found",customer:{phone:s,name:i||null,address:d||null}}),Tn()}catch(s){}},ln=async e=>{var s,i,d;const t=et(e);if(!t)return;qs(t);const a=(s=$a.current)==null?void 0:s.get(t);if(a&&Number.isFinite(a.ts)){const o=Date.now()-a.ts,v=a.status==="found"?Cs:As;if(o>=0&&o<=v){Wt({status:a.status,phone:t,customer:a.customer}),a.status==="found"&&a.customer&&ss(a.customer,t);return}}const n=++Pt.current;Wt({status:"loading",phone:t});try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(t)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Pt.current!==n)return;if(o&&o.exists&&o.customer){(i=$a.current)==null||i.set(t,{ts:Date.now(),status:"found",customer:o.customer}),Tn(),Wt({status:"found",phone:t,customer:o.customer}),ss(o.customer,t);return}(d=$a.current)==null||d.set(t,{ts:Date.now(),status:"not-found",customer:null}),Tn(),Wt({status:"not-found",phone:t})}catch(o){if(Pt.current!==n)return;console.error("Customer lookup error:",o),Wt({status:"error",phone:t})}},is=e=>{const t=et(e),a=ns(t);B(s=>{const i={...s,phone:t};return a&&(!String(s.customer_name||"").trim()&&a.name&&(i.customer_name=a.name),!String(s.address||"").trim()&&a.address&&(i.address=a.address)),i}),Lt(!1),kt.current&&(clearTimeout(kt.current),kt.current=null);const n=t;if(n.length<Kn){Wt(null);return}if(La(n)&&n!==Ia.current){Ia.current=n,ln(n);return}kt.current=setTimeout(()=>{const s=et(t);La(s)&&s!==Ia.current&&(Ia.current=s,ln(s))},xs)},rs=()=>{const e=et(m.phone);e.length<Kn||La(e)&&e!==Ia.current&&(Ia.current=e,ln(e))};useEffect(()=>(Ne?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Ne]);const cn=Array.isArray(m.items)?m.items.length:0;useEffect(()=>{if(!Ne){xn.current=cn;return}cn>xn.current&&setTimeout(()=>{const e=Pn.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),xn.current=cn},[Ne,cn]),useEffect(()=>()=>{kt.current&&(clearTimeout(kt.current),kt.current=null),vt.current&&(clearTimeout(vt.current),vt.current=null)},[]),useEffect(()=>{if(!Ne)return;vt.current&&(clearTimeout(vt.current),vt.current=null);const e=et((m==null?void 0:m.phone)||"");if(!La(e)){Ta([]),D(!1);return}return vt.current=setTimeout(async()=>{var s;const t=String(e),a=(s=ba.current)==null?void 0:s.get(t);if(a&&Number.isFinite(a.ts)&&Date.now()-a.ts<=Ss){Ta(Array.isArray(a.orders)?a.orders:[]),D(!1);return}const n=++Ut.current;D(!0);try{const i=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,d=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(Ut.current!==n)return;const o=Array.isArray(d)?d:Array.isArray(d==null?void 0:d.orders)?d.orders:[];Ta(o);try{const v=ba.current;if(v&&typeof v.set=="function"&&(v.set(t,{ts:Date.now(),orders:o}),v.size>100)){const u=Array.from(v.entries()).sort((p,C)=>{var J,z;return(Number((J=p==null?void 0:p[1])==null?void 0:J.ts)||0)-(Number((z=C==null?void 0:C[1])==null?void 0:z.ts)||0)}),l=Math.max(0,u.length-100);for(let p=0;p<l;p++)v.delete(u[p][0])}}catch(v){}}catch(i){if(Ut.current!==n)return;console.error("Phone history fetch error:",i),Ta([])}finally{if(Ut.current!==n)return;D(!1)}},ks),()=>{vt.current&&(clearTimeout(vt.current),vt.current=null)}},[Ne,m==null?void 0:m.phone]),useEffect(()=>{Ws()},[]),useEffect(()=>{Ce||Sa()},[b,Ce]),useEffect(()=>{un()},[]),useEffect(()=>{N&&Dt.current!==N&&(Dt.current=N,pn(x))},[N]);const qt=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",Da=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",ha=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(G),t=Tt;if(!t||!(t instanceof Set)||t.size===0)return e;const a=Array.isArray(e)?e.slice():[];return a.sort((n,s)=>{var o,v;const i=t.has(String((o=n==null?void 0:n.id)!=null?o:""))?1:0;return(t.has(String((v=s==null?void 0:s.id)!=null?v:""))?1:0)-i}),a},[G,Tt]),Mn=React.useMemo(()=>window.KTM.orders.sortOrders($e),[$e]),dn=React.useMemo(()=>{const t=(Array.isArray(Mn)?Mn:[]).filter(a=>nn(a));return t.sort((a,n)=>{const s=new Date(a==null?void 0:a.created_at).getTime(),i=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(s)?s:0)-(Number.isFinite(i)?i:0)}),t},[Mn]),os=React.useMemo(()=>{const t=(Array.isArray(Le)?Le:[]).filter(a=>rn(a));return t.sort((a,n)=>{const s=new Date(a==null?void 0:a.created_at).getTime(),i=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(s)?s:0)-(Number.isFinite(i)?i:0)}),t},[Le]),za=React.useMemo(()=>{if(re)return dn;let e=ha;if(da){const t=Tt;e=(Array.isArray(e)?e:[]).filter(a=>{var n,s;return(s=t==null?void 0:t.has)==null?void 0:s.call(t,String((n=a==null?void 0:a.id)!=null?n:""))})}return ma&&(e=(Array.isArray(e)?e:[]).filter(t=>Un(t))),e},[re,dn,ha,da,Tt,ma]),mn=React.useMemo(()=>{if(re)return za;const e=String(L||"").trim();return e?(Array.isArray(za)?za:[]).filter(t=>String((t==null?void 0:t.status)||"").trim()===e):za},[za,L,re]),ls=React.useMemo(()=>window.KTM.orders.sortOrders(Ee),[Ee]),ct=React.useMemo(()=>Ce?ls:mn,[mn,Ce,ls]),cs=React.useMemo(()=>{const e=Array.isArray(ct)?ct:[];return j?e.slice(0,Math.max(0,Number(ce)||0)):e},[j,ce,ct]);useEffect(()=>{j&&Z(Q)},[j,L,re,b,Ae]),useEffect(()=>{if(!j)return;const e=Array.isArray(ct)?ct.length:0;if(ce>=e)return;const t=ke.current;if(!t)return;const a=new IntersectionObserver(n=>{Array.isArray(n)&&n.some(i=>i==null?void 0:i.isIntersecting)&&Z(i=>Math.min((Number(i)||0)+pe,e))},{root:null,rootMargin:"520px 0px",threshold:0});return a.observe(t),()=>a.disconnect()},[j,ce,ct]),useEffect(()=>{if(!j){xt(!1),ca(!1);return}const e=()=>{ht.current||(ht.current=window.requestAnimationFrame(()=>{ht.current=null;const t=window.scrollY||document.documentElement.scrollTop||0;xt(t>140),ca(t>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),ht.current&&(window.cancelAnimationFrame(ht.current),ht.current=null)}},[j]),useEffect(()=>{if(!j){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(t){}return}const e=()=>{try{const t=document.querySelector(".mobile-bottom-nav"),a=t&&t.offsetHeight?t.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${a}px`)}catch(t){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[j]);const ga=React.useMemo(()=>{const e=Array.isArray(ct)?ct:[],t={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const a of e){const n=It(a==null?void 0:a.status);n==="draft"?t.draft+=1:n==="pending"?t.pending+=1:n==="processing"?t.processing+=1:n==="done"?t.done+=1:n==="paid"?t.paid+=1:n==="canceled"?t.canceled+=1:t.other+=1}return t},[ct]),Js=React.useMemo(()=>{const e=Tt;return!e||e.size===0?0:(Array.isArray(ha)?ha:[]).reduce((t,a)=>{var n;return t+(e.has(String((n=a==null?void 0:a.id)!=null?n:""))?1:0)},0)},[Tt,ha]),Gs=React.useMemo(()=>(Array.isArray(ha)?ha:[]).filter(e=>Un(e)).length,[ha]),ds=React.useMemo(()=>{const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${t}-${a}`},[]),la=e=>{if(Ce&&oe(""),e==="thisMonth"){ne(!1),Y(""),S(ds);return}if(e==="overduePending"){S(""),ne(!0),Y("pending");return}if(e==="draftExpiring"){ne(!1),Y("draft"),S(""),un();return}if(e==="all"){ne(!1),Y(""),S(ds);return}},Ra=e=>window.KTM.date.formatDateTime(e),Ws=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");$t(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),$t([])}},Sa=async()=>{Ie(!0),ye(!1);try{const t=new URLSearchParams;b&&t.set("month",String(b)),t.set("includeItems","0"),t.set("meta","1"),t.set("limit",String(qn)),t.set("offset","0");const a=`${API_BASE}/api/orders?${t.toString()}`,n=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),s=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],i=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;E(Array.isArray(s)?s:[]),O(Array.isArray(s)?s.length:0),de(!!(i!=null&&i.hasMore)),un()}catch(t){console.error("Load orders error:",t),E([]),O(0),de(!1)}finally{Ie(!1),ye(!1)}},Us=async()=>{if(!(he||ee||Ce)&&le){ye(!0);try{const e=new URLSearchParams;b&&e.set("month",String(b)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(qn)),e.set("offset",String($));const t=`${API_BASE}/api/orders?${e.toString()}`,a=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.orders)?a.orders:[],s=!Array.isArray(a)&&a&&typeof a=="object"&&a.meta||null;E(i=>Vs(i,Array.isArray(n)?n:[])),O(i=>i+(Array.isArray(n)?n.length:0)),de(!!(s!=null&&s.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{ye(!1)}}},ms=async e=>{var s;const t=es(e);if(!t){st([]),ot(""),Se(!1);return}const a=Fs(t);if(t.length<Vn&&a.length<Bn){st([]),ot(`Nh\u1EADp \xEDt nh\u1EA5t ${Vn} k\xFD t\u1EF1 (ho\u1EB7c ${Bn} s\u1ED1) \u0111\u1EC3 search nhanh`),Se(!1);return}try{const i=(s=Va.current)==null?void 0:s.get(t);if(i&&Number.isFinite(i.ts)&&Date.now()-i.ts<=$s){st(Array.isArray(i.results)?i.results:[]),ot(""),Se(!1);return}}catch(i){}const n=++Ma.current;Se(!0),ot("");try{const i=`${API_BASE}/api/orders?search=${encodeURIComponent(t)}`,d=await window.KTM.api.getJSON(i,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(Ma.current!==n)return;const o=Array.isArray(d)?d:[];st(o);try{const v=Va.current;if(v&&typeof v.set=="function"&&(v.set(t,{ts:Date.now(),results:o}),v.size>Hn)){const u=Array.from(v.entries()).sort((p,C)=>{var J,z;return(Number((J=p==null?void 0:p[1])==null?void 0:J.ts)||0)-(Number((z=C==null?void 0:C[1])==null?void 0:z.ts)||0)}),l=Math.max(0,u.length-Hn);for(let p=0;p<l;p++)v.delete(u[p][0])}}catch(v){}}catch(i){if(Ma.current!==n)return;console.error("Order search error:",i),st([]),ot((i==null?void 0:i.message)||"Search l\u1ED7i")}finally{if(Ma.current!==n)return;Se(!1)}};useEffect(()=>{Xt.current&&(clearTimeout(Xt.current),Xt.current=null);const e=es(Ae);if(!e){st([]),ot(""),Se(!1);return}return re&&ne(!1),Xt.current=setTimeout(()=>{ms(e)},Ms),()=>{Xt.current&&(clearTimeout(Xt.current),Xt.current=null)}},[Ae]);const un=async()=>{M(!0),ve(!0);try{const[e,t]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(fa)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(kn)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);me(Array.isArray(e)?e:[]),We(Array.isArray(t)?t:[])}catch(e){console.error("Load all orders error:",e),me([]),We([])}finally{M(!1),ve(!1)}},$n=async e=>{const t=await on(e);if(!t)return;gt(t.id);const a=Array.isArray(t.items)&&t.items.length?t.items.map(o=>{var v,u,l,p;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((v=o==null?void 0:o.quantity)!=null?v:1)||1,unit_price:(()=>{var z;const C=(z=o==null?void 0:o.unit_price)!=null?z:o==null?void 0:o.unitPrice,J=C==null||C===""?NaN:Number(C);return Number.isFinite(J)?Math.trunc(J):null})(),variant:String((u=o==null?void 0:o.variant)!=null?u:"").trim(),variant_json:(p=(l=o==null?void 0:o.variant_json)!=null?l:o==null?void 0:o.variantJson)!=null?p:null}}).filter(o=>o.product_id):[{product_id:t.product_id||"",quantity:Number(t.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=Hs(t),s=ja(n),i=Oa(s),d=An(s);B({customer_name:t.customer_name||"",phone:et(t.phone||""),address:t.address||"",note:(t==null?void 0:t.note)||"",items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:i,adjustment_note:d||(t==null?void 0:t.adjustment_note)||"",status:t.status||"pending"}),Te(new Array(a.length?a.length:1).fill("")),F(new Array(a.length?a.length:1).fill(!0)),Wt(null),we(!1),Oe(t),tt(!0),pt(""),Be(!1),St(!0),t.phone&&ln(et(t.phone))},Ja=async e=>{if(!e)return;tt(!0),pt(""),Be(!0),St(!1),Oe(e);const t=++y.current;try{const a=await on(e);if(y.current!==t)return;Oe(a||e)}catch(a){if(y.current!==t)return;pt((a==null?void 0:a.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(y.current!==t)return;Be(!1)}},Xs=()=>{g||q||(tt(!1),Be(!1),pt(""),St(!1),gt(null),ka(""),Lt(!1),F([]))};function pn(e){tt(!1),St(!1),Be(!1),pt(""),gt(null),ka(e||""),Lt(!1),F([]),we(!0)}const In=()=>{g||q||(we(!1),gt(null),ka(""),Lt(!1),F([]))},us=async()=>{var o,v,u;if(!Re||q||g)return;const e=(Array.isArray(G)?G:[]).find(l=>String(l==null?void 0:l.id)===String(Re))||null,t=String((e==null?void 0:e.status)||(m==null?void 0:m.status)||"").trim();if(t==="done"||t==="paid"||t==="canceled"){const l="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof A=="function"?A(l,"warning"):alert(l);return}const a=et(m.phone),s=(Array.isArray(m.items)?m.items:[]).map((l,p)=>{var C,J;return{idx:p,product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((C=l==null?void 0:l.quantity)!=null?C:0),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(J=l==null?void 0:l.variant_json)!=null?J:null,unit_price:(()=>{const z=l==null?void 0:l.unit_price,Me=z===""||z==null?NaN:Number(z);if(Number.isFinite(Me))return Math.max(0,Math.trunc(Me));const _e=Kt(l==null?void 0:l.product_id),rt=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return Ea(_e,rt)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);if(s.length<2){const l="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof A=="function"?A(l,"warning"):alert(l);return}const i=[],d=[];for(const l of s){const p=!!V[l.idx],C={product_id:l.product_id,quantity:l.quantity,unit_price:l.unit_price,variant:l.variant,variant_json:l.variant_json};p?i.push(C):d.push(C)}if(!i.length||!d.length){const l="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof A=="function"?A(l,"warning"):alert(l);return}ie(!0);try{const l=Array.isArray(m==null?void 0:m.adjustment_items)?m.adjustment_items:[],p=ja(l),C=Oa(p),J=An(p),z={customer_name:m.customer_name,phone:a,address:m.address,note:(m.note||"").trim(),adjustment_amount:C,adjustment_note:J,adjustment_items:p,status:"processing",items:i,product_id:i[0].product_id,quantity:i[0].quantity,split_seq:1},Me=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,z,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),_e=(u=(v=Me==null?void 0:Me.id)!=null?v:(o=Me==null?void 0:Me.order)==null?void 0:o.id)!=null?u:null;if(!_e)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const rt={id:Re,customer_name:m.customer_name,phone:a,address:m.address,note:(m.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:d,product_id:d[0].product_id,quantity:d[0].quantity,parent_order_id:String(_e),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${Re}`,rt,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),In(),Sa();const Pe=_e?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${_e}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof A=="function"?A(Pe,"success"):alert(Pe)}catch(l){console.error(l);const p=(l==null?void 0:l.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof A=="function"?A(p,"danger"):alert(p)}finally{ie(!1)}},ps=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const t=String(e),a=Ye.find(n=>String(n==null?void 0:n.id)===t);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Qt=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(t){return String(e!=null?e:"").toLowerCase()}},Ys=e=>{const a=Qt(e).trim().split(/\s+/).filter(Boolean),n=a.join(" ");return{contentTokens:a,cleanedQuery:n}},bs=React.useMemo(()=>(Array.isArray(Ye)?Ye:[]).map((e,t)=>{var u,l,p,C,J,z;const a=Qt((u=e==null?void 0:e.name)!=null?u:""),n=Qt((l=e==null?void 0:e.code)!=null?l:""),s=Qt((p=e==null?void 0:e.category)!=null?p:""),i=Qt((C=e==null?void 0:e.note)!=null?C:""),d=Qt((J=e==null?void 0:e.id)!=null?J:""),o=Qt((z=e==null?void 0:e.stt)!=null?z:""),v=`${a} ${n} ${s} ${i} ${d} ${o}`.trim();return{p:e,originalIndex:t,name:a,code:n,category:s,note:i,haystackAll:v}}),[Ye]),Qs=(e,t,a)=>{var p,C,J,z,Me;const n=Array.isArray(t)?t:[],s=Qt(a).trim();if(!n.length&&!s)return 0;const i=(p=e==null?void 0:e.name)!=null?p:"",d=(C=e==null?void 0:e.code)!=null?C:"",o=(J=e==null?void 0:e.category)!=null?J:"",v=(z=e==null?void 0:e.note)!=null?z:"";if(!((Me=e==null?void 0:e.haystackAll)!=null?Me:""))return 0;let l=0;s&&(i===s&&(l+=220),i.includes(s)&&(l+=140),i.startsWith(s)&&(l+=160),d&&d===s&&(l+=180),d&&d.includes(s)&&(l+=90));for(const _e of n){if(!_e)continue;const rt=new RegExp(`(?:^|\\s)${_e.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);i.includes(_e)&&(l+=35),rt.test(i)&&(l+=25),d&&d.includes(_e)&&(l+=20),d&&rt.test(d)&&(l+=10),o&&o.includes(_e)&&(l+=12),v&&v.includes(_e)&&(l+=6)}return l>0&&i&&(l+=Math.max(0,10-Math.min(10,Math.floor(i.length/10)))),l},jn=(e,t)=>{const a=String(e||""),n=String(t||"");if(a===n)return 0;if(!a)return n.length;if(!n)return a.length;const s=a.length,i=n.length;if(i>s)return jn(n,a);let d=new Array(i+1),o=new Array(i+1);for(let v=0;v<=i;v++)d[v]=v;for(let v=1;v<=s;v++){o[0]=v;const u=a.charCodeAt(v-1);for(let p=1;p<=i;p++){const C=u===n.charCodeAt(p-1)?0:1;o[p]=Math.min(d[p]+1,o[p-1]+1,d[p-1]+C)}const l=d;d=o,o=l}return d[i]},Zs=(e,t)=>{const a=String(e||"").trim(),n=String(t||"");if(!a||!n)return!1;if(n.includes(a))return!0;const s=n.split(/\s+/).filter(Boolean);if(!s.length)return!1;const i=a.length<=4?1:2;for(const d of s)if(!(Math.abs(d.length-a.length)>i)&&jn(a,d)<=i)return!0;return!1},bn=e=>{const t=Qt(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return t?t.split(" ").filter(Boolean):[]},ei=(e,t)=>{const a=Array.isArray(t)?t:[];if(!a.length)return 0;const n=bn((e==null?void 0:e.name)||""),s=bn((e==null?void 0:e.code)||""),i=bn((e==null?void 0:e.category)||""),d=bn((e==null?void 0:e.note)||""),o=(u,l,p)=>{const C=String(u||"").trim();if(!C||!l.length)return 0;const J=C.length<=4?1:2;let z=1/0,Me=-1;for(let Pe=0;Pe<l.length;Pe++){const Ft=l[Pe];if(!Ft||Math.abs(Ft.length-C.length)>J)continue;const Ze=jn(C,Ft);if(Ze<z&&(z=Ze,Me=Pe,Ze===0))break}if(z===1/0||z>J)return 0;let rt=Math.round(p*(z===0?1:z===1?.65:.45));return Me===0?rt+=Math.round(p*.25):Me===1&&(rt+=Math.round(p*.12)),rt};let v=0;for(const u of a){if(!u)continue;const l=o(u,n,180),p=o(u,s,120),C=o(u,i,60),J=o(u,d,30);v+=Math.max(l,p,C,J)}if(v>0){const u=((e==null?void 0:e.name)||"").length;v+=Math.max(0,60-Math.min(60,Math.floor(u/2)))}return v},On=React.useRef(new Map);React.useEffect(()=>{On.current=new Map},[Ye]);const fs=e=>{var u,l;const t=String(fe[e]||"").trim();if(!t)return Ye;const{contentTokens:a,cleanedQuery:n}=Ys(t);if(a.length===0)return Ye;const s=Qt(t).trim(),i=On.current.get(s);if(i)return i;const d=[];for(const p of bs){const C=p.haystackAll;C&&a.some(J=>C.includes(J))&&d.push(p)}let o=d;if(o.length<8&&a.length>0){const p=[],C=new Set(o.map(J=>{var z,Me;return String((Me=(z=J.p)==null?void 0:z.id)!=null?Me:"")+":"+String(J.originalIndex)}));for(const J of bs){const z=String((l=(u=J.p)==null?void 0:u.id)!=null?l:"")+":"+String(J.originalIndex);if(C.has(z))continue;const Me=J.haystackAll;Me&&a.some(_e=>Zs(_e,Me))&&(p.push(J),C.add(z))}p.length&&(o=o.concat(p))}const v=o.map(p=>({entry:p,score:Qs(p,a,n)})).map(p=>{if(p.score>0)return p;const C=ei(p.entry,a);return C>0?{...p,score:C}:p}).filter(p=>p.score>0).sort((p,C)=>C.score!==p.score?C.score-p.score:p.entry.originalIndex-C.entry.originalIndex).slice(0,40).map(p=>p.entry.p);return On.current.set(s,v),v},Kt=e=>{if(!e)return null;const t=String(e);return Ye.find(a=>String(a==null?void 0:a.id)===t)||null},va=e=>{if(e==null||e==="")return[];let t=e;if(typeof t=="string"){const a=t.trim();if(!a)return[];try{t=JSON.parse(a)}catch(n){return[]}}return Array.isArray(t)?t.map((a,n)=>{var d;if(!a||typeof a!="object")return null;const s=String((d=a.name)!=null?d:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,i=(Array.isArray(a.options)?a.options:[]).map(o=>{var Me,_e,rt,Pe,Ft,Ze,Zt;if(!o||typeof o!="object")return null;const v=String((Me=o.label)!=null?Me:"").trim();if(!v)return null;const u=(Ft=(Pe=(rt=(_e=o.price)!=null?_e:o.priceValue)!=null?rt:o.unit_price)!=null?Pe:o.unitPrice)!=null?Ft:null,l=u==null||u===""?NaN:typeof u=="number"?u:typeof u=="string"?ts(u):Number(u),p=Number.isFinite(l)?Math.trunc(l):null,C=(Zt=(Ze=o.price_delta)!=null?Ze:o.priceDelta)!=null?Zt:null,J=Number(C),z=Number.isFinite(J)?Math.trunc(J):0;return{label:v,price:p,price_delta:z}}).filter(Boolean);return{name:s,options:i}}).filter(Boolean):[]},mi=e=>{const t=Kt(e);return va(t==null?void 0:t.variants)},fn=e=>{if(!e||typeof e!="object")return"";const t=[];for(const[a,n]of Object.entries(e)){const s=String(a||"").trim(),i=String(n||"").trim();!s||!i||t.push(`${s}: ${i}`)}return t.join(", ")},Ea=(e,t)=>{const a=ts(e==null?void 0:e.price),n=va(e==null?void 0:e.variants);if(!n.length||!t||typeof t!="object")return a;let s=a,i=!1;for(const d of n){const o=String((d==null?void 0:d.name)||"").trim(),v=String((t==null?void 0:t[o])||"").trim();if(!o||!v)continue;const u=(Array.isArray(d.options)?d.options:[]).find(z=>String((z==null?void 0:z.label)||"").trim()===v);if(!u)continue;const l=u==null?void 0:u.price,p=l==null||l===""?NaN:Number(l);if(Number.isFinite(p)){s=Math.max(0,Math.trunc(p)),i=!0;continue}const C=u==null?void 0:u.price_delta,J=C==null||C===""?NaN:Number(C);Number.isFinite(J)&&(s+=Math.trunc(J))}return s},Ln=e=>window.KTM.orders.getOrderItems(e),hs=e=>window.KTM.orders.getOrderTotalQty(e),Pa=e=>window.KTM.orders.getOrderProductSummary(e,Kt),hn=e=>window.KTM.orders.getOrderItemRows(e,Kt),Ga=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Ca=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),ti=e=>{const t=Ln(e),a=hn(e),n=Ua(t),s=Wa(t),i=s.fee,d=Ga(e),o=n+i+d,v=l=>{const p=Number(l)||0;return p>0?`+${Ge(p)}`:Ge(p)},u=[];if(e!=null&&e.customer_name&&u.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&u.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&u.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&u.push(`GHI CH\xDA: ${(e.note||"").trim()}`),u.push(""),u.push("S\u1EA2N PH\u1EA8M:"),a.length)for(const l of a)u.push(`- ${l.name} (SL: ${l.qty})`);else{const l=Pa(e);l&&l!=="\u2014"&&u.push(`- ${l}`)}u.push(""),u.push(`T\u1EA0M T\xCDNH: ${Ge(n)}`),s.found&&i!==0&&u.push(`SHIP: ${Ge(i)}`);{const l=window.KTM.orders.getOrderAdjustmentItems(e),p=(Array.isArray(l)?l:[]).map(z=>{var Me;return{amount:Number((Me=z==null?void 0:z.amount)!=null?Me:0)||0,note:String((z==null?void 0:z.note)||"").trim()}}).filter(z=>z.amount!==0||!!z.note),C=Ca(e);if(d!==0||p.length>0||!!C)if(p.length===1){const z=p[0];u.push(`\u0110I\u1EC0U CH\u1EC8NH: ${v(d)}${z.note?` \u2014 ${z.note}`:""}`)}else{u.push(`\u0110I\u1EC0U CH\u1EC8NH: ${v(d)}${!p.length&&C?` \u2014 ${C}`:""}`);for(const z of p)u.push(`- ${v(z.amount)}${z.note?`: ${z.note}`:""}`)}}return u.push(`T\u1ED4NG: ${Ge(o)}`),u.filter(Boolean).join(`
`)},gn=async e=>{try{const t=await on(e),a=ti(t);await window.KTM.clipboard.writeText(a),typeof A=="function"?A("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(t){console.error(t),typeof A=="function"?A("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Wa=e=>window.KTM.orders.getOrderShipInfo(e,Kt),Ua=e=>window.KTM.orders.getItemsSubtotal(e,Kt),Dn=e=>{try{const t=e instanceof Date?e:new Date(e);if(!t||Number.isNaN(t.getTime()))return"";const a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${a}-${n}`}catch(t){return""}},Rn=()=>b?String(b):Dn(new Date),gs=e=>{const t=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=et((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),s=Cn(e).amount,d=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(o=>{var v;return{product_id:String((o==null?void 0:o.product_id)||"").trim(),quantity:Number((v=o==null?void 0:o.quantity)!=null?v:0),variant:String((o==null?void 0:o.variant)||"").trim()}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0).sort((o,v)=>o.product_id<v.product_id?-1:o.product_id>v.product_id?1:o.variant<v.variant?-1:o.variant>v.variant?1:o.quantity-v.quantity);return JSON.stringify({name:t,phone:a,address:n,items:d,adj:s})},At=React.useMemo(()=>{const e=et((m==null?void 0:m.phone)||"");if(!e)return{count:0,orders:[],monthKey:Rn()};const t=Rn(),n=(Array.isArray(pa)?pa:[]).filter(s=>{if(!s||Re&&String(s.id)===String(Re)||et(s.phone||"")!==e)return!1;const i=Dn(s.created_at);return i&&i===t}).sort((s,i)=>{const d=new Date(s.created_at).getTime(),o=new Date(i.created_at).getTime();return(Number.isFinite(o)?o:0)-(Number.isFinite(d)?d:0)});return{count:n.length,orders:n,monthKey:t}},[pa,m==null?void 0:m.phone,b,Re]),ai=e=>{var o;const t=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=et((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),s=as((o=e==null?void 0:e.adjustment_amount)!=null?o:0),i=Ln(e),d=(Array.isArray(i)?i:[]).map(v=>{var u;return{product_id:String((v==null?void 0:v.product_id)||"").trim(),quantity:Number((u=v==null?void 0:v.quantity)!=null?u:0),variant:String((v==null?void 0:v.variant)||"").trim()}}).filter(v=>v.product_id&&Number.isFinite(v.quantity)&&v.quantity>0).sort((v,u)=>v.product_id<u.product_id?-1:v.product_id>u.product_id?1:v.variant<u.variant?-1:v.variant>u.variant?1:v.quantity-u.quantity);return JSON.stringify({name:t,phone:a,address:n,items:d,adj:s})},vs=React.useMemo(()=>{if(Re)return"";const e=et((m==null?void 0:m.phone)||"");if(!e)return"";const t=Rn(),a=gs(m),n=Array.isArray(pa)?pa:[];for(const s of n){if(!s||Re&&String(s.id)===String(Re)||et(s.phone||"")!==e)continue;const i=Dn(s.created_at);if(!i||i!==t)continue;const d=ai(s);if(d&&d===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${t}${s!=null&&s.id?` (#${s.id})`:""}`}return""},[pa,m,b,Re]),ys=e=>{var Ft;const t=[],a=[],n=String((e==null?void 0:e.customer_name)||"").trim(),s=et((e==null?void 0:e.phone)||""),i=String((e==null?void 0:e.address)||"").trim();n||t.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),s||t.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),s&&!La(s)&&t.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),i||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const o=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ze=>Ze&&Ze.product_id);o.length===0&&t.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),o.some(Ze=>{var _a;const Zt=Number((_a=Ze==null?void 0:Ze.quantity)!=null?_a:0);return!Number.isFinite(Zt)||Zt<=0})&&t.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const u=new Set;let l=!1;for(const Ze of o){const Zt=String(Ze.product_id||"").trim(),_a=String((Ze==null?void 0:Ze.variant)||"").trim();if(!Zt)continue;const qe=`${Zt}||${_a}`;if(u.has(qe)){l=!0;break}u.add(qe)}l&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const p=Ua(o),C=Wa(o),J=C!=null&&C.found?Number((Ft=C==null?void 0:C.fee)!=null?Ft:0):0,z=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],Me=ja(z),_e=Oa(Me),rt=Me.some(Ze=>(Number(Ze==null?void 0:Ze.amount)||0)!==0&&!String((Ze==null?void 0:Ze.note)||"").trim());C!=null&&C.found&&(J>=2e5||p>0&&J>p*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(J)}`),rt&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Pe=Math.abs(_e);return(Pe>=5e5||p>0&&Pe>p*.5)&&_e!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(_e)}`),{errors:t,warnings:a,canSubmit:t.length===0}},ui=React.useMemo(()=>ys(m),[m,Ye]),Fe=React.useMemo(()=>{var _a;const e=String((m==null?void 0:m.customer_name)||"").trim(),t=et((m==null?void 0:m.phone)||""),a=String((m==null?void 0:m.address)||"").trim(),n=Array.isArray(m==null?void 0:m.items)?m.items:[],s=new Map;for(const qe of n){const Ka=String((qe==null?void 0:qe.product_id)||"").trim(),yn=String((qe==null?void 0:qe.variant)||"").trim();if(!Ka)continue;const Nn=`${Ka}||${yn}`;s.set(Nn,(s.get(Nn)||0)+1)}const i=n.map(qe=>{var Ns;const Ka=String((qe==null?void 0:qe.product_id)||"").trim(),yn=Number((Ns=qe==null?void 0:qe.quantity)!=null?Ns:0),Nn=Ka?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",ri=Number.isFinite(yn)&&yn>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",oi=String((qe==null?void 0:qe.variant)||"").trim(),li=`${Ka}||${oi}`,ci=Ka&&(s.get(li)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Nn,qtyError:ri,dupWarn:ci}}),d=n.filter(qe=>qe&&qe.product_id),o=Ua(d),v=Wa(d),u=v!=null&&v.found?Number((_a=v==null?void 0:v.fee)!=null?_a:0):0,l=Array.isArray(m==null?void 0:m.adjustment_items)?m.adjustment_items:[],p=ja(l),C=Oa(p),J=p.some(qe=>(Number(qe==null?void 0:qe.amount)||0)!==0&&!String((qe==null?void 0:qe.note)||"").trim()),z=Math.abs(C),Me=J?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",_e=C!==0&&(z>=5e5||o>0&&z>o*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(C)}`:"",rt=v!=null&&v.found&&(u>=2e5||o>0&&u>o*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(u)}`:"",Pe=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Ft=t?La(t)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ze=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Zt=!Pe&&!Ft&&i.every(qe=>!qe.productError&&!qe.qtyError);return{nameError:Pe,phoneError:Ft,addressWarn:Ze,items:i,shipAbnormalWarn:rt,adjustmentNoteWarn:Me,adjustmentAbnormalWarn:_e,canSubmit:Zt}},[m,Ye]),vn=async e=>{var o,v,u;const t=(e==null?void 0:e.mode)||"close",a=(e==null?void 0:e.origin)||"modal",n=ys(m);if(!n.canSubmit){const l=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof A=="function"?A(l,"danger"):alert(l);return}if(!Re&&vs){const l=`${vs}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(l)){(At==null?void 0:At.count)>0&&Lt(!0),setTimeout(()=>{var J;const C=document.getElementById("order-phone-input");C&&typeof C.scrollIntoView=="function"&&(C.scrollIntoView({block:"center",behavior:"smooth"}),(J=C.focus)==null||J.call(C))},0);return}}const s=et(m.phone),d=(Array.isArray(m.items)?m.items:[]).map(l=>{var p,C;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((p=l==null?void 0:l.quantity)!=null?p:1),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(C=l==null?void 0:l.variant_json)!=null?C:null,unit_price:(()=>{const J=l==null?void 0:l.unit_price,z=J===""||J==null?NaN:Number(J);if(Number.isFinite(z))return Math.max(0,Math.trunc(z));const Me=Kt(l==null?void 0:l.product_id),_e=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return Ea(Me,_e)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);f(!0);try{const l=Re,p=Re?`${API_BASE}/api/orders/${Re}`:`${API_BASE}/api/orders`,C=d[0],J=Array.isArray(m==null?void 0:m.adjustment_items)?m.adjustment_items:[],z=ja(J),Me=Oa(z),_e=An(z),rt={customer_name:m.customer_name,phone:s,address:m.address,note:(m.note||"").trim(),adjustment_amount:Me,adjustment_note:_e,adjustment_items:z,product_id:C.product_id,quantity:C.quantity,status:m.status,items:d,...Re?{id:Re}:{}};if(Re)await window.KTM.api.putJSON(p,rt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Pe=await window.KTM.api.postJSON(p,rt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");ws.current={id:(u=(v=Pe==null?void 0:Pe.id)!=null?v:(o=Pe==null?void 0:Pe.order)==null?void 0:o.id)!=null?u:null,fingerprint:gs(m),ts:Date.now()}}if(zs(s,m.customer_name,m.address),a==="drawer"){if(ka(""),gt(null),we(!1),St(!1),Lt(!1),F([]),Sa(),l){Be(!0),pt("");try{const Pe=await _n(l);Pe&&typeof Pe=="object"&&Oe(Pe)}catch(Pe){pt((Pe==null?void 0:Pe.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Be(!1)}}}else t==="new"&&!Re?(ka(""),gt(null),we(!0)):(ka(""),gt(null),we(!1)),Sa()}catch(l){console.error(l),typeof A=="function"?A(l.message,"danger"):alert(l.message);return}finally{f(!1)}},Xa=e=>window.KTM.orders.getOrderTotalMoney(e,Kt),pi=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){W(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Sa(),un()}catch(t){console.error(t),typeof A=="function"?A(t.message,"danger"):alert(t.message)}finally{W(null)}}},ni=()=>{const e=Mt.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(i){}e.timer=null}const t=Array.isArray(e.events)?e.events.splice(0):[];if(!t.length||typeof A!="function")return;const a=new Map;for(const i of t){const d=String((i==null?void 0:i.orderId)||"").trim();d&&a.set(d,i)}const n=Array.from(a.values());if(!n.length)return;const s=i=>async()=>{try{for(const d of i)!(d!=null&&d.prevStatus)||!(d!=null&&d.orderId)||await Aa({id:d.orderId,status:d.nextStatus},d.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});A(i.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${i.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(d){A("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(n.length===1){const i=n[0],d=`${qt(i.prevStatus)} \u2192 ${qt(i.nextStatus)}`.trim();A(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${d}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:s([i])});return}A(`\u0110\xE3 c\u1EADp nh\u1EADt ${n.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:s(n)})},si=e=>{const t=Mt.current;t&&(Array.isArray(t.events)||(t.events=[]),t.events.push(e),!t.timer&&(t.timer=setTimeout(()=>ni(),320)))};useEffect(()=>()=>{try{const e=Mt.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Aa=async(e,t,a={})=>{var d;const n=await on(e),s=n==null?void 0:n.id;if(!s||!t)return;const i=It(n==null?void 0:n.status);H(s);try{const o=Ln(n),v=(Array.isArray(o)?o:[]).map(p=>{var C,J;return{product_id:(p==null?void 0:p.product_id)||"",quantity:Number((C=p==null?void 0:p.quantity)!=null?C:1),variant:String((p==null?void 0:p.variant)||"").trim()||null,variant_json:(J=p==null?void 0:p.variant_json)!=null?J:null,unit_price:(()=>{var _e;const z=(_e=p==null?void 0:p.unit_price)!=null?_e:p==null?void 0:p.unitPrice,Me=Number(z);return Number.isFinite(Me)?Math.max(0,Math.trunc(Me)):null})()}}).filter(p=>p.product_id&&Number.isFinite(p.quantity)&&p.quantity>0);if(!v.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const u=v[0],l={id:s,customer_name:(n==null?void 0:n.customer_name)||"",phone:et((n==null?void 0:n.phone)||""),address:(n==null?void 0:n.address)||"",note:((n==null?void 0:n.note)||"").trim(),adjustment_amount:Number((d=n==null?void 0:n.adjustment_amount)!=null?d:0)||0,adjustment_note:(n==null?void 0:n.adjustment_note)||"",product_id:u.product_id,quantity:u.quantity,status:t,items:v};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${s}`,l,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),E(p=>Array.isArray(p)?p.map(C=>(C==null?void 0:C.id)===s?{...C,status:t}:C):p),me(p=>Array.isArray(p)?p.map(C=>(C==null?void 0:C.id)===s?{...C,status:t}:C):p),tn(s,!1),Ks(s),a!=null&&a.silentToast)return;if(a!=null&&a.skipToastBatch){typeof A=="function"&&A("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}si({orderId:s,prevStatus:i,nextStatus:It(t)})}catch(o){if(console.error(o),(!navigator.onLine||(o==null?void 0:o.name)==="TypeError"||String((o==null?void 0:o.message)||"").toLowerCase().includes("failed to fetch"))&&!(a!=null&&a.fromSync)){E(u=>Array.isArray(u)?u.map(l=>(l==null?void 0:l.id)===s?{...l,status:t}:l):u),me(u=>Array.isArray(u)?u.map(l=>(l==null?void 0:l.id)===s?{...l,status:t}:l):u),Es(s,t,i),typeof A=="function"&&A("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof A=="function"?A(o.message,"danger"):alert(o.message)}finally{H(null)}};useEffect(()=>{const e=t=>{var n;const a=(n=t==null?void 0:t.detail)==null?void 0:n.key;if(a){if(a==="/"){setTimeout(()=>{var s,i;(i=(s=wn.current)==null?void 0:s.focus)==null||i.call(s)},0);return}if(a==="N"||a==="n"){pn();return}if((a==="j"||a==="J"||a==="k"||a==="K")&&Ve&&(ae!=null&&ae.id)){const s=Array.isArray(ct)?ct:[],i=s.findIndex(v=>String(v==null?void 0:v.id)===String(ae==null?void 0:ae.id));if(i<0)return;const o=s[i+(a==="j"||a==="J"?-1:1)];o&&Ja(o)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[ct,Ve,ae]);const ii=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:m.customer_name,onChange:e=>B({...m,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Fe.nameError&&React.createElement("div",{className:"form-text text-danger"},Fe.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:m.phone,onChange:e=>is(e.target.value),onBlur:rs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Fe.phoneError&&React.createElement("div",{className:"form-text text-danger"},Fe.phoneError),!Fe.phoneError&&At.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",At.count," \u0111\u01A1n trong th\xE1ng ",At.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Lt(e=>!e)},oa?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),oa&&At.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Lt(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},At.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Da(e.status)}`},qt(e.status))),React.createElement("div",{className:"text-muted small"},Ra(e.created_at)," \u2022 ",Ge(Xa(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Pa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&$n(e)}},"M\u1EDF")))),At.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(nt==null?void 0:nt.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(nt==null?void 0:nt.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(nt==null?void 0:nt.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(nt==null?void 0:nt.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:m.status,onChange:e=>B({...m,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:m.address,onChange:e=>B({...m,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Fe.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:m.note,onChange:e=>B({...m,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{B(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Yt(m.adjustment_items).map((e,t)=>React.createElement("div",{key:t,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:a=>{const n=a.target.value;B(s=>{const i=Yt(s.adjustment_items);return i[t]={...i[t],amount:n},{...s,adjustment_items:i}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:a=>{const n=a.target.value;B(s=>{const i=Yt(s.adjustment_items);return i[t]={...i[t],note:n},{...s,adjustment_items:i}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{B(a=>{const n=Yt(a.adjustment_items);return n.splice(t,1),{...a,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:g||Yt(m.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Fe.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.adjustmentAbnormalWarn),!!Fe.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{B(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Te(e=>[...Array.isArray(e)?e:[],""]),Re&&F(e=>[...Array.isArray(e)?e:[],!0])},disabled:g},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(m.items)?m.items:[{product_id:"",quantity:1}]).map((e,t)=>React.createElement("div",{key:t,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{mt.current[t]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Je(a=>a===t?null:t),setTimeout(()=>{const a=document.getElementById(`order-product-search-${t}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ps(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),De===t&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${t}`,className:"form-control",value:fe[t]||"",onChange:a=>{const n=a.target.value;Te(s=>{const i=Array.isArray(s)?[...s]:[];return i[t]=n,i})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=fs(t);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const s=String(n.id),i=va(n==null?void 0:n.variants),d={};for(const u of i){const l=String((u==null?void 0:u.name)||"").trim(),p=Array.isArray(u==null?void 0:u.options)?u.options[0]:null,C=String((p==null?void 0:p.label)||"").trim();l&&C&&(d[l]=C)}const o=fn(d),v=Ea(n,d);B(u=>{const l=Array.isArray(u.items)?[...u.items]:[];return l[t]={...l[t]||{quantity:1},product_id:s,variant_json:Object.keys(d).length?d:null,variant:o,unit_price:i.length?v:null},{...u,items:l}}),Je(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Ye.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var n;const a=(n=Fe.items)==null?void 0:n[t];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const a=Kt(e.product_id),n=va(a==null?void 0:a.variants);if(!n.length)return null;const s=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((i,d)=>{const o=String((i==null?void 0:i.name)||`Bi\u1EBFn th\u1EC3 ${d+1}`).trim(),v=String((s==null?void 0:s[o])||"").trim();return React.createElement("div",{key:o},React.createElement("label",{className:"form-label small text-muted mb-1"},o),React.createElement("select",{className:"form-select",value:v,onChange:u=>{const l=String(u.target.value||"").trim();B(p=>{const C=Array.isArray(p.items)?[...p.items]:[],J={...C[t]||{}},z=Kt(J.product_id),Me=va(z==null?void 0:z.variants),_e=J!=null&&J.variant_json&&typeof J.variant_json=="object"?{...J.variant_json}:{};l?_e[o]=l:delete _e[o];const rt=fn(_e),Pe=Ea(z,_e);return C[t]={...J,variant_json:Object.keys(_e).length?_e:null,variant:rt,unit_price:Pe},{...p,items:C}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",o," --"),(Array.isArray(i==null?void 0:i.options)?i.options:[]).map(u=>React.createElement("option",{key:u.label,value:u.label},u.label,Number.isFinite(Number(u==null?void 0:u.price))?` (${Ge(Number(u.price))})`:Number(u==null?void 0:u.price_delta)?` (${u.price_delta>0?"+":""}${u.price_delta})`:""))))}))})(),Re&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${t}`,checked:!!V[t],onChange:a=>{const n=!!a.target.checked;F(s=>{const i=Array.isArray(s)?[...s]:[],d=Array.isArray(m.items)?m.items.length:0;for(;i.length<d;)i.push(!0);return i[t]=n,i})},disabled:g||q}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${t}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const n=a.target.value;B(s=>{const i=Array.isArray(s.items)?[...s.items]:[];return i[t]={...i[t]||{product_id:""},quantity:n},{...s,items:i}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const a=(n=Fe.items)==null?void 0:n[t];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{B(a=>{const n=Array.isArray(a.items)?[...a.items]:[];return n.splice(t,1),{...a,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Te(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(t,1),n.length?n:[""]}),F(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(t,1),n}),Je(a=>a==null?a:a===t?null:a>t?a-1:a)},disabled:g||q||(Array.isArray(m.items)?m.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const t=(Array.isArray(m.items)?m.items:[]).filter(o=>o==null?void 0:o.product_id),a=Ua(t),n=Wa(t),s=Cn(m),i=s.amount,d=a+(n.found?n.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ge(a))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ge(n.fee))),!!Fe.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Fe.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ge(i))),(m.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(m.note||"").trim()),!!s.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",s.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ge(d)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:g||!!_||!!X}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},ga.all," \u0111\u01A1n"),Ce&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>Ce?ms(Ae):Sa(),disabled:ft,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>pn(),disabled:g||!!_},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${da&&!re&&!Ce?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),ia(!1),sa(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Js)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${ma&&!re&&!Ce?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),sa(!1),ia(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Gs)),React.createElement("button",{type:"button",className:`orders-chip ${!L&&!re&&!Ce?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),Y("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ga.all)),React.createElement("button",{type:"button",className:`orders-chip ${L==="draft"&&!re&&!Ce?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),Y("draft"),S("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ga.draft)),React.createElement("button",{type:"button",className:`orders-chip ${L==="pending"&&!re&&!Ce?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),Y("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ga.pending)),React.createElement("button",{type:"button",className:`orders-chip ${L==="processing"&&!re&&!Ce?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),Y("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ga.processing)),React.createElement("button",{type:"button",className:`orders-chip ${L==="done"&&!re&&!Ce?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),Y("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ga.done)),React.createElement("button",{type:"button",className:`orders-chip ${L==="paid"&&!re&&!Ce?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),Y("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ga.paid)),React.createElement("button",{type:"button",className:`orders-chip ${L==="canceled"&&!re&&!Ce?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),Y("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ga.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>la("thisMonth"),disabled:Ce},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>la("overduePending"),disabled:Ce},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",fa," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>la("draftExpiring"),disabled:Ce},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a"),(L||re||!b&&!Ce)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>la("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:wn,type:"text",className:"form-control",value:Ae,onChange:e=>oe(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(Ae||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>oe(""),disabled:ft},React.createElement("i",{className:"fas fa-times"})),ft&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:b,onChange:e=>S(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:re||Ce})),React.createElement("div",{className:"text-muted small ms-auto"},Ce?"Search b\u1ECF qua filter":re?"\u0110ang xem \u0111\u01A1n ch\u1EADm":L?`L\u1ECDc: ${qt(L)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${aa?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if(Ce){const e=String(Ae||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${ct.length} k\u1EBFt qu\u1EA3`}return re?`\u0110\u01A1n ch\u1EADm \u2022 ${ct.length} \u0111\u01A1n`:da?`\u01AFu ti\xEAn \u2022 ${ct.length} \u0111\u01A1n`:ma?`H\xF4m nay \u2022 ${ct.length} \u0111\u01A1n`:L?`L\u1ECDc: ${qt(L)} \u2022 ${ct.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${ct.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{oe(""),sa(!1),ia(!1),la("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},Ce?`${ct.length} k\u1EBFt qu\u1EA3`:L?`${mn.length}/${G.length} \u0111\u01A1n`:`${G.length}${le?"+":""} \u0111\u01A1n`)),Ce&&Ue&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Ue),dn.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,dn.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",fa," ng\xE0y.",ue&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ne(!0),Y("pending")}},"Xem ngay")),os.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,os.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",kn," ng\xE0y).",He&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ne(!1),Y("draft"),S(""),Sa()}},"Xem ngay")),(Ce?ft:he)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,t)=>React.createElement("div",{key:t,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,t)=>React.createElement("tr",{key:t},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(Ce?ct.length===0:G.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},Ce?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!Ce&&mn.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},cs.map(e=>{var t;return React.createElement("div",{key:e.id,className:`card mb-2 orders-mobile-card ${Gt!=null&&Gt[String(e.id)]?"order-recent-updated":""} ${(Ke==null?void 0:Ke.id)===String(e.id)?`swipe-preview swipe-${(Ke==null?void 0:Ke.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>Ja(e),onPointerDown:a=>{if(P||Rt||lt||a.button!=null&&a.button!==0)return;const n=String(e.id);K.current={active:!0,id:n,startX:a.clientX,startY:a.clientY,dx:0,dy:0,lock:null},Xe(s=>(s==null?void 0:s.id)===n?s:{id:n,dir:null});try{be.current&&clearTimeout(be.current)}catch(s){}dt.current=n,be.current=setTimeout(async()=>{var i,d,o,v;const s=dt.current;if(s)try{if((d=(i=it.current)==null?void 0:i.has)!=null&&d.call(i,s))return;const u=await _n(s);u&&typeof u=="object"&&((v=(o=it.current)==null?void 0:o.set)==null||v.call(o,s,u))}catch(u){}},150)},onPointerMove:a=>{const n=K.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id))return;const s=a.clientX-n.startX,i=a.clientY-n.startY;if(n.dx=s,n.dy=i,Math.abs(s)>14||Math.abs(i)>14){try{be.current&&clearTimeout(be.current)}catch(d){}be.current=null,dt.current=null}if(!n.lock){const d=Math.abs(s),o=Math.abs(i);(d>10||o>10)&&(n.lock=d>o*1.2?"x":"y")}if(n.lock!=="x"){Math.abs(i)>24&&Xe(d=>(d==null?void 0:d.id)===n.id?{id:n.id,dir:null}:d);return}s>72?Xe({id:n.id,dir:"right"}):s<-72?Xe({id:n.id,dir:"left"}):Xe({id:n.id,dir:null})},onPointerCancel:()=>{try{be.current&&clearTimeout(be.current)}catch(a){}be.current=null,dt.current=null,K.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null},Xe({id:null,dir:null})},onPointerUp:a=>{try{be.current&&clearTimeout(be.current)}catch(u){}be.current=null,dt.current=null;const n=K.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id)){Xe({id:null,dir:null});return}K.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null};const s=Number(n.dx)||0,i=Math.abs(s),d=n.lock==="x",o=It(e==null?void 0:e.status);if(Xe({id:null,dir:null}),!d||i<88)return;a.preventDefault(),a.stopPropagation();const v=s>0?"done":"processing";It(v)!==o&&Aa(e,v)},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),Ja(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:a=>Ps(a,e.phone),onPointerMove:an,onPointerUp:an,onPointerCancel:an,onPointerLeave:an,onClick:a=>{if(a.stopPropagation(),ze.current){ze.current=!1;return}Qn(e.phone)},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),a.stopPropagation(),Qn(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((t=e==null?void 0:e.split_seq)!=null?t:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const a=Xn(e);if(!a)return null;const n=ya.has(String(e.id)),s=a.length>84||Yn(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${n?"":"order-text-collapsed"}`},a),s&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:i=>{i.stopPropagation(),Gn(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const a=Yn(e);if(!a)return null;const n=ya.has(String(e.id)),s=Xn(e).length,i=s>84||a.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${n?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",a),i&&s<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:d=>{d.stopPropagation(),Gn(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${Tt.has(String(e.id))?"active":""}`,onClick:a=>{a.stopPropagation(),js(e.id)},title:Tt.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":Tt.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:Tt.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(Ht!=null&&Ht[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${Da(e.status)} order-status-badge-btn`,onPointerDown:a=>{a.stopPropagation(),xe.current=!1;try{se.current&&clearTimeout(se.current)}catch(n){}se.current=setTimeout(()=>{xe.current=!0,Jn(e,a.currentTarget)},420)},onPointerUp:a=>{a.stopPropagation();try{se.current&&clearTimeout(se.current)}catch(n){}se.current=null},onPointerCancel:a=>{a.stopPropagation();try{se.current&&clearTimeout(se.current)}catch(n){}se.current=null},onClick:a=>{if(a.stopPropagation(),xe.current){xe.current=!1;return}lt&&String(k==null?void 0:k.id)===String(e.id)?wa():Jn(e,a.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},qt(e.status)),nn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${fa} ng\xE0y`},"\u26A0 Ch\u1EADm ",qa(e),"d"),rn(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Qa} ng\xE0y`},"\u23F3 C\xF2n ",sn(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=hn(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((n,s)=>React.createElement("div",{key:s,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},s+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${Ge(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Pa(e))})()),(Ga(e)!==0||Ca(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ge(Ga(e))),Ca(e)?React.createElement("span",{className:"text-muted"}," ","(",Ca(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Ge(Xa(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",Ra(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),gn(e)},disabled:g||!!_||X===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:a=>{a.stopPropagation(),zn(e)},disabled:g||!!_||X===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c"))))}),React.createElement("div",{ref:ke,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(ct)&&cs.length<ct.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),lt&&k&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>wa()},React.createElement("div",{className:`orders-status-popover ${(I==null?void 0:I.placement)||""}`,style:{left:I.left,top:I.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},k.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>wa(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},Za.map(e=>{const t=It(k.status)===It(e.value),a=g||!!_||X===k.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${t?"active":""}`,onClick:()=>{t||(Aa(k,e.value),wa())},disabled:a},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{zn(k),wa()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),P&&at&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>xa()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},at.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},at.phone||""),React.createElement("span",{className:`badge ${Da(at.status)}`},qt(at.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>xa(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{gn(at),xa()},disabled:g||!!_||X===at.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(at.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(at.phone||"").trim()}`,onClick:()=>xa()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{Ja(at),xa()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},Za.map(e=>{const t=It(at.status)===It(e.value),a=g||!!_||X===at.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${t?"active":""}`,onClick:()=>{t||(Aa(at,e.value),xa())},disabled:a},e.label)})))),Rt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>en()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>en(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>la("thisMonth"),disabled:Ce},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>la("overduePending"),disabled:Ce},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>la("draftExpiring"),disabled:Ce},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!L&&!re?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),Y("")}},"T\u1EA5t c\u1EA3"),Za.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${L===e.value&&!re?"active":""}`,onClick:()=>{Ce&&oe(""),ne(!1),Y(e.value),e.value==="draft"&&S("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:b,onChange:e=>S(e.target.value),disabled:re||Ce}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:re,onChange:e=>{Ce&&oe("");const t=!!e.target.checked;ne(t),t&&(S(""),Y("pending"))},disabled:Ce}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",fa," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>la("all"),disabled:Ce},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>en()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${Et?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){U.current=!1;try{T.current&&clearTimeout(T.current)}catch(t){}T.current=setTimeout(()=>{U.current=!0,Wn(Ae)},460)}},onPointerUp:()=>{try{T.current&&clearTimeout(T.current)}catch(e){}T.current=null},onPointerCancel:()=>{try{T.current&&clearTimeout(T.current)}catch(e){}T.current=null},onClick:()=>{if(U.current){U.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,t;return(t=(e=wn.current)==null?void 0:e.focus)==null?void 0:t.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>pn(),disabled:g||!!_,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Is(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),Na&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{Ba(ra),Bt()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const t=e.touches&&e.touches[0];t&&(te.current={active:!0,startY:t.clientY,startX:t.clientX,fired:!1})},onTouchMove:e=>{const t=te.current;if(!(t!=null&&t.active)||t.fired)return;const a=e.touches&&e.touches[0];if(!a)return;const n=a.clientY-t.startY,s=a.clientX-t.startX;Math.abs(s)>24||n>90&&(t.fired=!0,Ba(ra),Bt())},onTouchEnd:()=>{te.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Ba(ra),Bt()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:h,type:"text",className:"form-control",value:ra,onChange:e=>{const t=e.target.value;Ot(t),oe(t)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(Ba(ra),Bt())}}),!!String(ra||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Ot(""),oe("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(Vt)&&Vt.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},Vt.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{Ot(e),oe(e),Ba(e),Bt()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${da?"active":""}`,onClick:()=>{oe(""),Ot(""),ne(!1),ia(!1),sa(e=>!e),Bt()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${ma?"active":""}`,onClick:()=>{oe(""),Ot(""),ne(!1),sa(!1),ia(e=>!e),Bt()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${re?"active":""}`,onClick:()=>{oe(""),Ot(""),ne(e=>!e),re||(S(""),Y("pending")),Bt()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!L&&!re&&!da&&!ma?"active":""}`,onClick:()=>{oe(""),Ot(""),ne(!1),sa(!1),ia(!1),Y(""),Bt()}},"T\u1EA5t c\u1EA3"),Za.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${L===e.value&&!re?"active":""}`,onClick:()=>{oe(""),Ot(""),ne(!1),sa(!1),ia(!1),Y(e.value),e.value==="draft"&&S(""),Bt()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,ct.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>Ja(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const t=hn(e);return t.length?React.createElement("div",{className:"d-grid gap-1"},t.map((a,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Ge(a.unitPrice))))):Pa(e)})()),React.createElement("td",null,hs(e)),React.createElement("td",{className:"fw-semibold"},Ge(Xa(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${Da(e.status)}`},qt(e.status)),nn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${fa} ng\xE0y`},"\u26A0 Ch\u1EADm ",qa(e),"d"),rn(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Qa} ng\xE0y`},"\u23F3 C\xF2n ",sn(e),"d"))),React.createElement("td",null,Ra(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),gn(e)},disabled:g||!!_||X===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:t=>t.stopPropagation(),onChange:t=>{t.stopPropagation();const a=String(t.target.value||"").trim();t.target.value="",a&&Aa(e,a)},disabled:g||!!_||X===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!Ce&&le&&!re&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Us,disabled:he||ee},ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:Ve,title:(()=>{const e=ae,t=e!=null&&e.id?`#${e.id}`:"",a=e!=null&&e.status?`\u2022 ${qt(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${t} ${a}`.trim()})(),subtitle:(()=>{const e=ae,t=String((e==null?void 0:e.customer_name)||"").trim(),a=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?Ra(e.created_at):"";return[t||a||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:Xs,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},jt?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{St(!1),gt(null),ka(""),Lt(!1),F([])},disabled:g||q},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!Re&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:us,disabled:g||q,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>vn({mode:"close",origin:"drawer"}),disabled:g||q||!Fe.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},g?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ae&&gn(ae),disabled:!ae||ut||g||!!_},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>ae&&$n(ae),disabled:!ae||ut||g||!!_},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const t=String(e.target.value||"").trim();e.target.value="",t&&ae&&Aa(ae,t)},disabled:!ae||ut||g||!!_||X===(ae==null?void 0:ae.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},jt?React.createElement("form",{onSubmit:e=>{e.preventDefault(),vn({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),ii())):ut?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):yt?React.createElement("div",{className:"alert alert-danger",role:"alert"},yt):ae?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${Da(ae.status)}`},qt(ae.status)),nn(ae)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${fa} ng\xE0y`},"\u26A0 Ch\u1EADm ",qa(ae),"d"),rn(ae)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Qa} ng\xE0y`},"\u23F3 C\xF2n ",sn(ae),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},Ge(Xa(ae))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},hs(ae)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},Ra(ae.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},ae.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},ae.phone||"\u2014"),!!String(ae.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(ae.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},ae.address||"\u2014")),((ae==null?void 0:ae.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(ae.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=hn(ae);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((t,a)=>React.createElement("div",{key:a,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},a+1,"."),t.name),t.variant?React.createElement("div",{className:"text-muted small"},t.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",t.qty,Number(t.unitPrice)>0?` \u2022 ${Ge(t.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Pa(ae)||"\u2014")})(),(Ga(ae)!==0||Ca(ae))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ge(Ga(ae))),Ca(ae)?React.createElement("span",{className:"text-muted"}," ","(",Ca(ae),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Ne&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),Re?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:In})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),vn({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Pn},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:m.customer_name,onChange:e=>B({...m,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Fe.nameError&&React.createElement("div",{className:"form-text text-danger"},Fe.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:m.phone,onChange:e=>is(e.target.value),onBlur:rs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Fe.phoneError&&React.createElement("div",{className:"form-text text-danger"},Fe.phoneError),!Fe.phoneError&&At.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",At.count," \u0111\u01A1n trong th\xE1ng ",At.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Lt(e=>!e)},oa?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),oa&&At.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Lt(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},At.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Da(e.status)}`},qt(e.status))),React.createElement("div",{className:"text-muted small"},Ra(e.created_at)," \u2022 ",Ge(Xa(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Pa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&$n(e)}},"M\u1EDF")))),At.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(nt==null?void 0:nt.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(nt==null?void 0:nt.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(nt==null?void 0:nt.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(nt==null?void 0:nt.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:m.status,onChange:e=>B({...m,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:m.address,onChange:e=>B({...m,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Fe.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:m.note,onChange:e=>B({...m,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{B(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Yt(m.adjustment_items).map((e,t)=>React.createElement("div",{key:t,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:a=>{const n=a.target.value;B(s=>{const i=Yt(s.adjustment_items);return i[t]={...i[t],amount:n},{...s,adjustment_items:i}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:a=>{const n=a.target.value;B(s=>{const i=Yt(s.adjustment_items);return i[t]={...i[t],note:n},{...s,adjustment_items:i}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{B(a=>{const n=Yt(a.adjustment_items);return n.splice(t,1),{...a,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:g||Yt(m.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Fe.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.adjustmentAbnormalWarn),!!Fe.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{B(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Te(e=>[...Array.isArray(e)?e:[],""]),Re&&F(e=>[...Array.isArray(e)?e:[],!0])},disabled:g},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(m.items)?m.items:[{product_id:"",quantity:1}]).map((e,t)=>React.createElement("div",{key:t,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{mt.current[t]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Je(a=>a===t?null:t),setTimeout(()=>{const a=document.getElementById(`order-product-search-${t}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ps(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),De===t&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${t}`,className:"form-control",value:fe[t]||"",onChange:a=>{const n=a.target.value;Te(s=>{const i=Array.isArray(s)?[...s]:[];return i[t]=n,i})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=fs(t);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const s=String(n.id),i=va(n==null?void 0:n.variants),d={};for(const u of i){const l=String((u==null?void 0:u.name)||"").trim(),p=Array.isArray(u==null?void 0:u.options)?u.options[0]:null,C=String((p==null?void 0:p.label)||"").trim();l&&C&&(d[l]=C)}const o=fn(d),v=Ea(n,d);B(u=>{const l=Array.isArray(u.items)?[...u.items]:[];return l[t]={...l[t]||{quantity:1},product_id:s,variant_json:Object.keys(d).length?d:null,variant:o,unit_price:i.length?v:null},{...u,items:l}}),Je(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Ye.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var n;const a=(n=Fe.items)==null?void 0:n[t];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const a=Kt(e.product_id),n=va(a==null?void 0:a.variants);if(!n.length)return null;const s=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((i,d)=>{const o=String((i==null?void 0:i.name)||`Bi\u1EBFn th\u1EC3 ${d+1}`).trim(),v=String((s==null?void 0:s[o])||"").trim();return React.createElement("div",{key:o},React.createElement("label",{className:"form-label small text-muted mb-1"},o),React.createElement("select",{className:"form-select",value:v,onChange:u=>{const l=String(u.target.value||"").trim();B(p=>{const C=Array.isArray(p.items)?[...p.items]:[],J={...C[t]||{}},z=Kt(J.product_id),Me=va(z==null?void 0:z.variants),_e=J!=null&&J.variant_json&&typeof J.variant_json=="object"?{...J.variant_json}:{};l?_e[o]=l:delete _e[o];const rt=fn(_e),Pe=Ea(z,_e);return C[t]={...J,variant_json:Object.keys(_e).length?_e:null,variant:rt,unit_price:Pe},{...p,items:C}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",o," --"),(Array.isArray(i==null?void 0:i.options)?i.options:[]).map(u=>React.createElement("option",{key:u.label,value:u.label},u.label,Number.isFinite(Number(u==null?void 0:u.price))?` (${Ge(Number(u.price))})`:Number(u==null?void 0:u.price_delta)?` (${u.price_delta>0?"+":""}${u.price_delta})`:""))))}))})(),Re&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${t}`,checked:!!V[t],onChange:a=>{const n=!!a.target.checked;F(s=>{const i=Array.isArray(s)?[...s]:[],d=Array.isArray(m.items)?m.items.length:0;for(;i.length<d;)i.push(!0);return i[t]=n,i})},disabled:g||q}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${t}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const n=a.target.value;B(s=>{const i=Array.isArray(s.items)?[...s.items]:[];return i[t]={...i[t]||{product_id:""},quantity:n},{...s,items:i}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const a=(n=Fe.items)==null?void 0:n[t];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{B(a=>{const n=Array.isArray(a.items)?[...a.items]:[];return n.splice(t,1),{...a,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Te(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(t,1),n.length?n:[""]}),F(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(t,1),n}),Je(a=>a==null?a:a===t?null:a>t?a-1:a)},disabled:g||q||(Array.isArray(m.items)?m.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const t=(Array.isArray(m.items)?m.items:[]).filter(o=>o==null?void 0:o.product_id),a=Ua(t),n=Wa(t),s=Cn(m),i=s.amount,d=a+(n.found?n.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ge(a))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ge(n.fee))),!!Fe.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Fe.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ge(i))),(m.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(m.note||"").trim()),!!s.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",s.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ge(d)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:In,disabled:g||q,style:{borderRadius:10}},"H\u1EE7y"),!!Re&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:us,disabled:g||q,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!Re&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>vn({mode:"new",origin:"modal"}),disabled:g||!Fe.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:g||q||!Fe.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},g?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

