const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:_,error:w}){const[j,Y]=useState(""),[Q,N]=useState(""),[P,se]=useState(!1),[oe,X]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),w&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),w),React.createElement("form",{onSubmit:async ye=>{ye.preventDefault(),se(!0),await _(j,Q),se(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:j,onChange:ye=>Y(ye.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:oe?"text":"password",className:"form-control",value:Q,onChange:ye=>N(ye.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>X(!oe)},React.createElement("i",{className:`fas fa-eye${oe?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:P},P?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:_,type:w,onClose:j}){return useEffect(()=>{const Y=setTimeout(j,3e3);return()=>clearTimeout(Y)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${w} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},_),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:j})))}function Loading({show:_}){return _?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:_,onMenuChange:w,onLogout:j,currentUser:Y}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(N=>React.createElement("a",{key:N.id,href:"#",className:`nav-link ${_===N.id?"active":""} ${N.disabled?"opacity-50":""} ${N.highlight?"text-warning":""}`,onClick:P=>{P.preventDefault(),N.disabled||w(N.id)}},React.createElement("i",{className:`fas ${N.icon}`})," ",N.label,N.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),N.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),j&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:j,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(_){const w=typeof _=="number"?_:parseFloat(String(_!=null?_:"").trim());return Number.isFinite(w)?Math.max(0,Math.min(100,w)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var _;try{const w=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!w)return{ship_percent:DEFAULT_SHIP_PERCENT};const j=JSON.parse(w);return{ship_percent:normalizeShipPercent((_=j==null?void 0:j.ship_percent)!=null?_:j==null?void 0:j.shipPercent)}}catch(w){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(_){var w;try{const j={ship_percent:normalizeShipPercent((w=_==null?void 0:_.ship_percent)!=null?w:_==null?void 0:_.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(j)),j}catch(j){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var w;const _=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((w=_==null?void 0:_.ship_percent)!=null?w:_==null?void 0:_.shipPercent)}}async function saveAdminSettingsToServer(_){var Y,Q,N;const w={ship_percent:normalizeShipPercent((Y=_==null?void 0:_.ship_percent)!=null?Y:_==null?void 0:_.shipPercent)},j=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,w,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((N=(Q=j==null?void 0:j.ship_percent)!=null?Q:j==null?void 0:j.shipPercent)!=null?N:w.ship_percent)}}function AlbumList({albums:_,onSelect:w,onCreate:j,onEdit:Y,onDelete:Q,loading:N,currentFolder:P,onBack:se,breadcrumb:oe}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},P&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:se},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),P?P.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:j},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),oe&&oe.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:X=>{X.preventDefault(),se("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),oe.map((X,me)=>React.createElement("li",{key:X.id,className:`breadcrumb-item ${me===oe.length-1?"active":""}`},me===oe.length-1?X.title:React.createElement("a",{href:"#",onClick:ye=>{ye.preventDefault(),se(X)},className:"text-warning"},X.title))))),N?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):_.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},P?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},_.map(X=>React.createElement("div",{key:X.uuid||X.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>w(X)},X.cover?React.createElement("img",{src:X.cover,className:"album-cover",alt:X.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},X.title),React.createElement("small",{className:"text-muted"},X.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),X.subfolderCount),X.subfolderCount>0&&X.count>0&&" \u2022 ",X.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),X.count),X.subfolderCount===0&&X.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:me=>{me.stopPropagation(),Y(X)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:me=>{me.stopPropagation(),Q(X)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:_,album:w,onClose:j,onSave:Y,parentId:Q}){const[N,P]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[se,oe]=useState(!1),[X,me]=useState(!1),ye=useRef(null);useEffect(()=>{P(w?{slug:w.id||"",title:w.title||"",description:w.description||"",cover_url:w.cover||"",parent_id:w.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:Q||null})},[w,_,Q]);const re=async ce=>{ce.preventDefault(),oe(!0),await Y(N),oe(!1)},de=ce=>ce.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),ue=async ce=>{const Ne=ce.type==="image/heic"||ce.type==="image/heif"||/\.heic$/i.test(ce.name);if(ce.size<=2097152&&!Ne)return ce;try{const pe=await createImageBitmap(ce),Te=document.createElement("canvas");let ke=pe.width,fe=pe.height;const xe=800;return(ke>xe||fe>xe)&&(ke>fe?(fe=Math.round(fe/ke*xe),ke=xe):(ke=Math.round(ke/fe*xe),fe=xe)),Te.width=ke,Te.height=fe,Te.getContext("2d").drawImage(pe,0,0,ke,fe),pe.close(),new Promise((Ye,Se)=>{Te.toBlob(Oe=>{Oe?Ye(new File([Oe],ce.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Se(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(pe){throw console.error("Compress cover error:",pe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},le=async ce=>{var pe;const ie=ce.target.files[0];if(!ie)return;if(!(ie.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ie.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}me(!0);try{const Te=await ue(ie),ke=await window.KTM.cloudinary.uploadImage({file:Te,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!ke.secure_url)throw console.error("Cloudinary error:",ke),new Error(((pe=ke.error)==null?void 0:pe.message)||"Upload failed");P(fe=>({...fe,cover_url:ke.secure_url}))}catch(Te){console.error("Cover upload error:",Te),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Te.message)}me(!1),ce.target.value=""};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:re},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:N.title,onChange:ce=>P({...N,title:ce.target.value,slug:N.slug||de(ce.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:N.slug,onChange:ce=>P({...N,slug:ce.target.value}),required:!0,disabled:!!w}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:N.description,onChange:ce=>P({...N,description:ce.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},N.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:N.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>P(ce=>({...ce,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:ye,type:"file",accept:"image/*",className:"d-none",onChange:le}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var ce;return(ce=ye.current)==null?void 0:ce.click()},disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:N.cover_url,onChange:ce=>P({...N,cover_url:ce.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:se||X},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:_,allAlbums:w,currentAlbumId:j,targetAlbum:Y,onSelect:Q,level:N=0}){const[P,se]=useState(!0),oe=_.uuid||_.id,X=oe===j,me=Y===oe,ye=w.filter(de=>de.parentId===oe),re=ye.length>0;return React.createElement("div",{style:{marginLeft:N*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${me?"bg-info text-white":X?"bg-light text-muted":"hover-bg"}`,style:{cursor:X?"not-allowed":"pointer",opacity:X?.5:1,transition:"background 0.2s"},onClick:()=>!X&&Q(oe)},re&&React.createElement("i",{className:`fas fa-chevron-${P?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:de=>{de.stopPropagation(),se(!P)}}),!re&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${me?"-open":""} me-2 ${me?"":"text-warning"}`}),React.createElement("span",{className:"small"},_.title),X&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),_.count>0&&!X&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},_.count)),P&&re&&React.createElement("div",null,ye.map(de=>React.createElement(FolderTreeItem,{key:de.uuid||de.id,folder:de,allAlbums:w,currentAlbumId:j,targetAlbum:Y,onSelect:Q,level:N+1}))))}function AlbumDetail({album:_,onBack:w,onRefresh:j,showToast:Y,onNavigateToFolder:Q,onEditSubfolder:N,parentAlbum:P}){const[se,oe]=useState([]),[X,me]=useState([]),[ye,re]=useState(!0),[de,ue]=useState(!1),[le,ce]=useState(""),[ie,Ne]=useState([]),[pe,Te]=useState([]),[ke,fe]=useState({}),[xe,$e]=useState(null),[Ye,Se]=useState(!1),[Oe,Je]=useState(""),[b,M]=useState(!1),s=useRef(null),u=useRef(null),[A,$]=useState(!1),[z,U]=useState([]),[r,E]=useState([]),[ge,Re]=useState(""),[l,f]=useState(!1),be=async(h,I=2)=>{const C=I*1024*1024,Ee=h.type==="image/heic"||h.type==="image/heif"||/\.heic$/i.test(h.name);if(h.size<=C&&!Ee)return h;try{const Fe=await createImageBitmap(h),Ge=document.createElement("canvas");let Ze=Fe.width,et=Fe.height;const tt=1200;return(Ze>tt||et>tt)&&(Ze>et?(et=Math.round(et/Ze*tt),Ze=tt):(Ze=Math.round(Ze/et*tt),et=tt)),Ge.width=Ze,Ge.height=et,Ge.getContext("2d").drawImage(Fe,0,0,Ze,et),Fe.close(),new Promise((Mt,ft)=>{Ge.toBlob(Be=>{Be?Mt(new File([Be],h.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ft(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Fe){throw console.error("Compress error:",Fe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{v(),J()},[_.id,_.uuid]);const v=async()=>{re(!0);try{const h=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${_.uuid||_.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");oe(h.images||[]);const I=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${_.uuid||_.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");me(Array.isArray(I)?I:[])}catch(h){console.error(h),Y("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}re(!1)},J=async()=>{try{const h=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");E(Array.isArray(h)?h:[])}catch(h){console.error("Error loading albums:",h)}},F=h=>{U(I=>I.includes(h)?I.filter(C=>C!==h):[...I,h])},Ae=async()=>{if(!ge||z.length===0){Y("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}f(!0);let h=0;for(const I of z)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${I}`,{album_id:ge},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),h++}catch(C){console.error("Move error:",C)}f(!1),$(!1),U([]),Re(""),h>0?(Y("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),v(),j()):Y("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Xe,De]=useState(!1),Pe=async()=>{if(z.length===0||!confirm(`X\xF3a ${z.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;De(!0);let h=0;for(const I of z)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${I}`,"L\u1ED7i x\xF3a \u1EA3nh"),h++}catch(C){console.error("Delete error:",C)}De(!1),U([]),h>0?(Y(`\u0110\xE3 x\xF3a ${h} \u1EA3nh!`,"success"),v(),j()):Y("X\xF3a th\u1EA5t b\u1EA1i","danger")},Ue=()=>{z.length===se.length?U([]):U(se.map(h=>h.id))},lt=async()=>{if(Oe.trim()){M(!0);try{const h=Oe.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:h+"-"+Date.now(),title:Oe,parent_id:_.uuid||_.id},"L\u1ED7i t\u1EA1o folder"),Y("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Je(""),Se(!1),v(),j()}catch(h){Y(h.message,"danger")}M(!1)}},At=async h=>{if(confirm(`X\xF3a folder "${h.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${h.uuid||h.id}`,"L\u1ED7i x\xF3a folder"),Y("\u0110\xE3 x\xF3a folder","success"),v(),j()}catch(I){Y("L\u1ED7i x\xF3a folder","danger")}},yt=h=>{const I=Array.from(h).filter(C=>C.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(C.name));Ne(C=>[...C,...I]),I.forEach(C=>{const Ee=new FileReader;Ee.onload=Fe=>{Te(Ge=>[...Ge,{file:C,preview:Fe.target.result}])},Ee.readAsDataURL(C)})},Rt=h=>{Ne(I=>I.filter((C,Ee)=>Ee!==h)),Te(I=>I.filter((C,Ee)=>Ee!==h))},Pt=async h=>{var C;const I=await window.KTM.cloudinary.uploadImage({file:h,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${_.id}`});if(!I.secure_url)throw console.error("Cloudinary error:",I),new Error(((C=I.error)==null?void 0:C.message)||"Upload failed");return I},Ot=async()=>{if(ie.length===0)return;ue(!0);let h=0;for(let I=0;I<ie.length;I++)try{ce(`\u0110ang x\u1EED l\xFD ${I+1}/${ie.length}...`);const C=await be(ie[I],2);ce(`\u0110ang upload ${I+1}/${ie.length}...`);const Ee=await Pt(C);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${_.id}`,{url:Ee.secure_url,caption:ke[I]||ie[I].name.replace(/\.[^/.]+$/,""),sort_order:se.length+I},"L\u1ED7i l\u01B0u \u1EA3nh"),h++}catch(C){console.error("Upload error:",C)}ue(!1),ce(""),Ne([]),Te([]),fe({}),h>0?(Y(`\u0110\xE3 upload ${h} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),v(),j()):Y("Upload th\u1EA5t b\u1EA1i","danger")},ve=async(h,I)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${h}`,"L\u1ED7i x\xF3a \u1EA3nh"),Y("\u0110\xE3 x\xF3a \u1EA3nh","success"),v(),j()}catch(C){Y("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Qe=h=>{var I;h.preventDefault(),(I=u.current)==null||I.classList.add("dragover")},rt=()=>{var h;(h=u.current)==null||h.classList.remove("dragover")},Ct=h=>{var I;h.preventDefault(),(I=u.current)==null||I.classList.remove("dragover"),yt(h.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:w},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},_.title),React.createElement("small",{className:"text-muted"},X.length>0&&React.createElement("span",null,X.length," folder \u2022 "),se.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Se(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),Ye&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Oe,onChange:h=>Je(h.target.value),onKeyPress:h=>h.key==="Enter"&&lt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:lt,disabled:b||!Oe.trim()},b?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Se(!1),Je("")}},"H\u1EE7y")))),X.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},X.map(h=>React.createElement("div",{key:h.uuid||h.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>Q&&Q(h)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},h.title),React.createElement("small",{className:"text-muted"},h.subfolderCount>0&&React.createElement("span",null,h.subfolderCount," folder"),h.subfolderCount>0&&h.count>0&&" \u2022 ",h.count>0&&React.createElement("span",null,h.count," \u1EA3nh"),h.subfolderCount===0&&h.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:I=>{I.stopPropagation(),N&&N(h)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:I=>{I.stopPropagation(),At(h)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:u,className:"upload-zone",onClick:()=>{var h;return(h=s.current)==null?void 0:h.click()},onDragOver:Qe,onDragLeave:rt,onDrop:Ct},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:s,type:"file",multiple:!0,accept:"image/*",onChange:h=>yt(h.target.files)})),pe.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},pe.map((h,I)=>React.createElement("div",{key:I,className:"upload-preview-item"},React.createElement("img",{src:h.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Rt(I)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Ot,disabled:de},de?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),le||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",ie.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",se.length,")"),se.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Ue},z.length===se.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),z.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},z.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>$(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Pe,disabled:Xe},Xe?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>U([])},React.createElement("i",{className:"fas fa-times"})))),ye?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):se.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},se.map((h,I)=>React.createElement("div",{key:I,className:`image-item ${z.includes(h.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>F(h.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:z.includes(h.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:z.includes(h.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},z.includes(h.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:h.src,alt:h.caption,style:{opacity:z.includes(h.id)?.7:1,border:z.includes(h.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:C=>{C.stopPropagation(),ve(h.id,I)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),h.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},h.caption)))))),A&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",z.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>$(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},r.filter(h=>!h.parentId).map(h=>React.createElement(FolderTreeItem,{key:h.uuid||h.id,folder:h,allAlbums:r,currentAlbumId:_.uuid||_.id,targetAlbum:ge,onSelect:Re})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>$(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:Ae,disabled:!ge||l},l?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),xe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>$e(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>$e(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:xe.src,alt:xe.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:h=>h.stopPropagation()}),xe.caption&&React.createElement("div",{className:"text-white text-center mt-2"},xe.caption)))))}function SearchCenter({showToast:_,onNavigate:w}){const[j,Y]=useState(""),[Q,N]=useState([]),[P,se]=useState([]),[oe,X]=useState([]),[me,ye]=useState("all"),[re,de]=useState(null),[ue,le]=useState("list"),[ce,ie]=useState(!0),[Ne,pe]=useState([]),[Te,ke]=useState([]),fe=useRef(null),[xe,$e]=useState(!0),[Ye,Se]=useState(!1),Oe=useRef(null),[Je,b]=useState(!1),[M,s]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[u,A]=useState(""),[$,z]=useState(!1),U=useRef(null),r=useRef(null),[E,ge]=useState(null),[Re,l]=useState(!1),[f,be]=useState(null),[v,J]=useState(!1),[F,Ae]=useState(!1),[Xe,De]=useState(null),[Pe,Ue]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),lt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],At=t=>{var g,D;t._type==="product"&&(be(t),Ue({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||"",commission_percent:(D=(g=t.commission_percent)!=null?g:t.commissionPercent)!=null?D:""}),l(!0))},yt=async()=>{if(f)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${f.id}`,Pe,"L\u1ED7i c\u1EADp nh\u1EADt"),_("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),l(!1),be(null),Qe()}catch(t){_(t.message,"danger")}},Rt=async t=>{const g=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${g} "${t.name}"?`))try{let D="";t._type==="product"?D=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?D=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(D=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(D,"L\u1ED7i x\xF3a"),_(`\u0110\xE3 x\xF3a ${g}`,"success"),Qe()}catch(D){_(D.message,"danger")}},Pt=async t=>{try{const g=Xe?`${API_BASE}/api/products?id=${Xe.id}`:`${API_BASE}/api/products`;Xe?await window.KTM.api.putJSON(g,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(g,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),_(Xe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Ae(!1),De(null),Qe()}catch(g){_(g.message,"danger")}},Ot="ktm_admin_data_cache_v1",ve=1e3*60*10,Qe=async()=>{let t=null,g=!1;const D=window.KTM.cache.read(Ot,{ttlMs:ve,validate:Array.isArray});D.hit?(t=D.value,console.log("[CACHE] Using cache, items:",t.length),se(t),N(t),ie(!1),g=!0):D.status==="miss"?console.log("[CACHE] No cache found"):D.status==="expired"||D.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):D.status==="error"&&console.error("[CACHE] Error parsing cache"),g||ie(!0);try{const H=async(Ve,Me)=>{try{const qe=await window.KTM.api.getJSON(Ve,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return qe!=null?qe:Me}catch(qe){return Me}},[Z,T,c]=await Promise.all([H(`${API_BASE}/api/products`,[]),H(`${API_BASE}/api/albums`,[]),H(`${API_BASE}/api/video-folders?withVideos=true`,[])]),q=Array.isArray(Z)?Z.map(Ve=>({...Ve,_type:"product",_source:"database"})):[];pe(T);let ae=[];Array.isArray(T)&&T.length>0&&(await Promise.all(T.map(Me=>H(`${API_BASE}/api/albums/${Me.id}`,{})))).forEach((Me,qe)=>{const nt=T[qe];Me.images&&Me.images.length>0&&Me.images.forEach(at=>{ae.push({id:at.id,name:at.caption||"\u1EA2nh t\u1EEB "+nt.title,image:at.src,folder:nt.title,_type:"album",_source:"database"})})}),ke(c);let te=[];Array.isArray(c)&&c.forEach(Ve=>{Ve.videos&&Ve.videos.forEach(Me=>{te.push({id:Me.id,name:Me.title,folder:Ve.name,image:Me.thumb,youtubeId:Me.youtubeId,url:Me.url,_type:"video",_source:"database"})})});const k=[...q,...ae,...te];(!t||JSON.stringify(k)!==JSON.stringify(t))&&(se(k),N(k),window.KTM.cache.write(Ot,k))}catch(H){console.error("Song song fetch error:",H)}ie(!1)};useEffect(()=>{Qe(),setTimeout(()=>{var t;return(t=fe.current)==null?void 0:t.focus()},100)},[]);const rt=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(g){return String(t!=null?t:"").toLowerCase()}},Ct=t=>{const D=rt(t).trim().split(/\s+/).filter(Boolean),H=D.includes("anh"),Z=D.includes("video"),T=D.filter(ae=>ae!=="anh"&&ae!=="video"),c=T.join(" "),q=new Set(["product"]);return H&&q.add("album"),Z&&q.add("video"),{allowedTypes:q,includeAlbum:H,includeVideo:Z,contentTokens:T,cleanedQuery:c}},h=(t,g,D)=>{var Ve,Me,qe,nt,at;const H=Array.isArray(g)?g:[],Z=rt(D).trim();if(!H.length&&!Z)return 0;const T=rt((Ve=t==null?void 0:t.name)!=null?Ve:""),c=rt((Me=t==null?void 0:t.code)!=null?Me:""),q=rt((qe=t==null?void 0:t.category)!=null?qe:""),ae=rt((nt=t==null?void 0:t.note)!=null?nt:""),te=rt((at=t==null?void 0:t.folder)!=null?at:"");if(!`${T} ${c} ${q} ${ae} ${te}`.trim())return 0;let B=0;Z&&(T===Z&&(B+=220),T.includes(Z)&&(B+=140),T.startsWith(Z)&&(B+=160),c&&c===Z&&(B+=180),c&&c.includes(Z)&&(B+=90));for(const He of H){if(!He)continue;const gt=new RegExp(`(?:^|\\s)${He.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);T.includes(He)&&(B+=35),gt.test(T)&&(B+=25),c&&c.includes(He)&&(B+=20),c&&gt.test(c)&&(B+=10),q&&q.includes(He)&&(B+=12),te&&te.includes(He)&&(B+=12),ae&&ae.includes(He)&&(B+=6)}return B>0&&T&&(B+=Math.max(0,10-Math.min(10,Math.floor(T.length/10)))),B},I=(t,g,D)=>{const H=Array.isArray(t)?t:[];return H.length?H.map((T,c)=>({it:T,idx:c,score:h(T,g,D)})).sort((T,c)=>c.score!==T.score?c.score-T.score:T.idx-c.idx).map(T=>T.it):[]},C=async(t,g)=>{if(!(!xe||g.length===0)){Se(!0);try{const D=g.map(Z=>({id:Z.id,name:Z.name,price:Z.price,category:Z.category,note:Z.note,folder:Z.folder,_type:Z._type})),H=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:D},"AI Search error");if(H&&H.matchedIds&&H.matchedIds.length>0){const{contentTokens:Z,cleanedQuery:T}=Ct(t),c=new Set(H.matchedIds),q=g.filter(ae=>c.has(ae.id)).sort((ae,te)=>h(te,Z,T)-h(ae,Z,T));q.length>0&&N(q)}else H&&H.matchedIds&&H.matchedIds.length===0&&N([])}catch(D){console.error("AI Search error:",D)}Se(!1)}},Ee=t=>{if(Y(t),Oe.current&&clearTimeout(Oe.current),!t.trim()){Fe(me);return}const{allowedTypes:g,contentTokens:D,cleanedQuery:H}=Ct(t),Z=P.filter(c=>{if(!g.has(c==null?void 0:c._type))return!1;if(D.length===0)return!0;const q=rt(Object.entries(c).filter(([ae])=>!ae.startsWith("_")).map(([,ae])=>String(ae||"")).join(" "));return D.some(ae=>q.includes(ae))});let T=Z;me!=="all"&&(T=Z.filter(c=>(c.category||c._type)===me)),N(I(T,D,H)),xe&&H.length>=3&&(Oe.current=setTimeout(()=>{C(H,T)},500))},Fe=t=>{ye(t);const{allowedTypes:g,contentTokens:D}=Ct(j),{cleanedQuery:H}=Ct(j);let Z=P.filter(T=>g.has(T==null?void 0:T._type));t!=="all"&&(Z=Z.filter(T=>(T.category||T._type)===t)),j.trim()&&D.length>0&&(Z=Z.filter(T=>{const c=rt(Object.entries(T).filter(([q])=>!q.startsWith("_")).map(([,q])=>String(q||"")).join(" "));return D.every(q=>c.includes(q))})),N(I(Z,D,H))},Ge=(t,g)=>{window.KTM.clipboard.writeText(t).then(()=>{de(g),_("\u0110\xE3 copy!","success"),setTimeout(()=>de(null),1500)})},Ze=async(t,g)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),de(g+"-img"),_("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>de(null),1500)}catch(D){Ge(t,g+"-img")}},et=t=>{let g=t.toLowerCase();const D=[],H=P.filter(c=>c._type==="product");if(g.includes("ty")||g.includes("xy lanh")){if(g.includes("gi\u1EEFa")||g.includes("giua")){const c=H.find(q=>{var ae;return(ae=q.name)==null?void 0:ae.toLowerCase().includes("xy lanh gi\u1EEFa")});c&&!D.find(q=>q.id===c.id)&&D.push(c)}if(g.includes("nghi\xEAng")||g.includes("nghieng")){const c=H.find(q=>{var ae;return(ae=q.name)==null?void 0:ae.toLowerCase().includes("xy lanh nghi\xEAng")});c&&!D.find(q=>q.id===c.id)&&D.push(c)}if(g.includes("\u1EE7i")||g.includes("ui")){const c=H.find(q=>{var ae;return(ae=q.name)==null?void 0:ae.toLowerCase().includes("xy lanh \u1EE7i")});c&&!D.find(q=>q.id===c.id)&&D.push(c)}}const Z=g.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(Z){const c=Z[1],q=Z[2],ae=H.find(te=>{var B;const k=((B=te.name)==null?void 0:B.toLowerCase())||"";return k.includes("combo")&&k.includes(`${c} tay`)&&(k.includes(`${q} xy`)||k.includes(`${q} xylanh`))});if(ae&&!D.find(te=>te.id===ae.id))D.push(ae);else{const te=H.find(k=>{var Ve;const B=((Ve=k.name)==null?void 0:Ve.toLowerCase())||"";return B.includes("combo")&&B.includes(`${c} tay`)});te&&!D.find(k=>k.id===te.id)&&D.push(te)}}if(g.includes("combo")&&!Z){const c=g.match(/combo.*?(\d+)\s*tay/);if(c){const q=c[1];H.filter(te=>{var B;const k=((B=te.name)==null?void 0:B.toLowerCase())||"";return k.includes("combo")&&k.includes(`${q} tay`)}).forEach(te=>{D.find(k=>k.id===te.id)||D.push(te)})}}const T=g.match(/van\s*(\d+)\s*tay/);if(T&&!g.includes("ty")&&!g.includes("combo")){const c=T[1],q=H.find(ae=>{var k;const te=((k=ae.name)==null?void 0:k.toLowerCase())||"";return te.includes(`van ${c} tay`)&&!te.includes("combo")});q&&!D.find(ae=>ae.id===q.id)&&D.push(q)}return D.slice(0,4)},tt=async t=>{if(!t.trim())return;const g={role:"user",content:t,attachments:[]};s(H=>[...H,g]),A(""),z(!0);const D=et(t);setTimeout(()=>{var H;return(H=U.current)==null?void 0:H.scrollIntoView({behavior:"smooth"})},100);try{const Z=P.filter(k=>k._type==="product").map(k=>{let B=`- ${k.name}`;return k.code&&(B+=` (M\xE3: ${k.code})`),k.price&&(B+=` - Gi\xE1: ${k.price.replace(/[đ\s]/g,"")}\u0111`),k.category&&(B+=` [${k.category}]`),k.note&&(B+=` (${k.note})`),B}).join(`
`),c=M.slice(-6).map(k=>`${k.role==="user"?"Kh\xE1ch":"AI"}: ${k.content}`).join(`
`),q=c?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${c}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${Z}`:Z,te=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:q,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";s(k=>[...k,{role:"assistant",content:te,attachments:D}])}catch(H){console.error("AI Error:",H);const Z=t.toLowerCase(),T=P.filter(q=>{const ae=Object.values(q).join(" ").toLowerCase();return Z.split(" ").some(te=>ae.includes(te))});let c="";T.length>0?(c=`T\xECm th\u1EA5y ${T.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,T.slice(0,5).forEach(q=>{c+=`\u2022 ${q.name}`,q.price&&(c+=` - ${q.price.replace(/[đ\s]/g,"")}\u0111`),q.note&&(c+=` (${q.note})`),c+=`
`}),T.length>5&&(c+=`
...v\xE0 ${T.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):c='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',s(q=>[...q,{role:"assistant",content:c,attachments:T.slice(0,4)}])}z(!1),setTimeout(()=>{var H,Z;(H=U.current)==null||H.scrollIntoView({behavior:"smooth"}),(Z=r.current)==null||Z.focus()},100)};function _t({show:t,product:g,categories:D,onClose:H,onSave:Z}){const[T,c]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[q,ae]=useState(!1),[te,k]=useState(!1),B=useRef(null),Ve=O=>window.KTM.money.formatVNDInputDigits(O),Me=O=>{const S=window.KTM.money.getDigits(String(O!=null?O:"")),L=Number(S);return S&&Number.isFinite(L)?Math.trunc(L):0},qe=(O,S)=>{if(O==null||O==="")return[];let L=O;if(typeof L=="string"){const ee=L.trim();if(!ee)return[];try{L=JSON.parse(ee)}catch(W){return[]}}if(!Array.isArray(L))return[];const G=Me(S);return L.map(ee=>{var Ce;if(!ee||typeof ee!="object")return null;const W=String((Ce=ee.name)!=null?Ce:"").trim(),we=(Array.isArray(ee.options)?ee.options:[]).map(_e=>{var xt,vt,kt,St,Ft,It,Vt;if(!_e||typeof _e!="object")return null;const Le=String((xt=_e.label)!=null?xt:"").trim();if(!Le)return null;const ot=(Ft=(St=(kt=(vt=_e.price)!=null?vt:_e.priceValue)!=null?kt:_e.unit_price)!=null?St:_e.unitPrice)!=null?Ft:null,ut=Number(ot);let mt=Number.isFinite(ut)?Math.trunc(ut):null;if(mt==null){const Ht=(Vt=(It=_e.price_delta)!=null?It:_e.priceDelta)!=null?Vt:null,Bt=Number(Ht);Number.isFinite(Bt)&&(mt=G+Math.trunc(Bt))}mt==null&&(mt=G);const pt=String(Math.max(0,Math.trunc(Number(mt)||0)));return{label:Le,price:Math.max(0,Math.trunc(Number(mt)||0)),priceDigits:pt}}).filter(Boolean);return{name:W||"Bi\u1EBFn th\u1EC3",options:we}}).filter(Boolean)},nt=O=>{if(O==null||O==="")return[];let S=O;if(typeof S=="string"){const L=S.trim();if(!L)return[];try{S=JSON.parse(L)}catch(G){return[]}}return S&&typeof S=="object"&&!Array.isArray(S)&&(S=Object.entries(S).map(([L,G])=>({key:L,value:G}))),Array.isArray(S)?S.map(L=>{var we,Ce,_e,Le,ot;if(!L||typeof L!="object")return null;const G=String((_e=(Ce=(we=L.key)!=null?we:L.name)!=null?Ce:L.label)!=null?_e:"").trim(),ee=String((Le=L.value)!=null?Le:"").trim(),W=String((ot=L.unit)!=null?ot:"").trim();return G?{key:G,value:ee,unit:W}:null}).filter(Boolean):[]};useEffect(()=>{var O,S;if(g)if(c({name:g.name||"",code:g.code||"",price:g.price||"",image:g.image||"",category:g.category||"",note:g.note||"",sort_order:g.sort_order||0,commission_percent:(S=(O=g.commission_percent)!=null?O:g.commissionPercent)!=null?S:5,variants:qe(g.variants,g.price),attributes:nt(g.attributes)}),g.price){const L=window.KTM.money.getDigits(g.price);ct(L),c(G=>({...G,price:Ve(L)}))}else ct("");else c({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),ct("")},[g,t]);const at=O=>{c(S=>{var we;const L=Me(S.price),G=String(L),ee=Array.isArray(S.variants)?[...S.variants]:[],W={...ee[O]||{},options:Array.isArray((we=ee[O])==null?void 0:we.options)?[...ee[O].options]:[]};return W.options=W.options.map(Ce=>({label:String((Ce==null?void 0:Ce.label)||""),price:L,priceDigits:G})),ee[O]=W,{...S,variants:ee}})},He=()=>{c(O=>{const S=Me(O.price),L=String(S),ee=(Array.isArray(O.variants)?[...O.variants]:[]).map(W=>{const we=(Array.isArray(W==null?void 0:W.options)?W.options:[]).map(Ce=>({label:String((Ce==null?void 0:Ce.label)||""),price:S,priceDigits:L}));return{name:String((W==null?void 0:W.name)||"Bi\u1EBFn th\u1EC3"),options:we}});return{...O,variants:ee}})},[gt,Dt]=React.useState(""),[jt,ct]=React.useState(""),Kt=O=>{const S=window.KTM.money.nextPriceInputState(O.target.value,jt);ct(S.digits),c({...T,price:S.price})},Jt=async(O,S=2)=>{const L=S*1024*1024;if(O.size<=L)return O;try{const G=await createImageBitmap(O),ee=document.createElement("canvas");let W=G.width,we=G.height;const Ce=1200;return(W>Ce||we>Ce)&&(W>we?(we=Math.round(we/W*Ce),W=Ce):(W=Math.round(W/we*Ce),we=Ce)),ee.width=W,ee.height=we,ee.getContext("2d").drawImage(G,0,0,W,we),G.close(),new Promise((Le,ot)=>{ee.toBlob(ut=>{ut?Le(new File([ut],O.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ot(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(G){throw console.error("Compress error:",G),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},dt=async O=>{var G;const S=O.target.files[0];if(!S)return;if(!(S.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(S.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}k(!0);try{const ee=await Jt(S),W=await window.KTM.cloudinary.uploadImage({file:ee,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!W.secure_url)throw console.error("Cloudinary error:",W),new Error(((G=W.error)==null?void 0:G.message)||"Upload failed");c(we=>({...we,image:W.secure_url}))}catch(ee){console.error("Upload error:",ee),alert("L\u1ED7i upload \u1EA3nh: "+ee.message)}k(!1),O.target.value=""},Et=async O=>{O.preventDefault(),ae(!0);const S={...T,variants:qe(T.variants,T.price),attributes:nt(T.attributes)};await Z(S),ae(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),g?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:H})),React.createElement("form",{onSubmit:Et},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:T.name,onChange:O=>c({...T,name:O.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:T.code,onChange:O=>c({...T,code:O.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:T.price,onChange:Kt,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:T.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:O=>c({...T,commission_percent:O.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:T.category,onChange:O=>c({...T,category:O.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),D.map(O=>React.createElement("option",{key:O,value:O},O)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:T.note,onChange:O=>c({...T,note:O.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.attributes)?T.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(T.attributes)?T.attributes:[]).map((O,S)=>React.createElement("div",{key:S,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.key)||"",onChange:L=>{const G=L.target.value;c(ee=>{const W=Array.isArray(ee.attributes)?[...ee.attributes]:[];return W[S]={...W[S]||{},key:G},{...ee,attributes:W}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.value)||"",onChange:L=>{const G=L.target.value;c(ee=>{const W=Array.isArray(ee.attributes)?[...ee.attributes]:[];return W[S]={...W[S]||{},value:G},{...ee,attributes:W}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.unit)||"",onChange:L=>{const G=L.target.value;c(ee=>{const W=Array.isArray(ee.attributes)?[...ee.attributes]:[];return W[S]={...W[S]||{},unit:G},{...ee,attributes:W}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{c(L=>{const G=Array.isArray(L.attributes)?[...L.attributes]:[];return G.splice(S,1),{...L,attributes:G}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{c(O=>{const S=Array.isArray(O.attributes)?[...O.attributes]:[];return S.push({key:"",value:"",unit:""}),{...O,attributes:S}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.variants)?T.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(T.variants)?T.variants:[]).map((O,S)=>React.createElement("div",{key:S,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.name)||"",onChange:L=>{const G=L.target.value;c(ee=>{var we;const W=Array.isArray(ee.variants)?[...ee.variants]:[];return W[S]={...W[S]||{},name:G,options:Array.isArray((we=W[S])==null?void 0:we.options)?W[S].options:[]},{...ee,variants:W}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>at(S),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(O==null?void 0:O.options)||O.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{c(L=>{const G=Array.isArray(L.variants)?[...L.variants]:[];return G.splice(S,1),{...L,variants:G}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(O==null?void 0:O.options)?O.options:[]).map((L,G)=>{var ee,W;return React.createElement("div",{key:G,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(L==null?void 0:L.label)||"",onChange:we=>{const Ce=we.target.value;c(_e=>{var pt,xt,vt,kt,St;const Le=Array.isArray(_e.variants)?[..._e.variants]:[],ot={...Le[S]||{},options:Array.isArray((pt=Le[S])==null?void 0:pt.options)?[...Le[S].options]:[]},ut=Number((vt=(xt=ot.options[G])==null?void 0:xt.price)!=null?vt:0)||0,mt=String((St=(kt=ot.options[G])==null?void 0:kt.priceDigits)!=null?St:Math.max(0,Math.trunc(ut)));return ot.options[G]={...ot.options[G]||{},label:Ce,price:Math.max(0,Math.trunc(ut)),priceDigits:mt},Le[S]=ot,{..._e,variants:Le}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Ve(String((W=L==null?void 0:L.priceDigits)!=null?W:window.KTM.money.getDigits(String((ee=L==null?void 0:L.price)!=null?ee:"")))),onChange:we=>{c(Ce=>{var vt,kt,St,Ft,It;const _e=String((kt=L==null?void 0:L.priceDigits)!=null?kt:window.KTM.money.getDigits(String((vt=L==null?void 0:L.price)!=null?vt:""))),Le=window.KTM.money.nextPriceInputState(we.target.value,_e),ot=String((St=Le.digits)!=null?St:""),ut=Number(ot),mt=Number.isFinite(ut)?Math.max(0,Math.trunc(ut)):0,pt=Array.isArray(Ce.variants)?[...Ce.variants]:[],xt={...pt[S]||{},options:Array.isArray((Ft=pt[S])==null?void 0:Ft.options)?[...pt[S].options]:[]};return xt.options[G]={...xt.options[G]||{},label:String(((It=xt.options[G])==null?void 0:It.label)||""),price:mt,priceDigits:ot},pt[S]=xt,{...Ce,variants:pt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{c(we=>{var Le;const Ce=Array.isArray(we.variants)?[...we.variants]:[],_e={...Ce[S]||{},options:Array.isArray((Le=Ce[S])==null?void 0:Le.options)?[...Ce[S].options]:[]};return _e.options.splice(G,1),Ce[S]=_e,{...we,variants:Ce}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{c(L=>{var we;const G=Array.isArray(L.variants)?[...L.variants]:[],ee={...G[S]||{},options:Array.isArray((we=G[S])==null?void 0:we.options)?[...G[S].options]:[]},W=Me(L.price);return ee.options.push({label:"",price:W,priceDigits:String(W)}),G[S]=ee,{...L,variants:G}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{c(O=>{const S=Me(O.price),L=Array.isArray(O.variants)?[...O.variants]:[],G=String(S);return L.push({name:"Size",options:[{label:"S",price:S,priceDigits:G},{label:"M",price:S,priceDigits:G},{label:"L",price:S,priceDigits:G}]}),{...O,variants:L}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:He,disabled:!Array.isArray(T.variants)||T.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},T.image?React.createElement(React.Fragment,null,React.createElement("img",{src:T.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>c({...T,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var O;return(O=B.current)==null?void 0:O.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:B,type:"file",accept:"image/*",className:"d-none",onChange:dt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var O;return(O=B.current)==null?void 0:O.click()},disabled:te,style:{borderRadius:"10px"}},te?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:T.image,onChange:O=>c({...T,image:O.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:H,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:q,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Mt=t=>window.KTM.money.formatVND(t),ft=t=>{if(t==null||t==="")return[];let g=t;if(typeof g=="string"){const D=g.trim();if(!D)return[];try{g=JSON.parse(D)}catch(H){return[]}}return Array.isArray(g)?g:[]},Be=t=>{if(t==null||t==="")return[];let g=t;if(typeof g=="string"){const D=g.trim();if(!D)return[];try{g=JSON.parse(D)}catch(H){return[]}}return g&&typeof g=="object"&&!Array.isArray(g)&&(g=Object.entries(g).map(([D,H])=>({key:D,value:H}))),Array.isArray(g)?g:[]},qt=(t,g={})=>{var T;const D=Be(t).map(c=>{var q,ae,te,k,B;return{key:String((te=(ae=(q=c==null?void 0:c.key)!=null?q:c==null?void 0:c.name)!=null?ae:c==null?void 0:c.label)!=null?te:"").trim(),value:String((k=c==null?void 0:c.value)!=null?k:"").trim(),unit:String((B=c==null?void 0:c.unit)!=null?B:"").trim()}}).filter(c=>!!c.key);if(!D.length)return null;const H=!!g.compact,Z=String((T=g.className)!=null?T:"").trim();return React.createElement("div",{className:`ktm-variants-preview${H?" compact":""}${Z?" "+Z:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},D.map((c,q)=>{const ae=c.key,te=`${c.value||""}${c.unit?(c.value?" ":"")+c.unit:""}`.trim();return React.createElement("div",{key:`${ae}-${q}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ae),te?React.createElement("span",{className:"ktm-chip ktm-chip-option"},te):null)})))},Nt=(t,g={})=>{var ae;const D=ft(t).map(te=>{var k;return{name:String((k=te==null?void 0:te.name)!=null?k:"").trim(),options:Array.isArray(te==null?void 0:te.options)?te.options:[]}}).map(te=>({...te,options:te.options.map(k=>{var B;return{label:String((B=k==null?void 0:k.label)!=null?B:"").trim(),price:Number(k==null?void 0:k.price)}}).filter(k=>!!k.label)})).filter(te=>te.options.length>0);if(!D.length)return null;const H=Number.isFinite(g.maxGroups)?Math.max(1,Math.trunc(g.maxGroups)):D.length,Z=Number.isFinite(g.maxOptionsPerGroup)?Math.max(1,Math.trunc(g.maxOptionsPerGroup)):3,T=!!g.compact,c=String((ae=g.className)!=null?ae:"").trim(),q=D.slice(0,H);return React.createElement("div",{className:`ktm-variants-preview${T?" compact":""}${c?" "+c:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},q.map((te,k)=>{const B=te.name||"Bi\u1EBFn th\u1EC3",Ve=te.options.slice(0,Z),Me=te.options.length-Ve.length;return React.createElement("div",{key:`${B}-${k}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},B),Ve.map((qe,nt)=>{const at=qe.price,He=Number.isFinite(at)&&at>=0?Mt(Math.trunc(at)):"",gt=He?`${qe.label} \xB7 ${He}`:qe.label;return React.createElement("span",{key:`${B}-${k}-${nt}`,className:"ktm-chip ktm-chip-option"},gt)}),Me>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",Me))})))},Ie=(t,g)=>{const D=t._type==="product",H=t._type==="album",Z=t._type==="video",T=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale")),c=D?qt(t.attributes,{compact:ue==="grid",className:ue==="grid"?"meta text-muted":"text-muted"}):null,q=D?Nt(t.variants,{compact:ue==="grid",maxOptionsPerGroup:999,className:ue==="grid"?"meta text-muted":"text-muted"}):null;return ue==="grid"?React.createElement("div",{key:t.id||g,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>ge({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Z?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${D?"product":H?"album":"video"}`},D?"SP":H?"\u1EA2nh":"Video"),T&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),c&&React.createElement("div",{style:{marginTop:2}},c),q&&React.createElement("div",{style:{marginTop:2}},q),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:re===t.id+"-img"?"copied":"",onClick:()=>Ze(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:re===t.id+"-price"?"copied":"",onClick:()=>Ge(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||g,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${D?"product":H?"album":"video"}`},D?"S\u1EA3n ph\u1EA9m":H?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>ge({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Z?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),T&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),c&&React.createElement("div",{style:{marginTop:4}},c),q&&React.createElement("div",{style:{marginTop:4}},q)),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),Z&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},D&&React.createElement("button",{onClick:()=>w&&w("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:re===t.id+"-price"?"copied":"",onClick:()=>Ge(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:re===t.id+"-name"?"copied":"",onClick:()=>Ge(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),Z&&t.youtubeId&&React.createElement("button",{className:re===t.id+"-yt"?"copied":"",onClick:()=>Ge(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),D&&React.createElement("button",{className:"action-edit",onClick:()=>At(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Rt(t)},React.createElement("i",{className:"fas fa-trash"}))))},[$t,wt]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,Q.length)," k\u1EBFt qu\u1EA3",xe&&j.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),me!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},me==="product"?"S\u1EA3n ph\u1EA9m":me==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${ue==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>le("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${ue==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>le("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},ce?React.createElement("div",null,[...Array(8)].map((t,g)=>React.createElement("div",{key:g,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):Q.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',j,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{Y(""),Ee("")}},"Xem t\u1EA5t c\u1EA3")):ue==="grid"?React.createElement("div",{className:"product-grid-mobile"},Q.map((t,g)=>Ie(t,g))):React.createElement("div",null,Q.map((t,g)=>Ie(t,g)))),$t&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>wt(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${me==="all"?"active":""}`,onClick:()=>{Fe("all"),wt(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${me==="product"?"active":""}`,onClick:()=>{Fe("product"),wt(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${me==="album"?"active":""}`,onClick:()=>{Fe("album"),wt(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${me==="video"?"active":""}`,onClick:()=>{Fe("video"),wt(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:xe,onChange:t=>$e(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:fe,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:j,onChange:t=>Ee(t.target.value)}),React.createElement("button",{className:`filter-btn ${$t||me!=="all"?"active":""}`,onClick:()=>wt(!$t)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:v?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>b(!0),onTouchStart:()=>b(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Je&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>b(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},M.map((t,g)=>React.createElement("div",{key:g,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:re===`chat-${g}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:re===`chat-${g}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),de(`chat-${g}`),setTimeout(()=>de(null),1500)}},React.createElement("i",{className:`fas ${re===`chat-${g}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((D,H)=>React.createElement("div",{key:H,style:{width:70},className:"text-center"},D.image&&React.createElement("img",{src:D.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>ge({url:D.image,name:D.name,price:D.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},D.name),D.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},D.price.replace(/[đ\s]/g,""),"\u0111"))))))),$&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:U})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>tt(t),disabled:$,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),tt(u)},className:"chat-input-wrap"},React.createElement("input",{ref:r,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:u,onChange:t=>A(t.target.value),disabled:$}),React.createElement("button",{type:"submit",className:"send-btn",disabled:$||!u.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),E&&React.createElement("div",{className:"preview-modal",onClick:()=>ge(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>ge(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:E.url,alt:E.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},E.name),E.price&&React.createElement("div",{className:"price"},E.price.replace(/[đ\s]/g,""),"\u0111"),E.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},E.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:re==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:re==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Ze(E.url,"preview")},React.createElement("i",{className:`fas ${re==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),E.price&&React.createElement("button",{className:re==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Ge(E.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${re==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(_t,{show:F,product:Xe,categories:oe,onClose:()=>{Ae(!1),De(null)},onSave:Pt}),React.createElement("div",{className:`fab-container mobile-only ${v?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{J(!1),Ae(!0),De(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{J(!1),w&&w("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${v?"open":""}`,onClick:()=>J(!v)},React.createElement("i",{className:"fas fa-plus"}))),Re&&f&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>l(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Pe.name,onChange:t=>Ue({...Pe,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Pe.code,onChange:t=>Ue({...Pe,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Pe.price,onChange:t=>Ue({...Pe,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Pe.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:t=>Ue({...Pe,commission_percent:t.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Pe.category,onChange:t=>Ue({...Pe,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),lt.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Pe.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>Ue({...Pe,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>l(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:yt},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:_,showToast:w}){const[j,Y]=useState([]),[Q,N]=useState([]),[P,se]=useState(!0),[oe,X]=useState(null),[me,ye]=useState(!1),[re,de]=useState(null),[ue,le]=useState(!1),[ce,ie]=useState(null),[Ne,pe]=useState(null),[Te,ke]=useState([]);useEffect(()=>{fe()},[]);const fe=async(l=null)=>{se(!0);try{const f=l?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${l}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,be=await window.KTM.api.getJSON(f,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");Y(Array.isArray(be)?be:[])}catch(f){console.error(f),w("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}se(!1)},xe=async l=>{try{const f=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${l}`,"L\u1ED7i t\u1EA3i video");N(Array.isArray(f)?f:[])}catch(f){console.error(f)}},$e=async l=>{if(l===0)return;const f=[...j];[f[l-1],f[l]]=[f[l],f[l-1]],Y(f),await Se(f)},Ye=async l=>{if(l===j.length-1)return;const f=[...j];[f[l],f[l+1]]=[f[l+1],f[l]],Y(f),await Se(f)},Se=async l=>{try{await Promise.all(l.map((f,be)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${f.id}`,{sortOrder:be},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),w("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(f){w("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),fe(Ne==null?void 0:Ne.id)}},Oe=async l=>{if(l===0)return;const f=[...Q];[f[l-1],f[l]]=[f[l],f[l-1]],N(f),await b(f)},Je=async l=>{if(l===Q.length-1)return;const f=[...Q];[f[l],f[l+1]]=[f[l+1],f[l]],N(f),await b(f)},b=async l=>{try{await Promise.all(l.map((f,be)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${f.id}`,{sort_order:be},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),w("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(f){w("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),xe(oe.id)}},M=()=>{de(null),ye(!0)},s=l=>{de(l),ye(!0)},u=async l=>{try{!re&&Ne&&(l.parent_id=Ne.id);const f=re?`${API_BASE}/api/video-folders/${re.id}`:`${API_BASE}/api/video-folders`;re?await window.KTM.api.putJSON(f,l,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(f,l,"L\u1ED7i l\u01B0u folder"),w(re?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),ye(!1),fe(Ne==null?void 0:Ne.id)}catch(f){w(f.message,"danger")}},A=async l=>{const f=l.subfolderCount>0?`X\xF3a folder "${l.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${l.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(f))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${l.id}`,"L\u1ED7i x\xF3a folder"),w("\u0110\xE3 x\xF3a folder","success"),X(null),fe(Ne==null?void 0:Ne.id)}catch(be){w("L\u1ED7i x\xF3a folder","danger")}},$=l=>{l.subfolderCount>0?(ke(f=>[...f,l]),pe(l),fe(l.id)):(X(l),N(l.videos||[]))},z=l=>{if(l==="root")ke([]),pe(null),fe(null);else if(l){const f=Te.findIndex(be=>be.id===l.id);f>=0&&(ke(Te.slice(0,f+1)),pe(l),fe(l.id))}else{const f=[...Te];f.pop();const be=f[f.length-1]||null;ke(f),pe(be),fe(be==null?void 0:be.id)}},U=()=>{ie(null),le(!0)},r=l=>{ie(l),le(!0)},E=async l=>{try{l.folder_id=oe==null?void 0:oe.id;const f=ce?`${API_BASE}/api/videos/${ce.id}`:`${API_BASE}/api/videos`;ce?await window.KTM.api.putJSON(f,l,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(f,l,"L\u1ED7i l\u01B0u video"),w(ce?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),le(!1),fe(),oe&&xe(oe.id)}catch(f){w(f.message,"danger")}},ge=async l=>{if(confirm(`X\xF3a video "${l.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${l.id}`,"L\u1ED7i x\xF3a video"),w("\u0110\xE3 x\xF3a video","success"),fe(),oe&&xe(oe.id)}catch(f){w("L\u1ED7i x\xF3a video","danger")}},Re=l=>{const f=`https://www.youtube.com/watch?v=${l.youtubeId}`;window.KTM.clipboard.writeText(f).then(()=>{w("\u0110\xE3 copy link!","success")}).catch(()=>{w("Kh\xF4ng th\u1EC3 copy link","danger")})};return oe?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>X(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${oe.slug==="shorts"?"text-danger":"text-warning"}`}),oe.name)),React.createElement("button",{className:"btn btn-warning",onClick:U},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),Q.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},Q.map((l,f)=>React.createElement("div",{key:l.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Oe(f),disabled:f===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},f+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Je(f),disabled:f===Q.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:l.thumb,className:"card-img-top",alt:l.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${l.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:l.title},l.title),React.createElement("small",{className:"text-muted"},l.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Re(l),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>r(l),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>ge(l),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:ue,video:ce,onClose:()=>le(!1),onSave:E})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},Ne&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>z()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),Ne?Ne.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:M},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Te.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),z("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Te.map((l,f)=>React.createElement("li",{key:l.id,className:`breadcrumb-item ${f===Te.length-1?"active":""}`},f===Te.length-1?l.name:React.createElement("a",{href:"#",onClick:be=>{be.preventDefault(),z(l)},className:"text-warning"},l.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),P?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):j.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},Ne?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:M},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",Ne?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},j.map((l,f)=>{var be,v,J,F;return React.createElement("div",{key:l.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Ae=>{Ae.stopPropagation(),$e(f)},disabled:f===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},f+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Ae=>{Ae.stopPropagation(),Ye(f)},disabled:f===j.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>$(l),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${l.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},l.name),React.createElement("p",{className:"text-muted mb-0"},l.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),l.subfolderCount," folder"),l.subfolderCount>0&&(l.videoCount>0||((be=l.videos)==null?void 0:be.length)>0)&&" \u2022 ",(l.videoCount>0||((v=l.videos)==null?void 0:v.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),l.videoCount||((J=l.videos)==null?void 0:J.length)||0," videos"),l.subfolderCount===0&&!l.videoCount&&!((F=l.videos)!=null&&F.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Ae=>{Ae.stopPropagation(),s(l)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Ae=>{Ae.stopPropagation(),A(l)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:me,folder:re,onClose:()=>ye(!1),onSave:u}))}function VideoFolderModal({show:_,folder:w,onClose:j,onSave:Y}){const[Q,N]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[P,se]=useState(!1),[oe,X]=useState(!1);useEffect(()=>{N(w?{name:w.name||"",description:w.description||"",sortOrder:w.sortOrder||0,coverImage:w.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[w,_]);const me=async re=>{const de=re.target.files[0];if(de){X(!0);try{const ue=await window.KTM.cloudinary.uploadImage({file:de,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});ue.secure_url&&N(le=>({...le,coverImage:ue.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(ue){console.error("Cloudinary upload error:",ue),alert("L\u1ED7i upload \u1EA3nh: "+(ue.message||ue))}finally{X(!1)}}},ye=async re=>{re.preventDefault(),se(!0);const de={...Q,variants:normalizeVariants(Q.variants,Q.price),attributes:normalizeAttributes(Q.attributes)};await Y(de),se(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:ye},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:Q.name,onChange:re=>N({...Q,name:re.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:Q.description,onChange:re=>N({...Q,description:re.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Q.sortOrder,onChange:re=>N({...Q,sortOrder:parseInt(re.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},Q.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:Q.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>N({...Q,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:me,disabled:oe}),oe&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:Q.coverImage,onChange:re=>N({...Q,coverImage:re.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:P},P?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:_,settings:w}){const[j,Y]=useState([]),[Q,N]=useState(!0),[P,se]=useState(!1),[oe,X]=useState(null),[me,ye]=useState(""),[re,de]=useState(""),ue=normalizeShipPercent(w==null?void 0:w.ship_percent),{parseMoney:le,formatVND:ce}=window.KTM.money,ie=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Ne()},[]);const Ne=async()=>{N(!0);try{const s=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Y(Array.isArray(s)?s:[])}catch(s){console.error(s),_("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}N(!1)},pe=()=>{X(null),se(!0)},Te=s=>{X(s),se(!0)},ke=async s=>{if(!(!s||!s.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:s},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),_(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Ne()}catch(u){_("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},fe=async s=>{try{const u=oe?`${API_BASE}/api/products?id=${oe.id}`:`${API_BASE}/api/products`;oe?await window.KTM.api.putJSON(u,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(u,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),_(oe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),se(!1),Ne()}catch(u){_(u.message,"danger")}},xe=async s=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${s.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${s.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),_("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Ne()}catch(u){_(u.message,"danger")}},$e=j.filter(s=>{const u=!me||s.name.toLowerCase().includes(me.toLowerCase())||s.code&&s.code.toLowerCase().includes(me.toLowerCase()),A=!re||s.category===re;return u&&A}),Ye=s=>{var $;const u=($=s==null?void 0:s.commission_percent)!=null?$:s==null?void 0:s.commissionPercent,A=u===""||u==null?NaN:Number(u);return Number.isFinite(A)?Math.max(0,Math.min(100,A)):5},Se=s=>{const u=Ye(s),A=Number.isInteger(u)?String(u):String(Math.round(u*100)/100),$=le(s==null?void 0:s.price);if(!Number.isFinite($)||$<=0)return`${A}%`;const z=(Number(u)||0)/100,r=window.KTM.money.parseShipFeeFromNote(s==null?void 0:s.note)!=null?0:ue>0?$*ue/100:0,E=$*z-r*z,ge=Math.max(0,Math.round(E));return`${A}% - ${ce(ge)}`},Oe=s=>{if(s==null||s==="")return[];let u=s;if(typeof u=="string"){const A=u.trim();if(!A)return[];try{u=JSON.parse(A)}catch($){return[]}}return Array.isArray(u)?u:[]},Je=s=>{if(s==null||s==="")return[];let u=s;if(typeof u=="string"){const A=u.trim();if(!A)return[];try{u=JSON.parse(A)}catch($){return[]}}return u&&typeof u=="object"&&!Array.isArray(u)&&(u=Object.entries(u).map(([A,$])=>({key:A,value:$}))),Array.isArray(u)?u:[]},b=s=>{const u=Je(s).map(A=>{var $,z,U,r,E;return{key:String((U=(z=($=A==null?void 0:A.key)!=null?$:A==null?void 0:A.name)!=null?z:A==null?void 0:A.label)!=null?U:"").trim(),value:String((r=A==null?void 0:A.value)!=null?r:"").trim(),unit:String((E=A==null?void 0:A.unit)!=null?E:"").trim()}}).filter(A=>!!A.key);return u.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},u.map((A,$)=>{const z=A.key,U=`${A.value||""}${A.unit?(A.value?" ":"")+A.unit:""}`.trim();return React.createElement("div",{key:`${z}-${$}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},z),U?React.createElement("span",{className:"ktm-chip ktm-chip-option"},U):null)}))):null},M=(s,u={})=>{const A=Oe(s).map(r=>{var E;return{name:String((E=r==null?void 0:r.name)!=null?E:"").trim(),options:Array.isArray(r==null?void 0:r.options)?r.options:[]}}).map(r=>({...r,options:r.options.map(E=>{var ge;return{label:String((ge=E==null?void 0:E.label)!=null?ge:"").trim(),price:Number(E==null?void 0:E.price)}}).filter(E=>!!E.label)})).filter(r=>r.options.length>0);if(!A.length)return null;const $=Number.isFinite(u.maxGroups)?Math.max(1,Math.trunc(u.maxGroups)):A.length,z=Number.isFinite(u.maxOptionsPerGroup)?Math.max(1,Math.trunc(u.maxOptionsPerGroup)):4,U=A.slice(0,$);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},U.map((r,E)=>{const ge=r.name||"Bi\u1EBFn th\u1EC3",Re=r.options.slice(0,z),l=r.options.length-Re.length;return React.createElement("div",{key:`${ge}-${E}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ge),Re.map((f,be)=>{const v=f.price,J=Number.isFinite(v)&&v>=0?ce(Math.trunc(v)):"",F=J?`${f.label} \xB7 ${J}`:f.label;return React.createElement("span",{key:`${ge}-${E}-${be}`,className:"ktm-chip ktm-chip-option"},F)}),l>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",l))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:pe},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:me,onChange:s=>ye(s.target.value)})),React.createElement("span",{className:"product-count"},$e.length)),React.createElement("select",{className:"form-select",value:re,onChange:s=>de(s.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),ie.map(s=>React.createElement("option",{key:s,value:s},s)))),Q?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):$e.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:pe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},$e.map(s=>React.createElement("div",{key:s.id,className:"product-item d-flex align-items-center gap-3"},s.image?React.createElement("img",{src:s.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},s.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},s.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},s.category),s.code&&React.createElement("span",{className:"product-badge bg-secondary"},s.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),Se(s))),React.createElement("div",{className:"product-price"},s.price?s.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),s.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},s.note),b(s.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},b(s.attributes)),M(s.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},M(s.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>Te(s),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>xe(s),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:P,product:oe,categories:ie,onClose:()=>se(!1),onSave:fe}))}function ProductModal({show:_,product:w,categories:j,onClose:Y,onSave:Q}){const[N,P]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[se,oe]=useState(!1),[X,me]=useState(!1),ye=b=>{const M=window.KTM.money.getDigits(String(b!=null?b:"")),s=Number(M);return M&&Number.isFinite(s)?Math.trunc(s):0},re=b=>{if(b==null||b==="")return[];let M=b;if(typeof M=="string"){const s=M.trim();if(!s)return[];try{M=JSON.parse(s)}catch(u){return[]}}return M&&typeof M=="object"&&!Array.isArray(M)&&(M=Object.entries(M).map(([s,u])=>({key:s,value:u}))),Array.isArray(M)?M.map(s=>{var z,U,r,E,ge;if(!s||typeof s!="object")return null;const u=String((r=(U=(z=s.key)!=null?z:s.name)!=null?U:s.label)!=null?r:"").trim(),A=String((E=s.value)!=null?E:"").trim(),$=String((ge=s.unit)!=null?ge:"").trim();return u?{key:u,value:A,unit:$}:null}).filter(Boolean):[]},de=(b,M)=>{if(b==null||b==="")return[];let s=b;if(typeof s=="string"){const A=s.trim();if(!A)return[];try{s=JSON.parse(A)}catch($){return[]}}if(!Array.isArray(s))return[];const u=ye(M);return s.map(A=>{var U;if(!A||typeof A!="object")return null;const $=String((U=A.name)!=null?U:"").trim(),z=(Array.isArray(A.options)?A.options:[]).map(r=>{var be,v,J,F,Ae,Xe,De;if(!r||typeof r!="object")return null;const E=String((be=r.label)!=null?be:"").trim();if(!E)return null;const ge=(Ae=(F=(J=(v=r.price)!=null?v:r.priceValue)!=null?J:r.unit_price)!=null?F:r.unitPrice)!=null?Ae:null,Re=Number(ge);let l=Number.isFinite(Re)?Math.trunc(Re):null;if(l==null){const Pe=(De=(Xe=r.price_delta)!=null?Xe:r.priceDelta)!=null?De:null,Ue=Number(Pe);Number.isFinite(Ue)&&(l=u+Math.trunc(Ue))}l==null&&(l=u);const f=String(Math.max(0,Math.trunc(Number(l)||0)));return{label:E,price:Math.max(0,Math.trunc(Number(l)||0)),priceDigits:f}}).filter(Boolean);return{name:$||"Bi\u1EBFn th\u1EC3",options:z}}).filter(Boolean)};useEffect(()=>{var b,M;P(w?{name:w.name||"",code:w.code||"",price:w.price||"",image:w.image||"",category:w.category||"",note:w.note||"",sort_order:w.sort_order||0,commission_percent:(M=(b=w.commission_percent)!=null?b:w.commissionPercent)!=null?M:5,variants:de(w.variants,w.price),attributes:re(w.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[w,_]);const ue=b=>{P(M=>{var z;const s=ye(M.price),u=String(s),A=Array.isArray(M.variants)?[...M.variants]:[],$={...A[b]||{},options:Array.isArray((z=A[b])==null?void 0:z.options)?[...A[b].options]:[]};return $.options=$.options.map(U=>({label:String((U==null?void 0:U.label)||""),price:s,priceDigits:u})),A[b]=$,{...M,variants:A}})},le=()=>{P(b=>{const M=ye(b.price),s=String(M),A=(Array.isArray(b.variants)?[...b.variants]:[]).map($=>{const z=(Array.isArray($==null?void 0:$.options)?$.options:[]).map(U=>({label:String((U==null?void 0:U.label)||""),price:M,priceDigits:s}));return{name:String(($==null?void 0:$.name)||"Bi\u1EBFn th\u1EC3"),options:z}});return{...b,variants:A}})},[ce,ie]=React.useState(""),Ne=b=>window.KTM.money.formatVNDInputDigits(b),[pe,Te]=React.useState(""),ke=b=>{const M=window.KTM.money.nextPriceInputState(b.target.value,pe);Te(M.digits),P({...N,price:M.price})},[fe,xe]=React.useState("");React.useEffect(()=>{w!=null&&w.image&&xe(w.image)},[w]);const $e=async b=>{if(!(!b||!b.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:b},"L\u1ED7i x\xF3a \u1EA3nh")}catch(M){console.error("Delete cloudinary image error:",M)}},Ye=async(b,M=2,s)=>{const u=M*1024*1024,A=b.type==="image/heic"||b.type==="image/heif"||/\.heic$/i.test(b.name);if(b.size<=u&&!A)return b;s==null||s("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const $=await createImageBitmap(b);s==null||s("\u0110ang n\xE9n \u1EA3nh...");const z=document.createElement("canvas");let U=$.width,r=$.height;const E=1200;return(U>E||r>E)&&(U>r?(r=Math.round(r/U*E),U=E):(U=Math.round(U/r*E),r=E)),z.width=U,z.height=r,z.getContext("2d").drawImage($,0,0,U,r),$.close(),new Promise((Re,l)=>{z.toBlob(f=>{f?(s==null||s("Ho\xE0n t\u1EA5t!"),Re(new File([f],b.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):l(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch($){throw console.error("createImageBitmap error:",$),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Se=async b=>{var u,A;const M=(u=b.target.files)==null?void 0:u[0];if(!M)return;if(!(M.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(M.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}me(!0),ie("\u0110ang chu\u1EA9n b\u1ECB...");try{const $=(M.size/1024/1024).toFixed(1);ie(`File ${$}MB - \u0110ang n\xE9n...`);const z=await Ye(M,2,E=>{ie(E)}),U=(z.size/1024/1024).toFixed(1);ie(`\u0110\xE3 n\xE9n: ${U}MB - \u0110ang upload...`);const r=await window.KTM.cloudinary.uploadImage({file:z,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});r.secure_url?(N.image&&N.image!==fe&&$e(N.image),P(E=>({...E,image:r.secure_url})),ie("")):(console.error("Cloudinary error:",r),alert("Upload th\u1EA5t b\u1EA1i: "+(((A=r.error)==null?void 0:A.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),ie(""))}catch($){console.error("Upload error:",$),alert("L\u1ED7i: "+$.message),ie("")}me(!1),b.target.value=""},Oe=()=>{N.image&&(N.image!==fe&&$e(N.image),P(b=>({...b,image:""})))},Je=async b=>{b.preventDefault(),oe(!0),fe&&N.image&&fe!==N.image&&await $e(fe),fe&&!N.image&&await $e(fe),await Q(N),oe(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${w?"fa-edit":"fa-plus-circle"} me-2`}),w?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:Y})),React.createElement("form",{onSubmit:Je},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},N.image?React.createElement(React.Fragment,null,React.createElement("img",{src:N.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Oe,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${X?"fa-spinner fa-spin":"fa-camera"} me-1`}),X?ce||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Se,disabled:X,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),X&&ce&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},ce))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:N.name,onChange:b=>P({...N,name:b.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:N.code,onChange:b=>P({...N,code:b.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:N.price,onChange:ke,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:N.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:b=>P({...N,commission_percent:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:N.category,onChange:b=>P({...N,category:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),j.map(b=>React.createElement("option",{key:b,value:b},b)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:N.note,onChange:b=>P({...N,note:b.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(N.attributes)?N.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(N.attributes)?N.attributes:[]).map((b,M)=>React.createElement("div",{key:M,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.key)||"",onChange:s=>{const u=s.target.value;P(A=>{const $=Array.isArray(A.attributes)?[...A.attributes]:[];return $[M]={...$[M]||{},key:u},{...A,attributes:$}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.value)||"",onChange:s=>{const u=s.target.value;P(A=>{const $=Array.isArray(A.attributes)?[...A.attributes]:[];return $[M]={...$[M]||{},value:u},{...A,attributes:$}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.unit)||"",onChange:s=>{const u=s.target.value;P(A=>{const $=Array.isArray(A.attributes)?[...A.attributes]:[];return $[M]={...$[M]||{},unit:u},{...A,attributes:$}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{P(s=>{const u=Array.isArray(s.attributes)?[...s.attributes]:[];return u.splice(M,1),{...s,attributes:u}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{P(b=>{const M=Array.isArray(b.attributes)?[...b.attributes]:[];return M.push({key:"",value:"",unit:""}),{...b,attributes:M}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(N.variants)?N.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(N.variants)?N.variants:[]).map((b,M)=>React.createElement("div",{key:M,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.name)||"",onChange:s=>{const u=s.target.value;P(A=>{var z;const $=Array.isArray(A.variants)?[...A.variants]:[];return $[M]={...$[M]||{},name:u,options:Array.isArray((z=$[M])==null?void 0:z.options)?$[M].options:[]},{...A,variants:$}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ue(M),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(b==null?void 0:b.options)||b.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{P(s=>{const u=Array.isArray(s.variants)?[...s.variants]:[];return u.splice(M,1),{...s,variants:u}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(b==null?void 0:b.options)?b.options:[]).map((s,u)=>{var A,$;return React.createElement("div",{key:u,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(s==null?void 0:s.label)||"",onChange:z=>{const U=z.target.value;P(r=>{var f,be,v,J,F;const E=Array.isArray(r.variants)?[...r.variants]:[],ge={...E[M]||{},options:Array.isArray((f=E[M])==null?void 0:f.options)?[...E[M].options]:[]},Re=Number((v=(be=ge.options[u])==null?void 0:be.price)!=null?v:0)||0,l=String((F=(J=ge.options[u])==null?void 0:J.priceDigits)!=null?F:Math.max(0,Math.trunc(Re)));return ge.options[u]={...ge.options[u]||{},label:U,price:Math.max(0,Math.trunc(Re)),priceDigits:l},E[M]=ge,{...r,variants:E}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Ne(String(($=s==null?void 0:s.priceDigits)!=null?$:window.KTM.money.getDigits(String((A=s==null?void 0:s.price)!=null?A:"")))),onChange:z=>{P(U=>{var v,J,F,Ae,Xe;const r=String((J=s==null?void 0:s.priceDigits)!=null?J:window.KTM.money.getDigits(String((v=s==null?void 0:s.price)!=null?v:""))),E=window.KTM.money.nextPriceInputState(z.target.value,r),ge=String((F=E.digits)!=null?F:""),Re=Number(ge),l=Number.isFinite(Re)?Math.max(0,Math.trunc(Re)):0,f=Array.isArray(U.variants)?[...U.variants]:[],be={...f[M]||{},options:Array.isArray((Ae=f[M])==null?void 0:Ae.options)?[...f[M].options]:[]};return be.options[u]={...be.options[u]||{},label:String(((Xe=be.options[u])==null?void 0:Xe.label)||""),price:l,priceDigits:ge},f[M]=be,{...U,variants:f}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{P(z=>{var E;const U=Array.isArray(z.variants)?[...z.variants]:[],r={...U[M]||{},options:Array.isArray((E=U[M])==null?void 0:E.options)?[...U[M].options]:[]};return r.options.splice(u,1),U[M]=r,{...z,variants:U}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{P(s=>{var z;const u=Array.isArray(s.variants)?[...s.variants]:[],A={...u[M]||{},options:Array.isArray((z=u[M])==null?void 0:z.options)?[...u[M].options]:[]},$=ye(s.price);return A.options.push({label:"",price:$,priceDigits:String($)}),u[M]=A,{...s,variants:u}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{P(b=>{const M=ye(b.price),s=Array.isArray(b.variants)?[...b.variants]:[],u=String(M);return s.push({name:"Size",options:[{label:"S",price:M,priceDigits:u},{label:"M",price:M,priceDigits:u},{label:"L",price:M,priceDigits:u}]}),{...b,variants:s}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:le,disabled:!Array.isArray(N.variants)||N.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:N.image,onChange:b=>P({...N,image:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:Y,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:se,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:_,video:w,onClose:j,onSave:Y}){const[Q,N]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[P,se]=useState(!1),[oe,X]=useState("");useEffect(()=>{w?(N({title:w.title||"",youtube_url:`https://www.youtube.com/watch?v=${w.youtubeId}`,thumbnail_url:w.thumb||"",sort_order:w.sortOrder||0}),X(w.thumb)):(N({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),X(""))},[w,_]);const me=de=>{const ue=de.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return ue?ue[1]:null},ye=de=>{N({...Q,youtube_url:de});const ue=me(de);ue&&X(`https://img.youtube.com/vi/${ue}/hqdefault.jpg`)},re=async de=>{de.preventDefault(),se(!0),await Y(Q),se(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:re},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:Q.youtube_url,onChange:de=>ye(de.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),oe&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:oe,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:Q.title,onChange:de=>N({...Q,title:de.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Q.sort_order,onChange:de=>N({...Q,sort_order:parseInt(de.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:Q.thumbnail_url,onChange:de=>N({...Q,thumbnail_url:de.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:P},P?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[_,w]=useState(!1),[j,Y]=useState(""),[Q,N]=useState(null),[P,se]=useState("search"),[oe,X]=useState(null),[me,ye]=useState(""),[re,de]=useState([]),[ue,le]=useState(null),[ce,ie]=useState(!1),[Ne,pe]=useState(null),[Te,ke]=useState(!0),[fe,xe]=useState([]),[$e,Ye]=useState(()=>loadAdminSettings()),[Se,Oe]=useState(null),[Je,b]=useState([]);useEffect(()=>{const v=localStorage.getItem("ktm_admin_session");if(v)try{const J=JSON.parse(v);J.expiry>Date.now()?(w(!0),N(J.user)):localStorage.removeItem("ktm_admin_session")}catch(J){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{_&&$()},[_]),useEffect(()=>{if(!_)return;let v=!1;return(async()=>{try{const J=await fetchAdminSettingsFromServer();if(v)return;Ye(J),saveAdminSettings(J)}catch(J){}})(),()=>{v=!0}},[_]);const M=async(v,J)=>{Y("");try{const F=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:v,password:J},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),Ae={user:F.user,token:F.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(Ae)),N(F.user),w(!0)}catch(F){Y(F.message)}},s=()=>{localStorage.removeItem("ktm_admin_session"),w(!1),N(null),de([]),le(null)},u=(v,J="success")=>{const F=Date.now();xe(Ae=>[...Ae,{id:F,message:v,type:J}])},A=v=>{xe(J=>J.filter(F=>F.id!==v))},$=async(v=null)=>{ke(!0);try{const J=v?`${API_BASE}/api/albums?parent_id=${v}`:`${API_BASE}/api/albums?parent_id=root`,F=await window.KTM.api.getJSON(J,"L\u1ED7i t\u1EA3i danh s\xE1ch album");de(Array.isArray(F)?F:[])}catch(J){console.error(J),u("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}ke(!1)},z=()=>{pe(null),ie(!0)},U=v=>{pe(v),ie(!0)},r=async v=>{try{const J=Ne&&Ne.uuid;!J&&Se&&(v.parent_id=Se.uuid);const F=J?`${API_BASE}/api/albums/${Ne.uuid||Ne.id}`:`${API_BASE}/api/albums`;J?await window.KTM.api.putJSON(F,v,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(F,v,"L\u1ED7i t\u1EA1o"),u(J?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),ie(!1),$(Se==null?void 0:Se.uuid)}catch(J){u(J.message,"danger")}},E=v=>{le(v)},ge=v=>{if(v==="root")b([]),Oe(null),$(null);else if(v){const J=Je.findIndex(F=>F.uuid===v.uuid);J>=0&&(b(Je.slice(0,J+1)),Oe(v),$(v.uuid))}else{const J=[...Je];J.pop();const F=J[J.length-1]||null;b(J),Oe(F),$(F==null?void 0:F.uuid)}},Re=async v=>{const J=`X\xF3a folder "${v.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(J))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${v.uuid||v.id}`,"L\u1ED7i x\xF3a album"),u("\u0110\xE3 x\xF3a","success"),$(Se==null?void 0:Se.uuid)}catch(F){u("L\u1ED7i x\xF3a album","danger")}};if(!_)return React.createElement(LoginPage,{onLogin:M,error:j});const l=()=>{const v=new Date,J=v.getFullYear(),F=String(v.getMonth()+1).padStart(2,"0");return`${J}-${F}`};function f(){const[v,J]=useState(()=>{var De;return String((De=$e==null?void 0:$e.ship_percent)!=null?De:DEFAULT_SHIP_PERCENT)}),[F,Ae]=useState(!1);return useEffect(()=>{var De;J(String((De=$e==null?void 0:$e.ship_percent)!=null?De:DEFAULT_SHIP_PERCENT))},[$e==null?void 0:$e.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async De=>{De.preventDefault(),Ae(!0);const Pe=saveAdminSettings({ship_percent:v});try{const Ue=await saveAdminSettingsToServer(Pe);Ye(Ue),saveAdminSettings(Ue),u("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Ue){Ye(Pe),u("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{Ae(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:v,min:"0",max:"100",step:"0.01",onChange:De=>J(De.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:F},F?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function be(){const[v,J]=useState(l()),[F,Ae]=useState(!0),[Xe,De]=useState([]),[Pe,Ue]=useState([]),lt=useRef(!1),At=useRef(new Map),yt=normalizeShipPercent($e==null?void 0:$e.ship_percent),{parseMoney:Rt,parseShipFeeFromNote:Pt,getShipFeeForItems:Ot,formatNumber:ve,formatVND:Qe}=window.KTM.money,rt=async()=>{if(!lt.current)try{const C=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m");Ue(Array.isArray(C)?C:[]),lt.current=!0}catch(C){console.error("Load products for stats error:",C),Ue([]),lt.current=!0}},Ct=async C=>{var et,tt;const Ee=String(C||"").trim();if(!Ee)return[];const Fe=(et=At.current)==null?void 0:et.get(Ee);if(Fe&&Array.isArray(Fe))return Fe;const Ge=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(Ee)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Ze=Array.isArray(Ge)?Ge:[];return(tt=At.current)==null||tt.set(Ee,Ze),Ze},h=async()=>{Ae(!0);try{await rt();const C=await Ct(v);De(Array.isArray(C)?C:[])}catch(C){console.error("Load stats error:",C),De([])}finally{Ae(!1)}};useEffect(()=>{h()},[v]);const I=React.useMemo(()=>{var te;const C={draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};let Ee=0,Fe=0,Ge=0,Ze=0,et=0,tt=0,_t=0,Mt=0;const ft=k=>k.customer_id||k.phone||"unknown",Be=k=>window.KTM.orders.getOrderItems(k),qt=new Map,Nt=new Map,Ie=new Map,$t=5,wt=new Map((Array.isArray(Pe)?Pe:[]).map(k=>{var qe;const B=(qe=k==null?void 0:k.commission_percent)!=null?qe:k==null?void 0:k.commissionPercent,Ve=Number(B),Me=Number.isFinite(Ve)?Math.max(0,Math.min(100,Ve)):$t;return[String(k==null?void 0:k.id),Me]})),t=k=>{const B=String(k!=null?k:"").trim().toLowerCase();return B==="cancelled"?"canceled":B};for(const k of Xe){const B=t(k==null?void 0:k.status),qe=B==="canceled"||B==="draft",nt=Be(k);let at=0,He=0,gt=0;for(const S of nt){const L=Number((S==null?void 0:S.quantity)||0)||0,G=Rt(S==null?void 0:S.product_price),ee=L*G,W=String((S==null?void 0:S.product_id)||""),we=wt.has(W)?wt.get(W):$t,Ce=(Number(we)||0)/100;if(at+=L,He+=ee,gt+=ee*Ce,!qe){const _e=(S==null?void 0:S.product_id)||"unknown",Le=qt.get(W)||{product_id:_e,product_name:(S==null?void 0:S.product_name)||"\u2014",product_code:(S==null?void 0:S.product_code)||"",orders:0,quantity:0,revenue:0};Le.orders+=1,Le.quantity+=L,Le.revenue+=ee,qt.set(_e,Le)}}const Dt=Ot(nt),jt=Number((te=k==null?void 0:k.adjustment_amount)!=null?te:0)||0,ct=He+(Dt.found?Dt.fee:0)+jt,Kt=He+jt,Jt=!Dt.found&&yt>0&&He>0?He*yt/100:0,dt=He>0?gt/He:$t/100,Et=gt+jt*dt-Jt*dt,O=B==="done"||B==="paid";if(B==="draft"?C.draft+=1:B==="pending"?C.pending+=1:B==="processing"?C.processing+=1:B==="canceled"?C.canceled+=1:B==="paid"?(C.paid+=1,C.done+=1,Ze+=ct,tt+=Kt,Mt+=Et):B==="done"?(C.done+=1,Ze+=ct,tt+=Kt,Mt+=Et):C.other+=1,!qe){Ee+=1,Fe+=at,Ge+=ct,et+=Kt,_t+=Et;const S=ft(k),L=Nt.get(S)||{key:S,customer_name:k.customer_name||"",phone:k.phone||"",orders:0,quantity:0,revenue:0};L.orders+=1,L.quantity+=at,L.revenue+=ct,!L.customer_name&&k.customer_name&&(L.customer_name=k.customer_name),!L.phone&&k.phone&&(L.phone=k.phone),Nt.set(S,L);const G=k.created_at?new Date(k.created_at):null;if(G&&!Number.isNaN(G.getTime())){const ee=`${G.getFullYear()}-${String(G.getMonth()+1).padStart(2,"0")}-${String(G.getDate()).padStart(2,"0")}`,W=Ie.get(ee)||{day:ee,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};W.orders+=1,W.quantity+=at,W.revenue+=ct,O&&(W.doneOrders+=1,W.doneRevenue+=ct),Ie.set(ee,W)}}}const g=Array.from(qt.values()).sort((k,B)=>B.revenue-k.revenue),D=Array.from(Nt.values()).sort((k,B)=>B.revenue-k.revenue),H=Array.from(Ie.values()).sort((k,B)=>k.day.localeCompare(B.day)),Z=Nt.size,T=Ee?Math.round(Ge/Ee):0,c=Ee?Fe/Ee:0,q=Math.round(Mt),ae=Math.round(_t);return{statusCounts:C,activeOrders:Ee,totalQty:Fe,totalRevenue:Ge,doneRevenue:Ze,tempCommission:q,tempCommissionAll:ae,products:g,customers:D,days:H,uniqueCustomers:Z,avgOrderValue:T,avgQtyPerOrder:c}},[Xe,Pe,v]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:F}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:h,disabled:F},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:v,onChange:C=>J(C.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",yt,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),ve(I.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),ve(I.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),ve(I.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",ve(I.statusCounts.paid),"/",ve(I.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ve(I.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Qe(I.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Qe(I.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Qe(I.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Qe(I.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",I.avgQtyPerOrder?I.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},ve(I.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,ve(I.statusCounts.draft)),React.createElement("td",null,ve(I.statusCounts.pending)),React.createElement("td",null,ve(I.statusCounts.processing)),React.createElement("td",null,ve(I.statusCounts.canceled)),React.createElement("td",null,ve(I.statusCounts.done)),React.createElement("td",null,ve(I.statusCounts.paid)),React.createElement("td",null,ve(I.statusCounts.other)),React.createElement("td",null,ve(I.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},I.products.slice(0,10).map(C=>React.createElement("div",{key:C.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.product_name),React.createElement("div",{className:"text-muted small text-truncate"},C.product_code?`#${C.product_code} \u2022 `:"",ve(C.orders)," \u0111\u01A1n \u2022 ",ve(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Qe(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,I.products.slice(0,10).map(C=>React.createElement("tr",{key:C.product_id},React.createElement("td",null,C.product_name),React.createElement("td",null,C.product_code||"\u2014"),React.createElement("td",null,ve(C.orders)),React.createElement("td",null,ve(C.quantity)),React.createElement("td",{className:"fw-semibold"},Qe(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},I.customers.slice(0,10).map(C=>React.createElement("div",{key:C.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},C.phone||"\u2014"," \u2022 ",ve(C.orders)," \u0111\u01A1n \u2022 ",ve(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Qe(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,I.customers.slice(0,10).map(C=>React.createElement("tr",{key:C.key},React.createElement("td",null,C.customer_name||"\u2014"),React.createElement("td",null,C.phone||"\u2014"),React.createElement("td",null,ve(C.orders)),React.createElement("td",null,ve(C.quantity)),React.createElement("td",{className:"fw-semibold"},Qe(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},I.days.map(C=>React.createElement("div",{key:C.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},C.day),React.createElement("div",{className:"text-muted small"},ve(C.orders)," \u0111\u01A1n \u2022 ",ve(C.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",ve(C.doneOrders)," \u2022 ",Qe(C.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Qe(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,I.days.map(C=>React.createElement("tr",{key:C.day},React.createElement("td",null,C.day),React.createElement("td",null,ve(C.orders)),React.createElement("td",null,ve(C.quantity)),React.createElement("td",{className:"fw-semibold"},Qe(C.revenue)),React.createElement("td",null,ve(C.doneOrders)),React.createElement("td",{className:"fw-semibold"},Qe(C.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:P,onMenuChange:v=>{se(v),v==="albums"&&(Oe(null),b([]),$(null))},onLogout:s,currentUser:Q}),React.createElement("div",{className:"main-content"},P==="albums"&&!ue&&React.createElement(AlbumList,{albums:re,loading:Te,currentFolder:Se,breadcrumb:Je,onSelect:E,onCreate:z,onEdit:U,onDelete:Re,onBack:ge}),P==="search"&&React.createElement(SearchCenter,{showToast:u,onNavigate:(v,J,F)=>{se(v),v==="orders"&&J==="create"&&(X(Date.now()),ye((F==null?void 0:F.productId)||""))}}),P==="albums"&&ue&&React.createElement(AlbumDetail,{album:ue,parentAlbum:Je.length>0?Je[Je.length-1]:null,onBack:()=>{if(ue.parentId){const v=Je.findIndex(J=>J.uuid===ue.parentId);v>=0?le(Je[v]):le(null)}else le(null)},onRefresh:()=>$(Se==null?void 0:Se.uuid),showToast:u,onNavigateToFolder:v=>{b(J=>[...J,ue]),le(v)},onEditSubfolder:v=>{pe(v),ie(!0)}}),P==="videos"&&React.createElement(VideoList,{showToast:u}),P==="products"&&React.createElement(ProductManager,{showToast:u,settings:$e}),P==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:oe,autoOpenCreateProductId:me,showToast:u}),P==="stats"&&React.createElement(be,null),P==="settings"&&React.createElement(f,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${P==="search"?"active":""}`,onClick:v=>{v.preventDefault(),se("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${P==="albums"?"active":""}`,onClick:v=>{v.preventDefault(),se("albums"),le(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${P==="videos"?"active":""}`,onClick:v=>{v.preventDefault(),se("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${P==="products"?"active":""}`,onClick:v=>{v.preventDefault(),se("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${P==="orders"?"active":""}`,onClick:v=>{v.preventDefault(),se("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${P==="stats"?"active":""}`,onClick:v=>{v.preventDefault(),se("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:ce,album:Ne,parentId:Se==null?void 0:Se.uuid,onClose:()=>ie(!1),onSave:r}),React.createElement("div",{className:"toast-container"},fe.map(v=>React.createElement(Toast,{key:v.id,message:v.message,type:v.type,onClose:()=>A(v.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:_,autoOpenCreateProductId:w,showToast:j}){const[Y,Q]=useState([]),[N,P]=useState([]),[se,oe]=useState(!0),[X,me]=useState(!1),[ye,re]=useState([]),[de,ue]=useState(!1),[le,ce]=useState(!1),[ie,Ne]=useState(null),[pe,Te]=useState(null),[ke,fe]=useState(!1),[xe,$e]=useState(()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${n}-${a}`}),[Ye,Se]=useState(""),[Oe,Je]=useState(!1),[b,M]=useState(!1),[s,u]=useState(null),[A,$]=useState(!1),[z,U]=useState([]),[r,E]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[ge,Re]=useState([""]),[l,f]=useState(null),be=useRef({}),[v,J]=useState([]),[F,Ae]=useState(null),Xe=useRef(null),De=useRef(null),Pe=useRef(0),Ue=useRef(new Map),lt=useRef(""),At=useRef(null),yt=useRef(0),Rt=useRef(null),Pt=9,Ot=150,ve=24*60*60*1e3,Qe=5*60*1e3,rt="ktm_customer_lookup_cache_v1",Ct=200,h=3,I=7,C=3,Ee=24*60*60*1e3,Fe=e=>{try{const n=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(n))return 0;const a=Date.now()-n;return!Number.isFinite(a)||a<=0?0:Math.floor(a/Ee)}catch(n){return 0}},Ge=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:Fe(e)>=h,Ze=e=>{const n=String(e!=null?e:"").trim().toLowerCase();return n==="cancelled"?"canceled":n},et=e=>{if(Ze(e==null?void 0:e.status)!=="draft")return null;const a=I-Fe(e);return Number.isFinite(a)?a:null},tt=e=>{const n=et(e);return Number.isFinite(n)?n>0&&n<=C:!1},_t=e=>{E({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Re([""]),u(null),f(null)};useEffect(()=>{const e=n=>{var i;if(l==null)return;const a=(i=be.current)==null?void 0:i[l];a&&!a.contains(n.target)&&f(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]);const Mt=e=>window.KTM.money.parseMoney(e),ft=e=>window.KTM.money.parseSignedMoney(e),Be=e=>window.KTM.money.formatVND(e),qt=e=>window.KTM.money.parseShipFeeFromNote(e),Nt=e=>window.KTM.phone.isValid(e),Ie=e=>window.KTM.phone.normalize(e),$t=()=>{var e;try{const n=localStorage.getItem(rt);if(!n)return;const a=JSON.parse(n);if(!a||typeof a!="object")return;const i=Object.entries(a);for(const[d,y]of i)!d||!y||typeof y!="object"||(e=Ue.current)==null||e.set(String(d),y)}catch(n){}},wt=()=>{try{const e=Ue.current;if(!e||typeof e.entries!="function")return;const n=Array.from(e.entries()).filter(([i,d])=>i&&d&&typeof d=="object"&&Number.isFinite(d.ts)).sort((i,d)=>(Number(d[1].ts)||0)-(Number(i[1].ts)||0)).slice(0,Ct),a={};for(const[i,d]of n)a[i]=d;localStorage.setItem(rt,JSON.stringify(a))}catch(e){}};useEffect(()=>{$t()},[]);const t=e=>{const n=Ie(e);if(!n)return null;const a=Array.isArray(Y)?Y:[];let i=null,d=-1;for(const y of a){if(!y||Ie(y.phone||"")!==n)continue;const K=new Date(y.created_at).getTime(),x=Number.isFinite(K)?K:0;x>=d&&(d=x,i=y)}return i?{name:String(i.customer_name||"").trim(),address:String(i.address||"").trim()}:null},g=(e,n)=>{e&&E(a=>n&&Ie(a.phone)!==n?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},D=e=>{const n=t(e);if(!n)return;const a=Ie(e);E(i=>{if(a&&Ie(i.phone)!==a)return i;const d={...i};return!String(i.customer_name||"").trim()&&n.name&&(d.customer_name=n.name),!String(i.address||"").trim()&&n.address&&(d.address=n.address),d})},H=async e=>{var d,y,K;const n=Ie(e);if(!n)return;D(n);const a=(d=Ue.current)==null?void 0:d.get(n);if(a&&Number.isFinite(a.ts)){const x=Date.now()-a.ts,m=a.status==="found"?ve:Qe;if(x>=0&&x<=m){u({status:a.status,phone:n,customer:a.customer}),a.status==="found"&&a.customer&&g(a.customer,n);return}}const i=++Pe.current;u({status:"loading",phone:n});try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(n)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Pe.current!==i)return;if(x&&x.exists&&x.customer){(y=Ue.current)==null||y.set(n,{ts:Date.now(),status:"found",customer:x.customer}),wt(),u({status:"found",phone:n,customer:x.customer}),g(x.customer,n);return}(K=Ue.current)==null||K.set(n,{ts:Date.now(),status:"not-found",customer:null}),wt(),u({status:"not-found",phone:n})}catch(x){if(Pe.current!==i)return;console.error("Customer lookup error:",x),u({status:"error",phone:n})}},Z=e=>{const n=Ie(e),a=t(n);E(d=>{const y={...d,phone:n};return a&&(!String(d.customer_name||"").trim()&&a.name&&(y.customer_name=a.name),!String(d.address||"").trim()&&a.address&&(y.address=a.address)),y}),$(!1),De.current&&(clearTimeout(De.current),De.current=null);const i=n;if(i.length<Pt){u(null);return}if(Nt(i)&&i!==lt.current){lt.current=i,H(i);return}De.current=setTimeout(()=>{const d=Ie(n);Nt(d)&&d!==lt.current&&(lt.current=d,H(d))},Ot)},T=()=>{const e=Ie(r.phone);e.length<Pt||Nt(e)&&e!==lt.current&&(lt.current=e,H(e))};useEffect(()=>(b?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[b]);const c=Array.isArray(r.items)?r.items.length:0;useEffect(()=>{if(!b){yt.current=c;return}c>yt.current&&setTimeout(()=>{const e=At.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),yt.current=c},[b,c]),useEffect(()=>()=>{De.current&&(clearTimeout(De.current),De.current=null)},[]),useEffect(()=>{at()},[]),useEffect(()=>{He()},[xe]),useEffect(()=>{gt()},[]),useEffect(()=>{_&&Xe.current!==_&&(Xe.current=_,jt(w))},[_]);const q=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",ae=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",te=React.useMemo(()=>window.KTM.orders.sortOrders(Y),[Y]),k=React.useMemo(()=>window.KTM.orders.sortOrders(N),[N]),B=React.useMemo(()=>{const n=(Array.isArray(k)?k:[]).filter(a=>Ge(a));return n.sort((a,i)=>{const d=new Date(a==null?void 0:a.created_at).getTime(),y=new Date(i==null?void 0:i.created_at).getTime();return(Number.isFinite(d)?d:0)-(Number.isFinite(y)?y:0)}),n},[k]),Ve=React.useMemo(()=>{const n=(Array.isArray(ye)?ye:[]).filter(a=>tt(a));return n.sort((a,i)=>{const d=new Date(a==null?void 0:a.created_at).getTime(),y=new Date(i==null?void 0:i.created_at).getTime();return(Number.isFinite(d)?d:0)-(Number.isFinite(y)?y:0)}),n},[ye]),Me=React.useMemo(()=>Oe?B:te,[Oe,B,te]),qe=React.useMemo(()=>{if(Oe)return Me;const e=String(Ye||"").trim();return e?(Array.isArray(Me)?Me:[]).filter(n=>String((n==null?void 0:n.status)||"").trim()===e):Me},[Me,Ye,Oe]),nt=e=>window.KTM.date.formatDateTime(e),at=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");J(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),J([])}},He=async()=>{oe(!0);try{let e=`${API_BASE}/api/orders`;xe&&(e+=`?month=${xe}`);const n=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");Q(Array.isArray(n)?n:[]),gt()}catch(e){console.error("Load orders error:",e),Q([])}finally{oe(!1)}},gt=async()=>{me(!0),ue(!0);try{const[e,n]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(h)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(C)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);P(Array.isArray(e)?e:[]),re(Array.isArray(n)?n:[])}catch(e){console.error("Load all orders error:",e),P([]),re([])}finally{me(!1),ue(!1)}},Dt=e=>{var a;Ae(e.id);const n=Array.isArray(e.items)&&e.items.length?e.items.map(i=>{var d,y,K,x;return{product_id:(i==null?void 0:i.product_id)||"",quantity:Number((d=i==null?void 0:i.quantity)!=null?d:1)||1,unit_price:(()=>{var p;const m=(p=i==null?void 0:i.unit_price)!=null?p:i==null?void 0:i.unitPrice,o=Number(m);return Number.isFinite(o)?Math.trunc(o):null})(),variant:String((y=i==null?void 0:i.variant)!=null?y:"").trim(),variant_json:(x=(K=i==null?void 0:i.variant_json)!=null?K:i==null?void 0:i.variantJson)!=null?x:null}}).filter(i=>i.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1,unit_price:null,variant:"",variant_json:null}];E({customer_name:e.customer_name||"",phone:Ie(e.phone||""),address:e.address||"",note:(e==null?void 0:e.note)||"",items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:Number((a=e==null?void 0:e.adjustment_amount)!=null?a:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),Re(new Array(n.length?n.length:1).fill("")),U(new Array(n.length?n.length:1).fill(!0)),u(null),M(!0),e.phone&&H(Ie(e.phone))};function jt(e){Ae(null),_t(e||""),$(!1),U([]),M(!0)}const ct=()=>{le||ke||(M(!1),Ae(null),_t(""),$(!1),U([]))},Kt=async()=>{var x,m,o;if(!F||ke||le)return;const e=(Array.isArray(Y)?Y:[]).find(p=>String(p==null?void 0:p.id)===String(F))||null,n=String((e==null?void 0:e.status)||(r==null?void 0:r.status)||"").trim();if(n==="done"||n==="paid"||n==="canceled"){const p="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof j=="function"?j(p,"warning"):alert(p);return}const a=Ie(r.phone),d=(Array.isArray(r.items)?r.items:[]).map((p,R)=>{var V,ne;return{idx:R,product_id:String((p==null?void 0:p.product_id)||"").trim(),quantity:Number((V=p==null?void 0:p.quantity)!=null?V:0),variant:String((p==null?void 0:p.variant)||"").trim()||null,variant_json:(ne=p==null?void 0:p.variant_json)!=null?ne:null,unit_price:(()=>{const he=Number(p==null?void 0:p.unit_price);if(Number.isFinite(he))return Math.max(0,Math.trunc(he));const ze=_e(p==null?void 0:p.product_id),je=p!=null&&p.variant_json&&typeof p.variant_json=="object"?p.variant_json:null;return mt(ze,je)})()}}).filter(p=>p.product_id&&Number.isFinite(p.quantity)&&p.quantity>0);if(d.length<2){const p="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof j=="function"?j(p,"warning"):alert(p);return}const y=[],K=[];for(const p of d){const R=!!z[p.idx],V={product_id:p.product_id,quantity:p.quantity,unit_price:p.unit_price,variant:p.variant,variant_json:p.variant_json};R?y.push(V):K.push(V)}if(!y.length||!K.length){const p="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof j=="function"?j(p,"warning"):alert(p);return}fe(!0);try{const p=ft(r.adjustment_amount),R=(r.adjustment_note||"").trim(),V={customer_name:r.customer_name,phone:a,address:r.address,note:(r.note||"").trim(),adjustment_amount:p,adjustment_note:R,status:"processing",items:y,product_id:y[0].product_id,quantity:y[0].quantity,split_seq:1},ne=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,V,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),he=(o=(m=ne==null?void 0:ne.id)!=null?m:(x=ne==null?void 0:ne.order)==null?void 0:x.id)!=null?o:null;if(!he)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const ze={id:F,customer_name:r.customer_name,phone:a,address:r.address,note:(r.note||"").trim(),adjustment_amount:0,adjustment_note:"",status:"pending",items:K,product_id:K[0].product_id,quantity:K[0].quantity,parent_order_id:String(he),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${F}`,ze,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),ct(),He();const je=he?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${he}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof j=="function"?j(je,"success"):alert(je)}catch(p){console.error(p);const R=(p==null?void 0:p.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof j=="function"?j(R,"danger"):alert(R)}finally{fe(!1)}},Jt=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const n=String(e),a=v.find(i=>String(i==null?void 0:i.id)===n);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},dt=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(n){return String(e!=null?e:"").toLowerCase()}},Et=e=>{const a=dt(e).trim().split(/\s+/).filter(Boolean),i=a.join(" ");return{contentTokens:a,cleanedQuery:i}},O=React.useMemo(()=>(Array.isArray(v)?v:[]).map((e,n)=>{var o,p,R,V,ne,he;const a=dt((o=e==null?void 0:e.name)!=null?o:""),i=dt((p=e==null?void 0:e.code)!=null?p:""),d=dt((R=e==null?void 0:e.category)!=null?R:""),y=dt((V=e==null?void 0:e.note)!=null?V:""),K=dt((ne=e==null?void 0:e.id)!=null?ne:""),x=dt((he=e==null?void 0:e.stt)!=null?he:""),m=`${a} ${i} ${d} ${y} ${K} ${x}`.trim();return{p:e,originalIndex:n,name:a,code:i,category:d,note:y,haystackAll:m}}),[v]),S=(e,n,a)=>{var R,V,ne,he,ze;const i=Array.isArray(n)?n:[],d=dt(a).trim();if(!i.length&&!d)return 0;const y=(R=e==null?void 0:e.name)!=null?R:"",K=(V=e==null?void 0:e.code)!=null?V:"",x=(ne=e==null?void 0:e.category)!=null?ne:"",m=(he=e==null?void 0:e.note)!=null?he:"";if(!((ze=e==null?void 0:e.haystackAll)!=null?ze:""))return 0;let p=0;d&&(y===d&&(p+=220),y.includes(d)&&(p+=140),y.startsWith(d)&&(p+=160),K&&K===d&&(p+=180),K&&K.includes(d)&&(p+=90));for(const je of i){if(!je)continue;const it=new RegExp(`(?:^|\\s)${je.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);y.includes(je)&&(p+=35),it.test(y)&&(p+=25),K&&K.includes(je)&&(p+=20),K&&it.test(K)&&(p+=10),x&&x.includes(je)&&(p+=12),m&&m.includes(je)&&(p+=6)}return p>0&&y&&(p+=Math.max(0,10-Math.min(10,Math.floor(y.length/10)))),p},L=(e,n)=>{const a=String(e||""),i=String(n||"");if(a===i)return 0;if(!a)return i.length;if(!i)return a.length;const d=a.length,y=i.length;if(y>d)return L(i,a);let K=new Array(y+1),x=new Array(y+1);for(let m=0;m<=y;m++)K[m]=m;for(let m=1;m<=d;m++){x[0]=m;const o=a.charCodeAt(m-1);for(let R=1;R<=y;R++){const V=o===i.charCodeAt(R-1)?0:1;x[R]=Math.min(K[R]+1,x[R-1]+1,K[R-1]+V)}const p=K;K=x,x=p}return K[y]},G=(e,n)=>{const a=String(e||"").trim(),i=String(n||"");if(!a||!i)return!1;if(i.includes(a))return!0;const d=i.split(/\s+/).filter(Boolean);if(!d.length)return!1;const y=a.length<=4?1:2;for(const K of d)if(!(Math.abs(K.length-a.length)>y)&&L(a,K)<=y)return!0;return!1},ee=e=>{const n=dt(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return n?n.split(" ").filter(Boolean):[]},W=(e,n)=>{const a=Array.isArray(n)?n:[];if(!a.length)return 0;const i=ee((e==null?void 0:e.name)||""),d=ee((e==null?void 0:e.code)||""),y=ee((e==null?void 0:e.category)||""),K=ee((e==null?void 0:e.note)||""),x=(o,p,R)=>{const V=String(o||"").trim();if(!V||!p.length)return 0;const ne=V.length<=4?1:2;let he=1/0,ze=-1;for(let We=0;We<p.length;We++){const bt=p[We];if(!bt||Math.abs(bt.length-V.length)>ne)continue;const ht=L(V,bt);if(ht<he&&(he=ht,ze=We,ht===0))break}if(he===1/0||he>ne)return 0;let it=Math.round(R*(he===0?1:he===1?.65:.45));return ze===0?it+=Math.round(R*.25):ze===1&&(it+=Math.round(R*.12)),it};let m=0;for(const o of a){if(!o)continue;const p=x(o,i,180),R=x(o,d,120),V=x(o,y,60),ne=x(o,K,30);m+=Math.max(p,R,V,ne)}if(m>0){const o=((e==null?void 0:e.name)||"").length;m+=Math.max(0,60-Math.min(60,Math.floor(o/2)))}return m},we=React.useRef(new Map);React.useEffect(()=>{we.current=new Map},[v]);const Ce=e=>{var o,p;const n=String(ge[e]||"").trim();if(!n)return v;const{contentTokens:a,cleanedQuery:i}=Et(n);if(a.length===0)return v;const d=dt(n).trim(),y=we.current.get(d);if(y)return y;const K=[];for(const R of O){const V=R.haystackAll;V&&a.some(ne=>V.includes(ne))&&K.push(R)}let x=K;if(x.length<8&&a.length>0){const R=[],V=new Set(x.map(ne=>{var he,ze;return String((ze=(he=ne.p)==null?void 0:he.id)!=null?ze:"")+":"+String(ne.originalIndex)}));for(const ne of O){const he=String((p=(o=ne.p)==null?void 0:o.id)!=null?p:"")+":"+String(ne.originalIndex);if(V.has(he))continue;const ze=ne.haystackAll;ze&&a.some(je=>G(je,ze))&&(R.push(ne),V.add(he))}R.length&&(x=x.concat(R))}const m=x.map(R=>({entry:R,score:S(R,a,i)})).map(R=>{if(R.score>0)return R;const V=W(R.entry,a);return V>0?{...R,score:V}:R}).filter(R=>R.score>0).sort((R,V)=>V.score!==R.score?V.score-R.score:R.entry.originalIndex-V.entry.originalIndex).slice(0,40).map(R=>R.entry.p);return we.current.set(d,m),m},_e=e=>{if(!e)return null;const n=String(e);return v.find(a=>String(a==null?void 0:a.id)===n)||null},Le=e=>{if(e==null||e==="")return[];let n=e;if(typeof n=="string"){const a=n.trim();if(!a)return[];try{n=JSON.parse(a)}catch(i){return[]}}return Array.isArray(n)?n.map((a,i)=>{var K;if(!a||typeof a!="object")return null;const d=String((K=a.name)!=null?K:"").trim()||`Bi\u1EBFn th\u1EC3 ${i+1}`,y=(Array.isArray(a.options)?a.options:[]).map(x=>{var ze,je,it,We,bt,ht,Ke;if(!x||typeof x!="object")return null;const m=String((ze=x.label)!=null?ze:"").trim();if(!m)return null;const o=(bt=(We=(it=(je=x.price)!=null?je:x.priceValue)!=null?it:x.unit_price)!=null?We:x.unitPrice)!=null?bt:null,p=Number(o),R=Number.isFinite(p)?Math.trunc(p):null,V=(Ke=(ht=x.price_delta)!=null?ht:x.priceDelta)!=null?Ke:null,ne=Number(V),he=Number.isFinite(ne)?Math.trunc(ne):0;return{label:m,price:R,price_delta:he}}).filter(Boolean);return{name:d,options:y}}).filter(Boolean):[]},ot=e=>{const n=_e(e);return Le(n==null?void 0:n.variants)},ut=e=>{if(!e||typeof e!="object")return"";const n=[];for(const[a,i]of Object.entries(e)){const d=String(a||"").trim(),y=String(i||"").trim();!d||!y||n.push(`${d}: ${y}`)}return n.join(", ")},mt=(e,n)=>{var K;const a=Mt(e==null?void 0:e.price),i=Le(e==null?void 0:e.variants);if(!i.length||!n||typeof n!="object")return a;let d=a,y=!1;for(const x of i){const m=String((x==null?void 0:x.name)||"").trim(),o=String((n==null?void 0:n[m])||"").trim();if(!m||!o)continue;const p=(Array.isArray(x.options)?x.options:[]).find(ne=>String((ne==null?void 0:ne.label)||"").trim()===o);if(!p)continue;const R=Number(p==null?void 0:p.price);if(Number.isFinite(R)){d=Math.max(0,Math.trunc(R)),y=!0;continue}const V=Number((K=p==null?void 0:p.price_delta)!=null?K:0);Number.isFinite(V)&&(d+=Math.trunc(V))}return d},pt=e=>window.KTM.orders.getOrderItems(e),xt=e=>window.KTM.orders.getOrderTotalQty(e),vt=e=>window.KTM.orders.getOrderProductSummary(e,_e),kt=e=>window.KTM.orders.getOrderItemRows(e,_e),St=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Ft=e=>{const n=pt(e),a=kt(e),i=Ht(n),d=Vt(n),y=d.fee,K=St(e),x=i+y+K,m=[];if(e!=null&&e.customer_name&&m.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&m.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&m.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&m.push(`GHI CH\xDA: ${(e.note||"").trim()}`),m.push(""),m.push("S\u1EA2N PH\u1EA8M:"),a.length)for(const o of a)m.push(`- ${o.name} (SL: ${o.qty})`);else{const o=vt(e);o&&o!=="\u2014"&&m.push(`- ${o}`)}m.push(""),m.push(`T\u1EA0M T\xCDNH: ${Be(i)}`),d.found&&y!==0&&m.push(`SHIP: ${Be(y)}`);{const o=String((e==null?void 0:e.adjustment_note)||"").trim();(K!==0||o)&&m.push(`\u0110I\u1EC0U CH\u1EC8NH: ${Be(K)}${o?` (${o})`:""}`)}return m.push(`T\u1ED4NG: ${Be(x)}`),m.filter(Boolean).join(`
`)},It=async e=>{try{const n=Ft(e);await window.KTM.clipboard.writeText(n),typeof j=="function"?j("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(n){console.error(n),typeof j=="function"?j("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Vt=e=>window.KTM.orders.getOrderShipInfo(e,_e),Ht=e=>window.KTM.orders.getItemsSubtotal(e,_e),Bt=e=>{try{const n=e instanceof Date?e:new Date(e);if(!n||Number.isNaN(n.getTime()))return"";const a=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0");return`${a}-${i}`}catch(n){return""}},Wt=()=>xe?String(xe):Bt(new Date),Qt=e=>{const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=Ie((e==null?void 0:e.phone)||""),i=String((e==null?void 0:e.address)||"").trim().toLowerCase(),d=ft(e==null?void 0:e.adjustment_amount),K=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(x=>{var m;return{product_id:String((x==null?void 0:x.product_id)||"").trim(),quantity:Number((m=x==null?void 0:x.quantity)!=null?m:0),variant:String((x==null?void 0:x.variant)||"").trim()}}).filter(x=>x.product_id&&Number.isFinite(x.quantity)&&x.quantity>0).sort((x,m)=>x.product_id<m.product_id?-1:x.product_id>m.product_id?1:x.variant<m.variant?-1:x.variant>m.variant?1:x.quantity-m.quantity);return JSON.stringify({name:n,phone:a,address:i,items:K,adj:d})},Tt=React.useMemo(()=>{const e=Ie((r==null?void 0:r.phone)||"");if(!e)return{count:0,orders:[],monthKey:Wt()};const n=Wt(),a=(Array.isArray(Y)?Y:[]).filter(i=>{if(!i||F&&String(i.id)===String(F)||Ie(i.phone||"")!==e)return!1;const d=Bt(i.created_at);return d&&d===n}).sort((i,d)=>{const y=new Date(i.created_at).getTime(),K=new Date(d.created_at).getTime();return(Number.isFinite(K)?K:0)-(Number.isFinite(y)?y:0)});return{count:a.length,orders:a,monthKey:n}},[Y,r==null?void 0:r.phone,xe,F]),na=e=>{var x;const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=Ie((e==null?void 0:e.phone)||""),i=String((e==null?void 0:e.address)||"").trim().toLowerCase(),d=ft((x=e==null?void 0:e.adjustment_amount)!=null?x:0),y=pt(e),K=(Array.isArray(y)?y:[]).map(m=>{var o;return{product_id:String((m==null?void 0:m.product_id)||"").trim(),quantity:Number((o=m==null?void 0:m.quantity)!=null?o:0),variant:String((m==null?void 0:m.variant)||"").trim()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0).sort((m,o)=>m.product_id<o.product_id?-1:m.product_id>o.product_id?1:m.variant<o.variant?-1:m.variant>o.variant?1:m.quantity-o.quantity);return JSON.stringify({name:n,phone:a,address:i,items:K,adj:d})},Yt=React.useMemo(()=>{if(F)return"";const e=Ie((r==null?void 0:r.phone)||"");if(!e)return"";const n=Wt(),a=Qt(r),i=Array.isArray(Y)?Y:[];for(const d of i){if(!d||F&&String(d.id)===String(F)||Ie(d.phone||"")!==e)continue;const y=Bt(d.created_at);if(!y||y!==n)continue;const K=na(d);if(K&&K===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${n}${d!=null&&d.id?` (#${d.id})`:""}`}return""},[Y,r,xe,F]),Zt=e=>{var it;const n=[],a=[],i=String((e==null?void 0:e.customer_name)||"").trim(),d=Ie((e==null?void 0:e.phone)||""),y=String((e==null?void 0:e.address)||"").trim();i||n.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),d||n.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),d&&!Nt(d)&&n.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),y||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const x=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(We=>We&&We.product_id);x.length===0&&n.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),x.some(We=>{var ht;const bt=Number((ht=We==null?void 0:We.quantity)!=null?ht:0);return!Number.isFinite(bt)||bt<=0})&&n.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const o=new Set;let p=!1;for(const We of x){const bt=String(We.product_id||"").trim(),ht=String((We==null?void 0:We.variant)||"").trim();if(!bt)continue;const Ke=`${bt}||${ht}`;if(o.has(Ke)){p=!0;break}o.add(Ke)}p&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const R=Ht(x),V=Vt(x),ne=V!=null&&V.found?Number((it=V==null?void 0:V.fee)!=null?it:0):0,he=ft(e==null?void 0:e.adjustment_amount),ze=String((e==null?void 0:e.adjustment_note)||"").trim();V!=null&&V.found&&(ne>=2e5||R>0&&ne>R*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Be(ne)}`),he!==0&&!ze&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const je=Math.abs(he);return(je>=5e5||R>0&&je>R*.5)&&he!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Be(he)}`),{errors:n,warnings:a,canSubmit:n.length===0}},la=React.useMemo(()=>Zt(r),[r,v]),st=React.useMemo(()=>{var ht;const e=String((r==null?void 0:r.customer_name)||"").trim(),n=Ie((r==null?void 0:r.phone)||""),a=String((r==null?void 0:r.address)||"").trim(),i=Array.isArray(r==null?void 0:r.items)?r.items:[],d=new Map;for(const Ke of i){const zt=String((Ke==null?void 0:Ke.product_id)||"").trim(),Ut=String((Ke==null?void 0:Ke.variant)||"").trim();if(!zt)continue;const Gt=`${zt}||${Ut}`;d.set(Gt,(d.get(Gt)||0)+1)}const y=i.map(Ke=>{var aa;const zt=String((Ke==null?void 0:Ke.product_id)||"").trim(),Ut=Number((aa=Ke==null?void 0:Ke.quantity)!=null?aa:0),Gt=zt?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",sa=Number.isFinite(Ut)&&Ut>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",ia=String((Ke==null?void 0:Ke.variant)||"").trim(),ra=`${zt}||${ia}`,oa=zt&&(d.get(ra)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Gt,qtyError:sa,dupWarn:oa}}),K=i.filter(Ke=>Ke&&Ke.product_id),x=Ht(K),m=Vt(K),o=m!=null&&m.found?Number((ht=m==null?void 0:m.fee)!=null?ht:0):0,p=ft(r==null?void 0:r.adjustment_amount),R=String((r==null?void 0:r.adjustment_note)||"").trim(),V=Math.abs(p),ne=p!==0&&!R?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",he=p!==0&&(V>=5e5||x>0&&V>x*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Be(p)}`:"",ze=m!=null&&m.found&&(o>=2e5||x>0&&o>x*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Be(o)}`:"",je=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",it=n?Nt(n)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",We=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",bt=!je&&!it&&y.every(Ke=>!Ke.productError&&!Ke.qtyError);return{nameError:je,phoneError:it,addressWarn:We,items:y,shipAbnormalWarn:ze,adjustmentNoteWarn:ne,adjustmentAbnormalWarn:he,canSubmit:bt}},[r,v]),ea=async e=>{var K,x,m;const n=(e==null?void 0:e.mode)||"close",a=Zt(r);if(!a.canSubmit){const o=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof j=="function"?j(o,"danger"):alert(o);return}if(!F&&Yt){const o=`${Yt}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(o)){(Tt==null?void 0:Tt.count)>0&&$(!0),setTimeout(()=>{var V;const R=document.getElementById("order-phone-input");R&&typeof R.scrollIntoView=="function"&&(R.scrollIntoView({block:"center",behavior:"smooth"}),(V=R.focus)==null||V.call(R))},0);return}}const i=Ie(r.phone),y=(Array.isArray(r.items)?r.items:[]).map(o=>{var p,R;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((p=o==null?void 0:o.quantity)!=null?p:1),variant:String((o==null?void 0:o.variant)||"").trim()||null,variant_json:(R=o==null?void 0:o.variant_json)!=null?R:null,unit_price:(()=>{const V=o==null?void 0:o.unit_price,ne=Number(V);if(Number.isFinite(ne))return Math.max(0,Math.trunc(ne));const he=_e(o==null?void 0:o.product_id),ze=o!=null&&o.variant_json&&typeof o.variant_json=="object"?o.variant_json:null;return mt(he,ze)})()}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0);ce(!0);try{const o=F?`${API_BASE}/api/orders/${F}`:`${API_BASE}/api/orders`,p=y[0],R={customer_name:r.customer_name,phone:i,address:r.address,note:(r.note||"").trim(),adjustment_amount:ft(r.adjustment_amount),adjustment_note:(r.adjustment_note||"").trim(),product_id:p.product_id,quantity:p.quantity,status:r.status,items:y,...F?{id:F}:{}};if(F)await window.KTM.api.putJSON(o,R,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const V=await window.KTM.api.postJSON(o,R,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Rt.current={id:(m=(x=V==null?void 0:V.id)!=null?x:(K=V==null?void 0:V.order)==null?void 0:K.id)!=null?m:null,fingerprint:Qt(r),ts:Date.now()}}n==="new"&&!F?(_t(""),Ae(null),M(!0)):(_t(""),Ae(null),M(!1)),He()}catch(o){console.error(o),typeof j=="function"?j(o.message,"danger"):alert(o.message);return}finally{ce(!1)}},Xt=e=>window.KTM.orders.getOrderTotalMoney(e,_e),ta=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){Ne(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),He(),gt()}catch(n){console.error(n),typeof j=="function"?j(n.message,"danger"):alert(n.message)}finally{Ne(null)}}},Lt=async(e,n)=>{var i;const a=e==null?void 0:e.id;if(!(!a||!n)){Te(a);try{const d=pt(e),y=(Array.isArray(d)?d:[]).map(m=>{var o,p;return{product_id:(m==null?void 0:m.product_id)||"",quantity:Number((o=m==null?void 0:m.quantity)!=null?o:1),variant:String((m==null?void 0:m.variant)||"").trim()||null,variant_json:(p=m==null?void 0:m.variant_json)!=null?p:null,unit_price:(()=>{var ne;const R=(ne=m==null?void 0:m.unit_price)!=null?ne:m==null?void 0:m.unitPrice,V=Number(R);return Number.isFinite(V)?Math.max(0,Math.trunc(V)):null})()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0);if(!y.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const K=y[0],x={id:a,customer_name:(e==null?void 0:e.customer_name)||"",phone:Ie((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",note:((e==null?void 0:e.note)||"").trim(),adjustment_amount:Number((i=e==null?void 0:e.adjustment_amount)!=null?i:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:K.product_id,quantity:K.quantity,status:n,items:y};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${a}`,x,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),Q(m=>Array.isArray(m)?m.map(o=>(o==null?void 0:o.id)===a?{...o,status:n}:o):m),P(m=>Array.isArray(m)?m.map(o=>(o==null?void 0:o.id)===a?{...o,status:n}:o):m),typeof j=="function"&&j("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(d){console.error(d),typeof j=="function"?j(d.message,"danger"):alert(d.message)}finally{Te(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:se&&!b||le||!!ie||!!pe}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:jt,disabled:le||!!ie},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:xe,onChange:e=>$e(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:Oe}),xe&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{$e("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:se},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:Ye,onChange:e=>Se(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:Oe},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),Ye&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Se(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:se},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:Oe,onChange:e=>{const n=!!e.target.checked;Je(n),n&&Se("pending")}}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",h," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:He,disabled:se},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},Ye?`${qe.length}/${Y.length} \u0111\u01A1n`:`${Y.length} \u0111\u01A1n`)),B.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,B.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",h," ng\xE0y.",X&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Je(!0),Se("pending")}},"Xem ngay")),Ve.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,Ve.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",C," ng\xE0y).",de&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Je(!1),Se("draft"),$e(""),He()}},"Xem ngay")),se?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):Y.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):qe.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},qe.map(e=>{var n;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((n=e==null?void 0:e.split_seq)!=null?n:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${ae(e.status)}`},q(e.status)),Ge(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${h} ng\xE0y`},"\u26A0 Ch\u1EADm ",Fe(e),"d"),tt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${I} ng\xE0y`},"\u23F3 C\xF2n ",et(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=kt(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((i,d)=>React.createElement("div",{key:d,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},d+1,"."),i.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",i.qty,Number(i.unitPrice)>0?` \u2022 ${Be(i.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},vt(e))})()),(St(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Be(St(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Be(Xt(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",nt(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary flex-fill",onClick:()=>Dt(e),disabled:le||!!ie||pe===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>It(e),disabled:le||!!ie||pe===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger flex-fill",onClick:()=>ta(e.id),disabled:le||ie===e.id||pe===e.id},ie===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>Lt(e,"processing"),disabled:le||!!ie||pe===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>Lt(e,"done"),disabled:le||!!ie||pe===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>Lt(e,"paid"),disabled:le||!!ie||pe===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:()=>Lt(e,"canceled"),disabled:le||!!ie||pe===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,qe.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const n=kt(e);return n.length?React.createElement("div",{className:"d-grid gap-1"},n.map((a,i)=>React.createElement("div",{key:i,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Be(a.unitPrice))))):vt(e)})()),React.createElement("td",null,xt(e)),React.createElement("td",{className:"fw-semibold"},Be(Xt(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${ae(e.status)}`},q(e.status)),Ge(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${h} ng\xE0y`},"\u26A0 Ch\u1EADm ",Fe(e),"d"),tt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${I} ng\xE0y`},"\u23F3 C\xF2n ",et(e),"d"))),React.createElement("td",null,nt(e.created_at)),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary me-1",onClick:()=>Dt(e),disabled:le||!!ie||pe===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>It(e),disabled:le||!!ie||pe===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>Lt(e,"processing"),disabled:le||!!ie||pe===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>Lt(e,"done"),disabled:le||!!ie||pe===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>Lt(e,"paid"),disabled:le||!!ie||pe===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:()=>Lt(e,"canceled"),disabled:le||!!ie||pe===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>ta(e.id),disabled:le||ie===e.id},ie===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))))))),b&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),F?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:ct})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),ea({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:At},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:r.customer_name,onChange:e=>E({...r,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!st.nameError&&React.createElement("div",{className:"form-text text-danger"},st.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:r.phone,onChange:e=>Z(e.target.value),onBlur:T,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!st.phoneError&&React.createElement("div",{className:"form-text text-danger"},st.phoneError),!st.phoneError&&Tt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Tt.count," \u0111\u01A1n trong th\xE1ng ",Tt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>$(e=>!e)},A?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),A&&Tt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>$(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Tt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ae(e.status)}`},q(e.status))),React.createElement("div",{className:"text-muted small"},nt(e.created_at)," \u2022 ",Be(Xt(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},vt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Dt(e)}},"M\u1EDF")))),Tt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(s==null?void 0:s.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(s==null?void 0:s.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(s==null?void 0:s.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(s==null?void 0:s.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:r.status,onChange:e=>E({...r,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:r.address,onChange:e=>E({...r,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!st.addressWarn&&React.createElement("div",{className:"form-text text-warning"},st.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:r.note,onChange:e=>E({...r,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:r.adjustment_amount,onChange:e=>E({...r,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!st.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},st.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:r.adjustment_note,onChange:e=>E({...r,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!st.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},st.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{E(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Re(e=>[...Array.isArray(e)?e:[],""]),F&&U(e=>[...Array.isArray(e)?e:[],!0])},disabled:le},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(r.items)?r.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{be.current[n]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{f(a=>a===n?null:n),setTimeout(()=>{const a=document.getElementById(`order-product-search-${n}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Jt(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),l===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:ge[n]||"",onChange:a=>{const i=a.target.value;Re(d=>{const y=Array.isArray(d)?[...d]:[];return y[n]=i,y})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=Ce(n);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(i=>React.createElement("button",{key:i.id,type:"button",className:"dropdown-item",onClick:()=>{const d=String(i.id),y=Le(i==null?void 0:i.variants),K={};for(const o of y){const p=String((o==null?void 0:o.name)||"").trim(),R=Array.isArray(o==null?void 0:o.options)?o.options[0]:null,V=String((R==null?void 0:R.label)||"").trim();p&&V&&(K[p]=V)}const x=ut(K),m=mt(i,K);E(o=>{const p=Array.isArray(o.items)?[...o.items]:[];return p[n]={...p[n]||{quantity:1},product_id:d,variant_json:Object.keys(K).length?K:null,variant:x,unit_price:y.length?m:null},{...o,items:p}}),f(null)}},i.name,i.code?` (${i.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),v.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var i;const a=(i=st.items)==null?void 0:i[n];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const a=_e(e.product_id),i=Le(a==null?void 0:a.variants);if(!i.length)return null;const d=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},i.map((y,K)=>{const x=String((y==null?void 0:y.name)||`Bi\u1EBFn th\u1EC3 ${K+1}`).trim(),m=String((d==null?void 0:d[x])||"").trim();return React.createElement("div",{key:x},React.createElement("label",{className:"form-label small text-muted mb-1"},x),React.createElement("select",{className:"form-select",value:m,onChange:o=>{const p=String(o.target.value||"").trim();E(R=>{const V=Array.isArray(R.items)?[...R.items]:[],ne={...V[n]||{}},he=_e(ne.product_id),ze=Le(he==null?void 0:he.variants),je=ne!=null&&ne.variant_json&&typeof ne.variant_json=="object"?{...ne.variant_json}:{};p?je[x]=p:delete je[x];const it=ut(je),We=mt(he,je);return V[n]={...ne,variant_json:Object.keys(je).length?je:null,variant:it,unit_price:We},{...R,items:V}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",x," --"),(Array.isArray(y==null?void 0:y.options)?y.options:[]).map(o=>React.createElement("option",{key:o.label,value:o.label},o.label,Number.isFinite(Number(o==null?void 0:o.price))?` (${Be(Number(o.price))})`:Number(o==null?void 0:o.price_delta)?` (${o.price_delta>0?"+":""}${o.price_delta})`:""))))}))})(),F&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!z[n],onChange:a=>{const i=!!a.target.checked;U(d=>{const y=Array.isArray(d)?[...d]:[],K=Array.isArray(r.items)?r.items.length:0;for(;y.length<K;)y.push(!0);return y[n]=i,y})},disabled:le||ke}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const i=a.target.value;E(d=>{const y=Array.isArray(d.items)?[...d.items]:[];return y[n]={...y[n]||{product_id:""},quantity:i},{...d,items:y}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var i;const a=(i=st.items)==null?void 0:i[n];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{E(a=>{const i=Array.isArray(a.items)?[...a.items]:[];return i.splice(n,1),{...a,items:i.length?i:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Re(a=>{const i=Array.isArray(a)?[...a]:[];return i.splice(n,1),i.length?i:[""]}),U(a=>{const i=Array.isArray(a)?[...a]:[];return i.splice(n,1),i}),f(a=>a==null?a:a===n?null:a>n?a-1:a)},disabled:le||ke||(Array.isArray(r.items)?r.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(r.items)?r.items:[]).filter(K=>K==null?void 0:K.product_id),a=Ht(n),i=Vt(n),d=ft(r.adjustment_amount),y=a+(i.found?i.fee:0)+d;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Be(a))),i.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Be(i.fee))),!!st.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},st.shipAbnormalWarn),d!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Be(d))),(r.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(r.note||"").trim()),(r.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",(r.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Be(y)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:ct,disabled:le||ke,style:{borderRadius:10}},"H\u1EE7y"),!!F&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:Kt,disabled:le||ke,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},ke?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!F&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>ea({mode:"new"}),disabled:le||!st.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:le||ke||!st.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},le?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

