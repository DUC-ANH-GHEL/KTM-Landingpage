const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:x,error:k}){const[A,G]=useState(""),[P,M]=useState(""),[O,ce]=useState(!1),[ue,ee]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),k&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),k),React.createElement("form",{onSubmit:async Me=>{Me.preventDefault(),ce(!0),await x(A,P),ce(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:A,onChange:Me=>G(Me.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:ue?"text":"password",className:"form-control",value:P,onChange:Me=>M(Me.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ee(!ue)},React.createElement("i",{className:`fas fa-eye${ue?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:x,type:k,onClose:A,actionLabel:G,onAction:P,durationMs:M}){return useEffect(()=>{const O=Number(M),ce=Number.isFinite(O)&&O>0?O:3e3,ue=setTimeout(A,ce);return()=>clearTimeout(ue)},[A,M]),React.createElement("div",{className:`toast show align-items-center text-white bg-${k} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},x),G&&typeof P=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{P()}finally{A()}}},G),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:A})))}function Loading({show:x}){return x?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:x,title:k,subtitle:A,onClose:G,footer:P,children:M}){return useEffect(()=>{if(!x)return;const O=ce=>{ce.key==="Escape"&&(ce.preventDefault(),typeof G=="function"&&G())};return document.addEventListener("keydown",O),()=>document.removeEventListener("keydown",O)},[x,G]),x?React.createElement("div",{className:`admin-drawer-root ${x?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:G,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},k),A?React.createElement("div",{className:"admin-drawer-subtitle"},A):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:G,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},M),P?React.createElement("div",{className:"admin-drawer-footer"},P):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(x){try{const k=localStorage.getItem(x);if(!k)return[];const A=JSON.parse(k);return Array.isArray(A)?A.map(G=>String(G||"").trim()).filter(Boolean):[]}catch(k){return[]}}function saveAdminMenuIdsToStorage(x,k){try{localStorage.setItem(x,JSON.stringify(Array.isArray(k)?k:[]))}catch(A){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(x){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,x),x}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(x){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,x),x}function Sidebar({activeMenu:x,onMenuChange:k,onLogout:A,currentUser:G,pinnedMenus:P,recentMenus:M,onTogglePin:O}){const ce=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],ue=(G==null?void 0:G.username)||(G==null?void 0:G.name)||(G==null?void 0:G.email)||"Admin",ee=useMemo(()=>{const be=new Map;for(const T of ce)be.set(T.id,T);return be},[]),ve=Array.isArray(P)?P:[],Me=Array.isArray(M)?M:[],pe=ve.map(be=>ee.get(be)).filter(Boolean),he=Me.filter(be=>be!==x).map(be=>ee.get(be)).filter(Boolean).slice(0,5),$e=be=>ve.includes(be);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},ue),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},pe.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},pe.map(be=>React.createElement("a",{key:`pin-${be.id}`,href:"#",className:`nav-link ${x===be.id?"active":""} sidebar-quicklink`,onClick:T=>{T.preventDefault(),k(be.id)}},React.createElement("i",{className:`fas ${be.icon}`})," ",be.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:T=>{T.preventDefault(),T.stopPropagation(),O&&O(be.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),he.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},he.map(be=>React.createElement("a",{key:`recent-${be.id}`,href:"#",className:`nav-link ${x===be.id?"active":""} sidebar-quicklink`,onClick:T=>{T.preventDefault(),k(be.id)}},React.createElement("i",{className:`fas ${be.icon}`})," ",be.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),ce.map(be=>React.createElement("a",{key:be.id,href:"#",className:`nav-link ${x===be.id?"active":""} ${be.disabled?"opacity-50":""} ${be.highlight?"text-warning":""}`,onClick:T=>{T.preventDefault(),be.disabled||k(be.id)}},React.createElement("i",{className:`fas ${be.icon}`})," ",be.label,be.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),be.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${$e(be.id)?"pinned":""}`,onClick:T=>{T.preventDefault(),T.stopPropagation(),O&&O(be.id)},title:$e(be.id)?"B\u1ECF ghim":"Ghim","aria-label":$e(be.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),A&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:A,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(x){const k=typeof x=="number"?x:parseFloat(String(x!=null?x:"").trim());return Number.isFinite(k)?Math.max(0,Math.min(100,k)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var x;try{const k=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!k)return{ship_percent:DEFAULT_SHIP_PERCENT};const A=JSON.parse(k);return{ship_percent:normalizeShipPercent((x=A==null?void 0:A.ship_percent)!=null?x:A==null?void 0:A.shipPercent)}}catch(k){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(x){var k;try{const A={ship_percent:normalizeShipPercent((k=x==null?void 0:x.ship_percent)!=null?k:x==null?void 0:x.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(A)),A}catch(A){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var k;const x=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((k=x==null?void 0:x.ship_percent)!=null?k:x==null?void 0:x.shipPercent)}}async function saveAdminSettingsToServer(x){var G,P,M;const k={ship_percent:normalizeShipPercent((G=x==null?void 0:x.ship_percent)!=null?G:x==null?void 0:x.shipPercent)},A=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,k,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((M=(P=A==null?void 0:A.ship_percent)!=null?P:A==null?void 0:A.shipPercent)!=null?M:k.ship_percent)}}function AlbumList({albums:x,onSelect:k,onCreate:A,onEdit:G,onDelete:P,loading:M,currentFolder:O,onBack:ce,breadcrumb:ue}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},O&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:ce},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),O?O.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:A},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),ue&&ue.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:ee=>{ee.preventDefault(),ce("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ue.map((ee,ve)=>React.createElement("li",{key:ee.id,className:`breadcrumb-item ${ve===ue.length-1?"active":""}`},ve===ue.length-1?ee.title:React.createElement("a",{href:"#",onClick:Me=>{Me.preventDefault(),ce(ee)},className:"text-warning"},ee.title))))),M?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):x.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},O?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},x.map(ee=>React.createElement("div",{key:ee.uuid||ee.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>k(ee)},ee.cover?React.createElement("img",{src:ee.cover,className:"album-cover",alt:ee.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},ee.title),React.createElement("small",{className:"text-muted"},ee.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),ee.subfolderCount),ee.subfolderCount>0&&ee.count>0&&" \u2022 ",ee.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),ee.count),ee.subfolderCount===0&&ee.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:ve=>{ve.stopPropagation(),G(ee)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:ve=>{ve.stopPropagation(),P(ee)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:x,album:k,onClose:A,onSave:G,parentId:P}){const[M,O]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[ce,ue]=useState(!1),[ee,ve]=useState(!1),Me=useRef(null);useEffect(()=>{O(k?{slug:k.id||"",title:k.title||"",description:k.description||"",cover_url:k.cover||"",parent_id:k.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:P||null})},[k,x,P]);const pe=async T=>{T.preventDefault(),ue(!0),await G(M),ue(!1)},he=T=>T.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),$e=async T=>{const We=T.type==="image/heic"||T.type==="image/heif"||/\.heic$/i.test(T.name);if(T.size<=2097152&&!We)return T;try{const Ve=await createImageBitmap(T),ge=document.createElement("canvas");let Ae=Ve.width,le=Ve.height;const Pe=800;return(Ae>Pe||le>Pe)&&(Ae>le?(le=Math.round(le/Ae*Pe),Ae=Pe):(Ae=Math.round(Ae/le*Pe),le=Pe)),ge.width=Ae,ge.height=le,ge.getContext("2d").drawImage(Ve,0,0,Ae,le),Ve.close(),new Promise((ht,Se)=>{ge.toBlob(Ue=>{Ue?ht(new File([Ue],T.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Se(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Ve){throw console.error("Compress cover error:",Ve),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},be=async T=>{var Ve;const Le=T.target.files[0];if(!Le)return;if(!(Le.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Le.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ve(!0);try{const ge=await $e(Le),Ae=await window.KTM.cloudinary.uploadImage({file:ge,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Ae.secure_url)throw console.error("Cloudinary error:",Ae),new Error(((Ve=Ae.error)==null?void 0:Ve.message)||"Upload failed");O(le=>({...le,cover_url:Ae.secure_url}))}catch(ge){console.error("Cover upload error:",ge),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+ge.message)}ve(!1),T.target.value=""};return x?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},k?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:pe},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:M.title,onChange:T=>O({...M,title:T.target.value,slug:M.slug||he(T.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:M.slug,onChange:T=>O({...M,slug:T.target.value}),required:!0,disabled:!!k}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:M.description,onChange:T=>O({...M,description:T.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},M.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:M.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>O(T=>({...T,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:Me,type:"file",accept:"image/*",className:"d-none",onChange:be}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var T;return(T=Me.current)==null?void 0:T.click()},disabled:ee},ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:M.cover_url,onChange:T=>O({...M,cover_url:T.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:A},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:ce||ee},ce?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:x,allAlbums:k,currentAlbumId:A,targetAlbum:G,onSelect:P,level:M=0}){const[O,ce]=useState(!0),ue=x.uuid||x.id,ee=ue===A,ve=G===ue,Me=k.filter(he=>he.parentId===ue),pe=Me.length>0;return React.createElement("div",{style:{marginLeft:M*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${ve?"bg-info text-white":ee?"bg-light text-muted":"hover-bg"}`,style:{cursor:ee?"not-allowed":"pointer",opacity:ee?.5:1,transition:"background 0.2s"},onClick:()=>!ee&&P(ue)},pe&&React.createElement("i",{className:`fas fa-chevron-${O?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:he=>{he.stopPropagation(),ce(!O)}}),!pe&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${ve?"-open":""} me-2 ${ve?"":"text-warning"}`}),React.createElement("span",{className:"small"},x.title),ee&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),x.count>0&&!ee&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},x.count)),O&&pe&&React.createElement("div",null,Me.map(he=>React.createElement(FolderTreeItem,{key:he.uuid||he.id,folder:he,allAlbums:k,currentAlbumId:A,targetAlbum:G,onSelect:P,level:M+1}))))}function AlbumDetail({album:x,onBack:k,onRefresh:A,showToast:G,onNavigateToFolder:P,onEditSubfolder:M,parentAlbum:O}){const[ce,ue]=useState([]),[ee,ve]=useState([]),[Me,pe]=useState(!0),[he,$e]=useState(!1),[be,T]=useState(""),[Le,We]=useState([]),[Ve,ge]=useState([]),[Ae,le]=useState({}),[Pe,it]=useState(null),[ht,Se]=useState(!1),[Ue,lt]=useState(""),[g,f]=useState(!1),_=useRef(null),W=useRef(null),[X,H]=useState(!1),[z,re]=useState([]),[b,C]=useState([]),[L,Y]=useState(""),[oe,se]=useState(!1),ye=async(S,c=2)=>{const $=c*1024*1024,D=S.type==="image/heic"||S.type==="image/heif"||/\.heic$/i.test(S.name);if(S.size<=$&&!D)return S;try{const ie=await createImageBitmap(S),we=document.createElement("canvas");let K=ie.width,Ke=ie.height;const Xe=1200;return(K>Xe||Ke>Xe)&&(K>Ke?(Ke=Math.round(Ke/K*Xe),K=Xe):(K=Math.round(K/Ke*Xe),Ke=Xe)),we.width=K,we.height=Ke,we.getContext("2d").drawImage(ie,0,0,K,Ke),ie.close(),new Promise((xe,Je)=>{we.toBlob(Pt=>{Pt?xe(new File([Pt],S.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Je(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ie){throw console.error("Compress error:",ie),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{Ne(),Be()},[x.id,x.uuid]);const Ne=async()=>{pe(!0);try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${x.uuid||x.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ue(S.images||[]);const c=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${x.uuid||x.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ve(Array.isArray(c)?c:[])}catch(S){console.error(S),G("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}pe(!1)},Be=async()=>{try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");C(Array.isArray(S)?S:[])}catch(S){console.error("Error loading albums:",S)}},at=S=>{re(c=>c.includes(S)?c.filter($=>$!==S):[...c,S])},ae=async()=>{if(!L||z.length===0){G("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}se(!0);let S=0;for(const c of z)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${c}`,{album_id:L},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),S++}catch($){console.error("Move error:",$)}se(!1),H(!1),re([]),Y(""),S>0?(G("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),Ne(),A()):G("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[je,ut]=useState(!1),qe=async()=>{if(z.length===0||!confirm(`X\xF3a ${z.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;ut(!0);let S=0;for(const c of z)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${c}`,"L\u1ED7i x\xF3a \u1EA3nh"),S++}catch($){console.error("Delete error:",$)}ut(!1),re([]),S>0?(G(`\u0110\xE3 x\xF3a ${S} \u1EA3nh!`,"success"),Ne(),A()):G("X\xF3a th\u1EA5t b\u1EA1i","danger")},Nt=()=>{z.length===ce.length?re([]):re(ce.map(S=>S.id))},pt=async()=>{if(Ue.trim()){f(!0);try{const S=Ue.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:S+"-"+Date.now(),title:Ue,parent_id:x.uuid||x.id},"L\u1ED7i t\u1EA1o folder"),G("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),lt(""),Se(!1),Ne(),A()}catch(S){G(S.message,"danger")}f(!1)}},Ot=async S=>{if(confirm(`X\xF3a folder "${S.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${S.uuid||S.id}`,"L\u1ED7i x\xF3a folder"),G("\u0110\xE3 x\xF3a folder","success"),Ne(),A()}catch(c){G("L\u1ED7i x\xF3a folder","danger")}},_t=S=>{const c=Array.from(S).filter($=>$.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test($.name));We($=>[...$,...c]),c.forEach($=>{const D=new FileReader;D.onload=ie=>{ge(we=>[...we,{file:$,preview:ie.target.result}])},D.readAsDataURL($)})},w=S=>{We(c=>c.filter(($,D)=>D!==S)),ge(c=>c.filter(($,D)=>D!==S))},E=async S=>{var $;const c=await window.KTM.cloudinary.uploadImage({file:S,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${x.id}`});if(!c.secure_url)throw console.error("Cloudinary error:",c),new Error((($=c.error)==null?void 0:$.message)||"Upload failed");return c},Oe=async()=>{if(Le.length===0)return;$e(!0);let S=0;for(let c=0;c<Le.length;c++)try{T(`\u0110ang x\u1EED l\xFD ${c+1}/${Le.length}...`);const $=await ye(Le[c],2);T(`\u0110ang upload ${c+1}/${Le.length}...`);const D=await E($);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${x.id}`,{url:D.secure_url,caption:Ae[c]||Le[c].name.replace(/\.[^/.]+$/,""),sort_order:ce.length+c},"L\u1ED7i l\u01B0u \u1EA3nh"),S++}catch($){console.error("Upload error:",$)}$e(!1),T(""),We([]),ge([]),le({}),S>0?(G(`\u0110\xE3 upload ${S} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),Ne(),A()):G("Upload th\u1EA5t b\u1EA1i","danger")},nt=async(S,c)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${S}`,"L\u1ED7i x\xF3a \u1EA3nh"),G("\u0110\xE3 x\xF3a \u1EA3nh","success"),Ne(),A()}catch($){G("L\u1ED7i x\xF3a \u1EA3nh","danger")}},bt=S=>{var c;S.preventDefault(),(c=W.current)==null||c.classList.add("dragover")},ct=()=>{var S;(S=W.current)==null||S.classList.remove("dragover")},kt=S=>{var c;S.preventDefault(),(c=W.current)==null||c.classList.remove("dragover"),_t(S.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:k},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},x.title),React.createElement("small",{className:"text-muted"},ee.length>0&&React.createElement("span",null,ee.length," folder \u2022 "),ce.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Se(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ht&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Ue,onChange:S=>lt(S.target.value),onKeyPress:S=>S.key==="Enter"&&pt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:pt,disabled:g||!Ue.trim()},g?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Se(!1),lt("")}},"H\u1EE7y")))),ee.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},ee.map(S=>React.createElement("div",{key:S.uuid||S.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>P&&P(S)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},S.title),React.createElement("small",{className:"text-muted"},S.subfolderCount>0&&React.createElement("span",null,S.subfolderCount," folder"),S.subfolderCount>0&&S.count>0&&" \u2022 ",S.count>0&&React.createElement("span",null,S.count," \u1EA3nh"),S.subfolderCount===0&&S.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:c=>{c.stopPropagation(),M&&M(S)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:c=>{c.stopPropagation(),Ot(S)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:W,className:"upload-zone",onClick:()=>{var S;return(S=_.current)==null?void 0:S.click()},onDragOver:bt,onDragLeave:ct,onDrop:kt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:_,type:"file",multiple:!0,accept:"image/*",onChange:S=>_t(S.target.files)})),Ve.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Ve.map((S,c)=>React.createElement("div",{key:c,className:"upload-preview-item"},React.createElement("img",{src:S.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>w(c)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Oe,disabled:he},he?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),be||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Le.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",ce.length,")"),ce.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Nt},z.length===ce.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),z.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},z.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>H(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:qe,disabled:je},je?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>re([])},React.createElement("i",{className:"fas fa-times"})))),Me?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):ce.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},ce.map((S,c)=>React.createElement("div",{key:c,className:`image-item ${z.includes(S.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>at(S.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:z.includes(S.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:z.includes(S.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},z.includes(S.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:S.src,alt:S.caption,style:{opacity:z.includes(S.id)?.7:1,border:z.includes(S.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:$=>{$.stopPropagation(),nt(S.id,c)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),S.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},S.caption)))))),X&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",z.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>H(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},b.filter(S=>!S.parentId).map(S=>React.createElement(FolderTreeItem,{key:S.uuid||S.id,folder:S,allAlbums:b,currentAlbumId:x.uuid||x.id,targetAlbum:L,onSelect:Y})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>H(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ae,disabled:!L||oe},oe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Pe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>it(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>it(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Pe.src,alt:Pe.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:S=>S.stopPropagation()}),Pe.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Pe.caption)))))}function SearchCenter({showToast:x,onNavigate:k}){const[A,G]=useState(""),[P,M]=useState([]),[O,ce]=useState([]),[ue,ee]=useState([]),[ve,Me]=useState("all"),[pe,he]=useState(null),[$e,be]=useState("list"),[T,Le]=useState(!0),[We,Ve]=useState([]),[ge,Ae]=useState([]),le=useRef(null),[Pe,it]=useState(!0),[ht,Se]=useState(!1),Ue=useRef(null),lt=useRef(null),g=useRef(null),[f,_]=useState(!1),[W,X]=useState([]),[H,z]=useState([]),[re,b]=useState(""),C=useRef(null),L=useRef(new Map),[Y,oe]=useState("auto"),[se,ye]=useState({start:0,end:20}),[Ne,Be]=useState(!1),[at,ae]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[je,ut]=useState(""),[qe,Nt]=useState(!1),pt=useRef(null),Ot=useRef(null),_t=r=>r?String(r).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",w=r=>r?String(r).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",E=(r,h)=>{if(!r||!h)return r;const I=new RegExp(`(${h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return r.replace(I,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const r=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),h=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");X(Array.isArray(r)?r.slice(0,10):[]),z(Array.isArray(h)?h:[])}catch(r){}},[]);const Oe=r=>{if(!r.trim())return;const h=[r,...W.filter(I=>I!==r)].slice(0,10);X(h);try{localStorage.setItem("ktm_search_history",JSON.stringify(h))}catch(I){}},nt=r=>{if(!r.trim())return;const h=H.includes(r)?H.filter(I=>I!==r):[r,...H].slice(0,5);z(h);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(h))}catch(I){}},[bt,ct]=useState(null),[kt,S]=useState(!1),[c,$]=useState(null),[D,ie]=useState(!1),[we,K]=useState(!1),[Ke,Xe]=useState(null),[st,xe]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),Je=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Pt=r=>{var h,I;r._type==="product"&&($(r),xe({name:r.name||"",code:r.code||"",price:r.price||"",image:r.image||"",category:r.category||"",note:r.note||"",commission_percent:(I=(h=r.commission_percent)!=null?h:r.commissionPercent)!=null?I:""}),S(!0))},ba=async()=>{if(c)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${c.id}`,st,"L\u1ED7i c\u1EADp nh\u1EADt"),x("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),S(!1),$(null),Tt()}catch(r){x(r.message,"danger")}},de=async r=>{const h=r._type==="product"?"s\u1EA3n ph\u1EA9m":r._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${h} "${r.name}"?`))try{let I="";r._type==="product"?I=`${API_BASE}/api/products?id=${r.id}`:r._type==="album"?I=`${API_BASE}/api/images/${r.id}`:r._type==="video"&&(I=`${API_BASE}/api/videos/${r.id}`),await window.KTM.api.deleteJSON(I,"L\u1ED7i x\xF3a"),x(`\u0110\xE3 x\xF3a ${h}`,"success"),Tt()}catch(I){x(I.message,"danger")}},Vt=async r=>{try{const h=Ke?`${API_BASE}/api/products?id=${Ke.id}`:`${API_BASE}/api/products`;Ke?await window.KTM.api.putJSON(h,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(h,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),x(Ke?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),K(!1),Xe(null),Tt()}catch(h){x(h.message,"danger")}},Gt="ktm_admin_data_cache_v1",fa=1e3*60*10,Tt=async()=>{let r=null,h=!1;const I=window.KTM.cache.read(Gt,{ttlMs:fa,validate:Array.isArray});I.hit?(r=I.value,console.log("[CACHE] Using cache, items:",r.length),ce(r),M(r),Le(!1),h=!0):I.status==="miss"?console.log("[CACHE] No cache found"):I.status==="expired"||I.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):I.status==="error"&&console.error("[CACHE] Error parsing cache"),h||Le(!0);try{const J=async(dt,Fe)=>{try{const ft=await window.KTM.api.getJSON(dt,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return ft!=null?ft:Fe}catch(ft){return Fe}},[ne,j,v]=await Promise.all([J(`${API_BASE}/api/products?fields=search`,[]),J(`${API_BASE}/api/albums`,[]),J(`${API_BASE}/api/video-folders?withVideos=true`,[])]),Z=Array.isArray(ne)?ne.map(dt=>({...dt,_type:"product",_source:"database"})):[];Ve(j);let me=[];Array.isArray(j)&&j.length>0&&(await Promise.all(j.map(Fe=>J(`${API_BASE}/api/albums/${Fe.id}`,{})))).forEach((Fe,ft)=>{const Et=j[ft];Fe.images&&Fe.images.length>0&&Fe.images.forEach(St=>{me.push({id:St.id,name:St.caption||"\u1EA2nh t\u1EEB "+Et.title,image:St.src,folder:Et.title,_type:"album",_source:"database"})})}),Ae(v);let fe=[];Array.isArray(v)&&v.forEach(dt=>{dt.videos&&dt.videos.forEach(Fe=>{fe.push({id:Fe.id,name:Fe.title,folder:dt.name,image:Fe.thumb,youtubeId:Fe.youtubeId,url:Fe.url,_type:"video",_source:"database"})})});const Q=[...Z,...me,...fe];(!r||JSON.stringify(Q)!==JSON.stringify(r))&&(ce(Q),M(Q),window.KTM.cache.write(Gt,Q))}catch(J){console.error("Song song fetch error:",J)}Le(!1)};useEffect(()=>{Tt(),setTimeout(()=>{var h;return(h=le.current)==null?void 0:h.focus()},100);const r=h=>{var I,J;(h.ctrlKey||h.metaKey)&&h.key==="k"&&(h.preventDefault(),_(!0),setTimeout(()=>{var ne;return(ne=C.current)==null?void 0:ne.focus()},0)),h.key==="/"&&!f&&((I=document.activeElement)==null?void 0:I.tagName)!=="INPUT"&&(h.preventDefault(),(J=le.current)==null||J.focus()),h.key==="Escape"&&f&&_(!1)};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[f]);const jt=r=>{try{return String(r!=null?r:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(h){return String(r!=null?r:"").toLowerCase()}},Mt=r=>{const I=jt(r).trim().split(/\s+/).filter(Boolean),J=I.includes("anh"),ne=I.includes("video"),j=I.filter(me=>me!=="anh"&&me!=="video"),v=j.join(" "),Z=new Set(["product"]);return J&&Z.add("album"),ne&&Z.add("video"),{allowedTypes:Z,includeAlbum:J,includeVideo:ne,contentTokens:j,cleanedQuery:v}},Wt=(r,h,I)=>{var dt,Fe,ft,Et,St;const J=Array.isArray(h)?h:[],ne=jt(I).trim();if(!J.length&&!ne)return 0;const j=jt((dt=r==null?void 0:r.name)!=null?dt:""),v=jt((Fe=r==null?void 0:r.code)!=null?Fe:""),Z=jt((ft=r==null?void 0:r.category)!=null?ft:""),me=jt((Et=r==null?void 0:r.note)!=null?Et:""),fe=jt((St=r==null?void 0:r.folder)!=null?St:"");if(!`${j} ${v} ${Z} ${me} ${fe}`.trim())return 0;let ke=0;ne&&(j===ne&&(ke+=220),j.includes(ne)&&(ke+=140),j.startsWith(ne)&&(ke+=160),v&&v===ne&&(ke+=180),v&&v.includes(ne)&&(ke+=90));for(const gt of J){if(!gt)continue;const la=new RegExp(`(?:^|\\s)${gt.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);j.includes(gt)&&(ke+=35),la.test(j)&&(ke+=25),v&&v.includes(gt)&&(ke+=20),v&&la.test(v)&&(ke+=10),Z&&Z.includes(gt)&&(ke+=12),fe&&fe.includes(gt)&&(ke+=12),me&&me.includes(gt)&&(ke+=6)}return ke>0&&j&&(ke+=Math.max(0,10-Math.min(10,Math.floor(j.length/10)))),ke},ha=(r,h,I)=>{const J=Array.isArray(r)?r:[];return J.length?J.map((j,v)=>({it:j,idx:v,score:Wt(j,h,I)})).sort((j,v)=>v.score!==j.score?v.score-j.score:j.idx-v.idx).map(j=>j.it):[]},ga=async(r,h)=>{if(!(!Pe||h.length===0)){Se(!0);try{const I=h.map(ne=>({id:ne.id,name:ne.name,price:ne.price,category:ne.category,note:ne.note,folder:ne.folder,_type:ne._type})),J=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:r,products:I},"AI Search error");if(J&&J.matchedIds&&J.matchedIds.length>0){const{contentTokens:ne,cleanedQuery:j}=Mt(r),v=new Set(J.matchedIds),Z=h.filter(me=>v.has(me.id)).sort((me,fe)=>Wt(fe,ne,j)-Wt(me,ne,j));Z.length>0&&M(Z)}else J&&J.matchedIds&&J.matchedIds.length===0&&M([])}catch(I){console.error("AI Search error:",I)}Se(!1)}},Bt=r=>{if(G(r),b(r),lt.current&&clearTimeout(lt.current),Ue.current&&clearTimeout(Ue.current),g.current&&g.current.abort(),!r.trim()){ia(ve);return}const h=`${r}|${ve}`;if(L.current.has(h)){M(L.current.get(h));return}const{allowedTypes:I,contentTokens:J,cleanedQuery:ne}=Mt(r);lt.current=setTimeout(()=>{const j=O.filter(me=>{if(!I.has(me==null?void 0:me._type))return!1;if(J.length===0)return!0;const fe=_t(Object.entries(me).filter(([Q])=>!Q.startsWith("_")).map(([,Q])=>String(Q||"")).join(" "));if(me.phone){const Q=w(me.phone);if(Q&&J.some(ke=>Q.includes(ke)))return!0}return J.some(Q=>fe.includes(Q))});let v=j;ve!=="all"&&(v=j.filter(me=>(me.category||me._type)===ve));const Z=ha(v,J,ne);if(L.current.size>20){const me=L.current.keys().next().value;L.current.delete(me)}L.current.set(h,Z),M(Z),Pe&&ne.length>=3&&(Ue.current=setTimeout(()=>{ga(ne,v)},500))},200)},ia=r=>{Me(r);const{allowedTypes:h,contentTokens:I}=Mt(A),{cleanedQuery:J}=Mt(A);let ne=O.filter(j=>h.has(j==null?void 0:j._type));r!=="all"&&(ne=ne.filter(j=>(j.category||j._type)===r)),A.trim()&&I.length>0&&(ne=ne.filter(j=>{const v=jt(Object.entries(j).filter(([Z])=>!Z.startsWith("_")).map(([,Z])=>String(Z||"")).join(" "));return I.every(Z=>v.includes(Z))})),M(ha(ne,I,J))},Ut=(r,h)=>{window.KTM.clipboard.writeText(r).then(()=>{he(h),x("\u0110\xE3 copy!","success"),setTimeout(()=>he(null),1500)})},Fa=async(r,h)=>{try{await window.KTM.clipboard.writeImageFromUrl(r),he(h+"-img"),x("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>he(null),1500)}catch(I){Ut(r,h+"-img")}},Qa=r=>{let h=r.toLowerCase();const I=[],J=O.filter(v=>v._type==="product");if(h.includes("ty")||h.includes("xy lanh")){if(h.includes("gi\u1EEFa")||h.includes("giua")){const v=J.find(Z=>{var me;return(me=Z.name)==null?void 0:me.toLowerCase().includes("xy lanh gi\u1EEFa")});v&&!I.find(Z=>Z.id===v.id)&&I.push(v)}if(h.includes("nghi\xEAng")||h.includes("nghieng")){const v=J.find(Z=>{var me;return(me=Z.name)==null?void 0:me.toLowerCase().includes("xy lanh nghi\xEAng")});v&&!I.find(Z=>Z.id===v.id)&&I.push(v)}if(h.includes("\u1EE7i")||h.includes("ui")){const v=J.find(Z=>{var me;return(me=Z.name)==null?void 0:me.toLowerCase().includes("xy lanh \u1EE7i")});v&&!I.find(Z=>Z.id===v.id)&&I.push(v)}}const ne=h.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(ne){const v=ne[1],Z=ne[2],me=J.find(fe=>{var ke;const Q=((ke=fe.name)==null?void 0:ke.toLowerCase())||"";return Q.includes("combo")&&Q.includes(`${v} tay`)&&(Q.includes(`${Z} xy`)||Q.includes(`${Z} xylanh`))});if(me&&!I.find(fe=>fe.id===me.id))I.push(me);else{const fe=J.find(Q=>{var dt;const ke=((dt=Q.name)==null?void 0:dt.toLowerCase())||"";return ke.includes("combo")&&ke.includes(`${v} tay`)});fe&&!I.find(Q=>Q.id===fe.id)&&I.push(fe)}}if(h.includes("combo")&&!ne){const v=h.match(/combo.*?(\d+)\s*tay/);if(v){const Z=v[1];J.filter(fe=>{var ke;const Q=((ke=fe.name)==null?void 0:ke.toLowerCase())||"";return Q.includes("combo")&&Q.includes(`${Z} tay`)}).forEach(fe=>{I.find(Q=>Q.id===fe.id)||I.push(fe)})}}const j=h.match(/van\s*(\d+)\s*tay/);if(j&&!h.includes("ty")&&!h.includes("combo")){const v=j[1],Z=J.find(me=>{var Q;const fe=((Q=me.name)==null?void 0:Q.toLowerCase())||"";return fe.includes(`van ${v} tay`)&&!fe.includes("combo")});Z&&!I.find(me=>me.id===Z.id)&&I.push(Z)}return I.slice(0,4)},$t=async r=>{if(!r.trim())return;const h={role:"user",content:r,attachments:[]};ae(J=>[...J,h]),ut(""),Nt(!0);const I=Qa(r);setTimeout(()=>{var J;return(J=pt.current)==null?void 0:J.scrollIntoView({behavior:"smooth"})},100);try{const ne=O.filter(Q=>Q._type==="product").map(Q=>{let ke=`- ${Q.name}`;return Q.code&&(ke+=` (M\xE3: ${Q.code})`),Q.price&&(ke+=` - Gi\xE1: ${Q.price.replace(/[đ\s]/g,"")}\u0111`),Q.category&&(ke+=` [${Q.category}]`),Q.note&&(ke+=` (${Q.note})`),ke}).join(`
`),v=at.slice(-6).map(Q=>`${Q.role==="user"?"Kh\xE1ch":"AI"}: ${Q.content}`).join(`
`),Z=v?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${v}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${ne}`:ne,fe=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:r,context:Z,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";ae(Q=>[...Q,{role:"assistant",content:fe,attachments:I}])}catch(J){console.error("AI Error:",J);const ne=r.toLowerCase(),j=O.filter(Z=>{const me=Object.values(Z).join(" ").toLowerCase();return ne.split(" ").some(fe=>me.includes(fe))});let v="";j.length>0?(v=`T\xECm th\u1EA5y ${j.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,j.slice(0,5).forEach(Z=>{v+=`\u2022 ${Z.name}`,Z.price&&(v+=` - ${Z.price.replace(/[đ\s]/g,"")}\u0111`),Z.note&&(v+=` (${Z.note})`),v+=`
`}),j.length>5&&(v+=`
...v\xE0 ${j.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):v='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',ae(Z=>[...Z,{role:"assistant",content:v,attachments:j.slice(0,4)}])}Nt(!1),setTimeout(()=>{var J,ne;(J=pt.current)==null||J.scrollIntoView({behavior:"smooth"}),(ne=Ot.current)==null||ne.focus()},100)};function Za({show:r,product:h,categories:I,onClose:J,onSave:ne}){const[j,v]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Z,me]=useState(!1),[fe,Q]=useState(!1),ke=useRef(null),dt=R=>window.KTM.money.formatVNDInputDigits(R),Fe=R=>{const V=window.KTM.money.getDigits(String(R!=null?R:"")),U=Number(V);return V&&Number.isFinite(U)?Math.trunc(U):0},ft=(R,V)=>{if(R==null||R==="")return[];let U=R;if(typeof U=="string"){const u=U.trim();if(!u)return[];try{U=JSON.parse(u)}catch(F){return[]}}if(!Array.isArray(U))return[];const te=Fe(V);return U.map(u=>{var Ie;if(!u||typeof u!="object")return null;const F=String((Ie=u.name)!=null?Ie:"").trim(),De=(Array.isArray(u.options)?u.options:[]).map(Ye=>{var yt,qt,Ct,Kt,At,Yt,Va;if(!Ye||typeof Ye!="object")return null;const Qe=String((yt=Ye.label)!=null?yt:"").trim();if(!Qe)return null;const vt=(At=(Kt=(Ct=(qt=Ye.price)!=null?qt:Ye.priceValue)!=null?Ct:Ye.unit_price)!=null?Kt:Ye.unitPrice)!=null?At:null,rt=Number(vt);let Rt=Number.isFinite(rt)?Math.trunc(rt):null;if(Rt==null){const na=(Va=(Yt=Ye.price_delta)!=null?Yt:Ye.priceDelta)!=null?Va:null,ya=Number(na);Number.isFinite(ya)&&(Rt=te+Math.trunc(ya))}Rt==null&&(Rt=te);const Re=String(Math.max(0,Math.trunc(Number(Rt)||0)));return{label:Qe,price:Math.max(0,Math.trunc(Number(Rt)||0)),priceDigits:Re}}).filter(Boolean);return{name:F||"Bi\u1EBFn th\u1EC3",options:De}}).filter(Boolean)},Et=R=>{if(R==null||R==="")return[];let V=R;if(typeof V=="string"){const U=V.trim();if(!U)return[];try{V=JSON.parse(U)}catch(te){return[]}}return V&&typeof V=="object"&&!Array.isArray(V)&&(V=Object.entries(V).map(([U,te])=>({key:U,value:te}))),Array.isArray(V)?V.map(U=>{var De,Ie,Ye,Qe,vt;if(!U||typeof U!="object")return null;const te=String((Ye=(Ie=(De=U.key)!=null?De:U.name)!=null?Ie:U.label)!=null?Ye:"").trim(),u=String((Qe=U.value)!=null?Qe:"").trim(),F=String((vt=U.unit)!=null?vt:"").trim();return te?{key:te,value:u,unit:F}:null}).filter(Boolean):[]};useEffect(()=>{var R,V;if(h)if(v({name:h.name||"",code:h.code||"",price:h.price||"",image:h.image||"",category:h.category||"",note:h.note||"",sort_order:h.sort_order||0,commission_percent:(V=(R=h.commission_percent)!=null?R:h.commissionPercent)!=null?V:5,variants:ft(h.variants,h.price),attributes:Et(h.attributes)}),h.price){const U=window.KTM.money.getDigits(h.price);Lt(U),v(te=>({...te,price:dt(U)}))}else Lt("");else v({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Lt("")},[h,r]);const St=R=>{v(V=>{var De;const U=Fe(V.price),te=String(U),u=Array.isArray(V.variants)?[...V.variants]:[],F={...u[R]||{},options:Array.isArray((De=u[R])==null?void 0:De.options)?[...u[R].options]:[]};return F.options=F.options.map(Ie=>({label:String((Ie==null?void 0:Ie.label)||""),price:U,priceDigits:te})),u[R]=F,{...V,variants:u}})},gt=()=>{v(R=>{const V=Fe(R.price),U=String(V),u=(Array.isArray(R.variants)?[...R.variants]:[]).map(F=>{const De=(Array.isArray(F==null?void 0:F.options)?F.options:[]).map(Ie=>({label:String((Ie==null?void 0:Ie.label)||""),price:V,priceDigits:U}));return{name:String((F==null?void 0:F.name)||"Bi\u1EBFn th\u1EC3"),options:De}});return{...R,variants:u}})},[la,xn]=React.useState(""),[et,Lt]=React.useState(""),_a=R=>{const V=window.KTM.money.nextPriceInputState(R.target.value,et);Lt(V.digits),v({...j,price:V.price})},Dt=async(R,V=2)=>{const U=V*1024*1024;if(R.size<=U)return R;try{const te=await createImageBitmap(R),u=document.createElement("canvas");let F=te.width,De=te.height;const Ie=1200;return(F>Ie||De>Ie)&&(F>De?(De=Math.round(De/F*Ie),F=Ie):(F=Math.round(F/De*Ie),De=Ie)),u.width=F,u.height=De,u.getContext("2d").drawImage(te,0,0,F,De),te.close(),new Promise((Qe,vt)=>{u.toBlob(rt=>{rt?Qe(new File([rt],R.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):vt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(te){throw console.error("Compress error:",te),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ca=async R=>{var te;const V=R.target.files[0];if(!V)return;if(!(V.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(V.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Q(!0);try{const u=await Dt(V),F=await window.KTM.cloudinary.uploadImage({file:u,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!F.secure_url)throw console.error("Cloudinary error:",F),new Error(((te=F.error)==null?void 0:te.message)||"Upload failed");v(De=>({...De,image:F.secure_url}))}catch(u){console.error("Upload error:",u),alert("L\u1ED7i upload \u1EA3nh: "+u.message)}Q(!1),R.target.value=""},Ta=async R=>{R.preventDefault(),me(!0);const V={...j,variants:ft(j.variants,j.price),attributes:Et(j.attributes)};await ne(V),me(!1)};return r?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),h?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:J})),React.createElement("form",{onSubmit:Ta},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:j.name,onChange:R=>v({...j,name:R.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:j.code,onChange:R=>v({...j,code:R.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:j.price,onChange:_a,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:j.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:R=>v({...j,commission_percent:R.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:j.category,onChange:R=>v({...j,category:R.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),I.map(R=>React.createElement("option",{key:R,value:R},R)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:j.note,onChange:R=>v({...j,note:R.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(j.attributes)?j.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(j.attributes)?j.attributes:[]).map((R,V)=>React.createElement("div",{key:V,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(R==null?void 0:R.key)||"",onChange:U=>{const te=U.target.value;v(u=>{const F=Array.isArray(u.attributes)?[...u.attributes]:[];return F[V]={...F[V]||{},key:te},{...u,attributes:F}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(R==null?void 0:R.value)||"",onChange:U=>{const te=U.target.value;v(u=>{const F=Array.isArray(u.attributes)?[...u.attributes]:[];return F[V]={...F[V]||{},value:te},{...u,attributes:F}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(R==null?void 0:R.unit)||"",onChange:U=>{const te=U.target.value;v(u=>{const F=Array.isArray(u.attributes)?[...u.attributes]:[];return F[V]={...F[V]||{},unit:te},{...u,attributes:F}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{v(U=>{const te=Array.isArray(U.attributes)?[...U.attributes]:[];return te.splice(V,1),{...U,attributes:te}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{v(R=>{const V=Array.isArray(R.attributes)?[...R.attributes]:[];return V.push({key:"",value:"",unit:""}),{...R,attributes:V}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(j.variants)?j.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(j.variants)?j.variants:[]).map((R,V)=>React.createElement("div",{key:V,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(R==null?void 0:R.name)||"",onChange:U=>{const te=U.target.value;v(u=>{var De;const F=Array.isArray(u.variants)?[...u.variants]:[];return F[V]={...F[V]||{},name:te,options:Array.isArray((De=F[V])==null?void 0:De.options)?F[V].options:[]},{...u,variants:F}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>St(V),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(R==null?void 0:R.options)||R.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{v(U=>{const te=Array.isArray(U.variants)?[...U.variants]:[];return te.splice(V,1),{...U,variants:te}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(R==null?void 0:R.options)?R.options:[]).map((U,te)=>{var u,F;return React.createElement("div",{key:te,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(U==null?void 0:U.label)||"",onChange:De=>{const Ie=De.target.value;v(Ye=>{var Re,yt,qt,Ct,Kt;const Qe=Array.isArray(Ye.variants)?[...Ye.variants]:[],vt={...Qe[V]||{},options:Array.isArray((Re=Qe[V])==null?void 0:Re.options)?[...Qe[V].options]:[]},rt=Number((qt=(yt=vt.options[te])==null?void 0:yt.price)!=null?qt:0)||0,Rt=String((Kt=(Ct=vt.options[te])==null?void 0:Ct.priceDigits)!=null?Kt:Math.max(0,Math.trunc(rt)));return vt.options[te]={...vt.options[te]||{},label:Ie,price:Math.max(0,Math.trunc(rt)),priceDigits:Rt},Qe[V]=vt,{...Ye,variants:Qe}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:dt(String((F=U==null?void 0:U.priceDigits)!=null?F:window.KTM.money.getDigits(String((u=U==null?void 0:U.price)!=null?u:"")))),onChange:De=>{v(Ie=>{var qt,Ct,Kt,At,Yt;const Ye=String((Ct=U==null?void 0:U.priceDigits)!=null?Ct:window.KTM.money.getDigits(String((qt=U==null?void 0:U.price)!=null?qt:""))),Qe=window.KTM.money.nextPriceInputState(De.target.value,Ye),vt=String((Kt=Qe.digits)!=null?Kt:""),rt=Number(vt),Rt=Number.isFinite(rt)?Math.max(0,Math.trunc(rt)):0,Re=Array.isArray(Ie.variants)?[...Ie.variants]:[],yt={...Re[V]||{},options:Array.isArray((At=Re[V])==null?void 0:At.options)?[...Re[V].options]:[]};return yt.options[te]={...yt.options[te]||{},label:String(((Yt=yt.options[te])==null?void 0:Yt.label)||""),price:Rt,priceDigits:vt},Re[V]=yt,{...Ie,variants:Re}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{v(De=>{var Qe;const Ie=Array.isArray(De.variants)?[...De.variants]:[],Ye={...Ie[V]||{},options:Array.isArray((Qe=Ie[V])==null?void 0:Qe.options)?[...Ie[V].options]:[]};return Ye.options.splice(te,1),Ie[V]=Ye,{...De,variants:Ie}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{v(U=>{var De;const te=Array.isArray(U.variants)?[...U.variants]:[],u={...te[V]||{},options:Array.isArray((De=te[V])==null?void 0:De.options)?[...te[V].options]:[]},F=Fe(U.price);return u.options.push({label:"",price:F,priceDigits:String(F)}),te[V]=u,{...U,variants:te}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{v(R=>{const V=Fe(R.price),U=Array.isArray(R.variants)?[...R.variants]:[],te=String(V);return U.push({name:"Size",options:[{label:"S",price:V,priceDigits:te},{label:"M",price:V,priceDigits:te},{label:"L",price:V,priceDigits:te}]}),{...R,variants:U}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:gt,disabled:!Array.isArray(j.variants)||j.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},j.image?React.createElement(React.Fragment,null,React.createElement("img",{src:j.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>v({...j,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var R;return(R=ke.current)==null?void 0:R.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:ke,type:"file",accept:"image/*",className:"d-none",onChange:ca}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var R;return(R=ke.current)==null?void 0:R.click()},disabled:fe,style:{borderRadius:"10px"}},fe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:j.image,onChange:R=>v({...j,image:R.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:J,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Z,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const ra=r=>window.KTM.money.formatVND(r),ta=r=>{if(r==null||r==="")return[];let h=r;if(typeof h=="string"){const I=h.trim();if(!I)return[];try{h=JSON.parse(I)}catch(J){return[]}}return Array.isArray(h)?h:[]},oa=r=>{if(r==null||r==="")return[];let h=r;if(typeof h=="string"){const I=h.trim();if(!I)return[];try{h=JSON.parse(I)}catch(J){return[]}}return h&&typeof h=="object"&&!Array.isArray(h)&&(h=Object.entries(h).map(([I,J])=>({key:I,value:J}))),Array.isArray(h)?h:[]},aa=(r,h={})=>{var j;const I=oa(r).map(v=>{var Z,me,fe,Q,ke;return{key:String((fe=(me=(Z=v==null?void 0:v.key)!=null?Z:v==null?void 0:v.name)!=null?me:v==null?void 0:v.label)!=null?fe:"").trim(),value:String((Q=v==null?void 0:v.value)!=null?Q:"").trim(),unit:String((ke=v==null?void 0:v.unit)!=null?ke:"").trim()}}).filter(v=>!!v.key);if(!I.length)return null;const J=!!h.compact,ne=String((j=h.className)!=null?j:"").trim();return React.createElement("div",{className:`ktm-variants-preview${J?" compact":""}${ne?" "+ne:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},I.map((v,Z)=>{const me=v.key,fe=`${v.value||""}${v.unit?(v.value?" ":"")+v.unit:""}`.trim();return React.createElement("div",{key:`${me}-${Z}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},me),fe?React.createElement("span",{className:"ktm-chip ktm-chip-option"},fe):null)})))},va=(r,h={})=>{var me;const I=ta(r).map(fe=>{var Q;return{name:String((Q=fe==null?void 0:fe.name)!=null?Q:"").trim(),options:Array.isArray(fe==null?void 0:fe.options)?fe.options:[]}}).map(fe=>({...fe,options:fe.options.map(Q=>{var ke;return{label:String((ke=Q==null?void 0:Q.label)!=null?ke:"").trim(),price:Number(Q==null?void 0:Q.price)}}).filter(Q=>!!Q.label)})).filter(fe=>fe.options.length>0);if(!I.length)return null;const J=Number.isFinite(h.maxGroups)?Math.max(1,Math.trunc(h.maxGroups)):I.length,ne=Number.isFinite(h.maxOptionsPerGroup)?Math.max(1,Math.trunc(h.maxOptionsPerGroup)):3,j=!!h.compact,v=String((me=h.className)!=null?me:"").trim(),Z=I.slice(0,J);return React.createElement("div",{className:`ktm-variants-preview${j?" compact":""}${v?" "+v:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Z.map((fe,Q)=>{const ke=fe.name||"Bi\u1EBFn th\u1EC3",dt=fe.options.slice(0,ne),Fe=fe.options.length-dt.length;return React.createElement("div",{key:`${ke}-${Q}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ke),dt.map((ft,Et)=>{const St=ft.price,gt=Number.isFinite(St)&&St>=0?ra(Math.trunc(St)):"",la=gt?`${ft.label} \xB7 ${gt}`:ft.label;return React.createElement("span",{key:`${ke}-${Q}-${Et}`,className:"ktm-chip ktm-chip-option"},la)}),Fe>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",Fe))})))},Ha=(r,h)=>{const I=r._type==="product",J=r._type==="album",ne=r._type==="video",j=r.note&&(r.note.toLowerCase().includes("free")||r.note.toLowerCase().includes("gi\u1EA3m")||r.note.toLowerCase().includes("sale")),v=I?aa(r.attributes,{compact:$e==="grid",className:$e==="grid"?"meta text-muted":"text-muted"}):null,Z=I?va(r.variants,{compact:$e==="grid",maxOptionsPerGroup:999,className:$e==="grid"?"meta text-muted":"text-muted"}):null;return $e==="grid"?React.createElement("div",{key:r.id||h,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>ct({url:r.image,name:r.name,price:r.price,note:r.note,item:r})},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${ne?"fa-video":"fa-image"} fa-2x text-muted`})),r.price&&React.createElement("div",{className:"price-overlay"},r.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${I?"product":J?"album":"video"}`},I?"SP":J?"\u1EA2nh":"Video"),j&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},r.name),r.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},r.note),v&&React.createElement("div",{style:{marginTop:2}},v),Z&&React.createElement("div",{style:{marginTop:2}},Z),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:pe===r.id+"-img"?"copied":"",onClick:()=>Fa(r.image,r.id)},React.createElement("i",{className:"fas fa-image"})),r.price&&React.createElement("button",{className:pe===r.id+"-price"?"copied":"",onClick:()=>Ut(r.price.replace(/[đ\s]/g,""),r.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:r.id||h,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${I?"product":J?"album":"video"}`},I?"S\u1EA3n ph\u1EA9m":J?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy",onClick:()=>ct({url:r.image,name:r.name,price:r.price,note:r.note,item:r})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${ne?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},r.name),React.createElement("div",{className:"price-row"},r.price&&React.createElement("span",{className:"price"},r.price.replace(/[đ\s]/g,""),"\u0111"),j&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),v&&React.createElement("div",{style:{marginTop:4}},v),Z&&React.createElement("div",{style:{marginTop:4}},Z)),React.createElement("div",{className:"meta"},r.code&&React.createElement("span",{className:"meta-tag"},"#",r.code),r.category&&React.createElement("span",{className:"meta-tag"},r.category),r.note&&React.createElement("span",{className:"meta-tag highlight"},r.note),r.folder&&React.createElement("span",{className:"meta-tag"},r.folder),ne&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},I&&React.createElement("button",{onClick:()=>k&&k("orders","create",{productId:r.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),r.price&&React.createElement("button",{className:pe===r.id+"-price"?"copied":"",onClick:()=>Ut(r.price.replace(/[đ\s]/g,""),r.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:pe===r.id+"-name"?"copied":"",onClick:()=>Ut(r.name,r.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),ne&&r.youtubeId&&React.createElement("button",{className:pe===r.id+"-yt"?"copied":"",onClick:()=>Ut(`https://www.youtube.com/watch?v=${r.youtubeId}`,r.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),I&&React.createElement("button",{className:"action-edit",onClick:()=>Pt(r)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>de(r)},React.createElement("i",{className:"fas fa-trash"}))))},[Xt,wt]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,P.length)," k\u1EBFt qu\u1EA3",Pe&&A.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),ve!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},ve==="product"?"S\u1EA3n ph\u1EA9m":ve==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${$e==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>be("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${$e==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>be("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},T?React.createElement("div",null,[...Array(8)].map((r,h)=>React.createElement("div",{key:h,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):P.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',A,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{G(""),Bt("")}},"Xem t\u1EA5t c\u1EA3")):$e==="grid"?React.createElement("div",{className:"product-grid-mobile"},P.map((r,h)=>Ha(r,h))):React.createElement("div",null,P.map((r,h)=>Ha(r,h)))),Xt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>wt(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${ve==="all"?"active":""}`,onClick:()=>{ia("all"),wt(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${ve==="product"?"active":""}`,onClick:()=>{ia("product"),wt(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${ve==="album"?"active":""}`,onClick:()=>{ia("album"),wt(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${ve==="video"?"active":""}`,onClick:()=>{ia("video"),wt(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Pe,onChange:r=>it(r.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:le,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:A,onChange:r=>Bt(r.target.value),onFocus:()=>{A.trim()&&wt(!0)}}),React.createElement("button",{className:`filter-btn ${Xt||ve!=="all"?"active":""}`,onClick:()=>wt(!Xt)},React.createElement("i",{className:"fas fa-filter"})))),f&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>_(!1)},React.createElement("div",{className:"search-palette",onClick:r=>r.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:C,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:re,onChange:r=>Bt(r.target.value),onKeyDown:r=>{r.key==="Enter"&&P.length>0?(Oe(re),_(!1)):r.key==="Escape"&&_(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>_(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((r,h)=>React.createElement("span",{key:r,className:`filter-chip ${ve===["all","product","album","video"][h]?"active":""}`,onClick:()=>{ia(["all","product","album","video"][h])}},r)))),H.length>0&&!re.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},H.map((r,h)=>React.createElement("div",{key:h,className:"palette-item",onClick:()=>{Bt(r),Oe(r)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,r),React.createElement("button",{className:"unsave-btn",onClick:I=>{I.stopPropagation(),nt(r)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),W.length>0&&!re.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},W.map((r,h)=>React.createElement("div",{key:h,className:"palette-item",onClick:()=>{Bt(r)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,r),React.createElement("button",{className:"save-btn",onClick:I=>{I.stopPropagation(),nt(r)}},React.createElement("i",{className:`fas fa-star${H.includes(r)?"":"-o"}`})))))),re.trim()&&P.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",P.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},P.slice(0,8).map((r,h)=>React.createElement("div",{key:r.id||h,className:"palette-result-item",onClick:()=>{Oe(re),_(!1)}},r.image&&React.createElement("img",{src:r.image,alt:r.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},r.name),r.price&&React.createElement("div",{className:"result-meta"},r.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:I=>{I.stopPropagation(),nt(re)}},React.createElement("i",{className:`fas fa-star${H.includes(re)?"":"-o"}`})))))),re.trim()&&P.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',re,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:D?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>Be(!0),onTouchStart:()=>Be(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Ne&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>Be(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},at.map((r,h)=>React.createElement("div",{key:h,className:`mb-3 ${r.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${r.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:r.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},r.content,r.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:pe===`chat-${h}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:pe===`chat-${h}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(r.content),he(`chat-${h}`),setTimeout(()=>he(null),1500)}},React.createElement("i",{className:`fas ${pe===`chat-${h}`?"fa-check":"fa-copy"}`})),r.attachments&&r.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},r.attachments.map((I,J)=>React.createElement("div",{key:J,style:{width:70},className:"text-center"},I.image&&React.createElement("img",{src:I.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>ct({url:I.image,name:I.name,price:I.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},I.name),I.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},I.price.replace(/[đ\s]/g,""),"\u0111"))))))),qe&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:pt})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(r=>React.createElement("button",{key:r,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>$t(r),disabled:qe,style:{whiteSpace:"nowrap"}},r))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:r=>{r.preventDefault(),$t(je)},className:"chat-input-wrap"},React.createElement("input",{ref:Ot,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:je,onChange:r=>ut(r.target.value),disabled:qe}),React.createElement("button",{type:"submit",className:"send-btn",disabled:qe||!je.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),bt&&React.createElement("div",{className:"preview-modal",onClick:()=>ct(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>ct(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:r=>r.stopPropagation()},React.createElement("img",{src:bt.url,alt:bt.name})),React.createElement("div",{className:"preview-footer",onClick:r=>r.stopPropagation()},React.createElement("div",{className:"name"},bt.name),bt.price&&React.createElement("div",{className:"price"},bt.price.replace(/[đ\s]/g,""),"\u0111"),bt.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},bt.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:pe==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:pe==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Fa(bt.url,"preview")},React.createElement("i",{className:`fas ${pe==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),bt.price&&React.createElement("button",{className:pe==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Ut(bt.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${pe==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Za,{show:we,product:Ke,categories:ue,onClose:()=>{K(!1),Xe(null)},onSave:Vt}),React.createElement("div",{className:`fab-container mobile-only ${D?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{ie(!1),K(!0),Xe(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{ie(!1),k&&k("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${D?"open":""}`,onClick:()=>ie(!D)},React.createElement("i",{className:"fas fa-plus"}))),kt&&c&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>S(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:st.name,onChange:r=>xe({...st,name:r.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:st.code,onChange:r=>xe({...st,code:r.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:st.price,onChange:r=>xe({...st,price:r.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:st.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:r=>xe({...st,commission_percent:r.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:st.category,onChange:r=>xe({...st,category:r.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Je.map(r=>React.createElement("option",{key:r,value:r},r)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:st.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:r=>xe({...st,note:r.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>S(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:ba},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:x,showToast:k}){const[A,G]=useState([]),[P,M]=useState([]),[O,ce]=useState(!0),[ue,ee]=useState(null),[ve,Me]=useState(!1),[pe,he]=useState(null),[$e,be]=useState(!1),[T,Le]=useState(null),[We,Ve]=useState(!1),[ge,Ae]=useState(null),[le,Pe]=useState(!1),[it,ht]=useState(!1),[Se,Ue]=useState(null),[lt,g]=useState(!1),[f,_]=useState(null),[W,X]=useState([]);useEffect(()=>{H()},[]);const H=async(w=null)=>{ce(!0);try{const E=w?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${w}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Oe=await window.KTM.api.getJSON(E,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");G(Array.isArray(Oe)?Oe:[])}catch(E){console.error(E),k("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}ce(!1)},z=async w=>{try{const E=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${w}`,"L\u1ED7i t\u1EA3i video");M(Array.isArray(E)?E:[])}catch(E){console.error(E)}},re=async w=>{if(w===0)return;const E=[...A];[E[w-1],E[w]]=[E[w],E[w-1]],G(E),await C(E)},b=async w=>{if(w===A.length-1)return;const E=[...A];[E[w],E[w+1]]=[E[w+1],E[w]],G(E),await C(E)},C=async w=>{try{await Promise.all(w.map((E,Oe)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${E.id}`,{sortOrder:Oe},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),k("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(E){k("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),H(f==null?void 0:f.id)}},L=async w=>{if(w===0)return;const E=[...P];[E[w-1],E[w]]=[E[w],E[w-1]],M(E),await oe(E)},Y=async w=>{if(w===P.length-1)return;const E=[...P];[E[w],E[w+1]]=[E[w+1],E[w]],M(E),await oe(E)},oe=async w=>{try{await Promise.all(w.map((E,Oe)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${E.id}`,{sort_order:Oe},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),k("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(E){k("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),z(ue.id)}},se=()=>{he(null),Me(!0)},ye=w=>{Ue(w),ht(!0),g(!0)},Ne=async(w,E="modal")=>{try{!pe&&f&&(w.parent_id=f.id);const Oe=pe?`${API_BASE}/api/video-folders/${pe.id}`:`${API_BASE}/api/video-folders`;pe?await window.KTM.api.putJSON(Oe,w,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Oe,w,"L\u1ED7i l\u01B0u folder"),k(pe?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),E==="drawer"?(g(!1),he(null),H(f==null?void 0:f.id),pe&&Se&&Ue({...Se,...w})):(Me(!1),he(null),H(f==null?void 0:f.id))}catch(Oe){k(Oe.message,"danger")}},Be=async w=>{const E=w.subfolderCount>0?`X\xF3a folder "${w.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${w.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(E))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${w.id}`,"L\u1ED7i x\xF3a folder"),k("\u0110\xE3 x\xF3a folder","success"),ee(null),H(f==null?void 0:f.id)}catch(Oe){k("L\u1ED7i x\xF3a folder","danger")}},at=w=>{w.subfolderCount>0?(X(E=>[...E,w]),_(w),H(w.id)):(ee(w),M(w.videos||[]))},ae=w=>{if(w==="root")X([]),_(null),H(null);else if(w){const E=W.findIndex(Oe=>Oe.id===w.id);E>=0&&(X(W.slice(0,E+1)),_(w),H(w.id))}else{const E=[...W];E.pop();const Oe=E[E.length-1]||null;X(E),_(Oe),H(Oe==null?void 0:Oe.id)}},je=()=>{ht(!1),g(!1),Ue(null)},ut=()=>{Ve(!1),Pe(!1),Ae(null)},qe=()=>{Le(null),be(!0)},Nt=w=>{Ae(w),Ve(!0),Pe(!0)},pt=async(w,E="modal")=>{try{w.folder_id=ue==null?void 0:ue.id;const Oe=T?`${API_BASE}/api/videos/${T.id}`:`${API_BASE}/api/videos`;T?await window.KTM.api.putJSON(Oe,w,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Oe,w,"L\u1ED7i l\u01B0u video"),k(T?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),E==="drawer"?(Pe(!1),Le(null),H(),ue&&z(ue.id),T&&ge&&Ae({...ge,...w})):(be(!1),Le(null),H(),ue&&z(ue.id))}catch(Oe){k(Oe.message,"danger")}},Ot=async w=>{if(confirm(`X\xF3a video "${w.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${w.id}`,"L\u1ED7i x\xF3a video"),k("\u0110\xE3 x\xF3a video","success"),H(),ue&&z(ue.id)}catch(E){k("L\u1ED7i x\xF3a video","danger")}},_t=w=>{const E=`https://www.youtube.com/watch?v=${w.youtubeId}`;window.KTM.clipboard.writeText(E).then(()=>{k("\u0110\xE3 copy link!","success")}).catch(()=>{k("Kh\xF4ng th\u1EC3 copy link","danger")})};return ue?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ee(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${ue.slug==="shorts"?"text-danger":"text-warning"}`}),ue.name)),React.createElement("button",{className:"btn btn-warning",onClick:qe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),P.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},P.map((w,E)=>React.createElement("div",{key:w.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>L(E),disabled:E===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},E+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Y(E),disabled:E===P.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:w.thumb,className:"card-img-top",alt:w.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${w.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:w.title},w.title),React.createElement("small",{className:"text-muted"},w.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>_t(w),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Nt(w),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Ot(w),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:$e,video:T,onClose:()=>be(!1),onSave:pt}),React.createElement(AdminDrawer,{open:it,title:Se?Se.name:"Folder",subtitle:Se?`${Se.subfolderCount||0} subfolder \u2022 ${Se.videoCount||0} videos`:"",onClose:je,footer:lt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:je},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Se&&Ne({name:Se.name||"",description:Se.description||"",sortOrder:Se.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Se?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Se.name),k("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{g(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Se.name}"?`)&&(Be(Se),je())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},lt&&Se?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Se.name||"",onChange:w=>Ue({...Se,name:w.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Se.description||"",onChange:w=>Ue({...Se,description:w.target.value})}))):Se?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Se.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Se.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Se.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Se.videoCount||0))),Se.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Se.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:We,title:ge?ge.title:"Video",subtitle:ge?`${ge.youtubeId}`:"",onClose:ut,footer:le?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:ut},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{ge&&pt({youtube_url:`https://www.youtube.com/watch?v=${ge.youtubeId}`,title:ge.title||"",thumbnail_url:ge.thumb||"",sort_order:ge.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):ge?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const w=`https://www.youtube.com/watch?v=${ge.youtubeId}`;window.KTM.clipboard.writeText(w).then(()=>{k("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Pe(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${ge.title}"?`)&&(Ot(ge),ut())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},le&&ge?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:ge.title||"",onChange:w=>Ae({...ge,title:w.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:ge.youtubeId||"",onChange:w=>Ae({...ge,youtubeId:w.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ge.sortOrder||0,onChange:w=>Ae({...ge,sortOrder:parseInt(w.target.value)||0})}))):ge?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},ge.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},ge.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},ge.sortOrder||0))),ge.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:ge.thumb,alt:ge.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},f&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ae()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),f?f.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:se},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),W.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:w=>{w.preventDefault(),ae("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),W.map((w,E)=>React.createElement("li",{key:w.id,className:`breadcrumb-item ${E===W.length-1?"active":""}`},E===W.length-1?w.name:React.createElement("a",{href:"#",onClick:Oe=>{Oe.preventDefault(),ae(w)},className:"text-warning"},w.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),O?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):A.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},f?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:se},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",f?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},A.map((w,E)=>{var Oe,nt,bt,ct;return React.createElement("div",{key:w.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:kt=>{kt.stopPropagation(),re(E)},disabled:E===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},E+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:kt=>{kt.stopPropagation(),b(E)},disabled:E===A.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>at(w),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${w.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},w.name),React.createElement("p",{className:"text-muted mb-0"},w.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),w.subfolderCount," folder"),w.subfolderCount>0&&(w.videoCount>0||((Oe=w.videos)==null?void 0:Oe.length)>0)&&" \u2022 ",(w.videoCount>0||((nt=w.videos)==null?void 0:nt.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),w.videoCount||((bt=w.videos)==null?void 0:bt.length)||0," videos"),w.subfolderCount===0&&!w.videoCount&&!((ct=w.videos)!=null&&ct.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:kt=>{kt.stopPropagation(),ye(w)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:kt=>{kt.stopPropagation(),Be(w)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:ve,folder:pe,onClose:()=>Me(!1),onSave:Ne}))}function VideoFolderModal({show:x,folder:k,onClose:A,onSave:G}){const[P,M]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[O,ce]=useState(!1),[ue,ee]=useState(!1);useEffect(()=>{M(k?{name:k.name||"",description:k.description||"",sortOrder:k.sortOrder||0,coverImage:k.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[k,x]);const ve=async pe=>{const he=pe.target.files[0];if(he){ee(!0);try{const $e=await window.KTM.cloudinary.uploadImage({file:he,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});$e.secure_url&&M(be=>({...be,coverImage:$e.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch($e){console.error("Cloudinary upload error:",$e),alert("L\u1ED7i upload \u1EA3nh: "+($e.message||$e))}finally{ee(!1)}}},Me=async pe=>{pe.preventDefault(),ce(!0);const he={...P,variants:normalizeVariants(P.variants,P.price),attributes:normalizeAttributes(P.attributes)};await G(he),ce(!1)};return x?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},k?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:Me},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:P.name,onChange:pe=>M({...P,name:pe.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:P.description,onChange:pe=>M({...P,description:pe.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sortOrder,onChange:pe=>M({...P,sortOrder:parseInt(pe.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},P.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:P.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>M({...P,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:ve,disabled:ue}),ue&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:P.coverImage,onChange:pe=>M({...P,coverImage:pe.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:A},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:x,settings:k}){const[A,G]=useState([]),[P,M]=useState(!0),[O,ce]=useState(!1),[ue,ee]=useState(null),[ve,Me]=useState(""),[pe,he]=useState(""),[$e,be]=useState(!1),[T,Le]=useState(null),We=normalizeShipPercent(k==null?void 0:k.ship_percent),{parseMoney:Ve,formatVND:ge}=window.KTM.money,Ae=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{le()},[]);const le=async()=>{M(!0);try{const b=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");G(Array.isArray(b)?b:[])}catch(b){console.error(b),x("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}M(!1)},Pe=()=>{ee(null),ce(!0)},it=b=>{ee(b),ce(!0)},ht=b=>{b&&(Le(b),be(!0))},Se=()=>{be(!1)},Ue=async b=>{if(!(!b||!b.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:b},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),x(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),le()}catch(C){x("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},lt=async b=>{try{const C=ue?`${API_BASE}/api/products?id=${ue.id}`:`${API_BASE}/api/products`;ue?await window.KTM.api.putJSON(C,b,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(C,b,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),x(ue?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ce(!1),le()}catch(C){x(C.message,"danger")}},g=async b=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${b.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${b.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),x("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),le()}catch(C){x(C.message,"danger")}},f=A.filter(b=>{const C=!ve||b.name.toLowerCase().includes(ve.toLowerCase())||b.code&&b.code.toLowerCase().includes(ve.toLowerCase()),L=!pe||b.category===pe;return C&&L}),_=b=>{var Y;const C=(Y=b==null?void 0:b.commission_percent)!=null?Y:b==null?void 0:b.commissionPercent,L=C===""||C==null?NaN:Number(C);return Number.isFinite(L)?Math.max(0,Math.min(100,L)):5},W=b=>{const C=_(b),L=Number.isInteger(C)?String(C):String(Math.round(C*100)/100),Y=Ve(b==null?void 0:b.price);if(!Number.isFinite(Y)||Y<=0)return`${L}%`;const oe=(Number(C)||0)/100,ye=window.KTM.money.parseShipFeeFromNote(b==null?void 0:b.note)!=null?0:We>0?Y*We/100:0,Ne=Y*oe-ye*oe,Be=Math.max(0,Math.round(Ne));return`${L}% - ${ge(Be)}`},X=b=>{if(b==null||b==="")return[];let C=b;if(typeof C=="string"){const L=C.trim();if(!L)return[];try{C=JSON.parse(L)}catch(Y){return[]}}return Array.isArray(C)?C:[]},H=b=>{if(b==null||b==="")return[];let C=b;if(typeof C=="string"){const L=C.trim();if(!L)return[];try{C=JSON.parse(L)}catch(Y){return[]}}return C&&typeof C=="object"&&!Array.isArray(C)&&(C=Object.entries(C).map(([L,Y])=>({key:L,value:Y}))),Array.isArray(C)?C:[]},z=b=>{const C=H(b).map(L=>{var Y,oe,se,ye,Ne;return{key:String((se=(oe=(Y=L==null?void 0:L.key)!=null?Y:L==null?void 0:L.name)!=null?oe:L==null?void 0:L.label)!=null?se:"").trim(),value:String((ye=L==null?void 0:L.value)!=null?ye:"").trim(),unit:String((Ne=L==null?void 0:L.unit)!=null?Ne:"").trim()}}).filter(L=>!!L.key);return C.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},C.map((L,Y)=>{const oe=L.key,se=`${L.value||""}${L.unit?(L.value?" ":"")+L.unit:""}`.trim();return React.createElement("div",{key:`${oe}-${Y}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},oe),se?React.createElement("span",{className:"ktm-chip ktm-chip-option"},se):null)}))):null},re=(b,C={})=>{const L=X(b).map(ye=>{var Ne;return{name:String((Ne=ye==null?void 0:ye.name)!=null?Ne:"").trim(),options:Array.isArray(ye==null?void 0:ye.options)?ye.options:[]}}).map(ye=>({...ye,options:ye.options.map(Ne=>{var Be;return{label:String((Be=Ne==null?void 0:Ne.label)!=null?Be:"").trim(),price:Number(Ne==null?void 0:Ne.price)}}).filter(Ne=>!!Ne.label)})).filter(ye=>ye.options.length>0);if(!L.length)return null;const Y=Number.isFinite(C.maxGroups)?Math.max(1,Math.trunc(C.maxGroups)):L.length,oe=Number.isFinite(C.maxOptionsPerGroup)?Math.max(1,Math.trunc(C.maxOptionsPerGroup)):4,se=L.slice(0,Y);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},se.map((ye,Ne)=>{const Be=ye.name||"Bi\u1EBFn th\u1EC3",at=ye.options.slice(0,oe),ae=ye.options.length-at.length;return React.createElement("div",{key:`${Be}-${Ne}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Be),at.map((je,ut)=>{const qe=je.price,Nt=Number.isFinite(qe)&&qe>=0?ge(Math.trunc(qe)):"",pt=Nt?`${je.label} \xB7 ${Nt}`:je.label;return React.createElement("span",{key:`${Be}-${Ne}-${ut}`,className:"ktm-chip ktm-chip-option"},pt)}),ae>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",ae))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Pe},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:ve,onChange:b=>Me(b.target.value)})),React.createElement("span",{className:"product-count"},f.length)),React.createElement("select",{className:"form-select",value:pe,onChange:b=>he(b.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),Ae.map(b=>React.createElement("option",{key:b,value:b},b)))),P?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):f.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Pe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},f.map(b=>React.createElement("div",{key:b.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>ht(b),onKeyDown:C=>{(C.key==="Enter"||C.key===" ")&&(C.preventDefault(),ht(b))},title:"Xem chi ti\u1EBFt"},b.image?React.createElement("img",{src:b.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},b.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},b.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},b.category),b.code&&React.createElement("span",{className:"product-badge bg-secondary"},b.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),W(b))),React.createElement("div",{className:"product-price"},b.price?b.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),b.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},b.note),z(b.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},z(b.attributes)),re(b.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},re(b.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:C=>{C.stopPropagation(),it(b)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:C=>{C.stopPropagation(),g(b)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:$e,title:String((T==null?void 0:T.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((T==null?void 0:T.code)||"").trim()||null,String((T==null?void 0:T.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Se,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const b=String((T==null?void 0:T.code)||"").trim();b&&window.KTM.clipboard.writeText(b).then(()=>x("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((T==null?void 0:T.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const b=String((T==null?void 0:T.price)||"").trim();b&&window.KTM.clipboard.writeText(b).then(()=>x("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((T==null?void 0:T.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>T&&it(T),disabled:!T},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>T&&g(T),disabled:!T},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},T?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const b=String((T==null?void 0:T.price)||"").trim(),C=Ve(b);return Number.isFinite(C)&&C>0?ge(Math.trunc(C)):b||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},W(T)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},T.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},T.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),T.image?React.createElement("img",{src:T.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(T.note||"").trim()||T.attributes||T.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(T.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(T.note||"").trim()),z(T.attributes)?React.createElement("div",{className:"mt-2"},z(T.attributes)):null,re(T.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},re(T.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:O,product:ue,categories:Ae,onClose:()=>ce(!1),onSave:lt}))}function ProductModal({show:x,product:k,categories:A,onClose:G,onSave:P}){const[M,O]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[ce,ue]=useState(!1),[ee,ve]=useState(!1),Me=g=>{const f=window.KTM.money.getDigits(String(g!=null?g:"")),_=Number(f);return f&&Number.isFinite(_)?Math.trunc(_):0},pe=g=>{if(g==null||g==="")return[];let f=g;if(typeof f=="string"){const _=f.trim();if(!_)return[];try{f=JSON.parse(_)}catch(W){return[]}}return f&&typeof f=="object"&&!Array.isArray(f)&&(f=Object.entries(f).map(([_,W])=>({key:_,value:W}))),Array.isArray(f)?f.map(_=>{var z,re,b,C,L;if(!_||typeof _!="object")return null;const W=String((b=(re=(z=_.key)!=null?z:_.name)!=null?re:_.label)!=null?b:"").trim(),X=String((C=_.value)!=null?C:"").trim(),H=String((L=_.unit)!=null?L:"").trim();return W?{key:W,value:X,unit:H}:null}).filter(Boolean):[]},he=(g,f)=>{if(g==null||g==="")return[];let _=g;if(typeof _=="string"){const X=_.trim();if(!X)return[];try{_=JSON.parse(X)}catch(H){return[]}}if(!Array.isArray(_))return[];const W=Me(f);return _.map(X=>{var re;if(!X||typeof X!="object")return null;const H=String((re=X.name)!=null?re:"").trim(),z=(Array.isArray(X.options)?X.options:[]).map(b=>{var ye,Ne,Be,at,ae,je,ut;if(!b||typeof b!="object")return null;const C=String((ye=b.label)!=null?ye:"").trim();if(!C)return null;const L=(ae=(at=(Be=(Ne=b.price)!=null?Ne:b.priceValue)!=null?Be:b.unit_price)!=null?at:b.unitPrice)!=null?ae:null,Y=Number(L);let oe=Number.isFinite(Y)?Math.trunc(Y):null;if(oe==null){const qe=(ut=(je=b.price_delta)!=null?je:b.priceDelta)!=null?ut:null,Nt=Number(qe);Number.isFinite(Nt)&&(oe=W+Math.trunc(Nt))}oe==null&&(oe=W);const se=String(Math.max(0,Math.trunc(Number(oe)||0)));return{label:C,price:Math.max(0,Math.trunc(Number(oe)||0)),priceDigits:se}}).filter(Boolean);return{name:H||"Bi\u1EBFn th\u1EC3",options:z}}).filter(Boolean)};useEffect(()=>{var g,f;O(k?{name:k.name||"",code:k.code||"",price:k.price||"",image:k.image||"",category:k.category||"",note:k.note||"",sort_order:k.sort_order||0,commission_percent:(f=(g=k.commission_percent)!=null?g:k.commissionPercent)!=null?f:5,variants:he(k.variants,k.price),attributes:pe(k.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[k,x]);const $e=g=>{O(f=>{var z;const _=Me(f.price),W=String(_),X=Array.isArray(f.variants)?[...f.variants]:[],H={...X[g]||{},options:Array.isArray((z=X[g])==null?void 0:z.options)?[...X[g].options]:[]};return H.options=H.options.map(re=>({label:String((re==null?void 0:re.label)||""),price:_,priceDigits:W})),X[g]=H,{...f,variants:X}})},be=()=>{O(g=>{const f=Me(g.price),_=String(f),X=(Array.isArray(g.variants)?[...g.variants]:[]).map(H=>{const z=(Array.isArray(H==null?void 0:H.options)?H.options:[]).map(re=>({label:String((re==null?void 0:re.label)||""),price:f,priceDigits:_}));return{name:String((H==null?void 0:H.name)||"Bi\u1EBFn th\u1EC3"),options:z}});return{...g,variants:X}})},[T,Le]=React.useState(""),We=g=>window.KTM.money.formatVNDInputDigits(g),[Ve,ge]=React.useState(""),Ae=g=>{const f=window.KTM.money.nextPriceInputState(g.target.value,Ve);ge(f.digits),O({...M,price:f.price})},[le,Pe]=React.useState("");React.useEffect(()=>{k!=null&&k.image&&Pe(k.image)},[k]);const it=async g=>{if(!(!g||!g.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:g},"L\u1ED7i x\xF3a \u1EA3nh")}catch(f){console.error("Delete cloudinary image error:",f)}},ht=async(g,f=2,_)=>{const W=f*1024*1024,X=g.type==="image/heic"||g.type==="image/heif"||/\.heic$/i.test(g.name);if(g.size<=W&&!X)return g;_==null||_("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const H=await createImageBitmap(g);_==null||_("\u0110ang n\xE9n \u1EA3nh...");const z=document.createElement("canvas");let re=H.width,b=H.height;const C=1200;return(re>C||b>C)&&(re>b?(b=Math.round(b/re*C),re=C):(re=Math.round(re/b*C),b=C)),z.width=re,z.height=b,z.getContext("2d").drawImage(H,0,0,re,b),H.close(),new Promise((Y,oe)=>{z.toBlob(se=>{se?(_==null||_("Ho\xE0n t\u1EA5t!"),Y(new File([se],g.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):oe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(H){throw console.error("createImageBitmap error:",H),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Se=async g=>{var W,X;const f=(W=g.target.files)==null?void 0:W[0];if(!f)return;if(!(f.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(f.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ve(!0),Le("\u0110ang chu\u1EA9n b\u1ECB...");try{const H=(f.size/1024/1024).toFixed(1);Le(`File ${H}MB - \u0110ang n\xE9n...`);const z=await ht(f,2,C=>{Le(C)}),re=(z.size/1024/1024).toFixed(1);Le(`\u0110\xE3 n\xE9n: ${re}MB - \u0110ang upload...`);const b=await window.KTM.cloudinary.uploadImage({file:z,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});b.secure_url?(M.image&&M.image!==le&&it(M.image),O(C=>({...C,image:b.secure_url})),Le("")):(console.error("Cloudinary error:",b),alert("Upload th\u1EA5t b\u1EA1i: "+(((X=b.error)==null?void 0:X.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Le(""))}catch(H){console.error("Upload error:",H),alert("L\u1ED7i: "+H.message),Le("")}ve(!1),g.target.value=""},Ue=()=>{M.image&&(M.image!==le&&it(M.image),O(g=>({...g,image:""})))},lt=async g=>{g.preventDefault(),ue(!0),le&&M.image&&le!==M.image&&await it(le),le&&!M.image&&await it(le),await P(M),ue(!1)};return x?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${k?"fa-edit":"fa-plus-circle"} me-2`}),k?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:G})),React.createElement("form",{onSubmit:lt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},M.image?React.createElement(React.Fragment,null,React.createElement("img",{src:M.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Ue,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${ee?"fa-spinner fa-spin":"fa-camera"} me-1`}),ee?T||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Se,disabled:ee,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),ee&&T&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},T))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:M.name,onChange:g=>O({...M,name:g.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:M.code,onChange:g=>O({...M,code:g.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:M.price,onChange:Ae,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:M.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:g=>O({...M,commission_percent:g.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:M.category,onChange:g=>O({...M,category:g.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),A.map(g=>React.createElement("option",{key:g,value:g},g)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:M.note,onChange:g=>O({...M,note:g.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(M.attributes)?M.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(M.attributes)?M.attributes:[]).map((g,f)=>React.createElement("div",{key:f,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(g==null?void 0:g.key)||"",onChange:_=>{const W=_.target.value;O(X=>{const H=Array.isArray(X.attributes)?[...X.attributes]:[];return H[f]={...H[f]||{},key:W},{...X,attributes:H}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(g==null?void 0:g.value)||"",onChange:_=>{const W=_.target.value;O(X=>{const H=Array.isArray(X.attributes)?[...X.attributes]:[];return H[f]={...H[f]||{},value:W},{...X,attributes:H}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(g==null?void 0:g.unit)||"",onChange:_=>{const W=_.target.value;O(X=>{const H=Array.isArray(X.attributes)?[...X.attributes]:[];return H[f]={...H[f]||{},unit:W},{...X,attributes:H}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{O(_=>{const W=Array.isArray(_.attributes)?[..._.attributes]:[];return W.splice(f,1),{..._,attributes:W}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{O(g=>{const f=Array.isArray(g.attributes)?[...g.attributes]:[];return f.push({key:"",value:"",unit:""}),{...g,attributes:f}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(M.variants)?M.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(M.variants)?M.variants:[]).map((g,f)=>React.createElement("div",{key:f,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(g==null?void 0:g.name)||"",onChange:_=>{const W=_.target.value;O(X=>{var z;const H=Array.isArray(X.variants)?[...X.variants]:[];return H[f]={...H[f]||{},name:W,options:Array.isArray((z=H[f])==null?void 0:z.options)?H[f].options:[]},{...X,variants:H}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>$e(f),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(g==null?void 0:g.options)||g.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{O(_=>{const W=Array.isArray(_.variants)?[..._.variants]:[];return W.splice(f,1),{..._,variants:W}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(g==null?void 0:g.options)?g.options:[]).map((_,W)=>{var X,H;return React.createElement("div",{key:W,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(_==null?void 0:_.label)||"",onChange:z=>{const re=z.target.value;O(b=>{var se,ye,Ne,Be,at;const C=Array.isArray(b.variants)?[...b.variants]:[],L={...C[f]||{},options:Array.isArray((se=C[f])==null?void 0:se.options)?[...C[f].options]:[]},Y=Number((Ne=(ye=L.options[W])==null?void 0:ye.price)!=null?Ne:0)||0,oe=String((at=(Be=L.options[W])==null?void 0:Be.priceDigits)!=null?at:Math.max(0,Math.trunc(Y)));return L.options[W]={...L.options[W]||{},label:re,price:Math.max(0,Math.trunc(Y)),priceDigits:oe},C[f]=L,{...b,variants:C}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:We(String((H=_==null?void 0:_.priceDigits)!=null?H:window.KTM.money.getDigits(String((X=_==null?void 0:_.price)!=null?X:"")))),onChange:z=>{O(re=>{var Ne,Be,at,ae,je;const b=String((Be=_==null?void 0:_.priceDigits)!=null?Be:window.KTM.money.getDigits(String((Ne=_==null?void 0:_.price)!=null?Ne:""))),C=window.KTM.money.nextPriceInputState(z.target.value,b),L=String((at=C.digits)!=null?at:""),Y=Number(L),oe=Number.isFinite(Y)?Math.max(0,Math.trunc(Y)):0,se=Array.isArray(re.variants)?[...re.variants]:[],ye={...se[f]||{},options:Array.isArray((ae=se[f])==null?void 0:ae.options)?[...se[f].options]:[]};return ye.options[W]={...ye.options[W]||{},label:String(((je=ye.options[W])==null?void 0:je.label)||""),price:oe,priceDigits:L},se[f]=ye,{...re,variants:se}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{O(z=>{var C;const re=Array.isArray(z.variants)?[...z.variants]:[],b={...re[f]||{},options:Array.isArray((C=re[f])==null?void 0:C.options)?[...re[f].options]:[]};return b.options.splice(W,1),re[f]=b,{...z,variants:re}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{O(_=>{var z;const W=Array.isArray(_.variants)?[..._.variants]:[],X={...W[f]||{},options:Array.isArray((z=W[f])==null?void 0:z.options)?[...W[f].options]:[]},H=Me(_.price);return X.options.push({label:"",price:H,priceDigits:String(H)}),W[f]=X,{..._,variants:W}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{O(g=>{const f=Me(g.price),_=Array.isArray(g.variants)?[...g.variants]:[],W=String(f);return _.push({name:"Size",options:[{label:"S",price:f,priceDigits:W},{label:"M",price:f,priceDigits:W},{label:"L",price:f,priceDigits:W}]}),{...g,variants:_}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:be,disabled:!Array.isArray(M.variants)||M.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:M.image,onChange:g=>O({...M,image:g.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:G,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:ce,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ce?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:x,video:k,onClose:A,onSave:G}){const[P,M]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[O,ce]=useState(!1),[ue,ee]=useState("");useEffect(()=>{k?(M({title:k.title||"",youtube_url:`https://www.youtube.com/watch?v=${k.youtubeId}`,thumbnail_url:k.thumb||"",sort_order:k.sortOrder||0}),ee(k.thumb)):(M({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),ee(""))},[k,x]);const ve=he=>{const $e=he.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return $e?$e[1]:null},Me=he=>{M({...P,youtube_url:he});const $e=ve(he);$e&&ee(`https://img.youtube.com/vi/${$e}/hqdefault.jpg`)},pe=async he=>{he.preventDefault(),ce(!0),await G(P),ce(!1)};return x?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},k?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:pe},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:P.youtube_url,onChange:he=>Me(he.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),ue&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:ue,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:P.title,onChange:he=>M({...P,title:he.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sort_order,onChange:he=>M({...P,sort_order:parseInt(he.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:P.thumbnail_url,onChange:he=>M({...P,thumbnail_url:he.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:A},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[x,k]=useState(!1),[A,G]=useState(""),[P,M]=useState(null),[O,ce]=useState("search"),[ue,ee]=useState(()=>loadAdminPins()),[ve,Me]=useState(()=>loadAdminRecent()),[pe,he]=useState(null),[$e,be]=useState(""),[T,Le]=useState([]),[We,Ve]=useState(null),[ge,Ae]=useState(!1),[le,Pe]=useState(null),[it,ht]=useState(!0),[Se,Ue]=useState([]),[lt,g]=useState(!1),[f,_]=useState(null),[W,X]=useState(!1),[H,z]=useState(!1),[re,b]=useState(""),[C,L]=useState(()=>loadAdminSettings()),[Y,oe]=useState(null),[se,ye]=useState([]);useEffect(()=>{const c=localStorage.getItem("ktm_admin_session");if(c)try{const $=JSON.parse(c);$.expiry>Date.now()?(k(!0),M($.user)):localStorage.removeItem("ktm_admin_session")}catch($){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{x&&qe()},[x]),useEffect(()=>{const c=()=>{try{const D=document.querySelector(".admin-topbar");if(!D)return;const ie=D.getBoundingClientRect(),we=Math.max(0,Math.round(ie.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${we+10}px`)}catch(D){}};c(),window.addEventListener("resize",c);const $=setTimeout(c,0);return()=>{clearTimeout($),window.removeEventListener("resize",c)}},[x,O]),useEffect(()=>{var D,ie;const c=window.visualViewport,$=()=>{try{const we=Number(window.innerHeight)||0,K=Number(c==null?void 0:c.height)||we,Ke=Number(c==null?void 0:c.offsetTop)||0,Xe=Math.max(0,Math.round(we-K-Ke));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${Xe}px`)}catch(we){}};$(),window.addEventListener("resize",$);try{(D=c==null?void 0:c.addEventListener)==null||D.call(c,"resize",$),(ie=c==null?void 0:c.addEventListener)==null||ie.call(c,"scroll",$)}catch(we){}return()=>{var we,K;window.removeEventListener("resize",$);try{(we=c==null?void 0:c.removeEventListener)==null||we.call(c,"resize",$),(K=c==null?void 0:c.removeEventListener)==null||K.call(c,"scroll",$)}catch(Ke){}}},[]),useEffect(()=>{if(!x)return;const c=D=>{if(!D)return!1;const ie=String(D.tagName||"").toLowerCase();return!!(ie==="input"||ie==="textarea"||ie==="select"||D.isContentEditable)},$=D=>{if(!D||D.ctrlKey||D.metaKey||D.altKey||c(D.target))return;const ie=D.key;(ie==="/"||ie==="N"||ie==="n"||ie==="Escape"||ie==="j"||ie==="J"||ie==="k"||ie==="K")&&(ie==="/"&&D.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:ie}})))};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[x]),useEffect(()=>{x&&Me(c=>{const $=Array.isArray(c)?c:[],D=[O,...$.filter(ie=>ie!==O)].slice(0,8);return saveAdminRecent(D),D})},[x]);const Ne=c=>{const $=String(c||"").trim();$&&Me(D=>{const ie=Array.isArray(D)?D:[],we=[$,...ie.filter(K=>K!==$)].slice(0,8);return saveAdminRecent(we),we})},Be=c=>{const $=String(c||"").trim();$&&ee(D=>{const ie=Array.isArray(D)?D:[],K=ie.includes($)?ie.filter(Ke=>Ke!==$):[$,...ie].slice(0,10);return saveAdminPins(K),K})};useEffect(()=>{if(!x)return;let c=!1;return(async()=>{try{const $=await fetchAdminSettingsFromServer();if(c)return;L($),saveAdminSettings($)}catch($){}})(),()=>{c=!0}},[x]);const at=async(c,$)=>{G("");try{const D=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:c,password:$},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),ie={user:D.user,token:D.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(ie)),M(D.user),k(!0)}catch(D){G(D.message)}},ae=()=>{localStorage.removeItem("ktm_admin_session"),k(!1),M(null),Le([]),Ve(null)},je=(c,$="success",D=null)=>{const ie=Date.now()+Math.floor(Math.random()*1e3);if(c&&typeof c=="object"){const K=c;Ue(Ke=>[...Ke,{id:ie,message:String(K.message||""),type:String(K.type||$||"success"),actionLabel:K.actionLabel||null,onAction:typeof K.onAction=="function"?K.onAction:null,durationMs:K.durationMs||null}]);return}const we=D&&typeof D=="object"?D:null;Ue(K=>[...K,{id:ie,message:String(c||""),type:String($||"success"),actionLabel:(we==null?void 0:we.actionLabel)||null,onAction:typeof(we==null?void 0:we.onAction)=="function"?we.onAction:null,durationMs:(we==null?void 0:we.durationMs)||null}])},ut=c=>{Ue($=>$.filter(D=>D.id!==c))},qe=async(c=null)=>{ht(!0);try{const $=c?`${API_BASE}/api/albums?parent_id=${c}`:`${API_BASE}/api/albums?parent_id=root`,D=await window.KTM.api.getJSON($,"L\u1ED7i t\u1EA3i danh s\xE1ch album");Le(Array.isArray(D)?D:[])}catch($){console.error($),je("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}ht(!1)},Nt=()=>{Pe(null),Ae(!0)},pt=c=>{Oe(c),X(!0)},Ot=async(c,$="modal")=>{try{const D=le&&le.uuid;!D&&Y&&(c.parent_id=Y.uuid);const ie=D?`${API_BASE}/api/albums/${le.uuid||le.id}`:`${API_BASE}/api/albums`;D?await window.KTM.api.putJSON(ie,c,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(ie,c,"L\u1ED7i t\u1EA1o"),je(D?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),$==="drawer"?(X(!1),Pe(null),qe(Y==null?void 0:Y.uuid),D&&f&&_({...f,...c})):(Ae(!1),Pe(null),qe(Y==null?void 0:Y.uuid))}catch(D){je(D.message,"danger")}},_t=c=>{Ve(c)},w=c=>{if(c==="root")ye([]),oe(null),qe(null);else if(c){const $=se.findIndex(D=>D.uuid===c.uuid);$>=0&&(ye(se.slice(0,$+1)),oe(c),qe(c.uuid))}else{const $=[...se];$.pop();const D=$[$.length-1]||null;ye($),oe(D),qe(D==null?void 0:D.uuid)}},E=async c=>{const $=`X\xF3a folder "${c.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm($))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${c.uuid||c.id}`,"L\u1ED7i x\xF3a album"),je("\u0110\xE3 x\xF3a","success"),qe(Y==null?void 0:Y.uuid)}catch(D){je("L\u1ED7i x\xF3a album","danger")}},Oe=async c=>{c&&(g(!0),b(""),z(!1),X(!1),_(c))},nt=()=>{g(!1),z(!1),b(""),X(!1),_(null)},bt=c=>{X(!0)};if(!x)return React.createElement(LoginPage,{onLogin:at,error:A});const ct=()=>{const c=new Date,$=c.getFullYear(),D=String(c.getMonth()+1).padStart(2,"0");return`${$}-${D}`};function kt(){const[c,$]=useState(()=>{var K;return String((K=C==null?void 0:C.ship_percent)!=null?K:DEFAULT_SHIP_PERCENT)}),[D,ie]=useState(!1);return useEffect(()=>{var K;$(String((K=C==null?void 0:C.ship_percent)!=null?K:DEFAULT_SHIP_PERCENT))},[C==null?void 0:C.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async K=>{K.preventDefault(),ie(!0);const Ke=saveAdminSettings({ship_percent:c});try{const Xe=await saveAdminSettingsToServer(Ke);L(Xe),saveAdminSettings(Xe),je("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Xe){L(Ke),je("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{ie(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:c,min:"0",max:"100",step:"0.01",onChange:K=>$(K.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:D},D?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function S(){const[c,$]=useState(ct()),[D,ie]=useState(!0),we=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[K,Ke]=useState(we),Xe=useRef(new Map),st=normalizeShipPercent(C==null?void 0:C.ship_percent),{formatNumber:xe,formatVND:Je}=window.KTM.money,Pt=async(de,Vt=!1)=>{var ga,Bt;const Gt=String(de||"").trim();if(!Gt)return we();const fa=`${Gt}|${st}`,Tt=(ga=Xe.current)==null?void 0:ga.get(fa);if(!Vt&&Tt)return Tt;const jt=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(Gt)}&ship_percent=${encodeURIComponent(st)}`,Mt=await window.KTM.api.getJSON(jt,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Wt=Mt!=null&&Mt.stats&&(Mt!=null&&Mt.meta)?Mt.stats:Mt,ha=Wt&&typeof Wt=="object"?Wt:we();return(Bt=Xe.current)==null||Bt.set(fa,ha),ha},ba=async(de=!1)=>{ie(!0);try{const Vt=await Pt(c,de);Ke(Vt)}catch(Vt){console.error("Load stats error:",Vt),Ke(we())}finally{ie(!1)}};return useEffect(()=>{ba()},[c,st]),React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:D}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>ba(!0),disabled:D},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:c,onChange:de=>$(de.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",st,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),xe(K.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),xe(K.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),xe(K.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",xe(K.statusCounts.paid),"/",xe(K.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},xe(K.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Je(K.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Je(K.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Je(K.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Je(K.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",K.avgQtyPerOrder?K.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},xe(K.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},xe(K.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},xe(K.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},xe(K.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},xe(K.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},xe(K.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},xe(K.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,xe(K.statusCounts.draft)),React.createElement("td",null,xe(K.statusCounts.pending)),React.createElement("td",null,xe(K.statusCounts.processing)),React.createElement("td",null,xe(K.statusCounts.canceled)),React.createElement("td",null,xe(K.statusCounts.done)),React.createElement("td",null,xe(K.statusCounts.paid)),React.createElement("td",null,xe(K.statusCounts.other)),React.createElement("td",null,xe(K.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},K.products.slice(0,10).map(de=>React.createElement("div",{key:de.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},de.product_name),React.createElement("div",{className:"text-muted small text-truncate"},de.product_code?`#${de.product_code} \u2022 `:"",xe(de.orders)," \u0111\u01A1n \u2022 ",xe(de.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Je(de.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,K.products.slice(0,10).map(de=>React.createElement("tr",{key:de.product_id},React.createElement("td",null,de.product_name),React.createElement("td",null,de.product_code||"\u2014"),React.createElement("td",null,xe(de.orders)),React.createElement("td",null,xe(de.quantity)),React.createElement("td",{className:"fw-semibold"},Je(de.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},K.customers.slice(0,10).map(de=>React.createElement("div",{key:de.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},de.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},de.phone||"\u2014"," \u2022 ",xe(de.orders)," \u0111\u01A1n \u2022 ",xe(de.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Je(de.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,K.customers.slice(0,10).map(de=>React.createElement("tr",{key:de.key},React.createElement("td",null,de.customer_name||"\u2014"),React.createElement("td",null,de.phone||"\u2014"),React.createElement("td",null,xe(de.orders)),React.createElement("td",null,xe(de.quantity)),React.createElement("td",{className:"fw-semibold"},Je(de.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},K.days.map(de=>React.createElement("div",{key:de.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},de.day),React.createElement("div",{className:"text-muted small"},xe(de.orders)," \u0111\u01A1n \u2022 ",xe(de.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",xe(de.doneOrders)," \u2022 ",Je(de.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Je(de.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,K.days.map(de=>React.createElement("tr",{key:de.day},React.createElement("td",null,de.day),React.createElement("td",null,xe(de.orders)),React.createElement("td",null,xe(de.quantity)),React.createElement("td",{className:"fw-semibold"},Je(de.revenue)),React.createElement("td",null,xe(de.doneOrders)),React.createElement("td",{className:"fw-semibold"},Je(de.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:O,onMenuChange:c=>{Ne(c),ce(c),c==="albums"&&(oe(null),ye([]),qe(null))},onLogout:ae,currentUser:P,pinnedMenus:ue,recentMenus:ve,onTogglePin:Be}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const $={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[O]||{title:"KTM Admin",icon:"fa-tractor",sub:""},D=(P==null?void 0:P.username)||(P==null?void 0:P.name)||(P==null?void 0:P.email)||"Admin",ie=(()=>{if(O!=="albums")return"";const we=[];return we.push("Root"),Array.isArray(se)&&se.length>0&&we.push(...se.map(K=>K==null?void 0:K.title).filter(Boolean)),We!=null&&We.title&&we.push(We.title),we.length>0?we.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${$.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},$.title),React.createElement("div",{className:"admin-page-subtitle"},ie||$.sub))),React.createElement("div",{className:"admin-topbar-right"},O==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:Nt,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:D},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},D)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:ae,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},O==="albums"&&!We&&React.createElement(AlbumList,{albums:T,loading:it,currentFolder:Y,breadcrumb:se,onSelect:_t,onCreate:Nt,onEdit:pt,onDelete:E,onBack:w}),O==="search"&&React.createElement(SearchCenter,{showToast:je,onNavigate:(c,$,D)=>{ce(c),c==="orders"&&$==="create"&&(he(Date.now()),be((D==null?void 0:D.productId)||""))}}),O==="albums"&&We&&React.createElement(AlbumDetail,{album:We,parentAlbum:se.length>0?se[se.length-1]:null,onBack:()=>{if(We.parentId){const c=se.findIndex($=>$.uuid===We.parentId);c>=0?Ve(se[c]):Ve(null)}else Ve(null)},onRefresh:()=>qe(Y==null?void 0:Y.uuid),showToast:je,onNavigateToFolder:c=>{ye($=>[...$,We]),Ve(c)},onEditSubfolder:c=>{Pe(c),Ae(!0)}}),O==="videos"&&React.createElement(VideoList,{showToast:je}),O==="products"&&React.createElement(ProductManager,{showToast:je,settings:C}),O==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:pe,autoOpenCreateProductId:$e,showToast:je}),O==="stats"&&React.createElement(S,null),O==="settings"&&React.createElement(kt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${O==="search"?"active":""}`,onClick:c=>{c.preventDefault(),ce("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${O==="albums"?"active":""}`,onClick:c=>{c.preventDefault(),ce("albums"),Ve(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${O==="videos"?"active":""}`,onClick:c=>{c.preventDefault(),ce("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${O==="products"?"active":""}`,onClick:c=>{c.preventDefault(),ce("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${O==="orders"?"active":""}`,onClick:c=>{c.preventDefault(),ce("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${O==="stats"?"active":""}`,onClick:c=>{c.preventDefault(),ce("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:ge,album:le,parentId:Y==null?void 0:Y.uuid,onClose:()=>Ae(!1),onSave:Ot}),React.createElement(AdminDrawer,{open:lt,title:f?f.title:"Album",subtitle:f?`${f.subfolderCount||0} subfolder \u2022 ${f.count||0} \u1EA3nh`:"",onClose:nt,footer:W?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{X(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{f&&(Pe(f),Ot({slug:f.id||"",title:f.title||"",description:f.description||"",cover_url:f.cover||"",parent_id:f.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):f?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(f.title),je("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>bt(f)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{f&&confirm(`X\xF3a folder "${f.title}"?`)&&(E(f),nt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},W&&f?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:f.title,onChange:c=>_({...f,title:c.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:f.description,onChange:c=>_({...f,description:c.target.value})}))):f?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},f.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},f.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},f.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},f.count||0))),f.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,f.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Se.map(c=>React.createElement(Toast,{key:c.id,message:c.message,type:c.type,actionLabel:c.actionLabel,onAction:c.onAction,durationMs:c.durationMs,onClose:()=>ut(c.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:x,autoOpenCreateProductId:k,showToast:A}){const[G,P]=useState([]),[M,O]=useState(0),[ce,ue]=useState(!1),[ee,ve]=useState(!1),[Me,pe]=useState([]),[he,$e]=useState(!0),[be,T]=useState(!1),[Le,We]=useState([]),[Ve,ge]=useState(!1),[Ae,le]=useState(""),[Pe,it]=useState([]),[ht,Se]=useState(!1),[Ue,lt]=useState(""),[g,f]=useState(!1),[_,W]=useState(null),[X,H]=useState(null),[z,re]=useState(!1),[b,C]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[L,Y]=useState(""),[oe,se]=useState(!1),[ye,Ne]=useState(!1),[Be,at]=useState(!1),[ae,je]=useState(null),[ut,qe]=useState(!1),[Nt,pt]=useState(""),[Ot,_t]=useState(!1),w=useRef(0),[E,Oe]=useState(!1),[nt,bt]=useState(null),[ct,kt]=useState(!1),[S,c]=useState(null),[$,D]=useState(()=>({left:12,top:12,placement:"bottom"})),ie=useRef(null),we=useRef(!1),K=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1}),[Ke,Xe]=useState(()=>({id:null,dir:null})),st=useRef(!1),xe=useRef(new Map),Je=useRef(null),Pt=useRef(null),ba="ktm_orders_status_sync_queue_v1",de=useRef([]),Vt=useRef(!1),[Gt,fa]=useState(()=>({})),[Tt,jt]=useState(!1),[Mt,Wt]=useState(!1),[ha,ga]=useState(!1),[Bt,ia]=useState(()=>new Set),[Ut,Fa]=useState(()=>({})),Qa="ktm_orders_pinned_v1",[$t,Za]=useState(()=>new Set),[ra,ta]=useState(!1),[oa,aa]=useState(!1),[va,Ha]=useState(!1),[Xt,wt]=useState(""),[r,h]=useState(()=>[]),I=useRef(null),J=useRef(null),ne=useRef(!1),j=useRef({active:!1,startY:0,startX:0,fired:!1}),[v,Z]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),me=24,fe=20,[Q,ke]=useState(me),dt=useRef(null),Fe=useRef(null),ft=useRef(!1),Et=useRef(new Map),St=useRef({timer:null,events:[]}),gt=useRef(null),la="ktm_orders_phone_tip_v1",xn="ktm_orders_search_history_v1",[et,Lt]=useState(null),[_a,Dt]=useState(!1),[ca,Ta]=useState([]),[R,V]=useState(!1),[U,te]=useState([]),[u,F]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[De,Ie]=useState([""]),[Ye,Qe]=useState(null),vt=useRef({}),[rt,Rt]=useState([]),[Re,yt]=useState(null),qt=useRef(null),Ct=useRef(null),Kt=useRef(0),At=useRef(null),Yt=useRef(0),Va=useRef(new Map),na=useRef(null),ya=useRef(0),Fn=useRef(new Map),Ma=useRef(new Map),$a=useRef(""),Hn=useRef(null),kn=useRef(null),Sn=useRef(0),Cs=useRef(null),Vn=9,As=150,_s=250,Ts=3*60*1e3,Ms=24*60*60*1e3,$s=5*60*1e3,Bn="ktm_customer_lookup_cache_v1",Is=200,da=3,en=3,Cn=1,Os=24*60*60*1e3,js=120,Ls=5*60*1e3,qn=80,zn=2,Jn=4,Gn=60,Ce=React.useMemo(()=>String(Ae||"").trim().length>0,[Ae]),Ba=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),Wn=e=>{bt(e),Oe(!0)},Un=(e,a)=>{var t,n,s,i;try{const d=(t=a==null?void 0:a.getBoundingClientRect)==null?void 0:t.call(a),l=window.innerWidth||360,y=window.innerHeight||640,m=230,o=280,p=Math.min(Math.max(10,Math.round((n=d==null?void 0:d.left)!=null?n:10)),Math.max(10,l-m-10));let N=Math.round(((s=d==null?void 0:d.bottom)!=null?s:10)+8),B="bottom";N+o>y-10&&(N=Math.max(10,Math.round(((i=d==null?void 0:d.top)!=null?i:10)-8-o)),B="top"),D({left:p,top:N,placement:B})}catch(d){D({left:12,top:12,placement:"bottom"})}c(e),kt(!0)},Na=()=>{kt(!1),setTimeout(()=>c(null),120)};useEffect(()=>{if(!ct)return;const e=a=>{a.key==="Escape"&&Na()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ct]);const wa=()=>{Oe(!1),setTimeout(()=>bt(null),180)},Ds=()=>{jt(!0)},tn=()=>{jt(!1)},Xn=e=>{const a=String(e||"").trim();a&&ia(t=>{const n=new Set(t);return n.has(a)?n.delete(a):n.add(a),n})};useEffect(()=>{try{const e=localStorage.getItem(Qa);if(!e)return;const a=JSON.parse(e);if(!Array.isArray(a))return;Za(new Set(a.map(t=>String(t||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from($t||[]).map(a=>String(a||"").trim()).filter(Boolean);localStorage.setItem(Qa,JSON.stringify(e))}catch(e){}},[$t]);const Rs=e=>{const a=String(e||"").trim();a&&Za(t=>{const n=new Set(t);return n.has(a)?n.delete(a):n.add(a),n})};useEffect(()=>{try{const e=localStorage.getItem(xn);if(!e)return;const a=JSON.parse(e);if(!Array.isArray(a))return;h(a.map(t=>String(t||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Ps=e=>{try{localStorage.setItem(xn,JSON.stringify(e))}catch(a){}},qa=e=>{const a=String(e||"").trim();a&&h(t=>{const n=Array.isArray(t)?t:[],s=[a,...n.filter(i=>String(i||"").trim().toLowerCase()!==a.toLowerCase())].slice(0,10);return Ps(s),s})},Yn=e=>{var t;const a=String((t=e!=null?e:Ae)!=null?t:"").trim();wt(a),Ha(!0),setTimeout(()=>{var n,s;try{(s=(n=I.current)==null?void 0:n.focus)==null||s.call(n)}catch(i){}},0)},zt=()=>{Ha(!1)};useEffect(()=>{if(!va)return;const e=a=>{a.key==="Escape"&&zt()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[va]),useEffect(()=>{if(!v)return;const e=n=>{if(va||(window.scrollY||0)>6)return;const s=n.touches&&n.touches[0];s&&(j.current={active:!0,startY:s.clientY,startX:s.clientX,fired:!1})},a=n=>{const s=j.current;if(!(s!=null&&s.active)||s.fired||(window.scrollY||0)>6)return;const i=n.touches&&n.touches[0];if(!i)return;const d=i.clientY-s.startY,l=i.clientX-s.startX;Math.abs(l)>24||d>92&&(s.fired=!0,Yn(Ae))},t=()=>{j.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",a,{passive:!0}),window.addEventListener("touchend",t,{passive:!0}),window.addEventListener("touchcancel",t,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)}},[v,va,Ae]);const Qn=e=>{try{const a=xt(e==null?void 0:e.status);if(!(a==="pending"||a==="processing"))return!1;const t=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(t.getTime()))return!1;const n=new Date;return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate()}catch(a){return!1}};useEffect(()=>{var t;let e;const a=()=>{try{Z(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(n){Z(!1)}};try{e=(t=window.matchMedia)==null?void 0:t.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",a):e!=null&&e.addListener&&e.addListener(a)}catch(n){e=null}return window.addEventListener("resize",a),a(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",a):e!=null&&e.removeListener&&e.removeListener(a)}catch(n){}window.removeEventListener("resize",a)}},[]),useEffect(()=>{const e="admin-sheet-open";return E||Tt||ct?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[E,Tt,ct]),useEffect(()=>{if(!E&&!Tt&&!ct)return;const e=a=>{a.key==="Escape"&&(E&&wa(),Tt&&tn(),ct&&Na())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[E,Tt,ct]);const Es=()=>{try{if(localStorage.getItem(la))return;localStorage.setItem(la,"1"),typeof A=="function"&&A("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},Zn=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),es=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),ts=e=>{const a=tt(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{window.location.href=`tel:${a}`}catch(t){}},Ks=async e=>{var t,n,s;const a=tt(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{await((s=(n=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:n.call(t,a))!=null?s:Promise.reject(new Error("Clipboard not available"))),typeof A=="function"&&A("\u0110\xE3 copy S\u0110T","success")}catch(i){typeof A=="function"&&A("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Fs=()=>{try{const e=localStorage.getItem(ba),a=e?JSON.parse(e):[];return Array.isArray(a)?a:[]}catch(e){return[]}},as=e=>{try{localStorage.setItem(ba,JSON.stringify(Array.isArray(e)?e:[]))}catch(a){}},an=(e,a)=>{const t=String(e||"").trim();t&&fa(n=>{const s={...n||{}};return a?s[t]=!0:delete s[t],s})},Hs=(e,a,t)=>{const n=String(e||"").trim(),s=xt(a),i=xt(t);if(!n||!s)return;const d=Array.isArray(de.current)?de.current:[],l=new Map(d.map(m=>[String((m==null?void 0:m.orderId)||""),m]));l.set(n,{orderId:n,nextStatus:s,prevStatus:i,ts:Date.now()});const y=Array.from(l.values()).sort((m,o)=>(Number(m.ts)||0)-(Number(o.ts)||0));de.current=y,as(y),an(n,!0)},An=async()=>{if(Vt.current||!navigator.onLine)return;const e=Array.isArray(de.current)?de.current.slice():[];if(e.length){Vt.current=!0;try{for(const a of e){const t=String((a==null?void 0:a.orderId)||"").trim(),n=xt(a==null?void 0:a.nextStatus);if(!(!t||!n)){an(t,!0);try{await Ca({id:t,status:(a==null?void 0:a.prevStatus)||""},n,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const s=(Array.isArray(de.current)?de.current:[]).filter(i=>String((i==null?void 0:i.orderId)||"")!==t);de.current=s,as(s),an(t,!1)}catch(s){if(!navigator.onLine)break}}}}finally{Vt.current=!1}}};useEffect(()=>{const e=Fs();de.current=e;try{const a={};for(const t of e){const n=String((t==null?void 0:t.orderId)||"").trim();n&&(a[n]=!0)}fa(a)}catch(a){}setTimeout(()=>An(),600)},[]),useEffect(()=>{const e=()=>An();window.addEventListener("online",e);const a=setInterval(()=>An(),8e3);return()=>{clearInterval(a),window.removeEventListener("online",e)}},[]);const Vs=(e,a)=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e),ft.current=!1,Es();try{Fe.current&&clearTimeout(Fe.current)}catch(n){}Fe.current=setTimeout(()=>{ft.current=!0,Ks(a)},520)},nn=e=>{var a;(a=e==null?void 0:e.stopPropagation)==null||a.call(e);try{Fe.current&&clearTimeout(Fe.current)}catch(t){}Fe.current=null},Bs=e=>{const a=String(e||"").trim();if(!a)return;Fa(s=>({...s,[a]:Date.now()}));const t=Et.current;try{const s=t.get(a);s&&clearTimeout(s)}catch(s){}const n=setTimeout(()=>{Fa(s=>{const i={...s||{}};return delete i[a],i});try{t.delete(a)}catch(s){}},9e3);t.set(a,n)},ns=e=>String(e||"").replace(/\s+/g," ").trim(),qs=e=>String(e||"").replace(/[^0-9]+/g,""),za=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/Os)}catch(a){return 0}},sn=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:za(e)>=da,xt=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},_n=React.useMemo(()=>["draft","pending","processing","done","paid"],[]),Ia=(e,a)=>{const t=xt(e);if(!t||t==="canceled")return null;const n=_n.indexOf(t);return n<0?null:a==="left"?_n[n+1]||null:a==="right"&&_n[n-1]||null},ss=e=>{var s;const a=xt(e);if(!a)return{label:"",icon:"fa-circle"};const t=((s=Ba.find(i=>xt(i==null?void 0:i.value)===a))==null?void 0:s.label)||"",n=(()=>{switch(a){case"draft":return"fa-file-lines";case"pending":return"fa-hourglass-half";case"processing":return"fa-truck";case"done":return"fa-check";case"paid":return"fa-money-bill-wave";case"canceled":return"fa-ban";default:return"fa-circle"}})();return{label:t,icon:n}},rn=e=>{if(xt(e==null?void 0:e.status)!=="draft")return null;const t=en-za(e);return Number.isFinite(t)?t:null},on=e=>{const a=rn(e);return Number.isFinite(a)?a>0&&a<=Cn:!1},xa=e=>{F({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Ie([""]),Lt(null),Qe(null)};useEffect(()=>{const e=a=>{var n;if(Ye==null)return;const t=(n=vt.current)==null?void 0:n[Ye];t&&!t.contains(a.target)&&Qe(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Ye]);const is=e=>window.KTM.money.parseMoney(e),rs=e=>window.KTM.money.parseSignedMoney(e),Ge=e=>window.KTM.money.formatVND(e),Qt=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var s,i;return{amount:String((s=n==null?void 0:n.amount)!=null?s:""),note:String((i=n==null?void 0:n.note)!=null?i:"")}});return t.length?t:[{amount:"",note:""}]},zs=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var s,i;return{amount:(n==null?void 0:n.amount)===0?"":String((s=n==null?void 0:n.amount)!=null?s:""),note:String((i=n==null?void 0:n.note)!=null?i:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},Oa=e=>(Array.isArray(e)?e:[]).map(t=>({amount:rs(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),Tn=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Oa(a),n=ja(t),s=(()=>{if(!t.length)return"";const i=t.map(d=>String((d==null?void 0:d.note)||"").trim()).filter(Boolean);return i.length?i.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:s}},ja=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),Mn=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},bi=e=>window.KTM.money.parseShipFeeFromNote(e),La=e=>window.KTM.phone.isValid(e),tt=e=>window.KTM.phone.normalize(e),$n=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},Js=(e,a)=>{var i;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const s=new Map(t.map(d=>{var l;return[String((l=d==null?void 0:d.id)!=null?l:""),d]}));for(const d of n){const l=String((i=d==null?void 0:d.id)!=null?i:"");l&&s.set(l,d)}return Array.from(s.values())},ln=async e=>{var a,t,n,s;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const i=(t=(a=xe.current)==null?void 0:a.get)==null?void 0:t.call(a,String(e.id));if(i&&typeof i=="object"&&Array.isArray(i.items)&&i.items.length)return i}catch(i){}try{const i=await $n(e.id);if(i&&typeof i=="object"){try{(s=(n=xe.current)==null?void 0:n.set)==null||s.call(n,String(e.id),i)}catch(d){}return P(d=>Array.isArray(d)?d.map(l=>String(l==null?void 0:l.id)===String(e.id)?i:l):d),i}}catch(i){console.error("Fetch order by id error:",i)}return e},Gs=()=>{var e;try{const a=localStorage.getItem(Bn);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[s,i]of n)!s||!i||typeof i!="object"||(e=Ma.current)==null||e.set(String(s),i)}catch(a){}},In=()=>{try{const e=Ma.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,s])=>n&&s&&typeof s=="object"&&Number.isFinite(s.ts)).sort((n,s)=>(Number(s[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,Is),t={};for(const[n,s]of a)t[n]=s;localStorage.setItem(Bn,JSON.stringify(t))}catch(e){}};useEffect(()=>{Gs()},[]);const os=e=>{const a=tt(e);if(!a)return null;const t=Array.isArray(G)?G:[];let n=null,s=-1;for(const i of t){if(!i||tt(i.phone||"")!==a)continue;const d=new Date(i.created_at).getTime(),l=Number.isFinite(d)?d:0;l>=s&&(s=l,n=i)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},ls=(e,a)=>{e&&F(t=>a&&tt(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Ws=e=>{const a=os(e);if(!a)return;const t=tt(e);F(n=>{if(t&&tt(n.phone)!==t)return n;const s={...n};return!String(n.customer_name||"").trim()&&a.name&&(s.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(s.address=a.address),s})},Us=(e,a,t)=>{var n;try{const s=tt(e);if(!s)return;const i=String(a||"").trim(),d=String(t||"").trim();if(!i&&!d)return;(n=Ma.current)==null||n.set(s,{ts:Date.now(),status:"found",customer:{phone:s,name:i||null,address:d||null}}),In()}catch(s){}},cn=async e=>{var s,i,d;const a=tt(e);if(!a)return;Ws(a);const t=(s=Ma.current)==null?void 0:s.get(a);if(t&&Number.isFinite(t.ts)){const l=Date.now()-t.ts,y=t.status==="found"?Ms:$s;if(l>=0&&l<=y){Lt({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&ls(t.customer,a);return}}const n=++Kt.current;Lt({status:"loading",phone:a});try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Kt.current!==n)return;if(l&&l.exists&&l.customer){(i=Ma.current)==null||i.set(a,{ts:Date.now(),status:"found",customer:l.customer}),In(),Lt({status:"found",phone:a,customer:l.customer}),ls(l.customer,a);return}(d=Ma.current)==null||d.set(a,{ts:Date.now(),status:"not-found",customer:null}),In(),Lt({status:"not-found",phone:a})}catch(l){if(Kt.current!==n)return;console.error("Customer lookup error:",l),Lt({status:"error",phone:a})}},cs=e=>{const a=tt(e),t=os(a);F(s=>{const i={...s,phone:a};return t&&(!String(s.customer_name||"").trim()&&t.name&&(i.customer_name=t.name),!String(s.address||"").trim()&&t.address&&(i.address=t.address)),i}),Dt(!1),Ct.current&&(clearTimeout(Ct.current),Ct.current=null);const n=a;if(n.length<Vn){Lt(null);return}if(La(n)&&n!==$a.current){$a.current=n,cn(n);return}Ct.current=setTimeout(()=>{const s=tt(a);La(s)&&s!==$a.current&&($a.current=s,cn(s))},As)},ds=()=>{const e=tt(u.phone);e.length<Vn||La(e)&&e!==$a.current&&($a.current=e,cn(e))};useEffect(()=>(ye?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[ye]);const dn=Array.isArray(u.items)?u.items.length:0;useEffect(()=>{if(!ye){Sn.current=dn;return}dn>Sn.current&&setTimeout(()=>{const e=Hn.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Sn.current=dn},[ye,dn]),useEffect(()=>()=>{Ct.current&&(clearTimeout(Ct.current),Ct.current=null),At.current&&(clearTimeout(At.current),At.current=null)},[]),useEffect(()=>{if(!ye)return;At.current&&(clearTimeout(At.current),At.current=null);const e=tt((u==null?void 0:u.phone)||"");if(!La(e)){Ta([]),V(!1);return}return At.current=setTimeout(async()=>{var s;const a=String(e),t=(s=Va.current)==null?void 0:s.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=Ts){Ta(Array.isArray(t.orders)?t.orders:[]),V(!1);return}const n=++Yt.current;V(!0);try{const i=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,d=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(Yt.current!==n)return;const l=Array.isArray(d)?d:Array.isArray(d==null?void 0:d.orders)?d.orders:[];Ta(l);try{const y=Va.current;if(y&&typeof y.set=="function"&&(y.set(a,{ts:Date.now(),orders:l}),y.size>100)){const m=Array.from(y.entries()).sort((p,N)=>{var B,q;return(Number((B=p==null?void 0:p[1])==null?void 0:B.ts)||0)-(Number((q=N==null?void 0:N[1])==null?void 0:q.ts)||0)}),o=Math.max(0,m.length-100);for(let p=0;p<o;p++)y.delete(m[p][0])}}catch(y){}}catch(i){if(Yt.current!==n)return;console.error("Phone history fetch error:",i),Ta([])}finally{if(Yt.current!==n)return;V(!1)}},_s),()=>{At.current&&(clearTimeout(At.current),At.current=null)}},[ye,u==null?void 0:u.phone]),useEffect(()=>{Qs()},[]),useEffect(()=>{Ce||ka()},[b,Ce]),useEffect(()=>{pn()},[]),useEffect(()=>{x&&qt.current!==x&&(qt.current=x,bn(k))},[x]);const Jt=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",Da=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",ma=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(G),a=$t;if(!a||!(a instanceof Set)||a.size===0)return e;const t=Array.isArray(e)?e.slice():[];return t.sort((n,s)=>{var l,y;const i=a.has(String((l=n==null?void 0:n.id)!=null?l:""))?1:0;return(a.has(String((y=s==null?void 0:s.id)!=null?y:""))?1:0)-i}),t},[G,$t]),On=React.useMemo(()=>window.KTM.orders.sortOrders(Me),[Me]),mn=React.useMemo(()=>{const a=(Array.isArray(On)?On:[]).filter(t=>sn(t));return a.sort((t,n)=>{const s=new Date(t==null?void 0:t.created_at).getTime(),i=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(s)?s:0)-(Number.isFinite(i)?i:0)}),a},[On]),ms=React.useMemo(()=>{const a=(Array.isArray(Le)?Le:[]).filter(t=>on(t));return a.sort((t,n)=>{const s=new Date(t==null?void 0:t.created_at).getTime(),i=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(s)?s:0)-(Number.isFinite(i)?i:0)}),a},[Le]),Ja=React.useMemo(()=>{if(oe)return mn;let e=ma;if(ra){const a=$t;e=(Array.isArray(e)?e:[]).filter(t=>{var n,s;return(s=a==null?void 0:a.has)==null?void 0:s.call(a,String((n=t==null?void 0:t.id)!=null?n:""))})}return oa&&(e=(Array.isArray(e)?e:[]).filter(a=>Qn(a))),e},[oe,mn,ma,ra,$t,oa]),un=React.useMemo(()=>{if(oe)return Ja;const e=String(L||"").trim();return e?(Array.isArray(Ja)?Ja:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):Ja},[Ja,L,oe]),us=React.useMemo(()=>window.KTM.orders.sortOrders(Pe),[Pe]),mt=React.useMemo(()=>Ce?us:un,[un,Ce,us]),ps=React.useMemo(()=>{const e=Array.isArray(mt)?mt:[];return v?e.slice(0,Math.max(0,Number(Q)||0)):e},[v,Q,mt]);useEffect(()=>{v&&ke(me)},[v,L,oe,b,Ae]),useEffect(()=>{if(!v)return;const e=Array.isArray(mt)?mt.length:0;if(Q>=e)return;const a=dt.current;if(!a)return;const t=new IntersectionObserver(n=>{Array.isArray(n)&&n.some(i=>i==null?void 0:i.isIntersecting)&&ke(i=>Math.min((Number(i)||0)+fe,e))},{root:null,rootMargin:"520px 0px",threshold:0});return t.observe(a),()=>t.disconnect()},[v,Q,mt]),useEffect(()=>{if(!v){Wt(!1),ga(!1);return}const e=()=>{gt.current||(gt.current=window.requestAnimationFrame(()=>{gt.current=null;const a=window.scrollY||document.documentElement.scrollTop||0;Wt(a>140),ga(a>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),gt.current&&(window.cancelAnimationFrame(gt.current),gt.current=null)}},[v]),useEffect(()=>{if(!v){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(a){}return}const e=()=>{try{const a=document.querySelector(".mobile-bottom-nav"),t=a&&a.offsetHeight?a.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${t}px`)}catch(a){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[v]);const ua=React.useMemo(()=>{const e=Array.isArray(mt)?mt:[],a={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const n=xt(t==null?void 0:t.status);n==="draft"?a.draft+=1:n==="pending"?a.pending+=1:n==="processing"?a.processing+=1:n==="done"?a.done+=1:n==="paid"?a.paid+=1:n==="canceled"?a.canceled+=1:a.other+=1}return a},[mt]),Xs=React.useMemo(()=>{const e=$t;return!e||e.size===0?0:(Array.isArray(ma)?ma:[]).reduce((a,t)=>{var n;return a+(e.has(String((n=t==null?void 0:t.id)!=null?n:""))?1:0)},0)},[$t,ma]),Ys=React.useMemo(()=>(Array.isArray(ma)?ma:[]).filter(e=>Qn(e)).length,[ma]),bs=React.useMemo(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`},[]),sa=e=>{if(Ce&&le(""),e==="thisMonth"){se(!1),Y(""),C(bs);return}if(e==="overduePending"){C(""),se(!0),Y("pending");return}if(e==="draftExpiring"){se(!1),Y("draft"),C(""),pn();return}if(e==="all"){se(!1),Y(""),C(bs);return}},Ra=e=>window.KTM.date.formatDateTime(e),Qs=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Rt(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Rt([])}},ka=async()=>{$e(!0),ve(!1);try{const a=new URLSearchParams;b&&a.set("month",String(b)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(Gn)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),s=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],i=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;P(Array.isArray(s)?s:[]),O(Array.isArray(s)?s.length:0),ue(!!(i!=null&&i.hasMore)),pn()}catch(a){console.error("Load orders error:",a),P([]),O(0),ue(!1)}finally{$e(!1),ve(!1)}},Zs=async()=>{if(!(he||ee||Ce)&&ce){ve(!0);try{const e=new URLSearchParams;b&&e.set("month",String(b)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(Gn)),e.set("offset",String(M));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],s=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;P(i=>Js(i,Array.isArray(n)?n:[])),O(i=>i+(Array.isArray(n)?n.length:0)),ue(!!(s!=null&&s.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{ve(!1)}}},fs=async e=>{var s;const a=ns(e);if(!a){it([]),lt(""),Se(!1);return}const t=qs(a);if(a.length<zn&&t.length<Jn){it([]),lt(`Nh\u1EADp \xEDt nh\u1EA5t ${zn} k\xFD t\u1EF1 (ho\u1EB7c ${Jn} s\u1ED1) \u0111\u1EC3 search nhanh`),Se(!1);return}try{const i=(s=Fn.current)==null?void 0:s.get(a);if(i&&Number.isFinite(i.ts)&&Date.now()-i.ts<=Ls){it(Array.isArray(i.results)?i.results:[]),lt(""),Se(!1);return}}catch(i){}const n=++ya.current;Se(!0),lt("");try{const i=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,d=await window.KTM.api.getJSON(i,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(ya.current!==n)return;const l=Array.isArray(d)?d:[];it(l);try{const y=Fn.current;if(y&&typeof y.set=="function"&&(y.set(a,{ts:Date.now(),results:l}),y.size>qn)){const m=Array.from(y.entries()).sort((p,N)=>{var B,q;return(Number((B=p==null?void 0:p[1])==null?void 0:B.ts)||0)-(Number((q=N==null?void 0:N[1])==null?void 0:q.ts)||0)}),o=Math.max(0,m.length-qn);for(let p=0;p<o;p++)y.delete(m[p][0])}}catch(y){}}catch(i){if(ya.current!==n)return;console.error("Order search error:",i),it([]),lt((i==null?void 0:i.message)||"Search l\u1ED7i")}finally{if(ya.current!==n)return;Se(!1)}};useEffect(()=>{na.current&&(clearTimeout(na.current),na.current=null);const e=ns(Ae);if(!e){it([]),lt(""),Se(!1);return}return oe&&se(!1),na.current=setTimeout(()=>{fs(e)},js),()=>{na.current&&(clearTimeout(na.current),na.current=null)}},[Ae]);const pn=async()=>{T(!0),ge(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(da)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Cn)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);pe(Array.isArray(e)?e:[]),We(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),pe([]),We([])}finally{T(!1),ge(!1)}},jn=async e=>{const a=await ln(e);if(!a)return;yt(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(l=>{var y,m,o,p;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((y=l==null?void 0:l.quantity)!=null?y:1)||1,unit_price:(()=>{var q;const N=(q=l==null?void 0:l.unit_price)!=null?q:l==null?void 0:l.unitPrice,B=N==null||N===""?NaN:Number(N);return Number.isFinite(B)?Math.trunc(B):null})(),variant:String((m=l==null?void 0:l.variant)!=null?m:"").trim(),variant_json:(p=(o=l==null?void 0:l.variant_json)!=null?o:l==null?void 0:l.variantJson)!=null?p:null}}).filter(l=>l.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=zs(a),s=Oa(n),i=ja(s),d=Mn(s);F({customer_name:a.customer_name||"",phone:tt(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:i,adjustment_note:d||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),Ie(new Array(t.length?t.length:1).fill("")),te(new Array(t.length?t.length:1).fill(!0)),Lt(null),Ne(!1),je(a),at(!0),pt(""),qe(!1),_t(!0),a.phone&&cn(tt(a.phone))},Ga=async e=>{if(!e)return;at(!0),pt(""),qe(!0),_t(!1),je(e);const a=++w.current;try{const t=await ln(e);if(w.current!==a)return;je(t||e)}catch(t){if(w.current!==a)return;pt((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(w.current!==a)return;qe(!1)}},ei=()=>{g||z||(at(!1),qe(!1),pt(""),_t(!1),yt(null),xa(""),Dt(!1),te([]))};function bn(e){at(!1),_t(!1),qe(!1),pt(""),yt(null),xa(e||""),Dt(!1),te([]),Ne(!0)}const Ln=()=>{g||z||(Ne(!1),yt(null),xa(""),Dt(!1),te([]))},hs=async()=>{var l,y,m;if(!Re||z||g)return;const e=(Array.isArray(G)?G:[]).find(o=>String(o==null?void 0:o.id)===String(Re))||null,a=String((e==null?void 0:e.status)||(u==null?void 0:u.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const o="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof A=="function"?A(o,"warning"):alert(o);return}const t=tt(u.phone),s=(Array.isArray(u.items)?u.items:[]).map((o,p)=>{var N,B;return{idx:p,product_id:String((o==null?void 0:o.product_id)||"").trim(),quantity:Number((N=o==null?void 0:o.quantity)!=null?N:0),variant:String((o==null?void 0:o.variant)||"").trim()||null,variant_json:(B=o==null?void 0:o.variant_json)!=null?B:null,unit_price:(()=>{const q=o==null?void 0:o.unit_price,Te=q===""||q==null?NaN:Number(q);if(Number.isFinite(Te))return Math.max(0,Math.trunc(Te));const _e=Ft(o==null?void 0:o.product_id),ot=o!=null&&o.variant_json&&typeof o.variant_json=="object"?o.variant_json:null;return Pa(_e,ot)})()}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0);if(s.length<2){const o="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof A=="function"?A(o,"warning"):alert(o);return}const i=[],d=[];for(const o of s){const p=!!U[o.idx],N={product_id:o.product_id,quantity:o.quantity,unit_price:o.unit_price,variant:o.variant,variant_json:o.variant_json};p?i.push(N):d.push(N)}if(!i.length||!d.length){const o="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof A=="function"?A(o,"warning"):alert(o);return}re(!0);try{const o=Array.isArray(u==null?void 0:u.adjustment_items)?u.adjustment_items:[],p=Oa(o),N=ja(p),B=Mn(p),q={customer_name:u.customer_name,phone:t,address:u.address,note:(u.note||"").trim(),adjustment_amount:N,adjustment_note:B,adjustment_items:p,status:"processing",items:i,product_id:i[0].product_id,quantity:i[0].quantity,split_seq:1},Te=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,q,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),_e=(m=(y=Te==null?void 0:Te.id)!=null?y:(l=Te==null?void 0:Te.order)==null?void 0:l.id)!=null?m:null;if(!_e)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const ot={id:Re,customer_name:u.customer_name,phone:t,address:u.address,note:(u.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:d,product_id:d[0].product_id,quantity:d[0].quantity,parent_order_id:String(_e),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${Re}`,ot,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Ln(),ka();const Ee=_e?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${_e}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof A=="function"?A(Ee,"success"):alert(Ee)}catch(o){console.error(o);const p=(o==null?void 0:o.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof A=="function"?A(p,"danger"):alert(p)}finally{re(!1)}},gs=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=rt.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Zt=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},ti=e=>{const t=Zt(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},vs=React.useMemo(()=>(Array.isArray(rt)?rt:[]).map((e,a)=>{var m,o,p,N,B,q;const t=Zt((m=e==null?void 0:e.name)!=null?m:""),n=Zt((o=e==null?void 0:e.code)!=null?o:""),s=Zt((p=e==null?void 0:e.category)!=null?p:""),i=Zt((N=e==null?void 0:e.note)!=null?N:""),d=Zt((B=e==null?void 0:e.id)!=null?B:""),l=Zt((q=e==null?void 0:e.stt)!=null?q:""),y=`${t} ${n} ${s} ${i} ${d} ${l}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:s,note:i,haystackAll:y}}),[rt]),ai=(e,a,t)=>{var p,N,B,q,Te;const n=Array.isArray(a)?a:[],s=Zt(t).trim();if(!n.length&&!s)return 0;const i=(p=e==null?void 0:e.name)!=null?p:"",d=(N=e==null?void 0:e.code)!=null?N:"",l=(B=e==null?void 0:e.category)!=null?B:"",y=(q=e==null?void 0:e.note)!=null?q:"";if(!((Te=e==null?void 0:e.haystackAll)!=null?Te:""))return 0;let o=0;s&&(i===s&&(o+=220),i.includes(s)&&(o+=140),i.startsWith(s)&&(o+=160),d&&d===s&&(o+=180),d&&d.includes(s)&&(o+=90));for(const _e of n){if(!_e)continue;const ot=new RegExp(`(?:^|\\s)${_e.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);i.includes(_e)&&(o+=35),ot.test(i)&&(o+=25),d&&d.includes(_e)&&(o+=20),d&&ot.test(d)&&(o+=10),l&&l.includes(_e)&&(o+=12),y&&y.includes(_e)&&(o+=6)}return o>0&&i&&(o+=Math.max(0,10-Math.min(10,Math.floor(i.length/10)))),o},Dn=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const s=t.length,i=n.length;if(i>s)return Dn(n,t);let d=new Array(i+1),l=new Array(i+1);for(let y=0;y<=i;y++)d[y]=y;for(let y=1;y<=s;y++){l[0]=y;const m=t.charCodeAt(y-1);for(let p=1;p<=i;p++){const N=m===n.charCodeAt(p-1)?0:1;l[p]=Math.min(d[p]+1,l[p-1]+1,d[p-1]+N)}const o=d;d=l,l=o}return d[i]},ni=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const s=n.split(/\s+/).filter(Boolean);if(!s.length)return!1;const i=t.length<=4?1:2;for(const d of s)if(!(Math.abs(d.length-t.length)>i)&&Dn(t,d)<=i)return!0;return!1},fn=e=>{const a=Zt(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},si=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=fn((e==null?void 0:e.name)||""),s=fn((e==null?void 0:e.code)||""),i=fn((e==null?void 0:e.category)||""),d=fn((e==null?void 0:e.note)||""),l=(m,o,p)=>{const N=String(m||"").trim();if(!N||!o.length)return 0;const B=N.length<=4?1:2;let q=1/0,Te=-1;for(let Ee=0;Ee<o.length;Ee++){const Ht=o[Ee];if(!Ht||Math.abs(Ht.length-N.length)>B)continue;const Ze=Dn(N,Ht);if(Ze<q&&(q=Ze,Te=Ee,Ze===0))break}if(q===1/0||q>B)return 0;let ot=Math.round(p*(q===0?1:q===1?.65:.45));return Te===0?ot+=Math.round(p*.25):Te===1&&(ot+=Math.round(p*.12)),ot};let y=0;for(const m of t){if(!m)continue;const o=l(m,n,180),p=l(m,s,120),N=l(m,i,60),B=l(m,d,30);y+=Math.max(o,p,N,B)}if(y>0){const m=((e==null?void 0:e.name)||"").length;y+=Math.max(0,60-Math.min(60,Math.floor(m/2)))}return y},Rn=React.useRef(new Map);React.useEffect(()=>{Rn.current=new Map},[rt]);const ys=e=>{var m,o;const a=String(De[e]||"").trim();if(!a)return rt;const{contentTokens:t,cleanedQuery:n}=ti(a);if(t.length===0)return rt;const s=Zt(a).trim(),i=Rn.current.get(s);if(i)return i;const d=[];for(const p of vs){const N=p.haystackAll;N&&t.some(B=>N.includes(B))&&d.push(p)}let l=d;if(l.length<8&&t.length>0){const p=[],N=new Set(l.map(B=>{var q,Te;return String((Te=(q=B.p)==null?void 0:q.id)!=null?Te:"")+":"+String(B.originalIndex)}));for(const B of vs){const q=String((o=(m=B.p)==null?void 0:m.id)!=null?o:"")+":"+String(B.originalIndex);if(N.has(q))continue;const Te=B.haystackAll;Te&&t.some(_e=>ni(_e,Te))&&(p.push(B),N.add(q))}p.length&&(l=l.concat(p))}const y=l.map(p=>({entry:p,score:ai(p,t,n)})).map(p=>{if(p.score>0)return p;const N=si(p.entry,t);return N>0?{...p,score:N}:p}).filter(p=>p.score>0).sort((p,N)=>N.score!==p.score?N.score-p.score:p.entry.originalIndex-N.entry.originalIndex).slice(0,40).map(p=>p.entry.p);return Rn.current.set(s,y),y},Ft=e=>{if(!e)return null;const a=String(e);return rt.find(t=>String(t==null?void 0:t.id)===a)||null},pa=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var d;if(!t||typeof t!="object")return null;const s=String((d=t.name)!=null?d:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,i=(Array.isArray(t.options)?t.options:[]).map(l=>{var Te,_e,ot,Ee,Ht,Ze,ea;if(!l||typeof l!="object")return null;const y=String((Te=l.label)!=null?Te:"").trim();if(!y)return null;const m=(Ht=(Ee=(ot=(_e=l.price)!=null?_e:l.priceValue)!=null?ot:l.unit_price)!=null?Ee:l.unitPrice)!=null?Ht:null,o=m==null||m===""?NaN:typeof m=="number"?m:typeof m=="string"?is(m):Number(m),p=Number.isFinite(o)?Math.trunc(o):null,N=(ea=(Ze=l.price_delta)!=null?Ze:l.priceDelta)!=null?ea:null,B=Number(N),q=Number.isFinite(B)?Math.trunc(B):0;return{label:y,price:p,price_delta:q}}).filter(Boolean);return{name:s,options:i}}).filter(Boolean):[]},fi=e=>{const a=Ft(e);return pa(a==null?void 0:a.variants)},hn=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const s=String(t||"").trim(),i=String(n||"").trim();!s||!i||a.push(`${s}: ${i}`)}return a.join(", ")},Pa=(e,a)=>{const t=is(e==null?void 0:e.price),n=pa(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let s=t,i=!1;for(const d of n){const l=String((d==null?void 0:d.name)||"").trim(),y=String((a==null?void 0:a[l])||"").trim();if(!l||!y)continue;const m=(Array.isArray(d.options)?d.options:[]).find(q=>String((q==null?void 0:q.label)||"").trim()===y);if(!m)continue;const o=m==null?void 0:m.price,p=o==null||o===""?NaN:Number(o);if(Number.isFinite(p)){s=Math.max(0,Math.trunc(p)),i=!0;continue}const N=m==null?void 0:m.price_delta,B=N==null||N===""?NaN:Number(N);Number.isFinite(B)&&(s+=Math.trunc(B))}return s},Pn=e=>window.KTM.orders.getOrderItems(e),Ns=e=>window.KTM.orders.getOrderTotalQty(e),Ea=e=>window.KTM.orders.getOrderProductSummary(e,Ft),gn=e=>window.KTM.orders.getOrderItemRows(e,Ft),Wa=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Sa=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),ii=e=>{const a=Pn(e),t=gn(e),n=Xa(a),s=Ua(a),i=s.fee,d=Wa(e),l=n+i+d,y=o=>{const p=Number(o)||0;return p>0?`+${Ge(p)}`:Ge(p)},m=[];if(e!=null&&e.customer_name&&m.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&m.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&m.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&m.push(`GHI CH\xDA: ${(e.note||"").trim()}`),m.push(""),m.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const o of t)m.push(`- ${o.name} (SL: ${o.qty})`);else{const o=Ea(e);o&&o!=="\u2014"&&m.push(`- ${o}`)}m.push(""),m.push(`T\u1EA0M T\xCDNH: ${Ge(n)}`),s.found&&i!==0&&m.push(`SHIP: ${Ge(i)}`);{const o=window.KTM.orders.getOrderAdjustmentItems(e),p=(Array.isArray(o)?o:[]).map(q=>{var Te;return{amount:Number((Te=q==null?void 0:q.amount)!=null?Te:0)||0,note:String((q==null?void 0:q.note)||"").trim()}}).filter(q=>q.amount!==0||!!q.note),N=Sa(e);if(d!==0||p.length>0||!!N)if(p.length===1){const q=p[0];m.push(`\u0110I\u1EC0U CH\u1EC8NH: ${y(d)}${q.note?` \u2014 ${q.note}`:""}`)}else{m.push(`\u0110I\u1EC0U CH\u1EC8NH: ${y(d)}${!p.length&&N?` \u2014 ${N}`:""}`);for(const q of p)m.push(`- ${y(q.amount)}${q.note?`: ${q.note}`:""}`)}}return m.push(`T\u1ED4NG: ${Ge(l)}`),m.filter(Boolean).join(`
`)},vn=async e=>{try{const a=await ln(e),t=ii(a);await window.KTM.clipboard.writeText(t),typeof A=="function"?A("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof A=="function"?A("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Ua=e=>window.KTM.orders.getOrderShipInfo(e,Ft),Xa=e=>window.KTM.orders.getItemsSubtotal(e,Ft),En=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},Kn=()=>b?String(b):En(new Date),ws=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=tt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),s=Tn(e).amount,d=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(l=>{var y;return{product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((y=l==null?void 0:l.quantity)!=null?y:0),variant:String((l==null?void 0:l.variant)||"").trim()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0).sort((l,y)=>l.product_id<y.product_id?-1:l.product_id>y.product_id?1:l.variant<y.variant?-1:l.variant>y.variant?1:l.quantity-y.quantity);return JSON.stringify({name:a,phone:t,address:n,items:d,adj:s})},It=React.useMemo(()=>{const e=tt((u==null?void 0:u.phone)||"");if(!e)return{count:0,orders:[],monthKey:Kn()};const a=Kn(),n=(Array.isArray(ca)?ca:[]).filter(s=>{if(!s||Re&&String(s.id)===String(Re)||tt(s.phone||"")!==e)return!1;const i=En(s.created_at);return i&&i===a}).sort((s,i)=>{const d=new Date(s.created_at).getTime(),l=new Date(i.created_at).getTime();return(Number.isFinite(l)?l:0)-(Number.isFinite(d)?d:0)});return{count:n.length,orders:n,monthKey:a}},[ca,u==null?void 0:u.phone,b,Re]),ri=e=>{var l;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=tt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),s=rs((l=e==null?void 0:e.adjustment_amount)!=null?l:0),i=Pn(e),d=(Array.isArray(i)?i:[]).map(y=>{var m;return{product_id:String((y==null?void 0:y.product_id)||"").trim(),quantity:Number((m=y==null?void 0:y.quantity)!=null?m:0),variant:String((y==null?void 0:y.variant)||"").trim()}}).filter(y=>y.product_id&&Number.isFinite(y.quantity)&&y.quantity>0).sort((y,m)=>y.product_id<m.product_id?-1:y.product_id>m.product_id?1:y.variant<m.variant?-1:y.variant>m.variant?1:y.quantity-m.quantity);return JSON.stringify({name:a,phone:t,address:n,items:d,adj:s})},xs=React.useMemo(()=>{if(Re)return"";const e=tt((u==null?void 0:u.phone)||"");if(!e)return"";const a=Kn(),t=ws(u),n=Array.isArray(ca)?ca:[];for(const s of n){if(!s||Re&&String(s.id)===String(Re)||tt(s.phone||"")!==e)continue;const i=En(s.created_at);if(!i||i!==a)continue;const d=ri(s);if(d&&d===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${s!=null&&s.id?` (#${s.id})`:""}`}return""},[ca,u,b,Re]),ks=e=>{var Ht;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),s=tt((e==null?void 0:e.phone)||""),i=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),s||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),s&&!La(s)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),i||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const l=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ze=>Ze&&Ze.product_id);l.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),l.some(Ze=>{var Aa;const ea=Number((Aa=Ze==null?void 0:Ze.quantity)!=null?Aa:0);return!Number.isFinite(ea)||ea<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const m=new Set;let o=!1;for(const Ze of l){const ea=String(Ze.product_id||"").trim(),Aa=String((Ze==null?void 0:Ze.variant)||"").trim();if(!ea)continue;const ze=`${ea}||${Aa}`;if(m.has(ze)){o=!0;break}m.add(ze)}o&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const p=Xa(l),N=Ua(l),B=N!=null&&N.found?Number((Ht=N==null?void 0:N.fee)!=null?Ht:0):0,q=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],Te=Oa(q),_e=ja(Te),ot=Te.some(Ze=>(Number(Ze==null?void 0:Ze.amount)||0)!==0&&!String((Ze==null?void 0:Ze.note)||"").trim());N!=null&&N.found&&(B>=2e5||p>0&&B>p*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(B)}`),ot&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Ee=Math.abs(_e);return(Ee>=5e5||p>0&&Ee>p*.5)&&_e!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(_e)}`),{errors:a,warnings:t,canSubmit:a.length===0}},hi=React.useMemo(()=>ks(u),[u,rt]),He=React.useMemo(()=>{var Aa;const e=String((u==null?void 0:u.customer_name)||"").trim(),a=tt((u==null?void 0:u.phone)||""),t=String((u==null?void 0:u.address)||"").trim(),n=Array.isArray(u==null?void 0:u.items)?u.items:[],s=new Map;for(const ze of n){const Ka=String((ze==null?void 0:ze.product_id)||"").trim(),Nn=String((ze==null?void 0:ze.variant)||"").trim();if(!Ka)continue;const wn=`${Ka}||${Nn}`;s.set(wn,(s.get(wn)||0)+1)}const i=n.map(ze=>{var Ss;const Ka=String((ze==null?void 0:ze.product_id)||"").trim(),Nn=Number((Ss=ze==null?void 0:ze.quantity)!=null?Ss:0),wn=Ka?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",di=Number.isFinite(Nn)&&Nn>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",mi=String((ze==null?void 0:ze.variant)||"").trim(),ui=`${Ka}||${mi}`,pi=Ka&&(s.get(ui)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:wn,qtyError:di,dupWarn:pi}}),d=n.filter(ze=>ze&&ze.product_id),l=Xa(d),y=Ua(d),m=y!=null&&y.found?Number((Aa=y==null?void 0:y.fee)!=null?Aa:0):0,o=Array.isArray(u==null?void 0:u.adjustment_items)?u.adjustment_items:[],p=Oa(o),N=ja(p),B=p.some(ze=>(Number(ze==null?void 0:ze.amount)||0)!==0&&!String((ze==null?void 0:ze.note)||"").trim()),q=Math.abs(N),Te=B?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",_e=N!==0&&(q>=5e5||l>0&&q>l*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(N)}`:"",ot=y!=null&&y.found&&(m>=2e5||l>0&&m>l*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(m)}`:"",Ee=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Ht=a?La(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ze=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",ea=!Ee&&!Ht&&i.every(ze=>!ze.productError&&!ze.qtyError);return{nameError:Ee,phoneError:Ht,addressWarn:Ze,items:i,shipAbnormalWarn:ot,adjustmentNoteWarn:Te,adjustmentAbnormalWarn:_e,canSubmit:ea}},[u,rt]),yn=async e=>{var l,y,m;const a=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",n=ks(u);if(!n.canSubmit){const o=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof A=="function"?A(o,"danger"):alert(o);return}if(!Re&&xs){const o=`${xs}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(o)){(It==null?void 0:It.count)>0&&Dt(!0),setTimeout(()=>{var B;const N=document.getElementById("order-phone-input");N&&typeof N.scrollIntoView=="function"&&(N.scrollIntoView({block:"center",behavior:"smooth"}),(B=N.focus)==null||B.call(N))},0);return}}const s=tt(u.phone),d=(Array.isArray(u.items)?u.items:[]).map(o=>{var p,N;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((p=o==null?void 0:o.quantity)!=null?p:1),variant:String((o==null?void 0:o.variant)||"").trim()||null,variant_json:(N=o==null?void 0:o.variant_json)!=null?N:null,unit_price:(()=>{const B=o==null?void 0:o.unit_price,q=B===""||B==null?NaN:Number(B);if(Number.isFinite(q))return Math.max(0,Math.trunc(q));const Te=Ft(o==null?void 0:o.product_id),_e=o!=null&&o.variant_json&&typeof o.variant_json=="object"?o.variant_json:null;return Pa(Te,_e)})()}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0);f(!0);try{const o=Re,p=Re?`${API_BASE}/api/orders/${Re}`:`${API_BASE}/api/orders`,N=d[0],B=Array.isArray(u==null?void 0:u.adjustment_items)?u.adjustment_items:[],q=Oa(B),Te=ja(q),_e=Mn(q),ot={customer_name:u.customer_name,phone:s,address:u.address,note:(u.note||"").trim(),adjustment_amount:Te,adjustment_note:_e,adjustment_items:q,product_id:N.product_id,quantity:N.quantity,status:u.status,items:d,...Re?{id:Re}:{}};if(Re)await window.KTM.api.putJSON(p,ot,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Ee=await window.KTM.api.postJSON(p,ot,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Cs.current={id:(m=(y=Ee==null?void 0:Ee.id)!=null?y:(l=Ee==null?void 0:Ee.order)==null?void 0:l.id)!=null?m:null,fingerprint:ws(u),ts:Date.now()}}if(Us(s,u.customer_name,u.address),t==="drawer"){if(xa(""),yt(null),Ne(!1),_t(!1),Dt(!1),te([]),ka(),o){qe(!0),pt("");try{const Ee=await $n(o);Ee&&typeof Ee=="object"&&je(Ee)}catch(Ee){pt((Ee==null?void 0:Ee.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{qe(!1)}}}else a==="new"&&!Re?(xa(""),yt(null),Ne(!0)):(xa(""),yt(null),Ne(!1)),ka()}catch(o){console.error(o),typeof A=="function"?A(o.message,"danger"):alert(o.message);return}finally{f(!1)}},Ya=e=>window.KTM.orders.getOrderTotalMoney(e,Ft),gi=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){W(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),ka(),pn()}catch(a){console.error(a),typeof A=="function"?A(a.message,"danger"):alert(a.message)}finally{W(null)}}},oi=()=>{const e=St.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(i){}e.timer=null}const a=Array.isArray(e.events)?e.events.splice(0):[];if(!a.length||typeof A!="function")return;const t=new Map;for(const i of a){const d=String((i==null?void 0:i.orderId)||"").trim();d&&t.set(d,i)}const n=Array.from(t.values());if(!n.length)return;const s=i=>async()=>{try{for(const d of i)!(d!=null&&d.prevStatus)||!(d!=null&&d.orderId)||await Ca({id:d.orderId,status:d.nextStatus},d.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});A(i.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${i.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(d){A("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(n.length===1){const i=n[0],d=`${Jt(i.prevStatus)} \u2192 ${Jt(i.nextStatus)}`.trim();A(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${d}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:s([i])});return}A(`\u0110\xE3 c\u1EADp nh\u1EADt ${n.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:s(n)})},li=e=>{const a=St.current;a&&(Array.isArray(a.events)||(a.events=[]),a.events.push(e),!a.timer&&(a.timer=setTimeout(()=>oi(),320)))};useEffect(()=>()=>{try{const e=St.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Ca=async(e,a,t={})=>{var d;const n=await ln(e),s=n==null?void 0:n.id;if(!s||!a)return;const i=xt(n==null?void 0:n.status);H(s);try{const l=Pn(n),y=(Array.isArray(l)?l:[]).map(p=>{var N,B;return{product_id:(p==null?void 0:p.product_id)||"",quantity:Number((N=p==null?void 0:p.quantity)!=null?N:1),variant:String((p==null?void 0:p.variant)||"").trim()||null,variant_json:(B=p==null?void 0:p.variant_json)!=null?B:null,unit_price:(()=>{var _e;const q=(_e=p==null?void 0:p.unit_price)!=null?_e:p==null?void 0:p.unitPrice,Te=Number(q);return Number.isFinite(Te)?Math.max(0,Math.trunc(Te)):null})()}}).filter(p=>p.product_id&&Number.isFinite(p.quantity)&&p.quantity>0);if(!y.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const m=y[0],o={id:s,customer_name:(n==null?void 0:n.customer_name)||"",phone:tt((n==null?void 0:n.phone)||""),address:(n==null?void 0:n.address)||"",note:((n==null?void 0:n.note)||"").trim(),adjustment_amount:Number((d=n==null?void 0:n.adjustment_amount)!=null?d:0)||0,adjustment_note:(n==null?void 0:n.adjustment_note)||"",product_id:m.product_id,quantity:m.quantity,status:a,items:y};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${s}`,o,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),P(p=>Array.isArray(p)?p.map(N=>(N==null?void 0:N.id)===s?{...N,status:a}:N):p),pe(p=>Array.isArray(p)?p.map(N=>(N==null?void 0:N.id)===s?{...N,status:a}:N):p),an(s,!1),Bs(s),t!=null&&t.silentToast)return;if(t!=null&&t.skipToastBatch){typeof A=="function"&&A("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}li({orderId:s,prevStatus:i,nextStatus:xt(a)})}catch(l){if(console.error(l),(!navigator.onLine||(l==null?void 0:l.name)==="TypeError"||String((l==null?void 0:l.message)||"").toLowerCase().includes("failed to fetch"))&&!(t!=null&&t.fromSync)){P(m=>Array.isArray(m)?m.map(o=>(o==null?void 0:o.id)===s?{...o,status:a}:o):m),pe(m=>Array.isArray(m)?m.map(o=>(o==null?void 0:o.id)===s?{...o,status:a}:o):m),Hs(s,a,i),typeof A=="function"&&A("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof A=="function"?A(l.message,"danger"):alert(l.message)}finally{H(null)}};useEffect(()=>{const e=a=>{var n;const t=(n=a==null?void 0:a.detail)==null?void 0:n.key;if(t){if(t==="/"){setTimeout(()=>{var s,i;(i=(s=kn.current)==null?void 0:s.focus)==null||i.call(s)},0);return}if(t==="N"||t==="n"){bn();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&Be&&(ae!=null&&ae.id)){const s=Array.isArray(mt)?mt:[],i=s.findIndex(y=>String(y==null?void 0:y.id)===String(ae==null?void 0:ae.id));if(i<0)return;const l=s[i+(t==="j"||t==="J"?-1:1)];l&&Ga(l)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[mt,Be,ae]);const ci=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:u.customer_name,onChange:e=>F({...u,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!He.nameError&&React.createElement("div",{className:"form-text text-danger"},He.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:u.phone,onChange:e=>cs(e.target.value),onBlur:ds,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!He.phoneError&&React.createElement("div",{className:"form-text text-danger"},He.phoneError),!He.phoneError&&It.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",It.count," \u0111\u01A1n trong th\xE1ng ",It.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Dt(e=>!e)},_a?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),_a&&It.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Dt(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},It.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Da(e.status)}`},Jt(e.status))),React.createElement("div",{className:"text-muted small"},Ra(e.created_at)," \u2022 ",Ge(Ya(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Ea(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&jn(e)}},"M\u1EDF")))),It.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(et==null?void 0:et.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(et==null?void 0:et.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(et==null?void 0:et.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(et==null?void 0:et.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:u.status,onChange:e=>F({...u,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:u.address,onChange:e=>F({...u,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!He.addressWarn&&React.createElement("div",{className:"form-text text-warning"},He.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:u.note,onChange:e=>F({...u,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{F(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Qt(u.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;F(s=>{const i=Qt(s.adjustment_items);return i[a]={...i[a],amount:n},{...s,adjustment_items:i}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;F(s=>{const i=Qt(s.adjustment_items);return i[a]={...i[a],note:n},{...s,adjustment_items:i}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{F(t=>{const n=Qt(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:g||Qt(u.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!He.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},He.adjustmentAbnormalWarn),!!He.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},He.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{F(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Ie(e=>[...Array.isArray(e)?e:[],""]),Re&&te(e=>[...Array.isArray(e)?e:[],!0])},disabled:g},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(u.items)?u.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{vt.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Qe(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},gs(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Ye===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:De[a]||"",onChange:t=>{const n=t.target.value;Ie(s=>{const i=Array.isArray(s)?[...s]:[];return i[a]=n,i})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=ys(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const s=String(n.id),i=pa(n==null?void 0:n.variants),d={};for(const m of i){const o=String((m==null?void 0:m.name)||"").trim(),p=Array.isArray(m==null?void 0:m.options)?m.options[0]:null,N=String((p==null?void 0:p.label)||"").trim();o&&N&&(d[o]=N)}const l=hn(d),y=Pa(n,d);F(m=>{const o=Array.isArray(m.items)?[...m.items]:[];return o[a]={...o[a]||{quantity:1},product_id:s,variant_json:Object.keys(d).length?d:null,variant:l,unit_price:i.length?y:null},{...m,items:o}}),Qe(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),rt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=He.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Ft(e.product_id),n=pa(t==null?void 0:t.variants);if(!n.length)return null;const s=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((i,d)=>{const l=String((i==null?void 0:i.name)||`Bi\u1EBFn th\u1EC3 ${d+1}`).trim(),y=String((s==null?void 0:s[l])||"").trim();return React.createElement("div",{key:l},React.createElement("label",{className:"form-label small text-muted mb-1"},l),React.createElement("select",{className:"form-select",value:y,onChange:m=>{const o=String(m.target.value||"").trim();F(p=>{const N=Array.isArray(p.items)?[...p.items]:[],B={...N[a]||{}},q=Ft(B.product_id),Te=pa(q==null?void 0:q.variants),_e=B!=null&&B.variant_json&&typeof B.variant_json=="object"?{...B.variant_json}:{};o?_e[l]=o:delete _e[l];const ot=hn(_e),Ee=Pa(q,_e);return N[a]={...B,variant_json:Object.keys(_e).length?_e:null,variant:ot,unit_price:Ee},{...p,items:N}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",l," --"),(Array.isArray(i==null?void 0:i.options)?i.options:[]).map(m=>React.createElement("option",{key:m.label,value:m.label},m.label,Number.isFinite(Number(m==null?void 0:m.price))?` (${Ge(Number(m.price))})`:Number(m==null?void 0:m.price_delta)?` (${m.price_delta>0?"+":""}${m.price_delta})`:""))))}))})(),Re&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!U[a],onChange:t=>{const n=!!t.target.checked;te(s=>{const i=Array.isArray(s)?[...s]:[],d=Array.isArray(u.items)?u.items.length:0;for(;i.length<d;)i.push(!0);return i[a]=n,i})},disabled:g||z}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;F(s=>{const i=Array.isArray(s.items)?[...s.items]:[];return i[a]={...i[a]||{product_id:""},quantity:n},{...s,items:i}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=He.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{F(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Ie(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),te(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),Qe(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:g||z||(Array.isArray(u.items)?u.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(u.items)?u.items:[]).filter(l=>l==null?void 0:l.product_id),t=Xa(a),n=Ua(a),s=Tn(u),i=s.amount,d=t+(n.found?n.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ge(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ge(n.fee))),!!He.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},He.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ge(i))),(u.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(u.note||"").trim()),!!s.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",s.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ge(d)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:g||!!_||!!X}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},ua.all," \u0111\u01A1n"),Ce&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>Ce?fs(Ae):ka(),disabled:ht,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>bn(),disabled:g||!!_},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${ra&&!oe&&!Ce?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),aa(!1),ta(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xs)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${oa&&!oe&&!Ce?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),ta(!1),aa(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ys)),React.createElement("button",{type:"button",className:`orders-chip ${!L&&!oe&&!Ce?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),Y("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ua.all)),React.createElement("button",{type:"button",className:`orders-chip ${L==="draft"&&!oe&&!Ce?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),Y("draft"),C("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ua.draft)),React.createElement("button",{type:"button",className:`orders-chip ${L==="pending"&&!oe&&!Ce?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),Y("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ua.pending)),React.createElement("button",{type:"button",className:`orders-chip ${L==="processing"&&!oe&&!Ce?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),Y("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ua.processing)),React.createElement("button",{type:"button",className:`orders-chip ${L==="done"&&!oe&&!Ce?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),Y("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ua.done)),React.createElement("button",{type:"button",className:`orders-chip ${L==="paid"&&!oe&&!Ce?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),Y("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ua.paid)),React.createElement("button",{type:"button",className:`orders-chip ${L==="canceled"&&!oe&&!Ce?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),Y("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},ua.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>sa("thisMonth"),disabled:Ce},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>sa("overduePending"),disabled:Ce},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",da," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>sa("draftExpiring"),disabled:Ce},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a"),(L||oe||!b&&!Ce)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>sa("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:kn,type:"text",className:"form-control",value:Ae,onChange:e=>le(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(Ae||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>le(""),disabled:ht},React.createElement("i",{className:"fas fa-times"})),ht&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:b,onChange:e=>C(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:oe||Ce})),React.createElement("div",{className:"text-muted small ms-auto"},Ce?"Search b\u1ECF qua filter":oe?"\u0110ang xem \u0111\u01A1n ch\u1EADm":L?`L\u1ECDc: ${Jt(L)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${ha?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if(Ce){const e=String(Ae||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${mt.length} k\u1EBFt qu\u1EA3`}return oe?`\u0110\u01A1n ch\u1EADm \u2022 ${mt.length} \u0111\u01A1n`:ra?`\u01AFu ti\xEAn \u2022 ${mt.length} \u0111\u01A1n`:oa?`H\xF4m nay \u2022 ${mt.length} \u0111\u01A1n`:L?`L\u1ECDc: ${Jt(L)} \u2022 ${mt.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${mt.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{le(""),ta(!1),aa(!1),sa("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},Ce?`${mt.length} k\u1EBFt qu\u1EA3`:L?`${un.length}/${G.length} \u0111\u01A1n`:`${G.length}${ce?"+":""} \u0111\u01A1n`)),Ce&&Ue&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Ue),mn.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,mn.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",da," ng\xE0y.",be&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{se(!0),Y("pending")}},"Xem ngay")),ms.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,ms.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",Cn," ng\xE0y).",Ve&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{se(!1),Y("draft"),C(""),ka()}},"Xem ngay")),(Ce?ht:he)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,a)=>React.createElement("div",{key:a,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,a)=>React.createElement("tr",{key:a},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(Ce?mt.length===0:G.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},Ce?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!Ce&&un.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},ps.map(e=>{var a;return React.createElement("div",{key:e.id,className:`orders-mobile-swipe-shell mb-2 ${(Ke==null?void 0:Ke.id)===String(e.id)?`swipe-preview swipe-${(Ke==null?void 0:Ke.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>{if(st.current){st.current=!1;return}Ga(e)},onPointerDown:t=>{if(E||Tt||ct||t.button!=null&&t.button!==0)return;const n=String(e.id);st.current=!1,K.current={active:!0,id:n,startX:t.clientX,startY:t.clientY,dx:0,dy:0,lock:null,pointerId:t.pointerId,captured:!1},Xe(s=>(s==null?void 0:s.id)===n?s:{id:n,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(s){}try{Je.current&&clearTimeout(Je.current)}catch(s){}Pt.current=n,Je.current=setTimeout(async()=>{var i,d,l,y;const s=Pt.current;if(s)try{if((d=(i=xe.current)==null?void 0:i.has)!=null&&d.call(i,s))return;const m=await $n(s);m&&typeof m=="object"&&((y=(l=xe.current)==null?void 0:l.set)==null||y.call(l,s,m))}catch(m){}},150)},onPointerMove:t=>{const n=K.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id))return;const s=t.clientX-n.startX,i=t.clientY-n.startY;if(n.dx=s,n.dy=i,Math.abs(s)>14||Math.abs(i)>14){try{Je.current&&clearTimeout(Je.current)}catch(N){}Je.current=null,Pt.current=null}if(!n.lock){const N=Math.abs(s),B=Math.abs(i);if((N>10||B>10)&&(n.lock=N>B*1.2?"x":"y",n.lock==="x"&&!n.captured))try{t.currentTarget.setPointerCapture(t.pointerId),n.captured=!0}catch(q){}}if(n.lock!=="x"){try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(N){}Math.abs(i)>24&&Xe(N=>(N==null?void 0:N.id)===n.id?{id:n.id,dir:null}:N);return}const d=!!Ia(e==null?void 0:e.status,"right"),l=!!Ia(e==null?void 0:e.status,"left"),y=(N,B,q)=>Math.max(B,Math.min(q,N)),m=y(s,-140,140),o=m>0&&!d||m<0&&!l?m*.35:m,p=y(Math.abs(o)/88,0,1);try{t.currentTarget.classList.add("swiping"),t.currentTarget.style.setProperty("--swipe-x",`${o}px`),t.currentTarget.style.setProperty("--swipe-p",String(p)),t.currentTarget.style.setProperty("--swipe-l",o<0&&l?String(p):"0"),t.currentTarget.style.setProperty("--swipe-r",o>0&&d?String(p):"0")}catch(N){}Math.abs(o)>12&&(st.current=!0),s>72&&d?Xe({id:n.id,dir:"right"}):s<-72&&l?Xe({id:n.id,dir:"left"}):Xe({id:n.id,dir:null})},onPointerCancel:t=>{try{Je.current&&clearTimeout(Je.current)}catch(s){}Je.current=null,Pt.current=null;const n=K.current;try{n!=null&&n.captured&&(n==null?void 0:n.pointerId)!=null&&t.currentTarget.releasePointerCapture(n.pointerId)}catch(s){}K.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1},Xe({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(s){}},onPointerUp:t=>{try{Je.current&&clearTimeout(Je.current)}catch(o){}Je.current=null,Pt.current=null;const n=K.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id)){Xe({id:null,dir:null});return}try{n!=null&&n.captured&&(n==null?void 0:n.pointerId)!=null&&t.currentTarget.releasePointerCapture(n.pointerId)}catch(o){}K.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1};const s=Number(n.dx)||0,i=Math.abs(s),d=n.lock==="x",l=xt(e==null?void 0:e.status);Xe({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(o){}if(d&&i>12&&(st.current=!0),!d||i<88)return;t.preventDefault(),t.stopPropagation();const y=s>0?Ia(e==null?void 0:e.status,"right"):Ia(e==null?void 0:e.status,"left"),m=xt(y);!m||m===l||Ca(e,m)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),Ga(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"orders-mobile-swipe-bg","aria-hidden":"true"},React.createElement("div",{className:"orders-mobile-swipe-bg-left"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Ia(e==null?void 0:e.status,"right"),n=ss(t),s=(n==null?void 0:n.label)||String(t||"").trim();return s?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${n.icon||"fa-circle"}`}),s):null})())),React.createElement("div",{className:"orders-mobile-swipe-bg-right"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Ia(e==null?void 0:e.status,"left"),n=ss(t),s=(n==null?void 0:n.label)||String(t||"").trim();return s?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${n.icon||"fa-circle"}`}),s):null})()))),React.createElement("div",{className:`card orders-mobile-card ${Ut!=null&&Ut[String(e.id)]?"order-recent-updated":""}`},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:t=>Vs(t,e.phone),onPointerMove:nn,onPointerUp:nn,onPointerCancel:nn,onPointerLeave:nn,onClick:t=>{if(t.stopPropagation(),ft.current){ft.current=!1;return}ts(e.phone)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),ts(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=Zn(e);if(!t)return null;const n=Bt.has(String(e.id)),s=t.length>84||es(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${n?"":"order-text-collapsed"}`},t),s&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:i=>{i.stopPropagation(),Xn(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const t=es(e);if(!t)return null;const n=Bt.has(String(e.id)),s=Zn(e).length,i=s>84||t.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${n?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t),i&&s<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:d=>{d.stopPropagation(),Xn(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${$t.has(String(e.id))?"active":""}`,onClick:t=>{t.stopPropagation(),Rs(e.id)},title:$t.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":$t.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:$t.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(Gt!=null&&Gt[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${Da(e.status)} order-status-badge-btn`,onPointerDown:t=>{t.stopPropagation(),we.current=!1;try{ie.current&&clearTimeout(ie.current)}catch(n){}ie.current=setTimeout(()=>{we.current=!0,Un(e,t.currentTarget)},420)},onPointerUp:t=>{t.stopPropagation();try{ie.current&&clearTimeout(ie.current)}catch(n){}ie.current=null},onPointerCancel:t=>{t.stopPropagation();try{ie.current&&clearTimeout(ie.current)}catch(n){}ie.current=null},onClick:t=>{if(t.stopPropagation(),we.current){we.current=!1;return}ct&&String(S==null?void 0:S.id)===String(e.id)?Na():Un(e,t.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},Jt(e.status)),sn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${da} ng\xE0y`},"\u26A0 Ch\u1EADm ",za(e),"d"),on(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${en} ng\xE0y`},"\u23F3 C\xF2n ",rn(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=gn(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,s)=>React.createElement("div",{key:s,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},s+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${Ge(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Ea(e))})()),(Wa(e)!==0||Sa(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ge(Wa(e))),Sa(e)?React.createElement("span",{className:"text-muted"}," ","(",Sa(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Ge(Ya(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",Ra(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),vn(e)},disabled:g||!!_||X===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),Wn(e)},disabled:g||!!_||X===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c")))))}),React.createElement("div",{ref:dt,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(mt)&&ps.length<mt.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),ct&&S&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>Na()},React.createElement("div",{className:`orders-status-popover ${($==null?void 0:$.placement)||""}`,style:{left:$.left,top:$.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},S.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Na(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},Ba.map(e=>{const a=xt(S.status)===xt(e.value),t=g||!!_||X===S.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Ca(S,e.value),Na())},disabled:t},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{Wn(S),Na()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),E&&nt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>wa()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},nt.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},nt.phone||""),React.createElement("span",{className:`badge ${Da(nt.status)}`},Jt(nt.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>wa(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{vn(nt),wa()},disabled:g||!!_||X===nt.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(nt.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(nt.phone||"").trim()}`,onClick:()=>wa()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{Ga(nt),wa()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},Ba.map(e=>{const a=xt(nt.status)===xt(e.value),t=g||!!_||X===nt.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Ca(nt,e.value),wa())},disabled:t},e.label)})))),Tt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>tn()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>tn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>sa("thisMonth"),disabled:Ce},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>sa("overduePending"),disabled:Ce},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>sa("draftExpiring"),disabled:Ce},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!L&&!oe?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),Y("")}},"T\u1EA5t c\u1EA3"),Ba.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${L===e.value&&!oe?"active":""}`,onClick:()=>{Ce&&le(""),se(!1),Y(e.value),e.value==="draft"&&C("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:b,onChange:e=>C(e.target.value),disabled:oe||Ce}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:oe,onChange:e=>{Ce&&le("");const a=!!e.target.checked;se(a),a&&(C(""),Y("pending"))},disabled:Ce}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",da," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>sa("all"),disabled:Ce},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>tn()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${Mt?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){ne.current=!1;try{J.current&&clearTimeout(J.current)}catch(a){}J.current=setTimeout(()=>{ne.current=!0,Yn(Ae)},460)}},onPointerUp:()=>{try{J.current&&clearTimeout(J.current)}catch(e){}J.current=null},onPointerCancel:()=>{try{J.current&&clearTimeout(J.current)}catch(e){}J.current=null},onClick:()=>{if(ne.current){ne.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,a;return(a=(e=kn.current)==null?void 0:e.focus)==null?void 0:a.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>bn(),disabled:g||!!_,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Ds(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),va&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{qa(Xt),zt()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const a=e.touches&&e.touches[0];a&&(j.current={active:!0,startY:a.clientY,startX:a.clientX,fired:!1})},onTouchMove:e=>{const a=j.current;if(!(a!=null&&a.active)||a.fired)return;const t=e.touches&&e.touches[0];if(!t)return;const n=t.clientY-a.startY,s=t.clientX-a.startX;Math.abs(s)>24||n>90&&(a.fired=!0,qa(Xt),zt())},onTouchEnd:()=>{j.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{qa(Xt),zt()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:I,type:"text",className:"form-control",value:Xt,onChange:e=>{const a=e.target.value;wt(a),le(a)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(qa(Xt),zt())}}),!!String(Xt||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{wt(""),le("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(r)&&r.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},r.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{wt(e),le(e),qa(e),zt()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${ra?"active":""}`,onClick:()=>{le(""),wt(""),se(!1),aa(!1),ta(e=>!e),zt()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${oa?"active":""}`,onClick:()=>{le(""),wt(""),se(!1),ta(!1),aa(e=>!e),zt()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${oe?"active":""}`,onClick:()=>{le(""),wt(""),se(e=>!e),oe||(C(""),Y("pending")),zt()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!L&&!oe&&!ra&&!oa?"active":""}`,onClick:()=>{le(""),wt(""),se(!1),ta(!1),aa(!1),Y(""),zt()}},"T\u1EA5t c\u1EA3"),Ba.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${L===e.value&&!oe?"active":""}`,onClick:()=>{le(""),wt(""),se(!1),ta(!1),aa(!1),Y(e.value),e.value==="draft"&&C(""),zt()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,mt.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>Ga(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=gn(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Ge(t.unitPrice))))):Ea(e)})()),React.createElement("td",null,Ns(e)),React.createElement("td",{className:"fw-semibold"},Ge(Ya(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${Da(e.status)}`},Jt(e.status)),sn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${da} ng\xE0y`},"\u26A0 Ch\u1EADm ",za(e),"d"),on(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${en} ng\xE0y`},"\u23F3 C\xF2n ",rn(e),"d"))),React.createElement("td",null,Ra(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),vn(e)},disabled:g||!!_||X===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation();const t=String(a.target.value||"").trim();a.target.value="",t&&Ca(e,t)},disabled:g||!!_||X===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!Ce&&ce&&!oe&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Zs,disabled:he||ee},ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:Be,title:(()=>{const e=ae,a=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Jt(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${a} ${t}`.trim()})(),subtitle:(()=>{const e=ae,a=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?Ra(e.created_at):"";return[a||t||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:ei,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},Ot?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{_t(!1),yt(null),xa(""),Dt(!1),te([])},disabled:g||z},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!Re&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:hs,disabled:g||z,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>yn({mode:"close",origin:"drawer"}),disabled:g||z||!He.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},g?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ae&&vn(ae),disabled:!ae||ut||g||!!_},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>ae&&jn(ae),disabled:!ae||ut||g||!!_},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const a=String(e.target.value||"").trim();e.target.value="",a&&ae&&Ca(ae,a)},disabled:!ae||ut||g||!!_||X===(ae==null?void 0:ae.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},Ot?React.createElement("form",{onSubmit:e=>{e.preventDefault(),yn({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),ci())):ut?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):Nt?React.createElement("div",{className:"alert alert-danger",role:"alert"},Nt):ae?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${Da(ae.status)}`},Jt(ae.status)),sn(ae)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${da} ng\xE0y`},"\u26A0 Ch\u1EADm ",za(ae),"d"),on(ae)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${en} ng\xE0y`},"\u23F3 C\xF2n ",rn(ae),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},Ge(Ya(ae))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},Ns(ae)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},Ra(ae.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},ae.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},ae.phone||"\u2014"),!!String(ae.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(ae.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},ae.address||"\u2014")),((ae==null?void 0:ae.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(ae.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=gn(ae);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((a,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),a.name),a.variant?React.createElement("div",{className:"text-muted small"},a.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${Ge(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Ea(ae)||"\u2014")})(),(Wa(ae)!==0||Sa(ae))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ge(Wa(ae))),Sa(ae)?React.createElement("span",{className:"text-muted"}," ","(",Sa(ae),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),ye&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),Re?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Ln})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),yn({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Hn},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:u.customer_name,onChange:e=>F({...u,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!He.nameError&&React.createElement("div",{className:"form-text text-danger"},He.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:u.phone,onChange:e=>cs(e.target.value),onBlur:ds,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!He.phoneError&&React.createElement("div",{className:"form-text text-danger"},He.phoneError),!He.phoneError&&It.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",It.count," \u0111\u01A1n trong th\xE1ng ",It.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Dt(e=>!e)},_a?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),_a&&It.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Dt(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},It.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Da(e.status)}`},Jt(e.status))),React.createElement("div",{className:"text-muted small"},Ra(e.created_at)," \u2022 ",Ge(Ya(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Ea(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&jn(e)}},"M\u1EDF")))),It.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(et==null?void 0:et.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(et==null?void 0:et.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(et==null?void 0:et.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(et==null?void 0:et.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:u.status,onChange:e=>F({...u,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:u.address,onChange:e=>F({...u,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!He.addressWarn&&React.createElement("div",{className:"form-text text-warning"},He.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:u.note,onChange:e=>F({...u,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{F(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Qt(u.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;F(s=>{const i=Qt(s.adjustment_items);return i[a]={...i[a],amount:n},{...s,adjustment_items:i}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;F(s=>{const i=Qt(s.adjustment_items);return i[a]={...i[a],note:n},{...s,adjustment_items:i}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{F(t=>{const n=Qt(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:g||Qt(u.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!He.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},He.adjustmentAbnormalWarn),!!He.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},He.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{F(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Ie(e=>[...Array.isArray(e)?e:[],""]),Re&&te(e=>[...Array.isArray(e)?e:[],!0])},disabled:g},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(u.items)?u.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{vt.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Qe(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},gs(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Ye===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:De[a]||"",onChange:t=>{const n=t.target.value;Ie(s=>{const i=Array.isArray(s)?[...s]:[];return i[a]=n,i})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=ys(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const s=String(n.id),i=pa(n==null?void 0:n.variants),d={};for(const m of i){const o=String((m==null?void 0:m.name)||"").trim(),p=Array.isArray(m==null?void 0:m.options)?m.options[0]:null,N=String((p==null?void 0:p.label)||"").trim();o&&N&&(d[o]=N)}const l=hn(d),y=Pa(n,d);F(m=>{const o=Array.isArray(m.items)?[...m.items]:[];return o[a]={...o[a]||{quantity:1},product_id:s,variant_json:Object.keys(d).length?d:null,variant:l,unit_price:i.length?y:null},{...m,items:o}}),Qe(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),rt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=He.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Ft(e.product_id),n=pa(t==null?void 0:t.variants);if(!n.length)return null;const s=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((i,d)=>{const l=String((i==null?void 0:i.name)||`Bi\u1EBFn th\u1EC3 ${d+1}`).trim(),y=String((s==null?void 0:s[l])||"").trim();return React.createElement("div",{key:l},React.createElement("label",{className:"form-label small text-muted mb-1"},l),React.createElement("select",{className:"form-select",value:y,onChange:m=>{const o=String(m.target.value||"").trim();F(p=>{const N=Array.isArray(p.items)?[...p.items]:[],B={...N[a]||{}},q=Ft(B.product_id),Te=pa(q==null?void 0:q.variants),_e=B!=null&&B.variant_json&&typeof B.variant_json=="object"?{...B.variant_json}:{};o?_e[l]=o:delete _e[l];const ot=hn(_e),Ee=Pa(q,_e);return N[a]={...B,variant_json:Object.keys(_e).length?_e:null,variant:ot,unit_price:Ee},{...p,items:N}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",l," --"),(Array.isArray(i==null?void 0:i.options)?i.options:[]).map(m=>React.createElement("option",{key:m.label,value:m.label},m.label,Number.isFinite(Number(m==null?void 0:m.price))?` (${Ge(Number(m.price))})`:Number(m==null?void 0:m.price_delta)?` (${m.price_delta>0?"+":""}${m.price_delta})`:""))))}))})(),Re&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!U[a],onChange:t=>{const n=!!t.target.checked;te(s=>{const i=Array.isArray(s)?[...s]:[],d=Array.isArray(u.items)?u.items.length:0;for(;i.length<d;)i.push(!0);return i[a]=n,i})},disabled:g||z}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;F(s=>{const i=Array.isArray(s.items)?[...s.items]:[];return i[a]={...i[a]||{product_id:""},quantity:n},{...s,items:i}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=He.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{F(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Ie(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),te(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),Qe(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:g||z||(Array.isArray(u.items)?u.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(u.items)?u.items:[]).filter(l=>l==null?void 0:l.product_id),t=Xa(a),n=Ua(a),s=Tn(u),i=s.amount,d=t+(n.found?n.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ge(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ge(n.fee))),!!He.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},He.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ge(i))),(u.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(u.note||"").trim()),!!s.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",s.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ge(d)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Ln,disabled:g||z,style:{borderRadius:10}},"H\u1EE7y"),!!Re&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:hs,disabled:g||z,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!Re&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>yn({mode:"new",origin:"modal"}),disabled:g||!He.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:g||z||!He.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},g?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

