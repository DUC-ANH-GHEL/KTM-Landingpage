const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:C,error:x}){const[j,te]=useState(""),[J,w]=useState(""),[D,ce]=useState(!1),[de,z]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),x&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),x),React.createElement("form",{onSubmit:async xe=>{xe.preventDefault(),ce(!0),await C(j,J),ce(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:j,onChange:xe=>te(xe.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:de?"text":"password",className:"form-control",value:J,onChange:xe=>w(xe.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>z(!de)},React.createElement("i",{className:`fas fa-eye${de?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:D},D?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:C,type:x,onClose:j}){return useEffect(()=>{const te=setTimeout(j,3e3);return()=>clearTimeout(te)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${x} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},C),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:j})))}function Loading({show:C}){return C?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:C,onMenuChange:x,onLogout:j,currentUser:te}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(w=>React.createElement("a",{key:w.id,href:"#",className:`nav-link ${C===w.id?"active":""} ${w.disabled?"opacity-50":""} ${w.highlight?"text-warning":""}`,onClick:D=>{D.preventDefault(),w.disabled||x(w.id)}},React.createElement("i",{className:`fas ${w.icon}`})," ",w.label,w.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),w.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),j&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:j,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(C){const x=typeof C=="number"?C:parseFloat(String(C!=null?C:"").trim());return Number.isFinite(x)?Math.max(0,Math.min(100,x)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var C;try{const x=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!x)return{ship_percent:DEFAULT_SHIP_PERCENT};const j=JSON.parse(x);return{ship_percent:normalizeShipPercent((C=j==null?void 0:j.ship_percent)!=null?C:j==null?void 0:j.shipPercent)}}catch(x){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(C){var x;try{const j={ship_percent:normalizeShipPercent((x=C==null?void 0:C.ship_percent)!=null?x:C==null?void 0:C.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(j)),j}catch(j){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var x;const C=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((x=C==null?void 0:C.ship_percent)!=null?x:C==null?void 0:C.shipPercent)}}async function saveAdminSettingsToServer(C){var te,J,w;const x={ship_percent:normalizeShipPercent((te=C==null?void 0:C.ship_percent)!=null?te:C==null?void 0:C.shipPercent)},j=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,x,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((w=(J=j==null?void 0:j.ship_percent)!=null?J:j==null?void 0:j.shipPercent)!=null?w:x.ship_percent)}}function AlbumList({albums:C,onSelect:x,onCreate:j,onEdit:te,onDelete:J,loading:w,currentFolder:D,onBack:ce,breadcrumb:de}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},D&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:ce},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),D?D.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:j},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),de&&de.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:z=>{z.preventDefault(),ce("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),de.map((z,ue)=>React.createElement("li",{key:z.id,className:`breadcrumb-item ${ue===de.length-1?"active":""}`},ue===de.length-1?z.title:React.createElement("a",{href:"#",onClick:xe=>{xe.preventDefault(),ce(z)},className:"text-warning"},z.title))))),w?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):C.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},D?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},C.map(z=>React.createElement("div",{key:z.uuid||z.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>x(z)},z.cover?React.createElement("img",{src:z.cover,className:"album-cover",alt:z.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},z.title),React.createElement("small",{className:"text-muted"},z.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),z.subfolderCount),z.subfolderCount>0&&z.count>0&&" \u2022 ",z.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),z.count),z.subfolderCount===0&&z.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:ue=>{ue.stopPropagation(),te(z)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:ue=>{ue.stopPropagation(),J(z)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:C,album:x,onClose:j,onSave:te,parentId:J}){const[w,D]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[ce,de]=useState(!1),[z,ue]=useState(!1),xe=useRef(null);useEffect(()=>{D(x?{slug:x.id||"",title:x.title||"",description:x.description||"",cover_url:x.cover||"",parent_id:x.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:J||null})},[x,C,J]);const le=async me=>{me.preventDefault(),de(!0),await te(w),de(!1)},se=me=>me.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),fe=async me=>{const we=me.type==="image/heic"||me.type==="image/heif"||/\.heic$/i.test(me.name);if(me.size<=2097152&&!we)return me;try{const De=await createImageBitmap(me),Oe=document.createElement("canvas");let _e=De.width,ye=De.height;const Ie=800;return(_e>Ie||ye>Ie)&&(_e>ye?(ye=Math.round(ye/_e*Ie),_e=Ie):(_e=Math.round(_e/ye*Ie),ye=Ie)),Oe.width=_e,Oe.height=ye,Oe.getContext("2d").drawImage(De,0,0,_e,ye),De.close(),new Promise((tt,Ce)=>{Oe.toBlob(qe=>{qe?tt(new File([qe],me.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ce(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(De){throw console.error("Compress cover error:",De),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Fe=async me=>{var De;const ve=me.target.files[0];if(!ve)return;if(!(ve.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ve.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ue(!0);try{const Oe=await fe(ve),_e=await window.KTM.cloudinary.uploadImage({file:Oe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!_e.secure_url)throw console.error("Cloudinary error:",_e),new Error(((De=_e.error)==null?void 0:De.message)||"Upload failed");D(ye=>({...ye,cover_url:_e.secure_url}))}catch(Oe){console.error("Cover upload error:",Oe),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Oe.message)}ue(!1),me.target.value=""};return C?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:le},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:w.title,onChange:me=>D({...w,title:me.target.value,slug:w.slug||se(me.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:w.slug,onChange:me=>D({...w,slug:me.target.value}),required:!0,disabled:!!x}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:w.description,onChange:me=>D({...w,description:me.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},w.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:w.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>D(me=>({...me,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:xe,type:"file",accept:"image/*",className:"d-none",onChange:Fe}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var me;return(me=xe.current)==null?void 0:me.click()},disabled:z},z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:w.cover_url,onChange:me=>D({...w,cover_url:me.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:ce||z},ce?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:C,allAlbums:x,currentAlbumId:j,targetAlbum:te,onSelect:J,level:w=0}){const[D,ce]=useState(!0),de=C.uuid||C.id,z=de===j,ue=te===de,xe=x.filter(se=>se.parentId===de),le=xe.length>0;return React.createElement("div",{style:{marginLeft:w*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${ue?"bg-info text-white":z?"bg-light text-muted":"hover-bg"}`,style:{cursor:z?"not-allowed":"pointer",opacity:z?.5:1,transition:"background 0.2s"},onClick:()=>!z&&J(de)},le&&React.createElement("i",{className:`fas fa-chevron-${D?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:se=>{se.stopPropagation(),ce(!D)}}),!le&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${ue?"-open":""} me-2 ${ue?"":"text-warning"}`}),React.createElement("span",{className:"small"},C.title),z&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),C.count>0&&!z&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},C.count)),D&&le&&React.createElement("div",null,xe.map(se=>React.createElement(FolderTreeItem,{key:se.uuid||se.id,folder:se,allAlbums:x,currentAlbumId:j,targetAlbum:te,onSelect:J,level:w+1}))))}function AlbumDetail({album:C,onBack:x,onRefresh:j,showToast:te,onNavigateToFolder:J,onEditSubfolder:w,parentAlbum:D}){const[ce,de]=useState([]),[z,ue]=useState([]),[xe,le]=useState(!0),[se,fe]=useState(!1),[Fe,me]=useState(""),[ve,we]=useState([]),[De,Oe]=useState([]),[_e,ye]=useState({}),[Ie,Ae]=useState(null),[tt,Ce]=useState(!1),[qe,Le]=useState(""),[m,_]=useState(!1),i=useRef(null),b=useRef(null),[v,$]=useState(!1),[E,W]=useState([]),[P,q]=useState([]),[be,Pe]=useState(""),[u,g]=useState(!1),pe=async(h,U=2)=>{const ie=U*1024*1024,Ge=h.type==="image/heic"||h.type==="image/heif"||/\.heic$/i.test(h.name);if(h.size<=ie&&!Ge)return h;try{const et=await createImageBitmap(h),Ue=document.createElement("canvas");let dt=et.width,Qe=et.height;const ht=1200;return(dt>ht||Qe>ht)&&(dt>Qe?(Qe=Math.round(Qe/dt*ht),dt=ht):(dt=Math.round(dt/Qe*ht),Qe=ht)),Ue.width=dt,Ue.height=Qe,Ue.getContext("2d").drawImage(et,0,0,dt,Qe),et.close(),new Promise((xt,$t)=>{Ue.toBlob(Lt=>{Lt?xt(new File([Lt],h.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):$t(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(et){throw console.error("Compress error:",et),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{S(),L()},[C.id,C.uuid]);const S=async()=>{le(!0);try{const h=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${C.uuid||C.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");de(h.images||[]);const U=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${C.uuid||C.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ue(Array.isArray(U)?U:[])}catch(h){console.error(h),te("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}le(!1)},L=async()=>{try{const h=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");q(Array.isArray(h)?h:[])}catch(h){console.error("Error loading albums:",h)}},Q=h=>{W(U=>U.includes(h)?U.filter(ie=>ie!==h):[...U,h])},Te=async()=>{if(!be||E.length===0){te("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}g(!0);let h=0;for(const U of E)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${U}`,{album_id:be},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),h++}catch(ie){console.error("Move error:",ie)}g(!1),$(!1),W([]),Pe(""),h>0?(te("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),S(),j()):te("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[He,Z]=useState(!1),Ke=async()=>{if(E.length===0||!confirm(`X\xF3a ${E.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Z(!0);let h=0;for(const U of E)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${U}`,"L\u1ED7i x\xF3a \u1EA3nh"),h++}catch(ie){console.error("Delete error:",ie)}Z(!1),W([]),h>0?(te(`\u0110\xE3 x\xF3a ${h} \u1EA3nh!`,"success"),S(),j()):te("X\xF3a th\u1EA5t b\u1EA1i","danger")},Ye=()=>{E.length===ce.length?W([]):W(ce.map(h=>h.id))},pt=async()=>{if(qe.trim()){_(!0);try{const h=qe.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:h+"-"+Date.now(),title:qe,parent_id:C.uuid||C.id},"L\u1ED7i t\u1EA1o folder"),te("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Le(""),Ce(!1),S(),j()}catch(h){te(h.message,"danger")}_(!1)}},ge=async h=>{if(confirm(`X\xF3a folder "${h.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${h.uuid||h.id}`,"L\u1ED7i x\xF3a folder"),te("\u0110\xE3 x\xF3a folder","success"),S(),j()}catch(U){te("L\u1ED7i x\xF3a folder","danger")}},Je=h=>{const U=Array.from(h).filter(ie=>ie.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ie.name));we(ie=>[...ie,...U]),U.forEach(ie=>{const Ge=new FileReader;Ge.onload=et=>{Oe(Ue=>[...Ue,{file:ie,preview:et.target.result}])},Ge.readAsDataURL(ie)})},A=h=>{we(U=>U.filter((ie,Ge)=>Ge!==h)),Oe(U=>U.filter((ie,Ge)=>Ge!==h))},Be=async h=>{var ie;const U=await window.KTM.cloudinary.uploadImage({file:h,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${C.id}`});if(!U.secure_url)throw console.error("Cloudinary error:",U),new Error(((ie=U.error)==null?void 0:ie.message)||"Upload failed");return U},ae=async()=>{if(ve.length===0)return;fe(!0);let h=0;for(let U=0;U<ve.length;U++)try{me(`\u0110ang x\u1EED l\xFD ${U+1}/${ve.length}...`);const ie=await pe(ve[U],2);me(`\u0110ang upload ${U+1}/${ve.length}...`);const Ge=await Be(ie);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${C.id}`,{url:Ge.secure_url,caption:_e[U]||ve[U].name.replace(/\.[^/.]+$/,""),sort_order:ce.length+U},"L\u1ED7i l\u01B0u \u1EA3nh"),h++}catch(ie){console.error("Upload error:",ie)}fe(!1),me(""),we([]),Oe([]),ye({}),h>0?(te(`\u0110\xE3 upload ${h} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),S(),j()):te("Upload th\u1EA5t b\u1EA1i","danger")},lt=async(h,U)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${h}`,"L\u1ED7i x\xF3a \u1EA3nh"),te("\u0110\xE3 x\xF3a \u1EA3nh","success"),S(),j()}catch(ie){te("L\u1ED7i x\xF3a \u1EA3nh","danger")}},ct=h=>{var U;h.preventDefault(),(U=b.current)==null||U.classList.add("dragover")},Ze=()=>{var h;(h=b.current)==null||h.classList.remove("dragover")},ft=h=>{var U;h.preventDefault(),(U=b.current)==null||U.classList.remove("dragover"),Je(h.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:x},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},C.title),React.createElement("small",{className:"text-muted"},z.length>0&&React.createElement("span",null,z.length," folder \u2022 "),ce.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Ce(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),tt&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:qe,onChange:h=>Le(h.target.value),onKeyPress:h=>h.key==="Enter"&&pt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:pt,disabled:m||!qe.trim()},m?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Ce(!1),Le("")}},"H\u1EE7y")))),z.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},z.map(h=>React.createElement("div",{key:h.uuid||h.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>J&&J(h)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},h.title),React.createElement("small",{className:"text-muted"},h.subfolderCount>0&&React.createElement("span",null,h.subfolderCount," folder"),h.subfolderCount>0&&h.count>0&&" \u2022 ",h.count>0&&React.createElement("span",null,h.count," \u1EA3nh"),h.subfolderCount===0&&h.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:U=>{U.stopPropagation(),w&&w(h)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:U=>{U.stopPropagation(),ge(h)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:b,className:"upload-zone",onClick:()=>{var h;return(h=i.current)==null?void 0:h.click()},onDragOver:ct,onDragLeave:Ze,onDrop:ft},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:i,type:"file",multiple:!0,accept:"image/*",onChange:h=>Je(h.target.files)})),De.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},De.map((h,U)=>React.createElement("div",{key:U,className:"upload-preview-item"},React.createElement("img",{src:h.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>A(U)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:ae,disabled:se},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Fe||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",ve.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",ce.length,")"),ce.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Ye},E.length===ce.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),E.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},E.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>$(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Ke,disabled:He},He?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>W([])},React.createElement("i",{className:"fas fa-times"})))),xe?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):ce.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},ce.map((h,U)=>React.createElement("div",{key:U,className:`image-item ${E.includes(h.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Q(h.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:E.includes(h.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:E.includes(h.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},E.includes(h.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:h.src,alt:h.caption,style:{opacity:E.includes(h.id)?.7:1,border:E.includes(h.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:ie=>{ie.stopPropagation(),lt(h.id,U)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),h.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},h.caption)))))),v&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",E.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>$(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},P.filter(h=>!h.parentId).map(h=>React.createElement(FolderTreeItem,{key:h.uuid||h.id,folder:h,allAlbums:P,currentAlbumId:C.uuid||C.id,targetAlbum:be,onSelect:Pe})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>$(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:Te,disabled:!be||u},u?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Ie&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Ae(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Ae(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Ie.src,alt:Ie.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:h=>h.stopPropagation()}),Ie.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Ie.caption)))))}function SearchCenter({showToast:C,onNavigate:x}){const[j,te]=useState(""),[J,w]=useState([]),[D,ce]=useState([]),[de,z]=useState([]),[ue,xe]=useState("all"),[le,se]=useState(null),[fe,Fe]=useState("list"),[me,ve]=useState(!0),[we,De]=useState([]),[Oe,_e]=useState([]),ye=useRef(null),[Ie,Ae]=useState(!0),[tt,Ce]=useState(!1),qe=useRef(null),[Le,m]=useState(!1),[_,i]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[b,v]=useState(""),[$,E]=useState(!1),W=useRef(null),P=useRef(null),[q,be]=useState(null),[Pe,u]=useState(!1),[g,pe]=useState(null),[S,L]=useState(!1),[Q,Te]=useState(!1),[He,Z]=useState(null),[Ke,Ye]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),pt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ge=s=>{var N,O;s._type==="product"&&(pe(s),Ye({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(O=(N=s.commission_percent)!=null?N:s.commissionPercent)!=null?O:""}),u(!0))},Je=async()=>{if(g)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${g.id}`,Ke,"L\u1ED7i c\u1EADp nh\u1EADt"),C("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),u(!1),pe(null),ct()}catch(s){C(s.message,"danger")}},A=async s=>{const N=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${N} "${s.name}"?`))try{let O="";s._type==="product"?O=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?O=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(O=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(O,"L\u1ED7i x\xF3a"),C(`\u0110\xE3 x\xF3a ${N}`,"success"),ct()}catch(O){C(O.message,"danger")}},Be=async s=>{try{const N=He?`${API_BASE}/api/products?id=${He.id}`:`${API_BASE}/api/products`;He?await window.KTM.api.putJSON(N,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(N,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),C(He?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Te(!1),Z(null),ct()}catch(N){C(N.message,"danger")}},ae="ktm_admin_data_cache_v1",lt=1e3*60*10,ct=async()=>{let s=null,N=!1;const O=window.KTM.cache.read(ae,{ttlMs:lt,validate:Array.isArray});O.hit?(s=O.value,console.log("[CACHE] Using cache, items:",s.length),ce(s),w(s),ve(!1),N=!0):O.status==="miss"?console.log("[CACHE] No cache found"):O.status==="expired"||O.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):O.status==="error"&&console.error("[CACHE] Error parsing cache"),N||ve(!0);try{const B=async(We,Ee)=>{try{const at=await window.KTM.api.getJSON(We,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return at!=null?at:Ee}catch(at){return Ee}},[Y,T,p]=await Promise.all([B(`${API_BASE}/api/products?fields=search`,[]),B(`${API_BASE}/api/albums`,[]),B(`${API_BASE}/api/video-folders?withVideos=true`,[])]),V=Array.isArray(Y)?Y.map(We=>({...We,_type:"product",_source:"database"})):[];De(T);let ee=[];Array.isArray(T)&&T.length>0&&(await Promise.all(T.map(Ee=>B(`${API_BASE}/api/albums/${Ee.id}`,{})))).forEach((Ee,at)=>{const bt=T[at];Ee.images&&Ee.images.length>0&&Ee.images.forEach(mt=>{ee.push({id:mt.id,name:mt.caption||"\u1EA2nh t\u1EEB "+bt.title,image:mt.src,folder:bt.title,_type:"album",_source:"database"})})}),_e(p);let ne=[];Array.isArray(p)&&p.forEach(We=>{We.videos&&We.videos.forEach(Ee=>{ne.push({id:Ee.id,name:Ee.title,folder:We.name,image:Ee.thumb,youtubeId:Ee.youtubeId,url:Ee.url,_type:"video",_source:"database"})})});const G=[...V,...ee,...ne];(!s||JSON.stringify(G)!==JSON.stringify(s))&&(ce(G),w(G),window.KTM.cache.write(ae,G))}catch(B){console.error("Song song fetch error:",B)}ve(!1)};useEffect(()=>{ct(),setTimeout(()=>{var s;return(s=ye.current)==null?void 0:s.focus()},100)},[]);const Ze=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(N){return String(s!=null?s:"").toLowerCase()}},ft=s=>{const O=Ze(s).trim().split(/\s+/).filter(Boolean),B=O.includes("anh"),Y=O.includes("video"),T=O.filter(ee=>ee!=="anh"&&ee!=="video"),p=T.join(" "),V=new Set(["product"]);return B&&V.add("album"),Y&&V.add("video"),{allowedTypes:V,includeAlbum:B,includeVideo:Y,contentTokens:T,cleanedQuery:p}},h=(s,N,O)=>{var We,Ee,at,bt,mt;const B=Array.isArray(N)?N:[],Y=Ze(O).trim();if(!B.length&&!Y)return 0;const T=Ze((We=s==null?void 0:s.name)!=null?We:""),p=Ze((Ee=s==null?void 0:s.code)!=null?Ee:""),V=Ze((at=s==null?void 0:s.category)!=null?at:""),ee=Ze((bt=s==null?void 0:s.note)!=null?bt:""),ne=Ze((mt=s==null?void 0:s.folder)!=null?mt:"");if(!`${T} ${p} ${V} ${ee} ${ne}`.trim())return 0;let he=0;Y&&(T===Y&&(he+=220),T.includes(Y)&&(he+=140),T.startsWith(Y)&&(he+=160),p&&p===Y&&(he+=180),p&&p.includes(Y)&&(he+=90));for(const ut of B){if(!ut)continue;const ze=new RegExp(`(?:^|\\s)${ut.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);T.includes(ut)&&(he+=35),ze.test(T)&&(he+=25),p&&p.includes(ut)&&(he+=20),p&&ze.test(p)&&(he+=10),V&&V.includes(ut)&&(he+=12),ne&&ne.includes(ut)&&(he+=12),ee&&ee.includes(ut)&&(he+=6)}return he>0&&T&&(he+=Math.max(0,10-Math.min(10,Math.floor(T.length/10)))),he},U=(s,N,O)=>{const B=Array.isArray(s)?s:[];return B.length?B.map((T,p)=>({it:T,idx:p,score:h(T,N,O)})).sort((T,p)=>p.score!==T.score?p.score-T.score:T.idx-p.idx).map(T=>T.it):[]},ie=async(s,N)=>{if(!(!Ie||N.length===0)){Ce(!0);try{const O=N.map(Y=>({id:Y.id,name:Y.name,price:Y.price,category:Y.category,note:Y.note,folder:Y.folder,_type:Y._type})),B=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:O},"AI Search error");if(B&&B.matchedIds&&B.matchedIds.length>0){const{contentTokens:Y,cleanedQuery:T}=ft(s),p=new Set(B.matchedIds),V=N.filter(ee=>p.has(ee.id)).sort((ee,ne)=>h(ne,Y,T)-h(ee,Y,T));V.length>0&&w(V)}else B&&B.matchedIds&&B.matchedIds.length===0&&w([])}catch(O){console.error("AI Search error:",O)}Ce(!1)}},Ge=s=>{if(te(s),qe.current&&clearTimeout(qe.current),!s.trim()){et(ue);return}const{allowedTypes:N,contentTokens:O,cleanedQuery:B}=ft(s),Y=D.filter(p=>{if(!N.has(p==null?void 0:p._type))return!1;if(O.length===0)return!0;const V=Ze(Object.entries(p).filter(([ee])=>!ee.startsWith("_")).map(([,ee])=>String(ee||"")).join(" "));return O.some(ee=>V.includes(ee))});let T=Y;ue!=="all"&&(T=Y.filter(p=>(p.category||p._type)===ue)),w(U(T,O,B)),Ie&&B.length>=3&&(qe.current=setTimeout(()=>{ie(B,T)},500))},et=s=>{xe(s);const{allowedTypes:N,contentTokens:O}=ft(j),{cleanedQuery:B}=ft(j);let Y=D.filter(T=>N.has(T==null?void 0:T._type));s!=="all"&&(Y=Y.filter(T=>(T.category||T._type)===s)),j.trim()&&O.length>0&&(Y=Y.filter(T=>{const p=Ze(Object.entries(T).filter(([V])=>!V.startsWith("_")).map(([,V])=>String(V||"")).join(" "));return O.every(V=>p.includes(V))})),w(U(Y,O,B))},Ue=(s,N)=>{window.KTM.clipboard.writeText(s).then(()=>{se(N),C("\u0110\xE3 copy!","success"),setTimeout(()=>se(null),1500)})},dt=async(s,N)=>{try{await window.KTM.clipboard.writeImageFromUrl(s),se(N+"-img"),C("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>se(null),1500)}catch(O){Ue(s,N+"-img")}},Qe=s=>{let N=s.toLowerCase();const O=[],B=D.filter(p=>p._type==="product");if(N.includes("ty")||N.includes("xy lanh")){if(N.includes("gi\u1EEFa")||N.includes("giua")){const p=B.find(V=>{var ee;return(ee=V.name)==null?void 0:ee.toLowerCase().includes("xy lanh gi\u1EEFa")});p&&!O.find(V=>V.id===p.id)&&O.push(p)}if(N.includes("nghi\xEAng")||N.includes("nghieng")){const p=B.find(V=>{var ee;return(ee=V.name)==null?void 0:ee.toLowerCase().includes("xy lanh nghi\xEAng")});p&&!O.find(V=>V.id===p.id)&&O.push(p)}if(N.includes("\u1EE7i")||N.includes("ui")){const p=B.find(V=>{var ee;return(ee=V.name)==null?void 0:ee.toLowerCase().includes("xy lanh \u1EE7i")});p&&!O.find(V=>V.id===p.id)&&O.push(p)}}const Y=N.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(Y){const p=Y[1],V=Y[2],ee=B.find(ne=>{var he;const G=((he=ne.name)==null?void 0:he.toLowerCase())||"";return G.includes("combo")&&G.includes(`${p} tay`)&&(G.includes(`${V} xy`)||G.includes(`${V} xylanh`))});if(ee&&!O.find(ne=>ne.id===ee.id))O.push(ee);else{const ne=B.find(G=>{var We;const he=((We=G.name)==null?void 0:We.toLowerCase())||"";return he.includes("combo")&&he.includes(`${p} tay`)});ne&&!O.find(G=>G.id===ne.id)&&O.push(ne)}}if(N.includes("combo")&&!Y){const p=N.match(/combo.*?(\d+)\s*tay/);if(p){const V=p[1];B.filter(ne=>{var he;const G=((he=ne.name)==null?void 0:he.toLowerCase())||"";return G.includes("combo")&&G.includes(`${V} tay`)}).forEach(ne=>{O.find(G=>G.id===ne.id)||O.push(ne)})}}const T=N.match(/van\s*(\d+)\s*tay/);if(T&&!N.includes("ty")&&!N.includes("combo")){const p=T[1],V=B.find(ee=>{var G;const ne=((G=ee.name)==null?void 0:G.toLowerCase())||"";return ne.includes(`van ${p} tay`)&&!ne.includes("combo")});V&&!O.find(ee=>ee.id===V.id)&&O.push(V)}return O.slice(0,4)},ht=async s=>{if(!s.trim())return;const N={role:"user",content:s,attachments:[]};i(B=>[...B,N]),v(""),E(!0);const O=Qe(s);setTimeout(()=>{var B;return(B=W.current)==null?void 0:B.scrollIntoView({behavior:"smooth"})},100);try{const Y=D.filter(G=>G._type==="product").map(G=>{let he=`- ${G.name}`;return G.code&&(he+=` (M\xE3: ${G.code})`),G.price&&(he+=` - Gi\xE1: ${G.price.replace(/[đ\s]/g,"")}\u0111`),G.category&&(he+=` [${G.category}]`),G.note&&(he+=` (${G.note})`),he}).join(`
`),p=_.slice(-6).map(G=>`${G.role==="user"?"Kh\xE1ch":"AI"}: ${G.content}`).join(`
`),V=p?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${p}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${Y}`:Y,ne=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:V,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";i(G=>[...G,{role:"assistant",content:ne,attachments:O}])}catch(B){console.error("AI Error:",B);const Y=s.toLowerCase(),T=D.filter(V=>{const ee=Object.values(V).join(" ").toLowerCase();return Y.split(" ").some(ne=>ee.includes(ne))});let p="";T.length>0?(p=`T\xECm th\u1EA5y ${T.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,T.slice(0,5).forEach(V=>{p+=`\u2022 ${V.name}`,V.price&&(p+=` - ${V.price.replace(/[đ\s]/g,"")}\u0111`),V.note&&(p+=` (${V.note})`),p+=`
`}),T.length>5&&(p+=`
...v\xE0 ${T.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):p='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',i(V=>[...V,{role:"assistant",content:p,attachments:T.slice(0,4)}])}E(!1),setTimeout(()=>{var B,Y;(B=W.current)==null||B.scrollIntoView({behavior:"smooth"}),(Y=P.current)==null||Y.focus()},100)};function Vt({show:s,product:N,categories:O,onClose:B,onSave:Y}){const[T,p]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[V,ee]=useState(!1),[ne,G]=useState(!1),he=useRef(null),We=M=>window.KTM.money.formatVNDInputDigits(M),Ee=M=>{const R=window.KTM.money.getDigits(String(M!=null?M:"")),F=Number(R);return R&&Number.isFinite(F)?Math.trunc(F):0},at=(M,R)=>{if(M==null||M==="")return[];let F=M;if(typeof F=="string"){const re=F.trim();if(!re)return[];try{F=JSON.parse(re)}catch(oe){return[]}}if(!Array.isArray(F))return[];const K=Ee(R);return F.map(re=>{var Me;if(!re||typeof re!="object")return null;const oe=String((Me=re.name)!=null?Me:"").trim(),Ne=(Array.isArray(re.options)?re.options:[]).map(Re=>{var vt,yt,St,Nt,It,Dt,Wt;if(!Re||typeof Re!="object")return null;const Xe=String((vt=Re.label)!=null?vt:"").trim();if(!Xe)return null;const ot=(It=(Nt=(St=(yt=Re.price)!=null?yt:Re.priceValue)!=null?St:Re.unit_price)!=null?Nt:Re.unitPrice)!=null?It:null,st=Number(ot);let $e=Number.isFinite(st)?Math.trunc(st):null;if($e==null){const ma=(Wt=(Dt=Re.price_delta)!=null?Dt:Re.priceDelta)!=null?Wt:null,Kt=Number(ma);Number.isFinite(Kt)&&($e=K+Math.trunc(Kt))}$e==null&&($e=K);const gt=String(Math.max(0,Math.trunc(Number($e)||0)));return{label:Xe,price:Math.max(0,Math.trunc(Number($e)||0)),priceDigits:gt}}).filter(Boolean);return{name:oe||"Bi\u1EBFn th\u1EC3",options:Ne}}).filter(Boolean)},bt=M=>{if(M==null||M==="")return[];let R=M;if(typeof R=="string"){const F=R.trim();if(!F)return[];try{R=JSON.parse(F)}catch(K){return[]}}return R&&typeof R=="object"&&!Array.isArray(R)&&(R=Object.entries(R).map(([F,K])=>({key:F,value:K}))),Array.isArray(R)?R.map(F=>{var Ne,Me,Re,Xe,ot;if(!F||typeof F!="object")return null;const K=String((Re=(Me=(Ne=F.key)!=null?Ne:F.name)!=null?Me:F.label)!=null?Re:"").trim(),re=String((Xe=F.value)!=null?Xe:"").trim(),oe=String((ot=F.unit)!=null?ot:"").trim();return K?{key:K,value:re,unit:oe}:null}).filter(Boolean):[]};useEffect(()=>{var M,R;if(N)if(p({name:N.name||"",code:N.code||"",price:N.price||"",image:N.image||"",category:N.category||"",note:N.note||"",sort_order:N.sort_order||0,commission_percent:(R=(M=N.commission_percent)!=null?M:N.commissionPercent)!=null?R:5,variants:at(N.variants,N.price),attributes:bt(N.attributes)}),N.price){const F=window.KTM.money.getDigits(N.price);_t(F),p(K=>({...K,price:We(F)}))}else _t("");else p({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),_t("")},[N,s]);const mt=M=>{p(R=>{var Ne;const F=Ee(R.price),K=String(F),re=Array.isArray(R.variants)?[...R.variants]:[],oe={...re[M]||{},options:Array.isArray((Ne=re[M])==null?void 0:Ne.options)?[...re[M].options]:[]};return oe.options=oe.options.map(Me=>({label:String((Me==null?void 0:Me.label)||""),price:F,priceDigits:K})),re[M]=oe,{...R,variants:re}})},ut=()=>{p(M=>{const R=Ee(M.price),F=String(R),re=(Array.isArray(M.variants)?[...M.variants]:[]).map(oe=>{const Ne=(Array.isArray(oe==null?void 0:oe.options)?oe.options:[]).map(Me=>({label:String((Me==null?void 0:Me.label)||""),price:R,priceDigits:F}));return{name:String((oe==null?void 0:oe.name)||"Bi\u1EBFn th\u1EC3"),options:Ne}});return{...M,variants:re}})},[ze,la]=React.useState(""),[ca,_t]=React.useState(""),zt=M=>{const R=window.KTM.money.nextPriceInputState(M.target.value,ca);_t(R.digits),p({...T,price:R.price})},da=async(M,R=2)=>{const F=R*1024*1024;if(M.size<=F)return M;try{const K=await createImageBitmap(M),re=document.createElement("canvas");let oe=K.width,Ne=K.height;const Me=1200;return(oe>Me||Ne>Me)&&(oe>Ne?(Ne=Math.round(Ne/oe*Me),oe=Me):(oe=Math.round(oe/Ne*Me),Ne=Me)),re.width=oe,re.height=Ne,re.getContext("2d").drawImage(K,0,0,oe,Ne),K.close(),new Promise((Xe,ot)=>{re.toBlob(st=>{st?Xe(new File([st],M.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ot(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(K){throw console.error("Compress error:",K),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Bt=async M=>{var K;const R=M.target.files[0];if(!R)return;if(!(R.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(R.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}G(!0);try{const re=await da(R),oe=await window.KTM.cloudinary.uploadImage({file:re,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!oe.secure_url)throw console.error("Cloudinary error:",oe),new Error(((K=oe.error)==null?void 0:K.message)||"Upload failed");p(Ne=>({...Ne,image:oe.secure_url}))}catch(re){console.error("Upload error:",re),alert("L\u1ED7i upload \u1EA3nh: "+re.message)}G(!1),M.target.value=""},Jt=async M=>{M.preventDefault(),ee(!0);const R={...T,variants:at(T.variants,T.price),attributes:bt(T.attributes)};await Y(R),ee(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),N?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:B})),React.createElement("form",{onSubmit:Jt},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:T.name,onChange:M=>p({...T,name:M.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:T.code,onChange:M=>p({...T,code:M.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:T.price,onChange:zt,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:T.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:M=>p({...T,commission_percent:M.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:T.category,onChange:M=>p({...T,category:M.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),O.map(M=>React.createElement("option",{key:M,value:M},M)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:T.note,onChange:M=>p({...T,note:M.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.attributes)?T.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(T.attributes)?T.attributes:[]).map((M,R)=>React.createElement("div",{key:R,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.key)||"",onChange:F=>{const K=F.target.value;p(re=>{const oe=Array.isArray(re.attributes)?[...re.attributes]:[];return oe[R]={...oe[R]||{},key:K},{...re,attributes:oe}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.value)||"",onChange:F=>{const K=F.target.value;p(re=>{const oe=Array.isArray(re.attributes)?[...re.attributes]:[];return oe[R]={...oe[R]||{},value:K},{...re,attributes:oe}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.unit)||"",onChange:F=>{const K=F.target.value;p(re=>{const oe=Array.isArray(re.attributes)?[...re.attributes]:[];return oe[R]={...oe[R]||{},unit:K},{...re,attributes:oe}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{p(F=>{const K=Array.isArray(F.attributes)?[...F.attributes]:[];return K.splice(R,1),{...F,attributes:K}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{p(M=>{const R=Array.isArray(M.attributes)?[...M.attributes]:[];return R.push({key:"",value:"",unit:""}),{...M,attributes:R}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.variants)?T.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(T.variants)?T.variants:[]).map((M,R)=>React.createElement("div",{key:R,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.name)||"",onChange:F=>{const K=F.target.value;p(re=>{var Ne;const oe=Array.isArray(re.variants)?[...re.variants]:[];return oe[R]={...oe[R]||{},name:K,options:Array.isArray((Ne=oe[R])==null?void 0:Ne.options)?oe[R].options:[]},{...re,variants:oe}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>mt(R),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(M==null?void 0:M.options)||M.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{p(F=>{const K=Array.isArray(F.variants)?[...F.variants]:[];return K.splice(R,1),{...F,variants:K}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(M==null?void 0:M.options)?M.options:[]).map((F,K)=>{var re,oe;return React.createElement("div",{key:K,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(F==null?void 0:F.label)||"",onChange:Ne=>{const Me=Ne.target.value;p(Re=>{var gt,vt,yt,St,Nt;const Xe=Array.isArray(Re.variants)?[...Re.variants]:[],ot={...Xe[R]||{},options:Array.isArray((gt=Xe[R])==null?void 0:gt.options)?[...Xe[R].options]:[]},st=Number((yt=(vt=ot.options[K])==null?void 0:vt.price)!=null?yt:0)||0,$e=String((Nt=(St=ot.options[K])==null?void 0:St.priceDigits)!=null?Nt:Math.max(0,Math.trunc(st)));return ot.options[K]={...ot.options[K]||{},label:Me,price:Math.max(0,Math.trunc(st)),priceDigits:$e},Xe[R]=ot,{...Re,variants:Xe}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:We(String((oe=F==null?void 0:F.priceDigits)!=null?oe:window.KTM.money.getDigits(String((re=F==null?void 0:F.price)!=null?re:"")))),onChange:Ne=>{p(Me=>{var yt,St,Nt,It,Dt;const Re=String((St=F==null?void 0:F.priceDigits)!=null?St:window.KTM.money.getDigits(String((yt=F==null?void 0:F.price)!=null?yt:""))),Xe=window.KTM.money.nextPriceInputState(Ne.target.value,Re),ot=String((Nt=Xe.digits)!=null?Nt:""),st=Number(ot),$e=Number.isFinite(st)?Math.max(0,Math.trunc(st)):0,gt=Array.isArray(Me.variants)?[...Me.variants]:[],vt={...gt[R]||{},options:Array.isArray((It=gt[R])==null?void 0:It.options)?[...gt[R].options]:[]};return vt.options[K]={...vt.options[K]||{},label:String(((Dt=vt.options[K])==null?void 0:Dt.label)||""),price:$e,priceDigits:ot},gt[R]=vt,{...Me,variants:gt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{p(Ne=>{var Xe;const Me=Array.isArray(Ne.variants)?[...Ne.variants]:[],Re={...Me[R]||{},options:Array.isArray((Xe=Me[R])==null?void 0:Xe.options)?[...Me[R].options]:[]};return Re.options.splice(K,1),Me[R]=Re,{...Ne,variants:Me}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{p(F=>{var Ne;const K=Array.isArray(F.variants)?[...F.variants]:[],re={...K[R]||{},options:Array.isArray((Ne=K[R])==null?void 0:Ne.options)?[...K[R].options]:[]},oe=Ee(F.price);return re.options.push({label:"",price:oe,priceDigits:String(oe)}),K[R]=re,{...F,variants:K}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{p(M=>{const R=Ee(M.price),F=Array.isArray(M.variants)?[...M.variants]:[],K=String(R);return F.push({name:"Size",options:[{label:"S",price:R,priceDigits:K},{label:"M",price:R,priceDigits:K},{label:"L",price:R,priceDigits:K}]}),{...M,variants:F}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ut,disabled:!Array.isArray(T.variants)||T.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},T.image?React.createElement(React.Fragment,null,React.createElement("img",{src:T.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>p({...T,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var M;return(M=he.current)==null?void 0:M.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:he,type:"file",accept:"image/*",className:"d-none",onChange:Bt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var M;return(M=he.current)==null?void 0:M.click()},disabled:ne,style:{borderRadius:"10px"}},ne?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:T.image,onChange:M=>p({...T,image:M.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:B,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:V,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const xt=s=>window.KTM.money.formatVND(s),$t=s=>{if(s==null||s==="")return[];let N=s;if(typeof N=="string"){const O=N.trim();if(!O)return[];try{N=JSON.parse(O)}catch(B){return[]}}return Array.isArray(N)?N:[]},Lt=s=>{if(s==null||s==="")return[];let N=s;if(typeof N=="string"){const O=N.trim();if(!O)return[];try{N=JSON.parse(O)}catch(B){return[]}}return N&&typeof N=="object"&&!Array.isArray(N)&&(N=Object.entries(N).map(([O,B])=>({key:O,value:B}))),Array.isArray(N)?N:[]},Tt=(s,N={})=>{var T;const O=Lt(s).map(p=>{var V,ee,ne,G,he;return{key:String((ne=(ee=(V=p==null?void 0:p.key)!=null?V:p==null?void 0:p.name)!=null?ee:p==null?void 0:p.label)!=null?ne:"").trim(),value:String((G=p==null?void 0:p.value)!=null?G:"").trim(),unit:String((he=p==null?void 0:p.unit)!=null?he:"").trim()}}).filter(p=>!!p.key);if(!O.length)return null;const B=!!N.compact,Y=String((T=N.className)!=null?T:"").trim();return React.createElement("div",{className:`ktm-variants-preview${B?" compact":""}${Y?" "+Y:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},O.map((p,V)=>{const ee=p.key,ne=`${p.value||""}${p.unit?(p.value?" ":"")+p.unit:""}`.trim();return React.createElement("div",{key:`${ee}-${V}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ee),ne?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ne):null)})))},jt=(s,N={})=>{var ee;const O=$t(s).map(ne=>{var G;return{name:String((G=ne==null?void 0:ne.name)!=null?G:"").trim(),options:Array.isArray(ne==null?void 0:ne.options)?ne.options:[]}}).map(ne=>({...ne,options:ne.options.map(G=>{var he;return{label:String((he=G==null?void 0:G.label)!=null?he:"").trim(),price:Number(G==null?void 0:G.price)}}).filter(G=>!!G.label)})).filter(ne=>ne.options.length>0);if(!O.length)return null;const B=Number.isFinite(N.maxGroups)?Math.max(1,Math.trunc(N.maxGroups)):O.length,Y=Number.isFinite(N.maxOptionsPerGroup)?Math.max(1,Math.trunc(N.maxOptionsPerGroup)):3,T=!!N.compact,p=String((ee=N.className)!=null?ee:"").trim(),V=O.slice(0,B);return React.createElement("div",{className:`ktm-variants-preview${T?" compact":""}${p?" "+p:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},V.map((ne,G)=>{const he=ne.name||"Bi\u1EBFn th\u1EC3",We=ne.options.slice(0,Y),Ee=ne.options.length-We.length;return React.createElement("div",{key:`${he}-${G}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},he),We.map((at,bt)=>{const mt=at.price,ut=Number.isFinite(mt)&&mt>=0?xt(Math.trunc(mt)):"",ze=ut?`${at.label} \xB7 ${ut}`:at.label;return React.createElement("span",{key:`${he}-${G}-${bt}`,className:"ktm-chip ktm-chip-option"},ze)}),Ee>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",Ee))})))},qt=(s,N)=>{const O=s._type==="product",B=s._type==="album",Y=s._type==="video",T=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),p=O?Tt(s.attributes,{compact:fe==="grid",className:fe==="grid"?"meta text-muted":"text-muted"}):null,V=O?jt(s.variants,{compact:fe==="grid",maxOptionsPerGroup:999,className:fe==="grid"?"meta text-muted":"text-muted"}):null;return fe==="grid"?React.createElement("div",{key:s.id||N,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>be({url:s.image,name:s.name,price:s.price,note:s.note,item:s})},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Y?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${O?"product":B?"album":"video"}`},O?"SP":B?"\u1EA2nh":"Video"),T&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),p&&React.createElement("div",{style:{marginTop:2}},p),V&&React.createElement("div",{style:{marginTop:2}},V),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:le===s.id+"-img"?"copied":"",onClick:()=>dt(s.image,s.id)},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:le===s.id+"-price"?"copied":"",onClick:()=>Ue(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||N,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${O?"product":B?"album":"video"}`},O?"S\u1EA3n ph\u1EA9m":B?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>be({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Y?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),T&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),p&&React.createElement("div",{style:{marginTop:4}},p),V&&React.createElement("div",{style:{marginTop:4}},V)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),Y&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},O&&React.createElement("button",{onClick:()=>x&&x("orders","create",{productId:s.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:le===s.id+"-price"?"copied":"",onClick:()=>Ue(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:le===s.id+"-name"?"copied":"",onClick:()=>Ue(s.name,s.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),Y&&s.youtubeId&&React.createElement("button",{className:le===s.id+"-yt"?"copied":"",onClick:()=>Ue(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),O&&React.createElement("button",{className:"action-edit",onClick:()=>ge(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>A(s)},React.createElement("i",{className:"fas fa-trash"}))))},[Pt,Ot]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,J.length)," k\u1EBFt qu\u1EA3",Ie&&j.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),ue!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},ue==="product"?"S\u1EA3n ph\u1EA9m":ue==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${fe==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Fe("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${fe==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Fe("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},me?React.createElement("div",null,[...Array(8)].map((s,N)=>React.createElement("div",{key:N,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):J.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',j,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{te(""),Ge("")}},"Xem t\u1EA5t c\u1EA3")):fe==="grid"?React.createElement("div",{className:"product-grid-mobile"},J.map((s,N)=>qt(s,N))):React.createElement("div",null,J.map((s,N)=>qt(s,N)))),Pt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Ot(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${ue==="all"?"active":""}`,onClick:()=>{et("all"),Ot(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${ue==="product"?"active":""}`,onClick:()=>{et("product"),Ot(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${ue==="album"?"active":""}`,onClick:()=>{et("album"),Ot(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${ue==="video"?"active":""}`,onClick:()=>{et("video"),Ot(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Ie,onChange:s=>Ae(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:ye,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:j,onChange:s=>Ge(s.target.value)}),React.createElement("button",{className:`filter-btn ${Pt||ue!=="all"?"active":""}`,onClick:()=>Ot(!Pt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:S?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>m(!0),onTouchStart:()=>m(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Le&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>m(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},_.map((s,N)=>React.createElement("div",{key:N,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:le===`chat-${N}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:le===`chat-${N}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),se(`chat-${N}`),setTimeout(()=>se(null),1500)}},React.createElement("i",{className:`fas ${le===`chat-${N}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((O,B)=>React.createElement("div",{key:B,style:{width:70},className:"text-center"},O.image&&React.createElement("img",{src:O.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>be({url:O.image,name:O.name,price:O.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},O.name),O.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},O.price.replace(/[đ\s]/g,""),"\u0111"))))))),$&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:W})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>ht(s),disabled:$,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),ht(b)},className:"chat-input-wrap"},React.createElement("input",{ref:P,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:b,onChange:s=>v(s.target.value),disabled:$}),React.createElement("button",{type:"submit",className:"send-btn",disabled:$||!b.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),q&&React.createElement("div",{className:"preview-modal",onClick:()=>be(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>be(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:q.url,alt:q.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},q.name),q.price&&React.createElement("div",{className:"price"},q.price.replace(/[đ\s]/g,""),"\u0111"),q.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},q.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:le==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:le==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>dt(q.url,"preview")},React.createElement("i",{className:`fas ${le==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),q.price&&React.createElement("button",{className:le==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Ue(q.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${le==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Vt,{show:Q,product:He,categories:de,onClose:()=>{Te(!1),Z(null)},onSave:Be}),React.createElement("div",{className:`fab-container mobile-only ${S?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{L(!1),Te(!0),Z(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{L(!1),x&&x("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${S?"open":""}`,onClick:()=>L(!S)},React.createElement("i",{className:"fas fa-plus"}))),Pe&&g&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>u(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Ke.name,onChange:s=>Ye({...Ke,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Ke.code,onChange:s=>Ye({...Ke,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Ke.price,onChange:s=>Ye({...Ke,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Ke.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>Ye({...Ke,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Ke.category,onChange:s=>Ye({...Ke,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),pt.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Ke.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>Ye({...Ke,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>u(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:Je},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:C,showToast:x}){const[j,te]=useState([]),[J,w]=useState([]),[D,ce]=useState(!0),[de,z]=useState(null),[ue,xe]=useState(!1),[le,se]=useState(null),[fe,Fe]=useState(!1),[me,ve]=useState(null),[we,De]=useState(null),[Oe,_e]=useState([]);useEffect(()=>{ye()},[]);const ye=async(u=null)=>{ce(!0);try{const g=u?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${u}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,pe=await window.KTM.api.getJSON(g,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");te(Array.isArray(pe)?pe:[])}catch(g){console.error(g),x("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}ce(!1)},Ie=async u=>{try{const g=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${u}`,"L\u1ED7i t\u1EA3i video");w(Array.isArray(g)?g:[])}catch(g){console.error(g)}},Ae=async u=>{if(u===0)return;const g=[...j];[g[u-1],g[u]]=[g[u],g[u-1]],te(g),await Ce(g)},tt=async u=>{if(u===j.length-1)return;const g=[...j];[g[u],g[u+1]]=[g[u+1],g[u]],te(g),await Ce(g)},Ce=async u=>{try{await Promise.all(u.map((g,pe)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${g.id}`,{sortOrder:pe},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),x("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(g){x("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ye(we==null?void 0:we.id)}},qe=async u=>{if(u===0)return;const g=[...J];[g[u-1],g[u]]=[g[u],g[u-1]],w(g),await m(g)},Le=async u=>{if(u===J.length-1)return;const g=[...J];[g[u],g[u+1]]=[g[u+1],g[u]],w(g),await m(g)},m=async u=>{try{await Promise.all(u.map((g,pe)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${g.id}`,{sort_order:pe},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),x("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(g){x("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),Ie(de.id)}},_=()=>{se(null),xe(!0)},i=u=>{se(u),xe(!0)},b=async u=>{try{!le&&we&&(u.parent_id=we.id);const g=le?`${API_BASE}/api/video-folders/${le.id}`:`${API_BASE}/api/video-folders`;le?await window.KTM.api.putJSON(g,u,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(g,u,"L\u1ED7i l\u01B0u folder"),x(le?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),xe(!1),ye(we==null?void 0:we.id)}catch(g){x(g.message,"danger")}},v=async u=>{const g=u.subfolderCount>0?`X\xF3a folder "${u.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${u.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(g))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${u.id}`,"L\u1ED7i x\xF3a folder"),x("\u0110\xE3 x\xF3a folder","success"),z(null),ye(we==null?void 0:we.id)}catch(pe){x("L\u1ED7i x\xF3a folder","danger")}},$=u=>{u.subfolderCount>0?(_e(g=>[...g,u]),De(u),ye(u.id)):(z(u),w(u.videos||[]))},E=u=>{if(u==="root")_e([]),De(null),ye(null);else if(u){const g=Oe.findIndex(pe=>pe.id===u.id);g>=0&&(_e(Oe.slice(0,g+1)),De(u),ye(u.id))}else{const g=[...Oe];g.pop();const pe=g[g.length-1]||null;_e(g),De(pe),ye(pe==null?void 0:pe.id)}},W=()=>{ve(null),Fe(!0)},P=u=>{ve(u),Fe(!0)},q=async u=>{try{u.folder_id=de==null?void 0:de.id;const g=me?`${API_BASE}/api/videos/${me.id}`:`${API_BASE}/api/videos`;me?await window.KTM.api.putJSON(g,u,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(g,u,"L\u1ED7i l\u01B0u video"),x(me?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),Fe(!1),ye(),de&&Ie(de.id)}catch(g){x(g.message,"danger")}},be=async u=>{if(confirm(`X\xF3a video "${u.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${u.id}`,"L\u1ED7i x\xF3a video"),x("\u0110\xE3 x\xF3a video","success"),ye(),de&&Ie(de.id)}catch(g){x("L\u1ED7i x\xF3a video","danger")}},Pe=u=>{const g=`https://www.youtube.com/watch?v=${u.youtubeId}`;window.KTM.clipboard.writeText(g).then(()=>{x("\u0110\xE3 copy link!","success")}).catch(()=>{x("Kh\xF4ng th\u1EC3 copy link","danger")})};return de?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>z(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${de.slug==="shorts"?"text-danger":"text-warning"}`}),de.name)),React.createElement("button",{className:"btn btn-warning",onClick:W},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),J.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},J.map((u,g)=>React.createElement("div",{key:u.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>qe(g),disabled:g===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},g+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Le(g),disabled:g===J.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:u.thumb,className:"card-img-top",alt:u.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${u.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:u.title},u.title),React.createElement("small",{className:"text-muted"},u.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Pe(u),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>P(u),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>be(u),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:fe,video:me,onClose:()=>Fe(!1),onSave:q})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},we&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>E()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),we?we.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:_},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Oe.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:u=>{u.preventDefault(),E("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Oe.map((u,g)=>React.createElement("li",{key:u.id,className:`breadcrumb-item ${g===Oe.length-1?"active":""}`},g===Oe.length-1?u.name:React.createElement("a",{href:"#",onClick:pe=>{pe.preventDefault(),E(u)},className:"text-warning"},u.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),D?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):j.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},we?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:_},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",we?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},j.map((u,g)=>{var pe,S,L,Q;return React.createElement("div",{key:u.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Te=>{Te.stopPropagation(),Ae(g)},disabled:g===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},g+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Te=>{Te.stopPropagation(),tt(g)},disabled:g===j.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>$(u),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${u.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},u.name),React.createElement("p",{className:"text-muted mb-0"},u.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),u.subfolderCount," folder"),u.subfolderCount>0&&(u.videoCount>0||((pe=u.videos)==null?void 0:pe.length)>0)&&" \u2022 ",(u.videoCount>0||((S=u.videos)==null?void 0:S.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),u.videoCount||((L=u.videos)==null?void 0:L.length)||0," videos"),u.subfolderCount===0&&!u.videoCount&&!((Q=u.videos)!=null&&Q.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Te=>{Te.stopPropagation(),i(u)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Te=>{Te.stopPropagation(),v(u)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:ue,folder:le,onClose:()=>xe(!1),onSave:b}))}function VideoFolderModal({show:C,folder:x,onClose:j,onSave:te}){const[J,w]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[D,ce]=useState(!1),[de,z]=useState(!1);useEffect(()=>{w(x?{name:x.name||"",description:x.description||"",sortOrder:x.sortOrder||0,coverImage:x.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[x,C]);const ue=async le=>{const se=le.target.files[0];if(se){z(!0);try{const fe=await window.KTM.cloudinary.uploadImage({file:se,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});fe.secure_url&&w(Fe=>({...Fe,coverImage:fe.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(fe){console.error("Cloudinary upload error:",fe),alert("L\u1ED7i upload \u1EA3nh: "+(fe.message||fe))}finally{z(!1)}}},xe=async le=>{le.preventDefault(),ce(!0);const se={...J,variants:normalizeVariants(J.variants,J.price),attributes:normalizeAttributes(J.attributes)};await te(se),ce(!1)};return C?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:xe},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:J.name,onChange:le=>w({...J,name:le.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:J.description,onChange:le=>w({...J,description:le.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:J.sortOrder,onChange:le=>w({...J,sortOrder:parseInt(le.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},J.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:J.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>w({...J,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:ue,disabled:de}),de&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:J.coverImage,onChange:le=>w({...J,coverImage:le.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:D},D?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:C,settings:x}){const[j,te]=useState([]),[J,w]=useState(!0),[D,ce]=useState(!1),[de,z]=useState(null),[ue,xe]=useState(""),[le,se]=useState(""),fe=normalizeShipPercent(x==null?void 0:x.ship_percent),{parseMoney:Fe,formatVND:me}=window.KTM.money,ve=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{we()},[]);const we=async()=>{w(!0);try{const i=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");te(Array.isArray(i)?i:[])}catch(i){console.error(i),C("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}w(!1)},De=()=>{z(null),ce(!0)},Oe=i=>{z(i),ce(!0)},_e=async i=>{if(!(!i||!i.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:i},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),C(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),we()}catch(b){C("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},ye=async i=>{try{const b=de?`${API_BASE}/api/products?id=${de.id}`:`${API_BASE}/api/products`;de?await window.KTM.api.putJSON(b,i,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(b,i,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),C(de?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ce(!1),we()}catch(b){C(b.message,"danger")}},Ie=async i=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${i.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${i.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),C("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),we()}catch(b){C(b.message,"danger")}},Ae=j.filter(i=>{const b=!ue||i.name.toLowerCase().includes(ue.toLowerCase())||i.code&&i.code.toLowerCase().includes(ue.toLowerCase()),v=!le||i.category===le;return b&&v}),tt=i=>{var $;const b=($=i==null?void 0:i.commission_percent)!=null?$:i==null?void 0:i.commissionPercent,v=b===""||b==null?NaN:Number(b);return Number.isFinite(v)?Math.max(0,Math.min(100,v)):5},Ce=i=>{const b=tt(i),v=Number.isInteger(b)?String(b):String(Math.round(b*100)/100),$=Fe(i==null?void 0:i.price);if(!Number.isFinite($)||$<=0)return`${v}%`;const E=(Number(b)||0)/100,P=window.KTM.money.parseShipFeeFromNote(i==null?void 0:i.note)!=null?0:fe>0?$*fe/100:0,q=$*E-P*E,be=Math.max(0,Math.round(q));return`${v}% - ${me(be)}`},qe=i=>{if(i==null||i==="")return[];let b=i;if(typeof b=="string"){const v=b.trim();if(!v)return[];try{b=JSON.parse(v)}catch($){return[]}}return Array.isArray(b)?b:[]},Le=i=>{if(i==null||i==="")return[];let b=i;if(typeof b=="string"){const v=b.trim();if(!v)return[];try{b=JSON.parse(v)}catch($){return[]}}return b&&typeof b=="object"&&!Array.isArray(b)&&(b=Object.entries(b).map(([v,$])=>({key:v,value:$}))),Array.isArray(b)?b:[]},m=i=>{const b=Le(i).map(v=>{var $,E,W,P,q;return{key:String((W=(E=($=v==null?void 0:v.key)!=null?$:v==null?void 0:v.name)!=null?E:v==null?void 0:v.label)!=null?W:"").trim(),value:String((P=v==null?void 0:v.value)!=null?P:"").trim(),unit:String((q=v==null?void 0:v.unit)!=null?q:"").trim()}}).filter(v=>!!v.key);return b.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},b.map((v,$)=>{const E=v.key,W=`${v.value||""}${v.unit?(v.value?" ":"")+v.unit:""}`.trim();return React.createElement("div",{key:`${E}-${$}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},E),W?React.createElement("span",{className:"ktm-chip ktm-chip-option"},W):null)}))):null},_=(i,b={})=>{const v=qe(i).map(P=>{var q;return{name:String((q=P==null?void 0:P.name)!=null?q:"").trim(),options:Array.isArray(P==null?void 0:P.options)?P.options:[]}}).map(P=>({...P,options:P.options.map(q=>{var be;return{label:String((be=q==null?void 0:q.label)!=null?be:"").trim(),price:Number(q==null?void 0:q.price)}}).filter(q=>!!q.label)})).filter(P=>P.options.length>0);if(!v.length)return null;const $=Number.isFinite(b.maxGroups)?Math.max(1,Math.trunc(b.maxGroups)):v.length,E=Number.isFinite(b.maxOptionsPerGroup)?Math.max(1,Math.trunc(b.maxOptionsPerGroup)):4,W=v.slice(0,$);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},W.map((P,q)=>{const be=P.name||"Bi\u1EBFn th\u1EC3",Pe=P.options.slice(0,E),u=P.options.length-Pe.length;return React.createElement("div",{key:`${be}-${q}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},be),Pe.map((g,pe)=>{const S=g.price,L=Number.isFinite(S)&&S>=0?me(Math.trunc(S)):"",Q=L?`${g.label} \xB7 ${L}`:g.label;return React.createElement("span",{key:`${be}-${q}-${pe}`,className:"ktm-chip ktm-chip-option"},Q)}),u>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",u))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:De},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:ue,onChange:i=>xe(i.target.value)})),React.createElement("span",{className:"product-count"},Ae.length)),React.createElement("select",{className:"form-select",value:le,onChange:i=>se(i.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),ve.map(i=>React.createElement("option",{key:i,value:i},i)))),J?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):Ae.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:De},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},Ae.map(i=>React.createElement("div",{key:i.id,className:"product-item d-flex align-items-center gap-3"},i.image?React.createElement("img",{src:i.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},i.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},i.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},i.category),i.code&&React.createElement("span",{className:"product-badge bg-secondary"},i.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),Ce(i))),React.createElement("div",{className:"product-price"},i.price?i.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),i.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},i.note),m(i.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},m(i.attributes)),_(i.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},_(i.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>Oe(i),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>Ie(i),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:D,product:de,categories:ve,onClose:()=>ce(!1),onSave:ye}))}function ProductModal({show:C,product:x,categories:j,onClose:te,onSave:J}){const[w,D]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[ce,de]=useState(!1),[z,ue]=useState(!1),xe=m=>{const _=window.KTM.money.getDigits(String(m!=null?m:"")),i=Number(_);return _&&Number.isFinite(i)?Math.trunc(i):0},le=m=>{if(m==null||m==="")return[];let _=m;if(typeof _=="string"){const i=_.trim();if(!i)return[];try{_=JSON.parse(i)}catch(b){return[]}}return _&&typeof _=="object"&&!Array.isArray(_)&&(_=Object.entries(_).map(([i,b])=>({key:i,value:b}))),Array.isArray(_)?_.map(i=>{var E,W,P,q,be;if(!i||typeof i!="object")return null;const b=String((P=(W=(E=i.key)!=null?E:i.name)!=null?W:i.label)!=null?P:"").trim(),v=String((q=i.value)!=null?q:"").trim(),$=String((be=i.unit)!=null?be:"").trim();return b?{key:b,value:v,unit:$}:null}).filter(Boolean):[]},se=(m,_)=>{if(m==null||m==="")return[];let i=m;if(typeof i=="string"){const v=i.trim();if(!v)return[];try{i=JSON.parse(v)}catch($){return[]}}if(!Array.isArray(i))return[];const b=xe(_);return i.map(v=>{var W;if(!v||typeof v!="object")return null;const $=String((W=v.name)!=null?W:"").trim(),E=(Array.isArray(v.options)?v.options:[]).map(P=>{var pe,S,L,Q,Te,He,Z;if(!P||typeof P!="object")return null;const q=String((pe=P.label)!=null?pe:"").trim();if(!q)return null;const be=(Te=(Q=(L=(S=P.price)!=null?S:P.priceValue)!=null?L:P.unit_price)!=null?Q:P.unitPrice)!=null?Te:null,Pe=Number(be);let u=Number.isFinite(Pe)?Math.trunc(Pe):null;if(u==null){const Ke=(Z=(He=P.price_delta)!=null?He:P.priceDelta)!=null?Z:null,Ye=Number(Ke);Number.isFinite(Ye)&&(u=b+Math.trunc(Ye))}u==null&&(u=b);const g=String(Math.max(0,Math.trunc(Number(u)||0)));return{label:q,price:Math.max(0,Math.trunc(Number(u)||0)),priceDigits:g}}).filter(Boolean);return{name:$||"Bi\u1EBFn th\u1EC3",options:E}}).filter(Boolean)};useEffect(()=>{var m,_;D(x?{name:x.name||"",code:x.code||"",price:x.price||"",image:x.image||"",category:x.category||"",note:x.note||"",sort_order:x.sort_order||0,commission_percent:(_=(m=x.commission_percent)!=null?m:x.commissionPercent)!=null?_:5,variants:se(x.variants,x.price),attributes:le(x.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[x,C]);const fe=m=>{D(_=>{var E;const i=xe(_.price),b=String(i),v=Array.isArray(_.variants)?[..._.variants]:[],$={...v[m]||{},options:Array.isArray((E=v[m])==null?void 0:E.options)?[...v[m].options]:[]};return $.options=$.options.map(W=>({label:String((W==null?void 0:W.label)||""),price:i,priceDigits:b})),v[m]=$,{..._,variants:v}})},Fe=()=>{D(m=>{const _=xe(m.price),i=String(_),v=(Array.isArray(m.variants)?[...m.variants]:[]).map($=>{const E=(Array.isArray($==null?void 0:$.options)?$.options:[]).map(W=>({label:String((W==null?void 0:W.label)||""),price:_,priceDigits:i}));return{name:String(($==null?void 0:$.name)||"Bi\u1EBFn th\u1EC3"),options:E}});return{...m,variants:v}})},[me,ve]=React.useState(""),we=m=>window.KTM.money.formatVNDInputDigits(m),[De,Oe]=React.useState(""),_e=m=>{const _=window.KTM.money.nextPriceInputState(m.target.value,De);Oe(_.digits),D({...w,price:_.price})},[ye,Ie]=React.useState("");React.useEffect(()=>{x!=null&&x.image&&Ie(x.image)},[x]);const Ae=async m=>{if(!(!m||!m.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:m},"L\u1ED7i x\xF3a \u1EA3nh")}catch(_){console.error("Delete cloudinary image error:",_)}},tt=async(m,_=2,i)=>{const b=_*1024*1024,v=m.type==="image/heic"||m.type==="image/heif"||/\.heic$/i.test(m.name);if(m.size<=b&&!v)return m;i==null||i("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const $=await createImageBitmap(m);i==null||i("\u0110ang n\xE9n \u1EA3nh...");const E=document.createElement("canvas");let W=$.width,P=$.height;const q=1200;return(W>q||P>q)&&(W>P?(P=Math.round(P/W*q),W=q):(W=Math.round(W/P*q),P=q)),E.width=W,E.height=P,E.getContext("2d").drawImage($,0,0,W,P),$.close(),new Promise((Pe,u)=>{E.toBlob(g=>{g?(i==null||i("Ho\xE0n t\u1EA5t!"),Pe(new File([g],m.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):u(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch($){throw console.error("createImageBitmap error:",$),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ce=async m=>{var b,v;const _=(b=m.target.files)==null?void 0:b[0];if(!_)return;if(!(_.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(_.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ue(!0),ve("\u0110ang chu\u1EA9n b\u1ECB...");try{const $=(_.size/1024/1024).toFixed(1);ve(`File ${$}MB - \u0110ang n\xE9n...`);const E=await tt(_,2,q=>{ve(q)}),W=(E.size/1024/1024).toFixed(1);ve(`\u0110\xE3 n\xE9n: ${W}MB - \u0110ang upload...`);const P=await window.KTM.cloudinary.uploadImage({file:E,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});P.secure_url?(w.image&&w.image!==ye&&Ae(w.image),D(q=>({...q,image:P.secure_url})),ve("")):(console.error("Cloudinary error:",P),alert("Upload th\u1EA5t b\u1EA1i: "+(((v=P.error)==null?void 0:v.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),ve(""))}catch($){console.error("Upload error:",$),alert("L\u1ED7i: "+$.message),ve("")}ue(!1),m.target.value=""},qe=()=>{w.image&&(w.image!==ye&&Ae(w.image),D(m=>({...m,image:""})))},Le=async m=>{m.preventDefault(),de(!0),ye&&w.image&&ye!==w.image&&await Ae(ye),ye&&!w.image&&await Ae(ye),await J(w),de(!1)};return C?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${x?"fa-edit":"fa-plus-circle"} me-2`}),x?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:te})),React.createElement("form",{onSubmit:Le},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},w.image?React.createElement(React.Fragment,null,React.createElement("img",{src:w.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:qe,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${z?"fa-spinner fa-spin":"fa-camera"} me-1`}),z?me||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Ce,disabled:z,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),z&&me&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},me))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:w.name,onChange:m=>D({...w,name:m.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:w.code,onChange:m=>D({...w,code:m.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:w.price,onChange:_e,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:w.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:m=>D({...w,commission_percent:m.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:w.category,onChange:m=>D({...w,category:m.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),j.map(m=>React.createElement("option",{key:m,value:m},m)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:w.note,onChange:m=>D({...w,note:m.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(w.attributes)?w.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(w.attributes)?w.attributes:[]).map((m,_)=>React.createElement("div",{key:_,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(m==null?void 0:m.key)||"",onChange:i=>{const b=i.target.value;D(v=>{const $=Array.isArray(v.attributes)?[...v.attributes]:[];return $[_]={...$[_]||{},key:b},{...v,attributes:$}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(m==null?void 0:m.value)||"",onChange:i=>{const b=i.target.value;D(v=>{const $=Array.isArray(v.attributes)?[...v.attributes]:[];return $[_]={...$[_]||{},value:b},{...v,attributes:$}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(m==null?void 0:m.unit)||"",onChange:i=>{const b=i.target.value;D(v=>{const $=Array.isArray(v.attributes)?[...v.attributes]:[];return $[_]={...$[_]||{},unit:b},{...v,attributes:$}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{D(i=>{const b=Array.isArray(i.attributes)?[...i.attributes]:[];return b.splice(_,1),{...i,attributes:b}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{D(m=>{const _=Array.isArray(m.attributes)?[...m.attributes]:[];return _.push({key:"",value:"",unit:""}),{...m,attributes:_}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(w.variants)?w.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(w.variants)?w.variants:[]).map((m,_)=>React.createElement("div",{key:_,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(m==null?void 0:m.name)||"",onChange:i=>{const b=i.target.value;D(v=>{var E;const $=Array.isArray(v.variants)?[...v.variants]:[];return $[_]={...$[_]||{},name:b,options:Array.isArray((E=$[_])==null?void 0:E.options)?$[_].options:[]},{...v,variants:$}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>fe(_),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(m==null?void 0:m.options)||m.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{D(i=>{const b=Array.isArray(i.variants)?[...i.variants]:[];return b.splice(_,1),{...i,variants:b}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(m==null?void 0:m.options)?m.options:[]).map((i,b)=>{var v,$;return React.createElement("div",{key:b,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(i==null?void 0:i.label)||"",onChange:E=>{const W=E.target.value;D(P=>{var g,pe,S,L,Q;const q=Array.isArray(P.variants)?[...P.variants]:[],be={...q[_]||{},options:Array.isArray((g=q[_])==null?void 0:g.options)?[...q[_].options]:[]},Pe=Number((S=(pe=be.options[b])==null?void 0:pe.price)!=null?S:0)||0,u=String((Q=(L=be.options[b])==null?void 0:L.priceDigits)!=null?Q:Math.max(0,Math.trunc(Pe)));return be.options[b]={...be.options[b]||{},label:W,price:Math.max(0,Math.trunc(Pe)),priceDigits:u},q[_]=be,{...P,variants:q}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:we(String(($=i==null?void 0:i.priceDigits)!=null?$:window.KTM.money.getDigits(String((v=i==null?void 0:i.price)!=null?v:"")))),onChange:E=>{D(W=>{var S,L,Q,Te,He;const P=String((L=i==null?void 0:i.priceDigits)!=null?L:window.KTM.money.getDigits(String((S=i==null?void 0:i.price)!=null?S:""))),q=window.KTM.money.nextPriceInputState(E.target.value,P),be=String((Q=q.digits)!=null?Q:""),Pe=Number(be),u=Number.isFinite(Pe)?Math.max(0,Math.trunc(Pe)):0,g=Array.isArray(W.variants)?[...W.variants]:[],pe={...g[_]||{},options:Array.isArray((Te=g[_])==null?void 0:Te.options)?[...g[_].options]:[]};return pe.options[b]={...pe.options[b]||{},label:String(((He=pe.options[b])==null?void 0:He.label)||""),price:u,priceDigits:be},g[_]=pe,{...W,variants:g}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{D(E=>{var q;const W=Array.isArray(E.variants)?[...E.variants]:[],P={...W[_]||{},options:Array.isArray((q=W[_])==null?void 0:q.options)?[...W[_].options]:[]};return P.options.splice(b,1),W[_]=P,{...E,variants:W}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{D(i=>{var E;const b=Array.isArray(i.variants)?[...i.variants]:[],v={...b[_]||{},options:Array.isArray((E=b[_])==null?void 0:E.options)?[...b[_].options]:[]},$=xe(i.price);return v.options.push({label:"",price:$,priceDigits:String($)}),b[_]=v,{...i,variants:b}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{D(m=>{const _=xe(m.price),i=Array.isArray(m.variants)?[...m.variants]:[],b=String(_);return i.push({name:"Size",options:[{label:"S",price:_,priceDigits:b},{label:"M",price:_,priceDigits:b},{label:"L",price:_,priceDigits:b}]}),{...m,variants:i}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Fe,disabled:!Array.isArray(w.variants)||w.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:w.image,onChange:m=>D({...w,image:m.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:te,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:ce,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ce?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:C,video:x,onClose:j,onSave:te}){const[J,w]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[D,ce]=useState(!1),[de,z]=useState("");useEffect(()=>{x?(w({title:x.title||"",youtube_url:`https://www.youtube.com/watch?v=${x.youtubeId}`,thumbnail_url:x.thumb||"",sort_order:x.sortOrder||0}),z(x.thumb)):(w({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),z(""))},[x,C]);const ue=se=>{const fe=se.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return fe?fe[1]:null},xe=se=>{w({...J,youtube_url:se});const fe=ue(se);fe&&z(`https://img.youtube.com/vi/${fe}/hqdefault.jpg`)},le=async se=>{se.preventDefault(),ce(!0),await te(J),ce(!1)};return C?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:le},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:J.youtube_url,onChange:se=>xe(se.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),de&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:de,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:J.title,onChange:se=>w({...J,title:se.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:J.sort_order,onChange:se=>w({...J,sort_order:parseInt(se.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:J.thumbnail_url,onChange:se=>w({...J,thumbnail_url:se.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:D},D?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[C,x]=useState(!1),[j,te]=useState(""),[J,w]=useState(null),[D,ce]=useState("search"),[de,z]=useState(null),[ue,xe]=useState(""),[le,se]=useState([]),[fe,Fe]=useState(null),[me,ve]=useState(!1),[we,De]=useState(null),[Oe,_e]=useState(!0),[ye,Ie]=useState([]),[Ae,tt]=useState(()=>loadAdminSettings()),[Ce,qe]=useState(null),[Le,m]=useState([]);useEffect(()=>{const S=localStorage.getItem("ktm_admin_session");if(S)try{const L=JSON.parse(S);L.expiry>Date.now()?(x(!0),w(L.user)):localStorage.removeItem("ktm_admin_session")}catch(L){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{C&&$()},[C]),useEffect(()=>{if(!C)return;let S=!1;return(async()=>{try{const L=await fetchAdminSettingsFromServer();if(S)return;tt(L),saveAdminSettings(L)}catch(L){}})(),()=>{S=!0}},[C]);const _=async(S,L)=>{te("");try{const Q=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:S,password:L},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),Te={user:Q.user,token:Q.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(Te)),w(Q.user),x(!0)}catch(Q){te(Q.message)}},i=()=>{localStorage.removeItem("ktm_admin_session"),x(!1),w(null),se([]),Fe(null)},b=(S,L="success")=>{const Q=Date.now();Ie(Te=>[...Te,{id:Q,message:S,type:L}])},v=S=>{Ie(L=>L.filter(Q=>Q.id!==S))},$=async(S=null)=>{_e(!0);try{const L=S?`${API_BASE}/api/albums?parent_id=${S}`:`${API_BASE}/api/albums?parent_id=root`,Q=await window.KTM.api.getJSON(L,"L\u1ED7i t\u1EA3i danh s\xE1ch album");se(Array.isArray(Q)?Q:[])}catch(L){console.error(L),b("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}_e(!1)},E=()=>{De(null),ve(!0)},W=S=>{De(S),ve(!0)},P=async S=>{try{const L=we&&we.uuid;!L&&Ce&&(S.parent_id=Ce.uuid);const Q=L?`${API_BASE}/api/albums/${we.uuid||we.id}`:`${API_BASE}/api/albums`;L?await window.KTM.api.putJSON(Q,S,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(Q,S,"L\u1ED7i t\u1EA1o"),b(L?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),ve(!1),$(Ce==null?void 0:Ce.uuid)}catch(L){b(L.message,"danger")}},q=S=>{Fe(S)},be=S=>{if(S==="root")m([]),qe(null),$(null);else if(S){const L=Le.findIndex(Q=>Q.uuid===S.uuid);L>=0&&(m(Le.slice(0,L+1)),qe(S),$(S.uuid))}else{const L=[...Le];L.pop();const Q=L[L.length-1]||null;m(L),qe(Q),$(Q==null?void 0:Q.uuid)}},Pe=async S=>{const L=`X\xF3a folder "${S.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(L))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${S.uuid||S.id}`,"L\u1ED7i x\xF3a album"),b("\u0110\xE3 x\xF3a","success"),$(Ce==null?void 0:Ce.uuid)}catch(Q){b("L\u1ED7i x\xF3a album","danger")}};if(!C)return React.createElement(LoginPage,{onLogin:_,error:j});const u=()=>{const S=new Date,L=S.getFullYear(),Q=String(S.getMonth()+1).padStart(2,"0");return`${L}-${Q}`};function g(){const[S,L]=useState(()=>{var Z;return String((Z=Ae==null?void 0:Ae.ship_percent)!=null?Z:DEFAULT_SHIP_PERCENT)}),[Q,Te]=useState(!1);return useEffect(()=>{var Z;L(String((Z=Ae==null?void 0:Ae.ship_percent)!=null?Z:DEFAULT_SHIP_PERCENT))},[Ae==null?void 0:Ae.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Z=>{Z.preventDefault(),Te(!0);const Ke=saveAdminSettings({ship_percent:S});try{const Ye=await saveAdminSettingsToServer(Ke);tt(Ye),saveAdminSettings(Ye),b("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Ye){tt(Ke),b("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{Te(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:S,min:"0",max:"100",step:"0.01",onChange:Z=>L(Z.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:Q},Q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function pe(){const[S,L]=useState(u()),[Q,Te]=useState(!0),He=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[Z,Ke]=useState(He),Ye=useRef(new Map),pt=normalizeShipPercent(Ae==null?void 0:Ae.ship_percent),{formatNumber:ge,formatVND:Je}=window.KTM.money,A=async(ae,lt=!1)=>{var et,Ue;const ct=String(ae||"").trim();if(!ct)return He();const Ze=`${ct}|${pt}`,ft=(et=Ye.current)==null?void 0:et.get(Ze);if(!lt&&ft)return ft;const h=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(ct)}&ship_percent=${encodeURIComponent(pt)}`,U=await window.KTM.api.getJSON(h,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),ie=U!=null&&U.stats&&(U!=null&&U.meta)?U.stats:U,Ge=ie&&typeof ie=="object"?ie:He();return(Ue=Ye.current)==null||Ue.set(Ze,Ge),Ge},Be=async(ae=!1)=>{Te(!0);try{const lt=await A(S,ae);Ke(lt)}catch(lt){console.error("Load stats error:",lt),Ke(He())}finally{Te(!1)}};return useEffect(()=>{Be()},[S,pt]),React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:Q}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>Be(!0),disabled:Q},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:S,onChange:ae=>L(ae.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",pt,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),ge(Z.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),ge(Z.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),ge(Z.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",ge(Z.statusCounts.paid),"/",ge(Z.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ge(Z.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Je(Z.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Je(Z.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Je(Z.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Je(Z.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",Z.avgQtyPerOrder?Z.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},ge(Z.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},ge(Z.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},ge(Z.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},ge(Z.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},ge(Z.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},ge(Z.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},ge(Z.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,ge(Z.statusCounts.draft)),React.createElement("td",null,ge(Z.statusCounts.pending)),React.createElement("td",null,ge(Z.statusCounts.processing)),React.createElement("td",null,ge(Z.statusCounts.canceled)),React.createElement("td",null,ge(Z.statusCounts.done)),React.createElement("td",null,ge(Z.statusCounts.paid)),React.createElement("td",null,ge(Z.statusCounts.other)),React.createElement("td",null,ge(Z.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Z.products.slice(0,10).map(ae=>React.createElement("div",{key:ae.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},ae.product_name),React.createElement("div",{className:"text-muted small text-truncate"},ae.product_code?`#${ae.product_code} \u2022 `:"",ge(ae.orders)," \u0111\u01A1n \u2022 ",ge(ae.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Je(ae.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Z.products.slice(0,10).map(ae=>React.createElement("tr",{key:ae.product_id},React.createElement("td",null,ae.product_name),React.createElement("td",null,ae.product_code||"\u2014"),React.createElement("td",null,ge(ae.orders)),React.createElement("td",null,ge(ae.quantity)),React.createElement("td",{className:"fw-semibold"},Je(ae.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Z.customers.slice(0,10).map(ae=>React.createElement("div",{key:ae.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},ae.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},ae.phone||"\u2014"," \u2022 ",ge(ae.orders)," \u0111\u01A1n \u2022 ",ge(ae.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Je(ae.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Z.customers.slice(0,10).map(ae=>React.createElement("tr",{key:ae.key},React.createElement("td",null,ae.customer_name||"\u2014"),React.createElement("td",null,ae.phone||"\u2014"),React.createElement("td",null,ge(ae.orders)),React.createElement("td",null,ge(ae.quantity)),React.createElement("td",{className:"fw-semibold"},Je(ae.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},Z.days.map(ae=>React.createElement("div",{key:ae.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},ae.day),React.createElement("div",{className:"text-muted small"},ge(ae.orders)," \u0111\u01A1n \u2022 ",ge(ae.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",ge(ae.doneOrders)," \u2022 ",Je(ae.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Je(ae.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,Z.days.map(ae=>React.createElement("tr",{key:ae.day},React.createElement("td",null,ae.day),React.createElement("td",null,ge(ae.orders)),React.createElement("td",null,ge(ae.quantity)),React.createElement("td",{className:"fw-semibold"},Je(ae.revenue)),React.createElement("td",null,ge(ae.doneOrders)),React.createElement("td",{className:"fw-semibold"},Je(ae.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:D,onMenuChange:S=>{ce(S),S==="albums"&&(qe(null),m([]),$(null))},onLogout:i,currentUser:J}),React.createElement("div",{className:"main-content"},D==="albums"&&!fe&&React.createElement(AlbumList,{albums:le,loading:Oe,currentFolder:Ce,breadcrumb:Le,onSelect:q,onCreate:E,onEdit:W,onDelete:Pe,onBack:be}),D==="search"&&React.createElement(SearchCenter,{showToast:b,onNavigate:(S,L,Q)=>{ce(S),S==="orders"&&L==="create"&&(z(Date.now()),xe((Q==null?void 0:Q.productId)||""))}}),D==="albums"&&fe&&React.createElement(AlbumDetail,{album:fe,parentAlbum:Le.length>0?Le[Le.length-1]:null,onBack:()=>{if(fe.parentId){const S=Le.findIndex(L=>L.uuid===fe.parentId);S>=0?Fe(Le[S]):Fe(null)}else Fe(null)},onRefresh:()=>$(Ce==null?void 0:Ce.uuid),showToast:b,onNavigateToFolder:S=>{m(L=>[...L,fe]),Fe(S)},onEditSubfolder:S=>{De(S),ve(!0)}}),D==="videos"&&React.createElement(VideoList,{showToast:b}),D==="products"&&React.createElement(ProductManager,{showToast:b,settings:Ae}),D==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:de,autoOpenCreateProductId:ue,showToast:b}),D==="stats"&&React.createElement(pe,null),D==="settings"&&React.createElement(g,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${D==="search"?"active":""}`,onClick:S=>{S.preventDefault(),ce("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${D==="albums"?"active":""}`,onClick:S=>{S.preventDefault(),ce("albums"),Fe(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${D==="videos"?"active":""}`,onClick:S=>{S.preventDefault(),ce("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${D==="products"?"active":""}`,onClick:S=>{S.preventDefault(),ce("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${D==="orders"?"active":""}`,onClick:S=>{S.preventDefault(),ce("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${D==="stats"?"active":""}`,onClick:S=>{S.preventDefault(),ce("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:me,album:we,parentId:Ce==null?void 0:Ce.uuid,onClose:()=>ve(!1),onSave:P}),React.createElement("div",{className:"toast-container"},ye.map(S=>React.createElement(Toast,{key:S.id,message:S.message,type:S.type,onClose:()=>v(S.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:C,autoOpenCreateProductId:x,showToast:j}){const[te,J]=useState([]),[w,D]=useState(0),[ce,de]=useState(!1),[z,ue]=useState(!1),[xe,le]=useState([]),[se,fe]=useState(!0),[Fe,me]=useState(!1),[ve,we]=useState([]),[De,Oe]=useState(!1),[_e,ye]=useState(""),[Ie,Ae]=useState([]),[tt,Ce]=useState(!1),[qe,Le]=useState(""),[m,_]=useState(!1),[i,b]=useState(null),[v,$]=useState(null),[E,W]=useState(!1),[P,q]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[be,Pe]=useState(""),[u,g]=useState(!1),[pe,S]=useState(!1),[L,Q]=useState(null),[Te,He]=useState(!1),[Z,Ke]=useState([]),[Ye,pt]=useState(!1),[ge,Je]=useState([]),[A,Be]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[ae,lt]=useState([""]),[ct,Ze]=useState(null),ft=useRef({}),[h,U]=useState([]),[ie,Ge]=useState(null),et=useRef(null),Ue=useRef(null),dt=useRef(0),Qe=useRef(null),ht=useRef(0),Vt=useRef(new Map),xt=useRef(null),$t=useRef(0),Lt=useRef(new Map),Tt=useRef(new Map),jt=useRef(""),qt=useRef(null),Pt=useRef(0),Ot=useRef(null),s=9,N=150,O=250,B=3*60*1e3,Y=24*60*60*1e3,T=5*60*1e3,p="ktm_customer_lookup_cache_v1",V=200,ee=3,ne=3,G=1,he=24*60*60*1e3,We=120,Ee=5*60*1e3,at=80,bt=2,mt=4,ut=60,ze=React.useMemo(()=>String(_e||"").trim().length>0,[_e]),la=e=>String(e||"").replace(/\s+/g," ").trim(),ca=e=>String(e||"").replace(/[^0-9]+/g,""),_t=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/he)}catch(a){return 0}},zt=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:_t(e)>=ee,da=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},Bt=e=>{if(da(e==null?void 0:e.status)!=="draft")return null;const t=ne-_t(e);return Number.isFinite(t)?t:null},Jt=e=>{const a=Bt(e);return Number.isFinite(a)?a>0&&a<=G:!1},M=e=>{Be({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),lt([""]),Q(null),Ze(null)};useEffect(()=>{const e=a=>{var n;if(ct==null)return;const t=(n=ft.current)==null?void 0:n[ct];t&&!t.contains(a.target)&&Ze(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ct]);const R=e=>window.KTM.money.parseMoney(e),F=e=>window.KTM.money.parseSignedMoney(e),K=e=>window.KTM.money.formatVND(e),re=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var l,o;return{amount:String((l=n==null?void 0:n.amount)!=null?l:""),note:String((o=n==null?void 0:n.note)!=null?o:"")}});return t.length?t:[{amount:"",note:""}]},oe=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var l,o;return{amount:(n==null?void 0:n.amount)===0?"":String((l=n==null?void 0:n.amount)!=null?l:""),note:String((o=n==null?void 0:n.note)!=null?o:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},Ne=e=>(Array.isArray(e)?e:[]).map(t=>({amount:F(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),Me=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Ne(a),n=Re(t),l=(()=>{if(!t.length)return"";const o=t.map(y=>String((y==null?void 0:y.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:l}},Re=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),Xe=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},ot=e=>window.KTM.money.parseShipFeeFromNote(e),st=e=>window.KTM.phone.isValid(e),$e=e=>window.KTM.phone.normalize(e),gt=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},vt=(e,a)=>{var o;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const l=new Map(t.map(y=>{var c;return[String((c=y==null?void 0:y.id)!=null?c:""),y]}));for(const y of n){const c=String((o=y==null?void 0:y.id)!=null?o:"");c&&l.set(c,y)}return Array.from(l.values())},yt=async e=>{if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const a=await gt(e.id);if(a&&typeof a=="object")return J(t=>Array.isArray(t)?t.map(n=>String(n==null?void 0:n.id)===String(e.id)?a:n):t),a}catch(a){console.error("Fetch order by id error:",a)}return e},St=()=>{var e;try{const a=localStorage.getItem(p);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[l,o]of n)!l||!o||typeof o!="object"||(e=Tt.current)==null||e.set(String(l),o)}catch(a){}},Nt=()=>{try{const e=Tt.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,l])=>n&&l&&typeof l=="object"&&Number.isFinite(l.ts)).sort((n,l)=>(Number(l[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,V),t={};for(const[n,l]of a)t[n]=l;localStorage.setItem(p,JSON.stringify(t))}catch(e){}};useEffect(()=>{St()},[]);const It=e=>{const a=$e(e);if(!a)return null;const t=Array.isArray(te)?te:[];let n=null,l=-1;for(const o of t){if(!o||$e(o.phone||"")!==a)continue;const y=new Date(o.created_at).getTime(),c=Number.isFinite(y)?y:0;c>=l&&(l=c,n=o)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},Dt=(e,a)=>{e&&Be(t=>a&&$e(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Wt=e=>{const a=It(e);if(!a)return;const t=$e(e);Be(n=>{if(t&&$e(n.phone)!==t)return n;const l={...n};return!String(n.customer_name||"").trim()&&a.name&&(l.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(l.address=a.address),l})},ma=(e,a,t)=>{var n;try{const l=$e(e);if(!l)return;const o=String(a||"").trim(),y=String(t||"").trim();if(!o&&!y)return;(n=Tt.current)==null||n.set(l,{ts:Date.now(),status:"found",customer:{phone:l,name:o||null,address:y||null}}),Nt()}catch(l){}},Kt=async e=>{var l,o,y;const a=$e(e);if(!a)return;Wt(a);const t=(l=Tt.current)==null?void 0:l.get(a);if(t&&Number.isFinite(t.ts)){const c=Date.now()-t.ts,k=t.status==="found"?Y:T;if(c>=0&&c<=k){Q({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&Dt(t.customer,a);return}}const n=++dt.current;Q({status:"loading",phone:a});try{const c=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(dt.current!==n)return;if(c&&c.exists&&c.customer){(o=Tt.current)==null||o.set(a,{ts:Date.now(),status:"found",customer:c.customer}),Nt(),Q({status:"found",phone:a,customer:c.customer}),Dt(c.customer,a);return}(y=Tt.current)==null||y.set(a,{ts:Date.now(),status:"not-found",customer:null}),Nt(),Q({status:"not-found",phone:a})}catch(c){if(dt.current!==n)return;console.error("Customer lookup error:",c),Q({status:"error",phone:a})}},Ha=e=>{const a=$e(e),t=It(a);Be(l=>{const o={...l,phone:a};return t&&(!String(l.customer_name||"").trim()&&t.name&&(o.customer_name=t.name),!String(l.address||"").trim()&&t.address&&(o.address=t.address)),o}),He(!1),Ue.current&&(clearTimeout(Ue.current),Ue.current=null);const n=a;if(n.length<s){Q(null);return}if(st(n)&&n!==jt.current){jt.current=n,Kt(n);return}Ue.current=setTimeout(()=>{const l=$e(a);st(l)&&l!==jt.current&&(jt.current=l,Kt(l))},N)},Va=()=>{const e=$e(A.phone);e.length<s||st(e)&&e!==jt.current&&(jt.current=e,Kt(e))};useEffect(()=>(pe?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[pe]);const Xt=Array.isArray(A.items)?A.items.length:0;useEffect(()=>{if(!pe){Pt.current=Xt;return}Xt>Pt.current&&setTimeout(()=>{const e=qt.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Pt.current=Xt},[pe,Xt]),useEffect(()=>()=>{Ue.current&&(clearTimeout(Ue.current),Ue.current=null),Qe.current&&(clearTimeout(Qe.current),Qe.current=null)},[]),useEffect(()=>{if(!pe)return;Qe.current&&(clearTimeout(Qe.current),Qe.current=null);const e=$e((A==null?void 0:A.phone)||"");if(!st(e)){Ke([]),pt(!1);return}return Qe.current=setTimeout(async()=>{var l;const a=String(e),t=(l=Vt.current)==null?void 0:l.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=B){Ke(Array.isArray(t.orders)?t.orders:[]),pt(!1);return}const n=++ht.current;pt(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,y=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(ht.current!==n)return;const c=Array.isArray(y)?y:Array.isArray(y==null?void 0:y.orders)?y.orders:[];Ke(c);try{const k=Vt.current;if(k&&typeof k.set=="function"&&(k.set(a,{ts:Date.now(),orders:c}),k.size>100)){const r=Array.from(k.entries()).sort((f,I)=>{var X,H;return(Number((X=f==null?void 0:f[1])==null?void 0:X.ts)||0)-(Number((H=I==null?void 0:I[1])==null?void 0:H.ts)||0)}),d=Math.max(0,r.length-100);for(let f=0;f<d;f++)k.delete(r[f][0])}}catch(k){}}catch(o){if(ht.current!==n)return;console.error("Phone history fetch error:",o),Ke([])}finally{if(ht.current!==n)return;pt(!1)}},O),()=>{Qe.current&&(clearTimeout(Qe.current),Qe.current=null)}},[pe,A==null?void 0:A.phone]),useEffect(()=>{qa()},[]),useEffect(()=>{ze||Ft()},[P,ze]),useEffect(()=>{fa()},[]),useEffect(()=>{C&&et.current!==C&&(et.current=C,ja(x))},[C]);const ua=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",pa=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",_a=React.useMemo(()=>window.KTM.orders.sortOrders(te),[te]),ha=React.useMemo(()=>window.KTM.orders.sortOrders(xe),[xe]),Qt=React.useMemo(()=>{const a=(Array.isArray(ha)?ha:[]).filter(t=>zt(t));return a.sort((t,n)=>{const l=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(l)?l:0)-(Number.isFinite(o)?o:0)}),a},[ha]),Ma=React.useMemo(()=>{const a=(Array.isArray(ve)?ve:[]).filter(t=>Jt(t));return a.sort((t,n)=>{const l=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(l)?l:0)-(Number.isFinite(o)?o:0)}),a},[ve]),Ut=React.useMemo(()=>u?Qt:_a,[u,Qt,_a]),Yt=React.useMemo(()=>{if(u)return Ut;const e=String(be||"").trim();return e?(Array.isArray(Ut)?Ut:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):Ut},[Ut,be,u]),$a=React.useMemo(()=>window.KTM.orders.sortOrders(Ie),[Ie]),Zt=React.useMemo(()=>ze?$a:Yt,[Yt,ze,$a]),ba=e=>window.KTM.date.formatDateTime(e),qa=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");U(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),U([])}},Ft=async()=>{fe(!0),ue(!1);try{const a=new URLSearchParams;P&&a.set("month",String(P)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(ut)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),l=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],o=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;J(Array.isArray(l)?l:[]),D(Array.isArray(l)?l.length:0),de(!!(o!=null&&o.hasMore)),fa()}catch(a){console.error("Load orders error:",a),J([]),D(0),de(!1)}finally{fe(!1),ue(!1)}},za=async()=>{if(!(se||z||ze)&&ce){ue(!0);try{const e=new URLSearchParams;P&&e.set("month",String(P)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(ut)),e.set("offset",String(w));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],l=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;J(o=>vt(o,Array.isArray(n)?n:[])),D(o=>o+(Array.isArray(n)?n.length:0)),de(!!(l!=null&&l.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{ue(!1)}}},Ta=async e=>{var l;const a=la(e);if(!a){Ae([]),Le(""),Ce(!1);return}const t=ca(a);if(a.length<bt&&t.length<mt){Ae([]),Le(`Nh\u1EADp \xEDt nh\u1EA5t ${bt} k\xFD t\u1EF1 (ho\u1EB7c ${mt} s\u1ED1) \u0111\u1EC3 search nhanh`),Ce(!1);return}try{const o=(l=Lt.current)==null?void 0:l.get(a);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=Ee){Ae(Array.isArray(o.results)?o.results:[]),Le(""),Ce(!1);return}}catch(o){}const n=++$t.current;Ce(!0),Le("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,y=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if($t.current!==n)return;const c=Array.isArray(y)?y:[];Ae(c);try{const k=Lt.current;if(k&&typeof k.set=="function"&&(k.set(a,{ts:Date.now(),results:c}),k.size>at)){const r=Array.from(k.entries()).sort((f,I)=>{var X,H;return(Number((X=f==null?void 0:f[1])==null?void 0:X.ts)||0)-(Number((H=I==null?void 0:I[1])==null?void 0:H.ts)||0)}),d=Math.max(0,r.length-at);for(let f=0;f<d;f++)k.delete(r[f][0])}}catch(k){}}catch(o){if($t.current!==n)return;console.error("Order search error:",o),Ae([]),Le((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if($t.current!==n)return;Ce(!1)}};useEffect(()=>{xt.current&&(clearTimeout(xt.current),xt.current=null);const e=la(_e);if(!e){Ae([]),Le(""),Ce(!1);return}return u&&g(!1),xt.current=setTimeout(()=>{Ta(e)},We),()=>{xt.current&&(clearTimeout(xt.current),xt.current=null)}},[_e]);const fa=async()=>{me(!0),Oe(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(ee)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(G)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);le(Array.isArray(e)?e:[]),we(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),le([]),we([])}finally{me(!1),Oe(!1)}},ga=async e=>{const a=await yt(e);if(!a)return;Ge(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(c=>{var k,r,d,f;return{product_id:(c==null?void 0:c.product_id)||"",quantity:Number((k=c==null?void 0:c.quantity)!=null?k:1)||1,unit_price:(()=>{var H;const I=(H=c==null?void 0:c.unit_price)!=null?H:c==null?void 0:c.unitPrice,X=I==null||I===""?NaN:Number(I);return Number.isFinite(X)?Math.trunc(X):null})(),variant:String((r=c==null?void 0:c.variant)!=null?r:"").trim(),variant_json:(f=(d=c==null?void 0:c.variant_json)!=null?d:c==null?void 0:c.variantJson)!=null?f:null}}).filter(c=>c.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=oe(a),l=Ne(n),o=Re(l),y=Xe(l);Be({customer_name:a.customer_name||"",phone:$e(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:o,adjustment_note:y||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),lt(new Array(t.length?t.length:1).fill("")),Je(new Array(t.length?t.length:1).fill(!0)),Q(null),S(!0),a.phone&&Kt($e(a.phone))};function ja(e){Ge(null),M(e||""),He(!1),Je([]),S(!0)}const va=()=>{m||E||(S(!1),Ge(null),M(""),He(!1),Je([]))},Ba=async()=>{var c,k,r;if(!ie||E||m)return;const e=(Array.isArray(te)?te:[]).find(d=>String(d==null?void 0:d.id)===String(ie))||null,a=String((e==null?void 0:e.status)||(A==null?void 0:A.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const d="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof j=="function"?j(d,"warning"):alert(d);return}const t=$e(A.phone),l=(Array.isArray(A.items)?A.items:[]).map((d,f)=>{var I,X;return{idx:f,product_id:String((d==null?void 0:d.product_id)||"").trim(),quantity:Number((I=d==null?void 0:d.quantity)!=null?I:0),variant:String((d==null?void 0:d.variant)||"").trim()||null,variant_json:(X=d==null?void 0:d.variant_json)!=null?X:null,unit_price:(()=>{const H=d==null?void 0:d.unit_price,Se=H===""||H==null?NaN:Number(H);if(Number.isFinite(Se))return Math.max(0,Math.trunc(Se));const ke=Ct(d==null?void 0:d.product_id),nt=d!=null&&d.variant_json&&typeof d.variant_json=="object"?d.variant_json:null;return ta(ke,nt)})()}}).filter(d=>d.product_id&&Number.isFinite(d.quantity)&&d.quantity>0);if(l.length<2){const d="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof j=="function"?j(d,"warning"):alert(d);return}const o=[],y=[];for(const d of l){const f=!!ge[d.idx],I={product_id:d.product_id,quantity:d.quantity,unit_price:d.unit_price,variant:d.variant,variant_json:d.variant_json};f?o.push(I):y.push(I)}if(!o.length||!y.length){const d="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof j=="function"?j(d,"warning"):alert(d);return}W(!0);try{const d=Array.isArray(A==null?void 0:A.adjustment_items)?A.adjustment_items:[],f=Ne(d),I=Re(f),X=Xe(f),H={customer_name:A.customer_name,phone:t,address:A.address,note:(A.note||"").trim(),adjustment_amount:I,adjustment_note:X,adjustment_items:f,status:"processing",items:o,product_id:o[0].product_id,quantity:o[0].quantity,split_seq:1},Se=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,H,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),ke=(r=(k=Se==null?void 0:Se.id)!=null?k:(c=Se==null?void 0:Se.order)==null?void 0:c.id)!=null?r:null;if(!ke)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const nt={id:ie,customer_name:A.customer_name,phone:t,address:A.address,note:(A.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:y,product_id:y[0].product_id,quantity:y[0].quantity,parent_order_id:String(ke),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${ie}`,nt,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),va(),Ft();const it=ke?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${ke}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof j=="function"?j(it,"success"):alert(it)}catch(d){console.error(d);const f=(d==null?void 0:d.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof j=="function"?j(f,"danger"):alert(f)}finally{W(!1)}},Ja=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=h.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},kt=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},Ua=e=>{const t=kt(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},Oa=React.useMemo(()=>(Array.isArray(h)?h:[]).map((e,a)=>{var r,d,f,I,X,H;const t=kt((r=e==null?void 0:e.name)!=null?r:""),n=kt((d=e==null?void 0:e.code)!=null?d:""),l=kt((f=e==null?void 0:e.category)!=null?f:""),o=kt((I=e==null?void 0:e.note)!=null?I:""),y=kt((X=e==null?void 0:e.id)!=null?X:""),c=kt((H=e==null?void 0:e.stt)!=null?H:""),k=`${t} ${n} ${l} ${o} ${y} ${c}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:l,note:o,haystackAll:k}}),[h]),Ga=(e,a,t)=>{var f,I,X,H,Se;const n=Array.isArray(a)?a:[],l=kt(t).trim();if(!n.length&&!l)return 0;const o=(f=e==null?void 0:e.name)!=null?f:"",y=(I=e==null?void 0:e.code)!=null?I:"",c=(X=e==null?void 0:e.category)!=null?X:"",k=(H=e==null?void 0:e.note)!=null?H:"";if(!((Se=e==null?void 0:e.haystackAll)!=null?Se:""))return 0;let d=0;l&&(o===l&&(d+=220),o.includes(l)&&(d+=140),o.startsWith(l)&&(d+=160),y&&y===l&&(d+=180),y&&y.includes(l)&&(d+=90));for(const ke of n){if(!ke)continue;const nt=new RegExp(`(?:^|\\s)${ke.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(ke)&&(d+=35),nt.test(o)&&(d+=25),y&&y.includes(ke)&&(d+=20),y&&nt.test(y)&&(d+=10),c&&c.includes(ke)&&(d+=12),k&&k.includes(ke)&&(d+=6)}return d>0&&o&&(d+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),d},ya=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const l=t.length,o=n.length;if(o>l)return ya(n,t);let y=new Array(o+1),c=new Array(o+1);for(let k=0;k<=o;k++)y[k]=k;for(let k=1;k<=l;k++){c[0]=k;const r=t.charCodeAt(k-1);for(let f=1;f<=o;f++){const I=r===n.charCodeAt(f-1)?0:1;c[f]=Math.min(y[f]+1,c[f-1]+1,y[f-1]+I)}const d=y;y=c,c=d}return y[o]},Wa=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const l=n.split(/\s+/).filter(Boolean);if(!l.length)return!1;const o=t.length<=4?1:2;for(const y of l)if(!(Math.abs(y.length-t.length)>o)&&ya(t,y)<=o)return!0;return!1},ea=e=>{const a=kt(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},Xa=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=ea((e==null?void 0:e.name)||""),l=ea((e==null?void 0:e.code)||""),o=ea((e==null?void 0:e.category)||""),y=ea((e==null?void 0:e.note)||""),c=(r,d,f)=>{const I=String(r||"").trim();if(!I||!d.length)return 0;const X=I.length<=4?1:2;let H=1/0,Se=-1;for(let it=0;it<d.length;it++){const wt=d[it];if(!wt||Math.abs(wt.length-I.length)>X)continue;const Ve=ya(I,wt);if(Ve<H&&(H=Ve,Se=it,Ve===0))break}if(H===1/0||H>X)return 0;let nt=Math.round(f*(H===0?1:H===1?.65:.45));return Se===0?nt+=Math.round(f*.25):Se===1&&(nt+=Math.round(f*.12)),nt};let k=0;for(const r of t){if(!r)continue;const d=c(r,n,180),f=c(r,l,120),I=c(r,o,60),X=c(r,y,30);k+=Math.max(d,f,I,X)}if(k>0){const r=((e==null?void 0:e.name)||"").length;k+=Math.max(0,60-Math.min(60,Math.floor(r/2)))}return k},Na=React.useRef(new Map);React.useEffect(()=>{Na.current=new Map},[h]);const Qa=e=>{var r,d;const a=String(ae[e]||"").trim();if(!a)return h;const{contentTokens:t,cleanedQuery:n}=Ua(a);if(t.length===0)return h;const l=kt(a).trim(),o=Na.current.get(l);if(o)return o;const y=[];for(const f of Oa){const I=f.haystackAll;I&&t.some(X=>I.includes(X))&&y.push(f)}let c=y;if(c.length<8&&t.length>0){const f=[],I=new Set(c.map(X=>{var H,Se;return String((Se=(H=X.p)==null?void 0:H.id)!=null?Se:"")+":"+String(X.originalIndex)}));for(const X of Oa){const H=String((d=(r=X.p)==null?void 0:r.id)!=null?d:"")+":"+String(X.originalIndex);if(I.has(H))continue;const Se=X.haystackAll;Se&&t.some(ke=>Wa(ke,Se))&&(f.push(X),I.add(H))}f.length&&(c=c.concat(f))}const k=c.map(f=>({entry:f,score:Ga(f,t,n)})).map(f=>{if(f.score>0)return f;const I=Xa(f.entry,t);return I>0?{...f,score:I}:f}).filter(f=>f.score>0).sort((f,I)=>I.score!==f.score?I.score-f.score:f.entry.originalIndex-I.entry.originalIndex).slice(0,40).map(f=>f.entry.p);return Na.current.set(l,k),k},Ct=e=>{if(!e)return null;const a=String(e);return h.find(t=>String(t==null?void 0:t.id)===a)||null},Gt=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var y;if(!t||typeof t!="object")return null;const l=String((y=t.name)!=null?y:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,o=(Array.isArray(t.options)?t.options:[]).map(c=>{var Se,ke,nt,it,wt,Ve,At;if(!c||typeof c!="object")return null;const k=String((Se=c.label)!=null?Se:"").trim();if(!k)return null;const r=(wt=(it=(nt=(ke=c.price)!=null?ke:c.priceValue)!=null?nt:c.unit_price)!=null?it:c.unitPrice)!=null?wt:null,d=r==null||r===""?NaN:typeof r=="number"?r:typeof r=="string"?R(r):Number(r),f=Number.isFinite(d)?Math.trunc(d):null,I=(At=(Ve=c.price_delta)!=null?Ve:c.priceDelta)!=null?At:null,X=Number(I),H=Number.isFinite(X)?Math.trunc(X):0;return{label:k,price:f,price_delta:H}}).filter(Boolean);return{name:l,options:o}}).filter(Boolean):[]},rn=e=>{const a=Ct(e);return Gt(a==null?void 0:a.variants)},Ia=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const l=String(t||"").trim(),o=String(n||"").trim();!l||!o||a.push(`${l}: ${o}`)}return a.join(", ")},ta=(e,a)=>{const t=R(e==null?void 0:e.price),n=Gt(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let l=t,o=!1;for(const y of n){const c=String((y==null?void 0:y.name)||"").trim(),k=String((a==null?void 0:a[c])||"").trim();if(!c||!k)continue;const r=(Array.isArray(y.options)?y.options:[]).find(H=>String((H==null?void 0:H.label)||"").trim()===k);if(!r)continue;const d=r==null?void 0:r.price,f=d==null||d===""?NaN:Number(d);if(Number.isFinite(f)){l=Math.max(0,Math.trunc(f)),o=!0;continue}const I=r==null?void 0:r.price_delta,X=I==null||I===""?NaN:Number(I);Number.isFinite(X)&&(l+=Math.trunc(X))}return l},wa=e=>window.KTM.orders.getOrderItems(e),Ya=e=>window.KTM.orders.getOrderTotalQty(e),aa=e=>window.KTM.orders.getOrderProductSummary(e,Ct),xa=e=>window.KTM.orders.getOrderItemRows(e,Ct),Sa=e=>window.KTM.orders.getOrderAdjustmentMoney(e),na=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),Za=e=>{const a=wa(e),t=xa(e),n=ia(a),l=sa(a),o=l.fee,y=Sa(e),c=n+o+y,k=d=>{const f=Number(d)||0;return f>0?`+${K(f)}`:K(f)},r=[];if(e!=null&&e.customer_name&&r.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&r.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&r.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&r.push(`GHI CH\xDA: ${(e.note||"").trim()}`),r.push(""),r.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const d of t)r.push(`- ${d.name} (SL: ${d.qty})`);else{const d=aa(e);d&&d!=="\u2014"&&r.push(`- ${d}`)}r.push(""),r.push(`T\u1EA0M T\xCDNH: ${K(n)}`),l.found&&o!==0&&r.push(`SHIP: ${K(o)}`);{const d=window.KTM.orders.getOrderAdjustmentItems(e),f=(Array.isArray(d)?d:[]).map(H=>{var Se;return{amount:Number((Se=H==null?void 0:H.amount)!=null?Se:0)||0,note:String((H==null?void 0:H.note)||"").trim()}}).filter(H=>H.amount!==0||!!H.note),I=na(e);if(y!==0||f.length>0||!!I)if(f.length===1){const H=f[0];r.push(`\u0110I\u1EC0U CH\u1EC8NH: ${k(y)}${H.note?` \u2014 ${H.note}`:""}`)}else{r.push(`\u0110I\u1EC0U CH\u1EC8NH: ${k(y)}${!f.length&&I?` \u2014 ${I}`:""}`);for(const H of f)r.push(`- ${k(H.amount)}${H.note?`: ${H.note}`:""}`)}}return r.push(`T\u1ED4NG: ${K(c)}`),r.filter(Boolean).join(`
`)},Da=async e=>{try{const a=await yt(e),t=Za(a);await window.KTM.clipboard.writeText(t),typeof j=="function"?j("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof j=="function"?j("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},sa=e=>window.KTM.orders.getOrderShipInfo(e,Ct),ia=e=>window.KTM.orders.getItemsSubtotal(e,Ct),ka=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},Ca=()=>P?String(P):ka(new Date),Ra=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=$e((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),l=Me(e).amount,y=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(c=>{var k;return{product_id:String((c==null?void 0:c.product_id)||"").trim(),quantity:Number((k=c==null?void 0:c.quantity)!=null?k:0),variant:String((c==null?void 0:c.variant)||"").trim()}}).filter(c=>c.product_id&&Number.isFinite(c.quantity)&&c.quantity>0).sort((c,k)=>c.product_id<k.product_id?-1:c.product_id>k.product_id?1:c.variant<k.variant?-1:c.variant>k.variant?1:c.quantity-k.quantity);return JSON.stringify({name:a,phone:t,address:n,items:y,adj:l})},Mt=React.useMemo(()=>{const e=$e((A==null?void 0:A.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ca()};const a=Ca(),n=(Array.isArray(Z)?Z:[]).filter(l=>{if(!l||ie&&String(l.id)===String(ie)||$e(l.phone||"")!==e)return!1;const o=ka(l.created_at);return o&&o===a}).sort((l,o)=>{const y=new Date(l.created_at).getTime(),c=new Date(o.created_at).getTime();return(Number.isFinite(c)?c:0)-(Number.isFinite(y)?y:0)});return{count:n.length,orders:n,monthKey:a}},[Z,A==null?void 0:A.phone,P,ie]),en=e=>{var c;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=$e((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),l=F((c=e==null?void 0:e.adjustment_amount)!=null?c:0),o=wa(e),y=(Array.isArray(o)?o:[]).map(k=>{var r;return{product_id:String((k==null?void 0:k.product_id)||"").trim(),quantity:Number((r=k==null?void 0:k.quantity)!=null?r:0),variant:String((k==null?void 0:k.variant)||"").trim()}}).filter(k=>k.product_id&&Number.isFinite(k.quantity)&&k.quantity>0).sort((k,r)=>k.product_id<r.product_id?-1:k.product_id>r.product_id?1:k.variant<r.variant?-1:k.variant>r.variant?1:k.quantity-r.quantity);return JSON.stringify({name:a,phone:t,address:n,items:y,adj:l})},La=React.useMemo(()=>{if(ie)return"";const e=$e((A==null?void 0:A.phone)||"");if(!e)return"";const a=Ca(),t=Ra(A),n=Array.isArray(Z)?Z:[];for(const l of n){if(!l||ie&&String(l.id)===String(ie)||$e(l.phone||"")!==e)continue;const o=ka(l.created_at);if(!o||o!==a)continue;const y=en(l);if(y&&y===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${l!=null&&l.id?` (#${l.id})`:""}`}return""},[Z,A,P,ie]),Pa=e=>{var wt;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),l=$e((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),l||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),l&&!st(l)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const c=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ve=>Ve&&Ve.product_id);c.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),c.some(Ve=>{var Et;const At=Number((Et=Ve==null?void 0:Ve.quantity)!=null?Et:0);return!Number.isFinite(At)||At<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const r=new Set;let d=!1;for(const Ve of c){const At=String(Ve.product_id||"").trim(),Et=String((Ve==null?void 0:Ve.variant)||"").trim();if(!At)continue;const je=`${At}||${Et}`;if(r.has(je)){d=!0;break}r.add(je)}d&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const f=ia(c),I=sa(c),X=I!=null&&I.found?Number((wt=I==null?void 0:I.fee)!=null?wt:0):0,H=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],Se=Ne(H),ke=Re(Se),nt=Se.some(Ve=>(Number(Ve==null?void 0:Ve.amount)||0)!==0&&!String((Ve==null?void 0:Ve.note)||"").trim());I!=null&&I.found&&(X>=2e5||f>0&&X>f*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${K(X)}`),nt&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const it=Math.abs(ke);return(it>=5e5||f>0&&it>f*.5)&&ke!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${K(ke)}`),{errors:a,warnings:t,canSubmit:a.length===0}},on=React.useMemo(()=>Pa(A),[A,h]),rt=React.useMemo(()=>{var Et;const e=String((A==null?void 0:A.customer_name)||"").trim(),a=$e((A==null?void 0:A.phone)||""),t=String((A==null?void 0:A.address)||"").trim(),n=Array.isArray(A==null?void 0:A.items)?A.items:[],l=new Map;for(const je of n){const Ht=String((je==null?void 0:je.product_id)||"").trim(),ra=String((je==null?void 0:je.variant)||"").trim();if(!Ht)continue;const oa=`${Ht}||${ra}`;l.set(oa,(l.get(oa)||0)+1)}const o=n.map(je=>{var Fa;const Ht=String((je==null?void 0:je.product_id)||"").trim(),ra=Number((Fa=je==null?void 0:je.quantity)!=null?Fa:0),oa=Ht?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",tn=Number.isFinite(ra)&&ra>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",an=String((je==null?void 0:je.variant)||"").trim(),nn=`${Ht}||${an}`,sn=Ht&&(l.get(nn)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:oa,qtyError:tn,dupWarn:sn}}),y=n.filter(je=>je&&je.product_id),c=ia(y),k=sa(y),r=k!=null&&k.found?Number((Et=k==null?void 0:k.fee)!=null?Et:0):0,d=Array.isArray(A==null?void 0:A.adjustment_items)?A.adjustment_items:[],f=Ne(d),I=Re(f),X=f.some(je=>(Number(je==null?void 0:je.amount)||0)!==0&&!String((je==null?void 0:je.note)||"").trim()),H=Math.abs(I),Se=X?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ke=I!==0&&(H>=5e5||c>0&&H>c*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${K(I)}`:"",nt=k!=null&&k.found&&(r>=2e5||c>0&&r>c*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${K(r)}`:"",it=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",wt=a?st(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ve=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",At=!it&&!wt&&o.every(je=>!je.productError&&!je.qtyError);return{nameError:it,phoneError:wt,addressWarn:Ve,items:o,shipAbnormalWarn:nt,adjustmentNoteWarn:Se,adjustmentAbnormalWarn:ke,canSubmit:At}},[A,h]),Ka=async e=>{var y,c,k;const a=(e==null?void 0:e.mode)||"close",t=Pa(A);if(!t.canSubmit){const r=t.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof j=="function"?j(r,"danger"):alert(r);return}if(!ie&&La){const r=`${La}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(r)){(Mt==null?void 0:Mt.count)>0&&He(!0),setTimeout(()=>{var I;const f=document.getElementById("order-phone-input");f&&typeof f.scrollIntoView=="function"&&(f.scrollIntoView({block:"center",behavior:"smooth"}),(I=f.focus)==null||I.call(f))},0);return}}const n=$e(A.phone),o=(Array.isArray(A.items)?A.items:[]).map(r=>{var d,f;return{product_id:(r==null?void 0:r.product_id)||"",quantity:Number((d=r==null?void 0:r.quantity)!=null?d:1),variant:String((r==null?void 0:r.variant)||"").trim()||null,variant_json:(f=r==null?void 0:r.variant_json)!=null?f:null,unit_price:(()=>{const I=r==null?void 0:r.unit_price,X=I===""||I==null?NaN:Number(I);if(Number.isFinite(X))return Math.max(0,Math.trunc(X));const H=Ct(r==null?void 0:r.product_id),Se=r!=null&&r.variant_json&&typeof r.variant_json=="object"?r.variant_json:null;return ta(H,Se)})()}}).filter(r=>r.product_id&&Number.isFinite(r.quantity)&&r.quantity>0);_(!0);try{const r=ie?`${API_BASE}/api/orders/${ie}`:`${API_BASE}/api/orders`,d=o[0],f=Array.isArray(A==null?void 0:A.adjustment_items)?A.adjustment_items:[],I=Ne(f),X=Re(I),H=Xe(I),Se={customer_name:A.customer_name,phone:n,address:A.address,note:(A.note||"").trim(),adjustment_amount:X,adjustment_note:H,adjustment_items:I,product_id:d.product_id,quantity:d.quantity,status:A.status,items:o,...ie?{id:ie}:{}};if(ie)await window.KTM.api.putJSON(r,Se,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const ke=await window.KTM.api.postJSON(r,Se,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Ot.current={id:(k=(c=ke==null?void 0:ke.id)!=null?c:(y=ke==null?void 0:ke.order)==null?void 0:y.id)!=null?k:null,fingerprint:Ra(A),ts:Date.now()}}ma(n,A.customer_name,A.address),a==="new"&&!ie?(M(""),Ge(null),S(!0)):(M(""),Ge(null),S(!1)),Ft()}catch(r){console.error(r),typeof j=="function"?j(r.message,"danger"):alert(r.message);return}finally{_(!1)}},Aa=e=>window.KTM.orders.getOrderTotalMoney(e,Ct),Ea=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){b(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Ft(),fa()}catch(a){console.error(a),typeof j=="function"?j(a.message,"danger"):alert(a.message)}finally{b(null)}}},Rt=async(e,a)=>{var l;const t=await yt(e),n=t==null?void 0:t.id;if(!(!n||!a)){$(n);try{const o=wa(t),y=(Array.isArray(o)?o:[]).map(r=>{var d,f;return{product_id:(r==null?void 0:r.product_id)||"",quantity:Number((d=r==null?void 0:r.quantity)!=null?d:1),variant:String((r==null?void 0:r.variant)||"").trim()||null,variant_json:(f=r==null?void 0:r.variant_json)!=null?f:null,unit_price:(()=>{var H;const I=(H=r==null?void 0:r.unit_price)!=null?H:r==null?void 0:r.unitPrice,X=Number(I);return Number.isFinite(X)?Math.max(0,Math.trunc(X)):null})()}}).filter(r=>r.product_id&&Number.isFinite(r.quantity)&&r.quantity>0);if(!y.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const c=y[0],k={id:n,customer_name:(t==null?void 0:t.customer_name)||"",phone:$e((t==null?void 0:t.phone)||""),address:(t==null?void 0:t.address)||"",note:((t==null?void 0:t.note)||"").trim(),adjustment_amount:Number((l=t==null?void 0:t.adjustment_amount)!=null?l:0)||0,adjustment_note:(t==null?void 0:t.adjustment_note)||"",product_id:c.product_id,quantity:c.quantity,status:a,items:y};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${n}`,k,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),J(r=>Array.isArray(r)?r.map(d=>(d==null?void 0:d.id)===n?{...d,status:a}:d):r),le(r=>Array.isArray(r)?r.map(d=>(d==null?void 0:d.id)===n?{...d,status:a}:d):r),typeof j=="function"&&j("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(o){console.error(o),typeof j=="function"?j(o.message,"danger"):alert(o.message)}finally{$(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:se&&!pe&&!ze||m||!!i||!!v}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:ja,disabled:m||!!i},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:P,onChange:e=>q(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:u||ze}),P&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{q("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:se||ze},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:be,onChange:e=>Pe(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:u||ze},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),be&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Pe(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:se||ze},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:u,onChange:e=>{if(ze)return;const a=!!e.target.checked;g(a),a&&Pe("pending")},disabled:ze}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",ee," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label mb-1"},"Search (t\xEAn / S\u0110T)"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{type:"text",className:"form-control",value:_e,onChange:e=>ye(e.target.value),placeholder:"Nh\u1EADp t\xEAn ho\u1EB7c S\u0110T...","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(_e||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ye(""),title:"X\xF3a search","aria-label":"X\xF3a search",disabled:tt},React.createElement("i",{className:"fas fa-times"})),tt&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"text-muted small mt-1"},"Search s\u1EBD ra to\xE0n b\u1ED9 data, b\u1ECF qua filter")),React.createElement("div",{className:"col-12 col-md-2 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>ze?Ta(_e):Ft(),disabled:se||tt},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},ze?`${Zt.length} k\u1EBFt qu\u1EA3`:be?`${Yt.length}/${te.length} \u0111\u01A1n`:`${te.length}${ce?"+":""} \u0111\u01A1n`)),ze&&qe&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},qe),Qt.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Qt.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",ee," ng\xE0y.",Fe&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{g(!0),Pe("pending")}},"Xem ngay")),Ma.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,Ma.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",G," ng\xE0y).",De&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{g(!1),Pe("draft"),q(""),Ft()}},"Xem ngay")),(ze?tt:se)?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):(ze?Zt.length===0:te.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},ze?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!ze&&Yt.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Zt.map(e=>{var a;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${pa(e.status)}`},ua(e.status)),zt(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ee} ng\xE0y`},"\u26A0 Ch\u1EADm ",_t(e),"d"),Jt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${ne} ng\xE0y`},"\u23F3 C\xF2n ",Bt(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=xa(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,l)=>React.createElement("div",{key:l,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},l+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${K(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},aa(e))})()),(Sa(e)!==0||na(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},K(Sa(e))),na(e)?React.createElement("span",{className:"text-muted"}," ","(",na(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},K(Aa(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",ba(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary flex-fill",onClick:()=>ga(e),disabled:m||!!i||v===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>Da(e),disabled:m||!!i||v===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger flex-fill",onClick:()=>Ea(e.id),disabled:m||i===e.id||v===e.id},i===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>Rt(e,"processing"),disabled:m||!!i||v===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>Rt(e,"done"),disabled:m||!!i||v===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>Rt(e,"paid"),disabled:m||!!i||v===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:()=>Rt(e,"canceled"),disabled:m||!!i||v===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,Zt.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=xa(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",K(t.unitPrice))))):aa(e)})()),React.createElement("td",null,Ya(e)),React.createElement("td",{className:"fw-semibold"},K(Aa(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${pa(e.status)}`},ua(e.status)),zt(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ee} ng\xE0y`},"\u26A0 Ch\u1EADm ",_t(e),"d"),Jt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${ne} ng\xE0y`},"\u23F3 C\xF2n ",Bt(e),"d"))),React.createElement("td",null,ba(e.created_at)),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary me-1",onClick:()=>ga(e),disabled:m||!!i||v===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>Da(e),disabled:m||!!i||v===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>Rt(e,"processing"),disabled:m||!!i||v===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>Rt(e,"done"),disabled:m||!!i||v===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>Rt(e,"paid"),disabled:m||!!i||v===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:()=>Rt(e,"canceled"),disabled:m||!!i||v===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>Ea(e.id),disabled:m||i===e.id},i===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))))),!ze&&ce&&!u&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:za,disabled:se||z},z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),pe&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),ie?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:va})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ka({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:qt},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:A.customer_name,onChange:e=>Be({...A,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!rt.nameError&&React.createElement("div",{className:"form-text text-danger"},rt.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:A.phone,onChange:e=>Ha(e.target.value),onBlur:Va,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!rt.phoneError&&React.createElement("div",{className:"form-text text-danger"},rt.phoneError),!rt.phoneError&&Mt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Mt.count," \u0111\u01A1n trong th\xE1ng ",Mt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>He(e=>!e)},Te?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),Te&&Mt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>He(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Mt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${pa(e.status)}`},ua(e.status))),React.createElement("div",{className:"text-muted small"},ba(e.created_at)," \u2022 ",K(Aa(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},aa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&ga(e)}},"M\u1EDF")))),Mt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(L==null?void 0:L.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(L==null?void 0:L.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(L==null?void 0:L.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(L==null?void 0:L.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:A.status,onChange:e=>Be({...A,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:A.address,onChange:e=>Be({...A,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!rt.addressWarn&&React.createElement("div",{className:"form-text text-warning"},rt.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:A.note,onChange:e=>Be({...A,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Be(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},re(A.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;Be(l=>{const o=re(l.adjustment_items);return o[a]={...o[a],amount:n},{...l,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;Be(l=>{const o=re(l.adjustment_items);return o[a]={...o[a],note:n},{...l,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{Be(t=>{const n=re(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:m||re(A.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!rt.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},rt.adjustmentAbnormalWarn),!!rt.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},rt.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Be(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),lt(e=>[...Array.isArray(e)?e:[],""]),ie&&Je(e=>[...Array.isArray(e)?e:[],!0])},disabled:m},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(A.items)?A.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{ft.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Ze(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Ja(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ct===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:ae[a]||"",onChange:t=>{const n=t.target.value;lt(l=>{const o=Array.isArray(l)?[...l]:[];return o[a]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=Qa(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const l=String(n.id),o=Gt(n==null?void 0:n.variants),y={};for(const r of o){const d=String((r==null?void 0:r.name)||"").trim(),f=Array.isArray(r==null?void 0:r.options)?r.options[0]:null,I=String((f==null?void 0:f.label)||"").trim();d&&I&&(y[d]=I)}const c=Ia(y),k=ta(n,y);Be(r=>{const d=Array.isArray(r.items)?[...r.items]:[];return d[a]={...d[a]||{quantity:1},product_id:l,variant_json:Object.keys(y).length?y:null,variant:c,unit_price:o.length?k:null},{...r,items:d}}),Ze(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),h.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=rt.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Ct(e.product_id),n=Gt(t==null?void 0:t.variants);if(!n.length)return null;const l=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,y)=>{const c=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${y+1}`).trim(),k=String((l==null?void 0:l[c])||"").trim();return React.createElement("div",{key:c},React.createElement("label",{className:"form-label small text-muted mb-1"},c),React.createElement("select",{className:"form-select",value:k,onChange:r=>{const d=String(r.target.value||"").trim();Be(f=>{const I=Array.isArray(f.items)?[...f.items]:[],X={...I[a]||{}},H=Ct(X.product_id),Se=Gt(H==null?void 0:H.variants),ke=X!=null&&X.variant_json&&typeof X.variant_json=="object"?{...X.variant_json}:{};d?ke[c]=d:delete ke[c];const nt=Ia(ke),it=ta(H,ke);return I[a]={...X,variant_json:Object.keys(ke).length?ke:null,variant:nt,unit_price:it},{...f,items:I}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",c," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(r=>React.createElement("option",{key:r.label,value:r.label},r.label,Number.isFinite(Number(r==null?void 0:r.price))?` (${K(Number(r.price))})`:Number(r==null?void 0:r.price_delta)?` (${r.price_delta>0?"+":""}${r.price_delta})`:""))))}))})(),ie&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!ge[a],onChange:t=>{const n=!!t.target.checked;Je(l=>{const o=Array.isArray(l)?[...l]:[],y=Array.isArray(A.items)?A.items.length:0;for(;o.length<y;)o.push(!0);return o[a]=n,o})},disabled:m||E}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;Be(l=>{const o=Array.isArray(l.items)?[...l.items]:[];return o[a]={...o[a]||{product_id:""},quantity:n},{...l,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=rt.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{Be(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),lt(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),Je(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),Ze(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:m||E||(Array.isArray(A.items)?A.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(A.items)?A.items:[]).filter(c=>c==null?void 0:c.product_id),t=ia(a),n=sa(a),l=Me(A),o=l.amount,y=t+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},K(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},K(n.fee))),!!rt.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},rt.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},K(o))),(A.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(A.note||"").trim()),!!l.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",l.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},K(y)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:va,disabled:m||E,style:{borderRadius:10}},"H\u1EE7y"),!!ie&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:Ba,disabled:m||E,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},E?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!ie&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Ka({mode:"new"}),disabled:m||!rt.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:m||E||!rt.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},m?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

