const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:d,error:c}){const[N,L]=useState(""),[j,m]=useState(""),[$,H]=useState(!1),[V,I]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),c&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),c),React.createElement("form",{onSubmit:async le=>{le.preventDefault(),H(!0),await d(N,j),H(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:N,onChange:le=>L(le.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:V?"text":"password",className:"form-control",value:j,onChange:le=>m(le.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>I(!V)},React.createElement("i",{className:`fas fa-eye${V?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:$},$?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:d,type:c,onClose:N}){return useEffect(()=>{const L=setTimeout(N,3e3);return()=>clearTimeout(L)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${c} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},d),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:N})))}function Loading({show:d}){return d?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:d,onMenuChange:c,onLogout:N,currentUser:L}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(m=>React.createElement("a",{key:m.id,href:"#",className:`nav-link ${d===m.id?"active":""} ${m.disabled?"opacity-50":""} ${m.highlight?"text-warning":""}`,onClick:$=>{$.preventDefault(),m.disabled||c(m.id)}},React.createElement("i",{className:`fas ${m.icon}`})," ",m.label,m.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),m.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),N&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:N,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(d){const c=typeof d=="number"?d:parseFloat(String(d!=null?d:"").trim());return Number.isFinite(c)?Math.max(0,Math.min(100,c)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var d;try{const c=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!c)return{ship_percent:DEFAULT_SHIP_PERCENT};const N=JSON.parse(c);return{ship_percent:normalizeShipPercent((d=N==null?void 0:N.ship_percent)!=null?d:N==null?void 0:N.shipPercent)}}catch(c){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(d){var c;try{const N={ship_percent:normalizeShipPercent((c=d==null?void 0:d.ship_percent)!=null?c:d==null?void 0:d.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(N)),N}catch(N){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var c;const d=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((c=d==null?void 0:d.ship_percent)!=null?c:d==null?void 0:d.shipPercent)}}async function saveAdminSettingsToServer(d){var L,j,m;const c={ship_percent:normalizeShipPercent((L=d==null?void 0:d.ship_percent)!=null?L:d==null?void 0:d.shipPercent)},N=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,c,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((m=(j=N==null?void 0:N.ship_percent)!=null?j:N==null?void 0:N.shipPercent)!=null?m:c.ship_percent)}}function AlbumList({albums:d,onSelect:c,onCreate:N,onEdit:L,onDelete:j,loading:m,currentFolder:$,onBack:H,breadcrumb:V}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},$&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:H},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),$?$.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:N},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),V&&V.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:I=>{I.preventDefault(),H("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),V.map((I,G)=>React.createElement("li",{key:I.id,className:`breadcrumb-item ${G===V.length-1?"active":""}`},G===V.length-1?I.title:React.createElement("a",{href:"#",onClick:le=>{le.preventDefault(),H(I)},className:"text-warning"},I.title))))),m?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):d.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},$?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},d.map(I=>React.createElement("div",{key:I.uuid||I.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>c(I)},I.cover?React.createElement("img",{src:I.cover,className:"album-cover",alt:I.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},I.title),React.createElement("small",{className:"text-muted"},I.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),I.subfolderCount),I.subfolderCount>0&&I.count>0&&" \u2022 ",I.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),I.count),I.subfolderCount===0&&I.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:G=>{G.stopPropagation(),L(I)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:G=>{G.stopPropagation(),j(I)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:d,album:c,onClose:N,onSave:L,parentId:j}){const[m,$]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[H,V]=useState(!1),[I,G]=useState(!1),le=useRef(null);useEffect(()=>{$(c?{slug:c.id||"",title:c.title||"",description:c.description||"",cover_url:c.cover||"",parent_id:c.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:j||null})},[c,d,j]);const R=async B=>{B.preventDefault(),V(!0),await L(m),V(!1)},W=B=>B.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),oe=async B=>{const ie=B.type==="image/heic"||B.type==="image/heif"||/\.heic$/i.test(B.name);if(B.size<=2097152&&!ie)return B;try{const X=await createImageBitmap(B),Ne=document.createElement("canvas");let de=X.width,ue=X.height;const ce=800;return(de>ce||ue>ce)&&(de>ue?(ue=Math.round(ue/de*ce),de=ce):(de=Math.round(de/ue*ce),ue=ce)),Ne.width=de,Ne.height=ue,Ne.getContext("2d").drawImage(X,0,0,de,ue),X.close(),new Promise((he,Y)=>{Ne.toBlob(v=>{v?he(new File([v],B.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Y(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(X){throw console.error("Compress cover error:",X),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},U=async B=>{var X;const F=B.target.files[0];if(!F)return;if(!(F.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(F.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}G(!0);try{const Ne=await oe(F),de=await window.KTM.cloudinary.uploadImage({file:Ne,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!de.secure_url)throw console.error("Cloudinary error:",de),new Error(((X=de.error)==null?void 0:X.message)||"Upload failed");$(ue=>({...ue,cover_url:de.secure_url}))}catch(Ne){console.error("Cover upload error:",Ne),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Ne.message)}G(!1),B.target.value=""};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:N})),React.createElement("form",{onSubmit:R},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:m.title,onChange:B=>$({...m,title:B.target.value,slug:m.slug||W(B.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:m.slug,onChange:B=>$({...m,slug:B.target.value}),required:!0,disabled:!!c}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:m.description,onChange:B=>$({...m,description:B.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},m.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:m.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>$(B=>({...B,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:le,type:"file",accept:"image/*",className:"d-none",onChange:U}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var B;return(B=le.current)==null?void 0:B.click()},disabled:I},I?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:m.cover_url,onChange:B=>$({...m,cover_url:B.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:N},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:H||I},H?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:d,allAlbums:c,currentAlbumId:N,targetAlbum:L,onSelect:j,level:m=0}){const[$,H]=useState(!0),V=d.uuid||d.id,I=V===N,G=L===V,le=c.filter(W=>W.parentId===V),R=le.length>0;return React.createElement("div",{style:{marginLeft:m*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${G?"bg-info text-white":I?"bg-light text-muted":"hover-bg"}`,style:{cursor:I?"not-allowed":"pointer",opacity:I?.5:1,transition:"background 0.2s"},onClick:()=>!I&&j(V)},R&&React.createElement("i",{className:`fas fa-chevron-${$?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:W=>{W.stopPropagation(),H(!$)}}),!R&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${G?"-open":""} me-2 ${G?"":"text-warning"}`}),React.createElement("span",{className:"small"},d.title),I&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),d.count>0&&!I&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},d.count)),$&&R&&React.createElement("div",null,le.map(W=>React.createElement(FolderTreeItem,{key:W.uuid||W.id,folder:W,allAlbums:c,currentAlbumId:N,targetAlbum:L,onSelect:j,level:m+1}))))}function AlbumDetail({album:d,onBack:c,onRefresh:N,showToast:L,onNavigateToFolder:j,onEditSubfolder:m,parentAlbum:$}){const[H,V]=useState([]),[I,G]=useState([]),[le,R]=useState(!0),[W,oe]=useState(!1),[U,B]=useState(""),[F,ie]=useState([]),[X,Ne]=useState([]),[de,ue]=useState({}),[ce,M]=useState(null),[he,Y]=useState(!1),[v,ee]=useState(""),[ae,fe]=useState(!1),me=useRef(null),Q=useRef(null),[Ie,ye]=useState(!1),[ve,je]=useState([]),[h,be]=useState([]),[Ue,nt]=useState(""),[o,g]=useState(!1),Ce=async(l,y=2)=>{const r=y*1024*1024,_e=l.type==="image/heic"||l.type==="image/heif"||/\.heic$/i.test(l.name);if(l.size<=r&&!_e)return l;try{const $e=await createImageBitmap(l),Oe=document.createElement("canvas");let Ee=$e.width,qe=$e.height;const He=1200;return(Ee>He||qe>He)&&(Ee>qe?(qe=Math.round(qe/Ee*He),Ee=He):(Ee=Math.round(Ee/qe*He),qe=He)),Oe.width=Ee,Oe.height=qe,Oe.getContext("2d").drawImage($e,0,0,Ee,qe),$e.close(),new Promise((vt,at)=>{Oe.toBlob(we=>{we?vt(new File([we],l.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):at(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch($e){throw console.error("Compress error:",$e),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{u(),E()},[d.id,d.uuid]);const u=async()=>{R(!0);try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${d.uuid||d.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");V(l.images||[]);const y=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${d.uuid||d.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");G(Array.isArray(y)?y:[])}catch(l){console.error(l),L("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}R(!1)},E=async()=>{try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");be(Array.isArray(l)?l:[])}catch(l){console.error("Error loading albums:",l)}},O=l=>{je(y=>y.includes(l)?y.filter(r=>r!==l):[...y,l])},ke=async()=>{if(!Ue||ve.length===0){L("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}g(!0);let l=0;for(const y of ve)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${y}`,{album_id:Ue},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),l++}catch(r){console.error("Move error:",r)}g(!1),ye(!1),je([]),nt(""),l>0?(L("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),u(),N()):L("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[et,Se]=useState(!1),Te=async()=>{if(ve.length===0||!confirm(`X\xF3a ${ve.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Se(!0);let l=0;for(const y of ve)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${y}`,"L\u1ED7i x\xF3a \u1EA3nh"),l++}catch(r){console.error("Delete error:",r)}Se(!1),je([]),l>0?(L(`\u0110\xE3 x\xF3a ${l} \u1EA3nh!`,"success"),u(),N()):L("X\xF3a th\u1EA5t b\u1EA1i","danger")},Ke=()=>{ve.length===H.length?je([]):je(H.map(l=>l.id))},tt=async()=>{if(v.trim()){fe(!0);try{const l=v.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:l+"-"+Date.now(),title:v,parent_id:d.uuid||d.id},"L\u1ED7i t\u1EA1o folder"),L("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),ee(""),Y(!1),u(),N()}catch(l){L(l.message,"danger")}fe(!1)}},ft=async l=>{if(confirm(`X\xF3a folder "${l.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${l.uuid||l.id}`,"L\u1ED7i x\xF3a folder"),L("\u0110\xE3 x\xF3a folder","success"),u(),N()}catch(y){L("L\u1ED7i x\xF3a folder","danger")}},ct=l=>{const y=Array.from(l).filter(r=>r.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(r.name));ie(r=>[...r,...y]),y.forEach(r=>{const _e=new FileReader;_e.onload=$e=>{Ne(Oe=>[...Oe,{file:r,preview:$e.target.result}])},_e.readAsDataURL(r)})},$t=l=>{ie(y=>y.filter((r,_e)=>_e!==l)),Ne(y=>y.filter((r,_e)=>_e!==l))},Mt=async l=>{var r;const y=await window.KTM.cloudinary.uploadImage({file:l,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${d.id}`});if(!y.secure_url)throw console.error("Cloudinary error:",y),new Error(((r=y.error)==null?void 0:r.message)||"Upload failed");return y},Ct=async()=>{if(F.length===0)return;oe(!0);let l=0;for(let y=0;y<F.length;y++)try{B(`\u0110ang x\u1EED l\xFD ${y+1}/${F.length}...`);const r=await Ce(F[y],2);B(`\u0110ang upload ${y+1}/${F.length}...`);const _e=await Mt(r);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${d.id}`,{url:_e.secure_url,caption:de[y]||F[y].name.replace(/\.[^/.]+$/,""),sort_order:H.length+y},"L\u1ED7i l\u01B0u \u1EA3nh"),l++}catch(r){console.error("Upload error:",r)}oe(!1),B(""),ie([]),Ne([]),ue({}),l>0?(L(`\u0110\xE3 upload ${l} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),u(),N()):L("Upload th\u1EA5t b\u1EA1i","danger")},ne=async(l,y)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${l}`,"L\u1ED7i x\xF3a \u1EA3nh"),L("\u0110\xE3 x\xF3a \u1EA3nh","success"),u(),N()}catch(r){L("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Pe=l=>{var y;l.preventDefault(),(y=Q.current)==null||y.classList.add("dragover")},Be=()=>{var l;(l=Q.current)==null||l.classList.remove("dragover")},ht=l=>{var y;l.preventDefault(),(y=Q.current)==null||y.classList.remove("dragover"),ct(l.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:c},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},d.title),React.createElement("small",{className:"text-muted"},I.length>0&&React.createElement("span",null,I.length," folder \u2022 "),H.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Y(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),he&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:v,onChange:l=>ee(l.target.value),onKeyPress:l=>l.key==="Enter"&&tt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:tt,disabled:ae||!v.trim()},ae?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Y(!1),ee("")}},"H\u1EE7y")))),I.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},I.map(l=>React.createElement("div",{key:l.uuid||l.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>j&&j(l)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},l.title),React.createElement("small",{className:"text-muted"},l.subfolderCount>0&&React.createElement("span",null,l.subfolderCount," folder"),l.subfolderCount>0&&l.count>0&&" \u2022 ",l.count>0&&React.createElement("span",null,l.count," \u1EA3nh"),l.subfolderCount===0&&l.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:y=>{y.stopPropagation(),m&&m(l)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:y=>{y.stopPropagation(),ft(l)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:Q,className:"upload-zone",onClick:()=>{var l;return(l=me.current)==null?void 0:l.click()},onDragOver:Pe,onDragLeave:Be,onDrop:ht},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:me,type:"file",multiple:!0,accept:"image/*",onChange:l=>ct(l.target.files)})),X.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},X.map((l,y)=>React.createElement("div",{key:y,className:"upload-preview-item"},React.createElement("img",{src:l.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>$t(y)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Ct,disabled:W},W?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),U||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",F.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",H.length,")"),H.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Ke},ve.length===H.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ve.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ve.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>ye(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Te,disabled:et},et?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>je([])},React.createElement("i",{className:"fas fa-times"})))),le?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):H.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},H.map((l,y)=>React.createElement("div",{key:y,className:`image-item ${ve.includes(l.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>O(l.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ve.includes(l.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ve.includes(l.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ve.includes(l.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:l.src,alt:l.caption,style:{opacity:ve.includes(l.id)?.7:1,border:ve.includes(l.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:r=>{r.stopPropagation(),ne(l.id,y)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),l.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},l.caption)))))),Ie&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ve.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>ye(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},h.filter(l=>!l.parentId).map(l=>React.createElement(FolderTreeItem,{key:l.uuid||l.id,folder:l,allAlbums:h,currentAlbumId:d.uuid||d.id,targetAlbum:Ue,onSelect:nt})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>ye(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ke,disabled:!Ue||o},o?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),ce&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>M(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>M(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:ce.src,alt:ce.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:l=>l.stopPropagation()}),ce.caption&&React.createElement("div",{className:"text-white text-center mt-2"},ce.caption)))))}function SearchCenter({showToast:d,onNavigate:c}){const[N,L]=useState(""),[j,m]=useState([]),[$,H]=useState([]),[V,I]=useState([]),[G,le]=useState("all"),[R,W]=useState(null),[oe,U]=useState("list"),[B,F]=useState(!0),[ie,X]=useState([]),[Ne,de]=useState([]),ue=useRef(null),[ce,M]=useState(!0),[he,Y]=useState(!1),v=useRef(null),[ee,ae]=useState(!1),[fe,me]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[Q,Ie]=useState(""),[ye,ve]=useState(!1),je=useRef(null),h=useRef(null),[be,Ue]=useState(null),[nt,o]=useState(!1),[g,Ce]=useState(null),[u,E]=useState(!1),[O,ke]=useState(!1),[et,Se]=useState(null),[Te,Ke]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),tt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ft=t=>{var w,b;t._type==="product"&&(Ce(t),Ke({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||"",commission_percent:(b=(w=t.commission_percent)!=null?w:t.commissionPercent)!=null?b:""}),o(!0))},ct=async()=>{if(g)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${g.id}`,Te,"L\u1ED7i c\u1EADp nh\u1EADt"),d("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),o(!1),Ce(null),Pe()}catch(t){d(t.message,"danger")}},$t=async t=>{const w=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${w} "${t.name}"?`))try{let b="";t._type==="product"?b=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?b=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(b=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(b,"L\u1ED7i x\xF3a"),d(`\u0110\xE3 x\xF3a ${w}`,"success"),Pe()}catch(b){d(b.message,"danger")}},Mt=async t=>{try{const w=et?`${API_BASE}/api/products?id=${et.id}`:`${API_BASE}/api/products`;et?await window.KTM.api.putJSON(w,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(w,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),d(et?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ke(!1),Se(null),Pe()}catch(w){d(w.message,"danger")}},Ct="ktm_admin_data_cache_v1",ne=1e3*60*10,Pe=async()=>{let t=null,w=!1;const b=window.KTM.cache.read(Ct,{ttlMs:ne,validate:Array.isArray});b.hit?(t=b.value,console.log("[CACHE] Using cache, items:",t.length),H(t),m(t),F(!1),w=!0):b.status==="miss"?console.log("[CACHE] No cache found"):b.status==="expired"||b.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):b.status==="error"&&console.error("[CACHE] Error parsing cache"),w||F(!0);try{const D=async(Re,Le)=>{try{const We=await window.KTM.api.getJSON(Re,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return We!=null?We:Le}catch(We){return Le}},[K,k,x]=await Promise.all([D(`${API_BASE}/api/products`,[]),D(`${API_BASE}/api/albums`,[]),D(`${API_BASE}/api/video-folders?withVideos=true`,[])]),P=Array.isArray(K)?K.map(Re=>({...Re,_type:"product",_source:"database"})):[];X(k);let J=[];Array.isArray(k)&&k.length>0&&(await Promise.all(k.map(Le=>D(`${API_BASE}/api/albums/${Le.id}`,{})))).forEach((Le,We)=>{const z=k[We];Le.images&&Le.images.length>0&&Le.images.forEach(re=>{J.push({id:re.id,name:re.caption||"\u1EA2nh t\u1EEB "+z.title,image:re.src,folder:z.title,_type:"album",_source:"database"})})}),de(x);let pe=[];Array.isArray(x)&&x.forEach(Re=>{Re.videos&&Re.videos.forEach(Le=>{pe.push({id:Le.id,name:Le.title,folder:Re.name,image:Le.thumb,youtubeId:Le.youtubeId,url:Le.url,_type:"video",_source:"database"})})});const Z=[...P,...J,...pe];(!t||JSON.stringify(Z)!==JSON.stringify(t))&&(H(Z),m(Z),window.KTM.cache.write(Ct,Z))}catch(D){console.error("Song song fetch error:",D)}F(!1)};useEffect(()=>{Pe(),setTimeout(()=>{var t;return(t=ue.current)==null?void 0:t.focus()},100)},[]);const Be=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(w){return String(t!=null?t:"").toLowerCase()}},ht=t=>{const b=Be(t).trim().split(/\s+/).filter(Boolean),D=b.includes("anh"),K=b.includes("video"),k=b.filter(J=>J!=="anh"&&J!=="video"),x=k.join(" "),P=new Set(["product"]);return D&&P.add("album"),K&&P.add("video"),{allowedTypes:P,includeAlbum:D,includeVideo:K,contentTokens:k,cleanedQuery:x}},l=(t,w,b)=>{var Re,Le,We,z,re;const D=Array.isArray(w)?w:[],K=Be(b).trim();if(!D.length&&!K)return 0;const k=Be((Re=t==null?void 0:t.name)!=null?Re:""),x=Be((Le=t==null?void 0:t.code)!=null?Le:""),P=Be((We=t==null?void 0:t.category)!=null?We:""),J=Be((z=t==null?void 0:t.note)!=null?z:""),pe=Be((re=t==null?void 0:t.folder)!=null?re:"");if(!`${k} ${x} ${P} ${J} ${pe}`.trim())return 0;let se=0;K&&(k===K&&(se+=220),k.includes(K)&&(se+=140),k.startsWith(K)&&(se+=160),x&&x===K&&(se+=180),x&&x.includes(K)&&(se+=90));for(const Ge of D){if(!Ge)continue;const ot=new RegExp(`(?:^|\\s)${Ge.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);k.includes(Ge)&&(se+=35),ot.test(k)&&(se+=25),x&&x.includes(Ge)&&(se+=20),x&&ot.test(x)&&(se+=10),P&&P.includes(Ge)&&(se+=12),pe&&pe.includes(Ge)&&(se+=12),J&&J.includes(Ge)&&(se+=6)}return se>0&&k&&(se+=Math.max(0,10-Math.min(10,Math.floor(k.length/10)))),se},y=(t,w,b)=>{const D=Array.isArray(t)?t:[];return D.length?D.map((k,x)=>({it:k,idx:x,score:l(k,w,b)})).sort((k,x)=>x.score!==k.score?x.score-k.score:k.idx-x.idx).map(k=>k.it):[]},r=async(t,w)=>{if(!(!ce||w.length===0)){Y(!0);try{const b=w.map(K=>({id:K.id,name:K.name,price:K.price,category:K.category,note:K.note,folder:K.folder,_type:K._type})),D=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:b},"AI Search error");if(D&&D.matchedIds&&D.matchedIds.length>0){const{contentTokens:K,cleanedQuery:k}=ht(t),x=new Set(D.matchedIds),P=w.filter(J=>x.has(J.id)).sort((J,pe)=>l(pe,K,k)-l(J,K,k));P.length>0&&m(P)}else D&&D.matchedIds&&D.matchedIds.length===0&&m([])}catch(b){console.error("AI Search error:",b)}Y(!1)}},_e=t=>{if(L(t),v.current&&clearTimeout(v.current),!t.trim()){$e(G);return}const{allowedTypes:w,contentTokens:b,cleanedQuery:D}=ht(t),K=$.filter(x=>{if(!w.has(x==null?void 0:x._type))return!1;if(b.length===0)return!0;const P=Be(Object.entries(x).filter(([J])=>!J.startsWith("_")).map(([,J])=>String(J||"")).join(" "));return b.some(J=>P.includes(J))});let k=K;G!=="all"&&(k=K.filter(x=>(x.category||x._type)===G)),m(y(k,b,D)),ce&&D.length>=3&&(v.current=setTimeout(()=>{r(D,k)},500))},$e=t=>{le(t);const{allowedTypes:w,contentTokens:b}=ht(N),{cleanedQuery:D}=ht(N);let K=$.filter(k=>w.has(k==null?void 0:k._type));t!=="all"&&(K=K.filter(k=>(k.category||k._type)===t)),N.trim()&&b.length>0&&(K=K.filter(k=>{const x=Be(Object.entries(k).filter(([P])=>!P.startsWith("_")).map(([,P])=>String(P||"")).join(" "));return b.every(P=>x.includes(P))})),m(y(K,b,D))},Oe=(t,w)=>{window.KTM.clipboard.writeText(t).then(()=>{W(w),d("\u0110\xE3 copy!","success"),setTimeout(()=>W(null),1500)})},Ee=async(t,w)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),W(w+"-img"),d("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>W(null),1500)}catch(b){Oe(t,w+"-img")}},qe=t=>{let w=t.toLowerCase();const b=[],D=$.filter(x=>x._type==="product");if(w.includes("ty")||w.includes("xy lanh")){if(w.includes("gi\u1EEFa")||w.includes("giua")){const x=D.find(P=>{var J;return(J=P.name)==null?void 0:J.toLowerCase().includes("xy lanh gi\u1EEFa")});x&&!b.find(P=>P.id===x.id)&&b.push(x)}if(w.includes("nghi\xEAng")||w.includes("nghieng")){const x=D.find(P=>{var J;return(J=P.name)==null?void 0:J.toLowerCase().includes("xy lanh nghi\xEAng")});x&&!b.find(P=>P.id===x.id)&&b.push(x)}if(w.includes("\u1EE7i")||w.includes("ui")){const x=D.find(P=>{var J;return(J=P.name)==null?void 0:J.toLowerCase().includes("xy lanh \u1EE7i")});x&&!b.find(P=>P.id===x.id)&&b.push(x)}}const K=w.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(K){const x=K[1],P=K[2],J=D.find(pe=>{var se;const Z=((se=pe.name)==null?void 0:se.toLowerCase())||"";return Z.includes("combo")&&Z.includes(`${x} tay`)&&(Z.includes(`${P} xy`)||Z.includes(`${P} xylanh`))});if(J&&!b.find(pe=>pe.id===J.id))b.push(J);else{const pe=D.find(Z=>{var Re;const se=((Re=Z.name)==null?void 0:Re.toLowerCase())||"";return se.includes("combo")&&se.includes(`${x} tay`)});pe&&!b.find(Z=>Z.id===pe.id)&&b.push(pe)}}if(w.includes("combo")&&!K){const x=w.match(/combo.*?(\d+)\s*tay/);if(x){const P=x[1];D.filter(pe=>{var se;const Z=((se=pe.name)==null?void 0:se.toLowerCase())||"";return Z.includes("combo")&&Z.includes(`${P} tay`)}).forEach(pe=>{b.find(Z=>Z.id===pe.id)||b.push(pe)})}}const k=w.match(/van\s*(\d+)\s*tay/);if(k&&!w.includes("ty")&&!w.includes("combo")){const x=k[1],P=D.find(J=>{var Z;const pe=((Z=J.name)==null?void 0:Z.toLowerCase())||"";return pe.includes(`van ${x} tay`)&&!pe.includes("combo")});P&&!b.find(J=>J.id===P.id)&&b.push(P)}return b.slice(0,4)},He=async t=>{if(!t.trim())return;const w={role:"user",content:t,attachments:[]};me(D=>[...D,w]),Ie(""),ve(!0);const b=qe(t);setTimeout(()=>{var D;return(D=je.current)==null?void 0:D.scrollIntoView({behavior:"smooth"})},100);try{const K=$.filter(Z=>Z._type==="product").map(Z=>{let se=`- ${Z.name}`;return Z.code&&(se+=` (M\xE3: ${Z.code})`),Z.price&&(se+=` - Gi\xE1: ${Z.price.replace(/[đ\s]/g,"")}\u0111`),Z.category&&(se+=` [${Z.category}]`),Z.note&&(se+=` (${Z.note})`),se}).join(`
`),x=fe.slice(-6).map(Z=>`${Z.role==="user"?"Kh\xE1ch":"AI"}: ${Z.content}`).join(`
`),P=x?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${x}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${K}`:K,pe=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:P,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";me(Z=>[...Z,{role:"assistant",content:pe,attachments:b}])}catch(D){console.error("AI Error:",D);const K=t.toLowerCase(),k=$.filter(P=>{const J=Object.values(P).join(" ").toLowerCase();return K.split(" ").some(pe=>J.includes(pe))});let x="";k.length>0?(x=`T\xECm th\u1EA5y ${k.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,k.slice(0,5).forEach(P=>{x+=`\u2022 ${P.name}`,P.price&&(x+=` - ${P.price.replace(/[đ\s]/g,"")}\u0111`),P.note&&(x+=` (${P.note})`),x+=`
`}),k.length>5&&(x+=`
...v\xE0 ${k.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):x='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',me(P=>[...P,{role:"assistant",content:x,attachments:k.slice(0,4)}])}ve(!1),setTimeout(()=>{var D,K;(D=je.current)==null||D.scrollIntoView({behavior:"smooth"}),(K=h.current)==null||K.focus()},100)};function bt({show:t,product:w,categories:b,onClose:D,onSave:K}){const[k,x]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[P,J]=useState(!1),[pe,Z]=useState(!1),se=useRef(null),Re=te=>window.KTM.money.formatVNDInputDigits(te);useEffect(()=>{var te,Me;if(w)if(x({name:w.name||"",code:w.code||"",price:w.price||"",image:w.image||"",category:w.category||"",note:w.note||"",sort_order:w.sort_order||0,commission_percent:(Me=(te=w.commission_percent)!=null?te:w.commissionPercent)!=null?Me:5}),w.price){const lt=window.KTM.money.getDigits(w.price);re(lt),x(Fe=>({...Fe,price:Re(lt)}))}else re("");else x({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),re("")},[w,t]);const[Le,We]=React.useState(""),[z,re]=React.useState(""),Ge=te=>{const Me=window.KTM.money.nextPriceInputState(te.target.value,z);re(Me.digits),x({...k,price:Me.price})},ot=async(te,Me=2)=>{const lt=Me*1024*1024;if(te.size<=lt)return te;try{const Fe=await createImageBitmap(te),Qe=document.createElement("canvas");let De=Fe.width,Xe=Fe.height;const gt=1200;return(De>gt||Xe>gt)&&(De>Xe?(Xe=Math.round(Xe/De*gt),De=gt):(De=Math.round(De/Xe*gt),Xe=gt)),Qe.width=De,Qe.height=Xe,Qe.getContext("2d").drawImage(Fe,0,0,De,Xe),Fe.close(),new Promise((At,It)=>{Qe.toBlob(Ae=>{Ae?At(new File([Ae],te.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):It(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Fe){throw console.error("Compress error:",Fe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},rt=async te=>{var Fe;const Me=te.target.files[0];if(!Me)return;if(!(Me.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Me.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Z(!0);try{const Qe=await ot(Me),De=await window.KTM.cloudinary.uploadImage({file:Qe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!De.secure_url)throw console.error("Cloudinary error:",De),new Error(((Fe=De.error)==null?void 0:Fe.message)||"Upload failed");x(Xe=>({...Xe,image:De.secure_url}))}catch(Qe){console.error("Upload error:",Qe),alert("L\u1ED7i upload \u1EA3nh: "+Qe.message)}Z(!1),te.target.value=""},Nt=async te=>{te.preventDefault(),J(!0),await K(k),J(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),w?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:D})),React.createElement("form",{onSubmit:Nt},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:k.name,onChange:te=>x({...k,name:te.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:k.code,onChange:te=>x({...k,code:te.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:k.price,onChange:Ge,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:k.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:te=>x({...k,commission_percent:te.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:k.category,onChange:te=>x({...k,category:te.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),b.map(te=>React.createElement("option",{key:te,value:te},te)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:k.note,onChange:te=>x({...k,note:te.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},k.image?React.createElement(React.Fragment,null,React.createElement("img",{src:k.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>x({...k,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var te;return(te=se.current)==null?void 0:te.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:se,type:"file",accept:"image/*",className:"d-none",onChange:rt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var te;return(te=se.current)==null?void 0:te.click()},disabled:pe,style:{borderRadius:"10px"}},pe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:k.image,onChange:te=>x({...k,image:te.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:D,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:P,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},P?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const vt=(t,w)=>{const b=t._type==="product",D=t._type==="album",K=t._type==="video",k=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale"));return oe==="grid"?React.createElement("div",{key:t.id||w,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>Ue({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${K?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${b?"product":D?"album":"video"}`},b?"SP":D?"\u1EA2nh":"Video"),k&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:R===t.id+"-img"?"copied":"",onClick:()=>Ee(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:R===t.id+"-price"?"copied":"",onClick:()=>Oe(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||w,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${b?"product":D?"album":"video"}`},b?"S\u1EA3n ph\u1EA9m":D?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>Ue({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${K?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),k&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),K&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},b&&React.createElement("button",{onClick:()=>c&&c("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:R===t.id+"-price"?"copied":"",onClick:()=>Oe(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:R===t.id+"-name"?"copied":"",onClick:()=>Oe(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),K&&t.youtubeId&&React.createElement("button",{className:R===t.id+"-yt"?"copied":"",onClick:()=>Oe(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),b&&React.createElement("button",{className:"action-edit",onClick:()=>ft(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>$t(t)},React.createElement("i",{className:"fas fa-trash"}))))},[at,we]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,j.length)," k\u1EBFt qu\u1EA3",ce&&N.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),G!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},G==="product"?"S\u1EA3n ph\u1EA9m":G==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${oe==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>U("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${oe==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>U("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},B?React.createElement("div",null,[...Array(8)].map((t,w)=>React.createElement("div",{key:w,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):j.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',N,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{L(""),_e("")}},"Xem t\u1EA5t c\u1EA3")):oe==="grid"?React.createElement("div",{className:"product-grid-mobile"},j.map((t,w)=>vt(t,w))):React.createElement("div",null,j.map((t,w)=>vt(t,w)))),at&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>we(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${G==="all"?"active":""}`,onClick:()=>{$e("all"),we(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${G==="product"?"active":""}`,onClick:()=>{$e("product"),we(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${G==="album"?"active":""}`,onClick:()=>{$e("album"),we(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${G==="video"?"active":""}`,onClick:()=>{$e("video"),we(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:ce,onChange:t=>M(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:ue,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:N,onChange:t=>_e(t.target.value)}),React.createElement("button",{className:`filter-btn ${at||G!=="all"?"active":""}`,onClick:()=>we(!at)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:u?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>ae(!0),onTouchStart:()=>ae(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),ee&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>ae(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},fe.map((t,w)=>React.createElement("div",{key:w,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:R===`chat-${w}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:R===`chat-${w}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),W(`chat-${w}`),setTimeout(()=>W(null),1500)}},React.createElement("i",{className:`fas ${R===`chat-${w}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((b,D)=>React.createElement("div",{key:D,style:{width:70},className:"text-center"},b.image&&React.createElement("img",{src:b.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>Ue({url:b.image,name:b.name,price:b.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},b.name),b.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},b.price.replace(/[đ\s]/g,""),"\u0111"))))))),ye&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:je})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>He(t),disabled:ye,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),He(Q)},className:"chat-input-wrap"},React.createElement("input",{ref:h,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:Q,onChange:t=>Ie(t.target.value),disabled:ye}),React.createElement("button",{type:"submit",className:"send-btn",disabled:ye||!Q.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),be&&React.createElement("div",{className:"preview-modal",onClick:()=>Ue(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>Ue(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:be.url,alt:be.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},be.name),be.price&&React.createElement("div",{className:"price"},be.price.replace(/[đ\s]/g,""),"\u0111"),be.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},be.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:R==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:R==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Ee(be.url,"preview")},React.createElement("i",{className:`fas ${R==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),be.price&&React.createElement("button",{className:R==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Oe(be.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${R==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(bt,{show:O,product:et,categories:V,onClose:()=>{ke(!1),Se(null)},onSave:Mt}),React.createElement("div",{className:`fab-container mobile-only ${u?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{E(!1),ke(!0),Se(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{E(!1),c&&c("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${u?"open":""}`,onClick:()=>E(!u)},React.createElement("i",{className:"fas fa-plus"}))),nt&&g&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>o(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Te.name,onChange:t=>Ke({...Te,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Te.code,onChange:t=>Ke({...Te,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Te.price,onChange:t=>Ke({...Te,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Te.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:t=>Ke({...Te,commission_percent:t.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Te.category,onChange:t=>Ke({...Te,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),tt.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Te.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>Ke({...Te,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>o(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:ct},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:d,showToast:c}){const[N,L]=useState([]),[j,m]=useState([]),[$,H]=useState(!0),[V,I]=useState(null),[G,le]=useState(!1),[R,W]=useState(null),[oe,U]=useState(!1),[B,F]=useState(null),[ie,X]=useState(null),[Ne,de]=useState([]);useEffect(()=>{ue()},[]);const ue=async(o=null)=>{H(!0);try{const g=o?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${o}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Ce=await window.KTM.api.getJSON(g,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");L(Array.isArray(Ce)?Ce:[])}catch(g){console.error(g),c("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}H(!1)},ce=async o=>{try{const g=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${o}`,"L\u1ED7i t\u1EA3i video");m(Array.isArray(g)?g:[])}catch(g){console.error(g)}},M=async o=>{if(o===0)return;const g=[...N];[g[o-1],g[o]]=[g[o],g[o-1]],L(g),await Y(g)},he=async o=>{if(o===N.length-1)return;const g=[...N];[g[o],g[o+1]]=[g[o+1],g[o]],L(g),await Y(g)},Y=async o=>{try{await Promise.all(o.map((g,Ce)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${g.id}`,{sortOrder:Ce},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),c("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(g){c("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ue(ie==null?void 0:ie.id)}},v=async o=>{if(o===0)return;const g=[...j];[g[o-1],g[o]]=[g[o],g[o-1]],m(g),await ae(g)},ee=async o=>{if(o===j.length-1)return;const g=[...j];[g[o],g[o+1]]=[g[o+1],g[o]],m(g),await ae(g)},ae=async o=>{try{await Promise.all(o.map((g,Ce)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${g.id}`,{sort_order:Ce},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),c("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(g){c("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ce(V.id)}},fe=()=>{W(null),le(!0)},me=o=>{W(o),le(!0)},Q=async o=>{try{!R&&ie&&(o.parent_id=ie.id);const g=R?`${API_BASE}/api/video-folders/${R.id}`:`${API_BASE}/api/video-folders`;R?await window.KTM.api.putJSON(g,o,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(g,o,"L\u1ED7i l\u01B0u folder"),c(R?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),le(!1),ue(ie==null?void 0:ie.id)}catch(g){c(g.message,"danger")}},Ie=async o=>{const g=o.subfolderCount>0?`X\xF3a folder "${o.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${o.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(g))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${o.id}`,"L\u1ED7i x\xF3a folder"),c("\u0110\xE3 x\xF3a folder","success"),I(null),ue(ie==null?void 0:ie.id)}catch(Ce){c("L\u1ED7i x\xF3a folder","danger")}},ye=o=>{o.subfolderCount>0?(de(g=>[...g,o]),X(o),ue(o.id)):(I(o),m(o.videos||[]))},ve=o=>{if(o==="root")de([]),X(null),ue(null);else if(o){const g=Ne.findIndex(Ce=>Ce.id===o.id);g>=0&&(de(Ne.slice(0,g+1)),X(o),ue(o.id))}else{const g=[...Ne];g.pop();const Ce=g[g.length-1]||null;de(g),X(Ce),ue(Ce==null?void 0:Ce.id)}},je=()=>{F(null),U(!0)},h=o=>{F(o),U(!0)},be=async o=>{try{o.folder_id=V==null?void 0:V.id;const g=B?`${API_BASE}/api/videos/${B.id}`:`${API_BASE}/api/videos`;B?await window.KTM.api.putJSON(g,o,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(g,o,"L\u1ED7i l\u01B0u video"),c(B?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),U(!1),ue(),V&&ce(V.id)}catch(g){c(g.message,"danger")}},Ue=async o=>{if(confirm(`X\xF3a video "${o.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${o.id}`,"L\u1ED7i x\xF3a video"),c("\u0110\xE3 x\xF3a video","success"),ue(),V&&ce(V.id)}catch(g){c("L\u1ED7i x\xF3a video","danger")}},nt=o=>{const g=`https://www.youtube.com/watch?v=${o.youtubeId}`;window.KTM.clipboard.writeText(g).then(()=>{c("\u0110\xE3 copy link!","success")}).catch(()=>{c("Kh\xF4ng th\u1EC3 copy link","danger")})};return V?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>I(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${V.slug==="shorts"?"text-danger":"text-warning"}`}),V.name)),React.createElement("button",{className:"btn btn-warning",onClick:je},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),j.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},j.map((o,g)=>React.createElement("div",{key:o.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>v(g),disabled:g===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},g+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>ee(g),disabled:g===j.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:o.thumb,className:"card-img-top",alt:o.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${o.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:o.title},o.title),React.createElement("small",{className:"text-muted"},o.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>nt(o),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>h(o),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Ue(o),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:oe,video:B,onClose:()=>U(!1),onSave:be})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},ie&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ve()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),ie?ie.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:fe},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Ne.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:o=>{o.preventDefault(),ve("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Ne.map((o,g)=>React.createElement("li",{key:o.id,className:`breadcrumb-item ${g===Ne.length-1?"active":""}`},g===Ne.length-1?o.name:React.createElement("a",{href:"#",onClick:Ce=>{Ce.preventDefault(),ve(o)},className:"text-warning"},o.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),$?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):N.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},ie?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:fe},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",ie?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},N.map((o,g)=>{var Ce,u,E,O;return React.createElement("div",{key:o.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ke=>{ke.stopPropagation(),M(g)},disabled:g===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},g+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ke=>{ke.stopPropagation(),he(g)},disabled:g===N.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>ye(o),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${o.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},o.name),React.createElement("p",{className:"text-muted mb-0"},o.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),o.subfolderCount," folder"),o.subfolderCount>0&&(o.videoCount>0||((Ce=o.videos)==null?void 0:Ce.length)>0)&&" \u2022 ",(o.videoCount>0||((u=o.videos)==null?void 0:u.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),o.videoCount||((E=o.videos)==null?void 0:E.length)||0," videos"),o.subfolderCount===0&&!o.videoCount&&!((O=o.videos)!=null&&O.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ke=>{ke.stopPropagation(),me(o)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ke=>{ke.stopPropagation(),Ie(o)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:G,folder:R,onClose:()=>le(!1),onSave:Q}))}function VideoFolderModal({show:d,folder:c,onClose:N,onSave:L}){const[j,m]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[$,H]=useState(!1),[V,I]=useState(!1);useEffect(()=>{m(c?{name:c.name||"",description:c.description||"",sortOrder:c.sortOrder||0,coverImage:c.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[c,d]);const G=async R=>{const W=R.target.files[0];if(W){I(!0);try{const oe=await window.KTM.cloudinary.uploadImage({file:W,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});oe.secure_url&&m(U=>({...U,coverImage:oe.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(oe){console.error("Cloudinary upload error:",oe),alert("L\u1ED7i upload \u1EA3nh: "+(oe.message||oe))}finally{I(!1)}}},le=async R=>{R.preventDefault(),H(!0),await L(j),H(!1)};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:N})),React.createElement("form",{onSubmit:le},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:j.name,onChange:R=>m({...j,name:R.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:j.description,onChange:R=>m({...j,description:R.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:j.sortOrder,onChange:R=>m({...j,sortOrder:parseInt(R.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},j.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:j.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>m({...j,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:G,disabled:V}),V&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:j.coverImage,onChange:R=>m({...j,coverImage:R.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:N},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:$},$?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:d,settings:c}){const[N,L]=useState([]),[j,m]=useState(!0),[$,H]=useState(!1),[V,I]=useState(null),[G,le]=useState(""),[R,W]=useState(""),oe=normalizeShipPercent(c==null?void 0:c.ship_percent),{parseMoney:U,formatVND:B}=window.KTM.money,F=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{ie()},[]);const ie=async()=>{m(!0);try{const v=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");L(Array.isArray(v)?v:[])}catch(v){console.error(v),d("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}m(!1)},X=()=>{I(null),H(!0)},Ne=v=>{I(v),H(!0)},de=async v=>{if(!(!v||!v.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:v},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),d(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),ie()}catch(ee){d("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},ue=async v=>{try{const ee=V?`${API_BASE}/api/products?id=${V.id}`:`${API_BASE}/api/products`;V?await window.KTM.api.putJSON(ee,v,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(ee,v,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),d(V?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),H(!1),ie()}catch(ee){d(ee.message,"danger")}},ce=async v=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${v.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${v.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),d("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ie()}catch(ee){d(ee.message,"danger")}},M=N.filter(v=>{const ee=!G||v.name.toLowerCase().includes(G.toLowerCase())||v.code&&v.code.toLowerCase().includes(G.toLowerCase()),ae=!R||v.category===R;return ee&&ae}),he=v=>{var fe;const ee=(fe=v==null?void 0:v.commission_percent)!=null?fe:v==null?void 0:v.commissionPercent,ae=ee===""||ee==null?NaN:Number(ee);return Number.isFinite(ae)?Math.max(0,Math.min(100,ae)):5},Y=v=>{const ee=he(v),ae=Number.isInteger(ee)?String(ee):String(Math.round(ee*100)/100),fe=U(v==null?void 0:v.price);if(!Number.isFinite(fe)||fe<=0)return`${ae}%`;const me=(Number(ee)||0)/100,Ie=window.KTM.money.parseShipFeeFromNote(v==null?void 0:v.note)!=null?0:oe>0?fe*oe/100:0,ye=fe*me-Ie*me,ve=Math.max(0,Math.round(ye));return`${ae}% - ${B(ve)}`};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:X},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:G,onChange:v=>le(v.target.value)})),React.createElement("span",{className:"product-count"},M.length)),React.createElement("select",{className:"form-select",value:R,onChange:v=>W(v.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),F.map(v=>React.createElement("option",{key:v,value:v},v)))),j?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):M.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:X},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},M.map(v=>React.createElement("div",{key:v.id,className:"product-item d-flex align-items-center gap-3"},v.image?React.createElement("img",{src:v.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},v.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},v.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},v.category),v.code&&React.createElement("span",{className:"product-badge bg-secondary"},v.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),Y(v))),React.createElement("div",{className:"product-price"},v.price?v.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),v.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},v.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>Ne(v),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>ce(v),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:$,product:V,categories:F,onClose:()=>H(!1),onSave:ue}))}function ProductModal({show:d,product:c,categories:N,onClose:L,onSave:j}){const[m,$]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[H,V]=useState(!1),[I,G]=useState(!1);useEffect(()=>{var M,he;$(c?{name:c.name||"",code:c.code||"",price:c.price||"",image:c.image||"",category:c.category||"",note:c.note||"",sort_order:c.sort_order||0,commission_percent:(he=(M=c.commission_percent)!=null?M:c.commissionPercent)!=null?he:5}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5})},[c,d]);const[le,R]=React.useState(""),W=M=>window.KTM.money.formatVNDInputDigits(M),[oe,U]=React.useState(""),B=M=>{const he=window.KTM.money.nextPriceInputState(M.target.value,oe);U(he.digits),$({...m,price:he.price})},[F,ie]=React.useState("");React.useEffect(()=>{c!=null&&c.image&&ie(c.image)},[c]);const X=async M=>{if(!(!M||!M.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:M},"L\u1ED7i x\xF3a \u1EA3nh")}catch(he){console.error("Delete cloudinary image error:",he)}},Ne=async(M,he=2,Y)=>{const v=he*1024*1024,ee=M.type==="image/heic"||M.type==="image/heif"||/\.heic$/i.test(M.name);if(M.size<=v&&!ee)return M;Y==null||Y("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const ae=await createImageBitmap(M);Y==null||Y("\u0110ang n\xE9n \u1EA3nh...");const fe=document.createElement("canvas");let me=ae.width,Q=ae.height;const Ie=1200;return(me>Ie||Q>Ie)&&(me>Q?(Q=Math.round(Q/me*Ie),me=Ie):(me=Math.round(me/Q*Ie),Q=Ie)),fe.width=me,fe.height=Q,fe.getContext("2d").drawImage(ae,0,0,me,Q),ae.close(),new Promise((ve,je)=>{fe.toBlob(h=>{h?(Y==null||Y("Ho\xE0n t\u1EA5t!"),ve(new File([h],M.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):je(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ae){throw console.error("createImageBitmap error:",ae),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},de=async M=>{var v,ee;const he=(v=M.target.files)==null?void 0:v[0];if(!he)return;if(!(he.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(he.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}G(!0),R("\u0110ang chu\u1EA9n b\u1ECB...");try{const ae=(he.size/1024/1024).toFixed(1);R(`File ${ae}MB - \u0110ang n\xE9n...`);const fe=await Ne(he,2,Ie=>{R(Ie)}),me=(fe.size/1024/1024).toFixed(1);R(`\u0110\xE3 n\xE9n: ${me}MB - \u0110ang upload...`);const Q=await window.KTM.cloudinary.uploadImage({file:fe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Q.secure_url?(m.image&&m.image!==F&&X(m.image),$(Ie=>({...Ie,image:Q.secure_url})),R("")):(console.error("Cloudinary error:",Q),alert("Upload th\u1EA5t b\u1EA1i: "+(((ee=Q.error)==null?void 0:ee.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),R(""))}catch(ae){console.error("Upload error:",ae),alert("L\u1ED7i: "+ae.message),R("")}G(!1),M.target.value=""},ue=()=>{m.image&&(m.image!==F&&X(m.image),$(M=>({...M,image:""})))},ce=async M=>{M.preventDefault(),V(!0),F&&m.image&&F!==m.image&&await X(F),F&&!m.image&&await X(F),await j(m),V(!1)};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${c?"fa-edit":"fa-plus-circle"} me-2`}),c?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:ce},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},m.image?React.createElement(React.Fragment,null,React.createElement("img",{src:m.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:ue,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${I?"fa-spinner fa-spin":"fa-camera"} me-1`}),I?le||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:de,disabled:I,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),I&&le&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},le))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:m.name,onChange:M=>$({...m,name:M.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:m.code,onChange:M=>$({...m,code:M.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:m.price,onChange:B,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:m.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:M=>$({...m,commission_percent:M.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:m.category,onChange:M=>$({...m,category:M.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),N.map(M=>React.createElement("option",{key:M,value:M},M)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:m.note,onChange:M=>$({...m,note:M.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:m.image,onChange:M=>$({...m,image:M.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:L,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:H,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},H?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:d,video:c,onClose:N,onSave:L}){const[j,m]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[$,H]=useState(!1),[V,I]=useState("");useEffect(()=>{c?(m({title:c.title||"",youtube_url:`https://www.youtube.com/watch?v=${c.youtubeId}`,thumbnail_url:c.thumb||"",sort_order:c.sortOrder||0}),I(c.thumb)):(m({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),I(""))},[c,d]);const G=W=>{const oe=W.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return oe?oe[1]:null},le=W=>{m({...j,youtube_url:W});const oe=G(W);oe&&I(`https://img.youtube.com/vi/${oe}/hqdefault.jpg`)},R=async W=>{W.preventDefault(),H(!0),await L(j),H(!1)};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:N})),React.createElement("form",{onSubmit:R},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:j.youtube_url,onChange:W=>le(W.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),V&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:V,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:j.title,onChange:W=>m({...j,title:W.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:j.sort_order,onChange:W=>m({...j,sort_order:parseInt(W.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:j.thumbnail_url,onChange:W=>m({...j,thumbnail_url:W.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:N},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:$},$?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[d,c]=useState(!1),[N,L]=useState(""),[j,m]=useState(null),[$,H]=useState("search"),[V,I]=useState(null),[G,le]=useState(""),[R,W]=useState([]),[oe,U]=useState(null),[B,F]=useState(!1),[ie,X]=useState(null),[Ne,de]=useState(!0),[ue,ce]=useState([]),[M,he]=useState(()=>loadAdminSettings()),[Y,v]=useState(null),[ee,ae]=useState([]);useEffect(()=>{const u=localStorage.getItem("ktm_admin_session");if(u)try{const E=JSON.parse(u);E.expiry>Date.now()?(c(!0),m(E.user)):localStorage.removeItem("ktm_admin_session")}catch(E){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{d&&ye()},[d]),useEffect(()=>{if(!d)return;let u=!1;return(async()=>{try{const E=await fetchAdminSettingsFromServer();if(u)return;he(E),saveAdminSettings(E)}catch(E){}})(),()=>{u=!0}},[d]);const fe=async(u,E)=>{L("");try{const O=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:u,password:E},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),ke={user:O.user,token:O.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(ke)),m(O.user),c(!0)}catch(O){L(O.message)}},me=()=>{localStorage.removeItem("ktm_admin_session"),c(!1),m(null),W([]),U(null)},Q=(u,E="success")=>{const O=Date.now();ce(ke=>[...ke,{id:O,message:u,type:E}])},Ie=u=>{ce(E=>E.filter(O=>O.id!==u))},ye=async(u=null)=>{de(!0);try{const E=u?`${API_BASE}/api/albums?parent_id=${u}`:`${API_BASE}/api/albums?parent_id=root`,O=await window.KTM.api.getJSON(E,"L\u1ED7i t\u1EA3i danh s\xE1ch album");W(Array.isArray(O)?O:[])}catch(E){console.error(E),Q("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}de(!1)},ve=()=>{X(null),F(!0)},je=u=>{X(u),F(!0)},h=async u=>{try{const E=ie&&ie.uuid;!E&&Y&&(u.parent_id=Y.uuid);const O=E?`${API_BASE}/api/albums/${ie.uuid||ie.id}`:`${API_BASE}/api/albums`;E?await window.KTM.api.putJSON(O,u,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(O,u,"L\u1ED7i t\u1EA1o"),Q(E?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),F(!1),ye(Y==null?void 0:Y.uuid)}catch(E){Q(E.message,"danger")}},be=u=>{U(u)},Ue=u=>{if(u==="root")ae([]),v(null),ye(null);else if(u){const E=ee.findIndex(O=>O.uuid===u.uuid);E>=0&&(ae(ee.slice(0,E+1)),v(u),ye(u.uuid))}else{const E=[...ee];E.pop();const O=E[E.length-1]||null;ae(E),v(O),ye(O==null?void 0:O.uuid)}},nt=async u=>{const E=`X\xF3a folder "${u.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(E))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${u.uuid||u.id}`,"L\u1ED7i x\xF3a album"),Q("\u0110\xE3 x\xF3a","success"),ye(Y==null?void 0:Y.uuid)}catch(O){Q("L\u1ED7i x\xF3a album","danger")}};if(!d)return React.createElement(LoginPage,{onLogin:fe,error:N});const o=()=>{const u=new Date,E=u.getFullYear(),O=String(u.getMonth()+1).padStart(2,"0");return`${E}-${O}`};function g(){const[u,E]=useState(()=>{var Se;return String((Se=M==null?void 0:M.ship_percent)!=null?Se:DEFAULT_SHIP_PERCENT)}),[O,ke]=useState(!1);return useEffect(()=>{var Se;E(String((Se=M==null?void 0:M.ship_percent)!=null?Se:DEFAULT_SHIP_PERCENT))},[M==null?void 0:M.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Se=>{Se.preventDefault(),ke(!0);const Te=saveAdminSettings({ship_percent:u});try{const Ke=await saveAdminSettingsToServer(Te);he(Ke),saveAdminSettings(Ke),Q("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Ke){he(Te),Q("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{ke(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:u,min:"0",max:"100",step:"0.01",onChange:Se=>E(Se.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function Ce(){const[u,E]=useState(o()),[O,ke]=useState(!0),[et,Se]=useState([]),[Te,Ke]=useState([]),tt=useRef(!1),ft=useRef(new Map),ct=normalizeShipPercent(M==null?void 0:M.ship_percent),{parseMoney:$t,parseShipFeeFromNote:Mt,getShipFeeForItems:Ct,formatNumber:ne,formatVND:Pe}=window.KTM.money,Be=async()=>{if(!tt.current)try{const r=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m");Ke(Array.isArray(r)?r:[]),tt.current=!0}catch(r){console.error("Load products for stats error:",r),Ke([]),tt.current=!0}},ht=async r=>{var qe,He;const _e=String(r||"").trim();if(!_e)return[];const $e=(qe=ft.current)==null?void 0:qe.get(_e);if($e&&Array.isArray($e))return $e;const Oe=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(_e)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Ee=Array.isArray(Oe)?Oe:[];return(He=ft.current)==null||He.set(_e,Ee),Ee},l=async()=>{ke(!0);try{await Be();const r=await ht(u);Se(Array.isArray(r)?r:[])}catch(r){console.error("Load stats error:",r),Se([])}finally{ke(!1)}};useEffect(()=>{l()},[u]);const y=React.useMemo(()=>{var We;const r={draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};let _e=0,$e=0,Oe=0,Ee=0,qe=0,He=0,bt=0,vt=0;const at=z=>z.customer_id||z.phone||"unknown",we=z=>window.KTM.orders.getOrderItems(z),t=new Map,w=new Map,b=new Map,D=5,K=new Map((Array.isArray(Te)?Te:[]).map(z=>{var rt;const re=(rt=z==null?void 0:z.commission_percent)!=null?rt:z==null?void 0:z.commissionPercent,Ge=Number(re),ot=Number.isFinite(Ge)?Math.max(0,Math.min(100,Ge)):D;return[String(z==null?void 0:z.id),ot]})),k=z=>{const re=String(z!=null?z:"").trim().toLowerCase();return re==="cancelled"?"canceled":re};for(const z of et){const re=k(z==null?void 0:z.status),rt=re==="canceled"||re==="draft",Nt=we(z);let te=0,Me=0,lt=0;for(const Ae of Nt){const Ye=Number((Ae==null?void 0:Ae.quantity)||0)||0,yt=$t(Ae==null?void 0:Ae.product_price),dt=Ye*yt,mt=String((Ae==null?void 0:Ae.product_id)||""),Ot=K.has(mt)?K.get(mt):D,Rt=(Number(Ot)||0)/100;if(te+=Ye,Me+=dt,lt+=dt*Rt,!rt){const kt=(Ae==null?void 0:Ae.product_id)||"unknown",St=t.get(mt)||{product_id:kt,product_name:(Ae==null?void 0:Ae.product_name)||"\u2014",product_code:(Ae==null?void 0:Ae.product_code)||"",orders:0,quantity:0,revenue:0};St.orders+=1,St.quantity+=Ye,St.revenue+=dt,t.set(kt,St)}}const Fe=Ct(Nt),Qe=Number((We=z==null?void 0:z.adjustment_amount)!=null?We:0)||0,De=Me+(Fe.found?Fe.fee:0)+Qe,Xe=Me+Qe,gt=!Fe.found&&ct>0&&Me>0?Me*ct/100:0,it=Me>0?lt/Me:D/100,At=lt+Qe*it-gt*it,It=re==="done"||re==="paid";if(re==="draft"?r.draft+=1:re==="pending"?r.pending+=1:re==="processing"?r.processing+=1:re==="canceled"?r.canceled+=1:re==="paid"?(r.paid+=1,r.done+=1,Ee+=De,He+=Xe,vt+=At):re==="done"?(r.done+=1,Ee+=De,He+=Xe,vt+=At):r.other+=1,!rt){_e+=1,$e+=te,Oe+=De,qe+=Xe,bt+=At;const Ae=at(z),Ye=w.get(Ae)||{key:Ae,customer_name:z.customer_name||"",phone:z.phone||"",orders:0,quantity:0,revenue:0};Ye.orders+=1,Ye.quantity+=te,Ye.revenue+=De,!Ye.customer_name&&z.customer_name&&(Ye.customer_name=z.customer_name),!Ye.phone&&z.phone&&(Ye.phone=z.phone),w.set(Ae,Ye);const yt=z.created_at?new Date(z.created_at):null;if(yt&&!Number.isNaN(yt.getTime())){const dt=`${yt.getFullYear()}-${String(yt.getMonth()+1).padStart(2,"0")}-${String(yt.getDate()).padStart(2,"0")}`,mt=b.get(dt)||{day:dt,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};mt.orders+=1,mt.quantity+=te,mt.revenue+=De,It&&(mt.doneOrders+=1,mt.doneRevenue+=De),b.set(dt,mt)}}}const x=Array.from(t.values()).sort((z,re)=>re.revenue-z.revenue),P=Array.from(w.values()).sort((z,re)=>re.revenue-z.revenue),J=Array.from(b.values()).sort((z,re)=>z.day.localeCompare(re.day)),pe=w.size,Z=_e?Math.round(Oe/_e):0,se=_e?$e/_e:0,Re=Math.round(vt),Le=Math.round(bt);return{statusCounts:r,activeOrders:_e,totalQty:$e,totalRevenue:Oe,doneRevenue:Ee,tempCommission:Re,tempCommissionAll:Le,products:x,customers:P,days:J,uniqueCustomers:pe,avgOrderValue:Z,avgQtyPerOrder:se}},[et,Te,u]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:O}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:l,disabled:O},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:u,onChange:r=>E(r.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",ct,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),ne(y.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),ne(y.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),ne(y.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",ne(y.statusCounts.paid),"/",ne(y.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ne(y.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Pe(y.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Pe(y.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Pe(y.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Pe(y.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",y.avgQtyPerOrder?y.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},ne(y.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},ne(y.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},ne(y.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},ne(y.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},ne(y.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},ne(y.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},ne(y.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,ne(y.statusCounts.draft)),React.createElement("td",null,ne(y.statusCounts.pending)),React.createElement("td",null,ne(y.statusCounts.processing)),React.createElement("td",null,ne(y.statusCounts.canceled)),React.createElement("td",null,ne(y.statusCounts.done)),React.createElement("td",null,ne(y.statusCounts.paid)),React.createElement("td",null,ne(y.statusCounts.other)),React.createElement("td",null,ne(y.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},y.products.slice(0,10).map(r=>React.createElement("div",{key:r.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},r.product_name),React.createElement("div",{className:"text-muted small text-truncate"},r.product_code?`#${r.product_code} \u2022 `:"",ne(r.orders)," \u0111\u01A1n \u2022 ",ne(r.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Pe(r.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,y.products.slice(0,10).map(r=>React.createElement("tr",{key:r.product_id},React.createElement("td",null,r.product_name),React.createElement("td",null,r.product_code||"\u2014"),React.createElement("td",null,ne(r.orders)),React.createElement("td",null,ne(r.quantity)),React.createElement("td",{className:"fw-semibold"},Pe(r.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},y.customers.slice(0,10).map(r=>React.createElement("div",{key:r.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},r.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},r.phone||"\u2014"," \u2022 ",ne(r.orders)," \u0111\u01A1n \u2022 ",ne(r.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Pe(r.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,y.customers.slice(0,10).map(r=>React.createElement("tr",{key:r.key},React.createElement("td",null,r.customer_name||"\u2014"),React.createElement("td",null,r.phone||"\u2014"),React.createElement("td",null,ne(r.orders)),React.createElement("td",null,ne(r.quantity)),React.createElement("td",{className:"fw-semibold"},Pe(r.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},y.days.map(r=>React.createElement("div",{key:r.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},r.day),React.createElement("div",{className:"text-muted small"},ne(r.orders)," \u0111\u01A1n \u2022 ",ne(r.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",ne(r.doneOrders)," \u2022 ",Pe(r.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Pe(r.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,y.days.map(r=>React.createElement("tr",{key:r.day},React.createElement("td",null,r.day),React.createElement("td",null,ne(r.orders)),React.createElement("td",null,ne(r.quantity)),React.createElement("td",{className:"fw-semibold"},Pe(r.revenue)),React.createElement("td",null,ne(r.doneOrders)),React.createElement("td",{className:"fw-semibold"},Pe(r.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:$,onMenuChange:u=>{H(u),u==="albums"&&(v(null),ae([]),ye(null))},onLogout:me,currentUser:j}),React.createElement("div",{className:"main-content"},$==="albums"&&!oe&&React.createElement(AlbumList,{albums:R,loading:Ne,currentFolder:Y,breadcrumb:ee,onSelect:be,onCreate:ve,onEdit:je,onDelete:nt,onBack:Ue}),$==="search"&&React.createElement(SearchCenter,{showToast:Q,onNavigate:(u,E,O)=>{H(u),u==="orders"&&E==="create"&&(I(Date.now()),le((O==null?void 0:O.productId)||""))}}),$==="albums"&&oe&&React.createElement(AlbumDetail,{album:oe,parentAlbum:ee.length>0?ee[ee.length-1]:null,onBack:()=>{if(oe.parentId){const u=ee.findIndex(E=>E.uuid===oe.parentId);u>=0?U(ee[u]):U(null)}else U(null)},onRefresh:()=>ye(Y==null?void 0:Y.uuid),showToast:Q,onNavigateToFolder:u=>{ae(E=>[...E,oe]),U(u)},onEditSubfolder:u=>{X(u),F(!0)}}),$==="videos"&&React.createElement(VideoList,{showToast:Q}),$==="products"&&React.createElement(ProductManager,{showToast:Q,settings:M}),$==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:V,autoOpenCreateProductId:G,showToast:Q}),$==="stats"&&React.createElement(Ce,null),$==="settings"&&React.createElement(g,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${$==="search"?"active":""}`,onClick:u=>{u.preventDefault(),H("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${$==="albums"?"active":""}`,onClick:u=>{u.preventDefault(),H("albums"),U(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${$==="videos"?"active":""}`,onClick:u=>{u.preventDefault(),H("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${$==="products"?"active":""}`,onClick:u=>{u.preventDefault(),H("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${$==="orders"?"active":""}`,onClick:u=>{u.preventDefault(),H("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${$==="stats"?"active":""}`,onClick:u=>{u.preventDefault(),H("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:B,album:ie,parentId:Y==null?void 0:Y.uuid,onClose:()=>F(!1),onSave:h}),React.createElement("div",{className:"toast-container"},ue.map(u=>React.createElement(Toast,{key:u.id,message:u.message,type:u.type,onClose:()=>Ie(u.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:d,autoOpenCreateProductId:c,showToast:N}){const[L,j]=useState([]),[m,$]=useState([]),[H,V]=useState(!0),[I,G]=useState(!1),[le,R]=useState([]),[W,oe]=useState(!1),[U,B]=useState(!1),[F,ie]=useState(null),[X,Ne]=useState(null),[de,ue]=useState(!1),[ce,M]=useState(()=>{const e=new Date,s=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${s}-${a}`}),[he,Y]=useState(""),[v,ee]=useState(!1),[ae,fe]=useState(!1),[me,Q]=useState(null),[Ie,ye]=useState(!1),[ve,je]=useState([]),[h,be]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Ue,nt]=useState([""]),[o,g]=useState(null),Ce=useRef({}),[u,E]=useState([]),[O,ke]=useState(null),et=useRef(null),Se=useRef(null),Te=useRef(0),Ke=useRef(new Map),tt=useRef(""),ft=useRef(null),ct=useRef(0),$t=useRef(null),Mt=9,Ct=150,ne=24*60*60*1e3,Pe=5*60*1e3,Be="ktm_customer_lookup_cache_v1",ht=200,l=3,y=7,r=3,_e=24*60*60*1e3,$e=e=>{try{const s=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(s))return 0;const a=Date.now()-s;return!Number.isFinite(a)||a<=0?0:Math.floor(a/_e)}catch(s){return 0}},Oe=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:$e(e)>=l,Ee=e=>{const s=String(e!=null?e:"").trim().toLowerCase();return s==="cancelled"?"canceled":s},qe=e=>{if(Ee(e==null?void 0:e.status)!=="draft")return null;const a=y-$e(e);return Number.isFinite(a)?a:null},He=e=>{const s=qe(e);return Number.isFinite(s)?s>0&&s<=r:!1},bt=e=>{be({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),nt([""]),Q(null),g(null)};useEffect(()=>{const e=s=>{var n;if(o==null)return;const a=(n=Ce.current)==null?void 0:n[o];a&&!a.contains(s.target)&&g(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[o]);const vt=e=>window.KTM.money.parseMoney(e),at=e=>window.KTM.money.parseSignedMoney(e),we=e=>window.KTM.money.formatVND(e),t=e=>window.KTM.money.parseShipFeeFromNote(e),w=e=>window.KTM.phone.isValid(e),b=e=>window.KTM.phone.normalize(e),D=()=>{var e;try{const s=localStorage.getItem(Be);if(!s)return;const a=JSON.parse(s);if(!a||typeof a!="object")return;const n=Object.entries(a);for(const[i,f]of n)!i||!f||typeof f!="object"||(e=Ke.current)==null||e.set(String(i),f)}catch(s){}},K=()=>{try{const e=Ke.current;if(!e||typeof e.entries!="function")return;const s=Array.from(e.entries()).filter(([n,i])=>n&&i&&typeof i=="object"&&Number.isFinite(i.ts)).sort((n,i)=>(Number(i[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,ht),a={};for(const[n,i]of s)a[n]=i;localStorage.setItem(Be,JSON.stringify(a))}catch(e){}};useEffect(()=>{D()},[]);const k=e=>{const s=b(e);if(!s)return null;const a=Array.isArray(L)?L:[];let n=null,i=-1;for(const f of a){if(!f||b(f.phone||"")!==s)continue;const A=new Date(f.created_at).getTime(),_=Number.isFinite(A)?A:0;_>=i&&(i=_,n=f)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},x=(e,s)=>{e&&be(a=>s&&b(a.phone)!==s?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},P=e=>{const s=k(e);if(!s)return;const a=b(e);be(n=>{if(a&&b(n.phone)!==a)return n;const i={...n};return!String(n.customer_name||"").trim()&&s.name&&(i.customer_name=s.name),!String(n.address||"").trim()&&s.address&&(i.address=s.address),i})},J=async e=>{var i,f,A;const s=b(e);if(!s)return;P(s);const a=(i=Ke.current)==null?void 0:i.get(s);if(a&&Number.isFinite(a.ts)){const _=Date.now()-a.ts,p=a.status==="found"?ne:Pe;if(_>=0&&_<=p){Q({status:a.status,phone:s,customer:a.customer}),a.status==="found"&&a.customer&&x(a.customer,s);return}}const n=++Te.current;Q({status:"loading",phone:s});try{const _=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(s)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Te.current!==n)return;if(_&&_.exists&&_.customer){(f=Ke.current)==null||f.set(s,{ts:Date.now(),status:"found",customer:_.customer}),K(),Q({status:"found",phone:s,customer:_.customer}),x(_.customer,s);return}(A=Ke.current)==null||A.set(s,{ts:Date.now(),status:"not-found",customer:null}),K(),Q({status:"not-found",phone:s})}catch(_){if(Te.current!==n)return;console.error("Customer lookup error:",_),Q({status:"error",phone:s})}},pe=e=>{const s=b(e),a=k(s);be(i=>{const f={...i,phone:s};return a&&(!String(i.customer_name||"").trim()&&a.name&&(f.customer_name=a.name),!String(i.address||"").trim()&&a.address&&(f.address=a.address)),f}),ye(!1),Se.current&&(clearTimeout(Se.current),Se.current=null);const n=s;if(n.length<Mt){Q(null);return}if(w(n)&&n!==tt.current){tt.current=n,J(n);return}Se.current=setTimeout(()=>{const i=b(s);w(i)&&i!==tt.current&&(tt.current=i,J(i))},Ct)},Z=()=>{const e=b(h.phone);e.length<Mt||w(e)&&e!==tt.current&&(tt.current=e,J(e))};useEffect(()=>(ae?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[ae]);const se=Array.isArray(h.items)?h.items.length:0;useEffect(()=>{if(!ae){ct.current=se;return}se>ct.current&&setTimeout(()=>{const e=ft.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),ct.current=se},[ae,se]),useEffect(()=>()=>{Se.current&&(clearTimeout(Se.current),Se.current=null)},[]),useEffect(()=>{te()},[]),useEffect(()=>{Me()},[ce]),useEffect(()=>{lt()},[]),useEffect(()=>{d&&et.current!==d&&(et.current=d,Qe(c))},[d]);const Re=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",Le=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",We=React.useMemo(()=>window.KTM.orders.sortOrders(L),[L]),z=React.useMemo(()=>window.KTM.orders.sortOrders(m),[m]),re=React.useMemo(()=>{const s=(Array.isArray(z)?z:[]).filter(a=>Oe(a));return s.sort((a,n)=>{const i=new Date(a==null?void 0:a.created_at).getTime(),f=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(f)?f:0)}),s},[z]),Ge=React.useMemo(()=>{const s=(Array.isArray(le)?le:[]).filter(a=>He(a));return s.sort((a,n)=>{const i=new Date(a==null?void 0:a.created_at).getTime(),f=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(f)?f:0)}),s},[le]),ot=React.useMemo(()=>v?re:We,[v,re,We]),rt=React.useMemo(()=>{if(v)return ot;const e=String(he||"").trim();return e?(Array.isArray(ot)?ot:[]).filter(s=>String((s==null?void 0:s.status)||"").trim()===e):ot},[ot,he,v]),Nt=e=>window.KTM.date.formatDateTime(e),te=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");E(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),E([])}},Me=async()=>{V(!0);try{let e=`${API_BASE}/api/orders`;ce&&(e+=`?month=${ce}`);const s=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");j(Array.isArray(s)?s:[]),lt()}catch(e){console.error("Load orders error:",e),j([])}finally{V(!1)}},lt=async()=>{G(!0),oe(!0);try{const[e,s]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(l)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(r)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);$(Array.isArray(e)?e:[]),R(Array.isArray(s)?s:[])}catch(e){console.error("Load all orders error:",e),$([]),R([])}finally{G(!1),oe(!1)}},Fe=e=>{var a;ke(e.id);const s=Array.isArray(e.items)&&e.items.length?e.items.map(n=>{var i;return{product_id:(n==null?void 0:n.product_id)||"",quantity:Number((i=n==null?void 0:n.quantity)!=null?i:1)||1}}).filter(n=>n.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];be({customer_name:e.customer_name||"",phone:b(e.phone||""),address:e.address||"",note:(e==null?void 0:e.note)||"",items:s.length?s:[{product_id:"",quantity:1}],adjustment_amount:Number((a=e==null?void 0:e.adjustment_amount)!=null?a:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),nt(new Array(s.length?s.length:1).fill("")),je(new Array(s.length?s.length:1).fill(!0)),Q(null),fe(!0),e.phone&&J(b(e.phone))};function Qe(e){ke(null),bt(e||""),ye(!1),je([]),fe(!0)}const De=()=>{U||de||(fe(!1),ke(null),bt(""),ye(!1),je([]))},Xe=async()=>{var _,p,S;if(!O||de||U)return;const e=(Array.isArray(L)?L:[]).find(C=>String(C==null?void 0:C.id)===String(O))||null,s=String((e==null?void 0:e.status)||(h==null?void 0:h.status)||"").trim();if(s==="done"||s==="paid"||s==="canceled"){const C="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof N=="function"?N(C,"warning"):alert(C);return}const a=b(h.phone),i=(Array.isArray(h.items)?h.items:[]).map((C,T)=>{var q;return{idx:T,product_id:String((C==null?void 0:C.product_id)||"").trim(),quantity:Number((q=C==null?void 0:C.quantity)!=null?q:0)}}).filter(C=>C.product_id&&Number.isFinite(C.quantity)&&C.quantity>0);if(i.length<2){const C="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof N=="function"?N(C,"warning"):alert(C);return}const f=[],A=[];for(const C of i){const T=!!ve[C.idx],q={product_id:C.product_id,quantity:C.quantity};T?f.push(q):A.push(q)}if(!f.length||!A.length){const C="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof N=="function"?N(C,"warning"):alert(C);return}ue(!0);try{const C=at(h.adjustment_amount),T=(h.adjustment_note||"").trim(),q={customer_name:h.customer_name,phone:a,address:h.address,note:(h.note||"").trim(),adjustment_amount:C,adjustment_note:T,status:"processing",items:f,product_id:f[0].product_id,quantity:f[0].quantity,split_seq:1},ge=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,q,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),xe=(S=(p=ge==null?void 0:ge.id)!=null?p:(_=ge==null?void 0:ge.order)==null?void 0:_.id)!=null?S:null;if(!xe)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const Ve={id:O,customer_name:h.customer_name,phone:a,address:h.address,note:(h.note||"").trim(),adjustment_amount:0,adjustment_note:"",status:"pending",items:A,product_id:A[0].product_id,quantity:A[0].quantity,parent_order_id:String(xe),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${O}`,Ve,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),De(),Me();const ze=xe?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${xe}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof N=="function"?N(ze,"success"):alert(ze)}catch(C){console.error(C);const T=(C==null?void 0:C.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof N=="function"?N(T,"danger"):alert(T)}finally{ue(!1)}},gt=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const s=String(e),a=u.find(n=>String(n==null?void 0:n.id)===s);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},it=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(s){return String(e!=null?e:"").toLowerCase()}},At=e=>{const a=it(e).trim().split(/\s+/).filter(Boolean),n=a.join(" ");return{contentTokens:a,cleanedQuery:n}},It=React.useMemo(()=>(Array.isArray(u)?u:[]).map((e,s)=>{var S,C,T,q,ge,xe;const a=it((S=e==null?void 0:e.name)!=null?S:""),n=it((C=e==null?void 0:e.code)!=null?C:""),i=it((T=e==null?void 0:e.category)!=null?T:""),f=it((q=e==null?void 0:e.note)!=null?q:""),A=it((ge=e==null?void 0:e.id)!=null?ge:""),_=it((xe=e==null?void 0:e.stt)!=null?xe:""),p=`${a} ${n} ${i} ${f} ${A} ${_}`.trim();return{p:e,originalIndex:s,name:a,code:n,category:i,note:f,haystackAll:p}}),[u]),Ae=(e,s,a)=>{var T,q,ge,xe,Ve;const n=Array.isArray(s)?s:[],i=it(a).trim();if(!n.length&&!i)return 0;const f=(T=e==null?void 0:e.name)!=null?T:"",A=(q=e==null?void 0:e.code)!=null?q:"",_=(ge=e==null?void 0:e.category)!=null?ge:"",p=(xe=e==null?void 0:e.note)!=null?xe:"";if(!((Ve=e==null?void 0:e.haystackAll)!=null?Ve:""))return 0;let C=0;i&&(f===i&&(C+=220),f.includes(i)&&(C+=140),f.startsWith(i)&&(C+=160),A&&A===i&&(C+=180),A&&A.includes(i)&&(C+=90));for(const ze of n){if(!ze)continue;const ut=new RegExp(`(?:^|\\s)${ze.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);f.includes(ze)&&(C+=35),ut.test(f)&&(C+=25),A&&A.includes(ze)&&(C+=20),A&&ut.test(A)&&(C+=10),_&&_.includes(ze)&&(C+=12),p&&p.includes(ze)&&(C+=6)}return C>0&&f&&(C+=Math.max(0,10-Math.min(10,Math.floor(f.length/10)))),C},Ye=(e,s)=>{const a=String(e||""),n=String(s||"");if(a===n)return 0;if(!a)return n.length;if(!n)return a.length;const i=a.length,f=n.length;if(f>i)return Ye(n,a);let A=new Array(f+1),_=new Array(f+1);for(let p=0;p<=f;p++)A[p]=p;for(let p=1;p<=i;p++){_[0]=p;const S=a.charCodeAt(p-1);for(let T=1;T<=f;T++){const q=S===n.charCodeAt(T-1)?0:1;_[T]=Math.min(A[T]+1,_[T-1]+1,A[T-1]+q)}const C=A;A=_,_=C}return A[f]},yt=(e,s)=>{const a=String(e||"").trim(),n=String(s||"");if(!a||!n)return!1;if(n.includes(a))return!0;const i=n.split(/\s+/).filter(Boolean);if(!i.length)return!1;const f=a.length<=4?1:2;for(const A of i)if(!(Math.abs(A.length-a.length)>f)&&Ye(a,A)<=f)return!0;return!1},dt=e=>{const s=it(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return s?s.split(" ").filter(Boolean):[]},mt=(e,s)=>{const a=Array.isArray(s)?s:[];if(!a.length)return 0;const n=dt((e==null?void 0:e.name)||""),i=dt((e==null?void 0:e.code)||""),f=dt((e==null?void 0:e.category)||""),A=dt((e==null?void 0:e.note)||""),_=(S,C,T)=>{const q=String(S||"").trim();if(!q||!C.length)return 0;const ge=q.length<=4?1:2;let xe=1/0,Ve=-1;for(let st=0;st<C.length;st++){const pt=C[st];if(!pt||Math.abs(pt.length-q.length)>ge)continue;const xt=Ye(q,pt);if(xt<xe&&(xe=xt,Ve=st,xt===0))break}if(xe===1/0||xe>ge)return 0;let ut=Math.round(T*(xe===0?1:xe===1?.65:.45));return Ve===0?ut+=Math.round(T*.25):Ve===1&&(ut+=Math.round(T*.12)),ut};let p=0;for(const S of a){if(!S)continue;const C=_(S,n,180),T=_(S,i,120),q=_(S,f,60),ge=_(S,A,30);p+=Math.max(C,T,q,ge)}if(p>0){const S=((e==null?void 0:e.name)||"").length;p+=Math.max(0,60-Math.min(60,Math.floor(S/2)))}return p},Ot=React.useRef(new Map);React.useEffect(()=>{Ot.current=new Map},[u]);const Rt=e=>{var S,C;const s=String(Ue[e]||"").trim();if(!s)return u;const{contentTokens:a,cleanedQuery:n}=At(s);if(a.length===0)return u;const i=it(s).trim(),f=Ot.current.get(i);if(f)return f;const A=[];for(const T of It){const q=T.haystackAll;q&&a.some(ge=>q.includes(ge))&&A.push(T)}let _=A;if(_.length<8&&a.length>0){const T=[],q=new Set(_.map(ge=>{var xe,Ve;return String((Ve=(xe=ge.p)==null?void 0:xe.id)!=null?Ve:"")+":"+String(ge.originalIndex)}));for(const ge of It){const xe=String((C=(S=ge.p)==null?void 0:S.id)!=null?C:"")+":"+String(ge.originalIndex);if(q.has(xe))continue;const Ve=ge.haystackAll;Ve&&a.some(ze=>yt(ze,Ve))&&(T.push(ge),q.add(xe))}T.length&&(_=_.concat(T))}const p=_.map(T=>({entry:T,score:Ae(T,a,n)})).map(T=>{if(T.score>0)return T;const q=mt(T.entry,a);return q>0?{...T,score:q}:T}).filter(T=>T.score>0).sort((T,q)=>q.score!==T.score?q.score-T.score:T.entry.originalIndex-q.entry.originalIndex).slice(0,40).map(T=>T.entry.p);return Ot.current.set(i,p),p},kt=e=>{if(!e)return null;const s=String(e);return u.find(a=>String(a==null?void 0:a.id)===s)||null},St=e=>window.KTM.orders.getOrderItems(e),Qt=e=>window.KTM.orders.getOrderTotalQty(e),Lt=e=>window.KTM.orders.getOrderProductSummary(e,kt),Kt=e=>window.KTM.orders.getOrderItemRows(e,kt),Pt=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Xt=e=>{var S;const s=St(e),a=Kt(e),n=jt(s),i=Dt(s),f=i.fee,A=Pt(e),_=n+f+A,p=[];if(p.push(`\u0110\u01A0N H\xC0NG #${(S=e==null?void 0:e.id)!=null?S:""}`.trim()),e!=null&&e.customer_name&&p.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&p.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&p.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&p.push(`Ghi ch\xFA: ${(e.note||"").trim()}`),e!=null&&e.status&&p.push(`Tr\u1EA1ng th\xE1i: ${Re(e.status)}`),e!=null&&e.created_at&&p.push(`Th\u1EDDi gian: ${Nt(e.created_at)}`),p.push(""),p.push("S\u1EA3n ph\u1EA9m:"),a.length)for(const C of a)p.push(`- ${C.name} (SL: ${C.qty})`);else{const C=Lt(e);C&&C!=="\u2014"&&p.push(`- ${C}`)}return p.push(""),p.push(`T\u1EA1m t\xEDnh: ${we(n)}`),p.push(`Ship: ${we(i.found?f:0)}`),A!==0&&p.push(`\u0110i\u1EC1u ch\u1EC9nh: ${we(A)}`),e!=null&&e.adjustment_note&&p.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),p.push(`T\u1ED5ng: ${we(_)}`),p.filter(Boolean).join(`
`)},Ft=async e=>{try{const s=Xt(e);await window.KTM.clipboard.writeText(s),typeof N=="function"?N("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(s){console.error(s),typeof N=="function"?N("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Dt=e=>window.KTM.orders.getOrderShipInfo(e,kt),jt=e=>window.KTM.orders.getItemsSubtotal(e,kt),Et=e=>{try{const s=e instanceof Date?e:new Date(e);if(!s||Number.isNaN(s.getTime()))return"";const a=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0");return`${a}-${n}`}catch(s){return""}},qt=()=>ce?String(ce):Et(new Date),Vt=e=>{const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=b((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=at(e==null?void 0:e.adjustment_amount),A=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(_=>{var p;return{product_id:String((_==null?void 0:_.product_id)||"").trim(),quantity:Number((p=_==null?void 0:_.quantity)!=null?p:0)}}).filter(_=>_.product_id&&Number.isFinite(_.quantity)&&_.quantity>0).sort((_,p)=>_.product_id<p.product_id?-1:_.product_id>p.product_id?1:_.quantity-p.quantity);return JSON.stringify({name:s,phone:a,address:n,items:A,adj:i})},wt=React.useMemo(()=>{const e=b((h==null?void 0:h.phone)||"");if(!e)return{count:0,orders:[],monthKey:qt()};const s=qt(),a=(Array.isArray(L)?L:[]).filter(n=>{if(!n||O&&String(n.id)===String(O)||b(n.phone||"")!==e)return!1;const i=Et(n.created_at);return i&&i===s}).sort((n,i)=>{const f=new Date(n.created_at).getTime(),A=new Date(i.created_at).getTime();return(Number.isFinite(A)?A:0)-(Number.isFinite(f)?f:0)});return{count:a.length,orders:a,monthKey:s}},[L,h==null?void 0:h.phone,ce,O]),Yt=e=>{var _;const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=b((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=at((_=e==null?void 0:e.adjustment_amount)!=null?_:0),f=St(e),A=(Array.isArray(f)?f:[]).map(p=>{var S;return{product_id:String((p==null?void 0:p.product_id)||"").trim(),quantity:Number((S=p==null?void 0:p.quantity)!=null?S:0)}}).filter(p=>p.product_id&&Number.isFinite(p.quantity)&&p.quantity>0).sort((p,S)=>p.product_id<S.product_id?-1:p.product_id>S.product_id?1:p.quantity-S.quantity);return JSON.stringify({name:s,phone:a,address:n,items:A,adj:i})},zt=React.useMemo(()=>{if(O)return"";const e=b((h==null?void 0:h.phone)||"");if(!e)return"";const s=qt(),a=Vt(h),n=Array.isArray(L)?L:[];for(const i of n){if(!i||O&&String(i.id)===String(O)||b(i.phone||"")!==e)continue;const f=Et(i.created_at);if(!f||f!==s)continue;const A=Yt(i);if(A&&A===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${s}${i!=null&&i.id?` (#${i.id})`:""}`}return""},[L,h,ce,O]),Ut=e=>{var ut;const s=[],a=[],n=String((e==null?void 0:e.customer_name)||"").trim(),i=b((e==null?void 0:e.phone)||""),f=String((e==null?void 0:e.address)||"").trim();n||s.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),i||s.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),i&&!w(i)&&s.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),f||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const _=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(st=>st&&st.product_id);_.length===0&&s.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),_.some(st=>{var xt;const pt=Number((xt=st==null?void 0:st.quantity)!=null?xt:0);return!Number.isFinite(pt)||pt<=0})&&s.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const S=new Set;let C=!1;for(const st of _){const pt=String(st.product_id||"").trim();if(pt){if(S.has(pt)){C=!0;break}S.add(pt)}}C&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const T=jt(_),q=Dt(_),ge=q!=null&&q.found?Number((ut=q==null?void 0:q.fee)!=null?ut:0):0,xe=at(e==null?void 0:e.adjustment_amount),Ve=String((e==null?void 0:e.adjustment_note)||"").trim();q!=null&&q.found&&(ge>=2e5||T>0&&ge>T*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${we(ge)}`),xe!==0&&!Ve&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const ze=Math.abs(xe);return(ze>=5e5||T>0&&ze>T*.5)&&xe!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${we(xe)}`),{errors:s,warnings:a,canSubmit:s.length===0}},aa=React.useMemo(()=>Ut(h),[h,u]),Je=React.useMemo(()=>{var xt;const e=String((h==null?void 0:h.customer_name)||"").trim(),s=b((h==null?void 0:h.phone)||""),a=String((h==null?void 0:h.address)||"").trim(),n=Array.isArray(h==null?void 0:h.items)?h.items:[],i=new Map;for(const Ze of n){const Tt=String((Ze==null?void 0:Ze.product_id)||"").trim();Tt&&i.set(Tt,(i.get(Tt)||0)+1)}const f=n.map(Ze=>{var Gt;const Tt=String((Ze==null?void 0:Ze.product_id)||"").trim(),Wt=Number((Gt=Ze==null?void 0:Ze.quantity)!=null?Gt:0),Zt=Tt?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",ea=Number.isFinite(Wt)&&Wt>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",ta=Tt&&(i.get(Tt)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Zt,qtyError:ea,dupWarn:ta}}),A=n.filter(Ze=>Ze&&Ze.product_id),_=jt(A),p=Dt(A),S=p!=null&&p.found?Number((xt=p==null?void 0:p.fee)!=null?xt:0):0,C=at(h==null?void 0:h.adjustment_amount),T=String((h==null?void 0:h.adjustment_note)||"").trim(),q=Math.abs(C),ge=C!==0&&!T?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",xe=C!==0&&(q>=5e5||_>0&&q>_*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${we(C)}`:"",Ve=p!=null&&p.found&&(S>=2e5||_>0&&S>_*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${we(S)}`:"",ze=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",ut=s?w(s)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",st=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",pt=!ze&&!ut&&f.every(Ze=>!Ze.productError&&!Ze.qtyError);return{nameError:ze,phoneError:ut,addressWarn:st,items:f,shipAbnormalWarn:Ve,adjustmentNoteWarn:ge,adjustmentAbnormalWarn:xe,canSubmit:pt}},[h,u]),Jt=async e=>{var A,_,p;const s=(e==null?void 0:e.mode)||"close",a=Ut(h);if(!a.canSubmit){const S=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof N=="function"?N(S,"danger"):alert(S);return}if(!O&&zt){const S=`${zt}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(S)){(wt==null?void 0:wt.count)>0&&ye(!0),setTimeout(()=>{var q;const T=document.getElementById("order-phone-input");T&&typeof T.scrollIntoView=="function"&&(T.scrollIntoView({block:"center",behavior:"smooth"}),(q=T.focus)==null||q.call(T))},0);return}}const n=b(h.phone),f=(Array.isArray(h.items)?h.items:[]).map(S=>{var C;return{product_id:(S==null?void 0:S.product_id)||"",quantity:Number((C=S==null?void 0:S.quantity)!=null?C:1)}}).filter(S=>S.product_id&&Number.isFinite(S.quantity)&&S.quantity>0);B(!0);try{const S=O?`${API_BASE}/api/orders/${O}`:`${API_BASE}/api/orders`,C=f[0],T={customer_name:h.customer_name,phone:n,address:h.address,note:(h.note||"").trim(),adjustment_amount:at(h.adjustment_amount),adjustment_note:(h.adjustment_note||"").trim(),product_id:C.product_id,quantity:C.quantity,status:h.status,items:f,...O?{id:O}:{}};if(O)await window.KTM.api.putJSON(S,T,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const q=await window.KTM.api.postJSON(S,T,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");$t.current={id:(p=(_=q==null?void 0:q.id)!=null?_:(A=q==null?void 0:q.order)==null?void 0:A.id)!=null?p:null,fingerprint:Vt(h),ts:Date.now()}}s==="new"&&!O?(bt(""),ke(null),fe(!0)):(bt(""),ke(null),fe(!1)),Me()}catch(S){console.error(S),typeof N=="function"?N(S.message,"danger"):alert(S.message);return}finally{B(!1)}},Ht=e=>window.KTM.orders.getOrderTotalMoney(e,kt),Bt=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){ie(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Me(),lt()}catch(s){console.error(s),typeof N=="function"?N(s.message,"danger"):alert(s.message)}finally{ie(null)}}},_t=async(e,s)=>{var n;const a=e==null?void 0:e.id;if(!(!a||!s)){Ne(a);try{const i=St(e),f=(Array.isArray(i)?i:[]).map(p=>{var S;return{product_id:(p==null?void 0:p.product_id)||"",quantity:Number((S=p==null?void 0:p.quantity)!=null?S:1)}}).filter(p=>p.product_id&&Number.isFinite(p.quantity)&&p.quantity>0);if(!f.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const A=f[0],_={id:a,customer_name:(e==null?void 0:e.customer_name)||"",phone:b((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",note:((e==null?void 0:e.note)||"").trim(),adjustment_amount:Number((n=e==null?void 0:e.adjustment_amount)!=null?n:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:A.product_id,quantity:A.quantity,status:s,items:f};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${a}`,_,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),j(p=>Array.isArray(p)?p.map(S=>(S==null?void 0:S.id)===a?{...S,status:s}:S):p),$(p=>Array.isArray(p)?p.map(S=>(S==null?void 0:S.id)===a?{...S,status:s}:S):p),typeof N=="function"&&N("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(i){console.error(i),typeof N=="function"?N(i.message,"danger"):alert(i.message)}finally{Ne(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:H&&!ae||U||!!F||!!X}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Qe,disabled:U||!!F},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:ce,onChange:e=>M(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:v}),ce&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{M("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:H},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:he,onChange:e=>Y(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:v},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),he&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Y(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:H},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:v,onChange:e=>{const s=!!e.target.checked;ee(s),s&&Y("pending")}}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",l," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Me,disabled:H},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},he?`${rt.length}/${L.length} \u0111\u01A1n`:`${L.length} \u0111\u01A1n`)),re.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,re.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",l," ng\xE0y.",I&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ee(!0),Y("pending")}},"Xem ngay")),Ge.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,Ge.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",r," ng\xE0y).",W&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ee(!1),Y("draft"),M(""),Me()}},"Xem ngay")),H?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):L.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):rt.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},rt.map(e=>{var s;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((s=e==null?void 0:e.split_seq)!=null?s:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${Le(e.status)}`},Re(e.status)),Oe(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${l} ng\xE0y`},"\u26A0 Ch\u1EADm ",$e(e),"d"),He(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${y} ng\xE0y`},"\u23F3 C\xF2n ",qe(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=Kt(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((n,i)=>React.createElement("div",{key:i,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${we(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Lt(e))})()),(Pt(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},we(Pt(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},we(Ht(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",Nt(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary flex-fill",onClick:()=>Fe(e),disabled:U||!!F||X===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>Ft(e),disabled:U||!!F||X===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger flex-fill",onClick:()=>Bt(e.id),disabled:U||F===e.id||X===e.id},F===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>_t(e,"processing"),disabled:U||!!F||X===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>_t(e,"done"),disabled:U||!!F||X===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>_t(e,"paid"),disabled:U||!!F||X===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:()=>_t(e,"canceled"),disabled:U||!!F||X===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,rt.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const s=Kt(e);return s.length?React.createElement("div",{className:"d-grid gap-1"},s.map((a,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",we(a.unitPrice))))):Lt(e)})()),React.createElement("td",null,Qt(e)),React.createElement("td",{className:"fw-semibold"},we(Ht(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${Le(e.status)}`},Re(e.status)),Oe(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${l} ng\xE0y`},"\u26A0 Ch\u1EADm ",$e(e),"d"),He(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${y} ng\xE0y`},"\u23F3 C\xF2n ",qe(e),"d"))),React.createElement("td",null,Nt(e.created_at)),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary me-1",onClick:()=>Fe(e),disabled:U||!!F||X===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>Ft(e),disabled:U||!!F||X===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>_t(e,"processing"),disabled:U||!!F||X===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>_t(e,"done"),disabled:U||!!F||X===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>_t(e,"paid"),disabled:U||!!F||X===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:()=>_t(e,"canceled"),disabled:U||!!F||X===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>Bt(e.id),disabled:U||F===e.id},F===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))))))),ae&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),O?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:De})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Jt({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:ft},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:h.customer_name,onChange:e=>be({...h,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Je.nameError&&React.createElement("div",{className:"form-text text-danger"},Je.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:h.phone,onChange:e=>pe(e.target.value),onBlur:Z,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Je.phoneError&&React.createElement("div",{className:"form-text text-danger"},Je.phoneError),!Je.phoneError&&wt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",wt.count," \u0111\u01A1n trong th\xE1ng ",wt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>ye(e=>!e)},Ie?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),Ie&&wt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ye(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},wt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Le(e.status)}`},Re(e.status))),React.createElement("div",{className:"text-muted small"},Nt(e.created_at)," \u2022 ",we(Ht(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Lt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Fe(e)}},"M\u1EDF")))),wt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(me==null?void 0:me.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(me==null?void 0:me.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(me==null?void 0:me.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(me==null?void 0:me.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:h.status,onChange:e=>be({...h,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:h.address,onChange:e=>be({...h,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Je.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Je.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:h.note,onChange:e=>be({...h,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:h.adjustment_amount,onChange:e=>be({...h,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Je.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Je.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:h.adjustment_note,onChange:e=>be({...h,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!Je.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Je.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{be(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),nt(e=>[...Array.isArray(e)?e:[],""]),O&&je(e=>[...Array.isArray(e)?e:[],!0])},disabled:U},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(h.items)?h.items:[{product_id:"",quantity:1}]).map((e,s)=>React.createElement("div",{key:s,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{Ce.current[s]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{g(a=>a===s?null:s),setTimeout(()=>{const a=document.getElementById(`order-product-search-${s}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},gt(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),o===s&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${s}`,className:"form-control",value:Ue[s]||"",onChange:a=>{const n=a.target.value;nt(i=>{const f=Array.isArray(i)?[...i]:[];return f[s]=n,f})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=Rt(s);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(n.id);be(f=>{const A=Array.isArray(f.items)?[...f.items]:[];return A[s]={...A[s]||{quantity:1},product_id:i},{...f,items:A}}),g(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),u.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var n;const a=(n=Je.items)==null?void 0:n[s];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),O&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${s}`,checked:!!ve[s],onChange:a=>{const n=!!a.target.checked;je(i=>{const f=Array.isArray(i)?[...i]:[],A=Array.isArray(h.items)?h.items.length:0;for(;f.length<A;)f.push(!0);return f[s]=n,f})},disabled:U||de}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${s}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const n=a.target.value;be(i=>{const f=Array.isArray(i.items)?[...i.items]:[];return f[s]={...f[s]||{product_id:""},quantity:n},{...i,items:f}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const a=(n=Je.items)==null?void 0:n[s];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{be(a=>{const n=Array.isArray(a.items)?[...a.items]:[];return n.splice(s,1),{...a,items:n.length?n:[{product_id:"",quantity:1}]}}),nt(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(s,1),n.length?n:[""]}),je(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(s,1),n}),g(a=>a==null?a:a===s?null:a>s?a-1:a)},disabled:U||de||(Array.isArray(h.items)?h.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const s=(Array.isArray(h.items)?h.items:[]).filter(A=>A==null?void 0:A.product_id),a=jt(s),n=Dt(s),i=at(h.adjustment_amount),f=a+(n.found?n.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},we(a))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},we(n.fee))),!!Je.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Je.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},we(i))),(h.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(h.note||"").trim()),(h.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",(h.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},we(f)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:De,disabled:U||de,style:{borderRadius:10}},"H\u1EE7y"),!!O&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:Xe,disabled:U||de,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},de?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!O&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Jt({mode:"new"}),disabled:U||!Je.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:U||de||!Je.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},U?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

