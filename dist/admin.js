const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:$,error:E}){const[F,ye]=useState(""),[re,W]=useState(""),[X,Ee]=useState(!1),[je,ke]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),E&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),E),React.createElement("form",{onSubmit:async st=>{st.preventDefault(),Ee(!0),await $(F,re),Ee(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:F,onChange:st=>ye(st.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:je?"text":"password",className:"form-control",value:re,onChange:st=>W(st.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ke(!je)},React.createElement("i",{className:`fas fa-eye${je?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:$,type:E,onClose:F,actionLabel:ye,onAction:re,durationMs:W}){return useEffect(()=>{const X=Number(W),Ee=Number.isFinite(X)&&X>0?X:3e3,je=setTimeout(F,Ee);return()=>clearTimeout(je)},[F,W]),React.createElement("div",{className:`toast show align-items-center text-white bg-${E} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},$),ye&&typeof re=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{re()}finally{F()}}},ye),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:F})))}function Loading({show:$}){return $?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:$,title:E,subtitle:F,onClose:ye,footer:re,children:W}){return useEffect(()=>{if(!$)return;const X=Ee=>{Ee.key==="Escape"&&(Ee.preventDefault(),typeof ye=="function"&&ye())};return document.addEventListener("keydown",X),()=>document.removeEventListener("keydown",X)},[$,ye]),$?React.createElement("div",{className:`admin-drawer-root ${$?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:ye,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},E),F?React.createElement("div",{className:"admin-drawer-subtitle"},F):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:ye,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},W),re?React.createElement("div",{className:"admin-drawer-footer"},re):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage($){try{const E=localStorage.getItem($);if(!E)return[];const F=JSON.parse(E);return Array.isArray(F)?F.map(ye=>String(ye||"").trim()).filter(Boolean):[]}catch(E){return[]}}function saveAdminMenuIdsToStorage($,E){try{localStorage.setItem($,JSON.stringify(Array.isArray(E)?E:[]))}catch(F){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins($){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,$),$}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent($){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,$),$}function Sidebar({activeMenu:$,onMenuChange:E,onLogout:F,currentUser:ye,pinnedMenus:re,recentMenus:W,onTogglePin:X}){const Ee=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"recon",icon:"fa-file-excel",label:"\u0110\u1ED1i so\xE1t Excel"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],je=(ye==null?void 0:ye.username)||(ye==null?void 0:ye.name)||(ye==null?void 0:ye.email)||"Admin",ke=useMemo(()=>{const Ke=new Map;for(const K of Ee)Ke.set(K.id,K);return Ke},[]),Ge=Array.isArray(re)?re:[],st=Array.isArray(W)?W:[],Fe=Ge.map(Ke=>ke.get(Ke)).filter(Boolean),ze=st.filter(Ke=>Ke!==$).map(Ke=>ke.get(Ke)).filter(Boolean).slice(0,5),ne=Ke=>Ge.includes(Ke);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},je),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},Fe.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},Fe.map(Ke=>React.createElement("a",{key:`pin-${Ke.id}`,href:"#",className:`nav-link ${$===Ke.id?"active":""} sidebar-quicklink`,onClick:K=>{K.preventDefault(),E(Ke.id)}},React.createElement("i",{className:`fas ${Ke.icon}`})," ",Ke.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:K=>{K.preventDefault(),K.stopPropagation(),X&&X(Ke.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),ze.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},ze.map(Ke=>React.createElement("a",{key:`recent-${Ke.id}`,href:"#",className:`nav-link ${$===Ke.id?"active":""} sidebar-quicklink`,onClick:K=>{K.preventDefault(),E(Ke.id)}},React.createElement("i",{className:`fas ${Ke.icon}`})," ",Ke.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),Ee.map(Ke=>React.createElement("a",{key:Ke.id,href:"#",className:`nav-link ${$===Ke.id?"active":""} ${Ke.disabled?"opacity-50":""} ${Ke.highlight?"text-warning":""}`,onClick:K=>{K.preventDefault(),Ke.disabled||E(Ke.id)}},React.createElement("i",{className:`fas ${Ke.icon}`})," ",Ke.label,Ke.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),Ke.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${ne(Ke.id)?"pinned":""}`,onClick:K=>{K.preventDefault(),K.stopPropagation(),X&&X(Ke.id)},title:ne(Ke.id)?"B\u1ECF ghim":"Ghim","aria-label":ne(Ke.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),F&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:F,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent($){const E=typeof $=="number"?$:parseFloat(String($!=null?$:"").trim());return Number.isFinite(E)?Math.max(0,Math.min(100,E)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var $;try{const E=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!E)return{ship_percent:DEFAULT_SHIP_PERCENT};const F=JSON.parse(E);return{ship_percent:normalizeShipPercent(($=F==null?void 0:F.ship_percent)!=null?$:F==null?void 0:F.shipPercent)}}catch(E){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings($){var E;try{const F={ship_percent:normalizeShipPercent((E=$==null?void 0:$.ship_percent)!=null?E:$==null?void 0:$.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(F)),F}catch(F){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var E;const $=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((E=$==null?void 0:$.ship_percent)!=null?E:$==null?void 0:$.shipPercent)}}async function saveAdminSettingsToServer($){var ye,re,W;const E={ship_percent:normalizeShipPercent((ye=$==null?void 0:$.ship_percent)!=null?ye:$==null?void 0:$.shipPercent)},F=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,E,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((W=(re=F==null?void 0:F.ship_percent)!=null?re:F==null?void 0:F.shipPercent)!=null?W:E.ship_percent)}}function AlbumList({albums:$,onSelect:E,onCreate:F,onEdit:ye,onDelete:re,loading:W,currentFolder:X,onBack:Ee,breadcrumb:je}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},X&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:Ee},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),X?X.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:F},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),je&&je.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:ke=>{ke.preventDefault(),Ee("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),je.map((ke,Ge)=>React.createElement("li",{key:ke.id,className:`breadcrumb-item ${Ge===je.length-1?"active":""}`},Ge===je.length-1?ke.title:React.createElement("a",{href:"#",onClick:st=>{st.preventDefault(),Ee(ke)},className:"text-warning"},ke.title))))),W?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):$.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},X?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},$.map(ke=>React.createElement("div",{key:ke.uuid||ke.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>E(ke)},ke.cover?React.createElement("img",{src:ke.cover,className:"album-cover",alt:ke.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},ke.title),React.createElement("small",{className:"text-muted"},ke.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),ke.subfolderCount),ke.subfolderCount>0&&ke.count>0&&" \u2022 ",ke.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),ke.count),ke.subfolderCount===0&&ke.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Ge=>{Ge.stopPropagation(),ye(ke)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Ge=>{Ge.stopPropagation(),re(ke)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:$,album:E,onClose:F,onSave:ye,parentId:re}){const[W,X]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[Ee,je]=useState(!1),[ke,Ge]=useState(!1),st=useRef(null);useEffect(()=>{X(E?{slug:E.id||"",title:E.title||"",description:E.description||"",cover_url:E.cover||"",parent_id:E.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:re||null})},[E,$,re]);const Fe=async K=>{K.preventDefault(),je(!0),await ye(W),je(!1)},ze=K=>K.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),ne=async K=>{const gt=K.type==="image/heic"||K.type==="image/heif"||/\.heic$/i.test(K.name);if(K.size<=2097152&&!gt)return K;try{const wt=await createImageBitmap(K),Ve=document.createElement("canvas");let nt=wt.width,Ie=wt.height;const yt=800;return(nt>yt||Ie>yt)&&(nt>Ie?(Ie=Math.round(Ie/nt*yt),nt=yt):(nt=Math.round(nt/Ie*yt),Ie=yt)),Ve.width=nt,Ve.height=Ie,Ve.getContext("2d").drawImage(wt,0,0,nt,Ie),wt.close(),new Promise((tn,et)=>{Ve.toBlob(Dt=>{Dt?tn(new File([Dt],K.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):et(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(wt){throw console.error("Compress cover error:",wt),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ke=async K=>{var wt;const it=K.target.files[0];if(!it)return;if(!(it.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(it.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ge(!0);try{const Ve=await ne(it),nt=await window.KTM.cloudinary.uploadImage({file:Ve,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!nt.secure_url)throw console.error("Cloudinary error:",nt),new Error(((wt=nt.error)==null?void 0:wt.message)||"Upload failed");X(Ie=>({...Ie,cover_url:nt.secure_url}))}catch(Ve){console.error("Cover upload error:",Ve),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Ve.message)}Ge(!1),K.target.value=""};return $?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},E?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:F})),React.createElement("form",{onSubmit:Fe},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:W.title,onChange:K=>X({...W,title:K.target.value,slug:W.slug||ze(K.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:W.slug,onChange:K=>X({...W,slug:K.target.value}),required:!0,disabled:!!E}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:W.description,onChange:K=>X({...W,description:K.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},W.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:W.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>X(K=>({...K,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:st,type:"file",accept:"image/*",className:"d-none",onChange:Ke}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var K;return(K=st.current)==null?void 0:K.click()},disabled:ke},ke?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:W.cover_url,onChange:K=>X({...W,cover_url:K.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:F},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:Ee||ke},Ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:$,allAlbums:E,currentAlbumId:F,targetAlbum:ye,onSelect:re,level:W=0}){const[X,Ee]=useState(!0),je=$.uuid||$.id,ke=je===F,Ge=ye===je,st=E.filter(ze=>ze.parentId===je),Fe=st.length>0;return React.createElement("div",{style:{marginLeft:W*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Ge?"bg-info text-white":ke?"bg-light text-muted":"hover-bg"}`,style:{cursor:ke?"not-allowed":"pointer",opacity:ke?.5:1,transition:"background 0.2s"},onClick:()=>!ke&&re(je)},Fe&&React.createElement("i",{className:`fas fa-chevron-${X?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:ze=>{ze.stopPropagation(),Ee(!X)}}),!Fe&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Ge?"-open":""} me-2 ${Ge?"":"text-warning"}`}),React.createElement("span",{className:"small"},$.title),ke&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),$.count>0&&!ke&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},$.count)),X&&Fe&&React.createElement("div",null,st.map(ze=>React.createElement(FolderTreeItem,{key:ze.uuid||ze.id,folder:ze,allAlbums:E,currentAlbumId:F,targetAlbum:ye,onSelect:re,level:W+1}))))}function AlbumDetail({album:$,onBack:E,onRefresh:F,showToast:ye,onNavigateToFolder:re,onEditSubfolder:W,parentAlbum:X}){const[Ee,je]=useState([]),[ke,Ge]=useState([]),[st,Fe]=useState(!0),[ze,ne]=useState(!1),[Ke,K]=useState(""),[it,gt]=useState([]),[wt,Ve]=useState([]),[nt,Ie]=useState({}),[yt,Rt]=useState(null),[tn,et]=useState(!1),[Dt,Pt]=useState(""),[M,C]=useState(!1),z=useRef(null),be=useRef(null),[ve,le]=useState(!1),[de,Te]=useState([]),[x,q]=useState([]),[U,oe]=useState(""),[Me,Ae]=useState(!1),Qe=async(j,d=2)=>{const V=d*1024*1024,ae=j.type==="image/heic"||j.type==="image/heif"||/\.heic$/i.test(j.name);if(j.size<=V&&!ae)return j;try{const Re=await createImageBitmap(j),Pe=document.createElement("canvas");let Je=Re.width,vt=Re.height;const Ze=1200;return(Je>Ze||vt>Ze)&&(Je>vt?(vt=Math.round(vt/Je*Ze),Je=Ze):(Je=Math.round(Je/vt*Ze),vt=Ze)),Pe.width=Je,Pe.height=vt,Pe.getContext("2d").drawImage(Re,0,0,Je,vt),Re.close(),new Promise((qt,Gt)=>{Pe.toBlob(on=>{on?qt(new File([on],j.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Gt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Re){throw console.error("Compress error:",Re),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{Ue(),St()},[$.id,$.uuid]);const Ue=async()=>{Fe(!0);try{const j=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${$.uuid||$.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");je(j.images||[]);const d=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${$.uuid||$.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Ge(Array.isArray(d)?d:[])}catch(j){console.error(j),ye("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}Fe(!1)},St=async()=>{try{const j=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");q(Array.isArray(j)?j:[])}catch(j){console.error("Error loading albums:",j)}},It=j=>{Te(d=>d.includes(j)?d.filter(V=>V!==j):[...d,j])},_e=async()=>{if(!U||de.length===0){ye("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}Ae(!0);let j=0;for(const d of de)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${d}`,{album_id:U},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),j++}catch(V){console.error("Move error:",V)}Ae(!1),le(!1),Te([]),oe(""),j>0?(ye("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),Ue(),F()):ye("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[lt,Yt]=useState(!1),Ct=async()=>{if(de.length===0||!confirm(`X\xF3a ${de.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Yt(!0);let j=0;for(const d of de)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${d}`,"L\u1ED7i x\xF3a \u1EA3nh"),j++}catch(V){console.error("Delete error:",V)}Yt(!1),Te([]),j>0?(ye(`\u0110\xE3 x\xF3a ${j} \u1EA3nh!`,"success"),Ue(),F()):ye("X\xF3a th\u1EA5t b\u1EA1i","danger")},Wt=()=>{de.length===Ee.length?Te([]):Te(Ee.map(j=>j.id))},Bt=async()=>{if(Dt.trim()){C(!0);try{const j=Dt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:j+"-"+Date.now(),title:Dt,parent_id:$.uuid||$.id},"L\u1ED7i t\u1EA1o folder"),ye("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Pt(""),et(!1),Ue(),F()}catch(j){ye(j.message,"danger")}C(!1)}},yn=async j=>{if(confirm(`X\xF3a folder "${j.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${j.uuid||j.id}`,"L\u1ED7i x\xF3a folder"),ye("\u0110\xE3 x\xF3a folder","success"),Ue(),F()}catch(d){ye("L\u1ED7i x\xF3a folder","danger")}},pn=j=>{const d=Array.from(j).filter(V=>V.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(V.name));gt(V=>[...V,...d]),d.forEach(V=>{const ae=new FileReader;ae.onload=Re=>{Ve(Pe=>[...Pe,{file:V,preview:Re.target.result}])},ae.readAsDataURL(V)})},R=j=>{gt(d=>d.filter((V,ae)=>ae!==j)),Ve(d=>d.filter((V,ae)=>ae!==j))},Y=async j=>{var V;const d=await window.KTM.cloudinary.uploadImage({file:j,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${$.id}`});if(!d.secure_url)throw console.error("Cloudinary error:",d),new Error(((V=d.error)==null?void 0:V.message)||"Upload failed");return d},mt=async()=>{if(it.length===0)return;ne(!0);let j=0;for(let d=0;d<it.length;d++)try{K(`\u0110ang x\u1EED l\xFD ${d+1}/${it.length}...`);const V=await Qe(it[d],2);K(`\u0110ang upload ${d+1}/${it.length}...`);const ae=await Y(V);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${$.id}`,{url:ae.secure_url,caption:nt[d]||it[d].name.replace(/\.[^/.]+$/,""),sort_order:Ee.length+d},"L\u1ED7i l\u01B0u \u1EA3nh"),j++}catch(V){console.error("Upload error:",V)}ne(!1),K(""),gt([]),Ve([]),Ie({}),j>0?(ye(`\u0110\xE3 upload ${j} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),Ue(),F()):ye("Upload th\u1EA5t b\u1EA1i","danger")},Et=async(j,d)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${j}`,"L\u1ED7i x\xF3a \u1EA3nh"),ye("\u0110\xE3 x\xF3a \u1EA3nh","success"),Ue(),F()}catch(V){ye("L\u1ED7i x\xF3a \u1EA3nh","danger")}},hn=j=>{var d;j.preventDefault(),(d=be.current)==null||d.classList.add("dragover")},Kt=()=>{var j;(j=be.current)==null||j.classList.remove("dragover")},Qt=j=>{var d;j.preventDefault(),(d=be.current)==null||d.classList.remove("dragover"),pn(j.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:E},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},$.title),React.createElement("small",{className:"text-muted"},ke.length>0&&React.createElement("span",null,ke.length," folder \u2022 "),Ee.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>et(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),tn&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Dt,onChange:j=>Pt(j.target.value),onKeyPress:j=>j.key==="Enter"&&Bt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Bt,disabled:M||!Dt.trim()},M?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{et(!1),Pt("")}},"H\u1EE7y")))),ke.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},ke.map(j=>React.createElement("div",{key:j.uuid||j.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>re&&re(j)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},j.title),React.createElement("small",{className:"text-muted"},j.subfolderCount>0&&React.createElement("span",null,j.subfolderCount," folder"),j.subfolderCount>0&&j.count>0&&" \u2022 ",j.count>0&&React.createElement("span",null,j.count," \u1EA3nh"),j.subfolderCount===0&&j.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:d=>{d.stopPropagation(),W&&W(j)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:d=>{d.stopPropagation(),yn(j)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:be,className:"upload-zone",onClick:()=>{var j;return(j=z.current)==null?void 0:j.click()},onDragOver:hn,onDragLeave:Kt,onDrop:Qt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:z,type:"file",multiple:!0,accept:"image/*",onChange:j=>pn(j.target.files)})),wt.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},wt.map((j,d)=>React.createElement("div",{key:d,className:"upload-preview-item"},React.createElement("img",{src:j.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>R(d)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:mt,disabled:ze},ze?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Ke||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",it.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",Ee.length,")"),Ee.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Wt},de.length===Ee.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),de.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},de.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>le(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Ct,disabled:lt},lt?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Te([])},React.createElement("i",{className:"fas fa-times"})))),st?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):Ee.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},Ee.map((j,d)=>React.createElement("div",{key:d,className:`image-item ${de.includes(j.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>It(j.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:de.includes(j.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:de.includes(j.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},de.includes(j.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:j.src,alt:j.caption,style:{opacity:de.includes(j.id)?.7:1,border:de.includes(j.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:V=>{V.stopPropagation(),Et(j.id,d)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),j.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},j.caption)))))),ve&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",de.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>le(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},x.filter(j=>!j.parentId).map(j=>React.createElement(FolderTreeItem,{key:j.uuid||j.id,folder:j,allAlbums:x,currentAlbumId:$.uuid||$.id,targetAlbum:U,onSelect:oe})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>le(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:_e,disabled:!U||Me},Me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),yt&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Rt(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Rt(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:yt.src,alt:yt.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:j=>j.stopPropagation()}),yt.caption&&React.createElement("div",{className:"text-white text-center mt-2"},yt.caption)))))}function SearchCenter({showToast:$,onNavigate:E}){const[F,ye]=useState(""),[re,W]=useState([]),[X,Ee]=useState([]),[je,ke]=useState([]),[Ge,st]=useState("all"),[Fe,ze]=useState(null),[ne,Ke]=useState("list"),[K,it]=useState(!0),[gt,wt]=useState([]),[Ve,nt]=useState([]),Ie=useRef(null),[yt,Rt]=useState(!0),[tn,et]=useState(!1),Dt=useRef(null),Pt=useRef(null),M=useRef(null),[C,z]=useState(!1),[be,ve]=useState([]),[le,de]=useState([]),[Te,x]=useState(""),q=useRef(null),U=useRef(new Map),[oe,Me]=useState("auto"),[Ae,Qe]=useState({start:0,end:20}),[Ue,St]=useState(!1),[It,_e]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[lt,Yt]=useState(""),[Ct,Wt]=useState(!1),Bt=useRef(null),yn=useRef(null),pn=r=>r?String(r).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",R=r=>r?String(r).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",Y=(r,g)=>{if(!r||!g)return r;const u=new RegExp(`(${g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return r.replace(u,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const r=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),g=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");ve(Array.isArray(r)?r.slice(0,10):[]),de(Array.isArray(g)?g:[])}catch(r){}},[]);const mt=r=>{if(!r.trim())return;const g=[r,...be.filter(u=>u!==r)].slice(0,10);ve(g);try{localStorage.setItem("ktm_search_history",JSON.stringify(g))}catch(u){}},Et=r=>{if(!r.trim())return;const g=le.includes(r)?le.filter(u=>u!==r):[r,...le].slice(0,5);de(g);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(g))}catch(u){}},hn="ktm_search_query_stats_v1",Kt="ktm_search_product_stats_v1",Qt=(r,g)=>{try{const u=localStorage.getItem(r);if(!u)return g;const B=JSON.parse(u);return B!=null?B:g}catch(u){return g}},j=(r,g)=>{try{localStorage.setItem(r,JSON.stringify(g))}catch(u){}},[d,V]=useState(()=>Qt(hn,{})),[ae,Re]=useState(()=>Qt(Kt,{})),Pe=useRef(!1),Je=useRef(new Map);useEffect(()=>{const r=g=>{g&&(g.key===hn&&V(Qt(hn,{})),g.key===Kt&&Re(Qt(Kt,{})))};return window.addEventListener("storage",r),()=>window.removeEventListener("storage",r)},[]);const vt=r=>{const g=String(r||"").trim();if(!g)return;const u=Xe(g).trim();if(u.length<3||u==="sdt:"||u==="#"||u.endsWith(":"))return;const B=Date.now(),G=Qt(hn,d&&typeof d=="object"?d:{}),L={...G&&typeof G=="object"?G:{}},A=L[u]&&typeof L[u]=="object"?L[u]:{};L[u]={q:g,count:(Number(A.count)||0)+1,lastAt:B},V(L),j(hn,L)},Ze=(r,g)=>{if(!r||r._type!=="product")return;const u=String(r.id||"").trim();if(!u)return;const B=Date.now(),G=Qt(Kt,ae&&typeof ae=="object"?ae:{}),L={...G&&typeof G=="object"?G:{}},A=L[u]&&typeof L[u]=="object"?L[u]:{};L[u]={id:u,name:String(r.name||A.name||"").trim(),code:String(r.code||A.code||"").trim(),count:(Number(A.count)||0)+1,lastAt:B,action:String(g||A.action||"").trim()},Re(L),j(Kt,L)},un=(r,g)=>{const u=String(r||"").trim();if(!u)return;const B=Xe(u).trim();if(B.length<3||B==="sdt:"||B==="#"||B.endsWith(":"))return;const G=Date.now(),L=Number(Je.current.get(B)||0);if(G-L<3e4)return;const ee=(Array.isArray(g)?g:[]).find(me=>me&&me._type==="product");ee&&(Je.current.set(B,G),Ze(ee,"search"))},qt=useMemo(()=>Object.values(d&&typeof d=="object"?d:{}).map(u=>({q:String((u==null?void 0:u.q)||"").trim(),count:Number(u==null?void 0:u.count)||0,lastAt:Number(u==null?void 0:u.lastAt)||0})).filter(u=>u.q&&u.count>0).sort((u,B)=>B.count-u.count||B.lastAt-u.lastAt).slice(0,6),[d]),Gt=useMemo(()=>Object.values(ae&&typeof ae=="object"?ae:{}).map(u=>({id:String((u==null?void 0:u.id)||"").trim(),name:String((u==null?void 0:u.name)||"").trim(),code:String((u==null?void 0:u.code)||"").trim(),count:Number(u==null?void 0:u.count)||0,lastAt:Number(u==null?void 0:u.lastAt)||0})).filter(u=>u.id&&u.count>0).sort((u,B)=>B.count-u.count||B.lastAt-u.lastAt).slice(0,8).map(u=>{const B=X.find(G=>G&&G._type==="product"&&String(G.id)===u.id);return B?{...u,item:B}:{...u,item:null}}),[ae,X]),on=(r,g={})=>{const u=String(r||"");h(u),g.addToHistory!==!1&&mt(u),z(!1),gn(!1),p(!1),g.focus!==!1?(Pe.current=!0,setTimeout(()=>{var L;const G=Ie.current;(L=G==null?void 0:G.focus)==null||L.call(G);try{if(g.caret==="end"&&G&&typeof G.setSelectionRange=="function"){const A=String(G.value||"").length;G.setSelectionRange(A,A)}}catch(A){}},0)):(Pe.current=!1,setTimeout(()=>{var G,L,A,ee;try{(L=(G=Ie.current)==null?void 0:G.blur)==null||L.call(G),(ee=(A=document.activeElement)==null?void 0:A.blur)==null||ee.call(A)}catch(me){}},0))},[at,cn]=useState(null),[Mn,bn]=useState(!1),[s,c]=useState(null),[v,p]=useState(!1),[T,P]=useState(!1),[_,b]=useState(null),[S,Q]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),H=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ge=r=>{var g,u;r._type==="product"&&(c(r),Q({name:r.name||"",code:r.code||"",price:r.price||"",image:r.image||"",category:r.category||"",note:r.note||"",commission_percent:(u=(g=r.commission_percent)!=null?g:r.commissionPercent)!=null?u:""}),bn(!0))},se=async()=>{if(s)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${s.id}`,S,"L\u1ED7i c\u1EADp nh\u1EADt"),$("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),bn(!1),c(null),Ce()}catch(r){$(r.message,"danger")}},ue=async r=>{const g=r._type==="product"?"s\u1EA3n ph\u1EA9m":r._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${g} "${r.name}"?`))try{let u="";r._type==="product"?u=`${API_BASE}/api/products?id=${r.id}`:r._type==="album"?u=`${API_BASE}/api/images/${r.id}`:r._type==="video"&&(u=`${API_BASE}/api/videos/${r.id}`),await window.KTM.api.deleteJSON(u,"L\u1ED7i x\xF3a"),$(`\u0110\xE3 x\xF3a ${g}`,"success"),Ce()}catch(u){$(u.message,"danger")}},Ne=async r=>{try{const g=_?`${API_BASE}/api/products?id=${_.id}`:`${API_BASE}/api/products`;_?await window.KTM.api.putJSON(g,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(g,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),$(_?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),P(!1),b(null),Ce()}catch(g){$(g.message,"danger")}},Oe="ktm_admin_data_cache_v1",He=1e3*60*10,Ce=async()=>{let r=null,g=!1;const u=window.KTM.cache.read(Oe,{ttlMs:He,validate:Array.isArray});u.hit?(r=u.value,console.log("[CACHE] Using cache, items:",r.length),Ee(r),W(r),it(!1),g=!0):u.status==="miss"?console.log("[CACHE] No cache found"):u.status==="expired"||u.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):u.status==="error"&&console.error("[CACHE] Error parsing cache"),g||it(!0);try{const B=async(Ye,f)=>{try{const we=await window.KTM.api.getJSON(Ye,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return we!=null?we:f}catch(we){return f}},[G,L,A]=await Promise.all([B(`${API_BASE}/api/products?fields=search`,[]),B(`${API_BASE}/api/albums`,[]),B(`${API_BASE}/api/video-folders?withVideos=true`,[])]),ee=Array.isArray(G)?G.map(Ye=>({...Ye,_type:"product",_source:"database"})):[];wt(L);let me=[];Array.isArray(L)&&L.length>0&&(await Promise.all(L.map(f=>B(`${API_BASE}/api/albums/${f.id}`,{})))).forEach((f,we)=>{const kt=L[we];f.images&&f.images.length>0&&f.images.forEach(Tt=>{me.push({id:Tt.id,name:Tt.caption||"\u1EA2nh t\u1EEB "+kt.title,image:Tt.src,folder:kt.title,_type:"album",_source:"database"})})}),nt(A);let te=[];Array.isArray(A)&&A.forEach(Ye=>{Ye.videos&&Ye.videos.forEach(f=>{te.push({id:f.id,name:f.title,folder:Ye.name,image:f.thumb,youtubeId:f.youtubeId,url:f.url,_type:"video",_source:"database"})})});const ce=[...ee,...me,...te];(!r||JSON.stringify(ce)!==JSON.stringify(r))&&(Ee(ce),W(ce),window.KTM.cache.write(Oe,ce))}catch(B){console.error("Song song fetch error:",B)}it(!1)};useEffect(()=>{Ce(),setTimeout(()=>{var g;return(g=Ie.current)==null?void 0:g.focus()},100);const r=g=>{var u,B;(g.ctrlKey||g.metaKey)&&g.key==="k"&&(g.preventDefault(),z(!0),setTimeout(()=>{var G;return(G=q.current)==null?void 0:G.focus()},0)),g.key==="/"&&!C&&((u=document.activeElement)==null?void 0:u.tagName)!=="INPUT"&&(g.preventDefault(),(B=Ie.current)==null||B.focus()),g.key==="Escape"&&C&&z(!1)};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[C]);const Xe=r=>{try{return String(r!=null?r:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(g){return String(r!=null?r:"").toLowerCase()}},O=r=>{const u=Xe(r).trim().split(/\s+/).filter(Boolean).map(me=>{const te=String(me||"").trim();return te?te.startsWith("#")?te.slice(1):te.startsWith("sdt:")?te.slice(4):te.startsWith("phone:")?te.slice(6):te:""}).filter(Boolean),B=u.includes("anh"),G=u.includes("video"),L=u.filter(me=>me!=="anh"&&me!=="video"),A=L.join(" "),ee=new Set(["product"]);return B&&ee.add("album"),G&&ee.add("video"),{allowedTypes:ee,includeAlbum:B,includeVideo:G,contentTokens:L,cleanedQuery:A}},De=(r,g,u)=>{var we,kt,Tt,$t,Lt;const B=Array.isArray(g)?g:[],G=Xe(u).trim();if(!B.length&&!G)return 0;const L=Xe((we=r==null?void 0:r.name)!=null?we:""),A=Xe((kt=r==null?void 0:r.code)!=null?kt:""),ee=Xe((Tt=r==null?void 0:r.category)!=null?Tt:""),me=Xe(($t=r==null?void 0:r.note)!=null?$t:""),te=Xe((Lt=r==null?void 0:r.folder)!=null?Lt:"");if(!`${L} ${A} ${ee} ${me} ${te}`.trim())return 0;const qe=L.replace(/\s+/g,""),Ye=G.replace(/\s+/g,"");let f=0;G&&(L===G&&(f+=220),L.includes(G)&&(f+=140),L.startsWith(G)&&(f+=160),Ye&&(qe===Ye?f+=280:qe.startsWith(Ye)?f+=180:qe.includes(Ye)&&(f+=110)),A&&A===G&&(f+=180),A&&A.includes(G)&&(f+=90));for(const Xt of B){if(!Xt)continue;const jt=new RegExp(`(?:^|\\s)${Xt.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`),Ht=String(Xt).replace(/\s+/g,"");L.includes(Xt)&&(f+=35),jt.test(L)&&(f+=25),Ht&&(qe===Ht?f+=90:qe.startsWith(Ht)?f+=50:qe.includes(Ht)&&(f+=28)),A&&A.includes(Xt)&&(f+=20),A&&jt.test(A)&&(f+=10),ee&&ee.includes(Xt)&&(f+=12),te&&te.includes(Xt)&&(f+=12),me&&me.includes(Xt)&&(f+=6)}return f>0&&L&&(f+=Math.max(0,10-Math.min(10,Math.floor(L.length/10)))),f},We=(r,g,u)=>{const B=Array.isArray(r)?r:[];return B.length?B.map((L,A)=>({it:L,idx:A,score:De(L,g,u)})).sort((L,A)=>A.score!==L.score?A.score-L.score:L.idx-A.idx).map(L=>L.it):[]},ut=async(r,g)=>{if(!(!yt||g.length===0)){et(!0);try{const u=g.map(G=>({id:G.id,name:G.name,price:G.price,category:G.category,note:G.note,folder:G.folder,_type:G._type})),B=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:r,products:u},"AI Search error");if(B&&B.matchedIds&&B.matchedIds.length>0){const{contentTokens:G,cleanedQuery:L}=O(r),A=new Set(B.matchedIds),ee=g.filter(me=>A.has(me.id)).sort((me,te)=>De(te,G,L)-De(me,G,L));ee.length>0&&W(ee)}else B&&B.matchedIds&&B.matchedIds.length===0&&W([])}catch(u){console.error("AI Search error:",u)}et(!1)}},h=r=>{if(ye(r),x(r),Pt.current&&clearTimeout(Pt.current),Dt.current&&clearTimeout(Dt.current),M.current&&M.current.abort(),!r.trim()){Se(Ge);return}const u=`v2|${Xe(r).trim().replace(/\s+/g,"")}|${Ge}`;if(U.current.has(u)){W(U.current.get(u));return}const{allowedTypes:B,contentTokens:G,cleanedQuery:L}=O(r);Pt.current=setTimeout(()=>{const A=X.filter(te=>{if(!B.has(te==null?void 0:te._type))return!1;if(G.length===0)return!0;const ce=pn(Object.entries(te).filter(([we])=>!we.startsWith("_")).map(([,we])=>String(we||"")).join(" ")),qe=te.phone?R(te.phone):"",Ye=`${ce} ${qe}`.trim(),f=Ye.replace(/\s+/g,"");return G.every(we=>{const kt=String(we||"").trim();return kt?Ye.includes(kt)||f.includes(kt.replace(/\s+/g,"")):!0})});let ee=A;Ge!=="all"&&(ee=A.filter(te=>(te==null?void 0:te._type)===Ge));const me=We(ee,G,L);if(vt(r),un(r,me),U.current.size>20){const te=U.current.keys().next().value;U.current.delete(te)}U.current.set(u,me),W(me),yt&&L.length>=3&&(Dt.current=setTimeout(()=>{ut(L,ee)},500))},200)},Se=r=>{st(r);const{allowedTypes:g,contentTokens:u}=O(F),{cleanedQuery:B}=O(F);let G=X.filter(L=>g.has(L==null?void 0:L._type));r!=="all"&&(G=G.filter(L=>(L==null?void 0:L._type)===r)),F.trim()&&u.length>0&&(G=G.filter(L=>{const A=Xe(Object.entries(L).filter(([ce])=>!ce.startsWith("_")).map(([,ce])=>String(ce||"")).join(" ")),ee=L.phone?R(L.phone):"",me=`${A} ${ee}`.trim(),te=me.replace(/\s+/g,"");return u.every(ce=>{const qe=String(ce||"").trim();return qe?me.includes(qe)||te.includes(qe.replace(/\s+/g,"")):!0})})),W(We(G,u,B))},pt=(r,g,u)=>{u&&u.item&&Ze(u.item,u.action||"copy"),window.KTM.clipboard.writeText(r).then(()=>{ze(g),$("\u0110\xE3 copy!","success"),setTimeout(()=>ze(null),1500)})},w=async(r,g,u)=>{try{u&&u.item&&Ze(u.item,u.action||"copy_image"),await window.KTM.clipboard.writeImageFromUrl(r),ze(g+"-img"),$("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>ze(null),1500)}catch(B){pt(r,g+"-img",u)}},ie=r=>{let g=r.toLowerCase();const u=[],B=X.filter(A=>A._type==="product");if(g.includes("ty")||g.includes("xy lanh")){if(g.includes("gi\u1EEFa")||g.includes("giua")){const A=B.find(ee=>{var me;return(me=ee.name)==null?void 0:me.toLowerCase().includes("xy lanh gi\u1EEFa")});A&&!u.find(ee=>ee.id===A.id)&&u.push(A)}if(g.includes("nghi\xEAng")||g.includes("nghieng")){const A=B.find(ee=>{var me;return(me=ee.name)==null?void 0:me.toLowerCase().includes("xy lanh nghi\xEAng")});A&&!u.find(ee=>ee.id===A.id)&&u.push(A)}if(g.includes("\u1EE7i")||g.includes("ui")){const A=B.find(ee=>{var me;return(me=ee.name)==null?void 0:me.toLowerCase().includes("xy lanh \u1EE7i")});A&&!u.find(ee=>ee.id===A.id)&&u.push(A)}}const G=g.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(G){const A=G[1],ee=G[2],me=B.find(te=>{var qe;const ce=((qe=te.name)==null?void 0:qe.toLowerCase())||"";return ce.includes("combo")&&ce.includes(`${A} tay`)&&(ce.includes(`${ee} xy`)||ce.includes(`${ee} xylanh`))});if(me&&!u.find(te=>te.id===me.id))u.push(me);else{const te=B.find(ce=>{var Ye;const qe=((Ye=ce.name)==null?void 0:Ye.toLowerCase())||"";return qe.includes("combo")&&qe.includes(`${A} tay`)});te&&!u.find(ce=>ce.id===te.id)&&u.push(te)}}if(g.includes("combo")&&!G){const A=g.match(/combo.*?(\d+)\s*tay/);if(A){const ee=A[1];B.filter(te=>{var qe;const ce=((qe=te.name)==null?void 0:qe.toLowerCase())||"";return ce.includes("combo")&&ce.includes(`${ee} tay`)}).forEach(te=>{u.find(ce=>ce.id===te.id)||u.push(te)})}}const L=g.match(/van\s*(\d+)\s*tay/);if(L&&!g.includes("ty")&&!g.includes("combo")){const A=L[1],ee=B.find(me=>{var ce;const te=((ce=me.name)==null?void 0:ce.toLowerCase())||"";return te.includes(`van ${A} tay`)&&!te.includes("combo")});ee&&!u.find(me=>me.id===ee.id)&&u.push(ee)}return u.slice(0,4)},Be=async r=>{if(!r.trim())return;const g={role:"user",content:r,attachments:[]};_e(B=>[...B,g]),Yt(""),Wt(!0);const u=ie(r);setTimeout(()=>{var B;return(B=Bt.current)==null?void 0:B.scrollIntoView({behavior:"smooth"})},100);try{const G=X.filter(ce=>ce._type==="product").map(ce=>{let qe=`- ${ce.name}`;return ce.code&&(qe+=` (M\xE3: ${ce.code})`),ce.price&&(qe+=` - Gi\xE1: ${ce.price.replace(/[đ\s]/g,"")}\u0111`),ce.category&&(qe+=` [${ce.category}]`),ce.note&&(qe+=` (${ce.note})`),qe}).join(`
`),A=It.slice(-6).map(ce=>`${ce.role==="user"?"Kh\xE1ch":"AI"}: ${ce.content}`).join(`
`),ee=A?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${A}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${G}`:G,te=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:r,context:ee,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";_e(ce=>[...ce,{role:"assistant",content:te,attachments:u}])}catch(B){console.error("AI Error:",B);const G=r.toLowerCase(),L=X.filter(ee=>{const me=Object.values(ee).join(" ").toLowerCase();return G.split(" ").some(te=>me.includes(te))});let A="";L.length>0?(A=`T\xECm th\u1EA5y ${L.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,L.slice(0,5).forEach(ee=>{A+=`\u2022 ${ee.name}`,ee.price&&(A+=` - ${ee.price.replace(/[đ\s]/g,"")}\u0111`),ee.note&&(A+=` (${ee.note})`),A+=`
`}),L.length>5&&(A+=`
...v\xE0 ${L.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):A='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',_e(ee=>[...ee,{role:"assistant",content:A,attachments:L.slice(0,4)}])}Wt(!1),setTimeout(()=>{var B,G;(B=Bt.current)==null||B.scrollIntoView({behavior:"smooth"}),(G=yn.current)==null||G.focus()},100)};function tt({show:r,product:g,categories:u,onClose:B,onSave:G}){const[L,A]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[ee,me]=useState(!1),[te,ce]=useState(!1),qe=useRef(null),Ye=J=>window.KTM.money.formatVNDInputDigits(J),f=J=>{const Z=window.KTM.money.getDigits(String(J!=null?J:"")),fe=Number(Z);return Z&&Number.isFinite(fe)?Math.trunc(fe):0},we=(J,Z)=>{if(J==null||J==="")return[];let fe=J;if(typeof fe=="string"){const $e=fe.trim();if(!$e)return[];try{fe=JSON.parse($e)}catch(xe){return[]}}if(!Array.isArray(fe))return[];const Le=f(Z);return fe.map($e=>{var ot;if(!$e||typeof $e!="object")return null;const xe=String((ot=$e.name)!=null?ot:"").trim(),dt=(Array.isArray($e.options)?$e.options:[]).map(Nt=>{var kn,$n,Rn,Dn,qn,Ln,fa;if(!Nt||typeof Nt!="object")return null;const Vt=String((kn=Nt.label)!=null?kn:"").trim();if(!Vt)return null;const rn=(qn=(Dn=(Rn=($n=Nt.price)!=null?$n:Nt.priceValue)!=null?Rn:Nt.unit_price)!=null?Dn:Nt.unitPrice)!=null?qn:null,vn=Number(rn);let Sn=Number.isFinite(vn)?Math.trunc(vn):null;if(Sn==null){const In=(fa=(Ln=Nt.price_delta)!=null?Ln:Nt.priceDelta)!=null?fa:null,Hn=Number(In);Number.isFinite(Hn)&&(Sn=Le+Math.trunc(Hn))}Sn==null&&(Sn=Le);const wn=String(Math.max(0,Math.trunc(Number(Sn)||0)));return{label:Vt,price:Math.max(0,Math.trunc(Number(Sn)||0)),priceDigits:wn}}).filter(Boolean);return{name:xe||"Bi\u1EBFn th\u1EC3",options:dt}}).filter(Boolean)},kt=J=>{if(J==null||J==="")return[];let Z=J;if(typeof Z=="string"){const fe=Z.trim();if(!fe)return[];try{Z=JSON.parse(fe)}catch(Le){return[]}}return Z&&typeof Z=="object"&&!Array.isArray(Z)&&(Z=Object.entries(Z).map(([fe,Le])=>({key:fe,value:Le}))),Array.isArray(Z)?Z.map(fe=>{var dt,ot,Nt,Vt,rn;if(!fe||typeof fe!="object")return null;const Le=String((Nt=(ot=(dt=fe.key)!=null?dt:fe.name)!=null?ot:fe.label)!=null?Nt:"").trim(),$e=String((Vt=fe.value)!=null?Vt:"").trim(),xe=String((rn=fe.unit)!=null?rn:"").trim();return Le?{key:Le,value:$e,unit:xe}:null}).filter(Boolean):[]};useEffect(()=>{var J,Z;if(g)if(A({name:g.name||"",code:g.code||"",price:g.price||"",image:g.image||"",category:g.category||"",note:g.note||"",sort_order:g.sort_order||0,commission_percent:(Z=(J=g.commission_percent)!=null?J:g.commissionPercent)!=null?Z:5,variants:we(g.variants,g.price),attributes:kt(g.attributes)}),g.price){const fe=window.KTM.money.getDigits(g.price);Ht(fe),A(Le=>({...Le,price:Ye(fe)}))}else Ht("");else A({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Ht("")},[g,r]);const Tt=J=>{A(Z=>{var dt;const fe=f(Z.price),Le=String(fe),$e=Array.isArray(Z.variants)?[...Z.variants]:[],xe={...$e[J]||{},options:Array.isArray((dt=$e[J])==null?void 0:dt.options)?[...$e[J].options]:[]};return xe.options=xe.options.map(ot=>({label:String((ot==null?void 0:ot.label)||""),price:fe,priceDigits:Le})),$e[J]=xe,{...Z,variants:$e}})},$t=()=>{A(J=>{const Z=f(J.price),fe=String(Z),$e=(Array.isArray(J.variants)?[...J.variants]:[]).map(xe=>{const dt=(Array.isArray(xe==null?void 0:xe.options)?xe.options:[]).map(ot=>({label:String((ot==null?void 0:ot.label)||""),price:Z,priceDigits:fe}));return{name:String((xe==null?void 0:xe.name)||"Bi\u1EBFn th\u1EC3"),options:dt}});return{...J,variants:$e}})},[Lt,Xt]=React.useState(""),[jt,Ht]=React.useState(""),bt=J=>{const Z=window.KTM.money.nextPriceInputState(J.target.value,jt);Ht(Z.digits),A({...L,price:Z.price})},an=async(J,Z=2)=>{const fe=Z*1024*1024;if(J.size<=fe)return J;try{const Le=await createImageBitmap(J),$e=document.createElement("canvas");let xe=Le.width,dt=Le.height;const ot=1200;return(xe>ot||dt>ot)&&(xe>dt?(dt=Math.round(dt/xe*ot),xe=ot):(xe=Math.round(xe/dt*ot),dt=ot)),$e.width=xe,$e.height=dt,$e.getContext("2d").drawImage(Le,0,0,xe,dt),Le.close(),new Promise((Vt,rn)=>{$e.toBlob(vn=>{vn?Vt(new File([vn],J.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):rn(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Le){throw console.error("Compress error:",Le),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},mn=async J=>{var Le;const Z=J.target.files[0];if(!Z)return;if(!(Z.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Z.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ce(!0);try{const $e=await an(Z),xe=await window.KTM.cloudinary.uploadImage({file:$e,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!xe.secure_url)throw console.error("Cloudinary error:",xe),new Error(((Le=xe.error)==null?void 0:Le.message)||"Upload failed");A(dt=>({...dt,image:xe.secure_url}))}catch($e){console.error("Upload error:",$e),alert("L\u1ED7i upload \u1EA3nh: "+$e.message)}ce(!1),J.target.value=""},sn=async J=>{J.preventDefault(),me(!0);const Z={...L,variants:we(L.variants,L.price),attributes:kt(L.attributes)};await G(Z),me(!1)};return r?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),g?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:B})),React.createElement("form",{onSubmit:sn},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:L.name,onChange:J=>A({...L,name:J.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:L.code,onChange:J=>A({...L,code:J.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:L.price,onChange:bt,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:L.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:J=>A({...L,commission_percent:J.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:L.category,onChange:J=>A({...L,category:J.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),u.map(J=>React.createElement("option",{key:J,value:J},J)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:L.note,onChange:J=>A({...L,note:J.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(L.attributes)?L.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(L.attributes)?L.attributes:[]).map((J,Z)=>React.createElement("div",{key:Z,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(J==null?void 0:J.key)||"",onChange:fe=>{const Le=fe.target.value;A($e=>{const xe=Array.isArray($e.attributes)?[...$e.attributes]:[];return xe[Z]={...xe[Z]||{},key:Le},{...$e,attributes:xe}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(J==null?void 0:J.value)||"",onChange:fe=>{const Le=fe.target.value;A($e=>{const xe=Array.isArray($e.attributes)?[...$e.attributes]:[];return xe[Z]={...xe[Z]||{},value:Le},{...$e,attributes:xe}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(J==null?void 0:J.unit)||"",onChange:fe=>{const Le=fe.target.value;A($e=>{const xe=Array.isArray($e.attributes)?[...$e.attributes]:[];return xe[Z]={...xe[Z]||{},unit:Le},{...$e,attributes:xe}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{A(fe=>{const Le=Array.isArray(fe.attributes)?[...fe.attributes]:[];return Le.splice(Z,1),{...fe,attributes:Le}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{A(J=>{const Z=Array.isArray(J.attributes)?[...J.attributes]:[];return Z.push({key:"",value:"",unit:""}),{...J,attributes:Z}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(L.variants)?L.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(L.variants)?L.variants:[]).map((J,Z)=>React.createElement("div",{key:Z,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(J==null?void 0:J.name)||"",onChange:fe=>{const Le=fe.target.value;A($e=>{var dt;const xe=Array.isArray($e.variants)?[...$e.variants]:[];return xe[Z]={...xe[Z]||{},name:Le,options:Array.isArray((dt=xe[Z])==null?void 0:dt.options)?xe[Z].options:[]},{...$e,variants:xe}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Tt(Z),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(J==null?void 0:J.options)||J.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{A(fe=>{const Le=Array.isArray(fe.variants)?[...fe.variants]:[];return Le.splice(Z,1),{...fe,variants:Le}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(J==null?void 0:J.options)?J.options:[]).map((fe,Le)=>{var $e,xe;return React.createElement("div",{key:Le,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(fe==null?void 0:fe.label)||"",onChange:dt=>{const ot=dt.target.value;A(Nt=>{var wn,kn,$n,Rn,Dn;const Vt=Array.isArray(Nt.variants)?[...Nt.variants]:[],rn={...Vt[Z]||{},options:Array.isArray((wn=Vt[Z])==null?void 0:wn.options)?[...Vt[Z].options]:[]},vn=Number(($n=(kn=rn.options[Le])==null?void 0:kn.price)!=null?$n:0)||0,Sn=String((Dn=(Rn=rn.options[Le])==null?void 0:Rn.priceDigits)!=null?Dn:Math.max(0,Math.trunc(vn)));return rn.options[Le]={...rn.options[Le]||{},label:ot,price:Math.max(0,Math.trunc(vn)),priceDigits:Sn},Vt[Z]=rn,{...Nt,variants:Vt}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Ye(String((xe=fe==null?void 0:fe.priceDigits)!=null?xe:window.KTM.money.getDigits(String(($e=fe==null?void 0:fe.price)!=null?$e:"")))),onChange:dt=>{A(ot=>{var $n,Rn,Dn,qn,Ln;const Nt=String((Rn=fe==null?void 0:fe.priceDigits)!=null?Rn:window.KTM.money.getDigits(String(($n=fe==null?void 0:fe.price)!=null?$n:""))),Vt=window.KTM.money.nextPriceInputState(dt.target.value,Nt),rn=String((Dn=Vt.digits)!=null?Dn:""),vn=Number(rn),Sn=Number.isFinite(vn)?Math.max(0,Math.trunc(vn)):0,wn=Array.isArray(ot.variants)?[...ot.variants]:[],kn={...wn[Z]||{},options:Array.isArray((qn=wn[Z])==null?void 0:qn.options)?[...wn[Z].options]:[]};return kn.options[Le]={...kn.options[Le]||{},label:String(((Ln=kn.options[Le])==null?void 0:Ln.label)||""),price:Sn,priceDigits:rn},wn[Z]=kn,{...ot,variants:wn}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{A(dt=>{var Vt;const ot=Array.isArray(dt.variants)?[...dt.variants]:[],Nt={...ot[Z]||{},options:Array.isArray((Vt=ot[Z])==null?void 0:Vt.options)?[...ot[Z].options]:[]};return Nt.options.splice(Le,1),ot[Z]=Nt,{...dt,variants:ot}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{A(fe=>{var dt;const Le=Array.isArray(fe.variants)?[...fe.variants]:[],$e={...Le[Z]||{},options:Array.isArray((dt=Le[Z])==null?void 0:dt.options)?[...Le[Z].options]:[]},xe=f(fe.price);return $e.options.push({label:"",price:xe,priceDigits:String(xe)}),Le[Z]=$e,{...fe,variants:Le}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{A(J=>{const Z=f(J.price),fe=Array.isArray(J.variants)?[...J.variants]:[],Le=String(Z);return fe.push({name:"Size",options:[{label:"S",price:Z,priceDigits:Le},{label:"M",price:Z,priceDigits:Le},{label:"L",price:Z,priceDigits:Le}]}),{...J,variants:fe}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:$t,disabled:!Array.isArray(L.variants)||L.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},L.image?React.createElement(React.Fragment,null,React.createElement("img",{src:L.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>A({...L,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var J;return(J=qe.current)==null?void 0:J.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:qe,type:"file",accept:"image/*",className:"d-none",onChange:mn}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var J;return(J=qe.current)==null?void 0:J.click()},disabled:te,style:{borderRadius:"10px"}},te?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:L.image,onChange:J=>A({...L,image:J.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:B,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:ee,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const At=r=>window.KTM.money.formatVND(r),Zt=r=>{if(r==null||r==="")return[];let g=r;if(typeof g=="string"){const u=g.trim();if(!u)return[];try{g=JSON.parse(u)}catch(B){return[]}}return Array.isArray(g)?g:[]},ft=r=>{if(r==null||r==="")return[];let g=r;if(typeof g=="string"){const u=g.trim();if(!u)return[];try{g=JSON.parse(u)}catch(B){return[]}}return g&&typeof g=="object"&&!Array.isArray(g)&&(g=Object.entries(g).map(([u,B])=>({key:u,value:B}))),Array.isArray(g)?g:[]},Jt=(r,g={})=>{var L;const u=ft(r).map(A=>{var ee,me,te,ce,qe;return{key:String((te=(me=(ee=A==null?void 0:A.key)!=null?ee:A==null?void 0:A.name)!=null?me:A==null?void 0:A.label)!=null?te:"").trim(),value:String((ce=A==null?void 0:A.value)!=null?ce:"").trim(),unit:String((qe=A==null?void 0:A.unit)!=null?qe:"").trim()}}).filter(A=>!!A.key);if(!u.length)return null;const B=!!g.compact,G=String((L=g.className)!=null?L:"").trim();return React.createElement("div",{className:`ktm-variants-preview${B?" compact":""}${G?" "+G:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},u.map((A,ee)=>{const me=A.key,te=`${A.value||""}${A.unit?(A.value?" ":"")+A.unit:""}`.trim();return React.createElement("div",{key:`${me}-${ee}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},me),te?React.createElement("span",{className:"ktm-chip ktm-chip-option"},te):null)})))},nn=(r,g={})=>{var me;const u=Zt(r).map(te=>{var ce;return{name:String((ce=te==null?void 0:te.name)!=null?ce:"").trim(),options:Array.isArray(te==null?void 0:te.options)?te.options:[]}}).map(te=>({...te,options:te.options.map(ce=>{var qe;return{label:String((qe=ce==null?void 0:ce.label)!=null?qe:"").trim(),price:Number(ce==null?void 0:ce.price)}}).filter(ce=>!!ce.label)})).filter(te=>te.options.length>0);if(!u.length)return null;const B=Number.isFinite(g.maxGroups)?Math.max(1,Math.trunc(g.maxGroups)):u.length,G=Number.isFinite(g.maxOptionsPerGroup)?Math.max(1,Math.trunc(g.maxOptionsPerGroup)):3,L=!!g.compact,A=String((me=g.className)!=null?me:"").trim(),ee=u.slice(0,B);return React.createElement("div",{className:`ktm-variants-preview${L?" compact":""}${A?" "+A:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},ee.map((te,ce)=>{const qe=te.name||"Bi\u1EBFn th\u1EC3",Ye=te.options.slice(0,G),f=te.options.length-Ye.length;return React.createElement("div",{key:`${qe}-${ce}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},qe),Ye.map((we,kt)=>{const Tt=we.price,$t=Number.isFinite(Tt)&&Tt>=0?At(Math.trunc(Tt)):"",Lt=$t?`${we.label} \xB7 ${$t}`:we.label;return React.createElement("span",{key:`${qe}-${ce}-${kt}`,className:"ktm-chip ktm-chip-option"},Lt)}),f>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",f))})))},ln=(r,g)=>{const u=r._type==="product",B=r._type==="album",G=r._type==="video",L=r.note&&(r.note.toLowerCase().includes("free")||r.note.toLowerCase().includes("gi\u1EA3m")||r.note.toLowerCase().includes("sale")),A=u?Jt(r.attributes,{compact:ne==="grid",className:ne==="grid"?"meta text-muted":"text-muted"}):null,ee=u?nn(r.variants,{compact:ne==="grid",maxOptionsPerGroup:999,className:ne==="grid"?"meta text-muted":"text-muted"}):null;return ne==="grid"?React.createElement("div",{key:r.id||g,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>{Ze(r,"preview"),cn({url:r.image,name:r.name,price:r.price,note:r.note,item:r})}},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${G?"fa-video":"fa-image"} fa-2x text-muted`})),r.price&&React.createElement("div",{className:"price-overlay"},r.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${u?"product":B?"album":"video"}`},u?"SP":B?"\u1EA2nh":"Video"),L&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},r.name),r.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},r.note),A&&React.createElement("div",{style:{marginTop:2}},A),ee&&React.createElement("div",{style:{marginTop:2}},ee),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:Fe===r.id+"-img"?"copied":"",onClick:()=>w(r.image,r.id,{item:r,action:"copy_image"})},React.createElement("i",{className:"fas fa-image"})),r.price&&React.createElement("button",{className:Fe===r.id+"-price"?"copied":"",onClick:()=>pt(r.price.replace(/[đ\s]/g,""),r.id+"-price",{item:r,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:r.id||g,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${u?"product":B?"album":"video"}`},u?"S\u1EA3n ph\u1EA9m":B?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy",onClick:()=>{Ze(r,"preview"),cn({url:r.image,name:r.name,price:r.price,note:r.note,item:r})}}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${G?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},r.name),React.createElement("div",{className:"price-row"},r.price&&React.createElement("span",{className:"price"},r.price.replace(/[đ\s]/g,""),"\u0111"),L&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),A&&React.createElement("div",{style:{marginTop:4}},A),ee&&React.createElement("div",{style:{marginTop:4}},ee)),React.createElement("div",{className:"meta"},r.code&&React.createElement("span",{className:"meta-tag"},"#",r.code),r.category&&React.createElement("span",{className:"meta-tag"},r.category),r.note&&React.createElement("span",{className:"meta-tag highlight"},r.note),r.folder&&React.createElement("span",{className:"meta-tag"},r.folder),G&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},u&&React.createElement("button",{onClick:()=>{Ze(r,"create_order"),E&&E("orders","create",{productId:r.id})}},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),r.price&&React.createElement("button",{className:Fe===r.id+"-price"?"copied":"",onClick:()=>pt(r.price.replace(/[đ\s]/g,""),r.id+"-price",{item:r,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:Fe===r.id+"-name"?"copied":"",onClick:()=>pt(r.name,r.id+"-name",{item:r,action:"copy_name"})},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),G&&r.youtubeId&&React.createElement("button",{className:Fe===r.id+"-yt"?"copied":"",onClick:()=>pt(`https://www.youtube.com/watch?v=${r.youtubeId}`,r.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),u&&React.createElement("button",{className:"action-edit",onClick:()=>ge(r)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>ue(r)},React.createElement("i",{className:"fas fa-trash"}))))},[dn,gn]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"search-suggestions mobile-only"},React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"G\u1EE3i \xFD nhanh"),React.createElement("div",{className:"search-suggestions-row"},[{label:"van 2 tay",query:"van 2 tay"},{label:"combo r\u1EBB",query:"combo r\u1EBB"},{label:"xylanh",query:"xylanh"},{label:"sdt:\u2026",query:"sdt:",caret:"end",addToHistory:!1},{label:"#m\xE3\u2026",query:"#",caret:"end",addToHistory:!1}].map(r=>React.createElement("button",{key:r.label,type:"button",className:"suggestion-chip",onClick:()=>on(r.query,{caret:r.caret,addToHistory:r.addToHistory,focus:!1})},r.label)))),Gt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"S\u1EA3n ph\u1EA9m hay t\xECm"),React.createElement("div",{className:"search-suggestions-row"},Gt.map(r=>{var G,L;const g=(((G=r.item)==null?void 0:G.name)||r.name||"").trim();if(!g)return null;const u=String(((L=r.item)==null?void 0:L.code)||r.code||"").trim(),B=u?`#${u}`:g;return React.createElement("button",{key:r.id,type:"button",className:"suggestion-chip suggestion-chip-popular",onClick:()=>{r.item&&Ze(r.item,"suggestion"),on(B,{caret:"end",focus:!1})},title:u?`#${u}`:g},g)}))),qt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"T\xECm g\u1EA7n \u0111\xE2y / hay d\xF9ng"),React.createElement("div",{className:"search-suggestions-row"},qt.map(r=>React.createElement("button",{key:r.q,type:"button",className:"suggestion-chip suggestion-chip-query",onClick:()=>on(r.q,{caret:"end",focus:!1}),title:`${r.q} (${r.count})`},r.q))))),React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,re.length)," k\u1EBFt qu\u1EA3",yt&&F.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Ge!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Ge==="product"?"S\u1EA3n ph\u1EA9m":Ge==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${ne==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Ke("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${ne==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Ke("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},K?React.createElement("div",null,[...Array(8)].map((r,g)=>React.createElement("div",{key:g,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):re.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',F,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{ye(""),h("")}},"Xem t\u1EA5t c\u1EA3")):ne==="grid"?React.createElement("div",{className:"product-grid-mobile"},re.map((r,g)=>ln(r,g))):React.createElement("div",null,re.map((r,g)=>ln(r,g)))),dn&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>gn(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Ge==="all"?"active":""}`,onClick:()=>{Se("all"),gn(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Ge==="product"?"active":""}`,onClick:()=>{Se("product"),gn(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Ge==="album"?"active":""}`,onClick:()=>{Se("album"),gn(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Ge==="video"?"active":""}`,onClick:()=>{Se("video"),gn(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:yt,onChange:r=>Rt(r.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:Ie,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:F,onChange:r=>h(r.target.value)}),React.createElement("button",{className:`filter-btn ${dn||Ge!=="all"?"active":""}`,onClick:()=>gn(!dn)},React.createElement("i",{className:"fas fa-filter"})))),C&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>z(!1)},React.createElement("div",{className:"search-palette",onClick:r=>r.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:q,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:Te,onChange:r=>h(r.target.value),onKeyDown:r=>{r.key==="Enter"&&re.length>0?(mt(Te),z(!1)):r.key==="Escape"&&z(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>z(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((r,g)=>React.createElement("span",{key:r,className:`filter-chip ${Ge===["all","product","album","video"][g]?"active":""}`,onClick:()=>{Se(["all","product","album","video"][g])}},r)))),le.length>0&&!Te.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},le.map((r,g)=>React.createElement("div",{key:g,className:"palette-item",onClick:()=>{h(r),mt(r)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,r),React.createElement("button",{className:"unsave-btn",onClick:u=>{u.stopPropagation(),Et(r)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),be.length>0&&!Te.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},be.map((r,g)=>React.createElement("div",{key:g,className:"palette-item",onClick:()=>{h(r)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,r),React.createElement("button",{className:"save-btn",onClick:u=>{u.stopPropagation(),Et(r)}},React.createElement("i",{className:`fas fa-star${le.includes(r)?"":"-o"}`})))))),Te.trim()&&re.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",re.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},re.slice(0,8).map((r,g)=>React.createElement("div",{key:r.id||g,className:"palette-result-item",onClick:()=>{mt(Te),z(!1)}},r.image&&React.createElement("img",{src:r.image,alt:r.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},r.name),r.price&&React.createElement("div",{className:"result-meta"},r.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:u=>{u.stopPropagation(),Et(Te)}},React.createElement("i",{className:`fas fa-star${le.includes(Te)?"":"-o"}`})))))),Te.trim()&&re.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',Te,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:v?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>St(!0),onTouchStart:()=>St(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Ue&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>St(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},It.map((r,g)=>React.createElement("div",{key:g,className:`mb-3 ${r.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${r.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:r.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},r.content,r.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:Fe===`chat-${g}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:Fe===`chat-${g}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(r.content),ze(`chat-${g}`),setTimeout(()=>ze(null),1500)}},React.createElement("i",{className:`fas ${Fe===`chat-${g}`?"fa-check":"fa-copy"}`})),r.attachments&&r.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},r.attachments.map((u,B)=>React.createElement("div",{key:B,style:{width:70},className:"text-center"},u.image&&React.createElement("img",{src:u.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>cn({url:u.image,name:u.name,price:u.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},u.name),u.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},u.price.replace(/[đ\s]/g,""),"\u0111"))))))),Ct&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Bt})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(r=>React.createElement("button",{key:r,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Be(r),disabled:Ct,style:{whiteSpace:"nowrap"}},r))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:r=>{r.preventDefault(),Be(lt)},className:"chat-input-wrap"},React.createElement("input",{ref:yn,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:lt,onChange:r=>Yt(r.target.value),disabled:Ct}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Ct||!lt.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),at&&React.createElement("div",{className:"preview-modal",onClick:()=>cn(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>cn(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:r=>r.stopPropagation()},React.createElement("img",{src:at.url,alt:at.name})),React.createElement("div",{className:"preview-footer",onClick:r=>r.stopPropagation()},React.createElement("div",{className:"name"},at.name),at.price&&React.createElement("div",{className:"price"},at.price.replace(/[đ\s]/g,""),"\u0111"),at.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},at.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:Fe==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:Fe==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>w(at.url,"preview")},React.createElement("i",{className:`fas ${Fe==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),at.price&&React.createElement("button",{className:Fe==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>pt(at.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${Fe==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(tt,{show:T,product:_,categories:je,onClose:()=>{P(!1),b(null)},onSave:Ne}),React.createElement("div",{className:`fab-container mobile-only ${v?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{p(!1),P(!0),b(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{p(!1),E&&E("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${v?"open":""}`,onClick:()=>p(!v)},React.createElement("i",{className:"fas fa-plus"}))),Mn&&s&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>bn(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:S.name,onChange:r=>Q({...S,name:r.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:S.code,onChange:r=>Q({...S,code:r.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:S.price,onChange:r=>Q({...S,price:r.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:S.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:r=>Q({...S,commission_percent:r.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:S.category,onChange:r=>Q({...S,category:r.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),H.map(r=>React.createElement("option",{key:r,value:r},r)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:S.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:r=>Q({...S,note:r.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>bn(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:se},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:$,showToast:E}){const[F,ye]=useState([]),[re,W]=useState([]),[X,Ee]=useState(!0),[je,ke]=useState(null),[Ge,st]=useState(!1),[Fe,ze]=useState(null),[ne,Ke]=useState(!1),[K,it]=useState(null),[gt,wt]=useState(!1),[Ve,nt]=useState(null),[Ie,yt]=useState(!1),[Rt,tn]=useState(!1),[et,Dt]=useState(null),[Pt,M]=useState(!1),[C,z]=useState(null),[be,ve]=useState([]);useEffect(()=>{le()},[]);const le=async(R=null)=>{Ee(!0);try{const Y=R?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${R}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,mt=await window.KTM.api.getJSON(Y,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");ye(Array.isArray(mt)?mt:[])}catch(Y){console.error(Y),E("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}Ee(!1)},de=async R=>{try{const Y=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${R}`,"L\u1ED7i t\u1EA3i video");W(Array.isArray(Y)?Y:[])}catch(Y){console.error(Y)}},Te=async R=>{if(R===0)return;const Y=[...F];[Y[R-1],Y[R]]=[Y[R],Y[R-1]],ye(Y),await q(Y)},x=async R=>{if(R===F.length-1)return;const Y=[...F];[Y[R],Y[R+1]]=[Y[R+1],Y[R]],ye(Y),await q(Y)},q=async R=>{try{await Promise.all(R.map((Y,mt)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${Y.id}`,{sortOrder:mt},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),E("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(Y){E("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),le(C==null?void 0:C.id)}},U=async R=>{if(R===0)return;const Y=[...re];[Y[R-1],Y[R]]=[Y[R],Y[R-1]],W(Y),await Me(Y)},oe=async R=>{if(R===re.length-1)return;const Y=[...re];[Y[R],Y[R+1]]=[Y[R+1],Y[R]],W(Y),await Me(Y)},Me=async R=>{try{await Promise.all(R.map((Y,mt)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${Y.id}`,{sort_order:mt},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),E("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(Y){E("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),de(je.id)}},Ae=()=>{ze(null),st(!0)},Qe=R=>{Dt(R),tn(!0),M(!0)},Ue=async(R,Y="modal")=>{try{!Fe&&C&&(R.parent_id=C.id);const mt=Fe?`${API_BASE}/api/video-folders/${Fe.id}`:`${API_BASE}/api/video-folders`;Fe?await window.KTM.api.putJSON(mt,R,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(mt,R,"L\u1ED7i l\u01B0u folder"),E(Fe?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),Y==="drawer"?(M(!1),ze(null),le(C==null?void 0:C.id),Fe&&et&&Dt({...et,...R})):(st(!1),ze(null),le(C==null?void 0:C.id))}catch(mt){E(mt.message,"danger")}},St=async R=>{const Y=R.subfolderCount>0?`X\xF3a folder "${R.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${R.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(Y))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${R.id}`,"L\u1ED7i x\xF3a folder"),E("\u0110\xE3 x\xF3a folder","success"),ke(null),le(C==null?void 0:C.id)}catch(mt){E("L\u1ED7i x\xF3a folder","danger")}},It=R=>{R.subfolderCount>0?(ve(Y=>[...Y,R]),z(R),le(R.id)):(ke(R),W(R.videos||[]))},_e=R=>{if(R==="root")ve([]),z(null),le(null);else if(R){const Y=be.findIndex(mt=>mt.id===R.id);Y>=0&&(ve(be.slice(0,Y+1)),z(R),le(R.id))}else{const Y=[...be];Y.pop();const mt=Y[Y.length-1]||null;ve(Y),z(mt),le(mt==null?void 0:mt.id)}},lt=()=>{tn(!1),M(!1),Dt(null)},Yt=()=>{wt(!1),yt(!1),nt(null)},Ct=()=>{it(null),Ke(!0)},Wt=R=>{nt(R),wt(!0),yt(!0)},Bt=async(R,Y="modal")=>{try{R.folder_id=je==null?void 0:je.id;const mt=K?`${API_BASE}/api/videos/${K.id}`:`${API_BASE}/api/videos`;K?await window.KTM.api.putJSON(mt,R,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(mt,R,"L\u1ED7i l\u01B0u video"),E(K?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),Y==="drawer"?(yt(!1),it(null),le(),je&&de(je.id),K&&Ve&&nt({...Ve,...R})):(Ke(!1),it(null),le(),je&&de(je.id))}catch(mt){E(mt.message,"danger")}},yn=async R=>{if(confirm(`X\xF3a video "${R.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${R.id}`,"L\u1ED7i x\xF3a video"),E("\u0110\xE3 x\xF3a video","success"),le(),je&&de(je.id)}catch(Y){E("L\u1ED7i x\xF3a video","danger")}},pn=R=>{const Y=`https://www.youtube.com/watch?v=${R.youtubeId}`;window.KTM.clipboard.writeText(Y).then(()=>{E("\u0110\xE3 copy link!","success")}).catch(()=>{E("Kh\xF4ng th\u1EC3 copy link","danger")})};return je?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ke(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${je.slug==="shorts"?"text-danger":"text-warning"}`}),je.name)),React.createElement("button",{className:"btn btn-warning",onClick:Ct},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),re.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},re.map((R,Y)=>React.createElement("div",{key:R.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>U(Y),disabled:Y===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},Y+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>oe(Y),disabled:Y===re.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:R.thumb,className:"card-img-top",alt:R.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${R.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:R.title},R.title),React.createElement("small",{className:"text-muted"},R.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>pn(R),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Wt(R),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>yn(R),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:ne,video:K,onClose:()=>Ke(!1),onSave:Bt}),React.createElement(AdminDrawer,{open:Rt,title:et?et.name:"Folder",subtitle:et?`${et.subfolderCount||0} subfolder \u2022 ${et.videoCount||0} videos`:"",onClose:lt,footer:Pt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:lt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{et&&Ue({name:et.name||"",description:et.description||"",sortOrder:et.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):et?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(et.name),E("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{M(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${et.name}"?`)&&(St(et),lt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Pt&&et?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:et.name||"",onChange:R=>Dt({...et,name:R.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:et.description||"",onChange:R=>Dt({...et,description:R.target.value})}))):et?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},et.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},et.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},et.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},et.videoCount||0))),et.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,et.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:gt,title:Ve?Ve.title:"Video",subtitle:Ve?`${Ve.youtubeId}`:"",onClose:Yt,footer:Ie?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:Yt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Ve&&Bt({youtube_url:`https://www.youtube.com/watch?v=${Ve.youtubeId}`,title:Ve.title||"",thumbnail_url:Ve.thumb||"",sort_order:Ve.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Ve?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const R=`https://www.youtube.com/watch?v=${Ve.youtubeId}`;window.KTM.clipboard.writeText(R).then(()=>{E("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{yt(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${Ve.title}"?`)&&(yn(Ve),Yt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Ie&&Ve?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:Ve.title||"",onChange:R=>nt({...Ve,title:R.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:Ve.youtubeId||"",onChange:R=>nt({...Ve,youtubeId:R.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Ve.sortOrder||0,onChange:R=>nt({...Ve,sortOrder:parseInt(R.target.value)||0})}))):Ve?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},Ve.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},Ve.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},Ve.sortOrder||0))),Ve.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:Ve.thumb,alt:Ve.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},C&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>_e()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),C?C.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:Ae},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),be.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:R=>{R.preventDefault(),_e("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),be.map((R,Y)=>React.createElement("li",{key:R.id,className:`breadcrumb-item ${Y===be.length-1?"active":""}`},Y===be.length-1?R.name:React.createElement("a",{href:"#",onClick:mt=>{mt.preventDefault(),_e(R)},className:"text-warning"},R.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),X?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):F.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},C?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Ae},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",C?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},F.map((R,Y)=>{var mt,Et,hn,Kt;return React.createElement("div",{key:R.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Qt=>{Qt.stopPropagation(),Te(Y)},disabled:Y===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},Y+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Qt=>{Qt.stopPropagation(),x(Y)},disabled:Y===F.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>It(R),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${R.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},R.name),React.createElement("p",{className:"text-muted mb-0"},R.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),R.subfolderCount," folder"),R.subfolderCount>0&&(R.videoCount>0||((mt=R.videos)==null?void 0:mt.length)>0)&&" \u2022 ",(R.videoCount>0||((Et=R.videos)==null?void 0:Et.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),R.videoCount||((hn=R.videos)==null?void 0:hn.length)||0," videos"),R.subfolderCount===0&&!R.videoCount&&!((Kt=R.videos)!=null&&Kt.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Qt=>{Qt.stopPropagation(),Qe(R)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Qt=>{Qt.stopPropagation(),St(R)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Ge,folder:Fe,onClose:()=>st(!1),onSave:Ue}))}function VideoFolderModal({show:$,folder:E,onClose:F,onSave:ye}){const[re,W]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[X,Ee]=useState(!1),[je,ke]=useState(!1);useEffect(()=>{W(E?{name:E.name||"",description:E.description||"",sortOrder:E.sortOrder||0,coverImage:E.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[E,$]);const Ge=async Fe=>{const ze=Fe.target.files[0];if(ze){ke(!0);try{const ne=await window.KTM.cloudinary.uploadImage({file:ze,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});ne.secure_url&&W(Ke=>({...Ke,coverImage:ne.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(ne){console.error("Cloudinary upload error:",ne),alert("L\u1ED7i upload \u1EA3nh: "+(ne.message||ne))}finally{ke(!1)}}},st=async Fe=>{Fe.preventDefault(),Ee(!0);const ze={...re,variants:normalizeVariants(re.variants,re.price),attributes:normalizeAttributes(re.attributes)};await ye(ze),Ee(!1)};return $?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},E?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:F})),React.createElement("form",{onSubmit:st},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:re.name,onChange:Fe=>W({...re,name:Fe.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:re.description,onChange:Fe=>W({...re,description:Fe.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:re.sortOrder,onChange:Fe=>W({...re,sortOrder:parseInt(Fe.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},re.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:re.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>W({...re,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Ge,disabled:je}),je&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:re.coverImage,onChange:Fe=>W({...re,coverImage:Fe.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:F},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:$,settings:E}){const[F,ye]=useState([]),[re,W]=useState(!0),[X,Ee]=useState(!1),[je,ke]=useState(null),[Ge,st]=useState(""),[Fe,ze]=useState(""),[ne,Ke]=useState(!1),[K,it]=useState(null),gt=normalizeShipPercent(E==null?void 0:E.ship_percent),{parseMoney:wt,formatVND:Ve}=window.KTM.money,nt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Ie()},[]);const Ie=async()=>{W(!0);try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");ye(Array.isArray(x)?x:[])}catch(x){console.error(x),$("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}W(!1)},yt=()=>{ke(null),Ee(!0)},Rt=x=>{ke(x),Ee(!0)},tn=x=>{x&&(it(x),Ke(!0))},et=()=>{Ke(!1)},Dt=async x=>{if(!(!x||!x.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:x},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),$(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Ie()}catch(q){$("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},Pt=async x=>{try{const q=je?`${API_BASE}/api/products?id=${je.id}`:`${API_BASE}/api/products`;je?await window.KTM.api.putJSON(q,x,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(q,x,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),$(je?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Ee(!1),Ie()}catch(q){$(q.message,"danger")}},M=async x=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${x.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${x.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),$("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Ie()}catch(q){$(q.message,"danger")}},C=F.filter(x=>{const q=!Ge||x.name.toLowerCase().includes(Ge.toLowerCase())||x.code&&x.code.toLowerCase().includes(Ge.toLowerCase()),U=!Fe||x.category===Fe;return q&&U}),z=x=>{var oe;const q=(oe=x==null?void 0:x.commission_percent)!=null?oe:x==null?void 0:x.commissionPercent,U=q===""||q==null?NaN:Number(q);return Number.isFinite(U)?Math.max(0,Math.min(100,U)):5},be=x=>{const q=z(x),U=Number.isInteger(q)?String(q):String(Math.round(q*100)/100),oe=wt(x==null?void 0:x.price);if(!Number.isFinite(oe)||oe<=0)return`${U}%`;const Me=(Number(q)||0)/100,Qe=window.KTM.money.parseShipFeeFromNote(x==null?void 0:x.note)!=null?0:gt>0?oe*gt/100:0,Ue=oe*Me-Qe*Me,St=Math.max(0,Math.round(Ue));return`${U}% - ${Ve(St)}`},ve=x=>{if(x==null||x==="")return[];let q=x;if(typeof q=="string"){const U=q.trim();if(!U)return[];try{q=JSON.parse(U)}catch(oe){return[]}}return Array.isArray(q)?q:[]},le=x=>{if(x==null||x==="")return[];let q=x;if(typeof q=="string"){const U=q.trim();if(!U)return[];try{q=JSON.parse(U)}catch(oe){return[]}}return q&&typeof q=="object"&&!Array.isArray(q)&&(q=Object.entries(q).map(([U,oe])=>({key:U,value:oe}))),Array.isArray(q)?q:[]},de=x=>{const q=le(x).map(U=>{var oe,Me,Ae,Qe,Ue;return{key:String((Ae=(Me=(oe=U==null?void 0:U.key)!=null?oe:U==null?void 0:U.name)!=null?Me:U==null?void 0:U.label)!=null?Ae:"").trim(),value:String((Qe=U==null?void 0:U.value)!=null?Qe:"").trim(),unit:String((Ue=U==null?void 0:U.unit)!=null?Ue:"").trim()}}).filter(U=>!!U.key);return q.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},q.map((U,oe)=>{const Me=U.key,Ae=`${U.value||""}${U.unit?(U.value?" ":"")+U.unit:""}`.trim();return React.createElement("div",{key:`${Me}-${oe}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Me),Ae?React.createElement("span",{className:"ktm-chip ktm-chip-option"},Ae):null)}))):null},Te=(x,q={})=>{const U=ve(x).map(Qe=>{var Ue;return{name:String((Ue=Qe==null?void 0:Qe.name)!=null?Ue:"").trim(),options:Array.isArray(Qe==null?void 0:Qe.options)?Qe.options:[]}}).map(Qe=>({...Qe,options:Qe.options.map(Ue=>{var St;return{label:String((St=Ue==null?void 0:Ue.label)!=null?St:"").trim(),price:Number(Ue==null?void 0:Ue.price)}}).filter(Ue=>!!Ue.label)})).filter(Qe=>Qe.options.length>0);if(!U.length)return null;const oe=Number.isFinite(q.maxGroups)?Math.max(1,Math.trunc(q.maxGroups)):U.length,Me=Number.isFinite(q.maxOptionsPerGroup)?Math.max(1,Math.trunc(q.maxOptionsPerGroup)):4,Ae=U.slice(0,oe);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Ae.map((Qe,Ue)=>{const St=Qe.name||"Bi\u1EBFn th\u1EC3",It=Qe.options.slice(0,Me),_e=Qe.options.length-It.length;return React.createElement("div",{key:`${St}-${Ue}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},St),It.map((lt,Yt)=>{const Ct=lt.price,Wt=Number.isFinite(Ct)&&Ct>=0?Ve(Math.trunc(Ct)):"",Bt=Wt?`${lt.label} \xB7 ${Wt}`:lt.label;return React.createElement("span",{key:`${St}-${Ue}-${Yt}`,className:"ktm-chip ktm-chip-option"},Bt)}),_e>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",_e))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:yt},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:Ge,onChange:x=>st(x.target.value)})),React.createElement("span",{className:"product-count"},C.length)),React.createElement("select",{className:"form-select",value:Fe,onChange:x=>ze(x.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),nt.map(x=>React.createElement("option",{key:x,value:x},x)))),re?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):C.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:yt},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},C.map(x=>React.createElement("div",{key:x.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>tn(x),onKeyDown:q=>{(q.key==="Enter"||q.key===" ")&&(q.preventDefault(),tn(x))},title:"Xem chi ti\u1EBFt"},x.image?React.createElement("img",{src:x.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},x.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},x.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},x.category),x.code&&React.createElement("span",{className:"product-badge bg-secondary"},x.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),be(x))),React.createElement("div",{className:"product-price"},x.price?x.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),x.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},x.note),de(x.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},de(x.attributes)),Te(x.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},Te(x.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:q=>{q.stopPropagation(),Rt(x)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:q=>{q.stopPropagation(),M(x)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:ne,title:String((K==null?void 0:K.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((K==null?void 0:K.code)||"").trim()||null,String((K==null?void 0:K.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:et,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const x=String((K==null?void 0:K.code)||"").trim();x&&window.KTM.clipboard.writeText(x).then(()=>$("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((K==null?void 0:K.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const x=String((K==null?void 0:K.price)||"").trim();x&&window.KTM.clipboard.writeText(x).then(()=>$("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((K==null?void 0:K.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>K&&Rt(K),disabled:!K},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>K&&M(K),disabled:!K},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},K?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const x=String((K==null?void 0:K.price)||"").trim(),q=wt(x);return Number.isFinite(q)&&q>0?Ve(Math.trunc(q)):x||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},be(K)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},K.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},K.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),K.image?React.createElement("img",{src:K.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(K.note||"").trim()||K.attributes||K.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(K.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(K.note||"").trim()),de(K.attributes)?React.createElement("div",{className:"mt-2"},de(K.attributes)):null,Te(K.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},Te(K.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:X,product:je,categories:nt,onClose:()=>Ee(!1),onSave:Pt}))}function ProductModal({show:$,product:E,categories:F,onClose:ye,onSave:re}){const[W,X]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Ee,je]=useState(!1),[ke,Ge]=useState(!1),st=M=>{const C=window.KTM.money.getDigits(String(M!=null?M:"")),z=Number(C);return C&&Number.isFinite(z)?Math.trunc(z):0},Fe=M=>{if(M==null||M==="")return[];let C=M;if(typeof C=="string"){const z=C.trim();if(!z)return[];try{C=JSON.parse(z)}catch(be){return[]}}return C&&typeof C=="object"&&!Array.isArray(C)&&(C=Object.entries(C).map(([z,be])=>({key:z,value:be}))),Array.isArray(C)?C.map(z=>{var de,Te,x,q,U;if(!z||typeof z!="object")return null;const be=String((x=(Te=(de=z.key)!=null?de:z.name)!=null?Te:z.label)!=null?x:"").trim(),ve=String((q=z.value)!=null?q:"").trim(),le=String((U=z.unit)!=null?U:"").trim();return be?{key:be,value:ve,unit:le}:null}).filter(Boolean):[]},ze=(M,C)=>{if(M==null||M==="")return[];let z=M;if(typeof z=="string"){const ve=z.trim();if(!ve)return[];try{z=JSON.parse(ve)}catch(le){return[]}}if(!Array.isArray(z))return[];const be=st(C);return z.map(ve=>{var Te;if(!ve||typeof ve!="object")return null;const le=String((Te=ve.name)!=null?Te:"").trim(),de=(Array.isArray(ve.options)?ve.options:[]).map(x=>{var Qe,Ue,St,It,_e,lt,Yt;if(!x||typeof x!="object")return null;const q=String((Qe=x.label)!=null?Qe:"").trim();if(!q)return null;const U=(_e=(It=(St=(Ue=x.price)!=null?Ue:x.priceValue)!=null?St:x.unit_price)!=null?It:x.unitPrice)!=null?_e:null,oe=Number(U);let Me=Number.isFinite(oe)?Math.trunc(oe):null;if(Me==null){const Ct=(Yt=(lt=x.price_delta)!=null?lt:x.priceDelta)!=null?Yt:null,Wt=Number(Ct);Number.isFinite(Wt)&&(Me=be+Math.trunc(Wt))}Me==null&&(Me=be);const Ae=String(Math.max(0,Math.trunc(Number(Me)||0)));return{label:q,price:Math.max(0,Math.trunc(Number(Me)||0)),priceDigits:Ae}}).filter(Boolean);return{name:le||"Bi\u1EBFn th\u1EC3",options:de}}).filter(Boolean)};useEffect(()=>{var M,C;X(E?{name:E.name||"",code:E.code||"",price:E.price||"",image:E.image||"",category:E.category||"",note:E.note||"",sort_order:E.sort_order||0,commission_percent:(C=(M=E.commission_percent)!=null?M:E.commissionPercent)!=null?C:5,variants:ze(E.variants,E.price),attributes:Fe(E.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[E,$]);const ne=M=>{X(C=>{var de;const z=st(C.price),be=String(z),ve=Array.isArray(C.variants)?[...C.variants]:[],le={...ve[M]||{},options:Array.isArray((de=ve[M])==null?void 0:de.options)?[...ve[M].options]:[]};return le.options=le.options.map(Te=>({label:String((Te==null?void 0:Te.label)||""),price:z,priceDigits:be})),ve[M]=le,{...C,variants:ve}})},Ke=()=>{X(M=>{const C=st(M.price),z=String(C),ve=(Array.isArray(M.variants)?[...M.variants]:[]).map(le=>{const de=(Array.isArray(le==null?void 0:le.options)?le.options:[]).map(Te=>({label:String((Te==null?void 0:Te.label)||""),price:C,priceDigits:z}));return{name:String((le==null?void 0:le.name)||"Bi\u1EBFn th\u1EC3"),options:de}});return{...M,variants:ve}})},[K,it]=React.useState(""),gt=M=>window.KTM.money.formatVNDInputDigits(M),[wt,Ve]=React.useState(""),nt=M=>{const C=window.KTM.money.nextPriceInputState(M.target.value,wt);Ve(C.digits),X({...W,price:C.price})},[Ie,yt]=React.useState("");React.useEffect(()=>{E!=null&&E.image&&yt(E.image)},[E]);const Rt=async M=>{if(!(!M||!M.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:M},"L\u1ED7i x\xF3a \u1EA3nh")}catch(C){console.error("Delete cloudinary image error:",C)}},tn=async(M,C=2,z)=>{const be=C*1024*1024,ve=M.type==="image/heic"||M.type==="image/heif"||/\.heic$/i.test(M.name);if(M.size<=be&&!ve)return M;z==null||z("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const le=await createImageBitmap(M);z==null||z("\u0110ang n\xE9n \u1EA3nh...");const de=document.createElement("canvas");let Te=le.width,x=le.height;const q=1200;return(Te>q||x>q)&&(Te>x?(x=Math.round(x/Te*q),Te=q):(Te=Math.round(Te/x*q),x=q)),de.width=Te,de.height=x,de.getContext("2d").drawImage(le,0,0,Te,x),le.close(),new Promise((oe,Me)=>{de.toBlob(Ae=>{Ae?(z==null||z("Ho\xE0n t\u1EA5t!"),oe(new File([Ae],M.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):Me(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(le){throw console.error("createImageBitmap error:",le),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},et=async M=>{var be,ve;const C=(be=M.target.files)==null?void 0:be[0];if(!C)return;if(!(C.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(C.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ge(!0),it("\u0110ang chu\u1EA9n b\u1ECB...");try{const le=(C.size/1024/1024).toFixed(1);it(`File ${le}MB - \u0110ang n\xE9n...`);const de=await tn(C,2,q=>{it(q)}),Te=(de.size/1024/1024).toFixed(1);it(`\u0110\xE3 n\xE9n: ${Te}MB - \u0110ang upload...`);const x=await window.KTM.cloudinary.uploadImage({file:de,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});x.secure_url?(W.image&&W.image!==Ie&&Rt(W.image),X(q=>({...q,image:x.secure_url})),it("")):(console.error("Cloudinary error:",x),alert("Upload th\u1EA5t b\u1EA1i: "+(((ve=x.error)==null?void 0:ve.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),it(""))}catch(le){console.error("Upload error:",le),alert("L\u1ED7i: "+le.message),it("")}Ge(!1),M.target.value=""},Dt=()=>{W.image&&(W.image!==Ie&&Rt(W.image),X(M=>({...M,image:""})))},Pt=async M=>{M.preventDefault(),je(!0),Ie&&W.image&&Ie!==W.image&&await Rt(Ie),Ie&&!W.image&&await Rt(Ie),await re(W),je(!1)};return $?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${E?"fa-edit":"fa-plus-circle"} me-2`}),E?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:ye})),React.createElement("form",{onSubmit:Pt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},W.image?React.createElement(React.Fragment,null,React.createElement("img",{src:W.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Dt,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${ke?"fa-spinner fa-spin":"fa-camera"} me-1`}),ke?K||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:et,disabled:ke,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),ke&&K&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},K))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:W.name,onChange:M=>X({...W,name:M.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:W.code,onChange:M=>X({...W,code:M.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:W.price,onChange:nt,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:W.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:M=>X({...W,commission_percent:M.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:W.category,onChange:M=>X({...W,category:M.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),F.map(M=>React.createElement("option",{key:M,value:M},M)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:W.note,onChange:M=>X({...W,note:M.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(W.attributes)?W.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(W.attributes)?W.attributes:[]).map((M,C)=>React.createElement("div",{key:C,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.key)||"",onChange:z=>{const be=z.target.value;X(ve=>{const le=Array.isArray(ve.attributes)?[...ve.attributes]:[];return le[C]={...le[C]||{},key:be},{...ve,attributes:le}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.value)||"",onChange:z=>{const be=z.target.value;X(ve=>{const le=Array.isArray(ve.attributes)?[...ve.attributes]:[];return le[C]={...le[C]||{},value:be},{...ve,attributes:le}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.unit)||"",onChange:z=>{const be=z.target.value;X(ve=>{const le=Array.isArray(ve.attributes)?[...ve.attributes]:[];return le[C]={...le[C]||{},unit:be},{...ve,attributes:le}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(z=>{const be=Array.isArray(z.attributes)?[...z.attributes]:[];return be.splice(C,1),{...z,attributes:be}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{X(M=>{const C=Array.isArray(M.attributes)?[...M.attributes]:[];return C.push({key:"",value:"",unit:""}),{...M,attributes:C}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(W.variants)?W.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(W.variants)?W.variants:[]).map((M,C)=>React.createElement("div",{key:C,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.name)||"",onChange:z=>{const be=z.target.value;X(ve=>{var de;const le=Array.isArray(ve.variants)?[...ve.variants]:[];return le[C]={...le[C]||{},name:be,options:Array.isArray((de=le[C])==null?void 0:de.options)?le[C].options:[]},{...ve,variants:le}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ne(C),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(M==null?void 0:M.options)||M.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{X(z=>{const be=Array.isArray(z.variants)?[...z.variants]:[];return be.splice(C,1),{...z,variants:be}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(M==null?void 0:M.options)?M.options:[]).map((z,be)=>{var ve,le;return React.createElement("div",{key:be,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(z==null?void 0:z.label)||"",onChange:de=>{const Te=de.target.value;X(x=>{var Ae,Qe,Ue,St,It;const q=Array.isArray(x.variants)?[...x.variants]:[],U={...q[C]||{},options:Array.isArray((Ae=q[C])==null?void 0:Ae.options)?[...q[C].options]:[]},oe=Number((Ue=(Qe=U.options[be])==null?void 0:Qe.price)!=null?Ue:0)||0,Me=String((It=(St=U.options[be])==null?void 0:St.priceDigits)!=null?It:Math.max(0,Math.trunc(oe)));return U.options[be]={...U.options[be]||{},label:Te,price:Math.max(0,Math.trunc(oe)),priceDigits:Me},q[C]=U,{...x,variants:q}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:gt(String((le=z==null?void 0:z.priceDigits)!=null?le:window.KTM.money.getDigits(String((ve=z==null?void 0:z.price)!=null?ve:"")))),onChange:de=>{X(Te=>{var Ue,St,It,_e,lt;const x=String((St=z==null?void 0:z.priceDigits)!=null?St:window.KTM.money.getDigits(String((Ue=z==null?void 0:z.price)!=null?Ue:""))),q=window.KTM.money.nextPriceInputState(de.target.value,x),U=String((It=q.digits)!=null?It:""),oe=Number(U),Me=Number.isFinite(oe)?Math.max(0,Math.trunc(oe)):0,Ae=Array.isArray(Te.variants)?[...Te.variants]:[],Qe={...Ae[C]||{},options:Array.isArray((_e=Ae[C])==null?void 0:_e.options)?[...Ae[C].options]:[]};return Qe.options[be]={...Qe.options[be]||{},label:String(((lt=Qe.options[be])==null?void 0:lt.label)||""),price:Me,priceDigits:U},Ae[C]=Qe,{...Te,variants:Ae}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(de=>{var q;const Te=Array.isArray(de.variants)?[...de.variants]:[],x={...Te[C]||{},options:Array.isArray((q=Te[C])==null?void 0:q.options)?[...Te[C].options]:[]};return x.options.splice(be,1),Te[C]=x,{...de,variants:Te}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{X(z=>{var de;const be=Array.isArray(z.variants)?[...z.variants]:[],ve={...be[C]||{},options:Array.isArray((de=be[C])==null?void 0:de.options)?[...be[C].options]:[]},le=st(z.price);return ve.options.push({label:"",price:le,priceDigits:String(le)}),be[C]=ve,{...z,variants:be}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{X(M=>{const C=st(M.price),z=Array.isArray(M.variants)?[...M.variants]:[],be=String(C);return z.push({name:"Size",options:[{label:"S",price:C,priceDigits:be},{label:"M",price:C,priceDigits:be},{label:"L",price:C,priceDigits:be}]}),{...M,variants:z}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Ke,disabled:!Array.isArray(W.variants)||W.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:W.image,onChange:M=>X({...W,image:M.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:ye,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Ee,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:$,video:E,onClose:F,onSave:ye}){const[re,W]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[X,Ee]=useState(!1),[je,ke]=useState("");useEffect(()=>{E?(W({title:E.title||"",youtube_url:`https://www.youtube.com/watch?v=${E.youtubeId}`,thumbnail_url:E.thumb||"",sort_order:E.sortOrder||0}),ke(E.thumb)):(W({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),ke(""))},[E,$]);const Ge=ze=>{const ne=ze.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return ne?ne[1]:null},st=ze=>{W({...re,youtube_url:ze});const ne=Ge(ze);ne&&ke(`https://img.youtube.com/vi/${ne}/hqdefault.jpg`)},Fe=async ze=>{ze.preventDefault(),Ee(!0),await ye(re),Ee(!1)};return $?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},E?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:F})),React.createElement("form",{onSubmit:Fe},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:re.youtube_url,onChange:ze=>st(ze.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),je&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:je,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:re.title,onChange:ze=>W({...re,title:ze.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:re.sort_order,onChange:ze=>W({...re,sort_order:parseInt(ze.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:re.thumbnail_url,onChange:ze=>W({...re,thumbnail_url:ze.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:F},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function getCurrentMonth(){const $=new Date,E=$.getFullYear(),F=String($.getMonth()+1).padStart(2,"0");return`${E}-${F}`}function ReconExcelManager({showToast:$}){var bn;const E=typeof $=="function"?$:()=>{},[F,ye]=useState(getCurrentMonth()),re=F,W=ye,[X,Ee]=useState(!1),[je,ke]=useState(""),[Ge,st]=useState(""),[Fe,ze]=useState(""),[ne,Ke]=useState(null),[K,it]=useState("all"),[gt,wt]=useState(""),[Ve,nt]=useState(!0),[Ie,yt]=useState(!0),[Rt,tn]=useState(!1),[et,Dt]=useState("created_at"),[Pt,M]=useState(!1),[C,z]=useState(0),[be,ve]=useState(!1),[le,de]=useState(""),[Te,x]=useState(()=>new Set),[q,U]=useState(!1),[oe,Me]=useState(null),Ae=useRef(new Map),Qe=useRef(new Map),Ue=useRef(null),[St,It]=useState(()=>{var s;return(s=window==null?void 0:window.XLSX)!=null&&s.read?"ready":"loading"}),_e=s=>new Promise((c,v)=>{var p;try{const T=document.querySelector(`script[data-ktm-xlsx="${s}"]`);if(T){if((p=window==null?void 0:window.XLSX)!=null&&p.read)return c(!0);T.addEventListener("load",()=>c(!0),{once:!0}),T.addEventListener("error",()=>v(new Error("load failed")),{once:!0});return}const P=document.createElement("script");P.src=s,P.async=!0,P.defer=!0,P.setAttribute("data-ktm-xlsx",s),P.onload=()=>c(!0),P.onerror=()=>v(new Error("load failed")),document.head.appendChild(P)}catch(T){v(T)}}),lt=async()=>{var c;if((c=window==null?void 0:window.XLSX)!=null&&c.read)return!0;if(Ue.current)return Ue.current;const s=["https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js","https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js","https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"];return Ue.current=(async()=>{var v,p;for(const T of s)try{if(await _e(T),(v=window==null?void 0:window.XLSX)!=null&&v.read)return!0}catch(P){}return!!((p=window==null?void 0:window.XLSX)!=null&&p.read)})(),Ue.current};useEffect(()=>{let s=!1;return(async()=>{var c;try{if((c=window==null?void 0:window.XLSX)!=null&&c.read){s||It("ready");return}s||It("loading");const v=await lt();s||It(v?"ready":"failed")}catch(v){s||It("failed")}})(),()=>{s=!0}},[]);const Yt=s=>{const c=[],v=String(s!=null?s:"").split(/\s+/g);for(const p of v){const T=String(p||"").trim();T&&c.push(T)}return c.join(" ").replace(/\s+/g," ").trim()},Ct=s=>{try{return String(s!=null?s:"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,c=>c==="\u0111"?"d":"D")}catch(c){return String(s!=null?s:"").replace(/[đĐ]/g,v=>v==="\u0111"?"d":"D")}},Wt=s=>{const c=Yt(String(s!=null?s:""));return c?Ct(c).toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim():""},Bt=s=>{const c=Wt(s);return c?c.replace(/\b(combo|set|sp|san\s*pham|sanpham|hang|ship|freeship|free\s*ship)\b/g," ").replace(/\s+/g," ").trim():""},yn=s=>{var P,_;if(s==null||s==="")return"";if(typeof s=="number"&&Number.isFinite(s)&&((_=(P=window==null?void 0:window.XLSX)==null?void 0:P.SSF)!=null&&_.parse_date_code))try{const b=window.XLSX.SSF.parse_date_code(s);return!b||!b.y||!b.m?"":`${String(b.y).padStart(4,"0")}-${String(b.m).padStart(2,"0")}`}catch(b){}const c=String(s).trim(),v=c.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(v){const b=String(Number(v[2])||0).padStart(2,"0");return`${v[3]}-${b}`}const p=c.match(/^(\d{4})-(\d{2})-(\d{2})/);if(p)return`${p[1]}-${p[2]}`;const T=new Date(c);return Number.isNaN(T.getTime())?"":`${T.getFullYear()}-${String(T.getMonth()+1).padStart(2,"0")}`},pn=s=>{var P,_;if(s==null||s==="")return"";if(typeof s=="number"&&Number.isFinite(s)&&((_=(P=window==null?void 0:window.XLSX)==null?void 0:P.SSF)!=null&&_.parse_date_code))try{const b=window.XLSX.SSF.parse_date_code(s);return!b||!b.y||!b.m||!b.d?"":`${String(b.y).padStart(4,"0")}-${String(b.m).padStart(2,"0")}-${String(b.d).padStart(2,"0")}`}catch(b){}const c=String(s).trim(),v=c.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(v){const b=String(Number(v[1])||0).padStart(2,"0"),S=String(Number(v[2])||0).padStart(2,"0");return`${v[3]}-${S}-${b}`}const p=c.match(/^(\d{4})-(\d{2})-(\d{2})/);if(p)return`${p[1]}-${p[2]}-${p[3]}`;const T=new Date(c);return Number.isNaN(T.getTime())?"":`${T.getFullYear()}-${String(T.getMonth()+1).padStart(2,"0")}-${String(T.getDate()).padStart(2,"0")}`},R=s=>{if(s==null||s==="")return 0;if(typeof s=="number"&&Number.isFinite(s))return Math.trunc(s);const c=String(s!=null?s:"").trim();if(!c)return 0;try{const P=window.KTM.money.parseMoney(c);if(Number.isFinite(P)&&P>0)return Math.trunc(P)}catch(P){}const p=c.toLowerCase().replace(/vnd|đ|d/g," ").replace(/\s+/g," ").trim().replace(/[^0-9]/g,"");if(!p)return 0;const T=Number(p);return Number.isFinite(T)?Math.trunc(T):0},Y=s=>{var v,p;let c="";try{(p=(v=window==null?void 0:window.KTM)==null?void 0:v.phone)!=null&&p.normalize&&(c=window.KTM.phone.normalize(s))}catch(T){}return c||(c=String(s!=null?s:"").replace(/[^0-9]/g,"")),c=String(c||"").replace(/[^0-9]/g,""),c?(c.startsWith("840")?c=`0${c.slice(3)}`:c.startsWith("84")&&(c.length===11?c=`0${c.slice(2)}`:c.length===12&&c[2]!=="0"&&(c=`0${c.slice(2)}`)),c.length===9&&(c=`0${c}`),c):""},mt=(s,c)=>{try{const v=Array.isArray(c)?c:[],p=S=>{const Q=String(S!=null?S:"");return/[\n\r",]/.test(Q)?`"${Q.replace(/"/g,'""')}"`:Q},T=v.map(S=>Array.isArray(S)?S.map(p).join(","):"").join(`
`),P=new Blob([`\uFEFF${T}`],{type:"text/csv;charset=utf-8"}),_=URL.createObjectURL(P),b=document.createElement("a");b.href=_,b.download=s,document.body.appendChild(b),b.click(),setTimeout(()=>{try{URL.revokeObjectURL(_)}catch(S){}try{b.remove()}catch(S){}},0)}catch(v){}},Et=s=>{const c=String(s!=null?s:"");if(!c.trim())return{phone:"",phoneNorm:"",cleanedText:String(s!=null?s:"").trim()};const v=/(?:\+?84|0)\s*[0-9\s\-.()]{8,16}/g;let p=null,T;for(;(T=v.exec(c))!=null;){const S=T[0],Q=Y(S);Q&&(Q.length<9||Q.length>12||(p={raw:S,digits:Q}))}if(!p){const S=Y(c);if(S.length>=9){const Q=S.slice(-12);Q.length>=9&&(p={raw:Q,digits:Q})}}if(!p)return{phone:"",phoneNorm:"",cleanedText:c.trim()};const P=p.digits,_=P;let b=c;return p.raw&&c.includes(p.raw)?b=b.replace(p.raw," "):b=b.replace(new RegExp(`${p.digits}$`)," "),b=b.replace(/[\-–—•|]+\s*$/g," ").replace(/\s+[\-–—•|]+\s*/g," ").replace(/\s+/g," ").trim(),{phone:_,phoneNorm:P,cleanedText:b}},hn=async()=>{var c;const s=Ae.current;if(s&&s.size>0)return s;try{const v=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m"),p=Array.isArray(v==null?void 0:v.products)?v.products:Array.isArray(v)?v:[],T=new Map;for(const P of p){const _=String((c=P==null?void 0:P.id)!=null?c:"").trim();_&&T.set(_,P)}return Ae.current=T,T}catch(v){return Ae.current=new Map,Ae.current}},Kt=s=>{var v;const c=String(s!=null?s:"").trim();return c&&((v=Ae.current)==null?void 0:v.get(c))||null},Qt=async s=>{var S,Q,H;if(!s)throw new Error("Ch\u01B0a ch\u1ECDn file");const c=await s.arrayBuffer(),v=Number(s.size||0)||0;if(!!!(window!=null&&window.Worker&&typeof Blob!="undefined"&&typeof URL!="undefined")||v<450*1024){if(!((S=window==null?void 0:window.XLSX)!=null&&S.read))try{await lt()}catch(Ne){}if(!((Q=window==null?void 0:window.XLSX)!=null&&Q.read))throw new Error("Thi\u1EBFu th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). Vui l\xF2ng t\u1EA3i l\u1EA1i trang admin.");const ge=window.XLSX.read(c,{type:"array"}),se=(H=ge==null?void 0:ge.SheetNames)==null?void 0:H[0],ue=se?ge.Sheets[se]:null;if(!ue)throw new Error("Kh\xF4ng \u0111\u1ECDc \u0111\u01B0\u1EE3c sheet trong file");return window.XLSX.utils.sheet_to_json(ue,{header:1,raw:!0,defval:""})}const T=`
					const sources = [
						'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js',
						'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js',
						'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js',
					];

					const hasXlsx = () => Boolean(self.XLSX && typeof self.XLSX.read === 'function');
					const ensureXlsx = async () => {
						if (hasXlsx()) return true;
						for (const src of sources) {
							try {
								self.importScripts(src);
								if (hasXlsx()) return true;
							} catch (e) {
								// try next
							}
						}
						return hasXlsx();
					};

					self.onmessage = async (ev) => {
						try {
							const data = ev && ev.data;
							const buf = data && data.buf;
							const ok = await ensureXlsx();
							if (!ok) throw new Error('XLSX not available');
							const wb = self.XLSX.read(buf, { type: 'array' });
							const sheetName = wb && wb.SheetNames && wb.SheetNames[0];
							const ws = sheetName ? wb.Sheets[sheetName] : null;
							if (!ws) throw new Error('No sheet');
							const grid = self.XLSX.utils.sheet_to_json(ws, { header: 1, raw: true, defval: '' });
							self.postMessage({ ok: true, grid });
						} catch (e) {
							self.postMessage({ ok: false, error: String((e && e.message) || e || 'worker error') });
						}
					};
				`,P=new Blob([T],{type:"application/javascript"}),_=URL.createObjectURL(P),b=new Worker(_);try{return await new Promise((se,ue)=>{const Ne=setTimeout(()=>{try{b.terminate()}catch(Oe){}ue(new Error("Worker timeout"))},12e3);b.onmessage=Oe=>{const He=Oe&&Oe.data;He&&He.ok?(clearTimeout(Ne),se(He.grid)):He&&He.ok===!1&&(clearTimeout(Ne),ue(new Error(He.error||"Worker failed")))},b.onerror=()=>{clearTimeout(Ne),ue(new Error("Worker error"))};try{b.postMessage({buf:c},[c])}catch(Oe){b.postMessage({buf:c})}})}finally{try{b.terminate()}catch(ge){}try{URL.revokeObjectURL(_)}catch(ge){}}},j=async s=>{var Q,H;if(!s)throw new Error("Ch\u01B0a ch\u1ECDn file");const c=await Qt(s),v=Array.isArray(c)?c:[];if(!v.length)throw new Error("File r\u1ED7ng");const p={product:["ten san pham","tensanpham","san pham","t\xEAn s\u1EA3n ph\u1EA9m"],cod:["tong tien thu ho","t\u1ED5ng ti\u1EC1n thu h\u1ED9","thu ho","thu h\u1ED9","tong thu ho","t\u1ED5ng thu h\u1ED9"],date:["ngay","ng\xE0y","date"],phone:["sdt","s\u0111t","so dien thoai","s\u1ED1 \u0111i\u1EC7n tho\u1EA1i","dien thoai","\u0111i\u1EC7n tho\u1EA1i","phone"],qty:["sl","so luong","s\u1ED1 l\u01B0\u1EE3ng","qty","quantity"]},P=(()=>{const ge=Math.min(30,v.length);for(let se=0;se<ge;se++){const Ne=(Array.isArray(v[se])?v[se]:[]).map(Xe=>Wt(Xe)),Oe=Xe=>{for(let O=0;O<Ne.length;O++){const De=Ne[O];if(De&&Xe.some(We=>De.includes(Wt(We))))return O}return-1},He=Oe(p.product),Ce=Oe(p.cod);if(He>=0&&Ce>=0){const Xe=Oe(p.date),O=Oe(p.phone),De=Oe(p.qty);return{headerRow:se,productCol:He,codCol:Ce,dateCol:Xe,phoneCol:O,qtyCol:De}}}return null})();if(!P)throw new Error('Kh\xF4ng t\xECm th\u1EA5y header c\u1ED9t "T\xEAn s\u1EA3n ph\u1EA9m" v\xE0 "T\u1ED5ng ti\u1EC1n thu h\u1ED9"');const _=[],b=new Set,S=ge=>{const se=String(ge!=null?ge:"").trim();if(!se)return{text:"",qty:null};let ue=se.match(/^\s*x\s*(\d{1,3})\s+(.+)$/i);return ue?{text:String(ue[2]||"").trim(),qty:Number(ue[1])}:(ue=se.match(/^\s*(\d{1,3})\s*(?:x|\*|×)?\s+(.+)$/i),ue?{text:String(ue[2]||"").trim(),qty:Number(ue[1])}:{text:se,qty:null})};for(let ge=P.headerRow+1;ge<v.length;ge++){const se=Array.isArray(v[ge])?v[ge]:[],ue=String((Q=se[P.productCol])!=null?Q:"").trim(),Ne=S(ue),Oe=Ne.text,He=R(se[P.codCol]),Ce=P.qtyCol>=0?se[P.qtyCol]:"",Xe=(()=>{if(Ce!=null&&Ce!==""){if(typeof Ce=="number"&&Number.isFinite(Ce))return{qty:Math.max(1,Math.trunc(Ce)),source:"cell"};const Jt=String(Ce).trim(),nn=Number(Jt.replace(/[^0-9]/g,""));if(Number.isFinite(nn)&&nn>0)return{qty:Math.max(1,Math.trunc(nn)),source:"cell"}}const ft=Number(Ne.qty);return Number.isFinite(ft)&&ft>1?{qty:Math.max(1,Math.trunc(ft)),source:"text"}:{qty:1,source:"default"}})(),O=Xe.qty,De=Xe.source,We=De==="cell"&&O>1&&He>0&&O<=50?He*O:0,ut=Array.from(new Set([He,We].filter(ft=>Number(ft||0)>0))),h=He;if(!Oe&&!h)continue;const Se=P.phoneCol>=0?String((H=se[P.phoneCol])!=null?H:"").trim():"",pt=Y(Se);let w=Et(Oe);if(pt&&(w={...w,phone:pt,phoneNorm:pt}),!w.phoneNorm){const ft=se.map(nn=>String(nn!=null?nn:"")).join(" | "),Jt=Et(ft);Jt.phoneNorm&&(w={...w,phone:Jt.phone,phoneNorm:Jt.phoneNorm})}const ie=w.cleanedText||Oe,Be=Wt(ie);if(!Be||Be.includes("tong tien")||Be.includes("tong")||Be.includes("thanh toan")||Be.includes("thanh to\xE1n"))continue;const tt=P.dateCol>=0?se[P.dateCol]:"",At=tt?yn(tt):"";At&&b.add(At);const Zt=tt?pn(tt):"";_.push({rowIndex:ge+1,dateRaw:tt,monthKey:At,dayKey:Zt,product:ie,productNorm:Bt(ie),productCompact:Bt(ie).replace(/\s+/g,""),phone:w.phone,phoneNorm:w.phoneNorm,cod:h,codRaw:He,qty:O,qtySource:De,codAlt:We,codCandidates:ut})}return{rows:_,monthKeys:Array.from(b.values()).sort()}},d=s=>{const c=new Map,v=(b,S)=>{const Q=c.get(b)||{key:b,rows:[],phoneNorm:"",phone:"",monthKey:"",dayKey:""};Q.rows.push(S),!Q.phoneNorm&&S.phoneNorm&&(Q.phoneNorm=S.phoneNorm,Q.phone=S.phone||S.phoneNorm),!Q.monthKey&&S.monthKey&&(Q.monthKey=S.monthKey),!Q.dayKey&&S.dayKey&&(Q.dayKey=S.dayKey),c.set(b,Q)};for(const b of Array.isArray(s)?s:[]){const S=String((b==null?void 0:b.phoneNorm)||"").trim(),Q=String((b==null?void 0:b.dayKey)||"").trim(),H=String((b==null?void 0:b.monthKey)||"").trim();if(S){const ge=Q?`p:${S}:d:${Q}`:H?`p:${S}:m:${H}`:`p:${S}`;v(ge,b)}else v(`r:${b==null?void 0:b.rowIndex}`,b)}const p=b=>{const S=Number((b==null?void 0:b.cod)||0)||0;if(S>0)return S;const Q=Number((b==null?void 0:b.codAlt)||0)||0;return Q>0?Q:0},T=b=>{var ge;const S=((b==null?void 0:b.rows)||[]).slice().filter(Boolean);if(S.length<=1)return[{key:b.key,rows:S,phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey}];const Q=S.map(p).filter(se=>se>0),H=Array.from(new Set(Q));if(b.phoneNorm&&b.dayKey&&H.length>1&&H.length<=8){const se=new Map;for(const Ne of H)se.set(String(Ne),{key:`${b.key}:t:${Ne}`,rows:[],phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey});const ue=[];for(const Ne of S){const Oe=p(Ne);Oe>0?se.get(String(Oe)).rows.push(Ne):ue.push(Ne)}if(ue.length){const Ne=Array.from(se.values()).map(Oe=>{const He=Oe.rows.find(Ce=>String((Ce==null?void 0:Ce.productNorm)||"").trim())||null;return{group:Oe,seedNorm:String((He==null?void 0:He.productNorm)||"")}});for(const Oe of ue){const He=String((Oe==null?void 0:Oe.productNorm)||"");let Ce=null,Xe=-1;for(const O of Ne){const De=Re(He,O.seedNorm);De>Xe&&(Xe=De,Ce=O.group)}(Ce||((ge=Ne[0])==null?void 0:ge.group)).rows.push(Oe)}}return Array.from(se.values()).filter(Ne=>Ne.rows.length>0)}return[{key:b.key,rows:S,phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey}]},P=[];for(const b of c.values())P.push(...T(b));const _=b=>{var We,ut,h;const S=b.rows.slice().filter(Boolean),Q=S.map(Se=>Se.rowIndex).filter(Boolean),H=[],ge=new Set;for(const Se of S){const pt=String((Se==null?void 0:Se.productNorm)||"").trim();pt&&(ge.has(pt)||(ge.add(pt),H.push(String((Se==null?void 0:Se.product)||"").trim())))}const se=H.filter(Boolean).join(" + "),ue=Wt(se),Ne=[];for(const Se of S){const pt=Array.isArray(Se==null?void 0:Se.codCandidates)?Se.codCandidates:[];for(const w of pt){const ie=Number(w||0)||0;ie>0&&Ne.push(ie)}}const Oe=Array.from(new Set(Ne)).sort((Se,pt)=>Se-pt),He=S.map(Se=>p(Se)).filter(Se=>Se>0);let Ce=0;if(!He.length)Ce=0;else{const Se=new Map;for(const w of He)Se.set(w,(Se.get(w)||0)+1);const pt=Array.from(Se.keys());if(pt.length===1)Ce=pt[0];else{let w=null,ie=0;for(const[Be,tt]of Se.entries())tt>ie&&(ie=tt,w=Be);w!=null&&ie>=2?Ce=w:Ce=He.reduce((Be,tt)=>Be+tt,0)}}const Xe=b.monthKey||((We=S.find(Se=>Se==null?void 0:Se.monthKey))==null?void 0:We.monthKey)||"",O=((ut=S.find(Se=>Se==null?void 0:Se.dayKey))==null?void 0:ut.dayKey)||"",De=((h=S.find(Se=>Se==null?void 0:Se.dateRaw))==null?void 0:h.dateRaw)||"";return{key:b.key,phoneNorm:b.phoneNorm||"",phone:b.phone||b.phoneNorm||"",monthKey:Xe,dayKey:O,dateRaw:De,rowIndices:Q,rowIndexFirst:Q.length?Math.min(...Q):null,rowCount:S.length,productDisplay:se,productNorm:ue,productCompact:String(ue||"").replace(/\s+/g,""),cod:Ce,codCandidates:Oe,rows:S}};return P.map(_)},V=async s=>{const c=`${API_BASE}/api/orders?month=${encodeURIComponent(s)}&includeItems=1`,v=await window.KTM.api.getJSON(c,"L\u1ED7i t\u1EA3i danh s\xE1ch \u0111\u01A1n");return Array.isArray(v==null?void 0:v.orders)?v.orders:Array.isArray(v)?v:[]},ae=async s=>{var S,Q;const c=Array.isArray(s)&&s.length?s:[F],v=[],p=5*60*1e3;for(let H=0;H<c.length;H++){const ge=c[H],se=(S=Qe.current)==null?void 0:S.get(ge);if(se&&Date.now()-Number(se.at||0)<p&&Array.isArray(se.records)){v.push(...se.records);continue}st(`\u0110ang t\u1EA3i \u0111\u01A1n h\u1EC7 th\u1ED1ng th\xE1ng ${ge} (${H+1}/${c.length})...`);const ue=await V(ge);(Q=Qe.current)==null||Q.set(ge,{at:Date.now(),records:ue}),v.push(...ue)}const T=H=>String(H||"").trim().toLowerCase(),P=v.filter(H=>{const ge=T(H==null?void 0:H.status);return!(Ve&&ge==="draft"||Ie&&ge==="canceled"||Rt&&ge==="paid")}),_=H=>{var se,ue,Ne;return String(et||"created_at")==="updated_at"?(ue=(se=H==null?void 0:H.updated_at)!=null?se:H==null?void 0:H.created_at)!=null?ue:null:(Ne=H==null?void 0:H.created_at)!=null?Ne:null};return P.map(H=>{var Ce,Xe,O,De,We,ut;const ge=window.KTM.orders.getOrderProductSummary(H,Kt),se=window.KTM.orders.getOrderTotalMoney(H,Kt),ue=Bt(ge),Ne=Y((Ce=H==null?void 0:H.phone)!=null?Ce:""),Oe=_(H),He=(()=>{if(!Oe)return"";const h=new Date(Oe);return Number.isNaN(h.getTime())?"":`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")}`})();return{id:String((Xe=H==null?void 0:H.id)!=null?Xe:""),created_at:(O=H==null?void 0:H.created_at)!=null?O:null,updated_at:(De=H==null?void 0:H.updated_at)!=null?De:null,dayKey:He,status:String((We=H==null?void 0:H.status)!=null?We:""),phone:String((ut=H==null?void 0:H.phone)!=null?ut:""),phoneNorm:Ne,productSummary:ge,productNorm:ue,productCompact:ue.replace(/\s+/g,""),cod:Number(se||0)||0,raw:H}}).filter(H=>H.id&&H.cod>0)},Re=(s,c)=>{const v=String(s||"").trim(),p=String(c||"").trim();if(!v||!p)return 0;if(v===p)return 1;const T=v.replace(/\s+/g,""),P=p.replace(/\s+/g,"");if(T&&P&&T===P)return 1;if(T&&P&&(P.includes(T)||T.includes(P)))return .92;const _=Ce=>String(Ce||"").replace(/[\+]/g," ").replace(/[()\[\]{},.;:!?]/g," ").replace(/\s+/g," ").trim().split(" ").map(De=>De.trim()).filter(Boolean).map(De=>De.replace(/[^a-z0-9]/g,"")).filter(Boolean).filter(De=>De.length>1),b=_(v),S=_(p);if(!b.length||!S.length)return 0;const Q=new Set(S),H=(Ce,Xe)=>{if(Ce===Xe)return 0;const O=Ce.length,De=Xe.length;if(Math.abs(O-De)>1)return 2;let We=0,ut=0,h=0;for(;We<O&&ut<De;){if(Ce[We]===Xe[ut]){We+=1,ut+=1;continue}if(h+=1,h>1)return h;O>De?We+=1:(De>O||(We+=1),ut+=1)}return(We<O||ut<De)&&(h+=1),h},ge=Ce=>/[0-9]/.test(Ce)?2:1;let se=0,ue=0;for(const Ce of b){const Xe=ge(Ce);if(ue+=Xe,Q.has(Ce)||P&&P.includes(Ce)){se+=Xe;continue}if(Ce.length>=4){let O=!1;for(const De of S){if(De===Ce){O=!0;break}if(De.includes(Ce)||Ce.includes(De)){O=!0;break}if(P&&P.includes(Ce)){O=!0;break}if(H(Ce,De)<=1){O=!0;break}}O&&(se+=Xe*.8)}}const Ne=se/Math.max(1,ue),Oe=Math.min(.12,Math.abs(v.length-p.length)/Math.max(1,Math.max(v.length,p.length))),He=(()=>{const Ce=b.filter(O=>/[0-9]/.test(O)&&O.length>=3);if(!Ce.length)return 0;let Xe=0;for(const O of Ce)(Q.has(O)||P&&P.includes(O))&&(Xe+=1);return Math.min(.08,.04*Xe)})();return Math.max(0,Math.min(1,Ne-Oe+He))},Pe=s=>{const v=String(s||"").trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!v)return null;const p=new Date(Number(v[1]),Number(v[2])-1,Number(v[3]));return Number.isNaN(p.getTime())?null:p.getTime()},Je=(s,c)=>{const v=Array.isArray(s==null?void 0:s.codCandidates)&&s.codCandidates.length?s.codCandidates:[Number((s==null?void 0:s.cod)||0)||0],p=Number((c==null?void 0:c.cod)||0)||0;let T=1/0,P=0;for(const _ of v){const b=Number(_||0)||0;if(b<=0)continue;const S=Math.abs(p-b);S<T&&(T=S,P=b)}return Number.isFinite(T)||(T=1/0),{bestDiff:T,bestCand:P,oCod:p}},vt=(s,c,v)=>{const p=String((s==null?void 0:s.phoneNorm)||"").trim(),T=!!(p&&String((c==null?void 0:c.phoneNorm)||"")===p),P=Math.max(0,Number((v==null?void 0:v.codTolerance)||0)||0),{bestDiff:_,bestCand:b}=Je(s,c),S=_===0,Q=Number.isFinite(_)&&P>0&&_>0&&_<=P,H=String((s==null?void 0:s.dayKey)||"").trim(),ge=String((c==null?void 0:c.dayKey)||"").trim(),se=!!(H&&ge&&H===ge),ue=(()=>{if(!H||!ge)return!1;const h=Pe(H),Se=Pe(ge);if(h==null||Se==null)return!1;const pt=Math.abs(h-Se)/(24*60*60*1e3);return pt>0&&pt<=1.01})(),Ne=Re(String((s==null?void 0:s.productNorm)||""),String((c==null?void 0:c.productNorm)||"")),He=!!p?{phone:.5,cod:.3,day:.08,name:.12}:{phone:0,cod:.45,day:.1,name:.45},Ce=T?He.phone:0,Xe=S?He.cod:Q?He.cod*(1-_/Math.max(1,P)):0,O=se?He.day:ue?He.day*.6:0,De=Math.max(0,Math.min(1,Ne))*He.name,We=Ce+Xe+O+De,ut=[];return T&&ut.push("S\u0110T tr\xF9ng"),S?ut.push("COD tr\xF9ng"):Q?ut.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(_)} (<= ${window.KTM.money.formatNumber(P)})`):b>0&&Number.isFinite(_)&&_!==1/0&&ut.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(_)}`),se?ut.push("C\xF9ng ng\xE0y"):ue&&ut.push("Ng\xE0y g\u1EA7n \u0111\xFAng (\xB11)"),Ne>=.8?ut.push(`T\xEAn t\u01B0\u01A1ng \u0111\u01B0\u01A1ng ${Math.round(Ne*100)}%`):Ne>=.6&&ut.push(`T\xEAn t\u01B0\u01A1ng \u0111\u01B0\u01A1ng ${Math.round(Ne*100)}%`),{score:We,reasons:ut,nameSim:Ne,phoneMatch:T,codExact:S,codWithin:Q,codDiff:_,bestCand:b}},Ze=s=>{let c=String(s!=null?s:"");return c=c.replace(/^\s*(?:x\s*)?(\d{1,3})\s*(?:x|\*|×)?\s*/i," "),c=c.replace(/\s+/g," ").trim(),Bt(c)},un=s=>{var P;const c=new Map,v=new Map,p=Array.isArray(s==null?void 0:s.rows)?s.rows:[],T=p.length>1||p.some(_=>String((_==null?void 0:_.qtySource)||"default")!=="default");for(const _ of p){const b=String((_==null?void 0:_.product)||"").trim(),S=Ze(b);if(!S)continue;const Q=Math.max(1,Number((P=_==null?void 0:_.qty)!=null?P:1)||1),H=T?Q:1;c.set(S,(c.get(S)||0)+H),v.has(S)||v.set(S,b)}return{qtyByKey:c,labelByKey:v,qtyReliable:T}},qt=s=>{var b;const c=new Map,v=new Map,p=(s==null?void 0:s.raw)||null,T=Array.isArray(p==null?void 0:p.items)?p.items:[];if(T.length){for(const S of T){const Q=S==null?void 0:S.product_id,H=Q?Kt(Q):null,ge=String((H==null?void 0:H.name)||(S==null?void 0:S.product_name)||"").trim(),se=String((S==null?void 0:S.variant)||"").trim(),ue=(ge||(s==null?void 0:s.productSummary)||"").trim()+(se?` (${se})`:""),Ne=Ze(ue);if(!Ne)continue;const Oe=Math.max(1,Number((b=S==null?void 0:S.quantity)!=null?b:1)||1);c.set(Ne,(c.get(Ne)||0)+Oe),v.has(Ne)||v.set(Ne,ge||ue)}return{qtyByKey:c,labelByKey:v}}const P=String((s==null?void 0:s.productSummary)||"").trim();if(!P)return{qtyByKey:c,labelByKey:v};const _=P.split("+").map(S=>String(S||"").trim()).filter(Boolean);for(const S of _){const Q=S.match(/\bx\s*(\d{1,3})\b/i),H=Q?Math.max(1,Number(Q[1])||1):1,ge=S.replace(/\bx\s*\d{1,3}\b/ig," ").replace(/\s+/g," ").trim(),se=Ze(ge);se&&(c.set(se,(c.get(se)||0)+H),v.has(se)||v.set(se,ge))}return{qtyByKey:c,labelByKey:v}},Gt=(s,c)=>{const v=un(s),p=qt(c),T=Array.from(v.qtyByKey.keys()),P=Array.from(p.qtyByKey.keys()),_=[];for(const ue of T)for(const Ne of P){const Oe=Re(ue,Ne);Oe>=.9&&_.push({ek:ue,sk:Ne,sc:Oe})}_.sort((ue,Ne)=>Ne.sc-ue.sc);const b=new Map,S=new Set,Q=new Set;for(const ue of _)S.has(ue.ek)||Q.has(ue.sk)||(b.set(ue.ek,ue.sk),S.add(ue.ek),Q.add(ue.sk));const H=[],ge=[];for(const[ue,Ne]of v.qtyByKey.entries()){const Oe=b.get(ue)||ue,He=p.qtyByKey.get(Oe)||0;He<Ne&&H.push({name:v.labelByKey.get(ue)||ue,qty:Ne-He})}for(const[ue,Ne]of p.qtyByKey.entries()){let Oe=v.qtyByKey.get(ue)||0;if(!Oe){for(const[He,Ce]of b.entries())if(Ce===ue){Oe=v.qtyByKey.get(He)||0;break}}Oe<Ne&&ge.push({name:p.labelByKey.get(ue)||ue,qty:Ne-Oe})}return{hasDiff:H.length>0||ge.length>0,missingInSystem:H,missingInExcel:ge}},on=s=>{if(!(s!=null&&s.hasDiff))return"";const c=p=>p.slice(0,4).map(T=>`${T.name} x${T.qty}`).join(", ")+(p.length>4?` (+${p.length-4})`:""),v=[];return Array.isArray(s.missingInExcel)&&s.missingInExcel.length&&v.push(`Thi\u1EBFu trong Excel: ${c(s.missingInExcel)}`),Array.isArray(s.missingInSystem)&&s.missingInSystem.length&&v.push(`Thi\u1EBFu trong h\u1EC7 th\u1ED1ng: ${c(s.missingInSystem)}`),v.join(" \xB7 ")},at=async s=>{ke(""),Ke(null),ze((s==null?void 0:s.name)||""),Ee(!0),st("\u0110ang \u0111\u1ECDc file Excel...");try{await hn();const c=await j(s),v=c.rows,p=c.monthKeys.length?c.monthKeys:[F],T=d(v);st(`\u0110\u1ECDc \u0111\u01B0\u1EE3c ${v.length} d\xF2ng (${T.length} c\u1EE5m). \u0110ang chu\u1EA9n b\u1ECB \u0111\u1ED1i so\xE1t...`);const P=await ae(p);st(`\u0110ang \u0111\u1ED1i so\xE1t (${T.length} c\u1EE5m Excel vs ${P.length} \u0111\u01A1n h\u1EC7 th\u1ED1ng)...`);const _=new Set,b=[],S=[],Q=[],H=[],ge=[],se=O=>{const De=Number((O==null?void 0:O.diff)||0),We=O==null?void 0:O.itemDiff;if(De===0&&We&&We.hasDiff){H.push(O);return}if(De===0){ge.push(O);return}Q.push(O)},ue=Pt?Math.max(0,Number(C||0)||0):0,Ne=new Map;for(const O of P){const De=String(O.phoneNorm||"").trim();if(!De)continue;const We=Ne.get(De)||[];We.push(O),Ne.set(De,We)}const Oe=new Map;for(const O of P){const De=String(O.cod),We=Oe.get(De)||[];We.push(O),Oe.set(De,We)}for(const O of T){const De=String(O.phoneNorm||"").trim();let We=[];if(De?We=(Ne.get(De)||[]).filter(w=>!_.has(w.id)):We=(Oe.get(String(O.cod))||[]).filter(w=>!_.has(w.id)),O.dayKey&&We.length){const w=We.filter(ie=>String(ie.dayKey||"")===String(O.dayKey||""));w.length&&(We=w)}if(!We.length){S.push({group:O,suggestions:[]});continue}if(De){const w=Array.isArray(O.codCandidates)&&O.codCandidates.length?O.codCandidates:[Number(O.cod||0)||0];let Be=We.filter(tt=>w.some(At=>Number(At||0)===Number(tt.cod||0)));if(O.dayKey&&Be.length){const tt=Be.filter(At=>String(At.dayKey||"")===String(O.dayKey||""));tt.length&&(Be=tt)}if(Be.length===1){const tt=Be[0],At=Gt(O,tt);if(At.hasDiff){_.add(tt.id);const Zt=Number(O.cod||0)-Number(tt.cod||0);se({group:O,order:tt,score:1,diff:Zt,reason:["S\u0110T tr\xF9ng","COD tr\xF9ng",...O.dayKey?["C\xF9ng ng\xE0y"]:[],on(At)].filter(Boolean).join(" \xB7 "),itemDiff:At})}else _.add(tt.id),b.push({group:O,order:tt,score:1,reasons:["S\u0110T tr\xF9ng","COD tr\xF9ng",...O.dayKey?["C\xF9ng ng\xE0y"]:[]]});continue}}const ut=We.map(w=>{const ie=vt(O,w,{codTolerance:ue});return{order:w,...ie}}).sort((w,ie)=>ie.score-w.score),h=ut[0],Se=ut.slice(0,3).map(w=>({id:w.order.id,cod:w.order.cod,productSummary:w.order.productSummary,score:w.score,reasons:w.reasons})),pt=De?.7:.8;if(h&&h.score>=pt&&h.codExact){const w=Gt(O,h.order);if(w.hasDiff){_.add(h.order.id);const ie=Number(O.cod||0)-Number(h.order.cod||0);se({group:O,order:h.order,score:h.score,diff:ie,reason:[...h.reasons,on(w)].filter(Boolean).join(" \xB7 "),itemDiff:w})}else _.add(h.order.id),b.push({group:O,order:h.order,score:h.score,reasons:h.reasons})}else if(h&&De){_.add(h.order.id);const w=Number(O.cod||0)-Number(h.order.cod||0),ie=Gt(O,h.order),Be=on(ie);se({group:O,order:h.order,score:h.score,diff:w,reason:[...h.reasons||[],Be,h.score<pt?"C\u1EA7n ki\u1EC3m tra th\u1EE7 c\xF4ng (kh\u1EDBp ch\u01B0a ch\u1EAFc ch\u1EAFn)":""].filter(Boolean).join(" \xB7 "),suggestions:Se,itemDiff:ie})}else if(h&&(h.codWithin||ue>0&&Number.isFinite(h.codDiff)&&h.codDiff<=ue)&&h.nameSim>=.55){_.add(h.order.id);const w=Number(O.cod||0)-Number(h.order.cod||0);se({group:O,order:h.order,score:h.score,diff:w,reason:h.reasons.join(" \xB7 "),suggestions:Se})}else S.push({group:O,suggestions:Se})}const He=S,Ce=P.filter(O=>!_.has(O.id)),Xe=He.length===0&&Ce.length===0&&Q.length===0&&H.length===0&&ge.length===0;Ke({ok:Xe,monthKeys:p,excelCount:v.length,excelGroupCount:T.length,systemCount:P.length,matches:b,excelOnly:He,systemOnly:Ce,moneyMismatch:Q,productMismatch:H,needsReview:ge}),x(new Set),st(Xe?"OK \u2705":"\u0110\xE3 \u0111\u1ED1i so\xE1t xong")}catch(c){ke(String((c==null?void 0:c.message)||c||"L\u1ED7i \u0111\u1ED1i so\xE1t")),st("")}finally{Ee(!1)}},cn=(s,c)=>{var Q,H,ge,se,ue,Ne,Oe,He,Ce,Xe;const v=O=>String(O||"").replace(/[^0-9]/g,""),p=(s==null?void 0:s.raw)||{},T=String((H=(Q=s==null?void 0:s.id)!=null?Q:p==null?void 0:p.id)!=null?H:"").trim(),P=v((se=(ge=p==null?void 0:p.phone)!=null?ge:s==null?void 0:s.phone)!=null?se:"");if(!T||!P)return null;let b=(Array.isArray(p==null?void 0:p.items)?p.items:[]).map(O=>{var De,We;return{product_id:(O==null?void 0:O.product_id)||"",quantity:Number((De=O==null?void 0:O.quantity)!=null?De:1),variant:String((O==null?void 0:O.variant)||"").trim()||null,variant_json:(We=O==null?void 0:O.variant_json)!=null?We:null,unit_price:(()=>{var Se;const ut=(Se=O==null?void 0:O.unit_price)!=null?Se:O==null?void 0:O.unitPrice,h=ut==null||ut===""?NaN:Number(ut);return Number.isFinite(h)?Math.max(0,Math.trunc(h)):null})()}}).filter(O=>O.product_id&&Number.isFinite(O.quantity)&&O.quantity>0);if(!b.length&&(p!=null&&p.product_id)){const O=Number((ue=p==null?void 0:p.quantity)!=null?ue:1);b=[{product_id:p.product_id,quantity:Number.isFinite(O)&&O>0?O:1,variant:null,variant_json:null,unit_price:null}]}if(!b.length)return null;const S=b[0];return{id:T,customer_name:String((Ne=p==null?void 0:p.customer_name)!=null?Ne:"").trim(),phone:P,address:String((Oe=p==null?void 0:p.address)!=null?Oe:"").trim(),note:String((He=p==null?void 0:p.note)!=null?He:"").trim(),adjustment_amount:Number((Ce=p==null?void 0:p.adjustment_amount)!=null?Ce:0)||0,adjustment_note:String((Xe=p==null?void 0:p.adjustment_note)!=null?Xe:"").trim(),product_id:S.product_id,quantity:S.quantity,status:c,items:b}},Mn=async()=>{if(!ne||be)return;const s=Array.from(Te.values()).map(p=>String(p||"").trim()).filter(Boolean);if(!s.length||!confirm(`\u0110\xE1nh d\u1EA5u \u0111\xE3 nh\u1EADn ti\u1EC1n cho ${s.length} \u0111\u01A1n?`))return;ve(!0),de("\u0110ang c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i...");let c=0;const v=[];try{for(let p=0;p<s.length;p++){const T=s[p];de(`\u0110ang c\u1EADp nh\u1EADt (${p+1}/${s.length})...`);const P=(Array.isArray(ne==null?void 0:ne.matches)?ne.matches:[]).find(b=>{var S;return String(((S=b==null?void 0:b.order)==null?void 0:S.id)||"")===T}),_=cn(P==null?void 0:P.order,"paid");if(!_){v.push({id:T,error:"Thi\u1EBFu d\u1EEF li\u1EC7u (phone/items)"});continue}try{await window.KTM.api.putJSON(`${API_BASE}/api/orders/${encodeURIComponent(T)}`,_,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),c+=1}catch(b){v.push({id:T,error:String((b==null?void 0:b.message)||b||"L\u1ED7i")})}}}finally{ve(!1),de("")}if(c>0){E(`\u0110\xE3 c\u1EADp nh\u1EADt ${c} \u0111\u01A1n sang \u0110\xE3 nh\u1EADn ti\u1EC1n`,"success");const p=new Set(s);Ke(T=>{if(!T)return T;const P=_=>{if(!_||!p.has(String(_.id)))return _;const b=_.raw?{..._.raw,status:"paid"}:_.raw;return{..._,status:"paid",raw:b}};return{...T,matches:Array.isArray(T.matches)?T.matches.map(_=>({..._,order:P(_==null?void 0:_.order)})):T.matches,systemOnly:Array.isArray(T.systemOnly)?T.systemOnly.map(P):T.systemOnly,moneyMismatch:Array.isArray(T.moneyMismatch)?T.moneyMismatch.map(_=>({..._,order:P(_==null?void 0:_.order)})):T.moneyMismatch,productMismatch:Array.isArray(T.productMismatch)?T.productMismatch.map(_=>({..._,order:P(_==null?void 0:_.order)})):T.productMismatch,needsReview:Array.isArray(T.needsReview)?T.needsReview.map(_=>({..._,order:P(_==null?void 0:_.order)})):T.needsReview}}),x(new Set)}v.length&&(E(`C\xF3 ${v.length} \u0111\u01A1n c\u1EADp nh\u1EADt l\u1ED7i (xem console)`,"warning"),console.warn("Recon paid update failures:",v))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t Excel")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Th\xE1ng m\u1EB7c \u0111\u1ECBnh (n\u1EBFu Excel kh\xF4ng c\xF3 c\u1ED9t ng\xE0y)"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:re,onChange:s=>W(s.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:X}))))),React.createElement("div",{className:"card border-0 shadow-sm mb-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{className:"fw-semibold"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 (Excel)"),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("span",{className:"text-muted small"},"Check: ",React.createElement("span",{className:"fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m")," + ",React.createElement("span",{className:"fw-semibold"},"T\u1ED5ng ti\u1EC1n thu h\u1ED9")))),St==="loading"&&React.createElement("div",{className:"alert alert-info mt-3 mb-0"},"\u0110ang t\u1EA3i th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX)..."),St==="failed"&&React.createElement("div",{className:"alert alert-warning mt-3 mb-0"},"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). H\xE3y ki\u1EC3m tra m\u1EA1ng / ch\u1EB7n CDN (AdBlock) ho\u1EB7c refresh l\u1EA1i trang."),React.createElement("div",{className:"row g-2 align-items-end mt-2"},React.createElement("div",{className:"col-12 col-md-7"},React.createElement("label",{className:"form-label mb-1"},"Upload file Excel"),React.createElement("input",{type:"file",className:"form-control",accept:".xlsx,.xls,.csv",disabled:X,onChange:async s=>{const c=s.target.files&&s.target.files[0];c&&await at(c)}}),React.createElement("div",{className:"form-text"},Fe?`File: ${Fe}`:'Header c\u1EA7n c\xF3: "T\xEAn s\u1EA3n ph\u1EA9m" v\xE0 "T\u1ED5ng Ti\u1EC1n Thu H\u1ED9". C\xF3 c\u1ED9t "Ng\xE0y" th\xEC s\u1EBD t\u1EF1 t\u1EA3i \u0111\xFAng th\xE1ng trong file.')),React.createElement("div",{className:"col-12 col-md-5"},React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("label",{className:"form-label mb-0 small text-muted"},"Ng\xE0y theo"),React.createElement("select",{className:"form-select form-select-sm",style:{width:150},value:et,disabled:X,onChange:s=>Dt(s.target.value)},React.createElement("option",{value:"created_at"},"created_at"),React.createElement("option",{value:"updated_at"},"updated_at"))),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-draft",checked:Ve,disabled:X,onChange:s=>nt(!!s.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-draft"},"B\u1ECF nh\xE1p")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-canceled",checked:Ie,disabled:X,onChange:s=>yt(!!s.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-canceled"},"B\u1ECF h\u1EE7y")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-paid",checked:Rt,disabled:X,onChange:s=>tn(!!s.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-paid"},"B\u1ECF \u0111\xE3 nh\u1EADn ti\u1EC1n")),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("div",{className:"form-check mb-0"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-cod-tol",checked:Pt,disabled:X,onChange:s=>M(!!s.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-cod-tol"},"Cho l\u1EC7ch COD")),React.createElement("input",{type:"number",className:"form-control form-control-sm",style:{width:110},value:C,min:"0",step:"1000",disabled:X||!Pt,onChange:s=>z(s.target.value)})))),React.createElement("div",{className:"col-12 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",disabled:X,onClick:()=>{ke(""),st(""),Ke(null),ze(""),it("all"),wt(""),E("\u0110\xE3 reset \u0111\u1ED1i so\xE1t","info")}},React.createElement("i",{className:"fas fa-rotate-left me-2"}),"Reset"))),Ge&&React.createElement("div",{className:"mt-2 small text-muted"},Ge),je&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0"},je),ne&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:`alert ${ne.ok?"alert-success":"alert-warning"} mb-3`},ne.ok?React.createElement("div",{className:"fw-semibold"},"OK \u2014 File Excel \u0111\xE3 kh\u1EDBp \u0111\u1EA7y \u0111\u1EE7 v\u1EDBi h\u1EC7 th\u1ED1ng."):React.createElement("div",{className:"fw-semibold"},"CH\u01AFA KH\u1EDAP \u2014 C\xF3 thi\u1EBFu/sai l\u1EC7ch so v\u1EDBi h\u1EC7 th\u1ED1ng."),React.createElement("div",{className:"small mt-1"},"Th\xE1ng \u0111\u1ED1i so\xE1t: ",Array.isArray(ne.monthKeys)?ne.monthKeys.join(", "):""," \xB7 Excel: ",ne.excelCount," d\xF2ng",Number(ne.excelGroupCount||0)?` (${ne.excelGroupCount} c\u1EE5m)`:""," \xB7 H\u1EC7 th\u1ED1ng: ",ne.systemCount," \u0111\u01A1n")),!ne.ok&&React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center justify-content-between mb-2"},React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Recon view"},React.createElement("button",{type:"button",className:`btn ${K==="all"?"btn-dark":"btn-outline-dark"}`,onClick:()=>it("all")},"T\u1EA5t c\u1EA3"),React.createElement("button",{type:"button",className:`btn ${K==="systemOnly"?"btn-warning":"btn-outline-warning"}`,onClick:()=>it("systemOnly")},"H\u1EC7 th\u1ED1ng thi\u1EBFu Excel"),React.createElement("button",{type:"button",className:`btn ${K==="excelOnly"?"btn-warning":"btn-outline-warning"}`,onClick:()=>it("excelOnly")},"Excel thi\u1EBFu h\u1EC7 th\u1ED1ng"),React.createElement("button",{type:"button",className:`btn ${K==="moneyMismatch"?"btn-danger":"btn-outline-danger"}`,onClick:()=>it("moneyMismatch")},"Sai l\u1EC7ch ti\u1EC1n"),React.createElement("button",{type:"button",className:`btn ${K==="productMismatch"?"btn-warning":"btn-outline-warning"}`,onClick:()=>it("productMismatch")},"Sai l\u1EC7ch SP"),React.createElement("button",{type:"button",className:`btn ${K==="needsReview"?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>it("needsReview")},"C\u1EA7n ki\u1EC3m tra")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("input",{type:"text",className:"form-control form-control-sm",style:{width:220},placeholder:"L\u1ECDc theo S\u0110T...",value:gt,onChange:s=>wt(s.target.value)}),React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Export CSV"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{var v,p,T,P,_,b,S,Q,H,ge,se,ue,Ne,Oe,He,Ce,Xe,O,De,We,ut;const s=Y(gt),c=[["type","order_id","date","phone","product","cod_excel","cod_system","diff","reason"]];for(const h of Array.isArray(ne.moneyMismatch)?ne.moneyMismatch:[])s&&String(((v=h==null?void 0:h.group)==null?void 0:v.phoneNorm)||"").indexOf(s)<0||c.push(["moneyMismatch",((p=h==null?void 0:h.order)==null?void 0:p.id)||"",String(((T=h==null?void 0:h.group)==null?void 0:T.dateRaw)||""),((P=h==null?void 0:h.group)==null?void 0:P.phone)||"",((_=h==null?void 0:h.group)==null?void 0:_.productDisplay)||"",Number(((b=h==null?void 0:h.group)==null?void 0:b.cod)||0),Number(((S=h==null?void 0:h.order)==null?void 0:S.cod)||0),Number((h==null?void 0:h.diff)||0),String((h==null?void 0:h.reason)||"")]);for(const h of Array.isArray(ne.productMismatch)?ne.productMismatch:[])s&&String(((Q=h==null?void 0:h.group)==null?void 0:Q.phoneNorm)||"").indexOf(s)<0||c.push(["productMismatch",((H=h==null?void 0:h.order)==null?void 0:H.id)||"",String(((ge=h==null?void 0:h.group)==null?void 0:ge.dateRaw)||""),((se=h==null?void 0:h.group)==null?void 0:se.phone)||"",((ue=h==null?void 0:h.group)==null?void 0:ue.productDisplay)||"",Number(((Ne=h==null?void 0:h.group)==null?void 0:Ne.cod)||0),Number(((Oe=h==null?void 0:h.order)==null?void 0:Oe.cod)||0),Number((h==null?void 0:h.diff)||0),String((h==null?void 0:h.reason)||"")]);for(const h of Array.isArray(ne.needsReview)?ne.needsReview:[])s&&String(((He=h==null?void 0:h.group)==null?void 0:He.phoneNorm)||"").indexOf(s)<0||c.push(["needsReview",((Ce=h==null?void 0:h.order)==null?void 0:Ce.id)||"",String(((Xe=h==null?void 0:h.group)==null?void 0:Xe.dateRaw)||""),((O=h==null?void 0:h.group)==null?void 0:O.phone)||"",((De=h==null?void 0:h.group)==null?void 0:De.productDisplay)||"",Number(((We=h==null?void 0:h.group)==null?void 0:We.cod)||0),Number(((ut=h==null?void 0:h.order)==null?void 0:ut.cod)||0),Number((h==null?void 0:h.diff)||0),String((h==null?void 0:h.reason)||"")]);for(const h of Array.isArray(ne.systemOnly)?ne.systemOnly:[])s&&String((h==null?void 0:h.phoneNorm)||"").indexOf(s)<0||c.push(["systemOnly",(h==null?void 0:h.id)||"",window.KTM.date.formatDateTime(h==null?void 0:h.created_at),(h==null?void 0:h.phone)||"",(h==null?void 0:h.productSummary)||"","",Number((h==null?void 0:h.cod)||0),"",""]);for(const h of Array.isArray(ne.excelOnly)?ne.excelOnly:[]){const Se=h==null?void 0:h.group;s&&String((Se==null?void 0:Se.phoneNorm)||"").indexOf(s)<0||c.push(["excelOnly","",String((Se==null?void 0:Se.dateRaw)||""),(Se==null?void 0:Se.phone)||"",(Se==null?void 0:Se.productDisplay)||"",Number((Se==null?void 0:Se.cod)||0),"","",Array.isArray(h==null?void 0:h.suggestions)&&h.suggestions.length?h.suggestions.map(pt=>`#${pt.id}(${window.KTM.money.formatNumber(pt.cod)}|${Math.round((pt.score||0)*100)}%)`).join(" | "):""])}mt(`recon_${String(F||"").replace(/[^0-9\-]/g,"")}.csv`,c)}},"Export CSV")))),Array.isArray(ne.moneyMismatch)&&ne.moneyMismatch.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:K==="all"||K==="moneyMismatch"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-danger"},"Sai l\u1EC7ch s\u1ED1 ti\u1EC1n"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m (Excel)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (Excel)"),React.createElement("th",null,"Order ID"),React.createElement("th",null,"T\xEAn SP (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"L\u1EC7ch"),React.createElement("th",null,"L\xFD do"))),React.createElement("tbody",null,ne.moneyMismatch.filter(s=>{var v;const c=Y(gt);return c?String(((v=s==null?void 0:s.group)==null?void 0:v.phoneNorm)||"").includes(c):!0}).slice(0,30).map(s=>{var c,v,p,T,P,_,b,S,Q,H;return React.createElement("tr",{key:`mm-${String(((c=s==null?void 0:s.group)==null?void 0:c.key)||((v=s==null?void 0:s.order)==null?void 0:v.id)||Math.random())}`,className:"table-danger"},React.createElement("td",null,((p=s==null?void 0:s.group)==null?void 0:p.rowIndexFirst)||"\u2014",Number(((T=s==null?void 0:s.group)==null?void 0:T.rowCount)||0)>1?` (+${Number(s.group.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},((P=s==null?void 0:s.group)==null?void 0:P.phone)||"\u2014"),React.createElement("td",{style:{minWidth:260}},((_=s==null?void 0:s.group)==null?void 0:_.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number(((b=s==null?void 0:s.group)==null?void 0:b.cod)||0))),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me((s==null?void 0:s.order)||null),U(!0)}},(S=s==null?void 0:s.order)==null?void 0:S.id)),React.createElement("td",{style:{minWidth:240}},(Q=s==null?void 0:s.order)==null?void 0:Q.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber((H=s==null?void 0:s.order)==null?void 0:H.cod)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(s==null?void 0:s.diff)),React.createElement("td",{className:"text-muted",style:{minWidth:220}},(s==null?void 0:s.reason)||""))})))),ne.moneyMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ne.moneyMismatch.length," d\xF2ng."))),Array.isArray(ne.productMismatch)&&ne.productMismatch.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:K==="all"||K==="productMismatch"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"Sai l\u1EC7ch/thi\u1EBFu s\u1EA3n ph\u1EA9m (ti\u1EC1n kh\u1EDBp)"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m (Excel)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (Excel)"),React.createElement("th",null,"Order ID"),React.createElement("th",null,"T\xEAn SP (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("th",null,"L\xFD do"))),React.createElement("tbody",null,ne.productMismatch.filter(s=>{var v;const c=Y(gt);return c?String(((v=s==null?void 0:s.group)==null?void 0:v.phoneNorm)||"").includes(c):!0}).slice(0,30).map(s=>{var c,v,p,T,P,_,b,S,Q,H;return React.createElement("tr",{key:`pm-${String(((c=s==null?void 0:s.group)==null?void 0:c.key)||((v=s==null?void 0:s.order)==null?void 0:v.id)||Math.random())}`,className:"table-warning"},React.createElement("td",null,((p=s==null?void 0:s.group)==null?void 0:p.rowIndexFirst)||"\u2014",Number(((T=s==null?void 0:s.group)==null?void 0:T.rowCount)||0)>1?` (+${Number(s.group.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},((P=s==null?void 0:s.group)==null?void 0:P.phone)||"\u2014"),React.createElement("td",{style:{minWidth:260}},((_=s==null?void 0:s.group)==null?void 0:_.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number(((b=s==null?void 0:s.group)==null?void 0:b.cod)||0))),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me((s==null?void 0:s.order)||null),U(!0)}},(S=s==null?void 0:s.order)==null?void 0:S.id)),React.createElement("td",{style:{minWidth:240}},(Q=s==null?void 0:s.order)==null?void 0:Q.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber((H=s==null?void 0:s.order)==null?void 0:H.cod)),React.createElement("td",{className:"text-muted",style:{minWidth:240}},(s==null?void 0:s.reason)||""))})))),ne.productMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ne.productMismatch.length," d\xF2ng."))),Array.isArray(ne.needsReview)&&ne.needsReview.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:K==="all"||K==="needsReview"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-secondary"},"C\u1EA7n ki\u1EC3m tra th\u1EE7 c\xF4ng (ti\u1EC1n kh\u1EDBp)"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m (Excel)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (Excel)"),React.createElement("th",null,"Order ID"),React.createElement("th",null,"T\xEAn SP (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("th",null,"L\xFD do"))),React.createElement("tbody",null,ne.needsReview.filter(s=>{var v;const c=Y(gt);return c?String(((v=s==null?void 0:s.group)==null?void 0:v.phoneNorm)||"").includes(c):!0}).slice(0,30).map(s=>{var c,v,p,T,P,_,b,S,Q,H;return React.createElement("tr",{key:`rv-${String(((c=s==null?void 0:s.group)==null?void 0:c.key)||((v=s==null?void 0:s.order)==null?void 0:v.id)||Math.random())}`,className:"table-light"},React.createElement("td",null,((p=s==null?void 0:s.group)==null?void 0:p.rowIndexFirst)||"\u2014",Number(((T=s==null?void 0:s.group)==null?void 0:T.rowCount)||0)>1?` (+${Number(s.group.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},((P=s==null?void 0:s.group)==null?void 0:P.phone)||"\u2014"),React.createElement("td",{style:{minWidth:260}},((_=s==null?void 0:s.group)==null?void 0:_.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number(((b=s==null?void 0:s.group)==null?void 0:b.cod)||0))),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me((s==null?void 0:s.order)||null),U(!0)}},(S=s==null?void 0:s.order)==null?void 0:S.id)),React.createElement("td",{style:{minWidth:240}},(Q=s==null?void 0:s.order)==null?void 0:Q.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber((H=s==null?void 0:s.order)==null?void 0:H.cod)),React.createElement("td",{className:"text-muted",style:{minWidth:240}},(s==null?void 0:s.reason)||""))})))),ne.needsReview.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ne.needsReview.length," d\xF2ng."))),Array.isArray(ne.systemOnly)&&ne.systemOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:K==="all"||K==="systemOnly"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong h\u1EC7 th\u1ED1ng nh\u01B0ng thi\u1EBFu trong Excel"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y t\u1EA1o"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,ne.systemOnly.filter(s=>{const c=Y(gt);return c?String((s==null?void 0:s.phoneNorm)||"").includes(c):!0}).slice(0,30).map(s=>React.createElement("tr",{key:`so-${s.id}`,className:"table-warning"},React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me(s||null),U(!0)}},s.id)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(s.created_at)),React.createElement("td",{className:"text-muted"},s.phone||"\u2014"),React.createElement("td",{style:{minWidth:280}},s.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(s.cod)),React.createElement("td",{className:"text-muted"},s.status)))))),ne.systemOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ne.systemOnly.length," \u0111\u01A1n."))),Array.isArray(ne.excelOnly)&&ne.excelOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm",style:{display:K==="all"||K==="excelOnly"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong Excel nh\u01B0ng kh\xF4ng th\u1EA5y \u0111\u01A1n kh\u1EDBp trong h\u1EC7 th\u1ED1ng"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"G\u1EE3i \xFD (top 3)"))),React.createElement("tbody",null,ne.excelOnly.filter(s=>{var v;const c=Y(gt);return c?String(((v=s==null?void 0:s.group)==null?void 0:v.phoneNorm)||"").includes(c):!0}).slice(0,30).map(s=>{const c=s==null?void 0:s.group,v=Array.isArray(s==null?void 0:s.suggestions)?s.suggestions:[];return React.createElement("tr",{key:`eo-${String((c==null?void 0:c.key)||(c==null?void 0:c.rowIndexFirst)||Math.random())}`,className:"table-warning"},React.createElement("td",null,(c==null?void 0:c.rowIndexFirst)||"\u2014",Number((c==null?void 0:c.rowCount)||0)>1?` (+${Number(c.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},String((c==null?void 0:c.dateRaw)||"")),React.createElement("td",{className:"text-muted"},(c==null?void 0:c.phone)||"\u2014"),React.createElement("td",{style:{minWidth:280}},(c==null?void 0:c.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number((c==null?void 0:c.cod)||0))),React.createElement("td",{className:"text-muted",style:{minWidth:280}},v.length?React.createElement("div",{className:"small"},v.map(p=>React.createElement("div",{key:`s-${p.id}`},"#",p.id," \xB7 ",window.KTM.money.formatNumber(p.cod)," \xB7 ",Math.round((p.score||0)*100),"%",React.createElement("br",null),React.createElement("span",{className:"text-muted"},Array.isArray(p.reasons)?p.reasons.join(" \xB7 "):"")))):"\u2014"))})))),ne.excelOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ne.excelOnly.length," d\xF2ng."))))),Array.isArray(ne.matches)&&ne.matches.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mt-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2"},React.createElement("div",{className:"fw-semibold"},"\u0110\u01A1n \u0111\xE3 kh\u1EDBp"),React.createElement("div",{className:"d-flex flex-wrap align-items-center gap-2"},le?React.createElement("span",{className:"text-muted small"},le):null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",disabled:be||!(Te&&Te.size),onClick:Mn},"\u0110\xE1nh d\u1EA5u \u0111\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:34}},React.createElement("input",{type:"checkbox",checked:(()=>{var v;const s=Y(gt),c=(ne.matches||[]).filter(p=>{var _;const T=p==null?void 0:p.order;if(!(T!=null&&T.id))return!1;const P=String((T==null?void 0:T.status)||((_=T==null?void 0:T.raw)==null?void 0:_.status)||"").toLowerCase();return!(Rt&&P==="paid"||s&&!String((T==null?void 0:T.phoneNorm)||"").includes(s))});if(!c.length)return!1;for(const p of c)if(!Te.has(String(((v=p==null?void 0:p.order)==null?void 0:v.id)||"")))return!1;return!0})(),onChange:s=>{const c=!!s.target.checked;x(v=>{var _;const p=new Set(v),T=Y(gt),P=(ne.matches||[]).filter(b=>{var H;const S=b==null?void 0:b.order;if(!(S!=null&&S.id))return!1;const Q=String((S==null?void 0:S.status)||((H=S==null?void 0:S.raw)==null?void 0:H.status)||"").toLowerCase();return!(Rt&&Q==="paid"||T&&!String((S==null?void 0:S.phoneNorm)||"").includes(T))});for(const b of P){const S=String(((_=b==null?void 0:b.order)==null?void 0:_.id)||"").trim();S&&(c?p.add(S):p.delete(S))}return p})}})),React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"Excel"),React.createElement("th",null,"H\u1EC7 th\u1ED1ng"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,(ne.matches||[]).filter(s=>{var T;const c=s==null?void 0:s.order;if(!(c!=null&&c.id))return!1;const v=String((c==null?void 0:c.status)||((T=c==null?void 0:c.raw)==null?void 0:T.status)||"").toLowerCase();if(Rt&&v==="paid")return!1;const p=Y(gt);return!(p&&!String((c==null?void 0:c.phoneNorm)||"").includes(p))}).slice(0,50).map(s=>{var p,T,P,_;const c=s.order,v=String(c.id);return React.createElement("tr",{key:`match-${v}`},React.createElement("td",null,React.createElement("input",{type:"checkbox",checked:Te.has(v),onChange:b=>{const S=!!b.target.checked;x(Q=>{const H=new Set(Q);return S?H.add(v):H.delete(v),H})}})),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me(c||null),U(!0)}},v)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(c.created_at)),React.createElement("td",{className:"text-muted"},c.phone||"\u2014"),React.createElement("td",{style:{minWidth:240}},((p=s==null?void 0:s.group)==null?void 0:p.productDisplay)||"\u2014"),React.createElement("td",{style:{minWidth:240}},c.productSummary||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(c.cod)),React.createElement("td",null,React.createElement("span",{className:`badge ${String((c==null?void 0:c.status)||((T=c==null?void 0:c.raw)==null?void 0:T.status)||"").toLowerCase()==="paid"?"bg-primary":"bg-secondary"}`},String((c==null?void 0:c.status)||((P=c==null?void 0:c.raw)==null?void 0:P.status)||"").toLowerCase()==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":(c==null?void 0:c.status)||((_=c==null?void 0:c.raw)==null?void 0:_.status)||"\u2014")))})))),React.createElement("div",{className:"text-muted small mt-2"},"Hi\u1EC3n th\u1ECB t\u1ED1i \u0111a 50 \u0111\u01A1n. D\xF9ng l\u1ECDc S\u0110T \u0111\u1EC3 thu h\u1EB9p.")))))),React.createElement(AdminDrawer,{open:q,title:oe?`Order #${oe.id}`:"Order",subtitle:oe?`${oe.phone||""} \u2022 ${window.KTM.money.formatNumber(Number(oe.cod||0))}`:"",onClose:()=>{U(!1),Me(null)}},oe?React.createElement("div",{className:"small"},React.createElement("div",{className:"mb-2"},React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Tr\u1EA1ng th\xE1i:")," ",oe.status||"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"created_at:")," ",window.KTM.date.formatDateTime(oe.created_at)),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"updated_at:")," ",oe.updated_at?window.KTM.date.formatDateTime(oe.updated_at):"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:")," ",oe.productSummary||"\u2014")),React.createElement("div",{className:"fw-semibold mb-1"},"Line items"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"#"),React.createElement("th",null,"product_id"),React.createElement("th",{className:"text-end"},"qty"),React.createElement("th",{className:"text-end"},"price"),React.createElement("th",{className:"text-end"},"total"))),React.createElement("tbody",null,(Array.isArray((bn=oe==null?void 0:oe.raw)==null?void 0:bn.items)?oe.raw.items:[]).map((s,c)=>{var _,b,S,Q,H,ge;const v=String((b=(_=s==null?void 0:s.product_id)!=null?_:s==null?void 0:s.id)!=null?b:"").trim(),p=Number((Q=(S=s==null?void 0:s.qty)!=null?S:s==null?void 0:s.quantity)!=null?Q:0)||0,T=Number((ge=(H=s==null?void 0:s.price)!=null?H:s==null?void 0:s.unit_price)!=null?ge:0)||0,P=p*T;return React.createElement("tr",{key:`li-${c}-${v}`},React.createElement("td",{className:"text-muted"},c+1),React.createElement("td",{className:"text-muted"},v||"\u2014"),React.createElement("td",{className:"text-end"},p),React.createElement("td",{className:"text-end"},window.KTM.money.formatNumber(T)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(P)))}))))):null))}function AdminApp(){const[$,E]=useState(!1),[F,ye]=useState(""),[re,W]=useState(null),[X,Ee]=useState("search"),[je,ke]=useState(()=>loadAdminPins()),[Ge,st]=useState(()=>loadAdminRecent()),[Fe,ze]=useState(null),[ne,Ke]=useState(""),[K,it]=useState([]),[gt,wt]=useState(null),[Ve,nt]=useState(!1),[Ie,yt]=useState(null),[Rt,tn]=useState(!0),[et,Dt]=useState([]),[Pt,M]=useState(!1),[C,z]=useState(null),[be,ve]=useState(!1),[le,de]=useState(!1),[Te,x]=useState(""),[q,U]=useState(()=>loadAdminSettings()),[oe,Me]=useState(null),[Ae,Qe]=useState([]);useEffect(()=>{const d=localStorage.getItem("ktm_admin_session");if(d)try{const V=JSON.parse(d);V.expiry>Date.now()?(E(!0),W(V.user)):localStorage.removeItem("ktm_admin_session")}catch(V){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{$&&Ct()},[$]),useEffect(()=>{const d=()=>{try{const ae=document.querySelector(".admin-topbar");if(!ae)return;const Re=ae.getBoundingClientRect(),Pe=Math.max(0,Math.round(Re.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${Pe+10}px`)}catch(ae){}};d(),window.addEventListener("resize",d);const V=setTimeout(d,0);return()=>{clearTimeout(V),window.removeEventListener("resize",d)}},[$,X]),useEffect(()=>{var ae,Re;const d=window.visualViewport,V=()=>{try{const Pe=Number(window.innerHeight)||0,Je=Number(d==null?void 0:d.height)||Pe,vt=Number(d==null?void 0:d.offsetTop)||0,Ze=Math.max(0,Math.round(Pe-Je-vt));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${Ze}px`)}catch(Pe){}};V(),window.addEventListener("resize",V);try{(ae=d==null?void 0:d.addEventListener)==null||ae.call(d,"resize",V),(Re=d==null?void 0:d.addEventListener)==null||Re.call(d,"scroll",V)}catch(Pe){}return()=>{var Pe,Je;window.removeEventListener("resize",V);try{(Pe=d==null?void 0:d.removeEventListener)==null||Pe.call(d,"resize",V),(Je=d==null?void 0:d.removeEventListener)==null||Je.call(d,"scroll",V)}catch(vt){}}},[]),useEffect(()=>{if(!$)return;const d=ae=>{if(!ae)return!1;const Re=String(ae.tagName||"").toLowerCase();return!!(Re==="input"||Re==="textarea"||Re==="select"||ae.isContentEditable)},V=ae=>{if(!ae||ae.ctrlKey||ae.metaKey||ae.altKey||d(ae.target))return;const Re=ae.key;(Re==="/"||Re==="N"||Re==="n"||Re==="Escape"||Re==="j"||Re==="J"||Re==="k"||Re==="K")&&(Re==="/"&&ae.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:Re}})))};return document.addEventListener("keydown",V),()=>document.removeEventListener("keydown",V)},[$]),useEffect(()=>{$&&st(d=>{const V=Array.isArray(d)?d:[],ae=[X,...V.filter(Re=>Re!==X)].slice(0,8);return saveAdminRecent(ae),ae})},[$]);const Ue=d=>{const V=String(d||"").trim();V&&st(ae=>{const Re=Array.isArray(ae)?ae:[],Pe=[V,...Re.filter(Je=>Je!==V)].slice(0,8);return saveAdminRecent(Pe),Pe})},St=d=>{const V=String(d||"").trim();V&&ke(ae=>{const Re=Array.isArray(ae)?ae:[],Je=Re.includes(V)?Re.filter(vt=>vt!==V):[V,...Re].slice(0,10);return saveAdminPins(Je),Je})};useEffect(()=>{if(!$)return;let d=!1;return(async()=>{try{const V=await fetchAdminSettingsFromServer();if(d)return;U(V),saveAdminSettings(V)}catch(V){}})(),()=>{d=!0}},[$]);const It=async(d,V)=>{ye("");try{const ae=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:d,password:V},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),Re={user:ae.user,token:ae.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(Re)),W(ae.user),E(!0)}catch(ae){ye(ae.message)}},_e=()=>{localStorage.removeItem("ktm_admin_session"),E(!1),W(null),it([]),wt(null)},lt=(d,V="success",ae=null)=>{const Re=Date.now()+Math.floor(Math.random()*1e3);if(d&&typeof d=="object"){const Je=d;Dt(vt=>[...vt,{id:Re,message:String(Je.message||""),type:String(Je.type||V||"success"),actionLabel:Je.actionLabel||null,onAction:typeof Je.onAction=="function"?Je.onAction:null,durationMs:Je.durationMs||null}]);return}const Pe=ae&&typeof ae=="object"?ae:null;Dt(Je=>[...Je,{id:Re,message:String(d||""),type:String(V||"success"),actionLabel:(Pe==null?void 0:Pe.actionLabel)||null,onAction:typeof(Pe==null?void 0:Pe.onAction)=="function"?Pe.onAction:null,durationMs:(Pe==null?void 0:Pe.durationMs)||null}])},Yt=d=>{Dt(V=>V.filter(ae=>ae.id!==d))},Ct=async(d=null)=>{tn(!0);try{const V=d?`${API_BASE}/api/albums?parent_id=${d}`:`${API_BASE}/api/albums?parent_id=root`,ae=await window.KTM.api.getJSON(V,"L\u1ED7i t\u1EA3i danh s\xE1ch album");it(Array.isArray(ae)?ae:[])}catch(V){console.error(V),lt("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}tn(!1)},Wt=()=>{yt(null),nt(!0)},Bt=d=>{mt(d),ve(!0)},yn=async(d,V="modal")=>{try{const ae=Ie&&Ie.uuid;!ae&&oe&&(d.parent_id=oe.uuid);const Re=ae?`${API_BASE}/api/albums/${Ie.uuid||Ie.id}`:`${API_BASE}/api/albums`;ae?await window.KTM.api.putJSON(Re,d,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(Re,d,"L\u1ED7i t\u1EA1o"),lt(ae?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),V==="drawer"?(ve(!1),yt(null),Ct(oe==null?void 0:oe.uuid),ae&&C&&z({...C,...d})):(nt(!1),yt(null),Ct(oe==null?void 0:oe.uuid))}catch(ae){lt(ae.message,"danger")}},pn=d=>{wt(d)},R=d=>{if(d==="root")Qe([]),Me(null),Ct(null);else if(d){const V=Ae.findIndex(ae=>ae.uuid===d.uuid);V>=0&&(Qe(Ae.slice(0,V+1)),Me(d),Ct(d.uuid))}else{const V=[...Ae];V.pop();const ae=V[V.length-1]||null;Qe(V),Me(ae),Ct(ae==null?void 0:ae.uuid)}},Y=async d=>{const V=`X\xF3a folder "${d.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(V))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${d.uuid||d.id}`,"L\u1ED7i x\xF3a album"),lt("\u0110\xE3 x\xF3a","success"),Ct(oe==null?void 0:oe.uuid)}catch(ae){lt("L\u1ED7i x\xF3a album","danger")}},mt=async d=>{d&&(M(!0),x(""),de(!1),ve(!1),z(d))},Et=()=>{M(!1),de(!1),x(""),ve(!1),z(null)},hn=d=>{ve(!0)};if(!$)return React.createElement(LoginPage,{onLogin:It,error:F});const Kt=()=>{const d=new Date,V=d.getFullYear(),ae=String(d.getMonth()+1).padStart(2,"0");return`${V}-${ae}`};function Qt(){const[d,V]=useState(()=>{var Je;return String((Je=q==null?void 0:q.ship_percent)!=null?Je:DEFAULT_SHIP_PERCENT)}),[ae,Re]=useState(!1);return useEffect(()=>{var Je;V(String((Je=q==null?void 0:q.ship_percent)!=null?Je:DEFAULT_SHIP_PERCENT))},[q==null?void 0:q.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Je=>{Je.preventDefault(),Re(!0);const vt=saveAdminSettings({ship_percent:d});try{const Ze=await saveAdminSettingsToServer(vt);U(Ze),saveAdminSettings(Ze),lt("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Ze){U(vt),lt("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{Re(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:d,min:"0",max:"100",step:"0.01",onChange:Je=>V(Je.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:ae},ae?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function j(){const[d,V]=useState(Kt()),[ae,Re]=useState(!0),Pe=useRef(null),Je=useRef(null),[vt,Ze]=useState(0),[un,qt]=useState(!1),Gt=useRef(0),on=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[at,cn]=useState(on),Mn=useRef(new Map),bn=normalizeShipPercent(q==null?void 0:q.ship_percent),{formatNumber:s,formatVND:c}=window.KTM.money,v=async(w,ie=!1)=>{var ln,dn;const Be=String(w||"").trim();if(!Be)return on();const tt=`${Be}|${bn}`,At=(ln=Mn.current)==null?void 0:ln.get(tt);if(!ie&&At)return At;const Zt=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(Be)}&ship_percent=${encodeURIComponent(bn)}`,ft=await window.KTM.api.getJSON(Zt,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Jt=ft!=null&&ft.stats&&(ft!=null&&ft.meta)?ft.stats:ft,nn=Jt&&typeof Jt=="object"?Jt:on();return(dn=Mn.current)==null||dn.set(tt,nn),nn},p=async(w=!1)=>{Re(!0);try{const ie=await v(d,w);cn(ie)}catch(ie){console.error("Load stats error:",ie),cn(on())}finally{Re(!1)}};useEffect(()=>{p()},[d,bn]);const T=(w,ie)=>{const Be=String(w||"").trim(),tt=Be.match(/^(\d{4})-(\d{2})$/);if(!tt)return Be;const At=Number(tt[1]),Zt=Number(tt[2])-1,ft=new Date(At,Zt,1);ft.setMonth(ft.getMonth()+Number(ie||0));const Jt=ft.getFullYear(),nn=String(ft.getMonth()+1).padStart(2,"0");return`${Jt}-${nn}`},P=Kt(),_=T(P,-5),b=w=>{const ie=String(w||"").trim();return ie?ie>=_&&ie<=P:!1},S=w=>{const ie=String(w||"").trim();return ie&&(ie<_?_:ie>P?P:ie)},Q=w=>{const ie=Date.now();ie-Number(Gt.current||0)<1200||(Gt.current=ie,lt(w==="future"?"Kh\xF4ng xem \u0111\u01B0\u1EE3c th\xE1ng t\u01B0\u01A1ng lai":"Ch\u1EC9 xem t\u1ED1i \u0111a 5 th\xE1ng g\u1EA7n nh\u1EA5t","warning"))},H=(w,ie,Be)=>Math.max(ie,Math.min(Be,w)),ge=()=>{var w;return Math.max(320,Number((w=Je.current)==null?void 0:w.clientWidth)||360)},se=()=>{const w=ge();return H(Math.floor(w*.35),110,180)},ue=()=>{const w=ge();return H(Math.floor(w*.22),70,140)},Ne=w=>{try{if(!(w!=null&&w.touches)||w.touches.length!==1||un)return;const ie=w.target;if(ie&&typeof ie.closest=="function"&&ie.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Pe.current=null;return}const Be=w.touches[0];Pe.current={x:Be.clientX,y:Be.clientY,at:Date.now(),swiping:!1}}catch(ie){Pe.current=null}},Oe=w=>{const ie=Pe.current;if(!ie||un)return;const Be=(w==null?void 0:w.touches)&&w.touches[0];if(!Be)return;const tt=Be.clientX-ie.x,At=Be.clientY-ie.y,Zt=Math.abs(tt),ft=Math.abs(At);if(!ie.swiping)if(Zt>12&&Zt>ft*1.2)ie.swiping=!0,qt(!1);else return;const Jt=se();Ze(H(tt,-Jt,Jt))},He=w=>{const ie=Pe.current;if(Pe.current=null,!ie||un||!ie.swiping){Ze(0);return}const Be=(w==null?void 0:w.changedTouches)&&w.changedTouches[0];if(!Be)return;const tt=Be.clientX-ie.x,At=Be.clientY-ie.y,Zt=Date.now()-ie.at,ft=Math.abs(tt),Jt=Math.abs(At);if(Zt>1e3)return;if(ft<30){Ze(0);return}if(ft<Jt*1.5)return;const nn=ue(),ln=ft>=nn,dn=tt>0?1:-1;if(!ln){qt(!0),Ze(0),setTimeout(()=>qt(!1),220);return}const gn=dn>0?-1:1,_n=T(d,gn);if(!b(_n)){qt(!0),Ze(dn*Math.floor(se()*.55)),setTimeout(()=>{Ze(0),setTimeout(()=>qt(!1),200)},140),Q(_n>P?"future":"past");return}qt(!0),Ze(dn*se()),setTimeout(()=>{V(r=>T(r,gn)),Ze(-dn*se()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ze(0),setTimeout(()=>qt(!1),220)})})},140)},Ce=()=>{Pe.current=null,Ze(0)},Xe=w=>{var ie,Be;try{if(!w||w.pointerType==="touch"||typeof w.button=="number"&&w.button!==0||un)return;const tt=w.target;if(tt&&typeof tt.closest=="function"&&tt.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Pe.current=null;return}Pe.current={x:w.clientX,y:w.clientY,at:Date.now(),swiping:!1};try{(Be=(ie=w.currentTarget)==null?void 0:ie.setPointerCapture)==null||Be.call(ie,w.pointerId)}catch(At){}}catch(tt){Pe.current=null}},O=w=>{try{if(!w||w.pointerType==="touch")return;const ie=Pe.current;if(!ie||un)return;const Be=w.clientX-ie.x,tt=w.clientY-ie.y,At=Math.abs(Be),Zt=Math.abs(tt);if(!ie.swiping)if(At>12&&At>Zt*1.2)ie.swiping=!0,qt(!1);else return;const ft=se();Ze(H(Be,-ft,ft))}catch(ie){}},De=w=>{try{if(!w||w.pointerType==="touch")return;const ie=Pe.current;if(Pe.current=null,!ie||un||!ie.swiping){Ze(0);return}const Be=w.clientX-ie.x,tt=w.clientY-ie.y,At=Date.now()-ie.at,Zt=Math.abs(Be),ft=Math.abs(tt);if(At>1e3)return;if(Zt<30){Ze(0);return}if(Zt<ft*1.5)return;const Jt=ue(),nn=Zt>=Jt,ln=Be>0?1:-1;if(!nn){qt(!0),Ze(0),setTimeout(()=>qt(!1),220);return}const dn=ln>0?-1:1,gn=T(d,dn);if(!b(gn)){qt(!0),Ze(ln*Math.floor(se()*.55)),setTimeout(()=>{Ze(0),setTimeout(()=>qt(!1),200)},140),Q(gn>P?"future":"past");return}qt(!0),Ze(ln*se()),setTimeout(()=>{V(_n=>T(_n,dn)),Ze(-ln*se()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ze(0),setTimeout(()=>qt(!1),220)})})},140)}catch(ie){Pe.current=null}},We=()=>{Pe.current=null,Ze(0)},ut=vt>0?"Th\xE1ng tr\u01B0\u1EDBc":vt<0?"Th\xE1ng sau":"",h=vt>0?T(d,-1):vt<0?T(d,1):"",Se=h&&b(h)?h:"",pt=Math.min(1,Math.abs(vt)/Math.max(1,ue()));return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager",ref:Je,style:{touchAction:"pan-y",transform:`translateX(${vt}px)`,transition:un?"transform 220ms ease":"none",willChange:"transform"},onTouchStartCapture:Ne,onTouchMoveCapture:Oe,onTouchEndCapture:He,onTouchCancelCapture:Ce,onPointerDown:Xe,onPointerMove:O,onPointerUp:De,onPointerCancel:We},!!ut&&React.createElement("div",{"aria-hidden":"true",style:{position:"fixed",left:0,right:0,top:84,zIndex:1060,pointerEvents:"none",opacity:.15+.55*pt,transform:"translateZ(0)"}},React.createElement("div",{className:"d-flex justify-content-center"},React.createElement("div",{className:"px-3 py-2 rounded-pill bg-dark text-white shadow-sm",style:{fontSize:13}},vt>0?"\u2190":"\u2192"," ",ut," \xB7 ",Se))),React.createElement(Loading,{show:ae}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>p(!0),disabled:ae},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:d,onChange:w=>V(w.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",bn,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),s(at.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),s(at.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),s(at.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",s(at.statusCounts.paid),"/",s(at.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},s(at.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},c(at.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},c(at.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},c(at.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},c(at.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",at.avgQtyPerOrder?at.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},s(at.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},s(at.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},s(at.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},s(at.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},s(at.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},s(at.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},s(at.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,s(at.statusCounts.draft)),React.createElement("td",null,s(at.statusCounts.pending)),React.createElement("td",null,s(at.statusCounts.processing)),React.createElement("td",null,s(at.statusCounts.canceled)),React.createElement("td",null,s(at.statusCounts.done)),React.createElement("td",null,s(at.statusCounts.paid)),React.createElement("td",null,s(at.statusCounts.other)),React.createElement("td",null,s(at.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},at.products.slice(0,10).map(w=>React.createElement("div",{key:w.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},w.product_name),React.createElement("div",{className:"text-muted small text-truncate"},w.product_code?`#${w.product_code} \u2022 `:"",s(w.orders)," \u0111\u01A1n \u2022 ",s(w.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},c(w.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,at.products.slice(0,10).map(w=>React.createElement("tr",{key:w.product_id},React.createElement("td",null,w.product_name),React.createElement("td",null,w.product_code||"\u2014"),React.createElement("td",null,s(w.orders)),React.createElement("td",null,s(w.quantity)),React.createElement("td",{className:"fw-semibold"},c(w.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},at.customers.slice(0,10).map(w=>React.createElement("div",{key:w.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},w.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},w.phone||"\u2014"," \u2022 ",s(w.orders)," \u0111\u01A1n \u2022 ",s(w.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},c(w.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,at.customers.slice(0,10).map(w=>React.createElement("tr",{key:w.key},React.createElement("td",null,w.customer_name||"\u2014"),React.createElement("td",null,w.phone||"\u2014"),React.createElement("td",null,s(w.orders)),React.createElement("td",null,s(w.quantity)),React.createElement("td",{className:"fw-semibold"},c(w.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},at.days.map(w=>React.createElement("div",{key:w.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},w.day),React.createElement("div",{className:"text-muted small"},s(w.orders)," \u0111\u01A1n \u2022 ",s(w.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",s(w.doneOrders)," \u2022 ",c(w.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},c(w.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,at.days.map(w=>React.createElement("tr",{key:w.day},React.createElement("td",null,w.day),React.createElement("td",null,s(w.orders)),React.createElement("td",null,s(w.quantity)),React.createElement("td",{className:"fw-semibold"},c(w.revenue)),React.createElement("td",null,s(w.doneOrders)),React.createElement("td",{className:"fw-semibold"},c(w.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:X,onMenuChange:d=>{Ue(d),Ee(d),d==="albums"&&(Me(null),Qe([]),Ct(null))},onLogout:_e,currentUser:re,pinnedMenus:je,recentMenus:Ge,onTogglePin:St}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const V={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},recon:{title:"\u0110\u1ED1i so\xE1t Excel",icon:"fa-file-excel",sub:"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 t\u1EEB Excel"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[X]||{title:"KTM Admin",icon:"fa-tractor",sub:""},ae=(re==null?void 0:re.username)||(re==null?void 0:re.name)||(re==null?void 0:re.email)||"Admin",Re=(()=>{if(X!=="albums")return"";const Pe=[];return Pe.push("Root"),Array.isArray(Ae)&&Ae.length>0&&Pe.push(...Ae.map(Je=>Je==null?void 0:Je.title).filter(Boolean)),gt!=null&&gt.title&&Pe.push(gt.title),Pe.length>0?Pe.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${V.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},V.title),React.createElement("div",{className:"admin-page-subtitle"},Re||V.sub))),React.createElement("div",{className:"admin-topbar-right"},X==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:Wt,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:ae},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},ae)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:_e,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},X==="albums"&&!gt&&React.createElement(AlbumList,{albums:K,loading:Rt,currentFolder:oe,breadcrumb:Ae,onSelect:pn,onCreate:Wt,onEdit:Bt,onDelete:Y,onBack:R}),X==="search"&&React.createElement(SearchCenter,{showToast:lt,onNavigate:(d,V,ae)=>{Ee(d),d==="orders"&&V==="create"&&(ze(Date.now()),Ke((ae==null?void 0:ae.productId)||""))}}),X==="albums"&&gt&&React.createElement(AlbumDetail,{album:gt,parentAlbum:Ae.length>0?Ae[Ae.length-1]:null,onBack:()=>{if(gt.parentId){const d=Ae.findIndex(V=>V.uuid===gt.parentId);d>=0?wt(Ae[d]):wt(null)}else wt(null)},onRefresh:()=>Ct(oe==null?void 0:oe.uuid),showToast:lt,onNavigateToFolder:d=>{Qe(V=>[...V,gt]),wt(d)},onEditSubfolder:d=>{yt(d),nt(!0)}}),X==="videos"&&React.createElement(VideoList,{showToast:lt}),X==="products"&&React.createElement(ProductManager,{showToast:lt,settings:q}),X==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:Fe,autoOpenCreateProductId:ne,showToast:lt}),X==="recon"&&React.createElement(ReconExcelManager,{showToast:lt}),X==="stats"&&React.createElement(j,null),X==="settings"&&React.createElement(Qt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${X==="search"?"active":""}`,onClick:d=>{d.preventDefault(),Ee("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${X==="albums"?"active":""}`,onClick:d=>{d.preventDefault(),Ee("albums"),wt(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${X==="videos"?"active":""}`,onClick:d=>{d.preventDefault(),Ee("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${X==="products"?"active":""}`,onClick:d=>{d.preventDefault(),Ee("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${X==="orders"?"active":""}`,onClick:d=>{d.preventDefault(),Ee("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${X==="recon"?"active":""}`,onClick:d=>{d.preventDefault(),Ee("recon")}},React.createElement("i",{className:"fas fa-file-excel"}),React.createElement("span",null,"\u0110\u1ED1i so\xE1t")),React.createElement("a",{href:"#",className:`nav-item ${X==="stats"?"active":""}`,onClick:d=>{d.preventDefault(),Ee("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:Ve,album:Ie,parentId:oe==null?void 0:oe.uuid,onClose:()=>nt(!1),onSave:yn}),React.createElement(AdminDrawer,{open:Pt,title:C?C.title:"Album",subtitle:C?`${C.subfolderCount||0} subfolder \u2022 ${C.count||0} \u1EA3nh`:"",onClose:Et,footer:be?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{ve(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{C&&(yt(C),yn({slug:C.id||"",title:C.title||"",description:C.description||"",cover_url:C.cover||"",parent_id:C.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):C?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(C.title),lt("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>hn(C)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{C&&confirm(`X\xF3a folder "${C.title}"?`)&&(Y(C),Et())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},be&&C?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:C.title,onChange:d=>z({...C,title:d.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:C.description,onChange:d=>z({...C,description:d.target.value})}))):C?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},C.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},C.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},C.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},C.count||0))),C.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,C.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},et.map(d=>React.createElement(Toast,{key:d.id,message:d.message,type:d.type,actionLabel:d.actionLabel,onAction:d.onAction,durationMs:d.durationMs,onClose:()=>Yt(d.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:$,autoOpenCreateProductId:E,showToast:F}){const[ye,re]=useState([]),[W,X]=useState(0),[Ee,je]=useState(!1),[ke,Ge]=useState(!1),[st,Fe]=useState([]),[ze,ne]=useState(!0),[Ke,K]=useState(!1),[it,gt]=useState([]),[wt,Ve]=useState(!1),[nt,Ie]=useState(""),[yt,Rt]=useState([]),[tn,et]=useState(!1),[Dt,Pt]=useState(""),[M,C]=useState(!1),[z,be]=useState(null),[ve,le]=useState(null),[de,Te]=useState(!1),[x,q]=useState(()=>{const e=new Date,n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${n}-${t}`}),[U,oe]=useState(""),[Me,Ae]=useState(!1),[Qe,Ue]=useState(!1),[St,It]=useState(!1),[_e,lt]=useState(null),[Yt,Ct]=useState(!1),[Wt,Bt]=useState(""),[yn,pn]=useState(!1),R=useRef(0),[Y,mt]=useState(!1),[Et,hn]=useState(null),[Kt,Qt]=useState(!1),[j,d]=useState(null),[V,ae]=useState(()=>({left:12,top:12,placement:"bottom"})),Re=useRef(null),Pe=useRef(!1),Je=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1}),[vt,Ze]=useState(()=>({id:null,dir:null})),un=useRef(!1),qt=useRef(new Map),Gt=useRef(null),on=useRef(null),at="ktm_orders_status_sync_queue_v1",cn=useRef([]),Mn=useRef(!1),[bn,s]=useState(()=>({})),[c,v]=useState(!1),[p,T]=useState(!1),[P,_]=useState(!1),[b,S]=useState(()=>new Set),[Q,H]=useState(()=>({})),ge="ktm_orders_pinned_v1",[se,ue]=useState(()=>new Set),[Ne,Oe]=useState(!1),[He,Ce]=useState(!1),[Xe,O]=useState(!1),[De,We]=useState(""),[ut,h]=useState(()=>[]),Se=useRef(null),pt=useRef(null),w=useRef(!1),ie=useRef({active:!1,startY:0,startX:0,fired:!1}),[Be,tt]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),At=24,Zt=20,[ft,Jt]=useState(At),nn=useRef(null),ln=useRef(null),dn=useRef(!1),gn=useRef(new Map),_n=useRef({timer:null,events:[]}),r=useRef(null),g="ktm_orders_phone_tip_v1",u="ktm_orders_search_history_v1",[B,G]=useState(null),[L,A]=useState(!1),[ee,me]=useState([]),[te,ce]=useState(!1),[qe,Ye]=useState([]),[f,we]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[kt,Tt]=useState([""]),[$t,Lt]=useState(null),Xt=useRef({}),[jt,Ht]=useState([]),[bt,an]=useState(null),mn=useRef(null),sn=useRef(null),J=useRef(0),Z=useRef(null),fe=useRef(0),Le=useRef(new Map),$e=useRef(null),xe=useRef(0),dt=useRef(new Map),ot=useRef(new Map),Nt=useRef(""),Vt=useRef(null),rn=useRef(null),vn=useRef(0),Sn=useRef(null),wn=9,kn=150,$n=250,Rn=3*60*1e3,Dn=24*60*60*1e3,qn=5*60*1e3,Ln="ktm_customer_lookup_cache_v1",fa=200,In=3,Hn=3,Ka=1,Ds=24*60*60*1e3,Is=120,Os=5*60*1e3,Ya=80,Qa=2,Za=4,es=60,rt=React.useMemo(()=>String(nt||"").trim().length>0,[nt]),ia=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),ts=e=>{hn(e),mt(!0)},ns=(e,n)=>{var t,a,i,o;try{const y=(t=n==null?void 0:n.getBoundingClientRect)==null?void 0:t.call(n),m=window.innerWidth||360,D=window.innerHeight||640,N=230,l=280,k=Math.min(Math.max(10,Math.round((a=y==null?void 0:y.left)!=null?a:10)),Math.max(10,m-N-10));let I=Math.round(((i=y==null?void 0:y.bottom)!=null?i:10)+8),pe="bottom";I+l>D-10&&(I=Math.max(10,Math.round(((o=y==null?void 0:y.top)!=null?o:10)-8-l)),pe="top"),ae({left:k,top:I,placement:pe})}catch(y){ae({left:12,top:12,placement:"bottom"})}d(e),Qt(!0)},zn=()=>{Qt(!1),setTimeout(()=>d(null),120)};useEffect(()=>{if(!Kt)return;const e=n=>{n.key==="Escape"&&zn()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Kt]);const Xn=()=>{mt(!1),setTimeout(()=>hn(null),180)},Es=()=>{v(!0)},ba=()=>{v(!1)},as=e=>{const n=String(e||"").trim();n&&S(t=>{const a=new Set(t);return a.has(n)?a.delete(n):a.add(n),a})};useEffect(()=>{try{const e=localStorage.getItem(ge);if(!e)return;const n=JSON.parse(e);if(!Array.isArray(n))return;ue(new Set(n.map(t=>String(t||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from(se||[]).map(n=>String(n||"").trim()).filter(Boolean);localStorage.setItem(ge,JSON.stringify(e))}catch(e){}},[se]);const Ks=e=>{const n=String(e||"").trim();n&&ue(t=>{const a=new Set(t);return a.has(n)?a.delete(n):a.add(n),a})};useEffect(()=>{try{const e=localStorage.getItem(u);if(!e)return;const n=JSON.parse(e);if(!Array.isArray(n))return;h(n.map(t=>String(t||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Ps=e=>{try{localStorage.setItem(u,JSON.stringify(e))}catch(n){}},oa=e=>{const n=String(e||"").trim();n&&h(t=>{const a=Array.isArray(t)?t:[],i=[n,...a.filter(o=>String(o||"").trim().toLowerCase()!==n.toLowerCase())].slice(0,10);return Ps(i),i})},ss=e=>{var t;const n=String((t=e!=null?e:nt)!=null?t:"").trim();We(n),O(!0),setTimeout(()=>{var a,i;try{(i=(a=Se.current)==null?void 0:a.focus)==null||i.call(a)}catch(o){}},0)},An=()=>{O(!1)};useEffect(()=>{if(!Xe)return;const e=n=>{n.key==="Escape"&&An()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Xe]),useEffect(()=>{if(!Be)return;const e=a=>{if(Xe||(window.scrollY||0)>6)return;const i=a.touches&&a.touches[0];i&&(ie.current={active:!0,startY:i.clientY,startX:i.clientX,fired:!1})},n=a=>{const i=ie.current;if(!(i!=null&&i.active)||i.fired||(window.scrollY||0)>6)return;const o=a.touches&&a.touches[0];if(!o)return;const y=o.clientY-i.startY,m=o.clientX-i.startX;Math.abs(m)>24||y>92&&(i.fired=!0,ss(nt))},t=()=>{ie.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",n,{passive:!0}),window.addEventListener("touchend",t,{passive:!0}),window.addEventListener("touchcancel",t,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",n),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)}},[Be,Xe,nt]);const rs=e=>{try{const n=fn(e==null?void 0:e.status);if(!(n==="pending"||n==="processing"))return!1;const t=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(t.getTime()))return!1;const a=new Date;return t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()}catch(n){return!1}};useEffect(()=>{var t;let e;const n=()=>{try{tt(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(a){tt(!1)}};try{e=(t=window.matchMedia)==null?void 0:t.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",n):e!=null&&e.addListener&&e.addListener(n)}catch(a){e=null}return window.addEventListener("resize",n),n(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",n):e!=null&&e.removeListener&&e.removeListener(n)}catch(a){}window.removeEventListener("resize",n)}},[]),useEffect(()=>{const e="admin-sheet-open";return Y||c||Kt?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[Y,c,Kt]),useEffect(()=>{if(!Y&&!c&&!Kt)return;const e=n=>{n.key==="Escape"&&(Y&&Xn(),c&&ba(),Kt&&zn())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Y,c,Kt]);const Ls=()=>{try{if(localStorage.getItem(g))return;localStorage.setItem(g,"1"),typeof F=="function"&&F("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},is=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),os=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),cs=e=>{const n=zt(String(e||"")).replace(/[^0-9+]/g,"");if(n)try{window.location.href=`tel:${n}`}catch(t){}},js=async e=>{var t,a,i;const n=zt(String(e||"")).replace(/[^0-9+]/g,"");if(n)try{await((i=(a=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:a.call(t,n))!=null?i:Promise.reject(new Error("Clipboard not available"))),typeof F=="function"&&F("\u0110\xE3 copy S\u0110T","success")}catch(o){typeof F=="function"&&F("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Fs=()=>{try{const e=localStorage.getItem(at),n=e?JSON.parse(e):[];return Array.isArray(n)?n:[]}catch(e){return[]}},ls=e=>{try{localStorage.setItem(at,JSON.stringify(Array.isArray(e)?e:[]))}catch(n){}},ga=(e,n)=>{const t=String(e||"").trim();t&&s(a=>{const i={...a||{}};return n?i[t]=!0:delete i[t],i})},Bs=(e,n,t)=>{const a=String(e||"").trim(),i=fn(n),o=fn(t);if(!a||!i)return;const y=Array.isArray(cn.current)?cn.current:[],m=new Map(y.map(N=>[String((N==null?void 0:N.orderId)||""),N]));m.set(a,{orderId:a,nextStatus:i,prevStatus:o,ts:Date.now()});const D=Array.from(m.values()).sort((N,l)=>(Number(N.ts)||0)-(Number(l.ts)||0));cn.current=D,ls(D),ga(a,!0)},Pa=async()=>{if(Mn.current||!navigator.onLine)return;const e=Array.isArray(cn.current)?cn.current.slice():[];if(e.length){Mn.current=!0;try{for(const n of e){const t=String((n==null?void 0:n.orderId)||"").trim(),a=fn(n==null?void 0:n.nextStatus);if(!(!t||!a)){ga(t,!0);try{await Jn({id:t,status:(n==null?void 0:n.prevStatus)||""},a,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const i=(Array.isArray(cn.current)?cn.current:[]).filter(o=>String((o==null?void 0:o.orderId)||"")!==t);cn.current=i,ls(i),ga(t,!1)}catch(i){if(!navigator.onLine)break}}}}finally{Mn.current=!1}}};useEffect(()=>{const e=Fs();cn.current=e;try{const n={};for(const t of e){const a=String((t==null?void 0:t.orderId)||"").trim();a&&(n[a]=!0)}s(n)}catch(n){}setTimeout(()=>Pa(),600)},[]),useEffect(()=>{const e=()=>Pa();window.addEventListener("online",e);const n=setInterval(()=>Pa(),8e3);return()=>{clearInterval(n),window.removeEventListener("online",e)}},[]);const qs=(e,n)=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e),dn.current=!1,Ls();try{ln.current&&clearTimeout(ln.current)}catch(a){}ln.current=setTimeout(()=>{dn.current=!0,js(n)},520)},ya=e=>{var n;(n=e==null?void 0:e.stopPropagation)==null||n.call(e);try{ln.current&&clearTimeout(ln.current)}catch(t){}ln.current=null},Hs=e=>{const n=String(e||"").trim();if(!n)return;H(i=>({...i,[n]:Date.now()}));const t=gn.current;try{const i=t.get(n);i&&clearTimeout(i)}catch(i){}const a=setTimeout(()=>{H(i=>{const o={...i||{}};return delete o[n],o});try{t.delete(n)}catch(i){}},9e3);t.set(n,a)},ds=e=>String(e||"").replace(/\s+/g," ").trim(),zs=e=>String(e||"").replace(/[^0-9]+/g,""),ca=e=>{try{const n=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(n))return 0;const t=Date.now()-n;return!Number.isFinite(t)||t<=0?0:Math.floor(t/Ds)}catch(n){return 0}},va=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:ca(e)>=In,fn=e=>{const n=String(e!=null?e:"").trim().toLowerCase();return n==="cancelled"?"canceled":n},La=React.useMemo(()=>["draft","pending","processing","done","paid"],[]),Yn=(e,n)=>{const t=fn(e);if(!t||t==="canceled")return null;const a=La.indexOf(t);return a<0?null:n==="left"?La[a+1]||null:n==="right"&&La[a-1]||null},ms=e=>{var i;const n=fn(e);if(!n)return{label:"",icon:"fa-circle"};const t=((i=ia.find(o=>fn(o==null?void 0:o.value)===n))==null?void 0:i.label)||"",a=(()=>{switch(n){case"draft":return"fa-file-lines";case"pending":return"fa-hourglass-half";case"processing":return"fa-truck";case"done":return"fa-check";case"paid":return"fa-money-bill-wave";case"canceled":return"fa-ban";default:return"fa-circle"}})();return{label:t,icon:a}},Na=e=>{if(fn(e==null?void 0:e.status)!=="draft")return null;const t=Hn-ca(e);return Number.isFinite(t)?t:null},wa=e=>{const n=Na(e);return Number.isFinite(n)?n>0&&n<=Ka:!1},Vn=e=>{we({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Tt([""]),G(null),Lt(null)};useEffect(()=>{const e=n=>{var a;if($t==null)return;const t=(a=Xt.current)==null?void 0:a[$t];t&&!t.contains(n.target)&&Lt(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[$t]);const us=e=>window.KTM.money.parseMoney(e),ps=e=>window.KTM.money.parseSignedMoney(e),Ot=e=>window.KTM.money.formatVND(e),On=e=>{const t=(Array.isArray(e)?e:[]).map(a=>{var i,o;return{amount:String((i=a==null?void 0:a.amount)!=null?i:""),note:String((o=a==null?void 0:a.note)!=null?o:"")}});return t.length?t:[{amount:"",note:""}]},Xs=e=>{try{const n=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(n)?n:[]).map(a=>{var i,o;return{amount:(a==null?void 0:a.amount)===0?"":String((i=a==null?void 0:a.amount)!=null?i:""),note:String((o=a==null?void 0:a.note)!=null?o:"").trim()}}).filter(a=>String(a.amount||"").trim()||String(a.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(n){return[{amount:"",note:""}]}},Qn=e=>(Array.isArray(e)?e:[]).map(t=>({amount:ps(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),ja=e=>{const n=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Qn(n),a=Zn(t),i=(()=>{if(!t.length)return"";const o=t.map(y=>String((y==null?void 0:y.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:a,summaryText:i}},Zn=e=>(Array.isArray(e)?e:[]).reduce((t,a)=>t+(Number(a==null?void 0:a.amount)||0),0),Fa=e=>{const n=Array.isArray(e)?e:[];return n.length?JSON.stringify(n):""},hr=e=>window.KTM.money.parseShipFeeFromNote(e),ea=e=>window.KTM.phone.isValid(e),zt=e=>window.KTM.phone.normalize(e),Ba=async e=>{if(!e)return null;const n=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return n&&typeof n=="object"&&n.order&&typeof n.order=="object"?n.order:n},Vs=(e,n)=>{var o;const t=Array.isArray(e)?e:[],a=Array.isArray(n)?n:[];if(!t.length)return a;if(!a.length)return t;const i=new Map(t.map(y=>{var m;return[String((m=y==null?void 0:y.id)!=null?m:""),y]}));for(const y of a){const m=String((o=y==null?void 0:y.id)!=null?o:"");m&&i.set(m,y)}return Array.from(i.values())},Sa=async e=>{var n,t,a,i;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const o=(t=(n=qt.current)==null?void 0:n.get)==null?void 0:t.call(n,String(e.id));if(o&&typeof o=="object"&&Array.isArray(o.items)&&o.items.length)return o}catch(o){}try{const o=await Ba(e.id);if(o&&typeof o=="object"){try{(i=(a=qt.current)==null?void 0:a.set)==null||i.call(a,String(e.id),o)}catch(y){}return re(y=>Array.isArray(y)?y.map(m=>String(m==null?void 0:m.id)===String(e.id)?o:m):y),o}}catch(o){console.error("Fetch order by id error:",o)}return e},Ws=()=>{var e;try{const n=localStorage.getItem(Ln);if(!n)return;const t=JSON.parse(n);if(!t||typeof t!="object")return;const a=Object.entries(t);for(const[i,o]of a)!i||!o||typeof o!="object"||(e=ot.current)==null||e.set(String(i),o)}catch(n){}},qa=()=>{try{const e=ot.current;if(!e||typeof e.entries!="function")return;const n=Array.from(e.entries()).filter(([a,i])=>a&&i&&typeof i=="object"&&Number.isFinite(i.ts)).sort((a,i)=>(Number(i[1].ts)||0)-(Number(a[1].ts)||0)).slice(0,fa),t={};for(const[a,i]of n)t[a]=i;localStorage.setItem(Ln,JSON.stringify(t))}catch(e){}};useEffect(()=>{Ws()},[]);const hs=e=>{const n=zt(e);if(!n)return null;const t=Array.isArray(ye)?ye:[];let a=null,i=-1;for(const o of t){if(!o||zt(o.phone||"")!==n)continue;const y=new Date(o.created_at).getTime(),m=Number.isFinite(y)?y:0;m>=i&&(i=m,a=o)}return a?{name:String(a.customer_name||"").trim(),address:String(a.address||"").trim()}:null},fs=(e,n)=>{e&&we(t=>n&&zt(t.phone)!==n?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Gs=e=>{const n=hs(e);if(!n)return;const t=zt(e);we(a=>{if(t&&zt(a.phone)!==t)return a;const i={...a};return!String(a.customer_name||"").trim()&&n.name&&(i.customer_name=n.name),!String(a.address||"").trim()&&n.address&&(i.address=n.address),i})},Js=(e,n,t)=>{var a;try{const i=zt(e);if(!i)return;const o=String(n||"").trim(),y=String(t||"").trim();if(!o&&!y)return;(a=ot.current)==null||a.set(i,{ts:Date.now(),status:"found",customer:{phone:i,name:o||null,address:y||null}}),qa()}catch(i){}},ka=async e=>{var i,o,y;const n=zt(e);if(!n)return;Gs(n);const t=(i=ot.current)==null?void 0:i.get(n);if(t&&Number.isFinite(t.ts)){const m=Date.now()-t.ts,D=t.status==="found"?Dn:qn;if(m>=0&&m<=D){G({status:t.status,phone:n,customer:t.customer}),t.status==="found"&&t.customer&&fs(t.customer,n);return}}const a=++J.current;G({status:"loading",phone:n});try{const m=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(n)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(J.current!==a)return;if(m&&m.exists&&m.customer){(o=ot.current)==null||o.set(n,{ts:Date.now(),status:"found",customer:m.customer}),qa(),G({status:"found",phone:n,customer:m.customer}),fs(m.customer,n);return}(y=ot.current)==null||y.set(n,{ts:Date.now(),status:"not-found",customer:null}),qa(),G({status:"not-found",phone:n})}catch(m){if(J.current!==a)return;console.error("Customer lookup error:",m),G({status:"error",phone:n})}},bs=e=>{const n=zt(e),t=hs(n);we(i=>{const o={...i,phone:n};return t&&(!String(i.customer_name||"").trim()&&t.name&&(o.customer_name=t.name),!String(i.address||"").trim()&&t.address&&(o.address=t.address)),o}),A(!1),sn.current&&(clearTimeout(sn.current),sn.current=null);const a=n;if(a.length<wn){G(null);return}if(ea(a)&&a!==Nt.current){Nt.current=a,ka(a);return}sn.current=setTimeout(()=>{const i=zt(n);ea(i)&&i!==Nt.current&&(Nt.current=i,ka(i))},kn)},gs=()=>{const e=zt(f.phone);e.length<wn||ea(e)&&e!==Nt.current&&(Nt.current=e,ka(e))};useEffect(()=>(Qe?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Qe]);const xa=Array.isArray(f.items)?f.items.length:0;useEffect(()=>{if(!Qe){vn.current=xa;return}xa>vn.current&&setTimeout(()=>{const e=Vt.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),vn.current=xa},[Qe,xa]),useEffect(()=>()=>{sn.current&&(clearTimeout(sn.current),sn.current=null),Z.current&&(clearTimeout(Z.current),Z.current=null)},[]),useEffect(()=>{if(!Qe)return;Z.current&&(clearTimeout(Z.current),Z.current=null);const e=zt((f==null?void 0:f.phone)||"");if(!ea(e)){me([]),ce(!1);return}return Z.current=setTimeout(async()=>{var i;const n=String(e),t=(i=Le.current)==null?void 0:i.get(n);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=Rn){me(Array.isArray(t.orders)?t.orders:[]),ce(!1);return}const a=++fe.current;ce(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,y=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(fe.current!==a)return;const m=Array.isArray(y)?y:Array.isArray(y==null?void 0:y.orders)?y.orders:[];me(m);try{const D=Le.current;if(D&&typeof D.set=="function"&&(D.set(n,{ts:Date.now(),orders:m}),D.size>100)){const N=Array.from(D.entries()).sort((k,I)=>{var pe,he;return(Number((pe=k==null?void 0:k[1])==null?void 0:pe.ts)||0)-(Number((he=I==null?void 0:I[1])==null?void 0:he.ts)||0)}),l=Math.max(0,N.length-100);for(let k=0;k<l;k++)D.delete(N[k][0])}}catch(D){}}catch(o){if(fe.current!==a)return;console.error("Phone history fetch error:",o),me([])}finally{if(fe.current!==a)return;ce(!1)}},$n),()=>{Z.current&&(clearTimeout(Z.current),Z.current=null)}},[Qe,f==null?void 0:f.phone]),useEffect(()=>{Qs()},[]),useEffect(()=>{rt||Wn()},[x,rt]),useEffect(()=>{Ta()},[]),useEffect(()=>{$&&mn.current!==$&&(mn.current=$,Ma(E))},[$]);const Tn=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",ta=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",jn=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(ye),n=se;if(!n||!(n instanceof Set)||n.size===0)return e;const t=Array.isArray(e)?e.slice():[];return t.sort((a,i)=>{var m,D;const o=n.has(String((m=a==null?void 0:a.id)!=null?m:""))?1:0;return(n.has(String((D=i==null?void 0:i.id)!=null?D:""))?1:0)-o}),t},[ye,se]),Ha=React.useMemo(()=>window.KTM.orders.sortOrders(st),[st]),Ca=React.useMemo(()=>{const n=(Array.isArray(Ha)?Ha:[]).filter(t=>va(t));return n.sort((t,a)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(a==null?void 0:a.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),n},[Ha]),ys=React.useMemo(()=>{const n=(Array.isArray(it)?it:[]).filter(t=>wa(t));return n.sort((t,a)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(a==null?void 0:a.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),n},[it]),la=React.useMemo(()=>{if(Me)return Ca;let e=jn;if(Ne){const n=se;e=(Array.isArray(e)?e:[]).filter(t=>{var a,i;return(i=n==null?void 0:n.has)==null?void 0:i.call(n,String((a=t==null?void 0:t.id)!=null?a:""))})}return He&&(e=(Array.isArray(e)?e:[]).filter(n=>rs(n))),e},[Me,Ca,jn,Ne,se,He]),Aa=React.useMemo(()=>{if(Me)return la;const e=String(U||"").trim();return e?(Array.isArray(la)?la:[]).filter(n=>String((n==null?void 0:n.status)||"").trim()===e):la},[la,U,Me]),vs=React.useMemo(()=>window.KTM.orders.sortOrders(yt),[yt]),en=React.useMemo(()=>rt?vs:Aa,[Aa,rt,vs]),Ns=React.useMemo(()=>{const e=Array.isArray(en)?en:[];return Be?e.slice(0,Math.max(0,Number(ft)||0)):e},[Be,ft,en]);useEffect(()=>{Be&&Jt(At)},[Be,U,Me,x,nt]),useEffect(()=>{if(!Be)return;const e=Array.isArray(en)?en.length:0;if(ft>=e)return;const n=nn.current;if(!n)return;const t=new IntersectionObserver(a=>{Array.isArray(a)&&a.some(o=>o==null?void 0:o.isIntersecting)&&Jt(o=>Math.min((Number(o)||0)+Zt,e))},{root:null,rootMargin:"520px 0px",threshold:0});return t.observe(n),()=>t.disconnect()},[Be,ft,en]),useEffect(()=>{if(!Be){T(!1),_(!1);return}const e=()=>{r.current||(r.current=window.requestAnimationFrame(()=>{r.current=null;const n=window.scrollY||document.documentElement.scrollTop||0;T(n>140),_(n>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),r.current&&(window.cancelAnimationFrame(r.current),r.current=null)}},[Be]),useEffect(()=>{if(!Be){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(n){}return}const e=()=>{try{const n=document.querySelector(".mobile-bottom-nav"),t=n&&n.offsetHeight?n.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${t}px`)}catch(n){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[Be]);const Fn=React.useMemo(()=>{const e=Array.isArray(en)?en:[],n={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const a=fn(t==null?void 0:t.status);a==="draft"?n.draft+=1:a==="pending"?n.pending+=1:a==="processing"?n.processing+=1:a==="done"?n.done+=1:a==="paid"?n.paid+=1:a==="canceled"?n.canceled+=1:n.other+=1}return n},[en]),Us=React.useMemo(()=>{const e=se;return!e||e.size===0?0:(Array.isArray(jn)?jn:[]).reduce((n,t)=>{var a;return n+(e.has(String((a=t==null?void 0:t.id)!=null?a:""))?1:0)},0)},[se,jn]),Ys=React.useMemo(()=>(Array.isArray(jn)?jn:[]).filter(e=>rs(e)).length,[jn]),ws=React.useMemo(()=>{const e=new Date,n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${n}-${t}`},[]),Pn=e=>{if(rt&&Ie(""),e==="thisMonth"){Ae(!1),oe(""),q(ws);return}if(e==="overduePending"){q(""),Ae(!0),oe("pending");return}if(e==="draftExpiring"){Ae(!1),oe("draft"),q(""),Ta();return}if(e==="all"){Ae(!1),oe(""),q(ws);return}},na=e=>window.KTM.date.formatDateTime(e),Qs=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Ht(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Ht([])}},Wn=async()=>{ne(!0),Ge(!1);try{const n=new URLSearchParams;x&&n.set("month",String(x)),n.set("includeItems","0"),n.set("meta","1"),n.set("limit",String(es)),n.set("offset","0");const t=`${API_BASE}/api/orders?${n.toString()}`,a=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),i=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.orders)?a.orders:[],o=!Array.isArray(a)&&a&&typeof a=="object"&&a.meta||null;re(Array.isArray(i)?i:[]),X(Array.isArray(i)?i.length:0),je(!!(o!=null&&o.hasMore)),Ta()}catch(n){console.error("Load orders error:",n),re([]),X(0),je(!1)}finally{ne(!1),Ge(!1)}},Zs=async()=>{if(!(ze||ke||rt)&&Ee){Ge(!0);try{const e=new URLSearchParams;x&&e.set("month",String(x)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(es)),e.set("offset",String(W));const n=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(n,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),a=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],i=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;re(o=>Vs(o,Array.isArray(a)?a:[])),X(o=>o+(Array.isArray(a)?a.length:0)),je(!!(i!=null&&i.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{Ge(!1)}}},Ss=async e=>{var i;const n=ds(e);if(!n){Rt([]),Pt(""),et(!1);return}const t=zs(n);if(n.length<Qa&&t.length<Za){Rt([]),Pt(`Nh\u1EADp \xEDt nh\u1EA5t ${Qa} k\xFD t\u1EF1 (ho\u1EB7c ${Za} s\u1ED1) \u0111\u1EC3 search nhanh`),et(!1);return}try{const o=(i=dt.current)==null?void 0:i.get(n);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=Os){Rt(Array.isArray(o.results)?o.results:[]),Pt(""),et(!1);return}}catch(o){}const a=++xe.current;et(!0),Pt("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(n)}`,y=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(xe.current!==a)return;const m=Array.isArray(y)?y:[];Rt(m);try{const D=dt.current;if(D&&typeof D.set=="function"&&(D.set(n,{ts:Date.now(),results:m}),D.size>Ya)){const N=Array.from(D.entries()).sort((k,I)=>{var pe,he;return(Number((pe=k==null?void 0:k[1])==null?void 0:pe.ts)||0)-(Number((he=I==null?void 0:I[1])==null?void 0:he.ts)||0)}),l=Math.max(0,N.length-Ya);for(let k=0;k<l;k++)D.delete(N[k][0])}}catch(D){}}catch(o){if(xe.current!==a)return;console.error("Order search error:",o),Rt([]),Pt((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if(xe.current!==a)return;et(!1)}};useEffect(()=>{$e.current&&(clearTimeout($e.current),$e.current=null);const e=ds(nt);if(!e){Rt([]),Pt(""),et(!1);return}return Me&&Ae(!1),$e.current=setTimeout(()=>{Ss(e)},Is),()=>{$e.current&&(clearTimeout($e.current),$e.current=null)}},[nt]);const Ta=async()=>{K(!0),Ve(!0);try{const[e,n]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(In)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Ka)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);Fe(Array.isArray(e)?e:[]),gt(Array.isArray(n)?n:[])}catch(e){console.error("Load all orders error:",e),Fe([]),gt([])}finally{K(!1),Ve(!1)}},za=async e=>{const n=await Sa(e);if(!n)return;an(n.id);const t=Array.isArray(n.items)&&n.items.length?n.items.map(m=>{var D,N,l,k;return{product_id:(m==null?void 0:m.product_id)||"",quantity:Number((D=m==null?void 0:m.quantity)!=null?D:1)||1,unit_price:(()=>{var he;const I=(he=m==null?void 0:m.unit_price)!=null?he:m==null?void 0:m.unitPrice,pe=I==null||I===""?NaN:Number(I);return Number.isFinite(pe)?Math.trunc(pe):null})(),variant:String((N=m==null?void 0:m.variant)!=null?N:"").trim(),variant_json:(k=(l=m==null?void 0:m.variant_json)!=null?l:m==null?void 0:m.variantJson)!=null?k:null}}).filter(m=>m.product_id):[{product_id:n.product_id||"",quantity:Number(n.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],a=Xs(n),i=Qn(a),o=Zn(i),y=Fa(i);we({customer_name:n.customer_name||"",phone:zt(n.phone||""),address:n.address||"",note:(n==null?void 0:n.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:a,adjustment_amount:o,adjustment_note:y||(n==null?void 0:n.adjustment_note)||"",status:n.status||"pending"}),Tt(new Array(t.length?t.length:1).fill("")),Ye(new Array(t.length?t.length:1).fill(!0)),G(null),Ue(!1),lt(n),It(!0),Bt(""),Ct(!1),pn(!0),n.phone&&ka(zt(n.phone))},da=async e=>{if(!e)return;It(!0),Bt(""),Ct(!0),pn(!1),lt(e);const n=++R.current;try{const t=await Sa(e);if(R.current!==n)return;lt(t||e)}catch(t){if(R.current!==n)return;Bt((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(R.current!==n)return;Ct(!1)}},er=()=>{M||de||(It(!1),Ct(!1),Bt(""),pn(!1),an(null),Vn(""),A(!1),Ye([]))};function Ma(e){It(!1),pn(!1),Ct(!1),Bt(""),an(null),Vn(e||""),A(!1),Ye([]),Ue(!0)}const Xa=()=>{M||de||(Ue(!1),an(null),Vn(""),A(!1),Ye([]))},ks=async()=>{var m,D,N;if(!bt||de||M)return;const e=(Array.isArray(ye)?ye:[]).find(l=>String(l==null?void 0:l.id)===String(bt))||null,n=String((e==null?void 0:e.status)||(f==null?void 0:f.status)||"").trim();if(n==="done"||n==="paid"||n==="canceled"){const l="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof F=="function"?F(l,"warning"):alert(l);return}const t=zt(f.phone),i=(Array.isArray(f.items)?f.items:[]).map((l,k)=>{var I,pe;return{idx:k,product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((I=l==null?void 0:l.quantity)!=null?I:0),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(pe=l==null?void 0:l.variant_json)!=null?pe:null,unit_price:(()=>{const he=l==null?void 0:l.unit_price,ht=he===""||he==null?NaN:Number(he);if(Number.isFinite(ht))return Math.max(0,Math.trunc(ht));const ct=xn(l==null?void 0:l.product_id),Ut=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return aa(ct,Ut)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);if(i.length<2){const l="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof F=="function"?F(l,"warning"):alert(l);return}const o=[],y=[];for(const l of i){const k=!!qe[l.idx],I={product_id:l.product_id,quantity:l.quantity,unit_price:l.unit_price,variant:l.variant,variant_json:l.variant_json};k?o.push(I):y.push(I)}if(!o.length||!y.length){const l="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof F=="function"?F(l,"warning"):alert(l);return}Te(!0);try{const l=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],k=Qn(l),I=Zn(k),pe=Fa(k),he={customer_name:f.customer_name,phone:t,address:f.address,note:(f.note||"").trim(),adjustment_amount:I,adjustment_note:pe,adjustment_items:k,status:"processing",items:o,product_id:o[0].product_id,quantity:o[0].quantity,split_seq:1},ht=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,he,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),ct=(N=(D=ht==null?void 0:ht.id)!=null?D:(m=ht==null?void 0:ht.order)==null?void 0:m.id)!=null?N:null;if(!ct)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const Ut={id:bt,customer_name:f.customer_name,phone:t,address:f.address,note:(f.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:y,product_id:y[0].product_id,quantity:y[0].quantity,parent_order_id:String(ct),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${bt}`,Ut,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Xa(),Wn();const xt=ct?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${ct}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof F=="function"?F(xt,"success"):alert(xt)}catch(l){console.error(l);const k=(l==null?void 0:l.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof F=="function"?F(k,"danger"):alert(k)}finally{Te(!1)}},xs=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const n=String(e),t=jt.find(a=>String(a==null?void 0:a.id)===n);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},En=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(n){return String(e!=null?e:"").toLowerCase()}},tr=e=>{const t=En(e).trim().split(/\s+/).filter(Boolean),a=t.join(" ");return{contentTokens:t,cleanedQuery:a}},Cs=React.useMemo(()=>(Array.isArray(jt)?jt:[]).map((e,n)=>{var N,l,k,I,pe,he;const t=En((N=e==null?void 0:e.name)!=null?N:""),a=En((l=e==null?void 0:e.code)!=null?l:""),i=En((k=e==null?void 0:e.category)!=null?k:""),o=En((I=e==null?void 0:e.note)!=null?I:""),y=En((pe=e==null?void 0:e.id)!=null?pe:""),m=En((he=e==null?void 0:e.stt)!=null?he:""),D=`${t} ${a} ${i} ${o} ${y} ${m}`.trim();return{p:e,originalIndex:n,name:t,code:a,category:i,note:o,haystackAll:D}}),[jt]),nr=(e,n,t)=>{var k,I,pe,he,ht;const a=Array.isArray(n)?n:[],i=En(t).trim();if(!a.length&&!i)return 0;const o=(k=e==null?void 0:e.name)!=null?k:"",y=(I=e==null?void 0:e.code)!=null?I:"",m=(pe=e==null?void 0:e.category)!=null?pe:"",D=(he=e==null?void 0:e.note)!=null?he:"";if(!((ht=e==null?void 0:e.haystackAll)!=null?ht:""))return 0;let l=0;i&&(o===i&&(l+=220),o.includes(i)&&(l+=140),o.startsWith(i)&&(l+=160),y&&y===i&&(l+=180),y&&y.includes(i)&&(l+=90));for(const ct of a){if(!ct)continue;const Ut=new RegExp(`(?:^|\\s)${ct.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(ct)&&(l+=35),Ut.test(o)&&(l+=25),y&&y.includes(ct)&&(l+=20),y&&Ut.test(y)&&(l+=10),m&&m.includes(ct)&&(l+=12),D&&D.includes(ct)&&(l+=6)}return l>0&&o&&(l+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),l},Va=(e,n)=>{const t=String(e||""),a=String(n||"");if(t===a)return 0;if(!t)return a.length;if(!a)return t.length;const i=t.length,o=a.length;if(o>i)return Va(a,t);let y=new Array(o+1),m=new Array(o+1);for(let D=0;D<=o;D++)y[D]=D;for(let D=1;D<=i;D++){m[0]=D;const N=t.charCodeAt(D-1);for(let k=1;k<=o;k++){const I=N===a.charCodeAt(k-1)?0:1;m[k]=Math.min(y[k]+1,m[k-1]+1,y[k-1]+I)}const l=y;y=m,m=l}return y[o]},ar=(e,n)=>{const t=String(e||"").trim(),a=String(n||"");if(!t||!a)return!1;if(a.includes(t))return!0;const i=a.split(/\s+/).filter(Boolean);if(!i.length)return!1;const o=t.length<=4?1:2;for(const y of i)if(!(Math.abs(y.length-t.length)>o)&&Va(t,y)<=o)return!0;return!1},_a=e=>{const n=En(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return n?n.split(" ").filter(Boolean):[]},sr=(e,n)=>{const t=Array.isArray(n)?n:[];if(!t.length)return 0;const a=_a((e==null?void 0:e.name)||""),i=_a((e==null?void 0:e.code)||""),o=_a((e==null?void 0:e.category)||""),y=_a((e==null?void 0:e.note)||""),m=(N,l,k)=>{const I=String(N||"").trim();if(!I||!l.length)return 0;const pe=I.length<=4?1:2;let he=1/0,ht=-1;for(let xt=0;xt<l.length;xt++){const Cn=l[xt];if(!Cn||Math.abs(Cn.length-I.length)>pe)continue;const Ft=Va(I,Cn);if(Ft<he&&(he=Ft,ht=xt,Ft===0))break}if(he===1/0||he>pe)return 0;let Ut=Math.round(k*(he===0?1:he===1?.65:.45));return ht===0?Ut+=Math.round(k*.25):ht===1&&(Ut+=Math.round(k*.12)),Ut};let D=0;for(const N of t){if(!N)continue;const l=m(N,a,180),k=m(N,i,120),I=m(N,o,60),pe=m(N,y,30);D+=Math.max(l,k,I,pe)}if(D>0){const N=((e==null?void 0:e.name)||"").length;D+=Math.max(0,60-Math.min(60,Math.floor(N/2)))}return D},Wa=React.useRef(new Map);React.useEffect(()=>{Wa.current=new Map},[jt]);const As=e=>{var N,l;const n=String(kt[e]||"").trim();if(!n)return jt;const{contentTokens:t,cleanedQuery:a}=tr(n);if(t.length===0)return jt;const i=En(n).trim(),o=Wa.current.get(i);if(o)return o;const y=[];for(const k of Cs){const I=k.haystackAll;I&&t.some(pe=>I.includes(pe))&&y.push(k)}let m=y;if(m.length<8&&t.length>0){const k=[],I=new Set(m.map(pe=>{var he,ht;return String((ht=(he=pe.p)==null?void 0:he.id)!=null?ht:"")+":"+String(pe.originalIndex)}));for(const pe of Cs){const he=String((l=(N=pe.p)==null?void 0:N.id)!=null?l:"")+":"+String(pe.originalIndex);if(I.has(he))continue;const ht=pe.haystackAll;ht&&t.some(ct=>ar(ct,ht))&&(k.push(pe),I.add(he))}k.length&&(m=m.concat(k))}const D=m.map(k=>({entry:k,score:nr(k,t,a)})).map(k=>{if(k.score>0)return k;const I=sr(k.entry,t);return I>0?{...k,score:I}:k}).filter(k=>k.score>0).sort((k,I)=>I.score!==k.score?I.score-k.score:k.entry.originalIndex-I.entry.originalIndex).slice(0,40).map(k=>k.entry.p);return Wa.current.set(i,D),D},xn=e=>{if(!e)return null;const n=String(e);return jt.find(t=>String(t==null?void 0:t.id)===n)||null},Bn=e=>{if(e==null||e==="")return[];let n=e;if(typeof n=="string"){const t=n.trim();if(!t)return[];try{n=JSON.parse(t)}catch(a){return[]}}return Array.isArray(n)?n.map((t,a)=>{var y;if(!t||typeof t!="object")return null;const i=String((y=t.name)!=null?y:"").trim()||`Bi\u1EBFn th\u1EC3 ${a+1}`,o=(Array.isArray(t.options)?t.options:[]).map(m=>{var ht,ct,Ut,xt,Cn,Ft,Kn;if(!m||typeof m!="object")return null;const D=String((ht=m.label)!=null?ht:"").trim();if(!D)return null;const N=(Cn=(xt=(Ut=(ct=m.price)!=null?ct:m.priceValue)!=null?Ut:m.unit_price)!=null?xt:m.unitPrice)!=null?Cn:null,l=N==null||N===""?NaN:typeof N=="number"?N:typeof N=="string"?us(N):Number(N),k=Number.isFinite(l)?Math.trunc(l):null,I=(Kn=(Ft=m.price_delta)!=null?Ft:m.priceDelta)!=null?Kn:null,pe=Number(I),he=Number.isFinite(pe)?Math.trunc(pe):0;return{label:D,price:k,price_delta:he}}).filter(Boolean);return{name:i,options:o}}).filter(Boolean):[]},fr=e=>{const n=xn(e);return Bn(n==null?void 0:n.variants)},$a=e=>{if(!e||typeof e!="object")return"";const n=[];for(const[t,a]of Object.entries(e)){const i=String(t||"").trim(),o=String(a||"").trim();!i||!o||n.push(`${i}: ${o}`)}return n.join(", ")},aa=(e,n)=>{const t=us(e==null?void 0:e.price),a=Bn(e==null?void 0:e.variants);if(!a.length||!n||typeof n!="object")return t;let i=t,o=!1;for(const y of a){const m=String((y==null?void 0:y.name)||"").trim(),D=String((n==null?void 0:n[m])||"").trim();if(!m||!D)continue;const N=(Array.isArray(y.options)?y.options:[]).find(he=>String((he==null?void 0:he.label)||"").trim()===D);if(!N)continue;const l=N==null?void 0:N.price,k=l==null||l===""?NaN:Number(l);if(Number.isFinite(k)){i=Math.max(0,Math.trunc(k)),o=!0;continue}const I=N==null?void 0:N.price_delta,pe=I==null||I===""?NaN:Number(I);Number.isFinite(pe)&&(i+=Math.trunc(pe))}return i},Ga=e=>window.KTM.orders.getOrderItems(e),Ts=e=>window.KTM.orders.getOrderTotalQty(e),sa=e=>window.KTM.orders.getOrderProductSummary(e,xn),Ra=e=>window.KTM.orders.getOrderItemRows(e,xn),ma=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Gn=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),rr=e=>{const n=Ga(e),t=Ra(e),a=pa(n),i=ua(n),o=i.fee,y=ma(e),m=a+o+y,D=l=>{const k=Number(l)||0;return k>0?`+${Ot(k)}`:Ot(k)},N=[];if(e!=null&&e.customer_name&&N.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&N.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&N.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&N.push(`GHI CH\xDA: ${(e.note||"").trim()}`),N.push(""),N.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const l of t)N.push(`- ${l.name} (SL: ${l.qty})`);else{const l=sa(e);l&&l!=="\u2014"&&N.push(`- ${l}`)}N.push(""),N.push(`T\u1EA0M T\xCDNH: ${Ot(a)}`),i.found&&o!==0&&N.push(`SHIP: ${Ot(o)}`);{const l=window.KTM.orders.getOrderAdjustmentItems(e),k=(Array.isArray(l)?l:[]).map(he=>{var ht;return{amount:Number((ht=he==null?void 0:he.amount)!=null?ht:0)||0,note:String((he==null?void 0:he.note)||"").trim()}}).filter(he=>he.amount!==0||!!he.note),I=Gn(e);if(y!==0||k.length>0||!!I)if(k.length===1){const he=k[0];N.push(`\u0110I\u1EC0U CH\u1EC8NH: ${D(y)}${he.note?` \u2014 ${he.note}`:""}`)}else{N.push(`\u0110I\u1EC0U CH\u1EC8NH: ${D(y)}${!k.length&&I?` \u2014 ${I}`:""}`);for(const he of k)N.push(`- ${D(he.amount)}${he.note?`: ${he.note}`:""}`)}}return N.push(`T\u1ED4NG: ${Ot(m)}`),N.filter(Boolean).join(`
`)},Da=async e=>{try{const n=await Sa(e),t=rr(n);await window.KTM.clipboard.writeText(t),typeof F=="function"?F("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(n){console.error(n),typeof F=="function"?F("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},ua=e=>window.KTM.orders.getOrderShipInfo(e,xn),pa=e=>window.KTM.orders.getItemsSubtotal(e,xn),Ja=e=>{try{const n=e instanceof Date?e:new Date(e);if(!n||Number.isNaN(n.getTime()))return"";const t=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0");return`${t}-${a}`}catch(n){return""}},Ua=()=>x?String(x):Ja(new Date),Ms=e=>{const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=zt((e==null?void 0:e.phone)||""),a=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ja(e).amount,y=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(m=>{var D;return{product_id:String((m==null?void 0:m.product_id)||"").trim(),quantity:Number((D=m==null?void 0:m.quantity)!=null?D:0),variant:String((m==null?void 0:m.variant)||"").trim()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0).sort((m,D)=>m.product_id<D.product_id?-1:m.product_id>D.product_id?1:m.variant<D.variant?-1:m.variant>D.variant?1:m.quantity-D.quantity);return JSON.stringify({name:n,phone:t,address:a,items:y,adj:i})},Nn=React.useMemo(()=>{const e=zt((f==null?void 0:f.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ua()};const n=Ua(),a=(Array.isArray(ee)?ee:[]).filter(i=>{if(!i||bt&&String(i.id)===String(bt)||zt(i.phone||"")!==e)return!1;const o=Ja(i.created_at);return o&&o===n}).sort((i,o)=>{const y=new Date(i.created_at).getTime(),m=new Date(o.created_at).getTime();return(Number.isFinite(m)?m:0)-(Number.isFinite(y)?y:0)});return{count:a.length,orders:a,monthKey:n}},[ee,f==null?void 0:f.phone,x,bt]),ir=e=>{var m;const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=zt((e==null?void 0:e.phone)||""),a=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ps((m=e==null?void 0:e.adjustment_amount)!=null?m:0),o=Ga(e),y=(Array.isArray(o)?o:[]).map(D=>{var N;return{product_id:String((D==null?void 0:D.product_id)||"").trim(),quantity:Number((N=D==null?void 0:D.quantity)!=null?N:0),variant:String((D==null?void 0:D.variant)||"").trim()}}).filter(D=>D.product_id&&Number.isFinite(D.quantity)&&D.quantity>0).sort((D,N)=>D.product_id<N.product_id?-1:D.product_id>N.product_id?1:D.variant<N.variant?-1:D.variant>N.variant?1:D.quantity-N.quantity);return JSON.stringify({name:n,phone:t,address:a,items:y,adj:i})},_s=React.useMemo(()=>{if(bt)return"";const e=zt((f==null?void 0:f.phone)||"");if(!e)return"";const n=Ua(),t=Ms(f),a=Array.isArray(ee)?ee:[];for(const i of a){if(!i||bt&&String(i.id)===String(bt)||zt(i.phone||"")!==e)continue;const o=Ja(i.created_at);if(!o||o!==n)continue;const y=ir(i);if(y&&y===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${n}${i!=null&&i.id?` (#${i.id})`:""}`}return""},[ee,f,x,bt]),$s=e=>{var Cn;const n=[],t=[],a=String((e==null?void 0:e.customer_name)||"").trim(),i=zt((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim();a||n.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),i||n.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),i&&!ea(i)&&n.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const m=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ft=>Ft&&Ft.product_id);m.length===0&&n.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),m.some(Ft=>{var Un;const Kn=Number((Un=Ft==null?void 0:Ft.quantity)!=null?Un:0);return!Number.isFinite(Kn)||Kn<=0})&&n.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const N=new Set;let l=!1;for(const Ft of m){const Kn=String(Ft.product_id||"").trim(),Un=String((Ft==null?void 0:Ft.variant)||"").trim();if(!Kn)continue;const _t=`${Kn}||${Un}`;if(N.has(_t)){l=!0;break}N.add(_t)}l&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const k=pa(m),I=ua(m),pe=I!=null&&I.found?Number((Cn=I==null?void 0:I.fee)!=null?Cn:0):0,he=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],ht=Qn(he),ct=Zn(ht),Ut=ht.some(Ft=>(Number(Ft==null?void 0:Ft.amount)||0)!==0&&!String((Ft==null?void 0:Ft.note)||"").trim());I!=null&&I.found&&(pe>=2e5||k>0&&pe>k*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ot(pe)}`),Ut&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const xt=Math.abs(ct);return(xt>=5e5||k>0&&xt>k*.5)&&ct!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ot(ct)}`),{errors:n,warnings:t,canSubmit:n.length===0}},br=React.useMemo(()=>$s(f),[f,jt]),Mt=React.useMemo(()=>{var Un;const e=String((f==null?void 0:f.customer_name)||"").trim(),n=zt((f==null?void 0:f.phone)||""),t=String((f==null?void 0:f.address)||"").trim(),a=Array.isArray(f==null?void 0:f.items)?f.items:[],i=new Map;for(const _t of a){const ra=String((_t==null?void 0:_t.product_id)||"").trim(),Oa=String((_t==null?void 0:_t.variant)||"").trim();if(!ra)continue;const Ea=`${ra}||${Oa}`;i.set(Ea,(i.get(Ea)||0)+1)}const o=a.map(_t=>{var Rs;const ra=String((_t==null?void 0:_t.product_id)||"").trim(),Oa=Number((Rs=_t==null?void 0:_t.quantity)!=null?Rs:0),Ea=ra?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",dr=Number.isFinite(Oa)&&Oa>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",mr=String((_t==null?void 0:_t.variant)||"").trim(),ur=`${ra}||${mr}`,pr=ra&&(i.get(ur)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Ea,qtyError:dr,dupWarn:pr}}),y=a.filter(_t=>_t&&_t.product_id),m=pa(y),D=ua(y),N=D!=null&&D.found?Number((Un=D==null?void 0:D.fee)!=null?Un:0):0,l=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],k=Qn(l),I=Zn(k),pe=k.some(_t=>(Number(_t==null?void 0:_t.amount)||0)!==0&&!String((_t==null?void 0:_t.note)||"").trim()),he=Math.abs(I),ht=pe?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ct=I!==0&&(he>=5e5||m>0&&he>m*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ot(I)}`:"",Ut=D!=null&&D.found&&(N>=2e5||m>0&&N>m*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ot(N)}`:"",xt=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Cn=n?ea(n)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ft=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Kn=!xt&&!Cn&&o.every(_t=>!_t.productError&&!_t.qtyError);return{nameError:xt,phoneError:Cn,addressWarn:Ft,items:o,shipAbnormalWarn:Ut,adjustmentNoteWarn:ht,adjustmentAbnormalWarn:ct,canSubmit:Kn}},[f,jt]),Ia=async e=>{var m,D,N;const n=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",a=$s(f);if(!a.canSubmit){const l=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof F=="function"?F(l,"danger"):alert(l);return}if(!bt&&_s){const l=`${_s}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(l)){(Nn==null?void 0:Nn.count)>0&&A(!0),setTimeout(()=>{var pe;const I=document.getElementById("order-phone-input");I&&typeof I.scrollIntoView=="function"&&(I.scrollIntoView({block:"center",behavior:"smooth"}),(pe=I.focus)==null||pe.call(I))},0);return}}const i=zt(f.phone),y=(Array.isArray(f.items)?f.items:[]).map(l=>{var k,I;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((k=l==null?void 0:l.quantity)!=null?k:1),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(I=l==null?void 0:l.variant_json)!=null?I:null,unit_price:(()=>{const pe=l==null?void 0:l.unit_price,he=pe===""||pe==null?NaN:Number(pe);if(Number.isFinite(he))return Math.max(0,Math.trunc(he));const ht=xn(l==null?void 0:l.product_id),ct=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return aa(ht,ct)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);C(!0);try{const l=bt,k=bt?`${API_BASE}/api/orders/${bt}`:`${API_BASE}/api/orders`,I=y[0],pe=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],he=Qn(pe),ht=Zn(he),ct=Fa(he),Ut={customer_name:f.customer_name,phone:i,address:f.address,note:(f.note||"").trim(),adjustment_amount:ht,adjustment_note:ct,adjustment_items:he,product_id:I.product_id,quantity:I.quantity,status:f.status,items:y,...bt?{id:bt}:{}};if(bt)await window.KTM.api.putJSON(k,Ut,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const xt=await window.KTM.api.postJSON(k,Ut,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Sn.current={id:(N=(D=xt==null?void 0:xt.id)!=null?D:(m=xt==null?void 0:xt.order)==null?void 0:m.id)!=null?N:null,fingerprint:Ms(f),ts:Date.now()}}if(Js(i,f.customer_name,f.address),t==="drawer"){if(Vn(""),an(null),Ue(!1),pn(!1),A(!1),Ye([]),Wn(),l){Ct(!0),Bt("");try{const xt=await Ba(l);xt&&typeof xt=="object"&&lt(xt)}catch(xt){Bt((xt==null?void 0:xt.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Ct(!1)}}}else n==="new"&&!bt?(Vn(""),an(null),Ue(!0)):(Vn(""),an(null),Ue(!1)),Wn()}catch(l){console.error(l),typeof F=="function"?F(l.message,"danger"):alert(l.message);return}finally{C(!1)}},ha=e=>window.KTM.orders.getOrderTotalMoney(e,xn),gr=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){be(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Wn(),Ta()}catch(n){console.error(n),typeof F=="function"?F(n.message,"danger"):alert(n.message)}finally{be(null)}}},or=()=>{const e=_n.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(o){}e.timer=null}const n=Array.isArray(e.events)?e.events.splice(0):[];if(!n.length||typeof F!="function")return;const t=new Map;for(const o of n){const y=String((o==null?void 0:o.orderId)||"").trim();y&&t.set(y,o)}const a=Array.from(t.values());if(!a.length)return;const i=o=>async()=>{try{for(const y of o)!(y!=null&&y.prevStatus)||!(y!=null&&y.orderId)||await Jn({id:y.orderId,status:y.nextStatus},y.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});F(o.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${o.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(y){F("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(a.length===1){const o=a[0],y=`${Tn(o.prevStatus)} \u2192 ${Tn(o.nextStatus)}`.trim();F(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${y}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:i([o])});return}F(`\u0110\xE3 c\u1EADp nh\u1EADt ${a.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:i(a)})},cr=e=>{const n=_n.current;n&&(Array.isArray(n.events)||(n.events=[]),n.events.push(e),!n.timer&&(n.timer=setTimeout(()=>or(),320)))};useEffect(()=>()=>{try{const e=_n.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Jn=async(e,n,t={})=>{var y;const a=await Sa(e),i=a==null?void 0:a.id;if(!i||!n)return;const o=fn(a==null?void 0:a.status);le(i);try{const m=Ga(a),D=(Array.isArray(m)?m:[]).map(k=>{var I,pe;return{product_id:(k==null?void 0:k.product_id)||"",quantity:Number((I=k==null?void 0:k.quantity)!=null?I:1),variant:String((k==null?void 0:k.variant)||"").trim()||null,variant_json:(pe=k==null?void 0:k.variant_json)!=null?pe:null,unit_price:(()=>{var ct;const he=(ct=k==null?void 0:k.unit_price)!=null?ct:k==null?void 0:k.unitPrice,ht=Number(he);return Number.isFinite(ht)?Math.max(0,Math.trunc(ht)):null})()}}).filter(k=>k.product_id&&Number.isFinite(k.quantity)&&k.quantity>0);if(!D.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const N=D[0],l={id:i,customer_name:(a==null?void 0:a.customer_name)||"",phone:zt((a==null?void 0:a.phone)||""),address:(a==null?void 0:a.address)||"",note:((a==null?void 0:a.note)||"").trim(),adjustment_amount:Number((y=a==null?void 0:a.adjustment_amount)!=null?y:0)||0,adjustment_note:(a==null?void 0:a.adjustment_note)||"",product_id:N.product_id,quantity:N.quantity,status:n,items:D};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${i}`,l,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),re(k=>Array.isArray(k)?k.map(I=>(I==null?void 0:I.id)===i?{...I,status:n}:I):k),Fe(k=>Array.isArray(k)?k.map(I=>(I==null?void 0:I.id)===i?{...I,status:n}:I):k),ga(i,!1),Hs(i),t!=null&&t.silentToast)return;if(t!=null&&t.skipToastBatch){typeof F=="function"&&F("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}cr({orderId:i,prevStatus:o,nextStatus:fn(n)})}catch(m){if(console.error(m),(!navigator.onLine||(m==null?void 0:m.name)==="TypeError"||String((m==null?void 0:m.message)||"").toLowerCase().includes("failed to fetch"))&&!(t!=null&&t.fromSync)){re(N=>Array.isArray(N)?N.map(l=>(l==null?void 0:l.id)===i?{...l,status:n}:l):N),Fe(N=>Array.isArray(N)?N.map(l=>(l==null?void 0:l.id)===i?{...l,status:n}:l):N),Bs(i,n,o),typeof F=="function"&&F("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof F=="function"?F(m.message,"danger"):alert(m.message)}finally{le(null)}};useEffect(()=>{const e=n=>{var a;const t=(a=n==null?void 0:n.detail)==null?void 0:a.key;if(t){if(t==="/"){setTimeout(()=>{var i,o;(o=(i=rn.current)==null?void 0:i.focus)==null||o.call(i)},0);return}if(t==="N"||t==="n"){Ma();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&St&&(_e!=null&&_e.id)){const i=Array.isArray(en)?en:[],o=i.findIndex(D=>String(D==null?void 0:D.id)===String(_e==null?void 0:_e.id));if(o<0)return;const m=i[o+(t==="j"||t==="J"?-1:1)];m&&da(m)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[en,St,_e]);const lr=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:f.customer_name,onChange:e=>we({...f,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Mt.nameError&&React.createElement("div",{className:"form-text text-danger"},Mt.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:f.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Mt.phoneError&&React.createElement("div",{className:"form-text text-danger"},Mt.phoneError),!Mt.phoneError&&Nn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Nn.count," \u0111\u01A1n trong th\xE1ng ",Nn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>A(e=>!e)},L?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),L&&Nn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>A(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Nn.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ta(e.status)}`},Tn(e.status))),React.createElement("div",{className:"text-muted small"},na(e.created_at)," \u2022 ",Ot(ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&za(e)}},"M\u1EDF")))),Nn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(B==null?void 0:B.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(B==null?void 0:B.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(B==null?void 0:B.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(B==null?void 0:B.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:f.status,onChange:e=>we({...f,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:f.address,onChange:e=>we({...f,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Mt.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Mt.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:f.note,onChange:e=>we({...f,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{we(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},On(f.adjustment_items).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const a=t.target.value;we(i=>{const o=On(i.adjustment_items);return o[n]={...o[n],amount:a},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const a=t.target.value;we(i=>{const o=On(i.adjustment_items);return o[n]={...o[n],note:a},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{we(t=>{const a=On(t.adjustment_items);return a.splice(n,1),{...t,adjustment_items:a.length?a:[{amount:"",note:""}]}})},disabled:M||On(f.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Mt.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Mt.adjustmentAbnormalWarn),!!Mt.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Mt.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{we(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Tt(e=>[...Array.isArray(e)?e:[],""]),bt&&Ye(e=>[...Array.isArray(e)?e:[],!0])},disabled:M},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(f.items)?f.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Xt.current[n]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Lt(t=>t===n?null:n),setTimeout(()=>{const t=document.getElementById(`order-product-search-${n}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},xs(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),$t===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:kt[n]||"",onChange:t=>{const a=t.target.value;Tt(i=>{const o=Array.isArray(i)?[...i]:[];return o[n]=a,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(n);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(a.id),o=Bn(a==null?void 0:a.variants),y={};for(const N of o){const l=String((N==null?void 0:N.name)||"").trim(),k=Array.isArray(N==null?void 0:N.options)?N.options[0]:null,I=String((k==null?void 0:k.label)||"").trim();l&&I&&(y[l]=I)}const m=$a(y),D=aa(a,y);we(N=>{const l=Array.isArray(N.items)?[...N.items]:[];return l[n]={...l[n]||{quantity:1},product_id:i,variant_json:Object.keys(y).length?y:null,variant:m,unit_price:o.length?D:null},{...N,items:l}}),Lt(null)}},a.name,a.code?` (${a.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),jt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var a;const t=(a=Mt.items)==null?void 0:a[n];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=xn(e.product_id),a=Bn(t==null?void 0:t.variants);if(!a.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},a.map((o,y)=>{const m=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${y+1}`).trim(),D=String((i==null?void 0:i[m])||"").trim();return React.createElement("div",{key:m},React.createElement("label",{className:"form-label small text-muted mb-1"},m),React.createElement("select",{className:"form-select",value:D,onChange:N=>{const l=String(N.target.value||"").trim();we(k=>{const I=Array.isArray(k.items)?[...k.items]:[],pe={...I[n]||{}},he=xn(pe.product_id),ht=Bn(he==null?void 0:he.variants),ct=pe!=null&&pe.variant_json&&typeof pe.variant_json=="object"?{...pe.variant_json}:{};l?ct[m]=l:delete ct[m];const Ut=$a(ct),xt=aa(he,ct);return I[n]={...pe,variant_json:Object.keys(ct).length?ct:null,variant:Ut,unit_price:xt},{...k,items:I}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",m," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(N=>React.createElement("option",{key:N.label,value:N.label},N.label,Number.isFinite(Number(N==null?void 0:N.price))?` (${Ot(Number(N.price))})`:Number(N==null?void 0:N.price_delta)?` (${N.price_delta>0?"+":""}${N.price_delta})`:""))))}))})(),bt&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!qe[n],onChange:t=>{const a=!!t.target.checked;Ye(i=>{const o=Array.isArray(i)?[...i]:[],y=Array.isArray(f.items)?f.items.length:0;for(;o.length<y;)o.push(!0);return o[n]=a,o})},disabled:M||de}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const a=t.target.value;we(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[n]={...o[n]||{product_id:""},quantity:a},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var a;const t=(a=Mt.items)==null?void 0:a[n];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{we(t=>{const a=Array.isArray(t.items)?[...t.items]:[];return a.splice(n,1),{...t,items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Tt(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a.length?a:[""]}),Ye(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a}),Lt(t=>t==null?t:t===n?null:t>n?t-1:t)},disabled:M||de||(Array.isArray(f.items)?f.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(f.items)?f.items:[]).filter(m=>m==null?void 0:m.product_id),t=pa(n),a=ua(n),i=ja(f),o=i.amount,y=t+(a.found?a.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ot(t))),a.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ot(a.fee))),!!Mt.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Mt.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ot(o))),(f.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(f.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ot(y)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:M||!!z||!!ve}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.all," \u0111\u01A1n"),rt&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>rt?Ss(nt):Wn(),disabled:tn,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>Ma(),disabled:M||!!z},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${Ne&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),Ce(!1),Oe(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Us)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${He&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),Oe(!1),Ce(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ys)),React.createElement("button",{type:"button",className:`orders-chip ${!U&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),oe("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.all)),React.createElement("button",{type:"button",className:`orders-chip ${U==="draft"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),oe("draft"),q("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.draft)),React.createElement("button",{type:"button",className:`orders-chip ${U==="pending"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),oe("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.pending)),React.createElement("button",{type:"button",className:`orders-chip ${U==="processing"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),oe("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.processing)),React.createElement("button",{type:"button",className:`orders-chip ${U==="done"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),oe("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.done)),React.createElement("button",{type:"button",className:`orders-chip ${U==="paid"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),oe("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.paid)),React.createElement("button",{type:"button",className:`orders-chip ${U==="canceled"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),oe("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Pn("thisMonth"),disabled:rt},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Pn("overduePending"),disabled:rt},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",In," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Pn("draftExpiring"),disabled:rt},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y"),(U||Me||!x&&!rt)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Pn("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:rn,type:"text",className:"form-control",value:nt,onChange:e=>Ie(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(nt||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Ie(""),disabled:tn},React.createElement("i",{className:"fas fa-times"})),tn&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:x,onChange:e=>q(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:Me||rt})),React.createElement("div",{className:"text-muted small ms-auto"},rt?"Search b\u1ECF qua filter":Me?"\u0110ang xem \u0111\u01A1n ch\u1EADm":U?`L\u1ECDc: ${Tn(U)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${P?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if(rt){const e=String(nt||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${en.length} k\u1EBFt qu\u1EA3`}return Me?`\u0110\u01A1n ch\u1EADm \u2022 ${en.length} \u0111\u01A1n`:Ne?`\u01AFu ti\xEAn \u2022 ${en.length} \u0111\u01A1n`:He?`H\xF4m nay \u2022 ${en.length} \u0111\u01A1n`:U?`L\u1ECDc: ${Tn(U)} \u2022 ${en.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${en.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Ie(""),Oe(!1),Ce(!1),Pn("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},rt?`${en.length} k\u1EBFt qu\u1EA3`:U?`${Aa.length}/${ye.length} \u0111\u01A1n`:`${ye.length}${Ee?"+":""} \u0111\u01A1n`)),rt&&Dt&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Dt),Ca.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Ca.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",In," ng\xE0y.",Ke&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Ae(!0),oe("pending")}},"Xem ngay")),ys.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,ys.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 h\u1EE7y (c\xF2n \u2264 ",Ka," ng\xE0y).",wt&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Ae(!1),oe("draft"),q(""),Wn()}},"Xem ngay")),(rt?tn:ze)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,n)=>React.createElement("div",{key:n,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,n)=>React.createElement("tr",{key:n},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(rt?en.length===0:ye.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},rt?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!rt&&Aa.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Ns.map(e=>{var n;return React.createElement("div",{key:e.id,className:`orders-mobile-swipe-shell mb-2 ${(vt==null?void 0:vt.id)===String(e.id)?`swipe-preview swipe-${(vt==null?void 0:vt.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>{if(un.current){un.current=!1;return}da(e)},onPointerDown:t=>{if(Y||c||Kt||t.button!=null&&t.button!==0)return;const a=String(e.id);un.current=!1,Je.current={active:!0,id:a,startX:t.clientX,startY:t.clientY,dx:0,dy:0,lock:null,pointerId:t.pointerId,captured:!1},Ze(i=>(i==null?void 0:i.id)===a?i:{id:a,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}try{Gt.current&&clearTimeout(Gt.current)}catch(i){}on.current=a,Gt.current=setTimeout(async()=>{var o,y,m,D;const i=on.current;if(i)try{if((y=(o=qt.current)==null?void 0:o.has)!=null&&y.call(o,i))return;const N=await Ba(i);N&&typeof N=="object"&&((D=(m=qt.current)==null?void 0:m.set)==null||D.call(m,i,N))}catch(N){}},150)},onPointerMove:t=>{const a=Je.current;if(!(a!=null&&a.active)||String(a.id)!==String(e.id))return;const i=t.clientX-a.startX,o=t.clientY-a.startY;if(a.dx=i,a.dy=o,Math.abs(i)>14||Math.abs(o)>14){try{Gt.current&&clearTimeout(Gt.current)}catch(I){}Gt.current=null,on.current=null}if(!a.lock){const I=Math.abs(i),pe=Math.abs(o);if((I>10||pe>10)&&(a.lock=I>pe*1.2?"x":"y",a.lock==="x"&&!a.captured))try{t.currentTarget.setPointerCapture(t.pointerId),a.captured=!0}catch(he){}}if(a.lock!=="x"){try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(I){}Math.abs(o)>24&&Ze(I=>(I==null?void 0:I.id)===a.id?{id:a.id,dir:null}:I);return}const y=!!Yn(e==null?void 0:e.status,"right"),m=!!Yn(e==null?void 0:e.status,"left"),D=(I,pe,he)=>Math.max(pe,Math.min(he,I)),N=D(i,-140,140),l=N>0&&!y||N<0&&!m?N*.35:N,k=D(Math.abs(l)/88,0,1);try{t.currentTarget.classList.add("swiping"),t.currentTarget.style.setProperty("--swipe-x",`${l}px`),t.currentTarget.style.setProperty("--swipe-p",String(k)),t.currentTarget.style.setProperty("--swipe-l",l>0&&y?String(k):"0"),t.currentTarget.style.setProperty("--swipe-r",l<0&&m?String(k):"0")}catch(I){}Math.abs(l)>12&&(un.current=!0),i>72&&y?Ze({id:a.id,dir:"right"}):i<-72&&m?Ze({id:a.id,dir:"left"}):Ze({id:a.id,dir:null})},onPointerCancel:t=>{try{Gt.current&&clearTimeout(Gt.current)}catch(i){}Gt.current=null,on.current=null;const a=Je.current;try{a!=null&&a.captured&&(a==null?void 0:a.pointerId)!=null&&t.currentTarget.releasePointerCapture(a.pointerId)}catch(i){}Je.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1},Ze({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}},onPointerUp:t=>{try{Gt.current&&clearTimeout(Gt.current)}catch(l){}Gt.current=null,on.current=null;const a=Je.current;if(!(a!=null&&a.active)||String(a.id)!==String(e.id)){Ze({id:null,dir:null});return}try{a!=null&&a.captured&&(a==null?void 0:a.pointerId)!=null&&t.currentTarget.releasePointerCapture(a.pointerId)}catch(l){}Je.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1};const i=Number(a.dx)||0,o=Math.abs(i),y=a.lock==="x",m=fn(e==null?void 0:e.status);Ze({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(l){}if(y&&o>12&&(un.current=!0),!y||o<88)return;t.preventDefault(),t.stopPropagation();const D=i>0?Yn(e==null?void 0:e.status,"right"):Yn(e==null?void 0:e.status,"left"),N=fn(D);!N||N===m||Jn(e,N)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),da(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"orders-mobile-swipe-bg","aria-hidden":"true"},React.createElement("div",{className:"orders-mobile-swipe-bg-left"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Yn(e==null?void 0:e.status,"right"),a=ms(t),i=(a==null?void 0:a.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${a.icon||"fa-circle"}`}),i):null})())),React.createElement("div",{className:"orders-mobile-swipe-bg-right"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Yn(e==null?void 0:e.status,"left"),a=ms(t),i=(a==null?void 0:a.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${a.icon||"fa-circle"}`}),i):null})()))),React.createElement("div",{className:`card orders-mobile-card ${Q!=null&&Q[String(e.id)]?"order-recent-updated":""}`},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:t=>qs(t,e.phone),onPointerMove:ya,onPointerUp:ya,onPointerCancel:ya,onPointerLeave:ya,onClick:t=>{if(t.stopPropagation(),dn.current){dn.current=!1;return}cs(e.phone)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),cs(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((n=e==null?void 0:e.split_seq)!=null?n:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=is(e);if(!t)return null;const a=b.has(String(e.id)),i=t.length>84||os(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${a?"":"order-text-collapsed"}`},t),i&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:o=>{o.stopPropagation(),as(e.id)}},a?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const t=os(e);if(!t)return null;const a=b.has(String(e.id)),i=is(e).length,o=i>84||t.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${a?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t),o&&i<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:y=>{y.stopPropagation(),as(e.id)}},a?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${se.has(String(e.id))?"active":""}`,onClick:t=>{t.stopPropagation(),Ks(e.id)},title:se.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":se.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:se.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(bn!=null&&bn[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${ta(e.status)} order-status-badge-btn`,onPointerDown:t=>{t.stopPropagation(),Pe.current=!1;try{Re.current&&clearTimeout(Re.current)}catch(a){}Re.current=setTimeout(()=>{Pe.current=!0,ns(e,t.currentTarget)},420)},onPointerUp:t=>{t.stopPropagation();try{Re.current&&clearTimeout(Re.current)}catch(a){}Re.current=null},onPointerCancel:t=>{t.stopPropagation();try{Re.current&&clearTimeout(Re.current)}catch(a){}Re.current=null},onClick:t=>{if(t.stopPropagation(),Pe.current){Pe.current=!1;return}Kt&&String(j==null?void 0:j.id)===String(e.id)?zn():ns(e,t.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},Tn(e.status)),va(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${In} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(e),"d"),wa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Hn} ng\xE0y`},"\u23F3 C\xF2n ",Na(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=Ra(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((a,i)=>React.createElement("div",{key:i,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),a.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${Ot(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sa(e))})()),(ma(e)!==0||Gn(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ot(ma(e))),Gn(e)?React.createElement("span",{className:"text-muted"}," ","(",Gn(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Ot(ha(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",na(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),Da(e)},disabled:M||!!z||ve===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),ts(e)},disabled:M||!!z||ve===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c")))))}),React.createElement("div",{ref:nn,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(en)&&Ns.length<en.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),Kt&&j&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>zn()},React.createElement("div",{className:`orders-status-popover ${(V==null?void 0:V.placement)||""}`,style:{left:V.left,top:V.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},j.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>zn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},ia.map(e=>{const n=fn(j.status)===fn(e.value),t=M||!!z||ve===j.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${n?"active":""}`,onClick:()=>{n||(Jn(j,e.value),zn())},disabled:t},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{ts(j),zn()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),Y&&Et&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Xn()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},Et.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},Et.phone||""),React.createElement("span",{className:`badge ${ta(Et.status)}`},Tn(Et.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Xn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Da(Et),Xn()},disabled:M||!!z||ve===Et.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(Et.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(Et.phone||"").trim()}`,onClick:()=>Xn()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{da(Et),Xn()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},ia.map(e=>{const n=fn(Et.status)===fn(e.value),t=M||!!z||ve===Et.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${n?"active":""}`,onClick:()=>{n||(Jn(Et,e.value),Xn())},disabled:t},e.label)})))),c&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>ba()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ba(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Pn("thisMonth"),disabled:rt},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Pn("overduePending"),disabled:rt},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Pn("draftExpiring"),disabled:rt},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!U&&!Me?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),oe("")}},"T\u1EA5t c\u1EA3"),ia.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${U===e.value&&!Me?"active":""}`,onClick:()=>{rt&&Ie(""),Ae(!1),oe(e.value),e.value==="draft"&&q("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:x,onChange:e=>q(e.target.value),disabled:Me||rt}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:Me,onChange:e=>{rt&&Ie("");const n=!!e.target.checked;Ae(n),n&&(q(""),oe("pending"))},disabled:rt}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",In," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Pn("all"),disabled:rt},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>ba()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${p?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){w.current=!1;try{pt.current&&clearTimeout(pt.current)}catch(n){}pt.current=setTimeout(()=>{w.current=!0,ss(nt)},460)}},onPointerUp:()=>{try{pt.current&&clearTimeout(pt.current)}catch(e){}pt.current=null},onPointerCancel:()=>{try{pt.current&&clearTimeout(pt.current)}catch(e){}pt.current=null},onClick:()=>{if(w.current){w.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,n;return(n=(e=rn.current)==null?void 0:e.focus)==null?void 0:n.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>Ma(),disabled:M||!!z,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Es(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),Xe&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{oa(De),An()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const n=e.touches&&e.touches[0];n&&(ie.current={active:!0,startY:n.clientY,startX:n.clientX,fired:!1})},onTouchMove:e=>{const n=ie.current;if(!(n!=null&&n.active)||n.fired)return;const t=e.touches&&e.touches[0];if(!t)return;const a=t.clientY-n.startY,i=t.clientX-n.startX;Math.abs(i)>24||a>90&&(n.fired=!0,oa(De),An())},onTouchEnd:()=>{ie.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{oa(De),An()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:Se,type:"text",className:"form-control",value:De,onChange:e=>{const n=e.target.value;We(n),Ie(n)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(oa(De),An())}}),!!String(De||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{We(""),Ie("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(ut)&&ut.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},ut.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{We(e),Ie(e),oa(e),An()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${Ne?"active":""}`,onClick:()=>{Ie(""),We(""),Ae(!1),Ce(!1),Oe(e=>!e),An()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${He?"active":""}`,onClick:()=>{Ie(""),We(""),Ae(!1),Oe(!1),Ce(e=>!e),An()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${Me?"active":""}`,onClick:()=>{Ie(""),We(""),Ae(e=>!e),Me||(q(""),oe("pending")),An()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!U&&!Me&&!Ne&&!He?"active":""}`,onClick:()=>{Ie(""),We(""),Ae(!1),Oe(!1),Ce(!1),oe(""),An()}},"T\u1EA5t c\u1EA3"),ia.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${U===e.value&&!Me?"active":""}`,onClick:()=>{Ie(""),We(""),Ae(!1),Oe(!1),Ce(!1),oe(e.value),e.value==="draft"&&q(""),An()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,en.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>da(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const n=Ra(e);return n.length?React.createElement("div",{className:"d-grid gap-1"},n.map((t,a)=>React.createElement("div",{key:a,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},a+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Ot(t.unitPrice))))):sa(e)})()),React.createElement("td",null,Ts(e)),React.createElement("td",{className:"fw-semibold"},Ot(ha(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${ta(e.status)}`},Tn(e.status)),va(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${In} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(e),"d"),wa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Hn} ng\xE0y`},"\u23F3 C\xF2n ",Na(e),"d"))),React.createElement("td",null,na(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:n=>{n.stopPropagation(),Da(e)},disabled:M||!!z||ve===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:n=>n.stopPropagation(),onChange:n=>{n.stopPropagation();const t=String(n.target.value||"").trim();n.target.value="",t&&Jn(e,t)},disabled:M||!!z||ve===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!rt&&Ee&&!Me&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Zs,disabled:ze||ke},ke?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:St,title:(()=>{const e=_e,n=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Tn(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${n} ${t}`.trim()})(),subtitle:(()=>{const e=_e,n=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),a=e!=null&&e.created_at?na(e.created_at):"";return[n||t||null,a||null].filter(Boolean).join(" \u2022 ")})(),onClose:er,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},yn?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{pn(!1),an(null),Vn(""),A(!1),Ye([])},disabled:M||de},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!bt&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:ks,disabled:M||de,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},de?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>Ia({mode:"close",origin:"drawer"}),disabled:M||de||!Mt.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},M?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>_e&&Da(_e),disabled:!_e||Yt||M||!!z},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>_e&&za(_e),disabled:!_e||Yt||M||!!z},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const n=String(e.target.value||"").trim();e.target.value="",n&&_e&&Jn(_e,n)},disabled:!_e||Yt||M||!!z||ve===(_e==null?void 0:_e.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},yn?React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ia({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),lr())):Yt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):Wt?React.createElement("div",{className:"alert alert-danger",role:"alert"},Wt):_e?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${ta(_e.status)}`},Tn(_e.status)),va(_e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${In} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(_e),"d"),wa(_e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Hn} ng\xE0y`},"\u23F3 C\xF2n ",Na(_e),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},Ot(ha(_e))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},Ts(_e)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},na(_e.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},_e.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},_e.phone||"\u2014"),!!String(_e.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(_e.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},_e.address||"\u2014")),((_e==null?void 0:_e.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(_e.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=Ra(_e);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((n,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),n.name),n.variant?React.createElement("div",{className:"text-muted small"},n.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${Ot(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sa(_e)||"\u2014")})(),(ma(_e)!==0||Gn(_e))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ot(ma(_e))),Gn(_e)?React.createElement("span",{className:"text-muted"}," ","(",Gn(_e),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Qe&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),bt?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Xa})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ia({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Vt},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:f.customer_name,onChange:e=>we({...f,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Mt.nameError&&React.createElement("div",{className:"form-text text-danger"},Mt.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:f.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Mt.phoneError&&React.createElement("div",{className:"form-text text-danger"},Mt.phoneError),!Mt.phoneError&&Nn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Nn.count," \u0111\u01A1n trong th\xE1ng ",Nn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>A(e=>!e)},L?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),L&&Nn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>A(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Nn.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ta(e.status)}`},Tn(e.status))),React.createElement("div",{className:"text-muted small"},na(e.created_at)," \u2022 ",Ot(ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&za(e)}},"M\u1EDF")))),Nn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(B==null?void 0:B.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(B==null?void 0:B.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(B==null?void 0:B.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(B==null?void 0:B.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:f.status,onChange:e=>we({...f,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:f.address,onChange:e=>we({...f,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Mt.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Mt.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:f.note,onChange:e=>we({...f,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{we(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},On(f.adjustment_items).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const a=t.target.value;we(i=>{const o=On(i.adjustment_items);return o[n]={...o[n],amount:a},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const a=t.target.value;we(i=>{const o=On(i.adjustment_items);return o[n]={...o[n],note:a},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{we(t=>{const a=On(t.adjustment_items);return a.splice(n,1),{...t,adjustment_items:a.length?a:[{amount:"",note:""}]}})},disabled:M||On(f.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Mt.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Mt.adjustmentAbnormalWarn),!!Mt.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Mt.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{we(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Tt(e=>[...Array.isArray(e)?e:[],""]),bt&&Ye(e=>[...Array.isArray(e)?e:[],!0])},disabled:M},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(f.items)?f.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Xt.current[n]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Lt(t=>t===n?null:n),setTimeout(()=>{const t=document.getElementById(`order-product-search-${n}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},xs(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),$t===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:kt[n]||"",onChange:t=>{const a=t.target.value;Tt(i=>{const o=Array.isArray(i)?[...i]:[];return o[n]=a,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(n);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(a.id),o=Bn(a==null?void 0:a.variants),y={};for(const N of o){const l=String((N==null?void 0:N.name)||"").trim(),k=Array.isArray(N==null?void 0:N.options)?N.options[0]:null,I=String((k==null?void 0:k.label)||"").trim();l&&I&&(y[l]=I)}const m=$a(y),D=aa(a,y);we(N=>{const l=Array.isArray(N.items)?[...N.items]:[];return l[n]={...l[n]||{quantity:1},product_id:i,variant_json:Object.keys(y).length?y:null,variant:m,unit_price:o.length?D:null},{...N,items:l}}),Lt(null)}},a.name,a.code?` (${a.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),jt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var a;const t=(a=Mt.items)==null?void 0:a[n];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=xn(e.product_id),a=Bn(t==null?void 0:t.variants);if(!a.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},a.map((o,y)=>{const m=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${y+1}`).trim(),D=String((i==null?void 0:i[m])||"").trim();return React.createElement("div",{key:m},React.createElement("label",{className:"form-label small text-muted mb-1"},m),React.createElement("select",{className:"form-select",value:D,onChange:N=>{const l=String(N.target.value||"").trim();we(k=>{const I=Array.isArray(k.items)?[...k.items]:[],pe={...I[n]||{}},he=xn(pe.product_id),ht=Bn(he==null?void 0:he.variants),ct=pe!=null&&pe.variant_json&&typeof pe.variant_json=="object"?{...pe.variant_json}:{};l?ct[m]=l:delete ct[m];const Ut=$a(ct),xt=aa(he,ct);return I[n]={...pe,variant_json:Object.keys(ct).length?ct:null,variant:Ut,unit_price:xt},{...k,items:I}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",m," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(N=>React.createElement("option",{key:N.label,value:N.label},N.label,Number.isFinite(Number(N==null?void 0:N.price))?` (${Ot(Number(N.price))})`:Number(N==null?void 0:N.price_delta)?` (${N.price_delta>0?"+":""}${N.price_delta})`:""))))}))})(),bt&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!qe[n],onChange:t=>{const a=!!t.target.checked;Ye(i=>{const o=Array.isArray(i)?[...i]:[],y=Array.isArray(f.items)?f.items.length:0;for(;o.length<y;)o.push(!0);return o[n]=a,o})},disabled:M||de}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const a=t.target.value;we(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[n]={...o[n]||{product_id:""},quantity:a},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var a;const t=(a=Mt.items)==null?void 0:a[n];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{we(t=>{const a=Array.isArray(t.items)?[...t.items]:[];return a.splice(n,1),{...t,items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Tt(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a.length?a:[""]}),Ye(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a}),Lt(t=>t==null?t:t===n?null:t>n?t-1:t)},disabled:M||de||(Array.isArray(f.items)?f.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(f.items)?f.items:[]).filter(m=>m==null?void 0:m.product_id),t=pa(n),a=ua(n),i=ja(f),o=i.amount,y=t+(a.found?a.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ot(t))),a.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ot(a.fee))),!!Mt.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Mt.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ot(o))),(f.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(f.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ot(y)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Xa,disabled:M||de,style:{borderRadius:10}},"H\u1EE7y"),!!bt&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:ks,disabled:M||de,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},de?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!bt&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Ia({mode:"new",origin:"modal"}),disabled:M||!Mt.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:M||de||!Mt.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},M?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

