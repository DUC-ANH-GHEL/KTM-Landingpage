const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:N,error:w}){const[C,z]=useState(""),[P,T]=useState(""),[O,ie]=useState(!1),[oe,Z]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),w&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),w),React.createElement("form",{onSubmit:async $e=>{$e.preventDefault(),ie(!0),await N(C,P),ie(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:C,onChange:$e=>z($e.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:oe?"text":"password",className:"form-control",value:P,onChange:$e=>T($e.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Z(!oe)},React.createElement("i",{className:`fas fa-eye${oe?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:N,type:w,onClose:C,actionLabel:z,onAction:P,durationMs:T}){return useEffect(()=>{const O=Number(T),ie=Number.isFinite(O)&&O>0?O:3e3,oe=setTimeout(C,ie);return()=>clearTimeout(oe)},[C,T]),React.createElement("div",{className:`toast show align-items-center text-white bg-${w} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},N),z&&typeof P=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{P()}finally{C()}}},z),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:C})))}function Loading({show:N}){return N?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:N,title:w,subtitle:C,onClose:z,footer:P,children:T}){return useEffect(()=>{if(!N)return;const O=ie=>{ie.key==="Escape"&&(ie.preventDefault(),typeof z=="function"&&z())};return document.addEventListener("keydown",O),()=>document.removeEventListener("keydown",O)},[N,z]),N?React.createElement("div",{className:`admin-drawer-root ${N?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:z,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},w),C?React.createElement("div",{className:"admin-drawer-subtitle"},C):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:z,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},T),P?React.createElement("div",{className:"admin-drawer-footer"},P):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(N){try{const w=localStorage.getItem(N);if(!w)return[];const C=JSON.parse(w);return Array.isArray(C)?C.map(z=>String(z||"").trim()).filter(Boolean):[]}catch(w){return[]}}function saveAdminMenuIdsToStorage(N,w){try{localStorage.setItem(N,JSON.stringify(Array.isArray(w)?w:[]))}catch(C){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(N){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,N),N}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(N){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,N),N}function Sidebar({activeMenu:N,onMenuChange:w,onLogout:C,currentUser:z,pinnedMenus:P,recentMenus:T,onTogglePin:O}){const ie=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],oe=(z==null?void 0:z.username)||(z==null?void 0:z.name)||(z==null?void 0:z.email)||"Admin",Z=useMemo(()=>{const ce=new Map;for(const _ of ie)ce.set(_.id,_);return ce},[]),xe=Array.isArray(P)?P:[],$e=Array.isArray(T)?T:[],le=xe.map(ce=>Z.get(ce)).filter(Boolean),be=$e.filter(ce=>ce!==N).map(ce=>Z.get(ce)).filter(Boolean).slice(0,5),Ie=ce=>xe.includes(ce);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},oe),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},le.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},le.map(ce=>React.createElement("a",{key:`pin-${ce.id}`,href:"#",className:`nav-link ${N===ce.id?"active":""} sidebar-quicklink`,onClick:_=>{_.preventDefault(),w(ce.id)}},React.createElement("i",{className:`fas ${ce.icon}`})," ",ce.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:_=>{_.preventDefault(),_.stopPropagation(),O&&O(ce.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),be.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},be.map(ce=>React.createElement("a",{key:`recent-${ce.id}`,href:"#",className:`nav-link ${N===ce.id?"active":""} sidebar-quicklink`,onClick:_=>{_.preventDefault(),w(ce.id)}},React.createElement("i",{className:`fas ${ce.icon}`})," ",ce.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),ie.map(ce=>React.createElement("a",{key:ce.id,href:"#",className:`nav-link ${N===ce.id?"active":""} ${ce.disabled?"opacity-50":""} ${ce.highlight?"text-warning":""}`,onClick:_=>{_.preventDefault(),ce.disabled||w(ce.id)}},React.createElement("i",{className:`fas ${ce.icon}`})," ",ce.label,ce.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),ce.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${Ie(ce.id)?"pinned":""}`,onClick:_=>{_.preventDefault(),_.stopPropagation(),O&&O(ce.id)},title:Ie(ce.id)?"B\u1ECF ghim":"Ghim","aria-label":Ie(ce.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),C&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:C,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(N){const w=typeof N=="number"?N:parseFloat(String(N!=null?N:"").trim());return Number.isFinite(w)?Math.max(0,Math.min(100,w)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var N;try{const w=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!w)return{ship_percent:DEFAULT_SHIP_PERCENT};const C=JSON.parse(w);return{ship_percent:normalizeShipPercent((N=C==null?void 0:C.ship_percent)!=null?N:C==null?void 0:C.shipPercent)}}catch(w){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(N){var w;try{const C={ship_percent:normalizeShipPercent((w=N==null?void 0:N.ship_percent)!=null?w:N==null?void 0:N.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(C)),C}catch(C){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var w;const N=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((w=N==null?void 0:N.ship_percent)!=null?w:N==null?void 0:N.shipPercent)}}async function saveAdminSettingsToServer(N){var z,P,T;const w={ship_percent:normalizeShipPercent((z=N==null?void 0:N.ship_percent)!=null?z:N==null?void 0:N.shipPercent)},C=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,w,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((T=(P=C==null?void 0:C.ship_percent)!=null?P:C==null?void 0:C.shipPercent)!=null?T:w.ship_percent)}}function AlbumList({albums:N,onSelect:w,onCreate:C,onEdit:z,onDelete:P,loading:T,currentFolder:O,onBack:ie,breadcrumb:oe}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},O&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:ie},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),O?O.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:C},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),oe&&oe.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Z=>{Z.preventDefault(),ie("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),oe.map((Z,xe)=>React.createElement("li",{key:Z.id,className:`breadcrumb-item ${xe===oe.length-1?"active":""}`},xe===oe.length-1?Z.title:React.createElement("a",{href:"#",onClick:$e=>{$e.preventDefault(),ie(Z)},className:"text-warning"},Z.title))))),T?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):N.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},O?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},N.map(Z=>React.createElement("div",{key:Z.uuid||Z.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>w(Z)},Z.cover?React.createElement("img",{src:Z.cover,className:"album-cover",alt:Z.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Z.title),React.createElement("small",{className:"text-muted"},Z.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Z.subfolderCount),Z.subfolderCount>0&&Z.count>0&&" \u2022 ",Z.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Z.count),Z.subfolderCount===0&&Z.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:xe=>{xe.stopPropagation(),z(Z)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:xe=>{xe.stopPropagation(),P(Z)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:N,album:w,onClose:C,onSave:z,parentId:P}){const[T,O]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[ie,oe]=useState(!1),[Z,xe]=useState(!1),$e=useRef(null);useEffect(()=>{O(w?{slug:w.id||"",title:w.title||"",description:w.description||"",cover_url:w.cover||"",parent_id:w.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:P||null})},[w,N,P]);const le=async _=>{_.preventDefault(),oe(!0),await z(T),oe(!1)},be=_=>_.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Ie=async _=>{const Ue=_.type==="image/heic"||_.type==="image/heif"||/\.heic$/i.test(_.name);if(_.size<=2097152&&!Ue)return _;try{const qe=await createImageBitmap(_),he=document.createElement("canvas");let Ae=qe.width,re=qe.height;const Pe=800;return(Ae>Pe||re>Pe)&&(Ae>re?(re=Math.round(re/Ae*Pe),Ae=Pe):(Ae=Math.round(Ae/re*Pe),re=Pe)),he.width=Ae,he.height=re,he.getContext("2d").drawImage(qe,0,0,Ae,re),qe.close(),new Promise((bt,Se)=>{he.toBlob(Xe=>{Xe?bt(new File([Xe],_.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Se(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(qe){throw console.error("Compress cover error:",qe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ce=async _=>{var qe;const Re=_.target.files[0];if(!Re)return;if(!(Re.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Re.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}xe(!0);try{const he=await Ie(Re),Ae=await window.KTM.cloudinary.uploadImage({file:he,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Ae.secure_url)throw console.error("Cloudinary error:",Ae),new Error(((qe=Ae.error)==null?void 0:qe.message)||"Upload failed");O(re=>({...re,cover_url:Ae.secure_url}))}catch(he){console.error("Cover upload error:",he),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+he.message)}xe(!1),_.target.value=""};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:C})),React.createElement("form",{onSubmit:le},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:T.title,onChange:_=>O({...T,title:_.target.value,slug:T.slug||be(_.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:T.slug,onChange:_=>O({...T,slug:_.target.value}),required:!0,disabled:!!w}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:T.description,onChange:_=>O({...T,description:_.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},T.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:T.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>O(_=>({..._,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:$e,type:"file",accept:"image/*",className:"d-none",onChange:ce}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var _;return(_=$e.current)==null?void 0:_.click()},disabled:Z},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:T.cover_url,onChange:_=>O({...T,cover_url:_.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:C},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:ie||Z},ie?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:N,allAlbums:w,currentAlbumId:C,targetAlbum:z,onSelect:P,level:T=0}){const[O,ie]=useState(!0),oe=N.uuid||N.id,Z=oe===C,xe=z===oe,$e=w.filter(be=>be.parentId===oe),le=$e.length>0;return React.createElement("div",{style:{marginLeft:T*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${xe?"bg-info text-white":Z?"bg-light text-muted":"hover-bg"}`,style:{cursor:Z?"not-allowed":"pointer",opacity:Z?.5:1,transition:"background 0.2s"},onClick:()=>!Z&&P(oe)},le&&React.createElement("i",{className:`fas fa-chevron-${O?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:be=>{be.stopPropagation(),ie(!O)}}),!le&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${xe?"-open":""} me-2 ${xe?"":"text-warning"}`}),React.createElement("span",{className:"small"},N.title),Z&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),N.count>0&&!Z&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},N.count)),O&&le&&React.createElement("div",null,$e.map(be=>React.createElement(FolderTreeItem,{key:be.uuid||be.id,folder:be,allAlbums:w,currentAlbumId:C,targetAlbum:z,onSelect:P,level:T+1}))))}function AlbumDetail({album:N,onBack:w,onRefresh:C,showToast:z,onNavigateToFolder:P,onEditSubfolder:T,parentAlbum:O}){const[ie,oe]=useState([]),[Z,xe]=useState([]),[$e,le]=useState(!0),[be,Ie]=useState(!1),[ce,_]=useState(""),[Re,Ue]=useState([]),[qe,he]=useState([]),[Ae,re]=useState({}),[Pe,st]=useState(null),[bt,Se]=useState(!1),[Xe,pt]=useState(""),[b,f]=useState(!1),M=useRef(null),G=useRef(null),[U,H]=useState(!1),[V,me]=useState([]),[p,y]=useState([]),[D,J]=useState(""),[ae,ee]=useState(!1),Ne=async(x,c=2)=>{const $=c*1024*1024,E=x.type==="image/heic"||x.type==="image/heif"||/\.heic$/i.test(x.name);if(x.size<=$&&!E)return x;try{const ne=await createImageBitmap(x),ge=document.createElement("canvas");let K=ne.width,Je=ne.height;const Qe=1200;return(K>Qe||Je>Qe)&&(K>Je?(Je=Math.round(Je/K*Qe),K=Qe):(K=Math.round(K/Je*Qe),Je=Qe)),ge.width=K,ge.height=Je,ge.getContext("2d").drawImage(ne,0,0,K,Je),ne.close(),new Promise((ke,ut)=>{ge.toBlob(Zt=>{Zt?ke(new File([Zt],x.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ut(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ne){throw console.error("Compress error:",ne),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{we(),Be()},[N.id,N.uuid]);const we=async()=>{le(!0);try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");oe(x.images||[]);const c=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");xe(Array.isArray(c)?c:[])}catch(x){console.error(x),z("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}le(!1)},Be=async()=>{try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");y(Array.isArray(x)?x:[])}catch(x){console.error("Error loading albums:",x)}},it=x=>{me(c=>c.includes(x)?c.filter($=>$!==x):[...c,x])},te=async()=>{if(!D||V.length===0){z("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}ee(!0);let x=0;for(const c of V)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${c}`,{album_id:D},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),x++}catch($){console.error("Move error:",$)}ee(!1),H(!1),me([]),J(""),x>0?(z("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),we(),C()):z("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[je,mt]=useState(!1),Oe=async()=>{if(V.length===0||!confirm(`X\xF3a ${V.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;mt(!0);let x=0;for(const c of V)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${c}`,"L\u1ED7i x\xF3a \u1EA3nh"),x++}catch($){console.error("Delete error:",$)}mt(!1),me([]),x>0?(z(`\u0110\xE3 x\xF3a ${x} \u1EA3nh!`,"success"),we(),C()):z("X\xF3a th\u1EA5t b\u1EA1i","danger")},ot=()=>{V.length===ie.length?me([]):me(ie.map(x=>x.id))},gt=async()=>{if(Xe.trim()){f(!0);try{const x=Xe.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:x+"-"+Date.now(),title:Xe,parent_id:N.uuid||N.id},"L\u1ED7i t\u1EA1o folder"),z("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),pt(""),Se(!1),we(),C()}catch(x){z(x.message,"danger")}f(!1)}},Lt=async x=>{if(confirm(`X\xF3a folder "${x.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${x.uuid||x.id}`,"L\u1ED7i x\xF3a folder"),z("\u0110\xE3 x\xF3a folder","success"),we(),C()}catch(c){z("L\u1ED7i x\xF3a folder","danger")}},Ct=x=>{const c=Array.from(x).filter($=>$.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test($.name));Ue($=>[...$,...c]),c.forEach($=>{const E=new FileReader;E.onload=ne=>{he(ge=>[...ge,{file:$,preview:ne.target.result}])},E.readAsDataURL($)})},v=x=>{Ue(c=>c.filter(($,E)=>E!==x)),he(c=>c.filter(($,E)=>E!==x))},R=async x=>{var $;const c=await window.KTM.cloudinary.uploadImage({file:x,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${N.id}`});if(!c.secure_url)throw console.error("Cloudinary error:",c),new Error((($=c.error)==null?void 0:$.message)||"Upload failed");return c},Le=async()=>{if(Re.length===0)return;Ie(!0);let x=0;for(let c=0;c<Re.length;c++)try{_(`\u0110ang x\u1EED l\xFD ${c+1}/${Re.length}...`);const $=await Ne(Re[c],2);_(`\u0110ang upload ${c+1}/${Re.length}...`);const E=await R($);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${N.id}`,{url:E.secure_url,caption:Ae[c]||Re[c].name.replace(/\.[^/.]+$/,""),sort_order:ie.length+c},"L\u1ED7i l\u01B0u \u1EA3nh"),x++}catch($){console.error("Upload error:",$)}Ie(!1),_(""),Ue([]),he([]),re({}),x>0?(z(`\u0110\xE3 upload ${x} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),we(),C()):z("Upload th\u1EA5t b\u1EA1i","danger")},lt=async(x,c)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${x}`,"L\u1ED7i x\xF3a \u1EA3nh"),z("\u0110\xE3 x\xF3a \u1EA3nh","success"),we(),C()}catch($){z("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Mt=x=>{var c;x.preventDefault(),(c=G.current)==null||c.classList.add("dragover")},Ye=()=>{var x;(x=G.current)==null||x.classList.remove("dragover")},vt=x=>{var c;x.preventDefault(),(c=G.current)==null||c.classList.remove("dragover"),Ct(x.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:w},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},N.title),React.createElement("small",{className:"text-muted"},Z.length>0&&React.createElement("span",null,Z.length," folder \u2022 "),ie.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Se(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),bt&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Xe,onChange:x=>pt(x.target.value),onKeyPress:x=>x.key==="Enter"&&gt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:gt,disabled:b||!Xe.trim()},b?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Se(!1),pt("")}},"H\u1EE7y")))),Z.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Z.map(x=>React.createElement("div",{key:x.uuid||x.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>P&&P(x)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},x.title),React.createElement("small",{className:"text-muted"},x.subfolderCount>0&&React.createElement("span",null,x.subfolderCount," folder"),x.subfolderCount>0&&x.count>0&&" \u2022 ",x.count>0&&React.createElement("span",null,x.count," \u1EA3nh"),x.subfolderCount===0&&x.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:c=>{c.stopPropagation(),T&&T(x)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:c=>{c.stopPropagation(),Lt(x)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:G,className:"upload-zone",onClick:()=>{var x;return(x=M.current)==null?void 0:x.click()},onDragOver:Mt,onDragLeave:Ye,onDrop:vt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:M,type:"file",multiple:!0,accept:"image/*",onChange:x=>Ct(x.target.files)})),qe.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},qe.map((x,c)=>React.createElement("div",{key:c,className:"upload-preview-item"},React.createElement("img",{src:x.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>v(c)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Le,disabled:be},be?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),ce||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Re.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",ie.length,")"),ie.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:ot},V.length===ie.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),V.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},V.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>H(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Oe,disabled:je},je?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>me([])},React.createElement("i",{className:"fas fa-times"})))),$e?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):ie.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},ie.map((x,c)=>React.createElement("div",{key:c,className:`image-item ${V.includes(x.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>it(x.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:V.includes(x.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:V.includes(x.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},V.includes(x.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:x.src,alt:x.caption,style:{opacity:V.includes(x.id)?.7:1,border:V.includes(x.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:$=>{$.stopPropagation(),lt(x.id,c)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),x.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},x.caption)))))),U&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",V.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>H(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},p.filter(x=>!x.parentId).map(x=>React.createElement(FolderTreeItem,{key:x.uuid||x.id,folder:x,allAlbums:p,currentAlbumId:N.uuid||N.id,targetAlbum:D,onSelect:J})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>H(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:te,disabled:!D||ae},ae?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Pe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>st(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>st(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Pe.src,alt:Pe.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:x=>x.stopPropagation()}),Pe.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Pe.caption)))))}function SearchCenter({showToast:N,onNavigate:w}){const[C,z]=useState(""),[P,T]=useState([]),[O,ie]=useState([]),[oe,Z]=useState([]),[xe,$e]=useState("all"),[le,be]=useState(null),[Ie,ce]=useState("list"),[_,Re]=useState(!0),[Ue,qe]=useState([]),[he,Ae]=useState([]),re=useRef(null),[Pe,st]=useState(!0),[bt,Se]=useState(!1),Xe=useRef(null),[pt,b]=useState(!1),[f,M]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[G,U]=useState(""),[H,V]=useState(!1),me=useRef(null),p=useRef(null),[y,D]=useState(null),[J,ae]=useState(!1),[ee,Ne]=useState(null),[we,Be]=useState(!1),[it,te]=useState(!1),[je,mt]=useState(null),[Oe,ot]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),gt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Lt=r=>{var A,j;r._type==="product"&&(Ne(r),ot({name:r.name||"",code:r.code||"",price:r.price||"",image:r.image||"",category:r.category||"",note:r.note||"",commission_percent:(j=(A=r.commission_percent)!=null?A:r.commissionPercent)!=null?j:""}),ae(!0))},Ct=async()=>{if(ee)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${ee.id}`,Oe,"L\u1ED7i c\u1EADp nh\u1EADt"),N("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),ae(!1),Ne(null),Mt()}catch(r){N(r.message,"danger")}},v=async r=>{const A=r._type==="product"?"s\u1EA3n ph\u1EA9m":r._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${A} "${r.name}"?`))try{let j="";r._type==="product"?j=`${API_BASE}/api/products?id=${r.id}`:r._type==="album"?j=`${API_BASE}/api/images/${r.id}`:r._type==="video"&&(j=`${API_BASE}/api/videos/${r.id}`),await window.KTM.api.deleteJSON(j,"L\u1ED7i x\xF3a"),N(`\u0110\xE3 x\xF3a ${A}`,"success"),Mt()}catch(j){N(j.message,"danger")}},R=async r=>{try{const A=je?`${API_BASE}/api/products?id=${je.id}`:`${API_BASE}/api/products`;je?await window.KTM.api.putJSON(A,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(A,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(je?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),te(!1),mt(null),Mt()}catch(A){N(A.message,"danger")}},Le="ktm_admin_data_cache_v1",lt=1e3*60*10,Mt=async()=>{let r=null,A=!1;const j=window.KTM.cache.read(Le,{ttlMs:lt,validate:Array.isArray});j.hit?(r=j.value,console.log("[CACHE] Using cache, items:",r.length),ie(r),T(r),Re(!1),A=!0):j.status==="miss"?console.log("[CACHE] No cache found"):j.status==="expired"||j.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):j.status==="error"&&console.error("[CACHE] Error parsing cache"),A||Re(!0);try{const Y=async(Ze,He)=>{try{const ct=await window.KTM.api.getJSON(Ze,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return ct!=null?ct:He}catch(ct){return He}},[se,L,h]=await Promise.all([Y(`${API_BASE}/api/products?fields=search`,[]),Y(`${API_BASE}/api/albums`,[]),Y(`${API_BASE}/api/video-folders?withVideos=true`,[])]),Q=Array.isArray(se)?se.map(Ze=>({...Ze,_type:"product",_source:"database"})):[];qe(L);let ve=[];Array.isArray(L)&&L.length>0&&(await Promise.all(L.map(He=>Y(`${API_BASE}/api/albums/${He.id}`,{})))).forEach((He,ct)=>{const Nt=L[ct];He.images&&He.images.length>0&&He.images.forEach(wt=>{ve.push({id:wt.id,name:wt.caption||"\u1EA2nh t\u1EEB "+Nt.title,image:wt.src,folder:Nt.title,_type:"album",_source:"database"})})}),Ae(h);let ue=[];Array.isArray(h)&&h.forEach(Ze=>{Ze.videos&&Ze.videos.forEach(He=>{ue.push({id:He.id,name:He.title,folder:Ze.name,image:He.thumb,youtubeId:He.youtubeId,url:He.url,_type:"video",_source:"database"})})});const X=[...Q,...ve,...ue];(!r||JSON.stringify(X)!==JSON.stringify(r))&&(ie(X),T(X),window.KTM.cache.write(Le,X))}catch(Y){console.error("Song song fetch error:",Y)}Re(!1)};useEffect(()=>{Mt(),setTimeout(()=>{var r;return(r=re.current)==null?void 0:r.focus()},100)},[]);const Ye=r=>{try{return String(r!=null?r:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(A){return String(r!=null?r:"").toLowerCase()}},vt=r=>{const j=Ye(r).trim().split(/\s+/).filter(Boolean),Y=j.includes("anh"),se=j.includes("video"),L=j.filter(ve=>ve!=="anh"&&ve!=="video"),h=L.join(" "),Q=new Set(["product"]);return Y&&Q.add("album"),se&&Q.add("video"),{allowedTypes:Q,includeAlbum:Y,includeVideo:se,contentTokens:L,cleanedQuery:h}},x=(r,A,j)=>{var Ze,He,ct,Nt,wt;const Y=Array.isArray(A)?A:[],se=Ye(j).trim();if(!Y.length&&!se)return 0;const L=Ye((Ze=r==null?void 0:r.name)!=null?Ze:""),h=Ye((He=r==null?void 0:r.code)!=null?He:""),Q=Ye((ct=r==null?void 0:r.category)!=null?ct:""),ve=Ye((Nt=r==null?void 0:r.note)!=null?Nt:""),ue=Ye((wt=r==null?void 0:r.folder)!=null?wt:"");if(!`${L} ${h} ${Q} ${ve} ${ue}`.trim())return 0;let _e=0;se&&(L===se&&(_e+=220),L.includes(se)&&(_e+=140),L.startsWith(se)&&(_e+=160),h&&h===se&&(_e+=180),h&&h.includes(se)&&(_e+=90));for(const At of Y){if(!At)continue;const Et=new RegExp(`(?:^|\\s)${At.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);L.includes(At)&&(_e+=35),Et.test(L)&&(_e+=25),h&&h.includes(At)&&(_e+=20),h&&Et.test(h)&&(_e+=10),Q&&Q.includes(At)&&(_e+=12),ue&&ue.includes(At)&&(_e+=12),ve&&ve.includes(At)&&(_e+=6)}return _e>0&&L&&(_e+=Math.max(0,10-Math.min(10,Math.floor(L.length/10)))),_e},c=(r,A,j)=>{const Y=Array.isArray(r)?r:[];return Y.length?Y.map((L,h)=>({it:L,idx:h,score:x(L,A,j)})).sort((L,h)=>h.score!==L.score?h.score-L.score:L.idx-h.idx).map(L=>L.it):[]},$=async(r,A)=>{if(!(!Pe||A.length===0)){Se(!0);try{const j=A.map(se=>({id:se.id,name:se.name,price:se.price,category:se.category,note:se.note,folder:se.folder,_type:se._type})),Y=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:r,products:j},"AI Search error");if(Y&&Y.matchedIds&&Y.matchedIds.length>0){const{contentTokens:se,cleanedQuery:L}=vt(r),h=new Set(Y.matchedIds),Q=A.filter(ve=>h.has(ve.id)).sort((ve,ue)=>x(ue,se,L)-x(ve,se,L));Q.length>0&&T(Q)}else Y&&Y.matchedIds&&Y.matchedIds.length===0&&T([])}catch(j){console.error("AI Search error:",j)}Se(!1)}},E=r=>{if(z(r),Xe.current&&clearTimeout(Xe.current),!r.trim()){ne(xe);return}const{allowedTypes:A,contentTokens:j,cleanedQuery:Y}=vt(r),se=O.filter(h=>{if(!A.has(h==null?void 0:h._type))return!1;if(j.length===0)return!0;const Q=Ye(Object.entries(h).filter(([ve])=>!ve.startsWith("_")).map(([,ve])=>String(ve||"")).join(" "));return j.some(ve=>Q.includes(ve))});let L=se;xe!=="all"&&(L=se.filter(h=>(h.category||h._type)===xe)),T(c(L,j,Y)),Pe&&Y.length>=3&&(Xe.current=setTimeout(()=>{$(Y,L)},500))},ne=r=>{$e(r);const{allowedTypes:A,contentTokens:j}=vt(C),{cleanedQuery:Y}=vt(C);let se=O.filter(L=>A.has(L==null?void 0:L._type));r!=="all"&&(se=se.filter(L=>(L.category||L._type)===r)),C.trim()&&j.length>0&&(se=se.filter(L=>{const h=Ye(Object.entries(L).filter(([Q])=>!Q.startsWith("_")).map(([,Q])=>String(Q||"")).join(" "));return j.every(Q=>h.includes(Q))})),T(c(se,j,Y))},ge=(r,A)=>{window.KTM.clipboard.writeText(r).then(()=>{be(A),N("\u0110\xE3 copy!","success"),setTimeout(()=>be(null),1500)})},K=async(r,A)=>{try{await window.KTM.clipboard.writeImageFromUrl(r),be(A+"-img"),N("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>be(null),1500)}catch(j){ge(r,A+"-img")}},Je=r=>{let A=r.toLowerCase();const j=[],Y=O.filter(h=>h._type==="product");if(A.includes("ty")||A.includes("xy lanh")){if(A.includes("gi\u1EEFa")||A.includes("giua")){const h=Y.find(Q=>{var ve;return(ve=Q.name)==null?void 0:ve.toLowerCase().includes("xy lanh gi\u1EEFa")});h&&!j.find(Q=>Q.id===h.id)&&j.push(h)}if(A.includes("nghi\xEAng")||A.includes("nghieng")){const h=Y.find(Q=>{var ve;return(ve=Q.name)==null?void 0:ve.toLowerCase().includes("xy lanh nghi\xEAng")});h&&!j.find(Q=>Q.id===h.id)&&j.push(h)}if(A.includes("\u1EE7i")||A.includes("ui")){const h=Y.find(Q=>{var ve;return(ve=Q.name)==null?void 0:ve.toLowerCase().includes("xy lanh \u1EE7i")});h&&!j.find(Q=>Q.id===h.id)&&j.push(h)}}const se=A.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(se){const h=se[1],Q=se[2],ve=Y.find(ue=>{var _e;const X=((_e=ue.name)==null?void 0:_e.toLowerCase())||"";return X.includes("combo")&&X.includes(`${h} tay`)&&(X.includes(`${Q} xy`)||X.includes(`${Q} xylanh`))});if(ve&&!j.find(ue=>ue.id===ve.id))j.push(ve);else{const ue=Y.find(X=>{var Ze;const _e=((Ze=X.name)==null?void 0:Ze.toLowerCase())||"";return _e.includes("combo")&&_e.includes(`${h} tay`)});ue&&!j.find(X=>X.id===ue.id)&&j.push(ue)}}if(A.includes("combo")&&!se){const h=A.match(/combo.*?(\d+)\s*tay/);if(h){const Q=h[1];Y.filter(ue=>{var _e;const X=((_e=ue.name)==null?void 0:_e.toLowerCase())||"";return X.includes("combo")&&X.includes(`${Q} tay`)}).forEach(ue=>{j.find(X=>X.id===ue.id)||j.push(ue)})}}const L=A.match(/van\s*(\d+)\s*tay/);if(L&&!A.includes("ty")&&!A.includes("combo")){const h=L[1],Q=Y.find(ve=>{var X;const ue=((X=ve.name)==null?void 0:X.toLowerCase())||"";return ue.includes(`van ${h} tay`)&&!ue.includes("combo")});Q&&!j.find(ve=>ve.id===Q.id)&&j.push(Q)}return j.slice(0,4)},Qe=async r=>{if(!r.trim())return;const A={role:"user",content:r,attachments:[]};M(Y=>[...Y,A]),U(""),V(!0);const j=Je(r);setTimeout(()=>{var Y;return(Y=me.current)==null?void 0:Y.scrollIntoView({behavior:"smooth"})},100);try{const se=O.filter(X=>X._type==="product").map(X=>{let _e=`- ${X.name}`;return X.code&&(_e+=` (M\xE3: ${X.code})`),X.price&&(_e+=` - Gi\xE1: ${X.price.replace(/[đ\s]/g,"")}\u0111`),X.category&&(_e+=` [${X.category}]`),X.note&&(_e+=` (${X.note})`),_e}).join(`
`),h=f.slice(-6).map(X=>`${X.role==="user"?"Kh\xE1ch":"AI"}: ${X.content}`).join(`
`),Q=h?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${h}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${se}`:se,ue=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:r,context:Q,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";M(X=>[...X,{role:"assistant",content:ue,attachments:j}])}catch(Y){console.error("AI Error:",Y);const se=r.toLowerCase(),L=O.filter(Q=>{const ve=Object.values(Q).join(" ").toLowerCase();return se.split(" ").some(ue=>ve.includes(ue))});let h="";L.length>0?(h=`T\xECm th\u1EA5y ${L.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,L.slice(0,5).forEach(Q=>{h+=`\u2022 ${Q.name}`,Q.price&&(h+=` - ${Q.price.replace(/[đ\s]/g,"")}\u0111`),Q.note&&(h+=` (${Q.note})`),h+=`
`}),L.length>5&&(h+=`
...v\xE0 ${L.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):h='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',M(Q=>[...Q,{role:"assistant",content:h,attachments:L.slice(0,4)}])}V(!1),setTimeout(()=>{var Y,se;(Y=me.current)==null||Y.scrollIntoView({behavior:"smooth"}),(se=p.current)==null||se.focus()},100)};function Dt({show:r,product:A,categories:j,onClose:Y,onSave:se}){const[L,h]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Q,ve]=useState(!1),[ue,X]=useState(!1),_e=useRef(null),Ze=I=>window.KTM.money.formatVNDInputDigits(I),He=I=>{const F=window.KTM.money.getDigits(String(I!=null?I:"")),W=Number(F);return F&&Number.isFinite(W)?Math.trunc(W):0},ct=(I,F)=>{if(I==null||I==="")return[];let W=I;if(typeof W=="string"){const ye=W.trim();if(!ye)return[];try{W=JSON.parse(ye)}catch(pe){return[]}}if(!Array.isArray(W))return[];const de=He(F);return W.map(ye=>{var De;if(!ye||typeof ye!="object")return null;const pe=String((De=ye.name)!=null?De:"").trim(),Ee=(Array.isArray(ye.options)?ye.options:[]).map(et=>{var Ke,St,Ot,ht,Pt,Wt,bn;if(!et||typeof et!="object")return null;const ft=String((Ke=et.label)!=null?Ke:"").trim();if(!ft)return null;const yt=(Pt=(ht=(Ot=(St=et.price)!=null?St:et.priceValue)!=null?Ot:et.unit_price)!=null?ht:et.unitPrice)!=null?Pt:null,xt=Number(yt);let It=Number.isFinite(xt)?Math.trunc(xt):null;if(It==null){const Na=(bn=(Wt=et.price_delta)!=null?Wt:et.priceDelta)!=null?bn:null,wa=Number(Na);Number.isFinite(wa)&&(It=de+Math.trunc(wa))}It==null&&(It=de);const jt=String(Math.max(0,Math.trunc(Number(It)||0)));return{label:ft,price:Math.max(0,Math.trunc(Number(It)||0)),priceDigits:jt}}).filter(Boolean);return{name:pe||"Bi\u1EBFn th\u1EC3",options:Ee}}).filter(Boolean)},Nt=I=>{if(I==null||I==="")return[];let F=I;if(typeof F=="string"){const W=F.trim();if(!W)return[];try{F=JSON.parse(W)}catch(de){return[]}}return F&&typeof F=="object"&&!Array.isArray(F)&&(F=Object.entries(F).map(([W,de])=>({key:W,value:de}))),Array.isArray(F)?F.map(W=>{var Ee,De,et,ft,yt;if(!W||typeof W!="object")return null;const de=String((et=(De=(Ee=W.key)!=null?Ee:W.name)!=null?De:W.label)!=null?et:"").trim(),ye=String((ft=W.value)!=null?ft:"").trim(),pe=String((yt=W.unit)!=null?yt:"").trim();return de?{key:de,value:ye,unit:pe}:null}).filter(Boolean):[]};useEffect(()=>{var I,F;if(A)if(h({name:A.name||"",code:A.code||"",price:A.price||"",image:A.image||"",category:A.category||"",note:A.note||"",sort_order:A.sort_order||0,commission_percent:(F=(I=A.commission_percent)!=null?I:A.commissionPercent)!=null?F:5,variants:ct(A.variants,A.price),attributes:Nt(A.attributes)}),A.price){const W=window.KTM.money.getDigits(A.price);ca(W),h(de=>({...de,price:Ze(W)}))}else ca("");else h({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),ca("")},[A,r]);const wt=I=>{h(F=>{var Ee;const W=He(F.price),de=String(W),ye=Array.isArray(F.variants)?[...F.variants]:[],pe={...ye[I]||{},options:Array.isArray((Ee=ye[I])==null?void 0:Ee.options)?[...ye[I].options]:[]};return pe.options=pe.options.map(De=>({label:String((De==null?void 0:De.label)||""),price:W,priceDigits:de})),ye[I]=pe,{...F,variants:ye}})},At=()=>{h(I=>{const F=He(I.price),W=String(F),ye=(Array.isArray(I.variants)?[...I.variants]:[]).map(pe=>{const Ee=(Array.isArray(pe==null?void 0:pe.options)?pe.options:[]).map(De=>({label:String((De==null?void 0:De.label)||""),price:F,priceDigits:W}));return{name:String((pe==null?void 0:pe.name)||"Bi\u1EBFn th\u1EC3"),options:Ee}});return{...I,variants:ye}})},[Et,Jt]=React.useState(""),[ja,ca]=React.useState(""),Va=I=>{const F=window.KTM.money.nextPriceInputState(I.target.value,ja);ca(F.digits),h({...L,price:F.price})},qt=async(I,F=2)=>{const W=F*1024*1024;if(I.size<=W)return I;try{const de=await createImageBitmap(I),ye=document.createElement("canvas");let pe=de.width,Ee=de.height;const De=1200;return(pe>De||Ee>De)&&(pe>Ee?(Ee=Math.round(Ee/pe*De),pe=De):(pe=Math.round(pe/Ee*De),Ee=De)),ye.width=pe,ye.height=Ee,ye.getContext("2d").drawImage(de,0,0,pe,Ee),de.close(),new Promise((ft,yt)=>{ye.toBlob(xt=>{xt?ft(new File([xt],I.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):yt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(de){throw console.error("Compress error:",de),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ya=async I=>{var de;const F=I.target.files[0];if(!F)return;if(!(F.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(F.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}X(!0);try{const ye=await qt(F),pe=await window.KTM.cloudinary.uploadImage({file:ye,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!pe.secure_url)throw console.error("Cloudinary error:",pe),new Error(((de=pe.error)==null?void 0:de.message)||"Upload failed");h(Ee=>({...Ee,image:pe.secure_url}))}catch(ye){console.error("Upload error:",ye),alert("L\u1ED7i upload \u1EA3nh: "+ye.message)}X(!1),I.target.value=""},ta=async I=>{I.preventDefault(),ve(!0);const F={...L,variants:ct(L.variants,L.price),attributes:Nt(L.attributes)};await se(F),ve(!1)};return r?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),A?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:Y})),React.createElement("form",{onSubmit:ta},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:L.name,onChange:I=>h({...L,name:I.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:L.code,onChange:I=>h({...L,code:I.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:L.price,onChange:Va,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:L.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:I=>h({...L,commission_percent:I.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:L.category,onChange:I=>h({...L,category:I.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),j.map(I=>React.createElement("option",{key:I,value:I},I)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:L.note,onChange:I=>h({...L,note:I.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(L.attributes)?L.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(L.attributes)?L.attributes:[]).map((I,F)=>React.createElement("div",{key:F,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(I==null?void 0:I.key)||"",onChange:W=>{const de=W.target.value;h(ye=>{const pe=Array.isArray(ye.attributes)?[...ye.attributes]:[];return pe[F]={...pe[F]||{},key:de},{...ye,attributes:pe}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(I==null?void 0:I.value)||"",onChange:W=>{const de=W.target.value;h(ye=>{const pe=Array.isArray(ye.attributes)?[...ye.attributes]:[];return pe[F]={...pe[F]||{},value:de},{...ye,attributes:pe}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(I==null?void 0:I.unit)||"",onChange:W=>{const de=W.target.value;h(ye=>{const pe=Array.isArray(ye.attributes)?[...ye.attributes]:[];return pe[F]={...pe[F]||{},unit:de},{...ye,attributes:pe}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{h(W=>{const de=Array.isArray(W.attributes)?[...W.attributes]:[];return de.splice(F,1),{...W,attributes:de}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{h(I=>{const F=Array.isArray(I.attributes)?[...I.attributes]:[];return F.push({key:"",value:"",unit:""}),{...I,attributes:F}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(L.variants)?L.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(L.variants)?L.variants:[]).map((I,F)=>React.createElement("div",{key:F,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(I==null?void 0:I.name)||"",onChange:W=>{const de=W.target.value;h(ye=>{var Ee;const pe=Array.isArray(ye.variants)?[...ye.variants]:[];return pe[F]={...pe[F]||{},name:de,options:Array.isArray((Ee=pe[F])==null?void 0:Ee.options)?pe[F].options:[]},{...ye,variants:pe}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>wt(F),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(I==null?void 0:I.options)||I.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{h(W=>{const de=Array.isArray(W.variants)?[...W.variants]:[];return de.splice(F,1),{...W,variants:de}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(I==null?void 0:I.options)?I.options:[]).map((W,de)=>{var ye,pe;return React.createElement("div",{key:de,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(W==null?void 0:W.label)||"",onChange:Ee=>{const De=Ee.target.value;h(et=>{var jt,Ke,St,Ot,ht;const ft=Array.isArray(et.variants)?[...et.variants]:[],yt={...ft[F]||{},options:Array.isArray((jt=ft[F])==null?void 0:jt.options)?[...ft[F].options]:[]},xt=Number((St=(Ke=yt.options[de])==null?void 0:Ke.price)!=null?St:0)||0,It=String((ht=(Ot=yt.options[de])==null?void 0:Ot.priceDigits)!=null?ht:Math.max(0,Math.trunc(xt)));return yt.options[de]={...yt.options[de]||{},label:De,price:Math.max(0,Math.trunc(xt)),priceDigits:It},ft[F]=yt,{...et,variants:ft}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Ze(String((pe=W==null?void 0:W.priceDigits)!=null?pe:window.KTM.money.getDigits(String((ye=W==null?void 0:W.price)!=null?ye:"")))),onChange:Ee=>{h(De=>{var St,Ot,ht,Pt,Wt;const et=String((Ot=W==null?void 0:W.priceDigits)!=null?Ot:window.KTM.money.getDigits(String((St=W==null?void 0:W.price)!=null?St:""))),ft=window.KTM.money.nextPriceInputState(Ee.target.value,et),yt=String((ht=ft.digits)!=null?ht:""),xt=Number(yt),It=Number.isFinite(xt)?Math.max(0,Math.trunc(xt)):0,jt=Array.isArray(De.variants)?[...De.variants]:[],Ke={...jt[F]||{},options:Array.isArray((Pt=jt[F])==null?void 0:Pt.options)?[...jt[F].options]:[]};return Ke.options[de]={...Ke.options[de]||{},label:String(((Wt=Ke.options[de])==null?void 0:Wt.label)||""),price:It,priceDigits:yt},jt[F]=Ke,{...De,variants:jt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{h(Ee=>{var ft;const De=Array.isArray(Ee.variants)?[...Ee.variants]:[],et={...De[F]||{},options:Array.isArray((ft=De[F])==null?void 0:ft.options)?[...De[F].options]:[]};return et.options.splice(de,1),De[F]=et,{...Ee,variants:De}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{h(W=>{var Ee;const de=Array.isArray(W.variants)?[...W.variants]:[],ye={...de[F]||{},options:Array.isArray((Ee=de[F])==null?void 0:Ee.options)?[...de[F].options]:[]},pe=He(W.price);return ye.options.push({label:"",price:pe,priceDigits:String(pe)}),de[F]=ye,{...W,variants:de}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{h(I=>{const F=He(I.price),W=Array.isArray(I.variants)?[...I.variants]:[],de=String(F);return W.push({name:"Size",options:[{label:"S",price:F,priceDigits:de},{label:"M",price:F,priceDigits:de},{label:"L",price:F,priceDigits:de}]}),{...I,variants:W}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:At,disabled:!Array.isArray(L.variants)||L.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},L.image?React.createElement(React.Fragment,null,React.createElement("img",{src:L.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>h({...L,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var I;return(I=_e.current)==null?void 0:I.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:_e,type:"file",accept:"image/*",className:"d-none",onChange:ya}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var I;return(I=_e.current)==null?void 0:I.click()},disabled:ue,style:{borderRadius:"10px"}},ue?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:L.image,onChange:I=>h({...L,image:I.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:Y,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Q,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const ke=r=>window.KTM.money.formatVND(r),ut=r=>{if(r==null||r==="")return[];let A=r;if(typeof A=="string"){const j=A.trim();if(!j)return[];try{A=JSON.parse(j)}catch(Y){return[]}}return Array.isArray(A)?A:[]},Zt=r=>{if(r==null||r==="")return[];let A=r;if(typeof A=="string"){const j=A.trim();if(!j)return[];try{A=JSON.parse(j)}catch(Y){return[]}}return A&&typeof A=="object"&&!Array.isArray(A)&&(A=Object.entries(A).map(([j,Y])=>({key:j,value:Y}))),Array.isArray(A)?A:[]},Tt=(r,A={})=>{var L;const j=Zt(r).map(h=>{var Q,ve,ue,X,_e;return{key:String((ue=(ve=(Q=h==null?void 0:h.key)!=null?Q:h==null?void 0:h.name)!=null?ve:h==null?void 0:h.label)!=null?ue:"").trim(),value:String((X=h==null?void 0:h.value)!=null?X:"").trim(),unit:String((_e=h==null?void 0:h.unit)!=null?_e:"").trim()}}).filter(h=>!!h.key);if(!j.length)return null;const Y=!!A.compact,se=String((L=A.className)!=null?L:"").trim();return React.createElement("div",{className:`ktm-variants-preview${Y?" compact":""}${se?" "+se:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},j.map((h,Q)=>{const ve=h.key,ue=`${h.value||""}${h.unit?(h.value?" ":"")+h.unit:""}`.trim();return React.createElement("div",{key:`${ve}-${Q}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ve),ue?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ue):null)})))},fe=(r,A={})=>{var ve;const j=ut(r).map(ue=>{var X;return{name:String((X=ue==null?void 0:ue.name)!=null?X:"").trim(),options:Array.isArray(ue==null?void 0:ue.options)?ue.options:[]}}).map(ue=>({...ue,options:ue.options.map(X=>{var _e;return{label:String((_e=X==null?void 0:X.label)!=null?_e:"").trim(),price:Number(X==null?void 0:X.price)}}).filter(X=>!!X.label)})).filter(ue=>ue.options.length>0);if(!j.length)return null;const Y=Number.isFinite(A.maxGroups)?Math.max(1,Math.trunc(A.maxGroups)):j.length,se=Number.isFinite(A.maxOptionsPerGroup)?Math.max(1,Math.trunc(A.maxOptionsPerGroup)):3,L=!!A.compact,h=String((ve=A.className)!=null?ve:"").trim(),Q=j.slice(0,Y);return React.createElement("div",{className:`ktm-variants-preview${L?" compact":""}${h?" "+h:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Q.map((ue,X)=>{const _e=ue.name||"Bi\u1EBFn th\u1EC3",Ze=ue.options.slice(0,se),He=ue.options.length-Ze.length;return React.createElement("div",{key:`${_e}-${X}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},_e),Ze.map((ct,Nt)=>{const wt=ct.price,At=Number.isFinite(wt)&&wt>=0?ke(Math.trunc(wt)):"",Et=At?`${ct.label} \xB7 ${At}`:ct.label;return React.createElement("span",{key:`${_e}-${X}-${Nt}`,className:"ktm-chip ktm-chip-option"},Et)}),He>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",He))})))},Rt=(r,A)=>{const j=r._type==="product",Y=r._type==="album",se=r._type==="video",L=r.note&&(r.note.toLowerCase().includes("free")||r.note.toLowerCase().includes("gi\u1EA3m")||r.note.toLowerCase().includes("sale")),h=j?Tt(r.attributes,{compact:Ie==="grid",className:Ie==="grid"?"meta text-muted":"text-muted"}):null,Q=j?fe(r.variants,{compact:Ie==="grid",maxOptionsPerGroup:999,className:Ie==="grid"?"meta text-muted":"text-muted"}):null;return Ie==="grid"?React.createElement("div",{key:r.id||A,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>D({url:r.image,name:r.name,price:r.price,note:r.note,item:r})},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${se?"fa-video":"fa-image"} fa-2x text-muted`})),r.price&&React.createElement("div",{className:"price-overlay"},r.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${j?"product":Y?"album":"video"}`},j?"SP":Y?"\u1EA2nh":"Video"),L&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},r.name),r.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},r.note),h&&React.createElement("div",{style:{marginTop:2}},h),Q&&React.createElement("div",{style:{marginTop:2}},Q),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:le===r.id+"-img"?"copied":"",onClick:()=>K(r.image,r.id)},React.createElement("i",{className:"fas fa-image"})),r.price&&React.createElement("button",{className:le===r.id+"-price"?"copied":"",onClick:()=>ge(r.price.replace(/[đ\s]/g,""),r.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:r.id||A,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${j?"product":Y?"album":"video"}`},j?"S\u1EA3n ph\u1EA9m":Y?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy",onClick:()=>D({url:r.image,name:r.name,price:r.price,note:r.note,item:r})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${se?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},r.name),React.createElement("div",{className:"price-row"},r.price&&React.createElement("span",{className:"price"},r.price.replace(/[đ\s]/g,""),"\u0111"),L&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),h&&React.createElement("div",{style:{marginTop:4}},h),Q&&React.createElement("div",{style:{marginTop:4}},Q)),React.createElement("div",{className:"meta"},r.code&&React.createElement("span",{className:"meta-tag"},"#",r.code),r.category&&React.createElement("span",{className:"meta-tag"},r.category),r.note&&React.createElement("span",{className:"meta-tag highlight"},r.note),r.folder&&React.createElement("span",{className:"meta-tag"},r.folder),se&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},j&&React.createElement("button",{onClick:()=>w&&w("orders","create",{productId:r.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),r.price&&React.createElement("button",{className:le===r.id+"-price"?"copied":"",onClick:()=>ge(r.price.replace(/[đ\s]/g,""),r.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:le===r.id+"-name"?"copied":"",onClick:()=>ge(r.name,r.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),se&&r.youtubeId&&React.createElement("button",{className:le===r.id+"-yt"?"copied":"",onClick:()=>ge(`https://www.youtube.com/watch?v=${r.youtubeId}`,r.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),j&&React.createElement("button",{className:"action-edit",onClick:()=>Lt(r)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>v(r)},React.createElement("i",{className:"fas fa-trash"}))))},[Gt,kt]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,P.length)," k\u1EBFt qu\u1EA3",Pe&&C.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),xe!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},xe==="product"?"S\u1EA3n ph\u1EA9m":xe==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Ie==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ce("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Ie==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ce("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},_?React.createElement("div",null,[...Array(8)].map((r,A)=>React.createElement("div",{key:A,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):P.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',C,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{z(""),E("")}},"Xem t\u1EA5t c\u1EA3")):Ie==="grid"?React.createElement("div",{className:"product-grid-mobile"},P.map((r,A)=>Rt(r,A))):React.createElement("div",null,P.map((r,A)=>Rt(r,A)))),Gt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>kt(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${xe==="all"?"active":""}`,onClick:()=>{ne("all"),kt(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${xe==="product"?"active":""}`,onClick:()=>{ne("product"),kt(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${xe==="album"?"active":""}`,onClick:()=>{ne("album"),kt(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${xe==="video"?"active":""}`,onClick:()=>{ne("video"),kt(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Pe,onChange:r=>st(r.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:re,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:C,onChange:r=>E(r.target.value)}),React.createElement("button",{className:`filter-btn ${Gt||xe!=="all"?"active":""}`,onClick:()=>kt(!Gt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:we?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>b(!0),onTouchStart:()=>b(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),pt&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>b(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},f.map((r,A)=>React.createElement("div",{key:A,className:`mb-3 ${r.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${r.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:r.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},r.content,r.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:le===`chat-${A}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:le===`chat-${A}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(r.content),be(`chat-${A}`),setTimeout(()=>be(null),1500)}},React.createElement("i",{className:`fas ${le===`chat-${A}`?"fa-check":"fa-copy"}`})),r.attachments&&r.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},r.attachments.map((j,Y)=>React.createElement("div",{key:Y,style:{width:70},className:"text-center"},j.image&&React.createElement("img",{src:j.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>D({url:j.image,name:j.name,price:j.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},j.name),j.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},j.price.replace(/[đ\s]/g,""),"\u0111"))))))),H&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:me})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(r=>React.createElement("button",{key:r,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Qe(r),disabled:H,style:{whiteSpace:"nowrap"}},r))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:r=>{r.preventDefault(),Qe(G)},className:"chat-input-wrap"},React.createElement("input",{ref:p,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:G,onChange:r=>U(r.target.value),disabled:H}),React.createElement("button",{type:"submit",className:"send-btn",disabled:H||!G.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),y&&React.createElement("div",{className:"preview-modal",onClick:()=>D(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>D(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:r=>r.stopPropagation()},React.createElement("img",{src:y.url,alt:y.name})),React.createElement("div",{className:"preview-footer",onClick:r=>r.stopPropagation()},React.createElement("div",{className:"name"},y.name),y.price&&React.createElement("div",{className:"price"},y.price.replace(/[đ\s]/g,""),"\u0111"),y.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},y.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:le==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:le==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>K(y.url,"preview")},React.createElement("i",{className:`fas ${le==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),y.price&&React.createElement("button",{className:le==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>ge(y.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${le==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Dt,{show:it,product:je,categories:oe,onClose:()=>{te(!1),mt(null)},onSave:R}),React.createElement("div",{className:`fab-container mobile-only ${we?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{Be(!1),te(!0),mt(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{Be(!1),w&&w("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${we?"open":""}`,onClick:()=>Be(!we)},React.createElement("i",{className:"fas fa-plus"}))),J&&ee&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>ae(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Oe.name,onChange:r=>ot({...Oe,name:r.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Oe.code,onChange:r=>ot({...Oe,code:r.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Oe.price,onChange:r=>ot({...Oe,price:r.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Oe.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:r=>ot({...Oe,commission_percent:r.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Oe.category,onChange:r=>ot({...Oe,category:r.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),gt.map(r=>React.createElement("option",{key:r,value:r},r)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Oe.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:r=>ot({...Oe,note:r.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>ae(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:Ct},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:N,showToast:w}){const[C,z]=useState([]),[P,T]=useState([]),[O,ie]=useState(!0),[oe,Z]=useState(null),[xe,$e]=useState(!1),[le,be]=useState(null),[Ie,ce]=useState(!1),[_,Re]=useState(null),[Ue,qe]=useState(!1),[he,Ae]=useState(null),[re,Pe]=useState(!1),[st,bt]=useState(!1),[Se,Xe]=useState(null),[pt,b]=useState(!1),[f,M]=useState(null),[G,U]=useState([]);useEffect(()=>{H()},[]);const H=async(v=null)=>{ie(!0);try{const R=v?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${v}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Le=await window.KTM.api.getJSON(R,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");z(Array.isArray(Le)?Le:[])}catch(R){console.error(R),w("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}ie(!1)},V=async v=>{try{const R=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${v}`,"L\u1ED7i t\u1EA3i video");T(Array.isArray(R)?R:[])}catch(R){console.error(R)}},me=async v=>{if(v===0)return;const R=[...C];[R[v-1],R[v]]=[R[v],R[v-1]],z(R),await y(R)},p=async v=>{if(v===C.length-1)return;const R=[...C];[R[v],R[v+1]]=[R[v+1],R[v]],z(R),await y(R)},y=async v=>{try{await Promise.all(v.map((R,Le)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${R.id}`,{sortOrder:Le},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),w("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(R){w("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),H(f==null?void 0:f.id)}},D=async v=>{if(v===0)return;const R=[...P];[R[v-1],R[v]]=[R[v],R[v-1]],T(R),await ae(R)},J=async v=>{if(v===P.length-1)return;const R=[...P];[R[v],R[v+1]]=[R[v+1],R[v]],T(R),await ae(R)},ae=async v=>{try{await Promise.all(v.map((R,Le)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${R.id}`,{sort_order:Le},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),w("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(R){w("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),V(oe.id)}},ee=()=>{be(null),$e(!0)},Ne=v=>{Xe(v),bt(!0),b(!0)},we=async(v,R="modal")=>{try{!le&&f&&(v.parent_id=f.id);const Le=le?`${API_BASE}/api/video-folders/${le.id}`:`${API_BASE}/api/video-folders`;le?await window.KTM.api.putJSON(Le,v,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Le,v,"L\u1ED7i l\u01B0u folder"),w(le?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),R==="drawer"?(b(!1),be(null),H(f==null?void 0:f.id),le&&Se&&Xe({...Se,...v})):($e(!1),be(null),H(f==null?void 0:f.id))}catch(Le){w(Le.message,"danger")}},Be=async v=>{const R=v.subfolderCount>0?`X\xF3a folder "${v.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${v.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(R))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${v.id}`,"L\u1ED7i x\xF3a folder"),w("\u0110\xE3 x\xF3a folder","success"),Z(null),H(f==null?void 0:f.id)}catch(Le){w("L\u1ED7i x\xF3a folder","danger")}},it=v=>{v.subfolderCount>0?(U(R=>[...R,v]),M(v),H(v.id)):(Z(v),T(v.videos||[]))},te=v=>{if(v==="root")U([]),M(null),H(null);else if(v){const R=G.findIndex(Le=>Le.id===v.id);R>=0&&(U(G.slice(0,R+1)),M(v),H(v.id))}else{const R=[...G];R.pop();const Le=R[R.length-1]||null;U(R),M(Le),H(Le==null?void 0:Le.id)}},je=()=>{bt(!1),b(!1),Xe(null)},mt=()=>{qe(!1),Pe(!1),Ae(null)},Oe=()=>{Re(null),ce(!0)},ot=v=>{Ae(v),qe(!0),Pe(!0)},gt=async(v,R="modal")=>{try{v.folder_id=oe==null?void 0:oe.id;const Le=_?`${API_BASE}/api/videos/${_.id}`:`${API_BASE}/api/videos`;_?await window.KTM.api.putJSON(Le,v,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Le,v,"L\u1ED7i l\u01B0u video"),w(_?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),R==="drawer"?(Pe(!1),Re(null),H(),oe&&V(oe.id),_&&he&&Ae({...he,...v})):(ce(!1),Re(null),H(),oe&&V(oe.id))}catch(Le){w(Le.message,"danger")}},Lt=async v=>{if(confirm(`X\xF3a video "${v.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${v.id}`,"L\u1ED7i x\xF3a video"),w("\u0110\xE3 x\xF3a video","success"),H(),oe&&V(oe.id)}catch(R){w("L\u1ED7i x\xF3a video","danger")}},Ct=v=>{const R=`https://www.youtube.com/watch?v=${v.youtubeId}`;window.KTM.clipboard.writeText(R).then(()=>{w("\u0110\xE3 copy link!","success")}).catch(()=>{w("Kh\xF4ng th\u1EC3 copy link","danger")})};return oe?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Z(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${oe.slug==="shorts"?"text-danger":"text-warning"}`}),oe.name)),React.createElement("button",{className:"btn btn-warning",onClick:Oe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),P.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},P.map((v,R)=>React.createElement("div",{key:v.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>D(R),disabled:R===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},R+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>J(R),disabled:R===P.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:v.thumb,className:"card-img-top",alt:v.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${v.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:v.title},v.title),React.createElement("small",{className:"text-muted"},v.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Ct(v),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>ot(v),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Lt(v),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Ie,video:_,onClose:()=>ce(!1),onSave:gt}),React.createElement(AdminDrawer,{open:st,title:Se?Se.name:"Folder",subtitle:Se?`${Se.subfolderCount||0} subfolder \u2022 ${Se.videoCount||0} videos`:"",onClose:je,footer:pt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:je},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Se&&we({name:Se.name||"",description:Se.description||"",sortOrder:Se.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Se?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Se.name),w("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{b(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Se.name}"?`)&&(Be(Se),je())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},pt&&Se?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Se.name||"",onChange:v=>Xe({...Se,name:v.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Se.description||"",onChange:v=>Xe({...Se,description:v.target.value})}))):Se?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Se.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Se.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Se.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Se.videoCount||0))),Se.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Se.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:Ue,title:he?he.title:"Video",subtitle:he?`${he.youtubeId}`:"",onClose:mt,footer:re?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:mt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{he&&gt({youtube_url:`https://www.youtube.com/watch?v=${he.youtubeId}`,title:he.title||"",thumbnail_url:he.thumb||"",sort_order:he.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):he?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const v=`https://www.youtube.com/watch?v=${he.youtubeId}`;window.KTM.clipboard.writeText(v).then(()=>{w("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Pe(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${he.title}"?`)&&(Lt(he),mt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},re&&he?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:he.title||"",onChange:v=>Ae({...he,title:v.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:he.youtubeId||"",onChange:v=>Ae({...he,youtubeId:v.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:he.sortOrder||0,onChange:v=>Ae({...he,sortOrder:parseInt(v.target.value)||0})}))):he?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},he.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},he.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},he.sortOrder||0))),he.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:he.thumb,alt:he.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},f&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>te()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),f?f.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:ee},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),G.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:v=>{v.preventDefault(),te("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),G.map((v,R)=>React.createElement("li",{key:v.id,className:`breadcrumb-item ${R===G.length-1?"active":""}`},R===G.length-1?v.name:React.createElement("a",{href:"#",onClick:Le=>{Le.preventDefault(),te(v)},className:"text-warning"},v.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),O?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):C.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},f?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ee},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",f?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},C.map((v,R)=>{var Le,lt,Mt,Ye;return React.createElement("div",{key:v.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:vt=>{vt.stopPropagation(),me(R)},disabled:R===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},R+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:vt=>{vt.stopPropagation(),p(R)},disabled:R===C.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>it(v),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${v.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},v.name),React.createElement("p",{className:"text-muted mb-0"},v.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),v.subfolderCount," folder"),v.subfolderCount>0&&(v.videoCount>0||((Le=v.videos)==null?void 0:Le.length)>0)&&" \u2022 ",(v.videoCount>0||((lt=v.videos)==null?void 0:lt.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),v.videoCount||((Mt=v.videos)==null?void 0:Mt.length)||0," videos"),v.subfolderCount===0&&!v.videoCount&&!((Ye=v.videos)!=null&&Ye.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:vt=>{vt.stopPropagation(),Ne(v)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:vt=>{vt.stopPropagation(),Be(v)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:xe,folder:le,onClose:()=>$e(!1),onSave:we}))}function VideoFolderModal({show:N,folder:w,onClose:C,onSave:z}){const[P,T]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[O,ie]=useState(!1),[oe,Z]=useState(!1);useEffect(()=>{T(w?{name:w.name||"",description:w.description||"",sortOrder:w.sortOrder||0,coverImage:w.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[w,N]);const xe=async le=>{const be=le.target.files[0];if(be){Z(!0);try{const Ie=await window.KTM.cloudinary.uploadImage({file:be,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Ie.secure_url&&T(ce=>({...ce,coverImage:Ie.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Ie){console.error("Cloudinary upload error:",Ie),alert("L\u1ED7i upload \u1EA3nh: "+(Ie.message||Ie))}finally{Z(!1)}}},$e=async le=>{le.preventDefault(),ie(!0);const be={...P,variants:normalizeVariants(P.variants,P.price),attributes:normalizeAttributes(P.attributes)};await z(be),ie(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:C})),React.createElement("form",{onSubmit:$e},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:P.name,onChange:le=>T({...P,name:le.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:P.description,onChange:le=>T({...P,description:le.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sortOrder,onChange:le=>T({...P,sortOrder:parseInt(le.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},P.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:P.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>T({...P,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:xe,disabled:oe}),oe&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:P.coverImage,onChange:le=>T({...P,coverImage:le.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:C},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:N,settings:w}){const[C,z]=useState([]),[P,T]=useState(!0),[O,ie]=useState(!1),[oe,Z]=useState(null),[xe,$e]=useState(""),[le,be]=useState(""),[Ie,ce]=useState(!1),[_,Re]=useState(null),Ue=normalizeShipPercent(w==null?void 0:w.ship_percent),{parseMoney:qe,formatVND:he}=window.KTM.money,Ae=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{re()},[]);const re=async()=>{T(!0);try{const p=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");z(Array.isArray(p)?p:[])}catch(p){console.error(p),N("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}T(!1)},Pe=()=>{Z(null),ie(!0)},st=p=>{Z(p),ie(!0)},bt=p=>{p&&(Re(p),ce(!0))},Se=()=>{ce(!1)},Xe=async p=>{if(!(!p||!p.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:p},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),N(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),re()}catch(y){N("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},pt=async p=>{try{const y=oe?`${API_BASE}/api/products?id=${oe.id}`:`${API_BASE}/api/products`;oe?await window.KTM.api.putJSON(y,p,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(y,p,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(oe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ie(!1),re()}catch(y){N(y.message,"danger")}},b=async p=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${p.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${p.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),N("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),re()}catch(y){N(y.message,"danger")}},f=C.filter(p=>{const y=!xe||p.name.toLowerCase().includes(xe.toLowerCase())||p.code&&p.code.toLowerCase().includes(xe.toLowerCase()),D=!le||p.category===le;return y&&D}),M=p=>{var J;const y=(J=p==null?void 0:p.commission_percent)!=null?J:p==null?void 0:p.commissionPercent,D=y===""||y==null?NaN:Number(y);return Number.isFinite(D)?Math.max(0,Math.min(100,D)):5},G=p=>{const y=M(p),D=Number.isInteger(y)?String(y):String(Math.round(y*100)/100),J=qe(p==null?void 0:p.price);if(!Number.isFinite(J)||J<=0)return`${D}%`;const ae=(Number(y)||0)/100,Ne=window.KTM.money.parseShipFeeFromNote(p==null?void 0:p.note)!=null?0:Ue>0?J*Ue/100:0,we=J*ae-Ne*ae,Be=Math.max(0,Math.round(we));return`${D}% - ${he(Be)}`},U=p=>{if(p==null||p==="")return[];let y=p;if(typeof y=="string"){const D=y.trim();if(!D)return[];try{y=JSON.parse(D)}catch(J){return[]}}return Array.isArray(y)?y:[]},H=p=>{if(p==null||p==="")return[];let y=p;if(typeof y=="string"){const D=y.trim();if(!D)return[];try{y=JSON.parse(D)}catch(J){return[]}}return y&&typeof y=="object"&&!Array.isArray(y)&&(y=Object.entries(y).map(([D,J])=>({key:D,value:J}))),Array.isArray(y)?y:[]},V=p=>{const y=H(p).map(D=>{var J,ae,ee,Ne,we;return{key:String((ee=(ae=(J=D==null?void 0:D.key)!=null?J:D==null?void 0:D.name)!=null?ae:D==null?void 0:D.label)!=null?ee:"").trim(),value:String((Ne=D==null?void 0:D.value)!=null?Ne:"").trim(),unit:String((we=D==null?void 0:D.unit)!=null?we:"").trim()}}).filter(D=>!!D.key);return y.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},y.map((D,J)=>{const ae=D.key,ee=`${D.value||""}${D.unit?(D.value?" ":"")+D.unit:""}`.trim();return React.createElement("div",{key:`${ae}-${J}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ae),ee?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ee):null)}))):null},me=(p,y={})=>{const D=U(p).map(Ne=>{var we;return{name:String((we=Ne==null?void 0:Ne.name)!=null?we:"").trim(),options:Array.isArray(Ne==null?void 0:Ne.options)?Ne.options:[]}}).map(Ne=>({...Ne,options:Ne.options.map(we=>{var Be;return{label:String((Be=we==null?void 0:we.label)!=null?Be:"").trim(),price:Number(we==null?void 0:we.price)}}).filter(we=>!!we.label)})).filter(Ne=>Ne.options.length>0);if(!D.length)return null;const J=Number.isFinite(y.maxGroups)?Math.max(1,Math.trunc(y.maxGroups)):D.length,ae=Number.isFinite(y.maxOptionsPerGroup)?Math.max(1,Math.trunc(y.maxOptionsPerGroup)):4,ee=D.slice(0,J);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},ee.map((Ne,we)=>{const Be=Ne.name||"Bi\u1EBFn th\u1EC3",it=Ne.options.slice(0,ae),te=Ne.options.length-it.length;return React.createElement("div",{key:`${Be}-${we}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Be),it.map((je,mt)=>{const Oe=je.price,ot=Number.isFinite(Oe)&&Oe>=0?he(Math.trunc(Oe)):"",gt=ot?`${je.label} \xB7 ${ot}`:je.label;return React.createElement("span",{key:`${Be}-${we}-${mt}`,className:"ktm-chip ktm-chip-option"},gt)}),te>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",te))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Pe},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:xe,onChange:p=>$e(p.target.value)})),React.createElement("span",{className:"product-count"},f.length)),React.createElement("select",{className:"form-select",value:le,onChange:p=>be(p.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),Ae.map(p=>React.createElement("option",{key:p,value:p},p)))),P?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):f.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Pe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},f.map(p=>React.createElement("div",{key:p.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>bt(p),onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),bt(p))},title:"Xem chi ti\u1EBFt"},p.image?React.createElement("img",{src:p.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},p.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},p.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},p.category),p.code&&React.createElement("span",{className:"product-badge bg-secondary"},p.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),G(p))),React.createElement("div",{className:"product-price"},p.price?p.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),p.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},p.note),V(p.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},V(p.attributes)),me(p.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},me(p.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:y=>{y.stopPropagation(),st(p)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:y=>{y.stopPropagation(),b(p)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:Ie,title:String((_==null?void 0:_.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((_==null?void 0:_.code)||"").trim()||null,String((_==null?void 0:_.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Se,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const p=String((_==null?void 0:_.code)||"").trim();p&&window.KTM.clipboard.writeText(p).then(()=>N("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((_==null?void 0:_.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const p=String((_==null?void 0:_.price)||"").trim();p&&window.KTM.clipboard.writeText(p).then(()=>N("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((_==null?void 0:_.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>_&&st(_),disabled:!_},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>_&&b(_),disabled:!_},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},_?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const p=String((_==null?void 0:_.price)||"").trim(),y=qe(p);return Number.isFinite(y)&&y>0?he(Math.trunc(y)):p||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},G(_)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},_.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},_.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),_.image?React.createElement("img",{src:_.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(_.note||"").trim()||_.attributes||_.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(_.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(_.note||"").trim()),V(_.attributes)?React.createElement("div",{className:"mt-2"},V(_.attributes)):null,me(_.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},me(_.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:O,product:oe,categories:Ae,onClose:()=>ie(!1),onSave:pt}))}function ProductModal({show:N,product:w,categories:C,onClose:z,onSave:P}){const[T,O]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[ie,oe]=useState(!1),[Z,xe]=useState(!1),$e=b=>{const f=window.KTM.money.getDigits(String(b!=null?b:"")),M=Number(f);return f&&Number.isFinite(M)?Math.trunc(M):0},le=b=>{if(b==null||b==="")return[];let f=b;if(typeof f=="string"){const M=f.trim();if(!M)return[];try{f=JSON.parse(M)}catch(G){return[]}}return f&&typeof f=="object"&&!Array.isArray(f)&&(f=Object.entries(f).map(([M,G])=>({key:M,value:G}))),Array.isArray(f)?f.map(M=>{var V,me,p,y,D;if(!M||typeof M!="object")return null;const G=String((p=(me=(V=M.key)!=null?V:M.name)!=null?me:M.label)!=null?p:"").trim(),U=String((y=M.value)!=null?y:"").trim(),H=String((D=M.unit)!=null?D:"").trim();return G?{key:G,value:U,unit:H}:null}).filter(Boolean):[]},be=(b,f)=>{if(b==null||b==="")return[];let M=b;if(typeof M=="string"){const U=M.trim();if(!U)return[];try{M=JSON.parse(U)}catch(H){return[]}}if(!Array.isArray(M))return[];const G=$e(f);return M.map(U=>{var me;if(!U||typeof U!="object")return null;const H=String((me=U.name)!=null?me:"").trim(),V=(Array.isArray(U.options)?U.options:[]).map(p=>{var Ne,we,Be,it,te,je,mt;if(!p||typeof p!="object")return null;const y=String((Ne=p.label)!=null?Ne:"").trim();if(!y)return null;const D=(te=(it=(Be=(we=p.price)!=null?we:p.priceValue)!=null?Be:p.unit_price)!=null?it:p.unitPrice)!=null?te:null,J=Number(D);let ae=Number.isFinite(J)?Math.trunc(J):null;if(ae==null){const Oe=(mt=(je=p.price_delta)!=null?je:p.priceDelta)!=null?mt:null,ot=Number(Oe);Number.isFinite(ot)&&(ae=G+Math.trunc(ot))}ae==null&&(ae=G);const ee=String(Math.max(0,Math.trunc(Number(ae)||0)));return{label:y,price:Math.max(0,Math.trunc(Number(ae)||0)),priceDigits:ee}}).filter(Boolean);return{name:H||"Bi\u1EBFn th\u1EC3",options:V}}).filter(Boolean)};useEffect(()=>{var b,f;O(w?{name:w.name||"",code:w.code||"",price:w.price||"",image:w.image||"",category:w.category||"",note:w.note||"",sort_order:w.sort_order||0,commission_percent:(f=(b=w.commission_percent)!=null?b:w.commissionPercent)!=null?f:5,variants:be(w.variants,w.price),attributes:le(w.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[w,N]);const Ie=b=>{O(f=>{var V;const M=$e(f.price),G=String(M),U=Array.isArray(f.variants)?[...f.variants]:[],H={...U[b]||{},options:Array.isArray((V=U[b])==null?void 0:V.options)?[...U[b].options]:[]};return H.options=H.options.map(me=>({label:String((me==null?void 0:me.label)||""),price:M,priceDigits:G})),U[b]=H,{...f,variants:U}})},ce=()=>{O(b=>{const f=$e(b.price),M=String(f),U=(Array.isArray(b.variants)?[...b.variants]:[]).map(H=>{const V=(Array.isArray(H==null?void 0:H.options)?H.options:[]).map(me=>({label:String((me==null?void 0:me.label)||""),price:f,priceDigits:M}));return{name:String((H==null?void 0:H.name)||"Bi\u1EBFn th\u1EC3"),options:V}});return{...b,variants:U}})},[_,Re]=React.useState(""),Ue=b=>window.KTM.money.formatVNDInputDigits(b),[qe,he]=React.useState(""),Ae=b=>{const f=window.KTM.money.nextPriceInputState(b.target.value,qe);he(f.digits),O({...T,price:f.price})},[re,Pe]=React.useState("");React.useEffect(()=>{w!=null&&w.image&&Pe(w.image)},[w]);const st=async b=>{if(!(!b||!b.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:b},"L\u1ED7i x\xF3a \u1EA3nh")}catch(f){console.error("Delete cloudinary image error:",f)}},bt=async(b,f=2,M)=>{const G=f*1024*1024,U=b.type==="image/heic"||b.type==="image/heif"||/\.heic$/i.test(b.name);if(b.size<=G&&!U)return b;M==null||M("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const H=await createImageBitmap(b);M==null||M("\u0110ang n\xE9n \u1EA3nh...");const V=document.createElement("canvas");let me=H.width,p=H.height;const y=1200;return(me>y||p>y)&&(me>p?(p=Math.round(p/me*y),me=y):(me=Math.round(me/p*y),p=y)),V.width=me,V.height=p,V.getContext("2d").drawImage(H,0,0,me,p),H.close(),new Promise((J,ae)=>{V.toBlob(ee=>{ee?(M==null||M("Ho\xE0n t\u1EA5t!"),J(new File([ee],b.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):ae(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(H){throw console.error("createImageBitmap error:",H),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Se=async b=>{var G,U;const f=(G=b.target.files)==null?void 0:G[0];if(!f)return;if(!(f.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(f.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}xe(!0),Re("\u0110ang chu\u1EA9n b\u1ECB...");try{const H=(f.size/1024/1024).toFixed(1);Re(`File ${H}MB - \u0110ang n\xE9n...`);const V=await bt(f,2,y=>{Re(y)}),me=(V.size/1024/1024).toFixed(1);Re(`\u0110\xE3 n\xE9n: ${me}MB - \u0110ang upload...`);const p=await window.KTM.cloudinary.uploadImage({file:V,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});p.secure_url?(T.image&&T.image!==re&&st(T.image),O(y=>({...y,image:p.secure_url})),Re("")):(console.error("Cloudinary error:",p),alert("Upload th\u1EA5t b\u1EA1i: "+(((U=p.error)==null?void 0:U.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Re(""))}catch(H){console.error("Upload error:",H),alert("L\u1ED7i: "+H.message),Re("")}xe(!1),b.target.value=""},Xe=()=>{T.image&&(T.image!==re&&st(T.image),O(b=>({...b,image:""})))},pt=async b=>{b.preventDefault(),oe(!0),re&&T.image&&re!==T.image&&await st(re),re&&!T.image&&await st(re),await P(T),oe(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${w?"fa-edit":"fa-plus-circle"} me-2`}),w?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:z})),React.createElement("form",{onSubmit:pt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},T.image?React.createElement(React.Fragment,null,React.createElement("img",{src:T.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Xe,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Z?"fa-spinner fa-spin":"fa-camera"} me-1`}),Z?_||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Se,disabled:Z,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Z&&_&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},_))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:T.name,onChange:b=>O({...T,name:b.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:T.code,onChange:b=>O({...T,code:b.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:T.price,onChange:Ae,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:T.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:b=>O({...T,commission_percent:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:T.category,onChange:b=>O({...T,category:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),C.map(b=>React.createElement("option",{key:b,value:b},b)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:T.note,onChange:b=>O({...T,note:b.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.attributes)?T.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(T.attributes)?T.attributes:[]).map((b,f)=>React.createElement("div",{key:f,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.key)||"",onChange:M=>{const G=M.target.value;O(U=>{const H=Array.isArray(U.attributes)?[...U.attributes]:[];return H[f]={...H[f]||{},key:G},{...U,attributes:H}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.value)||"",onChange:M=>{const G=M.target.value;O(U=>{const H=Array.isArray(U.attributes)?[...U.attributes]:[];return H[f]={...H[f]||{},value:G},{...U,attributes:H}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.unit)||"",onChange:M=>{const G=M.target.value;O(U=>{const H=Array.isArray(U.attributes)?[...U.attributes]:[];return H[f]={...H[f]||{},unit:G},{...U,attributes:H}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{O(M=>{const G=Array.isArray(M.attributes)?[...M.attributes]:[];return G.splice(f,1),{...M,attributes:G}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{O(b=>{const f=Array.isArray(b.attributes)?[...b.attributes]:[];return f.push({key:"",value:"",unit:""}),{...b,attributes:f}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.variants)?T.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(T.variants)?T.variants:[]).map((b,f)=>React.createElement("div",{key:f,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.name)||"",onChange:M=>{const G=M.target.value;O(U=>{var V;const H=Array.isArray(U.variants)?[...U.variants]:[];return H[f]={...H[f]||{},name:G,options:Array.isArray((V=H[f])==null?void 0:V.options)?H[f].options:[]},{...U,variants:H}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Ie(f),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(b==null?void 0:b.options)||b.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{O(M=>{const G=Array.isArray(M.variants)?[...M.variants]:[];return G.splice(f,1),{...M,variants:G}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(b==null?void 0:b.options)?b.options:[]).map((M,G)=>{var U,H;return React.createElement("div",{key:G,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.label)||"",onChange:V=>{const me=V.target.value;O(p=>{var ee,Ne,we,Be,it;const y=Array.isArray(p.variants)?[...p.variants]:[],D={...y[f]||{},options:Array.isArray((ee=y[f])==null?void 0:ee.options)?[...y[f].options]:[]},J=Number((we=(Ne=D.options[G])==null?void 0:Ne.price)!=null?we:0)||0,ae=String((it=(Be=D.options[G])==null?void 0:Be.priceDigits)!=null?it:Math.max(0,Math.trunc(J)));return D.options[G]={...D.options[G]||{},label:me,price:Math.max(0,Math.trunc(J)),priceDigits:ae},y[f]=D,{...p,variants:y}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Ue(String((H=M==null?void 0:M.priceDigits)!=null?H:window.KTM.money.getDigits(String((U=M==null?void 0:M.price)!=null?U:"")))),onChange:V=>{O(me=>{var we,Be,it,te,je;const p=String((Be=M==null?void 0:M.priceDigits)!=null?Be:window.KTM.money.getDigits(String((we=M==null?void 0:M.price)!=null?we:""))),y=window.KTM.money.nextPriceInputState(V.target.value,p),D=String((it=y.digits)!=null?it:""),J=Number(D),ae=Number.isFinite(J)?Math.max(0,Math.trunc(J)):0,ee=Array.isArray(me.variants)?[...me.variants]:[],Ne={...ee[f]||{},options:Array.isArray((te=ee[f])==null?void 0:te.options)?[...ee[f].options]:[]};return Ne.options[G]={...Ne.options[G]||{},label:String(((je=Ne.options[G])==null?void 0:je.label)||""),price:ae,priceDigits:D},ee[f]=Ne,{...me,variants:ee}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{O(V=>{var y;const me=Array.isArray(V.variants)?[...V.variants]:[],p={...me[f]||{},options:Array.isArray((y=me[f])==null?void 0:y.options)?[...me[f].options]:[]};return p.options.splice(G,1),me[f]=p,{...V,variants:me}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{O(M=>{var V;const G=Array.isArray(M.variants)?[...M.variants]:[],U={...G[f]||{},options:Array.isArray((V=G[f])==null?void 0:V.options)?[...G[f].options]:[]},H=$e(M.price);return U.options.push({label:"",price:H,priceDigits:String(H)}),G[f]=U,{...M,variants:G}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{O(b=>{const f=$e(b.price),M=Array.isArray(b.variants)?[...b.variants]:[],G=String(f);return M.push({name:"Size",options:[{label:"S",price:f,priceDigits:G},{label:"M",price:f,priceDigits:G},{label:"L",price:f,priceDigits:G}]}),{...b,variants:M}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ce,disabled:!Array.isArray(T.variants)||T.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:T.image,onChange:b=>O({...T,image:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:z,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:ie,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ie?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:N,video:w,onClose:C,onSave:z}){const[P,T]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[O,ie]=useState(!1),[oe,Z]=useState("");useEffect(()=>{w?(T({title:w.title||"",youtube_url:`https://www.youtube.com/watch?v=${w.youtubeId}`,thumbnail_url:w.thumb||"",sort_order:w.sortOrder||0}),Z(w.thumb)):(T({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Z(""))},[w,N]);const xe=be=>{const Ie=be.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Ie?Ie[1]:null},$e=be=>{T({...P,youtube_url:be});const Ie=xe(be);Ie&&Z(`https://img.youtube.com/vi/${Ie}/hqdefault.jpg`)},le=async be=>{be.preventDefault(),ie(!0),await z(P),ie(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:C})),React.createElement("form",{onSubmit:le},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:P.youtube_url,onChange:be=>$e(be.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),oe&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:oe,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:P.title,onChange:be=>T({...P,title:be.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sort_order,onChange:be=>T({...P,sort_order:parseInt(be.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:P.thumbnail_url,onChange:be=>T({...P,thumbnail_url:be.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:C},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[N,w]=useState(!1),[C,z]=useState(""),[P,T]=useState(null),[O,ie]=useState("search"),[oe,Z]=useState(()=>loadAdminPins()),[xe,$e]=useState(()=>loadAdminRecent()),[le,be]=useState(null),[Ie,ce]=useState(""),[_,Re]=useState([]),[Ue,qe]=useState(null),[he,Ae]=useState(!1),[re,Pe]=useState(null),[st,bt]=useState(!0),[Se,Xe]=useState([]),[pt,b]=useState(!1),[f,M]=useState(null),[G,U]=useState(!1),[H,V]=useState(!1),[me,p]=useState(""),[y,D]=useState(()=>loadAdminSettings()),[J,ae]=useState(null),[ee,Ne]=useState([]);useEffect(()=>{const c=localStorage.getItem("ktm_admin_session");if(c)try{const $=JSON.parse(c);$.expiry>Date.now()?(w(!0),T($.user)):localStorage.removeItem("ktm_admin_session")}catch($){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{N&&Oe()},[N]),useEffect(()=>{const c=()=>{try{const E=document.querySelector(".admin-topbar");if(!E)return;const ne=E.getBoundingClientRect(),ge=Math.max(0,Math.round(ne.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${ge+10}px`)}catch(E){}};c(),window.addEventListener("resize",c);const $=setTimeout(c,0);return()=>{clearTimeout($),window.removeEventListener("resize",c)}},[N,O]),useEffect(()=>{var E,ne;const c=window.visualViewport,$=()=>{try{const ge=Number(window.innerHeight)||0,K=Number(c==null?void 0:c.height)||ge,Je=Number(c==null?void 0:c.offsetTop)||0,Qe=Math.max(0,Math.round(ge-K-Je));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${Qe}px`)}catch(ge){}};$(),window.addEventListener("resize",$);try{(E=c==null?void 0:c.addEventListener)==null||E.call(c,"resize",$),(ne=c==null?void 0:c.addEventListener)==null||ne.call(c,"scroll",$)}catch(ge){}return()=>{var ge,K;window.removeEventListener("resize",$);try{(ge=c==null?void 0:c.removeEventListener)==null||ge.call(c,"resize",$),(K=c==null?void 0:c.removeEventListener)==null||K.call(c,"scroll",$)}catch(Je){}}},[]),useEffect(()=>{if(!N)return;const c=E=>{if(!E)return!1;const ne=String(E.tagName||"").toLowerCase();return!!(ne==="input"||ne==="textarea"||ne==="select"||E.isContentEditable)},$=E=>{if(!E||E.ctrlKey||E.metaKey||E.altKey||c(E.target))return;const ne=E.key;(ne==="/"||ne==="N"||ne==="n"||ne==="Escape"||ne==="j"||ne==="J"||ne==="k"||ne==="K")&&(ne==="/"&&E.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:ne}})))};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[N]),useEffect(()=>{N&&$e(c=>{const $=Array.isArray(c)?c:[],E=[O,...$.filter(ne=>ne!==O)].slice(0,8);return saveAdminRecent(E),E})},[N]);const we=c=>{const $=String(c||"").trim();$&&$e(E=>{const ne=Array.isArray(E)?E:[],ge=[$,...ne.filter(K=>K!==$)].slice(0,8);return saveAdminRecent(ge),ge})},Be=c=>{const $=String(c||"").trim();$&&Z(E=>{const ne=Array.isArray(E)?E:[],K=ne.includes($)?ne.filter(Je=>Je!==$):[$,...ne].slice(0,10);return saveAdminPins(K),K})};useEffect(()=>{if(!N)return;let c=!1;return(async()=>{try{const $=await fetchAdminSettingsFromServer();if(c)return;D($),saveAdminSettings($)}catch($){}})(),()=>{c=!0}},[N]);const it=async(c,$)=>{z("");try{const E=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:c,password:$},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),ne={user:E.user,token:E.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(ne)),T(E.user),w(!0)}catch(E){z(E.message)}},te=()=>{localStorage.removeItem("ktm_admin_session"),w(!1),T(null),Re([]),qe(null)},je=(c,$="success",E=null)=>{const ne=Date.now()+Math.floor(Math.random()*1e3);if(c&&typeof c=="object"){const K=c;Xe(Je=>[...Je,{id:ne,message:String(K.message||""),type:String(K.type||$||"success"),actionLabel:K.actionLabel||null,onAction:typeof K.onAction=="function"?K.onAction:null,durationMs:K.durationMs||null}]);return}const ge=E&&typeof E=="object"?E:null;Xe(K=>[...K,{id:ne,message:String(c||""),type:String($||"success"),actionLabel:(ge==null?void 0:ge.actionLabel)||null,onAction:typeof(ge==null?void 0:ge.onAction)=="function"?ge.onAction:null,durationMs:(ge==null?void 0:ge.durationMs)||null}])},mt=c=>{Xe($=>$.filter(E=>E.id!==c))},Oe=async(c=null)=>{bt(!0);try{const $=c?`${API_BASE}/api/albums?parent_id=${c}`:`${API_BASE}/api/albums?parent_id=root`,E=await window.KTM.api.getJSON($,"L\u1ED7i t\u1EA3i danh s\xE1ch album");Re(Array.isArray(E)?E:[])}catch($){console.error($),je("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}bt(!1)},ot=()=>{Pe(null),Ae(!0)},gt=c=>{Le(c),U(!0)},Lt=async(c,$="modal")=>{try{const E=re&&re.uuid;!E&&J&&(c.parent_id=J.uuid);const ne=E?`${API_BASE}/api/albums/${re.uuid||re.id}`:`${API_BASE}/api/albums`;E?await window.KTM.api.putJSON(ne,c,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(ne,c,"L\u1ED7i t\u1EA1o"),je(E?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),$==="drawer"?(U(!1),Pe(null),Oe(J==null?void 0:J.uuid),E&&f&&M({...f,...c})):(Ae(!1),Pe(null),Oe(J==null?void 0:J.uuid))}catch(E){je(E.message,"danger")}},Ct=c=>{qe(c)},v=c=>{if(c==="root")Ne([]),ae(null),Oe(null);else if(c){const $=ee.findIndex(E=>E.uuid===c.uuid);$>=0&&(Ne(ee.slice(0,$+1)),ae(c),Oe(c.uuid))}else{const $=[...ee];$.pop();const E=$[$.length-1]||null;Ne($),ae(E),Oe(E==null?void 0:E.uuid)}},R=async c=>{const $=`X\xF3a folder "${c.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm($))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${c.uuid||c.id}`,"L\u1ED7i x\xF3a album"),je("\u0110\xE3 x\xF3a","success"),Oe(J==null?void 0:J.uuid)}catch(E){je("L\u1ED7i x\xF3a album","danger")}},Le=async c=>{c&&(b(!0),p(""),V(!1),U(!1),M(c))},lt=()=>{b(!1),V(!1),p(""),U(!1),M(null)},Mt=c=>{U(!0)};if(!N)return React.createElement(LoginPage,{onLogin:it,error:C});const Ye=()=>{const c=new Date,$=c.getFullYear(),E=String(c.getMonth()+1).padStart(2,"0");return`${$}-${E}`};function vt(){const[c,$]=useState(()=>{var K;return String((K=y==null?void 0:y.ship_percent)!=null?K:DEFAULT_SHIP_PERCENT)}),[E,ne]=useState(!1);return useEffect(()=>{var K;$(String((K=y==null?void 0:y.ship_percent)!=null?K:DEFAULT_SHIP_PERCENT))},[y==null?void 0:y.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async K=>{K.preventDefault(),ne(!0);const Je=saveAdminSettings({ship_percent:c});try{const Qe=await saveAdminSettingsToServer(Je);D(Qe),saveAdminSettings(Qe),je("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Qe){D(Je),je("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{ne(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:c,min:"0",max:"100",step:"0.01",onChange:K=>$(K.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:E},E?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function x(){const[c,$]=useState(Ye()),[E,ne]=useState(!0),ge=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[K,Je]=useState(ge),Qe=useRef(new Map),Dt=normalizeShipPercent(y==null?void 0:y.ship_percent),{formatNumber:ke,formatVND:ut}=window.KTM.money,Zt=async(fe,Rt=!1)=>{var L,h;const Gt=String(fe||"").trim();if(!Gt)return ge();const kt=`${Gt}|${Dt}`,r=(L=Qe.current)==null?void 0:L.get(kt);if(!Rt&&r)return r;const A=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(Gt)}&ship_percent=${encodeURIComponent(Dt)}`,j=await window.KTM.api.getJSON(A,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Y=j!=null&&j.stats&&(j!=null&&j.meta)?j.stats:j,se=Y&&typeof Y=="object"?Y:ge();return(h=Qe.current)==null||h.set(kt,se),se},Tt=async(fe=!1)=>{ne(!0);try{const Rt=await Zt(c,fe);Je(Rt)}catch(Rt){console.error("Load stats error:",Rt),Je(ge())}finally{ne(!1)}};return useEffect(()=>{Tt()},[c,Dt]),React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:E}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>Tt(!0),disabled:E},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:c,onChange:fe=>$(fe.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",Dt,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),ke(K.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),ke(K.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),ke(K.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",ke(K.statusCounts.paid),"/",ke(K.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ke(K.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ut(K.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ut(K.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ut(K.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ut(K.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",K.avgQtyPerOrder?K.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},ke(K.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},ke(K.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},ke(K.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},ke(K.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},ke(K.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},ke(K.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},ke(K.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,ke(K.statusCounts.draft)),React.createElement("td",null,ke(K.statusCounts.pending)),React.createElement("td",null,ke(K.statusCounts.processing)),React.createElement("td",null,ke(K.statusCounts.canceled)),React.createElement("td",null,ke(K.statusCounts.done)),React.createElement("td",null,ke(K.statusCounts.paid)),React.createElement("td",null,ke(K.statusCounts.other)),React.createElement("td",null,ke(K.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},K.products.slice(0,10).map(fe=>React.createElement("div",{key:fe.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},fe.product_name),React.createElement("div",{className:"text-muted small text-truncate"},fe.product_code?`#${fe.product_code} \u2022 `:"",ke(fe.orders)," \u0111\u01A1n \u2022 ",ke(fe.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},ut(fe.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,K.products.slice(0,10).map(fe=>React.createElement("tr",{key:fe.product_id},React.createElement("td",null,fe.product_name),React.createElement("td",null,fe.product_code||"\u2014"),React.createElement("td",null,ke(fe.orders)),React.createElement("td",null,ke(fe.quantity)),React.createElement("td",{className:"fw-semibold"},ut(fe.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},K.customers.slice(0,10).map(fe=>React.createElement("div",{key:fe.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},fe.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},fe.phone||"\u2014"," \u2022 ",ke(fe.orders)," \u0111\u01A1n \u2022 ",ke(fe.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},ut(fe.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,K.customers.slice(0,10).map(fe=>React.createElement("tr",{key:fe.key},React.createElement("td",null,fe.customer_name||"\u2014"),React.createElement("td",null,fe.phone||"\u2014"),React.createElement("td",null,ke(fe.orders)),React.createElement("td",null,ke(fe.quantity)),React.createElement("td",{className:"fw-semibold"},ut(fe.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},K.days.map(fe=>React.createElement("div",{key:fe.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},fe.day),React.createElement("div",{className:"text-muted small"},ke(fe.orders)," \u0111\u01A1n \u2022 ",ke(fe.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",ke(fe.doneOrders)," \u2022 ",ut(fe.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},ut(fe.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,K.days.map(fe=>React.createElement("tr",{key:fe.day},React.createElement("td",null,fe.day),React.createElement("td",null,ke(fe.orders)),React.createElement("td",null,ke(fe.quantity)),React.createElement("td",{className:"fw-semibold"},ut(fe.revenue)),React.createElement("td",null,ke(fe.doneOrders)),React.createElement("td",{className:"fw-semibold"},ut(fe.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:O,onMenuChange:c=>{we(c),ie(c),c==="albums"&&(ae(null),Ne([]),Oe(null))},onLogout:te,currentUser:P,pinnedMenus:oe,recentMenus:xe,onTogglePin:Be}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const $={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[O]||{title:"KTM Admin",icon:"fa-tractor",sub:""},E=(P==null?void 0:P.username)||(P==null?void 0:P.name)||(P==null?void 0:P.email)||"Admin",ne=(()=>{if(O!=="albums")return"";const ge=[];return ge.push("Root"),Array.isArray(ee)&&ee.length>0&&ge.push(...ee.map(K=>K==null?void 0:K.title).filter(Boolean)),Ue!=null&&Ue.title&&ge.push(Ue.title),ge.length>0?ge.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${$.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},$.title),React.createElement("div",{className:"admin-page-subtitle"},ne||$.sub))),React.createElement("div",{className:"admin-topbar-right"},O==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:ot,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:E},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},E)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:te,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},O==="albums"&&!Ue&&React.createElement(AlbumList,{albums:_,loading:st,currentFolder:J,breadcrumb:ee,onSelect:Ct,onCreate:ot,onEdit:gt,onDelete:R,onBack:v}),O==="search"&&React.createElement(SearchCenter,{showToast:je,onNavigate:(c,$,E)=>{ie(c),c==="orders"&&$==="create"&&(be(Date.now()),ce((E==null?void 0:E.productId)||""))}}),O==="albums"&&Ue&&React.createElement(AlbumDetail,{album:Ue,parentAlbum:ee.length>0?ee[ee.length-1]:null,onBack:()=>{if(Ue.parentId){const c=ee.findIndex($=>$.uuid===Ue.parentId);c>=0?qe(ee[c]):qe(null)}else qe(null)},onRefresh:()=>Oe(J==null?void 0:J.uuid),showToast:je,onNavigateToFolder:c=>{Ne($=>[...$,Ue]),qe(c)},onEditSubfolder:c=>{Pe(c),Ae(!0)}}),O==="videos"&&React.createElement(VideoList,{showToast:je}),O==="products"&&React.createElement(ProductManager,{showToast:je,settings:y}),O==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:le,autoOpenCreateProductId:Ie,showToast:je}),O==="stats"&&React.createElement(x,null),O==="settings"&&React.createElement(vt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${O==="search"?"active":""}`,onClick:c=>{c.preventDefault(),ie("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${O==="albums"?"active":""}`,onClick:c=>{c.preventDefault(),ie("albums"),qe(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${O==="videos"?"active":""}`,onClick:c=>{c.preventDefault(),ie("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${O==="products"?"active":""}`,onClick:c=>{c.preventDefault(),ie("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${O==="orders"?"active":""}`,onClick:c=>{c.preventDefault(),ie("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${O==="stats"?"active":""}`,onClick:c=>{c.preventDefault(),ie("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:he,album:re,parentId:J==null?void 0:J.uuid,onClose:()=>Ae(!1),onSave:Lt}),React.createElement(AdminDrawer,{open:pt,title:f?f.title:"Album",subtitle:f?`${f.subfolderCount||0} subfolder \u2022 ${f.count||0} \u1EA3nh`:"",onClose:lt,footer:G?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{U(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{f&&(Pe(f),Lt({slug:f.id||"",title:f.title||"",description:f.description||"",cover_url:f.cover||"",parent_id:f.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):f?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(f.title),je("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>Mt(f)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{f&&confirm(`X\xF3a folder "${f.title}"?`)&&(R(f),lt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},G&&f?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:f.title,onChange:c=>M({...f,title:c.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:f.description,onChange:c=>M({...f,description:c.target.value})}))):f?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},f.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},f.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},f.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},f.count||0))),f.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,f.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Se.map(c=>React.createElement(Toast,{key:c.id,message:c.message,type:c.type,actionLabel:c.actionLabel,onAction:c.onAction,durationMs:c.durationMs,onClose:()=>mt(c.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:N,autoOpenCreateProductId:w,showToast:C}){const[z,P]=useState([]),[T,O]=useState(0),[ie,oe]=useState(!1),[Z,xe]=useState(!1),[$e,le]=useState([]),[be,Ie]=useState(!0),[ce,_]=useState(!1),[Re,Ue]=useState([]),[qe,he]=useState(!1),[Ae,re]=useState(""),[Pe,st]=useState([]),[bt,Se]=useState(!1),[Xe,pt]=useState(""),[b,f]=useState(!1),[M,G]=useState(null),[U,H]=useState(null),[V,me]=useState(!1),[p,y]=useState(()=>{const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${t}-${a}`}),[D,J]=useState(""),[ae,ee]=useState(!1),[Ne,we]=useState(!1),[Be,it]=useState(!1),[te,je]=useState(null),[mt,Oe]=useState(!1),[ot,gt]=useState(""),[Lt,Ct]=useState(!1),v=useRef(0),[R,Le]=useState(!1),[lt,Mt]=useState(null),[Ye,vt]=useState(!1),[x,c]=useState(null),[$,E]=useState(()=>({left:12,top:12,placement:"bottom"})),ne=useRef(null),ge=useRef(!1),K=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null}),[Je,Qe]=useState(()=>({id:null,dir:null})),Dt=useRef(new Map),ke=useRef(null),ut=useRef(null),Zt="ktm_orders_status_sync_queue_v1",Tt=useRef([]),fe=useRef(!1),[Rt,Gt]=useState(()=>({})),[kt,r]=useState(!1),[A,j]=useState(!1),[Y,se]=useState(!1),[L,h]=useState(()=>new Set),[Q,ve]=useState(()=>({})),ue="ktm_orders_pinned_v1",[X,_e]=useState(()=>new Set),[Ze,He]=useState(!1),[ct,Nt]=useState(!1),[wt,At]=useState(!1),[Et,Jt]=useState(""),[ja,ca]=useState(()=>[]),Va=useRef(null),qt=useRef(null),ya=useRef(!1),ta=useRef({active:!1,startY:0,startX:0,fired:!1}),[I,F]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),W=24,de=20,[ye,pe]=useState(W),Ee=useRef(null),De=useRef(null),et=useRef(!1),ft=useRef(new Map),yt=useRef({timer:null,events:[]}),xt=useRef(null),It="ktm_orders_phone_tip_v1",jt="ktm_orders_search_history_v1",[Ke,St]=useState(null),[Ot,ht]=useState(!1),[Pt,Wt]=useState([]),[bn,Na]=useState(!1),[wa,Kt]=useState([]),[S,Ge]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[fn,aa]=useState([""]),[Oa,na]=useState(null),hn=useRef({}),[Ft,Ln]=useState([]),[tt,sa]=useState(null),Dn=useRef(null),da=useRef(null),gn=useRef(0),Ut=useRef(null),qa=useRef(0),Rn=useRef(new Map),ma=useRef(null),Ba=useRef(0),En=useRef(new Map),xa=useRef(new Map),ka=useRef(""),Pn=useRef(null),vn=useRef(null),yn=useRef(0),ws=useRef(null),Kn=9,xs=150,ks=250,Ss=3*60*1e3,Cs=24*60*60*1e3,As=5*60*1e3,Fn="ktm_customer_lookup_cache_v1",_s=200,ia=3,za=3,Nn=1,Ms=24*60*60*1e3,Ts=120,$s=5*60*1e3,Hn=80,Vn=2,qn=4,Bn=60,Ce=React.useMemo(()=>String(Ae||"").trim().length>0,[Ae]),Ga=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),zn=e=>{Mt(e),Le(!0)},Gn=(e,t)=>{var a,n,s,i;try{const d=(a=t==null?void 0:t.getBoundingClientRect)==null?void 0:a.call(t),o=window.innerWidth||360,g=window.innerHeight||640,m=230,l=280,u=Math.min(Math.max(10,Math.round((n=d==null?void 0:d.left)!=null?n:10)),Math.max(10,o-m-10));let k=Math.round(((s=d==null?void 0:d.bottom)!=null?s:10)+8),B="bottom";k+l>g-10&&(k=Math.max(10,Math.round(((i=d==null?void 0:d.top)!=null?i:10)-8-l)),B="top"),E({left:u,top:k,placement:B})}catch(d){E({left:12,top:12,placement:"bottom"})}c(e),vt(!0)},ua=()=>{vt(!1),setTimeout(()=>c(null),120)};useEffect(()=>{if(!Ye)return;const e=t=>{t.key==="Escape"&&ua()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Ye]);const pa=()=>{Le(!1),setTimeout(()=>Mt(null),180)},Is=()=>{r(!0)},Ja=()=>{r(!1)},Jn=e=>{const t=String(e||"").trim();t&&h(a=>{const n=new Set(a);return n.has(t)?n.delete(t):n.add(t),n})};useEffect(()=>{try{const e=localStorage.getItem(ue);if(!e)return;const t=JSON.parse(e);if(!Array.isArray(t))return;_e(new Set(t.map(a=>String(a||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from(X||[]).map(t=>String(t||"").trim()).filter(Boolean);localStorage.setItem(ue,JSON.stringify(e))}catch(e){}},[X]);const js=e=>{const t=String(e||"").trim();t&&_e(a=>{const n=new Set(a);return n.has(t)?n.delete(t):n.add(t),n})};useEffect(()=>{try{const e=localStorage.getItem(jt);if(!e)return;const t=JSON.parse(e);if(!Array.isArray(t))return;ca(t.map(a=>String(a||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Os=e=>{try{localStorage.setItem(jt,JSON.stringify(e))}catch(t){}},La=e=>{const t=String(e||"").trim();t&&ca(a=>{const n=Array.isArray(a)?a:[],s=[t,...n.filter(i=>String(i||"").trim().toLowerCase()!==t.toLowerCase())].slice(0,10);return Os(s),s})},Wn=e=>{var a;const t=String((a=e!=null?e:Ae)!=null?a:"").trim();Jt(t),At(!0),setTimeout(()=>{var n,s;try{(s=(n=Va.current)==null?void 0:n.focus)==null||s.call(n)}catch(i){}},0)},Bt=()=>{At(!1)};useEffect(()=>{if(!wt)return;const e=t=>{t.key==="Escape"&&Bt()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[wt]),useEffect(()=>{if(!I)return;const e=n=>{if(wt||(window.scrollY||0)>6)return;const s=n.touches&&n.touches[0];s&&(ta.current={active:!0,startY:s.clientY,startX:s.clientX,fired:!1})},t=n=>{const s=ta.current;if(!(s!=null&&s.active)||s.fired||(window.scrollY||0)>6)return;const i=n.touches&&n.touches[0];if(!i)return;const d=i.clientY-s.startY,o=i.clientX-s.startX;Math.abs(o)>24||d>92&&(s.fired=!0,Wn(Ae))},a=()=>{ta.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",t,{passive:!0}),window.addEventListener("touchend",a,{passive:!0}),window.addEventListener("touchcancel",a,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)}},[I,wt,Ae]);const Un=e=>{try{const t=$t(e==null?void 0:e.status);if(!(t==="pending"||t==="processing"))return!1;const a=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(a.getTime()))return!1;const n=new Date;return a.getFullYear()===n.getFullYear()&&a.getMonth()===n.getMonth()&&a.getDate()===n.getDate()}catch(t){return!1}};useEffect(()=>{var a;let e;const t=()=>{try{F(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(n){F(!1)}};try{e=(a=window.matchMedia)==null?void 0:a.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",t):e!=null&&e.addListener&&e.addListener(t)}catch(n){e=null}return window.addEventListener("resize",t),t(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",t):e!=null&&e.removeListener&&e.removeListener(t)}catch(n){}window.removeEventListener("resize",t)}},[]),useEffect(()=>{const e="admin-sheet-open";return R||kt||Ye?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[R,kt,Ye]),useEffect(()=>{if(!R&&!kt&&!Ye)return;const e=t=>{t.key==="Escape"&&(R&&pa(),kt&&Ja(),Ye&&ua())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[R,kt,Ye]);const Ls=()=>{try{if(localStorage.getItem(It))return;localStorage.setItem(It,"1"),typeof C=="function"&&C("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},Xn=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),Yn=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),Qn=e=>{const t=nt(String(e||"")).replace(/[^0-9+]/g,"");if(t)try{window.location.href=`tel:${t}`}catch(a){}},Ds=async e=>{var a,n,s;const t=nt(String(e||"")).replace(/[^0-9+]/g,"");if(t)try{await((s=(n=(a=navigator.clipboard)==null?void 0:a.writeText)==null?void 0:n.call(a,t))!=null?s:Promise.reject(new Error("Clipboard not available"))),typeof C=="function"&&C("\u0110\xE3 copy S\u0110T","success")}catch(i){typeof C=="function"&&C("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Rs=()=>{try{const e=localStorage.getItem(Zt),t=e?JSON.parse(e):[];return Array.isArray(t)?t:[]}catch(e){return[]}},Zn=e=>{try{localStorage.setItem(Zt,JSON.stringify(Array.isArray(e)?e:[]))}catch(t){}},Wa=(e,t)=>{const a=String(e||"").trim();a&&Gt(n=>{const s={...n||{}};return t?s[a]=!0:delete s[a],s})},Es=(e,t,a)=>{const n=String(e||"").trim(),s=$t(t),i=$t(a);if(!n||!s)return;const d=Array.isArray(Tt.current)?Tt.current:[],o=new Map(d.map(m=>[String((m==null?void 0:m.orderId)||""),m]));o.set(n,{orderId:n,nextStatus:s,prevStatus:i,ts:Date.now()});const g=Array.from(o.values()).sort((m,l)=>(Number(m.ts)||0)-(Number(l.ts)||0));Tt.current=g,Zn(g),Wa(n,!0)},wn=async()=>{if(fe.current||!navigator.onLine)return;const e=Array.isArray(Tt.current)?Tt.current.slice():[];if(e.length){fe.current=!0;try{for(const t of e){const a=String((t==null?void 0:t.orderId)||"").trim(),n=$t(t==null?void 0:t.nextStatus);if(!(!a||!n)){Wa(a,!0);try{await ga({id:a,status:(t==null?void 0:t.prevStatus)||""},n,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const s=(Array.isArray(Tt.current)?Tt.current:[]).filter(i=>String((i==null?void 0:i.orderId)||"")!==a);Tt.current=s,Zn(s),Wa(a,!1)}catch(s){if(!navigator.onLine)break}}}}finally{fe.current=!1}}};useEffect(()=>{const e=Rs();Tt.current=e;try{const t={};for(const a of e){const n=String((a==null?void 0:a.orderId)||"").trim();n&&(t[n]=!0)}Gt(t)}catch(t){}setTimeout(()=>wn(),600)},[]),useEffect(()=>{const e=()=>wn();window.addEventListener("online",e);const t=setInterval(()=>wn(),8e3);return()=>{clearInterval(t),window.removeEventListener("online",e)}},[]);const Ps=(e,t)=>{var a;(a=e==null?void 0:e.stopPropagation)==null||a.call(e),et.current=!1,Ls();try{De.current&&clearTimeout(De.current)}catch(n){}De.current=setTimeout(()=>{et.current=!0,Ds(t)},520)},Ua=e=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e);try{De.current&&clearTimeout(De.current)}catch(a){}De.current=null},Ks=e=>{const t=String(e||"").trim();if(!t)return;ve(s=>({...s,[t]:Date.now()}));const a=ft.current;try{const s=a.get(t);s&&clearTimeout(s)}catch(s){}const n=setTimeout(()=>{ve(s=>{const i={...s||{}};return delete i[t],i});try{a.delete(t)}catch(s){}},9e3);a.set(t,n)},es=e=>String(e||"").replace(/\s+/g," ").trim(),Fs=e=>String(e||"").replace(/[^0-9]+/g,""),Da=e=>{try{const t=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(t))return 0;const a=Date.now()-t;return!Number.isFinite(a)||a<=0?0:Math.floor(a/Ms)}catch(t){return 0}},Xa=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:Da(e)>=ia,$t=e=>{const t=String(e!=null?e:"").trim().toLowerCase();return t==="cancelled"?"canceled":t},Ya=e=>{if($t(e==null?void 0:e.status)!=="draft")return null;const a=za-Da(e);return Number.isFinite(a)?a:null},Qa=e=>{const t=Ya(e);return Number.isFinite(t)?t>0&&t<=Nn:!1},ba=e=>{Ge({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),aa([""]),St(null),na(null)};useEffect(()=>{const e=t=>{var n;if(Oa==null)return;const a=(n=hn.current)==null?void 0:n[Oa];a&&!a.contains(t.target)&&na(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Oa]);const ts=e=>window.KTM.money.parseMoney(e),as=e=>window.KTM.money.parseSignedMoney(e),We=e=>window.KTM.money.formatVND(e),Xt=e=>{const a=(Array.isArray(e)?e:[]).map(n=>{var s,i;return{amount:String((s=n==null?void 0:n.amount)!=null?s:""),note:String((i=n==null?void 0:n.note)!=null?i:"")}});return a.length?a:[{amount:"",note:""}]},Hs=e=>{try{const t=window.KTM.orders.getOrderAdjustmentItems(e),a=(Array.isArray(t)?t:[]).map(n=>{var s,i;return{amount:(n==null?void 0:n.amount)===0?"":String((s=n==null?void 0:n.amount)!=null?s:""),note:String((i=n==null?void 0:n.note)!=null?i:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return a.length?a:[{amount:"",note:""}]}catch(t){return[{amount:"",note:""}]}},Sa=e=>(Array.isArray(e)?e:[]).map(a=>({amount:as(a==null?void 0:a.amount),note:String((a==null?void 0:a.note)||"").trim()})).filter(a=>a.amount!==0||!!a.note),xn=e=>{const t=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],a=Sa(t),n=Ca(a),s=(()=>{if(!a.length)return"";const i=a.map(d=>String((d==null?void 0:d.note)||"").trim()).filter(Boolean);return i.length?i.join(" \u2022 "):a.length>1?`${a.length} m\u1EE5c`:""})();return{cleanAdjItems:a,amount:n,summaryText:s}},Ca=e=>(Array.isArray(e)?e:[]).reduce((a,n)=>a+(Number(n==null?void 0:n.amount)||0),0),kn=e=>{const t=Array.isArray(e)?e:[];return t.length?JSON.stringify(t):""},di=e=>window.KTM.money.parseShipFeeFromNote(e),Aa=e=>window.KTM.phone.isValid(e),nt=e=>window.KTM.phone.normalize(e),Sn=async e=>{if(!e)return null;const t=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return t&&typeof t=="object"&&t.order&&typeof t.order=="object"?t.order:t},Vs=(e,t)=>{var i;const a=Array.isArray(e)?e:[],n=Array.isArray(t)?t:[];if(!a.length)return n;if(!n.length)return a;const s=new Map(a.map(d=>{var o;return[String((o=d==null?void 0:d.id)!=null?o:""),d]}));for(const d of n){const o=String((i=d==null?void 0:d.id)!=null?i:"");o&&s.set(o,d)}return Array.from(s.values())},Za=async e=>{var t,a,n,s;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const i=(a=(t=Dt.current)==null?void 0:t.get)==null?void 0:a.call(t,String(e.id));if(i&&typeof i=="object"&&Array.isArray(i.items)&&i.items.length)return i}catch(i){}try{const i=await Sn(e.id);if(i&&typeof i=="object"){try{(s=(n=Dt.current)==null?void 0:n.set)==null||s.call(n,String(e.id),i)}catch(d){}return P(d=>Array.isArray(d)?d.map(o=>String(o==null?void 0:o.id)===String(e.id)?i:o):d),i}}catch(i){console.error("Fetch order by id error:",i)}return e},qs=()=>{var e;try{const t=localStorage.getItem(Fn);if(!t)return;const a=JSON.parse(t);if(!a||typeof a!="object")return;const n=Object.entries(a);for(const[s,i]of n)!s||!i||typeof i!="object"||(e=xa.current)==null||e.set(String(s),i)}catch(t){}},Cn=()=>{try{const e=xa.current;if(!e||typeof e.entries!="function")return;const t=Array.from(e.entries()).filter(([n,s])=>n&&s&&typeof s=="object"&&Number.isFinite(s.ts)).sort((n,s)=>(Number(s[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,_s),a={};for(const[n,s]of t)a[n]=s;localStorage.setItem(Fn,JSON.stringify(a))}catch(e){}};useEffect(()=>{qs()},[]);const ns=e=>{const t=nt(e);if(!t)return null;const a=Array.isArray(z)?z:[];let n=null,s=-1;for(const i of a){if(!i||nt(i.phone||"")!==t)continue;const d=new Date(i.created_at).getTime(),o=Number.isFinite(d)?d:0;o>=s&&(s=o,n=i)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},ss=(e,t)=>{e&&Ge(a=>t&&nt(a.phone)!==t?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},Bs=e=>{const t=ns(e);if(!t)return;const a=nt(e);Ge(n=>{if(a&&nt(n.phone)!==a)return n;const s={...n};return!String(n.customer_name||"").trim()&&t.name&&(s.customer_name=t.name),!String(n.address||"").trim()&&t.address&&(s.address=t.address),s})},zs=(e,t,a)=>{var n;try{const s=nt(e);if(!s)return;const i=String(t||"").trim(),d=String(a||"").trim();if(!i&&!d)return;(n=xa.current)==null||n.set(s,{ts:Date.now(),status:"found",customer:{phone:s,name:i||null,address:d||null}}),Cn()}catch(s){}},en=async e=>{var s,i,d;const t=nt(e);if(!t)return;Bs(t);const a=(s=xa.current)==null?void 0:s.get(t);if(a&&Number.isFinite(a.ts)){const o=Date.now()-a.ts,g=a.status==="found"?Cs:As;if(o>=0&&o<=g){St({status:a.status,phone:t,customer:a.customer}),a.status==="found"&&a.customer&&ss(a.customer,t);return}}const n=++gn.current;St({status:"loading",phone:t});try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(t)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(gn.current!==n)return;if(o&&o.exists&&o.customer){(i=xa.current)==null||i.set(t,{ts:Date.now(),status:"found",customer:o.customer}),Cn(),St({status:"found",phone:t,customer:o.customer}),ss(o.customer,t);return}(d=xa.current)==null||d.set(t,{ts:Date.now(),status:"not-found",customer:null}),Cn(),St({status:"not-found",phone:t})}catch(o){if(gn.current!==n)return;console.error("Customer lookup error:",o),St({status:"error",phone:t})}},is=e=>{const t=nt(e),a=ns(t);Ge(s=>{const i={...s,phone:t};return a&&(!String(s.customer_name||"").trim()&&a.name&&(i.customer_name=a.name),!String(s.address||"").trim()&&a.address&&(i.address=a.address)),i}),ht(!1),da.current&&(clearTimeout(da.current),da.current=null);const n=t;if(n.length<Kn){St(null);return}if(Aa(n)&&n!==ka.current){ka.current=n,en(n);return}da.current=setTimeout(()=>{const s=nt(t);Aa(s)&&s!==ka.current&&(ka.current=s,en(s))},xs)},rs=()=>{const e=nt(S.phone);e.length<Kn||Aa(e)&&e!==ka.current&&(ka.current=e,en(e))};useEffect(()=>(Ne?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Ne]);const tn=Array.isArray(S.items)?S.items.length:0;useEffect(()=>{if(!Ne){yn.current=tn;return}tn>yn.current&&setTimeout(()=>{const e=Pn.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),yn.current=tn},[Ne,tn]),useEffect(()=>()=>{da.current&&(clearTimeout(da.current),da.current=null),Ut.current&&(clearTimeout(Ut.current),Ut.current=null)},[]),useEffect(()=>{if(!Ne)return;Ut.current&&(clearTimeout(Ut.current),Ut.current=null);const e=nt((S==null?void 0:S.phone)||"");if(!Aa(e)){Wt([]),Na(!1);return}return Ut.current=setTimeout(async()=>{var s;const t=String(e),a=(s=Rn.current)==null?void 0:s.get(t);if(a&&Number.isFinite(a.ts)&&Date.now()-a.ts<=Ss){Wt(Array.isArray(a.orders)?a.orders:[]),Na(!1);return}const n=++qa.current;Na(!0);try{const i=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,d=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(qa.current!==n)return;const o=Array.isArray(d)?d:Array.isArray(d==null?void 0:d.orders)?d.orders:[];Wt(o);try{const g=Rn.current;if(g&&typeof g.set=="function"&&(g.set(t,{ts:Date.now(),orders:o}),g.size>100)){const m=Array.from(g.entries()).sort((u,k)=>{var B,q;return(Number((B=u==null?void 0:u[1])==null?void 0:B.ts)||0)-(Number((q=k==null?void 0:k[1])==null?void 0:q.ts)||0)}),l=Math.max(0,m.length-100);for(let u=0;u<l;u++)g.delete(m[u][0])}}catch(g){}}catch(i){if(qa.current!==n)return;console.error("Phone history fetch error:",i),Wt([])}finally{if(qa.current!==n)return;Na(!1)}},ks),()=>{Ut.current&&(clearTimeout(Ut.current),Ut.current=null)}},[Ne,S==null?void 0:S.phone]),useEffect(()=>{Ws()},[]),useEffect(()=>{Ce||fa()},[p,Ce]),useEffect(()=>{sn()},[]),useEffect(()=>{N&&Dn.current!==N&&(Dn.current=N,rn(w))},[N]);const zt=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",_a=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",ra=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(z),t=X;if(!t||!(t instanceof Set)||t.size===0)return e;const a=Array.isArray(e)?e.slice():[];return a.sort((n,s)=>{var o,g;const i=t.has(String((o=n==null?void 0:n.id)!=null?o:""))?1:0;return(t.has(String((g=s==null?void 0:s.id)!=null?g:""))?1:0)-i}),a},[z,X]),An=React.useMemo(()=>window.KTM.orders.sortOrders($e),[$e]),an=React.useMemo(()=>{const t=(Array.isArray(An)?An:[]).filter(a=>Xa(a));return t.sort((a,n)=>{const s=new Date(a==null?void 0:a.created_at).getTime(),i=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(s)?s:0)-(Number.isFinite(i)?i:0)}),t},[An]),os=React.useMemo(()=>{const t=(Array.isArray(Re)?Re:[]).filter(a=>Qa(a));return t.sort((a,n)=>{const s=new Date(a==null?void 0:a.created_at).getTime(),i=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(s)?s:0)-(Number.isFinite(i)?i:0)}),t},[Re]),Ra=React.useMemo(()=>{if(ae)return an;let e=ra;if(Ze){const t=X;e=(Array.isArray(e)?e:[]).filter(a=>{var n,s;return(s=t==null?void 0:t.has)==null?void 0:s.call(t,String((n=a==null?void 0:a.id)!=null?n:""))})}return ct&&(e=(Array.isArray(e)?e:[]).filter(t=>Un(t))),e},[ae,an,ra,Ze,X,ct]),nn=React.useMemo(()=>{if(ae)return Ra;const e=String(D||"").trim();return e?(Array.isArray(Ra)?Ra:[]).filter(t=>String((t==null?void 0:t.status)||"").trim()===e):Ra},[Ra,D,ae]),ls=React.useMemo(()=>window.KTM.orders.sortOrders(Pe),[Pe]),dt=React.useMemo(()=>Ce?ls:nn,[nn,Ce,ls]),cs=React.useMemo(()=>{const e=Array.isArray(dt)?dt:[];return I?e.slice(0,Math.max(0,Number(ye)||0)):e},[I,ye,dt]);useEffect(()=>{I&&pe(W)},[I,D,ae,p,Ae]),useEffect(()=>{if(!I)return;const e=Array.isArray(dt)?dt.length:0;if(ye>=e)return;const t=Ee.current;if(!t)return;const a=new IntersectionObserver(n=>{Array.isArray(n)&&n.some(i=>i==null?void 0:i.isIntersecting)&&pe(i=>Math.min((Number(i)||0)+de,e))},{root:null,rootMargin:"520px 0px",threshold:0});return a.observe(t),()=>a.disconnect()},[I,ye,dt]),useEffect(()=>{if(!I){j(!1),se(!1);return}const e=()=>{xt.current||(xt.current=window.requestAnimationFrame(()=>{xt.current=null;const t=window.scrollY||document.documentElement.scrollTop||0;j(t>140),se(t>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),xt.current&&(window.cancelAnimationFrame(xt.current),xt.current=null)}},[I]),useEffect(()=>{if(!I){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(t){}return}const e=()=>{try{const t=document.querySelector(".mobile-bottom-nav"),a=t&&t.offsetHeight?t.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${a}px`)}catch(t){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[I]);const oa=React.useMemo(()=>{const e=Array.isArray(dt)?dt:[],t={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const a of e){const n=$t(a==null?void 0:a.status);n==="draft"?t.draft+=1:n==="pending"?t.pending+=1:n==="processing"?t.processing+=1:n==="done"?t.done+=1:n==="paid"?t.paid+=1:n==="canceled"?t.canceled+=1:t.other+=1}return t},[dt]),Gs=React.useMemo(()=>{const e=X;return!e||e.size===0?0:(Array.isArray(ra)?ra:[]).reduce((t,a)=>{var n;return t+(e.has(String((n=a==null?void 0:a.id)!=null?n:""))?1:0)},0)},[X,ra]),Js=React.useMemo(()=>(Array.isArray(ra)?ra:[]).filter(e=>Un(e)).length,[ra]),ds=React.useMemo(()=>{const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${t}-${a}`},[]),ea=e=>{if(Ce&&re(""),e==="thisMonth"){ee(!1),J(""),y(ds);return}if(e==="overduePending"){y(""),ee(!0),J("pending");return}if(e==="draftExpiring"){ee(!1),J("draft"),y(""),sn();return}if(e==="all"){ee(!1),J(""),y(ds);return}},Ma=e=>window.KTM.date.formatDateTime(e),Ws=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Ln(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Ln([])}},fa=async()=>{Ie(!0),xe(!1);try{const t=new URLSearchParams;p&&t.set("month",String(p)),t.set("includeItems","0"),t.set("meta","1"),t.set("limit",String(Bn)),t.set("offset","0");const a=`${API_BASE}/api/orders?${t.toString()}`,n=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),s=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],i=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;P(Array.isArray(s)?s:[]),O(Array.isArray(s)?s.length:0),oe(!!(i!=null&&i.hasMore)),sn()}catch(t){console.error("Load orders error:",t),P([]),O(0),oe(!1)}finally{Ie(!1),xe(!1)}},Us=async()=>{if(!(be||Z||Ce)&&ie){xe(!0);try{const e=new URLSearchParams;p&&e.set("month",String(p)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(Bn)),e.set("offset",String(T));const t=`${API_BASE}/api/orders?${e.toString()}`,a=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.orders)?a.orders:[],s=!Array.isArray(a)&&a&&typeof a=="object"&&a.meta||null;P(i=>Vs(i,Array.isArray(n)?n:[])),O(i=>i+(Array.isArray(n)?n.length:0)),oe(!!(s!=null&&s.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{xe(!1)}}},ms=async e=>{var s;const t=es(e);if(!t){st([]),pt(""),Se(!1);return}const a=Fs(t);if(t.length<Vn&&a.length<qn){st([]),pt(`Nh\u1EADp \xEDt nh\u1EA5t ${Vn} k\xFD t\u1EF1 (ho\u1EB7c ${qn} s\u1ED1) \u0111\u1EC3 search nhanh`),Se(!1);return}try{const i=(s=En.current)==null?void 0:s.get(t);if(i&&Number.isFinite(i.ts)&&Date.now()-i.ts<=$s){st(Array.isArray(i.results)?i.results:[]),pt(""),Se(!1);return}}catch(i){}const n=++Ba.current;Se(!0),pt("");try{const i=`${API_BASE}/api/orders?search=${encodeURIComponent(t)}`,d=await window.KTM.api.getJSON(i,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(Ba.current!==n)return;const o=Array.isArray(d)?d:[];st(o);try{const g=En.current;if(g&&typeof g.set=="function"&&(g.set(t,{ts:Date.now(),results:o}),g.size>Hn)){const m=Array.from(g.entries()).sort((u,k)=>{var B,q;return(Number((B=u==null?void 0:u[1])==null?void 0:B.ts)||0)-(Number((q=k==null?void 0:k[1])==null?void 0:q.ts)||0)}),l=Math.max(0,m.length-Hn);for(let u=0;u<l;u++)g.delete(m[u][0])}}catch(g){}}catch(i){if(Ba.current!==n)return;console.error("Order search error:",i),st([]),pt((i==null?void 0:i.message)||"Search l\u1ED7i")}finally{if(Ba.current!==n)return;Se(!1)}};useEffect(()=>{ma.current&&(clearTimeout(ma.current),ma.current=null);const e=es(Ae);if(!e){st([]),pt(""),Se(!1);return}return ae&&ee(!1),ma.current=setTimeout(()=>{ms(e)},Ts),()=>{ma.current&&(clearTimeout(ma.current),ma.current=null)}},[Ae]);const sn=async()=>{_(!0),he(!0);try{const[e,t]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(ia)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Nn)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);le(Array.isArray(e)?e:[]),Ue(Array.isArray(t)?t:[])}catch(e){console.error("Load all orders error:",e),le([]),Ue([])}finally{_(!1),he(!1)}},_n=async e=>{const t=await Za(e);if(!t)return;sa(t.id);const a=Array.isArray(t.items)&&t.items.length?t.items.map(o=>{var g,m,l,u;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((g=o==null?void 0:o.quantity)!=null?g:1)||1,unit_price:(()=>{var q;const k=(q=o==null?void 0:o.unit_price)!=null?q:o==null?void 0:o.unitPrice,B=k==null||k===""?NaN:Number(k);return Number.isFinite(B)?Math.trunc(B):null})(),variant:String((m=o==null?void 0:o.variant)!=null?m:"").trim(),variant_json:(u=(l=o==null?void 0:o.variant_json)!=null?l:o==null?void 0:o.variantJson)!=null?u:null}}).filter(o=>o.product_id):[{product_id:t.product_id||"",quantity:Number(t.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=Hs(t),s=Sa(n),i=Ca(s),d=kn(s);Ge({customer_name:t.customer_name||"",phone:nt(t.phone||""),address:t.address||"",note:(t==null?void 0:t.note)||"",items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:i,adjustment_note:d||(t==null?void 0:t.adjustment_note)||"",status:t.status||"pending"}),aa(new Array(a.length?a.length:1).fill("")),Kt(new Array(a.length?a.length:1).fill(!0)),St(null),we(!1),je(t),it(!0),gt(""),Oe(!1),Ct(!0),t.phone&&en(nt(t.phone))},Ea=async e=>{if(!e)return;it(!0),gt(""),Oe(!0),Ct(!1),je(e);const t=++v.current;try{const a=await Za(e);if(v.current!==t)return;je(a||e)}catch(a){if(v.current!==t)return;gt((a==null?void 0:a.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(v.current!==t)return;Oe(!1)}},Xs=()=>{b||V||(it(!1),Oe(!1),gt(""),Ct(!1),sa(null),ba(""),ht(!1),Kt([]))};function rn(e){it(!1),Ct(!1),Oe(!1),gt(""),sa(null),ba(e||""),ht(!1),Kt([]),we(!0)}const Mn=()=>{b||V||(we(!1),sa(null),ba(""),ht(!1),Kt([]))},us=async()=>{var o,g,m;if(!tt||V||b)return;const e=(Array.isArray(z)?z:[]).find(l=>String(l==null?void 0:l.id)===String(tt))||null,t=String((e==null?void 0:e.status)||(S==null?void 0:S.status)||"").trim();if(t==="done"||t==="paid"||t==="canceled"){const l="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof C=="function"?C(l,"warning"):alert(l);return}const a=nt(S.phone),s=(Array.isArray(S.items)?S.items:[]).map((l,u)=>{var k,B;return{idx:u,product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((k=l==null?void 0:l.quantity)!=null?k:0),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(B=l==null?void 0:l.variant_json)!=null?B:null,unit_price:(()=>{const q=l==null?void 0:l.unit_price,Te=q===""||q==null?NaN:Number(q);if(Number.isFinite(Te))return Math.max(0,Math.trunc(Te));const Me=Ht(l==null?void 0:l.product_id),rt=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return Ta(Me,rt)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);if(s.length<2){const l="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof C=="function"?C(l,"warning"):alert(l);return}const i=[],d=[];for(const l of s){const u=!!wa[l.idx],k={product_id:l.product_id,quantity:l.quantity,unit_price:l.unit_price,variant:l.variant,variant_json:l.variant_json};u?i.push(k):d.push(k)}if(!i.length||!d.length){const l="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof C=="function"?C(l,"warning"):alert(l);return}me(!0);try{const l=Array.isArray(S==null?void 0:S.adjustment_items)?S.adjustment_items:[],u=Sa(l),k=Ca(u),B=kn(u),q={customer_name:S.customer_name,phone:a,address:S.address,note:(S.note||"").trim(),adjustment_amount:k,adjustment_note:B,adjustment_items:u,status:"processing",items:i,product_id:i[0].product_id,quantity:i[0].quantity,split_seq:1},Te=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,q,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),Me=(m=(g=Te==null?void 0:Te.id)!=null?g:(o=Te==null?void 0:Te.order)==null?void 0:o.id)!=null?m:null;if(!Me)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const rt={id:tt,customer_name:S.customer_name,phone:a,address:S.address,note:(S.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:d,product_id:d[0].product_id,quantity:d[0].quantity,parent_order_id:String(Me),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${tt}`,rt,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Mn(),fa();const Fe=Me?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${Me}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof C=="function"?C(Fe,"success"):alert(Fe)}catch(l){console.error(l);const u=(l==null?void 0:l.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof C=="function"?C(u,"danger"):alert(u)}finally{me(!1)}},ps=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const t=String(e),a=Ft.find(n=>String(n==null?void 0:n.id)===t);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Yt=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(t){return String(e!=null?e:"").toLowerCase()}},Ys=e=>{const a=Yt(e).trim().split(/\s+/).filter(Boolean),n=a.join(" ");return{contentTokens:a,cleanedQuery:n}},bs=React.useMemo(()=>(Array.isArray(Ft)?Ft:[]).map((e,t)=>{var m,l,u,k,B,q;const a=Yt((m=e==null?void 0:e.name)!=null?m:""),n=Yt((l=e==null?void 0:e.code)!=null?l:""),s=Yt((u=e==null?void 0:e.category)!=null?u:""),i=Yt((k=e==null?void 0:e.note)!=null?k:""),d=Yt((B=e==null?void 0:e.id)!=null?B:""),o=Yt((q=e==null?void 0:e.stt)!=null?q:""),g=`${a} ${n} ${s} ${i} ${d} ${o}`.trim();return{p:e,originalIndex:t,name:a,code:n,category:s,note:i,haystackAll:g}}),[Ft]),Qs=(e,t,a)=>{var u,k,B,q,Te;const n=Array.isArray(t)?t:[],s=Yt(a).trim();if(!n.length&&!s)return 0;const i=(u=e==null?void 0:e.name)!=null?u:"",d=(k=e==null?void 0:e.code)!=null?k:"",o=(B=e==null?void 0:e.category)!=null?B:"",g=(q=e==null?void 0:e.note)!=null?q:"";if(!((Te=e==null?void 0:e.haystackAll)!=null?Te:""))return 0;let l=0;s&&(i===s&&(l+=220),i.includes(s)&&(l+=140),i.startsWith(s)&&(l+=160),d&&d===s&&(l+=180),d&&d.includes(s)&&(l+=90));for(const Me of n){if(!Me)continue;const rt=new RegExp(`(?:^|\\s)${Me.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);i.includes(Me)&&(l+=35),rt.test(i)&&(l+=25),d&&d.includes(Me)&&(l+=20),d&&rt.test(d)&&(l+=10),o&&o.includes(Me)&&(l+=12),g&&g.includes(Me)&&(l+=6)}return l>0&&i&&(l+=Math.max(0,10-Math.min(10,Math.floor(i.length/10)))),l},Tn=(e,t)=>{const a=String(e||""),n=String(t||"");if(a===n)return 0;if(!a)return n.length;if(!n)return a.length;const s=a.length,i=n.length;if(i>s)return Tn(n,a);let d=new Array(i+1),o=new Array(i+1);for(let g=0;g<=i;g++)d[g]=g;for(let g=1;g<=s;g++){o[0]=g;const m=a.charCodeAt(g-1);for(let u=1;u<=i;u++){const k=m===n.charCodeAt(u-1)?0:1;o[u]=Math.min(d[u]+1,o[u-1]+1,d[u-1]+k)}const l=d;d=o,o=l}return d[i]},Zs=(e,t)=>{const a=String(e||"").trim(),n=String(t||"");if(!a||!n)return!1;if(n.includes(a))return!0;const s=n.split(/\s+/).filter(Boolean);if(!s.length)return!1;const i=a.length<=4?1:2;for(const d of s)if(!(Math.abs(d.length-a.length)>i)&&Tn(a,d)<=i)return!0;return!1},on=e=>{const t=Yt(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return t?t.split(" ").filter(Boolean):[]},ei=(e,t)=>{const a=Array.isArray(t)?t:[];if(!a.length)return 0;const n=on((e==null?void 0:e.name)||""),s=on((e==null?void 0:e.code)||""),i=on((e==null?void 0:e.category)||""),d=on((e==null?void 0:e.note)||""),o=(m,l,u)=>{const k=String(m||"").trim();if(!k||!l.length)return 0;const B=k.length<=4?1:2;let q=1/0,Te=-1;for(let Fe=0;Fe<l.length;Fe++){const Vt=l[Fe];if(!Vt||Math.abs(Vt.length-k.length)>B)continue;const at=Tn(k,Vt);if(at<q&&(q=at,Te=Fe,at===0))break}if(q===1/0||q>B)return 0;let rt=Math.round(u*(q===0?1:q===1?.65:.45));return Te===0?rt+=Math.round(u*.25):Te===1&&(rt+=Math.round(u*.12)),rt};let g=0;for(const m of a){if(!m)continue;const l=o(m,n,180),u=o(m,s,120),k=o(m,i,60),B=o(m,d,30);g+=Math.max(l,u,k,B)}if(g>0){const m=((e==null?void 0:e.name)||"").length;g+=Math.max(0,60-Math.min(60,Math.floor(m/2)))}return g},$n=React.useRef(new Map);React.useEffect(()=>{$n.current=new Map},[Ft]);const fs=e=>{var m,l;const t=String(fn[e]||"").trim();if(!t)return Ft;const{contentTokens:a,cleanedQuery:n}=Ys(t);if(a.length===0)return Ft;const s=Yt(t).trim(),i=$n.current.get(s);if(i)return i;const d=[];for(const u of bs){const k=u.haystackAll;k&&a.some(B=>k.includes(B))&&d.push(u)}let o=d;if(o.length<8&&a.length>0){const u=[],k=new Set(o.map(B=>{var q,Te;return String((Te=(q=B.p)==null?void 0:q.id)!=null?Te:"")+":"+String(B.originalIndex)}));for(const B of bs){const q=String((l=(m=B.p)==null?void 0:m.id)!=null?l:"")+":"+String(B.originalIndex);if(k.has(q))continue;const Te=B.haystackAll;Te&&a.some(Me=>Zs(Me,Te))&&(u.push(B),k.add(q))}u.length&&(o=o.concat(u))}const g=o.map(u=>({entry:u,score:Qs(u,a,n)})).map(u=>{if(u.score>0)return u;const k=ei(u.entry,a);return k>0?{...u,score:k}:u}).filter(u=>u.score>0).sort((u,k)=>k.score!==u.score?k.score-u.score:u.entry.originalIndex-k.entry.originalIndex).slice(0,40).map(u=>u.entry.p);return $n.current.set(s,g),g},Ht=e=>{if(!e)return null;const t=String(e);return Ft.find(a=>String(a==null?void 0:a.id)===t)||null},la=e=>{if(e==null||e==="")return[];let t=e;if(typeof t=="string"){const a=t.trim();if(!a)return[];try{t=JSON.parse(a)}catch(n){return[]}}return Array.isArray(t)?t.map((a,n)=>{var d;if(!a||typeof a!="object")return null;const s=String((d=a.name)!=null?d:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,i=(Array.isArray(a.options)?a.options:[]).map(o=>{var Te,Me,rt,Fe,Vt,at,Qt;if(!o||typeof o!="object")return null;const g=String((Te=o.label)!=null?Te:"").trim();if(!g)return null;const m=(Vt=(Fe=(rt=(Me=o.price)!=null?Me:o.priceValue)!=null?rt:o.unit_price)!=null?Fe:o.unitPrice)!=null?Vt:null,l=m==null||m===""?NaN:typeof m=="number"?m:typeof m=="string"?ts(m):Number(m),u=Number.isFinite(l)?Math.trunc(l):null,k=(Qt=(at=o.price_delta)!=null?at:o.priceDelta)!=null?Qt:null,B=Number(k),q=Number.isFinite(B)?Math.trunc(B):0;return{label:g,price:u,price_delta:q}}).filter(Boolean);return{name:s,options:i}}).filter(Boolean):[]},mi=e=>{const t=Ht(e);return la(t==null?void 0:t.variants)},ln=e=>{if(!e||typeof e!="object")return"";const t=[];for(const[a,n]of Object.entries(e)){const s=String(a||"").trim(),i=String(n||"").trim();!s||!i||t.push(`${s}: ${i}`)}return t.join(", ")},Ta=(e,t)=>{const a=ts(e==null?void 0:e.price),n=la(e==null?void 0:e.variants);if(!n.length||!t||typeof t!="object")return a;let s=a,i=!1;for(const d of n){const o=String((d==null?void 0:d.name)||"").trim(),g=String((t==null?void 0:t[o])||"").trim();if(!o||!g)continue;const m=(Array.isArray(d.options)?d.options:[]).find(q=>String((q==null?void 0:q.label)||"").trim()===g);if(!m)continue;const l=m==null?void 0:m.price,u=l==null||l===""?NaN:Number(l);if(Number.isFinite(u)){s=Math.max(0,Math.trunc(u)),i=!0;continue}const k=m==null?void 0:m.price_delta,B=k==null||k===""?NaN:Number(k);Number.isFinite(B)&&(s+=Math.trunc(B))}return s},In=e=>window.KTM.orders.getOrderItems(e),hs=e=>window.KTM.orders.getOrderTotalQty(e),$a=e=>window.KTM.orders.getOrderProductSummary(e,Ht),cn=e=>window.KTM.orders.getOrderItemRows(e,Ht),Pa=e=>window.KTM.orders.getOrderAdjustmentMoney(e),ha=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),ti=e=>{const t=In(e),a=cn(e),n=Fa(t),s=Ka(t),i=s.fee,d=Pa(e),o=n+i+d,g=l=>{const u=Number(l)||0;return u>0?`+${We(u)}`:We(u)},m=[];if(e!=null&&e.customer_name&&m.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&m.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&m.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&m.push(`GHI CH\xDA: ${(e.note||"").trim()}`),m.push(""),m.push("S\u1EA2N PH\u1EA8M:"),a.length)for(const l of a)m.push(`- ${l.name} (SL: ${l.qty})`);else{const l=$a(e);l&&l!=="\u2014"&&m.push(`- ${l}`)}m.push(""),m.push(`T\u1EA0M T\xCDNH: ${We(n)}`),s.found&&i!==0&&m.push(`SHIP: ${We(i)}`);{const l=window.KTM.orders.getOrderAdjustmentItems(e),u=(Array.isArray(l)?l:[]).map(q=>{var Te;return{amount:Number((Te=q==null?void 0:q.amount)!=null?Te:0)||0,note:String((q==null?void 0:q.note)||"").trim()}}).filter(q=>q.amount!==0||!!q.note),k=ha(e);if(d!==0||u.length>0||!!k)if(u.length===1){const q=u[0];m.push(`\u0110I\u1EC0U CH\u1EC8NH: ${g(d)}${q.note?` \u2014 ${q.note}`:""}`)}else{m.push(`\u0110I\u1EC0U CH\u1EC8NH: ${g(d)}${!u.length&&k?` \u2014 ${k}`:""}`);for(const q of u)m.push(`- ${g(q.amount)}${q.note?`: ${q.note}`:""}`)}}return m.push(`T\u1ED4NG: ${We(o)}`),m.filter(Boolean).join(`
`)},dn=async e=>{try{const t=await Za(e),a=ti(t);await window.KTM.clipboard.writeText(a),typeof C=="function"?C("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(t){console.error(t),typeof C=="function"?C("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Ka=e=>window.KTM.orders.getOrderShipInfo(e,Ht),Fa=e=>window.KTM.orders.getItemsSubtotal(e,Ht),jn=e=>{try{const t=e instanceof Date?e:new Date(e);if(!t||Number.isNaN(t.getTime()))return"";const a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${a}-${n}`}catch(t){return""}},On=()=>p?String(p):jn(new Date),gs=e=>{const t=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=nt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),s=xn(e).amount,d=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(o=>{var g;return{product_id:String((o==null?void 0:o.product_id)||"").trim(),quantity:Number((g=o==null?void 0:o.quantity)!=null?g:0),variant:String((o==null?void 0:o.variant)||"").trim()}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0).sort((o,g)=>o.product_id<g.product_id?-1:o.product_id>g.product_id?1:o.variant<g.variant?-1:o.variant>g.variant?1:o.quantity-g.quantity);return JSON.stringify({name:t,phone:a,address:n,items:d,adj:s})},_t=React.useMemo(()=>{const e=nt((S==null?void 0:S.phone)||"");if(!e)return{count:0,orders:[],monthKey:On()};const t=On(),n=(Array.isArray(Pt)?Pt:[]).filter(s=>{if(!s||tt&&String(s.id)===String(tt)||nt(s.phone||"")!==e)return!1;const i=jn(s.created_at);return i&&i===t}).sort((s,i)=>{const d=new Date(s.created_at).getTime(),o=new Date(i.created_at).getTime();return(Number.isFinite(o)?o:0)-(Number.isFinite(d)?d:0)});return{count:n.length,orders:n,monthKey:t}},[Pt,S==null?void 0:S.phone,p,tt]),ai=e=>{var o;const t=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=nt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),s=as((o=e==null?void 0:e.adjustment_amount)!=null?o:0),i=In(e),d=(Array.isArray(i)?i:[]).map(g=>{var m;return{product_id:String((g==null?void 0:g.product_id)||"").trim(),quantity:Number((m=g==null?void 0:g.quantity)!=null?m:0),variant:String((g==null?void 0:g.variant)||"").trim()}}).filter(g=>g.product_id&&Number.isFinite(g.quantity)&&g.quantity>0).sort((g,m)=>g.product_id<m.product_id?-1:g.product_id>m.product_id?1:g.variant<m.variant?-1:g.variant>m.variant?1:g.quantity-m.quantity);return JSON.stringify({name:t,phone:a,address:n,items:d,adj:s})},vs=React.useMemo(()=>{if(tt)return"";const e=nt((S==null?void 0:S.phone)||"");if(!e)return"";const t=On(),a=gs(S),n=Array.isArray(Pt)?Pt:[];for(const s of n){if(!s||tt&&String(s.id)===String(tt)||nt(s.phone||"")!==e)continue;const i=jn(s.created_at);if(!i||i!==t)continue;const d=ai(s);if(d&&d===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${t}${s!=null&&s.id?` (#${s.id})`:""}`}return""},[Pt,S,p,tt]),ys=e=>{var Vt;const t=[],a=[],n=String((e==null?void 0:e.customer_name)||"").trim(),s=nt((e==null?void 0:e.phone)||""),i=String((e==null?void 0:e.address)||"").trim();n||t.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),s||t.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),s&&!Aa(s)&&t.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),i||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const o=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(at=>at&&at.product_id);o.length===0&&t.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),o.some(at=>{var va;const Qt=Number((va=at==null?void 0:at.quantity)!=null?va:0);return!Number.isFinite(Qt)||Qt<=0})&&t.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const m=new Set;let l=!1;for(const at of o){const Qt=String(at.product_id||"").trim(),va=String((at==null?void 0:at.variant)||"").trim();if(!Qt)continue;const ze=`${Qt}||${va}`;if(m.has(ze)){l=!0;break}m.add(ze)}l&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const u=Fa(o),k=Ka(o),B=k!=null&&k.found?Number((Vt=k==null?void 0:k.fee)!=null?Vt:0):0,q=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],Te=Sa(q),Me=Ca(Te),rt=Te.some(at=>(Number(at==null?void 0:at.amount)||0)!==0&&!String((at==null?void 0:at.note)||"").trim());k!=null&&k.found&&(B>=2e5||u>0&&B>u*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${We(B)}`),rt&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Fe=Math.abs(Me);return(Fe>=5e5||u>0&&Fe>u*.5)&&Me!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${We(Me)}`),{errors:t,warnings:a,canSubmit:t.length===0}},ui=React.useMemo(()=>ys(S),[S,Ft]),Ve=React.useMemo(()=>{var va;const e=String((S==null?void 0:S.customer_name)||"").trim(),t=nt((S==null?void 0:S.phone)||""),a=String((S==null?void 0:S.address)||"").trim(),n=Array.isArray(S==null?void 0:S.items)?S.items:[],s=new Map;for(const ze of n){const Ia=String((ze==null?void 0:ze.product_id)||"").trim(),un=String((ze==null?void 0:ze.variant)||"").trim();if(!Ia)continue;const pn=`${Ia}||${un}`;s.set(pn,(s.get(pn)||0)+1)}const i=n.map(ze=>{var Ns;const Ia=String((ze==null?void 0:ze.product_id)||"").trim(),un=Number((Ns=ze==null?void 0:ze.quantity)!=null?Ns:0),pn=Ia?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",ri=Number.isFinite(un)&&un>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",oi=String((ze==null?void 0:ze.variant)||"").trim(),li=`${Ia}||${oi}`,ci=Ia&&(s.get(li)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:pn,qtyError:ri,dupWarn:ci}}),d=n.filter(ze=>ze&&ze.product_id),o=Fa(d),g=Ka(d),m=g!=null&&g.found?Number((va=g==null?void 0:g.fee)!=null?va:0):0,l=Array.isArray(S==null?void 0:S.adjustment_items)?S.adjustment_items:[],u=Sa(l),k=Ca(u),B=u.some(ze=>(Number(ze==null?void 0:ze.amount)||0)!==0&&!String((ze==null?void 0:ze.note)||"").trim()),q=Math.abs(k),Te=B?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Me=k!==0&&(q>=5e5||o>0&&q>o*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${We(k)}`:"",rt=g!=null&&g.found&&(m>=2e5||o>0&&m>o*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${We(m)}`:"",Fe=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Vt=t?Aa(t)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",at=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Qt=!Fe&&!Vt&&i.every(ze=>!ze.productError&&!ze.qtyError);return{nameError:Fe,phoneError:Vt,addressWarn:at,items:i,shipAbnormalWarn:rt,adjustmentNoteWarn:Te,adjustmentAbnormalWarn:Me,canSubmit:Qt}},[S,Ft]),mn=async e=>{var o,g,m;const t=(e==null?void 0:e.mode)||"close",a=(e==null?void 0:e.origin)||"modal",n=ys(S);if(!n.canSubmit){const l=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof C=="function"?C(l,"danger"):alert(l);return}if(!tt&&vs){const l=`${vs}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(l)){(_t==null?void 0:_t.count)>0&&ht(!0),setTimeout(()=>{var B;const k=document.getElementById("order-phone-input");k&&typeof k.scrollIntoView=="function"&&(k.scrollIntoView({block:"center",behavior:"smooth"}),(B=k.focus)==null||B.call(k))},0);return}}const s=nt(S.phone),d=(Array.isArray(S.items)?S.items:[]).map(l=>{var u,k;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((u=l==null?void 0:l.quantity)!=null?u:1),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(k=l==null?void 0:l.variant_json)!=null?k:null,unit_price:(()=>{const B=l==null?void 0:l.unit_price,q=B===""||B==null?NaN:Number(B);if(Number.isFinite(q))return Math.max(0,Math.trunc(q));const Te=Ht(l==null?void 0:l.product_id),Me=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return Ta(Te,Me)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);f(!0);try{const l=tt,u=tt?`${API_BASE}/api/orders/${tt}`:`${API_BASE}/api/orders`,k=d[0],B=Array.isArray(S==null?void 0:S.adjustment_items)?S.adjustment_items:[],q=Sa(B),Te=Ca(q),Me=kn(q),rt={customer_name:S.customer_name,phone:s,address:S.address,note:(S.note||"").trim(),adjustment_amount:Te,adjustment_note:Me,adjustment_items:q,product_id:k.product_id,quantity:k.quantity,status:S.status,items:d,...tt?{id:tt}:{}};if(tt)await window.KTM.api.putJSON(u,rt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Fe=await window.KTM.api.postJSON(u,rt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");ws.current={id:(m=(g=Fe==null?void 0:Fe.id)!=null?g:(o=Fe==null?void 0:Fe.order)==null?void 0:o.id)!=null?m:null,fingerprint:gs(S),ts:Date.now()}}if(zs(s,S.customer_name,S.address),a==="drawer"){if(ba(""),sa(null),we(!1),Ct(!1),ht(!1),Kt([]),fa(),l){Oe(!0),gt("");try{const Fe=await Sn(l);Fe&&typeof Fe=="object"&&je(Fe)}catch(Fe){gt((Fe==null?void 0:Fe.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Oe(!1)}}}else t==="new"&&!tt?(ba(""),sa(null),we(!0)):(ba(""),sa(null),we(!1)),fa()}catch(l){console.error(l),typeof C=="function"?C(l.message,"danger"):alert(l.message);return}finally{f(!1)}},Ha=e=>window.KTM.orders.getOrderTotalMoney(e,Ht),pi=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){G(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),fa(),sn()}catch(t){console.error(t),typeof C=="function"?C(t.message,"danger"):alert(t.message)}finally{G(null)}}},ni=()=>{const e=yt.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(i){}e.timer=null}const t=Array.isArray(e.events)?e.events.splice(0):[];if(!t.length||typeof C!="function")return;const a=new Map;for(const i of t){const d=String((i==null?void 0:i.orderId)||"").trim();d&&a.set(d,i)}const n=Array.from(a.values());if(!n.length)return;const s=i=>async()=>{try{for(const d of i)!(d!=null&&d.prevStatus)||!(d!=null&&d.orderId)||await ga({id:d.orderId,status:d.nextStatus},d.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});C(i.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${i.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(d){C("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(n.length===1){const i=n[0],d=`${zt(i.prevStatus)} \u2192 ${zt(i.nextStatus)}`.trim();C(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${d}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:s([i])});return}C(`\u0110\xE3 c\u1EADp nh\u1EADt ${n.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:s(n)})},si=e=>{const t=yt.current;t&&(Array.isArray(t.events)||(t.events=[]),t.events.push(e),!t.timer&&(t.timer=setTimeout(()=>ni(),320)))};useEffect(()=>()=>{try{const e=yt.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const ga=async(e,t,a={})=>{var d;const n=await Za(e),s=n==null?void 0:n.id;if(!s||!t)return;const i=$t(n==null?void 0:n.status);H(s);try{const o=In(n),g=(Array.isArray(o)?o:[]).map(u=>{var k,B;return{product_id:(u==null?void 0:u.product_id)||"",quantity:Number((k=u==null?void 0:u.quantity)!=null?k:1),variant:String((u==null?void 0:u.variant)||"").trim()||null,variant_json:(B=u==null?void 0:u.variant_json)!=null?B:null,unit_price:(()=>{var Me;const q=(Me=u==null?void 0:u.unit_price)!=null?Me:u==null?void 0:u.unitPrice,Te=Number(q);return Number.isFinite(Te)?Math.max(0,Math.trunc(Te)):null})()}}).filter(u=>u.product_id&&Number.isFinite(u.quantity)&&u.quantity>0);if(!g.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const m=g[0],l={id:s,customer_name:(n==null?void 0:n.customer_name)||"",phone:nt((n==null?void 0:n.phone)||""),address:(n==null?void 0:n.address)||"",note:((n==null?void 0:n.note)||"").trim(),adjustment_amount:Number((d=n==null?void 0:n.adjustment_amount)!=null?d:0)||0,adjustment_note:(n==null?void 0:n.adjustment_note)||"",product_id:m.product_id,quantity:m.quantity,status:t,items:g};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${s}`,l,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),P(u=>Array.isArray(u)?u.map(k=>(k==null?void 0:k.id)===s?{...k,status:t}:k):u),le(u=>Array.isArray(u)?u.map(k=>(k==null?void 0:k.id)===s?{...k,status:t}:k):u),Wa(s,!1),Ks(s),a!=null&&a.silentToast)return;if(a!=null&&a.skipToastBatch){typeof C=="function"&&C("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}si({orderId:s,prevStatus:i,nextStatus:$t(t)})}catch(o){if(console.error(o),(!navigator.onLine||(o==null?void 0:o.name)==="TypeError"||String((o==null?void 0:o.message)||"").toLowerCase().includes("failed to fetch"))&&!(a!=null&&a.fromSync)){P(m=>Array.isArray(m)?m.map(l=>(l==null?void 0:l.id)===s?{...l,status:t}:l):m),le(m=>Array.isArray(m)?m.map(l=>(l==null?void 0:l.id)===s?{...l,status:t}:l):m),Es(s,t,i),typeof C=="function"&&C("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof C=="function"?C(o.message,"danger"):alert(o.message)}finally{H(null)}};useEffect(()=>{const e=t=>{var n;const a=(n=t==null?void 0:t.detail)==null?void 0:n.key;if(a){if(a==="/"){setTimeout(()=>{var s,i;(i=(s=vn.current)==null?void 0:s.focus)==null||i.call(s)},0);return}if(a==="N"||a==="n"){rn();return}if((a==="j"||a==="J"||a==="k"||a==="K")&&Be&&(te!=null&&te.id)){const s=Array.isArray(dt)?dt:[],i=s.findIndex(g=>String(g==null?void 0:g.id)===String(te==null?void 0:te.id));if(i<0)return;const o=s[i+(a==="j"||a==="J"?-1:1)];o&&Ea(o)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[dt,Be,te]);const ii=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:S.customer_name,onChange:e=>Ge({...S,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Ve.nameError&&React.createElement("div",{className:"form-text text-danger"},Ve.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:S.phone,onChange:e=>is(e.target.value),onBlur:rs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Ve.phoneError&&React.createElement("div",{className:"form-text text-danger"},Ve.phoneError),!Ve.phoneError&&_t.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",_t.count," \u0111\u01A1n trong th\xE1ng ",_t.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>ht(e=>!e)},Ot?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),Ot&&_t.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ht(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},_t.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${_a(e.status)}`},zt(e.status))),React.createElement("div",{className:"text-muted small"},Ma(e.created_at)," \u2022 ",We(Ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},$a(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&_n(e)}},"M\u1EDF")))),_t.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(Ke==null?void 0:Ke.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(Ke==null?void 0:Ke.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(Ke==null?void 0:Ke.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(Ke==null?void 0:Ke.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:S.status,onChange:e=>Ge({...S,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:S.address,onChange:e=>Ge({...S,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Ve.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Ve.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:S.note,onChange:e=>Ge({...S,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Ge(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Xt(S.adjustment_items).map((e,t)=>React.createElement("div",{key:t,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:a=>{const n=a.target.value;Ge(s=>{const i=Xt(s.adjustment_items);return i[t]={...i[t],amount:n},{...s,adjustment_items:i}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:a=>{const n=a.target.value;Ge(s=>{const i=Xt(s.adjustment_items);return i[t]={...i[t],note:n},{...s,adjustment_items:i}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{Ge(a=>{const n=Xt(a.adjustment_items);return n.splice(t,1),{...a,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:b||Xt(S.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Ve.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Ve.adjustmentAbnormalWarn),!!Ve.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Ve.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Ge(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),aa(e=>[...Array.isArray(e)?e:[],""]),tt&&Kt(e=>[...Array.isArray(e)?e:[],!0])},disabled:b},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(S.items)?S.items:[{product_id:"",quantity:1}]).map((e,t)=>React.createElement("div",{key:t,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{hn.current[t]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{na(a=>a===t?null:t),setTimeout(()=>{const a=document.getElementById(`order-product-search-${t}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ps(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Oa===t&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${t}`,className:"form-control",value:fn[t]||"",onChange:a=>{const n=a.target.value;aa(s=>{const i=Array.isArray(s)?[...s]:[];return i[t]=n,i})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=fs(t);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const s=String(n.id),i=la(n==null?void 0:n.variants),d={};for(const m of i){const l=String((m==null?void 0:m.name)||"").trim(),u=Array.isArray(m==null?void 0:m.options)?m.options[0]:null,k=String((u==null?void 0:u.label)||"").trim();l&&k&&(d[l]=k)}const o=ln(d),g=Ta(n,d);Ge(m=>{const l=Array.isArray(m.items)?[...m.items]:[];return l[t]={...l[t]||{quantity:1},product_id:s,variant_json:Object.keys(d).length?d:null,variant:o,unit_price:i.length?g:null},{...m,items:l}}),na(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Ft.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var n;const a=(n=Ve.items)==null?void 0:n[t];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const a=Ht(e.product_id),n=la(a==null?void 0:a.variants);if(!n.length)return null;const s=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((i,d)=>{const o=String((i==null?void 0:i.name)||`Bi\u1EBFn th\u1EC3 ${d+1}`).trim(),g=String((s==null?void 0:s[o])||"").trim();return React.createElement("div",{key:o},React.createElement("label",{className:"form-label small text-muted mb-1"},o),React.createElement("select",{className:"form-select",value:g,onChange:m=>{const l=String(m.target.value||"").trim();Ge(u=>{const k=Array.isArray(u.items)?[...u.items]:[],B={...k[t]||{}},q=Ht(B.product_id),Te=la(q==null?void 0:q.variants),Me=B!=null&&B.variant_json&&typeof B.variant_json=="object"?{...B.variant_json}:{};l?Me[o]=l:delete Me[o];const rt=ln(Me),Fe=Ta(q,Me);return k[t]={...B,variant_json:Object.keys(Me).length?Me:null,variant:rt,unit_price:Fe},{...u,items:k}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",o," --"),(Array.isArray(i==null?void 0:i.options)?i.options:[]).map(m=>React.createElement("option",{key:m.label,value:m.label},m.label,Number.isFinite(Number(m==null?void 0:m.price))?` (${We(Number(m.price))})`:Number(m==null?void 0:m.price_delta)?` (${m.price_delta>0?"+":""}${m.price_delta})`:""))))}))})(),tt&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${t}`,checked:!!wa[t],onChange:a=>{const n=!!a.target.checked;Kt(s=>{const i=Array.isArray(s)?[...s]:[],d=Array.isArray(S.items)?S.items.length:0;for(;i.length<d;)i.push(!0);return i[t]=n,i})},disabled:b||V}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${t}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const n=a.target.value;Ge(s=>{const i=Array.isArray(s.items)?[...s.items]:[];return i[t]={...i[t]||{product_id:""},quantity:n},{...s,items:i}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const a=(n=Ve.items)==null?void 0:n[t];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{Ge(a=>{const n=Array.isArray(a.items)?[...a.items]:[];return n.splice(t,1),{...a,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),aa(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(t,1),n.length?n:[""]}),Kt(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(t,1),n}),na(a=>a==null?a:a===t?null:a>t?a-1:a)},disabled:b||V||(Array.isArray(S.items)?S.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const t=(Array.isArray(S.items)?S.items:[]).filter(o=>o==null?void 0:o.product_id),a=Fa(t),n=Ka(t),s=xn(S),i=s.amount,d=a+(n.found?n.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},We(a))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},We(n.fee))),!!Ve.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Ve.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},We(i))),(S.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(S.note||"").trim()),!!s.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",s.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},We(d)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:b||!!M||!!U}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},oa.all," \u0111\u01A1n"),Ce&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>Ce?ms(Ae):fa(),disabled:bt,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>rn(),disabled:b||!!M},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${Ze&&!ae&&!Ce?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),Nt(!1),He(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Gs)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${ct&&!ae&&!Ce?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),He(!1),Nt(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Js)),React.createElement("button",{type:"button",className:`orders-chip ${!D&&!ae&&!Ce?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),J("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},oa.all)),React.createElement("button",{type:"button",className:`orders-chip ${D==="draft"&&!ae&&!Ce?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),J("draft"),y("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},oa.draft)),React.createElement("button",{type:"button",className:`orders-chip ${D==="pending"&&!ae&&!Ce?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),J("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},oa.pending)),React.createElement("button",{type:"button",className:`orders-chip ${D==="processing"&&!ae&&!Ce?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),J("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},oa.processing)),React.createElement("button",{type:"button",className:`orders-chip ${D==="done"&&!ae&&!Ce?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),J("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},oa.done)),React.createElement("button",{type:"button",className:`orders-chip ${D==="paid"&&!ae&&!Ce?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),J("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},oa.paid)),React.createElement("button",{type:"button",className:`orders-chip ${D==="canceled"&&!ae&&!Ce?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),J("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},oa.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>ea("thisMonth"),disabled:Ce},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>ea("overduePending"),disabled:Ce},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",ia," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>ea("draftExpiring"),disabled:Ce},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a"),(D||ae||!p&&!Ce)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ea("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:vn,type:"text",className:"form-control",value:Ae,onChange:e=>re(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(Ae||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>re(""),disabled:bt},React.createElement("i",{className:"fas fa-times"})),bt&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:p,onChange:e=>y(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:ae||Ce})),React.createElement("div",{className:"text-muted small ms-auto"},Ce?"Search b\u1ECF qua filter":ae?"\u0110ang xem \u0111\u01A1n ch\u1EADm":D?`L\u1ECDc: ${zt(D)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${Y?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if(Ce){const e=String(Ae||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${dt.length} k\u1EBFt qu\u1EA3`}return ae?`\u0110\u01A1n ch\u1EADm \u2022 ${dt.length} \u0111\u01A1n`:Ze?`\u01AFu ti\xEAn \u2022 ${dt.length} \u0111\u01A1n`:ct?`H\xF4m nay \u2022 ${dt.length} \u0111\u01A1n`:D?`L\u1ECDc: ${zt(D)} \u2022 ${dt.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${dt.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{re(""),He(!1),Nt(!1),ea("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},Ce?`${dt.length} k\u1EBFt qu\u1EA3`:D?`${nn.length}/${z.length} \u0111\u01A1n`:`${z.length}${ie?"+":""} \u0111\u01A1n`)),Ce&&Xe&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Xe),an.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,an.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",ia," ng\xE0y.",ce&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ee(!0),J("pending")}},"Xem ngay")),os.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,os.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",Nn," ng\xE0y).",qe&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ee(!1),J("draft"),y(""),fa()}},"Xem ngay")),(Ce?bt:be)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,t)=>React.createElement("div",{key:t,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,t)=>React.createElement("tr",{key:t},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(Ce?dt.length===0:z.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},Ce?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!Ce&&nn.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},cs.map(e=>{var t;return React.createElement("div",{key:e.id,className:`card mb-2 orders-mobile-card ${Q!=null&&Q[String(e.id)]?"order-recent-updated":""} ${(Je==null?void 0:Je.id)===String(e.id)?`swipe-preview swipe-${(Je==null?void 0:Je.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>Ea(e),onPointerDown:a=>{if(R||kt||Ye||a.button!=null&&a.button!==0)return;const n=String(e.id);K.current={active:!0,id:n,startX:a.clientX,startY:a.clientY,dx:0,dy:0,lock:null},Qe(s=>(s==null?void 0:s.id)===n?s:{id:n,dir:null});try{ke.current&&clearTimeout(ke.current)}catch(s){}ut.current=n,ke.current=setTimeout(async()=>{var i,d,o,g;const s=ut.current;if(s)try{if((d=(i=Dt.current)==null?void 0:i.has)!=null&&d.call(i,s))return;const m=await Sn(s);m&&typeof m=="object"&&((g=(o=Dt.current)==null?void 0:o.set)==null||g.call(o,s,m))}catch(m){}},150)},onPointerMove:a=>{const n=K.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id))return;const s=a.clientX-n.startX,i=a.clientY-n.startY;if(n.dx=s,n.dy=i,Math.abs(s)>14||Math.abs(i)>14){try{ke.current&&clearTimeout(ke.current)}catch(d){}ke.current=null,ut.current=null}if(!n.lock){const d=Math.abs(s),o=Math.abs(i);(d>10||o>10)&&(n.lock=d>o*1.2?"x":"y")}if(n.lock!=="x"){Math.abs(i)>24&&Qe(d=>(d==null?void 0:d.id)===n.id?{id:n.id,dir:null}:d);return}s>72?Qe({id:n.id,dir:"right"}):s<-72?Qe({id:n.id,dir:"left"}):Qe({id:n.id,dir:null})},onPointerCancel:()=>{try{ke.current&&clearTimeout(ke.current)}catch(a){}ke.current=null,ut.current=null,K.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null},Qe({id:null,dir:null})},onPointerUp:a=>{try{ke.current&&clearTimeout(ke.current)}catch(m){}ke.current=null,ut.current=null;const n=K.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id)){Qe({id:null,dir:null});return}K.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null};const s=Number(n.dx)||0,i=Math.abs(s),d=n.lock==="x",o=$t(e==null?void 0:e.status);if(Qe({id:null,dir:null}),!d||i<88)return;a.preventDefault(),a.stopPropagation();const g=s>0?"done":"processing";$t(g)!==o&&ga(e,g)},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),Ea(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:a=>Ps(a,e.phone),onPointerMove:Ua,onPointerUp:Ua,onPointerCancel:Ua,onPointerLeave:Ua,onClick:a=>{if(a.stopPropagation(),et.current){et.current=!1;return}Qn(e.phone)},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),a.stopPropagation(),Qn(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((t=e==null?void 0:e.split_seq)!=null?t:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const a=Xn(e);if(!a)return null;const n=L.has(String(e.id)),s=a.length>84||Yn(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${n?"":"order-text-collapsed"}`},a),s&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:i=>{i.stopPropagation(),Jn(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const a=Yn(e);if(!a)return null;const n=L.has(String(e.id)),s=Xn(e).length,i=s>84||a.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${n?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",a),i&&s<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:d=>{d.stopPropagation(),Jn(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${X.has(String(e.id))?"active":""}`,onClick:a=>{a.stopPropagation(),js(e.id)},title:X.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":X.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:X.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(Rt!=null&&Rt[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${_a(e.status)} order-status-badge-btn`,onPointerDown:a=>{a.stopPropagation(),ge.current=!1;try{ne.current&&clearTimeout(ne.current)}catch(n){}ne.current=setTimeout(()=>{ge.current=!0,Gn(e,a.currentTarget)},420)},onPointerUp:a=>{a.stopPropagation();try{ne.current&&clearTimeout(ne.current)}catch(n){}ne.current=null},onPointerCancel:a=>{a.stopPropagation();try{ne.current&&clearTimeout(ne.current)}catch(n){}ne.current=null},onClick:a=>{if(a.stopPropagation(),ge.current){ge.current=!1;return}Ye&&String(x==null?void 0:x.id)===String(e.id)?ua():Gn(e,a.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},zt(e.status)),Xa(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ia} ng\xE0y`},"\u26A0 Ch\u1EADm ",Da(e),"d"),Qa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${za} ng\xE0y`},"\u23F3 C\xF2n ",Ya(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=cn(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((n,s)=>React.createElement("div",{key:s,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},s+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${We(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},$a(e))})()),(Pa(e)!==0||ha(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},We(Pa(e))),ha(e)?React.createElement("span",{className:"text-muted"}," ","(",ha(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},We(Ha(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",Ma(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),dn(e)},disabled:b||!!M||U===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:a=>{a.stopPropagation(),zn(e)},disabled:b||!!M||U===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c"))))}),React.createElement("div",{ref:Ee,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(dt)&&cs.length<dt.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),Ye&&x&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>ua()},React.createElement("div",{className:`orders-status-popover ${($==null?void 0:$.placement)||""}`,style:{left:$.left,top:$.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},x.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ua(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},Ga.map(e=>{const t=$t(x.status)===$t(e.value),a=b||!!M||U===x.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${t?"active":""}`,onClick:()=>{t||(ga(x,e.value),ua())},disabled:a},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{zn(x),ua()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),R&&lt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>pa()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},lt.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},lt.phone||""),React.createElement("span",{className:`badge ${_a(lt.status)}`},zt(lt.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>pa(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{dn(lt),pa()},disabled:b||!!M||U===lt.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(lt.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(lt.phone||"").trim()}`,onClick:()=>pa()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{Ea(lt),pa()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},Ga.map(e=>{const t=$t(lt.status)===$t(e.value),a=b||!!M||U===lt.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${t?"active":""}`,onClick:()=>{t||(ga(lt,e.value),pa())},disabled:a},e.label)})))),kt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Ja()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ja(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>ea("thisMonth"),disabled:Ce},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>ea("overduePending"),disabled:Ce},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>ea("draftExpiring"),disabled:Ce},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!D&&!ae?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),J("")}},"T\u1EA5t c\u1EA3"),Ga.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${D===e.value&&!ae?"active":""}`,onClick:()=>{Ce&&re(""),ee(!1),J(e.value),e.value==="draft"&&y("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:p,onChange:e=>y(e.target.value),disabled:ae||Ce}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:ae,onChange:e=>{Ce&&re("");const t=!!e.target.checked;ee(t),t&&(y(""),J("pending"))},disabled:Ce}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",ia," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ea("all"),disabled:Ce},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>Ja()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${A?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){ya.current=!1;try{qt.current&&clearTimeout(qt.current)}catch(t){}qt.current=setTimeout(()=>{ya.current=!0,Wn(Ae)},460)}},onPointerUp:()=>{try{qt.current&&clearTimeout(qt.current)}catch(e){}qt.current=null},onPointerCancel:()=>{try{qt.current&&clearTimeout(qt.current)}catch(e){}qt.current=null},onClick:()=>{if(ya.current){ya.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,t;return(t=(e=vn.current)==null?void 0:e.focus)==null?void 0:t.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>rn(),disabled:b||!!M,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Is(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),wt&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{La(Et),Bt()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const t=e.touches&&e.touches[0];t&&(ta.current={active:!0,startY:t.clientY,startX:t.clientX,fired:!1})},onTouchMove:e=>{const t=ta.current;if(!(t!=null&&t.active)||t.fired)return;const a=e.touches&&e.touches[0];if(!a)return;const n=a.clientY-t.startY,s=a.clientX-t.startX;Math.abs(s)>24||n>90&&(t.fired=!0,La(Et),Bt())},onTouchEnd:()=>{ta.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{La(Et),Bt()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:Va,type:"text",className:"form-control",value:Et,onChange:e=>{const t=e.target.value;Jt(t),re(t)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(La(Et),Bt())}}),!!String(Et||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Jt(""),re("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(ja)&&ja.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},ja.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{Jt(e),re(e),La(e),Bt()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${Ze?"active":""}`,onClick:()=>{re(""),Jt(""),ee(!1),Nt(!1),He(e=>!e),Bt()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${ct?"active":""}`,onClick:()=>{re(""),Jt(""),ee(!1),He(!1),Nt(e=>!e),Bt()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${ae?"active":""}`,onClick:()=>{re(""),Jt(""),ee(e=>!e),ae||(y(""),J("pending")),Bt()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!D&&!ae&&!Ze&&!ct?"active":""}`,onClick:()=>{re(""),Jt(""),ee(!1),He(!1),Nt(!1),J(""),Bt()}},"T\u1EA5t c\u1EA3"),Ga.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${D===e.value&&!ae?"active":""}`,onClick:()=>{re(""),Jt(""),ee(!1),He(!1),Nt(!1),J(e.value),e.value==="draft"&&y(""),Bt()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,dt.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>Ea(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const t=cn(e);return t.length?React.createElement("div",{className:"d-grid gap-1"},t.map((a,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",We(a.unitPrice))))):$a(e)})()),React.createElement("td",null,hs(e)),React.createElement("td",{className:"fw-semibold"},We(Ha(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${_a(e.status)}`},zt(e.status)),Xa(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ia} ng\xE0y`},"\u26A0 Ch\u1EADm ",Da(e),"d"),Qa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${za} ng\xE0y`},"\u23F3 C\xF2n ",Ya(e),"d"))),React.createElement("td",null,Ma(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),dn(e)},disabled:b||!!M||U===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:t=>t.stopPropagation(),onChange:t=>{t.stopPropagation();const a=String(t.target.value||"").trim();t.target.value="",a&&ga(e,a)},disabled:b||!!M||U===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!Ce&&ie&&!ae&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Us,disabled:be||Z},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:Be,title:(()=>{const e=te,t=e!=null&&e.id?`#${e.id}`:"",a=e!=null&&e.status?`\u2022 ${zt(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${t} ${a}`.trim()})(),subtitle:(()=>{const e=te,t=String((e==null?void 0:e.customer_name)||"").trim(),a=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?Ma(e.created_at):"";return[t||a||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:Xs,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},Lt?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Ct(!1),sa(null),ba(""),ht(!1),Kt([])},disabled:b||V},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!tt&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:us,disabled:b||V,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>mn({mode:"close",origin:"drawer"}),disabled:b||V||!Ve.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>te&&dn(te),disabled:!te||mt||b||!!M},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>te&&_n(te),disabled:!te||mt||b||!!M},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const t=String(e.target.value||"").trim();e.target.value="",t&&te&&ga(te,t)},disabled:!te||mt||b||!!M||U===(te==null?void 0:te.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},Lt?React.createElement("form",{onSubmit:e=>{e.preventDefault(),mn({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),ii())):mt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):ot?React.createElement("div",{className:"alert alert-danger",role:"alert"},ot):te?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${_a(te.status)}`},zt(te.status)),Xa(te)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ia} ng\xE0y`},"\u26A0 Ch\u1EADm ",Da(te),"d"),Qa(te)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${za} ng\xE0y`},"\u23F3 C\xF2n ",Ya(te),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},We(Ha(te))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},hs(te)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},Ma(te.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},te.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},te.phone||"\u2014"),!!String(te.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(te.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},te.address||"\u2014")),((te==null?void 0:te.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(te.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=cn(te);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((t,a)=>React.createElement("div",{key:a,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},a+1,"."),t.name),t.variant?React.createElement("div",{className:"text-muted small"},t.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",t.qty,Number(t.unitPrice)>0?` \u2022 ${We(t.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},$a(te)||"\u2014")})(),(Pa(te)!==0||ha(te))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},We(Pa(te))),ha(te)?React.createElement("span",{className:"text-muted"}," ","(",ha(te),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Ne&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),tt?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Mn})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),mn({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Pn},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:S.customer_name,onChange:e=>Ge({...S,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Ve.nameError&&React.createElement("div",{className:"form-text text-danger"},Ve.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:S.phone,onChange:e=>is(e.target.value),onBlur:rs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Ve.phoneError&&React.createElement("div",{className:"form-text text-danger"},Ve.phoneError),!Ve.phoneError&&_t.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",_t.count," \u0111\u01A1n trong th\xE1ng ",_t.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>ht(e=>!e)},Ot?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),Ot&&_t.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ht(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},_t.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${_a(e.status)}`},zt(e.status))),React.createElement("div",{className:"text-muted small"},Ma(e.created_at)," \u2022 ",We(Ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},$a(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&_n(e)}},"M\u1EDF")))),_t.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(Ke==null?void 0:Ke.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(Ke==null?void 0:Ke.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(Ke==null?void 0:Ke.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(Ke==null?void 0:Ke.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:S.status,onChange:e=>Ge({...S,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:S.address,onChange:e=>Ge({...S,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Ve.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Ve.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:S.note,onChange:e=>Ge({...S,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Ge(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Xt(S.adjustment_items).map((e,t)=>React.createElement("div",{key:t,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:a=>{const n=a.target.value;Ge(s=>{const i=Xt(s.adjustment_items);return i[t]={...i[t],amount:n},{...s,adjustment_items:i}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:a=>{const n=a.target.value;Ge(s=>{const i=Xt(s.adjustment_items);return i[t]={...i[t],note:n},{...s,adjustment_items:i}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{Ge(a=>{const n=Xt(a.adjustment_items);return n.splice(t,1),{...a,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:b||Xt(S.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Ve.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Ve.adjustmentAbnormalWarn),!!Ve.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Ve.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Ge(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),aa(e=>[...Array.isArray(e)?e:[],""]),tt&&Kt(e=>[...Array.isArray(e)?e:[],!0])},disabled:b},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(S.items)?S.items:[{product_id:"",quantity:1}]).map((e,t)=>React.createElement("div",{key:t,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{hn.current[t]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{na(a=>a===t?null:t),setTimeout(()=>{const a=document.getElementById(`order-product-search-${t}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ps(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Oa===t&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${t}`,className:"form-control",value:fn[t]||"",onChange:a=>{const n=a.target.value;aa(s=>{const i=Array.isArray(s)?[...s]:[];return i[t]=n,i})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=fs(t);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const s=String(n.id),i=la(n==null?void 0:n.variants),d={};for(const m of i){const l=String((m==null?void 0:m.name)||"").trim(),u=Array.isArray(m==null?void 0:m.options)?m.options[0]:null,k=String((u==null?void 0:u.label)||"").trim();l&&k&&(d[l]=k)}const o=ln(d),g=Ta(n,d);Ge(m=>{const l=Array.isArray(m.items)?[...m.items]:[];return l[t]={...l[t]||{quantity:1},product_id:s,variant_json:Object.keys(d).length?d:null,variant:o,unit_price:i.length?g:null},{...m,items:l}}),na(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Ft.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var n;const a=(n=Ve.items)==null?void 0:n[t];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const a=Ht(e.product_id),n=la(a==null?void 0:a.variants);if(!n.length)return null;const s=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((i,d)=>{const o=String((i==null?void 0:i.name)||`Bi\u1EBFn th\u1EC3 ${d+1}`).trim(),g=String((s==null?void 0:s[o])||"").trim();return React.createElement("div",{key:o},React.createElement("label",{className:"form-label small text-muted mb-1"},o),React.createElement("select",{className:"form-select",value:g,onChange:m=>{const l=String(m.target.value||"").trim();Ge(u=>{const k=Array.isArray(u.items)?[...u.items]:[],B={...k[t]||{}},q=Ht(B.product_id),Te=la(q==null?void 0:q.variants),Me=B!=null&&B.variant_json&&typeof B.variant_json=="object"?{...B.variant_json}:{};l?Me[o]=l:delete Me[o];const rt=ln(Me),Fe=Ta(q,Me);return k[t]={...B,variant_json:Object.keys(Me).length?Me:null,variant:rt,unit_price:Fe},{...u,items:k}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",o," --"),(Array.isArray(i==null?void 0:i.options)?i.options:[]).map(m=>React.createElement("option",{key:m.label,value:m.label},m.label,Number.isFinite(Number(m==null?void 0:m.price))?` (${We(Number(m.price))})`:Number(m==null?void 0:m.price_delta)?` (${m.price_delta>0?"+":""}${m.price_delta})`:""))))}))})(),tt&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${t}`,checked:!!wa[t],onChange:a=>{const n=!!a.target.checked;Kt(s=>{const i=Array.isArray(s)?[...s]:[],d=Array.isArray(S.items)?S.items.length:0;for(;i.length<d;)i.push(!0);return i[t]=n,i})},disabled:b||V}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${t}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const n=a.target.value;Ge(s=>{const i=Array.isArray(s.items)?[...s.items]:[];return i[t]={...i[t]||{product_id:""},quantity:n},{...s,items:i}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const a=(n=Ve.items)==null?void 0:n[t];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{Ge(a=>{const n=Array.isArray(a.items)?[...a.items]:[];return n.splice(t,1),{...a,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),aa(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(t,1),n.length?n:[""]}),Kt(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(t,1),n}),na(a=>a==null?a:a===t?null:a>t?a-1:a)},disabled:b||V||(Array.isArray(S.items)?S.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const t=(Array.isArray(S.items)?S.items:[]).filter(o=>o==null?void 0:o.product_id),a=Fa(t),n=Ka(t),s=xn(S),i=s.amount,d=a+(n.found?n.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},We(a))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},We(n.fee))),!!Ve.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Ve.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},We(i))),(S.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(S.note||"").trim()),!!s.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",s.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},We(d)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Mn,disabled:b||V,style:{borderRadius:10}},"H\u1EE7y"),!!tt&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:us,disabled:b||V,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!tt&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>mn({mode:"new",origin:"modal"}),disabled:b||!Ve.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:b||V||!Ve.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

