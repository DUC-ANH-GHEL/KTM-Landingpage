const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:p,error:i}){const[S,T]=useState(""),[v,n]=useState(""),[l,C]=useState(!1),[w,b]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),i&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),i),React.createElement("form",{onSubmit:async V=>{V.preventDefault(),C(!0),await p(S,v),C(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:S,onChange:V=>T(V.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:w?"text":"password",className:"form-control",value:v,onChange:V=>n(V.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>b(!w)},React.createElement("i",{className:`fas fa-eye${w?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:l},l?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:p,type:i,onClose:S}){return useEffect(()=>{const T=setTimeout(S,3e3);return()=>clearTimeout(T)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${i} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},p),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:S})))}function Loading({show:p}){return p?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:p,onMenuChange:i,onLogout:S,currentUser:T}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(n=>React.createElement("a",{key:n.id,href:"#",className:`nav-link ${p===n.id?"active":""} ${n.disabled?"opacity-50":""} ${n.highlight?"text-warning":""}`,onClick:l=>{l.preventDefault(),n.disabled||i(n.id)}},React.createElement("i",{className:`fas ${n.icon}`})," ",n.label,n.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),n.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),S&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:S,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:p,onSelect:i,onCreate:S,onEdit:T,onDelete:v,loading:n,currentFolder:l,onBack:C,breadcrumb:w}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},l&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:C},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),l?l.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:S},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),w&&w.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),C("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),w.map((b,D)=>React.createElement("li",{key:b.id,className:`breadcrumb-item ${D===w.length-1?"active":""}`},D===w.length-1?b.title:React.createElement("a",{href:"#",onClick:V=>{V.preventDefault(),C(b)},className:"text-warning"},b.title))))),n?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):p.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},l?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},p.map(b=>React.createElement("div",{key:b.uuid||b.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>i(b)},b.cover?React.createElement("img",{src:b.cover,className:"album-cover",alt:b.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},b.title),React.createElement("small",{className:"text-muted"},b.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),b.subfolderCount),b.subfolderCount>0&&b.count>0&&" \u2022 ",b.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),b.count),b.subfolderCount===0&&b.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:D=>{D.stopPropagation(),T(b)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:D=>{D.stopPropagation(),v(b)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:p,album:i,onClose:S,onSave:T,parentId:v}){const[n,l]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[C,w]=useState(!1),[b,D]=useState(!1),V=useRef(null);useEffect(()=>{l(i?{slug:i.id||"",title:i.title||"",description:i.description||"",cover_url:i.cover||"",parent_id:i.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:v||null})},[i,p,v]);const N=async u=>{u.preventDefault(),w(!0),await T(n),w(!1)},k=u=>u.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),I=async u=>{const q=u.type==="image/heic"||u.type==="image/heif"||/\.heic$/i.test(u.name);if(u.size<=2097152&&!q)return u;try{const Q=await createImageBitmap(u),H=document.createElement("canvas");let d=Q.width,j=Q.height;const P=800;return(d>P||j>P)&&(d>j?(j=Math.round(j/d*P),d=P):(d=Math.round(d/j*P),j=P)),H.width=d,H.height=j,H.getContext("2d").drawImage(Q,0,0,d,j),Q.close(),new Promise((Y,M)=>{H.toBlob(U=>{U?Y(new File([U],u.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):M(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Q){throw console.error("Compress cover error:",Q),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},O=async u=>{var Q;const $=u.target.files[0];if(!$)return;if(!($.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test($.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}D(!0);try{const H=await I($),d=new FormData;d.append("file",H),d.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),d.append("folder","ktm-albums/covers");const j=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:d}),P=await j.json();if(!j.ok)throw console.error("Cloudinary error:",P),new Error(((Q=P.error)==null?void 0:Q.message)||"Upload failed");l(h=>({...h,cover_url:P.secure_url}))}catch(H){console.error("Cover upload error:",H),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+H.message)}D(!1),u.target.value=""};return p?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},i?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:S})),React.createElement("form",{onSubmit:N},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:n.title,onChange:u=>l({...n,title:u.target.value,slug:n.slug||k(u.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:n.slug,onChange:u=>l({...n,slug:u.target.value}),required:!0,disabled:!!i}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:n.description,onChange:u=>l({...n,description:u.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},n.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:n.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>l(u=>({...u,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:V,type:"file",accept:"image/*",className:"d-none",onChange:O}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var u;return(u=V.current)==null?void 0:u.click()},disabled:b},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:n.cover_url,onChange:u=>l({...n,cover_url:u.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:S},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:C||b},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:p,allAlbums:i,currentAlbumId:S,targetAlbum:T,onSelect:v,level:n=0}){const[l,C]=useState(!0),w=p.uuid||p.id,b=w===S,D=T===w,V=i.filter(k=>k.parentId===w),N=V.length>0;return React.createElement("div",{style:{marginLeft:n*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${D?"bg-info text-white":b?"bg-light text-muted":"hover-bg"}`,style:{cursor:b?"not-allowed":"pointer",opacity:b?.5:1,transition:"background 0.2s"},onClick:()=>!b&&v(w)},N&&React.createElement("i",{className:`fas fa-chevron-${l?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:k=>{k.stopPropagation(),C(!l)}}),!N&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${D?"-open":""} me-2 ${D?"":"text-warning"}`}),React.createElement("span",{className:"small"},p.title),b&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),p.count>0&&!b&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},p.count)),l&&N&&React.createElement("div",null,V.map(k=>React.createElement(FolderTreeItem,{key:k.uuid||k.id,folder:k,allAlbums:i,currentAlbumId:S,targetAlbum:T,onSelect:v,level:n+1}))))}function AlbumDetail({album:p,onBack:i,onRefresh:S,showToast:T,onNavigateToFolder:v,onEditSubfolder:n,parentAlbum:l}){const[C,w]=useState([]),[b,D]=useState([]),[V,N]=useState(!0),[k,I]=useState(!1),[O,u]=useState(""),[$,q]=useState([]),[Q,H]=useState([]),[d,j]=useState({}),[P,h]=useState(null),[Y,M]=useState(!1),[U,he]=useState(""),[te,Z]=useState(!1),se=useRef(null),K=useRef(null),[ue,oe]=useState(!1),[W,le]=useState([]),[Ne,ce]=useState([]),[ge,$e]=useState(""),[a,e]=useState(!1),o=async(s,f=2)=>{const z=f*1024*1024,de=s.type==="image/heic"||s.type==="image/heif"||/\.heic$/i.test(s.name);if(s.size<=z&&!de)return s;try{const R=await createImageBitmap(s),me=document.createElement("canvas");let we=R.width,be=R.height;const fe=1200;return(we>fe||be>fe)&&(we>be?(be=Math.round(be/we*fe),we=fe):(we=Math.round(we/be*fe),be=fe)),me.width=we,me.height=be,me.getContext("2d").drawImage(R,0,0,we,be),R.close(),new Promise((c,r)=>{me.toBlob(y=>{y?c(new File([y],s.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):r(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(R){throw console.error("Compress error:",R),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{_(),A()},[p.id,p.uuid]);const _=async()=>{N(!0);try{const f=await(await fetch(`${API_BASE}/api/albums/${p.uuid||p.id}`)).json();w(f.images||[]);const de=await(await fetch(`${API_BASE}/api/albums?parent_id=${p.uuid||p.id}`)).json();D(Array.isArray(de)?de:[])}catch(s){console.error(s),T("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}N(!1)},A=async()=>{try{const f=await(await fetch(`${API_BASE}/api/albums`)).json();ce(Array.isArray(f)?f:[])}catch(s){console.error("Error loading albums:",s)}},G=s=>{le(f=>f.includes(s)?f.filter(z=>z!==s):[...f,s])},ne=async()=>{if(!ge||W.length===0){T("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}e(!0);let s=0;for(const f of W)try{(await fetch(`${API_BASE}/api/images/${f}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({album_id:ge})})).ok&&s++}catch(z){console.error("Move error:",z)}e(!1),oe(!1),le([]),$e(""),s>0?(T("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),_(),S()):T("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[F,re]=useState(!1),pe=async()=>{if(W.length===0||!confirm(`X\xF3a ${W.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;re(!0);let s=0;for(const f of W)try{(await fetch(`${API_BASE}/api/images/${f}`,{method:"DELETE"})).ok&&s++}catch(z){console.error("Delete error:",z)}re(!1),le([]),s>0?(T(`\u0110\xE3 x\xF3a ${s} \u1EA3nh!`,"success"),_(),S()):T("X\xF3a th\u1EA5t b\u1EA1i","danger")},J=()=>{W.length===C.length?le([]):le(C.map(s=>s.id))},m=async()=>{if(U.trim()){Z(!0);try{const s=U.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(!(await fetch(`${API_BASE}/api/albums`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:s+"-"+Date.now(),title:U,parent_id:p.uuid||p.id})})).ok)throw new Error("L\u1ED7i t\u1EA1o folder");T("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),he(""),M(!1),_(),S()}catch(s){T(s.message,"danger")}Z(!1)}},ye=async s=>{if(confirm(`X\xF3a folder "${s.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await fetch(`${API_BASE}/api/albums/${s.uuid||s.id}`,{method:"DELETE"}),T("\u0110\xE3 x\xF3a folder","success"),_(),S()}catch(f){T("L\u1ED7i x\xF3a folder","danger")}},Ae=s=>{const f=Array.from(s).filter(z=>z.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(z.name));q(z=>[...z,...f]),f.forEach(z=>{const de=new FileReader;de.onload=R=>{H(me=>[...me,{file:z,preview:R.target.result}])},de.readAsDataURL(z)})},Pe=s=>{q(f=>f.filter((z,de)=>de!==s)),H(f=>f.filter((z,de)=>de!==s))},Fe=async s=>{var de;const f=new FormData;f.append("file",s),f.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),f.append("folder",`ktm-albums/${p.id}`);const z=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:f});if(!z.ok){const R=await z.json();throw console.error("Cloudinary error:",R),new Error(((de=R.error)==null?void 0:de.message)||"Upload failed")}return await z.json()},Ee=async()=>{if($.length===0)return;I(!0);let s=0;for(let f=0;f<$.length;f++)try{u(`\u0110ang x\u1EED l\xFD ${f+1}/${$.length}...`);const z=await o($[f],2);u(`\u0110ang upload ${f+1}/${$.length}...`);const de=await Fe(z);await fetch(`${API_BASE}/api/albums/${p.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:de.secure_url,caption:d[f]||$[f].name.replace(/\.[^/.]+$/,""),sort_order:C.length+f})}),s++}catch(z){console.error("Upload error:",z)}I(!1),u(""),q([]),H([]),j({}),s>0?(T(`\u0110\xE3 upload ${s} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),_(),S()):T("Upload th\u1EA5t b\u1EA1i","danger")},Re=async(s,f)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await fetch(`${API_BASE}/api/images/${s}`,{method:"DELETE"}),T("\u0110\xE3 x\xF3a \u1EA3nh","success"),_(),S()}catch(z){T("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Te=s=>{var f;s.preventDefault(),(f=K.current)==null||f.classList.add("dragover")},Ve=()=>{var s;(s=K.current)==null||s.classList.remove("dragover")},Me=s=>{var f;s.preventDefault(),(f=K.current)==null||f.classList.remove("dragover"),Ae(s.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:i},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},p.title),React.createElement("small",{className:"text-muted"},b.length>0&&React.createElement("span",null,b.length," folder \u2022 "),C.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>M(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),Y&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:U,onChange:s=>he(s.target.value),onKeyPress:s=>s.key==="Enter"&&m(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:m,disabled:te||!U.trim()},te?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{M(!1),he("")}},"H\u1EE7y")))),b.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},b.map(s=>React.createElement("div",{key:s.uuid||s.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>v&&v(s)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},s.title),React.createElement("small",{className:"text-muted"},s.subfolderCount>0&&React.createElement("span",null,s.subfolderCount," folder"),s.subfolderCount>0&&s.count>0&&" \u2022 ",s.count>0&&React.createElement("span",null,s.count," \u1EA3nh"),s.subfolderCount===0&&s.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:f=>{f.stopPropagation(),n&&n(s)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:f=>{f.stopPropagation(),ye(s)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:K,className:"upload-zone",onClick:()=>{var s;return(s=se.current)==null?void 0:s.click()},onDragOver:Te,onDragLeave:Ve,onDrop:Me},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:se,type:"file",multiple:!0,accept:"image/*",onChange:s=>Ae(s.target.files)})),Q.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Q.map((s,f)=>React.createElement("div",{key:f,className:"upload-preview-item"},React.createElement("img",{src:s.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Pe(f)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Ee,disabled:k},k?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),O||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",$.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",C.length,")"),C.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:J},W.length===C.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),W.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},W.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>oe(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:pe,disabled:F},F?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>le([])},React.createElement("i",{className:"fas fa-times"})))),V?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):C.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},C.map((s,f)=>React.createElement("div",{key:f,className:`image-item ${W.includes(s.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>G(s.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:W.includes(s.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:W.includes(s.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},W.includes(s.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:s.src,alt:s.caption,style:{opacity:W.includes(s.id)?.7:1,border:W.includes(s.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:z=>{z.stopPropagation(),Re(s.id,f)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),s.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},s.caption)))))),ue&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",W.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>oe(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},Ne.filter(s=>!s.parentId).map(s=>React.createElement(FolderTreeItem,{key:s.uuid||s.id,folder:s,allAlbums:Ne,currentAlbumId:p.uuid||p.id,targetAlbum:ge,onSelect:$e})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>oe(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ne,disabled:!ge||a},a?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),P&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>h(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>h(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:P.src,alt:P.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:s=>s.stopPropagation()}),P.caption&&React.createElement("div",{className:"text-white text-center mt-2"},P.caption)))))}function SearchCenter({showToast:p,onNavigate:i}){const[S,T]=useState(""),[v,n]=useState([]),[l,C]=useState([]),[w,b]=useState([]),[D,V]=useState("all"),[N,k]=useState(null),[I,O]=useState("list"),[u,$]=useState(!0),[q,Q]=useState([]),[H,d]=useState([]),j=useRef(null),[P,h]=useState(!0),[Y,M]=useState(!1),U=useRef(null),[he,te]=useState(!1),[Z,se]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[K,ue]=useState(""),[oe,W]=useState(!1),le=useRef(null),Ne=useRef(null),[ce,ge]=useState(null),[$e,a]=useState(!1),[e,o]=useState(null),[_,A]=useState(!1),[G,ne]=useState(!1),[F,re]=useState(null),[pe,J]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),m=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ye=t=>{t._type==="product"&&(o(t),J({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||""}),a(!0))},Ae=async()=>{if(e)try{if(!(await fetch(`${API_BASE}/api/products?id=${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(pe)})).ok)throw new Error("L\u1ED7i c\u1EADp nh\u1EADt");p("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),a(!1),o(null),Te()}catch(t){p(t.message,"danger")}},Pe=async t=>{const c=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${c} "${t.name}"?`))try{let r="";if(t._type==="product"?r=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?r=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(r=`${API_BASE}/api/videos/${t.id}`),!(await fetch(r,{method:"DELETE"})).ok)throw new Error("L\u1ED7i x\xF3a");p(`\u0110\xE3 x\xF3a ${c}`,"success"),Te()}catch(r){p(r.message,"danger")}},Fe=async t=>{try{const c=F?`${API_BASE}/api/products?id=${F.id}`:`${API_BASE}/api/products`;if(!(await fetch(c,{method:F?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m");p(F?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ne(!1),re(null),Te()}catch(c){p(c.message,"danger")}},Ee="ktm_admin_data_cache_v1",Re=1e3*60*10,Te=async()=>{let t=null,c=!1;try{const r=localStorage.getItem(Ee);if(r){const y=JSON.parse(r);y&&y.timestamp&&Date.now()-y.timestamp<Re&&Array.isArray(y.data)?(t=y.data,console.log("[CACHE] Using cache, items:",t.length),C(t),n(t),$(!1),c=!0):console.log("[CACHE] Cache expired or invalid")}else console.log("[CACHE] No cache found")}catch(r){console.error("[CACHE] Error parsing cache:",r)}c||$(!0);try{const[r,y,L]=await Promise.all([fetch(`${API_BASE}/api/products`),fetch(`${API_BASE}/api/albums`),fetch(`${API_BASE}/api/video-folders?withVideos=true`)]),[x,g,E]=await Promise.all([r.ok?r.json():[],y.ok?y.json():[],L.ok?L.json():[]]),ee=Array.isArray(x)?x.map(Le=>({...Le,_type:"product",_source:"database"})):[];Q(g);let ae=[];if(Array.isArray(g)&&g.length>0){const Le=g.map(ve=>fetch(`${API_BASE}/api/albums/${ve.id}`)),Oe=await Promise.all(Le);(await Promise.all(Oe.map(ve=>ve.ok?ve.json():{}))).forEach((ve,ze)=>{const He=g[ze];ve.images&&ve.images.length>0&&ve.images.forEach(Ue=>{ae.push({id:Ue.id,name:Ue.caption||"\u1EA2nh t\u1EEB "+He.title,image:Ue.src,folder:He.title,_type:"album",_source:"database"})})})}d(E);let ie=[];Array.isArray(E)&&E.forEach(Le=>{Le.videos&&Le.videos.forEach(Oe=>{ie.push({id:Oe.id,name:Oe.title,folder:Le.name,image:Oe.thumb,youtubeId:Oe.youtubeId,url:Oe.url,_type:"video",_source:"database"})})});const X=[...ee,...ae,...ie];if(!t||JSON.stringify(X)!==JSON.stringify(t)){C(X),n(X);try{localStorage.setItem(Ee,JSON.stringify({data:X,timestamp:Date.now()}))}catch(Le){}}}catch(r){console.error("Song song fetch error:",r)}$(!1)};useEffect(()=>{Te(),setTimeout(()=>{var t;return(t=j.current)==null?void 0:t.focus()},100)},[]);const Ve=async(t,c)=>{if(!(!P||c.length===0)){M(!0);try{const r=c.map(L=>({id:L.id,name:L.name,price:L.price,category:L.category,note:L.note,folder:L.folder,_type:L._type})),y=await fetch(`${API_BASE}/api/ai-search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,products:r})});if(y.ok){const L=await y.json();if(L.matchedIds&&L.matchedIds.length>0){const x=c.filter(g=>L.matchedIds.includes(g.id));x.length>0&&n(x)}else L.matchedIds&&L.matchedIds.length===0&&n([])}}catch(r){console.error("AI Search error:",r)}M(!1)}},Me=t=>{if(T(t),U.current&&clearTimeout(U.current),!t.trim()){s(D);return}const r=t.toLowerCase().split(/\s+/).filter(x=>x.length>0),y=l.filter(x=>{const g=Object.entries(x).filter(([E])=>!E.startsWith("_")).map(([,E])=>String(E||"").toLowerCase()).join(" ");return r.some(E=>g.includes(E))});let L=y;D!=="all"&&(L=y.filter(x=>(x.category||x._type)===D)),n(L),P&&t.length>=3&&(U.current=setTimeout(()=>{Ve(t,L)},500))},s=t=>{V(t);let c=l;if(t!=="all"&&(c=l.filter(r=>(r.category||r._type)===t)),S.trim()){const y=S.toLowerCase().split(/\s+/).filter(L=>L.length>0);c=c.filter(L=>{const x=Object.entries(L).filter(([g])=>!g.startsWith("_")).map(([,g])=>String(g||"").toLowerCase()).join(" ");return y.every(g=>x.includes(g))})}n(c)},f=(t,c)=>{navigator.clipboard.writeText(t).then(()=>{k(c),p("\u0110\xE3 copy!","success"),setTimeout(()=>k(null),1500)})},z=async(t,c)=>{try{const y=await(await fetch(t)).blob();await navigator.clipboard.write([new ClipboardItem({[y.type]:y})]),k(c+"-img"),p("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>k(null),1500)}catch(r){f(t,c+"-img")}},de=t=>{let c=t.toLowerCase();const r=[],y=l.filter(g=>g._type==="product");if(c.includes("ty")||c.includes("xy lanh")){if(c.includes("gi\u1EEFa")||c.includes("giua")){const g=y.find(E=>{var ee;return(ee=E.name)==null?void 0:ee.toLowerCase().includes("xy lanh gi\u1EEFa")});g&&!r.find(E=>E.id===g.id)&&r.push(g)}if(c.includes("nghi\xEAng")||c.includes("nghieng")){const g=y.find(E=>{var ee;return(ee=E.name)==null?void 0:ee.toLowerCase().includes("xy lanh nghi\xEAng")});g&&!r.find(E=>E.id===g.id)&&r.push(g)}if(c.includes("\u1EE7i")||c.includes("ui")){const g=y.find(E=>{var ee;return(ee=E.name)==null?void 0:ee.toLowerCase().includes("xy lanh \u1EE7i")});g&&!r.find(E=>E.id===g.id)&&r.push(g)}}const L=c.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(L){const g=L[1],E=L[2],ee=y.find(ae=>{var X;const ie=((X=ae.name)==null?void 0:X.toLowerCase())||"";return ie.includes("combo")&&ie.includes(`${g} tay`)&&(ie.includes(`${E} xy`)||ie.includes(`${E} xylanh`))});if(ee&&!r.find(ae=>ae.id===ee.id))r.push(ee);else{const ae=y.find(ie=>{var xe;const X=((xe=ie.name)==null?void 0:xe.toLowerCase())||"";return X.includes("combo")&&X.includes(`${g} tay`)});ae&&!r.find(ie=>ie.id===ae.id)&&r.push(ae)}}if(c.includes("combo")&&!L){const g=c.match(/combo.*?(\d+)\s*tay/);if(g){const E=g[1];y.filter(ae=>{var X;const ie=((X=ae.name)==null?void 0:X.toLowerCase())||"";return ie.includes("combo")&&ie.includes(`${E} tay`)}).forEach(ae=>{r.find(ie=>ie.id===ae.id)||r.push(ae)})}}const x=c.match(/van\s*(\d+)\s*tay/);if(x&&!c.includes("ty")&&!c.includes("combo")){const g=x[1],E=y.find(ee=>{var ie;const ae=((ie=ee.name)==null?void 0:ie.toLowerCase())||"";return ae.includes(`van ${g} tay`)&&!ae.includes("combo")});E&&!r.find(ee=>ee.id===E.id)&&r.push(E)}return r.slice(0,4)},R=async t=>{if(!t.trim())return;const c={role:"user",content:t,attachments:[]};se(y=>[...y,c]),ue(""),W(!0);const r=de(t);setTimeout(()=>{var y;return(y=le.current)==null?void 0:y.scrollIntoView({behavior:"smooth"})},100);try{const L=l.filter(X=>X._type==="product").map(X=>{let xe=`- ${X.name}`;return X.code&&(xe+=` (M\xE3: ${X.code})`),X.price&&(xe+=` - Gi\xE1: ${X.price.replace(/[đ\s]/g,"")}\u0111`),X.category&&(xe+=` [${X.category}]`),X.note&&(xe+=` (${X.note})`),xe}).join(`
`),g=Z.slice(-6).map(X=>`${X.role==="user"?"Kh\xE1ch":"AI"}: ${X.content}`).join(`
`),E=g?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${g}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${L}`:L,ee=await fetch(`${API_BASE}/api/ai-chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,context:E,audience:"admin"})}),ae=await ee.json();if(!ee.ok)throw new Error(ae.error||"API error");const ie=ae.response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";se(X=>[...X,{role:"assistant",content:ie,attachments:r}])}catch(y){console.error("AI Error:",y);const L=t.toLowerCase(),x=l.filter(E=>{const ee=Object.values(E).join(" ").toLowerCase();return L.split(" ").some(ae=>ee.includes(ae))});let g="";x.length>0?(g=`T\xECm th\u1EA5y ${x.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,x.slice(0,5).forEach(E=>{g+=`\u2022 ${E.name}`,E.price&&(g+=` - ${E.price.replace(/[đ\s]/g,"")}\u0111`),E.note&&(g+=` (${E.note})`),g+=`
`}),x.length>5&&(g+=`
...v\xE0 ${x.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):g='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',se(E=>[...E,{role:"assistant",content:g,attachments:x.slice(0,4)}])}W(!1),setTimeout(()=>{var y,L;(y=le.current)==null||y.scrollIntoView({behavior:"smooth"}),(L=Ne.current)==null||L.focus()},100)};function me({show:t,product:c,categories:r,onClose:y,onSave:L}){const[x,g]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[E,ee]=useState(!1),[ae,ie]=useState(!1),X=useRef(null),xe=B=>{const Se=B.replace(/[^\d]/g,"");return Se?Se.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""};useEffect(()=>{if(c)if(g({name:c.name||"",code:c.code||"",price:c.price||"",image:c.image||"",category:c.category||"",note:c.note||"",sort_order:c.sort_order||0}),c.price){const B=c.price.replace(/[^\d]/g,"");ve(B),g(Se=>({...Se,price:xe(B)}))}else ve("");else g({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),ve("")},[c,t]);const[Le,Oe]=React.useState(""),[qe,ve]=React.useState(""),ze=B=>{const De=B.target.value.replace(/[^\d]/g,"");if(!De){g({...x,price:""}),ve("");return}if(De===qe&&De.length>0){const Ce=De.slice(0,-1);Ce?(g({...x,price:xe(Ce)}),ve(Ce)):(g({...x,price:""}),ve(""));return}ve(De),g({...x,price:xe(De)})},He=async(B,Se=2)=>{const De=Se*1024*1024;if(B.size<=De)return B;try{const Ce=await createImageBitmap(B),je=document.createElement("canvas");let ke=Ce.width,_e=Ce.height;const Ie=1200;return(ke>Ie||_e>Ie)&&(ke>_e?(_e=Math.round(_e/ke*Ie),ke=Ie):(ke=Math.round(ke/_e*Ie),_e=Ie)),je.width=ke,je.height=_e,je.getContext("2d").drawImage(Ce,0,0,ke,_e),Ce.close(),new Promise((Xe,Qe)=>{je.toBlob(Ke=>{Ke?Xe(new File([Ke],B.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Qe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Ce){throw console.error("Compress error:",Ce),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ue=async B=>{var Ce;const Se=B.target.files[0];if(!Se)return;if(!(Se.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Se.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ie(!0);try{const je=await He(Se),ke=new FormData;ke.append("file",je),ke.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),ke.append("folder","ktm-products");const _e=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:ke}),Ie=await _e.json();if(!_e.ok)throw console.error("Cloudinary error:",Ie),new Error(((Ce=Ie.error)==null?void 0:Ce.message)||"Upload failed");g(Be=>({...Be,image:Ie.secure_url}))}catch(je){console.error("Upload error:",je),alert("L\u1ED7i upload \u1EA3nh: "+je.message)}ie(!1),B.target.value=""},Je=async B=>{B.preventDefault(),ee(!0),await L(x),ee(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),c?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:y})),React.createElement("form",{onSubmit:Je},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:x.name,onChange:B=>g({...x,name:B.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:x.code,onChange:B=>g({...x,code:B.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:x.price,onChange:ze,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:x.category,onChange:B=>g({...x,category:B.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),r.map(B=>React.createElement("option",{key:B,value:B},B)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:x.note,onChange:B=>g({...x,note:B.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},x.image?React.createElement(React.Fragment,null,React.createElement("img",{src:x.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>g({...x,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var B;return(B=X.current)==null?void 0:B.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:X,type:"file",accept:"image/*",className:"d-none",onChange:Ue}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var B;return(B=X.current)==null?void 0:B.click()},disabled:ae,style:{borderRadius:"10px"}},ae?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:x.image,onChange:B=>g({...x,image:B.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:y,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:E,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},E?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const we=(t,c)=>{const r=t._type==="product",y=t._type==="album",L=t._type==="video",x=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale"));return I==="grid"?React.createElement("div",{key:t.id||c,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>ge({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${L?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${r?"product":y?"album":"video"}`},r?"SP":y?"\u1EA2nh":"Video"),x&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:N===t.id+"-img"?"copied":"",onClick:()=>z(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:N===t.id+"-price"?"copied":"",onClick:()=>f(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||c,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${r?"product":y?"album":"video"}`},r?"S\u1EA3n ph\u1EA9m":y?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>ge({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${L?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),x&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),L&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},r&&React.createElement("button",{onClick:()=>i&&i("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),React.createElement("button",{className:N===t.id+"-img"?"copied":"",onClick:()=>z(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})," \u1EA2nh"),t.price&&React.createElement("button",{className:N===t.id+"-price"?"copied":"",onClick:()=>f(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:N===t.id+"-name"?"copied":"",onClick:()=>f(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),L&&t.youtubeId&&React.createElement("button",{className:N===t.id+"-yt"?"copied":"",onClick:()=>f(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),r&&React.createElement("button",{className:"action-edit",onClick:()=>ye(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Pe(t)},React.createElement("i",{className:"fas fa-trash"}))))},[be,fe]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,v.length)," k\u1EBFt qu\u1EA3",P&&S.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),D!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},D==="product"?"S\u1EA3n ph\u1EA9m":D==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${I==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>O("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${I==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>O("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},u?React.createElement("div",null,[...Array(8)].map((t,c)=>React.createElement("div",{key:c,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):v.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',S,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{T(""),Me("")}},"Xem t\u1EA5t c\u1EA3")):I==="grid"?React.createElement("div",{className:"product-grid-mobile"},v.map((t,c)=>we(t,c))):React.createElement("div",null,v.map((t,c)=>we(t,c)))),be&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>fe(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${D==="all"?"active":""}`,onClick:()=>{s("all"),fe(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${D==="product"?"active":""}`,onClick:()=>{s("product"),fe(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${D==="album"?"active":""}`,onClick:()=>{s("album"),fe(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${D==="video"?"active":""}`,onClick:()=>{s("video"),fe(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:P,onChange:t=>h(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:j,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:S,onChange:t=>Me(t.target.value)}),React.createElement("button",{className:`filter-btn ${be||D!=="all"?"active":""}`,onClick:()=>fe(!be)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:_?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>te(!0),onTouchStart:()=>te(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),he&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>te(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},Z.map((t,c)=>React.createElement("div",{key:c,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:N===`chat-${c}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:N===`chat-${c}`?"#fff":"#666"},onClick:()=>{navigator.clipboard.writeText(t.content),k(`chat-${c}`),setTimeout(()=>k(null),1500)}},React.createElement("i",{className:`fas ${N===`chat-${c}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((r,y)=>React.createElement("div",{key:y,style:{width:70},className:"text-center"},r.image&&React.createElement("img",{src:r.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>ge({url:r.image,name:r.name,price:r.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},r.name),r.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},r.price.replace(/[đ\s]/g,""),"\u0111"))))))),oe&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:le})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>R(t),disabled:oe,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),R(K)},className:"chat-input-wrap"},React.createElement("input",{ref:Ne,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:K,onChange:t=>ue(t.target.value),disabled:oe}),React.createElement("button",{type:"submit",className:"send-btn",disabled:oe||!K.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),ce&&React.createElement("div",{className:"preview-modal",onClick:()=>ge(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>ge(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:ce.url,alt:ce.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},ce.name),ce.price&&React.createElement("div",{className:"price"},ce.price.replace(/[đ\s]/g,""),"\u0111"),ce.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},ce.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:N==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:N==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>z(ce.url,"preview")},React.createElement("i",{className:`fas ${N==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),ce.price&&React.createElement("button",{className:N==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>f(ce.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${N==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(me,{show:G,product:F,categories:w,onClose:()=>{ne(!1),re(null)},onSave:Fe}),React.createElement("div",{className:`fab-container mobile-only ${_?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{A(!1),ne(!0),re(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{A(!1),i&&i("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${_?"open":""}`,onClick:()=>A(!_)},React.createElement("i",{className:"fas fa-plus"}))),$e&&e&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>a(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:pe.name,onChange:t=>J({...pe,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:pe.code,onChange:t=>J({...pe,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:pe.price,onChange:t=>J({...pe,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:pe.category,onChange:t=>J({...pe,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),m.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:pe.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>J({...pe,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>a(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:Ae},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:p,showToast:i}){const[S,T]=useState([]),[v,n]=useState([]),[l,C]=useState(!0),[w,b]=useState(null),[D,V]=useState(!1),[N,k]=useState(null),[I,O]=useState(!1),[u,$]=useState(null),[q,Q]=useState(null),[H,d]=useState([]);useEffect(()=>{j()},[]);const j=async(a=null)=>{C(!0);try{const e=a?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${a}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,_=await(await fetch(e)).json();T(Array.isArray(_)?_:[])}catch(e){console.error(e),i("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}C(!1)},P=async a=>{try{const o=await(await fetch(`${API_BASE}/api/videos?folderId=${a}`)).json();n(Array.isArray(o)?o:[])}catch(e){console.error(e)}},h=async a=>{if(a===0)return;const e=[...S];[e[a-1],e[a]]=[e[a],e[a-1]],T(e),await M(e)},Y=async a=>{if(a===S.length-1)return;const e=[...S];[e[a],e[a+1]]=[e[a+1],e[a]],T(e),await M(e)},M=async a=>{try{await Promise.all(a.map((e,o)=>fetch(`${API_BASE}/api/video-folders/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:o})}))),i("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(e){i("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),j(q==null?void 0:q.id)}},U=async a=>{if(a===0)return;const e=[...v];[e[a-1],e[a]]=[e[a],e[a-1]],n(e),await te(e)},he=async a=>{if(a===v.length-1)return;const e=[...v];[e[a],e[a+1]]=[e[a+1],e[a]],n(e),await te(e)},te=async a=>{try{await Promise.all(a.map((e,o)=>fetch(`${API_BASE}/api/videos/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sort_order:o})}))),i("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(e){i("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),P(w.id)}},Z=()=>{k(null),V(!0)},se=a=>{k(a),V(!0)},K=async a=>{try{!N&&q&&(a.parent_id=q.id);const e=N?`${API_BASE}/api/video-folders/${N.id}`:`${API_BASE}/api/video-folders`;if(!(await fetch(e,{method:N?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw new Error("L\u1ED7i l\u01B0u folder");i(N?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),V(!1),j(q==null?void 0:q.id)}catch(e){i(e.message,"danger")}},ue=async a=>{const e=a.subfolderCount>0?`X\xF3a folder "${a.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${a.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(e))try{await fetch(`${API_BASE}/api/video-folders/${a.id}`,{method:"DELETE"}),i("\u0110\xE3 x\xF3a folder","success"),b(null),j(q==null?void 0:q.id)}catch(o){i("L\u1ED7i x\xF3a folder","danger")}},oe=a=>{a.subfolderCount>0?(d(e=>[...e,a]),Q(a),j(a.id)):(b(a),n(a.videos||[]))},W=a=>{if(a==="root")d([]),Q(null),j(null);else if(a){const e=H.findIndex(o=>o.id===a.id);e>=0&&(d(H.slice(0,e+1)),Q(a),j(a.id))}else{const e=[...H];e.pop();const o=e[e.length-1]||null;d(e),Q(o),j(o==null?void 0:o.id)}},le=()=>{$(null),O(!0)},Ne=a=>{$(a),O(!0)},ce=async a=>{try{a.folder_id=w==null?void 0:w.id;const e=u?`${API_BASE}/api/videos/${u.id}`:`${API_BASE}/api/videos`,o=await fetch(e,{method:u?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!o.ok){const _=await o.json();throw new Error(_.error||"L\u1ED7i l\u01B0u video")}i(u?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),O(!1),j(),w&&P(w.id)}catch(e){i(e.message,"danger")}},ge=async a=>{if(confirm(`X\xF3a video "${a.title}"?`))try{await fetch(`${API_BASE}/api/videos/${a.id}`,{method:"DELETE"}),i("\u0110\xE3 x\xF3a video","success"),j(),w&&P(w.id)}catch(e){i("L\u1ED7i x\xF3a video","danger")}},$e=a=>{const e=`https://www.youtube.com/watch?v=${a.youtubeId}`;navigator.clipboard.writeText(e).then(()=>{i("\u0110\xE3 copy link!","success")}).catch(()=>{i("Kh\xF4ng th\u1EC3 copy link","danger")})};return w?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>b(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${w.slug==="shorts"?"text-danger":"text-warning"}`}),w.name)),React.createElement("button",{className:"btn btn-warning",onClick:le},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),v.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},v.map((a,e)=>React.createElement("div",{key:a.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>U(e),disabled:e===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},e+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>he(e),disabled:e===v.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:a.thumb,className:"card-img-top",alt:a.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${a.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:a.title},a.title),React.createElement("small",{className:"text-muted"},a.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>$e(a),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Ne(a),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>ge(a),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:I,video:u,onClose:()=>O(!1),onSave:ce})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},q&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>W()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),q?q.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:Z},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),H.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:a=>{a.preventDefault(),W("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),H.map((a,e)=>React.createElement("li",{key:a.id,className:`breadcrumb-item ${e===H.length-1?"active":""}`},e===H.length-1?a.name:React.createElement("a",{href:"#",onClick:o=>{o.preventDefault(),W(a)},className:"text-warning"},a.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),l?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):S.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},q?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Z},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",q?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},S.map((a,e)=>{var o,_,A,G;return React.createElement("div",{key:a.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ne=>{ne.stopPropagation(),h(e)},disabled:e===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},e+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ne=>{ne.stopPropagation(),Y(e)},disabled:e===S.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>oe(a),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${a.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},a.name),React.createElement("p",{className:"text-muted mb-0"},a.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),a.subfolderCount," folder"),a.subfolderCount>0&&(a.videoCount>0||((o=a.videos)==null?void 0:o.length)>0)&&" \u2022 ",(a.videoCount>0||((_=a.videos)==null?void 0:_.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),a.videoCount||((A=a.videos)==null?void 0:A.length)||0," videos"),a.subfolderCount===0&&!a.videoCount&&!((G=a.videos)!=null&&G.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ne=>{ne.stopPropagation(),se(a)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ne=>{ne.stopPropagation(),ue(a)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:D,folder:N,onClose:()=>V(!1),onSave:K}))}function VideoFolderModal({show:p,folder:i,onClose:S,onSave:T}){const[v,n]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[l,C]=useState(!1),[w,b]=useState(!1);useEffect(()=>{n(i?{name:i.name||"",description:i.description||"",sortOrder:i.sortOrder||0,coverImage:i.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[i,p]);const D=async N=>{const k=N.target.files[0];if(!k)return;b(!0);const I=new FormData;I.append("file",k),I.append("upload_preset","ktm_unsigned");try{const u=await(await fetch("https://api.cloudinary.com/v1_1/diwxfpt92/image/upload",{method:"POST",body:I})).json();u.secure_url&&n($=>({...$,coverImage:u.secure_url})),localStorage.removeItem(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(O){console.error("Cloudinary upload error:",O),alert("L\u1ED7i upload \u1EA3nh: "+(O.message||O))}finally{b(!1)}},V=async N=>{N.preventDefault(),C(!0),await T(v),C(!1)};return p?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},i?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:S})),React.createElement("form",{onSubmit:V},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:v.name,onChange:N=>n({...v,name:N.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:v.description,onChange:N=>n({...v,description:N.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:v.sortOrder,onChange:N=>n({...v,sortOrder:parseInt(N.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},v.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:v.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>n({...v,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:D,disabled:w}),w&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:v.coverImage,onChange:N=>n({...v,coverImage:N.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:S},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:l},l?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:p}){const[i,S]=useState([]),[T,v]=useState(!0),[n,l]=useState(!1),[C,w]=useState(null),[b,D]=useState(""),[V,N]=useState(""),k=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{I()},[]);const I=async()=>{v(!0);try{const j=await(await fetch(`${API_BASE}/api/products`)).json();S(Array.isArray(j)?j:[])}catch(d){console.error(d),p("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}v(!1)},O=()=>{w(null),l(!0)},u=d=>{w(d),l(!0)},$=async d=>{if(!(!d||!d.includes("cloudinary.com")))try{await fetch(`${API_BASE}/api/products?action=delete-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:d})}),localStorage.removeItem(CACHE_KEY),p(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),I()}catch(j){p("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},q=async d=>{try{const j=C?`${API_BASE}/api/products?id=${C.id}`:`${API_BASE}/api/products`;if(!(await fetch(j,{method:C?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).ok)throw new Error("L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m");p(C?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),l(!1),I()}catch(j){p(j.message,"danger")}},Q=async d=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${d.name}"?`))try{if(!(await fetch(`${API_BASE}/api/products?id=${d.id}`,{method:"DELETE"})).ok)throw new Error("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m");p("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),I()}catch(j){p(j.message,"danger")}},H=i.filter(d=>{const j=!b||d.name.toLowerCase().includes(b.toLowerCase())||d.code&&d.code.toLowerCase().includes(b.toLowerCase()),P=!V||d.category===V;return j&&P});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:O},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:b,onChange:d=>D(d.target.value)})),React.createElement("span",{className:"product-count"},H.length)),React.createElement("select",{className:"form-select",value:V,onChange:d=>N(d.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),k.map(d=>React.createElement("option",{key:d,value:d},d)))),T?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):H.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:O},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},H.map(d=>React.createElement("div",{key:d.id,className:"product-item d-flex align-items-center gap-3"},d.image?React.createElement("img",{src:d.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},d.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},d.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},d.category),d.code&&React.createElement("span",{className:"product-badge bg-secondary"},d.code)),React.createElement("div",{className:"product-price"},d.price?d.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),d.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},d.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>u(d),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>Q(d),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:n,product:C,categories:k,onClose:()=>l(!1),onSave:q}))}function ProductModal({show:p,product:i,categories:S,onClose:T,onSave:v}){const[n,l]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[C,w]=useState(!1),[b,D]=useState(!1);useEffect(()=>{l(i?{name:i.name||"",code:i.code||"",price:i.price||"",image:i.image||"",category:i.category||"",note:i.note||"",sort_order:i.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[i,p]);const[V,N]=React.useState(""),k=h=>{const Y=h.replace(/[^\d]/g,"");return Y?Y.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""},[I,O]=React.useState(""),u=h=>{const M=h.target.value.replace(/[^\d]/g,"");if(!M){l({...n,price:""}),O("");return}if(M===I&&M.length>0){const U=M.slice(0,-1);U?(l({...n,price:k(U)}),O(U)):(l({...n,price:""}),O(""));return}O(M),l({...n,price:k(M)})},[$,q]=React.useState("");React.useEffect(()=>{i!=null&&i.image&&q(i.image)},[i]);const Q=async h=>{if(!(!h||!h.includes("cloudinary.com")))try{await fetch(`${API_BASE}/api/products?action=delete-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:h})})}catch(Y){console.error("Delete cloudinary image error:",Y)}},H=async(h,Y=2,M)=>{const U=Y*1024*1024,he=h.type==="image/heic"||h.type==="image/heif"||/\.heic$/i.test(h.name);if(h.size<=U&&!he)return h;M==null||M("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const te=await createImageBitmap(h);M==null||M("\u0110ang n\xE9n \u1EA3nh...");const Z=document.createElement("canvas");let se=te.width,K=te.height;const ue=1200;return(se>ue||K>ue)&&(se>K?(K=Math.round(K/se*ue),se=ue):(se=Math.round(se/K*ue),K=ue)),Z.width=se,Z.height=K,Z.getContext("2d").drawImage(te,0,0,se,K),te.close(),new Promise((W,le)=>{Z.toBlob(Ne=>{Ne?(M==null||M("Ho\xE0n t\u1EA5t!"),W(new File([Ne],h.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):le(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(te){throw console.error("createImageBitmap error:",te),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},d=async h=>{var U,he;const Y=(U=h.target.files)==null?void 0:U[0];if(!Y)return;if(!(Y.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Y.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}D(!0),N("\u0110ang chu\u1EA9n b\u1ECB...");try{const te=(Y.size/1024/1024).toFixed(1);N(`File ${te}MB - \u0110ang n\xE9n...`);const Z=await H(Y,2,W=>{N(W)}),se=(Z.size/1024/1024).toFixed(1);N(`\u0110\xE3 n\xE9n: ${se}MB - \u0110ang upload...`);const K=new FormData;K.append("file",Z),K.append("upload_preset","ktm_unsigned");const oe=await(await fetch("https://api.cloudinary.com/v1_1/diwxfpt92/image/upload",{method:"POST",body:K})).json();oe.secure_url?(n.image&&n.image!==$&&Q(n.image),l(W=>({...W,image:oe.secure_url})),N("")):(console.error("Cloudinary error:",oe),alert("Upload th\u1EA5t b\u1EA1i: "+(((he=oe.error)==null?void 0:he.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),N(""))}catch(te){console.error("Upload error:",te),alert("L\u1ED7i: "+te.message),N("")}D(!1),h.target.value=""},j=()=>{n.image&&(n.image!==$&&Q(n.image),l(h=>({...h,image:""})))},P=async h=>{h.preventDefault(),w(!0),$&&n.image&&$!==n.image&&await Q($),$&&!n.image&&await Q($),await v(n),w(!1)};return p?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${i?"fa-edit":"fa-plus-circle"} me-2`}),i?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:P},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},n.image?React.createElement(React.Fragment,null,React.createElement("img",{src:n.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:j,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${b?"fa-spinner fa-spin":"fa-camera"} me-1`}),b?V||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:d,disabled:b,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),b&&V&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},V))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:n.name,onChange:h=>l({...n,name:h.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:n.code,onChange:h=>l({...n,code:h.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:n.price,onChange:u,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:n.category,onChange:h=>l({...n,category:h.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),S.map(h=>React.createElement("option",{key:h,value:h},h)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:n.note,onChange:h=>l({...n,note:h.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:n.image,onChange:h=>l({...n,image:h.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:T,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:C,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:p,video:i,onClose:S,onSave:T}){const[v,n]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[l,C]=useState(!1),[w,b]=useState("");useEffect(()=>{i?(n({title:i.title||"",youtube_url:`https://www.youtube.com/watch?v=${i.youtubeId}`,thumbnail_url:i.thumb||"",sort_order:i.sortOrder||0}),b(i.thumb)):(n({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),b(""))},[i,p]);const D=k=>{const I=k.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return I?I[1]:null},V=k=>{n({...v,youtube_url:k});const I=D(k);I&&b(`https://img.youtube.com/vi/${I}/hqdefault.jpg`)},N=async k=>{k.preventDefault(),C(!0),await T(v),C(!1)};return p?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},i?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:S})),React.createElement("form",{onSubmit:N},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:v.youtube_url,onChange:k=>V(k.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),w&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:w,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:v.title,onChange:k=>n({...v,title:k.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:v.sort_order,onChange:k=>n({...v,sort_order:parseInt(k.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:v.thumbnail_url,onChange:k=>n({...v,thumbnail_url:k.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:S},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:l},l?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[p,i]=useState(!1),[S,T]=useState(""),[v,n]=useState(null),[l,C]=useState("search"),[w,b]=useState(null),[D,V]=useState(""),[N,k]=useState([]),[I,O]=useState(null),[u,$]=useState(!1),[q,Q]=useState(null),[H,d]=useState(!0),[j,P]=useState([]),[h,Y]=useState(null),[M,U]=useState([]);useEffect(()=>{const a=localStorage.getItem("ktm_admin_session");if(a)try{const e=JSON.parse(a);e.expiry>Date.now()?(i(!0),n(e.user)):localStorage.removeItem("ktm_admin_session")}catch(e){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{p&&K()},[p]);const he=async(a,e)=>{T("");try{const o=await fetch(`${API_BASE}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:e})}),_=await o.json();if(!o.ok)throw new Error(_.error||"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i");const A={user:_.user,token:_.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(A)),n(_.user),i(!0)}catch(o){T(o.message)}},te=()=>{localStorage.removeItem("ktm_admin_session"),i(!1),n(null),k([]),O(null)},Z=(a,e="success")=>{const o=Date.now();P(_=>[..._,{id:o,message:a,type:e}])},se=a=>{P(e=>e.filter(o=>o.id!==a))},K=async(a=null)=>{d(!0);try{const e=a?`${API_BASE}/api/albums?parent_id=${a}`:`${API_BASE}/api/albums?parent_id=root`,_=await(await fetch(e)).json();k(Array.isArray(_)?_:[])}catch(e){console.error(e),Z("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}d(!1)},ue=()=>{Q(null),$(!0)},oe=a=>{Q(a),$(!0)},W=async a=>{try{const e=q&&q.uuid;!e&&h&&(a.parent_id=h.uuid);const o=e?`${API_BASE}/api/albums/${q.uuid||q.id}`:`${API_BASE}/api/albums`,_=await fetch(o,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!_.ok){const A=await _.json();throw new Error(A.error||(e?"L\u1ED7i c\u1EADp nh\u1EADt":"L\u1ED7i t\u1EA1o"))}Z(e?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),$(!1),K(h==null?void 0:h.uuid)}catch(e){Z(e.message,"danger")}},le=a=>{O(a)},Ne=a=>{if(a==="root")U([]),Y(null),K(null);else if(a){const e=M.findIndex(o=>o.uuid===a.uuid);e>=0&&(U(M.slice(0,e+1)),Y(a),K(a.uuid))}else{const e=[...M];e.pop();const o=e[e.length-1]||null;U(e),Y(o),K(o==null?void 0:o.uuid)}},ce=async a=>{const e=`X\xF3a folder "${a.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(e))try{await fetch(`${API_BASE}/api/albums/${a.uuid||a.id}`,{method:"DELETE"}),Z("\u0110\xE3 x\xF3a","success"),K(h==null?void 0:h.uuid)}catch(o){Z("L\u1ED7i x\xF3a album","danger")}};if(!p)return React.createElement(LoginPage,{onLogin:he,error:S});const ge=()=>{const a=new Date,e=a.getFullYear(),o=String(a.getMonth()+1).padStart(2,"0");return`${e}-${o}`};function $e(){const[a,e]=useState(ge()),[o,_]=useState(!0),[A,G]=useState([]),ne=m=>{if(!m)return 0;const ye=String(m).replace(/[^0-9]/g,"");return ye?Number(ye):0},F=m=>{try{return Number(m||0).toLocaleString("vi-VN")}catch(ye){return String(m||0)}},re=m=>`${F(m)}\u0111`,pe=async()=>{_(!0);try{const ye=await(await fetch(`${API_BASE}/api/orders?month=${encodeURIComponent(a)}`)).json();G(Array.isArray(ye)?ye:[])}catch(m){console.error("Load stats error:",m),G([])}finally{_(!1)}};useEffect(()=>{pe()},[a]);const J=React.useMemo(()=>{const m={pending:0,processing:0,done:0,other:0};let ye=0,Ae=0,Pe=0;const Fe=R=>R.customer_id||R.phone||"unknown",Ee=new Map,Re=new Map,Te=new Map;for(const R of A){const me=Number(R.quantity||0)||0,we=ne(R.product_price),be=me*we;ye+=me,Ae+=be,R.status==="pending"?m.pending+=1:R.status==="processing"?m.processing+=1:R.status==="done"?(m.done+=1,Pe+=be):m.other+=1;const fe=R.product_id||"unknown",t=Ee.get(fe)||{product_id:fe,product_name:R.product_name||"\u2014",product_code:R.product_code||"",orders:0,quantity:0,revenue:0};t.orders+=1,t.quantity+=me,t.revenue+=be,Ee.set(fe,t);const c=Fe(R),r=Re.get(c)||{key:c,customer_name:R.customer_name||"",phone:R.phone||"",orders:0,quantity:0,revenue:0};r.orders+=1,r.quantity+=me,r.revenue+=be,!r.customer_name&&R.customer_name&&(r.customer_name=R.customer_name),!r.phone&&R.phone&&(r.phone=R.phone),Re.set(c,r);const y=R.created_at?new Date(R.created_at):null;if(y&&!Number.isNaN(y.getTime())){const L=`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}-${String(y.getDate()).padStart(2,"0")}`,x=Te.get(L)||{day:L,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};x.orders+=1,x.quantity+=me,x.revenue+=be,R.status==="done"&&(x.doneOrders+=1,x.doneRevenue+=be),Te.set(L,x)}}const Ve=Array.from(Ee.values()).sort((R,me)=>me.revenue-R.revenue),Me=Array.from(Re.values()).sort((R,me)=>me.revenue-R.revenue),s=Array.from(Te.values()).sort((R,me)=>R.day.localeCompare(me.day)),f=Re.size,z=A.length?Math.round(Ae/A.length):0,de=A.length?ye/A.length:0;return{statusCounts:m,totalQty:ye,totalRevenue:Ae,doneRevenue:Pe,products:Ve,customers:Me,days:s,uniqueCustomers:f,avgOrderValue:z,avgQtyPerOrder:de}},[A,a]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:o}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:pe,disabled:o},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:a,onChange:m=>e(m.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),F(A.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),F(J.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),F(J.totalQty)," SL"))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},F(A.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},re(J.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},re(J.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Gi\xE1 tr\u1ECB TB/\u0111\u01A1n"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},re(J.avgOrderValue))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",J.avgQtyPerOrder?J.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},F(J.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},F(J.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},F(J.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},F(J.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,F(J.statusCounts.pending)),React.createElement("td",null,F(J.statusCounts.processing)),React.createElement("td",null,F(J.statusCounts.done)),React.createElement("td",null,F(J.statusCounts.other)),React.createElement("td",null,F(J.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},J.products.slice(0,10).map(m=>React.createElement("div",{key:m.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},m.product_name),React.createElement("div",{className:"text-muted small text-truncate"},m.product_code?`#${m.product_code} \u2022 `:"",F(m.orders)," \u0111\u01A1n \u2022 ",F(m.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},re(m.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,J.products.slice(0,10).map(m=>React.createElement("tr",{key:m.product_id},React.createElement("td",null,m.product_name),React.createElement("td",null,m.product_code||"\u2014"),React.createElement("td",null,F(m.orders)),React.createElement("td",null,F(m.quantity)),React.createElement("td",{className:"fw-semibold"},re(m.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},J.customers.slice(0,10).map(m=>React.createElement("div",{key:m.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},m.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},m.phone||"\u2014"," \u2022 ",F(m.orders)," \u0111\u01A1n \u2022 ",F(m.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},re(m.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,J.customers.slice(0,10).map(m=>React.createElement("tr",{key:m.key},React.createElement("td",null,m.customer_name||"\u2014"),React.createElement("td",null,m.phone||"\u2014"),React.createElement("td",null,F(m.orders)),React.createElement("td",null,F(m.quantity)),React.createElement("td",{className:"fw-semibold"},re(m.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},J.days.map(m=>React.createElement("div",{key:m.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},m.day),React.createElement("div",{className:"text-muted small"},F(m.orders)," \u0111\u01A1n \u2022 ",F(m.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",F(m.doneOrders)," \u2022 ",re(m.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},re(m.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,J.days.map(m=>React.createElement("tr",{key:m.day},React.createElement("td",null,m.day),React.createElement("td",null,F(m.orders)),React.createElement("td",null,F(m.quantity)),React.createElement("td",{className:"fw-semibold"},re(m.revenue)),React.createElement("td",null,F(m.doneOrders)),React.createElement("td",{className:"fw-semibold"},re(m.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:l,onMenuChange:a=>{C(a),a==="albums"&&(Y(null),U([]),K(null))},onLogout:te,currentUser:v}),React.createElement("div",{className:"main-content"},l==="albums"&&!I&&React.createElement(AlbumList,{albums:N,loading:H,currentFolder:h,breadcrumb:M,onSelect:le,onCreate:ue,onEdit:oe,onDelete:ce,onBack:Ne}),l==="search"&&React.createElement(SearchCenter,{showToast:Z,onNavigate:(a,e,o)=>{C(a),a==="orders"&&e==="create"&&(b(Date.now()),V((o==null?void 0:o.productId)||""))}}),l==="albums"&&I&&React.createElement(AlbumDetail,{album:I,parentAlbum:M.length>0?M[M.length-1]:null,onBack:()=>{if(I.parentId){const a=M.findIndex(e=>e.uuid===I.parentId);a>=0?O(M[a]):O(null)}else O(null)},onRefresh:()=>K(h==null?void 0:h.uuid),showToast:Z,onNavigateToFolder:a=>{U(e=>[...e,I]),O(a)},onEditSubfolder:a=>{Q(a),$(!0)}}),l==="videos"&&React.createElement(VideoList,{showToast:Z}),l==="products"&&React.createElement(ProductManager,{showToast:Z}),l==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:w,autoOpenCreateProductId:D}),l==="stats"&&React.createElement($e,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${l==="search"?"active":""}`,onClick:a=>{a.preventDefault(),C("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${l==="albums"?"active":""}`,onClick:a=>{a.preventDefault(),C("albums"),O(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${l==="videos"?"active":""}`,onClick:a=>{a.preventDefault(),C("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${l==="products"?"active":""}`,onClick:a=>{a.preventDefault(),C("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${l==="orders"?"active":""}`,onClick:a=>{a.preventDefault(),C("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${l==="stats"?"active":""}`,onClick:a=>{a.preventDefault(),C("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:u,album:q,parentId:h==null?void 0:h.uuid,onClose:()=>$(!1),onSave:W}),React.createElement("div",{className:"toast-container"},j.map(a=>React.createElement(Toast,{key:a.id,message:a.message,type:a.type,onClose:()=>se(a.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:p,autoOpenCreateProductId:i}){const[S,T]=useState([]),[v,n]=useState(!0),[l,C]=useState(!1),[w,b]=useState(null),[D,V]=useState(""),[N,k]=useState(!1),[I,O]=useState(null),[u,$]=useState({customer_name:"",phone:"",address:"",product_id:"",quantity:1,status:"pending"}),[q,Q]=useState([]),[H,d]=useState(null),j=useRef(null),P=useRef(null),h=useRef(0),Y=3,M=e=>{const o=U(e);return o.length>=9&&o.length<=12},U=e=>e?String(e).replace(/[^0-9]/g,""):"",he=async e=>{const o=U(e);if(!o)return;const _=++h.current;O({status:"loading",phone:o});try{const G=await(await fetch(`${API_BASE}/api/customers?phone=${encodeURIComponent(o)}`)).json();if(h.current!==_)return;if(G&&G.exists&&G.customer){O({status:"found",phone:o,customer:G.customer}),$(ne=>U(ne.phone)!==o?ne:{...ne,customer_name:G.customer.name||ne.customer_name,address:G.customer.address||ne.address});return}O({status:"not-found",phone:o})}catch(A){if(h.current!==_)return;console.error("Customer lookup error:",A),O({status:"error",phone:o})}},te=e=>{const o=U(e);if($(A=>({...A,phone:o})),P.current&&(clearTimeout(P.current),P.current=null),o.length<Y){O(null);return}P.current=setTimeout(()=>{he(o)},350)},Z=()=>{const e=U(u.phone);e.length<Y||he(e)};useEffect(()=>(N?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[N]),useEffect(()=>()=>{P.current&&(clearTimeout(P.current),P.current=null)},[]),useEffect(()=>{W()},[]),useEffect(()=>{le()},[D]),useEffect(()=>{p&&j.current!==p&&(j.current=p,ge(i))},[p]);const se=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e||"",K=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":"bg-light text-dark",ue=React.useMemo(()=>{const e={pending:0,processing:1,done:2},o=A=>A in e?e[A]:99,_=A=>{if(!A)return Number.POSITIVE_INFINITY;const G=new Date(A).getTime();return Number.isFinite(G)?G:Number.POSITIVE_INFINITY};return[...S||[]].sort((A,G)=>{const ne=o(A==null?void 0:A.status),F=o(G==null?void 0:G.status);if(ne!==F)return ne-F;const re=_(A==null?void 0:A.created_at),pe=_(G==null?void 0:G.created_at);if(re!==pe)return re-pe;const J=Number(A==null?void 0:A.id),m=Number(G==null?void 0:G.id);return Number.isFinite(J)&&Number.isFinite(m)?J-m:String((A==null?void 0:A.id)||"").localeCompare(String((G==null?void 0:G.id)||""))})},[S]),oe=e=>{if(!e)return"";const o=new Date(e);if(Number.isNaN(o.getTime()))return String(e);try{return o.toLocaleString("vi-VN")}catch(_){return o.toISOString()}},W=async()=>{try{const o=await(await fetch(`${API_BASE}/api/products`)).json();Q(Array.isArray(o)?o:[])}catch(e){console.error("Load products error:",e),Q([])}},le=async()=>{n(!0);try{let e=`${API_BASE}/api/orders`;D&&(e+=`?month=${D}`);const _=await(await fetch(e)).json();T(Array.isArray(_)?_:[])}catch(e){console.error("Load orders error:",e),T([])}finally{n(!1)}},Ne=async()=>{const e=U(u.phone);if(!u.customer_name||!e||!u.product_id){alert("Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c");return}if(!M(e)){alert("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)");return}C(!0);try{const o=H?"PUT":"POST",_=H?`${API_BASE}/api/orders/${H}`:`${API_BASE}/api/orders`;await fetch(_,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_name:u.customer_name,phone:e,address:u.address,product_id:u.product_id,quantity:Number(u.quantity||1),status:u.status,...H?{id:H}:{}})}),$({customer_name:"",phone:"",address:"",product_id:"",quantity:1,status:"pending"}),d(null),k(!1),le()}finally{C(!1)}},ce=e=>{d(e.id),$({customer_name:e.customer_name||"",phone:U(e.phone||""),address:e.address||"",product_id:e.product_id||"",quantity:Number(e.quantity||1),status:e.status||"pending"}),O(null),k(!0),e.phone&&he(U(e.phone))};function ge(e){d(null),$({customer_name:"",phone:"",address:"",product_id:e||"",quantity:1,status:"pending"}),O(null),k(!0)}const $e=()=>{l||(k(!1),d(null),$({customer_name:"",phone:"",address:"",product_id:"",quantity:1,status:"pending"}),O(null))},a=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){b(e);try{await fetch(`${API_BASE}/api/orders/${e}`,{method:"DELETE"}),le()}finally{b(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:v&&!N||l||!!w}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:ge,disabled:l||!!w},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:D,onChange:e=>V(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),D&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{V("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:v},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:le,disabled:v},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},S.length," \u0111\u01A1n")),v?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):S.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},ue.map(e=>React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"text-muted small text-truncate"},e.phone,e.address?` \u2022 ${e.address}`:"")),React.createElement("span",{className:`badge ${K(e.status)}`},se(e.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:")," ",React.createElement("span",{className:"fw-semibold"},e.product_name||"\u2014")),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},e.quantity)),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",oe(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>ce(e),disabled:l||!!w},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>a(e.id),disabled:l||w===e.id},w===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,ue.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,e.product_name),React.createElement("td",null,e.quantity),React.createElement("td",null,React.createElement("span",{className:`badge ${K(e.status)}`},se(e.status))),React.createElement("td",null,oe(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>ce(e),disabled:l||!!w},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>a(e.id),disabled:l||w===e.id},w===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),N&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),H?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:$e})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ne()}},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:u.customer_name,onChange:e=>$({...u,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",value:u.phone,onChange:e=>te(e.target.value),onBlur:Z,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),(I==null?void 0:I.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(I==null?void 0:I.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(I==null?void 0:I.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(I==null?void 0:I.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:u.status,onChange:e=>$({...u,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:u.address,onChange:e=>$({...u,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("select",{className:"form-select",value:u.product_id,onChange:e=>$({...u,product_id:e.target.value}),required:!0,style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),q.map(e=>React.createElement("option",{key:e.id,value:e.id},e.name)))),React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("input",{type:"number",className:"form-control",value:u.quantity,onChange:e=>$({...u,quantity:e.target.value}),min:"1",style:{borderRadius:10,padding:12}})))),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:$e,disabled:l,style:{borderRadius:10}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:l,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},l?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

