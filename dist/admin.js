const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:d,error:c}){const[h,$]=useState(""),[M,r]=useState(""),[k,x]=useState(!1),[V,v]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),c&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),c),React.createElement("form",{onSubmit:async H=>{H.preventDefault(),x(!0),await d(h,M),x(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:h,onChange:H=>$(H.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:V?"text":"password",className:"form-control",value:M,onChange:H=>r(H.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>v(!V)},React.createElement("i",{className:`fas fa-eye${V?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:k},k?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:d,type:c,onClose:h}){return useEffect(()=>{const $=setTimeout(h,3e3);return()=>clearTimeout($)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${c} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},d),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:h})))}function Loading({show:d}){return d?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:d,onMenuChange:c,onLogout:h,currentUser:$}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(r=>React.createElement("a",{key:r.id,href:"#",className:`nav-link ${d===r.id?"active":""} ${r.disabled?"opacity-50":""} ${r.highlight?"text-warning":""}`,onClick:k=>{k.preventDefault(),r.disabled||c(r.id)}},React.createElement("i",{className:`fas ${r.icon}`})," ",r.label,r.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),r.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),h&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:h,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(d){const c=typeof d=="number"?d:parseFloat(String(d!=null?d:"").trim());return Number.isFinite(c)?Math.max(0,Math.min(100,c)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var d;try{const c=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!c)return{ship_percent:DEFAULT_SHIP_PERCENT};const h=JSON.parse(c);return{ship_percent:normalizeShipPercent((d=h==null?void 0:h.ship_percent)!=null?d:h==null?void 0:h.shipPercent)}}catch(c){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(d){var c;try{const h={ship_percent:normalizeShipPercent((c=d==null?void 0:d.ship_percent)!=null?c:d==null?void 0:d.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(h)),h}catch(h){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var c;const d=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((c=d==null?void 0:d.ship_percent)!=null?c:d==null?void 0:d.shipPercent)}}async function saveAdminSettingsToServer(d){var $,M,r;const c={ship_percent:normalizeShipPercent(($=d==null?void 0:d.ship_percent)!=null?$:d==null?void 0:d.shipPercent)},h=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,c,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((r=(M=h==null?void 0:h.ship_percent)!=null?M:h==null?void 0:h.shipPercent)!=null?r:c.ship_percent)}}function AlbumList({albums:d,onSelect:c,onCreate:h,onEdit:$,onDelete:M,loading:r,currentFolder:k,onBack:x,breadcrumb:V}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},k&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:x},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),k?k.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:h},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),V&&V.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:v=>{v.preventDefault(),x("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),V.map((v,Q)=>React.createElement("li",{key:v.id,className:`breadcrumb-item ${Q===V.length-1?"active":""}`},Q===V.length-1?v.title:React.createElement("a",{href:"#",onClick:H=>{H.preventDefault(),x(v)},className:"text-warning"},v.title))))),r?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):d.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},k?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},d.map(v=>React.createElement("div",{key:v.uuid||v.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>c(v)},v.cover?React.createElement("img",{src:v.cover,className:"album-cover",alt:v.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},v.title),React.createElement("small",{className:"text-muted"},v.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),v.subfolderCount),v.subfolderCount>0&&v.count>0&&" \u2022 ",v.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),v.count),v.subfolderCount===0&&v.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Q=>{Q.stopPropagation(),$(v)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Q=>{Q.stopPropagation(),M(v)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:d,album:c,onClose:h,onSave:$,parentId:M}){const[r,k]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[x,V]=useState(!1),[v,Q]=useState(!1),H=useRef(null);useEffect(()=>{k(c?{slug:c.id||"",title:c.title||"",description:c.description||"",cover_url:c.cover||"",parent_id:c.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:M||null})},[c,d,M]);const O=async J=>{J.preventDefault(),V(!0),await $(r),V(!1)},R=J=>J.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Y=async J=>{const ae=J.type==="image/heic"||J.type==="image/heif"||/\.heic$/i.test(J.name);if(J.size<=2097152&&!ae)return J;try{const se=await createImageBitmap(J),oe=document.createElement("canvas");let g=se.width,U=se.height;const ue=800;return(g>ue||U>ue)&&(g>U?(U=Math.round(U/g*ue),g=ue):(g=Math.round(g/U*ue),U=ue)),oe.width=g,oe.height=U,oe.getContext("2d").drawImage(se,0,0,g,U),se.close(),new Promise((ge,z)=>{oe.toBlob(l=>{l?ge(new File([l],J.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):z(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(se){throw console.error("Compress cover error:",se),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ie=async J=>{var se;const Z=J.target.files[0];if(!Z)return;if(!(Z.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Z.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Q(!0);try{const oe=await Y(Z),g=await window.KTM.cloudinary.uploadImage({file:oe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!g.secure_url)throw console.error("Cloudinary error:",g),new Error(((se=g.error)==null?void 0:se.message)||"Upload failed");k(U=>({...U,cover_url:g.secure_url}))}catch(oe){console.error("Cover upload error:",oe),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+oe.message)}Q(!1),J.target.value=""};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:h})),React.createElement("form",{onSubmit:O},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:r.title,onChange:J=>k({...r,title:J.target.value,slug:r.slug||R(J.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:r.slug,onChange:J=>k({...r,slug:J.target.value}),required:!0,disabled:!!c}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:r.description,onChange:J=>k({...r,description:J.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},r.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:r.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>k(J=>({...J,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:H,type:"file",accept:"image/*",className:"d-none",onChange:ie}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var J;return(J=H.current)==null?void 0:J.click()},disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:r.cover_url,onChange:J=>k({...r,cover_url:J.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:h},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:x||v},x?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:d,allAlbums:c,currentAlbumId:h,targetAlbum:$,onSelect:M,level:r=0}){const[k,x]=useState(!0),V=d.uuid||d.id,v=V===h,Q=$===V,H=c.filter(R=>R.parentId===V),O=H.length>0;return React.createElement("div",{style:{marginLeft:r*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Q?"bg-info text-white":v?"bg-light text-muted":"hover-bg"}`,style:{cursor:v?"not-allowed":"pointer",opacity:v?.5:1,transition:"background 0.2s"},onClick:()=>!v&&M(V)},O&&React.createElement("i",{className:`fas fa-chevron-${k?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:R=>{R.stopPropagation(),x(!k)}}),!O&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Q?"-open":""} me-2 ${Q?"":"text-warning"}`}),React.createElement("span",{className:"small"},d.title),v&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),d.count>0&&!v&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},d.count)),k&&O&&React.createElement("div",null,H.map(R=>React.createElement(FolderTreeItem,{key:R.uuid||R.id,folder:R,allAlbums:c,currentAlbumId:h,targetAlbum:$,onSelect:M,level:r+1}))))}function AlbumDetail({album:d,onBack:c,onRefresh:h,showToast:$,onNavigateToFolder:M,onEditSubfolder:r,parentAlbum:k}){const[x,V]=useState([]),[v,Q]=useState([]),[H,O]=useState(!0),[R,Y]=useState(!1),[ie,J]=useState(""),[Z,ae]=useState([]),[se,oe]=useState([]),[g,U]=useState({}),[ue,_]=useState(null),[ge,z]=useState(!1),[l,ne]=useState(""),[pe,$e]=useState(!1),Ce=useRef(null),X=useRef(null),[Ae,fe]=useState(!1),[he,te]=useState([]),[qe,De]=useState([]),[Ie,nt]=useState(""),[n,u]=useState(!1),ve=async(o,L=2)=>{const re=L*1024*1024,He=o.type==="image/heic"||o.type==="image/heif"||/\.heic$/i.test(o.name);if(o.size<=re&&!He)return o;try{const Re=await createImageBitmap(o),Le=document.createElement("canvas");let Je=Re.width,Qe=Re.height;const Ue=1200;return(Je>Ue||Qe>Ue)&&(Je>Qe?(Qe=Math.round(Qe/Je*Ue),Je=Ue):(Je=Math.round(Je/Qe*Ue),Qe=Ue)),Le.width=Je,Le.height=Qe,Le.getContext("2d").drawImage(Re,0,0,Je,Qe),Re.close(),new Promise((st,lt)=>{Le.toBlob(Fe=>{Fe?st(new File([Fe],o.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):lt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Re){throw console.error("Compress error:",Re),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{p(),j()},[d.id,d.uuid]);const p=async()=>{O(!0);try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${d.uuid||d.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");V(o.images||[]);const L=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${d.uuid||d.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Q(Array.isArray(L)?L:[])}catch(o){console.error(o),$("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}O(!1)},j=async()=>{try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");De(Array.isArray(o)?o:[])}catch(o){console.error("Error loading albums:",o)}},W=o=>{te(L=>L.includes(o)?L.filter(re=>re!==o):[...L,o])},ke=async()=>{if(!Ie||he.length===0){$("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}u(!0);let o=0;for(const L of he)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${L}`,{album_id:Ie},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),o++}catch(re){console.error("Move error:",re)}u(!1),fe(!1),te([]),nt(""),o>0?($("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),p(),h()):$("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Ke,je]=useState(!1),Se=async()=>{if(he.length===0||!confirm(`X\xF3a ${he.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;je(!0);let o=0;for(const L of he)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${L}`,"L\u1ED7i x\xF3a \u1EA3nh"),o++}catch(re){console.error("Delete error:",re)}je(!1),te([]),o>0?($(`\u0110\xE3 x\xF3a ${o} \u1EA3nh!`,"success"),p(),h()):$("X\xF3a th\u1EA5t b\u1EA1i","danger")},Ve=()=>{he.length===x.length?te([]):te(x.map(o=>o.id))},tt=async()=>{if(l.trim()){$e(!0);try{const o=l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:o+"-"+Date.now(),title:l,parent_id:d.uuid||d.id},"L\u1ED7i t\u1EA1o folder"),$("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),ne(""),z(!1),p(),h()}catch(o){$(o.message,"danger")}$e(!1)}},bt=async o=>{if(confirm(`X\xF3a folder "${o.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${o.uuid||o.id}`,"L\u1ED7i x\xF3a folder"),$("\u0110\xE3 x\xF3a folder","success"),p(),h()}catch(L){$("L\u1ED7i x\xF3a folder","danger")}},at=o=>{const L=Array.from(o).filter(re=>re.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(re.name));ae(re=>[...re,...L]),L.forEach(re=>{const He=new FileReader;He.onload=Re=>{oe(Le=>[...Le,{file:re,preview:Re.target.result}])},He.readAsDataURL(re)})},Te=o=>{ae(L=>L.filter((re,He)=>He!==o)),oe(L=>L.filter((re,He)=>He!==o))},le=async o=>{var re;const L=await window.KTM.cloudinary.uploadImage({file:o,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${d.id}`});if(!L.secure_url)throw console.error("Cloudinary error:",L),new Error(((re=L.error)==null?void 0:re.message)||"Upload failed");return L},Me=async()=>{if(Z.length===0)return;Y(!0);let o=0;for(let L=0;L<Z.length;L++)try{J(`\u0110ang x\u1EED l\xFD ${L+1}/${Z.length}...`);const re=await ve(Z[L],2);J(`\u0110ang upload ${L+1}/${Z.length}...`);const He=await le(re);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${d.id}`,{url:He.secure_url,caption:g[L]||Z[L].name.replace(/\.[^/.]+$/,""),sort_order:x.length+L},"L\u1ED7i l\u01B0u \u1EA3nh"),o++}catch(re){console.error("Upload error:",re)}Y(!1),J(""),ae([]),oe([]),U({}),o>0?($(`\u0110\xE3 upload ${o} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),p(),h()):$("Upload th\u1EA5t b\u1EA1i","danger")},Ne=async(o,L)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${o}`,"L\u1ED7i x\xF3a \u1EA3nh"),$("\u0110\xE3 x\xF3a \u1EA3nh","success"),p(),h()}catch(re){$("L\u1ED7i x\xF3a \u1EA3nh","danger")}},ce=o=>{var L;o.preventDefault(),(L=X.current)==null||L.classList.add("dragover")},C=()=>{var o;(o=X.current)==null||o.classList.remove("dragover")},We=o=>{var L;o.preventDefault(),(L=X.current)==null||L.classList.remove("dragover"),at(o.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:c},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},d.title),React.createElement("small",{className:"text-muted"},v.length>0&&React.createElement("span",null,v.length," folder \u2022 "),x.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>z(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ge&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:l,onChange:o=>ne(o.target.value),onKeyPress:o=>o.key==="Enter"&&tt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:tt,disabled:pe||!l.trim()},pe?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{z(!1),ne("")}},"H\u1EE7y")))),v.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},v.map(o=>React.createElement("div",{key:o.uuid||o.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>M&&M(o)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},o.title),React.createElement("small",{className:"text-muted"},o.subfolderCount>0&&React.createElement("span",null,o.subfolderCount," folder"),o.subfolderCount>0&&o.count>0&&" \u2022 ",o.count>0&&React.createElement("span",null,o.count," \u1EA3nh"),o.subfolderCount===0&&o.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:L=>{L.stopPropagation(),r&&r(o)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:L=>{L.stopPropagation(),bt(o)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:X,className:"upload-zone",onClick:()=>{var o;return(o=Ce.current)==null?void 0:o.click()},onDragOver:ce,onDragLeave:C,onDrop:We},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:Ce,type:"file",multiple:!0,accept:"image/*",onChange:o=>at(o.target.files)})),se.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},se.map((o,L)=>React.createElement("div",{key:L,className:"upload-preview-item"},React.createElement("img",{src:o.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Te(L)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Me,disabled:R},R?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),ie||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Z.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",x.length,")"),x.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Ve},he.length===x.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),he.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},he.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>fe(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Se,disabled:Ke},Ke?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>te([])},React.createElement("i",{className:"fas fa-times"})))),H?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):x.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},x.map((o,L)=>React.createElement("div",{key:L,className:`image-item ${he.includes(o.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>W(o.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:he.includes(o.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:he.includes(o.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},he.includes(o.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:o.src,alt:o.caption,style:{opacity:he.includes(o.id)?.7:1,border:he.includes(o.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:re=>{re.stopPropagation(),Ne(o.id,L)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),o.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},o.caption)))))),Ae&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",he.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>fe(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},qe.filter(o=>!o.parentId).map(o=>React.createElement(FolderTreeItem,{key:o.uuid||o.id,folder:o,allAlbums:qe,currentAlbumId:d.uuid||d.id,targetAlbum:Ie,onSelect:nt})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>fe(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ke,disabled:!Ie||n},n?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),ue&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>_(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>_(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:ue.src,alt:ue.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:o=>o.stopPropagation()}),ue.caption&&React.createElement("div",{className:"text-white text-center mt-2"},ue.caption)))))}function SearchCenter({showToast:d,onNavigate:c}){const[h,$]=useState(""),[M,r]=useState([]),[k,x]=useState([]),[V,v]=useState([]),[Q,H]=useState("all"),[O,R]=useState(null),[Y,ie]=useState("list"),[J,Z]=useState(!0),[ae,se]=useState([]),[oe,g]=useState([]),U=useRef(null),[ue,_]=useState(!0),[ge,z]=useState(!1),l=useRef(null),[ne,pe]=useState(!1),[$e,Ce]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[X,Ae]=useState(""),[fe,he]=useState(!1),te=useRef(null),qe=useRef(null),[De,Ie]=useState(null),[nt,n]=useState(!1),[u,ve]=useState(null),[p,j]=useState(!1),[W,ke]=useState(!1),[Ke,je]=useState(null),[Se,Ve]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),tt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],bt=t=>{var f,y;t._type==="product"&&(ve(t),Ve({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||"",commission_percent:(y=(f=t.commission_percent)!=null?f:t.commissionPercent)!=null?y:""}),n(!0))},at=async()=>{if(u)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${u.id}`,Se,"L\u1ED7i c\u1EADp nh\u1EADt"),d("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),n(!1),ve(null),ce()}catch(t){d(t.message,"danger")}},Te=async t=>{const f=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${f} "${t.name}"?`))try{let y="";t._type==="product"?y=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?y=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(y=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(y,"L\u1ED7i x\xF3a"),d(`\u0110\xE3 x\xF3a ${f}`,"success"),ce()}catch(y){d(y.message,"danger")}},le=async t=>{try{const f=Ke?`${API_BASE}/api/products?id=${Ke.id}`:`${API_BASE}/api/products`;Ke?await window.KTM.api.putJSON(f,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(f,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),d(Ke?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ke(!1),je(null),ce()}catch(f){d(f.message,"danger")}},Me="ktm_admin_data_cache_v1",Ne=1e3*60*10,ce=async()=>{let t=null,f=!1;const y=window.KTM.cache.read(Me,{ttlMs:Ne,validate:Array.isArray});y.hit?(t=y.value,console.log("[CACHE] Using cache, items:",t.length),x(t),r(t),Z(!1),f=!0):y.status==="miss"?console.log("[CACHE] No cache found"):y.status==="expired"||y.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):y.status==="error"&&console.error("[CACHE] Error parsing cache"),f||Z(!0);try{const A=async(ye,we)=>{try{const Pe=await window.KTM.api.getJSON(ye,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Pe!=null?Pe:we}catch(Pe){return we}},[D,N,b]=await Promise.all([A(`${API_BASE}/api/products`,[]),A(`${API_BASE}/api/albums`,[]),A(`${API_BASE}/api/video-folders?withVideos=true`,[])]),I=Array.isArray(D)?D.map(ye=>({...ye,_type:"product",_source:"database"})):[];se(N);let F=[];Array.isArray(N)&&N.length>0&&(await Promise.all(N.map(we=>A(`${API_BASE}/api/albums/${we.id}`,{})))).forEach((we,Pe)=>{const Xe=N[Pe];we.images&&we.images.length>0&&we.images.forEach(Oe=>{F.push({id:Oe.id,name:Oe.caption||"\u1EA2nh t\u1EEB "+Xe.title,image:Oe.src,folder:Xe.title,_type:"album",_source:"database"})})}),g(b);let w=[];Array.isArray(b)&&b.forEach(ye=>{ye.videos&&ye.videos.forEach(we=>{w.push({id:we.id,name:we.title,folder:ye.name,image:we.thumb,youtubeId:we.youtubeId,url:we.url,_type:"video",_source:"database"})})});const K=[...I,...F,...w];(!t||JSON.stringify(K)!==JSON.stringify(t))&&(x(K),r(K),window.KTM.cache.write(Me,K))}catch(A){console.error("Song song fetch error:",A)}Z(!1)};useEffect(()=>{ce(),setTimeout(()=>{var t;return(t=U.current)==null?void 0:t.focus()},100)},[]);const C=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(f){return String(t!=null?t:"").toLowerCase()}},We=t=>{const y=C(t).trim().split(/\s+/).filter(Boolean),A=y.includes("anh"),D=y.includes("video"),N=y.filter(F=>F!=="anh"&&F!=="video"),b=N.join(" "),I=new Set(["product"]);return A&&I.add("album"),D&&I.add("video"),{allowedTypes:I,includeAlbum:A,includeVideo:D,contentTokens:N,cleanedQuery:b}},o=(t,f,y)=>{var ye,we,Pe,Xe,Oe;const A=Array.isArray(f)?f:[],D=C(y).trim();if(!A.length&&!D)return 0;const N=C((ye=t==null?void 0:t.name)!=null?ye:""),b=C((we=t==null?void 0:t.code)!=null?we:""),I=C((Pe=t==null?void 0:t.category)!=null?Pe:""),F=C((Xe=t==null?void 0:t.note)!=null?Xe:""),w=C((Oe=t==null?void 0:t.folder)!=null?Oe:"");if(!`${N} ${b} ${I} ${F} ${w}`.trim())return 0;let B=0;D&&(N===D&&(B+=220),N.includes(D)&&(B+=140),N.startsWith(D)&&(B+=160),b&&b===D&&(B+=180),b&&b.includes(D)&&(B+=90));for(const Be of A){if(!Be)continue;const dt=new RegExp(`(?:^|\\s)${Be.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);N.includes(Be)&&(B+=35),dt.test(N)&&(B+=25),b&&b.includes(Be)&&(B+=20),b&&dt.test(b)&&(B+=10),I&&I.includes(Be)&&(B+=12),w&&w.includes(Be)&&(B+=12),F&&F.includes(Be)&&(B+=6)}return B>0&&N&&(B+=Math.max(0,10-Math.min(10,Math.floor(N.length/10)))),B},L=(t,f,y)=>{const A=Array.isArray(t)?t:[];return A.length?A.map((N,b)=>({it:N,idx:b,score:o(N,f,y)})).sort((N,b)=>b.score!==N.score?b.score-N.score:N.idx-b.idx).map(N=>N.it):[]},re=async(t,f)=>{if(!(!ue||f.length===0)){z(!0);try{const y=f.map(D=>({id:D.id,name:D.name,price:D.price,category:D.category,note:D.note,folder:D.folder,_type:D._type})),A=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:y},"AI Search error");if(A&&A.matchedIds&&A.matchedIds.length>0){const{contentTokens:D,cleanedQuery:N}=We(t),b=new Set(A.matchedIds),I=f.filter(F=>b.has(F.id)).sort((F,w)=>o(w,D,N)-o(F,D,N));I.length>0&&r(I)}else A&&A.matchedIds&&A.matchedIds.length===0&&r([])}catch(y){console.error("AI Search error:",y)}z(!1)}},He=t=>{if($(t),l.current&&clearTimeout(l.current),!t.trim()){Re(Q);return}const{allowedTypes:f,contentTokens:y,cleanedQuery:A}=We(t),D=k.filter(b=>{if(!f.has(b==null?void 0:b._type))return!1;if(y.length===0)return!0;const I=C(Object.entries(b).filter(([F])=>!F.startsWith("_")).map(([,F])=>String(F||"")).join(" "));return y.some(F=>I.includes(F))});let N=D;Q!=="all"&&(N=D.filter(b=>(b.category||b._type)===Q)),r(L(N,y,A)),ue&&A.length>=3&&(l.current=setTimeout(()=>{re(A,N)},500))},Re=t=>{H(t);const{allowedTypes:f,contentTokens:y}=We(h),{cleanedQuery:A}=We(h);let D=k.filter(N=>f.has(N==null?void 0:N._type));t!=="all"&&(D=D.filter(N=>(N.category||N._type)===t)),h.trim()&&y.length>0&&(D=D.filter(N=>{const b=C(Object.entries(N).filter(([I])=>!I.startsWith("_")).map(([,I])=>String(I||"")).join(" "));return y.every(I=>b.includes(I))})),r(L(D,y,A))},Le=(t,f)=>{window.KTM.clipboard.writeText(t).then(()=>{R(f),d("\u0110\xE3 copy!","success"),setTimeout(()=>R(null),1500)})},Je=async(t,f)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),R(f+"-img"),d("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>R(null),1500)}catch(y){Le(t,f+"-img")}},Qe=t=>{let f=t.toLowerCase();const y=[],A=k.filter(b=>b._type==="product");if(f.includes("ty")||f.includes("xy lanh")){if(f.includes("gi\u1EEFa")||f.includes("giua")){const b=A.find(I=>{var F;return(F=I.name)==null?void 0:F.toLowerCase().includes("xy lanh gi\u1EEFa")});b&&!y.find(I=>I.id===b.id)&&y.push(b)}if(f.includes("nghi\xEAng")||f.includes("nghieng")){const b=A.find(I=>{var F;return(F=I.name)==null?void 0:F.toLowerCase().includes("xy lanh nghi\xEAng")});b&&!y.find(I=>I.id===b.id)&&y.push(b)}if(f.includes("\u1EE7i")||f.includes("ui")){const b=A.find(I=>{var F;return(F=I.name)==null?void 0:F.toLowerCase().includes("xy lanh \u1EE7i")});b&&!y.find(I=>I.id===b.id)&&y.push(b)}}const D=f.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(D){const b=D[1],I=D[2],F=A.find(w=>{var B;const K=((B=w.name)==null?void 0:B.toLowerCase())||"";return K.includes("combo")&&K.includes(`${b} tay`)&&(K.includes(`${I} xy`)||K.includes(`${I} xylanh`))});if(F&&!y.find(w=>w.id===F.id))y.push(F);else{const w=A.find(K=>{var ye;const B=((ye=K.name)==null?void 0:ye.toLowerCase())||"";return B.includes("combo")&&B.includes(`${b} tay`)});w&&!y.find(K=>K.id===w.id)&&y.push(w)}}if(f.includes("combo")&&!D){const b=f.match(/combo.*?(\d+)\s*tay/);if(b){const I=b[1];A.filter(w=>{var B;const K=((B=w.name)==null?void 0:B.toLowerCase())||"";return K.includes("combo")&&K.includes(`${I} tay`)}).forEach(w=>{y.find(K=>K.id===w.id)||y.push(w)})}}const N=f.match(/van\s*(\d+)\s*tay/);if(N&&!f.includes("ty")&&!f.includes("combo")){const b=N[1],I=A.find(F=>{var K;const w=((K=F.name)==null?void 0:K.toLowerCase())||"";return w.includes(`van ${b} tay`)&&!w.includes("combo")});I&&!y.find(F=>F.id===I.id)&&y.push(I)}return y.slice(0,4)},Ue=async t=>{if(!t.trim())return;const f={role:"user",content:t,attachments:[]};Ce(A=>[...A,f]),Ae(""),he(!0);const y=Qe(t);setTimeout(()=>{var A;return(A=te.current)==null?void 0:A.scrollIntoView({behavior:"smooth"})},100);try{const D=k.filter(K=>K._type==="product").map(K=>{let B=`- ${K.name}`;return K.code&&(B+=` (M\xE3: ${K.code})`),K.price&&(B+=` - Gi\xE1: ${K.price.replace(/[đ\s]/g,"")}\u0111`),K.category&&(B+=` [${K.category}]`),K.note&&(B+=` (${K.note})`),B}).join(`
`),b=$e.slice(-6).map(K=>`${K.role==="user"?"Kh\xE1ch":"AI"}: ${K.content}`).join(`
`),I=b?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${b}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${D}`:D,w=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:I,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";Ce(K=>[...K,{role:"assistant",content:w,attachments:y}])}catch(A){console.error("AI Error:",A);const D=t.toLowerCase(),N=k.filter(I=>{const F=Object.values(I).join(" ").toLowerCase();return D.split(" ").some(w=>F.includes(w))});let b="";N.length>0?(b=`T\xECm th\u1EA5y ${N.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,N.slice(0,5).forEach(I=>{b+=`\u2022 ${I.name}`,I.price&&(b+=` - ${I.price.replace(/[đ\s]/g,"")}\u0111`),I.note&&(b+=` (${I.note})`),b+=`
`}),N.length>5&&(b+=`
...v\xE0 ${N.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):b='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',Ce(I=>[...I,{role:"assistant",content:b,attachments:N.slice(0,4)}])}he(!1),setTimeout(()=>{var A,D;(A=te.current)==null||A.scrollIntoView({behavior:"smooth"}),(D=qe.current)==null||D.focus()},100)};function it({show:t,product:f,categories:y,onClose:A,onSave:D}){const[N,b]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[I,F]=useState(!1),[w,K]=useState(!1),B=useRef(null),ye=G=>window.KTM.money.formatVNDInputDigits(G);useEffect(()=>{var G,Ee;if(f)if(b({name:f.name||"",code:f.code||"",price:f.price||"",image:f.image||"",category:f.category||"",note:f.note||"",sort_order:f.sort_order||0,commission_percent:(Ee=(G=f.commission_percent)!=null?G:f.commissionPercent)!=null?Ee:5}),f.price){const Ye=window.KTM.money.getDigits(f.price);Oe(Ye),b(de=>({...de,price:ye(Ye)}))}else Oe("");else b({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),Oe("")},[f,t]);const[we,Pe]=React.useState(""),[Xe,Oe]=React.useState(""),Be=G=>{const Ee=window.KTM.money.nextPriceInputState(G.target.value,Xe);Oe(Ee.digits),b({...N,price:Ee.price})},dt=async(G,Ee=2)=>{const Ye=Ee*1024*1024;if(G.size<=Ye)return G;try{const de=await createImageBitmap(G),me=document.createElement("canvas");let xe=de.width,Ze=de.height;const ze=1200;return(xe>ze||Ze>ze)&&(xe>Ze?(Ze=Math.round(Ze/xe*ze),xe=ze):(xe=Math.round(xe/Ze*ze),Ze=ze)),me.width=xe,me.height=Ze,me.getContext("2d").drawImage(de,0,0,xe,Ze),de.close(),new Promise((s,a)=>{me.toBlob(i=>{i?s(new File([i],G.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):a(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(de){throw console.error("Compress error:",de),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},et=async G=>{var de;const Ee=G.target.files[0];if(!Ee)return;if(!(Ee.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Ee.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}K(!0);try{const me=await dt(Ee),xe=await window.KTM.cloudinary.uploadImage({file:me,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!xe.secure_url)throw console.error("Cloudinary error:",xe),new Error(((de=xe.error)==null?void 0:de.message)||"Upload failed");b(Ze=>({...Ze,image:xe.secure_url}))}catch(me){console.error("Upload error:",me),alert("L\u1ED7i upload \u1EA3nh: "+me.message)}K(!1),G.target.value=""},pt=async G=>{G.preventDefault(),F(!0),await D(N),F(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),f?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:pt},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:N.name,onChange:G=>b({...N,name:G.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:N.code,onChange:G=>b({...N,code:G.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:N.price,onChange:Be,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:N.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:G=>b({...N,commission_percent:G.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:N.category,onChange:G=>b({...N,category:G.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),y.map(G=>React.createElement("option",{key:G,value:G},G)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:N.note,onChange:G=>b({...N,note:G.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},N.image?React.createElement(React.Fragment,null,React.createElement("img",{src:N.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>b({...N,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var G;return(G=B.current)==null?void 0:G.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:B,type:"file",accept:"image/*",className:"d-none",onChange:et}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var G;return(G=B.current)==null?void 0:G.click()},disabled:w,style:{borderRadius:"10px"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:N.image,onChange:G=>b({...N,image:G.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:A,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:I,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},I?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const st=(t,f)=>{const y=t._type==="product",A=t._type==="album",D=t._type==="video",N=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale"));return Y==="grid"?React.createElement("div",{key:t.id||f,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>Ie({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${D?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${y?"product":A?"album":"video"}`},y?"SP":A?"\u1EA2nh":"Video"),N&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:O===t.id+"-img"?"copied":"",onClick:()=>Je(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:O===t.id+"-price"?"copied":"",onClick:()=>Le(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||f,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${y?"product":A?"album":"video"}`},y?"S\u1EA3n ph\u1EA9m":A?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>Ie({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${D?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),N&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),D&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},y&&React.createElement("button",{onClick:()=>c&&c("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:O===t.id+"-price"?"copied":"",onClick:()=>Le(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:O===t.id+"-name"?"copied":"",onClick:()=>Le(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),D&&t.youtubeId&&React.createElement("button",{className:O===t.id+"-yt"?"copied":"",onClick:()=>Le(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),y&&React.createElement("button",{className:"action-edit",onClick:()=>bt(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Te(t)},React.createElement("i",{className:"fas fa-trash"}))))},[lt,Fe]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,M.length)," k\u1EBFt qu\u1EA3",ue&&h.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Q!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Q==="product"?"S\u1EA3n ph\u1EA9m":Q==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Y==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ie("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Y==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ie("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},J?React.createElement("div",null,[...Array(8)].map((t,f)=>React.createElement("div",{key:f,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):M.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',h,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{$(""),He("")}},"Xem t\u1EA5t c\u1EA3")):Y==="grid"?React.createElement("div",{className:"product-grid-mobile"},M.map((t,f)=>st(t,f))):React.createElement("div",null,M.map((t,f)=>st(t,f)))),lt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Fe(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Q==="all"?"active":""}`,onClick:()=>{Re("all"),Fe(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Q==="product"?"active":""}`,onClick:()=>{Re("product"),Fe(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Q==="album"?"active":""}`,onClick:()=>{Re("album"),Fe(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Q==="video"?"active":""}`,onClick:()=>{Re("video"),Fe(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:ue,onChange:t=>_(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:U,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:h,onChange:t=>He(t.target.value)}),React.createElement("button",{className:`filter-btn ${lt||Q!=="all"?"active":""}`,onClick:()=>Fe(!lt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:p?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>pe(!0),onTouchStart:()=>pe(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),ne&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>pe(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},$e.map((t,f)=>React.createElement("div",{key:f,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:O===`chat-${f}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:O===`chat-${f}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),R(`chat-${f}`),setTimeout(()=>R(null),1500)}},React.createElement("i",{className:`fas ${O===`chat-${f}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((y,A)=>React.createElement("div",{key:A,style:{width:70},className:"text-center"},y.image&&React.createElement("img",{src:y.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>Ie({url:y.image,name:y.name,price:y.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},y.name),y.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},y.price.replace(/[đ\s]/g,""),"\u0111"))))))),fe&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:te})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Ue(t),disabled:fe,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),Ue(X)},className:"chat-input-wrap"},React.createElement("input",{ref:qe,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:X,onChange:t=>Ae(t.target.value),disabled:fe}),React.createElement("button",{type:"submit",className:"send-btn",disabled:fe||!X.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),De&&React.createElement("div",{className:"preview-modal",onClick:()=>Ie(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>Ie(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:De.url,alt:De.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},De.name),De.price&&React.createElement("div",{className:"price"},De.price.replace(/[đ\s]/g,""),"\u0111"),De.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},De.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:O==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:O==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Je(De.url,"preview")},React.createElement("i",{className:`fas ${O==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),De.price&&React.createElement("button",{className:O==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Le(De.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${O==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(it,{show:W,product:Ke,categories:V,onClose:()=>{ke(!1),je(null)},onSave:le}),React.createElement("div",{className:`fab-container mobile-only ${p?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{j(!1),ke(!0),je(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{j(!1),c&&c("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${p?"open":""}`,onClick:()=>j(!p)},React.createElement("i",{className:"fas fa-plus"}))),nt&&u&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>n(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Se.name,onChange:t=>Ve({...Se,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Se.code,onChange:t=>Ve({...Se,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Se.price,onChange:t=>Ve({...Se,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Se.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:t=>Ve({...Se,commission_percent:t.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Se.category,onChange:t=>Ve({...Se,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),tt.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Se.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>Ve({...Se,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>n(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:at},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:d,showToast:c}){const[h,$]=useState([]),[M,r]=useState([]),[k,x]=useState(!0),[V,v]=useState(null),[Q,H]=useState(!1),[O,R]=useState(null),[Y,ie]=useState(!1),[J,Z]=useState(null),[ae,se]=useState(null),[oe,g]=useState([]);useEffect(()=>{U()},[]);const U=async(n=null)=>{x(!0);try{const u=n?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${n}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,ve=await window.KTM.api.getJSON(u,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");$(Array.isArray(ve)?ve:[])}catch(u){console.error(u),c("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}x(!1)},ue=async n=>{try{const u=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${n}`,"L\u1ED7i t\u1EA3i video");r(Array.isArray(u)?u:[])}catch(u){console.error(u)}},_=async n=>{if(n===0)return;const u=[...h];[u[n-1],u[n]]=[u[n],u[n-1]],$(u),await z(u)},ge=async n=>{if(n===h.length-1)return;const u=[...h];[u[n],u[n+1]]=[u[n+1],u[n]],$(u),await z(u)},z=async n=>{try{await Promise.all(n.map((u,ve)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${u.id}`,{sortOrder:ve},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),c("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(u){c("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),U(ae==null?void 0:ae.id)}},l=async n=>{if(n===0)return;const u=[...M];[u[n-1],u[n]]=[u[n],u[n-1]],r(u),await pe(u)},ne=async n=>{if(n===M.length-1)return;const u=[...M];[u[n],u[n+1]]=[u[n+1],u[n]],r(u),await pe(u)},pe=async n=>{try{await Promise.all(n.map((u,ve)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${u.id}`,{sort_order:ve},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),c("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(u){c("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ue(V.id)}},$e=()=>{R(null),H(!0)},Ce=n=>{R(n),H(!0)},X=async n=>{try{!O&&ae&&(n.parent_id=ae.id);const u=O?`${API_BASE}/api/video-folders/${O.id}`:`${API_BASE}/api/video-folders`;O?await window.KTM.api.putJSON(u,n,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(u,n,"L\u1ED7i l\u01B0u folder"),c(O?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),H(!1),U(ae==null?void 0:ae.id)}catch(u){c(u.message,"danger")}},Ae=async n=>{const u=n.subfolderCount>0?`X\xF3a folder "${n.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${n.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(u))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${n.id}`,"L\u1ED7i x\xF3a folder"),c("\u0110\xE3 x\xF3a folder","success"),v(null),U(ae==null?void 0:ae.id)}catch(ve){c("L\u1ED7i x\xF3a folder","danger")}},fe=n=>{n.subfolderCount>0?(g(u=>[...u,n]),se(n),U(n.id)):(v(n),r(n.videos||[]))},he=n=>{if(n==="root")g([]),se(null),U(null);else if(n){const u=oe.findIndex(ve=>ve.id===n.id);u>=0&&(g(oe.slice(0,u+1)),se(n),U(n.id))}else{const u=[...oe];u.pop();const ve=u[u.length-1]||null;g(u),se(ve),U(ve==null?void 0:ve.id)}},te=()=>{Z(null),ie(!0)},qe=n=>{Z(n),ie(!0)},De=async n=>{try{n.folder_id=V==null?void 0:V.id;const u=J?`${API_BASE}/api/videos/${J.id}`:`${API_BASE}/api/videos`;J?await window.KTM.api.putJSON(u,n,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(u,n,"L\u1ED7i l\u01B0u video"),c(J?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),ie(!1),U(),V&&ue(V.id)}catch(u){c(u.message,"danger")}},Ie=async n=>{if(confirm(`X\xF3a video "${n.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${n.id}`,"L\u1ED7i x\xF3a video"),c("\u0110\xE3 x\xF3a video","success"),U(),V&&ue(V.id)}catch(u){c("L\u1ED7i x\xF3a video","danger")}},nt=n=>{const u=`https://www.youtube.com/watch?v=${n.youtubeId}`;window.KTM.clipboard.writeText(u).then(()=>{c("\u0110\xE3 copy link!","success")}).catch(()=>{c("Kh\xF4ng th\u1EC3 copy link","danger")})};return V?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>v(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${V.slug==="shorts"?"text-danger":"text-warning"}`}),V.name)),React.createElement("button",{className:"btn btn-warning",onClick:te},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),M.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},M.map((n,u)=>React.createElement("div",{key:n.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>l(u),disabled:u===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},u+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>ne(u),disabled:u===M.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:n.thumb,className:"card-img-top",alt:n.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${n.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:n.title},n.title),React.createElement("small",{className:"text-muted"},n.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>nt(n),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>qe(n),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Ie(n),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Y,video:J,onClose:()=>ie(!1),onSave:De})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},ae&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>he()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),ae?ae.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:$e},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),oe.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:n=>{n.preventDefault(),he("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),oe.map((n,u)=>React.createElement("li",{key:n.id,className:`breadcrumb-item ${u===oe.length-1?"active":""}`},u===oe.length-1?n.name:React.createElement("a",{href:"#",onClick:ve=>{ve.preventDefault(),he(n)},className:"text-warning"},n.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),k?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):h.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},ae?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:$e},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",ae?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},h.map((n,u)=>{var ve,p,j,W;return React.createElement("div",{key:n.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ke=>{ke.stopPropagation(),_(u)},disabled:u===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},u+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ke=>{ke.stopPropagation(),ge(u)},disabled:u===h.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>fe(n),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${n.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},n.name),React.createElement("p",{className:"text-muted mb-0"},n.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),n.subfolderCount," folder"),n.subfolderCount>0&&(n.videoCount>0||((ve=n.videos)==null?void 0:ve.length)>0)&&" \u2022 ",(n.videoCount>0||((p=n.videos)==null?void 0:p.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),n.videoCount||((j=n.videos)==null?void 0:j.length)||0," videos"),n.subfolderCount===0&&!n.videoCount&&!((W=n.videos)!=null&&W.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ke=>{ke.stopPropagation(),Ce(n)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ke=>{ke.stopPropagation(),Ae(n)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Q,folder:O,onClose:()=>H(!1),onSave:X}))}function VideoFolderModal({show:d,folder:c,onClose:h,onSave:$}){const[M,r]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[k,x]=useState(!1),[V,v]=useState(!1);useEffect(()=>{r(c?{name:c.name||"",description:c.description||"",sortOrder:c.sortOrder||0,coverImage:c.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[c,d]);const Q=async O=>{const R=O.target.files[0];if(R){v(!0);try{const Y=await window.KTM.cloudinary.uploadImage({file:R,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Y.secure_url&&r(ie=>({...ie,coverImage:Y.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Y){console.error("Cloudinary upload error:",Y),alert("L\u1ED7i upload \u1EA3nh: "+(Y.message||Y))}finally{v(!1)}}},H=async O=>{O.preventDefault(),x(!0),await $(M),x(!1)};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:h})),React.createElement("form",{onSubmit:H},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:M.name,onChange:O=>r({...M,name:O.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:M.description,onChange:O=>r({...M,description:O.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:M.sortOrder,onChange:O=>r({...M,sortOrder:parseInt(O.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},M.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:M.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>r({...M,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Q,disabled:V}),V&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:M.coverImage,onChange:O=>r({...M,coverImage:O.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:h},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:k},k?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:d}){const[c,h]=useState([]),[$,M]=useState(!0),[r,k]=useState(!1),[x,V]=useState(null),[v,Q]=useState(""),[H,O]=useState(""),R=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Y()},[]);const Y=async()=>{M(!0);try{const g=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");h(Array.isArray(g)?g:[])}catch(g){console.error(g),d("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}M(!1)},ie=()=>{V(null),k(!0)},J=g=>{V(g),k(!0)},Z=async g=>{if(!(!g||!g.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:g},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),d(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Y()}catch(U){d("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},ae=async g=>{try{const U=x?`${API_BASE}/api/products?id=${x.id}`:`${API_BASE}/api/products`;x?await window.KTM.api.putJSON(U,g,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(U,g,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),d(x?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),k(!1),Y()}catch(U){d(U.message,"danger")}},se=async g=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${g.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${g.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),d("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Y()}catch(U){d(U.message,"danger")}},oe=c.filter(g=>{const U=!v||g.name.toLowerCase().includes(v.toLowerCase())||g.code&&g.code.toLowerCase().includes(v.toLowerCase()),ue=!H||g.category===H;return U&&ue});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:ie},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:v,onChange:g=>Q(g.target.value)})),React.createElement("span",{className:"product-count"},oe.length)),React.createElement("select",{className:"form-select",value:H,onChange:g=>O(g.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),R.map(g=>React.createElement("option",{key:g,value:g},g)))),$?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):oe.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ie},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},oe.map(g=>React.createElement("div",{key:g.id,className:"product-item d-flex align-items-center gap-3"},g.image?React.createElement("img",{src:g.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},g.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},g.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},g.category),g.code&&React.createElement("span",{className:"product-badge bg-secondary"},g.code)),React.createElement("div",{className:"product-price"},g.price?g.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),g.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},g.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>J(g),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>se(g),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:r,product:x,categories:R,onClose:()=>k(!1),onSave:ae}))}function ProductModal({show:d,product:c,categories:h,onClose:$,onSave:M}){const[r,k]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[x,V]=useState(!1),[v,Q]=useState(!1);useEffect(()=>{var _,ge;k(c?{name:c.name||"",code:c.code||"",price:c.price||"",image:c.image||"",category:c.category||"",note:c.note||"",sort_order:c.sort_order||0,commission_percent:(ge=(_=c.commission_percent)!=null?_:c.commissionPercent)!=null?ge:5}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5})},[c,d]);const[H,O]=React.useState(""),R=_=>window.KTM.money.formatVNDInputDigits(_),[Y,ie]=React.useState(""),J=_=>{const ge=window.KTM.money.nextPriceInputState(_.target.value,Y);ie(ge.digits),k({...r,price:ge.price})},[Z,ae]=React.useState("");React.useEffect(()=>{c!=null&&c.image&&ae(c.image)},[c]);const se=async _=>{if(!(!_||!_.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:_},"L\u1ED7i x\xF3a \u1EA3nh")}catch(ge){console.error("Delete cloudinary image error:",ge)}},oe=async(_,ge=2,z)=>{const l=ge*1024*1024,ne=_.type==="image/heic"||_.type==="image/heif"||/\.heic$/i.test(_.name);if(_.size<=l&&!ne)return _;z==null||z("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const pe=await createImageBitmap(_);z==null||z("\u0110ang n\xE9n \u1EA3nh...");const $e=document.createElement("canvas");let Ce=pe.width,X=pe.height;const Ae=1200;return(Ce>Ae||X>Ae)&&(Ce>X?(X=Math.round(X/Ce*Ae),Ce=Ae):(Ce=Math.round(Ce/X*Ae),X=Ae)),$e.width=Ce,$e.height=X,$e.getContext("2d").drawImage(pe,0,0,Ce,X),pe.close(),new Promise((he,te)=>{$e.toBlob(qe=>{qe?(z==null||z("Ho\xE0n t\u1EA5t!"),he(new File([qe],_.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):te(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(pe){throw console.error("createImageBitmap error:",pe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},g=async _=>{var l,ne;const ge=(l=_.target.files)==null?void 0:l[0];if(!ge)return;if(!(ge.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ge.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Q(!0),O("\u0110ang chu\u1EA9n b\u1ECB...");try{const pe=(ge.size/1024/1024).toFixed(1);O(`File ${pe}MB - \u0110ang n\xE9n...`);const $e=await oe(ge,2,Ae=>{O(Ae)}),Ce=($e.size/1024/1024).toFixed(1);O(`\u0110\xE3 n\xE9n: ${Ce}MB - \u0110ang upload...`);const X=await window.KTM.cloudinary.uploadImage({file:$e,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});X.secure_url?(r.image&&r.image!==Z&&se(r.image),k(Ae=>({...Ae,image:X.secure_url})),O("")):(console.error("Cloudinary error:",X),alert("Upload th\u1EA5t b\u1EA1i: "+(((ne=X.error)==null?void 0:ne.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),O(""))}catch(pe){console.error("Upload error:",pe),alert("L\u1ED7i: "+pe.message),O("")}Q(!1),_.target.value=""},U=()=>{r.image&&(r.image!==Z&&se(r.image),k(_=>({..._,image:""})))},ue=async _=>{_.preventDefault(),V(!0),Z&&r.image&&Z!==r.image&&await se(Z),Z&&!r.image&&await se(Z),await M(r),V(!1)};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${c?"fa-edit":"fa-plus-circle"} me-2`}),c?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:ue},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},r.image?React.createElement(React.Fragment,null,React.createElement("img",{src:r.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:U,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${v?"fa-spinner fa-spin":"fa-camera"} me-1`}),v?H||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:g,disabled:v,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),v&&H&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},H))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:r.name,onChange:_=>k({...r,name:_.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:r.code,onChange:_=>k({...r,code:_.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:r.price,onChange:J,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:r.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:_=>k({...r,commission_percent:_.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:r.category,onChange:_=>k({...r,category:_.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),h.map(_=>React.createElement("option",{key:_,value:_},_)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:r.note,onChange:_=>k({...r,note:_.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:r.image,onChange:_=>k({...r,image:_.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:$,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:x,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},x?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:d,video:c,onClose:h,onSave:$}){const[M,r]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[k,x]=useState(!1),[V,v]=useState("");useEffect(()=>{c?(r({title:c.title||"",youtube_url:`https://www.youtube.com/watch?v=${c.youtubeId}`,thumbnail_url:c.thumb||"",sort_order:c.sortOrder||0}),v(c.thumb)):(r({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),v(""))},[c,d]);const Q=R=>{const Y=R.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Y?Y[1]:null},H=R=>{r({...M,youtube_url:R});const Y=Q(R);Y&&v(`https://img.youtube.com/vi/${Y}/hqdefault.jpg`)},O=async R=>{R.preventDefault(),x(!0),await $(M),x(!1)};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:h})),React.createElement("form",{onSubmit:O},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:M.youtube_url,onChange:R=>H(R.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),V&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:V,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:M.title,onChange:R=>r({...M,title:R.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:M.sort_order,onChange:R=>r({...M,sort_order:parseInt(R.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:M.thumbnail_url,onChange:R=>r({...M,thumbnail_url:R.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:h},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:k},k?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[d,c]=useState(!1),[h,$]=useState(""),[M,r]=useState(null),[k,x]=useState("search"),[V,v]=useState(null),[Q,H]=useState(""),[O,R]=useState([]),[Y,ie]=useState(null),[J,Z]=useState(!1),[ae,se]=useState(null),[oe,g]=useState(!0),[U,ue]=useState([]),[_,ge]=useState(()=>loadAdminSettings()),[z,l]=useState(null),[ne,pe]=useState([]);useEffect(()=>{const p=localStorage.getItem("ktm_admin_session");if(p)try{const j=JSON.parse(p);j.expiry>Date.now()?(c(!0),r(j.user)):localStorage.removeItem("ktm_admin_session")}catch(j){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{d&&fe()},[d]),useEffect(()=>{if(!d)return;let p=!1;return(async()=>{try{const j=await fetchAdminSettingsFromServer();if(p)return;ge(j),saveAdminSettings(j)}catch(j){}})(),()=>{p=!0}},[d]);const $e=async(p,j)=>{$("");try{const W=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:p,password:j},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),ke={user:W.user,token:W.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(ke)),r(W.user),c(!0)}catch(W){$(W.message)}},Ce=()=>{localStorage.removeItem("ktm_admin_session"),c(!1),r(null),R([]),ie(null)},X=(p,j="success")=>{const W=Date.now();ue(ke=>[...ke,{id:W,message:p,type:j}])},Ae=p=>{ue(j=>j.filter(W=>W.id!==p))},fe=async(p=null)=>{g(!0);try{const j=p?`${API_BASE}/api/albums?parent_id=${p}`:`${API_BASE}/api/albums?parent_id=root`,W=await window.KTM.api.getJSON(j,"L\u1ED7i t\u1EA3i danh s\xE1ch album");R(Array.isArray(W)?W:[])}catch(j){console.error(j),X("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}g(!1)},he=()=>{se(null),Z(!0)},te=p=>{se(p),Z(!0)},qe=async p=>{try{const j=ae&&ae.uuid;!j&&z&&(p.parent_id=z.uuid);const W=j?`${API_BASE}/api/albums/${ae.uuid||ae.id}`:`${API_BASE}/api/albums`;j?await window.KTM.api.putJSON(W,p,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(W,p,"L\u1ED7i t\u1EA1o"),X(j?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),Z(!1),fe(z==null?void 0:z.uuid)}catch(j){X(j.message,"danger")}},De=p=>{ie(p)},Ie=p=>{if(p==="root")pe([]),l(null),fe(null);else if(p){const j=ne.findIndex(W=>W.uuid===p.uuid);j>=0&&(pe(ne.slice(0,j+1)),l(p),fe(p.uuid))}else{const j=[...ne];j.pop();const W=j[j.length-1]||null;pe(j),l(W),fe(W==null?void 0:W.uuid)}},nt=async p=>{const j=`X\xF3a folder "${p.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(j))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${p.uuid||p.id}`,"L\u1ED7i x\xF3a album"),X("\u0110\xE3 x\xF3a","success"),fe(z==null?void 0:z.uuid)}catch(W){X("L\u1ED7i x\xF3a album","danger")}};if(!d)return React.createElement(LoginPage,{onLogin:$e,error:h});const n=()=>{const p=new Date,j=p.getFullYear(),W=String(p.getMonth()+1).padStart(2,"0");return`${j}-${W}`};function u(){const[p,j]=useState(()=>{var je;return String((je=_==null?void 0:_.ship_percent)!=null?je:DEFAULT_SHIP_PERCENT)}),[W,ke]=useState(!1);return useEffect(()=>{var je;j(String((je=_==null?void 0:_.ship_percent)!=null?je:DEFAULT_SHIP_PERCENT))},[_==null?void 0:_.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async je=>{je.preventDefault(),ke(!0);const Se=saveAdminSettings({ship_percent:p});try{const Ve=await saveAdminSettingsToServer(Se);ge(Ve),saveAdminSettings(Ve),X("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Ve){ge(Se),X("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{ke(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:p,min:"0",max:"100",step:"0.01",onChange:je=>j(je.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:W},W?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function ve(){const[p,j]=useState(n()),[W,ke]=useState(!0),[Ke,je]=useState([]),[Se,Ve]=useState([]),tt=normalizeShipPercent(_==null?void 0:_.ship_percent),{parseMoney:bt,parseShipFeeFromNote:at,getShipFeeForItems:Te,formatNumber:le,formatVND:Me}=window.KTM.money,Ne=async()=>{ke(!0);try{const[C,We]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(p)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m")]);je(Array.isArray(C)?C:[]),Ve(Array.isArray(We)?We:[])}catch(C){console.error("Load stats error:",C),je([]),Ve([])}finally{ke(!1)}};useEffect(()=>{Ne()},[p]);const ce=React.useMemo(()=>{var F;const C={pending:0,processing:0,done:0,paid:0,other:0};let We=0,o=0,L=0,re=0,He=0,Re=0,Le=0;const Je=w=>w.customer_id||w.phone||"unknown",Qe=w=>window.KTM.orders.getOrderItems(w),Ue=new Map,it=new Map,st=new Map,lt=5,Fe=new Map((Array.isArray(Se)?Se:[]).map(w=>{var we;const K=(we=w==null?void 0:w.commission_percent)!=null?we:w==null?void 0:w.commissionPercent,B=Number(K),ye=Number.isFinite(B)?Math.max(0,Math.min(100,B)):lt;return[String(w==null?void 0:w.id),ye]}));for(const w of Ke){const K=Qe(w);let B=0,ye=0,we=0;for(const me of K){const xe=Number((me==null?void 0:me.quantity)||0)||0,Ze=bt(me==null?void 0:me.product_price),ze=xe*Ze,e=String((me==null?void 0:me.product_id)||""),s=Fe.has(e)?Fe.get(e):lt,a=(Number(s)||0)/100;B+=xe,ye+=ze,we+=ze*a;const i=(me==null?void 0:me.product_id)||"unknown",m=Ue.get(e)||{product_id:i,product_name:(me==null?void 0:me.product_name)||"\u2014",product_code:(me==null?void 0:me.product_code)||"",orders:0,quantity:0,revenue:0};m.orders+=1,m.quantity+=xe,m.revenue+=ze,Ue.set(i,m)}const Pe=Te(K),Xe=Number((F=w==null?void 0:w.adjustment_amount)!=null?F:0)||0,Oe=ye+(Pe.found?Pe.fee:0)+Xe,Be=ye+Xe,dt=!Pe.found&&tt>0&&ye>0?ye*tt/100:0,et=ye>0?we/ye:lt/100,pt=we+Xe*et-dt*et;We+=B,o+=Oe,re+=Be,Re+=pt;const G=w.status==="done"||w.status==="paid";w.status==="pending"?C.pending+=1:w.status==="processing"?C.processing+=1:w.status==="paid"?(C.paid+=1,C.done+=1,L+=Oe,He+=Be,Le+=pt):w.status==="done"?(C.done+=1,L+=Oe,He+=Be,Le+=pt):C.other+=1;const Ee=Je(w),Ye=it.get(Ee)||{key:Ee,customer_name:w.customer_name||"",phone:w.phone||"",orders:0,quantity:0,revenue:0};Ye.orders+=1,Ye.quantity+=B,Ye.revenue+=Oe,!Ye.customer_name&&w.customer_name&&(Ye.customer_name=w.customer_name),!Ye.phone&&w.phone&&(Ye.phone=w.phone),it.set(Ee,Ye);const de=w.created_at?new Date(w.created_at):null;if(de&&!Number.isNaN(de.getTime())){const me=`${de.getFullYear()}-${String(de.getMonth()+1).padStart(2,"0")}-${String(de.getDate()).padStart(2,"0")}`,xe=st.get(me)||{day:me,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};xe.orders+=1,xe.quantity+=B,xe.revenue+=Oe,G&&(xe.doneOrders+=1,xe.doneRevenue+=Oe),st.set(me,xe)}}const t=Array.from(Ue.values()).sort((w,K)=>K.revenue-w.revenue),f=Array.from(it.values()).sort((w,K)=>K.revenue-w.revenue),y=Array.from(st.values()).sort((w,K)=>w.day.localeCompare(K.day)),A=it.size,D=Ke.length?Math.round(o/Ke.length):0,N=Ke.length?We/Ke.length:0,b=Math.round(Le),I=Math.round(Re);return{statusCounts:C,totalQty:We,totalRevenue:o,doneRevenue:L,tempCommission:b,tempCommissionAll:I,products:t,customers:f,days:y,uniqueCustomers:A,avgOrderValue:D,avgQtyPerOrder:N}},[Ke,Se,p]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:W}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:Ne,disabled:W},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:p,onChange:C=>j(C.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",tt,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),le(Ke.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),le(ce.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),le(ce.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",le(ce.statusCounts.paid),"/",le(ce.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},le(Ke.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Me(ce.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Me(ce.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Me(ce.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Me(ce.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",ce.avgQtyPerOrder?ce.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},le(ce.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},le(ce.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},le(ce.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},le(ce.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},le(ce.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,le(ce.statusCounts.pending)),React.createElement("td",null,le(ce.statusCounts.processing)),React.createElement("td",null,le(ce.statusCounts.done)),React.createElement("td",null,le(ce.statusCounts.paid)),React.createElement("td",null,le(ce.statusCounts.other)),React.createElement("td",null,le(ce.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},ce.products.slice(0,10).map(C=>React.createElement("div",{key:C.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.product_name),React.createElement("div",{className:"text-muted small text-truncate"},C.product_code?`#${C.product_code} \u2022 `:"",le(C.orders)," \u0111\u01A1n \u2022 ",le(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Me(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,ce.products.slice(0,10).map(C=>React.createElement("tr",{key:C.product_id},React.createElement("td",null,C.product_name),React.createElement("td",null,C.product_code||"\u2014"),React.createElement("td",null,le(C.orders)),React.createElement("td",null,le(C.quantity)),React.createElement("td",{className:"fw-semibold"},Me(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},ce.customers.slice(0,10).map(C=>React.createElement("div",{key:C.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},C.phone||"\u2014"," \u2022 ",le(C.orders)," \u0111\u01A1n \u2022 ",le(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Me(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,ce.customers.slice(0,10).map(C=>React.createElement("tr",{key:C.key},React.createElement("td",null,C.customer_name||"\u2014"),React.createElement("td",null,C.phone||"\u2014"),React.createElement("td",null,le(C.orders)),React.createElement("td",null,le(C.quantity)),React.createElement("td",{className:"fw-semibold"},Me(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},ce.days.map(C=>React.createElement("div",{key:C.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},C.day),React.createElement("div",{className:"text-muted small"},le(C.orders)," \u0111\u01A1n \u2022 ",le(C.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",le(C.doneOrders)," \u2022 ",Me(C.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Me(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,ce.days.map(C=>React.createElement("tr",{key:C.day},React.createElement("td",null,C.day),React.createElement("td",null,le(C.orders)),React.createElement("td",null,le(C.quantity)),React.createElement("td",{className:"fw-semibold"},Me(C.revenue)),React.createElement("td",null,le(C.doneOrders)),React.createElement("td",{className:"fw-semibold"},Me(C.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:k,onMenuChange:p=>{x(p),p==="albums"&&(l(null),pe([]),fe(null))},onLogout:Ce,currentUser:M}),React.createElement("div",{className:"main-content"},k==="albums"&&!Y&&React.createElement(AlbumList,{albums:O,loading:oe,currentFolder:z,breadcrumb:ne,onSelect:De,onCreate:he,onEdit:te,onDelete:nt,onBack:Ie}),k==="search"&&React.createElement(SearchCenter,{showToast:X,onNavigate:(p,j,W)=>{x(p),p==="orders"&&j==="create"&&(v(Date.now()),H((W==null?void 0:W.productId)||""))}}),k==="albums"&&Y&&React.createElement(AlbumDetail,{album:Y,parentAlbum:ne.length>0?ne[ne.length-1]:null,onBack:()=>{if(Y.parentId){const p=ne.findIndex(j=>j.uuid===Y.parentId);p>=0?ie(ne[p]):ie(null)}else ie(null)},onRefresh:()=>fe(z==null?void 0:z.uuid),showToast:X,onNavigateToFolder:p=>{pe(j=>[...j,Y]),ie(p)},onEditSubfolder:p=>{se(p),Z(!0)}}),k==="videos"&&React.createElement(VideoList,{showToast:X}),k==="products"&&React.createElement(ProductManager,{showToast:X}),k==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:V,autoOpenCreateProductId:Q,showToast:X}),k==="stats"&&React.createElement(ve,null),k==="settings"&&React.createElement(u,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${k==="search"?"active":""}`,onClick:p=>{p.preventDefault(),x("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${k==="albums"?"active":""}`,onClick:p=>{p.preventDefault(),x("albums"),ie(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${k==="videos"?"active":""}`,onClick:p=>{p.preventDefault(),x("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${k==="products"?"active":""}`,onClick:p=>{p.preventDefault(),x("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${k==="orders"?"active":""}`,onClick:p=>{p.preventDefault(),x("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${k==="stats"?"active":""}`,onClick:p=>{p.preventDefault(),x("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:J,album:ae,parentId:z==null?void 0:z.uuid,onClose:()=>Z(!1),onSave:qe}),React.createElement("div",{className:"toast-container"},U.map(p=>React.createElement(Toast,{key:p.id,message:p.message,type:p.type,onClose:()=>Ae(p.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:d,autoOpenCreateProductId:c,showToast:h}){const[$,M]=useState([]),[r,k]=useState(!0),[x,V]=useState(!1),[v,Q]=useState(null),[H,O]=useState(null),[R,Y]=useState(!1),[ie,J]=useState(""),[Z,ae]=useState(""),[se,oe]=useState(!1),[g,U]=useState(null),[ue,_]=useState(!1),[ge,z]=useState([]),[l,ne]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[pe,$e]=useState([""]),[Ce,X]=useState(null),Ae=useRef({}),[fe,he]=useState([]),[te,qe]=useState(null),De=useRef(null),Ie=useRef(null),nt=useRef(0),n=useRef(new Map),u=useRef(""),ve=useRef(null),p=useRef(0),j=useRef(null),W=9,ke=150,Ke=24*60*60*1e3,je=5*60*1e3,Se="ktm_customer_lookup_cache_v1",Ve=200,tt=e=>{ne({customer_name:"",phone:"",address:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),$e([""]),U(null),X(null)};useEffect(()=>{const e=s=>{var i;if(Ce==null)return;const a=(i=Ae.current)==null?void 0:i[Ce];a&&!a.contains(s.target)&&X(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Ce]);const bt=e=>window.KTM.money.parseMoney(e),at=e=>window.KTM.money.parseSignedMoney(e),Te=e=>window.KTM.money.formatVND(e),le=e=>window.KTM.money.parseShipFeeFromNote(e),Me=e=>window.KTM.phone.isValid(e),Ne=e=>window.KTM.phone.normalize(e),ce=()=>{var e;try{const s=localStorage.getItem(Se);if(!s)return;const a=JSON.parse(s);if(!a||typeof a!="object")return;const i=Object.entries(a);for(const[m,T]of i)!m||!T||typeof T!="object"||(e=n.current)==null||e.set(String(m),T)}catch(s){}},C=()=>{try{const e=n.current;if(!e||typeof e.entries!="function")return;const s=Array.from(e.entries()).filter(([i,m])=>i&&m&&typeof m=="object"&&Number.isFinite(m.ts)).sort((i,m)=>(Number(m[1].ts)||0)-(Number(i[1].ts)||0)).slice(0,Ve),a={};for(const[i,m]of s)a[i]=m;localStorage.setItem(Se,JSON.stringify(a))}catch(e){}};useEffect(()=>{ce()},[]);const We=e=>{const s=Ne(e);if(!s)return null;const a=Array.isArray($)?$:[];let i=null,m=-1;for(const T of a){if(!T||Ne(T.phone||"")!==s)continue;const ee=new Date(T.created_at).getTime(),E=Number.isFinite(ee)?ee:0;E>=m&&(m=E,i=T)}return i?{name:String(i.customer_name||"").trim(),address:String(i.address||"").trim()}:null},o=(e,s)=>{e&&ne(a=>s&&Ne(a.phone)!==s?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},L=e=>{const s=We(e);if(!s)return;const a=Ne(e);ne(i=>{if(a&&Ne(i.phone)!==a)return i;const m={...i};return!String(i.customer_name||"").trim()&&s.name&&(m.customer_name=s.name),!String(i.address||"").trim()&&s.address&&(m.address=s.address),m})},re=async e=>{var m,T,ee;const s=Ne(e);if(!s)return;L(s);const a=(m=n.current)==null?void 0:m.get(s);if(a&&Number.isFinite(a.ts)){const E=Date.now()-a.ts,S=a.status==="found"?Ke:je;if(E>=0&&E<=S){U({status:a.status,phone:s,customer:a.customer}),a.status==="found"&&a.customer&&o(a.customer,s);return}}const i=++nt.current;U({status:"loading",phone:s});try{const E=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(s)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(nt.current!==i)return;if(E&&E.exists&&E.customer){(T=n.current)==null||T.set(s,{ts:Date.now(),status:"found",customer:E.customer}),C(),U({status:"found",phone:s,customer:E.customer}),o(E.customer,s);return}(ee=n.current)==null||ee.set(s,{ts:Date.now(),status:"not-found",customer:null}),C(),U({status:"not-found",phone:s})}catch(E){if(nt.current!==i)return;console.error("Customer lookup error:",E),U({status:"error",phone:s})}},He=e=>{const s=Ne(e),a=We(s);ne(m=>{const T={...m,phone:s};return a&&(!String(m.customer_name||"").trim()&&a.name&&(T.customer_name=a.name),!String(m.address||"").trim()&&a.address&&(T.address=a.address)),T}),_(!1),Ie.current&&(clearTimeout(Ie.current),Ie.current=null);const i=s;if(i.length<W){U(null);return}if(Me(i)&&i!==u.current){u.current=i,re(i);return}Ie.current=setTimeout(()=>{const m=Ne(s);Me(m)&&m!==u.current&&(u.current=m,re(m))},ke)},Re=()=>{const e=Ne(l.phone);e.length<W||Me(e)&&e!==u.current&&(u.current=e,re(e))};useEffect(()=>(se?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[se]);const Le=Array.isArray(l.items)?l.items.length:0;useEffect(()=>{if(!se){p.current=Le;return}Le>p.current&&setTimeout(()=>{const e=ve.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),p.current=Le},[se,Le]),useEffect(()=>()=>{Ie.current&&(clearTimeout(Ie.current),Ie.current=null)},[]),useEffect(()=>{lt()},[]),useEffect(()=>{Fe()},[ie]),useEffect(()=>{d&&De.current!==d&&(De.current=d,f(c))},[d]);const Je=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e||"",Qe=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":"bg-light text-dark",Ue=React.useMemo(()=>window.KTM.orders.sortOrders($),[$]),it=React.useMemo(()=>{const e=String(Z||"").trim();return e?(Array.isArray(Ue)?Ue:[]).filter(s=>String((s==null?void 0:s.status)||"").trim()===e):Ue},[Ue,Z]),st=e=>window.KTM.date.formatDateTime(e),lt=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");he(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),he([])}},Fe=async()=>{k(!0);try{let e=`${API_BASE}/api/orders`;ie&&(e+=`?month=${ie}`);const s=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");M(Array.isArray(s)?s:[])}catch(e){console.error("Load orders error:",e),M([])}finally{k(!1)}},t=e=>{var a;qe(e.id);const s=Array.isArray(e.items)&&e.items.length?e.items.map(i=>{var m;return{product_id:(i==null?void 0:i.product_id)||"",quantity:Number((m=i==null?void 0:i.quantity)!=null?m:1)||1}}).filter(i=>i.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];ne({customer_name:e.customer_name||"",phone:Ne(e.phone||""),address:e.address||"",items:s.length?s:[{product_id:"",quantity:1}],adjustment_amount:Number((a=e==null?void 0:e.adjustment_amount)!=null?a:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),$e(new Array(s.length?s.length:1).fill("")),z(new Array(s.length?s.length:1).fill(!0)),U(null),oe(!0),e.phone&&re(Ne(e.phone))};function f(e){qe(null),tt(e||""),_(!1),z([]),oe(!0)}const y=()=>{x||R||(oe(!1),qe(null),tt(""),_(!1),z([]))},A=async()=>{var E,S,q;if(!te||R||x)return;const e=(Array.isArray($)?$:[]).find(P=>String(P==null?void 0:P.id)===String(te))||null,s=String((e==null?void 0:e.status)||(l==null?void 0:l.status)||"").trim();if(s==="done"||s==="paid"){const P="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n.";typeof h=="function"?h(P,"warning"):alert(P);return}const a=Ne(l.phone),m=(Array.isArray(l.items)?l.items:[]).map((P,_e)=>{var be;return{idx:_e,product_id:String((P==null?void 0:P.product_id)||"").trim(),quantity:Number((be=P==null?void 0:P.quantity)!=null?be:0)}}).filter(P=>P.product_id&&Number.isFinite(P.quantity)&&P.quantity>0);if(m.length<2){const P="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof h=="function"?h(P,"warning"):alert(P);return}const T=[],ee=[];for(const P of m){const _e=!!ge[P.idx],be={product_id:P.product_id,quantity:P.quantity};_e?T.push(be):ee.push(be)}if(!T.length||!ee.length){const P="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof h=="function"?h(P,"warning"):alert(P);return}Y(!0);try{const P=at(l.adjustment_amount),_e=(l.adjustment_note||"").trim(),be={customer_name:l.customer_name,phone:a,address:l.address,adjustment_amount:P,adjustment_note:_e,status:"processing",items:T,product_id:T[0].product_id,quantity:T[0].quantity,split_seq:1},ot=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,be,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),ct=(q=(S=ot==null?void 0:ot.id)!=null?S:(E=ot==null?void 0:ot.order)==null?void 0:E.id)!=null?q:null;if(!ct)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const gt={id:te,customer_name:l.customer_name,phone:a,address:l.address,adjustment_amount:0,adjustment_note:"",status:"pending",items:ee,product_id:ee[0].product_id,quantity:ee[0].quantity,parent_order_id:String(ct),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${te}`,gt,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),y(),Fe();const mt=ct?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${ct}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof h=="function"?h(mt,"success"):alert(mt)}catch(P){console.error(P);const _e=(P==null?void 0:P.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof h=="function"?h(_e,"danger"):alert(_e)}finally{Y(!1)}},D=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const s=String(e),a=fe.find(i=>String(i==null?void 0:i.id)===s);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},N=e=>{const s=String(pe[e]||"").trim().toLowerCase();return s?fe.filter(a=>{const i=String((a==null?void 0:a.name)||"").toLowerCase(),m=String((a==null?void 0:a.code)||"").toLowerCase();return i.includes(s)||m.includes(s)}):fe},b=e=>{if(!e)return null;const s=String(e);return fe.find(a=>String(a==null?void 0:a.id)===s)||null},I=e=>window.KTM.orders.getOrderItems(e),F=e=>window.KTM.orders.getOrderTotalQty(e),w=e=>window.KTM.orders.getOrderProductSummary(e,b),K=e=>window.KTM.orders.getOrderItemRows(e,b),B=e=>window.KTM.orders.getOrderAdjustmentMoney(e),ye=e=>{var q;const s=I(e),a=K(e),i=Xe(s),m=Pe(s),T=m.fee,ee=B(e),E=i+T+ee,S=[];if(S.push(`\u0110\u01A0N H\xC0NG #${(q=e==null?void 0:e.id)!=null?q:""}`.trim()),e!=null&&e.customer_name&&S.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&S.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&S.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),e!=null&&e.status&&S.push(`Tr\u1EA1ng th\xE1i: ${Je(e.status)}`),e!=null&&e.created_at&&S.push(`Th\u1EDDi gian: ${st(e.created_at)}`),S.push(""),S.push("S\u1EA3n ph\u1EA9m:"),a.length)for(const P of a)S.push(`- ${P.name} x${P.qty}`);else{const P=w(e);P&&P!=="\u2014"&&S.push(`- ${P}`)}return S.push(""),S.push(`T\u1EA1m t\xEDnh: ${Te(i)}`),S.push(`Ship: ${Te(m.found?T:0)}`),ee!==0&&S.push(`\u0110i\u1EC1u ch\u1EC9nh: ${Te(ee)}`),e!=null&&e.adjustment_note&&S.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),S.push(`T\u1ED5ng: ${Te(E)}`),S.filter(Boolean).join(`
`)},we=async e=>{try{const s=ye(e);await window.KTM.clipboard.writeText(s),typeof h=="function"?h("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(s){console.error(s),typeof h=="function"?h("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Pe=e=>window.KTM.orders.getOrderShipInfo(e,b),Xe=e=>window.KTM.orders.getItemsSubtotal(e,b),Oe=e=>{try{const s=e instanceof Date?e:new Date(e);if(!s||Number.isNaN(s.getTime()))return"";const a=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0");return`${a}-${i}`}catch(s){return""}},Be=()=>ie?String(ie):Oe(new Date),dt=e=>{const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=Ne((e==null?void 0:e.phone)||""),i=String((e==null?void 0:e.address)||"").trim().toLowerCase(),m=at(e==null?void 0:e.adjustment_amount),ee=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(E=>{var S;return{product_id:String((E==null?void 0:E.product_id)||"").trim(),quantity:Number((S=E==null?void 0:E.quantity)!=null?S:0)}}).filter(E=>E.product_id&&Number.isFinite(E.quantity)&&E.quantity>0).sort((E,S)=>E.product_id<S.product_id?-1:E.product_id>S.product_id?1:E.quantity-S.quantity);return JSON.stringify({name:s,phone:a,address:i,items:ee,adj:m})},et=React.useMemo(()=>{const e=Ne((l==null?void 0:l.phone)||"");if(!e)return{count:0,orders:[],monthKey:Be()};const s=Be(),a=(Array.isArray($)?$:[]).filter(i=>{if(!i||te&&String(i.id)===String(te)||Ne(i.phone||"")!==e)return!1;const m=Oe(i.created_at);return m&&m===s}).sort((i,m)=>{const T=new Date(i.created_at).getTime(),ee=new Date(m.created_at).getTime();return(Number.isFinite(ee)?ee:0)-(Number.isFinite(T)?T:0)});return{count:a.length,orders:a,monthKey:s}},[$,l==null?void 0:l.phone,ie,te]),pt=e=>{var E;const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=Ne((e==null?void 0:e.phone)||""),i=String((e==null?void 0:e.address)||"").trim().toLowerCase(),m=at((E=e==null?void 0:e.adjustment_amount)!=null?E:0),T=I(e),ee=(Array.isArray(T)?T:[]).map(S=>{var q;return{product_id:String((S==null?void 0:S.product_id)||"").trim(),quantity:Number((q=S==null?void 0:S.quantity)!=null?q:0)}}).filter(S=>S.product_id&&Number.isFinite(S.quantity)&&S.quantity>0).sort((S,q)=>S.product_id<q.product_id?-1:S.product_id>q.product_id?1:S.quantity-q.quantity);return JSON.stringify({name:s,phone:a,address:i,items:ee,adj:m})},G=React.useMemo(()=>{if(te)return"";const e=Ne((l==null?void 0:l.phone)||"");if(!e)return"";const s=Be(),a=dt(l),i=Array.isArray($)?$:[];for(const m of i){if(!m||te&&String(m.id)===String(te)||Ne(m.phone||"")!==e)continue;const T=Oe(m.created_at);if(!T||T!==s)continue;const ee=pt(m);if(ee&&ee===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${s}${m!=null&&m.id?` (#${m.id})`:""}`}return""},[$,l,ie,te]),Ee=e=>{var ft;const s=[],a=[],i=String((e==null?void 0:e.customer_name)||"").trim(),m=Ne((e==null?void 0:e.phone)||""),T=String((e==null?void 0:e.address)||"").trim();i||s.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),m||s.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),m&&!Me(m)&&s.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),T||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const E=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(rt=>rt&&rt.product_id);E.length===0&&s.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),E.some(rt=>{var vt;const ut=Number((vt=rt==null?void 0:rt.quantity)!=null?vt:0);return!Number.isFinite(ut)||ut<=0})&&s.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const q=new Set;let P=!1;for(const rt of E){const ut=String(rt.product_id||"").trim();if(ut){if(q.has(ut)){P=!0;break}q.add(ut)}}P&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const _e=Xe(E),be=Pe(E),ot=be!=null&&be.found?Number((ft=be==null?void 0:be.fee)!=null?ft:0):0,ct=at(e==null?void 0:e.adjustment_amount),gt=String((e==null?void 0:e.adjustment_note)||"").trim();be!=null&&be.found&&(ot>=2e5||_e>0&&ot>_e*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Te(ot)}`),ct!==0&&!gt&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const mt=Math.abs(ct);return(mt>=5e5||_e>0&&mt>_e*.5)&&ct!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Te(ct)}`),{errors:s,warnings:a,canSubmit:s.length===0}},Ye=React.useMemo(()=>Ee(l),[l,fe]),de=React.useMemo(()=>{var vt;const e=String((l==null?void 0:l.customer_name)||"").trim(),s=Ne((l==null?void 0:l.phone)||""),a=String((l==null?void 0:l.address)||"").trim(),i=Array.isArray(l==null?void 0:l.items)?l.items:[],m=new Map;for(const Ge of i){const ht=String((Ge==null?void 0:Ge.product_id)||"").trim();ht&&m.set(ht,(m.get(ht)||0)+1)}const T=i.map(Ge=>{var yt;const ht=String((Ge==null?void 0:Ge.product_id)||"").trim(),Nt=Number((yt=Ge==null?void 0:Ge.quantity)!=null?yt:0),wt=ht?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",xt=Number.isFinite(Nt)&&Nt>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",Ct=ht&&(m.get(ht)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:wt,qtyError:xt,dupWarn:Ct}}),ee=i.filter(Ge=>Ge&&Ge.product_id),E=Xe(ee),S=Pe(ee),q=S!=null&&S.found?Number((vt=S==null?void 0:S.fee)!=null?vt:0):0,P=at(l==null?void 0:l.adjustment_amount),_e=String((l==null?void 0:l.adjustment_note)||"").trim(),be=Math.abs(P),ot=P!==0&&!_e?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ct=P!==0&&(be>=5e5||E>0&&be>E*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Te(P)}`:"",gt=S!=null&&S.found&&(q>=2e5||E>0&&q>E*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Te(q)}`:"",mt=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",ft=s?Me(s)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",rt=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",ut=!mt&&!ft&&T.every(Ge=>!Ge.productError&&!Ge.qtyError);return{nameError:mt,phoneError:ft,addressWarn:rt,items:T,shipAbnormalWarn:gt,adjustmentNoteWarn:ot,adjustmentAbnormalWarn:ct,canSubmit:ut}},[l,fe]),me=async e=>{var ee,E,S;const s=(e==null?void 0:e.mode)||"close",a=Ee(l);if(!a.canSubmit){const q=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof h=="function"?h(q,"danger"):alert(q);return}if(!te&&G){const q=`${G}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(q)){(et==null?void 0:et.count)>0&&_(!0),setTimeout(()=>{var be;const _e=document.getElementById("order-phone-input");_e&&typeof _e.scrollIntoView=="function"&&(_e.scrollIntoView({block:"center",behavior:"smooth"}),(be=_e.focus)==null||be.call(_e))},0);return}}const i=Ne(l.phone),T=(Array.isArray(l.items)?l.items:[]).map(q=>{var P;return{product_id:(q==null?void 0:q.product_id)||"",quantity:Number((P=q==null?void 0:q.quantity)!=null?P:1)}}).filter(q=>q.product_id&&Number.isFinite(q.quantity)&&q.quantity>0);V(!0);try{const q=te?`${API_BASE}/api/orders/${te}`:`${API_BASE}/api/orders`,P=T[0],_e={customer_name:l.customer_name,phone:i,address:l.address,adjustment_amount:at(l.adjustment_amount),adjustment_note:(l.adjustment_note||"").trim(),product_id:P.product_id,quantity:P.quantity,status:l.status,items:T,...te?{id:te}:{}};if(te)await window.KTM.api.putJSON(q,_e,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const be=await window.KTM.api.postJSON(q,_e,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");j.current={id:(S=(E=be==null?void 0:be.id)!=null?E:(ee=be==null?void 0:be.order)==null?void 0:ee.id)!=null?S:null,fingerprint:dt(l),ts:Date.now()}}s==="new"&&!te?(tt(""),qe(null),oe(!0)):(tt(""),qe(null),oe(!1)),Fe()}catch(q){console.error(q),typeof h=="function"?h(q.message,"danger"):alert(q.message);return}finally{V(!1)}},xe=e=>window.KTM.orders.getOrderTotalMoney(e,b),Ze=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){Q(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Fe()}catch(s){console.error(s),typeof h=="function"?h(s.message,"danger"):alert(s.message)}finally{Q(null)}}},ze=async(e,s)=>{var i;const a=e==null?void 0:e.id;if(!(!a||!s)){O(a);try{const m=I(e),T=(Array.isArray(m)?m:[]).map(S=>{var q;return{product_id:(S==null?void 0:S.product_id)||"",quantity:Number((q=S==null?void 0:S.quantity)!=null?q:1)}}).filter(S=>S.product_id&&Number.isFinite(S.quantity)&&S.quantity>0);if(!T.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const ee=T[0],E={id:a,customer_name:(e==null?void 0:e.customer_name)||"",phone:Ne((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",adjustment_amount:Number((i=e==null?void 0:e.adjustment_amount)!=null?i:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:ee.product_id,quantity:ee.quantity,status:s,items:T};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${a}`,E,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),M(S=>Array.isArray(S)?S.map(q=>(q==null?void 0:q.id)===a?{...q,status:s}:q):S),typeof h=="function"&&h("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(m){console.error(m),typeof h=="function"?h(m.message,"danger"):alert(m.message)}finally{O(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:r&&!se||x||!!v||!!H}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:f,disabled:x||!!v},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:ie,onChange:e=>J(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),ie&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{J("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:r},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:Z,onChange:e=>ae(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n")),Z&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ae(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:r},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-3 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Fe,disabled:r},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},Z?`${it.length}/${$.length} \u0111\u01A1n`:`${$.length} \u0111\u01A1n`)),r?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):$.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):it.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},it.map(e=>{var s;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((s=e==null?void 0:e.split_seq)!=null?s:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address)),React.createElement("span",{className:`badge ${Qe(e.status)}`},Je(e.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=K(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((i,m)=>React.createElement("div",{key:m,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},m+1,"."),i.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",i.qty,Number(i.unitPrice)>0?` \u2022 ${Te(i.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},w(e))})()),(B(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Te(B(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Te(xe(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",st(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>t(e),disabled:x||!!v||H===e.id},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>we(e),disabled:x||!!v||H===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>Ze(e.id),disabled:x||v===e.id||H===e.id},v===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>ze(e,"processing"),disabled:x||!!v||H===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>ze(e,"done"),disabled:x||!!v||H===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>ze(e,"paid"),disabled:x||!!v||H===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,it.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const s=K(e);return s.length?React.createElement("div",{className:"d-grid gap-1"},s.map((a,i)=>React.createElement("div",{key:i,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Te(a.unitPrice))))):w(e)})()),React.createElement("td",null,F(e)),React.createElement("td",{className:"fw-semibold"},Te(xe(e))),React.createElement("td",null,React.createElement("span",{className:`badge ${Qe(e.status)}`},Je(e.status))),React.createElement("td",null,st(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>t(e),disabled:x||!!v||H===e.id},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>we(e),disabled:x||!!v||H===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>ze(e,"processing"),disabled:x||!!v||H===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>ze(e,"done"),disabled:x||!!v||H===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>ze(e,"paid"),disabled:x||!!v||H===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>Ze(e.id),disabled:x||v===e.id},v===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),se&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),te?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:y})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),me({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:ve},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:l.customer_name,onChange:e=>ne({...l,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!de.nameError&&React.createElement("div",{className:"form-text text-danger"},de.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:l.phone,onChange:e=>He(e.target.value),onBlur:Re,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!de.phoneError&&React.createElement("div",{className:"form-text text-danger"},de.phoneError),!de.phoneError&&et.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",et.count," \u0111\u01A1n trong th\xE1ng ",et.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>_(e=>!e)},ue?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),ue&&et.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>_(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},et.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Qe(e.status)}`},Je(e.status))),React.createElement("div",{className:"text-muted small"},st(e.created_at)," \u2022 ",Te(xe(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},w(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&t(e)}},"M\u1EDF")))),et.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(g==null?void 0:g.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(g==null?void 0:g.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(g==null?void 0:g.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(g==null?void 0:g.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:l.status,onChange:e=>ne({...l,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:l.address,onChange:e=>ne({...l,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!de.addressWarn&&React.createElement("div",{className:"form-text text-warning"},de.addressWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:l.adjustment_amount,onChange:e=>ne({...l,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!de.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},de.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:l.adjustment_note,onChange:e=>ne({...l,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!de.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},de.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ne(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),$e(e=>[...Array.isArray(e)?e:[],""]),te&&z(e=>[...Array.isArray(e)?e:[],!0])},disabled:x},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(l.items)?l.items:[{product_id:"",quantity:1}]).map((e,s)=>React.createElement("div",{key:s,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{Ae.current[s]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{X(a=>a===s?null:s),setTimeout(()=>{const a=document.getElementById(`order-product-search-${s}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},D(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Ce===s&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${s}`,className:"form-control",value:pe[s]||"",onChange:a=>{const i=a.target.value;$e(m=>{const T=Array.isArray(m)?[...m]:[];return T[s]=i,T})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),N(s).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):N(s).map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(a.id);ne(m=>{const T=Array.isArray(m.items)?[...m.items]:[];return T[s]={...T[s]||{quantity:1},product_id:i},{...m,items:T}}),X(null)}},a.name,a.code?` (${a.code})`:""))),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),fe.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var i;const a=(i=de.items)==null?void 0:i[s];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),te&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${s}`,checked:!!ge[s],onChange:a=>{const i=!!a.target.checked;z(m=>{const T=Array.isArray(m)?[...m]:[],ee=Array.isArray(l.items)?l.items.length:0;for(;T.length<ee;)T.push(!0);return T[s]=i,T})},disabled:x||R}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${s}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const i=a.target.value;ne(m=>{const T=Array.isArray(m.items)?[...m.items]:[];return T[s]={...T[s]||{product_id:""},quantity:i},{...m,items:T}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var i;const a=(i=de.items)==null?void 0:i[s];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{ne(a=>{const i=Array.isArray(a.items)?[...a.items]:[];return i.splice(s,1),{...a,items:i.length?i:[{product_id:"",quantity:1}]}}),$e(a=>{const i=Array.isArray(a)?[...a]:[];return i.splice(s,1),i.length?i:[""]}),z(a=>{const i=Array.isArray(a)?[...a]:[];return i.splice(s,1),i}),X(a=>a==null?a:a===s?null:a>s?a-1:a)},disabled:x||R||(Array.isArray(l.items)?l.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const s=(Array.isArray(l.items)?l.items:[]).filter(ee=>ee==null?void 0:ee.product_id),a=Xe(s),i=Pe(s),m=at(l.adjustment_amount),T=a+(i.found?i.fee:0)+m;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Te(a))),i.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Te(i.fee))),!!de.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},de.shipAbnormalWarn),m!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Te(m))),(l.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(l.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Te(T)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:y,disabled:x||R,style:{borderRadius:10}},"H\u1EE7y"),!!te&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:A,disabled:x||R,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},R?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!te&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>me({mode:"new"}),disabled:x||!de.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:x||R||!de.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},x?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

