const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:m,error:r}){const[b,T]=useState(""),[O,u]=useState(""),[C,R]=useState(!1),[E,$]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),r&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),r),React.createElement("form",{onSubmit:async L=>{L.preventDefault(),R(!0),await m(b,O),R(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:b,onChange:L=>T(L.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:E?"text":"password",className:"form-control",value:O,onChange:L=>u(L.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>$(!E)},React.createElement("i",{className:`fas fa-eye${E?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:C},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:m,type:r,onClose:b}){return useEffect(()=>{const T=setTimeout(b,3e3);return()=>clearTimeout(T)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${r} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},m),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:b})))}function Loading({show:m}){return m?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:m,onMenuChange:r,onLogout:b,currentUser:T}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(u=>React.createElement("a",{key:u.id,href:"#",className:`nav-link ${m===u.id?"active":""} ${u.disabled?"opacity-50":""} ${u.highlight?"text-warning":""}`,onClick:C=>{C.preventDefault(),u.disabled||r(u.id)}},React.createElement("i",{className:`fas ${u.icon}`})," ",u.label,u.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),u.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),b&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:b,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(m){const r=typeof m=="number"?m:parseFloat(String(m!=null?m:"").trim());return Number.isFinite(r)?Math.max(0,Math.min(100,r)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var m;try{const r=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!r)return{ship_percent:DEFAULT_SHIP_PERCENT};const b=JSON.parse(r);return{ship_percent:normalizeShipPercent((m=b==null?void 0:b.ship_percent)!=null?m:b==null?void 0:b.shipPercent)}}catch(r){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(m){var r;try{const b={ship_percent:normalizeShipPercent((r=m==null?void 0:m.ship_percent)!=null?r:m==null?void 0:m.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(b)),b}catch(b){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var r;const m=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((r=m==null?void 0:m.ship_percent)!=null?r:m==null?void 0:m.shipPercent)}}async function saveAdminSettingsToServer(m){var T,O,u;const r={ship_percent:normalizeShipPercent((T=m==null?void 0:m.ship_percent)!=null?T:m==null?void 0:m.shipPercent)},b=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,r,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((u=(O=b==null?void 0:b.ship_percent)!=null?O:b==null?void 0:b.shipPercent)!=null?u:r.ship_percent)}}function AlbumList({albums:m,onSelect:r,onCreate:b,onEdit:T,onDelete:O,loading:u,currentFolder:C,onBack:R,breadcrumb:E}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},C&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:R},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),C?C.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:b},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),E&&E.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:$=>{$.preventDefault(),R("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),E.map(($,B)=>React.createElement("li",{key:$.id,className:`breadcrumb-item ${B===E.length-1?"active":""}`},B===E.length-1?$.title:React.createElement("a",{href:"#",onClick:L=>{L.preventDefault(),R($)},className:"text-warning"},$.title))))),u?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):m.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},C?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},m.map($=>React.createElement("div",{key:$.uuid||$.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>r($)},$.cover?React.createElement("img",{src:$.cover,className:"album-cover",alt:$.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},$.title),React.createElement("small",{className:"text-muted"},$.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),$.subfolderCount),$.subfolderCount>0&&$.count>0&&" \u2022 ",$.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),$.count),$.subfolderCount===0&&$.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:B=>{B.stopPropagation(),T($)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:B=>{B.stopPropagation(),O($)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:m,album:r,onClose:b,onSave:T,parentId:O}){const[u,C]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[R,E]=useState(!1),[$,B]=useState(!1),L=useRef(null);useEffect(()=>{C(r?{slug:r.id||"",title:r.title||"",description:r.description||"",cover_url:r.cover||"",parent_id:r.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:O||null})},[r,m,O]);const j=async J=>{J.preventDefault(),E(!0),await T(u),E(!1)},M=J=>J.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),ie=async J=>{const ne=J.type==="image/heic"||J.type==="image/heif"||/\.heic$/i.test(J.name);if(J.size<=2097152&&!ne)return J;try{const ee=await createImageBitmap(J),ve=document.createElement("canvas");let he=ee.width,de=ee.height;const me=800;return(he>me||de>me)&&(he>de?(de=Math.round(de/he*me),he=me):(he=Math.round(he/de*me),de=me)),ve.width=he,ve.height=de,ve.getContext("2d").drawImage(ee,0,0,he,de),ee.close(),new Promise((ue,W)=>{ve.toBlob(h=>{h?ue(new File([h],J.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):W(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ee){throw console.error("Compress cover error:",ee),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},se=async J=>{var ee;const z=J.target.files[0];if(!z)return;if(!(z.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(z.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}B(!0);try{const ve=await ie(z),he=await window.KTM.cloudinary.uploadImage({file:ve,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!he.secure_url)throw console.error("Cloudinary error:",he),new Error(((ee=he.error)==null?void 0:ee.message)||"Upload failed");C(de=>({...de,cover_url:he.secure_url}))}catch(ve){console.error("Cover upload error:",ve),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+ve.message)}B(!1),J.target.value=""};return m?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},r?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:b})),React.createElement("form",{onSubmit:j},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:u.title,onChange:J=>C({...u,title:J.target.value,slug:u.slug||M(J.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:u.slug,onChange:J=>C({...u,slug:J.target.value}),required:!0,disabled:!!r}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:u.description,onChange:J=>C({...u,description:J.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},u.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:u.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>C(J=>({...J,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:L,type:"file",accept:"image/*",className:"d-none",onChange:se}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var J;return(J=L.current)==null?void 0:J.click()},disabled:$},$?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:u.cover_url,onChange:J=>C({...u,cover_url:J.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:b},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:R||$},R?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:m,allAlbums:r,currentAlbumId:b,targetAlbum:T,onSelect:O,level:u=0}){const[C,R]=useState(!0),E=m.uuid||m.id,$=E===b,B=T===E,L=r.filter(M=>M.parentId===E),j=L.length>0;return React.createElement("div",{style:{marginLeft:u*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${B?"bg-info text-white":$?"bg-light text-muted":"hover-bg"}`,style:{cursor:$?"not-allowed":"pointer",opacity:$?.5:1,transition:"background 0.2s"},onClick:()=>!$&&O(E)},j&&React.createElement("i",{className:`fas fa-chevron-${C?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:M=>{M.stopPropagation(),R(!C)}}),!j&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${B?"-open":""} me-2 ${B?"":"text-warning"}`}),React.createElement("span",{className:"small"},m.title),$&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),m.count>0&&!$&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},m.count)),C&&j&&React.createElement("div",null,L.map(M=>React.createElement(FolderTreeItem,{key:M.uuid||M.id,folder:M,allAlbums:r,currentAlbumId:b,targetAlbum:T,onSelect:O,level:u+1}))))}function AlbumDetail({album:m,onBack:r,onRefresh:b,showToast:T,onNavigateToFolder:O,onEditSubfolder:u,parentAlbum:C}){const[R,E]=useState([]),[$,B]=useState([]),[L,j]=useState(!0),[M,ie]=useState(!1),[se,J]=useState(""),[z,ne]=useState([]),[ee,ve]=useState([]),[he,de]=useState({}),[me,k]=useState(null),[ue,W]=useState(!1),[h,F]=useState(""),[ce,be]=useState(!1),xe=useRef(null),X=useRef(null),[c,oe]=useState(!1),[ge,Ae]=useState([]),[qe,Me]=useState([]),[He,We]=useState(""),[n,l]=useState(!1),fe=async(i,f=2)=>{const d=f*1024*1024,Z=i.type==="image/heic"||i.type==="image/heif"||/\.heic$/i.test(i.name);if(i.size<=d&&!Z)return i;try{const Te=await createImageBitmap(i),ke=document.createElement("canvas");let te=Te.width,Fe=Te.height;const Re=1200;return(te>Re||Fe>Re)&&(te>Fe?(Fe=Math.round(Fe/te*Re),te=Re):(te=Math.round(te/Fe*Re),Fe=Re)),ke.width=te,ke.height=Fe,ke.getContext("2d").drawImage(Te,0,0,te,Fe),Te.close(),new Promise((ct,pt)=>{ke.toBlob(Ge=>{Ge?ct(new File([Ge],i.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):pt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Te){throw console.error("Compress error:",Te),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{g(),A()},[m.id,m.uuid]);const g=async()=>{j(!0);try{const i=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${m.uuid||m.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");E(i.images||[]);const f=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${m.uuid||m.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");B(Array.isArray(f)?f:[])}catch(i){console.error(i),T("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}j(!1)},A=async()=>{try{const i=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");Me(Array.isArray(i)?i:[])}catch(i){console.error("Error loading albums:",i)}},G=i=>{Ae(f=>f.includes(i)?f.filter(d=>d!==i):[...f,i])},ye=async()=>{if(!He||ge.length===0){T("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}l(!0);let i=0;for(const f of ge)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${f}`,{album_id:He},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),i++}catch(d){console.error("Move error:",d)}l(!1),oe(!1),Ae([]),We(""),i>0?(T("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),g(),b()):T("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[je,Ie]=useState(!1),Ce=async()=>{if(ge.length===0||!confirm(`X\xF3a ${ge.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Ie(!0);let i=0;for(const f of ge)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${f}`,"L\u1ED7i x\xF3a \u1EA3nh"),i++}catch(d){console.error("Delete error:",d)}Ie(!1),Ae([]),i>0?(T(`\u0110\xE3 x\xF3a ${i} \u1EA3nh!`,"success"),g(),b()):T("X\xF3a th\u1EA5t b\u1EA1i","danger")},Ke=()=>{ge.length===R.length?Ae([]):Ae(R.map(i=>i.id))},lt=async()=>{if(h.trim()){be(!0);try{const i=h.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:i+"-"+Date.now(),title:h,parent_id:m.uuid||m.id},"L\u1ED7i t\u1EA1o folder"),T("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),F(""),W(!1),g(),b()}catch(i){T(i.message,"danger")}be(!1)}},ht=async i=>{if(confirm(`X\xF3a folder "${i.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${i.uuid||i.id}`,"L\u1ED7i x\xF3a folder"),T("\u0110\xE3 x\xF3a folder","success"),g(),b()}catch(f){T("L\u1ED7i x\xF3a folder","danger")}},mt=i=>{const f=Array.from(i).filter(d=>d.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(d.name));ne(d=>[...d,...f]),f.forEach(d=>{const Z=new FileReader;Z.onload=Te=>{ve(ke=>[...ke,{file:d,preview:Te.target.result}])},Z.readAsDataURL(d)})},yt=i=>{ne(f=>f.filter((d,Z)=>Z!==i)),ve(f=>f.filter((d,Z)=>Z!==i))},wt=async i=>{var d;const f=await window.KTM.cloudinary.uploadImage({file:i,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${m.id}`});if(!f.secure_url)throw console.error("Cloudinary error:",f),new Error(((d=f.error)==null?void 0:d.message)||"Upload failed");return f},bt=async()=>{if(z.length===0)return;ie(!0);let i=0;for(let f=0;f<z.length;f++)try{J(`\u0110ang x\u1EED l\xFD ${f+1}/${z.length}...`);const d=await fe(z[f],2);J(`\u0110ang upload ${f+1}/${z.length}...`);const Z=await wt(d);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${m.id}`,{url:Z.secure_url,caption:he[f]||z[f].name.replace(/\.[^/.]+$/,""),sort_order:R.length+f},"L\u1ED7i l\u01B0u \u1EA3nh"),i++}catch(d){console.error("Upload error:",d)}ie(!1),J(""),ne([]),ve([]),de({}),i>0?(T(`\u0110\xE3 upload ${i} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),g(),b()):T("Upload th\u1EA5t b\u1EA1i","danger")},Y=async(i,f)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${i}`,"L\u1ED7i x\xF3a \u1EA3nh"),T("\u0110\xE3 x\xF3a \u1EA3nh","success"),g(),b()}catch(d){T("L\u1ED7i x\xF3a \u1EA3nh","danger")}},De=i=>{var f;i.preventDefault(),(f=X.current)==null||f.classList.add("dragover")},Ve=()=>{var i;(i=X.current)==null||i.classList.remove("dragover")},st=i=>{var f;i.preventDefault(),(f=X.current)==null||f.classList.remove("dragover"),mt(i.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:r},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},m.title),React.createElement("small",{className:"text-muted"},$.length>0&&React.createElement("span",null,$.length," folder \u2022 "),R.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>W(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ue&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:h,onChange:i=>F(i.target.value),onKeyPress:i=>i.key==="Enter"&&lt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:lt,disabled:ce||!h.trim()},ce?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{W(!1),F("")}},"H\u1EE7y")))),$.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},$.map(i=>React.createElement("div",{key:i.uuid||i.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>O&&O(i)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},i.title),React.createElement("small",{className:"text-muted"},i.subfolderCount>0&&React.createElement("span",null,i.subfolderCount," folder"),i.subfolderCount>0&&i.count>0&&" \u2022 ",i.count>0&&React.createElement("span",null,i.count," \u1EA3nh"),i.subfolderCount===0&&i.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:f=>{f.stopPropagation(),u&&u(i)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:f=>{f.stopPropagation(),ht(i)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:X,className:"upload-zone",onClick:()=>{var i;return(i=xe.current)==null?void 0:i.click()},onDragOver:De,onDragLeave:Ve,onDrop:st},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:xe,type:"file",multiple:!0,accept:"image/*",onChange:i=>mt(i.target.files)})),ee.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},ee.map((i,f)=>React.createElement("div",{key:f,className:"upload-preview-item"},React.createElement("img",{src:i.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>yt(f)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:bt,disabled:M},M?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),se||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",z.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",R.length,")"),R.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Ke},ge.length===R.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ge.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ge.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>oe(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Ce,disabled:je},je?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Ae([])},React.createElement("i",{className:"fas fa-times"})))),L?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):R.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},R.map((i,f)=>React.createElement("div",{key:f,className:`image-item ${ge.includes(i.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>G(i.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ge.includes(i.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ge.includes(i.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ge.includes(i.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:i.src,alt:i.caption,style:{opacity:ge.includes(i.id)?.7:1,border:ge.includes(i.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:d=>{d.stopPropagation(),Y(i.id,f)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),i.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},i.caption)))))),c&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ge.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>oe(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},qe.filter(i=>!i.parentId).map(i=>React.createElement(FolderTreeItem,{key:i.uuid||i.id,folder:i,allAlbums:qe,currentAlbumId:m.uuid||m.id,targetAlbum:He,onSelect:We})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>oe(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ye,disabled:!He||n},n?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),me&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>k(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>k(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:me.src,alt:me.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:i=>i.stopPropagation()}),me.caption&&React.createElement("div",{className:"text-white text-center mt-2"},me.caption)))))}function SearchCenter({showToast:m,onNavigate:r}){const[b,T]=useState(""),[O,u]=useState([]),[C,R]=useState([]),[E,$]=useState([]),[B,L]=useState("all"),[j,M]=useState(null),[ie,se]=useState("list"),[J,z]=useState(!0),[ne,ee]=useState([]),[ve,he]=useState([]),de=useRef(null),[me,k]=useState(!0),[ue,W]=useState(!1),h=useRef(null),[F,ce]=useState(!1),[be,xe]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[X,c]=useState(""),[oe,ge]=useState(!1),Ae=useRef(null),qe=useRef(null),[Me,He]=useState(null),[We,n]=useState(!1),[l,fe]=useState(null),[g,A]=useState(!1),[G,ye]=useState(!1),[je,Ie]=useState(null),[Ce,Ke]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),lt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ht=t=>{var v,y;t._type==="product"&&(fe(t),Ke({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||"",commission_percent:(y=(v=t.commission_percent)!=null?v:t.commissionPercent)!=null?y:""}),n(!0))},mt=async()=>{if(l)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${l.id}`,Ce,"L\u1ED7i c\u1EADp nh\u1EADt"),m("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),n(!1),fe(null),De()}catch(t){m(t.message,"danger")}},yt=async t=>{const v=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${v} "${t.name}"?`))try{let y="";t._type==="product"?y=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?y=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(y=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(y,"L\u1ED7i x\xF3a"),m(`\u0110\xE3 x\xF3a ${v}`,"success"),De()}catch(y){m(y.message,"danger")}},wt=async t=>{try{const v=je?`${API_BASE}/api/products?id=${je.id}`:`${API_BASE}/api/products`;je?await window.KTM.api.putJSON(v,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(v,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),m(je?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ye(!1),Ie(null),De()}catch(v){m(v.message,"danger")}},bt="ktm_admin_data_cache_v1",Y=1e3*60*10,De=async()=>{let t=null,v=!1;const y=window.KTM.cache.read(bt,{ttlMs:Y,validate:Array.isArray});y.hit?(t=y.value,console.log("[CACHE] Using cache, items:",t.length),R(t),u(t),z(!1),v=!0):y.status==="miss"?console.log("[CACHE] No cache found"):y.status==="expired"||y.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):y.status==="error"&&console.error("[CACHE] Error parsing cache"),v||z(!0);try{const S=async(_e,$e)=>{try{const Je=await window.KTM.api.getJSON(_e,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Je!=null?Je:$e}catch(Je){return $e}},[D,w,N]=await Promise.all([S(`${API_BASE}/api/products`,[]),S(`${API_BASE}/api/albums`,[]),S(`${API_BASE}/api/video-folders?withVideos=true`,[])]),I=Array.isArray(D)?D.map(_e=>({..._e,_type:"product",_source:"database"})):[];ee(w);let V=[];Array.isArray(w)&&w.length>0&&(await Promise.all(w.map($e=>S(`${API_BASE}/api/albums/${$e.id}`,{})))).forEach(($e,Je)=>{const H=w[Je];$e.images&&$e.images.length>0&&$e.images.forEach(pe=>{V.push({id:pe.id,name:pe.caption||"\u1EA2nh t\u1EEB "+H.title,image:pe.src,folder:H.title,_type:"album",_source:"database"})})}),he(N);let re=[];Array.isArray(N)&&N.forEach(_e=>{_e.videos&&_e.videos.forEach($e=>{re.push({id:$e.id,name:$e.title,folder:_e.name,image:$e.thumb,youtubeId:$e.youtubeId,url:$e.url,_type:"video",_source:"database"})})});const U=[...I,...V,...re];(!t||JSON.stringify(U)!==JSON.stringify(t))&&(R(U),u(U),window.KTM.cache.write(bt,U))}catch(S){console.error("Song song fetch error:",S)}z(!1)};useEffect(()=>{De(),setTimeout(()=>{var t;return(t=de.current)==null?void 0:t.focus()},100)},[]);const Ve=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(v){return String(t!=null?t:"").toLowerCase()}},st=t=>{const y=Ve(t).trim().split(/\s+/).filter(Boolean),S=y.includes("anh"),D=y.includes("video"),w=y.filter(V=>V!=="anh"&&V!=="video"),N=w.join(" "),I=new Set(["product"]);return S&&I.add("album"),D&&I.add("video"),{allowedTypes:I,includeAlbum:S,includeVideo:D,contentTokens:w,cleanedQuery:N}},i=(t,v,y)=>{var _e,$e,Je,H,pe;const S=Array.isArray(v)?v:[],D=Ve(y).trim();if(!S.length&&!D)return 0;const w=Ve((_e=t==null?void 0:t.name)!=null?_e:""),N=Ve(($e=t==null?void 0:t.code)!=null?$e:""),I=Ve((Je=t==null?void 0:t.category)!=null?Je:""),V=Ve((H=t==null?void 0:t.note)!=null?H:""),re=Ve((pe=t==null?void 0:t.folder)!=null?pe:"");if(!`${w} ${N} ${I} ${V} ${re}`.trim())return 0;let le=0;D&&(w===D&&(le+=220),w.includes(D)&&(le+=140),w.startsWith(D)&&(le+=160),N&&N===D&&(le+=180),N&&N.includes(D)&&(le+=90));for(const Qe of S){if(!Qe)continue;const rt=new RegExp(`(?:^|\\s)${Qe.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);w.includes(Qe)&&(le+=35),rt.test(w)&&(le+=25),N&&N.includes(Qe)&&(le+=20),N&&rt.test(N)&&(le+=10),I&&I.includes(Qe)&&(le+=12),re&&re.includes(Qe)&&(le+=12),V&&V.includes(Qe)&&(le+=6)}return le>0&&w&&(le+=Math.max(0,10-Math.min(10,Math.floor(w.length/10)))),le},f=(t,v,y)=>{const S=Array.isArray(t)?t:[];return S.length?S.map((w,N)=>({it:w,idx:N,score:i(w,v,y)})).sort((w,N)=>N.score!==w.score?N.score-w.score:w.idx-N.idx).map(w=>w.it):[]},d=async(t,v)=>{if(!(!me||v.length===0)){W(!0);try{const y=v.map(D=>({id:D.id,name:D.name,price:D.price,category:D.category,note:D.note,folder:D.folder,_type:D._type})),S=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:y},"AI Search error");if(S&&S.matchedIds&&S.matchedIds.length>0){const{contentTokens:D,cleanedQuery:w}=st(t),N=new Set(S.matchedIds),I=v.filter(V=>N.has(V.id)).sort((V,re)=>i(re,D,w)-i(V,D,w));I.length>0&&u(I)}else S&&S.matchedIds&&S.matchedIds.length===0&&u([])}catch(y){console.error("AI Search error:",y)}W(!1)}},Z=t=>{if(T(t),h.current&&clearTimeout(h.current),!t.trim()){Te(B);return}const{allowedTypes:v,contentTokens:y,cleanedQuery:S}=st(t),D=C.filter(N=>{if(!v.has(N==null?void 0:N._type))return!1;if(y.length===0)return!0;const I=Ve(Object.entries(N).filter(([V])=>!V.startsWith("_")).map(([,V])=>String(V||"")).join(" "));return y.some(V=>I.includes(V))});let w=D;B!=="all"&&(w=D.filter(N=>(N.category||N._type)===B)),u(f(w,y,S)),me&&S.length>=3&&(h.current=setTimeout(()=>{d(S,w)},500))},Te=t=>{L(t);const{allowedTypes:v,contentTokens:y}=st(b),{cleanedQuery:S}=st(b);let D=C.filter(w=>v.has(w==null?void 0:w._type));t!=="all"&&(D=D.filter(w=>(w.category||w._type)===t)),b.trim()&&y.length>0&&(D=D.filter(w=>{const N=Ve(Object.entries(w).filter(([I])=>!I.startsWith("_")).map(([,I])=>String(I||"")).join(" "));return y.every(I=>N.includes(I))})),u(f(D,y,S))},ke=(t,v)=>{window.KTM.clipboard.writeText(t).then(()=>{M(v),m("\u0110\xE3 copy!","success"),setTimeout(()=>M(null),1500)})},te=async(t,v)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),M(v+"-img"),m("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>M(null),1500)}catch(y){ke(t,v+"-img")}},Fe=t=>{let v=t.toLowerCase();const y=[],S=C.filter(N=>N._type==="product");if(v.includes("ty")||v.includes("xy lanh")){if(v.includes("gi\u1EEFa")||v.includes("giua")){const N=S.find(I=>{var V;return(V=I.name)==null?void 0:V.toLowerCase().includes("xy lanh gi\u1EEFa")});N&&!y.find(I=>I.id===N.id)&&y.push(N)}if(v.includes("nghi\xEAng")||v.includes("nghieng")){const N=S.find(I=>{var V;return(V=I.name)==null?void 0:V.toLowerCase().includes("xy lanh nghi\xEAng")});N&&!y.find(I=>I.id===N.id)&&y.push(N)}if(v.includes("\u1EE7i")||v.includes("ui")){const N=S.find(I=>{var V;return(V=I.name)==null?void 0:V.toLowerCase().includes("xy lanh \u1EE7i")});N&&!y.find(I=>I.id===N.id)&&y.push(N)}}const D=v.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(D){const N=D[1],I=D[2],V=S.find(re=>{var le;const U=((le=re.name)==null?void 0:le.toLowerCase())||"";return U.includes("combo")&&U.includes(`${N} tay`)&&(U.includes(`${I} xy`)||U.includes(`${I} xylanh`))});if(V&&!y.find(re=>re.id===V.id))y.push(V);else{const re=S.find(U=>{var _e;const le=((_e=U.name)==null?void 0:_e.toLowerCase())||"";return le.includes("combo")&&le.includes(`${N} tay`)});re&&!y.find(U=>U.id===re.id)&&y.push(re)}}if(v.includes("combo")&&!D){const N=v.match(/combo.*?(\d+)\s*tay/);if(N){const I=N[1];S.filter(re=>{var le;const U=((le=re.name)==null?void 0:le.toLowerCase())||"";return U.includes("combo")&&U.includes(`${I} tay`)}).forEach(re=>{y.find(U=>U.id===re.id)||y.push(re)})}}const w=v.match(/van\s*(\d+)\s*tay/);if(w&&!v.includes("ty")&&!v.includes("combo")){const N=w[1],I=S.find(V=>{var U;const re=((U=V.name)==null?void 0:U.toLowerCase())||"";return re.includes(`van ${N} tay`)&&!re.includes("combo")});I&&!y.find(V=>V.id===I.id)&&y.push(I)}return y.slice(0,4)},Re=async t=>{if(!t.trim())return;const v={role:"user",content:t,attachments:[]};xe(S=>[...S,v]),c(""),ge(!0);const y=Fe(t);setTimeout(()=>{var S;return(S=Ae.current)==null?void 0:S.scrollIntoView({behavior:"smooth"})},100);try{const D=C.filter(U=>U._type==="product").map(U=>{let le=`- ${U.name}`;return U.code&&(le+=` (M\xE3: ${U.code})`),U.price&&(le+=` - Gi\xE1: ${U.price.replace(/[đ\s]/g,"")}\u0111`),U.category&&(le+=` [${U.category}]`),U.note&&(le+=` (${U.note})`),le}).join(`
`),N=be.slice(-6).map(U=>`${U.role==="user"?"Kh\xE1ch":"AI"}: ${U.content}`).join(`
`),I=N?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${N}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${D}`:D,re=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:I,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";xe(U=>[...U,{role:"assistant",content:re,attachments:y}])}catch(S){console.error("AI Error:",S);const D=t.toLowerCase(),w=C.filter(I=>{const V=Object.values(I).join(" ").toLowerCase();return D.split(" ").some(re=>V.includes(re))});let N="";w.length>0?(N=`T\xECm th\u1EA5y ${w.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,w.slice(0,5).forEach(I=>{N+=`\u2022 ${I.name}`,I.price&&(N+=` - ${I.price.replace(/[đ\s]/g,"")}\u0111`),I.note&&(N+=` (${I.note})`),N+=`
`}),w.length>5&&(N+=`
...v\xE0 ${w.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):N='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',xe(I=>[...I,{role:"assistant",content:N,attachments:w.slice(0,4)}])}ge(!1),setTimeout(()=>{var S,D;(S=Ae.current)==null||S.scrollIntoView({behavior:"smooth"}),(D=qe.current)==null||D.focus()},100)};function gt({show:t,product:v,categories:y,onClose:S,onSave:D}){const[w,N]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[I,V]=useState(!1),[re,U]=useState(!1),le=useRef(null),_e=Q=>window.KTM.money.formatVNDInputDigits(Q);useEffect(()=>{var Q,Pe;if(v)if(N({name:v.name||"",code:v.code||"",price:v.price||"",image:v.image||"",category:v.category||"",note:v.note||"",sort_order:v.sort_order||0,commission_percent:(Pe=(Q=v.commission_percent)!=null?Q:v.commissionPercent)!=null?Pe:5}),v.price){const tt=window.KTM.money.getDigits(v.price);pe(tt),N(Oe=>({...Oe,price:_e(tt)}))}else pe("");else N({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),pe("")},[v,t]);const[$e,Je]=React.useState(""),[H,pe]=React.useState(""),Qe=Q=>{const Pe=window.KTM.money.nextPriceInputState(Q.target.value,H);pe(Pe.digits),N({...w,price:Pe.price})},rt=async(Q,Pe=2)=>{const tt=Pe*1024*1024;if(Q.size<=tt)return Q;try{const Oe=await createImageBitmap(Q),Ue=document.createElement("canvas");let Be=Oe.width,Xe=Oe.height;const et=1200;return(Be>et||Xe>et)&&(Be>Xe?(Xe=Math.round(Xe/Be*et),Be=et):(Be=Math.round(Be/Xe*et),Xe=et)),Ue.width=Be,Ue.height=Xe,Ue.getContext("2d").drawImage(Oe,0,0,Be,Xe),Oe.close(),new Promise((we,Ee)=>{Ue.toBlob(at=>{at?we(new File([at],Q.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ee(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Oe){throw console.error("Compress error:",Oe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},nt=async Q=>{var Oe;const Pe=Q.target.files[0];if(!Pe)return;if(!(Pe.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Pe.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}U(!0);try{const Ue=await rt(Pe),Be=await window.KTM.cloudinary.uploadImage({file:Ue,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!Be.secure_url)throw console.error("Cloudinary error:",Be),new Error(((Oe=Be.error)==null?void 0:Oe.message)||"Upload failed");N(Xe=>({...Xe,image:Be.secure_url}))}catch(Ue){console.error("Upload error:",Ue),alert("L\u1ED7i upload \u1EA3nh: "+Ue.message)}U(!1),Q.target.value=""},Ze=async Q=>{Q.preventDefault(),V(!0),await D(w),V(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),v?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:S})),React.createElement("form",{onSubmit:Ze},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:w.name,onChange:Q=>N({...w,name:Q.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:w.code,onChange:Q=>N({...w,code:Q.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:w.price,onChange:Qe,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:w.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:Q=>N({...w,commission_percent:Q.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:w.category,onChange:Q=>N({...w,category:Q.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),y.map(Q=>React.createElement("option",{key:Q,value:Q},Q)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:w.note,onChange:Q=>N({...w,note:Q.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},w.image?React.createElement(React.Fragment,null,React.createElement("img",{src:w.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>N({...w,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var Q;return(Q=le.current)==null?void 0:Q.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:le,type:"file",accept:"image/*",className:"d-none",onChange:nt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var Q;return(Q=le.current)==null?void 0:Q.click()},disabled:re,style:{borderRadius:"10px"}},re?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:w.image,onChange:Q=>N({...w,image:Q.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:S,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:I,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},I?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const ct=(t,v)=>{const y=t._type==="product",S=t._type==="album",D=t._type==="video",w=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale"));return ie==="grid"?React.createElement("div",{key:t.id||v,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>He({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${D?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${y?"product":S?"album":"video"}`},y?"SP":S?"\u1EA2nh":"Video"),w&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:j===t.id+"-img"?"copied":"",onClick:()=>te(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:j===t.id+"-price"?"copied":"",onClick:()=>ke(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||v,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${y?"product":S?"album":"video"}`},y?"S\u1EA3n ph\u1EA9m":S?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>He({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${D?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),w&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),D&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},y&&React.createElement("button",{onClick:()=>r&&r("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:j===t.id+"-price"?"copied":"",onClick:()=>ke(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:j===t.id+"-name"?"copied":"",onClick:()=>ke(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),D&&t.youtubeId&&React.createElement("button",{className:j===t.id+"-yt"?"copied":"",onClick:()=>ke(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),y&&React.createElement("button",{className:"action-edit",onClick:()=>ht(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>yt(t)},React.createElement("i",{className:"fas fa-trash"}))))},[pt,Ge]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,O.length)," k\u1EBFt qu\u1EA3",me&&b.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),B!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},B==="product"?"S\u1EA3n ph\u1EA9m":B==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${ie==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>se("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${ie==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>se("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},J?React.createElement("div",null,[...Array(8)].map((t,v)=>React.createElement("div",{key:v,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):O.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',b,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{T(""),Z("")}},"Xem t\u1EA5t c\u1EA3")):ie==="grid"?React.createElement("div",{className:"product-grid-mobile"},O.map((t,v)=>ct(t,v))):React.createElement("div",null,O.map((t,v)=>ct(t,v)))),pt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Ge(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${B==="all"?"active":""}`,onClick:()=>{Te("all"),Ge(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${B==="product"?"active":""}`,onClick:()=>{Te("product"),Ge(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${B==="album"?"active":""}`,onClick:()=>{Te("album"),Ge(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${B==="video"?"active":""}`,onClick:()=>{Te("video"),Ge(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:me,onChange:t=>k(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:de,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:b,onChange:t=>Z(t.target.value)}),React.createElement("button",{className:`filter-btn ${pt||B!=="all"?"active":""}`,onClick:()=>Ge(!pt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:g?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>ce(!0),onTouchStart:()=>ce(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),F&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>ce(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},be.map((t,v)=>React.createElement("div",{key:v,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:j===`chat-${v}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:j===`chat-${v}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),M(`chat-${v}`),setTimeout(()=>M(null),1500)}},React.createElement("i",{className:`fas ${j===`chat-${v}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((y,S)=>React.createElement("div",{key:S,style:{width:70},className:"text-center"},y.image&&React.createElement("img",{src:y.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>He({url:y.image,name:y.name,price:y.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},y.name),y.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},y.price.replace(/[đ\s]/g,""),"\u0111"))))))),oe&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Ae})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Re(t),disabled:oe,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),Re(X)},className:"chat-input-wrap"},React.createElement("input",{ref:qe,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:X,onChange:t=>c(t.target.value),disabled:oe}),React.createElement("button",{type:"submit",className:"send-btn",disabled:oe||!X.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),Me&&React.createElement("div",{className:"preview-modal",onClick:()=>He(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>He(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:Me.url,alt:Me.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},Me.name),Me.price&&React.createElement("div",{className:"price"},Me.price.replace(/[đ\s]/g,""),"\u0111"),Me.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},Me.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:j==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:j==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>te(Me.url,"preview")},React.createElement("i",{className:`fas ${j==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),Me.price&&React.createElement("button",{className:j==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>ke(Me.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${j==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(gt,{show:G,product:je,categories:E,onClose:()=>{ye(!1),Ie(null)},onSave:wt}),React.createElement("div",{className:`fab-container mobile-only ${g?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{A(!1),ye(!0),Ie(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{A(!1),r&&r("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${g?"open":""}`,onClick:()=>A(!g)},React.createElement("i",{className:"fas fa-plus"}))),We&&l&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>n(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Ce.name,onChange:t=>Ke({...Ce,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Ce.code,onChange:t=>Ke({...Ce,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Ce.price,onChange:t=>Ke({...Ce,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Ce.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:t=>Ke({...Ce,commission_percent:t.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Ce.category,onChange:t=>Ke({...Ce,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),lt.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Ce.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>Ke({...Ce,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>n(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:mt},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:m,showToast:r}){const[b,T]=useState([]),[O,u]=useState([]),[C,R]=useState(!0),[E,$]=useState(null),[B,L]=useState(!1),[j,M]=useState(null),[ie,se]=useState(!1),[J,z]=useState(null),[ne,ee]=useState(null),[ve,he]=useState([]);useEffect(()=>{de()},[]);const de=async(n=null)=>{R(!0);try{const l=n?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${n}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,fe=await window.KTM.api.getJSON(l,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");T(Array.isArray(fe)?fe:[])}catch(l){console.error(l),r("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}R(!1)},me=async n=>{try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${n}`,"L\u1ED7i t\u1EA3i video");u(Array.isArray(l)?l:[])}catch(l){console.error(l)}},k=async n=>{if(n===0)return;const l=[...b];[l[n-1],l[n]]=[l[n],l[n-1]],T(l),await W(l)},ue=async n=>{if(n===b.length-1)return;const l=[...b];[l[n],l[n+1]]=[l[n+1],l[n]],T(l),await W(l)},W=async n=>{try{await Promise.all(n.map((l,fe)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${l.id}`,{sortOrder:fe},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),r("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(l){r("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),de(ne==null?void 0:ne.id)}},h=async n=>{if(n===0)return;const l=[...O];[l[n-1],l[n]]=[l[n],l[n-1]],u(l),await ce(l)},F=async n=>{if(n===O.length-1)return;const l=[...O];[l[n],l[n+1]]=[l[n+1],l[n]],u(l),await ce(l)},ce=async n=>{try{await Promise.all(n.map((l,fe)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${l.id}`,{sort_order:fe},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),r("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(l){r("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),me(E.id)}},be=()=>{M(null),L(!0)},xe=n=>{M(n),L(!0)},X=async n=>{try{!j&&ne&&(n.parent_id=ne.id);const l=j?`${API_BASE}/api/video-folders/${j.id}`:`${API_BASE}/api/video-folders`;j?await window.KTM.api.putJSON(l,n,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(l,n,"L\u1ED7i l\u01B0u folder"),r(j?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),L(!1),de(ne==null?void 0:ne.id)}catch(l){r(l.message,"danger")}},c=async n=>{const l=n.subfolderCount>0?`X\xF3a folder "${n.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${n.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(l))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${n.id}`,"L\u1ED7i x\xF3a folder"),r("\u0110\xE3 x\xF3a folder","success"),$(null),de(ne==null?void 0:ne.id)}catch(fe){r("L\u1ED7i x\xF3a folder","danger")}},oe=n=>{n.subfolderCount>0?(he(l=>[...l,n]),ee(n),de(n.id)):($(n),u(n.videos||[]))},ge=n=>{if(n==="root")he([]),ee(null),de(null);else if(n){const l=ve.findIndex(fe=>fe.id===n.id);l>=0&&(he(ve.slice(0,l+1)),ee(n),de(n.id))}else{const l=[...ve];l.pop();const fe=l[l.length-1]||null;he(l),ee(fe),de(fe==null?void 0:fe.id)}},Ae=()=>{z(null),se(!0)},qe=n=>{z(n),se(!0)},Me=async n=>{try{n.folder_id=E==null?void 0:E.id;const l=J?`${API_BASE}/api/videos/${J.id}`:`${API_BASE}/api/videos`;J?await window.KTM.api.putJSON(l,n,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(l,n,"L\u1ED7i l\u01B0u video"),r(J?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),se(!1),de(),E&&me(E.id)}catch(l){r(l.message,"danger")}},He=async n=>{if(confirm(`X\xF3a video "${n.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${n.id}`,"L\u1ED7i x\xF3a video"),r("\u0110\xE3 x\xF3a video","success"),de(),E&&me(E.id)}catch(l){r("L\u1ED7i x\xF3a video","danger")}},We=n=>{const l=`https://www.youtube.com/watch?v=${n.youtubeId}`;window.KTM.clipboard.writeText(l).then(()=>{r("\u0110\xE3 copy link!","success")}).catch(()=>{r("Kh\xF4ng th\u1EC3 copy link","danger")})};return E?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>$(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${E.slug==="shorts"?"text-danger":"text-warning"}`}),E.name)),React.createElement("button",{className:"btn btn-warning",onClick:Ae},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),O.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},O.map((n,l)=>React.createElement("div",{key:n.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>h(l),disabled:l===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},l+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>F(l),disabled:l===O.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:n.thumb,className:"card-img-top",alt:n.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${n.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:n.title},n.title),React.createElement("small",{className:"text-muted"},n.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>We(n),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>qe(n),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>He(n),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:ie,video:J,onClose:()=>se(!1),onSave:Me})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},ne&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ge()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),ne?ne.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:be},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),ve.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:n=>{n.preventDefault(),ge("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ve.map((n,l)=>React.createElement("li",{key:n.id,className:`breadcrumb-item ${l===ve.length-1?"active":""}`},l===ve.length-1?n.name:React.createElement("a",{href:"#",onClick:fe=>{fe.preventDefault(),ge(n)},className:"text-warning"},n.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),C?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):b.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},ne?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:be},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",ne?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},b.map((n,l)=>{var fe,g,A,G;return React.createElement("div",{key:n.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ye=>{ye.stopPropagation(),k(l)},disabled:l===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},l+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ye=>{ye.stopPropagation(),ue(l)},disabled:l===b.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>oe(n),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${n.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},n.name),React.createElement("p",{className:"text-muted mb-0"},n.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),n.subfolderCount," folder"),n.subfolderCount>0&&(n.videoCount>0||((fe=n.videos)==null?void 0:fe.length)>0)&&" \u2022 ",(n.videoCount>0||((g=n.videos)==null?void 0:g.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),n.videoCount||((A=n.videos)==null?void 0:A.length)||0," videos"),n.subfolderCount===0&&!n.videoCount&&!((G=n.videos)!=null&&G.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ye=>{ye.stopPropagation(),xe(n)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ye=>{ye.stopPropagation(),c(n)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:B,folder:j,onClose:()=>L(!1),onSave:X}))}function VideoFolderModal({show:m,folder:r,onClose:b,onSave:T}){const[O,u]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[C,R]=useState(!1),[E,$]=useState(!1);useEffect(()=>{u(r?{name:r.name||"",description:r.description||"",sortOrder:r.sortOrder||0,coverImage:r.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[r,m]);const B=async j=>{const M=j.target.files[0];if(M){$(!0);try{const ie=await window.KTM.cloudinary.uploadImage({file:M,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});ie.secure_url&&u(se=>({...se,coverImage:ie.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(ie){console.error("Cloudinary upload error:",ie),alert("L\u1ED7i upload \u1EA3nh: "+(ie.message||ie))}finally{$(!1)}}},L=async j=>{j.preventDefault(),R(!0),await T(O),R(!1)};return m?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},r?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:b})),React.createElement("form",{onSubmit:L},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:O.name,onChange:j=>u({...O,name:j.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:O.description,onChange:j=>u({...O,description:j.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:O.sortOrder,onChange:j=>u({...O,sortOrder:parseInt(j.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},O.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:O.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>u({...O,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:B,disabled:E}),E&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:O.coverImage,onChange:j=>u({...O,coverImage:j.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:b},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:C},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:m,settings:r}){const[b,T]=useState([]),[O,u]=useState(!0),[C,R]=useState(!1),[E,$]=useState(null),[B,L]=useState(""),[j,M]=useState(""),ie=normalizeShipPercent(r==null?void 0:r.ship_percent),{parseMoney:se,formatVND:J}=window.KTM.money,z=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{ne()},[]);const ne=async()=>{u(!0);try{const h=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");T(Array.isArray(h)?h:[])}catch(h){console.error(h),m("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}u(!1)},ee=()=>{$(null),R(!0)},ve=h=>{$(h),R(!0)},he=async h=>{if(!(!h||!h.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:h},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),m(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),ne()}catch(F){m("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},de=async h=>{try{const F=E?`${API_BASE}/api/products?id=${E.id}`:`${API_BASE}/api/products`;E?await window.KTM.api.putJSON(F,h,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(F,h,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),m(E?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),R(!1),ne()}catch(F){m(F.message,"danger")}},me=async h=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${h.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${h.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),m("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ne()}catch(F){m(F.message,"danger")}},k=b.filter(h=>{const F=!B||h.name.toLowerCase().includes(B.toLowerCase())||h.code&&h.code.toLowerCase().includes(B.toLowerCase()),ce=!j||h.category===j;return F&&ce}),ue=h=>{var be;const F=(be=h==null?void 0:h.commission_percent)!=null?be:h==null?void 0:h.commissionPercent,ce=F===""||F==null?NaN:Number(F);return Number.isFinite(ce)?Math.max(0,Math.min(100,ce)):5},W=h=>{const F=ue(h),ce=Number.isInteger(F)?String(F):String(Math.round(F*100)/100),be=se(h==null?void 0:h.price);if(!Number.isFinite(be)||be<=0)return`${ce}%`;const xe=(Number(F)||0)/100,c=window.KTM.money.parseShipFeeFromNote(h==null?void 0:h.note)!=null?0:ie>0?be*ie/100:0,oe=be*xe-c*xe,ge=Math.max(0,Math.round(oe));return`${ce}% - ${J(ge)}`};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:ee},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:B,onChange:h=>L(h.target.value)})),React.createElement("span",{className:"product-count"},k.length)),React.createElement("select",{className:"form-select",value:j,onChange:h=>M(h.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),z.map(h=>React.createElement("option",{key:h,value:h},h)))),O?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):k.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ee},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},k.map(h=>React.createElement("div",{key:h.id,className:"product-item d-flex align-items-center gap-3"},h.image?React.createElement("img",{src:h.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},h.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},h.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},h.category),h.code&&React.createElement("span",{className:"product-badge bg-secondary"},h.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),W(h))),React.createElement("div",{className:"product-price"},h.price?h.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),h.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},h.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>ve(h),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>me(h),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:C,product:E,categories:z,onClose:()=>R(!1),onSave:de}))}function ProductModal({show:m,product:r,categories:b,onClose:T,onSave:O}){const[u,C]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[R,E]=useState(!1),[$,B]=useState(!1);useEffect(()=>{var k,ue;C(r?{name:r.name||"",code:r.code||"",price:r.price||"",image:r.image||"",category:r.category||"",note:r.note||"",sort_order:r.sort_order||0,commission_percent:(ue=(k=r.commission_percent)!=null?k:r.commissionPercent)!=null?ue:5}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5})},[r,m]);const[L,j]=React.useState(""),M=k=>window.KTM.money.formatVNDInputDigits(k),[ie,se]=React.useState(""),J=k=>{const ue=window.KTM.money.nextPriceInputState(k.target.value,ie);se(ue.digits),C({...u,price:ue.price})},[z,ne]=React.useState("");React.useEffect(()=>{r!=null&&r.image&&ne(r.image)},[r]);const ee=async k=>{if(!(!k||!k.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:k},"L\u1ED7i x\xF3a \u1EA3nh")}catch(ue){console.error("Delete cloudinary image error:",ue)}},ve=async(k,ue=2,W)=>{const h=ue*1024*1024,F=k.type==="image/heic"||k.type==="image/heif"||/\.heic$/i.test(k.name);if(k.size<=h&&!F)return k;W==null||W("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const ce=await createImageBitmap(k);W==null||W("\u0110ang n\xE9n \u1EA3nh...");const be=document.createElement("canvas");let xe=ce.width,X=ce.height;const c=1200;return(xe>c||X>c)&&(xe>X?(X=Math.round(X/xe*c),xe=c):(xe=Math.round(xe/X*c),X=c)),be.width=xe,be.height=X,be.getContext("2d").drawImage(ce,0,0,xe,X),ce.close(),new Promise((ge,Ae)=>{be.toBlob(qe=>{qe?(W==null||W("Ho\xE0n t\u1EA5t!"),ge(new File([qe],k.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):Ae(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ce){throw console.error("createImageBitmap error:",ce),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},he=async k=>{var h,F;const ue=(h=k.target.files)==null?void 0:h[0];if(!ue)return;if(!(ue.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ue.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}B(!0),j("\u0110ang chu\u1EA9n b\u1ECB...");try{const ce=(ue.size/1024/1024).toFixed(1);j(`File ${ce}MB - \u0110ang n\xE9n...`);const be=await ve(ue,2,c=>{j(c)}),xe=(be.size/1024/1024).toFixed(1);j(`\u0110\xE3 n\xE9n: ${xe}MB - \u0110ang upload...`);const X=await window.KTM.cloudinary.uploadImage({file:be,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});X.secure_url?(u.image&&u.image!==z&&ee(u.image),C(c=>({...c,image:X.secure_url})),j("")):(console.error("Cloudinary error:",X),alert("Upload th\u1EA5t b\u1EA1i: "+(((F=X.error)==null?void 0:F.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),j(""))}catch(ce){console.error("Upload error:",ce),alert("L\u1ED7i: "+ce.message),j("")}B(!1),k.target.value=""},de=()=>{u.image&&(u.image!==z&&ee(u.image),C(k=>({...k,image:""})))},me=async k=>{k.preventDefault(),E(!0),z&&u.image&&z!==u.image&&await ee(z),z&&!u.image&&await ee(z),await O(u),E(!1)};return m?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${r?"fa-edit":"fa-plus-circle"} me-2`}),r?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:me},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},u.image?React.createElement(React.Fragment,null,React.createElement("img",{src:u.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:de,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${$?"fa-spinner fa-spin":"fa-camera"} me-1`}),$?L||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:he,disabled:$,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),$&&L&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},L))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:u.name,onChange:k=>C({...u,name:k.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:u.code,onChange:k=>C({...u,code:k.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:u.price,onChange:J,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:u.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:k=>C({...u,commission_percent:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:u.category,onChange:k=>C({...u,category:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),b.map(k=>React.createElement("option",{key:k,value:k},k)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:u.note,onChange:k=>C({...u,note:k.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:u.image,onChange:k=>C({...u,image:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:T,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:R,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},R?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:m,video:r,onClose:b,onSave:T}){const[O,u]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[C,R]=useState(!1),[E,$]=useState("");useEffect(()=>{r?(u({title:r.title||"",youtube_url:`https://www.youtube.com/watch?v=${r.youtubeId}`,thumbnail_url:r.thumb||"",sort_order:r.sortOrder||0}),$(r.thumb)):(u({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),$(""))},[r,m]);const B=M=>{const ie=M.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return ie?ie[1]:null},L=M=>{u({...O,youtube_url:M});const ie=B(M);ie&&$(`https://img.youtube.com/vi/${ie}/hqdefault.jpg`)},j=async M=>{M.preventDefault(),R(!0),await T(O),R(!1)};return m?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},r?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:b})),React.createElement("form",{onSubmit:j},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:O.youtube_url,onChange:M=>L(M.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),E&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:E,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:O.title,onChange:M=>u({...O,title:M.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:O.sort_order,onChange:M=>u({...O,sort_order:parseInt(M.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:O.thumbnail_url,onChange:M=>u({...O,thumbnail_url:M.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:b},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:C},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[m,r]=useState(!1),[b,T]=useState(""),[O,u]=useState(null),[C,R]=useState("search"),[E,$]=useState(null),[B,L]=useState(""),[j,M]=useState([]),[ie,se]=useState(null),[J,z]=useState(!1),[ne,ee]=useState(null),[ve,he]=useState(!0),[de,me]=useState([]),[k,ue]=useState(()=>loadAdminSettings()),[W,h]=useState(null),[F,ce]=useState([]);useEffect(()=>{const g=localStorage.getItem("ktm_admin_session");if(g)try{const A=JSON.parse(g);A.expiry>Date.now()?(r(!0),u(A.user)):localStorage.removeItem("ktm_admin_session")}catch(A){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{m&&oe()},[m]),useEffect(()=>{if(!m)return;let g=!1;return(async()=>{try{const A=await fetchAdminSettingsFromServer();if(g)return;ue(A),saveAdminSettings(A)}catch(A){}})(),()=>{g=!0}},[m]);const be=async(g,A)=>{T("");try{const G=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:g,password:A},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),ye={user:G.user,token:G.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(ye)),u(G.user),r(!0)}catch(G){T(G.message)}},xe=()=>{localStorage.removeItem("ktm_admin_session"),r(!1),u(null),M([]),se(null)},X=(g,A="success")=>{const G=Date.now();me(ye=>[...ye,{id:G,message:g,type:A}])},c=g=>{me(A=>A.filter(G=>G.id!==g))},oe=async(g=null)=>{he(!0);try{const A=g?`${API_BASE}/api/albums?parent_id=${g}`:`${API_BASE}/api/albums?parent_id=root`,G=await window.KTM.api.getJSON(A,"L\u1ED7i t\u1EA3i danh s\xE1ch album");M(Array.isArray(G)?G:[])}catch(A){console.error(A),X("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}he(!1)},ge=()=>{ee(null),z(!0)},Ae=g=>{ee(g),z(!0)},qe=async g=>{try{const A=ne&&ne.uuid;!A&&W&&(g.parent_id=W.uuid);const G=A?`${API_BASE}/api/albums/${ne.uuid||ne.id}`:`${API_BASE}/api/albums`;A?await window.KTM.api.putJSON(G,g,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(G,g,"L\u1ED7i t\u1EA1o"),X(A?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),z(!1),oe(W==null?void 0:W.uuid)}catch(A){X(A.message,"danger")}},Me=g=>{se(g)},He=g=>{if(g==="root")ce([]),h(null),oe(null);else if(g){const A=F.findIndex(G=>G.uuid===g.uuid);A>=0&&(ce(F.slice(0,A+1)),h(g),oe(g.uuid))}else{const A=[...F];A.pop();const G=A[A.length-1]||null;ce(A),h(G),oe(G==null?void 0:G.uuid)}},We=async g=>{const A=`X\xF3a folder "${g.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(A))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${g.uuid||g.id}`,"L\u1ED7i x\xF3a album"),X("\u0110\xE3 x\xF3a","success"),oe(W==null?void 0:W.uuid)}catch(G){X("L\u1ED7i x\xF3a album","danger")}};if(!m)return React.createElement(LoginPage,{onLogin:be,error:b});const n=()=>{const g=new Date,A=g.getFullYear(),G=String(g.getMonth()+1).padStart(2,"0");return`${A}-${G}`};function l(){const[g,A]=useState(()=>{var Ie;return String((Ie=k==null?void 0:k.ship_percent)!=null?Ie:DEFAULT_SHIP_PERCENT)}),[G,ye]=useState(!1);return useEffect(()=>{var Ie;A(String((Ie=k==null?void 0:k.ship_percent)!=null?Ie:DEFAULT_SHIP_PERCENT))},[k==null?void 0:k.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Ie=>{Ie.preventDefault(),ye(!0);const Ce=saveAdminSettings({ship_percent:g});try{const Ke=await saveAdminSettingsToServer(Ce);ue(Ke),saveAdminSettings(Ke),X("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Ke){ue(Ce),X("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{ye(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:g,min:"0",max:"100",step:"0.01",onChange:Ie=>A(Ie.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:G},G?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function fe(){const[g,A]=useState(n()),[G,ye]=useState(!0),[je,Ie]=useState([]),[Ce,Ke]=useState([]),lt=useRef(!1),ht=useRef(new Map),mt=normalizeShipPercent(k==null?void 0:k.ship_percent),{parseMoney:yt,parseShipFeeFromNote:wt,getShipFeeForItems:bt,formatNumber:Y,formatVND:De}=window.KTM.money,Ve=async()=>{if(!lt.current)try{const d=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m");Ke(Array.isArray(d)?d:[]),lt.current=!0}catch(d){console.error("Load products for stats error:",d),Ke([]),lt.current=!0}},st=async d=>{var Fe,Re;const Z=String(d||"").trim();if(!Z)return[];const Te=(Fe=ht.current)==null?void 0:Fe.get(Z);if(Te&&Array.isArray(Te))return Te;const ke=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(Z)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),te=Array.isArray(ke)?ke:[];return(Re=ht.current)==null||Re.set(Z,te),te},i=async()=>{ye(!0);try{await Ve();const d=await st(g);Ie(Array.isArray(d)?d:[])}catch(d){console.error("Load stats error:",d),Ie([])}finally{ye(!1)}};useEffect(()=>{i()},[g]);const f=React.useMemo(()=>{var Je;const d={pending:0,processing:0,done:0,paid:0,canceled:0,other:0};let Z=0,Te=0,ke=0,te=0,Fe=0,Re=0,gt=0,ct=0;const pt=H=>H.customer_id||H.phone||"unknown",Ge=H=>window.KTM.orders.getOrderItems(H),t=new Map,v=new Map,y=new Map,S=5,D=new Map((Array.isArray(Ce)?Ce:[]).map(H=>{var nt;const pe=(nt=H==null?void 0:H.commission_percent)!=null?nt:H==null?void 0:H.commissionPercent,Qe=Number(pe),rt=Number.isFinite(Qe)?Math.max(0,Math.min(100,Qe)):S;return[String(H==null?void 0:H.id),rt]})),w=H=>{const pe=String(H!=null?H:"").trim().toLowerCase();return pe==="cancelled"?"canceled":pe};for(const H of je){const pe=w(H==null?void 0:H.status),Qe=pe==="canceled",rt=Ge(H);let nt=0,Ze=0,Q=0;for(const we of rt){const Ee=Number((we==null?void 0:we.quantity)||0)||0,at=yt(we==null?void 0:we.product_price),ze=Ee*at,it=String((we==null?void 0:we.product_id)||""),$t=D.has(it)?D.get(it):S,Mt=(Number($t)||0)/100;nt+=Ee,Ze+=ze,Q+=ze*Mt;const Tt=(we==null?void 0:we.product_id)||"unknown",Le=t.get(it)||{product_id:Tt,product_name:(we==null?void 0:we.product_name)||"\u2014",product_code:(we==null?void 0:we.product_code)||"",orders:0,quantity:0,revenue:0};Le.orders+=1,Le.quantity+=Ee,Le.revenue+=ze,t.set(Tt,Le)}const Pe=bt(rt),tt=Number((Je=H==null?void 0:H.adjustment_amount)!=null?Je:0)||0,Oe=Ze+(Pe.found?Pe.fee:0)+tt,Ue=Ze+tt,Be=!Pe.found&&mt>0&&Ze>0?Ze*mt/100:0,Xe=Ze>0?Q/Ze:S/100,et=Q+tt*Xe-Be*Xe,xt=pe==="done"||pe==="paid";if(pe==="pending"?d.pending+=1:pe==="processing"?d.processing+=1:pe==="canceled"?d.canceled+=1:pe==="paid"?(d.paid+=1,d.done+=1,te+=Oe,Re+=Ue,ct+=et):pe==="done"?(d.done+=1,te+=Oe,Re+=Ue,ct+=et):d.other+=1,!Qe){Z+=1,Te+=nt,ke+=Oe,Fe+=Ue,gt+=et;const we=pt(H),Ee=v.get(we)||{key:we,customer_name:H.customer_name||"",phone:H.phone||"",orders:0,quantity:0,revenue:0};Ee.orders+=1,Ee.quantity+=nt,Ee.revenue+=Oe,!Ee.customer_name&&H.customer_name&&(Ee.customer_name=H.customer_name),!Ee.phone&&H.phone&&(Ee.phone=H.phone),v.set(we,Ee);const at=H.created_at?new Date(H.created_at):null;if(at&&!Number.isNaN(at.getTime())){const ze=`${at.getFullYear()}-${String(at.getMonth()+1).padStart(2,"0")}-${String(at.getDate()).padStart(2,"0")}`,it=y.get(ze)||{day:ze,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};it.orders+=1,it.quantity+=nt,it.revenue+=Oe,xt&&(it.doneOrders+=1,it.doneRevenue+=Oe),y.set(ze,it)}}}const N=Array.from(t.values()).sort((H,pe)=>pe.revenue-H.revenue),I=Array.from(v.values()).sort((H,pe)=>pe.revenue-H.revenue),V=Array.from(y.values()).sort((H,pe)=>H.day.localeCompare(pe.day)),re=v.size,U=Z?Math.round(ke/Z):0,le=Z?Te/Z:0,_e=Math.round(ct),$e=Math.round(gt);return{statusCounts:d,activeOrders:Z,totalQty:Te,totalRevenue:ke,doneRevenue:te,tempCommission:_e,tempCommissionAll:$e,products:N,customers:I,days:V,uniqueCustomers:re,avgOrderValue:U,avgQtyPerOrder:le}},[je,Ce,g]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:G}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:i,disabled:G},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:g,onChange:d=>A(d.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",mt,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),Y(f.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),Y(f.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),Y(f.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",Y(f.statusCounts.paid),"/",Y(f.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Y(f.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},De(f.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},De(f.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},De(f.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},De(f.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",f.avgQtyPerOrder?f.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},Y(f.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},Y(f.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},Y(f.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},Y(f.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},Y(f.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},Y(f.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,Y(f.statusCounts.pending)),React.createElement("td",null,Y(f.statusCounts.processing)),React.createElement("td",null,Y(f.statusCounts.canceled)),React.createElement("td",null,Y(f.statusCounts.done)),React.createElement("td",null,Y(f.statusCounts.paid)),React.createElement("td",null,Y(f.statusCounts.other)),React.createElement("td",null,Y(f.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},f.products.slice(0,10).map(d=>React.createElement("div",{key:d.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},d.product_name),React.createElement("div",{className:"text-muted small text-truncate"},d.product_code?`#${d.product_code} \u2022 `:"",Y(d.orders)," \u0111\u01A1n \u2022 ",Y(d.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},De(d.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,f.products.slice(0,10).map(d=>React.createElement("tr",{key:d.product_id},React.createElement("td",null,d.product_name),React.createElement("td",null,d.product_code||"\u2014"),React.createElement("td",null,Y(d.orders)),React.createElement("td",null,Y(d.quantity)),React.createElement("td",{className:"fw-semibold"},De(d.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},f.customers.slice(0,10).map(d=>React.createElement("div",{key:d.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},d.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},d.phone||"\u2014"," \u2022 ",Y(d.orders)," \u0111\u01A1n \u2022 ",Y(d.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},De(d.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,f.customers.slice(0,10).map(d=>React.createElement("tr",{key:d.key},React.createElement("td",null,d.customer_name||"\u2014"),React.createElement("td",null,d.phone||"\u2014"),React.createElement("td",null,Y(d.orders)),React.createElement("td",null,Y(d.quantity)),React.createElement("td",{className:"fw-semibold"},De(d.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},f.days.map(d=>React.createElement("div",{key:d.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},d.day),React.createElement("div",{className:"text-muted small"},Y(d.orders)," \u0111\u01A1n \u2022 ",Y(d.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",Y(d.doneOrders)," \u2022 ",De(d.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},De(d.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,f.days.map(d=>React.createElement("tr",{key:d.day},React.createElement("td",null,d.day),React.createElement("td",null,Y(d.orders)),React.createElement("td",null,Y(d.quantity)),React.createElement("td",{className:"fw-semibold"},De(d.revenue)),React.createElement("td",null,Y(d.doneOrders)),React.createElement("td",{className:"fw-semibold"},De(d.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:C,onMenuChange:g=>{R(g),g==="albums"&&(h(null),ce([]),oe(null))},onLogout:xe,currentUser:O}),React.createElement("div",{className:"main-content"},C==="albums"&&!ie&&React.createElement(AlbumList,{albums:j,loading:ve,currentFolder:W,breadcrumb:F,onSelect:Me,onCreate:ge,onEdit:Ae,onDelete:We,onBack:He}),C==="search"&&React.createElement(SearchCenter,{showToast:X,onNavigate:(g,A,G)=>{R(g),g==="orders"&&A==="create"&&($(Date.now()),L((G==null?void 0:G.productId)||""))}}),C==="albums"&&ie&&React.createElement(AlbumDetail,{album:ie,parentAlbum:F.length>0?F[F.length-1]:null,onBack:()=>{if(ie.parentId){const g=F.findIndex(A=>A.uuid===ie.parentId);g>=0?se(F[g]):se(null)}else se(null)},onRefresh:()=>oe(W==null?void 0:W.uuid),showToast:X,onNavigateToFolder:g=>{ce(A=>[...A,ie]),se(g)},onEditSubfolder:g=>{ee(g),z(!0)}}),C==="videos"&&React.createElement(VideoList,{showToast:X}),C==="products"&&React.createElement(ProductManager,{showToast:X,settings:k}),C==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:E,autoOpenCreateProductId:B,showToast:X}),C==="stats"&&React.createElement(fe,null),C==="settings"&&React.createElement(l,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${C==="search"?"active":""}`,onClick:g=>{g.preventDefault(),R("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${C==="albums"?"active":""}`,onClick:g=>{g.preventDefault(),R("albums"),se(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${C==="videos"?"active":""}`,onClick:g=>{g.preventDefault(),R("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${C==="products"?"active":""}`,onClick:g=>{g.preventDefault(),R("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${C==="orders"?"active":""}`,onClick:g=>{g.preventDefault(),R("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${C==="stats"?"active":""}`,onClick:g=>{g.preventDefault(),R("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:J,album:ne,parentId:W==null?void 0:W.uuid,onClose:()=>z(!1),onSave:qe}),React.createElement("div",{className:"toast-container"},de.map(g=>React.createElement(Toast,{key:g.id,message:g.message,type:g.type,onClose:()=>c(g.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:m,autoOpenCreateProductId:r,showToast:b}){const[T,O]=useState([]),[u,C]=useState([]),[R,E]=useState(!0),[$,B]=useState(!1),[L,j]=useState(!1),[M,ie]=useState(null),[se,J]=useState(null),[z,ne]=useState(!1),[ee,ve]=useState(""),[he,de]=useState(""),[me,k]=useState(!1),[ue,W]=useState(!1),[h,F]=useState(null),[ce,be]=useState(!1),[xe,X]=useState([]),[c,oe]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[ge,Ae]=useState([""]),[qe,Me]=useState(null),He=useRef({}),[We,n]=useState([]),[l,fe]=useState(null),g=useRef(null),A=useRef(null),G=useRef(0),ye=useRef(new Map),je=useRef(""),Ie=useRef(null),Ce=useRef(0),Ke=useRef(null),lt=9,ht=150,mt=24*60*60*1e3,yt=5*60*1e3,wt="ktm_customer_lookup_cache_v1",bt=200,Y=3,De=24*60*60*1e3,Ve=e=>{try{const s=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(s))return 0;const a=Date.now()-s;return!Number.isFinite(a)||a<=0?0:Math.floor(a/De)}catch(s){return 0}},st=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:Ve(e)>=Y,i=e=>{oe({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Ae([""]),F(null),Me(null)};useEffect(()=>{const e=s=>{var o;if(qe==null)return;const a=(o=He.current)==null?void 0:o[qe];a&&!a.contains(s.target)&&Me(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[qe]);const f=e=>window.KTM.money.parseMoney(e),d=e=>window.KTM.money.parseSignedMoney(e),Z=e=>window.KTM.money.formatVND(e),Te=e=>window.KTM.money.parseShipFeeFromNote(e),ke=e=>window.KTM.phone.isValid(e),te=e=>window.KTM.phone.normalize(e),Fe=()=>{var e;try{const s=localStorage.getItem(wt);if(!s)return;const a=JSON.parse(s);if(!a||typeof a!="object")return;const o=Object.entries(a);for(const[p,_]of o)!p||!_||typeof _!="object"||(e=ye.current)==null||e.set(String(p),_)}catch(s){}},Re=()=>{try{const e=ye.current;if(!e||typeof e.entries!="function")return;const s=Array.from(e.entries()).filter(([o,p])=>o&&p&&typeof p=="object"&&Number.isFinite(p.ts)).sort((o,p)=>(Number(p[1].ts)||0)-(Number(o[1].ts)||0)).slice(0,bt),a={};for(const[o,p]of s)a[o]=p;localStorage.setItem(wt,JSON.stringify(a))}catch(e){}};useEffect(()=>{Fe()},[]);const gt=e=>{const s=te(e);if(!s)return null;const a=Array.isArray(T)?T:[];let o=null,p=-1;for(const _ of a){if(!_||te(_.phone||"")!==s)continue;const ae=new Date(_.created_at).getTime(),q=Number.isFinite(ae)?ae:0;q>=p&&(p=q,o=_)}return o?{name:String(o.customer_name||"").trim(),address:String(o.address||"").trim()}:null},ct=(e,s)=>{e&&oe(a=>s&&te(a.phone)!==s?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},pt=e=>{const s=gt(e);if(!s)return;const a=te(e);oe(o=>{if(a&&te(o.phone)!==a)return o;const p={...o};return!String(o.customer_name||"").trim()&&s.name&&(p.customer_name=s.name),!String(o.address||"").trim()&&s.address&&(p.address=s.address),p})},Ge=async e=>{var p,_,ae;const s=te(e);if(!s)return;pt(s);const a=(p=ye.current)==null?void 0:p.get(s);if(a&&Number.isFinite(a.ts)){const q=Date.now()-a.ts,x=a.status==="found"?mt:yt;if(q>=0&&q<=x){F({status:a.status,phone:s,customer:a.customer}),a.status==="found"&&a.customer&&ct(a.customer,s);return}}const o=++G.current;F({status:"loading",phone:s});try{const q=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(s)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(G.current!==o)return;if(q&&q.exists&&q.customer){(_=ye.current)==null||_.set(s,{ts:Date.now(),status:"found",customer:q.customer}),Re(),F({status:"found",phone:s,customer:q.customer}),ct(q.customer,s);return}(ae=ye.current)==null||ae.set(s,{ts:Date.now(),status:"not-found",customer:null}),Re(),F({status:"not-found",phone:s})}catch(q){if(G.current!==o)return;console.error("Customer lookup error:",q),F({status:"error",phone:s})}},t=e=>{const s=te(e),a=gt(s);oe(p=>{const _={...p,phone:s};return a&&(!String(p.customer_name||"").trim()&&a.name&&(_.customer_name=a.name),!String(p.address||"").trim()&&a.address&&(_.address=a.address)),_}),be(!1),A.current&&(clearTimeout(A.current),A.current=null);const o=s;if(o.length<lt){F(null);return}if(ke(o)&&o!==je.current){je.current=o,Ge(o);return}A.current=setTimeout(()=>{const p=te(s);ke(p)&&p!==je.current&&(je.current=p,Ge(p))},ht)},v=()=>{const e=te(c.phone);e.length<lt||ke(e)&&e!==je.current&&(je.current=e,Ge(e))};useEffect(()=>(ue?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[ue]);const y=Array.isArray(c.items)?c.items.length:0;useEffect(()=>{if(!ue){Ce.current=y;return}y>Ce.current&&setTimeout(()=>{const e=Ie.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Ce.current=y},[ue,y]),useEffect(()=>()=>{A.current&&(clearTimeout(A.current),A.current=null)},[]),useEffect(()=>{le()},[]),useEffect(()=>{_e()},[ee]),useEffect(()=>{$e()},[]),useEffect(()=>{m&&g.current!==m&&(g.current=m,H(r))},[m]);const S=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",D=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="canceled"?"bg-danger":"bg-light text-dark",w=React.useMemo(()=>window.KTM.orders.sortOrders(T),[T]),N=React.useMemo(()=>window.KTM.orders.sortOrders(u),[u]),I=React.useMemo(()=>{const s=(Array.isArray(N)?N:[]).filter(a=>st(a));return s.sort((a,o)=>{const p=new Date(a==null?void 0:a.created_at).getTime(),_=new Date(o==null?void 0:o.created_at).getTime();return(Number.isFinite(p)?p:0)-(Number.isFinite(_)?_:0)}),s},[N]),V=React.useMemo(()=>me?I:w,[me,I,w]),re=React.useMemo(()=>{if(me)return V;const e=String(he||"").trim();return e?(Array.isArray(V)?V:[]).filter(s=>String((s==null?void 0:s.status)||"").trim()===e):V},[V,he,me]),U=e=>window.KTM.date.formatDateTime(e),le=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");n(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),n([])}},_e=async()=>{E(!0);try{let e=`${API_BASE}/api/orders`;ee&&(e+=`?month=${ee}`);const s=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");O(Array.isArray(s)?s:[]),$e()}catch(e){console.error("Load orders error:",e),O([])}finally{E(!1)}},$e=async()=>{B(!0);try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Y)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");C(Array.isArray(e)?e:[])}catch(e){console.error("Load all orders error:",e),C([])}finally{B(!1)}},Je=e=>{var a;fe(e.id);const s=Array.isArray(e.items)&&e.items.length?e.items.map(o=>{var p;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((p=o==null?void 0:o.quantity)!=null?p:1)||1}}).filter(o=>o.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];oe({customer_name:e.customer_name||"",phone:te(e.phone||""),address:e.address||"",note:(e==null?void 0:e.note)||"",items:s.length?s:[{product_id:"",quantity:1}],adjustment_amount:Number((a=e==null?void 0:e.adjustment_amount)!=null?a:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),Ae(new Array(s.length?s.length:1).fill("")),X(new Array(s.length?s.length:1).fill(!0)),F(null),W(!0),e.phone&&Ge(te(e.phone))};function H(e){fe(null),i(e||""),be(!1),X([]),W(!0)}const pe=()=>{L||z||(W(!1),fe(null),i(""),be(!1),X([]))},Qe=async()=>{var q,x,K;if(!l||z||L)return;const e=(Array.isArray(T)?T:[]).find(P=>String(P==null?void 0:P.id)===String(l))||null,s=String((e==null?void 0:e.status)||(c==null?void 0:c.status)||"").trim();if(s==="done"||s==="paid"||s==="canceled"){const P="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof b=="function"?b(P,"warning"):alert(P);return}const a=te(c.phone),p=(Array.isArray(c.items)?c.items:[]).map((P,Se)=>{var Ne;return{idx:Se,product_id:String((P==null?void 0:P.product_id)||"").trim(),quantity:Number((Ne=P==null?void 0:P.quantity)!=null?Ne:0)}}).filter(P=>P.product_id&&Number.isFinite(P.quantity)&&P.quantity>0);if(p.length<2){const P="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof b=="function"?b(P,"warning"):alert(P);return}const _=[],ae=[];for(const P of p){const Se=!!xe[P.idx],Ne={product_id:P.product_id,quantity:P.quantity};Se?_.push(Ne):ae.push(Ne)}if(!_.length||!ae.length){const P="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof b=="function"?b(P,"warning"):alert(P);return}ne(!0);try{const P=d(c.adjustment_amount),Se=(c.adjustment_note||"").trim(),Ne={customer_name:c.customer_name,phone:a,address:c.address,note:(c.note||"").trim(),adjustment_amount:P,adjustment_note:Se,status:"processing",items:_,product_id:_[0].product_id,quantity:_[0].quantity,split_seq:1},ot=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,Ne,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),dt=(K=(x=ot==null?void 0:ot.id)!=null?x:(q=ot==null?void 0:ot.order)==null?void 0:q.id)!=null?K:null;if(!dt)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const kt={id:l,customer_name:c.customer_name,phone:a,address:c.address,note:(c.note||"").trim(),adjustment_amount:0,adjustment_note:"",status:"pending",items:ae,product_id:ae[0].product_id,quantity:ae[0].quantity,parent_order_id:String(dt),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${l}`,kt,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),pe(),_e();const vt=dt?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${dt}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof b=="function"?b(vt,"success"):alert(vt)}catch(P){console.error(P);const Se=(P==null?void 0:P.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof b=="function"?b(Se,"danger"):alert(Se)}finally{ne(!1)}},rt=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const s=String(e),a=We.find(o=>String(o==null?void 0:o.id)===s);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},nt=e=>{const s=String(ge[e]||"").trim().toLowerCase();return s?We.filter(a=>{const o=String((a==null?void 0:a.name)||"").toLowerCase(),p=String((a==null?void 0:a.code)||"").toLowerCase();return o.includes(s)||p.includes(s)}):We},Ze=e=>{if(!e)return null;const s=String(e);return We.find(a=>String(a==null?void 0:a.id)===s)||null},Q=e=>window.KTM.orders.getOrderItems(e),Pe=e=>window.KTM.orders.getOrderTotalQty(e),tt=e=>window.KTM.orders.getOrderProductSummary(e,Ze),Oe=e=>window.KTM.orders.getOrderItemRows(e,Ze),Ue=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Be=e=>{var K;const s=Q(e),a=Oe(e),o=xt(s),p=et(s),_=p.fee,ae=Ue(e),q=o+_+ae,x=[];if(x.push(`\u0110\u01A0N H\xC0NG #${(K=e==null?void 0:e.id)!=null?K:""}`.trim()),e!=null&&e.customer_name&&x.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&x.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&x.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&x.push(`Ghi ch\xFA: ${(e.note||"").trim()}`),e!=null&&e.status&&x.push(`Tr\u1EA1ng th\xE1i: ${S(e.status)}`),e!=null&&e.created_at&&x.push(`Th\u1EDDi gian: ${U(e.created_at)}`),x.push(""),x.push("S\u1EA3n ph\u1EA9m:"),a.length)for(const P of a)x.push(`- ${P.name} x${P.qty}`);else{const P=tt(e);P&&P!=="\u2014"&&x.push(`- ${P}`)}return x.push(""),x.push(`T\u1EA1m t\xEDnh: ${Z(o)}`),x.push(`Ship: ${Z(p.found?_:0)}`),ae!==0&&x.push(`\u0110i\u1EC1u ch\u1EC9nh: ${Z(ae)}`),e!=null&&e.adjustment_note&&x.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),x.push(`T\u1ED5ng: ${Z(q)}`),x.filter(Boolean).join(`
`)},Xe=async e=>{try{const s=Be(e);await window.KTM.clipboard.writeText(s),typeof b=="function"?b("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(s){console.error(s),typeof b=="function"?b("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},et=e=>window.KTM.orders.getOrderShipInfo(e,Ze),xt=e=>window.KTM.orders.getItemsSubtotal(e,Ze),we=e=>{try{const s=e instanceof Date?e:new Date(e);if(!s||Number.isNaN(s.getTime()))return"";const a=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0");return`${a}-${o}`}catch(s){return""}},Ee=()=>ee?String(ee):we(new Date),at=e=>{const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=te((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim().toLowerCase(),p=d(e==null?void 0:e.adjustment_amount),ae=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(q=>{var x;return{product_id:String((q==null?void 0:q.product_id)||"").trim(),quantity:Number((x=q==null?void 0:q.quantity)!=null?x:0)}}).filter(q=>q.product_id&&Number.isFinite(q.quantity)&&q.quantity>0).sort((q,x)=>q.product_id<x.product_id?-1:q.product_id>x.product_id?1:q.quantity-x.quantity);return JSON.stringify({name:s,phone:a,address:o,items:ae,adj:p})},ze=React.useMemo(()=>{const e=te((c==null?void 0:c.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ee()};const s=Ee(),a=(Array.isArray(T)?T:[]).filter(o=>{if(!o||l&&String(o.id)===String(l)||te(o.phone||"")!==e)return!1;const p=we(o.created_at);return p&&p===s}).sort((o,p)=>{const _=new Date(o.created_at).getTime(),ae=new Date(p.created_at).getTime();return(Number.isFinite(ae)?ae:0)-(Number.isFinite(_)?_:0)});return{count:a.length,orders:a,monthKey:s}},[T,c==null?void 0:c.phone,ee,l]),it=e=>{var q;const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=te((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim().toLowerCase(),p=d((q=e==null?void 0:e.adjustment_amount)!=null?q:0),_=Q(e),ae=(Array.isArray(_)?_:[]).map(x=>{var K;return{product_id:String((x==null?void 0:x.product_id)||"").trim(),quantity:Number((K=x==null?void 0:x.quantity)!=null?K:0)}}).filter(x=>x.product_id&&Number.isFinite(x.quantity)&&x.quantity>0).sort((x,K)=>x.product_id<K.product_id?-1:x.product_id>K.product_id?1:x.quantity-K.quantity);return JSON.stringify({name:s,phone:a,address:o,items:ae,adj:p})},$t=React.useMemo(()=>{if(l)return"";const e=te((c==null?void 0:c.phone)||"");if(!e)return"";const s=Ee(),a=at(c),o=Array.isArray(T)?T:[];for(const p of o){if(!p||l&&String(p.id)===String(l)||te(p.phone||"")!==e)continue;const _=we(p.created_at);if(!_||_!==s)continue;const ae=it(p);if(ae&&ae===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${s}${p!=null&&p.id?` (#${p.id})`:""}`}return""},[T,c,ee,l]),Mt=e=>{var St;const s=[],a=[],o=String((e==null?void 0:e.customer_name)||"").trim(),p=te((e==null?void 0:e.phone)||""),_=String((e==null?void 0:e.address)||"").trim();o||s.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),p||s.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),p&&!ke(p)&&s.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),_||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const q=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(ut=>ut&&ut.product_id);q.length===0&&s.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),q.some(ut=>{var _t;const Nt=Number((_t=ut==null?void 0:ut.quantity)!=null?_t:0);return!Number.isFinite(Nt)||Nt<=0})&&s.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const K=new Set;let P=!1;for(const ut of q){const Nt=String(ut.product_id||"").trim();if(Nt){if(K.has(Nt)){P=!0;break}K.add(Nt)}}P&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const Se=xt(q),Ne=et(q),ot=Ne!=null&&Ne.found?Number((St=Ne==null?void 0:Ne.fee)!=null?St:0):0,dt=d(e==null?void 0:e.adjustment_amount),kt=String((e==null?void 0:e.adjustment_note)||"").trim();Ne!=null&&Ne.found&&(ot>=2e5||Se>0&&ot>Se*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Z(ot)}`),dt!==0&&!kt&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const vt=Math.abs(dt);return(vt>=5e5||Se>0&&vt>Se*.5)&&dt!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Z(dt)}`),{errors:s,warnings:a,canSubmit:s.length===0}},Tt=React.useMemo(()=>Mt(c),[c,We]),Le=React.useMemo(()=>{var _t;const e=String((c==null?void 0:c.customer_name)||"").trim(),s=te((c==null?void 0:c.phone)||""),a=String((c==null?void 0:c.address)||"").trim(),o=Array.isArray(c==null?void 0:c.items)?c.items:[],p=new Map;for(const Ye of o){const Ct=String((Ye==null?void 0:Ye.product_id)||"").trim();Ct&&p.set(Ct,(p.get(Ct)||0)+1)}const _=o.map(Ye=>{var Dt;const Ct=String((Ye==null?void 0:Ye.product_id)||"").trim(),Lt=Number((Dt=Ye==null?void 0:Ye.quantity)!=null?Dt:0),jt=Ct?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",Kt=Number.isFinite(Lt)&&Lt>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",Rt=Ct&&(p.get(Ct)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:jt,qtyError:Kt,dupWarn:Rt}}),ae=o.filter(Ye=>Ye&&Ye.product_id),q=xt(ae),x=et(ae),K=x!=null&&x.found?Number((_t=x==null?void 0:x.fee)!=null?_t:0):0,P=d(c==null?void 0:c.adjustment_amount),Se=String((c==null?void 0:c.adjustment_note)||"").trim(),Ne=Math.abs(P),ot=P!==0&&!Se?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",dt=P!==0&&(Ne>=5e5||q>0&&Ne>q*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Z(P)}`:"",kt=x!=null&&x.found&&(K>=2e5||q>0&&K>q*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Z(K)}`:"",vt=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",St=s?ke(s)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",ut=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Nt=!vt&&!St&&_.every(Ye=>!Ye.productError&&!Ye.qtyError);return{nameError:vt,phoneError:St,addressWarn:ut,items:_,shipAbnormalWarn:kt,adjustmentNoteWarn:ot,adjustmentAbnormalWarn:dt,canSubmit:Nt}},[c,We]),It=async e=>{var ae,q,x;const s=(e==null?void 0:e.mode)||"close",a=Mt(c);if(!a.canSubmit){const K=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof b=="function"?b(K,"danger"):alert(K);return}if(!l&&$t){const K=`${$t}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(K)){(ze==null?void 0:ze.count)>0&&be(!0),setTimeout(()=>{var Ne;const Se=document.getElementById("order-phone-input");Se&&typeof Se.scrollIntoView=="function"&&(Se.scrollIntoView({block:"center",behavior:"smooth"}),(Ne=Se.focus)==null||Ne.call(Se))},0);return}}const o=te(c.phone),_=(Array.isArray(c.items)?c.items:[]).map(K=>{var P;return{product_id:(K==null?void 0:K.product_id)||"",quantity:Number((P=K==null?void 0:K.quantity)!=null?P:1)}}).filter(K=>K.product_id&&Number.isFinite(K.quantity)&&K.quantity>0);j(!0);try{const K=l?`${API_BASE}/api/orders/${l}`:`${API_BASE}/api/orders`,P=_[0],Se={customer_name:c.customer_name,phone:o,address:c.address,note:(c.note||"").trim(),adjustment_amount:d(c.adjustment_amount),adjustment_note:(c.adjustment_note||"").trim(),product_id:P.product_id,quantity:P.quantity,status:c.status,items:_,...l?{id:l}:{}};if(l)await window.KTM.api.putJSON(K,Se,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Ne=await window.KTM.api.postJSON(K,Se,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Ke.current={id:(x=(q=Ne==null?void 0:Ne.id)!=null?q:(ae=Ne==null?void 0:Ne.order)==null?void 0:ae.id)!=null?x:null,fingerprint:at(c),ts:Date.now()}}s==="new"&&!l?(i(""),fe(null),W(!0)):(i(""),fe(null),W(!1)),_e()}catch(K){console.error(K),typeof b=="function"?b(K.message,"danger"):alert(K.message);return}finally{j(!1)}},At=e=>window.KTM.orders.getOrderTotalMoney(e,Ze),Ot=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){ie(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),_e(),$e()}catch(s){console.error(s),typeof b=="function"?b(s.message,"danger"):alert(s.message)}finally{ie(null)}}},ft=async(e,s)=>{var o;const a=e==null?void 0:e.id;if(!(!a||!s)){J(a);try{const p=Q(e),_=(Array.isArray(p)?p:[]).map(x=>{var K;return{product_id:(x==null?void 0:x.product_id)||"",quantity:Number((K=x==null?void 0:x.quantity)!=null?K:1)}}).filter(x=>x.product_id&&Number.isFinite(x.quantity)&&x.quantity>0);if(!_.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const ae=_[0],q={id:a,customer_name:(e==null?void 0:e.customer_name)||"",phone:te((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",note:((e==null?void 0:e.note)||"").trim(),adjustment_amount:Number((o=e==null?void 0:e.adjustment_amount)!=null?o:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:ae.product_id,quantity:ae.quantity,status:s,items:_};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${a}`,q,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),O(x=>Array.isArray(x)?x.map(K=>(K==null?void 0:K.id)===a?{...K,status:s}:K):x),C(x=>Array.isArray(x)?x.map(K=>(K==null?void 0:K.id)===a?{...K,status:s}:K):x),typeof b=="function"&&b("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(p){console.error(p),typeof b=="function"?b(p.message,"danger"):alert(p.message)}finally{J(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:R&&!ue||L||!!M||!!se}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:H,disabled:L||!!M},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:ee,onChange:e=>ve(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:me}),ee&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{ve("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:R},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:he,onChange:e=>de(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:me},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),he&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>de(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:R},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:me,onChange:e=>{const s=!!e.target.checked;k(s),s&&de("pending")}}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",Y," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:_e,disabled:R},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},he?`${re.length}/${T.length} \u0111\u01A1n`:`${T.length} \u0111\u01A1n`)),I.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,I.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Y," ng\xE0y.",$&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{k(!0),de("pending")}},"Xem ngay")),R?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):T.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):re.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},re.map(e=>{var s;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((s=e==null?void 0:e.split_seq)!=null?s:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${D(e.status)}`},S(e.status)),st(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Y} ng\xE0y`},"\u26A0 Ch\u1EADm ",Ve(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=Oe(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((o,p)=>React.createElement("div",{key:p,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},p+1,"."),o.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",o.qty,Number(o.unitPrice)>0?` \u2022 ${Z(o.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},tt(e))})()),(Ue(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Z(Ue(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Z(At(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",U(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary flex-fill",onClick:()=>Je(e),disabled:L||!!M||se===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>Xe(e),disabled:L||!!M||se===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger flex-fill",onClick:()=>Ot(e.id),disabled:L||M===e.id||se===e.id},M===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>ft(e,"processing"),disabled:L||!!M||se===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>ft(e,"done"),disabled:L||!!M||se===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>ft(e,"paid"),disabled:L||!!M||se===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:()=>ft(e,"canceled"),disabled:L||!!M||se===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,re.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const s=Oe(e);return s.length?React.createElement("div",{className:"d-grid gap-1"},s.map((a,o)=>React.createElement("div",{key:o,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},o+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Z(a.unitPrice))))):tt(e)})()),React.createElement("td",null,Pe(e)),React.createElement("td",{className:"fw-semibold"},Z(At(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${D(e.status)}`},S(e.status)),st(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Y} ng\xE0y`},"\u26A0 Ch\u1EADm ",Ve(e),"d"))),React.createElement("td",null,U(e.created_at)),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary me-1",onClick:()=>Je(e),disabled:L||!!M||se===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>Xe(e),disabled:L||!!M||se===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>ft(e,"processing"),disabled:L||!!M||se===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>ft(e,"done"),disabled:L||!!M||se===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>ft(e,"paid"),disabled:L||!!M||se===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:()=>ft(e,"canceled"),disabled:L||!!M||se===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>Ot(e.id),disabled:L||M===e.id},M===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))))))),ue&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),l?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:pe})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),It({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:Ie},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:c.customer_name,onChange:e=>oe({...c,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Le.nameError&&React.createElement("div",{className:"form-text text-danger"},Le.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:c.phone,onChange:e=>t(e.target.value),onBlur:v,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Le.phoneError&&React.createElement("div",{className:"form-text text-danger"},Le.phoneError),!Le.phoneError&&ze.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",ze.count," \u0111\u01A1n trong th\xE1ng ",ze.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>be(e=>!e)},ce?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),ce&&ze.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>be(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},ze.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${D(e.status)}`},S(e.status))),React.createElement("div",{className:"text-muted small"},U(e.created_at)," \u2022 ",Z(At(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},tt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Je(e)}},"M\u1EDF")))),ze.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(h==null?void 0:h.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(h==null?void 0:h.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(h==null?void 0:h.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(h==null?void 0:h.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:c.status,onChange:e=>oe({...c,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:c.address,onChange:e=>oe({...c,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Le.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Le.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:c.note,onChange:e=>oe({...c,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:c.adjustment_amount,onChange:e=>oe({...c,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Le.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Le.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:c.adjustment_note,onChange:e=>oe({...c,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!Le.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Le.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{oe(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),Ae(e=>[...Array.isArray(e)?e:[],""]),l&&X(e=>[...Array.isArray(e)?e:[],!0])},disabled:L},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(c.items)?c.items:[{product_id:"",quantity:1}]).map((e,s)=>React.createElement("div",{key:s,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{He.current[s]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Me(a=>a===s?null:s),setTimeout(()=>{const a=document.getElementById(`order-product-search-${s}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},rt(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),qe===s&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${s}`,className:"form-control",value:ge[s]||"",onChange:a=>{const o=a.target.value;Ae(p=>{const _=Array.isArray(p)?[...p]:[];return _[s]=o,_})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),nt(s).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):nt(s).map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const o=String(a.id);oe(p=>{const _=Array.isArray(p.items)?[...p.items]:[];return _[s]={..._[s]||{quantity:1},product_id:o},{...p,items:_}}),Me(null)}},a.name,a.code?` (${a.code})`:""))),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),We.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var o;const a=(o=Le.items)==null?void 0:o[s];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),l&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${s}`,checked:!!xe[s],onChange:a=>{const o=!!a.target.checked;X(p=>{const _=Array.isArray(p)?[...p]:[],ae=Array.isArray(c.items)?c.items.length:0;for(;_.length<ae;)_.push(!0);return _[s]=o,_})},disabled:L||z}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${s}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const o=a.target.value;oe(p=>{const _=Array.isArray(p.items)?[...p.items]:[];return _[s]={..._[s]||{product_id:""},quantity:o},{...p,items:_}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var o;const a=(o=Le.items)==null?void 0:o[s];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{oe(a=>{const o=Array.isArray(a.items)?[...a.items]:[];return o.splice(s,1),{...a,items:o.length?o:[{product_id:"",quantity:1}]}}),Ae(a=>{const o=Array.isArray(a)?[...a]:[];return o.splice(s,1),o.length?o:[""]}),X(a=>{const o=Array.isArray(a)?[...a]:[];return o.splice(s,1),o}),Me(a=>a==null?a:a===s?null:a>s?a-1:a)},disabled:L||z||(Array.isArray(c.items)?c.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const s=(Array.isArray(c.items)?c.items:[]).filter(ae=>ae==null?void 0:ae.product_id),a=xt(s),o=et(s),p=d(c.adjustment_amount),_=a+(o.found?o.fee:0)+p;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Z(a))),o.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Z(o.fee))),!!Le.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Le.shipAbnormalWarn),p!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Z(p))),(c.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(c.note||"").trim()),(c.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",(c.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Z(_)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:pe,disabled:L||z,style:{borderRadius:10}},"H\u1EE7y"),!!l&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:Qe,disabled:L||z,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!l&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>It({mode:"new"}),disabled:L||!Le.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:L||z||!Le.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},L?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

