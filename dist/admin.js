const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:v,error:N}){const[T,z]=useState(""),[K,M]=useState(""),[j,se]=useState(!1),[ce,Q]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),N&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),N),React.createElement("form",{onSubmit:async Se=>{Se.preventDefault(),se(!0),await v(T,K),se(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:T,onChange:Se=>z(Se.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:ce?"text":"password",className:"form-control",value:K,onChange:Se=>M(Se.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Q(!ce)},React.createElement("i",{className:`fas fa-eye${ce?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:j},j?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:v,type:N,onClose:T,actionLabel:z,onAction:K,durationMs:M}){return useEffect(()=>{const j=Number(M),se=Number.isFinite(j)&&j>0?j:3e3,ce=setTimeout(T,se);return()=>clearTimeout(ce)},[T,M]),React.createElement("div",{className:`toast show align-items-center text-white bg-${N} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},v),z&&typeof K=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{K()}finally{T()}}},z),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:T})))}function Loading({show:v}){return v?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:v,title:N,subtitle:T,onClose:z,footer:K,children:M}){return useEffect(()=>{if(!v)return;const j=se=>{se.key==="Escape"&&(se.preventDefault(),typeof z=="function"&&z())};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[v,z]),v?React.createElement("div",{className:`admin-drawer-root ${v?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:z,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},N),T?React.createElement("div",{className:"admin-drawer-subtitle"},T):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:z,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},M),K?React.createElement("div",{className:"admin-drawer-footer"},K):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(v){try{const N=localStorage.getItem(v);if(!N)return[];const T=JSON.parse(N);return Array.isArray(T)?T.map(z=>String(z||"").trim()).filter(Boolean):[]}catch(N){return[]}}function saveAdminMenuIdsToStorage(v,N){try{localStorage.setItem(v,JSON.stringify(Array.isArray(N)?N:[]))}catch(T){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(v){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,v),v}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(v){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,v),v}function Sidebar({activeMenu:v,onMenuChange:N,onLogout:T,currentUser:z,pinnedMenus:K,recentMenus:M,onTogglePin:j}){const se=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],ce=(z==null?void 0:z.username)||(z==null?void 0:z.name)||(z==null?void 0:z.email)||"Admin",Q=useMemo(()=>{const ie=new Map;for(const A of se)ie.set(A.id,A);return ie},[]),ve=Array.isArray(K)?K:[],Se=Array.isArray(M)?M:[],de=ve.map(ie=>Q.get(ie)).filter(Boolean),he=Se.filter(ie=>ie!==v).map(ie=>Q.get(ie)).filter(Boolean).slice(0,5),Ae=ie=>ve.includes(ie);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},ce),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},de.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},de.map(ie=>React.createElement("a",{key:`pin-${ie.id}`,href:"#",className:`nav-link ${v===ie.id?"active":""} sidebar-quicklink`,onClick:A=>{A.preventDefault(),N(ie.id)}},React.createElement("i",{className:`fas ${ie.icon}`})," ",ie.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:A=>{A.preventDefault(),A.stopPropagation(),j&&j(ie.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),he.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},he.map(ie=>React.createElement("a",{key:`recent-${ie.id}`,href:"#",className:`nav-link ${v===ie.id?"active":""} sidebar-quicklink`,onClick:A=>{A.preventDefault(),N(ie.id)}},React.createElement("i",{className:`fas ${ie.icon}`})," ",ie.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),se.map(ie=>React.createElement("a",{key:ie.id,href:"#",className:`nav-link ${v===ie.id?"active":""} ${ie.disabled?"opacity-50":""} ${ie.highlight?"text-warning":""}`,onClick:A=>{A.preventDefault(),ie.disabled||N(ie.id)}},React.createElement("i",{className:`fas ${ie.icon}`})," ",ie.label,ie.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),ie.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${Ae(ie.id)?"pinned":""}`,onClick:A=>{A.preventDefault(),A.stopPropagation(),j&&j(ie.id)},title:Ae(ie.id)?"B\u1ECF ghim":"Ghim","aria-label":Ae(ie.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),T&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:T,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(v){const N=typeof v=="number"?v:parseFloat(String(v!=null?v:"").trim());return Number.isFinite(N)?Math.max(0,Math.min(100,N)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var v;try{const N=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!N)return{ship_percent:DEFAULT_SHIP_PERCENT};const T=JSON.parse(N);return{ship_percent:normalizeShipPercent((v=T==null?void 0:T.ship_percent)!=null?v:T==null?void 0:T.shipPercent)}}catch(N){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(v){var N;try{const T={ship_percent:normalizeShipPercent((N=v==null?void 0:v.ship_percent)!=null?N:v==null?void 0:v.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(T)),T}catch(T){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var N;const v=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((N=v==null?void 0:v.ship_percent)!=null?N:v==null?void 0:v.shipPercent)}}async function saveAdminSettingsToServer(v){var z,K,M;const N={ship_percent:normalizeShipPercent((z=v==null?void 0:v.ship_percent)!=null?z:v==null?void 0:v.shipPercent)},T=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,N,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((M=(K=T==null?void 0:T.ship_percent)!=null?K:T==null?void 0:T.shipPercent)!=null?M:N.ship_percent)}}function AlbumList({albums:v,onSelect:N,onCreate:T,onEdit:z,onDelete:K,loading:M,currentFolder:j,onBack:se,breadcrumb:ce}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},j&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:se},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),j?j.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:T},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),ce&&ce.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Q=>{Q.preventDefault(),se("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ce.map((Q,ve)=>React.createElement("li",{key:Q.id,className:`breadcrumb-item ${ve===ce.length-1?"active":""}`},ve===ce.length-1?Q.title:React.createElement("a",{href:"#",onClick:Se=>{Se.preventDefault(),se(Q)},className:"text-warning"},Q.title))))),M?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):v.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},j?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},v.map(Q=>React.createElement("div",{key:Q.uuid||Q.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>N(Q)},Q.cover?React.createElement("img",{src:Q.cover,className:"album-cover",alt:Q.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Q.title),React.createElement("small",{className:"text-muted"},Q.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Q.subfolderCount),Q.subfolderCount>0&&Q.count>0&&" \u2022 ",Q.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Q.count),Q.subfolderCount===0&&Q.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:ve=>{ve.stopPropagation(),z(Q)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:ve=>{ve.stopPropagation(),K(Q)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:v,album:N,onClose:T,onSave:z,parentId:K}){const[M,j]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[se,ce]=useState(!1),[Q,ve]=useState(!1),Se=useRef(null);useEffect(()=>{j(N?{slug:N.id||"",title:N.title||"",description:N.description||"",cover_url:N.cover||"",parent_id:N.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:K||null})},[N,v,K]);const de=async A=>{A.preventDefault(),ce(!0),await z(M),ce(!1)},he=A=>A.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Ae=async A=>{const xe=A.type==="image/heic"||A.type==="image/heif"||/\.heic$/i.test(A.name);if(A.size<=2097152&&!xe)return A;try{const Le=await createImageBitmap(A),Ee=document.createElement("canvas");let _e=Le.width,pe=Le.height;const Pe=800;return(_e>Pe||pe>Pe)&&(_e>pe?(pe=Math.round(pe/_e*Pe),_e=Pe):(_e=Math.round(_e/pe*Pe),pe=Pe)),Ee.width=_e,Ee.height=pe,Ee.getContext("2d").drawImage(Le,0,0,_e,pe),Le.close(),new Promise((ot,Ze)=>{Ee.toBlob(et=>{et?ot(new File([et],A.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ze(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Le){throw console.error("Compress cover error:",Le),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ie=async A=>{var Le;const De=A.target.files[0];if(!De)return;if(!(De.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(De.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ve(!0);try{const Ee=await Ae(De),_e=await window.KTM.cloudinary.uploadImage({file:Ee,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!_e.secure_url)throw console.error("Cloudinary error:",_e),new Error(((Le=_e.error)==null?void 0:Le.message)||"Upload failed");j(pe=>({...pe,cover_url:_e.secure_url}))}catch(Ee){console.error("Cover upload error:",Ee),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Ee.message)}ve(!1),A.target.value=""};return v?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},N?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:de},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:M.title,onChange:A=>j({...M,title:A.target.value,slug:M.slug||he(A.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:M.slug,onChange:A=>j({...M,slug:A.target.value}),required:!0,disabled:!!N}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:M.description,onChange:A=>j({...M,description:A.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},M.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:M.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>j(A=>({...A,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:Se,type:"file",accept:"image/*",className:"d-none",onChange:ie}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var A;return(A=Se.current)==null?void 0:A.click()},disabled:Q},Q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:M.cover_url,onChange:A=>j({...M,cover_url:A.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:T},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:se||Q},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:v,allAlbums:N,currentAlbumId:T,targetAlbum:z,onSelect:K,level:M=0}){const[j,se]=useState(!0),ce=v.uuid||v.id,Q=ce===T,ve=z===ce,Se=N.filter(he=>he.parentId===ce),de=Se.length>0;return React.createElement("div",{style:{marginLeft:M*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${ve?"bg-info text-white":Q?"bg-light text-muted":"hover-bg"}`,style:{cursor:Q?"not-allowed":"pointer",opacity:Q?.5:1,transition:"background 0.2s"},onClick:()=>!Q&&K(ce)},de&&React.createElement("i",{className:`fas fa-chevron-${j?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:he=>{he.stopPropagation(),se(!j)}}),!de&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${ve?"-open":""} me-2 ${ve?"":"text-warning"}`}),React.createElement("span",{className:"small"},v.title),Q&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),v.count>0&&!Q&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},v.count)),j&&de&&React.createElement("div",null,Se.map(he=>React.createElement(FolderTreeItem,{key:he.uuid||he.id,folder:he,allAlbums:N,currentAlbumId:T,targetAlbum:z,onSelect:K,level:M+1}))))}function AlbumDetail({album:v,onBack:N,onRefresh:T,showToast:z,onNavigateToFolder:K,onEditSubfolder:M,parentAlbum:j}){const[se,ce]=useState([]),[Q,ve]=useState([]),[Se,de]=useState(!0),[he,Ae]=useState(!1),[ie,A]=useState(""),[De,xe]=useState([]),[Le,Ee]=useState([]),[_e,pe]=useState({}),[Pe,Ye]=useState(null),[ot,Ze]=useState(!1),[et,Fe]=useState(""),[m,C]=useState(!1),$=useRef(null),H=useRef(null),[ee,Y]=useState(!1),[B,oe]=useState([]),[d,w]=useState([]),[L,le]=useState(""),[c,f]=useState(!1),te=async(S,_=2)=>{const $e=_*1024*1024,Be=S.type==="image/heic"||S.type==="image/heif"||/\.heic$/i.test(S.name);if(S.size<=$e&&!Be)return S;try{const h=await createImageBitmap(S),ye=document.createElement("canvas");let ht=h.width,Je=h.height;const lt=1200;return(ht>lt||Je>lt)&&(ht>Je?(Je=Math.round(Je/ht*lt),ht=lt):(ht=Math.round(ht/Je*lt),Je=lt)),ye.width=ht,ye.height=Je,ye.getContext("2d").drawImage(h,0,0,ht,Je),h.close(),new Promise(($t,ct)=>{ye.toBlob(Bt=>{Bt?$t(new File([Bt],S.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ct(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(h){throw console.error("Compress error:",h),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{ge(),qe()},[v.id,v.uuid]);const ge=async()=>{de(!0);try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${v.uuid||v.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ce(S.images||[]);const _=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${v.uuid||v.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ve(Array.isArray(_)?_:[])}catch(S){console.error(S),z("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}de(!1)},qe=async()=>{try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");w(Array.isArray(S)?S:[])}catch(S){console.error("Error loading albums:",S)}},Xe=S=>{oe(_=>_.includes(S)?_.filter($e=>$e!==S):[..._,S])},X=async()=>{if(!L||B.length===0){z("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}f(!0);let S=0;for(const _ of B)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${_}`,{album_id:L},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),S++}catch($e){console.error("Move error:",$e)}f(!1),Y(!1),oe([]),le(""),S>0?(z("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),ge(),T()):z("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Qe,mt]=useState(!1),y=async()=>{if(B.length===0||!confirm(`X\xF3a ${B.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;mt(!0);let S=0;for(const _ of B)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${_}`,"L\u1ED7i x\xF3a \u1EA3nh"),S++}catch($e){console.error("Delete error:",$e)}mt(!1),oe([]),S>0?(z(`\u0110\xE3 x\xF3a ${S} \u1EA3nh!`,"success"),ge(),T()):z("X\xF3a th\u1EA5t b\u1EA1i","danger")},E=()=>{B.length===se.length?oe([]):oe(se.map(S=>S.id))},V=async()=>{if(et.trim()){C(!0);try{const S=et.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:S+"-"+Date.now(),title:et,parent_id:v.uuid||v.id},"L\u1ED7i t\u1EA1o folder"),z("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Fe(""),Ze(!1),ge(),T()}catch(S){z(S.message,"danger")}C(!1)}},we=async S=>{if(confirm(`X\xF3a folder "${S.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${S.uuid||S.id}`,"L\u1ED7i x\xF3a folder"),z("\u0110\xE3 x\xF3a folder","success"),ge(),T()}catch(_){z("L\u1ED7i x\xF3a folder","danger")}},Me=S=>{const _=Array.from(S).filter($e=>$e.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test($e.name));xe($e=>[...$e,..._]),_.forEach($e=>{const Be=new FileReader;Be.onload=h=>{Ee(ye=>[...ye,{file:$e,preview:h.target.result}])},Be.readAsDataURL($e)})},Z=S=>{xe(_=>_.filter(($e,Be)=>Be!==S)),Ee(_=>_.filter(($e,Be)=>Be!==S))},Te=async S=>{var $e;const _=await window.KTM.cloudinary.uploadImage({file:S,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${v.id}`});if(!_.secure_url)throw console.error("Cloudinary error:",_),new Error((($e=_.error)==null?void 0:$e.message)||"Upload failed");return _},it=async()=>{if(De.length===0)return;Ae(!0);let S=0;for(let _=0;_<De.length;_++)try{A(`\u0110ang x\u1EED l\xFD ${_+1}/${De.length}...`);const $e=await te(De[_],2);A(`\u0110ang upload ${_+1}/${De.length}...`);const Be=await Te($e);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${v.id}`,{url:Be.secure_url,caption:_e[_]||De[_].name.replace(/\.[^/.]+$/,""),sort_order:se.length+_},"L\u1ED7i l\u01B0u \u1EA3nh"),S++}catch($e){console.error("Upload error:",$e)}Ae(!1),A(""),xe([]),Ee([]),pe({}),S>0?(z(`\u0110\xE3 upload ${S} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),ge(),T()):z("Upload th\u1EA5t b\u1EA1i","danger")},Nt=async(S,_)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${S}`,"L\u1ED7i x\xF3a \u1EA3nh"),z("\u0110\xE3 x\xF3a \u1EA3nh","success"),ge(),T()}catch($e){z("L\u1ED7i x\xF3a \u1EA3nh","danger")}},fe=S=>{var _;S.preventDefault(),(_=H.current)==null||_.classList.add("dragover")},Ve=()=>{var S;(S=H.current)==null||S.classList.remove("dragover")},wt=S=>{var _;S.preventDefault(),(_=H.current)==null||_.classList.remove("dragover"),Me(S.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:N},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},v.title),React.createElement("small",{className:"text-muted"},Q.length>0&&React.createElement("span",null,Q.length," folder \u2022 "),se.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Ze(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ot&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:et,onChange:S=>Fe(S.target.value),onKeyPress:S=>S.key==="Enter"&&V(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:V,disabled:m||!et.trim()},m?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Ze(!1),Fe("")}},"H\u1EE7y")))),Q.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Q.map(S=>React.createElement("div",{key:S.uuid||S.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>K&&K(S)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},S.title),React.createElement("small",{className:"text-muted"},S.subfolderCount>0&&React.createElement("span",null,S.subfolderCount," folder"),S.subfolderCount>0&&S.count>0&&" \u2022 ",S.count>0&&React.createElement("span",null,S.count," \u1EA3nh"),S.subfolderCount===0&&S.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:_=>{_.stopPropagation(),M&&M(S)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:_=>{_.stopPropagation(),we(S)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:H,className:"upload-zone",onClick:()=>{var S;return(S=$.current)==null?void 0:S.click()},onDragOver:fe,onDragLeave:Ve,onDrop:wt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:$,type:"file",multiple:!0,accept:"image/*",onChange:S=>Me(S.target.files)})),Le.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Le.map((S,_)=>React.createElement("div",{key:_,className:"upload-preview-item"},React.createElement("img",{src:S.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Z(_)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:it,disabled:he},he?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),ie||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",De.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",se.length,")"),se.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:E},B.length===se.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),B.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},B.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>Y(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:y,disabled:Qe},Qe?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>oe([])},React.createElement("i",{className:"fas fa-times"})))),Se?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):se.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},se.map((S,_)=>React.createElement("div",{key:_,className:`image-item ${B.includes(S.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Xe(S.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:B.includes(S.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:B.includes(S.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},B.includes(S.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:S.src,alt:S.caption,style:{opacity:B.includes(S.id)?.7:1,border:B.includes(S.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:$e=>{$e.stopPropagation(),Nt(S.id,_)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),S.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},S.caption)))))),ee&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",B.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>Y(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},d.filter(S=>!S.parentId).map(S=>React.createElement(FolderTreeItem,{key:S.uuid||S.id,folder:S,allAlbums:d,currentAlbumId:v.uuid||v.id,targetAlbum:L,onSelect:le})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>Y(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:X,disabled:!L||c},c?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Pe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Ye(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Ye(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Pe.src,alt:Pe.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:S=>S.stopPropagation()}),Pe.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Pe.caption)))))}function SearchCenter({showToast:v,onNavigate:N}){const[T,z]=useState(""),[K,M]=useState([]),[j,se]=useState([]),[ce,Q]=useState([]),[ve,Se]=useState("all"),[de,he]=useState(null),[Ae,ie]=useState("list"),[A,De]=useState(!0),[xe,Le]=useState([]),[Ee,_e]=useState([]),pe=useRef(null),[Pe,Ye]=useState(!0),[ot,Ze]=useState(!1),et=useRef(null),[Fe,m]=useState(!1),[C,$]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[H,ee]=useState(""),[Y,B]=useState(!1),oe=useRef(null),d=useRef(null),[w,L]=useState(null),[le,c]=useState(!1),[f,te]=useState(null),[ge,qe]=useState(!1),[Xe,X]=useState(!1),[Qe,mt]=useState(null),[y,E]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),V=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],we=s=>{var x,R;s._type==="product"&&(te(s),E({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(R=(x=s.commission_percent)!=null?x:s.commissionPercent)!=null?R:""}),c(!0))},Me=async()=>{if(f)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${f.id}`,y,"L\u1ED7i c\u1EADp nh\u1EADt"),v("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),c(!1),te(null),fe()}catch(s){v(s.message,"danger")}},Z=async s=>{const x=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${x} "${s.name}"?`))try{let R="";s._type==="product"?R=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?R=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(R=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(R,"L\u1ED7i x\xF3a"),v(`\u0110\xE3 x\xF3a ${x}`,"success"),fe()}catch(R){v(R.message,"danger")}},Te=async s=>{try{const x=Qe?`${API_BASE}/api/products?id=${Qe.id}`:`${API_BASE}/api/products`;Qe?await window.KTM.api.putJSON(x,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(x,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),v(Qe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),X(!1),mt(null),fe()}catch(x){v(x.message,"danger")}},it="ktm_admin_data_cache_v1",Nt=1e3*60*10,fe=async()=>{let s=null,x=!1;const R=window.KTM.cache.read(it,{ttlMs:Nt,validate:Array.isArray});R.hit?(s=R.value,console.log("[CACHE] Using cache, items:",s.length),se(s),M(s),De(!1),x=!0):R.status==="miss"?console.log("[CACHE] No cache found"):R.status==="expired"||R.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):R.status==="error"&&console.error("[CACHE] Error parsing cache"),x||De(!0);try{const W=async(nt,Ge)=>{try{const ut=await window.KTM.api.getJSON(nt,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return ut!=null?ut:Ge}catch(ut){return Ge}},[ae,D,b]=await Promise.all([W(`${API_BASE}/api/products?fields=search`,[]),W(`${API_BASE}/api/albums`,[]),W(`${API_BASE}/api/video-folders?withVideos=true`,[])]),J=Array.isArray(ae)?ae.map(nt=>({...nt,_type:"product",_source:"database"})):[];Le(D);let be=[];Array.isArray(D)&&D.length>0&&(await Promise.all(D.map(Ge=>W(`${API_BASE}/api/albums/${Ge.id}`,{})))).forEach((Ge,ut)=>{const St=D[ut];Ge.images&&Ge.images.length>0&&Ge.images.forEach(vt=>{be.push({id:vt.id,name:vt.caption||"\u1EA2nh t\u1EEB "+St.title,image:vt.src,folder:St.title,_type:"album",_source:"database"})})}),_e(b);let me=[];Array.isArray(b)&&b.forEach(nt=>{nt.videos&&nt.videos.forEach(Ge=>{me.push({id:Ge.id,name:Ge.title,folder:nt.name,image:Ge.thumb,youtubeId:Ge.youtubeId,url:Ge.url,_type:"video",_source:"database"})})});const ne=[...J,...be,...me];(!s||JSON.stringify(ne)!==JSON.stringify(s))&&(se(ne),M(ne),window.KTM.cache.write(it,ne))}catch(W){console.error("Song song fetch error:",W)}De(!1)};useEffect(()=>{fe(),setTimeout(()=>{var s;return(s=pe.current)==null?void 0:s.focus()},100)},[]);const Ve=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(x){return String(s!=null?s:"").toLowerCase()}},wt=s=>{const R=Ve(s).trim().split(/\s+/).filter(Boolean),W=R.includes("anh"),ae=R.includes("video"),D=R.filter(be=>be!=="anh"&&be!=="video"),b=D.join(" "),J=new Set(["product"]);return W&&J.add("album"),ae&&J.add("video"),{allowedTypes:J,includeAlbum:W,includeVideo:ae,contentTokens:D,cleanedQuery:b}},S=(s,x,R)=>{var nt,Ge,ut,St,vt;const W=Array.isArray(x)?x:[],ae=Ve(R).trim();if(!W.length&&!ae)return 0;const D=Ve((nt=s==null?void 0:s.name)!=null?nt:""),b=Ve((Ge=s==null?void 0:s.code)!=null?Ge:""),J=Ve((ut=s==null?void 0:s.category)!=null?ut:""),be=Ve((St=s==null?void 0:s.note)!=null?St:""),me=Ve((vt=s==null?void 0:s.folder)!=null?vt:"");if(!`${D} ${b} ${J} ${be} ${me}`.trim())return 0;let Ne=0;ae&&(D===ae&&(Ne+=220),D.includes(ae)&&(Ne+=140),D.startsWith(ae)&&(Ne+=160),b&&b===ae&&(Ne+=180),b&&b.includes(ae)&&(Ne+=90));for(const yt of W){if(!yt)continue;const qt=new RegExp(`(?:^|\\s)${yt.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);D.includes(yt)&&(Ne+=35),qt.test(D)&&(Ne+=25),b&&b.includes(yt)&&(Ne+=20),b&&qt.test(b)&&(Ne+=10),J&&J.includes(yt)&&(Ne+=12),me&&me.includes(yt)&&(Ne+=12),be&&be.includes(yt)&&(Ne+=6)}return Ne>0&&D&&(Ne+=Math.max(0,10-Math.min(10,Math.floor(D.length/10)))),Ne},_=(s,x,R)=>{const W=Array.isArray(s)?s:[];return W.length?W.map((D,b)=>({it:D,idx:b,score:S(D,x,R)})).sort((D,b)=>b.score!==D.score?b.score-D.score:D.idx-b.idx).map(D=>D.it):[]},$e=async(s,x)=>{if(!(!Pe||x.length===0)){Ze(!0);try{const R=x.map(ae=>({id:ae.id,name:ae.name,price:ae.price,category:ae.category,note:ae.note,folder:ae.folder,_type:ae._type})),W=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:R},"AI Search error");if(W&&W.matchedIds&&W.matchedIds.length>0){const{contentTokens:ae,cleanedQuery:D}=wt(s),b=new Set(W.matchedIds),J=x.filter(be=>b.has(be.id)).sort((be,me)=>S(me,ae,D)-S(be,ae,D));J.length>0&&M(J)}else W&&W.matchedIds&&W.matchedIds.length===0&&M([])}catch(R){console.error("AI Search error:",R)}Ze(!1)}},Be=s=>{if(z(s),et.current&&clearTimeout(et.current),!s.trim()){h(ve);return}const{allowedTypes:x,contentTokens:R,cleanedQuery:W}=wt(s),ae=j.filter(b=>{if(!x.has(b==null?void 0:b._type))return!1;if(R.length===0)return!0;const J=Ve(Object.entries(b).filter(([be])=>!be.startsWith("_")).map(([,be])=>String(be||"")).join(" "));return R.some(be=>J.includes(be))});let D=ae;ve!=="all"&&(D=ae.filter(b=>(b.category||b._type)===ve)),M(_(D,R,W)),Pe&&W.length>=3&&(et.current=setTimeout(()=>{$e(W,D)},500))},h=s=>{Se(s);const{allowedTypes:x,contentTokens:R}=wt(T),{cleanedQuery:W}=wt(T);let ae=j.filter(D=>x.has(D==null?void 0:D._type));s!=="all"&&(ae=ae.filter(D=>(D.category||D._type)===s)),T.trim()&&R.length>0&&(ae=ae.filter(D=>{const b=Ve(Object.entries(D).filter(([J])=>!J.startsWith("_")).map(([,J])=>String(J||"")).join(" "));return R.every(J=>b.includes(J))})),M(_(ae,R,W))},ye=(s,x)=>{window.KTM.clipboard.writeText(s).then(()=>{he(x),v("\u0110\xE3 copy!","success"),setTimeout(()=>he(null),1500)})},ht=async(s,x)=>{try{await window.KTM.clipboard.writeImageFromUrl(s),he(x+"-img"),v("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>he(null),1500)}catch(R){ye(s,x+"-img")}},Je=s=>{let x=s.toLowerCase();const R=[],W=j.filter(b=>b._type==="product");if(x.includes("ty")||x.includes("xy lanh")){if(x.includes("gi\u1EEFa")||x.includes("giua")){const b=W.find(J=>{var be;return(be=J.name)==null?void 0:be.toLowerCase().includes("xy lanh gi\u1EEFa")});b&&!R.find(J=>J.id===b.id)&&R.push(b)}if(x.includes("nghi\xEAng")||x.includes("nghieng")){const b=W.find(J=>{var be;return(be=J.name)==null?void 0:be.toLowerCase().includes("xy lanh nghi\xEAng")});b&&!R.find(J=>J.id===b.id)&&R.push(b)}if(x.includes("\u1EE7i")||x.includes("ui")){const b=W.find(J=>{var be;return(be=J.name)==null?void 0:be.toLowerCase().includes("xy lanh \u1EE7i")});b&&!R.find(J=>J.id===b.id)&&R.push(b)}}const ae=x.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(ae){const b=ae[1],J=ae[2],be=W.find(me=>{var Ne;const ne=((Ne=me.name)==null?void 0:Ne.toLowerCase())||"";return ne.includes("combo")&&ne.includes(`${b} tay`)&&(ne.includes(`${J} xy`)||ne.includes(`${J} xylanh`))});if(be&&!R.find(me=>me.id===be.id))R.push(be);else{const me=W.find(ne=>{var nt;const Ne=((nt=ne.name)==null?void 0:nt.toLowerCase())||"";return Ne.includes("combo")&&Ne.includes(`${b} tay`)});me&&!R.find(ne=>ne.id===me.id)&&R.push(me)}}if(x.includes("combo")&&!ae){const b=x.match(/combo.*?(\d+)\s*tay/);if(b){const J=b[1];W.filter(me=>{var Ne;const ne=((Ne=me.name)==null?void 0:Ne.toLowerCase())||"";return ne.includes("combo")&&ne.includes(`${J} tay`)}).forEach(me=>{R.find(ne=>ne.id===me.id)||R.push(me)})}}const D=x.match(/van\s*(\d+)\s*tay/);if(D&&!x.includes("ty")&&!x.includes("combo")){const b=D[1],J=W.find(be=>{var ne;const me=((ne=be.name)==null?void 0:ne.toLowerCase())||"";return me.includes(`van ${b} tay`)&&!me.includes("combo")});J&&!R.find(be=>be.id===J.id)&&R.push(J)}return R.slice(0,4)},lt=async s=>{if(!s.trim())return;const x={role:"user",content:s,attachments:[]};$(W=>[...W,x]),ee(""),B(!0);const R=Je(s);setTimeout(()=>{var W;return(W=oe.current)==null?void 0:W.scrollIntoView({behavior:"smooth"})},100);try{const ae=j.filter(ne=>ne._type==="product").map(ne=>{let Ne=`- ${ne.name}`;return ne.code&&(Ne+=` (M\xE3: ${ne.code})`),ne.price&&(Ne+=` - Gi\xE1: ${ne.price.replace(/[đ\s]/g,"")}\u0111`),ne.category&&(Ne+=` [${ne.category}]`),ne.note&&(Ne+=` (${ne.note})`),Ne}).join(`
`),b=C.slice(-6).map(ne=>`${ne.role==="user"?"Kh\xE1ch":"AI"}: ${ne.content}`).join(`
`),J=b?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${b}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${ae}`:ae,me=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:J,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";$(ne=>[...ne,{role:"assistant",content:me,attachments:R}])}catch(W){console.error("AI Error:",W);const ae=s.toLowerCase(),D=j.filter(J=>{const be=Object.values(J).join(" ").toLowerCase();return ae.split(" ").some(me=>be.includes(me))});let b="";D.length>0?(b=`T\xECm th\u1EA5y ${D.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,D.slice(0,5).forEach(J=>{b+=`\u2022 ${J.name}`,J.price&&(b+=` - ${J.price.replace(/[đ\s]/g,"")}\u0111`),J.note&&(b+=` (${J.note})`),b+=`
`}),D.length>5&&(b+=`
...v\xE0 ${D.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):b='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',$(J=>[...J,{role:"assistant",content:b,attachments:D.slice(0,4)}])}B(!1),setTimeout(()=>{var W,ae;(W=oe.current)==null||W.scrollIntoView({behavior:"smooth"}),(ae=d.current)==null||ae.focus()},100)};function gt({show:s,product:x,categories:R,onClose:W,onSave:ae}){const[D,b]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[J,be]=useState(!1),[me,ne]=useState(!1),Ne=useRef(null),nt=O=>window.KTM.money.formatVNDInputDigits(O),Ge=O=>{const F=window.KTM.money.getDigits(String(O!=null?O:"")),G=Number(F);return F&&Number.isFinite(G)?Math.trunc(G):0},ut=(O,F)=>{if(O==null||O==="")return[];let G=O;if(typeof G=="string"){const P=G.trim();if(!P)return[];try{G=JSON.parse(P)}catch(ue){return[]}}if(!Array.isArray(G))return[];const re=Ge(F);return G.map(P=>{var je;if(!P||typeof P!="object")return null;const ue=String((je=P.name)!=null?je:"").trim(),Oe=(Array.isArray(P.options)?P.options:[]).map(We=>{var kt,Ie,dt,It,Ct,Pt,Kt;if(!We||typeof We!="object")return null;const st=String((kt=We.label)!=null?kt:"").trim();if(!st)return null;const rt=(Ct=(It=(dt=(Ie=We.price)!=null?Ie:We.priceValue)!=null?dt:We.unit_price)!=null?It:We.unitPrice)!=null?Ct:null,bt=Number(rt);let pt=Number.isFinite(bt)?Math.trunc(bt):null;if(pt==null){const ta=(Kt=(Pt=We.price_delta)!=null?Pt:We.priceDelta)!=null?Kt:null,Aa=Number(ta);Number.isFinite(Aa)&&(pt=re+Math.trunc(Aa))}pt==null&&(pt=re);const xt=String(Math.max(0,Math.trunc(Number(pt)||0)));return{label:st,price:Math.max(0,Math.trunc(Number(pt)||0)),priceDigits:xt}}).filter(Boolean);return{name:ue||"Bi\u1EBFn th\u1EC3",options:Oe}}).filter(Boolean)},St=O=>{if(O==null||O==="")return[];let F=O;if(typeof F=="string"){const G=F.trim();if(!G)return[];try{F=JSON.parse(G)}catch(re){return[]}}return F&&typeof F=="object"&&!Array.isArray(F)&&(F=Object.entries(F).map(([G,re])=>({key:G,value:re}))),Array.isArray(F)?F.map(G=>{var Oe,je,We,st,rt;if(!G||typeof G!="object")return null;const re=String((We=(je=(Oe=G.key)!=null?Oe:G.name)!=null?je:G.label)!=null?We:"").trim(),P=String((st=G.value)!=null?st:"").trim(),ue=String((rt=G.unit)!=null?rt:"").trim();return re?{key:re,value:P,unit:ue}:null}).filter(Boolean):[]};useEffect(()=>{var O,F;if(x)if(b({name:x.name||"",code:x.code||"",price:x.price||"",image:x.image||"",category:x.category||"",note:x.note||"",sort_order:x.sort_order||0,commission_percent:(F=(O=x.commission_percent)!=null?O:x.commissionPercent)!=null?F:5,variants:ut(x.variants,x.price),attributes:St(x.attributes)}),x.price){const G=window.KTM.money.getDigits(x.price);Et(G),b(re=>({...re,price:nt(G)}))}else Et("");else b({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Et("")},[x,s]);const vt=O=>{b(F=>{var Oe;const G=Ge(F.price),re=String(G),P=Array.isArray(F.variants)?[...F.variants]:[],ue={...P[O]||{},options:Array.isArray((Oe=P[O])==null?void 0:Oe.options)?[...P[O].options]:[]};return ue.options=ue.options.map(je=>({label:String((je==null?void 0:je.label)||""),price:G,priceDigits:re})),P[O]=ue,{...F,variants:P}})},yt=()=>{b(O=>{const F=Ge(O.price),G=String(F),P=(Array.isArray(O.variants)?[...O.variants]:[]).map(ue=>{const Oe=(Array.isArray(ue==null?void 0:ue.options)?ue.options:[]).map(je=>({label:String((je==null?void 0:je.label)||""),price:F,priceDigits:G}));return{name:String((ue==null?void 0:ue.name)||"Bi\u1EBFn th\u1EC3"),options:Oe}});return{...O,variants:P}})},[qt,Pa]=React.useState(""),[Lt,Et]=React.useState(""),ea=O=>{const F=window.KTM.money.nextPriceInputState(O.target.value,Lt);Et(F.digits),b({...D,price:F.price})},ka=async(O,F=2)=>{const G=F*1024*1024;if(O.size<=G)return O;try{const re=await createImageBitmap(O),P=document.createElement("canvas");let ue=re.width,Oe=re.height;const je=1200;return(ue>je||Oe>je)&&(ue>Oe?(Oe=Math.round(Oe/ue*je),ue=je):(ue=Math.round(ue/Oe*je),Oe=je)),P.width=ue,P.height=Oe,P.getContext("2d").drawImage(re,0,0,ue,Oe),re.close(),new Promise((st,rt)=>{P.toBlob(bt=>{bt?st(new File([bt],O.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):rt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(re){throw console.error("Compress error:",re),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Sa=async O=>{var re;const F=O.target.files[0];if(!F)return;if(!(F.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(F.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ne(!0);try{const P=await ka(F),ue=await window.KTM.cloudinary.uploadImage({file:P,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!ue.secure_url)throw console.error("Cloudinary error:",ue),new Error(((re=ue.error)==null?void 0:re.message)||"Upload failed");b(Oe=>({...Oe,image:ue.secure_url}))}catch(P){console.error("Upload error:",P),alert("L\u1ED7i upload \u1EA3nh: "+P.message)}ne(!1),O.target.value=""},Ca=async O=>{O.preventDefault(),be(!0);const F={...D,variants:ut(D.variants,D.price),attributes:St(D.attributes)};await ae(F),be(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),x?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:W})),React.createElement("form",{onSubmit:Ca},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:D.name,onChange:O=>b({...D,name:O.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:D.code,onChange:O=>b({...D,code:O.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:D.price,onChange:ea,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:D.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:O=>b({...D,commission_percent:O.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:D.category,onChange:O=>b({...D,category:O.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),R.map(O=>React.createElement("option",{key:O,value:O},O)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:D.note,onChange:O=>b({...D,note:O.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(D.attributes)?D.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(D.attributes)?D.attributes:[]).map((O,F)=>React.createElement("div",{key:F,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.key)||"",onChange:G=>{const re=G.target.value;b(P=>{const ue=Array.isArray(P.attributes)?[...P.attributes]:[];return ue[F]={...ue[F]||{},key:re},{...P,attributes:ue}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.value)||"",onChange:G=>{const re=G.target.value;b(P=>{const ue=Array.isArray(P.attributes)?[...P.attributes]:[];return ue[F]={...ue[F]||{},value:re},{...P,attributes:ue}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.unit)||"",onChange:G=>{const re=G.target.value;b(P=>{const ue=Array.isArray(P.attributes)?[...P.attributes]:[];return ue[F]={...ue[F]||{},unit:re},{...P,attributes:ue}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{b(G=>{const re=Array.isArray(G.attributes)?[...G.attributes]:[];return re.splice(F,1),{...G,attributes:re}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{b(O=>{const F=Array.isArray(O.attributes)?[...O.attributes]:[];return F.push({key:"",value:"",unit:""}),{...O,attributes:F}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(D.variants)?D.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(D.variants)?D.variants:[]).map((O,F)=>React.createElement("div",{key:F,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.name)||"",onChange:G=>{const re=G.target.value;b(P=>{var Oe;const ue=Array.isArray(P.variants)?[...P.variants]:[];return ue[F]={...ue[F]||{},name:re,options:Array.isArray((Oe=ue[F])==null?void 0:Oe.options)?ue[F].options:[]},{...P,variants:ue}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>vt(F),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(O==null?void 0:O.options)||O.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{b(G=>{const re=Array.isArray(G.variants)?[...G.variants]:[];return re.splice(F,1),{...G,variants:re}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(O==null?void 0:O.options)?O.options:[]).map((G,re)=>{var P,ue;return React.createElement("div",{key:re,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(G==null?void 0:G.label)||"",onChange:Oe=>{const je=Oe.target.value;b(We=>{var xt,kt,Ie,dt,It;const st=Array.isArray(We.variants)?[...We.variants]:[],rt={...st[F]||{},options:Array.isArray((xt=st[F])==null?void 0:xt.options)?[...st[F].options]:[]},bt=Number((Ie=(kt=rt.options[re])==null?void 0:kt.price)!=null?Ie:0)||0,pt=String((It=(dt=rt.options[re])==null?void 0:dt.priceDigits)!=null?It:Math.max(0,Math.trunc(bt)));return rt.options[re]={...rt.options[re]||{},label:je,price:Math.max(0,Math.trunc(bt)),priceDigits:pt},st[F]=rt,{...We,variants:st}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:nt(String((ue=G==null?void 0:G.priceDigits)!=null?ue:window.KTM.money.getDigits(String((P=G==null?void 0:G.price)!=null?P:"")))),onChange:Oe=>{b(je=>{var Ie,dt,It,Ct,Pt;const We=String((dt=G==null?void 0:G.priceDigits)!=null?dt:window.KTM.money.getDigits(String((Ie=G==null?void 0:G.price)!=null?Ie:""))),st=window.KTM.money.nextPriceInputState(Oe.target.value,We),rt=String((It=st.digits)!=null?It:""),bt=Number(rt),pt=Number.isFinite(bt)?Math.max(0,Math.trunc(bt)):0,xt=Array.isArray(je.variants)?[...je.variants]:[],kt={...xt[F]||{},options:Array.isArray((Ct=xt[F])==null?void 0:Ct.options)?[...xt[F].options]:[]};return kt.options[re]={...kt.options[re]||{},label:String(((Pt=kt.options[re])==null?void 0:Pt.label)||""),price:pt,priceDigits:rt},xt[F]=kt,{...je,variants:xt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{b(Oe=>{var st;const je=Array.isArray(Oe.variants)?[...Oe.variants]:[],We={...je[F]||{},options:Array.isArray((st=je[F])==null?void 0:st.options)?[...je[F].options]:[]};return We.options.splice(re,1),je[F]=We,{...Oe,variants:je}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{b(G=>{var Oe;const re=Array.isArray(G.variants)?[...G.variants]:[],P={...re[F]||{},options:Array.isArray((Oe=re[F])==null?void 0:Oe.options)?[...re[F].options]:[]},ue=Ge(G.price);return P.options.push({label:"",price:ue,priceDigits:String(ue)}),re[F]=P,{...G,variants:re}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{b(O=>{const F=Ge(O.price),G=Array.isArray(O.variants)?[...O.variants]:[],re=String(F);return G.push({name:"Size",options:[{label:"S",price:F,priceDigits:re},{label:"M",price:F,priceDigits:re},{label:"L",price:F,priceDigits:re}]}),{...O,variants:G}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:yt,disabled:!Array.isArray(D.variants)||D.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},D.image?React.createElement(React.Fragment,null,React.createElement("img",{src:D.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>b({...D,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var O;return(O=Ne.current)==null?void 0:O.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:Ne,type:"file",accept:"image/*",className:"d-none",onChange:Sa}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var O;return(O=Ne.current)==null?void 0:O.click()},disabled:me,style:{borderRadius:"10px"}},me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:D.image,onChange:O=>b({...D,image:O.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:W,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:J,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},J?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const $t=s=>window.KTM.money.formatVND(s),ct=s=>{if(s==null||s==="")return[];let x=s;if(typeof x=="string"){const R=x.trim();if(!R)return[];try{x=JSON.parse(R)}catch(W){return[]}}return Array.isArray(x)?x:[]},Bt=s=>{if(s==null||s==="")return[];let x=s;if(typeof x=="string"){const R=x.trim();if(!R)return[];try{x=JSON.parse(R)}catch(W){return[]}}return x&&typeof x=="object"&&!Array.isArray(x)&&(x=Object.entries(x).map(([R,W])=>({key:R,value:W}))),Array.isArray(x)?x:[]},ze=(s,x={})=>{var D;const R=Bt(s).map(b=>{var J,be,me,ne,Ne;return{key:String((me=(be=(J=b==null?void 0:b.key)!=null?J:b==null?void 0:b.name)!=null?be:b==null?void 0:b.label)!=null?me:"").trim(),value:String((ne=b==null?void 0:b.value)!=null?ne:"").trim(),unit:String((Ne=b==null?void 0:b.unit)!=null?Ne:"").trim()}}).filter(b=>!!b.key);if(!R.length)return null;const W=!!x.compact,ae=String((D=x.className)!=null?D:"").trim();return React.createElement("div",{className:`ktm-variants-preview${W?" compact":""}${ae?" "+ae:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},R.map((b,J)=>{const be=b.key,me=`${b.value||""}${b.unit?(b.value?" ":"")+b.unit:""}`.trim();return React.createElement("div",{key:`${be}-${J}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},be),me?React.createElement("span",{className:"ktm-chip ktm-chip-option"},me):null)})))},Tt=(s,x={})=>{var be;const R=ct(s).map(me=>{var ne;return{name:String((ne=me==null?void 0:me.name)!=null?ne:"").trim(),options:Array.isArray(me==null?void 0:me.options)?me.options:[]}}).map(me=>({...me,options:me.options.map(ne=>{var Ne;return{label:String((Ne=ne==null?void 0:ne.label)!=null?Ne:"").trim(),price:Number(ne==null?void 0:ne.price)}}).filter(ne=>!!ne.label)})).filter(me=>me.options.length>0);if(!R.length)return null;const W=Number.isFinite(x.maxGroups)?Math.max(1,Math.trunc(x.maxGroups)):R.length,ae=Number.isFinite(x.maxOptionsPerGroup)?Math.max(1,Math.trunc(x.maxOptionsPerGroup)):3,D=!!x.compact,b=String((be=x.className)!=null?be:"").trim(),J=R.slice(0,W);return React.createElement("div",{className:`ktm-variants-preview${D?" compact":""}${b?" "+b:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},J.map((me,ne)=>{const Ne=me.name||"Bi\u1EBFn th\u1EC3",nt=me.options.slice(0,ae),Ge=me.options.length-nt.length;return React.createElement("div",{key:`${Ne}-${ne}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Ne),nt.map((ut,St)=>{const vt=ut.price,yt=Number.isFinite(vt)&&vt>=0?$t(Math.trunc(vt)):"",qt=yt?`${ut.label} \xB7 ${yt}`:ut.label;return React.createElement("span",{key:`${Ne}-${ne}-${St}`,className:"ktm-chip ktm-chip-option"},qt)}),Ge>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",Ge))})))},Zt=(s,x)=>{const R=s._type==="product",W=s._type==="album",ae=s._type==="video",D=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),b=R?ze(s.attributes,{compact:Ae==="grid",className:Ae==="grid"?"meta text-muted":"text-muted"}):null,J=R?Tt(s.variants,{compact:Ae==="grid",maxOptionsPerGroup:999,className:Ae==="grid"?"meta text-muted":"text-muted"}):null;return Ae==="grid"?React.createElement("div",{key:s.id||x,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>L({url:s.image,name:s.name,price:s.price,note:s.note,item:s})},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${ae?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${R?"product":W?"album":"video"}`},R?"SP":W?"\u1EA2nh":"Video"),D&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),b&&React.createElement("div",{style:{marginTop:2}},b),J&&React.createElement("div",{style:{marginTop:2}},J),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:de===s.id+"-img"?"copied":"",onClick:()=>ht(s.image,s.id)},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:de===s.id+"-price"?"copied":"",onClick:()=>ye(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||x,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${R?"product":W?"album":"video"}`},R?"S\u1EA3n ph\u1EA9m":W?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>L({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${ae?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),D&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),b&&React.createElement("div",{style:{marginTop:4}},b),J&&React.createElement("div",{style:{marginTop:4}},J)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),ae&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},R&&React.createElement("button",{onClick:()=>N&&N("orders","create",{productId:s.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:de===s.id+"-price"?"copied":"",onClick:()=>ye(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:de===s.id+"-name"?"copied":"",onClick:()=>ye(s.name,s.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),ae&&s.youtubeId&&React.createElement("button",{className:de===s.id+"-yt"?"copied":"",onClick:()=>ye(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),R&&React.createElement("button",{className:"action-edit",onClick:()=>we(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Z(s)},React.createElement("i",{className:"fas fa-trash"}))))},[Mt,jt]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,K.length)," k\u1EBFt qu\u1EA3",Pe&&T.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),ve!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},ve==="product"?"S\u1EA3n ph\u1EA9m":ve==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Ae==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ie("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Ae==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ie("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},A?React.createElement("div",null,[...Array(8)].map((s,x)=>React.createElement("div",{key:x,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):K.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',T,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{z(""),Be("")}},"Xem t\u1EA5t c\u1EA3")):Ae==="grid"?React.createElement("div",{className:"product-grid-mobile"},K.map((s,x)=>Zt(s,x))):React.createElement("div",null,K.map((s,x)=>Zt(s,x)))),Mt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>jt(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${ve==="all"?"active":""}`,onClick:()=>{h("all"),jt(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${ve==="product"?"active":""}`,onClick:()=>{h("product"),jt(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${ve==="album"?"active":""}`,onClick:()=>{h("album"),jt(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${ve==="video"?"active":""}`,onClick:()=>{h("video"),jt(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Pe,onChange:s=>Ye(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:pe,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:T,onChange:s=>Be(s.target.value)}),React.createElement("button",{className:`filter-btn ${Mt||ve!=="all"?"active":""}`,onClick:()=>jt(!Mt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:ge?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>m(!0),onTouchStart:()=>m(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Fe&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>m(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},C.map((s,x)=>React.createElement("div",{key:x,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:de===`chat-${x}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:de===`chat-${x}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),he(`chat-${x}`),setTimeout(()=>he(null),1500)}},React.createElement("i",{className:`fas ${de===`chat-${x}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((R,W)=>React.createElement("div",{key:W,style:{width:70},className:"text-center"},R.image&&React.createElement("img",{src:R.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>L({url:R.image,name:R.name,price:R.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},R.name),R.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},R.price.replace(/[đ\s]/g,""),"\u0111"))))))),Y&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:oe})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>lt(s),disabled:Y,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),lt(H)},className:"chat-input-wrap"},React.createElement("input",{ref:d,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:H,onChange:s=>ee(s.target.value),disabled:Y}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Y||!H.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),w&&React.createElement("div",{className:"preview-modal",onClick:()=>L(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>L(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:w.url,alt:w.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},w.name),w.price&&React.createElement("div",{className:"price"},w.price.replace(/[đ\s]/g,""),"\u0111"),w.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},w.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:de==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:de==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>ht(w.url,"preview")},React.createElement("i",{className:`fas ${de==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),w.price&&React.createElement("button",{className:de==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>ye(w.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${de==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(gt,{show:Xe,product:Qe,categories:ce,onClose:()=>{X(!1),mt(null)},onSave:Te}),React.createElement("div",{className:`fab-container mobile-only ${ge?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{qe(!1),X(!0),mt(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{qe(!1),N&&N("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${ge?"open":""}`,onClick:()=>qe(!ge)},React.createElement("i",{className:"fas fa-plus"}))),le&&f&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>c(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:y.name,onChange:s=>E({...y,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:y.code,onChange:s=>E({...y,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:y.price,onChange:s=>E({...y,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:y.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>E({...y,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:y.category,onChange:s=>E({...y,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),V.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:y.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>E({...y,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>c(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:Me},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:v,showToast:N}){const[T,z]=useState([]),[K,M]=useState([]),[j,se]=useState(!0),[ce,Q]=useState(null),[ve,Se]=useState(!1),[de,he]=useState(null),[Ae,ie]=useState(!1),[A,De]=useState(null),[xe,Le]=useState(null),[Ee,_e]=useState([]);useEffect(()=>{pe()},[]);const pe=async(c=null)=>{se(!0);try{const f=c?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${c}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,te=await window.KTM.api.getJSON(f,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");z(Array.isArray(te)?te:[])}catch(f){console.error(f),N("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}se(!1)},Pe=async c=>{try{const f=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${c}`,"L\u1ED7i t\u1EA3i video");M(Array.isArray(f)?f:[])}catch(f){console.error(f)}},Ye=async c=>{if(c===0)return;const f=[...T];[f[c-1],f[c]]=[f[c],f[c-1]],z(f),await Ze(f)},ot=async c=>{if(c===T.length-1)return;const f=[...T];[f[c],f[c+1]]=[f[c+1],f[c]],z(f),await Ze(f)},Ze=async c=>{try{await Promise.all(c.map((f,te)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${f.id}`,{sortOrder:te},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),N("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(f){N("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),pe(xe==null?void 0:xe.id)}},et=async c=>{if(c===0)return;const f=[...K];[f[c-1],f[c]]=[f[c],f[c-1]],M(f),await m(f)},Fe=async c=>{if(c===K.length-1)return;const f=[...K];[f[c],f[c+1]]=[f[c+1],f[c]],M(f),await m(f)},m=async c=>{try{await Promise.all(c.map((f,te)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${f.id}`,{sort_order:te},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),N("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(f){N("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),Pe(ce.id)}},C=()=>{he(null),Se(!0)},$=c=>{he(c),Se(!0)},H=async c=>{try{!de&&xe&&(c.parent_id=xe.id);const f=de?`${API_BASE}/api/video-folders/${de.id}`:`${API_BASE}/api/video-folders`;de?await window.KTM.api.putJSON(f,c,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(f,c,"L\u1ED7i l\u01B0u folder"),N(de?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),Se(!1),pe(xe==null?void 0:xe.id)}catch(f){N(f.message,"danger")}},ee=async c=>{const f=c.subfolderCount>0?`X\xF3a folder "${c.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${c.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(f))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${c.id}`,"L\u1ED7i x\xF3a folder"),N("\u0110\xE3 x\xF3a folder","success"),Q(null),pe(xe==null?void 0:xe.id)}catch(te){N("L\u1ED7i x\xF3a folder","danger")}},Y=c=>{c.subfolderCount>0?(_e(f=>[...f,c]),Le(c),pe(c.id)):(Q(c),M(c.videos||[]))},B=c=>{if(c==="root")_e([]),Le(null),pe(null);else if(c){const f=Ee.findIndex(te=>te.id===c.id);f>=0&&(_e(Ee.slice(0,f+1)),Le(c),pe(c.id))}else{const f=[...Ee];f.pop();const te=f[f.length-1]||null;_e(f),Le(te),pe(te==null?void 0:te.id)}},oe=()=>{De(null),ie(!0)},d=c=>{De(c),ie(!0)},w=async c=>{try{c.folder_id=ce==null?void 0:ce.id;const f=A?`${API_BASE}/api/videos/${A.id}`:`${API_BASE}/api/videos`;A?await window.KTM.api.putJSON(f,c,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(f,c,"L\u1ED7i l\u01B0u video"),N(A?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),ie(!1),pe(),ce&&Pe(ce.id)}catch(f){N(f.message,"danger")}},L=async c=>{if(confirm(`X\xF3a video "${c.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${c.id}`,"L\u1ED7i x\xF3a video"),N("\u0110\xE3 x\xF3a video","success"),pe(),ce&&Pe(ce.id)}catch(f){N("L\u1ED7i x\xF3a video","danger")}},le=c=>{const f=`https://www.youtube.com/watch?v=${c.youtubeId}`;window.KTM.clipboard.writeText(f).then(()=>{N("\u0110\xE3 copy link!","success")}).catch(()=>{N("Kh\xF4ng th\u1EC3 copy link","danger")})};return ce?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Q(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${ce.slug==="shorts"?"text-danger":"text-warning"}`}),ce.name)),React.createElement("button",{className:"btn btn-warning",onClick:oe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),K.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},K.map((c,f)=>React.createElement("div",{key:c.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>et(f),disabled:f===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},f+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Fe(f),disabled:f===K.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:c.thumb,className:"card-img-top",alt:c.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${c.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:c.title},c.title),React.createElement("small",{className:"text-muted"},c.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>le(c),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>d(c),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>L(c),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Ae,video:A,onClose:()=>ie(!1),onSave:w})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},xe&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>B()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),xe?xe.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:C},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Ee.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:c=>{c.preventDefault(),B("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Ee.map((c,f)=>React.createElement("li",{key:c.id,className:`breadcrumb-item ${f===Ee.length-1?"active":""}`},f===Ee.length-1?c.name:React.createElement("a",{href:"#",onClick:te=>{te.preventDefault(),B(c)},className:"text-warning"},c.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),j?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):T.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},xe?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:C},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",xe?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},T.map((c,f)=>{var te,ge,qe,Xe;return React.createElement("div",{key:c.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:X=>{X.stopPropagation(),Ye(f)},disabled:f===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},f+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:X=>{X.stopPropagation(),ot(f)},disabled:f===T.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>Y(c),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${c.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},c.name),React.createElement("p",{className:"text-muted mb-0"},c.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),c.subfolderCount," folder"),c.subfolderCount>0&&(c.videoCount>0||((te=c.videos)==null?void 0:te.length)>0)&&" \u2022 ",(c.videoCount>0||((ge=c.videos)==null?void 0:ge.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),c.videoCount||((qe=c.videos)==null?void 0:qe.length)||0," videos"),c.subfolderCount===0&&!c.videoCount&&!((Xe=c.videos)!=null&&Xe.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:X=>{X.stopPropagation(),$(c)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:X=>{X.stopPropagation(),ee(c)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:ve,folder:de,onClose:()=>Se(!1),onSave:H}))}function VideoFolderModal({show:v,folder:N,onClose:T,onSave:z}){const[K,M]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[j,se]=useState(!1),[ce,Q]=useState(!1);useEffect(()=>{M(N?{name:N.name||"",description:N.description||"",sortOrder:N.sortOrder||0,coverImage:N.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[N,v]);const ve=async de=>{const he=de.target.files[0];if(he){Q(!0);try{const Ae=await window.KTM.cloudinary.uploadImage({file:he,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Ae.secure_url&&M(ie=>({...ie,coverImage:Ae.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Ae){console.error("Cloudinary upload error:",Ae),alert("L\u1ED7i upload \u1EA3nh: "+(Ae.message||Ae))}finally{Q(!1)}}},Se=async de=>{de.preventDefault(),se(!0);const he={...K,variants:normalizeVariants(K.variants,K.price),attributes:normalizeAttributes(K.attributes)};await z(he),se(!1)};return v?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},N?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:Se},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:K.name,onChange:de=>M({...K,name:de.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:K.description,onChange:de=>M({...K,description:de.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:K.sortOrder,onChange:de=>M({...K,sortOrder:parseInt(de.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},K.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:K.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>M({...K,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:ve,disabled:ce}),ce&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:K.coverImage,onChange:de=>M({...K,coverImage:de.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:T},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:j},j?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:v,settings:N}){const[T,z]=useState([]),[K,M]=useState(!0),[j,se]=useState(!1),[ce,Q]=useState(null),[ve,Se]=useState(""),[de,he]=useState(""),[Ae,ie]=useState(!1),[A,De]=useState(null),xe=normalizeShipPercent(N==null?void 0:N.ship_percent),{parseMoney:Le,formatVND:Ee}=window.KTM.money,_e=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{pe()},[]);const pe=async()=>{M(!0);try{const d=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");z(Array.isArray(d)?d:[])}catch(d){console.error(d),v("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}M(!1)},Pe=()=>{Q(null),se(!0)},Ye=d=>{Q(d),se(!0)},ot=d=>{d&&(De(d),ie(!0))},Ze=()=>{ie(!1)},et=async d=>{if(!(!d||!d.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:d},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),v(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),pe()}catch(w){v("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},Fe=async d=>{try{const w=ce?`${API_BASE}/api/products?id=${ce.id}`:`${API_BASE}/api/products`;ce?await window.KTM.api.putJSON(w,d,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(w,d,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),v(ce?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),se(!1),pe()}catch(w){v(w.message,"danger")}},m=async d=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${d.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${d.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),v("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),pe()}catch(w){v(w.message,"danger")}},C=T.filter(d=>{const w=!ve||d.name.toLowerCase().includes(ve.toLowerCase())||d.code&&d.code.toLowerCase().includes(ve.toLowerCase()),L=!de||d.category===de;return w&&L}),$=d=>{var le;const w=(le=d==null?void 0:d.commission_percent)!=null?le:d==null?void 0:d.commissionPercent,L=w===""||w==null?NaN:Number(w);return Number.isFinite(L)?Math.max(0,Math.min(100,L)):5},H=d=>{const w=$(d),L=Number.isInteger(w)?String(w):String(Math.round(w*100)/100),le=Le(d==null?void 0:d.price);if(!Number.isFinite(le)||le<=0)return`${L}%`;const c=(Number(w)||0)/100,te=window.KTM.money.parseShipFeeFromNote(d==null?void 0:d.note)!=null?0:xe>0?le*xe/100:0,ge=le*c-te*c,qe=Math.max(0,Math.round(ge));return`${L}% - ${Ee(qe)}`},ee=d=>{if(d==null||d==="")return[];let w=d;if(typeof w=="string"){const L=w.trim();if(!L)return[];try{w=JSON.parse(L)}catch(le){return[]}}return Array.isArray(w)?w:[]},Y=d=>{if(d==null||d==="")return[];let w=d;if(typeof w=="string"){const L=w.trim();if(!L)return[];try{w=JSON.parse(L)}catch(le){return[]}}return w&&typeof w=="object"&&!Array.isArray(w)&&(w=Object.entries(w).map(([L,le])=>({key:L,value:le}))),Array.isArray(w)?w:[]},B=d=>{const w=Y(d).map(L=>{var le,c,f,te,ge;return{key:String((f=(c=(le=L==null?void 0:L.key)!=null?le:L==null?void 0:L.name)!=null?c:L==null?void 0:L.label)!=null?f:"").trim(),value:String((te=L==null?void 0:L.value)!=null?te:"").trim(),unit:String((ge=L==null?void 0:L.unit)!=null?ge:"").trim()}}).filter(L=>!!L.key);return w.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},w.map((L,le)=>{const c=L.key,f=`${L.value||""}${L.unit?(L.value?" ":"")+L.unit:""}`.trim();return React.createElement("div",{key:`${c}-${le}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},c),f?React.createElement("span",{className:"ktm-chip ktm-chip-option"},f):null)}))):null},oe=(d,w={})=>{const L=ee(d).map(te=>{var ge;return{name:String((ge=te==null?void 0:te.name)!=null?ge:"").trim(),options:Array.isArray(te==null?void 0:te.options)?te.options:[]}}).map(te=>({...te,options:te.options.map(ge=>{var qe;return{label:String((qe=ge==null?void 0:ge.label)!=null?qe:"").trim(),price:Number(ge==null?void 0:ge.price)}}).filter(ge=>!!ge.label)})).filter(te=>te.options.length>0);if(!L.length)return null;const le=Number.isFinite(w.maxGroups)?Math.max(1,Math.trunc(w.maxGroups)):L.length,c=Number.isFinite(w.maxOptionsPerGroup)?Math.max(1,Math.trunc(w.maxOptionsPerGroup)):4,f=L.slice(0,le);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},f.map((te,ge)=>{const qe=te.name||"Bi\u1EBFn th\u1EC3",Xe=te.options.slice(0,c),X=te.options.length-Xe.length;return React.createElement("div",{key:`${qe}-${ge}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},qe),Xe.map((Qe,mt)=>{const y=Qe.price,E=Number.isFinite(y)&&y>=0?Ee(Math.trunc(y)):"",V=E?`${Qe.label} \xB7 ${E}`:Qe.label;return React.createElement("span",{key:`${qe}-${ge}-${mt}`,className:"ktm-chip ktm-chip-option"},V)}),X>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",X))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Pe},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:ve,onChange:d=>Se(d.target.value)})),React.createElement("span",{className:"product-count"},C.length)),React.createElement("select",{className:"form-select",value:de,onChange:d=>he(d.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),_e.map(d=>React.createElement("option",{key:d,value:d},d)))),K?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):C.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Pe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},C.map(d=>React.createElement("div",{key:d.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>ot(d),onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),ot(d))},title:"Xem chi ti\u1EBFt"},d.image?React.createElement("img",{src:d.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},d.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},d.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},d.category),d.code&&React.createElement("span",{className:"product-badge bg-secondary"},d.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),H(d))),React.createElement("div",{className:"product-price"},d.price?d.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),d.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},d.note),B(d.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},B(d.attributes)),oe(d.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},oe(d.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:w=>{w.stopPropagation(),Ye(d)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:w=>{w.stopPropagation(),m(d)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:Ae,title:String((A==null?void 0:A.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((A==null?void 0:A.code)||"").trim()||null,String((A==null?void 0:A.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Ze,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const d=String((A==null?void 0:A.code)||"").trim();d&&window.KTM.clipboard.writeText(d).then(()=>v("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((A==null?void 0:A.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const d=String((A==null?void 0:A.price)||"").trim();d&&window.KTM.clipboard.writeText(d).then(()=>v("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((A==null?void 0:A.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>A&&Ye(A),disabled:!A},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>A&&m(A),disabled:!A},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},A?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const d=String((A==null?void 0:A.price)||"").trim(),w=Le(d);return Number.isFinite(w)&&w>0?Ee(Math.trunc(w)):d||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},H(A)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},A.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},A.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),A.image?React.createElement("img",{src:A.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(A.note||"").trim()||A.attributes||A.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(A.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(A.note||"").trim()),B(A.attributes)?React.createElement("div",{className:"mt-2"},B(A.attributes)):null,oe(A.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},oe(A.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:j,product:ce,categories:_e,onClose:()=>se(!1),onSave:Fe}))}function ProductModal({show:v,product:N,categories:T,onClose:z,onSave:K}){const[M,j]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[se,ce]=useState(!1),[Q,ve]=useState(!1),Se=m=>{const C=window.KTM.money.getDigits(String(m!=null?m:"")),$=Number(C);return C&&Number.isFinite($)?Math.trunc($):0},de=m=>{if(m==null||m==="")return[];let C=m;if(typeof C=="string"){const $=C.trim();if(!$)return[];try{C=JSON.parse($)}catch(H){return[]}}return C&&typeof C=="object"&&!Array.isArray(C)&&(C=Object.entries(C).map(([$,H])=>({key:$,value:H}))),Array.isArray(C)?C.map($=>{var B,oe,d,w,L;if(!$||typeof $!="object")return null;const H=String((d=(oe=(B=$.key)!=null?B:$.name)!=null?oe:$.label)!=null?d:"").trim(),ee=String((w=$.value)!=null?w:"").trim(),Y=String((L=$.unit)!=null?L:"").trim();return H?{key:H,value:ee,unit:Y}:null}).filter(Boolean):[]},he=(m,C)=>{if(m==null||m==="")return[];let $=m;if(typeof $=="string"){const ee=$.trim();if(!ee)return[];try{$=JSON.parse(ee)}catch(Y){return[]}}if(!Array.isArray($))return[];const H=Se(C);return $.map(ee=>{var oe;if(!ee||typeof ee!="object")return null;const Y=String((oe=ee.name)!=null?oe:"").trim(),B=(Array.isArray(ee.options)?ee.options:[]).map(d=>{var te,ge,qe,Xe,X,Qe,mt;if(!d||typeof d!="object")return null;const w=String((te=d.label)!=null?te:"").trim();if(!w)return null;const L=(X=(Xe=(qe=(ge=d.price)!=null?ge:d.priceValue)!=null?qe:d.unit_price)!=null?Xe:d.unitPrice)!=null?X:null,le=Number(L);let c=Number.isFinite(le)?Math.trunc(le):null;if(c==null){const y=(mt=(Qe=d.price_delta)!=null?Qe:d.priceDelta)!=null?mt:null,E=Number(y);Number.isFinite(E)&&(c=H+Math.trunc(E))}c==null&&(c=H);const f=String(Math.max(0,Math.trunc(Number(c)||0)));return{label:w,price:Math.max(0,Math.trunc(Number(c)||0)),priceDigits:f}}).filter(Boolean);return{name:Y||"Bi\u1EBFn th\u1EC3",options:B}}).filter(Boolean)};useEffect(()=>{var m,C;j(N?{name:N.name||"",code:N.code||"",price:N.price||"",image:N.image||"",category:N.category||"",note:N.note||"",sort_order:N.sort_order||0,commission_percent:(C=(m=N.commission_percent)!=null?m:N.commissionPercent)!=null?C:5,variants:he(N.variants,N.price),attributes:de(N.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[N,v]);const Ae=m=>{j(C=>{var B;const $=Se(C.price),H=String($),ee=Array.isArray(C.variants)?[...C.variants]:[],Y={...ee[m]||{},options:Array.isArray((B=ee[m])==null?void 0:B.options)?[...ee[m].options]:[]};return Y.options=Y.options.map(oe=>({label:String((oe==null?void 0:oe.label)||""),price:$,priceDigits:H})),ee[m]=Y,{...C,variants:ee}})},ie=()=>{j(m=>{const C=Se(m.price),$=String(C),ee=(Array.isArray(m.variants)?[...m.variants]:[]).map(Y=>{const B=(Array.isArray(Y==null?void 0:Y.options)?Y.options:[]).map(oe=>({label:String((oe==null?void 0:oe.label)||""),price:C,priceDigits:$}));return{name:String((Y==null?void 0:Y.name)||"Bi\u1EBFn th\u1EC3"),options:B}});return{...m,variants:ee}})},[A,De]=React.useState(""),xe=m=>window.KTM.money.formatVNDInputDigits(m),[Le,Ee]=React.useState(""),_e=m=>{const C=window.KTM.money.nextPriceInputState(m.target.value,Le);Ee(C.digits),j({...M,price:C.price})},[pe,Pe]=React.useState("");React.useEffect(()=>{N!=null&&N.image&&Pe(N.image)},[N]);const Ye=async m=>{if(!(!m||!m.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:m},"L\u1ED7i x\xF3a \u1EA3nh")}catch(C){console.error("Delete cloudinary image error:",C)}},ot=async(m,C=2,$)=>{const H=C*1024*1024,ee=m.type==="image/heic"||m.type==="image/heif"||/\.heic$/i.test(m.name);if(m.size<=H&&!ee)return m;$==null||$("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const Y=await createImageBitmap(m);$==null||$("\u0110ang n\xE9n \u1EA3nh...");const B=document.createElement("canvas");let oe=Y.width,d=Y.height;const w=1200;return(oe>w||d>w)&&(oe>d?(d=Math.round(d/oe*w),oe=w):(oe=Math.round(oe/d*w),d=w)),B.width=oe,B.height=d,B.getContext("2d").drawImage(Y,0,0,oe,d),Y.close(),new Promise((le,c)=>{B.toBlob(f=>{f?($==null||$("Ho\xE0n t\u1EA5t!"),le(new File([f],m.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):c(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Y){throw console.error("createImageBitmap error:",Y),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ze=async m=>{var H,ee;const C=(H=m.target.files)==null?void 0:H[0];if(!C)return;if(!(C.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(C.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ve(!0),De("\u0110ang chu\u1EA9n b\u1ECB...");try{const Y=(C.size/1024/1024).toFixed(1);De(`File ${Y}MB - \u0110ang n\xE9n...`);const B=await ot(C,2,w=>{De(w)}),oe=(B.size/1024/1024).toFixed(1);De(`\u0110\xE3 n\xE9n: ${oe}MB - \u0110ang upload...`);const d=await window.KTM.cloudinary.uploadImage({file:B,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});d.secure_url?(M.image&&M.image!==pe&&Ye(M.image),j(w=>({...w,image:d.secure_url})),De("")):(console.error("Cloudinary error:",d),alert("Upload th\u1EA5t b\u1EA1i: "+(((ee=d.error)==null?void 0:ee.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),De(""))}catch(Y){console.error("Upload error:",Y),alert("L\u1ED7i: "+Y.message),De("")}ve(!1),m.target.value=""},et=()=>{M.image&&(M.image!==pe&&Ye(M.image),j(m=>({...m,image:""})))},Fe=async m=>{m.preventDefault(),ce(!0),pe&&M.image&&pe!==M.image&&await Ye(pe),pe&&!M.image&&await Ye(pe),await K(M),ce(!1)};return v?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${N?"fa-edit":"fa-plus-circle"} me-2`}),N?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:z})),React.createElement("form",{onSubmit:Fe},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},M.image?React.createElement(React.Fragment,null,React.createElement("img",{src:M.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:et,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Q?"fa-spinner fa-spin":"fa-camera"} me-1`}),Q?A||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Ze,disabled:Q,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Q&&A&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},A))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:M.name,onChange:m=>j({...M,name:m.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:M.code,onChange:m=>j({...M,code:m.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:M.price,onChange:_e,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:M.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:m=>j({...M,commission_percent:m.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:M.category,onChange:m=>j({...M,category:m.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),T.map(m=>React.createElement("option",{key:m,value:m},m)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:M.note,onChange:m=>j({...M,note:m.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(M.attributes)?M.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(M.attributes)?M.attributes:[]).map((m,C)=>React.createElement("div",{key:C,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(m==null?void 0:m.key)||"",onChange:$=>{const H=$.target.value;j(ee=>{const Y=Array.isArray(ee.attributes)?[...ee.attributes]:[];return Y[C]={...Y[C]||{},key:H},{...ee,attributes:Y}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(m==null?void 0:m.value)||"",onChange:$=>{const H=$.target.value;j(ee=>{const Y=Array.isArray(ee.attributes)?[...ee.attributes]:[];return Y[C]={...Y[C]||{},value:H},{...ee,attributes:Y}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(m==null?void 0:m.unit)||"",onChange:$=>{const H=$.target.value;j(ee=>{const Y=Array.isArray(ee.attributes)?[...ee.attributes]:[];return Y[C]={...Y[C]||{},unit:H},{...ee,attributes:Y}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{j($=>{const H=Array.isArray($.attributes)?[...$.attributes]:[];return H.splice(C,1),{...$,attributes:H}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{j(m=>{const C=Array.isArray(m.attributes)?[...m.attributes]:[];return C.push({key:"",value:"",unit:""}),{...m,attributes:C}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(M.variants)?M.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(M.variants)?M.variants:[]).map((m,C)=>React.createElement("div",{key:C,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(m==null?void 0:m.name)||"",onChange:$=>{const H=$.target.value;j(ee=>{var B;const Y=Array.isArray(ee.variants)?[...ee.variants]:[];return Y[C]={...Y[C]||{},name:H,options:Array.isArray((B=Y[C])==null?void 0:B.options)?Y[C].options:[]},{...ee,variants:Y}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Ae(C),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(m==null?void 0:m.options)||m.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{j($=>{const H=Array.isArray($.variants)?[...$.variants]:[];return H.splice(C,1),{...$,variants:H}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(m==null?void 0:m.options)?m.options:[]).map(($,H)=>{var ee,Y;return React.createElement("div",{key:H,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:($==null?void 0:$.label)||"",onChange:B=>{const oe=B.target.value;j(d=>{var f,te,ge,qe,Xe;const w=Array.isArray(d.variants)?[...d.variants]:[],L={...w[C]||{},options:Array.isArray((f=w[C])==null?void 0:f.options)?[...w[C].options]:[]},le=Number((ge=(te=L.options[H])==null?void 0:te.price)!=null?ge:0)||0,c=String((Xe=(qe=L.options[H])==null?void 0:qe.priceDigits)!=null?Xe:Math.max(0,Math.trunc(le)));return L.options[H]={...L.options[H]||{},label:oe,price:Math.max(0,Math.trunc(le)),priceDigits:c},w[C]=L,{...d,variants:w}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:xe(String((Y=$==null?void 0:$.priceDigits)!=null?Y:window.KTM.money.getDigits(String((ee=$==null?void 0:$.price)!=null?ee:"")))),onChange:B=>{j(oe=>{var ge,qe,Xe,X,Qe;const d=String((qe=$==null?void 0:$.priceDigits)!=null?qe:window.KTM.money.getDigits(String((ge=$==null?void 0:$.price)!=null?ge:""))),w=window.KTM.money.nextPriceInputState(B.target.value,d),L=String((Xe=w.digits)!=null?Xe:""),le=Number(L),c=Number.isFinite(le)?Math.max(0,Math.trunc(le)):0,f=Array.isArray(oe.variants)?[...oe.variants]:[],te={...f[C]||{},options:Array.isArray((X=f[C])==null?void 0:X.options)?[...f[C].options]:[]};return te.options[H]={...te.options[H]||{},label:String(((Qe=te.options[H])==null?void 0:Qe.label)||""),price:c,priceDigits:L},f[C]=te,{...oe,variants:f}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{j(B=>{var w;const oe=Array.isArray(B.variants)?[...B.variants]:[],d={...oe[C]||{},options:Array.isArray((w=oe[C])==null?void 0:w.options)?[...oe[C].options]:[]};return d.options.splice(H,1),oe[C]=d,{...B,variants:oe}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{j($=>{var B;const H=Array.isArray($.variants)?[...$.variants]:[],ee={...H[C]||{},options:Array.isArray((B=H[C])==null?void 0:B.options)?[...H[C].options]:[]},Y=Se($.price);return ee.options.push({label:"",price:Y,priceDigits:String(Y)}),H[C]=ee,{...$,variants:H}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{j(m=>{const C=Se(m.price),$=Array.isArray(m.variants)?[...m.variants]:[],H=String(C);return $.push({name:"Size",options:[{label:"S",price:C,priceDigits:H},{label:"M",price:C,priceDigits:H},{label:"L",price:C,priceDigits:H}]}),{...m,variants:$}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ie,disabled:!Array.isArray(M.variants)||M.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:M.image,onChange:m=>j({...M,image:m.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:z,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:se,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:v,video:N,onClose:T,onSave:z}){const[K,M]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[j,se]=useState(!1),[ce,Q]=useState("");useEffect(()=>{N?(M({title:N.title||"",youtube_url:`https://www.youtube.com/watch?v=${N.youtubeId}`,thumbnail_url:N.thumb||"",sort_order:N.sortOrder||0}),Q(N.thumb)):(M({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Q(""))},[N,v]);const ve=he=>{const Ae=he.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Ae?Ae[1]:null},Se=he=>{M({...K,youtube_url:he});const Ae=ve(he);Ae&&Q(`https://img.youtube.com/vi/${Ae}/hqdefault.jpg`)},de=async he=>{he.preventDefault(),se(!0),await z(K),se(!1)};return v?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},N?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:de},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:K.youtube_url,onChange:he=>Se(he.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),ce&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:ce,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:K.title,onChange:he=>M({...K,title:he.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:K.sort_order,onChange:he=>M({...K,sort_order:parseInt(he.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:K.thumbnail_url,onChange:he=>M({...K,thumbnail_url:he.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:T},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:j},j?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[v,N]=useState(!1),[T,z]=useState(""),[K,M]=useState(null),[j,se]=useState("search"),[ce,Q]=useState(()=>loadAdminPins()),[ve,Se]=useState(()=>loadAdminRecent()),[de,he]=useState(null),[Ae,ie]=useState(""),[A,De]=useState([]),[xe,Le]=useState(null),[Ee,_e]=useState(!1),[pe,Pe]=useState(null),[Ye,ot]=useState(!0),[Ze,et]=useState([]),[Fe,m]=useState(()=>loadAdminSettings()),[C,$]=useState(null),[H,ee]=useState([]);useEffect(()=>{const y=localStorage.getItem("ktm_admin_session");if(y)try{const E=JSON.parse(y);E.expiry>Date.now()?(N(!0),M(E.user)):localStorage.removeItem("ktm_admin_session")}catch(E){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{v&&le()},[v]),useEffect(()=>{const y=()=>{try{const V=document.querySelector(".admin-topbar");if(!V)return;const we=V.getBoundingClientRect(),Me=Math.max(0,Math.round(we.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${Me+10}px`)}catch(V){}};y(),window.addEventListener("resize",y);const E=setTimeout(y,0);return()=>{clearTimeout(E),window.removeEventListener("resize",y)}},[v,j]),useEffect(()=>{if(!v)return;const y=V=>{if(!V)return!1;const we=String(V.tagName||"").toLowerCase();return!!(we==="input"||we==="textarea"||we==="select"||V.isContentEditable)},E=V=>{if(!V||V.ctrlKey||V.metaKey||V.altKey||y(V.target))return;const we=V.key;(we==="/"||we==="N"||we==="n"||we==="Escape"||we==="j"||we==="J"||we==="k"||we==="K")&&(we==="/"&&V.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:we}})))};return document.addEventListener("keydown",E),()=>document.removeEventListener("keydown",E)},[v]),useEffect(()=>{v&&Se(y=>{const E=Array.isArray(y)?y:[],V=[j,...E.filter(we=>we!==j)].slice(0,8);return saveAdminRecent(V),V})},[v]);const Y=y=>{const E=String(y||"").trim();E&&Se(V=>{const we=Array.isArray(V)?V:[],Me=[E,...we.filter(Z=>Z!==E)].slice(0,8);return saveAdminRecent(Me),Me})},B=y=>{const E=String(y||"").trim();E&&Q(V=>{const we=Array.isArray(V)?V:[],Z=we.includes(E)?we.filter(Te=>Te!==E):[E,...we].slice(0,10);return saveAdminPins(Z),Z})};useEffect(()=>{if(!v)return;let y=!1;return(async()=>{try{const E=await fetchAdminSettingsFromServer();if(y)return;m(E),saveAdminSettings(E)}catch(E){}})(),()=>{y=!0}},[v]);const oe=async(y,E)=>{z("");try{const V=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:y,password:E},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),we={user:V.user,token:V.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(we)),M(V.user),N(!0)}catch(V){z(V.message)}},d=()=>{localStorage.removeItem("ktm_admin_session"),N(!1),M(null),De([]),Le(null)},w=(y,E="success",V=null)=>{const we=Date.now()+Math.floor(Math.random()*1e3);if(y&&typeof y=="object"){const Z=y;et(Te=>[...Te,{id:we,message:String(Z.message||""),type:String(Z.type||E||"success"),actionLabel:Z.actionLabel||null,onAction:typeof Z.onAction=="function"?Z.onAction:null,durationMs:Z.durationMs||null}]);return}const Me=V&&typeof V=="object"?V:null;et(Z=>[...Z,{id:we,message:String(y||""),type:String(E||"success"),actionLabel:(Me==null?void 0:Me.actionLabel)||null,onAction:typeof(Me==null?void 0:Me.onAction)=="function"?Me.onAction:null,durationMs:(Me==null?void 0:Me.durationMs)||null}])},L=y=>{et(E=>E.filter(V=>V.id!==y))},le=async(y=null)=>{ot(!0);try{const E=y?`${API_BASE}/api/albums?parent_id=${y}`:`${API_BASE}/api/albums?parent_id=root`,V=await window.KTM.api.getJSON(E,"L\u1ED7i t\u1EA3i danh s\xE1ch album");De(Array.isArray(V)?V:[])}catch(E){console.error(E),w("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}ot(!1)},c=()=>{Pe(null),_e(!0)},f=y=>{Pe(y),_e(!0)},te=async y=>{try{const E=pe&&pe.uuid;!E&&C&&(y.parent_id=C.uuid);const V=E?`${API_BASE}/api/albums/${pe.uuid||pe.id}`:`${API_BASE}/api/albums`;E?await window.KTM.api.putJSON(V,y,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(V,y,"L\u1ED7i t\u1EA1o"),w(E?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),_e(!1),le(C==null?void 0:C.uuid)}catch(E){w(E.message,"danger")}},ge=y=>{Le(y)},qe=y=>{if(y==="root")ee([]),$(null),le(null);else if(y){const E=H.findIndex(V=>V.uuid===y.uuid);E>=0&&(ee(H.slice(0,E+1)),$(y),le(y.uuid))}else{const E=[...H];E.pop();const V=E[E.length-1]||null;ee(E),$(V),le(V==null?void 0:V.uuid)}},Xe=async y=>{const E=`X\xF3a folder "${y.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(E))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${y.uuid||y.id}`,"L\u1ED7i x\xF3a album"),w("\u0110\xE3 x\xF3a","success"),le(C==null?void 0:C.uuid)}catch(V){w("L\u1ED7i x\xF3a album","danger")}};if(!v)return React.createElement(LoginPage,{onLogin:oe,error:T});const X=()=>{const y=new Date,E=y.getFullYear(),V=String(y.getMonth()+1).padStart(2,"0");return`${E}-${V}`};function Qe(){const[y,E]=useState(()=>{var Z;return String((Z=Fe==null?void 0:Fe.ship_percent)!=null?Z:DEFAULT_SHIP_PERCENT)}),[V,we]=useState(!1);return useEffect(()=>{var Z;E(String((Z=Fe==null?void 0:Fe.ship_percent)!=null?Z:DEFAULT_SHIP_PERCENT))},[Fe==null?void 0:Fe.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Z=>{Z.preventDefault(),we(!0);const Te=saveAdminSettings({ship_percent:y});try{const it=await saveAdminSettingsToServer(Te);m(it),saveAdminSettings(it),w("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(it){m(Te),w("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{we(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:y,min:"0",max:"100",step:"0.01",onChange:Z=>E(Z.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:V},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function mt(){const[y,E]=useState(X()),[V,we]=useState(!0),Me=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[Z,Te]=useState(Me),it=useRef(new Map),Nt=normalizeShipPercent(Fe==null?void 0:Fe.ship_percent),{formatNumber:fe,formatVND:Ve}=window.KTM.money,wt=async(_,$e=!1)=>{var $t,ct;const Be=String(_||"").trim();if(!Be)return Me();const h=`${Be}|${Nt}`,ye=($t=it.current)==null?void 0:$t.get(h);if(!$e&&ye)return ye;const ht=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(Be)}&ship_percent=${encodeURIComponent(Nt)}`,Je=await window.KTM.api.getJSON(ht,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),lt=Je!=null&&Je.stats&&(Je!=null&&Je.meta)?Je.stats:Je,gt=lt&&typeof lt=="object"?lt:Me();return(ct=it.current)==null||ct.set(h,gt),gt},S=async(_=!1)=>{we(!0);try{const $e=await wt(y,_);Te($e)}catch($e){console.error("Load stats error:",$e),Te(Me())}finally{we(!1)}};return useEffect(()=>{S()},[y,Nt]),React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:V}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>S(!0),disabled:V},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:y,onChange:_=>E(_.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",Nt,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),fe(Z.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),fe(Z.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),fe(Z.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",fe(Z.statusCounts.paid),"/",fe(Z.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},fe(Z.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ve(Z.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ve(Z.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ve(Z.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ve(Z.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",Z.avgQtyPerOrder?Z.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},fe(Z.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},fe(Z.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},fe(Z.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},fe(Z.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},fe(Z.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},fe(Z.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},fe(Z.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,fe(Z.statusCounts.draft)),React.createElement("td",null,fe(Z.statusCounts.pending)),React.createElement("td",null,fe(Z.statusCounts.processing)),React.createElement("td",null,fe(Z.statusCounts.canceled)),React.createElement("td",null,fe(Z.statusCounts.done)),React.createElement("td",null,fe(Z.statusCounts.paid)),React.createElement("td",null,fe(Z.statusCounts.other)),React.createElement("td",null,fe(Z.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Z.products.slice(0,10).map(_=>React.createElement("div",{key:_.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},_.product_name),React.createElement("div",{className:"text-muted small text-truncate"},_.product_code?`#${_.product_code} \u2022 `:"",fe(_.orders)," \u0111\u01A1n \u2022 ",fe(_.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ve(_.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Z.products.slice(0,10).map(_=>React.createElement("tr",{key:_.product_id},React.createElement("td",null,_.product_name),React.createElement("td",null,_.product_code||"\u2014"),React.createElement("td",null,fe(_.orders)),React.createElement("td",null,fe(_.quantity)),React.createElement("td",{className:"fw-semibold"},Ve(_.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Z.customers.slice(0,10).map(_=>React.createElement("div",{key:_.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},_.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},_.phone||"\u2014"," \u2022 ",fe(_.orders)," \u0111\u01A1n \u2022 ",fe(_.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ve(_.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Z.customers.slice(0,10).map(_=>React.createElement("tr",{key:_.key},React.createElement("td",null,_.customer_name||"\u2014"),React.createElement("td",null,_.phone||"\u2014"),React.createElement("td",null,fe(_.orders)),React.createElement("td",null,fe(_.quantity)),React.createElement("td",{className:"fw-semibold"},Ve(_.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},Z.days.map(_=>React.createElement("div",{key:_.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},_.day),React.createElement("div",{className:"text-muted small"},fe(_.orders)," \u0111\u01A1n \u2022 ",fe(_.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",fe(_.doneOrders)," \u2022 ",Ve(_.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Ve(_.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,Z.days.map(_=>React.createElement("tr",{key:_.day},React.createElement("td",null,_.day),React.createElement("td",null,fe(_.orders)),React.createElement("td",null,fe(_.quantity)),React.createElement("td",{className:"fw-semibold"},Ve(_.revenue)),React.createElement("td",null,fe(_.doneOrders)),React.createElement("td",{className:"fw-semibold"},Ve(_.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:j,onMenuChange:y=>{Y(y),se(y),y==="albums"&&($(null),ee([]),le(null))},onLogout:d,currentUser:K,pinnedMenus:ce,recentMenus:ve,onTogglePin:B}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const E={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[j]||{title:"KTM Admin",icon:"fa-tractor",sub:""},V=(K==null?void 0:K.username)||(K==null?void 0:K.name)||(K==null?void 0:K.email)||"Admin",we=(()=>{if(j!=="albums")return"";const Me=[];return Me.push("Root"),Array.isArray(H)&&H.length>0&&Me.push(...H.map(Z=>Z==null?void 0:Z.title).filter(Boolean)),xe!=null&&xe.title&&Me.push(xe.title),Me.length>0?Me.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${E.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},E.title),React.createElement("div",{className:"admin-page-subtitle"},we||E.sub))),React.createElement("div",{className:"admin-topbar-right"},j==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:c,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:V},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},V)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:d,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},j==="albums"&&!xe&&React.createElement(AlbumList,{albums:A,loading:Ye,currentFolder:C,breadcrumb:H,onSelect:ge,onCreate:c,onEdit:f,onDelete:Xe,onBack:qe}),j==="search"&&React.createElement(SearchCenter,{showToast:w,onNavigate:(y,E,V)=>{se(y),y==="orders"&&E==="create"&&(he(Date.now()),ie((V==null?void 0:V.productId)||""))}}),j==="albums"&&xe&&React.createElement(AlbumDetail,{album:xe,parentAlbum:H.length>0?H[H.length-1]:null,onBack:()=>{if(xe.parentId){const y=H.findIndex(E=>E.uuid===xe.parentId);y>=0?Le(H[y]):Le(null)}else Le(null)},onRefresh:()=>le(C==null?void 0:C.uuid),showToast:w,onNavigateToFolder:y=>{ee(E=>[...E,xe]),Le(y)},onEditSubfolder:y=>{Pe(y),_e(!0)}}),j==="videos"&&React.createElement(VideoList,{showToast:w}),j==="products"&&React.createElement(ProductManager,{showToast:w,settings:Fe}),j==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:de,autoOpenCreateProductId:Ae,showToast:w}),j==="stats"&&React.createElement(mt,null),j==="settings"&&React.createElement(Qe,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${j==="search"?"active":""}`,onClick:y=>{y.preventDefault(),se("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${j==="albums"?"active":""}`,onClick:y=>{y.preventDefault(),se("albums"),Le(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${j==="videos"?"active":""}`,onClick:y=>{y.preventDefault(),se("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${j==="products"?"active":""}`,onClick:y=>{y.preventDefault(),se("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${j==="orders"?"active":""}`,onClick:y=>{y.preventDefault(),se("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${j==="stats"?"active":""}`,onClick:y=>{y.preventDefault(),se("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:Ee,album:pe,parentId:C==null?void 0:C.uuid,onClose:()=>_e(!1),onSave:te}),React.createElement("div",{className:"toast-container"},Ze.map(y=>React.createElement(Toast,{key:y.id,message:y.message,type:y.type,actionLabel:y.actionLabel,onAction:y.onAction,durationMs:y.durationMs,onClose:()=>L(y.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:v,autoOpenCreateProductId:N,showToast:T}){const[z,K]=useState([]),[M,j]=useState(0),[se,ce]=useState(!1),[Q,ve]=useState(!1),[Se,de]=useState([]),[he,Ae]=useState(!0),[ie,A]=useState(!1),[De,xe]=useState([]),[Le,Ee]=useState(!1),[_e,pe]=useState(""),[Pe,Ye]=useState([]),[ot,Ze]=useState(!1),[et,Fe]=useState(""),[m,C]=useState(!1),[$,H]=useState(null),[ee,Y]=useState(null),[B,oe]=useState(!1),[d,w]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[L,le]=useState(""),[c,f]=useState(!1),[te,ge]=useState(!1),[qe,Xe]=useState(!1),[X,Qe]=useState(null),[mt,y]=useState(!1),[E,V]=useState(""),[we,Me]=useState(!1),Z=useRef(0),[Te,it]=useState(null),[Nt,fe]=useState(!1),[Ve,wt]=useState([]),[S,_]=useState(!1),[$e,Be]=useState([]),[h,ye]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[ht,Je]=useState([""]),[lt,gt]=useState(null),$t=useRef({}),[ct,Bt]=useState([]),[ze,Tt]=useState(null),Zt=useRef(null),Mt=useRef(null),jt=useRef(0),s=useRef(null),x=useRef(0),R=useRef(new Map),W=useRef(null),ae=useRef(0),D=useRef(new Map),b=useRef(new Map),J=useRef(""),be=useRef(null),me=useRef(null),ne=useRef(0),Ne=useRef(null),nt=9,Ge=150,ut=250,St=3*60*1e3,vt=24*60*60*1e3,yt=5*60*1e3,qt="ktm_customer_lookup_cache_v1",Pa=200,Lt=3,Et=3,ea=1,ka=24*60*60*1e3,Sa=120,Ca=5*60*1e3,O=80,F=2,G=4,re=60,P=React.useMemo(()=>String(_e||"").trim().length>0,[_e]),ue=e=>String(e||"").replace(/\s+/g," ").trim(),Oe=e=>String(e||"").replace(/[^0-9]+/g,""),je=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/ka)}catch(a){return 0}},We=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:je(e)>=Lt,st=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},rt=e=>{if(st(e==null?void 0:e.status)!=="draft")return null;const t=Et-je(e);return Number.isFinite(t)?t:null},bt=e=>{const a=rt(e);return Number.isFinite(a)?a>0&&a<=ea:!1},pt=e=>{ye({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Je([""]),it(null),gt(null)};useEffect(()=>{const e=a=>{var n;if(lt==null)return;const t=(n=$t.current)==null?void 0:n[lt];t&&!t.contains(a.target)&&gt(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[lt]);const xt=e=>window.KTM.money.parseMoney(e),kt=e=>window.KTM.money.parseSignedMoney(e),Ie=e=>window.KTM.money.formatVND(e),dt=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var r,o;return{amount:String((r=n==null?void 0:n.amount)!=null?r:""),note:String((o=n==null?void 0:n.note)!=null?o:"")}});return t.length?t:[{amount:"",note:""}]},It=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var r,o;return{amount:(n==null?void 0:n.amount)===0?"":String((r=n==null?void 0:n.amount)!=null?r:""),note:String((o=n==null?void 0:n.note)!=null?o:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},Ct=e=>(Array.isArray(e)?e:[]).map(t=>({amount:kt(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),Pt=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Ct(a),n=Kt(t),r=(()=>{if(!t.length)return"";const o=t.map(g=>String((g==null?void 0:g.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:r}},Kt=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),ta=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},Aa=e=>window.KTM.money.parseShipFeeFromNote(e),Wt=e=>window.KTM.phone.isValid(e),tt=e=>window.KTM.phone.normalize(e),Ka=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},sn=(e,a)=>{var o;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const r=new Map(t.map(g=>{var l;return[String((l=g==null?void 0:g.id)!=null?l:""),g]}));for(const g of n){const l=String((o=g==null?void 0:g.id)!=null?o:"");l&&r.set(l,g)}return Array.from(r.values())},la=async e=>{if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const a=await Ka(e.id);if(a&&typeof a=="object")return K(t=>Array.isArray(t)?t.map(n=>String(n==null?void 0:n.id)===String(e.id)?a:n):t),a}catch(a){console.error("Fetch order by id error:",a)}return e},rn=()=>{var e;try{const a=localStorage.getItem(qt);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[r,o]of n)!r||!o||typeof o!="object"||(e=b.current)==null||e.set(String(r),o)}catch(a){}},_a=()=>{try{const e=b.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,r])=>n&&r&&typeof r=="object"&&Number.isFinite(r.ts)).sort((n,r)=>(Number(r[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,Pa),t={};for(const[n,r]of a)t[n]=r;localStorage.setItem(qt,JSON.stringify(t))}catch(e){}};useEffect(()=>{rn()},[]);const Fa=e=>{const a=tt(e);if(!a)return null;const t=Array.isArray(z)?z:[];let n=null,r=-1;for(const o of t){if(!o||tt(o.phone||"")!==a)continue;const g=new Date(o.created_at).getTime(),l=Number.isFinite(g)?g:0;l>=r&&(r=l,n=o)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},qa=(e,a)=>{e&&ye(t=>a&&tt(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},on=e=>{const a=Fa(e);if(!a)return;const t=tt(e);ye(n=>{if(t&&tt(n.phone)!==t)return n;const r={...n};return!String(n.customer_name||"").trim()&&a.name&&(r.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(r.address=a.address),r})},ln=(e,a,t)=>{var n;try{const r=tt(e);if(!r)return;const o=String(a||"").trim(),g=String(t||"").trim();if(!o&&!g)return;(n=b.current)==null||n.set(r,{ts:Date.now(),status:"found",customer:{phone:r,name:o||null,address:g||null}}),_a()}catch(r){}},ca=async e=>{var r,o,g;const a=tt(e);if(!a)return;on(a);const t=(r=b.current)==null?void 0:r.get(a);if(t&&Number.isFinite(t.ts)){const l=Date.now()-t.ts,k=t.status==="found"?vt:yt;if(l>=0&&l<=k){it({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&qa(t.customer,a);return}}const n=++jt.current;it({status:"loading",phone:a});try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(jt.current!==n)return;if(l&&l.exists&&l.customer){(o=b.current)==null||o.set(a,{ts:Date.now(),status:"found",customer:l.customer}),_a(),it({status:"found",phone:a,customer:l.customer}),qa(l.customer,a);return}(g=b.current)==null||g.set(a,{ts:Date.now(),status:"not-found",customer:null}),_a(),it({status:"not-found",phone:a})}catch(l){if(jt.current!==n)return;console.error("Customer lookup error:",l),it({status:"error",phone:a})}},Ha=e=>{const a=tt(e),t=Fa(a);ye(r=>{const o={...r,phone:a};return t&&(!String(r.customer_name||"").trim()&&t.name&&(o.customer_name=t.name),!String(r.address||"").trim()&&t.address&&(o.address=t.address)),o}),fe(!1),Mt.current&&(clearTimeout(Mt.current),Mt.current=null);const n=a;if(n.length<nt){it(null);return}if(Wt(n)&&n!==J.current){J.current=n,ca(n);return}Mt.current=setTimeout(()=>{const r=tt(a);Wt(r)&&r!==J.current&&(J.current=r,ca(r))},Ge)},Va=()=>{const e=tt(h.phone);e.length<nt||Wt(e)&&e!==J.current&&(J.current=e,ca(e))};useEffect(()=>(te?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[te]);const da=Array.isArray(h.items)?h.items.length:0;useEffect(()=>{if(!te){ne.current=da;return}da>ne.current&&setTimeout(()=>{const e=be.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),ne.current=da},[te,da]),useEffect(()=>()=>{Mt.current&&(clearTimeout(Mt.current),Mt.current=null),s.current&&(clearTimeout(s.current),s.current=null)},[]),useEffect(()=>{if(!te)return;s.current&&(clearTimeout(s.current),s.current=null);const e=tt((h==null?void 0:h.phone)||"");if(!Wt(e)){wt([]),_(!1);return}return s.current=setTimeout(async()=>{var r;const a=String(e),t=(r=R.current)==null?void 0:r.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=St){wt(Array.isArray(t.orders)?t.orders:[]),_(!1);return}const n=++x.current;_(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,g=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(x.current!==n)return;const l=Array.isArray(g)?g:Array.isArray(g==null?void 0:g.orders)?g.orders:[];wt(l);try{const k=R.current;if(k&&typeof k.set=="function"&&(k.set(a,{ts:Date.now(),orders:l}),k.size>100)){const u=Array.from(k.entries()).sort((p,I)=>{var U,q;return(Number((U=p==null?void 0:p[1])==null?void 0:U.ts)||0)-(Number((q=I==null?void 0:I[1])==null?void 0:q.ts)||0)}),i=Math.max(0,u.length-100);for(let p=0;p<i;p++)k.delete(u[p][0])}}catch(k){}}catch(o){if(x.current!==n)return;console.error("Phone history fetch error:",o),wt([])}finally{if(x.current!==n)return;_(!1)}},ut),()=>{s.current&&(clearTimeout(s.current),s.current=null)}},[te,h==null?void 0:h.phone]),useEffect(()=>{cn()},[]),useEffect(()=>{P||zt()},[d,P]),useEffect(()=>{ha()},[]),useEffect(()=>{v&&Zt.current!==v&&(Zt.current=v,Ta(N))},[v]);const Ft=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",aa=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",Ba=React.useMemo(()=>window.KTM.orders.sortOrders(z),[z]),Ma=React.useMemo(()=>window.KTM.orders.sortOrders(Se),[Se]),ma=React.useMemo(()=>{const a=(Array.isArray(Ma)?Ma:[]).filter(t=>We(t));return a.sort((t,n)=>{const r=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(o)?o:0)}),a},[Ma]),za=React.useMemo(()=>{const a=(Array.isArray(De)?De:[]).filter(t=>bt(t));return a.sort((t,n)=>{const r=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(o)?o:0)}),a},[De]),na=React.useMemo(()=>c?ma:Ba,[c,ma,Ba]),ua=React.useMemo(()=>{if(c)return na;const e=String(L||"").trim();return e?(Array.isArray(na)?na:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):na},[na,L,c]),Ja=React.useMemo(()=>window.KTM.orders.sortOrders(Pe),[Pe]),Dt=React.useMemo(()=>P?Ja:ua,[ua,P,Ja]),Ht=React.useMemo(()=>{const e=Array.isArray(Dt)?Dt:[],a={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const n=st(t==null?void 0:t.status);n==="draft"?a.draft+=1:n==="pending"?a.pending+=1:n==="processing"?a.processing+=1:n==="done"?a.done+=1:n==="paid"?a.paid+=1:n==="canceled"?a.canceled+=1:a.other+=1}return a},[Dt]),Ga=React.useMemo(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`},[]),pa=e=>{if(P&&pe(""),e==="thisMonth"){f(!1),le(""),w(Ga);return}if(e==="overduePending"){w(""),f(!0),le("pending");return}if(e==="draftExpiring"){f(!1),le("draft"),w(""),ha();return}if(e==="all"){f(!1),le(""),w(Ga);return}},Ut=e=>window.KTM.date.formatDateTime(e),cn=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Bt(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Bt([])}},zt=async()=>{Ae(!0),ve(!1);try{const a=new URLSearchParams;d&&a.set("month",String(d)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(re)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),r=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],o=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;K(Array.isArray(r)?r:[]),j(Array.isArray(r)?r.length:0),ce(!!(o!=null&&o.hasMore)),ha()}catch(a){console.error("Load orders error:",a),K([]),j(0),ce(!1)}finally{Ae(!1),ve(!1)}},dn=async()=>{if(!(he||Q||P)&&se){ve(!0);try{const e=new URLSearchParams;d&&e.set("month",String(d)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(re)),e.set("offset",String(M));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],r=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;K(o=>sn(o,Array.isArray(n)?n:[])),j(o=>o+(Array.isArray(n)?n.length:0)),ce(!!(r!=null&&r.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{ve(!1)}}},Wa=async e=>{var r;const a=ue(e);if(!a){Ye([]),Fe(""),Ze(!1);return}const t=Oe(a);if(a.length<F&&t.length<G){Ye([]),Fe(`Nh\u1EADp \xEDt nh\u1EA5t ${F} k\xFD t\u1EF1 (ho\u1EB7c ${G} s\u1ED1) \u0111\u1EC3 search nhanh`),Ze(!1);return}try{const o=(r=D.current)==null?void 0:r.get(a);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=Ca){Ye(Array.isArray(o.results)?o.results:[]),Fe(""),Ze(!1);return}}catch(o){}const n=++ae.current;Ze(!0),Fe("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,g=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(ae.current!==n)return;const l=Array.isArray(g)?g:[];Ye(l);try{const k=D.current;if(k&&typeof k.set=="function"&&(k.set(a,{ts:Date.now(),results:l}),k.size>O)){const u=Array.from(k.entries()).sort((p,I)=>{var U,q;return(Number((U=p==null?void 0:p[1])==null?void 0:U.ts)||0)-(Number((q=I==null?void 0:I[1])==null?void 0:q.ts)||0)}),i=Math.max(0,u.length-O);for(let p=0;p<i;p++)k.delete(u[p][0])}}catch(k){}}catch(o){if(ae.current!==n)return;console.error("Order search error:",o),Ye([]),Fe((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if(ae.current!==n)return;Ze(!1)}};useEffect(()=>{W.current&&(clearTimeout(W.current),W.current=null);const e=ue(_e);if(!e){Ye([]),Fe(""),Ze(!1);return}return c&&f(!1),W.current=setTimeout(()=>{Wa(e)},Sa),()=>{W.current&&(clearTimeout(W.current),W.current=null)}},[_e]);const ha=async()=>{A(!0),Ee(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Lt)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(ea)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);de(Array.isArray(e)?e:[]),xe(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),de([]),xe([])}finally{A(!1),Ee(!1)}},$a=async e=>{const a=await la(e);if(!a)return;Tt(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(l=>{var k,u,i,p;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((k=l==null?void 0:l.quantity)!=null?k:1)||1,unit_price:(()=>{var q;const I=(q=l==null?void 0:l.unit_price)!=null?q:l==null?void 0:l.unitPrice,U=I==null||I===""?NaN:Number(I);return Number.isFinite(U)?Math.trunc(U):null})(),variant:String((u=l==null?void 0:l.variant)!=null?u:"").trim(),variant_json:(p=(i=l==null?void 0:l.variant_json)!=null?i:l==null?void 0:l.variantJson)!=null?p:null}}).filter(l=>l.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=It(a),r=Ct(n),o=Kt(r),g=ta(r);ye({customer_name:a.customer_name||"",phone:tt(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:o,adjustment_note:g||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),Je(new Array(t.length?t.length:1).fill("")),Be(new Array(t.length?t.length:1).fill(!0)),it(null),ge(!1),Qe(a),Xe(!0),V(""),y(!1),Me(!0),a.phone&&ca(tt(a.phone))},ba=async e=>{if(!e)return;Xe(!0),V(""),y(!0),Me(!1),Qe(e);const a=++Z.current;try{const t=await la(e);if(Z.current!==a)return;Qe(t||e)}catch(t){if(Z.current!==a)return;V((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(Z.current!==a)return;y(!1)}},mn=()=>{m||B||(Xe(!1),y(!1),V(""),Me(!1),Tt(null),pt(""),fe(!1),Be([]))};function Ta(e){Xe(!1),Me(!1),y(!1),V(""),Tt(null),pt(e||""),fe(!1),Be([]),ge(!0)}const ja=()=>{m||B||(ge(!1),Tt(null),pt(""),fe(!1),Be([]))},Ua=async()=>{var l,k,u;if(!ze||B||m)return;const e=(Array.isArray(z)?z:[]).find(i=>String(i==null?void 0:i.id)===String(ze))||null,a=String((e==null?void 0:e.status)||(h==null?void 0:h.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const i="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof T=="function"?T(i,"warning"):alert(i);return}const t=tt(h.phone),r=(Array.isArray(h.items)?h.items:[]).map((i,p)=>{var I,U;return{idx:p,product_id:String((i==null?void 0:i.product_id)||"").trim(),quantity:Number((I=i==null?void 0:i.quantity)!=null?I:0),variant:String((i==null?void 0:i.variant)||"").trim()||null,variant_json:(U=i==null?void 0:i.variant_json)!=null?U:null,unit_price:(()=>{const q=i==null?void 0:i.unit_price,Ce=q===""||q==null?NaN:Number(q);if(Number.isFinite(Ce))return Math.max(0,Math.trunc(Ce));const ke=At(i==null?void 0:i.product_id),at=i!=null&&i.variant_json&&typeof i.variant_json=="object"?i.variant_json:null;return Xt(ke,at)})()}}).filter(i=>i.product_id&&Number.isFinite(i.quantity)&&i.quantity>0);if(r.length<2){const i="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof T=="function"?T(i,"warning"):alert(i);return}const o=[],g=[];for(const i of r){const p=!!$e[i.idx],I={product_id:i.product_id,quantity:i.quantity,unit_price:i.unit_price,variant:i.variant,variant_json:i.variant_json};p?o.push(I):g.push(I)}if(!o.length||!g.length){const i="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof T=="function"?T(i,"warning"):alert(i);return}oe(!0);try{const i=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],p=Ct(i),I=Kt(p),U=ta(p),q={customer_name:h.customer_name,phone:t,address:h.address,note:(h.note||"").trim(),adjustment_amount:I,adjustment_note:U,adjustment_items:p,status:"processing",items:o,product_id:o[0].product_id,quantity:o[0].quantity,split_seq:1},Ce=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,q,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),ke=(u=(k=Ce==null?void 0:Ce.id)!=null?k:(l=Ce==null?void 0:Ce.order)==null?void 0:l.id)!=null?u:null;if(!ke)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const at={id:ze,customer_name:h.customer_name,phone:t,address:h.address,note:(h.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:g,product_id:g[0].product_id,quantity:g[0].quantity,parent_order_id:String(ke),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${ze}`,at,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),ja(),zt();const Re=ke?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${ke}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof T=="function"?T(Re,"success"):alert(Re)}catch(i){console.error(i);const p=(i==null?void 0:i.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof T=="function"?T(p,"danger"):alert(p)}finally{oe(!1)}},Xa=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=ct.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Ot=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},un=e=>{const t=Ot(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},Qa=React.useMemo(()=>(Array.isArray(ct)?ct:[]).map((e,a)=>{var u,i,p,I,U,q;const t=Ot((u=e==null?void 0:e.name)!=null?u:""),n=Ot((i=e==null?void 0:e.code)!=null?i:""),r=Ot((p=e==null?void 0:e.category)!=null?p:""),o=Ot((I=e==null?void 0:e.note)!=null?I:""),g=Ot((U=e==null?void 0:e.id)!=null?U:""),l=Ot((q=e==null?void 0:e.stt)!=null?q:""),k=`${t} ${n} ${r} ${o} ${g} ${l}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:r,note:o,haystackAll:k}}),[ct]),pn=(e,a,t)=>{var p,I,U,q,Ce;const n=Array.isArray(a)?a:[],r=Ot(t).trim();if(!n.length&&!r)return 0;const o=(p=e==null?void 0:e.name)!=null?p:"",g=(I=e==null?void 0:e.code)!=null?I:"",l=(U=e==null?void 0:e.category)!=null?U:"",k=(q=e==null?void 0:e.note)!=null?q:"";if(!((Ce=e==null?void 0:e.haystackAll)!=null?Ce:""))return 0;let i=0;r&&(o===r&&(i+=220),o.includes(r)&&(i+=140),o.startsWith(r)&&(i+=160),g&&g===r&&(i+=180),g&&g.includes(r)&&(i+=90));for(const ke of n){if(!ke)continue;const at=new RegExp(`(?:^|\\s)${ke.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(ke)&&(i+=35),at.test(o)&&(i+=25),g&&g.includes(ke)&&(i+=20),g&&at.test(g)&&(i+=10),l&&l.includes(ke)&&(i+=12),k&&k.includes(ke)&&(i+=6)}return i>0&&o&&(i+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),i},Ia=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const r=t.length,o=n.length;if(o>r)return Ia(n,t);let g=new Array(o+1),l=new Array(o+1);for(let k=0;k<=o;k++)g[k]=k;for(let k=1;k<=r;k++){l[0]=k;const u=t.charCodeAt(k-1);for(let p=1;p<=o;p++){const I=u===n.charCodeAt(p-1)?0:1;l[p]=Math.min(g[p]+1,l[p-1]+1,g[p-1]+I)}const i=g;g=l,l=i}return g[o]},hn=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const r=n.split(/\s+/).filter(Boolean);if(!r.length)return!1;const o=t.length<=4?1:2;for(const g of r)if(!(Math.abs(g.length-t.length)>o)&&Ia(t,g)<=o)return!0;return!1},fa=e=>{const a=Ot(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},bn=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=fa((e==null?void 0:e.name)||""),r=fa((e==null?void 0:e.code)||""),o=fa((e==null?void 0:e.category)||""),g=fa((e==null?void 0:e.note)||""),l=(u,i,p)=>{const I=String(u||"").trim();if(!I||!i.length)return 0;const U=I.length<=4?1:2;let q=1/0,Ce=-1;for(let Re=0;Re<i.length;Re++){const _t=i[Re];if(!_t||Math.abs(_t.length-I.length)>U)continue;const Ue=Ia(I,_t);if(Ue<q&&(q=Ue,Ce=Re,Ue===0))break}if(q===1/0||q>U)return 0;let at=Math.round(p*(q===0?1:q===1?.65:.45));return Ce===0?at+=Math.round(p*.25):Ce===1&&(at+=Math.round(p*.12)),at};let k=0;for(const u of t){if(!u)continue;const i=l(u,n,180),p=l(u,r,120),I=l(u,o,60),U=l(u,g,30);k+=Math.max(i,p,I,U)}if(k>0){const u=((e==null?void 0:e.name)||"").length;k+=Math.max(0,60-Math.min(60,Math.floor(u/2)))}return k},Da=React.useRef(new Map);React.useEffect(()=>{Da.current=new Map},[ct]);const Ya=e=>{var u,i;const a=String(ht[e]||"").trim();if(!a)return ct;const{contentTokens:t,cleanedQuery:n}=un(a);if(t.length===0)return ct;const r=Ot(a).trim(),o=Da.current.get(r);if(o)return o;const g=[];for(const p of Qa){const I=p.haystackAll;I&&t.some(U=>I.includes(U))&&g.push(p)}let l=g;if(l.length<8&&t.length>0){const p=[],I=new Set(l.map(U=>{var q,Ce;return String((Ce=(q=U.p)==null?void 0:q.id)!=null?Ce:"")+":"+String(U.originalIndex)}));for(const U of Qa){const q=String((i=(u=U.p)==null?void 0:u.id)!=null?i:"")+":"+String(U.originalIndex);if(I.has(q))continue;const Ce=U.haystackAll;Ce&&t.some(ke=>hn(ke,Ce))&&(p.push(U),I.add(q))}p.length&&(l=l.concat(p))}const k=l.map(p=>({entry:p,score:pn(p,t,n)})).map(p=>{if(p.score>0)return p;const I=bn(p.entry,t);return I>0?{...p,score:I}:p}).filter(p=>p.score>0).sort((p,I)=>I.score!==p.score?I.score-p.score:p.entry.originalIndex-I.entry.originalIndex).slice(0,40).map(p=>p.entry.p);return Da.current.set(r,k),k},At=e=>{if(!e)return null;const a=String(e);return ct.find(t=>String(t==null?void 0:t.id)===a)||null},Vt=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var g;if(!t||typeof t!="object")return null;const r=String((g=t.name)!=null?g:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,o=(Array.isArray(t.options)?t.options:[]).map(l=>{var Ce,ke,at,Re,_t,Ue,Rt;if(!l||typeof l!="object")return null;const k=String((Ce=l.label)!=null?Ce:"").trim();if(!k)return null;const u=(_t=(Re=(at=(ke=l.price)!=null?ke:l.priceValue)!=null?at:l.unit_price)!=null?Re:l.unitPrice)!=null?_t:null,i=u==null||u===""?NaN:typeof u=="number"?u:typeof u=="string"?xt(u):Number(u),p=Number.isFinite(i)?Math.trunc(i):null,I=(Rt=(Ue=l.price_delta)!=null?Ue:l.priceDelta)!=null?Rt:null,U=Number(I),q=Number.isFinite(U)?Math.trunc(U):0;return{label:k,price:p,price_delta:q}}).filter(Boolean);return{name:r,options:o}}).filter(Boolean):[]},kn=e=>{const a=At(e);return Vt(a==null?void 0:a.variants)},ga=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const r=String(t||"").trim(),o=String(n||"").trim();!r||!o||a.push(`${r}: ${o}`)}return a.join(", ")},Xt=(e,a)=>{const t=xt(e==null?void 0:e.price),n=Vt(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let r=t,o=!1;for(const g of n){const l=String((g==null?void 0:g.name)||"").trim(),k=String((a==null?void 0:a[l])||"").trim();if(!l||!k)continue;const u=(Array.isArray(g.options)?g.options:[]).find(q=>String((q==null?void 0:q.label)||"").trim()===k);if(!u)continue;const i=u==null?void 0:u.price,p=i==null||i===""?NaN:Number(i);if(Number.isFinite(p)){r=Math.max(0,Math.trunc(p)),o=!0;continue}const I=u==null?void 0:u.price_delta,U=I==null||I===""?NaN:Number(I);Number.isFinite(U)&&(r+=Math.trunc(U))}return r},Oa=e=>window.KTM.orders.getOrderItems(e),Za=e=>window.KTM.orders.getOrderTotalQty(e),Qt=e=>window.KTM.orders.getOrderProductSummary(e,At),va=e=>window.KTM.orders.getOrderItemRows(e,At),sa=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Jt=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),fn=e=>{const a=Oa(e),t=va(e),n=ra(a),r=ia(a),o=r.fee,g=sa(e),l=n+o+g,k=i=>{const p=Number(i)||0;return p>0?`+${Ie(p)}`:Ie(p)},u=[];if(e!=null&&e.customer_name&&u.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&u.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&u.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&u.push(`GHI CH\xDA: ${(e.note||"").trim()}`),u.push(""),u.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const i of t)u.push(`- ${i.name} (SL: ${i.qty})`);else{const i=Qt(e);i&&i!=="\u2014"&&u.push(`- ${i}`)}u.push(""),u.push(`T\u1EA0M T\xCDNH: ${Ie(n)}`),r.found&&o!==0&&u.push(`SHIP: ${Ie(o)}`);{const i=window.KTM.orders.getOrderAdjustmentItems(e),p=(Array.isArray(i)?i:[]).map(q=>{var Ce;return{amount:Number((Ce=q==null?void 0:q.amount)!=null?Ce:0)||0,note:String((q==null?void 0:q.note)||"").trim()}}).filter(q=>q.amount!==0||!!q.note),I=Jt(e);if(g!==0||p.length>0||!!I)if(p.length===1){const q=p[0];u.push(`\u0110I\u1EC0U CH\u1EC8NH: ${k(g)}${q.note?` \u2014 ${q.note}`:""}`)}else{u.push(`\u0110I\u1EC0U CH\u1EC8NH: ${k(g)}${!p.length&&I?` \u2014 ${I}`:""}`);for(const q of p)u.push(`- ${k(q.amount)}${q.note?`: ${q.note}`:""}`)}}return u.push(`T\u1ED4NG: ${Ie(l)}`),u.filter(Boolean).join(`
`)},Ra=async e=>{try{const a=await la(e),t=fn(a);await window.KTM.clipboard.writeText(t),typeof T=="function"?T("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof T=="function"?T("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},ia=e=>window.KTM.orders.getOrderShipInfo(e,At),ra=e=>window.KTM.orders.getItemsSubtotal(e,At),La=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},Ea=()=>d?String(d):La(new Date),en=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=tt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),r=Pt(e).amount,g=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(l=>{var k;return{product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((k=l==null?void 0:l.quantity)!=null?k:0),variant:String((l==null?void 0:l.variant)||"").trim()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0).sort((l,k)=>l.product_id<k.product_id?-1:l.product_id>k.product_id?1:l.variant<k.variant?-1:l.variant>k.variant?1:l.quantity-k.quantity);return JSON.stringify({name:a,phone:t,address:n,items:g,adj:r})},ft=React.useMemo(()=>{const e=tt((h==null?void 0:h.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ea()};const a=Ea(),n=(Array.isArray(Ve)?Ve:[]).filter(r=>{if(!r||ze&&String(r.id)===String(ze)||tt(r.phone||"")!==e)return!1;const o=La(r.created_at);return o&&o===a}).sort((r,o)=>{const g=new Date(r.created_at).getTime(),l=new Date(o.created_at).getTime();return(Number.isFinite(l)?l:0)-(Number.isFinite(g)?g:0)});return{count:n.length,orders:n,monthKey:a}},[Ve,h==null?void 0:h.phone,d,ze]),gn=e=>{var l;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=tt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),r=kt((l=e==null?void 0:e.adjustment_amount)!=null?l:0),o=Oa(e),g=(Array.isArray(o)?o:[]).map(k=>{var u;return{product_id:String((k==null?void 0:k.product_id)||"").trim(),quantity:Number((u=k==null?void 0:k.quantity)!=null?u:0),variant:String((k==null?void 0:k.variant)||"").trim()}}).filter(k=>k.product_id&&Number.isFinite(k.quantity)&&k.quantity>0).sort((k,u)=>k.product_id<u.product_id?-1:k.product_id>u.product_id?1:k.variant<u.variant?-1:k.variant>u.variant?1:k.quantity-u.quantity);return JSON.stringify({name:a,phone:t,address:n,items:g,adj:r})},tn=React.useMemo(()=>{if(ze)return"";const e=tt((h==null?void 0:h.phone)||"");if(!e)return"";const a=Ea(),t=en(h),n=Array.isArray(Ve)?Ve:[];for(const r of n){if(!r||ze&&String(r.id)===String(ze)||tt(r.phone||"")!==e)continue;const o=La(r.created_at);if(!o||o!==a)continue;const g=gn(r);if(g&&g===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${r!=null&&r.id?` (#${r.id})`:""}`}return""},[Ve,h,d,ze]),an=e=>{var _t;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),r=tt((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),r||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),r&&!Wt(r)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const l=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ue=>Ue&&Ue.product_id);l.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),l.some(Ue=>{var Gt;const Rt=Number((Gt=Ue==null?void 0:Ue.quantity)!=null?Gt:0);return!Number.isFinite(Rt)||Rt<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const u=new Set;let i=!1;for(const Ue of l){const Rt=String(Ue.product_id||"").trim(),Gt=String((Ue==null?void 0:Ue.variant)||"").trim();if(!Rt)continue;const He=`${Rt}||${Gt}`;if(u.has(He)){i=!0;break}u.add(He)}i&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const p=ra(l),I=ia(l),U=I!=null&&I.found?Number((_t=I==null?void 0:I.fee)!=null?_t:0):0,q=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],Ce=Ct(q),ke=Kt(Ce),at=Ce.some(Ue=>(Number(Ue==null?void 0:Ue.amount)||0)!==0&&!String((Ue==null?void 0:Ue.note)||"").trim());I!=null&&I.found&&(U>=2e5||p>0&&U>p*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ie(U)}`),at&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Re=Math.abs(ke);return(Re>=5e5||p>0&&Re>p*.5)&&ke!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ie(ke)}`),{errors:a,warnings:t,canSubmit:a.length===0}},Sn=React.useMemo(()=>an(h),[h,ct]),Ke=React.useMemo(()=>{var Gt;const e=String((h==null?void 0:h.customer_name)||"").trim(),a=tt((h==null?void 0:h.phone)||""),t=String((h==null?void 0:h.address)||"").trim(),n=Array.isArray(h==null?void 0:h.items)?h.items:[],r=new Map;for(const He of n){const Yt=String((He==null?void 0:He.product_id)||"").trim(),wa=String((He==null?void 0:He.variant)||"").trim();if(!Yt)continue;const xa=`${Yt}||${wa}`;r.set(xa,(r.get(xa)||0)+1)}const o=n.map(He=>{var nn;const Yt=String((He==null?void 0:He.product_id)||"").trim(),wa=Number((nn=He==null?void 0:He.quantity)!=null?nn:0),xa=Yt?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",yn=Number.isFinite(wa)&&wa>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",Nn=String((He==null?void 0:He.variant)||"").trim(),wn=`${Yt}||${Nn}`,xn=Yt&&(r.get(wn)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:xa,qtyError:yn,dupWarn:xn}}),g=n.filter(He=>He&&He.product_id),l=ra(g),k=ia(g),u=k!=null&&k.found?Number((Gt=k==null?void 0:k.fee)!=null?Gt:0):0,i=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],p=Ct(i),I=Kt(p),U=p.some(He=>(Number(He==null?void 0:He.amount)||0)!==0&&!String((He==null?void 0:He.note)||"").trim()),q=Math.abs(I),Ce=U?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ke=I!==0&&(q>=5e5||l>0&&q>l*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ie(I)}`:"",at=k!=null&&k.found&&(u>=2e5||l>0&&u>l*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ie(u)}`:"",Re=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",_t=a?Wt(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ue=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Rt=!Re&&!_t&&o.every(He=>!He.productError&&!He.qtyError);return{nameError:Re,phoneError:_t,addressWarn:Ue,items:o,shipAbnormalWarn:at,adjustmentNoteWarn:Ce,adjustmentAbnormalWarn:ke,canSubmit:Rt}},[h,ct]),ya=async e=>{var l,k,u;const a=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",n=an(h);if(!n.canSubmit){const i=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof T=="function"?T(i,"danger"):alert(i);return}if(!ze&&tn){const i=`${tn}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(i)){(ft==null?void 0:ft.count)>0&&fe(!0),setTimeout(()=>{var U;const I=document.getElementById("order-phone-input");I&&typeof I.scrollIntoView=="function"&&(I.scrollIntoView({block:"center",behavior:"smooth"}),(U=I.focus)==null||U.call(I))},0);return}}const r=tt(h.phone),g=(Array.isArray(h.items)?h.items:[]).map(i=>{var p,I;return{product_id:(i==null?void 0:i.product_id)||"",quantity:Number((p=i==null?void 0:i.quantity)!=null?p:1),variant:String((i==null?void 0:i.variant)||"").trim()||null,variant_json:(I=i==null?void 0:i.variant_json)!=null?I:null,unit_price:(()=>{const U=i==null?void 0:i.unit_price,q=U===""||U==null?NaN:Number(U);if(Number.isFinite(q))return Math.max(0,Math.trunc(q));const Ce=At(i==null?void 0:i.product_id),ke=i!=null&&i.variant_json&&typeof i.variant_json=="object"?i.variant_json:null;return Xt(Ce,ke)})()}}).filter(i=>i.product_id&&Number.isFinite(i.quantity)&&i.quantity>0);C(!0);try{const i=ze,p=ze?`${API_BASE}/api/orders/${ze}`:`${API_BASE}/api/orders`,I=g[0],U=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],q=Ct(U),Ce=Kt(q),ke=ta(q),at={customer_name:h.customer_name,phone:r,address:h.address,note:(h.note||"").trim(),adjustment_amount:Ce,adjustment_note:ke,adjustment_items:q,product_id:I.product_id,quantity:I.quantity,status:h.status,items:g,...ze?{id:ze}:{}};if(ze)await window.KTM.api.putJSON(p,at,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Re=await window.KTM.api.postJSON(p,at,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Ne.current={id:(u=(k=Re==null?void 0:Re.id)!=null?k:(l=Re==null?void 0:Re.order)==null?void 0:l.id)!=null?u:null,fingerprint:en(h),ts:Date.now()}}if(ln(r,h.customer_name,h.address),t==="drawer"){if(pt(""),Tt(null),ge(!1),Me(!1),fe(!1),Be([]),zt(),i){y(!0),V("");try{const Re=await Ka(i);Re&&typeof Re=="object"&&Qe(Re)}catch(Re){V((Re==null?void 0:Re.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{y(!1)}}}else a==="new"&&!ze?(pt(""),Tt(null),ge(!0)):(pt(""),Tt(null),ge(!1)),zt()}catch(i){console.error(i),typeof T=="function"?T(i.message,"danger"):alert(i.message);return}finally{C(!1)}},oa=e=>window.KTM.orders.getOrderTotalMoney(e,At),Cn=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){H(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),zt(),ha()}catch(a){console.error(a),typeof T=="function"?T(a.message,"danger"):alert(a.message)}finally{H(null)}}},Na=async(e,a)=>{var o;const t=await la(e),n=t==null?void 0:t.id;if(!n||!a)return;const r=st(t==null?void 0:t.status);Y(n);try{const g=Oa(t),l=(Array.isArray(g)?g:[]).map(i=>{var p,I;return{product_id:(i==null?void 0:i.product_id)||"",quantity:Number((p=i==null?void 0:i.quantity)!=null?p:1),variant:String((i==null?void 0:i.variant)||"").trim()||null,variant_json:(I=i==null?void 0:i.variant_json)!=null?I:null,unit_price:(()=>{var Ce;const U=(Ce=i==null?void 0:i.unit_price)!=null?Ce:i==null?void 0:i.unitPrice,q=Number(U);return Number.isFinite(q)?Math.max(0,Math.trunc(q)):null})()}}).filter(i=>i.product_id&&Number.isFinite(i.quantity)&&i.quantity>0);if(!l.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const k=l[0],u={id:n,customer_name:(t==null?void 0:t.customer_name)||"",phone:tt((t==null?void 0:t.phone)||""),address:(t==null?void 0:t.address)||"",note:((t==null?void 0:t.note)||"").trim(),adjustment_amount:Number((o=t==null?void 0:t.adjustment_amount)!=null?o:0)||0,adjustment_note:(t==null?void 0:t.adjustment_note)||"",product_id:k.product_id,quantity:k.quantity,status:a,items:l};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${n}`,u,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),K(i=>Array.isArray(i)?i.map(p=>(p==null?void 0:p.id)===n?{...p,status:a}:p):i),de(i=>Array.isArray(i)?i.map(p=>(p==null?void 0:p.id)===n?{...p,status:a}:p):i),typeof T=="function"){const i=`${Ft(r)} \u2192 ${Ft(a)}`.trim();T(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${i}`,"success",{actionLabel:"Undo",durationMs:6500,onAction:()=>{!r||r===st(a)||Na({...t,status:a},r)}})}}catch(g){console.error(g),typeof T=="function"?T(g.message,"danger"):alert(g.message)}finally{Y(null)}};useEffect(()=>{const e=a=>{var n;const t=(n=a==null?void 0:a.detail)==null?void 0:n.key;if(t){if(t==="/"){setTimeout(()=>{var r,o;(o=(r=me.current)==null?void 0:r.focus)==null||o.call(r)},0);return}if(t==="N"||t==="n"){Ta();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&qe&&(X!=null&&X.id)){const r=Array.isArray(Dt)?Dt:[],o=r.findIndex(k=>String(k==null?void 0:k.id)===String(X==null?void 0:X.id));if(o<0)return;const l=r[o+(t==="j"||t==="J"?-1:1)];l&&ba(l)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[Dt,qe,X]);const vn=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:h.customer_name,onChange:e=>ye({...h,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Ke.nameError&&React.createElement("div",{className:"form-text text-danger"},Ke.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:h.phone,onChange:e=>Ha(e.target.value),onBlur:Va,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Ke.phoneError&&React.createElement("div",{className:"form-text text-danger"},Ke.phoneError),!Ke.phoneError&&ft.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",ft.count," \u0111\u01A1n trong th\xE1ng ",ft.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>fe(e=>!e)},Nt?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),Nt&&ft.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>fe(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},ft.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${aa(e.status)}`},Ft(e.status))),React.createElement("div",{className:"text-muted small"},Ut(e.created_at)," \u2022 ",Ie(oa(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Qt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&$a(e)}},"M\u1EDF")))),ft.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(Te==null?void 0:Te.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(Te==null?void 0:Te.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(Te==null?void 0:Te.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(Te==null?void 0:Te.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:h.status,onChange:e=>ye({...h,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:h.address,onChange:e=>ye({...h,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Ke.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Ke.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:h.note,onChange:e=>ye({...h,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ye(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},dt(h.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;ye(r=>{const o=dt(r.adjustment_items);return o[a]={...o[a],amount:n},{...r,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;ye(r=>{const o=dt(r.adjustment_items);return o[a]={...o[a],note:n},{...r,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{ye(t=>{const n=dt(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:m||dt(h.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Ke.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Ke.adjustmentAbnormalWarn),!!Ke.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Ke.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ye(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Je(e=>[...Array.isArray(e)?e:[],""]),ze&&Be(e=>[...Array.isArray(e)?e:[],!0])},disabled:m},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(h.items)?h.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{$t.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{gt(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Xa(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),lt===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:ht[a]||"",onChange:t=>{const n=t.target.value;Je(r=>{const o=Array.isArray(r)?[...r]:[];return o[a]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=Ya(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(n.id),o=Vt(n==null?void 0:n.variants),g={};for(const u of o){const i=String((u==null?void 0:u.name)||"").trim(),p=Array.isArray(u==null?void 0:u.options)?u.options[0]:null,I=String((p==null?void 0:p.label)||"").trim();i&&I&&(g[i]=I)}const l=ga(g),k=Xt(n,g);ye(u=>{const i=Array.isArray(u.items)?[...u.items]:[];return i[a]={...i[a]||{quantity:1},product_id:r,variant_json:Object.keys(g).length?g:null,variant:l,unit_price:o.length?k:null},{...u,items:i}}),gt(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),ct.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Ke.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=At(e.product_id),n=Vt(t==null?void 0:t.variants);if(!n.length)return null;const r=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,g)=>{const l=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${g+1}`).trim(),k=String((r==null?void 0:r[l])||"").trim();return React.createElement("div",{key:l},React.createElement("label",{className:"form-label small text-muted mb-1"},l),React.createElement("select",{className:"form-select",value:k,onChange:u=>{const i=String(u.target.value||"").trim();ye(p=>{const I=Array.isArray(p.items)?[...p.items]:[],U={...I[a]||{}},q=At(U.product_id),Ce=Vt(q==null?void 0:q.variants),ke=U!=null&&U.variant_json&&typeof U.variant_json=="object"?{...U.variant_json}:{};i?ke[l]=i:delete ke[l];const at=ga(ke),Re=Xt(q,ke);return I[a]={...U,variant_json:Object.keys(ke).length?ke:null,variant:at,unit_price:Re},{...p,items:I}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",l," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(u=>React.createElement("option",{key:u.label,value:u.label},u.label,Number.isFinite(Number(u==null?void 0:u.price))?` (${Ie(Number(u.price))})`:Number(u==null?void 0:u.price_delta)?` (${u.price_delta>0?"+":""}${u.price_delta})`:""))))}))})(),ze&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!$e[a],onChange:t=>{const n=!!t.target.checked;Be(r=>{const o=Array.isArray(r)?[...r]:[],g=Array.isArray(h.items)?h.items.length:0;for(;o.length<g;)o.push(!0);return o[a]=n,o})},disabled:m||B}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;ye(r=>{const o=Array.isArray(r.items)?[...r.items]:[];return o[a]={...o[a]||{product_id:""},quantity:n},{...r,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Ke.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{ye(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Je(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),Be(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),gt(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:m||B||(Array.isArray(h.items)?h.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(h.items)?h.items:[]).filter(l=>l==null?void 0:l.product_id),t=ra(a),n=ia(a),r=Pt(h),o=r.amount,g=t+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ie(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ie(n.fee))),!!Ke.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Ke.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ie(o))),(h.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(h.note||"").trim()),!!r.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",r.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ie(g)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:m||!!$||!!ee}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ht.all," \u0111\u01A1n"),P&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>P?Wa(_e):zt(),disabled:ot,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>Ta(),disabled:m||!!$},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip ${!L&&!c&&!P?"active":""}`,onClick:()=>{P&&pe(""),f(!1),le("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ht.all)),React.createElement("button",{type:"button",className:`orders-chip ${L==="draft"&&!c&&!P?"active":""}`,onClick:()=>{P&&pe(""),f(!1),le("draft"),w("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ht.draft)),React.createElement("button",{type:"button",className:`orders-chip ${L==="pending"&&!c&&!P?"active":""}`,onClick:()=>{P&&pe(""),f(!1),le("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ht.pending)),React.createElement("button",{type:"button",className:`orders-chip ${L==="processing"&&!c&&!P?"active":""}`,onClick:()=>{P&&pe(""),f(!1),le("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ht.processing)),React.createElement("button",{type:"button",className:`orders-chip ${L==="done"&&!c&&!P?"active":""}`,onClick:()=>{P&&pe(""),f(!1),le("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ht.done)),React.createElement("button",{type:"button",className:`orders-chip ${L==="paid"&&!c&&!P?"active":""}`,onClick:()=>{P&&pe(""),f(!1),le("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ht.paid)),React.createElement("button",{type:"button",className:`orders-chip ${L==="canceled"&&!c&&!P?"active":""}`,onClick:()=>{P&&pe(""),f(!1),le("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ht.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>pa("thisMonth"),disabled:P},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>pa("overduePending"),disabled:P},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",Lt," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>pa("draftExpiring"),disabled:P},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a"),(L||c||!d&&!P)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>pa("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:me,type:"text",className:"form-control",value:_e,onChange:e=>pe(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(_e||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>pe(""),disabled:ot},React.createElement("i",{className:"fas fa-times"})),ot&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:d,onChange:e=>w(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:c||P})),React.createElement("div",{className:"text-muted small ms-auto"},P?"Search b\u1ECF qua filter":c?"\u0110ang xem \u0111\u01A1n ch\u1EADm":L?`L\u1ECDc: ${Ft(L)}`:""))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},P?`${Dt.length} k\u1EBFt qu\u1EA3`:L?`${ua.length}/${z.length} \u0111\u01A1n`:`${z.length}${se?"+":""} \u0111\u01A1n`)),P&&et&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},et),ma.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,ma.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Lt," ng\xE0y.",ie&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{f(!0),le("pending")}},"Xem ngay")),za.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,za.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",ea," ng\xE0y).",Le&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{f(!1),le("draft"),w(""),zt()}},"Xem ngay")),(P?ot:he)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,a)=>React.createElement("div",{key:a,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,a)=>React.createElement("tr",{key:a},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(P?Dt.length===0:z.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},P?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!P&&ua.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Dt.map(e=>{var a;return React.createElement("div",{key:e.id,className:"card mb-2",role:"button",tabIndex:0,onClick:()=>ba(e),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),ba(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${aa(e.status)}`},Ft(e.status)),We(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Lt} ng\xE0y`},"\u26A0 Ch\u1EADm ",je(e),"d"),bt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Et} ng\xE0y`},"\u23F3 C\xF2n ",rt(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=va(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,r)=>React.createElement("div",{key:r,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},r+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${Ie(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Qt(e))})()),(sa(e)!==0||Jt(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ie(sa(e))),Jt(e)?React.createElement("span",{className:"text-muted"}," ","(",Jt(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Ie(oa(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",Ut(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),Ra(e)},disabled:m||!!$||ee===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:t=>t.stopPropagation(),onChange:t=>{t.stopPropagation();const n=String(t.target.value||"").trim();t.target.value="",n&&Na(e,n)},disabled:m||!!$||ee===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"\u0110\u1ED5i tr\u1EA1ng th\xE1i\u2026"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,Dt.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>ba(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=va(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Ie(t.unitPrice))))):Qt(e)})()),React.createElement("td",null,Za(e)),React.createElement("td",{className:"fw-semibold"},Ie(oa(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${aa(e.status)}`},Ft(e.status)),We(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Lt} ng\xE0y`},"\u26A0 Ch\u1EADm ",je(e),"d"),bt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Et} ng\xE0y`},"\u23F3 C\xF2n ",rt(e),"d"))),React.createElement("td",null,Ut(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),Ra(e)},disabled:m||!!$||ee===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation();const t=String(a.target.value||"").trim();a.target.value="",t&&Na(e,t)},disabled:m||!!$||ee===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!P&&se&&!c&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:dn,disabled:he||Q},Q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:qe,title:(()=>{const e=X,a=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Ft(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${a} ${t}`.trim()})(),subtitle:(()=>{const e=X,a=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?Ut(e.created_at):"";return[a||t||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:mn,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},we?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Me(!1),Tt(null),pt(""),fe(!1),Be([])},disabled:m||B},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!ze&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:Ua,disabled:m||B,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},B?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>ya({mode:"close",origin:"drawer"}),disabled:m||B||!Ke.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},m?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>X&&Ra(X),disabled:!X||mt||m||!!$},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>X&&$a(X),disabled:!X||mt||m||!!$},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const a=String(e.target.value||"").trim();e.target.value="",a&&X&&Na(X,a)},disabled:!X||mt||m||!!$||ee===(X==null?void 0:X.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},we?React.createElement("form",{onSubmit:e=>{e.preventDefault(),ya({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),vn())):mt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):E?React.createElement("div",{className:"alert alert-danger",role:"alert"},E):X?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${aa(X.status)}`},Ft(X.status)),We(X)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Lt} ng\xE0y`},"\u26A0 Ch\u1EADm ",je(X),"d"),bt(X)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Et} ng\xE0y`},"\u23F3 C\xF2n ",rt(X),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},Ie(oa(X))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},Za(X)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},Ut(X.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},X.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},X.phone||"\u2014"),!!String(X.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(X.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},X.address||"\u2014")),((X==null?void 0:X.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(X.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=va(X);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((a,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),a.name),a.variant?React.createElement("div",{className:"text-muted small"},a.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${Ie(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Qt(X)||"\u2014")})(),(sa(X)!==0||Jt(X))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ie(sa(X))),Jt(X)?React.createElement("span",{className:"text-muted"}," ","(",Jt(X),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),te&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),ze?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:ja})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),ya({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:be},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:h.customer_name,onChange:e=>ye({...h,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Ke.nameError&&React.createElement("div",{className:"form-text text-danger"},Ke.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:h.phone,onChange:e=>Ha(e.target.value),onBlur:Va,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Ke.phoneError&&React.createElement("div",{className:"form-text text-danger"},Ke.phoneError),!Ke.phoneError&&ft.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",ft.count," \u0111\u01A1n trong th\xE1ng ",ft.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>fe(e=>!e)},Nt?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),Nt&&ft.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>fe(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},ft.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${aa(e.status)}`},Ft(e.status))),React.createElement("div",{className:"text-muted small"},Ut(e.created_at)," \u2022 ",Ie(oa(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Qt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&$a(e)}},"M\u1EDF")))),ft.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(Te==null?void 0:Te.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(Te==null?void 0:Te.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(Te==null?void 0:Te.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(Te==null?void 0:Te.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:h.status,onChange:e=>ye({...h,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:h.address,onChange:e=>ye({...h,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Ke.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Ke.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:h.note,onChange:e=>ye({...h,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ye(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},dt(h.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;ye(r=>{const o=dt(r.adjustment_items);return o[a]={...o[a],amount:n},{...r,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;ye(r=>{const o=dt(r.adjustment_items);return o[a]={...o[a],note:n},{...r,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{ye(t=>{const n=dt(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:m||dt(h.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Ke.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Ke.adjustmentAbnormalWarn),!!Ke.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Ke.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ye(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Je(e=>[...Array.isArray(e)?e:[],""]),ze&&Be(e=>[...Array.isArray(e)?e:[],!0])},disabled:m},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(h.items)?h.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{$t.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{gt(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Xa(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),lt===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:ht[a]||"",onChange:t=>{const n=t.target.value;Je(r=>{const o=Array.isArray(r)?[...r]:[];return o[a]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=Ya(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(n.id),o=Vt(n==null?void 0:n.variants),g={};for(const u of o){const i=String((u==null?void 0:u.name)||"").trim(),p=Array.isArray(u==null?void 0:u.options)?u.options[0]:null,I=String((p==null?void 0:p.label)||"").trim();i&&I&&(g[i]=I)}const l=ga(g),k=Xt(n,g);ye(u=>{const i=Array.isArray(u.items)?[...u.items]:[];return i[a]={...i[a]||{quantity:1},product_id:r,variant_json:Object.keys(g).length?g:null,variant:l,unit_price:o.length?k:null},{...u,items:i}}),gt(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),ct.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Ke.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=At(e.product_id),n=Vt(t==null?void 0:t.variants);if(!n.length)return null;const r=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,g)=>{const l=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${g+1}`).trim(),k=String((r==null?void 0:r[l])||"").trim();return React.createElement("div",{key:l},React.createElement("label",{className:"form-label small text-muted mb-1"},l),React.createElement("select",{className:"form-select",value:k,onChange:u=>{const i=String(u.target.value||"").trim();ye(p=>{const I=Array.isArray(p.items)?[...p.items]:[],U={...I[a]||{}},q=At(U.product_id),Ce=Vt(q==null?void 0:q.variants),ke=U!=null&&U.variant_json&&typeof U.variant_json=="object"?{...U.variant_json}:{};i?ke[l]=i:delete ke[l];const at=ga(ke),Re=Xt(q,ke);return I[a]={...U,variant_json:Object.keys(ke).length?ke:null,variant:at,unit_price:Re},{...p,items:I}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",l," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(u=>React.createElement("option",{key:u.label,value:u.label},u.label,Number.isFinite(Number(u==null?void 0:u.price))?` (${Ie(Number(u.price))})`:Number(u==null?void 0:u.price_delta)?` (${u.price_delta>0?"+":""}${u.price_delta})`:""))))}))})(),ze&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!$e[a],onChange:t=>{const n=!!t.target.checked;Be(r=>{const o=Array.isArray(r)?[...r]:[],g=Array.isArray(h.items)?h.items.length:0;for(;o.length<g;)o.push(!0);return o[a]=n,o})},disabled:m||B}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;ye(r=>{const o=Array.isArray(r.items)?[...r.items]:[];return o[a]={...o[a]||{product_id:""},quantity:n},{...r,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Ke.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{ye(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Je(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),Be(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),gt(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:m||B||(Array.isArray(h.items)?h.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(h.items)?h.items:[]).filter(l=>l==null?void 0:l.product_id),t=ra(a),n=ia(a),r=Pt(h),o=r.amount,g=t+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ie(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ie(n.fee))),!!Ke.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Ke.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ie(o))),(h.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(h.note||"").trim()),!!r.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",r.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ie(g)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:ja,disabled:m||B,style:{borderRadius:10}},"H\u1EE7y"),!!ze&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:Ua,disabled:m||B,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},B?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!ze&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>ya({mode:"new",origin:"modal"}),disabled:m||!Ke.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:m||B||!Ke.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},m?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

