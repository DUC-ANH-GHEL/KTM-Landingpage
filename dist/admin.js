const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:w,error:m}){const[j,A]=useState(""),[_,d]=useState(""),[f,C]=useState(!1),[L,b]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),m&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),m),React.createElement("form",{onSubmit:async V=>{V.preventDefault(),C(!0),await w(j,_),C(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:j,onChange:V=>A(V.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:L?"text":"password",className:"form-control",value:_,onChange:V=>d(V.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>b(!L)},React.createElement("i",{className:`fas fa-eye${L?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:f},f?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:w,type:m,onClose:j}){return useEffect(()=>{const A=setTimeout(j,3e3);return()=>clearTimeout(A)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${m} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},w),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:j})))}function Loading({show:w}){return w?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:w,onMenuChange:m,onLogout:j,currentUser:A}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(d=>React.createElement("a",{key:d.id,href:"#",className:`nav-link ${w===d.id?"active":""} ${d.disabled?"opacity-50":""} ${d.highlight?"text-warning":""}`,onClick:f=>{f.preventDefault(),d.disabled||m(d.id)}},React.createElement("i",{className:`fas ${d.icon}`})," ",d.label,d.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),d.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),j&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:j,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:w,onSelect:m,onCreate:j,onEdit:A,onDelete:_,loading:d,currentFolder:f,onBack:C,breadcrumb:L}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},f&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:C},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),f?f.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:j},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),L&&L.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),C("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),L.map((b,M)=>React.createElement("li",{key:b.id,className:`breadcrumb-item ${M===L.length-1?"active":""}`},M===L.length-1?b.title:React.createElement("a",{href:"#",onClick:V=>{V.preventDefault(),C(b)},className:"text-warning"},b.title))))),d?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):w.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},f?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},w.map(b=>React.createElement("div",{key:b.uuid||b.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>m(b)},b.cover?React.createElement("img",{src:b.cover,className:"album-cover",alt:b.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},b.title),React.createElement("small",{className:"text-muted"},b.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),b.subfolderCount),b.subfolderCount>0&&b.count>0&&" \u2022 ",b.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),b.count),b.subfolderCount===0&&b.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:M=>{M.stopPropagation(),A(b)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:M=>{M.stopPropagation(),_(b)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:w,album:m,onClose:j,onSave:A,parentId:_}){const[d,f]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[C,L]=useState(!1),[b,M]=useState(!1),V=useRef(null);useEffect(()=>{f(m?{slug:m.id||"",title:m.title||"",description:m.description||"",cover_url:m.cover||"",parent_id:m.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:_||null})},[m,w,_]);const $=async T=>{T.preventDefault(),L(!0),await A(d),L(!1)},I=T=>T.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),q=async T=>{const D=T.type==="image/heic"||T.type==="image/heif"||/\.heic$/i.test(T.name);if(T.size<=2097152&&!D)return T;try{const Y=await createImageBitmap(T),U=document.createElement("canvas");let g=Y.width,E=Y.height;const z=800;return(g>z||E>z)&&(g>E?(E=Math.round(E/g*z),g=z):(g=Math.round(g/E*z),E=z)),U.width=g,U.height=E,U.getContext("2d").drawImage(Y,0,0,g,E),Y.close(),new Promise((te,O)=>{U.toBlob(J=>{J?te(new File([J],T.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):O(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Y){throw console.error("Compress cover error:",Y),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},P=async T=>{var Y;const y=T.target.files[0];if(!y)return;if(!(y.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(y.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}M(!0);try{const U=await q(y),g=new FormData;g.append("file",U),g.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),g.append("folder","ktm-albums/covers");const E=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:g}),z=await E.json();if(!E.ok)throw console.error("Cloudinary error:",z),new Error(((Y=z.error)==null?void 0:Y.message)||"Upload failed");f(N=>({...N,cover_url:z.secure_url}))}catch(U){console.error("Cover upload error:",U),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+U.message)}M(!1),T.target.value=""};return w?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},m?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:$},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:d.title,onChange:T=>f({...d,title:T.target.value,slug:d.slug||I(T.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:d.slug,onChange:T=>f({...d,slug:T.target.value}),required:!0,disabled:!!m}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:d.description,onChange:T=>f({...d,description:T.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},d.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:d.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>f(T=>({...T,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:V,type:"file",accept:"image/*",className:"d-none",onChange:P}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var T;return(T=V.current)==null?void 0:T.click()},disabled:b},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:d.cover_url,onChange:T=>f({...d,cover_url:T.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:C||b},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:w,allAlbums:m,currentAlbumId:j,targetAlbum:A,onSelect:_,level:d=0}){const[f,C]=useState(!0),L=w.uuid||w.id,b=L===j,M=A===L,V=m.filter(I=>I.parentId===L),$=V.length>0;return React.createElement("div",{style:{marginLeft:d*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${M?"bg-info text-white":b?"bg-light text-muted":"hover-bg"}`,style:{cursor:b?"not-allowed":"pointer",opacity:b?.5:1,transition:"background 0.2s"},onClick:()=>!b&&_(L)},$&&React.createElement("i",{className:`fas fa-chevron-${f?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:I=>{I.stopPropagation(),C(!f)}}),!$&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${M?"-open":""} me-2 ${M?"":"text-warning"}`}),React.createElement("span",{className:"small"},w.title),b&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),w.count>0&&!b&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},w.count)),f&&$&&React.createElement("div",null,V.map(I=>React.createElement(FolderTreeItem,{key:I.uuid||I.id,folder:I,allAlbums:m,currentAlbumId:j,targetAlbum:A,onSelect:_,level:d+1}))))}function AlbumDetail({album:w,onBack:m,onRefresh:j,showToast:A,onNavigateToFolder:_,onEditSubfolder:d,parentAlbum:f}){const[C,L]=useState([]),[b,M]=useState([]),[V,$]=useState(!0),[I,q]=useState(!1),[P,T]=useState(""),[y,D]=useState([]),[Y,U]=useState([]),[g,E]=useState({}),[z,N]=useState(null),[te,O]=useState(!1),[J,xe]=useState(""),[ee,ae]=useState(!1),oe=useRef(null),B=useRef(null),[fe,be]=useState(!1),[X,se]=useState([]),[_e,ge]=useState([]),[de,Le]=useState(""),[t,o]=useState(!1),k=async(c,x=2)=>{const F=x*1024*1024,ce=c.type==="image/heic"||c.type==="image/heif"||/\.heic$/i.test(c.name);if(c.size<=F&&!ce)return c;try{const ye=await createImageBitmap(c),Ie=document.createElement("canvas");let a=ye.width,l=ye.height;const i=1200;return(a>i||l>i)&&(a>l?(l=Math.round(l/a*i),a=i):(a=Math.round(a/l*i),l=i)),Ie.width=a,Ie.height=l,Ie.getContext("2d").drawImage(ye,0,0,a,l),ye.close(),new Promise((s,r)=>{Ie.toBlob(n=>{n?s(new File([n],c.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):r(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ye){throw console.error("Compress error:",ye),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{H(),le()},[w.id,w.uuid]);const H=async()=>{$(!0);try{const x=await(await fetch(`${API_BASE}/api/albums/${w.uuid||w.id}`)).json();L(x.images||[]);const ce=await(await fetch(`${API_BASE}/api/albums?parent_id=${w.uuid||w.id}`)).json();M(Array.isArray(ce)?ce:[])}catch(c){console.error(c),A("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}$(!1)},le=async()=>{try{const x=await(await fetch(`${API_BASE}/api/albums`)).json();ge(Array.isArray(x)?x:[])}catch(c){console.error("Error loading albums:",c)}},De=c=>{se(x=>x.includes(c)?x.filter(F=>F!==c):[...x,c])},ve=async()=>{if(!de||X.length===0){A("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}o(!0);let c=0;for(const x of X)try{(await fetch(`${API_BASE}/api/images/${x}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({album_id:de})})).ok&&c++}catch(F){console.error("Move error:",F)}o(!1),be(!1),se([]),Le(""),c>0?(A("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),H(),j()):A("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Ee,Te]=useState(!1),R=async()=>{if(X.length===0||!confirm(`X\xF3a ${X.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Te(!0);let c=0;for(const x of X)try{(await fetch(`${API_BASE}/api/images/${x}`,{method:"DELETE"})).ok&&c++}catch(F){console.error("Delete error:",F)}Te(!1),se([]),c>0?(A(`\u0110\xE3 x\xF3a ${c} \u1EA3nh!`,"success"),H(),j()):A("X\xF3a th\u1EA5t b\u1EA1i","danger")},re=()=>{X.length===C.length?se([]):se(C.map(c=>c.id))},Pe=async()=>{if(J.trim()){ae(!0);try{const c=J.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(!(await fetch(`${API_BASE}/api/albums`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:c+"-"+Date.now(),title:J,parent_id:w.uuid||w.id})})).ok)throw new Error("L\u1ED7i t\u1EA1o folder");A("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),xe(""),O(!1),H(),j()}catch(c){A(c.message,"danger")}ae(!1)}},W=async c=>{if(confirm(`X\xF3a folder "${c.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await fetch(`${API_BASE}/api/albums/${c.uuid||c.id}`,{method:"DELETE"}),A("\u0110\xE3 x\xF3a folder","success"),H(),j()}catch(x){A("L\u1ED7i x\xF3a folder","danger")}},h=c=>{const x=Array.from(c).filter(F=>F.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(F.name));D(F=>[...F,...x]),x.forEach(F=>{const ce=new FileReader;ce.onload=ye=>{U(Ie=>[...Ie,{file:F,preview:ye.target.result}])},ce.readAsDataURL(F)})},ue=c=>{D(x=>x.filter((F,ce)=>ce!==c)),U(x=>x.filter((F,ce)=>ce!==c))},me=async c=>{var ce;const x=new FormData;x.append("file",c),x.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),x.append("folder",`ktm-albums/${w.id}`);const F=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:x});if(!F.ok){const ye=await F.json();throw console.error("Cloudinary error:",ye),new Error(((ce=ye.error)==null?void 0:ce.message)||"Upload failed")}return await F.json()},Ne=async()=>{if(y.length===0)return;q(!0);let c=0;for(let x=0;x<y.length;x++)try{T(`\u0110ang x\u1EED l\xFD ${x+1}/${y.length}...`);const F=await k(y[x],2);T(`\u0110ang upload ${x+1}/${y.length}...`);const ce=await me(F);await fetch(`${API_BASE}/api/albums/${w.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:ce.secure_url,caption:g[x]||y[x].name.replace(/\.[^/.]+$/,""),sort_order:C.length+x})}),c++}catch(F){console.error("Upload error:",F)}q(!1),T(""),D([]),U([]),E({}),c>0?(A(`\u0110\xE3 upload ${c} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),H(),j()):A("Upload th\u1EA5t b\u1EA1i","danger")},Ce=async(c,x)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await fetch(`${API_BASE}/api/images/${c}`,{method:"DELETE"}),A("\u0110\xE3 x\xF3a \u1EA3nh","success"),H(),j()}catch(F){A("L\u1ED7i x\xF3a \u1EA3nh","danger")}},pe=c=>{var x;c.preventDefault(),(x=B.current)==null||x.classList.add("dragover")},Se=()=>{var c;(c=B.current)==null||c.classList.remove("dragover")},He=c=>{var x;c.preventDefault(),(x=B.current)==null||x.classList.remove("dragover"),h(c.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:m},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},w.title),React.createElement("small",{className:"text-muted"},b.length>0&&React.createElement("span",null,b.length," folder \u2022 "),C.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>O(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),te&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:J,onChange:c=>xe(c.target.value),onKeyPress:c=>c.key==="Enter"&&Pe(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Pe,disabled:ee||!J.trim()},ee?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{O(!1),xe("")}},"H\u1EE7y")))),b.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},b.map(c=>React.createElement("div",{key:c.uuid||c.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>_&&_(c)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},c.title),React.createElement("small",{className:"text-muted"},c.subfolderCount>0&&React.createElement("span",null,c.subfolderCount," folder"),c.subfolderCount>0&&c.count>0&&" \u2022 ",c.count>0&&React.createElement("span",null,c.count," \u1EA3nh"),c.subfolderCount===0&&c.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:x=>{x.stopPropagation(),d&&d(c)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:x=>{x.stopPropagation(),W(c)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:B,className:"upload-zone",onClick:()=>{var c;return(c=oe.current)==null?void 0:c.click()},onDragOver:pe,onDragLeave:Se,onDrop:He},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:oe,type:"file",multiple:!0,accept:"image/*",onChange:c=>h(c.target.files)})),Y.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Y.map((c,x)=>React.createElement("div",{key:x,className:"upload-preview-item"},React.createElement("img",{src:c.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>ue(x)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Ne,disabled:I},I?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),P||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",y.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",C.length,")"),C.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:re},X.length===C.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),X.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},X.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>be(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:R,disabled:Ee},Ee?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>se([])},React.createElement("i",{className:"fas fa-times"})))),V?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):C.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},C.map((c,x)=>React.createElement("div",{key:x,className:`image-item ${X.includes(c.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>De(c.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:X.includes(c.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:X.includes(c.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},X.includes(c.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:c.src,alt:c.caption,style:{opacity:X.includes(c.id)?.7:1,border:X.includes(c.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:F=>{F.stopPropagation(),Ce(c.id,x)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),c.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},c.caption)))))),fe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",X.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>be(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},_e.filter(c=>!c.parentId).map(c=>React.createElement(FolderTreeItem,{key:c.uuid||c.id,folder:c,allAlbums:_e,currentAlbumId:w.uuid||w.id,targetAlbum:de,onSelect:Le})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>be(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ve,disabled:!de||t},t?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),z&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>N(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>N(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:z.src,alt:z.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:c=>c.stopPropagation()}),z.caption&&React.createElement("div",{className:"text-white text-center mt-2"},z.caption)))))}function SearchCenter({showToast:w,onNavigate:m}){const[j,A]=useState(""),[_,d]=useState([]),[f,C]=useState([]),[L,b]=useState([]),[M,V]=useState("all"),[$,I]=useState(null),[q,P]=useState("list"),[T,y]=useState(!0),[D,Y]=useState([]),[U,g]=useState([]),E=useRef(null),[z,N]=useState(!0),[te,O]=useState(!1),J=useRef(null),[xe,ee]=useState(!1),[ae,oe]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[B,fe]=useState(""),[be,X]=useState(!1),se=useRef(null),_e=useRef(null),[ge,de]=useState(null),[Le,t]=useState(!1),[o,k]=useState(null),[H,le]=useState(!1),[De,ve]=useState(!1),[Ee,Te]=useState(null),[R,re]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),Pe=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],W=e=>{e._type==="product"&&(k(e),re({name:e.name||"",code:e.code||"",price:e.price||"",image:e.image||"",category:e.category||"",note:e.note||""}),t(!0))},h=async()=>{if(o)try{if(!(await fetch(`${API_BASE}/api/products?id=${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)})).ok)throw new Error("L\u1ED7i c\u1EADp nh\u1EADt");w("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),t(!1),k(null),pe()}catch(e){w(e.message,"danger")}},ue=async e=>{const s=e._type==="product"?"s\u1EA3n ph\u1EA9m":e._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${s} "${e.name}"?`))try{let r="";if(e._type==="product"?r=`${API_BASE}/api/products?id=${e.id}`:e._type==="album"?r=`${API_BASE}/api/images/${e.id}`:e._type==="video"&&(r=`${API_BASE}/api/videos/${e.id}`),!(await fetch(r,{method:"DELETE"})).ok)throw new Error("L\u1ED7i x\xF3a");w(`\u0110\xE3 x\xF3a ${s}`,"success"),pe()}catch(r){w(r.message,"danger")}},me=async e=>{try{const s=Ee?`${API_BASE}/api/products?id=${Ee.id}`:`${API_BASE}/api/products`;if(!(await fetch(s,{method:Ee?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m");w(Ee?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ve(!1),Te(null),pe()}catch(s){w(s.message,"danger")}},Ne="ktm_admin_data_cache_v1",Ce=1e3*60*10,pe=async()=>{let e=null,s=!1;try{const r=localStorage.getItem(Ne);if(r){const n=JSON.parse(r);n&&n.timestamp&&Date.now()-n.timestamp<Ce&&Array.isArray(n.data)?(e=n.data,console.log("[CACHE] Using cache, items:",e.length),C(e),d(e),y(!1),s=!0):console.log("[CACHE] Cache expired or invalid")}else console.log("[CACHE] No cache found")}catch(r){console.error("[CACHE] Error parsing cache:",r)}s||y(!0);try{const[r,n,v]=await Promise.all([fetch(`${API_BASE}/api/products`),fetch(`${API_BASE}/api/albums`),fetch(`${API_BASE}/api/video-folders?withVideos=true`)]),[u,p,S]=await Promise.all([r.ok?r.json():[],n.ok?n.json():[],v.ok?v.json():[]]),G=Array.isArray(u)?u.map(we=>({...we,_type:"product",_source:"database"})):[];Y(p);let Z=[];if(Array.isArray(p)&&p.length>0){const we=p.map(ie=>fetch(`${API_BASE}/api/albums/${ie.id}`)),$e=await Promise.all(we);(await Promise.all($e.map(ie=>ie.ok?ie.json():{}))).forEach((ie,Be)=>{const Ue=p[Be];ie.images&&ie.images.length>0&&ie.images.forEach(Fe=>{Z.push({id:Fe.id,name:Fe.caption||"\u1EA2nh t\u1EEB "+Ue.title,image:Fe.src,folder:Ue.title,_type:"album",_source:"database"})})})}g(S);let ne=[];Array.isArray(S)&&S.forEach(we=>{we.videos&&we.videos.forEach($e=>{ne.push({id:$e.id,name:$e.title,folder:we.name,image:$e.thumb,youtubeId:$e.youtubeId,url:$e.url,_type:"video",_source:"database"})})});const K=[...G,...Z,...ne];if(!e||JSON.stringify(K)!==JSON.stringify(e)){C(K),d(K);try{localStorage.setItem(Ne,JSON.stringify({data:K,timestamp:Date.now()}))}catch(we){}}}catch(r){console.error("Song song fetch error:",r)}y(!1)};useEffect(()=>{pe(),setTimeout(()=>{var e;return(e=E.current)==null?void 0:e.focus()},100)},[]);const Se=async(e,s)=>{if(!(!z||s.length===0)){O(!0);try{const r=s.map(v=>({id:v.id,name:v.name,price:v.price,category:v.category,note:v.note,folder:v.folder,_type:v._type})),n=await fetch(`${API_BASE}/api/ai-search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,products:r})});if(n.ok){const v=await n.json();if(v.matchedIds&&v.matchedIds.length>0){const u=s.filter(p=>v.matchedIds.includes(p.id));u.length>0&&d(u)}else v.matchedIds&&v.matchedIds.length===0&&d([])}}catch(r){console.error("AI Search error:",r)}O(!1)}},He=e=>{if(A(e),J.current&&clearTimeout(J.current),!e.trim()){c(M);return}const r=e.toLowerCase().split(/\s+/).filter(u=>u.length>0),n=f.filter(u=>{const p=Object.entries(u).filter(([S])=>!S.startsWith("_")).map(([,S])=>String(S||"").toLowerCase()).join(" ");return r.some(S=>p.includes(S))});let v=n;M!=="all"&&(v=n.filter(u=>(u.category||u._type)===M)),d(v),z&&e.length>=3&&(J.current=setTimeout(()=>{Se(e,v)},500))},c=e=>{V(e);let s=f;if(e!=="all"&&(s=f.filter(r=>(r.category||r._type)===e)),j.trim()){const n=j.toLowerCase().split(/\s+/).filter(v=>v.length>0);s=s.filter(v=>{const u=Object.entries(v).filter(([p])=>!p.startsWith("_")).map(([,p])=>String(p||"").toLowerCase()).join(" ");return n.every(p=>u.includes(p))})}d(s)},x=(e,s)=>{navigator.clipboard.writeText(e).then(()=>{I(s),w("\u0110\xE3 copy!","success"),setTimeout(()=>I(null),1500)})},F=async(e,s)=>{try{const n=await(await fetch(e)).blob();await navigator.clipboard.write([new ClipboardItem({[n.type]:n})]),I(s+"-img"),w("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>I(null),1500)}catch(r){x(e,s+"-img")}},ce=e=>{let s=e.toLowerCase();const r=[],n=f.filter(p=>p._type==="product");if(s.includes("ty")||s.includes("xy lanh")){if(s.includes("gi\u1EEFa")||s.includes("giua")){const p=n.find(S=>{var G;return(G=S.name)==null?void 0:G.toLowerCase().includes("xy lanh gi\u1EEFa")});p&&!r.find(S=>S.id===p.id)&&r.push(p)}if(s.includes("nghi\xEAng")||s.includes("nghieng")){const p=n.find(S=>{var G;return(G=S.name)==null?void 0:G.toLowerCase().includes("xy lanh nghi\xEAng")});p&&!r.find(S=>S.id===p.id)&&r.push(p)}if(s.includes("\u1EE7i")||s.includes("ui")){const p=n.find(S=>{var G;return(G=S.name)==null?void 0:G.toLowerCase().includes("xy lanh \u1EE7i")});p&&!r.find(S=>S.id===p.id)&&r.push(p)}}const v=s.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(v){const p=v[1],S=v[2],G=n.find(Z=>{var K;const ne=((K=Z.name)==null?void 0:K.toLowerCase())||"";return ne.includes("combo")&&ne.includes(`${p} tay`)&&(ne.includes(`${S} xy`)||ne.includes(`${S} xylanh`))});if(G&&!r.find(Z=>Z.id===G.id))r.push(G);else{const Z=n.find(ne=>{var ke;const K=((ke=ne.name)==null?void 0:ke.toLowerCase())||"";return K.includes("combo")&&K.includes(`${p} tay`)});Z&&!r.find(ne=>ne.id===Z.id)&&r.push(Z)}}if(s.includes("combo")&&!v){const p=s.match(/combo.*?(\d+)\s*tay/);if(p){const S=p[1];n.filter(Z=>{var K;const ne=((K=Z.name)==null?void 0:K.toLowerCase())||"";return ne.includes("combo")&&ne.includes(`${S} tay`)}).forEach(Z=>{r.find(ne=>ne.id===Z.id)||r.push(Z)})}}const u=s.match(/van\s*(\d+)\s*tay/);if(u&&!s.includes("ty")&&!s.includes("combo")){const p=u[1],S=n.find(G=>{var ne;const Z=((ne=G.name)==null?void 0:ne.toLowerCase())||"";return Z.includes(`van ${p} tay`)&&!Z.includes("combo")});S&&!r.find(G=>G.id===S.id)&&r.push(S)}return r.slice(0,4)},ye=async e=>{if(!e.trim())return;const s={role:"user",content:e,attachments:[]};oe(n=>[...n,s]),fe(""),X(!0);const r=ce(e);setTimeout(()=>{var n;return(n=se.current)==null?void 0:n.scrollIntoView({behavior:"smooth"})},100);try{const v=f.filter(K=>K._type==="product").map(K=>{let ke=`- ${K.name}`;return K.code&&(ke+=` (M\xE3: ${K.code})`),K.price&&(ke+=` - Gi\xE1: ${K.price.replace(/[đ\s]/g,"")}\u0111`),K.category&&(ke+=` [${K.category}]`),K.note&&(ke+=` (${K.note})`),ke}).join(`
`),p=ae.slice(-6).map(K=>`${K.role==="user"?"Kh\xE1ch":"AI"}: ${K.content}`).join(`
`),S=p?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${p}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${v}`:v,G=await fetch(`${API_BASE}/api/ai-chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,context:S,audience:"admin"})}),Z=await G.json();if(!G.ok)throw new Error(Z.error||"API error");const ne=Z.response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";oe(K=>[...K,{role:"assistant",content:ne,attachments:r}])}catch(n){console.error("AI Error:",n);const v=e.toLowerCase(),u=f.filter(S=>{const G=Object.values(S).join(" ").toLowerCase();return v.split(" ").some(Z=>G.includes(Z))});let p="";u.length>0?(p=`T\xECm th\u1EA5y ${u.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,u.slice(0,5).forEach(S=>{p+=`\u2022 ${S.name}`,S.price&&(p+=` - ${S.price.replace(/[đ\s]/g,"")}\u0111`),S.note&&(p+=` (${S.note})`),p+=`
`}),u.length>5&&(p+=`
...v\xE0 ${u.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):p='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',oe(S=>[...S,{role:"assistant",content:p,attachments:u.slice(0,4)}])}X(!1),setTimeout(()=>{var n,v;(n=se.current)==null||n.scrollIntoView({behavior:"smooth"}),(v=_e.current)==null||v.focus()},100)};function Ie({show:e,product:s,categories:r,onClose:n,onSave:v}){const[u,p]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[S,G]=useState(!1),[Z,ne]=useState(!1),K=useRef(null),ke=Q=>{const Re=Q.replace(/[^\d]/g,"");return Re?Re.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""};useEffect(()=>{if(s)if(p({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",sort_order:s.sort_order||0}),s.price){const Q=s.price.replace(/[^\d]/g,"");ie(Q),p(Re=>({...Re,price:ke(Q)}))}else ie("");else p({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),ie("")},[s,e]);const[we,$e]=React.useState(""),[he,ie]=React.useState(""),Be=Q=>{const Ve=Q.target.value.replace(/[^\d]/g,"");if(!Ve){p({...u,price:""}),ie("");return}if(Ve===he&&Ve.length>0){const je=Ve.slice(0,-1);je?(p({...u,price:ke(je)}),ie(je)):(p({...u,price:""}),ie(""));return}ie(Ve),p({...u,price:ke(Ve)})},Ue=async(Q,Re=2)=>{const Ve=Re*1024*1024;if(Q.size<=Ve)return Q;try{const je=await createImageBitmap(Q),qe=document.createElement("canvas");let Ae=je.width,Oe=je.height;const Me=1200;return(Ae>Me||Oe>Me)&&(Ae>Oe?(Oe=Math.round(Oe/Ae*Me),Ae=Me):(Ae=Math.round(Ae/Oe*Me),Oe=Me)),qe.width=Ae,qe.height=Oe,qe.getContext("2d").drawImage(je,0,0,Ae,Oe),je.close(),new Promise((Je,Xe)=>{qe.toBlob(Qe=>{Qe?Je(new File([Qe],Q.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Xe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(je){throw console.error("Compress error:",je),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Fe=async Q=>{var je;const Re=Q.target.files[0];if(!Re)return;if(!(Re.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Re.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ne(!0);try{const qe=await Ue(Re),Ae=new FormData;Ae.append("file",qe),Ae.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),Ae.append("folder","ktm-products");const Oe=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:Ae}),Me=await Oe.json();if(!Oe.ok)throw console.error("Cloudinary error:",Me),new Error(((je=Me.error)==null?void 0:je.message)||"Upload failed");p(Ke=>({...Ke,image:Me.secure_url}))}catch(qe){console.error("Upload error:",qe),alert("L\u1ED7i upload \u1EA3nh: "+qe.message)}ne(!1),Q.target.value=""},ze=async Q=>{Q.preventDefault(),G(!0),await v(u),G(!1)};return e?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),s?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:n})),React.createElement("form",{onSubmit:ze},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:u.name,onChange:Q=>p({...u,name:Q.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:u.code,onChange:Q=>p({...u,code:Q.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:u.price,onChange:Be,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:u.category,onChange:Q=>p({...u,category:Q.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),r.map(Q=>React.createElement("option",{key:Q,value:Q},Q)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:u.note,onChange:Q=>p({...u,note:Q.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},u.image?React.createElement(React.Fragment,null,React.createElement("img",{src:u.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>p({...u,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var Q;return(Q=K.current)==null?void 0:Q.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:K,type:"file",accept:"image/*",className:"d-none",onChange:Fe}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var Q;return(Q=K.current)==null?void 0:Q.click()},disabled:Z,style:{borderRadius:"10px"}},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:u.image,onChange:Q=>p({...u,image:Q.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:n,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:S,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},S?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const a=(e,s)=>{const r=e._type==="product",n=e._type==="album",v=e._type==="video",u=e.note&&(e.note.toLowerCase().includes("free")||e.note.toLowerCase().includes("gi\u1EA3m")||e.note.toLowerCase().includes("sale"));return q==="grid"?React.createElement("div",{key:e.id||s,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>de({url:e.image,name:e.name,price:e.price,note:e.note,item:e})},e.image?React.createElement("img",{src:e.image,alt:e.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${v?"fa-video":"fa-image"} fa-2x text-muted`})),e.price&&React.createElement("div",{className:"price-overlay"},e.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${r?"product":n?"album":"video"}`},r?"SP":n?"\u1EA2nh":"Video"),u&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},e.name),e.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},e.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:$===e.id+"-img"?"copied":"",onClick:()=>F(e.image,e.id)},React.createElement("i",{className:"fas fa-image"})),e.price&&React.createElement("button",{className:$===e.id+"-price"?"copied":"",onClick:()=>x(e.price.replace(/[đ\s]/g,""),e.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:e.id||s,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${r?"product":n?"album":"video"}`},r?"S\u1EA3n ph\u1EA9m":n?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},e.image?React.createElement("img",{src:e.image,alt:e.name,className:"thumb",loading:"lazy",onClick:()=>de({url:e.image,name:e.name,price:e.price,note:e.note,item:e})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${v?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},e.name),React.createElement("div",{className:"price-row"},e.price&&React.createElement("span",{className:"price"},e.price.replace(/[đ\s]/g,""),"\u0111"),u&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},e.code&&React.createElement("span",{className:"meta-tag"},"#",e.code),e.category&&React.createElement("span",{className:"meta-tag"},e.category),e.note&&React.createElement("span",{className:"meta-tag highlight"},e.note),e.folder&&React.createElement("span",{className:"meta-tag"},e.folder),v&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},r&&React.createElement("button",{onClick:()=>m&&m("orders","create",{productId:e.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),React.createElement("button",{className:$===e.id+"-img"?"copied":"",onClick:()=>F(e.image,e.id)},React.createElement("i",{className:"fas fa-image"})," \u1EA2nh"),e.price&&React.createElement("button",{className:$===e.id+"-price"?"copied":"",onClick:()=>x(e.price.replace(/[đ\s]/g,""),e.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:$===e.id+"-name"?"copied":"",onClick:()=>x(e.name,e.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),v&&e.youtubeId&&React.createElement("button",{className:$===e.id+"-yt"?"copied":"",onClick:()=>x(`https://www.youtube.com/watch?v=${e.youtubeId}`,e.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),r&&React.createElement("button",{className:"action-edit",onClick:()=>W(e)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>ue(e)},React.createElement("i",{className:"fas fa-trash"}))))},[l,i]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,_.length)," k\u1EBFt qu\u1EA3",z&&j.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),M!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},M==="product"?"S\u1EA3n ph\u1EA9m":M==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${q==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>P("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${q==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>P("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},T?React.createElement("div",null,[...Array(8)].map((e,s)=>React.createElement("div",{key:s,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):_.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',j,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{A(""),He("")}},"Xem t\u1EA5t c\u1EA3")):q==="grid"?React.createElement("div",{className:"product-grid-mobile"},_.map((e,s)=>a(e,s))):React.createElement("div",null,_.map((e,s)=>a(e,s)))),l&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>i(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${M==="all"?"active":""}`,onClick:()=>{c("all"),i(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${M==="product"?"active":""}`,onClick:()=>{c("product"),i(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${M==="album"?"active":""}`,onClick:()=>{c("album"),i(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${M==="video"?"active":""}`,onClick:()=>{c("video"),i(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:z,onChange:e=>N(e.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:E,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:j,onChange:e=>He(e.target.value)}),React.createElement("button",{className:`filter-btn ${l||M!=="all"?"active":""}`,onClick:()=>i(!l)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:H?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>ee(!0),onTouchStart:()=>ee(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),xe&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>ee(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},ae.map((e,s)=>React.createElement("div",{key:s,className:`mb-3 ${e.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${e.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:e.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},e.content,e.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:$===`chat-${s}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:$===`chat-${s}`?"#fff":"#666"},onClick:()=>{navigator.clipboard.writeText(e.content),I(`chat-${s}`),setTimeout(()=>I(null),1500)}},React.createElement("i",{className:`fas ${$===`chat-${s}`?"fa-check":"fa-copy"}`})),e.attachments&&e.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},e.attachments.map((r,n)=>React.createElement("div",{key:n,style:{width:70},className:"text-center"},r.image&&React.createElement("img",{src:r.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>de({url:r.image,name:r.name,price:r.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},r.name),r.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},r.price.replace(/[đ\s]/g,""),"\u0111"))))))),be&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:se})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(e=>React.createElement("button",{key:e,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>ye(e),disabled:be,style:{whiteSpace:"nowrap"}},e))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:e=>{e.preventDefault(),ye(B)},className:"chat-input-wrap"},React.createElement("input",{ref:_e,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:B,onChange:e=>fe(e.target.value),disabled:be}),React.createElement("button",{type:"submit",className:"send-btn",disabled:be||!B.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),ge&&React.createElement("div",{className:"preview-modal",onClick:()=>de(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>de(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:e=>e.stopPropagation()},React.createElement("img",{src:ge.url,alt:ge.name})),React.createElement("div",{className:"preview-footer",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"name"},ge.name),ge.price&&React.createElement("div",{className:"price"},ge.price.replace(/[đ\s]/g,""),"\u0111"),ge.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},ge.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:$==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:$==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>F(ge.url,"preview")},React.createElement("i",{className:`fas ${$==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),ge.price&&React.createElement("button",{className:$==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>x(ge.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${$==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Ie,{show:De,product:Ee,categories:L,onClose:()=>{ve(!1),Te(null)},onSave:me}),React.createElement("div",{className:`fab-container mobile-only ${H?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{le(!1),ve(!0),Te(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{le(!1),m&&m("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${H?"open":""}`,onClick:()=>le(!H)},React.createElement("i",{className:"fas fa-plus"}))),Le&&o&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>t(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:R.name,onChange:e=>re({...R,name:e.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:R.code,onChange:e=>re({...R,code:e.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:R.price,onChange:e=>re({...R,price:e.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:R.category,onChange:e=>re({...R,category:e.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Pe.map(e=>React.createElement("option",{key:e,value:e},e)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:R.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:e=>re({...R,note:e.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>t(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:h},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:w,showToast:m}){const[j,A]=useState([]),[_,d]=useState([]),[f,C]=useState(!0),[L,b]=useState(null),[M,V]=useState(!1),[$,I]=useState(null),[q,P]=useState(!1),[T,y]=useState(null),[D,Y]=useState(null),[U,g]=useState([]);useEffect(()=>{E()},[]);const E=async(t=null)=>{C(!0);try{const o=t?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${t}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,H=await(await fetch(o)).json();A(Array.isArray(H)?H:[])}catch(o){console.error(o),m("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}C(!1)},z=async t=>{try{const k=await(await fetch(`${API_BASE}/api/videos?folderId=${t}`)).json();d(Array.isArray(k)?k:[])}catch(o){console.error(o)}},N=async t=>{if(t===0)return;const o=[...j];[o[t-1],o[t]]=[o[t],o[t-1]],A(o),await O(o)},te=async t=>{if(t===j.length-1)return;const o=[...j];[o[t],o[t+1]]=[o[t+1],o[t]],A(o),await O(o)},O=async t=>{try{await Promise.all(t.map((o,k)=>fetch(`${API_BASE}/api/video-folders/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:k})}))),m("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(o){m("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),E(D==null?void 0:D.id)}},J=async t=>{if(t===0)return;const o=[..._];[o[t-1],o[t]]=[o[t],o[t-1]],d(o),await ee(o)},xe=async t=>{if(t===_.length-1)return;const o=[..._];[o[t],o[t+1]]=[o[t+1],o[t]],d(o),await ee(o)},ee=async t=>{try{await Promise.all(t.map((o,k)=>fetch(`${API_BASE}/api/videos/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sort_order:k})}))),m("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(o){m("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),z(L.id)}},ae=()=>{I(null),V(!0)},oe=t=>{I(t),V(!0)},B=async t=>{try{!$&&D&&(t.parent_id=D.id);const o=$?`${API_BASE}/api/video-folders/${$.id}`:`${API_BASE}/api/video-folders`;if(!(await fetch(o,{method:$?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("L\u1ED7i l\u01B0u folder");m($?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),V(!1),E(D==null?void 0:D.id)}catch(o){m(o.message,"danger")}},fe=async t=>{const o=t.subfolderCount>0?`X\xF3a folder "${t.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${t.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(o))try{await fetch(`${API_BASE}/api/video-folders/${t.id}`,{method:"DELETE"}),m("\u0110\xE3 x\xF3a folder","success"),b(null),E(D==null?void 0:D.id)}catch(k){m("L\u1ED7i x\xF3a folder","danger")}},be=t=>{t.subfolderCount>0?(g(o=>[...o,t]),Y(t),E(t.id)):(b(t),d(t.videos||[]))},X=t=>{if(t==="root")g([]),Y(null),E(null);else if(t){const o=U.findIndex(k=>k.id===t.id);o>=0&&(g(U.slice(0,o+1)),Y(t),E(t.id))}else{const o=[...U];o.pop();const k=o[o.length-1]||null;g(o),Y(k),E(k==null?void 0:k.id)}},se=()=>{y(null),P(!0)},_e=t=>{y(t),P(!0)},ge=async t=>{try{t.folder_id=L==null?void 0:L.id;const o=T?`${API_BASE}/api/videos/${T.id}`:`${API_BASE}/api/videos`,k=await fetch(o,{method:T?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!k.ok){const H=await k.json();throw new Error(H.error||"L\u1ED7i l\u01B0u video")}m(T?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),P(!1),E(),L&&z(L.id)}catch(o){m(o.message,"danger")}},de=async t=>{if(confirm(`X\xF3a video "${t.title}"?`))try{await fetch(`${API_BASE}/api/videos/${t.id}`,{method:"DELETE"}),m("\u0110\xE3 x\xF3a video","success"),E(),L&&z(L.id)}catch(o){m("L\u1ED7i x\xF3a video","danger")}},Le=t=>{const o=`https://www.youtube.com/watch?v=${t.youtubeId}`;navigator.clipboard.writeText(o).then(()=>{m("\u0110\xE3 copy link!","success")}).catch(()=>{m("Kh\xF4ng th\u1EC3 copy link","danger")})};return L?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>b(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${L.slug==="shorts"?"text-danger":"text-warning"}`}),L.name)),React.createElement("button",{className:"btn btn-warning",onClick:se},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),_.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},_.map((t,o)=>React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>J(o),disabled:o===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},o+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>xe(o),disabled:o===_.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:t.thumb,className:"card-img-top",alt:t.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${t.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:t.title},t.title),React.createElement("small",{className:"text-muted"},t.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Le(t),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>_e(t),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>de(t),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:q,video:T,onClose:()=>P(!1),onSave:ge})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},D&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>X()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),D?D.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:ae},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),U.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:t=>{t.preventDefault(),X("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),U.map((t,o)=>React.createElement("li",{key:t.id,className:`breadcrumb-item ${o===U.length-1?"active":""}`},o===U.length-1?t.name:React.createElement("a",{href:"#",onClick:k=>{k.preventDefault(),X(t)},className:"text-warning"},t.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),f?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):j.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},D?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ae},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",D?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},j.map((t,o)=>{var k,H,le,De;return React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ve=>{ve.stopPropagation(),N(o)},disabled:o===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},o+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ve=>{ve.stopPropagation(),te(o)},disabled:o===j.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>be(t),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${t.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},t.name),React.createElement("p",{className:"text-muted mb-0"},t.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),t.subfolderCount," folder"),t.subfolderCount>0&&(t.videoCount>0||((k=t.videos)==null?void 0:k.length)>0)&&" \u2022 ",(t.videoCount>0||((H=t.videos)==null?void 0:H.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),t.videoCount||((le=t.videos)==null?void 0:le.length)||0," videos"),t.subfolderCount===0&&!t.videoCount&&!((De=t.videos)!=null&&De.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ve=>{ve.stopPropagation(),oe(t)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ve=>{ve.stopPropagation(),fe(t)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:M,folder:$,onClose:()=>V(!1),onSave:B}))}function VideoFolderModal({show:w,folder:m,onClose:j,onSave:A}){const[_,d]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[f,C]=useState(!1),[L,b]=useState(!1);useEffect(()=>{d(m?{name:m.name||"",description:m.description||"",sortOrder:m.sortOrder||0,coverImage:m.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[m,w]);const M=async $=>{const I=$.target.files[0];if(!I)return;b(!0);const q=new FormData;q.append("file",I),q.append("upload_preset","ktm_unsigned");try{const T=await(await fetch("https://api.cloudinary.com/v1_1/diwxfpt92/image/upload",{method:"POST",body:q})).json();T.secure_url&&d(y=>({...y,coverImage:T.secure_url})),localStorage.removeItem(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(P){console.error("Cloudinary upload error:",P),alert("L\u1ED7i upload \u1EA3nh: "+(P.message||P))}finally{b(!1)}},V=async $=>{$.preventDefault(),C(!0),await A(_),C(!1)};return w?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},m?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:V},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:_.name,onChange:$=>d({..._,name:$.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:_.description,onChange:$=>d({..._,description:$.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:_.sortOrder,onChange:$=>d({..._,sortOrder:parseInt($.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},_.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:_.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>d({..._,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:M,disabled:L}),L&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:_.coverImage,onChange:$=>d({..._,coverImage:$.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:f},f?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:w}){const[m,j]=useState([]),[A,_]=useState(!0),[d,f]=useState(!1),[C,L]=useState(null),[b,M]=useState(""),[V,$]=useState(""),I=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{q()},[]);const q=async()=>{_(!0);try{const E=await(await fetch(`${API_BASE}/api/products`)).json();j(Array.isArray(E)?E:[])}catch(g){console.error(g),w("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}_(!1)},P=()=>{L(null),f(!0)},T=g=>{L(g),f(!0)},y=async g=>{if(!(!g||!g.includes("cloudinary.com")))try{await fetch(`${API_BASE}/api/products?action=delete-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:g})}),localStorage.removeItem(CACHE_KEY),w(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),q()}catch(E){w("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},D=async g=>{try{const E=C?`${API_BASE}/api/products?id=${C.id}`:`${API_BASE}/api/products`;if(!(await fetch(E,{method:C?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).ok)throw new Error("L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m");w(C?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),f(!1),q()}catch(E){w(E.message,"danger")}},Y=async g=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${g.name}"?`))try{if(!(await fetch(`${API_BASE}/api/products?id=${g.id}`,{method:"DELETE"})).ok)throw new Error("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m");w("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),q()}catch(E){w(E.message,"danger")}},U=m.filter(g=>{const E=!b||g.name.toLowerCase().includes(b.toLowerCase())||g.code&&g.code.toLowerCase().includes(b.toLowerCase()),z=!V||g.category===V;return E&&z});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:P},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:b,onChange:g=>M(g.target.value)})),React.createElement("span",{className:"product-count"},U.length)),React.createElement("select",{className:"form-select",value:V,onChange:g=>$(g.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),I.map(g=>React.createElement("option",{key:g,value:g},g)))),A?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):U.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:P},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},U.map(g=>React.createElement("div",{key:g.id,className:"product-item d-flex align-items-center gap-3"},g.image?React.createElement("img",{src:g.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},g.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},g.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},g.category),g.code&&React.createElement("span",{className:"product-badge bg-secondary"},g.code)),React.createElement("div",{className:"product-price"},g.price?g.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),g.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},g.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>T(g),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>Y(g),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:d,product:C,categories:I,onClose:()=>f(!1),onSave:D}))}function ProductModal({show:w,product:m,categories:j,onClose:A,onSave:_}){const[d,f]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[C,L]=useState(!1),[b,M]=useState(!1);useEffect(()=>{f(m?{name:m.name||"",code:m.code||"",price:m.price||"",image:m.image||"",category:m.category||"",note:m.note||"",sort_order:m.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[m,w]);const[V,$]=React.useState(""),I=N=>{const te=N.replace(/[^\d]/g,"");return te?te.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""},[q,P]=React.useState(""),T=N=>{const O=N.target.value.replace(/[^\d]/g,"");if(!O){f({...d,price:""}),P("");return}if(O===q&&O.length>0){const J=O.slice(0,-1);J?(f({...d,price:I(J)}),P(J)):(f({...d,price:""}),P(""));return}P(O),f({...d,price:I(O)})},[y,D]=React.useState("");React.useEffect(()=>{m!=null&&m.image&&D(m.image)},[m]);const Y=async N=>{if(!(!N||!N.includes("cloudinary.com")))try{await fetch(`${API_BASE}/api/products?action=delete-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:N})})}catch(te){console.error("Delete cloudinary image error:",te)}},U=async(N,te=2,O)=>{const J=te*1024*1024,xe=N.type==="image/heic"||N.type==="image/heif"||/\.heic$/i.test(N.name);if(N.size<=J&&!xe)return N;O==null||O("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const ee=await createImageBitmap(N);O==null||O("\u0110ang n\xE9n \u1EA3nh...");const ae=document.createElement("canvas");let oe=ee.width,B=ee.height;const fe=1200;return(oe>fe||B>fe)&&(oe>B?(B=Math.round(B/oe*fe),oe=fe):(oe=Math.round(oe/B*fe),B=fe)),ae.width=oe,ae.height=B,ae.getContext("2d").drawImage(ee,0,0,oe,B),ee.close(),new Promise((X,se)=>{ae.toBlob(_e=>{_e?(O==null||O("Ho\xE0n t\u1EA5t!"),X(new File([_e],N.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):se(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ee){throw console.error("createImageBitmap error:",ee),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},g=async N=>{var J,xe;const te=(J=N.target.files)==null?void 0:J[0];if(!te)return;if(!(te.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(te.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}M(!0),$("\u0110ang chu\u1EA9n b\u1ECB...");try{const ee=(te.size/1024/1024).toFixed(1);$(`File ${ee}MB - \u0110ang n\xE9n...`);const ae=await U(te,2,X=>{$(X)}),oe=(ae.size/1024/1024).toFixed(1);$(`\u0110\xE3 n\xE9n: ${oe}MB - \u0110ang upload...`);const B=new FormData;B.append("file",ae),B.append("upload_preset","ktm_unsigned");const be=await(await fetch("https://api.cloudinary.com/v1_1/diwxfpt92/image/upload",{method:"POST",body:B})).json();be.secure_url?(d.image&&d.image!==y&&Y(d.image),f(X=>({...X,image:be.secure_url})),$("")):(console.error("Cloudinary error:",be),alert("Upload th\u1EA5t b\u1EA1i: "+(((xe=be.error)==null?void 0:xe.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),$(""))}catch(ee){console.error("Upload error:",ee),alert("L\u1ED7i: "+ee.message),$("")}M(!1),N.target.value=""},E=()=>{d.image&&(d.image!==y&&Y(d.image),f(N=>({...N,image:""})))},z=async N=>{N.preventDefault(),L(!0),y&&d.image&&y!==d.image&&await Y(y),y&&!d.image&&await Y(y),await _(d),L(!1)};return w?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${m?"fa-edit":"fa-plus-circle"} me-2`}),m?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:z},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},d.image?React.createElement(React.Fragment,null,React.createElement("img",{src:d.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:E,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${b?"fa-spinner fa-spin":"fa-camera"} me-1`}),b?V||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:g,disabled:b,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),b&&V&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},V))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:d.name,onChange:N=>f({...d,name:N.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:d.code,onChange:N=>f({...d,code:N.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:d.price,onChange:T,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:d.category,onChange:N=>f({...d,category:N.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),j.map(N=>React.createElement("option",{key:N,value:N},N)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:d.note,onChange:N=>f({...d,note:N.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:d.image,onChange:N=>f({...d,image:N.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:A,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:C,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:w,video:m,onClose:j,onSave:A}){const[_,d]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[f,C]=useState(!1),[L,b]=useState("");useEffect(()=>{m?(d({title:m.title||"",youtube_url:`https://www.youtube.com/watch?v=${m.youtubeId}`,thumbnail_url:m.thumb||"",sort_order:m.sortOrder||0}),b(m.thumb)):(d({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),b(""))},[m,w]);const M=I=>{const q=I.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return q?q[1]:null},V=I=>{d({..._,youtube_url:I});const q=M(I);q&&b(`https://img.youtube.com/vi/${q}/hqdefault.jpg`)},$=async I=>{I.preventDefault(),C(!0),await A(_),C(!1)};return w?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},m?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:$},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:_.youtube_url,onChange:I=>V(I.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),L&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:L,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:_.title,onChange:I=>d({..._,title:I.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:_.sort_order,onChange:I=>d({..._,sort_order:parseInt(I.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:_.thumbnail_url,onChange:I=>d({..._,thumbnail_url:I.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:f},f?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[w,m]=useState(!1),[j,A]=useState(""),[_,d]=useState(null),[f,C]=useState("search"),[L,b]=useState(null),[M,V]=useState(""),[$,I]=useState([]),[q,P]=useState(null),[T,y]=useState(!1),[D,Y]=useState(null),[U,g]=useState(!0),[E,z]=useState([]),[N,te]=useState(null),[O,J]=useState([]);useEffect(()=>{const t=localStorage.getItem("ktm_admin_session");if(t)try{const o=JSON.parse(t);o.expiry>Date.now()?(m(!0),d(o.user)):localStorage.removeItem("ktm_admin_session")}catch(o){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{w&&B()},[w]);const xe=async(t,o)=>{A("");try{const k=await fetch(`${API_BASE}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:o})}),H=await k.json();if(!k.ok)throw new Error(H.error||"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i");const le={user:H.user,token:H.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(le)),d(H.user),m(!0)}catch(k){A(k.message)}},ee=()=>{localStorage.removeItem("ktm_admin_session"),m(!1),d(null),I([]),P(null)},ae=(t,o="success")=>{const k=Date.now();z(H=>[...H,{id:k,message:t,type:o}])},oe=t=>{z(o=>o.filter(k=>k.id!==t))},B=async(t=null)=>{g(!0);try{const o=t?`${API_BASE}/api/albums?parent_id=${t}`:`${API_BASE}/api/albums?parent_id=root`,H=await(await fetch(o)).json();I(Array.isArray(H)?H:[])}catch(o){console.error(o),ae("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}g(!1)},fe=()=>{Y(null),y(!0)},be=t=>{Y(t),y(!0)},X=async t=>{try{const o=D&&D.uuid;!o&&N&&(t.parent_id=N.uuid);const k=o?`${API_BASE}/api/albums/${D.uuid||D.id}`:`${API_BASE}/api/albums`,H=await fetch(k,{method:o?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!H.ok){const le=await H.json();throw new Error(le.error||(o?"L\u1ED7i c\u1EADp nh\u1EADt":"L\u1ED7i t\u1EA1o"))}ae(o?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),y(!1),B(N==null?void 0:N.uuid)}catch(o){ae(o.message,"danger")}},se=t=>{P(t)},_e=t=>{if(t==="root")J([]),te(null),B(null);else if(t){const o=O.findIndex(k=>k.uuid===t.uuid);o>=0&&(J(O.slice(0,o+1)),te(t),B(t.uuid))}else{const o=[...O];o.pop();const k=o[o.length-1]||null;J(o),te(k),B(k==null?void 0:k.uuid)}},ge=async t=>{const o=`X\xF3a folder "${t.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(o))try{await fetch(`${API_BASE}/api/albums/${t.uuid||t.id}`,{method:"DELETE"}),ae("\u0110\xE3 x\xF3a","success"),B(N==null?void 0:N.uuid)}catch(k){ae("L\u1ED7i x\xF3a album","danger")}};if(!w)return React.createElement(LoginPage,{onLogin:xe,error:j});const de=()=>{const t=new Date,o=t.getFullYear(),k=String(t.getMonth()+1).padStart(2,"0");return`${o}-${k}`};function Le(){const[t,o]=useState(de()),[k,H]=useState(!0),[le,De]=useState([]),ve=h=>{if(!h)return 0;const ue=String(h).replace(/[^0-9]/g,"");return ue?Number(ue):0},Ee=h=>{if(!h)return null;const ue=String(h),me=ue.toLowerCase();if(me.includes("freeship")||me.includes("free ship")||me.includes("mi\u1EC5n ph\xED ship")||me.includes("mien phi ship")||me.includes("mi\u1EC5n ph\xED v\u1EADn chuy\u1EC3n")||me.includes("mien phi van chuyen"))return 0;const Ne=ue.match(/(?:ship|vận\s*chuyển|van\s*chuyen|\bvc\b)\s*[:=\-]?\s*([0-9][0-9\.,\s]*)(?:\s*(k|nghìn|nghin|tr|triệu|trieu|m))?/i);if(!Ne)return null;const Ce=String(Ne[1]||"").replace(/[^0-9]/g,"");if(!Ce)return null;let pe=Number(Ce);const Se=String(Ne[2]||"").toLowerCase();return Se==="k"||Se.startsWith("ngh")?pe*=1e3:(Se==="tr"||Se.startsWith("tri")||Se==="m")&&(pe*=1e6),Number.isFinite(pe)?pe:null},Te=h=>{const ue=Array.isArray(h)?h:[];let me=!1,Ne=0;for(const Ce of ue){const pe=Ee(Ce==null?void 0:Ce.product_note);pe!=null&&(me=!0,pe>Ne&&(Ne=pe))}return{found:me,fee:Ne}},R=h=>{try{return Number(h||0).toLocaleString("vi-VN")}catch(ue){return String(h||0)}},re=h=>`${R(h)}\u0111`,Pe=async()=>{H(!0);try{const ue=await(await fetch(`${API_BASE}/api/orders?month=${encodeURIComponent(t)}`)).json();De(Array.isArray(ue)?ue:[])}catch(h){console.error("Load stats error:",h),De([])}finally{H(!1)}};useEffect(()=>{Pe()},[t]);const W=React.useMemo(()=>{var r;const h={pending:0,processing:0,done:0,paid:0,other:0};let ue=0,me=0,Ne=0,Ce=0,pe=0;const Se=n=>n.customer_id||n.phone||"unknown",He=n=>Array.isArray(n==null?void 0:n.items)&&n.items.length?n.items:n!=null&&n.product_id?[{product_id:n.product_id,quantity:n.quantity,product_price:n.product_price,product_name:n.product_name,product_code:n.product_code,product_note:n.product_note}]:[],c=new Map,x=new Map,F=new Map;for(const n of le){const v=He(n);let u=0,p=0;for(const he of v){const ie=Number((he==null?void 0:he.quantity)||0)||0,Be=ve(he==null?void 0:he.product_price),Ue=ie*Be;u+=ie,p+=Ue;const Fe=(he==null?void 0:he.product_id)||"unknown",ze=c.get(Fe)||{product_id:Fe,product_name:(he==null?void 0:he.product_name)||"\u2014",product_code:(he==null?void 0:he.product_code)||"",orders:0,quantity:0,revenue:0};ze.orders+=1,ze.quantity+=ie,ze.revenue+=Ue,c.set(Fe,ze)}const S=Te(v),G=Number((r=n==null?void 0:n.adjustment_amount)!=null?r:0)||0,Z=p+(S.found?S.fee:0)+G,ne=p+G;ue+=u,me+=Z,Ce+=ne;const K=n.status==="done"||n.status==="paid";n.status==="pending"?h.pending+=1:n.status==="processing"?h.processing+=1:n.status==="paid"?(h.paid+=1,h.done+=1,Ne+=Z,pe+=ne):n.status==="done"?(h.done+=1,Ne+=Z,pe+=ne):h.other+=1;const ke=Se(n),we=x.get(ke)||{key:ke,customer_name:n.customer_name||"",phone:n.phone||"",orders:0,quantity:0,revenue:0};we.orders+=1,we.quantity+=u,we.revenue+=Z,!we.customer_name&&n.customer_name&&(we.customer_name=n.customer_name),!we.phone&&n.phone&&(we.phone=n.phone),x.set(ke,we);const $e=n.created_at?new Date(n.created_at):null;if($e&&!Number.isNaN($e.getTime())){const he=`${$e.getFullYear()}-${String($e.getMonth()+1).padStart(2,"0")}-${String($e.getDate()).padStart(2,"0")}`,ie=F.get(he)||{day:he,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};ie.orders+=1,ie.quantity+=u,ie.revenue+=Z,K&&(ie.doneOrders+=1,ie.doneRevenue+=Z),F.set(he,ie)}}const ce=Array.from(c.values()).sort((n,v)=>v.revenue-n.revenue),ye=Array.from(x.values()).sort((n,v)=>v.revenue-n.revenue),Ie=Array.from(F.values()).sort((n,v)=>n.day.localeCompare(v.day)),a=x.size,l=le.length?Math.round(me/le.length):0,i=le.length?ue/le.length:0,e=Math.round(pe*.05),s=Math.round(Ce*.05);return{statusCounts:h,totalQty:ue,totalRevenue:me,doneRevenue:Ne,tempCommission:e,tempCommissionAll:s,products:ce,customers:ye,days:Ie,uniqueCustomers:a,avgOrderValue:l,avgQtyPerOrder:i}},[le,t]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:k}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:Pe,disabled:k},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:t,onChange:h=>o(h.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),R(le.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),R(W.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),R(W.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",R(W.statusCounts.paid),"/",R(W.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},R(le.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},re(W.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},re(W.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},re(W.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},re(W.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",W.avgQtyPerOrder?W.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},R(W.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},R(W.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},R(W.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},R(W.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},R(W.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,R(W.statusCounts.pending)),React.createElement("td",null,R(W.statusCounts.processing)),React.createElement("td",null,R(W.statusCounts.done)),React.createElement("td",null,R(W.statusCounts.paid)),React.createElement("td",null,R(W.statusCounts.other)),React.createElement("td",null,R(W.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},W.products.slice(0,10).map(h=>React.createElement("div",{key:h.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},h.product_name),React.createElement("div",{className:"text-muted small text-truncate"},h.product_code?`#${h.product_code} \u2022 `:"",R(h.orders)," \u0111\u01A1n \u2022 ",R(h.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},re(h.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,W.products.slice(0,10).map(h=>React.createElement("tr",{key:h.product_id},React.createElement("td",null,h.product_name),React.createElement("td",null,h.product_code||"\u2014"),React.createElement("td",null,R(h.orders)),React.createElement("td",null,R(h.quantity)),React.createElement("td",{className:"fw-semibold"},re(h.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},W.customers.slice(0,10).map(h=>React.createElement("div",{key:h.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},h.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},h.phone||"\u2014"," \u2022 ",R(h.orders)," \u0111\u01A1n \u2022 ",R(h.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},re(h.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,W.customers.slice(0,10).map(h=>React.createElement("tr",{key:h.key},React.createElement("td",null,h.customer_name||"\u2014"),React.createElement("td",null,h.phone||"\u2014"),React.createElement("td",null,R(h.orders)),React.createElement("td",null,R(h.quantity)),React.createElement("td",{className:"fw-semibold"},re(h.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},W.days.map(h=>React.createElement("div",{key:h.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},h.day),React.createElement("div",{className:"text-muted small"},R(h.orders)," \u0111\u01A1n \u2022 ",R(h.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",R(h.doneOrders)," \u2022 ",re(h.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},re(h.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,W.days.map(h=>React.createElement("tr",{key:h.day},React.createElement("td",null,h.day),React.createElement("td",null,R(h.orders)),React.createElement("td",null,R(h.quantity)),React.createElement("td",{className:"fw-semibold"},re(h.revenue)),React.createElement("td",null,R(h.doneOrders)),React.createElement("td",{className:"fw-semibold"},re(h.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:f,onMenuChange:t=>{C(t),t==="albums"&&(te(null),J([]),B(null))},onLogout:ee,currentUser:_}),React.createElement("div",{className:"main-content"},f==="albums"&&!q&&React.createElement(AlbumList,{albums:$,loading:U,currentFolder:N,breadcrumb:O,onSelect:se,onCreate:fe,onEdit:be,onDelete:ge,onBack:_e}),f==="search"&&React.createElement(SearchCenter,{showToast:ae,onNavigate:(t,o,k)=>{C(t),t==="orders"&&o==="create"&&(b(Date.now()),V((k==null?void 0:k.productId)||""))}}),f==="albums"&&q&&React.createElement(AlbumDetail,{album:q,parentAlbum:O.length>0?O[O.length-1]:null,onBack:()=>{if(q.parentId){const t=O.findIndex(o=>o.uuid===q.parentId);t>=0?P(O[t]):P(null)}else P(null)},onRefresh:()=>B(N==null?void 0:N.uuid),showToast:ae,onNavigateToFolder:t=>{J(o=>[...o,q]),P(t)},onEditSubfolder:t=>{Y(t),y(!0)}}),f==="videos"&&React.createElement(VideoList,{showToast:ae}),f==="products"&&React.createElement(ProductManager,{showToast:ae}),f==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:L,autoOpenCreateProductId:M,showToast:ae}),f==="stats"&&React.createElement(Le,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${f==="search"?"active":""}`,onClick:t=>{t.preventDefault(),C("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${f==="albums"?"active":""}`,onClick:t=>{t.preventDefault(),C("albums"),P(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${f==="videos"?"active":""}`,onClick:t=>{t.preventDefault(),C("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${f==="products"?"active":""}`,onClick:t=>{t.preventDefault(),C("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${f==="orders"?"active":""}`,onClick:t=>{t.preventDefault(),C("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${f==="stats"?"active":""}`,onClick:t=>{t.preventDefault(),C("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:T,album:D,parentId:N==null?void 0:N.uuid,onClose:()=>y(!1),onSave:X}),React.createElement("div",{className:"toast-container"},E.map(t=>React.createElement(Toast,{key:t.id,message:t.message,type:t.type,onClose:()=>oe(t.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:w,autoOpenCreateProductId:m,showToast:j}){const[A,_]=useState([]),[d,f]=useState(!0),[C,L]=useState(!1),[b,M]=useState(null),[V,$]=useState(""),[I,q]=useState(!1),[P,T]=useState(null),[y,D]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Y,U]=useState([""]),[g,E]=useState(null),z=useRef({}),[N,te]=useState([]),[O,J]=useState(null),xe=useRef(null),ee=useRef(null),ae=useRef(0),oe=useRef(null),B=useRef(0),fe=3;useEffect(()=>{const a=l=>{var e;if(g==null)return;const i=(e=z.current)==null?void 0:e[g];i&&!i.contains(l.target)&&E(null)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[g]);const be=a=>{if(a==null)return 0;const l=String(a).replace(/[^0-9]/g,"");return l?Number(l):0},X=a=>{if(a==null||a==="")return 0;if(typeof a=="number")return Number.isFinite(a)?Math.trunc(a):0;const l=String(a).trim();if(!l)return 0;const i=/^\s*-/.test(l),e=l.replace(/[^0-9]/g,""),s=e?Number(e):0;return i?-s:s},se=a=>{try{return`${Number(a||0).toLocaleString("vi-VN")}\u0111`}catch(l){return`${a||0}\u0111`}},_e=a=>{if(!a)return null;const l=String(a),i=l.toLowerCase();if(i.includes("freeship")||i.includes("free ship")||i.includes("mi\u1EC5n ph\xED ship")||i.includes("mien phi ship")||i.includes("mi\u1EC5n ph\xED v\u1EADn chuy\u1EC3n")||i.includes("mien phi van chuyen"))return 0;const e=l.match(/(?:ship|vận\s*chuyển|van\s*chuyen|\bvc\b)\s*[:=\-]?\s*([0-9][0-9\.,\s]*)(?:\s*(k|nghìn|nghin|tr|triệu|trieu|m))?/i);if(!e)return null;const s=String(e[1]||"").replace(/[^0-9]/g,"");if(!s)return null;let r=Number(s);const n=String(e[2]||"").toLowerCase();return n==="k"||n.startsWith("ngh")?r*=1e3:(n==="tr"||n.startsWith("tri")||n==="m")&&(r*=1e6),Number.isFinite(r)?r:null},ge=a=>{const l=de(a);return l.length>=9&&l.length<=12},de=a=>a?String(a).replace(/[^0-9]/g,""):"",Le=async a=>{const l=de(a);if(!l)return;const i=++ae.current;T({status:"loading",phone:l});try{const s=await(await fetch(`${API_BASE}/api/customers?phone=${encodeURIComponent(l)}`)).json();if(ae.current!==i)return;if(s&&s.exists&&s.customer){T({status:"found",phone:l,customer:s.customer}),D(r=>de(r.phone)!==l?r:{...r,customer_name:s.customer.name||r.customer_name,address:s.customer.address||r.address});return}T({status:"not-found",phone:l})}catch(e){if(ae.current!==i)return;console.error("Customer lookup error:",e),T({status:"error",phone:l})}},t=a=>{const l=de(a);if(D(e=>({...e,phone:l})),ee.current&&(clearTimeout(ee.current),ee.current=null),l.length<fe){T(null);return}ee.current=setTimeout(()=>{Le(l)},350)},o=()=>{const a=de(y.phone);a.length<fe||Le(a)};useEffect(()=>(I?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[I]);const k=Array.isArray(y.items)?y.items.length:0;useEffect(()=>{if(!I){B.current=k;return}k>B.current&&setTimeout(()=>{const a=oe.current;a&&a.scrollTo({top:a.scrollHeight,behavior:"smooth"})},0),B.current=k},[I,k]),useEffect(()=>()=>{ee.current&&(clearTimeout(ee.current),ee.current=null)},[]),useEffect(()=>{Ee()},[]),useEffect(()=>{Te()},[V]),useEffect(()=>{w&&xe.current!==w&&(xe.current=w,Pe(m))},[w]);const H=a=>a==="pending"?"Ch\u1EDD x\u1EED l\xFD":a==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":a==="done"?"Ho\xE0n th\xE0nh":a==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":a||"",le=a=>a==="pending"?"bg-secondary":a==="processing"?"bg-warning text-dark":a==="done"?"bg-success":a==="paid"?"bg-primary":"bg-light text-dark",De=React.useMemo(()=>{const a={pending:0,processing:1,done:2,paid:3},l=e=>e in a?a[e]:99,i=e=>{if(!e)return Number.POSITIVE_INFINITY;const s=new Date(e).getTime();return Number.isFinite(s)?s:Number.POSITIVE_INFINITY};return[...A||[]].sort((e,s)=>{const r=l(e==null?void 0:e.status),n=l(s==null?void 0:s.status);if(r!==n)return r-n;const v=i(e==null?void 0:e.created_at),u=i(s==null?void 0:s.created_at);if(v!==u)return u-v;const p=Number(e==null?void 0:e.id),S=Number(s==null?void 0:s.id);return Number.isFinite(p)&&Number.isFinite(S)?S-p:String((e==null?void 0:e.id)||"").localeCompare(String((s==null?void 0:s.id)||""))})},[A]),ve=a=>{if(!a)return"";const l=new Date(a);if(Number.isNaN(l.getTime()))return String(a);try{return l.toLocaleString("vi-VN")}catch(i){return l.toISOString()}},Ee=async()=>{try{const l=await(await fetch(`${API_BASE}/api/products`)).json();te(Array.isArray(l)?l:[])}catch(a){console.error("Load products error:",a),te([])}},Te=async()=>{f(!0);try{let a=`${API_BASE}/api/orders`;V&&(a+=`?month=${V}`);const i=await(await fetch(a)).json();_(Array.isArray(i)?i:[])}catch(a){console.error("Load orders error:",a),_([])}finally{f(!1)}},R=async()=>{const a=de(y.phone),i=(Array.isArray(y.items)?y.items:[]).map(e=>{var s;return{product_id:(e==null?void 0:e.product_id)||"",quantity:Number((s=e==null?void 0:e.quantity)!=null?s:1)}}).filter(e=>e.product_id&&Number.isFinite(e.quantity)&&e.quantity>0);if(!y.customer_name||!a||i.length===0){alert("Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c");return}if(!ge(a)){alert("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)");return}L(!0);try{const e=O?"PUT":"POST",s=O?`${API_BASE}/api/orders/${O}`:`${API_BASE}/api/orders`,r=i[0];await fetch(s,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_name:y.customer_name,phone:a,address:y.address,adjustment_amount:X(y.adjustment_amount),adjustment_note:(y.adjustment_note||"").trim(),product_id:r.product_id,quantity:r.quantity,status:y.status,items:i,...O?{id:O}:{}})}),D({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),J(null),q(!1),Te()}finally{L(!1)}},re=a=>{var i;J(a.id);const l=Array.isArray(a.items)&&a.items.length?a.items.map(e=>{var s;return{product_id:(e==null?void 0:e.product_id)||"",quantity:Number((s=e==null?void 0:e.quantity)!=null?s:1)||1}}).filter(e=>e.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1}];D({customer_name:a.customer_name||"",phone:de(a.phone||""),address:a.address||"",items:l.length?l:[{product_id:"",quantity:1}],adjustment_amount:Number((i=a==null?void 0:a.adjustment_amount)!=null?i:0)||0,adjustment_note:(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),U(new Array(l.length?l.length:1).fill("")),T(null),q(!0),a.phone&&Le(de(a.phone))};function Pe(a){J(null),D({customer_name:"",phone:"",address:"",items:[{product_id:a||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),U([""]),T(null),q(!0)}const W=()=>{C||(q(!1),J(null),D({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),U([""]),E(null),T(null))},h=a=>{if(!a)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const l=String(a),i=N.find(e=>String(e==null?void 0:e.id)===l);return i?`${i.name}${i.code?` (${i.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},ue=a=>{const l=String(Y[a]||"").trim().toLowerCase();return l?N.filter(i=>{const e=String((i==null?void 0:i.name)||"").toLowerCase(),s=String((i==null?void 0:i.code)||"").toLowerCase();return e.includes(l)||s.includes(l)}):N},me=a=>Array.isArray(a==null?void 0:a.items)&&a.items.length?a.items:a!=null&&a.product_id?[{product_id:a.product_id,quantity:Number(a.quantity||1)||1,product_name:a.product_name}]:[],Ne=a=>{var s,r;const i=me(a).reduce((n,v)=>n+(Number((v==null?void 0:v.quantity)||0)||0),0);if(i>0)return i;const e=Number((r=(s=a==null?void 0:a.total_quantity)!=null?s:a==null?void 0:a.quantity)!=null?r:0);return Number.isFinite(e)?e:0},Ce=a=>{const l=me(a);if(!l.length)return"\u2014";const i=l.map(e=>{const s=e==null?void 0:e.product_name;if(s)return String(s);const r=String((e==null?void 0:e.product_id)||""),n=N.find(v=>String(v==null?void 0:v.id)===r);return n!=null&&n.name?String(n.name):""}).filter(Boolean);return i.length?i.join(" + "):(a==null?void 0:a.product_name)||"\u2014"},pe=a=>{const l=me(a);return l.length?l.map(i=>{var u;const e=i==null?void 0:i.product_name,s=String((i==null?void 0:i.product_id)||""),r=N.find(p=>String(p==null?void 0:p.id)===s),n=(e||(r==null?void 0:r.name)||"").toString().trim(),v=Number((u=i==null?void 0:i.quantity)!=null?u:1)||1;return{name:n,qty:v}}).filter(i=>i.name):[]},Se=a=>{const l=a==null?void 0:a.adjustment_amount;if(typeof l=="number")return Number.isFinite(l)?Math.trunc(l):0;const i=Number(l);return Number.isFinite(i)?Math.trunc(i):0},He=a=>{var p;const l=me(a),i=pe(a),e=ce(l),s=F(l),r=s.fee,n=Se(a),v=e+r+n,u=[];if(u.push(`\u0110\u01A0N H\xC0NG #${(p=a==null?void 0:a.id)!=null?p:""}`.trim()),a!=null&&a.customer_name&&u.push(`Kh\xE1ch: ${a.customer_name}`),a!=null&&a.phone&&u.push(`S\u0110T: ${a.phone}`),a!=null&&a.address&&u.push(`\u0110\u1ECBa ch\u1EC9: ${a.address}`),a!=null&&a.status&&u.push(`Tr\u1EA1ng th\xE1i: ${H(a.status)}`),a!=null&&a.created_at&&u.push(`Th\u1EDDi gian: ${ve(a.created_at)}`),u.push(""),u.push("S\u1EA3n ph\u1EA9m:"),i.length)for(const S of i)u.push(`- ${S.name} x${S.qty}`);else{const S=Ce(a);S&&S!=="\u2014"&&u.push(`- ${S}`)}return u.push(""),u.push(`T\u1EA1m t\xEDnh: ${se(e)}`),u.push(`Ship: ${se(s.found?r:0)}`),n!==0&&u.push(`\u0110i\u1EC1u ch\u1EC9nh: ${se(n)}`),a!=null&&a.adjustment_note&&u.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${a.adjustment_note}`),u.push(`T\u1ED5ng: ${se(v)}`),u.filter(Boolean).join(`
`)},c=async a=>{var e;if((e=navigator==null?void 0:navigator.clipboard)!=null&&e.writeText){await navigator.clipboard.writeText(a);return}const l=document.createElement("textarea");l.value=a,l.setAttribute("readonly",""),l.style.position="fixed",l.style.left="-9999px",document.body.appendChild(l),l.select();const i=document.execCommand("copy");if(document.body.removeChild(l),!i)throw new Error("copy_failed")},x=async a=>{try{const l=He(a);await c(l),typeof j=="function"?j("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(l){console.error(l),typeof j=="function"?j("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},F=a=>{var s,r;const l=Array.isArray(a)?a:[];let i=!1,e=0;for(const n of l){const v=String((n==null?void 0:n.product_id)||""),u=N.find(G=>String(G==null?void 0:G.id)===v),p=(r=(s=n==null?void 0:n.product_note)!=null?s:u==null?void 0:u.note)!=null?r:null,S=_e(p);S!=null&&(i=!0,S>e&&(e=S))}return{found:i,fee:e}},ce=a=>(Array.isArray(a)?a:[]).reduce((i,e)=>{var u;const s=Number((e==null?void 0:e.quantity)||0)||0,r=String((e==null?void 0:e.product_id)||""),n=N.find(p=>String(p==null?void 0:p.id)===r),v=be((u=e==null?void 0:e.product_price)!=null?u:n==null?void 0:n.price);return i+s*v},0),ye=a=>{const l=me(a),i=ce(l),e=F(l).fee,s=Se(a);return i+e+s},Ie=async a=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){M(a);try{await fetch(`${API_BASE}/api/orders/${a}`,{method:"DELETE"}),Te()}finally{M(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:d&&!I||C||!!b}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Pe,disabled:C||!!b},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:V,onChange:a=>$(a.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),V&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{$("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:d},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Te,disabled:d},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},A.length," \u0111\u01A1n")),d?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):A.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},De.map(a=>React.createElement("div",{key:a.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},a.customer_name),React.createElement("div",{className:"text-muted small"},a.phone),a.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},a.address)),React.createElement("span",{className:`badge ${le(a.status)}`},H(a.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const l=pe(a);return l.length?React.createElement("div",{className:"mt-1"},l.map((i,e)=>React.createElement("div",{key:e,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},i.name),React.createElement("div",{className:"text-muted",style:{flexShrink:0}},"x",i.qty)))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Ce(a))})()),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},Ne(a))),(Se(a)!==0||((a==null?void 0:a.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},se(Se(a))),((a==null?void 0:a.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(a.adjustment_note||"").trim(),")"):null),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},se(ye(a)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",ve(a.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>re(a),disabled:C||!!b},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>x(a),disabled:C||!!b},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>Ie(a.id),disabled:C||b===a.id},b===a.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,De.map(a=>React.createElement("tr",{key:a.id},React.createElement("td",null,a.customer_name),React.createElement("td",null,a.phone),React.createElement("td",null,Ce(a)),React.createElement("td",null,Ne(a)),React.createElement("td",{className:"fw-semibold"},se(ye(a))),React.createElement("td",null,React.createElement("span",{className:`badge ${le(a.status)}`},H(a.status))),React.createElement("td",null,ve(a.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>re(a),disabled:C||!!b},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>x(a),disabled:C||!!b},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>Ie(a.id),disabled:C||b===a.id},b===a.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),I&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),O?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:W})),React.createElement("form",{onSubmit:a=>{a.preventDefault(),R()}},React.createElement("div",{className:"modal-body",ref:oe},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:y.customer_name,onChange:a=>D({...y,customer_name:a.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",value:y.phone,onChange:a=>t(a.target.value),onBlur:o,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),(P==null?void 0:P.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(P==null?void 0:P.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(P==null?void 0:P.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(P==null?void 0:P.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:y.status,onChange:a=>D({...y,status:a.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:y.address,onChange:a=>D({...y,address:a.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:y.adjustment_amount,onChange:a=>D({...y,adjustment_amount:a.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm.")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:y.adjustment_note,onChange:a=>D({...y,adjustment_note:a.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{D(a=>({...a,items:[...Array.isArray(a.items)?a.items:[],{product_id:"",quantity:1}]})),U(a=>[...Array.isArray(a)?a:[],""])},disabled:C},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(y.items)?y.items:[{product_id:"",quantity:1}]).map((a,l)=>React.createElement("div",{key:l,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:i=>{z.current[l]=i}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{E(i=>i===l?null:l),setTimeout(()=>{const i=document.getElementById(`order-product-search-${l}`);i&&i.focus()},0)}},React.createElement("span",{className:a.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},h(a.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),g===l&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${l}`,className:"form-control",value:Y[l]||"",onChange:i=>{const e=i.target.value;U(s=>{const r=Array.isArray(s)?[...s]:[];return r[l]=e,r})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),ue(l).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):ue(l).map(i=>React.createElement("button",{key:i.id,type:"button",className:"dropdown-item",onClick:()=>{const e=String(i.id);D(s=>{const r=Array.isArray(s.items)?[...s.items]:[];return r[l]={...r[l]||{quantity:1},product_id:e},{...s,items:r}}),E(null)}},i.name,i.code?` (${i.code})`:""))),React.createElement("select",{className:"form-select",value:a.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),N.map(i=>React.createElement("option",{key:i.id,value:i.id},i.name))))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:a.quantity,onChange:i=>{const e=i.target.value;D(s=>{const r=Array.isArray(s.items)?[...s.items]:[];return r[l]={...r[l]||{product_id:""},quantity:e},{...s,items:r}})},min:"1",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{D(i=>{const e=Array.isArray(i.items)?[...i.items]:[];return e.splice(l,1),{...i,items:e.length?e:[{product_id:"",quantity:1}]}}),U(i=>{const e=Array.isArray(i)?[...i]:[];return e.splice(l,1),e.length?e:[""]}),E(i=>i==null?i:i===l?null:i>l?i-1:i)},disabled:C||(Array.isArray(y.items)?y.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const l=(Array.isArray(y.items)?y.items:[]).filter(n=>n==null?void 0:n.product_id),i=ce(l),e=F(l),s=X(y.adjustment_amount),r=i+(e.found?e.fee:0)+s;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},se(i))),e.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},se(e.fee))),s!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},se(s))),(y.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(y.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},se(r)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:W,disabled:C,style:{borderRadius:10}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:C,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

