const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:g,error:d}){const[$,L]=useState(""),[k,o]=useState(""),[b,v]=useState(!1),[A,u]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),d&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),d),React.createElement("form",{onSubmit:async P=>{P.preventDefault(),v(!0),await g($,k),v(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:$,onChange:P=>L(P.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:A?"text":"password",className:"form-control",value:k,onChange:P=>o(P.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>u(!A)},React.createElement("i",{className:`fas fa-eye${A?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:b},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:g,type:d,onClose:$}){return useEffect(()=>{const L=setTimeout($,3e3);return()=>clearTimeout(L)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${d} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},g),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:$})))}function Loading({show:g}){return g?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:g,onMenuChange:d,onLogout:$,currentUser:L}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(o=>React.createElement("a",{key:o.id,href:"#",className:`nav-link ${g===o.id?"active":""} ${o.disabled?"opacity-50":""} ${o.highlight?"text-warning":""}`,onClick:b=>{b.preventDefault(),o.disabled||d(o.id)}},React.createElement("i",{className:`fas ${o.icon}`})," ",o.label,o.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),o.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),$&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:$,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:g,onSelect:d,onCreate:$,onEdit:L,onDelete:k,loading:o,currentFolder:b,onBack:v,breadcrumb:A}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},b&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:v},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),b?b.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:$},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),A&&A.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:u=>{u.preventDefault(),v("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),A.map((u,R)=>React.createElement("li",{key:u.id,className:`breadcrumb-item ${R===A.length-1?"active":""}`},R===A.length-1?u.title:React.createElement("a",{href:"#",onClick:P=>{P.preventDefault(),v(u)},className:"text-warning"},u.title))))),o?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):g.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},b?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},g.map(u=>React.createElement("div",{key:u.uuid||u.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>d(u)},u.cover?React.createElement("img",{src:u.cover,className:"album-cover",alt:u.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},u.title),React.createElement("small",{className:"text-muted"},u.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),u.subfolderCount),u.subfolderCount>0&&u.count>0&&" \u2022 ",u.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),u.count),u.subfolderCount===0&&u.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:R=>{R.stopPropagation(),L(u)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:R=>{R.stopPropagation(),k(u)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:g,album:d,onClose:$,onSave:L,parentId:k}){const[o,b]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[v,A]=useState(!1),[u,R]=useState(!1),P=useRef(null);useEffect(()=>{b(d?{slug:d.id||"",title:d.title||"",description:d.description||"",cover_url:d.cover||"",parent_id:d.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:k||null})},[d,g,k]);const S=async _=>{_.preventDefault(),A(!0),await L(o),A(!1)},T=_=>_.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),F=async _=>{const O=_.type==="image/heic"||_.type==="image/heif"||/\.heic$/i.test(_.name);if(_.size<=2097152&&!O)return _;try{const B=await createImageBitmap(_),H=document.createElement("canvas");let p=B.width,j=B.height;const X=800;return(p>X||j>X)&&(p>j?(j=Math.round(j/p*X),p=X):(p=Math.round(p/j*X),j=X)),H.width=p,H.height=j,H.getContext("2d").drawImage(B,0,0,p,j),B.close(),new Promise((te,V)=>{H.toBlob(Y=>{Y?te(new File([Y],_.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):V(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(B){throw console.error("Compress cover error:",B),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},E=async _=>{var B;const f=_.target.files[0];if(!f)return;if(!(f.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(f.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}R(!0);try{const H=await F(f),p=await window.KTM.cloudinary.uploadImage({file:H,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!p.secure_url)throw console.error("Cloudinary error:",p),new Error(((B=p.error)==null?void 0:B.message)||"Upload failed");b(j=>({...j,cover_url:p.secure_url}))}catch(H){console.error("Cover upload error:",H),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+H.message)}R(!1),_.target.value=""};return g?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},d?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:S},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:o.title,onChange:_=>b({...o,title:_.target.value,slug:o.slug||T(_.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:o.slug,onChange:_=>b({...o,slug:_.target.value}),required:!0,disabled:!!d}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:o.description,onChange:_=>b({...o,description:_.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},o.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:o.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>b(_=>({..._,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:P,type:"file",accept:"image/*",className:"d-none",onChange:E}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var _;return(_=P.current)==null?void 0:_.click()},disabled:u},u?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:o.cover_url,onChange:_=>b({...o,cover_url:_.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:v||u},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:g,allAlbums:d,currentAlbumId:$,targetAlbum:L,onSelect:k,level:o=0}){const[b,v]=useState(!0),A=g.uuid||g.id,u=A===$,R=L===A,P=d.filter(T=>T.parentId===A),S=P.length>0;return React.createElement("div",{style:{marginLeft:o*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${R?"bg-info text-white":u?"bg-light text-muted":"hover-bg"}`,style:{cursor:u?"not-allowed":"pointer",opacity:u?.5:1,transition:"background 0.2s"},onClick:()=>!u&&k(A)},S&&React.createElement("i",{className:`fas fa-chevron-${b?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:T=>{T.stopPropagation(),v(!b)}}),!S&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${R?"-open":""} me-2 ${R?"":"text-warning"}`}),React.createElement("span",{className:"small"},g.title),u&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),g.count>0&&!u&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},g.count)),b&&S&&React.createElement("div",null,P.map(T=>React.createElement(FolderTreeItem,{key:T.uuid||T.id,folder:T,allAlbums:d,currentAlbumId:$,targetAlbum:L,onSelect:k,level:o+1}))))}function AlbumDetail({album:g,onBack:d,onRefresh:$,showToast:L,onNavigateToFolder:k,onEditSubfolder:o,parentAlbum:b}){const[v,A]=useState([]),[u,R]=useState([]),[P,S]=useState(!0),[T,F]=useState(!1),[E,_]=useState(""),[f,O]=useState([]),[B,H]=useState([]),[p,j]=useState({}),[X,N]=useState(null),[te,V]=useState(!1),[Y,he]=useState(""),[G,W]=useState(!1),ne=useRef(null),q=useRef(null),[ce,Ne]=useState(!1),[Z,ae]=useState([]),[we,ue]=useState([]),[de,_e]=useState(""),[t,s]=useState(!1),C=async(n,w=2)=>{const J=w*1024*1024,ge=n.type==="image/heic"||n.type==="image/heif"||/\.heic$/i.test(n.name);if(n.size<=J&&!ge)return n;try{const ve=await createImageBitmap(n),ke=document.createElement("canvas");let a=ve.width,m=ve.height;const c=1200;return(a>c||m>c)&&(a>m?(m=Math.round(m/a*c),a=c):(a=Math.round(a/m*c),m=c)),ke.width=a,ke.height=m,ke.getContext("2d").drawImage(ve,0,0,a,m),ve.close(),new Promise((i,r)=>{ke.toBlob(l=>{l?i(new File([l],n.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):r(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ve){throw console.error("Compress error:",ve),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{se(),me()},[g.id,g.uuid]);const se=async()=>{S(!0);try{const n=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${g.uuid||g.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");A(n.images||[]);const w=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${g.uuid||g.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");R(Array.isArray(w)?w:[])}catch(n){console.error(n),L("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}S(!1)},me=async()=>{try{const n=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");ue(Array.isArray(n)?n:[])}catch(n){console.error("Error loading albums:",n)}},Te=n=>{ae(w=>w.includes(n)?w.filter(J=>J!==n):[...w,n])},pe=async()=>{if(!de||Z.length===0){L("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}s(!0);let n=0;for(const w of Z)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${w}`,{album_id:de},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),n++}catch(J){console.error("Move error:",J)}s(!1),Ne(!1),ae([]),_e(""),n>0?(L("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),se(),$()):L("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Me,xe]=useState(!1),D=async()=>{if(Z.length===0||!confirm(`X\xF3a ${Z.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;xe(!0);let n=0;for(const w of Z)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${w}`,"L\u1ED7i x\xF3a \u1EA3nh"),n++}catch(J){console.error("Delete error:",J)}xe(!1),ae([]),n>0?(L(`\u0110\xE3 x\xF3a ${n} \u1EA3nh!`,"success"),se(),$()):L("X\xF3a th\u1EA5t b\u1EA1i","danger")},ie=()=>{Z.length===v.length?ae([]):ae(v.map(n=>n.id))},Le=async()=>{if(Y.trim()){W(!0);try{const n=Y.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:n+"-"+Date.now(),title:Y,parent_id:g.uuid||g.id},"L\u1ED7i t\u1EA1o folder"),L("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),he(""),V(!1),se(),$()}catch(n){L(n.message,"danger")}W(!1)}},U=async n=>{if(confirm(`X\xF3a folder "${n.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${n.uuid||n.id}`,"L\u1ED7i x\xF3a folder"),L("\u0110\xE3 x\xF3a folder","success"),se(),$()}catch(w){L("L\u1ED7i x\xF3a folder","danger")}},y=n=>{const w=Array.from(n).filter(J=>J.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(J.name));O(J=>[...J,...w]),w.forEach(J=>{const ge=new FileReader;ge.onload=ve=>{H(ke=>[...ke,{file:J,preview:ve.target.result}])},ge.readAsDataURL(J)})},Ae=n=>{O(w=>w.filter((J,ge)=>ge!==n)),H(w=>w.filter((J,ge)=>ge!==n))},Ce=async n=>{var J;const w=await window.KTM.cloudinary.uploadImage({file:n,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${g.id}`});if(!w.secure_url)throw console.error("Cloudinary error:",w),new Error(((J=w.error)==null?void 0:J.message)||"Upload failed");return w},Oe=async()=>{if(f.length===0)return;F(!0);let n=0;for(let w=0;w<f.length;w++)try{_(`\u0110ang x\u1EED l\xFD ${w+1}/${f.length}...`);const J=await C(f[w],2);_(`\u0110ang upload ${w+1}/${f.length}...`);const ge=await Ce(J);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${g.id}`,{url:ge.secure_url,caption:p[w]||f[w].name.replace(/\.[^/.]+$/,""),sort_order:v.length+w},"L\u1ED7i l\u01B0u \u1EA3nh"),n++}catch(J){console.error("Upload error:",J)}F(!1),_(""),O([]),H([]),j({}),n>0?(L(`\u0110\xE3 upload ${n} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),se(),$()):L("Upload th\u1EA5t b\u1EA1i","danger")},Ke=async(n,w)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${n}`,"L\u1ED7i x\xF3a \u1EA3nh"),L("\u0110\xE3 x\xF3a \u1EA3nh","success"),se(),$()}catch(J){L("L\u1ED7i x\xF3a \u1EA3nh","danger")}},ye=n=>{var w;n.preventDefault(),(w=q.current)==null||w.classList.add("dragover")},Pe=()=>{var n;(n=q.current)==null||n.classList.remove("dragover")},De=n=>{var w;n.preventDefault(),(w=q.current)==null||w.classList.remove("dragover"),y(n.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:d},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},g.title),React.createElement("small",{className:"text-muted"},u.length>0&&React.createElement("span",null,u.length," folder \u2022 "),v.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>V(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),te&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Y,onChange:n=>he(n.target.value),onKeyPress:n=>n.key==="Enter"&&Le(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Le,disabled:G||!Y.trim()},G?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{V(!1),he("")}},"H\u1EE7y")))),u.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},u.map(n=>React.createElement("div",{key:n.uuid||n.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>k&&k(n)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},n.title),React.createElement("small",{className:"text-muted"},n.subfolderCount>0&&React.createElement("span",null,n.subfolderCount," folder"),n.subfolderCount>0&&n.count>0&&" \u2022 ",n.count>0&&React.createElement("span",null,n.count," \u1EA3nh"),n.subfolderCount===0&&n.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:w=>{w.stopPropagation(),o&&o(n)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:w=>{w.stopPropagation(),U(n)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:q,className:"upload-zone",onClick:()=>{var n;return(n=ne.current)==null?void 0:n.click()},onDragOver:ye,onDragLeave:Pe,onDrop:De},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:ne,type:"file",multiple:!0,accept:"image/*",onChange:n=>y(n.target.files)})),B.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},B.map((n,w)=>React.createElement("div",{key:w,className:"upload-preview-item"},React.createElement("img",{src:n.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Ae(w)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Oe,disabled:T},T?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),E||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",f.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",v.length,")"),v.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:ie},Z.length===v.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),Z.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},Z.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>Ne(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:D,disabled:Me},Me?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ae([])},React.createElement("i",{className:"fas fa-times"})))),P?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):v.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},v.map((n,w)=>React.createElement("div",{key:w,className:`image-item ${Z.includes(n.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Te(n.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:Z.includes(n.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:Z.includes(n.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},Z.includes(n.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:n.src,alt:n.caption,style:{opacity:Z.includes(n.id)?.7:1,border:Z.includes(n.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:J=>{J.stopPropagation(),Ke(n.id,w)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),n.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},n.caption)))))),ce&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",Z.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>Ne(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},we.filter(n=>!n.parentId).map(n=>React.createElement(FolderTreeItem,{key:n.uuid||n.id,folder:n,allAlbums:we,currentAlbumId:g.uuid||g.id,targetAlbum:de,onSelect:_e})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>Ne(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:pe,disabled:!de||t},t?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),X&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>N(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>N(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:X.src,alt:X.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:n=>n.stopPropagation()}),X.caption&&React.createElement("div",{className:"text-white text-center mt-2"},X.caption)))))}function SearchCenter({showToast:g,onNavigate:d}){const[$,L]=useState(""),[k,o]=useState([]),[b,v]=useState([]),[A,u]=useState([]),[R,P]=useState("all"),[S,T]=useState(null),[F,E]=useState("list"),[_,f]=useState(!0),[O,B]=useState([]),[H,p]=useState([]),j=useRef(null),[X,N]=useState(!0),[te,V]=useState(!1),Y=useRef(null),[he,G]=useState(!1),[W,ne]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[q,ce]=useState(""),[Ne,Z]=useState(!1),ae=useRef(null),we=useRef(null),[ue,de]=useState(null),[_e,t]=useState(!1),[s,C]=useState(null),[se,me]=useState(!1),[Te,pe]=useState(!1),[Me,xe]=useState(null),[D,ie]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),Le=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],U=e=>{e._type==="product"&&(C(e),ie({name:e.name||"",code:e.code||"",price:e.price||"",image:e.image||"",category:e.category||"",note:e.note||""}),t(!0))},y=async()=>{if(s)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${s.id}`,D,"L\u1ED7i c\u1EADp nh\u1EADt"),g("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),t(!1),C(null),ye()}catch(e){g(e.message,"danger")}},Ae=async e=>{const i=e._type==="product"?"s\u1EA3n ph\u1EA9m":e._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${i} "${e.name}"?`))try{let r="";e._type==="product"?r=`${API_BASE}/api/products?id=${e.id}`:e._type==="album"?r=`${API_BASE}/api/images/${e.id}`:e._type==="video"&&(r=`${API_BASE}/api/videos/${e.id}`),await window.KTM.api.deleteJSON(r,"L\u1ED7i x\xF3a"),g(`\u0110\xE3 x\xF3a ${i}`,"success"),ye()}catch(r){g(r.message,"danger")}},Ce=async e=>{try{const i=Me?`${API_BASE}/api/products?id=${Me.id}`:`${API_BASE}/api/products`;Me?await window.KTM.api.putJSON(i,e,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(i,e,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),g(Me?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),pe(!1),xe(null),ye()}catch(i){g(i.message,"danger")}},Oe="ktm_admin_data_cache_v1",Ke=1e3*60*10,ye=async()=>{let e=null,i=!1;const r=window.KTM.cache.read(Oe,{ttlMs:Ke,validate:Array.isArray});r.hit?(e=r.value,console.log("[CACHE] Using cache, items:",e.length),v(e),o(e),f(!1),i=!0):r.status==="miss"?console.log("[CACHE] No cache found"):r.status==="expired"||r.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):r.status==="error"&&console.error("[CACHE] Error parsing cache"),i||f(!0);try{const l=async(fe,oe)=>{try{const Se=await window.KTM.api.getJSON(fe,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Se!=null?Se:oe}catch(Se){return oe}},[I,h,x]=await Promise.all([l(`${API_BASE}/api/products`,[]),l(`${API_BASE}/api/albums`,[]),l(`${API_BASE}/api/video-folders?withVideos=true`,[])]),M=Array.isArray(I)?I.map(fe=>({...fe,_type:"product",_source:"database"})):[];B(h);let ee=[];Array.isArray(h)&&h.length>0&&(await Promise.all(h.map(oe=>l(`${API_BASE}/api/albums/${oe.id}`,{})))).forEach((oe,Se)=>{const le=h[Se];oe.images&&oe.images.length>0&&oe.images.forEach(be=>{ee.push({id:be.id,name:be.caption||"\u1EA2nh t\u1EEB "+le.title,image:be.src,folder:le.title,_type:"album",_source:"database"})})}),p(x);let Q=[];Array.isArray(x)&&x.forEach(fe=>{fe.videos&&fe.videos.forEach(oe=>{Q.push({id:oe.id,name:oe.title,folder:fe.name,image:oe.thumb,youtubeId:oe.youtubeId,url:oe.url,_type:"video",_source:"database"})})});const K=[...M,...ee,...Q];(!e||JSON.stringify(K)!==JSON.stringify(e))&&(v(K),o(K),window.KTM.cache.write(Oe,K))}catch(l){console.error("Song song fetch error:",l)}f(!1)};useEffect(()=>{ye(),setTimeout(()=>{var e;return(e=j.current)==null?void 0:e.focus()},100)},[]);const Pe=async(e,i)=>{if(!(!X||i.length===0)){V(!0);try{const r=i.map(I=>({id:I.id,name:I.name,price:I.price,category:I.category,note:I.note,folder:I.folder,_type:I._type})),l=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:e,products:r},"AI Search error");if(l&&l.matchedIds&&l.matchedIds.length>0){const I=i.filter(h=>l.matchedIds.includes(h.id));I.length>0&&o(I)}else l&&l.matchedIds&&l.matchedIds.length===0&&o([])}catch(r){console.error("AI Search error:",r)}V(!1)}},De=e=>{if(L(e),Y.current&&clearTimeout(Y.current),!e.trim()){n(R);return}const r=e.toLowerCase().split(/\s+/).filter(h=>h.length>0),l=b.filter(h=>{const x=Object.entries(h).filter(([M])=>!M.startsWith("_")).map(([,M])=>String(M||"").toLowerCase()).join(" ");return r.some(M=>x.includes(M))});let I=l;R!=="all"&&(I=l.filter(h=>(h.category||h._type)===R)),o(I),X&&e.length>=3&&(Y.current=setTimeout(()=>{Pe(e,I)},500))},n=e=>{P(e);let i=b;if(e!=="all"&&(i=b.filter(r=>(r.category||r._type)===e)),$.trim()){const l=$.toLowerCase().split(/\s+/).filter(I=>I.length>0);i=i.filter(I=>{const h=Object.entries(I).filter(([x])=>!x.startsWith("_")).map(([,x])=>String(x||"").toLowerCase()).join(" ");return l.every(x=>h.includes(x))})}o(i)},w=(e,i)=>{window.KTM.clipboard.writeText(e).then(()=>{T(i),g("\u0110\xE3 copy!","success"),setTimeout(()=>T(null),1500)})},J=async(e,i)=>{try{await window.KTM.clipboard.writeImageFromUrl(e),T(i+"-img"),g("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>T(null),1500)}catch(r){w(e,i+"-img")}},ge=e=>{let i=e.toLowerCase();const r=[],l=b.filter(x=>x._type==="product");if(i.includes("ty")||i.includes("xy lanh")){if(i.includes("gi\u1EEFa")||i.includes("giua")){const x=l.find(M=>{var ee;return(ee=M.name)==null?void 0:ee.toLowerCase().includes("xy lanh gi\u1EEFa")});x&&!r.find(M=>M.id===x.id)&&r.push(x)}if(i.includes("nghi\xEAng")||i.includes("nghieng")){const x=l.find(M=>{var ee;return(ee=M.name)==null?void 0:ee.toLowerCase().includes("xy lanh nghi\xEAng")});x&&!r.find(M=>M.id===x.id)&&r.push(x)}if(i.includes("\u1EE7i")||i.includes("ui")){const x=l.find(M=>{var ee;return(ee=M.name)==null?void 0:ee.toLowerCase().includes("xy lanh \u1EE7i")});x&&!r.find(M=>M.id===x.id)&&r.push(x)}}const I=i.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(I){const x=I[1],M=I[2],ee=l.find(Q=>{var re;const K=((re=Q.name)==null?void 0:re.toLowerCase())||"";return K.includes("combo")&&K.includes(`${x} tay`)&&(K.includes(`${M} xy`)||K.includes(`${M} xylanh`))});if(ee&&!r.find(Q=>Q.id===ee.id))r.push(ee);else{const Q=l.find(K=>{var fe;const re=((fe=K.name)==null?void 0:fe.toLowerCase())||"";return re.includes("combo")&&re.includes(`${x} tay`)});Q&&!r.find(K=>K.id===Q.id)&&r.push(Q)}}if(i.includes("combo")&&!I){const x=i.match(/combo.*?(\d+)\s*tay/);if(x){const M=x[1];l.filter(Q=>{var re;const K=((re=Q.name)==null?void 0:re.toLowerCase())||"";return K.includes("combo")&&K.includes(`${M} tay`)}).forEach(Q=>{r.find(K=>K.id===Q.id)||r.push(Q)})}}const h=i.match(/van\s*(\d+)\s*tay/);if(h&&!i.includes("ty")&&!i.includes("combo")){const x=h[1],M=l.find(ee=>{var K;const Q=((K=ee.name)==null?void 0:K.toLowerCase())||"";return Q.includes(`van ${x} tay`)&&!Q.includes("combo")});M&&!r.find(ee=>ee.id===M.id)&&r.push(M)}return r.slice(0,4)},ve=async e=>{if(!e.trim())return;const i={role:"user",content:e,attachments:[]};ne(l=>[...l,i]),ce(""),Z(!0);const r=ge(e);setTimeout(()=>{var l;return(l=ae.current)==null?void 0:l.scrollIntoView({behavior:"smooth"})},100);try{const I=b.filter(K=>K._type==="product").map(K=>{let re=`- ${K.name}`;return K.code&&(re+=` (M\xE3: ${K.code})`),K.price&&(re+=` - Gi\xE1: ${K.price.replace(/[đ\s]/g,"")}\u0111`),K.category&&(re+=` [${K.category}]`),K.note&&(re+=` (${K.note})`),re}).join(`
`),x=W.slice(-6).map(K=>`${K.role==="user"?"Kh\xE1ch":"AI"}: ${K.content}`).join(`
`),M=x?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${x}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${I}`:I,Q=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:e,context:M,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";ne(K=>[...K,{role:"assistant",content:Q,attachments:r}])}catch(l){console.error("AI Error:",l);const I=e.toLowerCase(),h=b.filter(M=>{const ee=Object.values(M).join(" ").toLowerCase();return I.split(" ").some(Q=>ee.includes(Q))});let x="";h.length>0?(x=`T\xECm th\u1EA5y ${h.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,h.slice(0,5).forEach(M=>{x+=`\u2022 ${M.name}`,M.price&&(x+=` - ${M.price.replace(/[đ\s]/g,"")}\u0111`),M.note&&(x+=` (${M.note})`),x+=`
`}),h.length>5&&(x+=`
...v\xE0 ${h.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):x='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',ne(M=>[...M,{role:"assistant",content:x,attachments:h.slice(0,4)}])}Z(!1),setTimeout(()=>{var l,I;(l=ae.current)==null||l.scrollIntoView({behavior:"smooth"}),(I=we.current)==null||I.focus()},100)};function ke({show:e,product:i,categories:r,onClose:l,onSave:I}){const[h,x]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[M,ee]=useState(!1),[Q,K]=useState(!1),re=useRef(null),fe=z=>window.KTM.money.formatVNDInputDigits(z);useEffect(()=>{if(i)if(x({name:i.name||"",code:i.code||"",price:i.price||"",image:i.image||"",category:i.category||"",note:i.note||"",sort_order:i.sort_order||0}),i.price){const z=window.KTM.money.getDigits(i.price);be(z),x(Ie=>({...Ie,price:fe(z)}))}else be("");else x({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),be("")},[i,e]);const[oe,Se]=React.useState(""),[le,be]=React.useState(""),Je=z=>{const Ie=window.KTM.money.nextPriceInputState(z.target.value,le);be(Ie.digits),x({...h,price:Ie.price})},qe=async(z,Ie=2)=>{const ze=Ie*1024*1024;if(z.size<=ze)return z;try{const Re=await createImageBitmap(z),Fe=document.createElement("canvas");let $e=Re.width,je=Re.height;const Ve=1200;return($e>Ve||je>Ve)&&($e>je?(je=Math.round(je/$e*Ve),$e=Ve):($e=Math.round($e/je*Ve),je=Ve)),Fe.width=$e,Fe.height=je,Fe.getContext("2d").drawImage(Re,0,0,$e,je),Re.close(),new Promise((Be,Qe)=>{Fe.toBlob(Ue=>{Ue?Be(new File([Ue],z.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Qe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Re){throw console.error("Compress error:",Re),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},He=async z=>{var Re;const Ie=z.target.files[0];if(!Ie)return;if(!(Ie.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Ie.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}K(!0);try{const Fe=await qe(Ie),$e=await window.KTM.cloudinary.uploadImage({file:Fe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!$e.secure_url)throw console.error("Cloudinary error:",$e),new Error(((Re=$e.error)==null?void 0:Re.message)||"Upload failed");x(je=>({...je,image:$e.secure_url}))}catch(Fe){console.error("Upload error:",Fe),alert("L\u1ED7i upload \u1EA3nh: "+Fe.message)}K(!1),z.target.value=""},Ee=async z=>{z.preventDefault(),ee(!0),await I(h),ee(!1)};return e?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),i?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:l})),React.createElement("form",{onSubmit:Ee},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:h.name,onChange:z=>x({...h,name:z.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:h.code,onChange:z=>x({...h,code:z.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:h.price,onChange:Je,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:h.category,onChange:z=>x({...h,category:z.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),r.map(z=>React.createElement("option",{key:z,value:z},z)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:h.note,onChange:z=>x({...h,note:z.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},h.image?React.createElement(React.Fragment,null,React.createElement("img",{src:h.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>x({...h,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var z;return(z=re.current)==null?void 0:z.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:re,type:"file",accept:"image/*",className:"d-none",onChange:He}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var z;return(z=re.current)==null?void 0:z.click()},disabled:Q,style:{borderRadius:"10px"}},Q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:h.image,onChange:z=>x({...h,image:z.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:l,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:M,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},M?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const a=(e,i)=>{const r=e._type==="product",l=e._type==="album",I=e._type==="video",h=e.note&&(e.note.toLowerCase().includes("free")||e.note.toLowerCase().includes("gi\u1EA3m")||e.note.toLowerCase().includes("sale"));return F==="grid"?React.createElement("div",{key:e.id||i,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>de({url:e.image,name:e.name,price:e.price,note:e.note,item:e})},e.image?React.createElement("img",{src:e.image,alt:e.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${I?"fa-video":"fa-image"} fa-2x text-muted`})),e.price&&React.createElement("div",{className:"price-overlay"},e.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${r?"product":l?"album":"video"}`},r?"SP":l?"\u1EA2nh":"Video"),h&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},e.name),e.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},e.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:S===e.id+"-img"?"copied":"",onClick:()=>J(e.image,e.id)},React.createElement("i",{className:"fas fa-image"})),e.price&&React.createElement("button",{className:S===e.id+"-price"?"copied":"",onClick:()=>w(e.price.replace(/[đ\s]/g,""),e.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:e.id||i,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${r?"product":l?"album":"video"}`},r?"S\u1EA3n ph\u1EA9m":l?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},e.image?React.createElement("img",{src:e.image,alt:e.name,className:"thumb",loading:"lazy",onClick:()=>de({url:e.image,name:e.name,price:e.price,note:e.note,item:e})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${I?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},e.name),React.createElement("div",{className:"price-row"},e.price&&React.createElement("span",{className:"price"},e.price.replace(/[đ\s]/g,""),"\u0111"),h&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},e.code&&React.createElement("span",{className:"meta-tag"},"#",e.code),e.category&&React.createElement("span",{className:"meta-tag"},e.category),e.note&&React.createElement("span",{className:"meta-tag highlight"},e.note),e.folder&&React.createElement("span",{className:"meta-tag"},e.folder),I&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},r&&React.createElement("button",{onClick:()=>d&&d("orders","create",{productId:e.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),e.price&&React.createElement("button",{className:S===e.id+"-price"?"copied":"",onClick:()=>w(e.price.replace(/[đ\s]/g,""),e.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:S===e.id+"-name"?"copied":"",onClick:()=>w(e.name,e.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),I&&e.youtubeId&&React.createElement("button",{className:S===e.id+"-yt"?"copied":"",onClick:()=>w(`https://www.youtube.com/watch?v=${e.youtubeId}`,e.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),r&&React.createElement("button",{className:"action-edit",onClick:()=>U(e)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Ae(e)},React.createElement("i",{className:"fas fa-trash"}))))},[m,c]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,k.length)," k\u1EBFt qu\u1EA3",X&&$.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),R!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},R==="product"?"S\u1EA3n ph\u1EA9m":R==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${F==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>E("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${F==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>E("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},_?React.createElement("div",null,[...Array(8)].map((e,i)=>React.createElement("div",{key:i,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):k.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',$,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{L(""),De("")}},"Xem t\u1EA5t c\u1EA3")):F==="grid"?React.createElement("div",{className:"product-grid-mobile"},k.map((e,i)=>a(e,i))):React.createElement("div",null,k.map((e,i)=>a(e,i)))),m&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>c(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${R==="all"?"active":""}`,onClick:()=>{n("all"),c(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${R==="product"?"active":""}`,onClick:()=>{n("product"),c(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${R==="album"?"active":""}`,onClick:()=>{n("album"),c(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${R==="video"?"active":""}`,onClick:()=>{n("video"),c(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:X,onChange:e=>N(e.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:j,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:$,onChange:e=>De(e.target.value)}),React.createElement("button",{className:`filter-btn ${m||R!=="all"?"active":""}`,onClick:()=>c(!m)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:se?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>G(!0),onTouchStart:()=>G(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),he&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>G(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},W.map((e,i)=>React.createElement("div",{key:i,className:`mb-3 ${e.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${e.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:e.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},e.content,e.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:S===`chat-${i}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:S===`chat-${i}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(e.content),T(`chat-${i}`),setTimeout(()=>T(null),1500)}},React.createElement("i",{className:`fas ${S===`chat-${i}`?"fa-check":"fa-copy"}`})),e.attachments&&e.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},e.attachments.map((r,l)=>React.createElement("div",{key:l,style:{width:70},className:"text-center"},r.image&&React.createElement("img",{src:r.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>de({url:r.image,name:r.name,price:r.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},r.name),r.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},r.price.replace(/[đ\s]/g,""),"\u0111"))))))),Ne&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:ae})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(e=>React.createElement("button",{key:e,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>ve(e),disabled:Ne,style:{whiteSpace:"nowrap"}},e))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:e=>{e.preventDefault(),ve(q)},className:"chat-input-wrap"},React.createElement("input",{ref:we,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:q,onChange:e=>ce(e.target.value),disabled:Ne}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Ne||!q.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),ue&&React.createElement("div",{className:"preview-modal",onClick:()=>de(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>de(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:e=>e.stopPropagation()},React.createElement("img",{src:ue.url,alt:ue.name})),React.createElement("div",{className:"preview-footer",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"name"},ue.name),ue.price&&React.createElement("div",{className:"price"},ue.price.replace(/[đ\s]/g,""),"\u0111"),ue.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},ue.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:S==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:S==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>J(ue.url,"preview")},React.createElement("i",{className:`fas ${S==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),ue.price&&React.createElement("button",{className:S==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>w(ue.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${S==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(ke,{show:Te,product:Me,categories:A,onClose:()=>{pe(!1),xe(null)},onSave:Ce}),React.createElement("div",{className:`fab-container mobile-only ${se?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{me(!1),pe(!0),xe(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{me(!1),d&&d("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${se?"open":""}`,onClick:()=>me(!se)},React.createElement("i",{className:"fas fa-plus"}))),_e&&s&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>t(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:D.name,onChange:e=>ie({...D,name:e.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:D.code,onChange:e=>ie({...D,code:e.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:D.price,onChange:e=>ie({...D,price:e.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:D.category,onChange:e=>ie({...D,category:e.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Le.map(e=>React.createElement("option",{key:e,value:e},e)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:D.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:e=>ie({...D,note:e.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>t(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:y},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:g,showToast:d}){const[$,L]=useState([]),[k,o]=useState([]),[b,v]=useState(!0),[A,u]=useState(null),[R,P]=useState(!1),[S,T]=useState(null),[F,E]=useState(!1),[_,f]=useState(null),[O,B]=useState(null),[H,p]=useState([]);useEffect(()=>{j()},[]);const j=async(t=null)=>{v(!0);try{const s=t?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${t}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,C=await window.KTM.api.getJSON(s,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");L(Array.isArray(C)?C:[])}catch(s){console.error(s),d("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}v(!1)},X=async t=>{try{const s=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${t}`,"L\u1ED7i t\u1EA3i video");o(Array.isArray(s)?s:[])}catch(s){console.error(s)}},N=async t=>{if(t===0)return;const s=[...$];[s[t-1],s[t]]=[s[t],s[t-1]],L(s),await V(s)},te=async t=>{if(t===$.length-1)return;const s=[...$];[s[t],s[t+1]]=[s[t+1],s[t]],L(s),await V(s)},V=async t=>{try{await Promise.all(t.map((s,C)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${s.id}`,{sortOrder:C},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),d("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(s){d("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),j(O==null?void 0:O.id)}},Y=async t=>{if(t===0)return;const s=[...k];[s[t-1],s[t]]=[s[t],s[t-1]],o(s),await G(s)},he=async t=>{if(t===k.length-1)return;const s=[...k];[s[t],s[t+1]]=[s[t+1],s[t]],o(s),await G(s)},G=async t=>{try{await Promise.all(t.map((s,C)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${s.id}`,{sort_order:C},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),d("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(s){d("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),X(A.id)}},W=()=>{T(null),P(!0)},ne=t=>{T(t),P(!0)},q=async t=>{try{!S&&O&&(t.parent_id=O.id);const s=S?`${API_BASE}/api/video-folders/${S.id}`:`${API_BASE}/api/video-folders`;S?await window.KTM.api.putJSON(s,t,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(s,t,"L\u1ED7i l\u01B0u folder"),d(S?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),P(!1),j(O==null?void 0:O.id)}catch(s){d(s.message,"danger")}},ce=async t=>{const s=t.subfolderCount>0?`X\xF3a folder "${t.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${t.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(s))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${t.id}`,"L\u1ED7i x\xF3a folder"),d("\u0110\xE3 x\xF3a folder","success"),u(null),j(O==null?void 0:O.id)}catch(C){d("L\u1ED7i x\xF3a folder","danger")}},Ne=t=>{t.subfolderCount>0?(p(s=>[...s,t]),B(t),j(t.id)):(u(t),o(t.videos||[]))},Z=t=>{if(t==="root")p([]),B(null),j(null);else if(t){const s=H.findIndex(C=>C.id===t.id);s>=0&&(p(H.slice(0,s+1)),B(t),j(t.id))}else{const s=[...H];s.pop();const C=s[s.length-1]||null;p(s),B(C),j(C==null?void 0:C.id)}},ae=()=>{f(null),E(!0)},we=t=>{f(t),E(!0)},ue=async t=>{try{t.folder_id=A==null?void 0:A.id;const s=_?`${API_BASE}/api/videos/${_.id}`:`${API_BASE}/api/videos`;_?await window.KTM.api.putJSON(s,t,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(s,t,"L\u1ED7i l\u01B0u video"),d(_?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),E(!1),j(),A&&X(A.id)}catch(s){d(s.message,"danger")}},de=async t=>{if(confirm(`X\xF3a video "${t.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${t.id}`,"L\u1ED7i x\xF3a video"),d("\u0110\xE3 x\xF3a video","success"),j(),A&&X(A.id)}catch(s){d("L\u1ED7i x\xF3a video","danger")}},_e=t=>{const s=`https://www.youtube.com/watch?v=${t.youtubeId}`;window.KTM.clipboard.writeText(s).then(()=>{d("\u0110\xE3 copy link!","success")}).catch(()=>{d("Kh\xF4ng th\u1EC3 copy link","danger")})};return A?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>u(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${A.slug==="shorts"?"text-danger":"text-warning"}`}),A.name)),React.createElement("button",{className:"btn btn-warning",onClick:ae},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),k.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},k.map((t,s)=>React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Y(s),disabled:s===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},s+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>he(s),disabled:s===k.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:t.thumb,className:"card-img-top",alt:t.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${t.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:t.title},t.title),React.createElement("small",{className:"text-muted"},t.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>_e(t),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>we(t),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>de(t),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:F,video:_,onClose:()=>E(!1),onSave:ue})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},O&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Z()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),O?O.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:W},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),H.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:t=>{t.preventDefault(),Z("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),H.map((t,s)=>React.createElement("li",{key:t.id,className:`breadcrumb-item ${s===H.length-1?"active":""}`},s===H.length-1?t.name:React.createElement("a",{href:"#",onClick:C=>{C.preventDefault(),Z(t)},className:"text-warning"},t.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),b?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):$.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},O?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:W},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",O?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},$.map((t,s)=>{var C,se,me,Te;return React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:pe=>{pe.stopPropagation(),N(s)},disabled:s===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},s+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:pe=>{pe.stopPropagation(),te(s)},disabled:s===$.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>Ne(t),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${t.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},t.name),React.createElement("p",{className:"text-muted mb-0"},t.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),t.subfolderCount," folder"),t.subfolderCount>0&&(t.videoCount>0||((C=t.videos)==null?void 0:C.length)>0)&&" \u2022 ",(t.videoCount>0||((se=t.videos)==null?void 0:se.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),t.videoCount||((me=t.videos)==null?void 0:me.length)||0," videos"),t.subfolderCount===0&&!t.videoCount&&!((Te=t.videos)!=null&&Te.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:pe=>{pe.stopPropagation(),ne(t)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:pe=>{pe.stopPropagation(),ce(t)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:R,folder:S,onClose:()=>P(!1),onSave:q}))}function VideoFolderModal({show:g,folder:d,onClose:$,onSave:L}){const[k,o]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[b,v]=useState(!1),[A,u]=useState(!1);useEffect(()=>{o(d?{name:d.name||"",description:d.description||"",sortOrder:d.sortOrder||0,coverImage:d.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[d,g]);const R=async S=>{const T=S.target.files[0];if(T){u(!0);try{const F=await window.KTM.cloudinary.uploadImage({file:T,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});F.secure_url&&o(E=>({...E,coverImage:F.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(F){console.error("Cloudinary upload error:",F),alert("L\u1ED7i upload \u1EA3nh: "+(F.message||F))}finally{u(!1)}}},P=async S=>{S.preventDefault(),v(!0),await L(k),v(!1)};return g?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},d?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:P},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:k.name,onChange:S=>o({...k,name:S.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:k.description,onChange:S=>o({...k,description:S.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:k.sortOrder,onChange:S=>o({...k,sortOrder:parseInt(S.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},k.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:k.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>o({...k,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:R,disabled:A}),A&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:k.coverImage,onChange:S=>o({...k,coverImage:S.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:b},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:g}){const[d,$]=useState([]),[L,k]=useState(!0),[o,b]=useState(!1),[v,A]=useState(null),[u,R]=useState(""),[P,S]=useState(""),T=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{F()},[]);const F=async()=>{k(!0);try{const p=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");$(Array.isArray(p)?p:[])}catch(p){console.error(p),g("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}k(!1)},E=()=>{A(null),b(!0)},_=p=>{A(p),b(!0)},f=async p=>{if(!(!p||!p.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:p},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),g(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),F()}catch(j){g("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},O=async p=>{try{const j=v?`${API_BASE}/api/products?id=${v.id}`:`${API_BASE}/api/products`;v?await window.KTM.api.putJSON(j,p,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(j,p,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),g(v?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),b(!1),F()}catch(j){g(j.message,"danger")}},B=async p=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${p.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${p.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),g("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),F()}catch(j){g(j.message,"danger")}},H=d.filter(p=>{const j=!u||p.name.toLowerCase().includes(u.toLowerCase())||p.code&&p.code.toLowerCase().includes(u.toLowerCase()),X=!P||p.category===P;return j&&X});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:E},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:u,onChange:p=>R(p.target.value)})),React.createElement("span",{className:"product-count"},H.length)),React.createElement("select",{className:"form-select",value:P,onChange:p=>S(p.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),T.map(p=>React.createElement("option",{key:p,value:p},p)))),L?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):H.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:E},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},H.map(p=>React.createElement("div",{key:p.id,className:"product-item d-flex align-items-center gap-3"},p.image?React.createElement("img",{src:p.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},p.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},p.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},p.category),p.code&&React.createElement("span",{className:"product-badge bg-secondary"},p.code)),React.createElement("div",{className:"product-price"},p.price?p.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),p.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},p.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>_(p),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>B(p),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:o,product:v,categories:T,onClose:()=>b(!1),onSave:O}))}function ProductModal({show:g,product:d,categories:$,onClose:L,onSave:k}){const[o,b]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[v,A]=useState(!1),[u,R]=useState(!1);useEffect(()=>{b(d?{name:d.name||"",code:d.code||"",price:d.price||"",image:d.image||"",category:d.category||"",note:d.note||"",sort_order:d.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[d,g]);const[P,S]=React.useState(""),T=N=>window.KTM.money.formatVNDInputDigits(N),[F,E]=React.useState(""),_=N=>{const te=window.KTM.money.nextPriceInputState(N.target.value,F);E(te.digits),b({...o,price:te.price})},[f,O]=React.useState("");React.useEffect(()=>{d!=null&&d.image&&O(d.image)},[d]);const B=async N=>{if(!(!N||!N.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:N},"L\u1ED7i x\xF3a \u1EA3nh")}catch(te){console.error("Delete cloudinary image error:",te)}},H=async(N,te=2,V)=>{const Y=te*1024*1024,he=N.type==="image/heic"||N.type==="image/heif"||/\.heic$/i.test(N.name);if(N.size<=Y&&!he)return N;V==null||V("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const G=await createImageBitmap(N);V==null||V("\u0110ang n\xE9n \u1EA3nh...");const W=document.createElement("canvas");let ne=G.width,q=G.height;const ce=1200;return(ne>ce||q>ce)&&(ne>q?(q=Math.round(q/ne*ce),ne=ce):(ne=Math.round(ne/q*ce),q=ce)),W.width=ne,W.height=q,W.getContext("2d").drawImage(G,0,0,ne,q),G.close(),new Promise((Z,ae)=>{W.toBlob(we=>{we?(V==null||V("Ho\xE0n t\u1EA5t!"),Z(new File([we],N.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):ae(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(G){throw console.error("createImageBitmap error:",G),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},p=async N=>{var Y,he;const te=(Y=N.target.files)==null?void 0:Y[0];if(!te)return;if(!(te.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(te.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}R(!0),S("\u0110ang chu\u1EA9n b\u1ECB...");try{const G=(te.size/1024/1024).toFixed(1);S(`File ${G}MB - \u0110ang n\xE9n...`);const W=await H(te,2,ce=>{S(ce)}),ne=(W.size/1024/1024).toFixed(1);S(`\u0110\xE3 n\xE9n: ${ne}MB - \u0110ang upload...`);const q=await window.KTM.cloudinary.uploadImage({file:W,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});q.secure_url?(o.image&&o.image!==f&&B(o.image),b(ce=>({...ce,image:q.secure_url})),S("")):(console.error("Cloudinary error:",q),alert("Upload th\u1EA5t b\u1EA1i: "+(((he=q.error)==null?void 0:he.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),S(""))}catch(G){console.error("Upload error:",G),alert("L\u1ED7i: "+G.message),S("")}R(!1),N.target.value=""},j=()=>{o.image&&(o.image!==f&&B(o.image),b(N=>({...N,image:""})))},X=async N=>{N.preventDefault(),A(!0),f&&o.image&&f!==o.image&&await B(f),f&&!o.image&&await B(f),await k(o),A(!1)};return g?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${d?"fa-edit":"fa-plus-circle"} me-2`}),d?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:X},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},o.image?React.createElement(React.Fragment,null,React.createElement("img",{src:o.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:j,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${u?"fa-spinner fa-spin":"fa-camera"} me-1`}),u?P||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:p,disabled:u,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),u&&P&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},P))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:o.name,onChange:N=>b({...o,name:N.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:o.code,onChange:N=>b({...o,code:N.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:o.price,onChange:_,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:o.category,onChange:N=>b({...o,category:N.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),$.map(N=>React.createElement("option",{key:N,value:N},N)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:o.note,onChange:N=>b({...o,note:N.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:o.image,onChange:N=>b({...o,image:N.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:L,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:v,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:g,video:d,onClose:$,onSave:L}){const[k,o]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[b,v]=useState(!1),[A,u]=useState("");useEffect(()=>{d?(o({title:d.title||"",youtube_url:`https://www.youtube.com/watch?v=${d.youtubeId}`,thumbnail_url:d.thumb||"",sort_order:d.sortOrder||0}),u(d.thumb)):(o({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),u(""))},[d,g]);const R=T=>{const F=T.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return F?F[1]:null},P=T=>{o({...k,youtube_url:T});const F=R(T);F&&u(`https://img.youtube.com/vi/${F}/hqdefault.jpg`)},S=async T=>{T.preventDefault(),v(!0),await L(k),v(!1)};return g?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},d?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:S},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:k.youtube_url,onChange:T=>P(T.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),A&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:A,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:k.title,onChange:T=>o({...k,title:T.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:k.sort_order,onChange:T=>o({...k,sort_order:parseInt(T.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:k.thumbnail_url,onChange:T=>o({...k,thumbnail_url:T.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:b},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[g,d]=useState(!1),[$,L]=useState(""),[k,o]=useState(null),[b,v]=useState("search"),[A,u]=useState(null),[R,P]=useState(""),[S,T]=useState([]),[F,E]=useState(null),[_,f]=useState(!1),[O,B]=useState(null),[H,p]=useState(!0),[j,X]=useState([]),[N,te]=useState(null),[V,Y]=useState([]);useEffect(()=>{const t=localStorage.getItem("ktm_admin_session");if(t)try{const s=JSON.parse(t);s.expiry>Date.now()?(d(!0),o(s.user)):localStorage.removeItem("ktm_admin_session")}catch(s){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{g&&q()},[g]);const he=async(t,s)=>{L("");try{const C=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:t,password:s},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),se={user:C.user,token:C.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(se)),o(C.user),d(!0)}catch(C){L(C.message)}},G=()=>{localStorage.removeItem("ktm_admin_session"),d(!1),o(null),T([]),E(null)},W=(t,s="success")=>{const C=Date.now();X(se=>[...se,{id:C,message:t,type:s}])},ne=t=>{X(s=>s.filter(C=>C.id!==t))},q=async(t=null)=>{p(!0);try{const s=t?`${API_BASE}/api/albums?parent_id=${t}`:`${API_BASE}/api/albums?parent_id=root`,C=await window.KTM.api.getJSON(s,"L\u1ED7i t\u1EA3i danh s\xE1ch album");T(Array.isArray(C)?C:[])}catch(s){console.error(s),W("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}p(!1)},ce=()=>{B(null),f(!0)},Ne=t=>{B(t),f(!0)},Z=async t=>{try{const s=O&&O.uuid;!s&&N&&(t.parent_id=N.uuid);const C=s?`${API_BASE}/api/albums/${O.uuid||O.id}`:`${API_BASE}/api/albums`;s?await window.KTM.api.putJSON(C,t,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(C,t,"L\u1ED7i t\u1EA1o"),W(s?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),f(!1),q(N==null?void 0:N.uuid)}catch(s){W(s.message,"danger")}},ae=t=>{E(t)},we=t=>{if(t==="root")Y([]),te(null),q(null);else if(t){const s=V.findIndex(C=>C.uuid===t.uuid);s>=0&&(Y(V.slice(0,s+1)),te(t),q(t.uuid))}else{const s=[...V];s.pop();const C=s[s.length-1]||null;Y(s),te(C),q(C==null?void 0:C.uuid)}},ue=async t=>{const s=`X\xF3a folder "${t.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(s))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${t.uuid||t.id}`,"L\u1ED7i x\xF3a album"),W("\u0110\xE3 x\xF3a","success"),q(N==null?void 0:N.uuid)}catch(C){W("L\u1ED7i x\xF3a album","danger")}};if(!g)return React.createElement(LoginPage,{onLogin:he,error:$});const de=()=>{const t=new Date,s=t.getFullYear(),C=String(t.getMonth()+1).padStart(2,"0");return`${s}-${C}`};function _e(){const[t,s]=useState(de()),[C,se]=useState(!0),[me,Te]=useState([]),{parseMoney:pe,parseShipFeeFromNote:Me,getShipFeeForItems:xe,formatNumber:D,formatVND:ie}=window.KTM.money,Le=async()=>{se(!0);try{const y=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(t)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA");Te(Array.isArray(y)?y:[])}catch(y){console.error("Load stats error:",y),Te([])}finally{se(!1)}};useEffect(()=>{Le()},[t]);const U=React.useMemo(()=>{var r;const y={pending:0,processing:0,done:0,paid:0,other:0};let Ae=0,Ce=0,Oe=0,Ke=0,ye=0;const Pe=l=>l.customer_id||l.phone||"unknown",De=l=>window.KTM.orders.getOrderItems(l),n=new Map,w=new Map,J=new Map;for(const l of me){const I=De(l);let h=0,x=0;for(const le of I){const be=Number((le==null?void 0:le.quantity)||0)||0,Je=pe(le==null?void 0:le.product_price),qe=be*Je;h+=be,x+=qe;const He=(le==null?void 0:le.product_id)||"unknown",Ee=n.get(He)||{product_id:He,product_name:(le==null?void 0:le.product_name)||"\u2014",product_code:(le==null?void 0:le.product_code)||"",orders:0,quantity:0,revenue:0};Ee.orders+=1,Ee.quantity+=be,Ee.revenue+=qe,n.set(He,Ee)}const M=xe(I),ee=Number((r=l==null?void 0:l.adjustment_amount)!=null?r:0)||0,Q=x+(M.found?M.fee:0)+ee,K=x+ee;Ae+=h,Ce+=Q,Ke+=K;const re=l.status==="done"||l.status==="paid";l.status==="pending"?y.pending+=1:l.status==="processing"?y.processing+=1:l.status==="paid"?(y.paid+=1,y.done+=1,Oe+=Q,ye+=K):l.status==="done"?(y.done+=1,Oe+=Q,ye+=K):y.other+=1;const fe=Pe(l),oe=w.get(fe)||{key:fe,customer_name:l.customer_name||"",phone:l.phone||"",orders:0,quantity:0,revenue:0};oe.orders+=1,oe.quantity+=h,oe.revenue+=Q,!oe.customer_name&&l.customer_name&&(oe.customer_name=l.customer_name),!oe.phone&&l.phone&&(oe.phone=l.phone),w.set(fe,oe);const Se=l.created_at?new Date(l.created_at):null;if(Se&&!Number.isNaN(Se.getTime())){const le=`${Se.getFullYear()}-${String(Se.getMonth()+1).padStart(2,"0")}-${String(Se.getDate()).padStart(2,"0")}`,be=J.get(le)||{day:le,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};be.orders+=1,be.quantity+=h,be.revenue+=Q,re&&(be.doneOrders+=1,be.doneRevenue+=Q),J.set(le,be)}}const ge=Array.from(n.values()).sort((l,I)=>I.revenue-l.revenue),ve=Array.from(w.values()).sort((l,I)=>I.revenue-l.revenue),ke=Array.from(J.values()).sort((l,I)=>l.day.localeCompare(I.day)),a=w.size,m=me.length?Math.round(Ce/me.length):0,c=me.length?Ae/me.length:0,e=Math.round(ye*.05),i=Math.round(Ke*.05);return{statusCounts:y,totalQty:Ae,totalRevenue:Ce,doneRevenue:Oe,tempCommission:e,tempCommissionAll:i,products:ge,customers:ve,days:ke,uniqueCustomers:a,avgOrderValue:m,avgQtyPerOrder:c}},[me,t]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:C}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:Le,disabled:C},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:t,onChange:y=>s(y.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),D(me.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),D(U.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),D(U.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",D(U.statusCounts.paid),"/",D(U.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},D(me.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ie(U.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ie(U.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ie(U.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ie(U.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",U.avgQtyPerOrder?U.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},D(U.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},D(U.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},D(U.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},D(U.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},D(U.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,D(U.statusCounts.pending)),React.createElement("td",null,D(U.statusCounts.processing)),React.createElement("td",null,D(U.statusCounts.done)),React.createElement("td",null,D(U.statusCounts.paid)),React.createElement("td",null,D(U.statusCounts.other)),React.createElement("td",null,D(U.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},U.products.slice(0,10).map(y=>React.createElement("div",{key:y.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},y.product_name),React.createElement("div",{className:"text-muted small text-truncate"},y.product_code?`#${y.product_code} \u2022 `:"",D(y.orders)," \u0111\u01A1n \u2022 ",D(y.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},ie(y.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,U.products.slice(0,10).map(y=>React.createElement("tr",{key:y.product_id},React.createElement("td",null,y.product_name),React.createElement("td",null,y.product_code||"\u2014"),React.createElement("td",null,D(y.orders)),React.createElement("td",null,D(y.quantity)),React.createElement("td",{className:"fw-semibold"},ie(y.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},U.customers.slice(0,10).map(y=>React.createElement("div",{key:y.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},y.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},y.phone||"\u2014"," \u2022 ",D(y.orders)," \u0111\u01A1n \u2022 ",D(y.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},ie(y.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,U.customers.slice(0,10).map(y=>React.createElement("tr",{key:y.key},React.createElement("td",null,y.customer_name||"\u2014"),React.createElement("td",null,y.phone||"\u2014"),React.createElement("td",null,D(y.orders)),React.createElement("td",null,D(y.quantity)),React.createElement("td",{className:"fw-semibold"},ie(y.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},U.days.map(y=>React.createElement("div",{key:y.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},y.day),React.createElement("div",{className:"text-muted small"},D(y.orders)," \u0111\u01A1n \u2022 ",D(y.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",D(y.doneOrders)," \u2022 ",ie(y.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},ie(y.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,U.days.map(y=>React.createElement("tr",{key:y.day},React.createElement("td",null,y.day),React.createElement("td",null,D(y.orders)),React.createElement("td",null,D(y.quantity)),React.createElement("td",{className:"fw-semibold"},ie(y.revenue)),React.createElement("td",null,D(y.doneOrders)),React.createElement("td",{className:"fw-semibold"},ie(y.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:b,onMenuChange:t=>{v(t),t==="albums"&&(te(null),Y([]),q(null))},onLogout:G,currentUser:k}),React.createElement("div",{className:"main-content"},b==="albums"&&!F&&React.createElement(AlbumList,{albums:S,loading:H,currentFolder:N,breadcrumb:V,onSelect:ae,onCreate:ce,onEdit:Ne,onDelete:ue,onBack:we}),b==="search"&&React.createElement(SearchCenter,{showToast:W,onNavigate:(t,s,C)=>{v(t),t==="orders"&&s==="create"&&(u(Date.now()),P((C==null?void 0:C.productId)||""))}}),b==="albums"&&F&&React.createElement(AlbumDetail,{album:F,parentAlbum:V.length>0?V[V.length-1]:null,onBack:()=>{if(F.parentId){const t=V.findIndex(s=>s.uuid===F.parentId);t>=0?E(V[t]):E(null)}else E(null)},onRefresh:()=>q(N==null?void 0:N.uuid),showToast:W,onNavigateToFolder:t=>{Y(s=>[...s,F]),E(t)},onEditSubfolder:t=>{B(t),f(!0)}}),b==="videos"&&React.createElement(VideoList,{showToast:W}),b==="products"&&React.createElement(ProductManager,{showToast:W}),b==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:A,autoOpenCreateProductId:R,showToast:W}),b==="stats"&&React.createElement(_e,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${b==="search"?"active":""}`,onClick:t=>{t.preventDefault(),v("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${b==="albums"?"active":""}`,onClick:t=>{t.preventDefault(),v("albums"),E(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${b==="videos"?"active":""}`,onClick:t=>{t.preventDefault(),v("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${b==="products"?"active":""}`,onClick:t=>{t.preventDefault(),v("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${b==="orders"?"active":""}`,onClick:t=>{t.preventDefault(),v("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${b==="stats"?"active":""}`,onClick:t=>{t.preventDefault(),v("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:_,album:O,parentId:N==null?void 0:N.uuid,onClose:()=>f(!1),onSave:Z}),React.createElement("div",{className:"toast-container"},j.map(t=>React.createElement(Toast,{key:t.id,message:t.message,type:t.type,onClose:()=>ne(t.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:g,autoOpenCreateProductId:d,showToast:$}){const[L,k]=useState([]),[o,b]=useState(!0),[v,A]=useState(!1),[u,R]=useState(null),[P,S]=useState(""),[T,F]=useState(!1),[E,_]=useState(null),[f,O]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[B,H]=useState([""]),[p,j]=useState(null),X=useRef({}),[N,te]=useState([]),[V,Y]=useState(null),he=useRef(null),G=useRef(null),W=useRef(0),ne=useRef(null),q=useRef(0),ce=3;useEffect(()=>{const a=m=>{var e;if(p==null)return;const c=(e=X.current)==null?void 0:e[p];c&&!c.contains(m.target)&&j(null)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[p]);const Ne=a=>window.KTM.money.parseMoney(a),Z=a=>window.KTM.money.parseSignedMoney(a),ae=a=>window.KTM.money.formatVND(a),we=a=>window.KTM.money.parseShipFeeFromNote(a),ue=a=>window.KTM.phone.isValid(a),de=a=>window.KTM.phone.normalize(a),_e=async a=>{const m=de(a);if(!m)return;const c=++W.current;_({status:"loading",phone:m});try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(m)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(W.current!==c)return;if(e&&e.exists&&e.customer){_({status:"found",phone:m,customer:e.customer}),O(i=>de(i.phone)!==m?i:{...i,customer_name:e.customer.name||i.customer_name,address:e.customer.address||i.address});return}_({status:"not-found",phone:m})}catch(e){if(W.current!==c)return;console.error("Customer lookup error:",e),_({status:"error",phone:m})}},t=a=>{const m=de(a);if(O(e=>({...e,phone:m})),G.current&&(clearTimeout(G.current),G.current=null),m.length<ce){_(null);return}G.current=setTimeout(()=>{_e(m)},350)},s=()=>{const a=de(f.phone);a.length<ce||_e(a)};useEffect(()=>(T?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[T]);const C=Array.isArray(f.items)?f.items.length:0;useEffect(()=>{if(!T){q.current=C;return}C>q.current&&setTimeout(()=>{const a=ne.current;a&&a.scrollTo({top:a.scrollHeight,behavior:"smooth"})},0),q.current=C},[T,C]),useEffect(()=>()=>{G.current&&(clearTimeout(G.current),G.current=null)},[]),useEffect(()=>{Me()},[]),useEffect(()=>{xe()},[P]),useEffect(()=>{g&&he.current!==g&&(he.current=g,Le(d))},[g]);const se=a=>a==="pending"?"Ch\u1EDD x\u1EED l\xFD":a==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":a==="done"?"Ho\xE0n th\xE0nh":a==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":a||"",me=a=>a==="pending"?"bg-secondary":a==="processing"?"bg-warning text-dark":a==="done"?"bg-success":a==="paid"?"bg-primary":"bg-light text-dark",Te=React.useMemo(()=>window.KTM.orders.sortOrders(L),[L]),pe=a=>window.KTM.date.formatDateTime(a),Me=async()=>{try{const a=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");te(Array.isArray(a)?a:[])}catch(a){console.error("Load products error:",a),te([])}},xe=async()=>{b(!0);try{let a=`${API_BASE}/api/orders`;P&&(a+=`?month=${P}`);const m=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");k(Array.isArray(m)?m:[])}catch(a){console.error("Load orders error:",a),k([])}finally{b(!1)}},D=async()=>{const a=de(f.phone),c=(Array.isArray(f.items)?f.items:[]).map(e=>{var i;return{product_id:(e==null?void 0:e.product_id)||"",quantity:Number((i=e==null?void 0:e.quantity)!=null?i:1)}}).filter(e=>e.product_id&&Number.isFinite(e.quantity)&&e.quantity>0);if(!f.customer_name||!a||c.length===0){alert("Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c");return}if(!ue(a)){alert("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)");return}A(!0);try{const e=V?`${API_BASE}/api/orders/${V}`:`${API_BASE}/api/orders`,i=c[0],r={customer_name:f.customer_name,phone:a,address:f.address,adjustment_amount:Z(f.adjustment_amount),adjustment_note:(f.adjustment_note||"").trim(),product_id:i.product_id,quantity:i.quantity,status:f.status,items:c,...V?{id:V}:{}};V?await window.KTM.api.putJSON(e,r,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng"):await window.KTM.api.postJSON(e,r,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng"),O({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Y(null),F(!1),xe()}catch(e){console.error(e),typeof $=="function"?$(e.message,"danger"):alert(e.message);return}finally{A(!1)}},ie=a=>{var c;Y(a.id);const m=Array.isArray(a.items)&&a.items.length?a.items.map(e=>{var i;return{product_id:(e==null?void 0:e.product_id)||"",quantity:Number((i=e==null?void 0:e.quantity)!=null?i:1)||1}}).filter(e=>e.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1}];O({customer_name:a.customer_name||"",phone:de(a.phone||""),address:a.address||"",items:m.length?m:[{product_id:"",quantity:1}],adjustment_amount:Number((c=a==null?void 0:a.adjustment_amount)!=null?c:0)||0,adjustment_note:(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),H(new Array(m.length?m.length:1).fill("")),_(null),F(!0),a.phone&&_e(de(a.phone))};function Le(a){Y(null),O({customer_name:"",phone:"",address:"",items:[{product_id:a||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),H([""]),_(null),F(!0)}const U=()=>{v||(F(!1),Y(null),O({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),H([""]),j(null),_(null))},y=a=>{if(!a)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const m=String(a),c=N.find(e=>String(e==null?void 0:e.id)===m);return c?`${c.name}${c.code?` (${c.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Ae=a=>{const m=String(B[a]||"").trim().toLowerCase();return m?N.filter(c=>{const e=String((c==null?void 0:c.name)||"").toLowerCase(),i=String((c==null?void 0:c.code)||"").toLowerCase();return e.includes(m)||i.includes(m)}):N},Ce=a=>{if(!a)return null;const m=String(a);return N.find(c=>String(c==null?void 0:c.id)===m)||null},Oe=a=>window.KTM.orders.getOrderItems(a),Ke=a=>window.KTM.orders.getOrderTotalQty(a),ye=a=>window.KTM.orders.getOrderProductSummary(a,Ce),Pe=a=>window.KTM.orders.getOrderItemRows(a,Ce),De=a=>window.KTM.orders.getOrderAdjustmentMoney(a),n=a=>{var x;const m=Oe(a),c=Pe(a),e=ge(m),i=J(m),r=i.fee,l=De(a),I=e+r+l,h=[];if(h.push(`\u0110\u01A0N H\xC0NG #${(x=a==null?void 0:a.id)!=null?x:""}`.trim()),a!=null&&a.customer_name&&h.push(`Kh\xE1ch: ${a.customer_name}`),a!=null&&a.phone&&h.push(`S\u0110T: ${a.phone}`),a!=null&&a.address&&h.push(`\u0110\u1ECBa ch\u1EC9: ${a.address}`),a!=null&&a.status&&h.push(`Tr\u1EA1ng th\xE1i: ${se(a.status)}`),a!=null&&a.created_at&&h.push(`Th\u1EDDi gian: ${pe(a.created_at)}`),h.push(""),h.push("S\u1EA3n ph\u1EA9m:"),c.length)for(const M of c)h.push(`- ${M.name} x${M.qty}`);else{const M=ye(a);M&&M!=="\u2014"&&h.push(`- ${M}`)}return h.push(""),h.push(`T\u1EA1m t\xEDnh: ${ae(e)}`),h.push(`Ship: ${ae(i.found?r:0)}`),l!==0&&h.push(`\u0110i\u1EC1u ch\u1EC9nh: ${ae(l)}`),a!=null&&a.adjustment_note&&h.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${a.adjustment_note}`),h.push(`T\u1ED5ng: ${ae(I)}`),h.filter(Boolean).join(`
`)},w=async a=>{try{const m=n(a);await window.KTM.clipboard.writeText(m),typeof $=="function"?$("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(m){console.error(m),typeof $=="function"?$("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},J=a=>window.KTM.orders.getOrderShipInfo(a,Ce),ge=a=>window.KTM.orders.getItemsSubtotal(a,Ce),ve=a=>window.KTM.orders.getOrderTotalMoney(a,Ce),ke=async a=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){R(a);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${a}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),xe()}catch(m){console.error(m),typeof $=="function"?$(m.message,"danger"):alert(m.message)}finally{R(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:o&&!T||v||!!u}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Le,disabled:v||!!u},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:P,onChange:a=>S(a.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),P&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{S("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:o},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:xe,disabled:o},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},L.length," \u0111\u01A1n")),o?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):L.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Te.map(a=>React.createElement("div",{key:a.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},a.customer_name),React.createElement("div",{className:"text-muted small"},a.phone),a.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},a.address)),React.createElement("span",{className:`badge ${me(a.status)}`},se(a.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const m=Pe(a);return m.length?React.createElement("div",{className:"mt-1"},m.map((c,e)=>React.createElement("div",{key:e,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},c.name),React.createElement("div",{className:"text-muted",style:{flexShrink:0}},"x",c.qty)))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},ye(a))})()),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},Ke(a))),(De(a)!==0||((a==null?void 0:a.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ae(De(a))),((a==null?void 0:a.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(a.adjustment_note||"").trim(),")"):null),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},ae(ve(a)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",pe(a.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>ie(a),disabled:v||!!u},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>w(a),disabled:v||!!u},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>ke(a.id),disabled:v||u===a.id},u===a.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,Te.map(a=>React.createElement("tr",{key:a.id},React.createElement("td",null,a.customer_name),React.createElement("td",null,a.phone),React.createElement("td",null,ye(a)),React.createElement("td",null,Ke(a)),React.createElement("td",{className:"fw-semibold"},ae(ve(a))),React.createElement("td",null,React.createElement("span",{className:`badge ${me(a.status)}`},se(a.status))),React.createElement("td",null,pe(a.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>ie(a),disabled:v||!!u},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>w(a),disabled:v||!!u},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>ke(a.id),disabled:v||u===a.id},u===a.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),T&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),V?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:U})),React.createElement("form",{onSubmit:a=>{a.preventDefault(),D()}},React.createElement("div",{className:"modal-body",ref:ne},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:f.customer_name,onChange:a=>O({...f,customer_name:a.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",value:f.phone,onChange:a=>t(a.target.value),onBlur:s,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),(E==null?void 0:E.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(E==null?void 0:E.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(E==null?void 0:E.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(E==null?void 0:E.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:f.status,onChange:a=>O({...f,status:a.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:f.address,onChange:a=>O({...f,address:a.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:f.adjustment_amount,onChange:a=>O({...f,adjustment_amount:a.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm.")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:f.adjustment_note,onChange:a=>O({...f,adjustment_note:a.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{O(a=>({...a,items:[...Array.isArray(a.items)?a.items:[],{product_id:"",quantity:1}]})),H(a=>[...Array.isArray(a)?a:[],""])},disabled:v},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(f.items)?f.items:[{product_id:"",quantity:1}]).map((a,m)=>React.createElement("div",{key:m,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:c=>{X.current[m]=c}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{j(c=>c===m?null:m),setTimeout(()=>{const c=document.getElementById(`order-product-search-${m}`);c&&c.focus()},0)}},React.createElement("span",{className:a.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},y(a.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),p===m&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${m}`,className:"form-control",value:B[m]||"",onChange:c=>{const e=c.target.value;H(i=>{const r=Array.isArray(i)?[...i]:[];return r[m]=e,r})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),Ae(m).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):Ae(m).map(c=>React.createElement("button",{key:c.id,type:"button",className:"dropdown-item",onClick:()=>{const e=String(c.id);O(i=>{const r=Array.isArray(i.items)?[...i.items]:[];return r[m]={...r[m]||{quantity:1},product_id:e},{...i,items:r}}),j(null)}},c.name,c.code?` (${c.code})`:""))),React.createElement("select",{className:"form-select",value:a.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),N.map(c=>React.createElement("option",{key:c.id,value:c.id},c.name))))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:a.quantity,onChange:c=>{const e=c.target.value;O(i=>{const r=Array.isArray(i.items)?[...i.items]:[];return r[m]={...r[m]||{product_id:""},quantity:e},{...i,items:r}})},min:"1",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{O(c=>{const e=Array.isArray(c.items)?[...c.items]:[];return e.splice(m,1),{...c,items:e.length?e:[{product_id:"",quantity:1}]}}),H(c=>{const e=Array.isArray(c)?[...c]:[];return e.splice(m,1),e.length?e:[""]}),j(c=>c==null?c:c===m?null:c>m?c-1:c)},disabled:v||(Array.isArray(f.items)?f.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const m=(Array.isArray(f.items)?f.items:[]).filter(l=>l==null?void 0:l.product_id),c=ge(m),e=J(m),i=Z(f.adjustment_amount),r=c+(e.found?e.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ae(c))),e.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ae(e.fee))),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ae(i))),(f.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(f.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ae(r)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:U,disabled:v,style:{borderRadius:10}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:v,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

