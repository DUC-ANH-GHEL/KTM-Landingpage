const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:y,error:p}){const[T,A]=useState(""),[M,r]=useState(""),[N,x]=useState(!1),[R,g]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),p&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),p),React.createElement("form",{onSubmit:async P=>{P.preventDefault(),x(!0),await y(T,M),x(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:T,onChange:P=>A(P.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:R?"text":"password",className:"form-control",value:M,onChange:P=>r(P.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>g(!R)},React.createElement("i",{className:`fas fa-eye${R?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:N},N?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:y,type:p,onClose:T}){return useEffect(()=>{const A=setTimeout(T,3e3);return()=>clearTimeout(A)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${p} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},y),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:T})))}function Loading({show:y}){return y?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:y,onMenuChange:p,onLogout:T,currentUser:A}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(r=>React.createElement("a",{key:r.id,href:"#",className:`nav-link ${y===r.id?"active":""} ${r.disabled?"opacity-50":""} ${r.highlight?"text-warning":""}`,onClick:N=>{N.preventDefault(),r.disabled||p(r.id)}},React.createElement("i",{className:`fas ${r.icon}`})," ",r.label,r.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),r.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),T&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:T,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:y,onSelect:p,onCreate:T,onEdit:A,onDelete:M,loading:r,currentFolder:N,onBack:x,breadcrumb:R}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},N&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:x},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),N?N.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:T},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),R&&R.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:g=>{g.preventDefault(),x("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),R.map((g,q)=>React.createElement("li",{key:g.id,className:`breadcrumb-item ${q===R.length-1?"active":""}`},q===R.length-1?g.title:React.createElement("a",{href:"#",onClick:P=>{P.preventDefault(),x(g)},className:"text-warning"},g.title))))),r?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):y.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},N?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},y.map(g=>React.createElement("div",{key:g.uuid||g.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>p(g)},g.cover?React.createElement("img",{src:g.cover,className:"album-cover",alt:g.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},g.title),React.createElement("small",{className:"text-muted"},g.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),g.subfolderCount),g.subfolderCount>0&&g.count>0&&" \u2022 ",g.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),g.count),g.subfolderCount===0&&g.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:q=>{q.stopPropagation(),A(g)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:q=>{q.stopPropagation(),M(g)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:y,album:p,onClose:T,onSave:A,parentId:M}){const[r,N]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[x,R]=useState(!1),[g,q]=useState(!1),P=useRef(null);useEffect(()=>{N(p?{slug:p.id||"",title:p.title||"",description:p.description||"",cover_url:p.cover||"",parent_id:p.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:M||null})},[p,y,M]);const I=async O=>{O.preventDefault(),R(!0),await A(r),R(!1)},L=O=>O.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),H=async O=>{const B=O.type==="image/heic"||O.type==="image/heif"||/\.heic$/i.test(O.name);if(O.size<=2097152&&!B)return O;try{const d=await createImageBitmap(O),J=document.createElement("canvas");let f=d.width,V=d.height;const ee=800;return(f>ee||V>ee)&&(f>V?(V=Math.round(V/f*ee),f=ee):(f=Math.round(f/V*ee),V=ee)),J.width=f,J.height=V,J.getContext("2d").drawImage(d,0,0,f,V),d.close(),new Promise((le,U)=>{J.toBlob(oe=>{oe?le(new File([oe],O.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):U(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(d){throw console.error("Compress cover error:",d),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},W=async O=>{var d;const Q=O.target.files[0];if(!Q)return;if(!(Q.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Q.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}q(!0);try{const J=await H(Q),f=await window.KTM.cloudinary.uploadImage({file:J,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!f.secure_url)throw console.error("Cloudinary error:",f),new Error(((d=f.error)==null?void 0:d.message)||"Upload failed");N(V=>({...V,cover_url:f.secure_url}))}catch(J){console.error("Cover upload error:",J),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+J.message)}q(!1),O.target.value=""};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},p?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:I},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:r.title,onChange:O=>N({...r,title:O.target.value,slug:r.slug||L(O.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:r.slug,onChange:O=>N({...r,slug:O.target.value}),required:!0,disabled:!!p}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:r.description,onChange:O=>N({...r,description:O.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},r.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:r.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>N(O=>({...O,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:P,type:"file",accept:"image/*",className:"d-none",onChange:W}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var O;return(O=P.current)==null?void 0:O.click()},disabled:g},g?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:r.cover_url,onChange:O=>N({...r,cover_url:O.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:T},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:x||g},x?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:y,allAlbums:p,currentAlbumId:T,targetAlbum:A,onSelect:M,level:r=0}){const[N,x]=useState(!0),R=y.uuid||y.id,g=R===T,q=A===R,P=p.filter(L=>L.parentId===R),I=P.length>0;return React.createElement("div",{style:{marginLeft:r*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${q?"bg-info text-white":g?"bg-light text-muted":"hover-bg"}`,style:{cursor:g?"not-allowed":"pointer",opacity:g?.5:1,transition:"background 0.2s"},onClick:()=>!g&&M(R)},I&&React.createElement("i",{className:`fas fa-chevron-${N?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:L=>{L.stopPropagation(),x(!N)}}),!I&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${q?"-open":""} me-2 ${q?"":"text-warning"}`}),React.createElement("span",{className:"small"},y.title),g&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),y.count>0&&!g&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},y.count)),N&&I&&React.createElement("div",null,P.map(L=>React.createElement(FolderTreeItem,{key:L.uuid||L.id,folder:L,allAlbums:p,currentAlbumId:T,targetAlbum:A,onSelect:M,level:r+1}))))}function AlbumDetail({album:y,onBack:p,onRefresh:T,showToast:A,onNavigateToFolder:M,onEditSubfolder:r,parentAlbum:N}){const[x,R]=useState([]),[g,q]=useState([]),[P,I]=useState(!0),[L,H]=useState(!1),[W,O]=useState(""),[Q,B]=useState([]),[d,J]=useState([]),[f,V]=useState({}),[ee,k]=useState(null),[le,U]=useState(!1),[oe,ae]=useState(""),[se,te]=useState(!1),ne=useRef(null),G=useRef(null),[he,Ce]=useState(!1),[ie,Ne]=useState([]),[$e,ke]=useState([]),[be,pe]=useState(""),[t,i]=useState(!1),v=async(l,_=2)=>{const Y=_*1024*1024,Te=l.type==="image/heic"||l.type==="image/heif"||/\.heic$/i.test(l.name);if(l.size<=Y&&!Te)return l;try{const we=await createImageBitmap(l),fe=document.createElement("canvas");let Se=we.width,Le=we.height;const je=1200;return(Se>je||Le>je)&&(Se>Le?(Le=Math.round(Le/Se*je),Se=je):(Se=Math.round(Se/Le*je),Le=je)),fe.width=Se,fe.height=Le,fe.getContext("2d").drawImage(we,0,0,Se,Le),we.close(),new Promise((Oe,Je)=>{fe.toBlob(z=>{z?Oe(new File([z],l.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Je(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(we){throw console.error("Compress error:",we),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{de(),ye()},[y.id,y.uuid]);const de=async()=>{I(!0);try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");R(l.images||[]);const _=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");q(Array.isArray(_)?_:[])}catch(l){console.error(l),A("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}I(!1)},ye=async()=>{try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");ke(Array.isArray(l)?l:[])}catch(l){console.error("Error loading albums:",l)}},Ee=l=>{Ne(_=>_.includes(l)?_.filter(Y=>Y!==l):[..._,l])},ge=async()=>{if(!be||ie.length===0){A("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}i(!0);let l=0;for(const _ of ie)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${_}`,{album_id:be},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),l++}catch(Y){console.error("Move error:",Y)}i(!1),Ce(!1),Ne([]),pe(""),l>0?(A("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),de(),T()):A("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[De,Re]=useState(!1),E=async()=>{if(ie.length===0||!confirm(`X\xF3a ${ie.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Re(!0);let l=0;for(const _ of ie)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${_}`,"L\u1ED7i x\xF3a \u1EA3nh"),l++}catch(Y){console.error("Delete error:",Y)}Re(!1),Ne([]),l>0?(A(`\u0110\xE3 x\xF3a ${l} \u1EA3nh!`,"success"),de(),T()):A("X\xF3a th\u1EA5t b\u1EA1i","danger")},me=()=>{ie.length===x.length?Ne([]):Ne(x.map(l=>l.id))},ze=async()=>{if(oe.trim()){te(!0);try{const l=oe.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:l+"-"+Date.now(),title:oe,parent_id:y.uuid||y.id},"L\u1ED7i t\u1EA1o folder"),A("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),ae(""),U(!1),de(),T()}catch(l){A(l.message,"danger")}te(!1)}},Z=async l=>{if(confirm(`X\xF3a folder "${l.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${l.uuid||l.id}`,"L\u1ED7i x\xF3a folder"),A("\u0110\xE3 x\xF3a folder","success"),de(),T()}catch(_){A("L\u1ED7i x\xF3a folder","danger")}},w=l=>{const _=Array.from(l).filter(Y=>Y.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Y.name));B(Y=>[...Y,..._]),_.forEach(Y=>{const Te=new FileReader;Te.onload=we=>{J(fe=>[...fe,{file:Y,preview:we.target.result}])},Te.readAsDataURL(Y)})},Ve=l=>{B(_=>_.filter((Y,Te)=>Te!==l)),J(_=>_.filter((Y,Te)=>Te!==l))},qe=async l=>{var Y;const _=await window.KTM.cloudinary.uploadImage({file:l,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${y.id}`});if(!_.secure_url)throw console.error("Cloudinary error:",_),new Error(((Y=_.error)==null?void 0:Y.message)||"Upload failed");return _},He=async()=>{if(Q.length===0)return;H(!0);let l=0;for(let _=0;_<Q.length;_++)try{O(`\u0110ang x\u1EED l\xFD ${_+1}/${Q.length}...`);const Y=await v(Q[_],2);O(`\u0110ang upload ${_+1}/${Q.length}...`);const Te=await qe(Y);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${y.id}`,{url:Te.secure_url,caption:f[_]||Q[_].name.replace(/\.[^/.]+$/,""),sort_order:x.length+_},"L\u1ED7i l\u01B0u \u1EA3nh"),l++}catch(Y){console.error("Upload error:",Y)}H(!1),O(""),B([]),J([]),V({}),l>0?(A(`\u0110\xE3 upload ${l} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),de(),T()):A("Upload th\u1EA5t b\u1EA1i","danger")},Be=async(l,_)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${l}`,"L\u1ED7i x\xF3a \u1EA3nh"),A("\u0110\xE3 x\xF3a \u1EA3nh","success"),de(),T()}catch(Y){A("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Ie=l=>{var _;l.preventDefault(),(_=G.current)==null||_.classList.add("dragover")},Ae=()=>{var l;(l=G.current)==null||l.classList.remove("dragover")},Pe=l=>{var _;l.preventDefault(),(_=G.current)==null||_.classList.remove("dragover"),w(l.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:p},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},y.title),React.createElement("small",{className:"text-muted"},g.length>0&&React.createElement("span",null,g.length," folder \u2022 "),x.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>U(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),le&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:oe,onChange:l=>ae(l.target.value),onKeyPress:l=>l.key==="Enter"&&ze(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:ze,disabled:se||!oe.trim()},se?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{U(!1),ae("")}},"H\u1EE7y")))),g.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},g.map(l=>React.createElement("div",{key:l.uuid||l.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>M&&M(l)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},l.title),React.createElement("small",{className:"text-muted"},l.subfolderCount>0&&React.createElement("span",null,l.subfolderCount," folder"),l.subfolderCount>0&&l.count>0&&" \u2022 ",l.count>0&&React.createElement("span",null,l.count," \u1EA3nh"),l.subfolderCount===0&&l.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:_=>{_.stopPropagation(),r&&r(l)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:_=>{_.stopPropagation(),Z(l)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:G,className:"upload-zone",onClick:()=>{var l;return(l=ne.current)==null?void 0:l.click()},onDragOver:Ie,onDragLeave:Ae,onDrop:Pe},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:ne,type:"file",multiple:!0,accept:"image/*",onChange:l=>w(l.target.files)})),d.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},d.map((l,_)=>React.createElement("div",{key:_,className:"upload-preview-item"},React.createElement("img",{src:l.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Ve(_)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:He,disabled:L},L?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),W||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Q.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",x.length,")"),x.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:me},ie.length===x.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ie.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ie.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>Ce(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:E,disabled:De},De?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Ne([])},React.createElement("i",{className:"fas fa-times"})))),P?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):x.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},x.map((l,_)=>React.createElement("div",{key:_,className:`image-item ${ie.includes(l.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Ee(l.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ie.includes(l.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ie.includes(l.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ie.includes(l.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:l.src,alt:l.caption,style:{opacity:ie.includes(l.id)?.7:1,border:ie.includes(l.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Y=>{Y.stopPropagation(),Be(l.id,_)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),l.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},l.caption)))))),he&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ie.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>Ce(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},$e.filter(l=>!l.parentId).map(l=>React.createElement(FolderTreeItem,{key:l.uuid||l.id,folder:l,allAlbums:$e,currentAlbumId:y.uuid||y.id,targetAlbum:be,onSelect:pe})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>Ce(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ge,disabled:!be||t},t?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),ee&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>k(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>k(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:ee.src,alt:ee.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:l=>l.stopPropagation()}),ee.caption&&React.createElement("div",{className:"text-white text-center mt-2"},ee.caption)))))}function SearchCenter({showToast:y,onNavigate:p}){const[T,A]=useState(""),[M,r]=useState([]),[N,x]=useState([]),[R,g]=useState([]),[q,P]=useState("all"),[I,L]=useState(null),[H,W]=useState("list"),[O,Q]=useState(!0),[B,d]=useState([]),[J,f]=useState([]),V=useRef(null),[ee,k]=useState(!0),[le,U]=useState(!1),oe=useRef(null),[ae,se]=useState(!1),[te,ne]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[G,he]=useState(""),[Ce,ie]=useState(!1),Ne=useRef(null),$e=useRef(null),[ke,be]=useState(null),[pe,t]=useState(!1),[i,v]=useState(null),[de,ye]=useState(!1),[Ee,ge]=useState(!1),[De,Re]=useState(null),[E,me]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),ze=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Z=a=>{a._type==="product"&&(v(a),me({name:a.name||"",code:a.code||"",price:a.price||"",image:a.image||"",category:a.category||"",note:a.note||""}),t(!0))},w=async()=>{if(i)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${i.id}`,E,"L\u1ED7i c\u1EADp nh\u1EADt"),y("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),t(!1),v(null),Ie()}catch(a){y(a.message,"danger")}},Ve=async a=>{const b=a._type==="product"?"s\u1EA3n ph\u1EA9m":a._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${b} "${a.name}"?`))try{let m="";a._type==="product"?m=`${API_BASE}/api/products?id=${a.id}`:a._type==="album"?m=`${API_BASE}/api/images/${a.id}`:a._type==="video"&&(m=`${API_BASE}/api/videos/${a.id}`),await window.KTM.api.deleteJSON(m,"L\u1ED7i x\xF3a"),y(`\u0110\xE3 x\xF3a ${b}`,"success"),Ie()}catch(m){y(m.message,"danger")}},qe=async a=>{try{const b=De?`${API_BASE}/api/products?id=${De.id}`:`${API_BASE}/api/products`;De?await window.KTM.api.putJSON(b,a,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(b,a,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(De?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ge(!1),Re(null),Ie()}catch(b){y(b.message,"danger")}},He="ktm_admin_data_cache_v1",Be=1e3*60*10,Ie=async()=>{let a=null,b=!1;const m=window.KTM.cache.read(He,{ttlMs:Be,validate:Array.isArray});m.hit?(a=m.value,console.log("[CACHE] Using cache, items:",a.length),x(a),r(a),Q(!1),b=!0):m.status==="miss"?console.log("[CACHE] No cache found"):m.status==="expired"||m.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):m.status==="error"&&console.error("[CACHE] Error parsing cache"),b||Q(!0);try{const S=async(D,j)=>{try{const C=await window.KTM.api.getJSON(D,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return C!=null?C:j}catch(C){return j}},[$,h,e]=await Promise.all([S(`${API_BASE}/api/products`,[]),S(`${API_BASE}/api/albums`,[]),S(`${API_BASE}/api/video-folders?withVideos=true`,[])]),s=Array.isArray($)?$.map(D=>({...D,_type:"product",_source:"database"})):[];d(h);let n=[];Array.isArray(h)&&h.length>0&&(await Promise.all(h.map(j=>S(`${API_BASE}/api/albums/${j.id}`,{})))).forEach((j,C)=>{const K=h[C];j.images&&j.images.length>0&&j.images.forEach(X=>{n.push({id:X.id,name:X.caption||"\u1EA2nh t\u1EEB "+K.title,image:X.src,folder:K.title,_type:"album",_source:"database"})})}),f(e);let o=[];Array.isArray(e)&&e.forEach(D=>{D.videos&&D.videos.forEach(j=>{o.push({id:j.id,name:j.title,folder:D.name,image:j.thumb,youtubeId:j.youtubeId,url:j.url,_type:"video",_source:"database"})})});const c=[...s,...n,...o];(!a||JSON.stringify(c)!==JSON.stringify(a))&&(x(c),r(c),window.KTM.cache.write(He,c))}catch(S){console.error("Song song fetch error:",S)}Q(!1)};useEffect(()=>{Ie(),setTimeout(()=>{var a;return(a=V.current)==null?void 0:a.focus()},100)},[]);const Ae=a=>{try{return String(a!=null?a:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(b){return String(a!=null?a:"").toLowerCase()}},Pe=a=>{const m=Ae(a).trim().split(/\s+/).filter(Boolean),S=m.includes("anh"),$=m.includes("video"),h=m.filter(n=>n!=="anh"&&n!=="video"),e=h.join(" "),s=new Set(["product"]);return S&&s.add("album"),$&&s.add("video"),{allowedTypes:s,includeAlbum:S,includeVideo:$,contentTokens:h,cleanedQuery:e}},l=(a,b,m)=>{var D,j,C,K,X;const S=Array.isArray(b)?b:[],$=Ae(m).trim();if(!S.length&&!$)return 0;const h=Ae((D=a==null?void 0:a.name)!=null?D:""),e=Ae((j=a==null?void 0:a.code)!=null?j:""),s=Ae((C=a==null?void 0:a.category)!=null?C:""),n=Ae((K=a==null?void 0:a.note)!=null?K:""),o=Ae((X=a==null?void 0:a.folder)!=null?X:"");if(!`${h} ${e} ${s} ${n} ${o}`.trim())return 0;let u=0;$&&(h===$&&(u+=220),h.includes($)&&(u+=140),h.startsWith($)&&(u+=160),e&&e===$&&(u+=180),e&&e.includes($)&&(u+=90));for(const ue of S){if(!ue)continue;const ce=new RegExp(`(?:^|\\s)${ue.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);h.includes(ue)&&(u+=35),ce.test(h)&&(u+=25),e&&e.includes(ue)&&(u+=20),e&&ce.test(e)&&(u+=10),s&&s.includes(ue)&&(u+=12),o&&o.includes(ue)&&(u+=12),n&&n.includes(ue)&&(u+=6)}return u>0&&h&&(u+=Math.max(0,10-Math.min(10,Math.floor(h.length/10)))),u},_=(a,b,m)=>{const S=Array.isArray(a)?a:[];return S.length?S.map((h,e)=>({it:h,idx:e,score:l(h,b,m)})).sort((h,e)=>e.score!==h.score?e.score-h.score:h.idx-e.idx).map(h=>h.it):[]},Y=async(a,b)=>{if(!(!ee||b.length===0)){U(!0);try{const m=b.map($=>({id:$.id,name:$.name,price:$.price,category:$.category,note:$.note,folder:$.folder,_type:$._type})),S=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:a,products:m},"AI Search error");if(S&&S.matchedIds&&S.matchedIds.length>0){const{contentTokens:$,cleanedQuery:h}=Pe(a),e=new Set(S.matchedIds),s=b.filter(n=>e.has(n.id)).sort((n,o)=>l(o,$,h)-l(n,$,h));s.length>0&&r(s)}else S&&S.matchedIds&&S.matchedIds.length===0&&r([])}catch(m){console.error("AI Search error:",m)}U(!1)}},Te=a=>{if(A(a),oe.current&&clearTimeout(oe.current),!a.trim()){we(q);return}const{allowedTypes:b,contentTokens:m,cleanedQuery:S}=Pe(a),$=N.filter(e=>{if(!b.has(e==null?void 0:e._type))return!1;if(m.length===0)return!0;const s=Ae(Object.entries(e).filter(([n])=>!n.startsWith("_")).map(([,n])=>String(n||"")).join(" "));return m.some(n=>s.includes(n))});let h=$;q!=="all"&&(h=$.filter(e=>(e.category||e._type)===q)),r(_(h,m,S)),ee&&S.length>=3&&(oe.current=setTimeout(()=>{Y(S,h)},500))},we=a=>{P(a);const{allowedTypes:b,contentTokens:m}=Pe(T),{cleanedQuery:S}=Pe(T);let $=N.filter(h=>b.has(h==null?void 0:h._type));a!=="all"&&($=$.filter(h=>(h.category||h._type)===a)),T.trim()&&m.length>0&&($=$.filter(h=>{const e=Ae(Object.entries(h).filter(([s])=>!s.startsWith("_")).map(([,s])=>String(s||"")).join(" "));return m.every(s=>e.includes(s))})),r(_($,m,S))},fe=(a,b)=>{window.KTM.clipboard.writeText(a).then(()=>{L(b),y("\u0110\xE3 copy!","success"),setTimeout(()=>L(null),1500)})},Se=async(a,b)=>{try{await window.KTM.clipboard.writeImageFromUrl(a),L(b+"-img"),y("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>L(null),1500)}catch(m){fe(a,b+"-img")}},Le=a=>{let b=a.toLowerCase();const m=[],S=N.filter(e=>e._type==="product");if(b.includes("ty")||b.includes("xy lanh")){if(b.includes("gi\u1EEFa")||b.includes("giua")){const e=S.find(s=>{var n;return(n=s.name)==null?void 0:n.toLowerCase().includes("xy lanh gi\u1EEFa")});e&&!m.find(s=>s.id===e.id)&&m.push(e)}if(b.includes("nghi\xEAng")||b.includes("nghieng")){const e=S.find(s=>{var n;return(n=s.name)==null?void 0:n.toLowerCase().includes("xy lanh nghi\xEAng")});e&&!m.find(s=>s.id===e.id)&&m.push(e)}if(b.includes("\u1EE7i")||b.includes("ui")){const e=S.find(s=>{var n;return(n=s.name)==null?void 0:n.toLowerCase().includes("xy lanh \u1EE7i")});e&&!m.find(s=>s.id===e.id)&&m.push(e)}}const $=b.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if($){const e=$[1],s=$[2],n=S.find(o=>{var u;const c=((u=o.name)==null?void 0:u.toLowerCase())||"";return c.includes("combo")&&c.includes(`${e} tay`)&&(c.includes(`${s} xy`)||c.includes(`${s} xylanh`))});if(n&&!m.find(o=>o.id===n.id))m.push(n);else{const o=S.find(c=>{var D;const u=((D=c.name)==null?void 0:D.toLowerCase())||"";return u.includes("combo")&&u.includes(`${e} tay`)});o&&!m.find(c=>c.id===o.id)&&m.push(o)}}if(b.includes("combo")&&!$){const e=b.match(/combo.*?(\d+)\s*tay/);if(e){const s=e[1];S.filter(o=>{var u;const c=((u=o.name)==null?void 0:u.toLowerCase())||"";return c.includes("combo")&&c.includes(`${s} tay`)}).forEach(o=>{m.find(c=>c.id===o.id)||m.push(o)})}}const h=b.match(/van\s*(\d+)\s*tay/);if(h&&!b.includes("ty")&&!b.includes("combo")){const e=h[1],s=S.find(n=>{var c;const o=((c=n.name)==null?void 0:c.toLowerCase())||"";return o.includes(`van ${e} tay`)&&!o.includes("combo")});s&&!m.find(n=>n.id===s.id)&&m.push(s)}return m.slice(0,4)},je=async a=>{if(!a.trim())return;const b={role:"user",content:a,attachments:[]};ne(S=>[...S,b]),he(""),ie(!0);const m=Le(a);setTimeout(()=>{var S;return(S=Ne.current)==null?void 0:S.scrollIntoView({behavior:"smooth"})},100);try{const $=N.filter(c=>c._type==="product").map(c=>{let u=`- ${c.name}`;return c.code&&(u+=` (M\xE3: ${c.code})`),c.price&&(u+=` - Gi\xE1: ${c.price.replace(/[đ\s]/g,"")}\u0111`),c.category&&(u+=` [${c.category}]`),c.note&&(u+=` (${c.note})`),u}).join(`
`),e=te.slice(-6).map(c=>`${c.role==="user"?"Kh\xE1ch":"AI"}: ${c.content}`).join(`
`),s=e?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${e}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${$}`:$,o=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:a,context:s,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";ne(c=>[...c,{role:"assistant",content:o,attachments:m}])}catch(S){console.error("AI Error:",S);const $=a.toLowerCase(),h=N.filter(s=>{const n=Object.values(s).join(" ").toLowerCase();return $.split(" ").some(o=>n.includes(o))});let e="";h.length>0?(e=`T\xECm th\u1EA5y ${h.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,h.slice(0,5).forEach(s=>{e+=`\u2022 ${s.name}`,s.price&&(e+=` - ${s.price.replace(/[đ\s]/g,"")}\u0111`),s.note&&(e+=` (${s.note})`),e+=`
`}),h.length>5&&(e+=`
...v\xE0 ${h.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):e='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',ne(s=>[...s,{role:"assistant",content:e,attachments:h.slice(0,4)}])}ie(!1),setTimeout(()=>{var S,$;(S=Ne.current)==null||S.scrollIntoView({behavior:"smooth"}),($=$e.current)==null||$.focus()},100)};function We({show:a,product:b,categories:m,onClose:S,onSave:$}){const[h,e]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[s,n]=useState(!1),[o,c]=useState(!1),u=useRef(null),D=F=>window.KTM.money.formatVNDInputDigits(F);useEffect(()=>{if(b)if(e({name:b.name||"",code:b.code||"",price:b.price||"",image:b.image||"",category:b.category||"",note:b.note||"",sort_order:b.sort_order||0}),b.price){const F=window.KTM.money.getDigits(b.price);X(F),e(Me=>({...Me,price:D(F)}))}else X("");else e({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),X("")},[b,a]);const[j,C]=React.useState(""),[K,X]=React.useState(""),ue=F=>{const Me=window.KTM.money.nextPriceInputState(F.target.value,K);X(Me.digits),e({...h,price:Me.price})},ce=async(F,Me=2)=>{const Fe=Me*1024*1024;if(F.size<=Fe)return F;try{const ve=await createImageBitmap(F),_e=document.createElement("canvas");let xe=ve.width,re=ve.height;const Ke=1200;return(xe>Ke||re>Ke)&&(xe>re?(re=Math.round(re/xe*Ke),xe=Ke):(xe=Math.round(xe/re*Ke),re=Ke)),_e.width=xe,_e.height=re,_e.getContext("2d").drawImage(ve,0,0,xe,re),ve.close(),new Promise((Ye,Ze)=>{_e.toBlob(Xe=>{Xe?Ye(new File([Xe],F.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ze(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ve){throw console.error("Compress error:",ve),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Qe=async F=>{var ve;const Me=F.target.files[0];if(!Me)return;if(!(Me.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Me.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}c(!0);try{const _e=await ce(Me),xe=await window.KTM.cloudinary.uploadImage({file:_e,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!xe.secure_url)throw console.error("Cloudinary error:",xe),new Error(((ve=xe.error)==null?void 0:ve.message)||"Upload failed");e(re=>({...re,image:xe.secure_url}))}catch(_e){console.error("Upload error:",_e),alert("L\u1ED7i upload \u1EA3nh: "+_e.message)}c(!1),F.target.value=""},Ue=async F=>{F.preventDefault(),n(!0),await $(h),n(!1)};return a?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),b?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:S})),React.createElement("form",{onSubmit:Ue},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:h.name,onChange:F=>e({...h,name:F.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:h.code,onChange:F=>e({...h,code:F.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:h.price,onChange:ue,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:h.category,onChange:F=>e({...h,category:F.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),m.map(F=>React.createElement("option",{key:F,value:F},F)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:h.note,onChange:F=>e({...h,note:F.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},h.image?React.createElement(React.Fragment,null,React.createElement("img",{src:h.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>e({...h,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var F;return(F=u.current)==null?void 0:F.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:u,type:"file",accept:"image/*",className:"d-none",onChange:Qe}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var F;return(F=u.current)==null?void 0:F.click()},disabled:o,style:{borderRadius:"10px"}},o?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:h.image,onChange:F=>e({...h,image:F.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:S,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:s,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},s?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Oe=(a,b)=>{const m=a._type==="product",S=a._type==="album",$=a._type==="video",h=a.note&&(a.note.toLowerCase().includes("free")||a.note.toLowerCase().includes("gi\u1EA3m")||a.note.toLowerCase().includes("sale"));return H==="grid"?React.createElement("div",{key:a.id||b,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>be({url:a.image,name:a.name,price:a.price,note:a.note,item:a})},a.image?React.createElement("img",{src:a.image,alt:a.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${$?"fa-video":"fa-image"} fa-2x text-muted`})),a.price&&React.createElement("div",{className:"price-overlay"},a.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${m?"product":S?"album":"video"}`},m?"SP":S?"\u1EA2nh":"Video"),h&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},a.name),a.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},a.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:I===a.id+"-img"?"copied":"",onClick:()=>Se(a.image,a.id)},React.createElement("i",{className:"fas fa-image"})),a.price&&React.createElement("button",{className:I===a.id+"-price"?"copied":"",onClick:()=>fe(a.price.replace(/[đ\s]/g,""),a.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:a.id||b,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${m?"product":S?"album":"video"}`},m?"S\u1EA3n ph\u1EA9m":S?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},a.image?React.createElement("img",{src:a.image,alt:a.name,className:"thumb",loading:"lazy",onClick:()=>be({url:a.image,name:a.name,price:a.price,note:a.note,item:a})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${$?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},a.name),React.createElement("div",{className:"price-row"},a.price&&React.createElement("span",{className:"price"},a.price.replace(/[đ\s]/g,""),"\u0111"),h&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},a.code&&React.createElement("span",{className:"meta-tag"},"#",a.code),a.category&&React.createElement("span",{className:"meta-tag"},a.category),a.note&&React.createElement("span",{className:"meta-tag highlight"},a.note),a.folder&&React.createElement("span",{className:"meta-tag"},a.folder),$&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},m&&React.createElement("button",{onClick:()=>p&&p("orders","create",{productId:a.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),a.price&&React.createElement("button",{className:I===a.id+"-price"?"copied":"",onClick:()=>fe(a.price.replace(/[đ\s]/g,""),a.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:I===a.id+"-name"?"copied":"",onClick:()=>fe(a.name,a.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),$&&a.youtubeId&&React.createElement("button",{className:I===a.id+"-yt"?"copied":"",onClick:()=>fe(`https://www.youtube.com/watch?v=${a.youtubeId}`,a.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),m&&React.createElement("button",{className:"action-edit",onClick:()=>Z(a)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Ve(a)},React.createElement("i",{className:"fas fa-trash"}))))},[Je,z]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,M.length)," k\u1EBFt qu\u1EA3",ee&&T.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),q!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},q==="product"?"S\u1EA3n ph\u1EA9m":q==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${H==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>W("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${H==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>W("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},O?React.createElement("div",null,[...Array(8)].map((a,b)=>React.createElement("div",{key:b,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):M.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',T,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{A(""),Te("")}},"Xem t\u1EA5t c\u1EA3")):H==="grid"?React.createElement("div",{className:"product-grid-mobile"},M.map((a,b)=>Oe(a,b))):React.createElement("div",null,M.map((a,b)=>Oe(a,b)))),Je&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>z(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${q==="all"?"active":""}`,onClick:()=>{we("all"),z(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${q==="product"?"active":""}`,onClick:()=>{we("product"),z(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${q==="album"?"active":""}`,onClick:()=>{we("album"),z(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${q==="video"?"active":""}`,onClick:()=>{we("video"),z(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:ee,onChange:a=>k(a.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:V,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:T,onChange:a=>Te(a.target.value)}),React.createElement("button",{className:`filter-btn ${Je||q!=="all"?"active":""}`,onClick:()=>z(!Je)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:de?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>se(!0),onTouchStart:()=>se(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),ae&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>se(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},te.map((a,b)=>React.createElement("div",{key:b,className:`mb-3 ${a.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${a.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:a.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},a.content,a.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:I===`chat-${b}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:I===`chat-${b}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(a.content),L(`chat-${b}`),setTimeout(()=>L(null),1500)}},React.createElement("i",{className:`fas ${I===`chat-${b}`?"fa-check":"fa-copy"}`})),a.attachments&&a.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},a.attachments.map((m,S)=>React.createElement("div",{key:S,style:{width:70},className:"text-center"},m.image&&React.createElement("img",{src:m.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>be({url:m.image,name:m.name,price:m.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},m.name),m.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},m.price.replace(/[đ\s]/g,""),"\u0111"))))))),Ce&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Ne})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(a=>React.createElement("button",{key:a,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>je(a),disabled:Ce,style:{whiteSpace:"nowrap"}},a))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:a=>{a.preventDefault(),je(G)},className:"chat-input-wrap"},React.createElement("input",{ref:$e,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:G,onChange:a=>he(a.target.value),disabled:Ce}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Ce||!G.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),ke&&React.createElement("div",{className:"preview-modal",onClick:()=>be(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>be(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:a=>a.stopPropagation()},React.createElement("img",{src:ke.url,alt:ke.name})),React.createElement("div",{className:"preview-footer",onClick:a=>a.stopPropagation()},React.createElement("div",{className:"name"},ke.name),ke.price&&React.createElement("div",{className:"price"},ke.price.replace(/[đ\s]/g,""),"\u0111"),ke.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},ke.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:I==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:I==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Se(ke.url,"preview")},React.createElement("i",{className:`fas ${I==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),ke.price&&React.createElement("button",{className:I==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>fe(ke.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${I==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(We,{show:Ee,product:De,categories:R,onClose:()=>{ge(!1),Re(null)},onSave:qe}),React.createElement("div",{className:`fab-container mobile-only ${de?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{ye(!1),ge(!0),Re(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{ye(!1),p&&p("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${de?"open":""}`,onClick:()=>ye(!de)},React.createElement("i",{className:"fas fa-plus"}))),pe&&i&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>t(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:E.name,onChange:a=>me({...E,name:a.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:E.code,onChange:a=>me({...E,code:a.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:E.price,onChange:a=>me({...E,price:a.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:E.category,onChange:a=>me({...E,category:a.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),ze.map(a=>React.createElement("option",{key:a,value:a},a)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:E.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:a=>me({...E,note:a.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>t(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:w},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:y,showToast:p}){const[T,A]=useState([]),[M,r]=useState([]),[N,x]=useState(!0),[R,g]=useState(null),[q,P]=useState(!1),[I,L]=useState(null),[H,W]=useState(!1),[O,Q]=useState(null),[B,d]=useState(null),[J,f]=useState([]);useEffect(()=>{V()},[]);const V=async(t=null)=>{x(!0);try{const i=t?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${t}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,v=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");A(Array.isArray(v)?v:[])}catch(i){console.error(i),p("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}x(!1)},ee=async t=>{try{const i=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${t}`,"L\u1ED7i t\u1EA3i video");r(Array.isArray(i)?i:[])}catch(i){console.error(i)}},k=async t=>{if(t===0)return;const i=[...T];[i[t-1],i[t]]=[i[t],i[t-1]],A(i),await U(i)},le=async t=>{if(t===T.length-1)return;const i=[...T];[i[t],i[t+1]]=[i[t+1],i[t]],A(i),await U(i)},U=async t=>{try{await Promise.all(t.map((i,v)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${i.id}`,{sortOrder:v},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),p("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(i){p("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),V(B==null?void 0:B.id)}},oe=async t=>{if(t===0)return;const i=[...M];[i[t-1],i[t]]=[i[t],i[t-1]],r(i),await se(i)},ae=async t=>{if(t===M.length-1)return;const i=[...M];[i[t],i[t+1]]=[i[t+1],i[t]],r(i),await se(i)},se=async t=>{try{await Promise.all(t.map((i,v)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${i.id}`,{sort_order:v},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),p("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(i){p("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ee(R.id)}},te=()=>{L(null),P(!0)},ne=t=>{L(t),P(!0)},G=async t=>{try{!I&&B&&(t.parent_id=B.id);const i=I?`${API_BASE}/api/video-folders/${I.id}`:`${API_BASE}/api/video-folders`;I?await window.KTM.api.putJSON(i,t,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(i,t,"L\u1ED7i l\u01B0u folder"),p(I?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),P(!1),V(B==null?void 0:B.id)}catch(i){p(i.message,"danger")}},he=async t=>{const i=t.subfolderCount>0?`X\xF3a folder "${t.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${t.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(i))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${t.id}`,"L\u1ED7i x\xF3a folder"),p("\u0110\xE3 x\xF3a folder","success"),g(null),V(B==null?void 0:B.id)}catch(v){p("L\u1ED7i x\xF3a folder","danger")}},Ce=t=>{t.subfolderCount>0?(f(i=>[...i,t]),d(t),V(t.id)):(g(t),r(t.videos||[]))},ie=t=>{if(t==="root")f([]),d(null),V(null);else if(t){const i=J.findIndex(v=>v.id===t.id);i>=0&&(f(J.slice(0,i+1)),d(t),V(t.id))}else{const i=[...J];i.pop();const v=i[i.length-1]||null;f(i),d(v),V(v==null?void 0:v.id)}},Ne=()=>{Q(null),W(!0)},$e=t=>{Q(t),W(!0)},ke=async t=>{try{t.folder_id=R==null?void 0:R.id;const i=O?`${API_BASE}/api/videos/${O.id}`:`${API_BASE}/api/videos`;O?await window.KTM.api.putJSON(i,t,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(i,t,"L\u1ED7i l\u01B0u video"),p(O?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),W(!1),V(),R&&ee(R.id)}catch(i){p(i.message,"danger")}},be=async t=>{if(confirm(`X\xF3a video "${t.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${t.id}`,"L\u1ED7i x\xF3a video"),p("\u0110\xE3 x\xF3a video","success"),V(),R&&ee(R.id)}catch(i){p("L\u1ED7i x\xF3a video","danger")}},pe=t=>{const i=`https://www.youtube.com/watch?v=${t.youtubeId}`;window.KTM.clipboard.writeText(i).then(()=>{p("\u0110\xE3 copy link!","success")}).catch(()=>{p("Kh\xF4ng th\u1EC3 copy link","danger")})};return R?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>g(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${R.slug==="shorts"?"text-danger":"text-warning"}`}),R.name)),React.createElement("button",{className:"btn btn-warning",onClick:Ne},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),M.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},M.map((t,i)=>React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>oe(i),disabled:i===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},i+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>ae(i),disabled:i===M.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:t.thumb,className:"card-img-top",alt:t.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${t.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:t.title},t.title),React.createElement("small",{className:"text-muted"},t.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>pe(t),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>$e(t),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>be(t),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:H,video:O,onClose:()=>W(!1),onSave:ke})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},B&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ie()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),B?B.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:te},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),J.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:t=>{t.preventDefault(),ie("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),J.map((t,i)=>React.createElement("li",{key:t.id,className:`breadcrumb-item ${i===J.length-1?"active":""}`},i===J.length-1?t.name:React.createElement("a",{href:"#",onClick:v=>{v.preventDefault(),ie(t)},className:"text-warning"},t.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),N?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):T.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},B?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:te},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",B?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},T.map((t,i)=>{var v,de,ye,Ee;return React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ge=>{ge.stopPropagation(),k(i)},disabled:i===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},i+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ge=>{ge.stopPropagation(),le(i)},disabled:i===T.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>Ce(t),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${t.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},t.name),React.createElement("p",{className:"text-muted mb-0"},t.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),t.subfolderCount," folder"),t.subfolderCount>0&&(t.videoCount>0||((v=t.videos)==null?void 0:v.length)>0)&&" \u2022 ",(t.videoCount>0||((de=t.videos)==null?void 0:de.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),t.videoCount||((ye=t.videos)==null?void 0:ye.length)||0," videos"),t.subfolderCount===0&&!t.videoCount&&!((Ee=t.videos)!=null&&Ee.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ge=>{ge.stopPropagation(),ne(t)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ge=>{ge.stopPropagation(),he(t)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:q,folder:I,onClose:()=>P(!1),onSave:G}))}function VideoFolderModal({show:y,folder:p,onClose:T,onSave:A}){const[M,r]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[N,x]=useState(!1),[R,g]=useState(!1);useEffect(()=>{r(p?{name:p.name||"",description:p.description||"",sortOrder:p.sortOrder||0,coverImage:p.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[p,y]);const q=async I=>{const L=I.target.files[0];if(L){g(!0);try{const H=await window.KTM.cloudinary.uploadImage({file:L,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});H.secure_url&&r(W=>({...W,coverImage:H.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(H){console.error("Cloudinary upload error:",H),alert("L\u1ED7i upload \u1EA3nh: "+(H.message||H))}finally{g(!1)}}},P=async I=>{I.preventDefault(),x(!0),await A(M),x(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},p?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:P},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:M.name,onChange:I=>r({...M,name:I.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:M.description,onChange:I=>r({...M,description:I.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:M.sortOrder,onChange:I=>r({...M,sortOrder:parseInt(I.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},M.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:M.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>r({...M,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:q,disabled:R}),R&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:M.coverImage,onChange:I=>r({...M,coverImage:I.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:T},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:N},N?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:y}){const[p,T]=useState([]),[A,M]=useState(!0),[r,N]=useState(!1),[x,R]=useState(null),[g,q]=useState(""),[P,I]=useState(""),L=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{H()},[]);const H=async()=>{M(!0);try{const f=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");T(Array.isArray(f)?f:[])}catch(f){console.error(f),y("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}M(!1)},W=()=>{R(null),N(!0)},O=f=>{R(f),N(!0)},Q=async f=>{if(!(!f||!f.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:f},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),y(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),H()}catch(V){y("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},B=async f=>{try{const V=x?`${API_BASE}/api/products?id=${x.id}`:`${API_BASE}/api/products`;x?await window.KTM.api.putJSON(V,f,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(V,f,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(x?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),N(!1),H()}catch(V){y(V.message,"danger")}},d=async f=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${f.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${f.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),y("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),H()}catch(V){y(V.message,"danger")}},J=p.filter(f=>{const V=!g||f.name.toLowerCase().includes(g.toLowerCase())||f.code&&f.code.toLowerCase().includes(g.toLowerCase()),ee=!P||f.category===P;return V&&ee});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:W},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:g,onChange:f=>q(f.target.value)})),React.createElement("span",{className:"product-count"},J.length)),React.createElement("select",{className:"form-select",value:P,onChange:f=>I(f.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),L.map(f=>React.createElement("option",{key:f,value:f},f)))),A?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):J.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:W},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},J.map(f=>React.createElement("div",{key:f.id,className:"product-item d-flex align-items-center gap-3"},f.image?React.createElement("img",{src:f.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},f.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},f.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},f.category),f.code&&React.createElement("span",{className:"product-badge bg-secondary"},f.code)),React.createElement("div",{className:"product-price"},f.price?f.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),f.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},f.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>O(f),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>d(f),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:r,product:x,categories:L,onClose:()=>N(!1),onSave:B}))}function ProductModal({show:y,product:p,categories:T,onClose:A,onSave:M}){const[r,N]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[x,R]=useState(!1),[g,q]=useState(!1);useEffect(()=>{N(p?{name:p.name||"",code:p.code||"",price:p.price||"",image:p.image||"",category:p.category||"",note:p.note||"",sort_order:p.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[p,y]);const[P,I]=React.useState(""),L=k=>window.KTM.money.formatVNDInputDigits(k),[H,W]=React.useState(""),O=k=>{const le=window.KTM.money.nextPriceInputState(k.target.value,H);W(le.digits),N({...r,price:le.price})},[Q,B]=React.useState("");React.useEffect(()=>{p!=null&&p.image&&B(p.image)},[p]);const d=async k=>{if(!(!k||!k.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:k},"L\u1ED7i x\xF3a \u1EA3nh")}catch(le){console.error("Delete cloudinary image error:",le)}},J=async(k,le=2,U)=>{const oe=le*1024*1024,ae=k.type==="image/heic"||k.type==="image/heif"||/\.heic$/i.test(k.name);if(k.size<=oe&&!ae)return k;U==null||U("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const se=await createImageBitmap(k);U==null||U("\u0110ang n\xE9n \u1EA3nh...");const te=document.createElement("canvas");let ne=se.width,G=se.height;const he=1200;return(ne>he||G>he)&&(ne>G?(G=Math.round(G/ne*he),ne=he):(ne=Math.round(ne/G*he),G=he)),te.width=ne,te.height=G,te.getContext("2d").drawImage(se,0,0,ne,G),se.close(),new Promise((ie,Ne)=>{te.toBlob($e=>{$e?(U==null||U("Ho\xE0n t\u1EA5t!"),ie(new File([$e],k.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):Ne(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(se){throw console.error("createImageBitmap error:",se),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},f=async k=>{var oe,ae;const le=(oe=k.target.files)==null?void 0:oe[0];if(!le)return;if(!(le.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(le.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}q(!0),I("\u0110ang chu\u1EA9n b\u1ECB...");try{const se=(le.size/1024/1024).toFixed(1);I(`File ${se}MB - \u0110ang n\xE9n...`);const te=await J(le,2,he=>{I(he)}),ne=(te.size/1024/1024).toFixed(1);I(`\u0110\xE3 n\xE9n: ${ne}MB - \u0110ang upload...`);const G=await window.KTM.cloudinary.uploadImage({file:te,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});G.secure_url?(r.image&&r.image!==Q&&d(r.image),N(he=>({...he,image:G.secure_url})),I("")):(console.error("Cloudinary error:",G),alert("Upload th\u1EA5t b\u1EA1i: "+(((ae=G.error)==null?void 0:ae.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),I(""))}catch(se){console.error("Upload error:",se),alert("L\u1ED7i: "+se.message),I("")}q(!1),k.target.value=""},V=()=>{r.image&&(r.image!==Q&&d(r.image),N(k=>({...k,image:""})))},ee=async k=>{k.preventDefault(),R(!0),Q&&r.image&&Q!==r.image&&await d(Q),Q&&!r.image&&await d(Q),await M(r),R(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${p?"fa-edit":"fa-plus-circle"} me-2`}),p?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:ee},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},r.image?React.createElement(React.Fragment,null,React.createElement("img",{src:r.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:V,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${g?"fa-spinner fa-spin":"fa-camera"} me-1`}),g?P||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:f,disabled:g,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),g&&P&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},P))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:r.name,onChange:k=>N({...r,name:k.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:r.code,onChange:k=>N({...r,code:k.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:r.price,onChange:O,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:r.category,onChange:k=>N({...r,category:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),T.map(k=>React.createElement("option",{key:k,value:k},k)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:r.note,onChange:k=>N({...r,note:k.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:r.image,onChange:k=>N({...r,image:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:A,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:x,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},x?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:y,video:p,onClose:T,onSave:A}){const[M,r]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[N,x]=useState(!1),[R,g]=useState("");useEffect(()=>{p?(r({title:p.title||"",youtube_url:`https://www.youtube.com/watch?v=${p.youtubeId}`,thumbnail_url:p.thumb||"",sort_order:p.sortOrder||0}),g(p.thumb)):(r({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),g(""))},[p,y]);const q=L=>{const H=L.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return H?H[1]:null},P=L=>{r({...M,youtube_url:L});const H=q(L);H&&g(`https://img.youtube.com/vi/${H}/hqdefault.jpg`)},I=async L=>{L.preventDefault(),x(!0),await A(M),x(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},p?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:I},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:M.youtube_url,onChange:L=>P(L.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),R&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:R,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:M.title,onChange:L=>r({...M,title:L.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:M.sort_order,onChange:L=>r({...M,sort_order:parseInt(L.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:M.thumbnail_url,onChange:L=>r({...M,thumbnail_url:L.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:T},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:N},N?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[y,p]=useState(!1),[T,A]=useState(""),[M,r]=useState(null),[N,x]=useState("search"),[R,g]=useState(null),[q,P]=useState(""),[I,L]=useState([]),[H,W]=useState(null),[O,Q]=useState(!1),[B,d]=useState(null),[J,f]=useState(!0),[V,ee]=useState([]),[k,le]=useState(null),[U,oe]=useState([]);useEffect(()=>{const t=localStorage.getItem("ktm_admin_session");if(t)try{const i=JSON.parse(t);i.expiry>Date.now()?(p(!0),r(i.user)):localStorage.removeItem("ktm_admin_session")}catch(i){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{y&&G()},[y]);const ae=async(t,i)=>{A("");try{const v=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:t,password:i},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),de={user:v.user,token:v.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(de)),r(v.user),p(!0)}catch(v){A(v.message)}},se=()=>{localStorage.removeItem("ktm_admin_session"),p(!1),r(null),L([]),W(null)},te=(t,i="success")=>{const v=Date.now();ee(de=>[...de,{id:v,message:t,type:i}])},ne=t=>{ee(i=>i.filter(v=>v.id!==t))},G=async(t=null)=>{f(!0);try{const i=t?`${API_BASE}/api/albums?parent_id=${t}`:`${API_BASE}/api/albums?parent_id=root`,v=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i danh s\xE1ch album");L(Array.isArray(v)?v:[])}catch(i){console.error(i),te("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}f(!1)},he=()=>{d(null),Q(!0)},Ce=t=>{d(t),Q(!0)},ie=async t=>{try{const i=B&&B.uuid;!i&&k&&(t.parent_id=k.uuid);const v=i?`${API_BASE}/api/albums/${B.uuid||B.id}`:`${API_BASE}/api/albums`;i?await window.KTM.api.putJSON(v,t,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(v,t,"L\u1ED7i t\u1EA1o"),te(i?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),Q(!1),G(k==null?void 0:k.uuid)}catch(i){te(i.message,"danger")}},Ne=t=>{W(t)},$e=t=>{if(t==="root")oe([]),le(null),G(null);else if(t){const i=U.findIndex(v=>v.uuid===t.uuid);i>=0&&(oe(U.slice(0,i+1)),le(t),G(t.uuid))}else{const i=[...U];i.pop();const v=i[i.length-1]||null;oe(i),le(v),G(v==null?void 0:v.uuid)}},ke=async t=>{const i=`X\xF3a folder "${t.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(i))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${t.uuid||t.id}`,"L\u1ED7i x\xF3a album"),te("\u0110\xE3 x\xF3a","success"),G(k==null?void 0:k.uuid)}catch(v){te("L\u1ED7i x\xF3a album","danger")}};if(!y)return React.createElement(LoginPage,{onLogin:ae,error:T});const be=()=>{const t=new Date,i=t.getFullYear(),v=String(t.getMonth()+1).padStart(2,"0");return`${i}-${v}`};function pe(){const[t,i]=useState(be()),[v,de]=useState(!0),[ye,Ee]=useState([]),{parseMoney:ge,parseShipFeeFromNote:De,getShipFeeForItems:Re,formatNumber:E,formatVND:me}=window.KTM.money,ze=async()=>{de(!0);try{const w=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(t)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA");Ee(Array.isArray(w)?w:[])}catch(w){console.error("Load stats error:",w),Ee([])}finally{de(!1)}};useEffect(()=>{ze()},[t]);const Z=React.useMemo(()=>{var Je;const w={pending:0,processing:0,done:0,paid:0,other:0};let Ve=0,qe=0,He=0,Be=0,Ie=0;const Ae=z=>z.customer_id||z.phone||"unknown",Pe=z=>window.KTM.orders.getOrderItems(z),l=new Map,_=new Map,Y=new Map;for(const z of ye){const a=Pe(z);let b=0,m=0;for(const u of a){const D=Number((u==null?void 0:u.quantity)||0)||0,j=ge(u==null?void 0:u.product_price),C=D*j;b+=D,m+=C;const K=(u==null?void 0:u.product_id)||"unknown",X=l.get(K)||{product_id:K,product_name:(u==null?void 0:u.product_name)||"\u2014",product_code:(u==null?void 0:u.product_code)||"",orders:0,quantity:0,revenue:0};X.orders+=1,X.quantity+=D,X.revenue+=C,l.set(K,X)}const S=Re(a),$=Number((Je=z==null?void 0:z.adjustment_amount)!=null?Je:0)||0,h=m+(S.found?S.fee:0)+$,e=m+$;Ve+=b,qe+=h,Be+=e;const s=z.status==="done"||z.status==="paid";z.status==="pending"?w.pending+=1:z.status==="processing"?w.processing+=1:z.status==="paid"?(w.paid+=1,w.done+=1,He+=h,Ie+=e):z.status==="done"?(w.done+=1,He+=h,Ie+=e):w.other+=1;const n=Ae(z),o=_.get(n)||{key:n,customer_name:z.customer_name||"",phone:z.phone||"",orders:0,quantity:0,revenue:0};o.orders+=1,o.quantity+=b,o.revenue+=h,!o.customer_name&&z.customer_name&&(o.customer_name=z.customer_name),!o.phone&&z.phone&&(o.phone=z.phone),_.set(n,o);const c=z.created_at?new Date(z.created_at):null;if(c&&!Number.isNaN(c.getTime())){const u=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,D=Y.get(u)||{day:u,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};D.orders+=1,D.quantity+=b,D.revenue+=h,s&&(D.doneOrders+=1,D.doneRevenue+=h),Y.set(u,D)}}const Te=Array.from(l.values()).sort((z,a)=>a.revenue-z.revenue),we=Array.from(_.values()).sort((z,a)=>a.revenue-z.revenue),fe=Array.from(Y.values()).sort((z,a)=>z.day.localeCompare(a.day)),Se=_.size,Le=ye.length?Math.round(qe/ye.length):0,je=ye.length?Ve/ye.length:0,We=Math.round(Ie*.05),Oe=Math.round(Be*.05);return{statusCounts:w,totalQty:Ve,totalRevenue:qe,doneRevenue:He,tempCommission:We,tempCommissionAll:Oe,products:Te,customers:we,days:fe,uniqueCustomers:Se,avgOrderValue:Le,avgQtyPerOrder:je}},[ye,t]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:v}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:ze,disabled:v},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:t,onChange:w=>i(w.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),E(ye.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),E(Z.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),E(Z.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",E(Z.statusCounts.paid),"/",E(Z.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},E(ye.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},me(Z.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},me(Z.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},me(Z.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},me(Z.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",Z.avgQtyPerOrder?Z.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},E(Z.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},E(Z.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},E(Z.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},E(Z.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},E(Z.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,E(Z.statusCounts.pending)),React.createElement("td",null,E(Z.statusCounts.processing)),React.createElement("td",null,E(Z.statusCounts.done)),React.createElement("td",null,E(Z.statusCounts.paid)),React.createElement("td",null,E(Z.statusCounts.other)),React.createElement("td",null,E(Z.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Z.products.slice(0,10).map(w=>React.createElement("div",{key:w.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},w.product_name),React.createElement("div",{className:"text-muted small text-truncate"},w.product_code?`#${w.product_code} \u2022 `:"",E(w.orders)," \u0111\u01A1n \u2022 ",E(w.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},me(w.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Z.products.slice(0,10).map(w=>React.createElement("tr",{key:w.product_id},React.createElement("td",null,w.product_name),React.createElement("td",null,w.product_code||"\u2014"),React.createElement("td",null,E(w.orders)),React.createElement("td",null,E(w.quantity)),React.createElement("td",{className:"fw-semibold"},me(w.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Z.customers.slice(0,10).map(w=>React.createElement("div",{key:w.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},w.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},w.phone||"\u2014"," \u2022 ",E(w.orders)," \u0111\u01A1n \u2022 ",E(w.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},me(w.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Z.customers.slice(0,10).map(w=>React.createElement("tr",{key:w.key},React.createElement("td",null,w.customer_name||"\u2014"),React.createElement("td",null,w.phone||"\u2014"),React.createElement("td",null,E(w.orders)),React.createElement("td",null,E(w.quantity)),React.createElement("td",{className:"fw-semibold"},me(w.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},Z.days.map(w=>React.createElement("div",{key:w.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},w.day),React.createElement("div",{className:"text-muted small"},E(w.orders)," \u0111\u01A1n \u2022 ",E(w.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",E(w.doneOrders)," \u2022 ",me(w.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},me(w.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,Z.days.map(w=>React.createElement("tr",{key:w.day},React.createElement("td",null,w.day),React.createElement("td",null,E(w.orders)),React.createElement("td",null,E(w.quantity)),React.createElement("td",{className:"fw-semibold"},me(w.revenue)),React.createElement("td",null,E(w.doneOrders)),React.createElement("td",{className:"fw-semibold"},me(w.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:N,onMenuChange:t=>{x(t),t==="albums"&&(le(null),oe([]),G(null))},onLogout:se,currentUser:M}),React.createElement("div",{className:"main-content"},N==="albums"&&!H&&React.createElement(AlbumList,{albums:I,loading:J,currentFolder:k,breadcrumb:U,onSelect:Ne,onCreate:he,onEdit:Ce,onDelete:ke,onBack:$e}),N==="search"&&React.createElement(SearchCenter,{showToast:te,onNavigate:(t,i,v)=>{x(t),t==="orders"&&i==="create"&&(g(Date.now()),P((v==null?void 0:v.productId)||""))}}),N==="albums"&&H&&React.createElement(AlbumDetail,{album:H,parentAlbum:U.length>0?U[U.length-1]:null,onBack:()=>{if(H.parentId){const t=U.findIndex(i=>i.uuid===H.parentId);t>=0?W(U[t]):W(null)}else W(null)},onRefresh:()=>G(k==null?void 0:k.uuid),showToast:te,onNavigateToFolder:t=>{oe(i=>[...i,H]),W(t)},onEditSubfolder:t=>{d(t),Q(!0)}}),N==="videos"&&React.createElement(VideoList,{showToast:te}),N==="products"&&React.createElement(ProductManager,{showToast:te}),N==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:R,autoOpenCreateProductId:q,showToast:te}),N==="stats"&&React.createElement(pe,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${N==="search"?"active":""}`,onClick:t=>{t.preventDefault(),x("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${N==="albums"?"active":""}`,onClick:t=>{t.preventDefault(),x("albums"),W(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${N==="videos"?"active":""}`,onClick:t=>{t.preventDefault(),x("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${N==="products"?"active":""}`,onClick:t=>{t.preventDefault(),x("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${N==="orders"?"active":""}`,onClick:t=>{t.preventDefault(),x("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${N==="stats"?"active":""}`,onClick:t=>{t.preventDefault(),x("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:O,album:B,parentId:k==null?void 0:k.uuid,onClose:()=>Q(!1),onSave:ie}),React.createElement("div",{className:"toast-container"},V.map(t=>React.createElement(Toast,{key:t.id,message:t.message,type:t.type,onClose:()=>ne(t.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:y,autoOpenCreateProductId:p,showToast:T}){const[A,M]=useState([]),[r,N]=useState(!0),[x,R]=useState(!1),[g,q]=useState(null),[P,I]=useState(""),[L,H]=useState(!1),[W,O]=useState(null),[Q,B]=useState(!1),[d,J]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[f,V]=useState([""]),[ee,k]=useState(null),le=useRef({}),[U,oe]=useState([]),[ae,se]=useState(null),te=useRef(null),ne=useRef(null),G=useRef(0),he=useRef(null),Ce=useRef(0),ie=useRef(null),Ne=3,$e=e=>{J({customer_name:"",phone:"",address:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),V([""]),O(null),k(null)};useEffect(()=>{const e=s=>{var o;if(ee==null)return;const n=(o=le.current)==null?void 0:o[ee];n&&!n.contains(s.target)&&k(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ee]);const ke=e=>window.KTM.money.parseMoney(e),be=e=>window.KTM.money.parseSignedMoney(e),pe=e=>window.KTM.money.formatVND(e),t=e=>window.KTM.money.parseShipFeeFromNote(e),i=e=>window.KTM.phone.isValid(e),v=e=>window.KTM.phone.normalize(e),de=async e=>{const s=v(e);if(!s)return;const n=++G.current;O({status:"loading",phone:s});try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(s)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(G.current!==n)return;if(o&&o.exists&&o.customer){O({status:"found",phone:s,customer:o.customer}),J(c=>v(c.phone)!==s?c:{...c,customer_name:o.customer.name||c.customer_name,address:o.customer.address||c.address});return}O({status:"not-found",phone:s})}catch(o){if(G.current!==n)return;console.error("Customer lookup error:",o),O({status:"error",phone:s})}},ye=e=>{const s=v(e);if(J(o=>({...o,phone:s})),B(!1),ne.current&&(clearTimeout(ne.current),ne.current=null),s.length<Ne){O(null);return}ne.current=setTimeout(()=>{de(s)},350)},Ee=()=>{const e=v(d.phone);e.length<Ne||de(e)};useEffect(()=>(L?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[L]);const ge=Array.isArray(d.items)?d.items.length:0;useEffect(()=>{if(!L){Ce.current=ge;return}ge>Ce.current&&setTimeout(()=>{const e=he.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Ce.current=ge},[L,ge]),useEffect(()=>()=>{ne.current&&(clearTimeout(ne.current),ne.current=null)},[]),useEffect(()=>{ze()},[]),useEffect(()=>{Z()},[P]),useEffect(()=>{y&&te.current!==y&&(te.current=y,Ve(p))},[y]);const De=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e||"",Re=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":"bg-light text-dark",E=React.useMemo(()=>window.KTM.orders.sortOrders(A),[A]),me=e=>window.KTM.date.formatDateTime(e),ze=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");oe(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),oe([])}},Z=async()=>{N(!0);try{let e=`${API_BASE}/api/orders`;P&&(e+=`?month=${P}`);const s=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");M(Array.isArray(s)?s:[])}catch(e){console.error("Load orders error:",e),M([])}finally{N(!1)}},w=e=>{var n;se(e.id);const s=Array.isArray(e.items)&&e.items.length?e.items.map(o=>{var c;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((c=o==null?void 0:o.quantity)!=null?c:1)||1}}).filter(o=>o.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];J({customer_name:e.customer_name||"",phone:v(e.phone||""),address:e.address||"",items:s.length?s:[{product_id:"",quantity:1}],adjustment_amount:Number((n=e==null?void 0:e.adjustment_amount)!=null?n:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),V(new Array(s.length?s.length:1).fill("")),O(null),H(!0),e.phone&&de(v(e.phone))};function Ve(e){se(null),$e(e||""),B(!1),H(!0)}const qe=()=>{x||(H(!1),se(null),$e(""),B(!1))},He=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const s=String(e),n=U.find(o=>String(o==null?void 0:o.id)===s);return n?`${n.name}${n.code?` (${n.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Be=e=>{const s=String(f[e]||"").trim().toLowerCase();return s?U.filter(n=>{const o=String((n==null?void 0:n.name)||"").toLowerCase(),c=String((n==null?void 0:n.code)||"").toLowerCase();return o.includes(s)||c.includes(s)}):U},Ie=e=>{if(!e)return null;const s=String(e);return U.find(n=>String(n==null?void 0:n.id)===s)||null},Ae=e=>window.KTM.orders.getOrderItems(e),Pe=e=>window.KTM.orders.getOrderTotalQty(e),l=e=>window.KTM.orders.getOrderProductSummary(e,Ie),_=e=>window.KTM.orders.getOrderItemRows(e,Ie),Y=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Te=e=>{var K;const s=Ae(e),n=_(e),o=Se(s),c=fe(s),u=c.fee,D=Y(e),j=o+u+D,C=[];if(C.push(`\u0110\u01A0N H\xC0NG #${(K=e==null?void 0:e.id)!=null?K:""}`.trim()),e!=null&&e.customer_name&&C.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&C.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&C.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),e!=null&&e.status&&C.push(`Tr\u1EA1ng th\xE1i: ${De(e.status)}`),e!=null&&e.created_at&&C.push(`Th\u1EDDi gian: ${me(e.created_at)}`),C.push(""),C.push("S\u1EA3n ph\u1EA9m:"),n.length)for(const X of n)C.push(`- ${X.name} x${X.qty}`);else{const X=l(e);X&&X!=="\u2014"&&C.push(`- ${X}`)}return C.push(""),C.push(`T\u1EA1m t\xEDnh: ${pe(o)}`),C.push(`Ship: ${pe(c.found?u:0)}`),D!==0&&C.push(`\u0110i\u1EC1u ch\u1EC9nh: ${pe(D)}`),e!=null&&e.adjustment_note&&C.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),C.push(`T\u1ED5ng: ${pe(j)}`),C.filter(Boolean).join(`
`)},we=async e=>{try{const s=Te(e);await window.KTM.clipboard.writeText(s),typeof T=="function"?T("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(s){console.error(s),typeof T=="function"?T("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},fe=e=>window.KTM.orders.getOrderShipInfo(e,Ie),Se=e=>window.KTM.orders.getItemsSubtotal(e,Ie),Le=e=>{try{const s=e instanceof Date?e:new Date(e);if(!s||Number.isNaN(s.getTime()))return"";const n=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0");return`${n}-${o}`}catch(s){return""}},je=()=>P?String(P):Le(new Date),We=e=>{const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),n=v((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim().toLowerCase(),c=be(e==null?void 0:e.adjustment_amount),D=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(j=>{var C;return{product_id:String((j==null?void 0:j.product_id)||"").trim(),quantity:Number((C=j==null?void 0:j.quantity)!=null?C:0)}}).filter(j=>j.product_id&&Number.isFinite(j.quantity)&&j.quantity>0).sort((j,C)=>j.product_id<C.product_id?-1:j.product_id>C.product_id?1:j.quantity-C.quantity);return JSON.stringify({name:s,phone:n,address:o,items:D,adj:c})},Oe=React.useMemo(()=>{const e=v((d==null?void 0:d.phone)||"");if(!e)return{count:0,orders:[],monthKey:je()};const s=je(),n=(Array.isArray(A)?A:[]).filter(o=>{if(!o||ae&&String(o.id)===String(ae)||v(o.phone||"")!==e)return!1;const c=Le(o.created_at);return c&&c===s}).sort((o,c)=>{const u=new Date(o.created_at).getTime(),D=new Date(c.created_at).getTime();return(Number.isFinite(D)?D:0)-(Number.isFinite(u)?u:0)});return{count:n.length,orders:n,monthKey:s}},[A,d==null?void 0:d.phone,P,ae]),Je=e=>{var j;const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),n=v((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim().toLowerCase(),c=be((j=e==null?void 0:e.adjustment_amount)!=null?j:0),u=Ae(e),D=(Array.isArray(u)?u:[]).map(C=>{var K;return{product_id:String((C==null?void 0:C.product_id)||"").trim(),quantity:Number((K=C==null?void 0:C.quantity)!=null?K:0)}}).filter(C=>C.product_id&&Number.isFinite(C.quantity)&&C.quantity>0).sort((C,K)=>C.product_id<K.product_id?-1:C.product_id>K.product_id?1:C.quantity-K.quantity);return JSON.stringify({name:s,phone:n,address:o,items:D,adj:c})},z=React.useMemo(()=>{if(ae)return"";const e=v((d==null?void 0:d.phone)||"");if(!e)return"";const s=je(),n=We(d),o=Array.isArray(A)?A:[];for(const c of o){if(!c||ae&&String(c.id)===String(ae)||v(c.phone||"")!==e)continue;const u=Le(c.created_at);if(!u||u!==s)continue;const D=Je(c);if(D&&D===n)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${s}${c!=null&&c.id?` (#${c.id})`:""}`}return""},[A,d,P,ae]),a=e=>{var Fe;const s=[],n=[],o=String((e==null?void 0:e.customer_name)||"").trim(),c=v((e==null?void 0:e.phone)||""),u=String((e==null?void 0:e.address)||"").trim();o||s.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),c||s.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),c&&!i(c)&&s.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),u||n.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const j=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(ve=>ve&&ve.product_id);j.length===0&&s.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),j.some(ve=>{var xe;const _e=Number((xe=ve==null?void 0:ve.quantity)!=null?xe:0);return!Number.isFinite(_e)||_e<=0})&&s.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const K=new Set;let X=!1;for(const ve of j){const _e=String(ve.product_id||"").trim();if(_e){if(K.has(_e)){X=!0;break}K.add(_e)}}X&&n.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const ue=Se(j),ce=fe(j),Qe=ce!=null&&ce.found?Number((Fe=ce==null?void 0:ce.fee)!=null?Fe:0):0,Ue=be(e==null?void 0:e.adjustment_amount),F=String((e==null?void 0:e.adjustment_note)||"").trim();ce!=null&&ce.found&&(Qe>=2e5||ue>0&&Qe>ue*.6)&&n.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${pe(Qe)}`),Ue!==0&&!F&&n.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Me=Math.abs(Ue);return(Me>=5e5||ue>0&&Me>ue*.5)&&Ue!==0&&n.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${pe(Ue)}`),{errors:s,warnings:n,canSubmit:s.length===0}},b=React.useMemo(()=>a(d),[d,U]),m=React.useMemo(()=>{var xe;const e=String((d==null?void 0:d.customer_name)||"").trim(),s=v((d==null?void 0:d.phone)||""),n=String((d==null?void 0:d.address)||"").trim(),o=Array.isArray(d==null?void 0:d.items)?d.items:[],c=new Map;for(const re of o){const Ke=String((re==null?void 0:re.product_id)||"").trim();Ke&&c.set(Ke,(c.get(Ke)||0)+1)}const u=o.map(re=>{var ea;const Ke=String((re==null?void 0:re.product_id)||"").trim(),Ge=Number((ea=re==null?void 0:re.quantity)!=null?ea:0),Ye=Ke?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",Ze=Number.isFinite(Ge)&&Ge>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",Xe=Ke&&(c.get(Ke)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Ye,qtyError:Ze,dupWarn:Xe}}),D=o.filter(re=>re&&re.product_id),j=Se(D),C=fe(D),K=C!=null&&C.found?Number((xe=C==null?void 0:C.fee)!=null?xe:0):0,X=be(d==null?void 0:d.adjustment_amount),ue=String((d==null?void 0:d.adjustment_note)||"").trim(),ce=Math.abs(X),Qe=X!==0&&!ue?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Ue=X!==0&&(ce>=5e5||j>0&&ce>j*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${pe(X)}`:"",F=C!=null&&C.found&&(K>=2e5||j>0&&K>j*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${pe(K)}`:"",Me=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Fe=s?i(s)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",ve=n?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",_e=!Me&&!Fe&&u.every(re=>!re.productError&&!re.qtyError);return{nameError:Me,phoneError:Fe,addressWarn:ve,items:u,shipAbnormalWarn:F,adjustmentNoteWarn:Qe,adjustmentAbnormalWarn:Ue,canSubmit:_e}},[d,U]),S=async e=>{var D,j,C;const s=(e==null?void 0:e.mode)||"close",n=a(d);if(!n.canSubmit){const K=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof T=="function"?T(K,"danger"):alert(K);return}if(!ae&&z){const K=`${z}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(K)){(Oe==null?void 0:Oe.count)>0&&B(!0),setTimeout(()=>{var ce;const ue=document.getElementById("order-phone-input");ue&&typeof ue.scrollIntoView=="function"&&(ue.scrollIntoView({block:"center",behavior:"smooth"}),(ce=ue.focus)==null||ce.call(ue))},0);return}}const o=v(d.phone),u=(Array.isArray(d.items)?d.items:[]).map(K=>{var X;return{product_id:(K==null?void 0:K.product_id)||"",quantity:Number((X=K==null?void 0:K.quantity)!=null?X:1)}}).filter(K=>K.product_id&&Number.isFinite(K.quantity)&&K.quantity>0);R(!0);try{const K=ae?`${API_BASE}/api/orders/${ae}`:`${API_BASE}/api/orders`,X=u[0],ue={customer_name:d.customer_name,phone:o,address:d.address,adjustment_amount:be(d.adjustment_amount),adjustment_note:(d.adjustment_note||"").trim(),product_id:X.product_id,quantity:X.quantity,status:d.status,items:u,...ae?{id:ae}:{}};if(ae)await window.KTM.api.putJSON(K,ue,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const ce=await window.KTM.api.postJSON(K,ue,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");ie.current={id:(C=(j=ce==null?void 0:ce.id)!=null?j:(D=ce==null?void 0:ce.order)==null?void 0:D.id)!=null?C:null,fingerprint:We(d),ts:Date.now()}}s==="new"&&!ae?($e(""),se(null),H(!0)):($e(""),se(null),H(!1)),Z()}catch(K){console.error(K),typeof T=="function"?T(K.message,"danger"):alert(K.message);return}finally{R(!1)}},$=e=>window.KTM.orders.getOrderTotalMoney(e,Ie),h=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){q(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Z()}catch(s){console.error(s),typeof T=="function"?T(s.message,"danger"):alert(s.message)}finally{q(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:r&&!L||x||!!g}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Ve,disabled:x||!!g},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:P,onChange:e=>I(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),P&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{I("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:r},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Z,disabled:r},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},A.length," \u0111\u01A1n")),r?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):A.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},E.map(e=>React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"text-muted small"},e.phone),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address)),React.createElement("span",{className:`badge ${Re(e.status)}`},De(e.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const s=_(e);return s.length?React.createElement("div",{className:"mt-1"},s.map((n,o)=>React.createElement("div",{key:o,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},n.name),React.createElement("div",{className:"text-muted",style:{flexShrink:0}},"x",n.qty)))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},l(e))})()),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},Pe(e))),(Y(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},pe(Y(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},pe($(e)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",me(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>w(e),disabled:x||!!g},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>we(e),disabled:x||!!g},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>h(e.id),disabled:x||g===e.id},g===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,E.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,l(e)),React.createElement("td",null,Pe(e)),React.createElement("td",{className:"fw-semibold"},pe($(e))),React.createElement("td",null,React.createElement("span",{className:`badge ${Re(e.status)}`},De(e.status))),React.createElement("td",null,me(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>w(e),disabled:x||!!g},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>we(e),disabled:x||!!g},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>h(e.id),disabled:x||g===e.id},g===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),L&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),ae?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:qe})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),S({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:he},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:d.customer_name,onChange:e=>J({...d,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!m.nameError&&React.createElement("div",{className:"form-text text-danger"},m.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:d.phone,onChange:e=>ye(e.target.value),onBlur:Ee,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!m.phoneError&&React.createElement("div",{className:"form-text text-danger"},m.phoneError),!m.phoneError&&Oe.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Oe.count," \u0111\u01A1n trong th\xE1ng ",Oe.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>B(e=>!e)},Q?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),Q&&Oe.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>B(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Oe.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Re(e.status)}`},De(e.status))),React.createElement("div",{className:"text-muted small"},me(e.created_at)," \u2022 ",pe($(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},l(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&w(e)}},"M\u1EDF")))),Oe.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(W==null?void 0:W.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(W==null?void 0:W.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(W==null?void 0:W.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(W==null?void 0:W.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:d.status,onChange:e=>J({...d,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:d.address,onChange:e=>J({...d,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!m.addressWarn&&React.createElement("div",{className:"form-text text-warning"},m.addressWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:d.adjustment_amount,onChange:e=>J({...d,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!m.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},m.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:d.adjustment_note,onChange:e=>J({...d,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!m.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},m.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{J(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),V(e=>[...Array.isArray(e)?e:[],""])},disabled:x},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(d.items)?d.items:[{product_id:"",quantity:1}]).map((e,s)=>React.createElement("div",{key:s,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:n=>{le.current[s]=n}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{k(n=>n===s?null:s),setTimeout(()=>{const n=document.getElementById(`order-product-search-${s}`);n&&n.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},He(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ee===s&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${s}`,className:"form-control",value:f[s]||"",onChange:n=>{const o=n.target.value;V(c=>{const u=Array.isArray(c)?[...c]:[];return u[s]=o,u})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),Be(s).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):Be(s).map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const o=String(n.id);J(c=>{const u=Array.isArray(c.items)?[...c.items]:[];return u[s]={...u[s]||{quantity:1},product_id:o},{...c,items:u}}),k(null)}},n.name,n.code?` (${n.code})`:""))),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),U.map(n=>React.createElement("option",{key:n.id,value:n.id},n.name)))),(()=>{var o;const n=(o=m.items)==null?void 0:o[s];return n?React.createElement(React.Fragment,null,!!n.productError&&React.createElement("div",{className:"form-text text-danger"},n.productError),!!n.dupWarn&&React.createElement("div",{className:"form-text text-warning"},n.dupWarn)):null})()),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:n=>{const o=n.target.value;J(c=>{const u=Array.isArray(c.items)?[...c.items]:[];return u[s]={...u[s]||{product_id:""},quantity:o},{...c,items:u}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var o;const n=(o=m.items)==null?void 0:o[s];return n&&n.qtyError?React.createElement("div",{className:"form-text text-danger"},n.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{J(n=>{const o=Array.isArray(n.items)?[...n.items]:[];return o.splice(s,1),{...n,items:o.length?o:[{product_id:"",quantity:1}]}}),V(n=>{const o=Array.isArray(n)?[...n]:[];return o.splice(s,1),o.length?o:[""]}),k(n=>n==null?n:n===s?null:n>s?n-1:n)},disabled:x||(Array.isArray(d.items)?d.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const s=(Array.isArray(d.items)?d.items:[]).filter(D=>D==null?void 0:D.product_id),n=Se(s),o=fe(s),c=be(d.adjustment_amount),u=n+(o.found?o.fee:0)+c;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},pe(n))),o.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},pe(o.fee))),!!m.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},m.shipAbnormalWarn),c!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},pe(c))),(d.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(d.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},pe(u)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:qe,disabled:x,style:{borderRadius:10}},"H\u1EE7y"),!ae&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>S({mode:"new"}),disabled:x||!m.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:x||!m.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},x?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

