const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:g,error:l}){const[L,E]=useState(""),[C,i]=useState(""),[r,I]=useState(!1),[$,v]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),l&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),l),React.createElement("form",{onSubmit:async K=>{K.preventDefault(),I(!0),await g(L,C),I(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:L,onChange:K=>E(K.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:$?"text":"password",className:"form-control",value:C,onChange:K=>i(K.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>v(!$)},React.createElement("i",{className:`fas fa-eye${$?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:r},r?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:g,type:l,onClose:L}){return useEffect(()=>{const E=setTimeout(L,3e3);return()=>clearTimeout(E)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${l} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},g),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:L})))}function Loading({show:g}){return g?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:g,onMenuChange:l,onLogout:L,currentUser:E}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(i=>React.createElement("a",{key:i.id,href:"#",className:`nav-link ${g===i.id?"active":""} ${i.disabled?"opacity-50":""} ${i.highlight?"text-warning":""}`,onClick:r=>{r.preventDefault(),i.disabled||l(i.id)}},React.createElement("i",{className:`fas ${i.icon}`})," ",i.label,i.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),i.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),L&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:L,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:g,onSelect:l,onCreate:L,onEdit:E,onDelete:C,loading:i,currentFolder:r,onBack:I,breadcrumb:$}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},r&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:I},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),r?r.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:L},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),$&&$.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:v=>{v.preventDefault(),I("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),$.map((v,P)=>React.createElement("li",{key:v.id,className:`breadcrumb-item ${P===$.length-1?"active":""}`},P===$.length-1?v.title:React.createElement("a",{href:"#",onClick:K=>{K.preventDefault(),I(v)},className:"text-warning"},v.title))))),i?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):g.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},r?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},g.map(v=>React.createElement("div",{key:v.uuid||v.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>l(v)},v.cover?React.createElement("img",{src:v.cover,className:"album-cover",alt:v.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},v.title),React.createElement("small",{className:"text-muted"},v.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),v.subfolderCount),v.subfolderCount>0&&v.count>0&&" \u2022 ",v.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),v.count),v.subfolderCount===0&&v.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:P=>{P.stopPropagation(),E(v)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:P=>{P.stopPropagation(),C(v)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:g,album:l,onClose:L,onSave:E,parentId:C}){const[i,r]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[I,$]=useState(!1),[v,P]=useState(!1),K=useRef(null);useEffect(()=>{r(l?{slug:l.id||"",title:l.title||"",description:l.description||"",cover_url:l.cover||"",parent_id:l.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:C||null})},[l,g,C]);const x=async p=>{p.preventDefault(),$(!0),await E(i),$(!1)},A=p=>p.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),O=async p=>{const Q=p.type==="image/heic"||p.type==="image/heif"||/\.heic$/i.test(p.name);if(p.size<=2097152&&!Q)return p;try{const Z=await createImageBitmap(p),G=document.createElement("canvas");let m=Z.width,F=Z.height;const H=800;return(m>H||F>H)&&(m>F?(F=Math.round(F/m*H),m=H):(m=Math.round(m/F*H),F=H)),G.width=m,G.height=F,G.getContext("2d").drawImage(Z,0,0,m,F),Z.close(),new Promise((ne,q)=>{G.toBlob(ae=>{ae?ne(new File([ae],p.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):q(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Z){throw console.error("Compress cover error:",Z),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},U=async p=>{var Z;const D=p.target.files[0];if(!D)return;if(!(D.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(D.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}P(!0);try{const G=await O(D),m=new FormData;m.append("file",G),m.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),m.append("folder","ktm-albums/covers");const F=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:m}),H=await F.json();if(!F.ok)throw console.error("Cloudinary error:",H),new Error(((Z=H.error)==null?void 0:Z.message)||"Upload failed");r(N=>({...N,cover_url:H.secure_url}))}catch(G){console.error("Cover upload error:",G),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+G.message)}P(!1),p.target.value=""};return g?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},l?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:x},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:i.title,onChange:p=>r({...i,title:p.target.value,slug:i.slug||A(p.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:i.slug,onChange:p=>r({...i,slug:p.target.value}),required:!0,disabled:!!l}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:i.description,onChange:p=>r({...i,description:p.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},i.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:i.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>r(p=>({...p,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:K,type:"file",accept:"image/*",className:"d-none",onChange:U}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var p;return(p=K.current)==null?void 0:p.click()},disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:i.cover_url,onChange:p=>r({...i,cover_url:p.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:I||v},I?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:g,allAlbums:l,currentAlbumId:L,targetAlbum:E,onSelect:C,level:i=0}){const[r,I]=useState(!0),$=g.uuid||g.id,v=$===L,P=E===$,K=l.filter(A=>A.parentId===$),x=K.length>0;return React.createElement("div",{style:{marginLeft:i*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${P?"bg-info text-white":v?"bg-light text-muted":"hover-bg"}`,style:{cursor:v?"not-allowed":"pointer",opacity:v?.5:1,transition:"background 0.2s"},onClick:()=>!v&&C($)},x&&React.createElement("i",{className:`fas fa-chevron-${r?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:A=>{A.stopPropagation(),I(!r)}}),!x&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${P?"-open":""} me-2 ${P?"":"text-warning"}`}),React.createElement("span",{className:"small"},g.title),v&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),g.count>0&&!v&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},g.count)),r&&x&&React.createElement("div",null,K.map(A=>React.createElement(FolderTreeItem,{key:A.uuid||A.id,folder:A,allAlbums:l,currentAlbumId:L,targetAlbum:E,onSelect:C,level:i+1}))))}function AlbumDetail({album:g,onBack:l,onRefresh:L,showToast:E,onNavigateToFolder:C,onEditSubfolder:i,parentAlbum:r}){const[I,$]=useState([]),[v,P]=useState([]),[K,x]=useState(!0),[A,O]=useState(!1),[U,p]=useState(""),[D,Q]=useState([]),[Z,G]=useState([]),[m,F]=useState({}),[H,N]=useState(null),[ne,q]=useState(!1),[ae,we]=useState(""),[te,ie]=useState(!1),me=useRef(null),z=useRef(null),[fe,be]=useState(!1),[ee,he]=useState([]),[ke,ge]=useState([]),[ye,Le]=useState(""),[a,s]=useState(!1),k=async(n,b=2)=>{const V=b*1024*1024,de=n.type==="image/heic"||n.type==="image/heif"||/\.heic$/i.test(n.name);if(n.size<=V&&!de)return n;try{const xe=await createImageBitmap(n),Oe=document.createElement("canvas");let _e=xe.width,j=xe.height;const pe=1200;return(_e>pe||j>pe)&&(_e>j?(j=Math.round(j/_e*pe),_e=pe):(_e=Math.round(_e/j*pe),j=pe)),Oe.width=_e,Oe.height=j,Oe.getContext("2d").drawImage(xe,0,0,_e,j),xe.close(),new Promise((u,h)=>{Oe.toBlob(S=>{S?u(new File([S],n.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):h(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(xe){throw console.error("Compress error:",xe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{J(),re()},[g.id,g.uuid]);const J=async()=>{x(!0);try{const b=await(await fetch(`${API_BASE}/api/albums/${g.uuid||g.id}`)).json();$(b.images||[]);const de=await(await fetch(`${API_BASE}/api/albums?parent_id=${g.uuid||g.id}`)).json();P(Array.isArray(de)?de:[])}catch(n){console.error(n),E("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}x(!1)},re=async()=>{try{const b=await(await fetch(`${API_BASE}/api/albums`)).json();ge(Array.isArray(b)?b:[])}catch(n){console.error("Error loading albums:",n)}},Ie=n=>{he(b=>b.includes(n)?b.filter(V=>V!==n):[...b,n])},ve=async()=>{if(!ye||ee.length===0){E("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}s(!0);let n=0;for(const b of ee)try{(await fetch(`${API_BASE}/api/images/${b}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({album_id:ye})})).ok&&n++}catch(V){console.error("Move error:",V)}s(!1),be(!1),he([]),Le(""),n>0?(E("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),J(),L()):E("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Se,De]=useState(!1),M=async()=>{if(ee.length===0||!confirm(`X\xF3a ${ee.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;De(!0);let n=0;for(const b of ee)try{(await fetch(`${API_BASE}/api/images/${b}`,{method:"DELETE"})).ok&&n++}catch(V){console.error("Delete error:",V)}De(!1),he([]),n>0?(E(`\u0110\xE3 x\xF3a ${n} \u1EA3nh!`,"success"),J(),L()):E("X\xF3a th\u1EA5t b\u1EA1i","danger")},ue=()=>{ee.length===I.length?he([]):he(I.map(n=>n.id))},Ee=async()=>{if(ae.trim()){ie(!0);try{const n=ae.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(!(await fetch(`${API_BASE}/api/albums`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:n+"-"+Date.now(),title:ae,parent_id:g.uuid||g.id})})).ok)throw new Error("L\u1ED7i t\u1EA1o folder");E("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),we(""),q(!1),J(),L()}catch(n){E(n.message,"danger")}ie(!1)}},se=async n=>{if(confirm(`X\xF3a folder "${n.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await fetch(`${API_BASE}/api/albums/${n.uuid||n.id}`,{method:"DELETE"}),E("\u0110\xE3 x\xF3a folder","success"),J(),L()}catch(b){E("L\u1ED7i x\xF3a folder","danger")}},e=n=>{const b=Array.from(n).filter(V=>V.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(V.name));Q(V=>[...V,...b]),b.forEach(V=>{const de=new FileReader;de.onload=xe=>{G(Oe=>[...Oe,{file:V,preview:xe.target.result}])},de.readAsDataURL(V)})},c=n=>{Q(b=>b.filter((V,de)=>de!==n)),G(b=>b.filter((V,de)=>de!==n))},d=async n=>{var de;const b=new FormData;b.append("file",n),b.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),b.append("folder",`ktm-albums/${g.id}`);const V=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:b});if(!V.ok){const xe=await V.json();throw console.error("Cloudinary error:",xe),new Error(((de=xe.error)==null?void 0:de.message)||"Upload failed")}return await V.json()},o=async()=>{if(D.length===0)return;O(!0);let n=0;for(let b=0;b<D.length;b++)try{p(`\u0110ang x\u1EED l\xFD ${b+1}/${D.length}...`);const V=await k(D[b],2);p(`\u0110ang upload ${b+1}/${D.length}...`);const de=await d(V);await fetch(`${API_BASE}/api/albums/${g.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:de.secure_url,caption:m[b]||D[b].name.replace(/\.[^/.]+$/,""),sort_order:I.length+b})}),n++}catch(V){console.error("Upload error:",V)}O(!1),p(""),Q([]),G([]),F({}),n>0?(E(`\u0110\xE3 upload ${n} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),J(),L()):E("Upload th\u1EA5t b\u1EA1i","danger")},w=async(n,b)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await fetch(`${API_BASE}/api/images/${n}`,{method:"DELETE"}),E("\u0110\xE3 x\xF3a \u1EA3nh","success"),J(),L()}catch(V){E("L\u1ED7i x\xF3a \u1EA3nh","danger")}},T=n=>{var b;n.preventDefault(),(b=z.current)==null||b.classList.add("dragover")},B=()=>{var n;(n=z.current)==null||n.classList.remove("dragover")},ce=n=>{var b;n.preventDefault(),(b=z.current)==null||b.classList.remove("dragover"),e(n.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:l},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},g.title),React.createElement("small",{className:"text-muted"},v.length>0&&React.createElement("span",null,v.length," folder \u2022 "),I.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>q(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ne&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:ae,onChange:n=>we(n.target.value),onKeyPress:n=>n.key==="Enter"&&Ee(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Ee,disabled:te||!ae.trim()},te?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{q(!1),we("")}},"H\u1EE7y")))),v.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},v.map(n=>React.createElement("div",{key:n.uuid||n.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>C&&C(n)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},n.title),React.createElement("small",{className:"text-muted"},n.subfolderCount>0&&React.createElement("span",null,n.subfolderCount," folder"),n.subfolderCount>0&&n.count>0&&" \u2022 ",n.count>0&&React.createElement("span",null,n.count," \u1EA3nh"),n.subfolderCount===0&&n.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:b=>{b.stopPropagation(),i&&i(n)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:b=>{b.stopPropagation(),se(n)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:z,className:"upload-zone",onClick:()=>{var n;return(n=me.current)==null?void 0:n.click()},onDragOver:T,onDragLeave:B,onDrop:ce},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:me,type:"file",multiple:!0,accept:"image/*",onChange:n=>e(n.target.files)})),Z.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Z.map((n,b)=>React.createElement("div",{key:b,className:"upload-preview-item"},React.createElement("img",{src:n.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>c(b)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:o,disabled:A},A?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),U||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",D.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",I.length,")"),I.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:ue},ee.length===I.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ee.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ee.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>be(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:M,disabled:Se},Se?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>he([])},React.createElement("i",{className:"fas fa-times"})))),K?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):I.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},I.map((n,b)=>React.createElement("div",{key:b,className:`image-item ${ee.includes(n.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Ie(n.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ee.includes(n.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ee.includes(n.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ee.includes(n.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:n.src,alt:n.caption,style:{opacity:ee.includes(n.id)?.7:1,border:ee.includes(n.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:V=>{V.stopPropagation(),w(n.id,b)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),n.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},n.caption)))))),fe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ee.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>be(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},ke.filter(n=>!n.parentId).map(n=>React.createElement(FolderTreeItem,{key:n.uuid||n.id,folder:n,allAlbums:ke,currentAlbumId:g.uuid||g.id,targetAlbum:ye,onSelect:Le})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>be(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ve,disabled:!ye||a},a?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),H&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>N(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>N(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:H.src,alt:H.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:n=>n.stopPropagation()}),H.caption&&React.createElement("div",{className:"text-white text-center mt-2"},H.caption)))))}function SearchCenter({showToast:g,onNavigate:l}){const[L,E]=useState(""),[C,i]=useState([]),[r,I]=useState([]),[$,v]=useState([]),[P,K]=useState("all"),[x,A]=useState(null),[O,U]=useState("list"),[p,D]=useState(!0),[Q,Z]=useState([]),[G,m]=useState([]),F=useRef(null),[H,N]=useState(!0),[ne,q]=useState(!1),ae=useRef(null),[we,te]=useState(!1),[ie,me]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[z,fe]=useState(""),[be,ee]=useState(!1),he=useRef(null),ke=useRef(null),[ge,ye]=useState(null),[Le,a]=useState(!1),[s,k]=useState(null),[J,re]=useState(!1),[Ie,ve]=useState(!1),[Se,De]=useState(null),[M,ue]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),Ee=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],se=t=>{t._type==="product"&&(k(t),ue({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||""}),a(!0))},e=async()=>{if(s)try{if(!(await fetch(`${API_BASE}/api/products?id=${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)})).ok)throw new Error("L\u1ED7i c\u1EADp nh\u1EADt");g("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),a(!1),k(null),T()}catch(t){g(t.message,"danger")}},c=async t=>{const u=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${u} "${t.name}"?`))try{let h="";if(t._type==="product"?h=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?h=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(h=`${API_BASE}/api/videos/${t.id}`),!(await fetch(h,{method:"DELETE"})).ok)throw new Error("L\u1ED7i x\xF3a");g(`\u0110\xE3 x\xF3a ${u}`,"success"),T()}catch(h){g(h.message,"danger")}},d=async t=>{try{const u=Se?`${API_BASE}/api/products?id=${Se.id}`:`${API_BASE}/api/products`;if(!(await fetch(u,{method:Se?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m");g(Se?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ve(!1),De(null),T()}catch(u){g(u.message,"danger")}},o="ktm_admin_data_cache_v1",w=1e3*60*10,T=async()=>{let t=null,u=!1;try{const h=localStorage.getItem(o);if(h){const S=JSON.parse(h);S&&S.timestamp&&Date.now()-S.timestamp<w&&Array.isArray(S.data)?(t=S.data,console.log("[CACHE] Using cache, items:",t.length),I(t),i(t),D(!1),u=!0):console.log("[CACHE] Cache expired or invalid")}else console.log("[CACHE] No cache found")}catch(h){console.error("[CACHE] Error parsing cache:",h)}u||D(!0);try{const[h,S,R]=await Promise.all([fetch(`${API_BASE}/api/products`),fetch(`${API_BASE}/api/albums`),fetch(`${API_BASE}/api/video-folders?withVideos=true`)]),[_,f,y]=await Promise.all([h.ok?h.json():[],S.ok?S.json():[],R.ok?R.json():[]]),X=Array.isArray(_)?_.map(Pe=>({...Pe,_type:"product",_source:"database"})):[];Z(f);let oe=[];if(Array.isArray(f)&&f.length>0){const Pe=f.map(Ce=>fetch(`${API_BASE}/api/albums/${Ce.id}`)),Ve=await Promise.all(Pe);(await Promise.all(Ve.map(Ce=>Ce.ok?Ce.json():{}))).forEach((Ce,He)=>{const Ue=f[He];Ce.images&&Ce.images.length>0&&Ce.images.forEach(qe=>{oe.push({id:qe.id,name:qe.caption||"\u1EA2nh t\u1EEB "+Ue.title,image:qe.src,folder:Ue.title,_type:"album",_source:"database"})})})}m(y);let le=[];Array.isArray(y)&&y.forEach(Pe=>{Pe.videos&&Pe.videos.forEach(Ve=>{le.push({id:Ve.id,name:Ve.title,folder:Pe.name,image:Ve.thumb,youtubeId:Ve.youtubeId,url:Ve.url,_type:"video",_source:"database"})})});const W=[...X,...oe,...le];if(!t||JSON.stringify(W)!==JSON.stringify(t)){I(W),i(W);try{localStorage.setItem(o,JSON.stringify({data:W,timestamp:Date.now()}))}catch(Pe){}}}catch(h){console.error("Song song fetch error:",h)}D(!1)};useEffect(()=>{T(),setTimeout(()=>{var t;return(t=F.current)==null?void 0:t.focus()},100)},[]);const B=async(t,u)=>{if(!(!H||u.length===0)){q(!0);try{const h=u.map(R=>({id:R.id,name:R.name,price:R.price,category:R.category,note:R.note,folder:R.folder,_type:R._type})),S=await fetch(`${API_BASE}/api/ai-search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,products:h})});if(S.ok){const R=await S.json();if(R.matchedIds&&R.matchedIds.length>0){const _=u.filter(f=>R.matchedIds.includes(f.id));_.length>0&&i(_)}else R.matchedIds&&R.matchedIds.length===0&&i([])}}catch(h){console.error("AI Search error:",h)}q(!1)}},ce=t=>{if(E(t),ae.current&&clearTimeout(ae.current),!t.trim()){n(P);return}const h=t.toLowerCase().split(/\s+/).filter(_=>_.length>0),S=r.filter(_=>{const f=Object.entries(_).filter(([y])=>!y.startsWith("_")).map(([,y])=>String(y||"").toLowerCase()).join(" ");return h.some(y=>f.includes(y))});let R=S;P!=="all"&&(R=S.filter(_=>(_.category||_._type)===P)),i(R),H&&t.length>=3&&(ae.current=setTimeout(()=>{B(t,R)},500))},n=t=>{K(t);let u=r;if(t!=="all"&&(u=r.filter(h=>(h.category||h._type)===t)),L.trim()){const S=L.toLowerCase().split(/\s+/).filter(R=>R.length>0);u=u.filter(R=>{const _=Object.entries(R).filter(([f])=>!f.startsWith("_")).map(([,f])=>String(f||"").toLowerCase()).join(" ");return S.every(f=>_.includes(f))})}i(u)},b=(t,u)=>{navigator.clipboard.writeText(t).then(()=>{A(u),g("\u0110\xE3 copy!","success"),setTimeout(()=>A(null),1500)})},V=async(t,u)=>{try{const S=await(await fetch(t)).blob();await navigator.clipboard.write([new ClipboardItem({[S.type]:S})]),A(u+"-img"),g("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>A(null),1500)}catch(h){b(t,u+"-img")}},de=t=>{let u=t.toLowerCase();const h=[],S=r.filter(f=>f._type==="product");if(u.includes("ty")||u.includes("xy lanh")){if(u.includes("gi\u1EEFa")||u.includes("giua")){const f=S.find(y=>{var X;return(X=y.name)==null?void 0:X.toLowerCase().includes("xy lanh gi\u1EEFa")});f&&!h.find(y=>y.id===f.id)&&h.push(f)}if(u.includes("nghi\xEAng")||u.includes("nghieng")){const f=S.find(y=>{var X;return(X=y.name)==null?void 0:X.toLowerCase().includes("xy lanh nghi\xEAng")});f&&!h.find(y=>y.id===f.id)&&h.push(f)}if(u.includes("\u1EE7i")||u.includes("ui")){const f=S.find(y=>{var X;return(X=y.name)==null?void 0:X.toLowerCase().includes("xy lanh \u1EE7i")});f&&!h.find(y=>y.id===f.id)&&h.push(f)}}const R=u.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(R){const f=R[1],y=R[2],X=S.find(oe=>{var W;const le=((W=oe.name)==null?void 0:W.toLowerCase())||"";return le.includes("combo")&&le.includes(`${f} tay`)&&(le.includes(`${y} xy`)||le.includes(`${y} xylanh`))});if(X&&!h.find(oe=>oe.id===X.id))h.push(X);else{const oe=S.find(le=>{var Ne;const W=((Ne=le.name)==null?void 0:Ne.toLowerCase())||"";return W.includes("combo")&&W.includes(`${f} tay`)});oe&&!h.find(le=>le.id===oe.id)&&h.push(oe)}}if(u.includes("combo")&&!R){const f=u.match(/combo.*?(\d+)\s*tay/);if(f){const y=f[1];S.filter(oe=>{var W;const le=((W=oe.name)==null?void 0:W.toLowerCase())||"";return le.includes("combo")&&le.includes(`${y} tay`)}).forEach(oe=>{h.find(le=>le.id===oe.id)||h.push(oe)})}}const _=u.match(/van\s*(\d+)\s*tay/);if(_&&!u.includes("ty")&&!u.includes("combo")){const f=_[1],y=S.find(X=>{var le;const oe=((le=X.name)==null?void 0:le.toLowerCase())||"";return oe.includes(`van ${f} tay`)&&!oe.includes("combo")});y&&!h.find(X=>X.id===y.id)&&h.push(y)}return h.slice(0,4)},xe=async t=>{if(!t.trim())return;const u={role:"user",content:t,attachments:[]};me(S=>[...S,u]),fe(""),ee(!0);const h=de(t);setTimeout(()=>{var S;return(S=he.current)==null?void 0:S.scrollIntoView({behavior:"smooth"})},100);try{const R=r.filter(W=>W._type==="product").map(W=>{let Ne=`- ${W.name}`;return W.code&&(Ne+=` (M\xE3: ${W.code})`),W.price&&(Ne+=` - Gi\xE1: ${W.price.replace(/[đ\s]/g,"")}\u0111`),W.category&&(Ne+=` [${W.category}]`),W.note&&(Ne+=` (${W.note})`),Ne}).join(`
`),f=ie.slice(-6).map(W=>`${W.role==="user"?"Kh\xE1ch":"AI"}: ${W.content}`).join(`
`),y=f?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${f}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${R}`:R,X=await fetch(`${API_BASE}/api/ai-chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,context:y,audience:"admin"})}),oe=await X.json();if(!X.ok)throw new Error(oe.error||"API error");const le=oe.response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";me(W=>[...W,{role:"assistant",content:le,attachments:h}])}catch(S){console.error("AI Error:",S);const R=t.toLowerCase(),_=r.filter(y=>{const X=Object.values(y).join(" ").toLowerCase();return R.split(" ").some(oe=>X.includes(oe))});let f="";_.length>0?(f=`T\xECm th\u1EA5y ${_.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,_.slice(0,5).forEach(y=>{f+=`\u2022 ${y.name}`,y.price&&(f+=` - ${y.price.replace(/[đ\s]/g,"")}\u0111`),y.note&&(f+=` (${y.note})`),f+=`
`}),_.length>5&&(f+=`
...v\xE0 ${_.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):f='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',me(y=>[...y,{role:"assistant",content:f,attachments:_.slice(0,4)}])}ee(!1),setTimeout(()=>{var S,R;(S=he.current)==null||S.scrollIntoView({behavior:"smooth"}),(R=ke.current)==null||R.focus()},100)};function Oe({show:t,product:u,categories:h,onClose:S,onSave:R}){const[_,f]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[y,X]=useState(!1),[oe,le]=useState(!1),W=useRef(null),Ne=Y=>{const Ae=Y.replace(/[^\d]/g,"");return Ae?Ae.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""};useEffect(()=>{if(u)if(f({name:u.name||"",code:u.code||"",price:u.price||"",image:u.image||"",category:u.category||"",note:u.note||"",sort_order:u.sort_order||0}),u.price){const Y=u.price.replace(/[^\d]/g,"");Ce(Y),f(Ae=>({...Ae,price:Ne(Y)}))}else Ce("");else f({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),Ce("")},[u,t]);const[Pe,Ve]=React.useState(""),[ze,Ce]=React.useState(""),He=Y=>{const Fe=Y.target.value.replace(/[^\d]/g,"");if(!Fe){f({..._,price:""}),Ce("");return}if(Fe===ze&&Fe.length>0){const $e=Fe.slice(0,-1);$e?(f({..._,price:Ne($e)}),Ce($e)):(f({..._,price:""}),Ce(""));return}Ce(Fe),f({..._,price:Ne(Fe)})},Ue=async(Y,Ae=2)=>{const Fe=Ae*1024*1024;if(Y.size<=Fe)return Y;try{const $e=await createImageBitmap(Y),Me=document.createElement("canvas");let Te=$e.width,je=$e.height;const Re=1200;return(Te>Re||je>Re)&&(Te>je?(je=Math.round(je/Te*Re),Te=Re):(Te=Math.round(Te/je*Re),je=Re)),Me.width=Te,Me.height=je,Me.getContext("2d").drawImage($e,0,0,Te,je),$e.close(),new Promise((Je,Xe)=>{Me.toBlob(Ke=>{Ke?Je(new File([Ke],Y.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Xe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch($e){throw console.error("Compress error:",$e),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},qe=async Y=>{var $e;const Ae=Y.target.files[0];if(!Ae)return;if(!(Ae.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Ae.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}le(!0);try{const Me=await Ue(Ae),Te=new FormData;Te.append("file",Me),Te.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),Te.append("folder","ktm-products");const je=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:Te}),Re=await je.json();if(!je.ok)throw console.error("Cloudinary error:",Re),new Error((($e=Re.error)==null?void 0:$e.message)||"Upload failed");f(Be=>({...Be,image:Re.secure_url}))}catch(Me){console.error("Upload error:",Me),alert("L\u1ED7i upload \u1EA3nh: "+Me.message)}le(!1),Y.target.value=""},Qe=async Y=>{Y.preventDefault(),X(!0),await R(_),X(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),u?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:S})),React.createElement("form",{onSubmit:Qe},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:_.name,onChange:Y=>f({..._,name:Y.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:_.code,onChange:Y=>f({..._,code:Y.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:_.price,onChange:He,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:_.category,onChange:Y=>f({..._,category:Y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),h.map(Y=>React.createElement("option",{key:Y,value:Y},Y)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:_.note,onChange:Y=>f({..._,note:Y.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},_.image?React.createElement(React.Fragment,null,React.createElement("img",{src:_.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>f({..._,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var Y;return(Y=W.current)==null?void 0:Y.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:W,type:"file",accept:"image/*",className:"d-none",onChange:qe}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var Y;return(Y=W.current)==null?void 0:Y.click()},disabled:oe,style:{borderRadius:"10px"}},oe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:_.image,onChange:Y=>f({..._,image:Y.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:S,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:y,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const _e=(t,u)=>{const h=t._type==="product",S=t._type==="album",R=t._type==="video",_=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale"));return O==="grid"?React.createElement("div",{key:t.id||u,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>ye({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${R?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${h?"product":S?"album":"video"}`},h?"SP":S?"\u1EA2nh":"Video"),_&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:x===t.id+"-img"?"copied":"",onClick:()=>V(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:x===t.id+"-price"?"copied":"",onClick:()=>b(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||u,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${h?"product":S?"album":"video"}`},h?"S\u1EA3n ph\u1EA9m":S?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>ye({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${R?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),_&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),R&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},h&&React.createElement("button",{onClick:()=>l&&l("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),React.createElement("button",{className:x===t.id+"-img"?"copied":"",onClick:()=>V(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})," \u1EA2nh"),t.price&&React.createElement("button",{className:x===t.id+"-price"?"copied":"",onClick:()=>b(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:x===t.id+"-name"?"copied":"",onClick:()=>b(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),R&&t.youtubeId&&React.createElement("button",{className:x===t.id+"-yt"?"copied":"",onClick:()=>b(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),h&&React.createElement("button",{className:"action-edit",onClick:()=>se(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>c(t)},React.createElement("i",{className:"fas fa-trash"}))))},[j,pe]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,C.length)," k\u1EBFt qu\u1EA3",H&&L.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),P!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},P==="product"?"S\u1EA3n ph\u1EA9m":P==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${O==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>U("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${O==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>U("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},p?React.createElement("div",null,[...Array(8)].map((t,u)=>React.createElement("div",{key:u,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):C.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',L,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{E(""),ce("")}},"Xem t\u1EA5t c\u1EA3")):O==="grid"?React.createElement("div",{className:"product-grid-mobile"},C.map((t,u)=>_e(t,u))):React.createElement("div",null,C.map((t,u)=>_e(t,u)))),j&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>pe(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${P==="all"?"active":""}`,onClick:()=>{n("all"),pe(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${P==="product"?"active":""}`,onClick:()=>{n("product"),pe(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${P==="album"?"active":""}`,onClick:()=>{n("album"),pe(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${P==="video"?"active":""}`,onClick:()=>{n("video"),pe(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:H,onChange:t=>N(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:F,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:L,onChange:t=>ce(t.target.value)}),React.createElement("button",{className:`filter-btn ${j||P!=="all"?"active":""}`,onClick:()=>pe(!j)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:J?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>te(!0),onTouchStart:()=>te(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),we&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>te(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},ie.map((t,u)=>React.createElement("div",{key:u,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:x===`chat-${u}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:x===`chat-${u}`?"#fff":"#666"},onClick:()=>{navigator.clipboard.writeText(t.content),A(`chat-${u}`),setTimeout(()=>A(null),1500)}},React.createElement("i",{className:`fas ${x===`chat-${u}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((h,S)=>React.createElement("div",{key:S,style:{width:70},className:"text-center"},h.image&&React.createElement("img",{src:h.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>ye({url:h.image,name:h.name,price:h.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},h.name),h.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},h.price.replace(/[đ\s]/g,""),"\u0111"))))))),be&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:he})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>xe(t),disabled:be,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),xe(z)},className:"chat-input-wrap"},React.createElement("input",{ref:ke,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:z,onChange:t=>fe(t.target.value),disabled:be}),React.createElement("button",{type:"submit",className:"send-btn",disabled:be||!z.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),ge&&React.createElement("div",{className:"preview-modal",onClick:()=>ye(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>ye(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:ge.url,alt:ge.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},ge.name),ge.price&&React.createElement("div",{className:"price"},ge.price.replace(/[đ\s]/g,""),"\u0111"),ge.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},ge.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:x==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:x==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>V(ge.url,"preview")},React.createElement("i",{className:`fas ${x==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),ge.price&&React.createElement("button",{className:x==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>b(ge.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${x==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Oe,{show:Ie,product:Se,categories:$,onClose:()=>{ve(!1),De(null)},onSave:d}),React.createElement("div",{className:`fab-container mobile-only ${J?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{re(!1),ve(!0),De(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{re(!1),l&&l("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${J?"open":""}`,onClick:()=>re(!J)},React.createElement("i",{className:"fas fa-plus"}))),Le&&s&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>a(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:M.name,onChange:t=>ue({...M,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:M.code,onChange:t=>ue({...M,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:M.price,onChange:t=>ue({...M,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:M.category,onChange:t=>ue({...M,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Ee.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:M.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>ue({...M,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>a(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:e},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:g,showToast:l}){const[L,E]=useState([]),[C,i]=useState([]),[r,I]=useState(!0),[$,v]=useState(null),[P,K]=useState(!1),[x,A]=useState(null),[O,U]=useState(!1),[p,D]=useState(null),[Q,Z]=useState(null),[G,m]=useState([]);useEffect(()=>{F()},[]);const F=async(a=null)=>{I(!0);try{const s=a?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${a}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,J=await(await fetch(s)).json();E(Array.isArray(J)?J:[])}catch(s){console.error(s),l("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}I(!1)},H=async a=>{try{const k=await(await fetch(`${API_BASE}/api/videos?folderId=${a}`)).json();i(Array.isArray(k)?k:[])}catch(s){console.error(s)}},N=async a=>{if(a===0)return;const s=[...L];[s[a-1],s[a]]=[s[a],s[a-1]],E(s),await q(s)},ne=async a=>{if(a===L.length-1)return;const s=[...L];[s[a],s[a+1]]=[s[a+1],s[a]],E(s),await q(s)},q=async a=>{try{await Promise.all(a.map((s,k)=>fetch(`${API_BASE}/api/video-folders/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:k})}))),l("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(s){l("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),F(Q==null?void 0:Q.id)}},ae=async a=>{if(a===0)return;const s=[...C];[s[a-1],s[a]]=[s[a],s[a-1]],i(s),await te(s)},we=async a=>{if(a===C.length-1)return;const s=[...C];[s[a],s[a+1]]=[s[a+1],s[a]],i(s),await te(s)},te=async a=>{try{await Promise.all(a.map((s,k)=>fetch(`${API_BASE}/api/videos/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sort_order:k})}))),l("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(s){l("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),H($.id)}},ie=()=>{A(null),K(!0)},me=a=>{A(a),K(!0)},z=async a=>{try{!x&&Q&&(a.parent_id=Q.id);const s=x?`${API_BASE}/api/video-folders/${x.id}`:`${API_BASE}/api/video-folders`;if(!(await fetch(s,{method:x?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw new Error("L\u1ED7i l\u01B0u folder");l(x?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),K(!1),F(Q==null?void 0:Q.id)}catch(s){l(s.message,"danger")}},fe=async a=>{const s=a.subfolderCount>0?`X\xF3a folder "${a.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${a.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(s))try{await fetch(`${API_BASE}/api/video-folders/${a.id}`,{method:"DELETE"}),l("\u0110\xE3 x\xF3a folder","success"),v(null),F(Q==null?void 0:Q.id)}catch(k){l("L\u1ED7i x\xF3a folder","danger")}},be=a=>{a.subfolderCount>0?(m(s=>[...s,a]),Z(a),F(a.id)):(v(a),i(a.videos||[]))},ee=a=>{if(a==="root")m([]),Z(null),F(null);else if(a){const s=G.findIndex(k=>k.id===a.id);s>=0&&(m(G.slice(0,s+1)),Z(a),F(a.id))}else{const s=[...G];s.pop();const k=s[s.length-1]||null;m(s),Z(k),F(k==null?void 0:k.id)}},he=()=>{D(null),U(!0)},ke=a=>{D(a),U(!0)},ge=async a=>{try{a.folder_id=$==null?void 0:$.id;const s=p?`${API_BASE}/api/videos/${p.id}`:`${API_BASE}/api/videos`,k=await fetch(s,{method:p?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!k.ok){const J=await k.json();throw new Error(J.error||"L\u1ED7i l\u01B0u video")}l(p?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),U(!1),F(),$&&H($.id)}catch(s){l(s.message,"danger")}},ye=async a=>{if(confirm(`X\xF3a video "${a.title}"?`))try{await fetch(`${API_BASE}/api/videos/${a.id}`,{method:"DELETE"}),l("\u0110\xE3 x\xF3a video","success"),F(),$&&H($.id)}catch(s){l("L\u1ED7i x\xF3a video","danger")}},Le=a=>{const s=`https://www.youtube.com/watch?v=${a.youtubeId}`;navigator.clipboard.writeText(s).then(()=>{l("\u0110\xE3 copy link!","success")}).catch(()=>{l("Kh\xF4ng th\u1EC3 copy link","danger")})};return $?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>v(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${$.slug==="shorts"?"text-danger":"text-warning"}`}),$.name)),React.createElement("button",{className:"btn btn-warning",onClick:he},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),C.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},C.map((a,s)=>React.createElement("div",{key:a.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>ae(s),disabled:s===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},s+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>we(s),disabled:s===C.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:a.thumb,className:"card-img-top",alt:a.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${a.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:a.title},a.title),React.createElement("small",{className:"text-muted"},a.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Le(a),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>ke(a),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>ye(a),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:O,video:p,onClose:()=>U(!1),onSave:ge})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},Q&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ee()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),Q?Q.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:ie},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),G.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:a=>{a.preventDefault(),ee("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),G.map((a,s)=>React.createElement("li",{key:a.id,className:`breadcrumb-item ${s===G.length-1?"active":""}`},s===G.length-1?a.name:React.createElement("a",{href:"#",onClick:k=>{k.preventDefault(),ee(a)},className:"text-warning"},a.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),r?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):L.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},Q?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ie},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",Q?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},L.map((a,s)=>{var k,J,re,Ie;return React.createElement("div",{key:a.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ve=>{ve.stopPropagation(),N(s)},disabled:s===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},s+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ve=>{ve.stopPropagation(),ne(s)},disabled:s===L.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>be(a),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${a.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},a.name),React.createElement("p",{className:"text-muted mb-0"},a.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),a.subfolderCount," folder"),a.subfolderCount>0&&(a.videoCount>0||((k=a.videos)==null?void 0:k.length)>0)&&" \u2022 ",(a.videoCount>0||((J=a.videos)==null?void 0:J.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),a.videoCount||((re=a.videos)==null?void 0:re.length)||0," videos"),a.subfolderCount===0&&!a.videoCount&&!((Ie=a.videos)!=null&&Ie.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ve=>{ve.stopPropagation(),me(a)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ve=>{ve.stopPropagation(),fe(a)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:P,folder:x,onClose:()=>K(!1),onSave:z}))}function VideoFolderModal({show:g,folder:l,onClose:L,onSave:E}){const[C,i]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[r,I]=useState(!1),[$,v]=useState(!1);useEffect(()=>{i(l?{name:l.name||"",description:l.description||"",sortOrder:l.sortOrder||0,coverImage:l.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[l,g]);const P=async x=>{const A=x.target.files[0];if(!A)return;v(!0);const O=new FormData;O.append("file",A),O.append("upload_preset","ktm_unsigned");try{const p=await(await fetch("https://api.cloudinary.com/v1_1/diwxfpt92/image/upload",{method:"POST",body:O})).json();p.secure_url&&i(D=>({...D,coverImage:p.secure_url})),localStorage.removeItem(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(U){console.error("Cloudinary upload error:",U),alert("L\u1ED7i upload \u1EA3nh: "+(U.message||U))}finally{v(!1)}},K=async x=>{x.preventDefault(),I(!0),await E(C),I(!1)};return g?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},l?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:K},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:C.name,onChange:x=>i({...C,name:x.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:C.description,onChange:x=>i({...C,description:x.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:C.sortOrder,onChange:x=>i({...C,sortOrder:parseInt(x.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},C.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:C.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>i({...C,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:P,disabled:$}),$&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:C.coverImage,onChange:x=>i({...C,coverImage:x.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:r},r?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:g}){const[l,L]=useState([]),[E,C]=useState(!0),[i,r]=useState(!1),[I,$]=useState(null),[v,P]=useState(""),[K,x]=useState(""),A=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{O()},[]);const O=async()=>{C(!0);try{const F=await(await fetch(`${API_BASE}/api/products`)).json();L(Array.isArray(F)?F:[])}catch(m){console.error(m),g("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}C(!1)},U=()=>{$(null),r(!0)},p=m=>{$(m),r(!0)},D=async m=>{if(!(!m||!m.includes("cloudinary.com")))try{await fetch(`${API_BASE}/api/products?action=delete-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:m})}),localStorage.removeItem(CACHE_KEY),g(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),O()}catch(F){g("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},Q=async m=>{try{const F=I?`${API_BASE}/api/products?id=${I.id}`:`${API_BASE}/api/products`;if(!(await fetch(F,{method:I?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).ok)throw new Error("L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m");g(I?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),r(!1),O()}catch(F){g(F.message,"danger")}},Z=async m=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${m.name}"?`))try{if(!(await fetch(`${API_BASE}/api/products?id=${m.id}`,{method:"DELETE"})).ok)throw new Error("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m");g("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),O()}catch(F){g(F.message,"danger")}},G=l.filter(m=>{const F=!v||m.name.toLowerCase().includes(v.toLowerCase())||m.code&&m.code.toLowerCase().includes(v.toLowerCase()),H=!K||m.category===K;return F&&H});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:U},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:v,onChange:m=>P(m.target.value)})),React.createElement("span",{className:"product-count"},G.length)),React.createElement("select",{className:"form-select",value:K,onChange:m=>x(m.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),A.map(m=>React.createElement("option",{key:m,value:m},m)))),E?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):G.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:U},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},G.map(m=>React.createElement("div",{key:m.id,className:"product-item d-flex align-items-center gap-3"},m.image?React.createElement("img",{src:m.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},m.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},m.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},m.category),m.code&&React.createElement("span",{className:"product-badge bg-secondary"},m.code)),React.createElement("div",{className:"product-price"},m.price?m.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),m.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},m.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>p(m),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>Z(m),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:i,product:I,categories:A,onClose:()=>r(!1),onSave:Q}))}function ProductModal({show:g,product:l,categories:L,onClose:E,onSave:C}){const[i,r]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[I,$]=useState(!1),[v,P]=useState(!1);useEffect(()=>{r(l?{name:l.name||"",code:l.code||"",price:l.price||"",image:l.image||"",category:l.category||"",note:l.note||"",sort_order:l.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[l,g]);const[K,x]=React.useState(""),A=N=>{const ne=N.replace(/[^\d]/g,"");return ne?ne.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""},[O,U]=React.useState(""),p=N=>{const q=N.target.value.replace(/[^\d]/g,"");if(!q){r({...i,price:""}),U("");return}if(q===O&&q.length>0){const ae=q.slice(0,-1);ae?(r({...i,price:A(ae)}),U(ae)):(r({...i,price:""}),U(""));return}U(q),r({...i,price:A(q)})},[D,Q]=React.useState("");React.useEffect(()=>{l!=null&&l.image&&Q(l.image)},[l]);const Z=async N=>{if(!(!N||!N.includes("cloudinary.com")))try{await fetch(`${API_BASE}/api/products?action=delete-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:N})})}catch(ne){console.error("Delete cloudinary image error:",ne)}},G=async(N,ne=2,q)=>{const ae=ne*1024*1024,we=N.type==="image/heic"||N.type==="image/heif"||/\.heic$/i.test(N.name);if(N.size<=ae&&!we)return N;q==null||q("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const te=await createImageBitmap(N);q==null||q("\u0110ang n\xE9n \u1EA3nh...");const ie=document.createElement("canvas");let me=te.width,z=te.height;const fe=1200;return(me>fe||z>fe)&&(me>z?(z=Math.round(z/me*fe),me=fe):(me=Math.round(me/z*fe),z=fe)),ie.width=me,ie.height=z,ie.getContext("2d").drawImage(te,0,0,me,z),te.close(),new Promise((ee,he)=>{ie.toBlob(ke=>{ke?(q==null||q("Ho\xE0n t\u1EA5t!"),ee(new File([ke],N.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):he(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(te){throw console.error("createImageBitmap error:",te),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},m=async N=>{var ae,we;const ne=(ae=N.target.files)==null?void 0:ae[0];if(!ne)return;if(!(ne.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ne.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}P(!0),x("\u0110ang chu\u1EA9n b\u1ECB...");try{const te=(ne.size/1024/1024).toFixed(1);x(`File ${te}MB - \u0110ang n\xE9n...`);const ie=await G(ne,2,ee=>{x(ee)}),me=(ie.size/1024/1024).toFixed(1);x(`\u0110\xE3 n\xE9n: ${me}MB - \u0110ang upload...`);const z=new FormData;z.append("file",ie),z.append("upload_preset","ktm_unsigned");const be=await(await fetch("https://api.cloudinary.com/v1_1/diwxfpt92/image/upload",{method:"POST",body:z})).json();be.secure_url?(i.image&&i.image!==D&&Z(i.image),r(ee=>({...ee,image:be.secure_url})),x("")):(console.error("Cloudinary error:",be),alert("Upload th\u1EA5t b\u1EA1i: "+(((we=be.error)==null?void 0:we.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),x(""))}catch(te){console.error("Upload error:",te),alert("L\u1ED7i: "+te.message),x("")}P(!1),N.target.value=""},F=()=>{i.image&&(i.image!==D&&Z(i.image),r(N=>({...N,image:""})))},H=async N=>{N.preventDefault(),$(!0),D&&i.image&&D!==i.image&&await Z(D),D&&!i.image&&await Z(D),await C(i),$(!1)};return g?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${l?"fa-edit":"fa-plus-circle"} me-2`}),l?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:E})),React.createElement("form",{onSubmit:H},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},i.image?React.createElement(React.Fragment,null,React.createElement("img",{src:i.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:F,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${v?"fa-spinner fa-spin":"fa-camera"} me-1`}),v?K||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:m,disabled:v,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),v&&K&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},K))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:i.name,onChange:N=>r({...i,name:N.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:i.code,onChange:N=>r({...i,code:N.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:i.price,onChange:p,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:i.category,onChange:N=>r({...i,category:N.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),L.map(N=>React.createElement("option",{key:N,value:N},N)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:i.note,onChange:N=>r({...i,note:N.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:i.image,onChange:N=>r({...i,image:N.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:E,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:I,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},I?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:g,video:l,onClose:L,onSave:E}){const[C,i]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[r,I]=useState(!1),[$,v]=useState("");useEffect(()=>{l?(i({title:l.title||"",youtube_url:`https://www.youtube.com/watch?v=${l.youtubeId}`,thumbnail_url:l.thumb||"",sort_order:l.sortOrder||0}),v(l.thumb)):(i({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),v(""))},[l,g]);const P=A=>{const O=A.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return O?O[1]:null},K=A=>{i({...C,youtube_url:A});const O=P(A);O&&v(`https://img.youtube.com/vi/${O}/hqdefault.jpg`)},x=async A=>{A.preventDefault(),I(!0),await E(C),I(!1)};return g?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},l?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:x},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:C.youtube_url,onChange:A=>K(A.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),$&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:$,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:C.title,onChange:A=>i({...C,title:A.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:C.sort_order,onChange:A=>i({...C,sort_order:parseInt(A.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:C.thumbnail_url,onChange:A=>i({...C,thumbnail_url:A.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:r},r?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[g,l]=useState(!1),[L,E]=useState(""),[C,i]=useState(null),[r,I]=useState("search"),[$,v]=useState(null),[P,K]=useState(""),[x,A]=useState([]),[O,U]=useState(null),[p,D]=useState(!1),[Q,Z]=useState(null),[G,m]=useState(!0),[F,H]=useState([]),[N,ne]=useState(null),[q,ae]=useState([]);useEffect(()=>{const a=localStorage.getItem("ktm_admin_session");if(a)try{const s=JSON.parse(a);s.expiry>Date.now()?(l(!0),i(s.user)):localStorage.removeItem("ktm_admin_session")}catch(s){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{g&&z()},[g]);const we=async(a,s)=>{E("");try{const k=await fetch(`${API_BASE}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:s})}),J=await k.json();if(!k.ok)throw new Error(J.error||"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i");const re={user:J.user,token:J.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(re)),i(J.user),l(!0)}catch(k){E(k.message)}},te=()=>{localStorage.removeItem("ktm_admin_session"),l(!1),i(null),A([]),U(null)},ie=(a,s="success")=>{const k=Date.now();H(J=>[...J,{id:k,message:a,type:s}])},me=a=>{H(s=>s.filter(k=>k.id!==a))},z=async(a=null)=>{m(!0);try{const s=a?`${API_BASE}/api/albums?parent_id=${a}`:`${API_BASE}/api/albums?parent_id=root`,J=await(await fetch(s)).json();A(Array.isArray(J)?J:[])}catch(s){console.error(s),ie("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}m(!1)},fe=()=>{Z(null),D(!0)},be=a=>{Z(a),D(!0)},ee=async a=>{try{const s=Q&&Q.uuid;!s&&N&&(a.parent_id=N.uuid);const k=s?`${API_BASE}/api/albums/${Q.uuid||Q.id}`:`${API_BASE}/api/albums`,J=await fetch(k,{method:s?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!J.ok){const re=await J.json();throw new Error(re.error||(s?"L\u1ED7i c\u1EADp nh\u1EADt":"L\u1ED7i t\u1EA1o"))}ie(s?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),D(!1),z(N==null?void 0:N.uuid)}catch(s){ie(s.message,"danger")}},he=a=>{U(a)},ke=a=>{if(a==="root")ae([]),ne(null),z(null);else if(a){const s=q.findIndex(k=>k.uuid===a.uuid);s>=0&&(ae(q.slice(0,s+1)),ne(a),z(a.uuid))}else{const s=[...q];s.pop();const k=s[s.length-1]||null;ae(s),ne(k),z(k==null?void 0:k.uuid)}},ge=async a=>{const s=`X\xF3a folder "${a.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(s))try{await fetch(`${API_BASE}/api/albums/${a.uuid||a.id}`,{method:"DELETE"}),ie("\u0110\xE3 x\xF3a","success"),z(N==null?void 0:N.uuid)}catch(k){ie("L\u1ED7i x\xF3a album","danger")}};if(!g)return React.createElement(LoginPage,{onLogin:we,error:L});const ye=()=>{const a=new Date,s=a.getFullYear(),k=String(a.getMonth()+1).padStart(2,"0");return`${s}-${k}`};function Le(){const[a,s]=useState(ye()),[k,J]=useState(!0),[re,Ie]=useState([]),ve=e=>{if(!e)return 0;const c=String(e).replace(/[^0-9]/g,"");return c?Number(c):0},Se=e=>{if(!e)return null;const c=String(e),d=c.toLowerCase();if(d.includes("freeship")||d.includes("free ship")||d.includes("mi\u1EC5n ph\xED ship")||d.includes("mien phi ship")||d.includes("mi\u1EC5n ph\xED v\u1EADn chuy\u1EC3n")||d.includes("mien phi van chuyen"))return 0;const o=c.match(/(?:ship|vận\s*chuyển|van\s*chuyen|\bvc\b)\s*[:=\-]?\s*([0-9][0-9\.,\s]*)(?:\s*(k|nghìn|nghin|tr|triệu|trieu|m))?/i);if(!o)return null;const w=String(o[1]||"").replace(/[^0-9]/g,"");if(!w)return null;let T=Number(w);const B=String(o[2]||"").toLowerCase();return B==="k"||B.startsWith("ngh")?T*=1e3:(B==="tr"||B.startsWith("tri")||B==="m")&&(T*=1e6),Number.isFinite(T)?T:null},De=e=>{const c=Array.isArray(e)?e:[];let d=!1,o=0;for(const w of c){const T=Se(w==null?void 0:w.product_note);T!=null&&(d=!0,T>o&&(o=T))}return{found:d,fee:o}},M=e=>{try{return Number(e||0).toLocaleString("vi-VN")}catch(c){return String(e||0)}},ue=e=>`${M(e)}\u0111`,Ee=async()=>{J(!0);try{const c=await(await fetch(`${API_BASE}/api/orders?month=${encodeURIComponent(a)}`)).json();Ie(Array.isArray(c)?c:[])}catch(e){console.error("Load stats error:",e),Ie([])}finally{J(!1)}};useEffect(()=>{Ee()},[a]);const se=React.useMemo(()=>{const e={pending:0,processing:0,done:0,other:0};let c=0,d=0,o=0;const w=j=>j.customer_id||j.phone||"unknown",T=j=>Array.isArray(j==null?void 0:j.items)&&j.items.length?j.items:j!=null&&j.product_id?[{product_id:j.product_id,quantity:j.quantity,product_price:j.product_price,product_name:j.product_name,product_code:j.product_code,product_note:j.product_note}]:[],B=new Map,ce=new Map,n=new Map;for(const j of re){const pe=T(j);let t=0,u=0;for(const y of pe){const X=Number((y==null?void 0:y.quantity)||0)||0,oe=ve(y==null?void 0:y.product_price),le=X*oe;t+=X,u+=le;const W=(y==null?void 0:y.product_id)||"unknown",Ne=B.get(W)||{product_id:W,product_name:(y==null?void 0:y.product_name)||"\u2014",product_code:(y==null?void 0:y.product_code)||"",orders:0,quantity:0,revenue:0};Ne.orders+=1,Ne.quantity+=X,Ne.revenue+=le,B.set(W,Ne)}const h=De(pe),S=u+(h.found?h.fee:0);c+=t,d+=S,j.status==="pending"?e.pending+=1:j.status==="processing"?e.processing+=1:j.status==="done"?(e.done+=1,o+=S):e.other+=1;const R=w(j),_=ce.get(R)||{key:R,customer_name:j.customer_name||"",phone:j.phone||"",orders:0,quantity:0,revenue:0};_.orders+=1,_.quantity+=t,_.revenue+=S,!_.customer_name&&j.customer_name&&(_.customer_name=j.customer_name),!_.phone&&j.phone&&(_.phone=j.phone),ce.set(R,_);const f=j.created_at?new Date(j.created_at):null;if(f&&!Number.isNaN(f.getTime())){const y=`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}-${String(f.getDate()).padStart(2,"0")}`,X=n.get(y)||{day:y,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};X.orders+=1,X.quantity+=t,X.revenue+=S,j.status==="done"&&(X.doneOrders+=1,X.doneRevenue+=S),n.set(y,X)}}const b=Array.from(B.values()).sort((j,pe)=>pe.revenue-j.revenue),V=Array.from(ce.values()).sort((j,pe)=>pe.revenue-j.revenue),de=Array.from(n.values()).sort((j,pe)=>j.day.localeCompare(pe.day)),xe=ce.size,Oe=re.length?Math.round(d/re.length):0,_e=re.length?c/re.length:0;return{statusCounts:e,totalQty:c,totalRevenue:d,doneRevenue:o,products:b,customers:V,days:de,uniqueCustomers:xe,avgOrderValue:Oe,avgQtyPerOrder:_e}},[re,a]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:k}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:Ee,disabled:k},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:a,onChange:e=>s(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),M(re.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),M(se.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),M(se.totalQty)," SL"))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},M(re.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ue(se.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ue(se.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Gi\xE1 tr\u1ECB TB/\u0111\u01A1n"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ue(se.avgOrderValue))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",se.avgQtyPerOrder?se.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},M(se.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},M(se.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},M(se.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},M(se.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,M(se.statusCounts.pending)),React.createElement("td",null,M(se.statusCounts.processing)),React.createElement("td",null,M(se.statusCounts.done)),React.createElement("td",null,M(se.statusCounts.other)),React.createElement("td",null,M(se.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},se.products.slice(0,10).map(e=>React.createElement("div",{key:e.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},e.product_name),React.createElement("div",{className:"text-muted small text-truncate"},e.product_code?`#${e.product_code} \u2022 `:"",M(e.orders)," \u0111\u01A1n \u2022 ",M(e.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},ue(e.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,se.products.slice(0,10).map(e=>React.createElement("tr",{key:e.product_id},React.createElement("td",null,e.product_name),React.createElement("td",null,e.product_code||"\u2014"),React.createElement("td",null,M(e.orders)),React.createElement("td",null,M(e.quantity)),React.createElement("td",{className:"fw-semibold"},ue(e.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},se.customers.slice(0,10).map(e=>React.createElement("div",{key:e.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},e.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},e.phone||"\u2014"," \u2022 ",M(e.orders)," \u0111\u01A1n \u2022 ",M(e.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},ue(e.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,se.customers.slice(0,10).map(e=>React.createElement("tr",{key:e.key},React.createElement("td",null,e.customer_name||"\u2014"),React.createElement("td",null,e.phone||"\u2014"),React.createElement("td",null,M(e.orders)),React.createElement("td",null,M(e.quantity)),React.createElement("td",{className:"fw-semibold"},ue(e.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},se.days.map(e=>React.createElement("div",{key:e.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},e.day),React.createElement("div",{className:"text-muted small"},M(e.orders)," \u0111\u01A1n \u2022 ",M(e.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",M(e.doneOrders)," \u2022 ",ue(e.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},ue(e.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,se.days.map(e=>React.createElement("tr",{key:e.day},React.createElement("td",null,e.day),React.createElement("td",null,M(e.orders)),React.createElement("td",null,M(e.quantity)),React.createElement("td",{className:"fw-semibold"},ue(e.revenue)),React.createElement("td",null,M(e.doneOrders)),React.createElement("td",{className:"fw-semibold"},ue(e.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:r,onMenuChange:a=>{I(a),a==="albums"&&(ne(null),ae([]),z(null))},onLogout:te,currentUser:C}),React.createElement("div",{className:"main-content"},r==="albums"&&!O&&React.createElement(AlbumList,{albums:x,loading:G,currentFolder:N,breadcrumb:q,onSelect:he,onCreate:fe,onEdit:be,onDelete:ge,onBack:ke}),r==="search"&&React.createElement(SearchCenter,{showToast:ie,onNavigate:(a,s,k)=>{I(a),a==="orders"&&s==="create"&&(v(Date.now()),K((k==null?void 0:k.productId)||""))}}),r==="albums"&&O&&React.createElement(AlbumDetail,{album:O,parentAlbum:q.length>0?q[q.length-1]:null,onBack:()=>{if(O.parentId){const a=q.findIndex(s=>s.uuid===O.parentId);a>=0?U(q[a]):U(null)}else U(null)},onRefresh:()=>z(N==null?void 0:N.uuid),showToast:ie,onNavigateToFolder:a=>{ae(s=>[...s,O]),U(a)},onEditSubfolder:a=>{Z(a),D(!0)}}),r==="videos"&&React.createElement(VideoList,{showToast:ie}),r==="products"&&React.createElement(ProductManager,{showToast:ie}),r==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:$,autoOpenCreateProductId:P}),r==="stats"&&React.createElement(Le,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${r==="search"?"active":""}`,onClick:a=>{a.preventDefault(),I("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${r==="albums"?"active":""}`,onClick:a=>{a.preventDefault(),I("albums"),U(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${r==="videos"?"active":""}`,onClick:a=>{a.preventDefault(),I("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${r==="products"?"active":""}`,onClick:a=>{a.preventDefault(),I("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${r==="orders"?"active":""}`,onClick:a=>{a.preventDefault(),I("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${r==="stats"?"active":""}`,onClick:a=>{a.preventDefault(),I("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:p,album:Q,parentId:N==null?void 0:N.uuid,onClose:()=>D(!1),onSave:ee}),React.createElement("div",{className:"toast-container"},F.map(a=>React.createElement(Toast,{key:a.id,message:a.message,type:a.type,onClose:()=>me(a.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:g,autoOpenCreateProductId:l}){const[L,E]=useState([]),[C,i]=useState(!0),[r,I]=useState(!1),[$,v]=useState(null),[P,K]=useState(""),[x,A]=useState(!1),[O,U]=useState(null),[p,D]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],status:"pending"}),[Q,Z]=useState([]),[G,m]=useState(null),F=useRef(null),H=useRef(null),N=useRef(0),ne=useRef(null),q=useRef(0),ae=3,we=e=>{if(e==null)return 0;const c=String(e).replace(/[^0-9]/g,"");return c?Number(c):0},te=e=>{try{return`${Number(e||0).toLocaleString("vi-VN")}\u0111`}catch(c){return`${e||0}\u0111`}},ie=e=>{if(!e)return null;const c=String(e),d=c.toLowerCase();if(d.includes("freeship")||d.includes("free ship")||d.includes("mi\u1EC5n ph\xED ship")||d.includes("mien phi ship")||d.includes("mi\u1EC5n ph\xED v\u1EADn chuy\u1EC3n")||d.includes("mien phi van chuyen"))return 0;const o=c.match(/(?:ship|vận\s*chuyển|van\s*chuyen|\bvc\b)\s*[:=\-]?\s*([0-9][0-9\.,\s]*)(?:\s*(k|nghìn|nghin|tr|triệu|trieu|m))?/i);if(!o)return null;const w=String(o[1]||"").replace(/[^0-9]/g,"");if(!w)return null;let T=Number(w);const B=String(o[2]||"").toLowerCase();return B==="k"||B.startsWith("ngh")?T*=1e3:(B==="tr"||B.startsWith("tri")||B==="m")&&(T*=1e6),Number.isFinite(T)?T:null},me=e=>{const c=z(e);return c.length>=9&&c.length<=12},z=e=>e?String(e).replace(/[^0-9]/g,""):"",fe=async e=>{const c=z(e);if(!c)return;const d=++N.current;U({status:"loading",phone:c});try{const w=await(await fetch(`${API_BASE}/api/customers?phone=${encodeURIComponent(c)}`)).json();if(N.current!==d)return;if(w&&w.exists&&w.customer){U({status:"found",phone:c,customer:w.customer}),D(T=>z(T.phone)!==c?T:{...T,customer_name:w.customer.name||T.customer_name,address:w.customer.address||T.address});return}U({status:"not-found",phone:c})}catch(o){if(N.current!==d)return;console.error("Customer lookup error:",o),U({status:"error",phone:c})}},be=e=>{const c=z(e);if(D(o=>({...o,phone:c})),H.current&&(clearTimeout(H.current),H.current=null),c.length<ae){U(null);return}H.current=setTimeout(()=>{fe(c)},350)},ee=()=>{const e=z(p.phone);e.length<ae||fe(e)};useEffect(()=>(x?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[x]);const he=Array.isArray(p.items)?p.items.length:0;useEffect(()=>{if(!x){q.current=he;return}he>q.current&&setTimeout(()=>{const e=ne.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),q.current=he},[x,he]),useEffect(()=>()=>{H.current&&(clearTimeout(H.current),H.current=null)},[]),useEffect(()=>{a()},[]),useEffect(()=>{s()},[P]),useEffect(()=>{g&&F.current!==g&&(F.current=g,re(l))},[g]);const ke=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e||"",ge=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":"bg-light text-dark",ye=React.useMemo(()=>{const e={pending:0,processing:1,done:2},c=o=>o in e?e[o]:99,d=o=>{if(!o)return Number.POSITIVE_INFINITY;const w=new Date(o).getTime();return Number.isFinite(w)?w:Number.POSITIVE_INFINITY};return[...L||[]].sort((o,w)=>{const T=c(o==null?void 0:o.status),B=c(w==null?void 0:w.status);if(T!==B)return T-B;const ce=d(o==null?void 0:o.created_at),n=d(w==null?void 0:w.created_at);if(ce!==n)return ce-n;const b=Number(o==null?void 0:o.id),V=Number(w==null?void 0:w.id);return Number.isFinite(b)&&Number.isFinite(V)?b-V:String((o==null?void 0:o.id)||"").localeCompare(String((w==null?void 0:w.id)||""))})},[L]),Le=e=>{if(!e)return"";const c=new Date(e);if(Number.isNaN(c.getTime()))return String(e);try{return c.toLocaleString("vi-VN")}catch(d){return c.toISOString()}},a=async()=>{try{const c=await(await fetch(`${API_BASE}/api/products`)).json();Z(Array.isArray(c)?c:[])}catch(e){console.error("Load products error:",e),Z([])}},s=async()=>{i(!0);try{let e=`${API_BASE}/api/orders`;P&&(e+=`?month=${P}`);const d=await(await fetch(e)).json();E(Array.isArray(d)?d:[])}catch(e){console.error("Load orders error:",e),E([])}finally{i(!1)}},k=async()=>{const e=z(p.phone),d=(Array.isArray(p.items)?p.items:[]).map(o=>{var w;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((w=o==null?void 0:o.quantity)!=null?w:1)}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0);if(!p.customer_name||!e||d.length===0){alert("Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c");return}if(!me(e)){alert("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)");return}I(!0);try{const o=G?"PUT":"POST",w=G?`${API_BASE}/api/orders/${G}`:`${API_BASE}/api/orders`,T=d[0];await fetch(w,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_name:p.customer_name,phone:e,address:p.address,product_id:T.product_id,quantity:T.quantity,status:p.status,items:d,...G?{id:G}:{}})}),D({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],status:"pending"}),m(null),A(!1),s()}finally{I(!1)}},J=e=>{m(e.id);const c=Array.isArray(e.items)&&e.items.length?e.items.map(d=>{var o;return{product_id:(d==null?void 0:d.product_id)||"",quantity:Number((o=d==null?void 0:d.quantity)!=null?o:1)||1}}).filter(d=>d.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];D({customer_name:e.customer_name||"",phone:z(e.phone||""),address:e.address||"",items:c.length?c:[{product_id:"",quantity:1}],status:e.status||"pending"}),U(null),A(!0),e.phone&&fe(z(e.phone))};function re(e){m(null),D({customer_name:"",phone:"",address:"",items:[{product_id:e||"",quantity:1}],status:"pending"}),U(null),A(!0)}const Ie=()=>{r||(A(!1),m(null),D({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],status:"pending"}),U(null))},ve=e=>Array.isArray(e==null?void 0:e.items)&&e.items.length?e.items:e!=null&&e.product_id?[{product_id:e.product_id,quantity:Number(e.quantity||1)||1,product_name:e.product_name}]:[],Se=e=>{var w,T;const d=ve(e).reduce((B,ce)=>B+(Number((ce==null?void 0:ce.quantity)||0)||0),0);if(d>0)return d;const o=Number((T=(w=e==null?void 0:e.total_quantity)!=null?w:e==null?void 0:e.quantity)!=null?T:0);return Number.isFinite(o)?o:0},De=e=>{const c=ve(e);if(!c.length)return"\u2014";const d=c.map(o=>{const w=o==null?void 0:o.product_name;if(w)return String(w);const T=String((o==null?void 0:o.product_id)||""),B=Q.find(ce=>String(ce==null?void 0:ce.id)===T);return B!=null&&B.name?String(B.name):""}).filter(Boolean);return d.length?d.join(" + "):(e==null?void 0:e.product_name)||"\u2014"},M=e=>{var w,T;const c=Array.isArray(e)?e:[];let d=!1,o=0;for(const B of c){const ce=String((B==null?void 0:B.product_id)||""),n=Q.find(de=>String(de==null?void 0:de.id)===ce),b=(T=(w=B==null?void 0:B.product_note)!=null?w:n==null?void 0:n.note)!=null?T:null,V=ie(b);V!=null&&(d=!0,V>o&&(o=V))}return{found:d,fee:o}},ue=e=>(Array.isArray(e)?e:[]).reduce((d,o)=>{var n;const w=Number((o==null?void 0:o.quantity)||0)||0,T=String((o==null?void 0:o.product_id)||""),B=Q.find(b=>String(b==null?void 0:b.id)===T),ce=we((n=o==null?void 0:o.product_price)!=null?n:B==null?void 0:B.price);return d+w*ce},0),Ee=e=>{const c=ve(e),d=ue(c),o=M(c).fee;return d+o},se=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){v(e);try{await fetch(`${API_BASE}/api/orders/${e}`,{method:"DELETE"}),s()}finally{v(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:C&&!x||r||!!$}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:re,disabled:r||!!$},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:P,onChange:e=>K(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),P&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{K("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:C},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:s,disabled:C},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},L.length," \u0111\u01A1n")),C?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):L.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},ye.map(e=>React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"text-muted small"},e.phone),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address)),React.createElement("span",{className:`badge ${ge(e.status)}`},ke(e.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:")," ",React.createElement("span",{className:"fw-semibold"},De(e))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},Se(e))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},te(Ee(e)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",Le(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>J(e),disabled:r||!!$},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>se(e.id),disabled:r||$===e.id},$===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,ye.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,De(e)),React.createElement("td",null,Se(e)),React.createElement("td",{className:"fw-semibold"},te(Ee(e))),React.createElement("td",null,React.createElement("span",{className:`badge ${ge(e.status)}`},ke(e.status))),React.createElement("td",null,Le(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>J(e),disabled:r||!!$},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>se(e.id),disabled:r||$===e.id},$===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),x&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),G?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Ie})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),k()}},React.createElement("div",{className:"modal-body",ref:ne},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:p.customer_name,onChange:e=>D({...p,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",value:p.phone,onChange:e=>be(e.target.value),onBlur:ee,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),(O==null?void 0:O.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(O==null?void 0:O.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(O==null?void 0:O.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(O==null?void 0:O.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:p.status,onChange:e=>D({...p,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:p.address,onChange:e=>D({...p,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>D(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),disabled:r},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(p.items)?p.items:[{product_id:"",quantity:1}]).map((e,c)=>React.createElement("div",{key:c,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("select",{className:"form-select",value:e.product_id,onChange:d=>{const o=d.target.value;D(w=>{const T=Array.isArray(w.items)?[...w.items]:[];return T[c]={...T[c]||{quantity:1},product_id:o},{...w,items:T}})},required:!0,style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Q.map(d=>React.createElement("option",{key:d.id,value:d.id},d.name)))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:d=>{const o=d.target.value;D(w=>{const T=Array.isArray(w.items)?[...w.items]:[];return T[c]={...T[c]||{product_id:""},quantity:o},{...w,items:T}})},min:"1",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>D(d=>{const o=Array.isArray(d.items)?[...d.items]:[];return o.splice(c,1),{...d,items:o.length?o:[{product_id:"",quantity:1}]}}),disabled:r||(Array.isArray(p.items)?p.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const c=(Array.isArray(p.items)?p.items:[]).filter(T=>T==null?void 0:T.product_id),d=ue(c),o=M(c),w=d+(o.found?o.fee:0);return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},te(d))),o.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},te(o.fee))),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},te(w)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Ie,disabled:r,style:{borderRadius:10}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:r,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},r?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

