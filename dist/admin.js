const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:A,error:_}){const[O,ee]=useState(""),[z,E]=useState(""),[F,fe]=useState(!1),[ve,se]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),_&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),_),React.createElement("form",{onSubmit:async He=>{He.preventDefault(),fe(!0),await A(O,z),fe(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:O,onChange:He=>ee(He.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:ve?"text":"password",className:"form-control",value:z,onChange:He=>E(He.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>se(!ve)},React.createElement("i",{className:`fas fa-eye${ve?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:F},F?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:A,type:_,onClose:O,actionLabel:ee,onAction:z,durationMs:E}){return useEffect(()=>{const F=Number(E),fe=Number.isFinite(F)&&F>0?F:3e3,ve=setTimeout(O,fe);return()=>clearTimeout(ve)},[O,E]),React.createElement("div",{className:`toast show align-items-center text-white bg-${_} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},A),ee&&typeof z=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{z()}finally{O()}}},ee),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:O})))}function Loading({show:A}){return A?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:A,title:_,subtitle:O,onClose:ee,footer:z,children:E}){return useEffect(()=>{if(!A)return;const F=fe=>{fe.key==="Escape"&&(fe.preventDefault(),typeof ee=="function"&&ee())};return document.addEventListener("keydown",F),()=>document.removeEventListener("keydown",F)},[A,ee]),A?React.createElement("div",{className:`admin-drawer-root ${A?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:ee,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},_),O?React.createElement("div",{className:"admin-drawer-subtitle"},O):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:ee,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},E),z?React.createElement("div",{className:"admin-drawer-footer"},z):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(A){try{const _=localStorage.getItem(A);if(!_)return[];const O=JSON.parse(_);return Array.isArray(O)?O.map(ee=>String(ee||"").trim()).filter(Boolean):[]}catch(_){return[]}}function saveAdminMenuIdsToStorage(A,_){try{localStorage.setItem(A,JSON.stringify(Array.isArray(_)?_:[]))}catch(O){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(A){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,A),A}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(A){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,A),A}function Sidebar({activeMenu:A,onMenuChange:_,onLogout:O,currentUser:ee,pinnedMenus:z,recentMenus:E,onTogglePin:F}){const fe=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],ve=(ee==null?void 0:ee.username)||(ee==null?void 0:ee.name)||(ee==null?void 0:ee.email)||"Admin",se=useMemo(()=>{const Ne=new Map;for(const L of fe)Ne.set(L.id,L);return Ne},[]),ke=Array.isArray(z)?z:[],He=Array.isArray(E)?E:[],ye=ke.map(Ne=>se.get(Ne)).filter(Boolean),xe=He.filter(Ne=>Ne!==A).map(Ne=>se.get(Ne)).filter(Boolean).slice(0,5),qe=Ne=>ke.includes(Ne);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},ve),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},ye.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},ye.map(Ne=>React.createElement("a",{key:`pin-${Ne.id}`,href:"#",className:`nav-link ${A===Ne.id?"active":""} sidebar-quicklink`,onClick:L=>{L.preventDefault(),_(Ne.id)}},React.createElement("i",{className:`fas ${Ne.icon}`})," ",Ne.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:L=>{L.preventDefault(),L.stopPropagation(),F&&F(Ne.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),xe.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},xe.map(Ne=>React.createElement("a",{key:`recent-${Ne.id}`,href:"#",className:`nav-link ${A===Ne.id?"active":""} sidebar-quicklink`,onClick:L=>{L.preventDefault(),_(Ne.id)}},React.createElement("i",{className:`fas ${Ne.icon}`})," ",Ne.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),fe.map(Ne=>React.createElement("a",{key:Ne.id,href:"#",className:`nav-link ${A===Ne.id?"active":""} ${Ne.disabled?"opacity-50":""} ${Ne.highlight?"text-warning":""}`,onClick:L=>{L.preventDefault(),Ne.disabled||_(Ne.id)}},React.createElement("i",{className:`fas ${Ne.icon}`})," ",Ne.label,Ne.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),Ne.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${qe(Ne.id)?"pinned":""}`,onClick:L=>{L.preventDefault(),L.stopPropagation(),F&&F(Ne.id)},title:qe(Ne.id)?"B\u1ECF ghim":"Ghim","aria-label":qe(Ne.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),O&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:O,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(A){const _=typeof A=="number"?A:parseFloat(String(A!=null?A:"").trim());return Number.isFinite(_)?Math.max(0,Math.min(100,_)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var A;try{const _=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!_)return{ship_percent:DEFAULT_SHIP_PERCENT};const O=JSON.parse(_);return{ship_percent:normalizeShipPercent((A=O==null?void 0:O.ship_percent)!=null?A:O==null?void 0:O.shipPercent)}}catch(_){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(A){var _;try{const O={ship_percent:normalizeShipPercent((_=A==null?void 0:A.ship_percent)!=null?_:A==null?void 0:A.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(O)),O}catch(O){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var _;const A=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((_=A==null?void 0:A.ship_percent)!=null?_:A==null?void 0:A.shipPercent)}}async function saveAdminSettingsToServer(A){var ee,z,E;const _={ship_percent:normalizeShipPercent((ee=A==null?void 0:A.ship_percent)!=null?ee:A==null?void 0:A.shipPercent)},O=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,_,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((E=(z=O==null?void 0:O.ship_percent)!=null?z:O==null?void 0:O.shipPercent)!=null?E:_.ship_percent)}}function AlbumList({albums:A,onSelect:_,onCreate:O,onEdit:ee,onDelete:z,loading:E,currentFolder:F,onBack:fe,breadcrumb:ve}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},F&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:fe},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),F?F.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:O},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),ve&&ve.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:se=>{se.preventDefault(),fe("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ve.map((se,ke)=>React.createElement("li",{key:se.id,className:`breadcrumb-item ${ke===ve.length-1?"active":""}`},ke===ve.length-1?se.title:React.createElement("a",{href:"#",onClick:He=>{He.preventDefault(),fe(se)},className:"text-warning"},se.title))))),E?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):A.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},F?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},A.map(se=>React.createElement("div",{key:se.uuid||se.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>_(se)},se.cover?React.createElement("img",{src:se.cover,className:"album-cover",alt:se.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},se.title),React.createElement("small",{className:"text-muted"},se.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),se.subfolderCount),se.subfolderCount>0&&se.count>0&&" \u2022 ",se.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),se.count),se.subfolderCount===0&&se.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:ke=>{ke.stopPropagation(),ee(se)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:ke=>{ke.stopPropagation(),z(se)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:A,album:_,onClose:O,onSave:ee,parentId:z}){const[E,F]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[fe,ve]=useState(!1),[se,ke]=useState(!1),He=useRef(null);useEffect(()=>{F(_?{slug:_.id||"",title:_.title||"",description:_.description||"",cover_url:_.cover||"",parent_id:_.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:z||null})},[_,A,z]);const ye=async L=>{L.preventDefault(),ve(!0),await ee(E),ve(!1)},xe=L=>L.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),qe=async L=>{const rt=L.type==="image/heic"||L.type==="image/heif"||/\.heic$/i.test(L.name);if(L.size<=2097152&&!rt)return L;try{const Ye=await createImageBitmap(L),Se=document.createElement("canvas");let Ie=Ye.width,de=Ye.height;const Je=800;return(Ie>Je||de>Je)&&(Ie>de?(de=Math.round(de/Ie*Je),Ie=Je):(Ie=Math.round(Ie/de*Je),de=Je)),Se.width=Ie,Se.height=de,Se.getContext("2d").drawImage(Ye,0,0,Ie,de),Ye.close(),new Promise((At,Me)=>{Se.toBlob(ot=>{ot?At(new File([ot],L.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Me(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Ye){throw console.error("Compress cover error:",Ye),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ne=async L=>{var Ye;const Xe=L.target.files[0];if(!Xe)return;if(!(Xe.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Xe.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ke(!0);try{const Se=await qe(Xe),Ie=await window.KTM.cloudinary.uploadImage({file:Se,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Ie.secure_url)throw console.error("Cloudinary error:",Ie),new Error(((Ye=Ie.error)==null?void 0:Ye.message)||"Upload failed");F(de=>({...de,cover_url:Ie.secure_url}))}catch(Se){console.error("Cover upload error:",Se),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Se.message)}ke(!1),L.target.value=""};return A?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},_?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:O})),React.createElement("form",{onSubmit:ye},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:E.title,onChange:L=>F({...E,title:L.target.value,slug:E.slug||xe(L.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:E.slug,onChange:L=>F({...E,slug:L.target.value}),required:!0,disabled:!!_}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:E.description,onChange:L=>F({...E,description:L.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},E.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:E.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>F(L=>({...L,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:He,type:"file",accept:"image/*",className:"d-none",onChange:Ne}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var L;return(L=He.current)==null?void 0:L.click()},disabled:se},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:E.cover_url,onChange:L=>F({...E,cover_url:L.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:O},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:fe||se},fe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:A,allAlbums:_,currentAlbumId:O,targetAlbum:ee,onSelect:z,level:E=0}){const[F,fe]=useState(!0),ve=A.uuid||A.id,se=ve===O,ke=ee===ve,He=_.filter(xe=>xe.parentId===ve),ye=He.length>0;return React.createElement("div",{style:{marginLeft:E*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${ke?"bg-info text-white":se?"bg-light text-muted":"hover-bg"}`,style:{cursor:se?"not-allowed":"pointer",opacity:se?.5:1,transition:"background 0.2s"},onClick:()=>!se&&z(ve)},ye&&React.createElement("i",{className:`fas fa-chevron-${F?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:xe=>{xe.stopPropagation(),fe(!F)}}),!ye&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${ke?"-open":""} me-2 ${ke?"":"text-warning"}`}),React.createElement("span",{className:"small"},A.title),se&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),A.count>0&&!se&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},A.count)),F&&ye&&React.createElement("div",null,He.map(xe=>React.createElement(FolderTreeItem,{key:xe.uuid||xe.id,folder:xe,allAlbums:_,currentAlbumId:O,targetAlbum:ee,onSelect:z,level:E+1}))))}function AlbumDetail({album:A,onBack:_,onRefresh:O,showToast:ee,onNavigateToFolder:z,onEditSubfolder:E,parentAlbum:F}){const[fe,ve]=useState([]),[se,ke]=useState([]),[He,ye]=useState(!0),[xe,qe]=useState(!1),[Ne,L]=useState(""),[Xe,rt]=useState([]),[Ye,Se]=useState([]),[Ie,de]=useState({}),[Je,ht]=useState(null),[At,Me]=useState(!1),[ot,yt]=useState(""),[w,y]=useState(!1),I=useRef(null),te=useRef(null),[ae,G]=useState(!1),[Z,me]=useState([]),[v,$]=useState([]),[B,ne]=useState(""),[he,oe]=useState(!1),Ae=async(M,d=2)=>{const D=d*1024*1024,V=M.type==="image/heic"||M.type==="image/heif"||/\.heic$/i.test(M.name);if(M.size<=D&&!V)return M;try{const ue=await createImageBitmap(M),be=document.createElement("canvas");let Ce=ue.width,Ge=ue.height;const Te=1200;return(Ce>Te||Ge>Te)&&(Ce>Ge?(Ge=Math.round(Ge/Ce*Te),Ce=Te):(Ce=Math.round(Ce/Ge*Te),Ge=Te)),be.width=Ce,be.height=Ge,be.getContext("2d").drawImage(ue,0,0,Ce,Ge),ue.close(),new Promise((bt,_t)=>{be.toBlob(Ht=>{Ht?bt(new File([Ht],M.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):_t(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ue){throw console.error("Compress error:",ue),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{_e(),Qe()},[A.id,A.uuid]);const _e=async()=>{ye(!0);try{const M=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${A.uuid||A.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ve(M.images||[]);const d=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${A.uuid||A.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ke(Array.isArray(d)?d:[])}catch(M){console.error(M),ee("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}ye(!1)},Qe=async()=>{try{const M=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");$(Array.isArray(M)?M:[])}catch(M){console.error("Error loading albums:",M)}},mt=M=>{me(d=>d.includes(M)?d.filter(D=>D!==M):[...d,M])},re=async()=>{if(!B||Z.length===0){ee("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}oe(!0);let M=0;for(const d of Z)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${d}`,{album_id:B},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),M++}catch(D){console.error("Move error:",D)}oe(!1),G(!1),me([]),ne(""),M>0?(ee("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),_e(),O()):ee("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Ke,xt]=useState(!1),Ze=async()=>{if(Z.length===0||!confirm(`X\xF3a ${Z.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;xt(!0);let M=0;for(const d of Z)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${d}`,"L\u1ED7i x\xF3a \u1EA3nh"),M++}catch(D){console.error("Delete error:",D)}xt(!1),me([]),M>0?(ee(`\u0110\xE3 x\xF3a ${M} \u1EA3nh!`,"success"),_e(),O()):ee("X\xF3a th\u1EA5t b\u1EA1i","danger")},jt=()=>{Z.length===fe.length?me([]):me(fe.map(M=>M.id))},St=async()=>{if(ot.trim()){y(!0);try{const M=ot.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:M+"-"+Date.now(),title:ot,parent_id:A.uuid||A.id},"L\u1ED7i t\u1EA1o folder"),ee("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),yt(""),Me(!1),_e(),O()}catch(M){ee(M.message,"danger")}y(!1)}},Wt=async M=>{if(confirm(`X\xF3a folder "${M.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${M.uuid||M.id}`,"L\u1ED7i x\xF3a folder"),ee("\u0110\xE3 x\xF3a folder","success"),_e(),O()}catch(d){ee("L\u1ED7i x\xF3a folder","danger")}},Kt=M=>{const d=Array.from(M).filter(D=>D.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(D.name));rt(D=>[...D,...d]),d.forEach(D=>{const V=new FileReader;V.onload=ue=>{Se(be=>[...be,{file:D,preview:ue.target.result}])},V.readAsDataURL(D)})},S=M=>{rt(d=>d.filter((D,V)=>V!==M)),Se(d=>d.filter((D,V)=>V!==M))},X=async M=>{var D;const d=await window.KTM.cloudinary.uploadImage({file:M,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${A.id}`});if(!d.secure_url)throw console.error("Cloudinary error:",d),new Error(((D=d.error)==null?void 0:D.message)||"Upload failed");return d},Be=async()=>{if(Xe.length===0)return;qe(!0);let M=0;for(let d=0;d<Xe.length;d++)try{L(`\u0110ang x\u1EED l\xFD ${d+1}/${Xe.length}...`);const D=await Ae(Xe[d],2);L(`\u0110ang upload ${d+1}/${Xe.length}...`);const V=await X(D);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${A.id}`,{url:V.secure_url,caption:Ie[d]||Xe[d].name.replace(/\.[^/.]+$/,""),sort_order:fe.length+d},"L\u1ED7i l\u01B0u \u1EA3nh"),M++}catch(D){console.error("Upload error:",D)}qe(!1),L(""),rt([]),Se([]),de({}),M>0?(ee(`\u0110\xE3 upload ${M} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),_e(),O()):ee("Upload th\u1EA5t b\u1EA1i","danger")},ut=async(M,d)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${M}`,"L\u1ED7i x\xF3a \u1EA3nh"),ee("\u0110\xE3 x\xF3a \u1EA3nh","success"),_e(),O()}catch(D){ee("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Ft=M=>{var d;M.preventDefault(),(d=te.current)==null||d.classList.add("dragover")},ft=()=>{var M;(M=te.current)==null||M.classList.remove("dragover")},kt=M=>{var d;M.preventDefault(),(d=te.current)==null||d.classList.remove("dragover"),Kt(M.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:_},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},A.title),React.createElement("small",{className:"text-muted"},se.length>0&&React.createElement("span",null,se.length," folder \u2022 "),fe.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Me(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),At&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:ot,onChange:M=>yt(M.target.value),onKeyPress:M=>M.key==="Enter"&&St(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:St,disabled:w||!ot.trim()},w?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Me(!1),yt("")}},"H\u1EE7y")))),se.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},se.map(M=>React.createElement("div",{key:M.uuid||M.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>z&&z(M)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},M.title),React.createElement("small",{className:"text-muted"},M.subfolderCount>0&&React.createElement("span",null,M.subfolderCount," folder"),M.subfolderCount>0&&M.count>0&&" \u2022 ",M.count>0&&React.createElement("span",null,M.count," \u1EA3nh"),M.subfolderCount===0&&M.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:d=>{d.stopPropagation(),E&&E(M)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:d=>{d.stopPropagation(),Wt(M)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:te,className:"upload-zone",onClick:()=>{var M;return(M=I.current)==null?void 0:M.click()},onDragOver:Ft,onDragLeave:ft,onDrop:kt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:I,type:"file",multiple:!0,accept:"image/*",onChange:M=>Kt(M.target.files)})),Ye.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Ye.map((M,d)=>React.createElement("div",{key:d,className:"upload-preview-item"},React.createElement("img",{src:M.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>S(d)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Be,disabled:xe},xe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Ne||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Xe.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",fe.length,")"),fe.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:jt},Z.length===fe.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),Z.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},Z.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>G(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Ze,disabled:Ke},Ke?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>me([])},React.createElement("i",{className:"fas fa-times"})))),He?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):fe.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},fe.map((M,d)=>React.createElement("div",{key:d,className:`image-item ${Z.includes(M.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>mt(M.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:Z.includes(M.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:Z.includes(M.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},Z.includes(M.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:M.src,alt:M.caption,style:{opacity:Z.includes(M.id)?.7:1,border:Z.includes(M.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:D=>{D.stopPropagation(),ut(M.id,d)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),M.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},M.caption)))))),ae&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",Z.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>G(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},v.filter(M=>!M.parentId).map(M=>React.createElement(FolderTreeItem,{key:M.uuid||M.id,folder:M,allAlbums:v,currentAlbumId:A.uuid||A.id,targetAlbum:B,onSelect:ne})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>G(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:re,disabled:!B||he},he?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Je&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>ht(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>ht(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Je.src,alt:Je.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:M=>M.stopPropagation()}),Je.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Je.caption)))))}function SearchCenter({showToast:A,onNavigate:_}){const[O,ee]=useState(""),[z,E]=useState([]),[F,fe]=useState([]),[ve,se]=useState([]),[ke,He]=useState("all"),[ye,xe]=useState(null),[qe,Ne]=useState("list"),[L,Xe]=useState(!0),[rt,Ye]=useState([]),[Se,Ie]=useState([]),de=useRef(null),[Je,ht]=useState(!0),[At,Me]=useState(!1),ot=useRef(null),yt=useRef(null),w=useRef(null),[y,I]=useState(!1),[te,ae]=useState([]),[G,Z]=useState([]),[me,v]=useState(""),$=useRef(null),B=useRef(new Map),[ne,he]=useState("auto"),[oe,Ae]=useState({start:0,end:20}),[_e,Qe]=useState(!1),[mt,re]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[Ke,xt]=useState(""),[Ze,jt]=useState(!1),St=useRef(null),Wt=useRef(null),Kt=s=>s?String(s).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",S=s=>s?String(s).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",X=(s,p)=>{if(!s||!p)return s;const u=new RegExp(`(${p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return s.replace(u,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const s=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),p=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");ae(Array.isArray(s)?s.slice(0,10):[]),Z(Array.isArray(p)?p:[])}catch(s){}},[]);const Be=s=>{if(!s.trim())return;const p=[s,...te.filter(u=>u!==s)].slice(0,10);ae(p);try{localStorage.setItem("ktm_search_history",JSON.stringify(p))}catch(u){}},ut=s=>{if(!s.trim())return;const p=G.includes(s)?G.filter(u=>u!==s):[s,...G].slice(0,5);Z(p);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(p))}catch(u){}},Ft="ktm_search_query_stats_v1",ft="ktm_search_product_stats_v1",kt=(s,p)=>{try{const u=localStorage.getItem(s);if(!u)return p;const T=JSON.parse(u);return T!=null?T:p}catch(u){return p}},M=(s,p)=>{try{localStorage.setItem(s,JSON.stringify(p))}catch(u){}},[d,D]=useState(()=>kt(Ft,{})),[V,ue]=useState(()=>kt(ft,{})),be=useRef(!1),Ce=useRef(new Map);useEffect(()=>{const s=p=>{p&&(p.key===Ft&&D(kt(Ft,{})),p.key===ft&&ue(kt(ft,{})))};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const Ge=s=>{const p=String(s||"").trim();if(!p)return;const u=gt(p).trim();if(u.length<3||u==="sdt:"||u==="#"||u.endsWith(":"))return;const T=Date.now(),P=kt(Ft,d&&typeof d=="object"?d:{}),C={...P&&typeof P=="object"?P:{}},g=C[u]&&typeof C[u]=="object"?C[u]:{};C[u]={q:p,count:(Number(g.count)||0)+1,lastAt:T},D(C),M(Ft,C)},Te=(s,p)=>{if(!s||s._type!=="product")return;const u=String(s.id||"").trim();if(!u)return;const T=Date.now(),P=kt(ft,V&&typeof V=="object"?V:{}),C={...P&&typeof P=="object"?P:{}},g=C[u]&&typeof C[u]=="object"?C[u]:{};C[u]={id:u,name:String(s.name||g.name||"").trim(),code:String(s.code||g.code||"").trim(),count:(Number(g.count)||0)+1,lastAt:T,action:String(p||g.action||"").trim()},ue(C),M(ft,C)},Pt=(s,p)=>{const u=String(s||"").trim();if(!u)return;const T=gt(u).trim();if(T.length<3||T==="sdt:"||T==="#"||T.endsWith(":"))return;const P=Date.now(),C=Number(Ce.current.get(T)||0);if(P-C<3e4)return;const W=(Array.isArray(p)?p:[]).find(le=>le&&le._type==="product");W&&(Ce.current.set(T,P),Te(W,"search"))},bt=useMemo(()=>Object.values(d&&typeof d=="object"?d:{}).map(u=>({q:String((u==null?void 0:u.q)||"").trim(),count:Number(u==null?void 0:u.count)||0,lastAt:Number(u==null?void 0:u.lastAt)||0})).filter(u=>u.q&&u.count>0).sort((u,T)=>T.count-u.count||T.lastAt-u.lastAt).slice(0,6),[d]),_t=useMemo(()=>Object.values(V&&typeof V=="object"?V:{}).map(u=>({id:String((u==null?void 0:u.id)||"").trim(),name:String((u==null?void 0:u.name)||"").trim(),code:String((u==null?void 0:u.code)||"").trim(),count:Number(u==null?void 0:u.count)||0,lastAt:Number(u==null?void 0:u.lastAt)||0})).filter(u=>u.id&&u.count>0).sort((u,T)=>T.count-u.count||T.lastAt-u.lastAt).slice(0,8).map(u=>{const T=F.find(P=>P&&P._type==="product"&&String(P.id)===u.id);return T?{...u,item:T}:{...u,item:null}}),[V,F]),Ht=(s,p={})=>{const u=String(s||"");Gt(u),p.addToHistory!==!1&&Be(u),I(!1),ma(!1),nt(!1),p.focus!==!1?(be.current=!0,setTimeout(()=>{var C;const P=de.current;(C=P==null?void 0:P.focus)==null||C.call(P);try{if(p.caret==="end"&&P&&typeof P.setSelectionRange=="function"){const g=String(P.value||"").length;P.setSelectionRange(g,g)}}catch(g){}},0)):(be.current=!1,setTimeout(()=>{var P,C,g,W;try{(C=(P=de.current)==null?void 0:P.blur)==null||C.call(P),(W=(g=document.activeElement)==null?void 0:g.blur)==null||W.call(g)}catch(le){}},0))},[Lt,Rt]=useState(null),[ka,ra]=useState(!1),[zt,Ut]=useState(null),[ha,nt]=useState(!1),[Aa,oa]=useState(!1),[Xt,fa]=useState(null),[Tt,je]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),ja=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Ra=s=>{var p,u;s._type==="product"&&(Ut(s),je({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(u=(p=s.commission_percent)!=null?p:s.commissionPercent)!=null?u:""}),ra(!0))},$t=async()=>{if(zt)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${zt.id}`,Tt,"L\u1ED7i c\u1EADp nh\u1EADt"),A("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),ra(!1),Ut(null),Mt()}catch(s){A(s.message,"danger")}},Ve=async s=>{const p=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${p} "${s.name}"?`))try{let u="";s._type==="product"?u=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?u=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(u=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(u,"L\u1ED7i x\xF3a"),A(`\u0110\xE3 x\xF3a ${p}`,"success"),Mt()}catch(u){A(u.message,"danger")}},Ct=async s=>{try{const p=Xt?`${API_BASE}/api/products?id=${Xt.id}`:`${API_BASE}/api/products`;Xt?await window.KTM.api.putJSON(p,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(p,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),A(Xt?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),oa(!1),fa(null),Mt()}catch(p){A(p.message,"danger")}},Zt="ktm_admin_data_cache_v1",la=1e3*60*10,Mt=async()=>{let s=null,p=!1;const u=window.KTM.cache.read(Zt,{ttlMs:la,validate:Array.isArray});u.hit?(s=u.value,console.log("[CACHE] Using cache, items:",s.length),fe(s),E(s),Xe(!1),p=!0):u.status==="miss"?console.log("[CACHE] No cache found"):u.status==="expired"||u.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):u.status==="error"&&console.error("[CACHE] Error parsing cache"),p||Xe(!0);try{const T=async(R,l)=>{try{const H=await window.KTM.api.getJSON(R,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return H!=null?H:l}catch(H){return l}},[P,C,g]=await Promise.all([T(`${API_BASE}/api/products?fields=search`,[]),T(`${API_BASE}/api/albums`,[]),T(`${API_BASE}/api/video-folders?withVideos=true`,[])]),W=Array.isArray(P)?P.map(R=>({...R,_type:"product",_source:"database"})):[];Ye(C);let le=[];Array.isArray(C)&&C.length>0&&(await Promise.all(C.map(l=>T(`${API_BASE}/api/albums/${l.id}`,{})))).forEach((l,H)=>{const ge=C[H];l.images&&l.images.length>0&&l.images.forEach(q=>{le.push({id:q.id,name:q.caption||"\u1EA2nh t\u1EEB "+ge.title,image:q.src,folder:ge.title,_type:"album",_source:"database"})})}),Ie(g);let Q=[];Array.isArray(g)&&g.forEach(R=>{R.videos&&R.videos.forEach(l=>{Q.push({id:l.id,name:l.title,folder:R.name,image:l.thumb,youtubeId:l.youtubeId,url:l.url,_type:"video",_source:"database"})})});const o=[...W,...le,...Q];(!s||JSON.stringify(o)!==JSON.stringify(s))&&(fe(o),E(o),window.KTM.cache.write(Zt,o))}catch(T){console.error("Song song fetch error:",T)}Xe(!1)};useEffect(()=>{Mt(),setTimeout(()=>{var p;return(p=de.current)==null?void 0:p.focus()},100);const s=p=>{var u,T;(p.ctrlKey||p.metaKey)&&p.key==="k"&&(p.preventDefault(),I(!0),setTimeout(()=>{var P;return(P=$.current)==null?void 0:P.focus()},0)),p.key==="/"&&!y&&((u=document.activeElement)==null?void 0:u.tagName)!=="INPUT"&&(p.preventDefault(),(T=de.current)==null||T.focus()),p.key==="Escape"&&y&&I(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[y]);const gt=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(p){return String(s!=null?s:"").toLowerCase()}},ca=s=>{const u=gt(s).trim().split(/\s+/).filter(Boolean).map(le=>{const Q=String(le||"").trim();return Q?Q.startsWith("#")?Q.slice(1):Q.startsWith("sdt:")?Q.slice(4):Q.startsWith("phone:")?Q.slice(6):Q:""}).filter(Boolean),T=u.includes("anh"),P=u.includes("video"),C=u.filter(le=>le!=="anh"&&le!=="video"),g=C.join(" "),W=new Set(["product"]);return T&&W.add("album"),P&&W.add("video"),{allowedTypes:W,includeAlbum:T,includeVideo:P,contentTokens:C,cleanedQuery:g}},Jt=(s,p,u)=>{var H,ge,q,we,ze;const T=Array.isArray(p)?p:[],P=gt(u).trim();if(!T.length&&!P)return 0;const C=gt((H=s==null?void 0:s.name)!=null?H:""),g=gt((ge=s==null?void 0:s.code)!=null?ge:""),W=gt((q=s==null?void 0:s.category)!=null?q:""),le=gt((we=s==null?void 0:s.note)!=null?we:""),Q=gt((ze=s==null?void 0:s.folder)!=null?ze:"");if(!`${C} ${g} ${W} ${le} ${Q}`.trim())return 0;const N=C.replace(/\s+/g,""),R=P.replace(/\s+/g,"");let l=0;P&&(C===P&&(l+=220),C.includes(P)&&(l+=140),C.startsWith(P)&&(l+=160),R&&(N===R?l+=280:N.startsWith(R)?l+=180:N.includes(R)&&(l+=110)),g&&g===P&&(l+=180),g&&g.includes(P)&&(l+=90));for(const Re of T){if(!Re)continue;const Le=new RegExp(`(?:^|\\s)${Re.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`),lt=String(Re).replace(/\s+/g,"");C.includes(Re)&&(l+=35),Le.test(C)&&(l+=25),lt&&(N===lt?l+=90:N.startsWith(lt)?l+=50:N.includes(lt)&&(l+=28)),g&&g.includes(Re)&&(l+=20),g&&Le.test(g)&&(l+=10),W&&W.includes(Re)&&(l+=12),Q&&Q.includes(Re)&&(l+=12),le&&le.includes(Re)&&(l+=6)}return l>0&&C&&(l+=Math.max(0,10-Math.min(10,Math.floor(C.length/10)))),l},Yt=(s,p,u)=>{const T=Array.isArray(s)?s:[];return T.length?T.map((C,g)=>({it:C,idx:g,score:Jt(C,p,u)})).sort((C,g)=>g.score!==C.score?g.score-C.score:C.idx-g.idx).map(C=>C.it):[]},_a=async(s,p)=>{if(!(!Je||p.length===0)){Me(!0);try{const u=p.map(P=>({id:P.id,name:P.name,price:P.price,category:P.category,note:P.note,folder:P.folder,_type:P._type})),T=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:u},"AI Search error");if(T&&T.matchedIds&&T.matchedIds.length>0){const{contentTokens:P,cleanedQuery:C}=ca(s),g=new Set(T.matchedIds),W=p.filter(le=>g.has(le.id)).sort((le,Q)=>Jt(Q,P,C)-Jt(le,P,C));W.length>0&&E(W)}else T&&T.matchedIds&&T.matchedIds.length===0&&E([])}catch(u){console.error("AI Search error:",u)}Me(!1)}},Gt=s=>{if(ee(s),v(s),yt.current&&clearTimeout(yt.current),ot.current&&clearTimeout(ot.current),w.current&&w.current.abort(),!s.trim()){ea(ke);return}const u=`v2|${gt(s).trim().replace(/\s+/g,"")}|${ke}`;if(B.current.has(u)){E(B.current.get(u));return}const{allowedTypes:T,contentTokens:P,cleanedQuery:C}=ca(s);yt.current=setTimeout(()=>{const g=F.filter(Q=>{if(!T.has(Q==null?void 0:Q._type))return!1;if(P.length===0)return!0;const o=Kt(Object.entries(Q).filter(([H])=>!H.startsWith("_")).map(([,H])=>String(H||"")).join(" ")),N=Q.phone?S(Q.phone):"",R=`${o} ${N}`.trim(),l=R.replace(/\s+/g,"");return P.every(H=>{const ge=String(H||"").trim();return ge?R.includes(ge)||l.includes(ge.replace(/\s+/g,"")):!0})});let W=g;ke!=="all"&&(W=g.filter(Q=>(Q==null?void 0:Q._type)===ke));const le=Yt(W,P,C);if(Ge(s),Pt(s,le),B.current.size>20){const Q=B.current.keys().next().value;B.current.delete(Q)}B.current.set(u,le),E(le),Je&&C.length>=3&&(ot.current=setTimeout(()=>{_a(C,W)},500))},200)},ea=s=>{He(s);const{allowedTypes:p,contentTokens:u}=ca(O),{cleanedQuery:T}=ca(O);let P=F.filter(C=>p.has(C==null?void 0:C._type));s!=="all"&&(P=P.filter(C=>(C==null?void 0:C._type)===s)),O.trim()&&u.length>0&&(P=P.filter(C=>{const g=gt(Object.entries(C).filter(([o])=>!o.startsWith("_")).map(([,o])=>String(o||"")).join(" ")),W=C.phone?S(C.phone):"",le=`${g} ${W}`.trim(),Q=le.replace(/\s+/g,"");return u.every(o=>{const N=String(o||"").trim();return N?le.includes(N)||Q.includes(N.replace(/\s+/g,"")):!0})})),E(Yt(P,u,T))},pt=(s,p,u)=>{u&&u.item&&Te(u.item,u.action||"copy"),window.KTM.clipboard.writeText(s).then(()=>{xe(p),A("\u0110\xE3 copy!","success"),setTimeout(()=>xe(null),1500)})},da=async(s,p,u)=>{try{u&&u.item&&Te(u.item,u.action||"copy_image"),await window.KTM.clipboard.writeImageFromUrl(s),xe(p+"-img"),A("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>xe(null),1500)}catch(T){pt(s,p+"-img",u)}},qt=s=>{let p=s.toLowerCase();const u=[],T=F.filter(g=>g._type==="product");if(p.includes("ty")||p.includes("xy lanh")){if(p.includes("gi\u1EEFa")||p.includes("giua")){const g=T.find(W=>{var le;return(le=W.name)==null?void 0:le.toLowerCase().includes("xy lanh gi\u1EEFa")});g&&!u.find(W=>W.id===g.id)&&u.push(g)}if(p.includes("nghi\xEAng")||p.includes("nghieng")){const g=T.find(W=>{var le;return(le=W.name)==null?void 0:le.toLowerCase().includes("xy lanh nghi\xEAng")});g&&!u.find(W=>W.id===g.id)&&u.push(g)}if(p.includes("\u1EE7i")||p.includes("ui")){const g=T.find(W=>{var le;return(le=W.name)==null?void 0:le.toLowerCase().includes("xy lanh \u1EE7i")});g&&!u.find(W=>W.id===g.id)&&u.push(g)}}const P=p.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(P){const g=P[1],W=P[2],le=T.find(Q=>{var N;const o=((N=Q.name)==null?void 0:N.toLowerCase())||"";return o.includes("combo")&&o.includes(`${g} tay`)&&(o.includes(`${W} xy`)||o.includes(`${W} xylanh`))});if(le&&!u.find(Q=>Q.id===le.id))u.push(le);else{const Q=T.find(o=>{var R;const N=((R=o.name)==null?void 0:R.toLowerCase())||"";return N.includes("combo")&&N.includes(`${g} tay`)});Q&&!u.find(o=>o.id===Q.id)&&u.push(Q)}}if(p.includes("combo")&&!P){const g=p.match(/combo.*?(\d+)\s*tay/);if(g){const W=g[1];T.filter(Q=>{var N;const o=((N=Q.name)==null?void 0:N.toLowerCase())||"";return o.includes("combo")&&o.includes(`${W} tay`)}).forEach(Q=>{u.find(o=>o.id===Q.id)||u.push(Q)})}}const C=p.match(/van\s*(\d+)\s*tay/);if(C&&!p.includes("ty")&&!p.includes("combo")){const g=C[1],W=T.find(le=>{var o;const Q=((o=le.name)==null?void 0:o.toLowerCase())||"";return Q.includes(`van ${g} tay`)&&!Q.includes("combo")});W&&!u.find(le=>le.id===W.id)&&u.push(W)}return u.slice(0,4)},Dt=async s=>{if(!s.trim())return;const p={role:"user",content:s,attachments:[]};re(T=>[...T,p]),xt(""),jt(!0);const u=qt(s);setTimeout(()=>{var T;return(T=St.current)==null?void 0:T.scrollIntoView({behavior:"smooth"})},100);try{const P=F.filter(o=>o._type==="product").map(o=>{let N=`- ${o.name}`;return o.code&&(N+=` (M\xE3: ${o.code})`),o.price&&(N+=` - Gi\xE1: ${o.price.replace(/[đ\s]/g,"")}\u0111`),o.category&&(N+=` [${o.category}]`),o.note&&(N+=` (${o.note})`),N}).join(`
`),g=mt.slice(-6).map(o=>`${o.role==="user"?"Kh\xE1ch":"AI"}: ${o.content}`).join(`
`),W=g?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${g}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${P}`:P,Q=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:W,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";re(o=>[...o,{role:"assistant",content:Q,attachments:u}])}catch(T){console.error("AI Error:",T);const P=s.toLowerCase(),C=F.filter(W=>{const le=Object.values(W).join(" ").toLowerCase();return P.split(" ").some(Q=>le.includes(Q))});let g="";C.length>0?(g=`T\xECm th\u1EA5y ${C.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,C.slice(0,5).forEach(W=>{g+=`\u2022 ${W.name}`,W.price&&(g+=` - ${W.price.replace(/[đ\s]/g,"")}\u0111`),W.note&&(g+=` (${W.note})`),g+=`
`}),C.length>5&&(g+=`
...v\xE0 ${C.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):g='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',re(W=>[...W,{role:"assistant",content:g,attachments:C.slice(0,4)}])}jt(!1),setTimeout(()=>{var T,P;(T=St.current)==null||T.scrollIntoView({behavior:"smooth"}),(P=Wt.current)==null||P.focus()},100)};function La({show:s,product:p,categories:u,onClose:T,onSave:P}){const[C,g]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[W,le]=useState(!1),[Q,o]=useState(!1),N=useRef(null),R=j=>window.KTM.money.formatVNDInputDigits(j),l=j=>{const K=window.KTM.money.getDigits(String(j!=null?j:"")),J=Number(K);return K&&Number.isFinite(J)?Math.trunc(J):0},H=(j,K)=>{if(j==null||j==="")return[];let J=j;if(typeof J=="string"){const pe=J.trim();if(!pe)return[];try{J=JSON.parse(pe)}catch(ce){return[]}}if(!Array.isArray(J))return[];const ie=l(K);return J.map(pe=>{var De;if(!pe||typeof pe!="object")return null;const ce=String((De=pe.name)!=null?De:"").trim(),Pe=(Array.isArray(pe.options)?pe.options:[]).map(tt=>{var na,ga,va,ya,Da,Ma,fn;if(!tt||typeof tt!="object")return null;const Nt=String((na=tt.label)!=null?na:"").trim();if(!Nt)return null;const Ot=(Da=(ya=(va=(ga=tt.price)!=null?ga:tt.priceValue)!=null?va:tt.unit_price)!=null?ya:tt.unitPrice)!=null?Da:null,Bt=Number(Ot);let aa=Number.isFinite(Bt)?Math.trunc(Bt):null;if(aa==null){const Na=(fn=(Ma=tt.price_delta)!=null?Ma:tt.priceDelta)!=null?fn:null,Ea=Number(Na);Number.isFinite(Ea)&&(aa=ie+Math.trunc(Ea))}aa==null&&(aa=ie);const Qt=String(Math.max(0,Math.trunc(Number(aa)||0)));return{label:Nt,price:Math.max(0,Math.trunc(Number(aa)||0)),priceDigits:Qt}}).filter(Boolean);return{name:ce||"Bi\u1EBFn th\u1EC3",options:Pe}}).filter(Boolean)},ge=j=>{if(j==null||j==="")return[];let K=j;if(typeof K=="string"){const J=K.trim();if(!J)return[];try{K=JSON.parse(J)}catch(ie){return[]}}return K&&typeof K=="object"&&!Array.isArray(K)&&(K=Object.entries(K).map(([J,ie])=>({key:J,value:ie}))),Array.isArray(K)?K.map(J=>{var Pe,De,tt,Nt,Ot;if(!J||typeof J!="object")return null;const ie=String((tt=(De=(Pe=J.key)!=null?Pe:J.name)!=null?De:J.label)!=null?tt:"").trim(),pe=String((Nt=J.value)!=null?Nt:"").trim(),ce=String((Ot=J.unit)!=null?Ot:"").trim();return ie?{key:ie,value:pe,unit:ce}:null}).filter(Boolean):[]};useEffect(()=>{var j,K;if(p)if(g({name:p.name||"",code:p.code||"",price:p.price||"",image:p.image||"",category:p.category||"",note:p.note||"",sort_order:p.sort_order||0,commission_percent:(K=(j=p.commission_percent)!=null?j:p.commissionPercent)!=null?K:5,variants:H(p.variants,p.price),attributes:ge(p.attributes)}),p.price){const J=window.KTM.money.getDigits(p.price);lt(J),g(ie=>({...ie,price:R(J)}))}else lt("");else g({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),lt("")},[p,s]);const q=j=>{g(K=>{var Pe;const J=l(K.price),ie=String(J),pe=Array.isArray(K.variants)?[...K.variants]:[],ce={...pe[j]||{},options:Array.isArray((Pe=pe[j])==null?void 0:Pe.options)?[...pe[j].options]:[]};return ce.options=ce.options.map(De=>({label:String((De==null?void 0:De.label)||""),price:J,priceDigits:ie})),pe[j]=ce,{...K,variants:pe}})},we=()=>{g(j=>{const K=l(j.price),J=String(K),pe=(Array.isArray(j.variants)?[...j.variants]:[]).map(ce=>{const Pe=(Array.isArray(ce==null?void 0:ce.options)?ce.options:[]).map(De=>({label:String((De==null?void 0:De.label)||""),price:K,priceDigits:J}));return{name:String((ce==null?void 0:ce.name)||"Bi\u1EBFn th\u1EC3"),options:Pe}});return{...j,variants:pe}})},[ze,Re]=React.useState(""),[Le,lt]=React.useState(""),Ee=j=>{const K=window.KTM.money.nextPriceInputState(j.target.value,Le);lt(K.digits),g({...C,price:K.price})},et=async(j,K=2)=>{const J=K*1024*1024;if(j.size<=J)return j;try{const ie=await createImageBitmap(j),pe=document.createElement("canvas");let ce=ie.width,Pe=ie.height;const De=1200;return(ce>De||Pe>De)&&(ce>Pe?(Pe=Math.round(Pe/ce*De),ce=De):(ce=Math.round(ce/Pe*De),Pe=De)),pe.width=ce,pe.height=Pe,pe.getContext("2d").drawImage(ie,0,0,ce,Pe),ie.close(),new Promise((Nt,Ot)=>{pe.toBlob(Bt=>{Bt?Nt(new File([Bt],j.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ot(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ie){throw console.error("Compress error:",ie),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},It=async j=>{var ie;const K=j.target.files[0];if(!K)return;if(!(K.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(K.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}o(!0);try{const pe=await et(K),ce=await window.KTM.cloudinary.uploadImage({file:pe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!ce.secure_url)throw console.error("Cloudinary error:",ce),new Error(((ie=ce.error)==null?void 0:ie.message)||"Upload failed");g(Pe=>({...Pe,image:ce.secure_url}))}catch(pe){console.error("Upload error:",pe),alert("L\u1ED7i upload \u1EA3nh: "+pe.message)}o(!1),j.target.value=""},st=async j=>{j.preventDefault(),le(!0);const K={...C,variants:H(C.variants,C.price),attributes:ge(C.attributes)};await P(K),le(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),p?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:st},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:C.name,onChange:j=>g({...C,name:j.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:C.code,onChange:j=>g({...C,code:j.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:C.price,onChange:Ee,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:C.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:j=>g({...C,commission_percent:j.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:C.category,onChange:j=>g({...C,category:j.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),u.map(j=>React.createElement("option",{key:j,value:j},j)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:C.note,onChange:j=>g({...C,note:j.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(C.attributes)?C.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(C.attributes)?C.attributes:[]).map((j,K)=>React.createElement("div",{key:K,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(j==null?void 0:j.key)||"",onChange:J=>{const ie=J.target.value;g(pe=>{const ce=Array.isArray(pe.attributes)?[...pe.attributes]:[];return ce[K]={...ce[K]||{},key:ie},{...pe,attributes:ce}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(j==null?void 0:j.value)||"",onChange:J=>{const ie=J.target.value;g(pe=>{const ce=Array.isArray(pe.attributes)?[...pe.attributes]:[];return ce[K]={...ce[K]||{},value:ie},{...pe,attributes:ce}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(j==null?void 0:j.unit)||"",onChange:J=>{const ie=J.target.value;g(pe=>{const ce=Array.isArray(pe.attributes)?[...pe.attributes]:[];return ce[K]={...ce[K]||{},unit:ie},{...pe,attributes:ce}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{g(J=>{const ie=Array.isArray(J.attributes)?[...J.attributes]:[];return ie.splice(K,1),{...J,attributes:ie}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{g(j=>{const K=Array.isArray(j.attributes)?[...j.attributes]:[];return K.push({key:"",value:"",unit:""}),{...j,attributes:K}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(C.variants)?C.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(C.variants)?C.variants:[]).map((j,K)=>React.createElement("div",{key:K,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(j==null?void 0:j.name)||"",onChange:J=>{const ie=J.target.value;g(pe=>{var Pe;const ce=Array.isArray(pe.variants)?[...pe.variants]:[];return ce[K]={...ce[K]||{},name:ie,options:Array.isArray((Pe=ce[K])==null?void 0:Pe.options)?ce[K].options:[]},{...pe,variants:ce}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>q(K),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(j==null?void 0:j.options)||j.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{g(J=>{const ie=Array.isArray(J.variants)?[...J.variants]:[];return ie.splice(K,1),{...J,variants:ie}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(j==null?void 0:j.options)?j.options:[]).map((J,ie)=>{var pe,ce;return React.createElement("div",{key:ie,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(J==null?void 0:J.label)||"",onChange:Pe=>{const De=Pe.target.value;g(tt=>{var Qt,na,ga,va,ya;const Nt=Array.isArray(tt.variants)?[...tt.variants]:[],Ot={...Nt[K]||{},options:Array.isArray((Qt=Nt[K])==null?void 0:Qt.options)?[...Nt[K].options]:[]},Bt=Number((ga=(na=Ot.options[ie])==null?void 0:na.price)!=null?ga:0)||0,aa=String((ya=(va=Ot.options[ie])==null?void 0:va.priceDigits)!=null?ya:Math.max(0,Math.trunc(Bt)));return Ot.options[ie]={...Ot.options[ie]||{},label:De,price:Math.max(0,Math.trunc(Bt)),priceDigits:aa},Nt[K]=Ot,{...tt,variants:Nt}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:R(String((ce=J==null?void 0:J.priceDigits)!=null?ce:window.KTM.money.getDigits(String((pe=J==null?void 0:J.price)!=null?pe:"")))),onChange:Pe=>{g(De=>{var ga,va,ya,Da,Ma;const tt=String((va=J==null?void 0:J.priceDigits)!=null?va:window.KTM.money.getDigits(String((ga=J==null?void 0:J.price)!=null?ga:""))),Nt=window.KTM.money.nextPriceInputState(Pe.target.value,tt),Ot=String((ya=Nt.digits)!=null?ya:""),Bt=Number(Ot),aa=Number.isFinite(Bt)?Math.max(0,Math.trunc(Bt)):0,Qt=Array.isArray(De.variants)?[...De.variants]:[],na={...Qt[K]||{},options:Array.isArray((Da=Qt[K])==null?void 0:Da.options)?[...Qt[K].options]:[]};return na.options[ie]={...na.options[ie]||{},label:String(((Ma=na.options[ie])==null?void 0:Ma.label)||""),price:aa,priceDigits:Ot},Qt[K]=na,{...De,variants:Qt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{g(Pe=>{var Nt;const De=Array.isArray(Pe.variants)?[...Pe.variants]:[],tt={...De[K]||{},options:Array.isArray((Nt=De[K])==null?void 0:Nt.options)?[...De[K].options]:[]};return tt.options.splice(ie,1),De[K]=tt,{...Pe,variants:De}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{g(J=>{var Pe;const ie=Array.isArray(J.variants)?[...J.variants]:[],pe={...ie[K]||{},options:Array.isArray((Pe=ie[K])==null?void 0:Pe.options)?[...ie[K].options]:[]},ce=l(J.price);return pe.options.push({label:"",price:ce,priceDigits:String(ce)}),ie[K]=pe,{...J,variants:ie}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{g(j=>{const K=l(j.price),J=Array.isArray(j.variants)?[...j.variants]:[],ie=String(K);return J.push({name:"Size",options:[{label:"S",price:K,priceDigits:ie},{label:"M",price:K,priceDigits:ie},{label:"L",price:K,priceDigits:ie}]}),{...j,variants:J}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:we,disabled:!Array.isArray(C.variants)||C.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},C.image?React.createElement(React.Fragment,null,React.createElement("img",{src:C.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>g({...C,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var j;return(j=N.current)==null?void 0:j.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:N,type:"file",accept:"image/*",className:"d-none",onChange:It}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var j;return(j=N.current)==null?void 0:j.click()},disabled:Q,style:{borderRadius:"10px"}},Q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:C.image,onChange:j=>g({...C,image:j.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:T,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:W,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},W?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const za=s=>window.KTM.money.formatVND(s),Xa=s=>{if(s==null||s==="")return[];let p=s;if(typeof p=="string"){const u=p.trim();if(!u)return[];try{p=JSON.parse(u)}catch(T){return[]}}return Array.isArray(p)?p:[]},Ta=s=>{if(s==null||s==="")return[];let p=s;if(typeof p=="string"){const u=p.trim();if(!u)return[];try{p=JSON.parse(u)}catch(T){return[]}}return p&&typeof p=="object"&&!Array.isArray(p)&&(p=Object.entries(p).map(([u,T])=>({key:u,value:T}))),Array.isArray(p)?p:[]},Ja=(s,p={})=>{var C;const u=Ta(s).map(g=>{var W,le,Q,o,N;return{key:String((Q=(le=(W=g==null?void 0:g.key)!=null?W:g==null?void 0:g.name)!=null?le:g==null?void 0:g.label)!=null?Q:"").trim(),value:String((o=g==null?void 0:g.value)!=null?o:"").trim(),unit:String((N=g==null?void 0:g.unit)!=null?N:"").trim()}}).filter(g=>!!g.key);if(!u.length)return null;const T=!!p.compact,P=String((C=p.className)!=null?C:"").trim();return React.createElement("div",{className:`ktm-variants-preview${T?" compact":""}${P?" "+P:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},u.map((g,W)=>{const le=g.key,Q=`${g.value||""}${g.unit?(g.value?" ":"")+g.unit:""}`.trim();return React.createElement("div",{key:`${le}-${W}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},le),Q?React.createElement("span",{className:"ktm-chip ktm-chip-option"},Q):null)})))},Ga=(s,p={})=>{var le;const u=Xa(s).map(Q=>{var o;return{name:String((o=Q==null?void 0:Q.name)!=null?o:"").trim(),options:Array.isArray(Q==null?void 0:Q.options)?Q.options:[]}}).map(Q=>({...Q,options:Q.options.map(o=>{var N;return{label:String((N=o==null?void 0:o.label)!=null?N:"").trim(),price:Number(o==null?void 0:o.price)}}).filter(o=>!!o.label)})).filter(Q=>Q.options.length>0);if(!u.length)return null;const T=Number.isFinite(p.maxGroups)?Math.max(1,Math.trunc(p.maxGroups)):u.length,P=Number.isFinite(p.maxOptionsPerGroup)?Math.max(1,Math.trunc(p.maxOptionsPerGroup)):3,C=!!p.compact,g=String((le=p.className)!=null?le:"").trim(),W=u.slice(0,T);return React.createElement("div",{className:`ktm-variants-preview${C?" compact":""}${g?" "+g:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},W.map((Q,o)=>{const N=Q.name||"Bi\u1EBFn th\u1EC3",R=Q.options.slice(0,P),l=Q.options.length-R.length;return React.createElement("div",{key:`${N}-${o}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},N),R.map((H,ge)=>{const q=H.price,we=Number.isFinite(q)&&q>=0?za(Math.trunc(q)):"",ze=we?`${H.label} \xB7 ${we}`:H.label;return React.createElement("span",{key:`${N}-${o}-${ge}`,className:"ktm-chip ktm-chip-option"},ze)}),l>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",l))})))},ta=(s,p)=>{const u=s._type==="product",T=s._type==="album",P=s._type==="video",C=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),g=u?Ja(s.attributes,{compact:qe==="grid",className:qe==="grid"?"meta text-muted":"text-muted"}):null,W=u?Ga(s.variants,{compact:qe==="grid",maxOptionsPerGroup:999,className:qe==="grid"?"meta text-muted":"text-muted"}):null;return qe==="grid"?React.createElement("div",{key:s.id||p,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>{Te(s,"preview"),Rt({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${P?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${u?"product":T?"album":"video"}`},u?"SP":T?"\u1EA2nh":"Video"),C&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),g&&React.createElement("div",{style:{marginTop:2}},g),W&&React.createElement("div",{style:{marginTop:2}},W),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:ye===s.id+"-img"?"copied":"",onClick:()=>da(s.image,s.id,{item:s,action:"copy_image"})},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:ye===s.id+"-price"?"copied":"",onClick:()=>pt(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||p,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${u?"product":T?"album":"video"}`},u?"S\u1EA3n ph\u1EA9m":T?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>{Te(s,"preview"),Rt({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${P?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),C&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),g&&React.createElement("div",{style:{marginTop:4}},g),W&&React.createElement("div",{style:{marginTop:4}},W)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),P&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},u&&React.createElement("button",{onClick:()=>{Te(s,"create_order"),_&&_("orders","create",{productId:s.id})}},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:ye===s.id+"-price"?"copied":"",onClick:()=>pt(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:ye===s.id+"-name"?"copied":"",onClick:()=>pt(s.name,s.id+"-name",{item:s,action:"copy_name"})},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),P&&s.youtubeId&&React.createElement("button",{className:ye===s.id+"-yt"?"copied":"",onClick:()=>pt(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),u&&React.createElement("button",{className:"action-edit",onClick:()=>Ra(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Ve(s)},React.createElement("i",{className:"fas fa-trash"}))))},[ba,ma]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"search-suggestions mobile-only"},React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"G\u1EE3i \xFD nhanh"),React.createElement("div",{className:"search-suggestions-row"},[{label:"van 2 tay",query:"van 2 tay"},{label:"combo r\u1EBB",query:"combo r\u1EBB"},{label:"xylanh",query:"xylanh"},{label:"sdt:\u2026",query:"sdt:",caret:"end",addToHistory:!1},{label:"#m\xE3\u2026",query:"#",caret:"end",addToHistory:!1}].map(s=>React.createElement("button",{key:s.label,type:"button",className:"suggestion-chip",onClick:()=>Ht(s.query,{caret:s.caret,addToHistory:s.addToHistory,focus:!1})},s.label)))),_t.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"S\u1EA3n ph\u1EA9m hay t\xECm"),React.createElement("div",{className:"search-suggestions-row"},_t.map(s=>{var P,C;const p=(((P=s.item)==null?void 0:P.name)||s.name||"").trim();if(!p)return null;const u=String(((C=s.item)==null?void 0:C.code)||s.code||"").trim(),T=u?`#${u}`:p;return React.createElement("button",{key:s.id,type:"button",className:"suggestion-chip suggestion-chip-popular",onClick:()=>{s.item&&Te(s.item,"suggestion"),Ht(T,{caret:"end",focus:!1})},title:u?`#${u}`:p},p)}))),bt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"T\xECm g\u1EA7n \u0111\xE2y / hay d\xF9ng"),React.createElement("div",{className:"search-suggestions-row"},bt.map(s=>React.createElement("button",{key:s.q,type:"button",className:"suggestion-chip suggestion-chip-query",onClick:()=>Ht(s.q,{caret:"end",focus:!1}),title:`${s.q} (${s.count})`},s.q))))),React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,z.length)," k\u1EBFt qu\u1EA3",Je&&O.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),ke!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},ke==="product"?"S\u1EA3n ph\u1EA9m":ke==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${qe==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Ne("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${qe==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Ne("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},L?React.createElement("div",null,[...Array(8)].map((s,p)=>React.createElement("div",{key:p,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):z.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',O,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{ee(""),Gt("")}},"Xem t\u1EA5t c\u1EA3")):qe==="grid"?React.createElement("div",{className:"product-grid-mobile"},z.map((s,p)=>ta(s,p))):React.createElement("div",null,z.map((s,p)=>ta(s,p)))),ba&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ma(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${ke==="all"?"active":""}`,onClick:()=>{ea("all"),ma(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${ke==="product"?"active":""}`,onClick:()=>{ea("product"),ma(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${ke==="album"?"active":""}`,onClick:()=>{ea("album"),ma(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${ke==="video"?"active":""}`,onClick:()=>{ea("video"),ma(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Je,onChange:s=>ht(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:de,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:O,onChange:s=>Gt(s.target.value)}),React.createElement("button",{className:`filter-btn ${ba||ke!=="all"?"active":""}`,onClick:()=>ma(!ba)},React.createElement("i",{className:"fas fa-filter"})))),y&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>I(!1)},React.createElement("div",{className:"search-palette",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:$,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:me,onChange:s=>Gt(s.target.value),onKeyDown:s=>{s.key==="Enter"&&z.length>0?(Be(me),I(!1)):s.key==="Escape"&&I(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>I(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((s,p)=>React.createElement("span",{key:s,className:`filter-chip ${ke===["all","product","album","video"][p]?"active":""}`,onClick:()=>{ea(["all","product","album","video"][p])}},s)))),G.length>0&&!me.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},G.map((s,p)=>React.createElement("div",{key:p,className:"palette-item",onClick:()=>{Gt(s),Be(s)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,s),React.createElement("button",{className:"unsave-btn",onClick:u=>{u.stopPropagation(),ut(s)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),te.length>0&&!me.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},te.map((s,p)=>React.createElement("div",{key:p,className:"palette-item",onClick:()=>{Gt(s)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,s),React.createElement("button",{className:"save-btn",onClick:u=>{u.stopPropagation(),ut(s)}},React.createElement("i",{className:`fas fa-star${G.includes(s)?"":"-o"}`})))))),me.trim()&&z.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",z.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},z.slice(0,8).map((s,p)=>React.createElement("div",{key:s.id||p,className:"palette-result-item",onClick:()=>{Be(me),I(!1)}},s.image&&React.createElement("img",{src:s.image,alt:s.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},s.name),s.price&&React.createElement("div",{className:"result-meta"},s.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:u=>{u.stopPropagation(),ut(me)}},React.createElement("i",{className:`fas fa-star${G.includes(me)?"":"-o"}`})))))),me.trim()&&z.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',me,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:ha?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>Qe(!0),onTouchStart:()=>Qe(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),_e&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>Qe(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},mt.map((s,p)=>React.createElement("div",{key:p,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:ye===`chat-${p}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:ye===`chat-${p}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),xe(`chat-${p}`),setTimeout(()=>xe(null),1500)}},React.createElement("i",{className:`fas ${ye===`chat-${p}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((u,T)=>React.createElement("div",{key:T,style:{width:70},className:"text-center"},u.image&&React.createElement("img",{src:u.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>Rt({url:u.image,name:u.name,price:u.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},u.name),u.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},u.price.replace(/[đ\s]/g,""),"\u0111"))))))),Ze&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:St})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Dt(s),disabled:Ze,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),Dt(Ke)},className:"chat-input-wrap"},React.createElement("input",{ref:Wt,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:Ke,onChange:s=>xt(s.target.value),disabled:Ze}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Ze||!Ke.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),Lt&&React.createElement("div",{className:"preview-modal",onClick:()=>Rt(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>Rt(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:Lt.url,alt:Lt.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},Lt.name),Lt.price&&React.createElement("div",{className:"price"},Lt.price.replace(/[đ\s]/g,""),"\u0111"),Lt.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},Lt.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:ye==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:ye==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>da(Lt.url,"preview")},React.createElement("i",{className:`fas ${ye==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),Lt.price&&React.createElement("button",{className:ye==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>pt(Lt.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${ye==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(La,{show:Aa,product:Xt,categories:ve,onClose:()=>{oa(!1),fa(null)},onSave:Ct}),React.createElement("div",{className:`fab-container mobile-only ${ha?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{nt(!1),oa(!0),fa(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{nt(!1),_&&_("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${ha?"open":""}`,onClick:()=>nt(!ha)},React.createElement("i",{className:"fas fa-plus"}))),ka&&zt&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>ra(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Tt.name,onChange:s=>je({...Tt,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Tt.code,onChange:s=>je({...Tt,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Tt.price,onChange:s=>je({...Tt,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Tt.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>je({...Tt,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Tt.category,onChange:s=>je({...Tt,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),ja.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Tt.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>je({...Tt,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>ra(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:$t},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:A,showToast:_}){const[O,ee]=useState([]),[z,E]=useState([]),[F,fe]=useState(!0),[ve,se]=useState(null),[ke,He]=useState(!1),[ye,xe]=useState(null),[qe,Ne]=useState(!1),[L,Xe]=useState(null),[rt,Ye]=useState(!1),[Se,Ie]=useState(null),[de,Je]=useState(!1),[ht,At]=useState(!1),[Me,ot]=useState(null),[yt,w]=useState(!1),[y,I]=useState(null),[te,ae]=useState([]);useEffect(()=>{G()},[]);const G=async(S=null)=>{fe(!0);try{const X=S?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${S}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Be=await window.KTM.api.getJSON(X,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");ee(Array.isArray(Be)?Be:[])}catch(X){console.error(X),_("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}fe(!1)},Z=async S=>{try{const X=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${S}`,"L\u1ED7i t\u1EA3i video");E(Array.isArray(X)?X:[])}catch(X){console.error(X)}},me=async S=>{if(S===0)return;const X=[...O];[X[S-1],X[S]]=[X[S],X[S-1]],ee(X),await $(X)},v=async S=>{if(S===O.length-1)return;const X=[...O];[X[S],X[S+1]]=[X[S+1],X[S]],ee(X),await $(X)},$=async S=>{try{await Promise.all(S.map((X,Be)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${X.id}`,{sortOrder:Be},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),_("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(X){_("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),G(y==null?void 0:y.id)}},B=async S=>{if(S===0)return;const X=[...z];[X[S-1],X[S]]=[X[S],X[S-1]],E(X),await he(X)},ne=async S=>{if(S===z.length-1)return;const X=[...z];[X[S],X[S+1]]=[X[S+1],X[S]],E(X),await he(X)},he=async S=>{try{await Promise.all(S.map((X,Be)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${X.id}`,{sort_order:Be},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),_("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(X){_("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),Z(ve.id)}},oe=()=>{xe(null),He(!0)},Ae=S=>{ot(S),At(!0),w(!0)},_e=async(S,X="modal")=>{try{!ye&&y&&(S.parent_id=y.id);const Be=ye?`${API_BASE}/api/video-folders/${ye.id}`:`${API_BASE}/api/video-folders`;ye?await window.KTM.api.putJSON(Be,S,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Be,S,"L\u1ED7i l\u01B0u folder"),_(ye?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),X==="drawer"?(w(!1),xe(null),G(y==null?void 0:y.id),ye&&Me&&ot({...Me,...S})):(He(!1),xe(null),G(y==null?void 0:y.id))}catch(Be){_(Be.message,"danger")}},Qe=async S=>{const X=S.subfolderCount>0?`X\xF3a folder "${S.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${S.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(X))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${S.id}`,"L\u1ED7i x\xF3a folder"),_("\u0110\xE3 x\xF3a folder","success"),se(null),G(y==null?void 0:y.id)}catch(Be){_("L\u1ED7i x\xF3a folder","danger")}},mt=S=>{S.subfolderCount>0?(ae(X=>[...X,S]),I(S),G(S.id)):(se(S),E(S.videos||[]))},re=S=>{if(S==="root")ae([]),I(null),G(null);else if(S){const X=te.findIndex(Be=>Be.id===S.id);X>=0&&(ae(te.slice(0,X+1)),I(S),G(S.id))}else{const X=[...te];X.pop();const Be=X[X.length-1]||null;ae(X),I(Be),G(Be==null?void 0:Be.id)}},Ke=()=>{At(!1),w(!1),ot(null)},xt=()=>{Ye(!1),Je(!1),Ie(null)},Ze=()=>{Xe(null),Ne(!0)},jt=S=>{Ie(S),Ye(!0),Je(!0)},St=async(S,X="modal")=>{try{S.folder_id=ve==null?void 0:ve.id;const Be=L?`${API_BASE}/api/videos/${L.id}`:`${API_BASE}/api/videos`;L?await window.KTM.api.putJSON(Be,S,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Be,S,"L\u1ED7i l\u01B0u video"),_(L?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),X==="drawer"?(Je(!1),Xe(null),G(),ve&&Z(ve.id),L&&Se&&Ie({...Se,...S})):(Ne(!1),Xe(null),G(),ve&&Z(ve.id))}catch(Be){_(Be.message,"danger")}},Wt=async S=>{if(confirm(`X\xF3a video "${S.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${S.id}`,"L\u1ED7i x\xF3a video"),_("\u0110\xE3 x\xF3a video","success"),G(),ve&&Z(ve.id)}catch(X){_("L\u1ED7i x\xF3a video","danger")}},Kt=S=>{const X=`https://www.youtube.com/watch?v=${S.youtubeId}`;window.KTM.clipboard.writeText(X).then(()=>{_("\u0110\xE3 copy link!","success")}).catch(()=>{_("Kh\xF4ng th\u1EC3 copy link","danger")})};return ve?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>se(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${ve.slug==="shorts"?"text-danger":"text-warning"}`}),ve.name)),React.createElement("button",{className:"btn btn-warning",onClick:Ze},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),z.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},z.map((S,X)=>React.createElement("div",{key:S.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>B(X),disabled:X===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},X+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>ne(X),disabled:X===z.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:S.thumb,className:"card-img-top",alt:S.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${S.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:S.title},S.title),React.createElement("small",{className:"text-muted"},S.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Kt(S),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>jt(S),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Wt(S),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:qe,video:L,onClose:()=>Ne(!1),onSave:St}),React.createElement(AdminDrawer,{open:ht,title:Me?Me.name:"Folder",subtitle:Me?`${Me.subfolderCount||0} subfolder \u2022 ${Me.videoCount||0} videos`:"",onClose:Ke,footer:yt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:Ke},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Me&&_e({name:Me.name||"",description:Me.description||"",sortOrder:Me.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Me?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Me.name),_("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{w(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Me.name}"?`)&&(Qe(Me),Ke())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},yt&&Me?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Me.name||"",onChange:S=>ot({...Me,name:S.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Me.description||"",onChange:S=>ot({...Me,description:S.target.value})}))):Me?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Me.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Me.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Me.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Me.videoCount||0))),Me.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Me.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:rt,title:Se?Se.title:"Video",subtitle:Se?`${Se.youtubeId}`:"",onClose:xt,footer:de?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:xt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Se&&St({youtube_url:`https://www.youtube.com/watch?v=${Se.youtubeId}`,title:Se.title||"",thumbnail_url:Se.thumb||"",sort_order:Se.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Se?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const S=`https://www.youtube.com/watch?v=${Se.youtubeId}`;window.KTM.clipboard.writeText(S).then(()=>{_("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Je(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${Se.title}"?`)&&(Wt(Se),xt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},de&&Se?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:Se.title||"",onChange:S=>Ie({...Se,title:S.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:Se.youtubeId||"",onChange:S=>Ie({...Se,youtubeId:S.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Se.sortOrder||0,onChange:S=>Ie({...Se,sortOrder:parseInt(S.target.value)||0})}))):Se?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},Se.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},Se.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},Se.sortOrder||0))),Se.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:Se.thumb,alt:Se.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},y&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>re()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),y?y.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:oe},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),te.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:S=>{S.preventDefault(),re("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),te.map((S,X)=>React.createElement("li",{key:S.id,className:`breadcrumb-item ${X===te.length-1?"active":""}`},X===te.length-1?S.name:React.createElement("a",{href:"#",onClick:Be=>{Be.preventDefault(),re(S)},className:"text-warning"},S.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),F?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):O.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},y?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:oe},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",y?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},O.map((S,X)=>{var Be,ut,Ft,ft;return React.createElement("div",{key:S.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:kt=>{kt.stopPropagation(),me(X)},disabled:X===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},X+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:kt=>{kt.stopPropagation(),v(X)},disabled:X===O.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>mt(S),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${S.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},S.name),React.createElement("p",{className:"text-muted mb-0"},S.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),S.subfolderCount," folder"),S.subfolderCount>0&&(S.videoCount>0||((Be=S.videos)==null?void 0:Be.length)>0)&&" \u2022 ",(S.videoCount>0||((ut=S.videos)==null?void 0:ut.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),S.videoCount||((Ft=S.videos)==null?void 0:Ft.length)||0," videos"),S.subfolderCount===0&&!S.videoCount&&!((ft=S.videos)!=null&&ft.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:kt=>{kt.stopPropagation(),Ae(S)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:kt=>{kt.stopPropagation(),Qe(S)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:ke,folder:ye,onClose:()=>He(!1),onSave:_e}))}function VideoFolderModal({show:A,folder:_,onClose:O,onSave:ee}){const[z,E]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[F,fe]=useState(!1),[ve,se]=useState(!1);useEffect(()=>{E(_?{name:_.name||"",description:_.description||"",sortOrder:_.sortOrder||0,coverImage:_.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[_,A]);const ke=async ye=>{const xe=ye.target.files[0];if(xe){se(!0);try{const qe=await window.KTM.cloudinary.uploadImage({file:xe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});qe.secure_url&&E(Ne=>({...Ne,coverImage:qe.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(qe){console.error("Cloudinary upload error:",qe),alert("L\u1ED7i upload \u1EA3nh: "+(qe.message||qe))}finally{se(!1)}}},He=async ye=>{ye.preventDefault(),fe(!0);const xe={...z,variants:normalizeVariants(z.variants,z.price),attributes:normalizeAttributes(z.attributes)};await ee(xe),fe(!1)};return A?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},_?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:O})),React.createElement("form",{onSubmit:He},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:z.name,onChange:ye=>E({...z,name:ye.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:z.description,onChange:ye=>E({...z,description:ye.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:z.sortOrder,onChange:ye=>E({...z,sortOrder:parseInt(ye.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},z.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:z.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>E({...z,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:ke,disabled:ve}),ve&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:z.coverImage,onChange:ye=>E({...z,coverImage:ye.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:O},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:F},F?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:A,settings:_}){const[O,ee]=useState([]),[z,E]=useState(!0),[F,fe]=useState(!1),[ve,se]=useState(null),[ke,He]=useState(""),[ye,xe]=useState(""),[qe,Ne]=useState(!1),[L,Xe]=useState(null),rt=normalizeShipPercent(_==null?void 0:_.ship_percent),{parseMoney:Ye,formatVND:Se}=window.KTM.money,Ie=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{de()},[]);const de=async()=>{E(!0);try{const v=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");ee(Array.isArray(v)?v:[])}catch(v){console.error(v),A("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}E(!1)},Je=()=>{se(null),fe(!0)},ht=v=>{se(v),fe(!0)},At=v=>{v&&(Xe(v),Ne(!0))},Me=()=>{Ne(!1)},ot=async v=>{if(!(!v||!v.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:v},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),A(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),de()}catch($){A("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},yt=async v=>{try{const $=ve?`${API_BASE}/api/products?id=${ve.id}`:`${API_BASE}/api/products`;ve?await window.KTM.api.putJSON($,v,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON($,v,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),A(ve?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),fe(!1),de()}catch($){A($.message,"danger")}},w=async v=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${v.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${v.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),A("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),de()}catch($){A($.message,"danger")}},y=O.filter(v=>{const $=!ke||v.name.toLowerCase().includes(ke.toLowerCase())||v.code&&v.code.toLowerCase().includes(ke.toLowerCase()),B=!ye||v.category===ye;return $&&B}),I=v=>{var ne;const $=(ne=v==null?void 0:v.commission_percent)!=null?ne:v==null?void 0:v.commissionPercent,B=$===""||$==null?NaN:Number($);return Number.isFinite(B)?Math.max(0,Math.min(100,B)):5},te=v=>{const $=I(v),B=Number.isInteger($)?String($):String(Math.round($*100)/100),ne=Ye(v==null?void 0:v.price);if(!Number.isFinite(ne)||ne<=0)return`${B}%`;const he=(Number($)||0)/100,Ae=window.KTM.money.parseShipFeeFromNote(v==null?void 0:v.note)!=null?0:rt>0?ne*rt/100:0,_e=ne*he-Ae*he,Qe=Math.max(0,Math.round(_e));return`${B}% - ${Se(Qe)}`},ae=v=>{if(v==null||v==="")return[];let $=v;if(typeof $=="string"){const B=$.trim();if(!B)return[];try{$=JSON.parse(B)}catch(ne){return[]}}return Array.isArray($)?$:[]},G=v=>{if(v==null||v==="")return[];let $=v;if(typeof $=="string"){const B=$.trim();if(!B)return[];try{$=JSON.parse(B)}catch(ne){return[]}}return $&&typeof $=="object"&&!Array.isArray($)&&($=Object.entries($).map(([B,ne])=>({key:B,value:ne}))),Array.isArray($)?$:[]},Z=v=>{const $=G(v).map(B=>{var ne,he,oe,Ae,_e;return{key:String((oe=(he=(ne=B==null?void 0:B.key)!=null?ne:B==null?void 0:B.name)!=null?he:B==null?void 0:B.label)!=null?oe:"").trim(),value:String((Ae=B==null?void 0:B.value)!=null?Ae:"").trim(),unit:String((_e=B==null?void 0:B.unit)!=null?_e:"").trim()}}).filter(B=>!!B.key);return $.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},$.map((B,ne)=>{const he=B.key,oe=`${B.value||""}${B.unit?(B.value?" ":"")+B.unit:""}`.trim();return React.createElement("div",{key:`${he}-${ne}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},he),oe?React.createElement("span",{className:"ktm-chip ktm-chip-option"},oe):null)}))):null},me=(v,$={})=>{const B=ae(v).map(Ae=>{var _e;return{name:String((_e=Ae==null?void 0:Ae.name)!=null?_e:"").trim(),options:Array.isArray(Ae==null?void 0:Ae.options)?Ae.options:[]}}).map(Ae=>({...Ae,options:Ae.options.map(_e=>{var Qe;return{label:String((Qe=_e==null?void 0:_e.label)!=null?Qe:"").trim(),price:Number(_e==null?void 0:_e.price)}}).filter(_e=>!!_e.label)})).filter(Ae=>Ae.options.length>0);if(!B.length)return null;const ne=Number.isFinite($.maxGroups)?Math.max(1,Math.trunc($.maxGroups)):B.length,he=Number.isFinite($.maxOptionsPerGroup)?Math.max(1,Math.trunc($.maxOptionsPerGroup)):4,oe=B.slice(0,ne);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},oe.map((Ae,_e)=>{const Qe=Ae.name||"Bi\u1EBFn th\u1EC3",mt=Ae.options.slice(0,he),re=Ae.options.length-mt.length;return React.createElement("div",{key:`${Qe}-${_e}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Qe),mt.map((Ke,xt)=>{const Ze=Ke.price,jt=Number.isFinite(Ze)&&Ze>=0?Se(Math.trunc(Ze)):"",St=jt?`${Ke.label} \xB7 ${jt}`:Ke.label;return React.createElement("span",{key:`${Qe}-${_e}-${xt}`,className:"ktm-chip ktm-chip-option"},St)}),re>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",re))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Je},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:ke,onChange:v=>He(v.target.value)})),React.createElement("span",{className:"product-count"},y.length)),React.createElement("select",{className:"form-select",value:ye,onChange:v=>xe(v.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),Ie.map(v=>React.createElement("option",{key:v,value:v},v)))),z?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):y.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Je},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},y.map(v=>React.createElement("div",{key:v.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>At(v),onKeyDown:$=>{($.key==="Enter"||$.key===" ")&&($.preventDefault(),At(v))},title:"Xem chi ti\u1EBFt"},v.image?React.createElement("img",{src:v.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},v.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},v.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},v.category),v.code&&React.createElement("span",{className:"product-badge bg-secondary"},v.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),te(v))),React.createElement("div",{className:"product-price"},v.price?v.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),v.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},v.note),Z(v.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},Z(v.attributes)),me(v.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},me(v.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:$=>{$.stopPropagation(),ht(v)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:$=>{$.stopPropagation(),w(v)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:qe,title:String((L==null?void 0:L.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((L==null?void 0:L.code)||"").trim()||null,String((L==null?void 0:L.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Me,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const v=String((L==null?void 0:L.code)||"").trim();v&&window.KTM.clipboard.writeText(v).then(()=>A("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((L==null?void 0:L.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const v=String((L==null?void 0:L.price)||"").trim();v&&window.KTM.clipboard.writeText(v).then(()=>A("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((L==null?void 0:L.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>L&&ht(L),disabled:!L},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>L&&w(L),disabled:!L},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},L?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const v=String((L==null?void 0:L.price)||"").trim(),$=Ye(v);return Number.isFinite($)&&$>0?Se(Math.trunc($)):v||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},te(L)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},L.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},L.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),L.image?React.createElement("img",{src:L.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(L.note||"").trim()||L.attributes||L.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(L.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(L.note||"").trim()),Z(L.attributes)?React.createElement("div",{className:"mt-2"},Z(L.attributes)):null,me(L.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},me(L.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:F,product:ve,categories:Ie,onClose:()=>fe(!1),onSave:yt}))}function ProductModal({show:A,product:_,categories:O,onClose:ee,onSave:z}){const[E,F]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[fe,ve]=useState(!1),[se,ke]=useState(!1),He=w=>{const y=window.KTM.money.getDigits(String(w!=null?w:"")),I=Number(y);return y&&Number.isFinite(I)?Math.trunc(I):0},ye=w=>{if(w==null||w==="")return[];let y=w;if(typeof y=="string"){const I=y.trim();if(!I)return[];try{y=JSON.parse(I)}catch(te){return[]}}return y&&typeof y=="object"&&!Array.isArray(y)&&(y=Object.entries(y).map(([I,te])=>({key:I,value:te}))),Array.isArray(y)?y.map(I=>{var Z,me,v,$,B;if(!I||typeof I!="object")return null;const te=String((v=(me=(Z=I.key)!=null?Z:I.name)!=null?me:I.label)!=null?v:"").trim(),ae=String(($=I.value)!=null?$:"").trim(),G=String((B=I.unit)!=null?B:"").trim();return te?{key:te,value:ae,unit:G}:null}).filter(Boolean):[]},xe=(w,y)=>{if(w==null||w==="")return[];let I=w;if(typeof I=="string"){const ae=I.trim();if(!ae)return[];try{I=JSON.parse(ae)}catch(G){return[]}}if(!Array.isArray(I))return[];const te=He(y);return I.map(ae=>{var me;if(!ae||typeof ae!="object")return null;const G=String((me=ae.name)!=null?me:"").trim(),Z=(Array.isArray(ae.options)?ae.options:[]).map(v=>{var Ae,_e,Qe,mt,re,Ke,xt;if(!v||typeof v!="object")return null;const $=String((Ae=v.label)!=null?Ae:"").trim();if(!$)return null;const B=(re=(mt=(Qe=(_e=v.price)!=null?_e:v.priceValue)!=null?Qe:v.unit_price)!=null?mt:v.unitPrice)!=null?re:null,ne=Number(B);let he=Number.isFinite(ne)?Math.trunc(ne):null;if(he==null){const Ze=(xt=(Ke=v.price_delta)!=null?Ke:v.priceDelta)!=null?xt:null,jt=Number(Ze);Number.isFinite(jt)&&(he=te+Math.trunc(jt))}he==null&&(he=te);const oe=String(Math.max(0,Math.trunc(Number(he)||0)));return{label:$,price:Math.max(0,Math.trunc(Number(he)||0)),priceDigits:oe}}).filter(Boolean);return{name:G||"Bi\u1EBFn th\u1EC3",options:Z}}).filter(Boolean)};useEffect(()=>{var w,y;F(_?{name:_.name||"",code:_.code||"",price:_.price||"",image:_.image||"",category:_.category||"",note:_.note||"",sort_order:_.sort_order||0,commission_percent:(y=(w=_.commission_percent)!=null?w:_.commissionPercent)!=null?y:5,variants:xe(_.variants,_.price),attributes:ye(_.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[_,A]);const qe=w=>{F(y=>{var Z;const I=He(y.price),te=String(I),ae=Array.isArray(y.variants)?[...y.variants]:[],G={...ae[w]||{},options:Array.isArray((Z=ae[w])==null?void 0:Z.options)?[...ae[w].options]:[]};return G.options=G.options.map(me=>({label:String((me==null?void 0:me.label)||""),price:I,priceDigits:te})),ae[w]=G,{...y,variants:ae}})},Ne=()=>{F(w=>{const y=He(w.price),I=String(y),ae=(Array.isArray(w.variants)?[...w.variants]:[]).map(G=>{const Z=(Array.isArray(G==null?void 0:G.options)?G.options:[]).map(me=>({label:String((me==null?void 0:me.label)||""),price:y,priceDigits:I}));return{name:String((G==null?void 0:G.name)||"Bi\u1EBFn th\u1EC3"),options:Z}});return{...w,variants:ae}})},[L,Xe]=React.useState(""),rt=w=>window.KTM.money.formatVNDInputDigits(w),[Ye,Se]=React.useState(""),Ie=w=>{const y=window.KTM.money.nextPriceInputState(w.target.value,Ye);Se(y.digits),F({...E,price:y.price})},[de,Je]=React.useState("");React.useEffect(()=>{_!=null&&_.image&&Je(_.image)},[_]);const ht=async w=>{if(!(!w||!w.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:w},"L\u1ED7i x\xF3a \u1EA3nh")}catch(y){console.error("Delete cloudinary image error:",y)}},At=async(w,y=2,I)=>{const te=y*1024*1024,ae=w.type==="image/heic"||w.type==="image/heif"||/\.heic$/i.test(w.name);if(w.size<=te&&!ae)return w;I==null||I("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const G=await createImageBitmap(w);I==null||I("\u0110ang n\xE9n \u1EA3nh...");const Z=document.createElement("canvas");let me=G.width,v=G.height;const $=1200;return(me>$||v>$)&&(me>v?(v=Math.round(v/me*$),me=$):(me=Math.round(me/v*$),v=$)),Z.width=me,Z.height=v,Z.getContext("2d").drawImage(G,0,0,me,v),G.close(),new Promise((ne,he)=>{Z.toBlob(oe=>{oe?(I==null||I("Ho\xE0n t\u1EA5t!"),ne(new File([oe],w.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):he(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(G){throw console.error("createImageBitmap error:",G),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Me=async w=>{var te,ae;const y=(te=w.target.files)==null?void 0:te[0];if(!y)return;if(!(y.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(y.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ke(!0),Xe("\u0110ang chu\u1EA9n b\u1ECB...");try{const G=(y.size/1024/1024).toFixed(1);Xe(`File ${G}MB - \u0110ang n\xE9n...`);const Z=await At(y,2,$=>{Xe($)}),me=(Z.size/1024/1024).toFixed(1);Xe(`\u0110\xE3 n\xE9n: ${me}MB - \u0110ang upload...`);const v=await window.KTM.cloudinary.uploadImage({file:Z,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});v.secure_url?(E.image&&E.image!==de&&ht(E.image),F($=>({...$,image:v.secure_url})),Xe("")):(console.error("Cloudinary error:",v),alert("Upload th\u1EA5t b\u1EA1i: "+(((ae=v.error)==null?void 0:ae.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Xe(""))}catch(G){console.error("Upload error:",G),alert("L\u1ED7i: "+G.message),Xe("")}ke(!1),w.target.value=""},ot=()=>{E.image&&(E.image!==de&&ht(E.image),F(w=>({...w,image:""})))},yt=async w=>{w.preventDefault(),ve(!0),de&&E.image&&de!==E.image&&await ht(de),de&&!E.image&&await ht(de),await z(E),ve(!1)};return A?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${_?"fa-edit":"fa-plus-circle"} me-2`}),_?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:ee})),React.createElement("form",{onSubmit:yt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},E.image?React.createElement(React.Fragment,null,React.createElement("img",{src:E.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:ot,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${se?"fa-spinner fa-spin":"fa-camera"} me-1`}),se?L||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Me,disabled:se,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),se&&L&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},L))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:E.name,onChange:w=>F({...E,name:w.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:E.code,onChange:w=>F({...E,code:w.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:E.price,onChange:Ie,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:E.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:w=>F({...E,commission_percent:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:E.category,onChange:w=>F({...E,category:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),O.map(w=>React.createElement("option",{key:w,value:w},w)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:E.note,onChange:w=>F({...E,note:w.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(E.attributes)?E.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(E.attributes)?E.attributes:[]).map((w,y)=>React.createElement("div",{key:y,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(w==null?void 0:w.key)||"",onChange:I=>{const te=I.target.value;F(ae=>{const G=Array.isArray(ae.attributes)?[...ae.attributes]:[];return G[y]={...G[y]||{},key:te},{...ae,attributes:G}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(w==null?void 0:w.value)||"",onChange:I=>{const te=I.target.value;F(ae=>{const G=Array.isArray(ae.attributes)?[...ae.attributes]:[];return G[y]={...G[y]||{},value:te},{...ae,attributes:G}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(w==null?void 0:w.unit)||"",onChange:I=>{const te=I.target.value;F(ae=>{const G=Array.isArray(ae.attributes)?[...ae.attributes]:[];return G[y]={...G[y]||{},unit:te},{...ae,attributes:G}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{F(I=>{const te=Array.isArray(I.attributes)?[...I.attributes]:[];return te.splice(y,1),{...I,attributes:te}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{F(w=>{const y=Array.isArray(w.attributes)?[...w.attributes]:[];return y.push({key:"",value:"",unit:""}),{...w,attributes:y}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(E.variants)?E.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(E.variants)?E.variants:[]).map((w,y)=>React.createElement("div",{key:y,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(w==null?void 0:w.name)||"",onChange:I=>{const te=I.target.value;F(ae=>{var Z;const G=Array.isArray(ae.variants)?[...ae.variants]:[];return G[y]={...G[y]||{},name:te,options:Array.isArray((Z=G[y])==null?void 0:Z.options)?G[y].options:[]},{...ae,variants:G}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>qe(y),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(w==null?void 0:w.options)||w.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{F(I=>{const te=Array.isArray(I.variants)?[...I.variants]:[];return te.splice(y,1),{...I,variants:te}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(w==null?void 0:w.options)?w.options:[]).map((I,te)=>{var ae,G;return React.createElement("div",{key:te,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(I==null?void 0:I.label)||"",onChange:Z=>{const me=Z.target.value;F(v=>{var oe,Ae,_e,Qe,mt;const $=Array.isArray(v.variants)?[...v.variants]:[],B={...$[y]||{},options:Array.isArray((oe=$[y])==null?void 0:oe.options)?[...$[y].options]:[]},ne=Number((_e=(Ae=B.options[te])==null?void 0:Ae.price)!=null?_e:0)||0,he=String((mt=(Qe=B.options[te])==null?void 0:Qe.priceDigits)!=null?mt:Math.max(0,Math.trunc(ne)));return B.options[te]={...B.options[te]||{},label:me,price:Math.max(0,Math.trunc(ne)),priceDigits:he},$[y]=B,{...v,variants:$}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:rt(String((G=I==null?void 0:I.priceDigits)!=null?G:window.KTM.money.getDigits(String((ae=I==null?void 0:I.price)!=null?ae:"")))),onChange:Z=>{F(me=>{var _e,Qe,mt,re,Ke;const v=String((Qe=I==null?void 0:I.priceDigits)!=null?Qe:window.KTM.money.getDigits(String((_e=I==null?void 0:I.price)!=null?_e:""))),$=window.KTM.money.nextPriceInputState(Z.target.value,v),B=String((mt=$.digits)!=null?mt:""),ne=Number(B),he=Number.isFinite(ne)?Math.max(0,Math.trunc(ne)):0,oe=Array.isArray(me.variants)?[...me.variants]:[],Ae={...oe[y]||{},options:Array.isArray((re=oe[y])==null?void 0:re.options)?[...oe[y].options]:[]};return Ae.options[te]={...Ae.options[te]||{},label:String(((Ke=Ae.options[te])==null?void 0:Ke.label)||""),price:he,priceDigits:B},oe[y]=Ae,{...me,variants:oe}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{F(Z=>{var $;const me=Array.isArray(Z.variants)?[...Z.variants]:[],v={...me[y]||{},options:Array.isArray(($=me[y])==null?void 0:$.options)?[...me[y].options]:[]};return v.options.splice(te,1),me[y]=v,{...Z,variants:me}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{F(I=>{var Z;const te=Array.isArray(I.variants)?[...I.variants]:[],ae={...te[y]||{},options:Array.isArray((Z=te[y])==null?void 0:Z.options)?[...te[y].options]:[]},G=He(I.price);return ae.options.push({label:"",price:G,priceDigits:String(G)}),te[y]=ae,{...I,variants:te}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{F(w=>{const y=He(w.price),I=Array.isArray(w.variants)?[...w.variants]:[],te=String(y);return I.push({name:"Size",options:[{label:"S",price:y,priceDigits:te},{label:"M",price:y,priceDigits:te},{label:"L",price:y,priceDigits:te}]}),{...w,variants:I}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Ne,disabled:!Array.isArray(E.variants)||E.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:E.image,onChange:w=>F({...E,image:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:ee,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:fe,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},fe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:A,video:_,onClose:O,onSave:ee}){const[z,E]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[F,fe]=useState(!1),[ve,se]=useState("");useEffect(()=>{_?(E({title:_.title||"",youtube_url:`https://www.youtube.com/watch?v=${_.youtubeId}`,thumbnail_url:_.thumb||"",sort_order:_.sortOrder||0}),se(_.thumb)):(E({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),se(""))},[_,A]);const ke=xe=>{const qe=xe.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return qe?qe[1]:null},He=xe=>{E({...z,youtube_url:xe});const qe=ke(xe);qe&&se(`https://img.youtube.com/vi/${qe}/hqdefault.jpg`)},ye=async xe=>{xe.preventDefault(),fe(!0),await ee(z),fe(!1)};return A?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},_?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:O})),React.createElement("form",{onSubmit:ye},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:z.youtube_url,onChange:xe=>He(xe.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),ve&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:ve,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:z.title,onChange:xe=>E({...z,title:xe.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:z.sort_order,onChange:xe=>E({...z,sort_order:parseInt(xe.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:z.thumbnail_url,onChange:xe=>E({...z,thumbnail_url:xe.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:O},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:F},F?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[A,_]=useState(!1),[O,ee]=useState(""),[z,E]=useState(null),[F,fe]=useState("search"),[ve,se]=useState(()=>loadAdminPins()),[ke,He]=useState(()=>loadAdminRecent()),[ye,xe]=useState(null),[qe,Ne]=useState(""),[L,Xe]=useState([]),[rt,Ye]=useState(null),[Se,Ie]=useState(!1),[de,Je]=useState(null),[ht,At]=useState(!0),[Me,ot]=useState([]),[yt,w]=useState(!1),[y,I]=useState(null),[te,ae]=useState(!1),[G,Z]=useState(!1),[me,v]=useState(""),[$,B]=useState(()=>loadAdminSettings()),[ne,he]=useState(null),[oe,Ae]=useState([]);useEffect(()=>{const d=localStorage.getItem("ktm_admin_session");if(d)try{const D=JSON.parse(d);D.expiry>Date.now()?(_(!0),E(D.user)):localStorage.removeItem("ktm_admin_session")}catch(D){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{A&&Ze()},[A]),useEffect(()=>{const d=()=>{try{const V=document.querySelector(".admin-topbar");if(!V)return;const ue=V.getBoundingClientRect(),be=Math.max(0,Math.round(ue.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${be+10}px`)}catch(V){}};d(),window.addEventListener("resize",d);const D=setTimeout(d,0);return()=>{clearTimeout(D),window.removeEventListener("resize",d)}},[A,F]),useEffect(()=>{var V,ue;const d=window.visualViewport,D=()=>{try{const be=Number(window.innerHeight)||0,Ce=Number(d==null?void 0:d.height)||be,Ge=Number(d==null?void 0:d.offsetTop)||0,Te=Math.max(0,Math.round(be-Ce-Ge));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${Te}px`)}catch(be){}};D(),window.addEventListener("resize",D);try{(V=d==null?void 0:d.addEventListener)==null||V.call(d,"resize",D),(ue=d==null?void 0:d.addEventListener)==null||ue.call(d,"scroll",D)}catch(be){}return()=>{var be,Ce;window.removeEventListener("resize",D);try{(be=d==null?void 0:d.removeEventListener)==null||be.call(d,"resize",D),(Ce=d==null?void 0:d.removeEventListener)==null||Ce.call(d,"scroll",D)}catch(Ge){}}},[]),useEffect(()=>{if(!A)return;const d=V=>{if(!V)return!1;const ue=String(V.tagName||"").toLowerCase();return!!(ue==="input"||ue==="textarea"||ue==="select"||V.isContentEditable)},D=V=>{if(!V||V.ctrlKey||V.metaKey||V.altKey||d(V.target))return;const ue=V.key;(ue==="/"||ue==="N"||ue==="n"||ue==="Escape"||ue==="j"||ue==="J"||ue==="k"||ue==="K")&&(ue==="/"&&V.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:ue}})))};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[A]),useEffect(()=>{A&&He(d=>{const D=Array.isArray(d)?d:[],V=[F,...D.filter(ue=>ue!==F)].slice(0,8);return saveAdminRecent(V),V})},[A]);const _e=d=>{const D=String(d||"").trim();D&&He(V=>{const ue=Array.isArray(V)?V:[],be=[D,...ue.filter(Ce=>Ce!==D)].slice(0,8);return saveAdminRecent(be),be})},Qe=d=>{const D=String(d||"").trim();D&&se(V=>{const ue=Array.isArray(V)?V:[],Ce=ue.includes(D)?ue.filter(Ge=>Ge!==D):[D,...ue].slice(0,10);return saveAdminPins(Ce),Ce})};useEffect(()=>{if(!A)return;let d=!1;return(async()=>{try{const D=await fetchAdminSettingsFromServer();if(d)return;B(D),saveAdminSettings(D)}catch(D){}})(),()=>{d=!0}},[A]);const mt=async(d,D)=>{ee("");try{const V=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:d,password:D},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),ue={user:V.user,token:V.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(ue)),E(V.user),_(!0)}catch(V){ee(V.message)}},re=()=>{localStorage.removeItem("ktm_admin_session"),_(!1),E(null),Xe([]),Ye(null)},Ke=(d,D="success",V=null)=>{const ue=Date.now()+Math.floor(Math.random()*1e3);if(d&&typeof d=="object"){const Ce=d;ot(Ge=>[...Ge,{id:ue,message:String(Ce.message||""),type:String(Ce.type||D||"success"),actionLabel:Ce.actionLabel||null,onAction:typeof Ce.onAction=="function"?Ce.onAction:null,durationMs:Ce.durationMs||null}]);return}const be=V&&typeof V=="object"?V:null;ot(Ce=>[...Ce,{id:ue,message:String(d||""),type:String(D||"success"),actionLabel:(be==null?void 0:be.actionLabel)||null,onAction:typeof(be==null?void 0:be.onAction)=="function"?be.onAction:null,durationMs:(be==null?void 0:be.durationMs)||null}])},xt=d=>{ot(D=>D.filter(V=>V.id!==d))},Ze=async(d=null)=>{At(!0);try{const D=d?`${API_BASE}/api/albums?parent_id=${d}`:`${API_BASE}/api/albums?parent_id=root`,V=await window.KTM.api.getJSON(D,"L\u1ED7i t\u1EA3i danh s\xE1ch album");Xe(Array.isArray(V)?V:[])}catch(D){console.error(D),Ke("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}At(!1)},jt=()=>{Je(null),Ie(!0)},St=d=>{Be(d),ae(!0)},Wt=async(d,D="modal")=>{try{const V=de&&de.uuid;!V&&ne&&(d.parent_id=ne.uuid);const ue=V?`${API_BASE}/api/albums/${de.uuid||de.id}`:`${API_BASE}/api/albums`;V?await window.KTM.api.putJSON(ue,d,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(ue,d,"L\u1ED7i t\u1EA1o"),Ke(V?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),D==="drawer"?(ae(!1),Je(null),Ze(ne==null?void 0:ne.uuid),V&&y&&I({...y,...d})):(Ie(!1),Je(null),Ze(ne==null?void 0:ne.uuid))}catch(V){Ke(V.message,"danger")}},Kt=d=>{Ye(d)},S=d=>{if(d==="root")Ae([]),he(null),Ze(null);else if(d){const D=oe.findIndex(V=>V.uuid===d.uuid);D>=0&&(Ae(oe.slice(0,D+1)),he(d),Ze(d.uuid))}else{const D=[...oe];D.pop();const V=D[D.length-1]||null;Ae(D),he(V),Ze(V==null?void 0:V.uuid)}},X=async d=>{const D=`X\xF3a folder "${d.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(D))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${d.uuid||d.id}`,"L\u1ED7i x\xF3a album"),Ke("\u0110\xE3 x\xF3a","success"),Ze(ne==null?void 0:ne.uuid)}catch(V){Ke("L\u1ED7i x\xF3a album","danger")}},Be=async d=>{d&&(w(!0),v(""),Z(!1),ae(!1),I(d))},ut=()=>{w(!1),Z(!1),v(""),ae(!1),I(null)},Ft=d=>{ae(!0)};if(!A)return React.createElement(LoginPage,{onLogin:mt,error:O});const ft=()=>{const d=new Date,D=d.getFullYear(),V=String(d.getMonth()+1).padStart(2,"0");return`${D}-${V}`};function kt(){const[d,D]=useState(()=>{var Ce;return String((Ce=$==null?void 0:$.ship_percent)!=null?Ce:DEFAULT_SHIP_PERCENT)}),[V,ue]=useState(!1);return useEffect(()=>{var Ce;D(String((Ce=$==null?void 0:$.ship_percent)!=null?Ce:DEFAULT_SHIP_PERCENT))},[$==null?void 0:$.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Ce=>{Ce.preventDefault(),ue(!0);const Ge=saveAdminSettings({ship_percent:d});try{const Te=await saveAdminSettingsToServer(Ge);B(Te),saveAdminSettings(Te),Ke("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Te){B(Ge),Ke("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{ue(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:d,min:"0",max:"100",step:"0.01",onChange:Ce=>D(Ce.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:V},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function M(){const[d,D]=useState(ft()),[V,ue]=useState(!0),be=useRef(null),Ce=useRef(null),[Ge,Te]=useState(0),[Pt,bt]=useState(!1),_t=useRef(0),[Ht,Lt]=useState(!1),[Rt,ka]=useState(""),[ra,zt]=useState(""),[Ut,ha]=useState(""),[nt,Aa]=useState(null),oa=useRef(new Map),[Xt,fa]=useState(window!=null&&window.XLSX?"ready":"loading"),Tt=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[je,ja]=useState(Tt),Ra=useRef(new Map),$t=normalizeShipPercent($==null?void 0:$.ship_percent),{formatNumber:Ve,formatVND:Ct}=window.KTM.money,Zt=async(o,N=!1)=>{var Re,Le;const R=String(o||"").trim();if(!R)return Tt();const l=`${R}|${$t}`,H=(Re=Ra.current)==null?void 0:Re.get(l);if(!N&&H)return H;const ge=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(R)}&ship_percent=${encodeURIComponent($t)}`,q=await window.KTM.api.getJSON(ge,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),we=q!=null&&q.stats&&(q!=null&&q.meta)?q.stats:q,ze=we&&typeof we=="object"?we:Tt();return(Le=Ra.current)==null||Le.set(l,ze),ze},la=async(o=!1)=>{ue(!0);try{const N=await Zt(d,o);ja(N)}catch(N){console.error("Load stats error:",N),ja(Tt())}finally{ue(!1)}};useEffect(()=>{la()},[d,$t]);const Mt=(o,N)=>{const R=String(o||"").trim(),l=R.match(/^(\d{4})-(\d{2})$/);if(!l)return R;const H=Number(l[1]),ge=Number(l[2])-1,q=new Date(H,ge,1);q.setMonth(q.getMonth()+Number(N||0));const we=q.getFullYear(),ze=String(q.getMonth()+1).padStart(2,"0");return`${we}-${ze}`},gt=ft(),ca=Mt(gt,-5),Jt=o=>{const N=String(o||"").trim();return N?N>=ca&&N<=gt:!1},Yt=o=>{const N=String(o||"").trim();return N&&(N<ca?ca:N>gt?gt:N)},_a=o=>{const N=Date.now();N-Number(_t.current||0)<1200||(_t.current=N,Ke(o==="future"?"Kh\xF4ng xem \u0111\u01B0\u1EE3c th\xE1ng t\u01B0\u01A1ng lai":"Ch\u1EC9 xem t\u1ED1i \u0111a 5 th\xE1ng g\u1EA7n nh\u1EA5t","warning"))},Gt=(o,N,R)=>Math.max(N,Math.min(R,o)),ea=()=>{var o;return Math.max(320,Number((o=Ce.current)==null?void 0:o.clientWidth)||360)},pt=()=>{const o=ea();return Gt(Math.floor(o*.35),110,180)},da=()=>{const o=ea();return Gt(Math.floor(o*.22),70,140)};useEffect(()=>{let o=!1;const N=()=>!!(window!=null&&window.XLSX&&typeof window.XLSX.read=="function"),R=H=>new Promise((ge,q)=>{try{if(Array.from(document.querySelectorAll("script")).find(Re=>((Re==null?void 0:Re.src)||"").includes(H))){const Re=Date.now(),Le=setInterval(()=>{N()?(clearInterval(Le),ge(!0)):Date.now()-Re>2500&&(clearInterval(Le),q(new Error("existing script not loaded")))},100);return}const ze=document.createElement("script");ze.src=H,ze.async=!0,ze.onload=()=>ge(!0),ze.onerror=()=>q(new Error(`load failed: ${H}`)),document.head.appendChild(ze)}catch(we){q(we)}}),l=async()=>{if(N())return!0;const H=["https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js","https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js","https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"];for(const ge of H){if(N())return!0;try{if(await R(ge),N())return!0}catch(q){}}return N()};return(async()=>{if(Xt==="ready"||Xt==="failed")return;if(N()){o||fa("ready");return}o||fa("loading"),await new Promise(ge=>setTimeout(ge,300));const H=await l();o||fa(H?"ready":"failed")})(),()=>{o=!0}},[Xt]);const qt=o=>{const N=String(o!=null?o:"").trim().toLowerCase();if(!N)return"";try{return N.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/đ/g,"d").replace(/[^a-z0-9\s\.\-\/\+]/g," ").replace(/\s+/g," ").trim()}catch(R){return N.replace(/\s+/g," ").trim()}},Dt=o=>{var ge,q;if(o==null||o==="")return"";if(typeof o=="number"&&Number.isFinite(o)&&((q=(ge=window==null?void 0:window.XLSX)==null?void 0:ge.SSF)!=null&&q.parse_date_code))try{const we=window.XLSX.SSF.parse_date_code(o);return!we||!we.y||!we.m?"":`${String(we.y).padStart(4,"0")}-${String(we.m).padStart(2,"0")}`}catch(we){}const N=String(o).trim(),R=N.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(R){const we=String(Number(R[2])||0).padStart(2,"0");return`${R[3]}-${we}`}const l=N.match(/^(\d{4})-(\d{2})-(\d{2})/);if(l)return`${l[1]}-${l[2]}`;const H=new Date(N);return Number.isNaN(H.getTime())?"":`${H.getFullYear()}-${String(H.getMonth()+1).padStart(2,"0")}`},La=o=>o==null||o===""?0:typeof o=="number"&&Number.isFinite(o)?Math.trunc(o):window.KTM.money.parseMoney(String(o)),za=async()=>{var N;const o=oa.current;if(o&&o.size>0)return o;try{const R=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m"),l=Array.isArray(R==null?void 0:R.products)?R.products:Array.isArray(R)?R:[],H=new Map;for(const ge of l){const q=String((N=ge==null?void 0:ge.id)!=null?N:"").trim();q&&H.set(q,ge)}return oa.current=H,H}catch(R){return oa.current=new Map,oa.current}},Xa=o=>{var R;const N=String(o!=null?o:"").trim();return N&&((R=oa.current)==null?void 0:R.get(N))||null},Ta=async o=>{var Ee,et,It;if(!o)throw new Error("Ch\u01B0a ch\u1ECDn file");if(!((Ee=window==null?void 0:window.XLSX)!=null&&Ee.read))throw new Error("Thi\u1EBFu th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). Vui l\xF2ng t\u1EA3i l\u1EA1i trang admin.");const N=await o.arrayBuffer(),R=window.XLSX.read(N,{type:"array"}),l=(et=R==null?void 0:R.SheetNames)==null?void 0:et[0],H=l?R.Sheets[l]:null;if(!H)throw new Error("Kh\xF4ng \u0111\u1ECDc \u0111\u01B0\u1EE3c sheet trong file");const ge=window.XLSX.utils.sheet_to_json(H,{header:1,raw:!0,defval:""}),q=Array.isArray(ge)?ge:[];if(!q.length)throw new Error("File r\u1ED7ng");const we={product:["ten san pham","tensanpham","san pham","t\xEAn s\u1EA3n ph\u1EA9m"],cod:["tong tien thu ho","t\u1ED5ng ti\u1EC1n thu h\u1ED9","thu ho","thu h\u1ED9","tong thu ho","t\u1ED5ng thu h\u1ED9"],date:["ngay","ng\xE0y","date"]},Re=(()=>{const st=Math.min(30,q.length);for(let j=0;j<st;j++){const J=(Array.isArray(q[j])?q[j]:[]).map(Pe=>qt(Pe)),ie=Pe=>{for(let De=0;De<J.length;De++){const tt=J[De];if(tt&&Pe.some(Nt=>tt.includes(qt(Nt))))return De}return-1},pe=ie(we.product),ce=ie(we.cod);if(pe>=0&&ce>=0){const Pe=ie(we.date);return{headerRow:j,productCol:pe,codCol:ce,dateCol:Pe}}}return null})();if(!Re)throw new Error('Kh\xF4ng t\xECm th\u1EA5y header c\u1ED9t "T\xEAn s\u1EA3n ph\u1EA9m" v\xE0 "T\u1ED5ng ti\u1EC1n thu h\u1ED9"');const Le=[],lt=new Set;for(let st=Re.headerRow+1;st<q.length;st++){const j=Array.isArray(q[st])?q[st]:[],K=String((It=j[Re.productCol])!=null?It:"").trim(),J=La(j[Re.codCol]);if(!K&&!J)continue;const ie=qt(K);if(!ie||ie.includes("tong tien")||ie.includes("tong")||ie.includes("thanh toan")||ie.includes("thanh to\xE1n"))continue;const pe=Re.dateCol>=0?j[Re.dateCol]:"",ce=pe?Dt(pe):"";ce&&lt.add(ce),Le.push({rowIndex:st+1,dateRaw:pe,monthKey:ce,product:K,productNorm:qt(K),productCompact:qt(K).replace(/\s+/g,""),cod:J})}return{rows:Le,monthKeys:Array.from(lt.values()).sort()}},Ja=async o=>{const N=`${API_BASE}/api/orders?month=${encodeURIComponent(o)}&includeItems=1`,R=await window.KTM.api.getJSON(N,"L\u1ED7i t\u1EA3i danh s\xE1ch \u0111\u01A1n");return Array.isArray(R==null?void 0:R.orders)?R.orders:Array.isArray(R)?R:[]},Ga=async o=>{const N=Array.isArray(o)&&o.length?o:[d],R=[];for(let q=0;q<N.length;q++){const we=N[q];zt(`\u0110ang t\u1EA3i \u0111\u01A1n h\u1EC7 th\u1ED1ng th\xE1ng ${we} (${q+1}/${N.length})...`);const ze=await Ja(we);R.push(...ze)}const l=q=>String(q||"").trim().toLowerCase();return R.filter(q=>{const we=l(q==null?void 0:q.status);return we!=="draft"&&we!=="canceled"}).map(q=>{var Le,lt,Ee;const we=window.KTM.orders.getOrderProductSummary(q,Xa),ze=window.KTM.orders.getOrderTotalMoney(q,Xa),Re=qt(we);return{id:String((Le=q==null?void 0:q.id)!=null?Le:""),created_at:(lt=q==null?void 0:q.created_at)!=null?lt:null,status:String((Ee=q==null?void 0:q.status)!=null?Ee:""),productSummary:we,productNorm:Re,productCompact:Re.replace(/\s+/g,""),cod:Number(ze||0)||0,raw:q}}).filter(q=>q.id&&q.cod>0)},ta=(o,N)=>{const R=String(o||"").trim(),l=String(N||"").trim();if(!R||!l)return 0;if(R===l)return 1;const H=R.replace(/\s+/g,""),ge=l.replace(/\s+/g,"");if(H&&ge&&H===ge)return 1;if(H&&ge&&(ge.includes(H)||H.includes(ge)))return .9;const q=R.split(" ").filter(Boolean);if(!q.length)return 0;let we=0;for(const Le of q)Le.length<=1||l.includes(Le)&&(we+=1);const ze=we/Math.max(1,q.length),Re=Math.min(.15,Math.abs(R.length-l.length)/Math.max(1,Math.max(R.length,l.length)));return Math.max(0,ze-Re)},ba=async o=>{ka(""),Aa(null),ha((o==null?void 0:o.name)||""),Lt(!0),zt("\u0110ang \u0111\u1ECDc file Excel...");try{await za();const N=await Ta(o),R=N.rows,l=N.monthKeys.length?N.monthKeys:[d];zt(`\u0110\u1ECDc \u0111\u01B0\u1EE3c ${R.length} d\xF2ng. \u0110ang chu\u1EA9n b\u1ECB \u0111\u1ED1i so\xE1t...`);const H=await Ga(l);zt(`\u0110ang \u0111\u1ED1i so\xE1t (${R.length} d\xF2ng Excel vs ${H.length} \u0111\u01A1n h\u1EC7 th\u1ED1ng)...`);const ge=new Map;for(const et of H){const It=String(et.cod),st=ge.get(It)||[];st.push(et),ge.set(It,st)}const q=new Set,we=[],ze=[],Re=[];for(const et of R){const It=(ge.get(String(et.cod))||[]).filter(K=>!q.has(K.id));if(!It.length){ze.push(et);continue}let st=null,j=-1;for(const K of It){const J=ta(et.productNorm,K.productNorm);J>j&&(j=J,st=K)}st&&j>=.55?(q.add(st.id),we.push({row:et,order:st,score:j})):ze.push(et)}const Le=[];for(const et of ze){let It=null,st=-1;for(const j of H){const K=ta(et.productNorm,j.productNorm);K>st&&(st=K,It=j)}It&&st>=.72&&Number(It.cod||0)!==Number(et.cod||0)?Re.push({row:et,order:It,score:st,diff:Number(et.cod||0)-Number(It.cod||0)}):Le.push(et)}const lt=H.filter(et=>!q.has(et.id)),Ee=Le.length===0&&lt.length===0&&Re.length===0;Aa({ok:Ee,monthKeys:l,excelCount:R.length,systemCount:H.length,matches:we,excelOnly:Le,systemOnly:lt,amountMismatch:Re}),zt(Ee?"OK \u2705":"\u0110\xE3 \u0111\u1ED1i so\xE1t xong")}catch(N){ka(String((N==null?void 0:N.message)||N||"L\u1ED7i \u0111\u1ED1i so\xE1t")),zt("")}finally{Lt(!1)}},ma=o=>{try{if(!(o!=null&&o.touches)||o.touches.length!==1||Pt)return;const N=o.target;if(N&&typeof N.closest=="function"&&N.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){be.current=null;return}const R=o.touches[0];be.current={x:R.clientX,y:R.clientY,at:Date.now(),swiping:!1}}catch(N){be.current=null}},Wa=o=>{const N=be.current;if(!N||Pt)return;const R=(o==null?void 0:o.touches)&&o.touches[0];if(!R)return;const l=R.clientX-N.x,H=R.clientY-N.y,ge=Math.abs(l),q=Math.abs(H);if(!N.swiping)if(ge>12&&ge>q*1.2)N.swiping=!0,bt(!1);else return;const we=pt();Te(Gt(l,-we,we))},s=o=>{const N=be.current;if(be.current=null,!N||Pt||!N.swiping){Te(0);return}const R=(o==null?void 0:o.changedTouches)&&o.changedTouches[0];if(!R)return;const l=R.clientX-N.x,H=R.clientY-N.y,ge=Date.now()-N.at,q=Math.abs(l),we=Math.abs(H);if(ge>1e3)return;if(q<30){Te(0);return}if(q<we*1.5)return;const ze=da(),Re=q>=ze,Le=l>0?1:-1;if(!Re){bt(!0),Te(0),setTimeout(()=>bt(!1),220);return}const lt=Le>0?-1:1,Ee=Mt(d,lt);if(!Jt(Ee)){bt(!0),Te(Le*Math.floor(pt()*.55)),setTimeout(()=>{Te(0),setTimeout(()=>bt(!1),200)},140),_a(Ee>gt?"future":"past");return}bt(!0),Te(Le*pt()),setTimeout(()=>{D(et=>Mt(et,lt)),Te(-Le*pt()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Te(0),setTimeout(()=>bt(!1),220)})})},140)},p=()=>{be.current=null,Te(0)},u=o=>{var N,R;try{if(!o||o.pointerType==="touch"||typeof o.button=="number"&&o.button!==0||Pt)return;const l=o.target;if(l&&typeof l.closest=="function"&&l.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){be.current=null;return}be.current={x:o.clientX,y:o.clientY,at:Date.now(),swiping:!1};try{(R=(N=o.currentTarget)==null?void 0:N.setPointerCapture)==null||R.call(N,o.pointerId)}catch(H){}}catch(l){be.current=null}},T=o=>{try{if(!o||o.pointerType==="touch")return;const N=be.current;if(!N||Pt)return;const R=o.clientX-N.x,l=o.clientY-N.y,H=Math.abs(R),ge=Math.abs(l);if(!N.swiping)if(H>12&&H>ge*1.2)N.swiping=!0,bt(!1);else return;const q=pt();Te(Gt(R,-q,q))}catch(N){}},P=o=>{try{if(!o||o.pointerType==="touch")return;const N=be.current;if(be.current=null,!N||Pt||!N.swiping){Te(0);return}const R=o.clientX-N.x,l=o.clientY-N.y,H=Date.now()-N.at,ge=Math.abs(R),q=Math.abs(l);if(H>1e3)return;if(ge<30){Te(0);return}if(ge<q*1.5)return;const we=da(),ze=ge>=we,Re=R>0?1:-1;if(!ze){bt(!0),Te(0),setTimeout(()=>bt(!1),220);return}const Le=Re>0?-1:1,lt=Mt(d,Le);if(!Jt(lt)){bt(!0),Te(Re*Math.floor(pt()*.55)),setTimeout(()=>{Te(0),setTimeout(()=>bt(!1),200)},140),_a(lt>gt?"future":"past");return}bt(!0),Te(Re*pt()),setTimeout(()=>{D(Ee=>Mt(Ee,Le)),Te(-Re*pt()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Te(0),setTimeout(()=>bt(!1),220)})})},140)}catch(N){be.current=null}},C=()=>{be.current=null,Te(0)},g=Ge>0?"Th\xE1ng tr\u01B0\u1EDBc":Ge<0?"Th\xE1ng sau":"",W=Ge>0?Mt(d,-1):Ge<0?Mt(d,1):"",le=W&&Jt(W)?W:"",Q=Math.min(1,Math.abs(Ge)/Math.max(1,da()));return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager",ref:Ce,style:{touchAction:"pan-y",transform:`translateX(${Ge}px)`,transition:Pt?"transform 220ms ease":"none",willChange:"transform"},onTouchStartCapture:ma,onTouchMoveCapture:Wa,onTouchEndCapture:s,onTouchCancelCapture:p,onPointerDown:u,onPointerMove:T,onPointerUp:P,onPointerCancel:C},!!g&&React.createElement("div",{"aria-hidden":"true",style:{position:"fixed",left:0,right:0,top:84,zIndex:1060,pointerEvents:"none",opacity:.15+.55*Q,transform:"translateZ(0)"}},React.createElement("div",{className:"d-flex justify-content-center"},React.createElement("div",{className:"px-3 py-2 rounded-pill bg-dark text-white shadow-sm",style:{fontSize:13}},Ge>0?"\u2190":"\u2192"," ",g," \xB7 ",le))),React.createElement(Loading,{show:V}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>la(!0),disabled:V},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:d,onChange:o=>D(o.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",$t,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),Ve(je.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),Ve(je.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),Ve(je.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",Ve(je.statusCounts.paid),"/",Ve(je.statusCounts.done)))))),React.createElement("div",{className:"card border-0 shadow-sm mb-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{className:"fw-semibold"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 (Excel)"),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("span",{className:"text-muted small"},"Check: ",React.createElement("span",{className:"fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m")," + ",React.createElement("span",{className:"fw-semibold"},"T\u1ED5ng ti\u1EC1n thu h\u1ED9")))),Xt==="loading"&&React.createElement("div",{className:"alert alert-info mt-3 mb-0"},"\u0110ang t\u1EA3i th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX)..."),Xt==="failed"&&React.createElement("div",{className:"alert alert-warning mt-3 mb-0"},"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). H\xE3y ki\u1EC3m tra m\u1EA1ng / ch\u1EB7n CDN (AdBlock) ho\u1EB7c refresh l\u1EA1i trang."),React.createElement("div",{className:"row g-2 align-items-end mt-2"},React.createElement("div",{className:"col-12 col-md-7"},React.createElement("label",{className:"form-label mb-1"},"Upload file Excel"),React.createElement("input",{type:"file",className:"form-control",accept:".xlsx,.xls,.csv",disabled:Ht,onChange:async o=>{const N=o.target.files&&o.target.files[0];N&&await ba(N)}}),React.createElement("div",{className:"form-text"},Ut?`File: ${Ut}`:'Header c\u1EA7n c\xF3: "T\xEAn s\u1EA3n ph\u1EA9m" v\xE0 "T\u1ED5ng Ti\u1EC1n Thu H\u1ED9". C\xF3 c\u1ED9t "Ng\xE0y" th\xEC s\u1EBD t\u1EF1 t\u1EA3i \u0111\xFAng th\xE1ng trong file.')),React.createElement("div",{className:"col-12 col-md-5 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",disabled:Ht,onClick:()=>{ka(""),zt(""),Aa(null),ha(""),Ke("\u0110\xE3 reset \u0111\u1ED1i so\xE1t","info")}},React.createElement("i",{className:"fas fa-rotate-left me-2"}),"Reset"))),ra&&React.createElement("div",{className:"mt-2 small text-muted"},ra),Rt&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0"},Rt),nt&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:`alert ${nt.ok?"alert-success":"alert-warning"} mb-3`},nt.ok?React.createElement("div",{className:"fw-semibold"},"OK \u2014 File Excel \u0111\xE3 kh\u1EDBp \u0111\u1EA7y \u0111\u1EE7 v\u1EDBi h\u1EC7 th\u1ED1ng."):React.createElement("div",{className:"fw-semibold"},"CH\u01AFA KH\u1EDAP \u2014 C\xF3 thi\u1EBFu/sai l\u1EC7ch so v\u1EDBi h\u1EC7 th\u1ED1ng."),React.createElement("div",{className:"small mt-1"},"Th\xE1ng \u0111\u1ED1i so\xE1t: ",Array.isArray(nt.monthKeys)?nt.monthKeys.join(", "):""," \xB7 Excel: ",nt.excelCount," d\xF2ng \xB7 H\u1EC7 th\u1ED1ng: ",nt.systemCount," \u0111\u01A1n")),!nt.ok&&React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-12"},Array.isArray(nt.amountMismatch)&&nt.amountMismatch.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-danger"},"Sai l\u1EC7ch s\u1ED1 ti\u1EC1n (t\xECm theo t\xEAn s\u1EA3n ph\u1EA9m)"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m (Excel)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (Excel)"),React.createElement("th",null,"Order ID"),React.createElement("th",null,"T\xEAn SP (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"L\u1EC7ch"))),React.createElement("tbody",null,nt.amountMismatch.slice(0,30).map(o=>React.createElement("tr",{key:`mm-${o.row.rowIndex}`,className:"table-danger"},React.createElement("td",null,o.row.rowIndex),React.createElement("td",{style:{minWidth:260}},o.row.product),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(o.row.cod)),React.createElement("td",{className:"text-muted"},o.order.id),React.createElement("td",{style:{minWidth:240}},o.order.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(o.order.cod)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(o.diff))))))),nt.amountMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",nt.amountMismatch.length," d\xF2ng."))),Array.isArray(nt.excelOnly)&&nt.excelOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong Excel nh\u01B0ng kh\xF4ng th\u1EA5y \u0111\u01A1n kh\u1EDBp trong h\u1EC7 th\u1ED1ng"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"))),React.createElement("tbody",null,nt.excelOnly.slice(0,30).map(o=>React.createElement("tr",{key:`eo-${o.rowIndex}`,className:"table-warning"},React.createElement("td",null,o.rowIndex),React.createElement("td",{className:"text-muted"},String(o.dateRaw||"")),React.createElement("td",{style:{minWidth:280}},o.product),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(o.cod))))))),nt.excelOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",nt.excelOnly.length," d\xF2ng."))),Array.isArray(nt.systemOnly)&&nt.systemOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong h\u1EC7 th\u1ED1ng nh\u01B0ng thi\u1EBFu trong Excel"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y t\u1EA1o"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,nt.systemOnly.slice(0,30).map(o=>React.createElement("tr",{key:`so-${o.id}`,className:"table-warning"},React.createElement("td",{className:"text-muted"},o.id),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(o.created_at)),React.createElement("td",{style:{minWidth:280}},o.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(o.cod)),React.createElement("td",{className:"text-muted"},o.status)))))),nt.systemOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",nt.systemOnly.length," \u0111\u01A1n.")))))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ve(je.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ct(je.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ct(je.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ct(je.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ct(je.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",je.avgQtyPerOrder?je.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},Ve(je.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},Ve(je.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},Ve(je.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},Ve(je.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},Ve(je.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},Ve(je.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},Ve(je.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,Ve(je.statusCounts.draft)),React.createElement("td",null,Ve(je.statusCounts.pending)),React.createElement("td",null,Ve(je.statusCounts.processing)),React.createElement("td",null,Ve(je.statusCounts.canceled)),React.createElement("td",null,Ve(je.statusCounts.done)),React.createElement("td",null,Ve(je.statusCounts.paid)),React.createElement("td",null,Ve(je.statusCounts.other)),React.createElement("td",null,Ve(je.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},je.products.slice(0,10).map(o=>React.createElement("div",{key:o.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},o.product_name),React.createElement("div",{className:"text-muted small text-truncate"},o.product_code?`#${o.product_code} \u2022 `:"",Ve(o.orders)," \u0111\u01A1n \u2022 ",Ve(o.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ct(o.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,je.products.slice(0,10).map(o=>React.createElement("tr",{key:o.product_id},React.createElement("td",null,o.product_name),React.createElement("td",null,o.product_code||"\u2014"),React.createElement("td",null,Ve(o.orders)),React.createElement("td",null,Ve(o.quantity)),React.createElement("td",{className:"fw-semibold"},Ct(o.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},je.customers.slice(0,10).map(o=>React.createElement("div",{key:o.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},o.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},o.phone||"\u2014"," \u2022 ",Ve(o.orders)," \u0111\u01A1n \u2022 ",Ve(o.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ct(o.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,je.customers.slice(0,10).map(o=>React.createElement("tr",{key:o.key},React.createElement("td",null,o.customer_name||"\u2014"),React.createElement("td",null,o.phone||"\u2014"),React.createElement("td",null,Ve(o.orders)),React.createElement("td",null,Ve(o.quantity)),React.createElement("td",{className:"fw-semibold"},Ct(o.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},je.days.map(o=>React.createElement("div",{key:o.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},o.day),React.createElement("div",{className:"text-muted small"},Ve(o.orders)," \u0111\u01A1n \u2022 ",Ve(o.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",Ve(o.doneOrders)," \u2022 ",Ct(o.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Ct(o.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,je.days.map(o=>React.createElement("tr",{key:o.day},React.createElement("td",null,o.day),React.createElement("td",null,Ve(o.orders)),React.createElement("td",null,Ve(o.quantity)),React.createElement("td",{className:"fw-semibold"},Ct(o.revenue)),React.createElement("td",null,Ve(o.doneOrders)),React.createElement("td",{className:"fw-semibold"},Ct(o.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:F,onMenuChange:d=>{_e(d),fe(d),d==="albums"&&(he(null),Ae([]),Ze(null))},onLogout:re,currentUser:z,pinnedMenus:ve,recentMenus:ke,onTogglePin:Qe}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const D={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[F]||{title:"KTM Admin",icon:"fa-tractor",sub:""},V=(z==null?void 0:z.username)||(z==null?void 0:z.name)||(z==null?void 0:z.email)||"Admin",ue=(()=>{if(F!=="albums")return"";const be=[];return be.push("Root"),Array.isArray(oe)&&oe.length>0&&be.push(...oe.map(Ce=>Ce==null?void 0:Ce.title).filter(Boolean)),rt!=null&&rt.title&&be.push(rt.title),be.length>0?be.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${D.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},D.title),React.createElement("div",{className:"admin-page-subtitle"},ue||D.sub))),React.createElement("div",{className:"admin-topbar-right"},F==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:jt,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:V},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},V)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:re,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},F==="albums"&&!rt&&React.createElement(AlbumList,{albums:L,loading:ht,currentFolder:ne,breadcrumb:oe,onSelect:Kt,onCreate:jt,onEdit:St,onDelete:X,onBack:S}),F==="search"&&React.createElement(SearchCenter,{showToast:Ke,onNavigate:(d,D,V)=>{fe(d),d==="orders"&&D==="create"&&(xe(Date.now()),Ne((V==null?void 0:V.productId)||""))}}),F==="albums"&&rt&&React.createElement(AlbumDetail,{album:rt,parentAlbum:oe.length>0?oe[oe.length-1]:null,onBack:()=>{if(rt.parentId){const d=oe.findIndex(D=>D.uuid===rt.parentId);d>=0?Ye(oe[d]):Ye(null)}else Ye(null)},onRefresh:()=>Ze(ne==null?void 0:ne.uuid),showToast:Ke,onNavigateToFolder:d=>{Ae(D=>[...D,rt]),Ye(d)},onEditSubfolder:d=>{Je(d),Ie(!0)}}),F==="videos"&&React.createElement(VideoList,{showToast:Ke}),F==="products"&&React.createElement(ProductManager,{showToast:Ke,settings:$}),F==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:ye,autoOpenCreateProductId:qe,showToast:Ke}),F==="stats"&&React.createElement(M,null),F==="settings"&&React.createElement(kt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${F==="search"?"active":""}`,onClick:d=>{d.preventDefault(),fe("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${F==="albums"?"active":""}`,onClick:d=>{d.preventDefault(),fe("albums"),Ye(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${F==="videos"?"active":""}`,onClick:d=>{d.preventDefault(),fe("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${F==="products"?"active":""}`,onClick:d=>{d.preventDefault(),fe("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${F==="orders"?"active":""}`,onClick:d=>{d.preventDefault(),fe("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${F==="stats"?"active":""}`,onClick:d=>{d.preventDefault(),fe("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:Se,album:de,parentId:ne==null?void 0:ne.uuid,onClose:()=>Ie(!1),onSave:Wt}),React.createElement(AdminDrawer,{open:yt,title:y?y.title:"Album",subtitle:y?`${y.subfolderCount||0} subfolder \u2022 ${y.count||0} \u1EA3nh`:"",onClose:ut,footer:te?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{ae(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{y&&(Je(y),Wt({slug:y.id||"",title:y.title||"",description:y.description||"",cover_url:y.cover||"",parent_id:y.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):y?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(y.title),Ke("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>Ft(y)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{y&&confirm(`X\xF3a folder "${y.title}"?`)&&(X(y),ut())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},te&&y?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:y.title,onChange:d=>I({...y,title:d.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:y.description,onChange:d=>I({...y,description:d.target.value})}))):y?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},y.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},y.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},y.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},y.count||0))),y.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,y.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Me.map(d=>React.createElement(Toast,{key:d.id,message:d.message,type:d.type,actionLabel:d.actionLabel,onAction:d.onAction,durationMs:d.durationMs,onClose:()=>xt(d.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:A,autoOpenCreateProductId:_,showToast:O}){const[ee,z]=useState([]),[E,F]=useState(0),[fe,ve]=useState(!1),[se,ke]=useState(!1),[He,ye]=useState([]),[xe,qe]=useState(!0),[Ne,L]=useState(!1),[Xe,rt]=useState([]),[Ye,Se]=useState(!1),[Ie,de]=useState(""),[Je,ht]=useState([]),[At,Me]=useState(!1),[ot,yt]=useState(""),[w,y]=useState(!1),[I,te]=useState(null),[ae,G]=useState(null),[Z,me]=useState(!1),[v,$]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[B,ne]=useState(""),[he,oe]=useState(!1),[Ae,_e]=useState(!1),[Qe,mt]=useState(!1),[re,Ke]=useState(null),[xt,Ze]=useState(!1),[jt,St]=useState(""),[Wt,Kt]=useState(!1),S=useRef(0),[X,Be]=useState(!1),[ut,Ft]=useState(null),[ft,kt]=useState(!1),[M,d]=useState(null),[D,V]=useState(()=>({left:12,top:12,placement:"bottom"})),ue=useRef(null),be=useRef(!1),Ce=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1}),[Ge,Te]=useState(()=>({id:null,dir:null})),Pt=useRef(!1),bt=useRef(new Map),_t=useRef(null),Ht=useRef(null),Lt="ktm_orders_status_sync_queue_v1",Rt=useRef([]),ka=useRef(!1),[ra,zt]=useState(()=>({})),[Ut,ha]=useState(!1),[nt,Aa]=useState(!1),[oa,Xt]=useState(!1),[fa,Tt]=useState(()=>new Set),[je,ja]=useState(()=>({})),Ra="ktm_orders_pinned_v1",[$t,Ve]=useState(()=>new Set),[Ct,Zt]=useState(!1),[la,Mt]=useState(!1),[gt,ca]=useState(!1),[Jt,Yt]=useState(""),[_a,Gt]=useState(()=>[]),ea=useRef(null),pt=useRef(null),da=useRef(!1),qt=useRef({active:!1,startY:0,startX:0,fired:!1}),[Dt,La]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),za=24,Xa=20,[Ta,Ja]=useState(za),Ga=useRef(null),ta=useRef(null),ba=useRef(!1),ma=useRef(new Map),Wa=useRef({timer:null,events:[]}),s=useRef(null),p="ktm_orders_phone_tip_v1",u="ktm_orders_search_history_v1",[T,P]=useState(null),[C,g]=useState(!1),[W,le]=useState([]),[Q,o]=useState(!1),[N,R]=useState([]),[l,H]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[ge,q]=useState([""]),[we,ze]=useState(null),Re=useRef({}),[Le,lt]=useState([]),[Ee,et]=useState(null),It=useRef(null),st=useRef(null),j=useRef(0),K=useRef(null),J=useRef(0),ie=useRef(new Map),pe=useRef(null),ce=useRef(0),Pe=useRef(new Map),De=useRef(new Map),tt=useRef(""),Nt=useRef(null),Ot=useRef(null),Bt=useRef(0),aa=useRef(null),Qt=9,na=150,ga=250,va=3*60*1e3,ya=24*60*60*1e3,Da=5*60*1e3,Ma="ktm_customer_lookup_cache_v1",fn=200,Na=3,Ea=3,Dn=1,Os=24*60*60*1e3,js=120,Rs=5*60*1e3,Yn=80,Qn=2,Zn=4,es=60,$e=React.useMemo(()=>String(Ie||"").trim().length>0,[Ie]),rn=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),ts=e=>{Ft(e),Be(!0)},as=(e,a)=>{var t,n,i,r;try{const h=(t=a==null?void 0:a.getBoundingClientRect)==null?void 0:t.call(a),m=window.innerWidth||360,x=window.innerHeight||640,f=230,c=280,b=Math.min(Math.max(10,Math.round((n=h==null?void 0:h.left)!=null?n:10)),Math.max(10,m-f-10));let k=Math.round(((i=h==null?void 0:h.bottom)!=null?i:10)+8),U="bottom";k+c>x-10&&(k=Math.max(10,Math.round(((r=h==null?void 0:h.top)!=null?r:10)-8-c)),U="top"),V({left:b,top:k,placement:U})}catch(h){V({left:12,top:12,placement:"bottom"})}d(e),kt(!0)},Pa=()=>{kt(!1),setTimeout(()=>d(null),120)};useEffect(()=>{if(!ft)return;const e=a=>{a.key==="Escape"&&Pa()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ft]);const Ka=()=>{Be(!1),setTimeout(()=>Ft(null),180)},Ls=()=>{ha(!0)},bn=()=>{ha(!1)},ns=e=>{const a=String(e||"").trim();a&&Tt(t=>{const n=new Set(t);return n.has(a)?n.delete(a):n.add(a),n})};useEffect(()=>{try{const e=localStorage.getItem(Ra);if(!e)return;const a=JSON.parse(e);if(!Array.isArray(a))return;Ve(new Set(a.map(t=>String(t||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from($t||[]).map(a=>String(a||"").trim()).filter(Boolean);localStorage.setItem(Ra,JSON.stringify(e))}catch(e){}},[$t]);const Ds=e=>{const a=String(e||"").trim();a&&Ve(t=>{const n=new Set(t);return n.has(a)?n.delete(a):n.add(a),n})};useEffect(()=>{try{const e=localStorage.getItem(u);if(!e)return;const a=JSON.parse(e);if(!Array.isArray(a))return;Gt(a.map(t=>String(t||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Es=e=>{try{localStorage.setItem(u,JSON.stringify(e))}catch(a){}},on=e=>{const a=String(e||"").trim();a&&Gt(t=>{const n=Array.isArray(t)?t:[],i=[a,...n.filter(r=>String(r||"").trim().toLowerCase()!==a.toLowerCase())].slice(0,10);return Es(i),i})},ss=e=>{var t;const a=String((t=e!=null?e:Ie)!=null?t:"").trim();Yt(a),ca(!0),setTimeout(()=>{var n,i;try{(i=(n=ea.current)==null?void 0:n.focus)==null||i.call(n)}catch(r){}},0)},ua=()=>{ca(!1)};useEffect(()=>{if(!gt)return;const e=a=>{a.key==="Escape"&&ua()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[gt]),useEffect(()=>{if(!Dt)return;const e=n=>{if(gt||(window.scrollY||0)>6)return;const i=n.touches&&n.touches[0];i&&(qt.current={active:!0,startY:i.clientY,startX:i.clientX,fired:!1})},a=n=>{const i=qt.current;if(!(i!=null&&i.active)||i.fired||(window.scrollY||0)>6)return;const r=n.touches&&n.touches[0];if(!r)return;const h=r.clientY-i.startY,m=r.clientX-i.startX;Math.abs(m)>24||h>92&&(i.fired=!0,ss(Ie))},t=()=>{qt.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",a,{passive:!0}),window.addEventListener("touchend",t,{passive:!0}),window.addEventListener("touchcancel",t,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)}},[Dt,gt,Ie]);const is=e=>{try{const a=Et(e==null?void 0:e.status);if(!(a==="pending"||a==="processing"))return!1;const t=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(t.getTime()))return!1;const n=new Date;return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate()}catch(a){return!1}};useEffect(()=>{var t;let e;const a=()=>{try{La(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(n){La(!1)}};try{e=(t=window.matchMedia)==null?void 0:t.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",a):e!=null&&e.addListener&&e.addListener(a)}catch(n){e=null}return window.addEventListener("resize",a),a(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",a):e!=null&&e.removeListener&&e.removeListener(a)}catch(n){}window.removeEventListener("resize",a)}},[]),useEffect(()=>{const e="admin-sheet-open";return X||Ut||ft?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[X,Ut,ft]),useEffect(()=>{if(!X&&!Ut&&!ft)return;const e=a=>{a.key==="Escape"&&(X&&Ka(),Ut&&bn(),ft&&Pa())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[X,Ut,ft]);const Ps=()=>{try{if(localStorage.getItem(p))return;localStorage.setItem(p,"1"),typeof O=="function"&&O("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},rs=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),os=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),ls=e=>{const a=dt(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{window.location.href=`tel:${a}`}catch(t){}},Ks=async e=>{var t,n,i;const a=dt(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{await((i=(n=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:n.call(t,a))!=null?i:Promise.reject(new Error("Clipboard not available"))),typeof O=="function"&&O("\u0110\xE3 copy S\u0110T","success")}catch(r){typeof O=="function"&&O("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Fs=()=>{try{const e=localStorage.getItem(Lt),a=e?JSON.parse(e):[];return Array.isArray(a)?a:[]}catch(e){return[]}},cs=e=>{try{localStorage.setItem(Lt,JSON.stringify(Array.isArray(e)?e:[]))}catch(a){}},gn=(e,a)=>{const t=String(e||"").trim();t&&zt(n=>{const i={...n||{}};return a?i[t]=!0:delete i[t],i})},Hs=(e,a,t)=>{const n=String(e||"").trim(),i=Et(a),r=Et(t);if(!n||!i)return;const h=Array.isArray(Rt.current)?Rt.current:[],m=new Map(h.map(f=>[String((f==null?void 0:f.orderId)||""),f]));m.set(n,{orderId:n,nextStatus:i,prevStatus:r,ts:Date.now()});const x=Array.from(m.values()).sort((f,c)=>(Number(f.ts)||0)-(Number(c.ts)||0));Rt.current=x,cs(x),gn(n,!0)},En=async()=>{if(ka.current||!navigator.onLine)return;const e=Array.isArray(Rt.current)?Rt.current.slice():[];if(e.length){ka.current=!0;try{for(const a of e){const t=String((a==null?void 0:a.orderId)||"").trim(),n=Et(a==null?void 0:a.nextStatus);if(!(!t||!n)){gn(t,!0);try{await Ba({id:t,status:(a==null?void 0:a.prevStatus)||""},n,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const i=(Array.isArray(Rt.current)?Rt.current:[]).filter(r=>String((r==null?void 0:r.orderId)||"")!==t);Rt.current=i,cs(i),gn(t,!1)}catch(i){if(!navigator.onLine)break}}}}finally{ka.current=!1}}};useEffect(()=>{const e=Fs();Rt.current=e;try{const a={};for(const t of e){const n=String((t==null?void 0:t.orderId)||"").trim();n&&(a[n]=!0)}zt(a)}catch(a){}setTimeout(()=>En(),600)},[]),useEffect(()=>{const e=()=>En();window.addEventListener("online",e);const a=setInterval(()=>En(),8e3);return()=>{clearInterval(a),window.removeEventListener("online",e)}},[]);const qs=(e,a)=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e),ba.current=!1,Ps();try{ta.current&&clearTimeout(ta.current)}catch(n){}ta.current=setTimeout(()=>{ba.current=!0,Ks(a)},520)},vn=e=>{var a;(a=e==null?void 0:e.stopPropagation)==null||a.call(e);try{ta.current&&clearTimeout(ta.current)}catch(t){}ta.current=null},Bs=e=>{const a=String(e||"").trim();if(!a)return;ja(i=>({...i,[a]:Date.now()}));const t=ma.current;try{const i=t.get(a);i&&clearTimeout(i)}catch(i){}const n=setTimeout(()=>{ja(i=>{const r={...i||{}};return delete r[a],r});try{t.delete(a)}catch(i){}},9e3);t.set(a,n)},ds=e=>String(e||"").replace(/\s+/g," ").trim(),Vs=e=>String(e||"").replace(/[^0-9]+/g,""),ln=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/Os)}catch(a){return 0}},yn=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:ln(e)>=Na,Et=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},Pn=React.useMemo(()=>["draft","pending","processing","done","paid"],[]),Ua=(e,a)=>{const t=Et(e);if(!t||t==="canceled")return null;const n=Pn.indexOf(t);return n<0?null:a==="left"?Pn[n+1]||null:a==="right"&&Pn[n-1]||null},ms=e=>{var i;const a=Et(e);if(!a)return{label:"",icon:"fa-circle"};const t=((i=rn.find(r=>Et(r==null?void 0:r.value)===a))==null?void 0:i.label)||"",n=(()=>{switch(a){case"draft":return"fa-file-lines";case"pending":return"fa-hourglass-half";case"processing":return"fa-truck";case"done":return"fa-check";case"paid":return"fa-money-bill-wave";case"canceled":return"fa-ban";default:return"fa-circle"}})();return{label:t,icon:n}},Nn=e=>{if(Et(e==null?void 0:e.status)!=="draft")return null;const t=Ea-ln(e);return Number.isFinite(t)?t:null},wn=e=>{const a=Nn(e);return Number.isFinite(a)?a>0&&a<=Dn:!1},Fa=e=>{H({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),q([""]),P(null),ze(null)};useEffect(()=>{const e=a=>{var n;if(we==null)return;const t=(n=Re.current)==null?void 0:n[we];t&&!t.contains(a.target)&&ze(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[we]);const us=e=>window.KTM.money.parseMoney(e),ps=e=>window.KTM.money.parseSignedMoney(e),it=e=>window.KTM.money.formatVND(e),wa=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var i,r;return{amount:String((i=n==null?void 0:n.amount)!=null?i:""),note:String((r=n==null?void 0:n.note)!=null?r:"")}});return t.length?t:[{amount:"",note:""}]},zs=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var i,r;return{amount:(n==null?void 0:n.amount)===0?"":String((i=n==null?void 0:n.amount)!=null?i:""),note:String((r=n==null?void 0:n.note)!=null?r:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},Ya=e=>(Array.isArray(e)?e:[]).map(t=>({amount:ps(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),Kn=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Ya(a),n=Qa(t),i=(()=>{if(!t.length)return"";const r=t.map(h=>String((h==null?void 0:h.note)||"").trim()).filter(Boolean);return r.length?r.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:i}},Qa=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),Fn=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},hi=e=>window.KTM.money.parseShipFeeFromNote(e),Za=e=>window.KTM.phone.isValid(e),dt=e=>window.KTM.phone.normalize(e),Hn=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},Xs=(e,a)=>{var r;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const i=new Map(t.map(h=>{var m;return[String((m=h==null?void 0:h.id)!=null?m:""),h]}));for(const h of n){const m=String((r=h==null?void 0:h.id)!=null?r:"");m&&i.set(m,h)}return Array.from(i.values())},xn=async e=>{var a,t,n,i;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const r=(t=(a=bt.current)==null?void 0:a.get)==null?void 0:t.call(a,String(e.id));if(r&&typeof r=="object"&&Array.isArray(r.items)&&r.items.length)return r}catch(r){}try{const r=await Hn(e.id);if(r&&typeof r=="object"){try{(i=(n=bt.current)==null?void 0:n.set)==null||i.call(n,String(e.id),r)}catch(h){}return z(h=>Array.isArray(h)?h.map(m=>String(m==null?void 0:m.id)===String(e.id)?r:m):h),r}}catch(r){console.error("Fetch order by id error:",r)}return e},Js=()=>{var e;try{const a=localStorage.getItem(Ma);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[i,r]of n)!i||!r||typeof r!="object"||(e=De.current)==null||e.set(String(i),r)}catch(a){}},qn=()=>{try{const e=De.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,i])=>n&&i&&typeof i=="object"&&Number.isFinite(i.ts)).sort((n,i)=>(Number(i[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,fn),t={};for(const[n,i]of a)t[n]=i;localStorage.setItem(Ma,JSON.stringify(t))}catch(e){}};useEffect(()=>{Js()},[]);const hs=e=>{const a=dt(e);if(!a)return null;const t=Array.isArray(ee)?ee:[];let n=null,i=-1;for(const r of t){if(!r||dt(r.phone||"")!==a)continue;const h=new Date(r.created_at).getTime(),m=Number.isFinite(h)?h:0;m>=i&&(i=m,n=r)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},fs=(e,a)=>{e&&H(t=>a&&dt(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Gs=e=>{const a=hs(e);if(!a)return;const t=dt(e);H(n=>{if(t&&dt(n.phone)!==t)return n;const i={...n};return!String(n.customer_name||"").trim()&&a.name&&(i.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(i.address=a.address),i})},Ws=(e,a,t)=>{var n;try{const i=dt(e);if(!i)return;const r=String(a||"").trim(),h=String(t||"").trim();if(!r&&!h)return;(n=De.current)==null||n.set(i,{ts:Date.now(),status:"found",customer:{phone:i,name:r||null,address:h||null}}),qn()}catch(i){}},Sn=async e=>{var i,r,h;const a=dt(e);if(!a)return;Gs(a);const t=(i=De.current)==null?void 0:i.get(a);if(t&&Number.isFinite(t.ts)){const m=Date.now()-t.ts,x=t.status==="found"?ya:Da;if(m>=0&&m<=x){P({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&fs(t.customer,a);return}}const n=++j.current;P({status:"loading",phone:a});try{const m=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(j.current!==n)return;if(m&&m.exists&&m.customer){(r=De.current)==null||r.set(a,{ts:Date.now(),status:"found",customer:m.customer}),qn(),P({status:"found",phone:a,customer:m.customer}),fs(m.customer,a);return}(h=De.current)==null||h.set(a,{ts:Date.now(),status:"not-found",customer:null}),qn(),P({status:"not-found",phone:a})}catch(m){if(j.current!==n)return;console.error("Customer lookup error:",m),P({status:"error",phone:a})}},bs=e=>{const a=dt(e),t=hs(a);H(i=>{const r={...i,phone:a};return t&&(!String(i.customer_name||"").trim()&&t.name&&(r.customer_name=t.name),!String(i.address||"").trim()&&t.address&&(r.address=t.address)),r}),g(!1),st.current&&(clearTimeout(st.current),st.current=null);const n=a;if(n.length<Qt){P(null);return}if(Za(n)&&n!==tt.current){tt.current=n,Sn(n);return}st.current=setTimeout(()=>{const i=dt(a);Za(i)&&i!==tt.current&&(tt.current=i,Sn(i))},na)},gs=()=>{const e=dt(l.phone);e.length<Qt||Za(e)&&e!==tt.current&&(tt.current=e,Sn(e))};useEffect(()=>(Ae?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Ae]);const kn=Array.isArray(l.items)?l.items.length:0;useEffect(()=>{if(!Ae){Bt.current=kn;return}kn>Bt.current&&setTimeout(()=>{const e=Nt.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Bt.current=kn},[Ae,kn]),useEffect(()=>()=>{st.current&&(clearTimeout(st.current),st.current=null),K.current&&(clearTimeout(K.current),K.current=null)},[]),useEffect(()=>{if(!Ae)return;K.current&&(clearTimeout(K.current),K.current=null);const e=dt((l==null?void 0:l.phone)||"");if(!Za(e)){le([]),o(!1);return}return K.current=setTimeout(async()=>{var i;const a=String(e),t=(i=ie.current)==null?void 0:i.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=va){le(Array.isArray(t.orders)?t.orders:[]),o(!1);return}const n=++J.current;o(!0);try{const r=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,h=await window.KTM.api.getJSON(r,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(J.current!==n)return;const m=Array.isArray(h)?h:Array.isArray(h==null?void 0:h.orders)?h.orders:[];le(m);try{const x=ie.current;if(x&&typeof x.set=="function"&&(x.set(a,{ts:Date.now(),orders:m}),x.size>100)){const f=Array.from(x.entries()).sort((b,k)=>{var U,Y;return(Number((U=b==null?void 0:b[1])==null?void 0:U.ts)||0)-(Number((Y=k==null?void 0:k[1])==null?void 0:Y.ts)||0)}),c=Math.max(0,f.length-100);for(let b=0;b<c;b++)x.delete(f[b][0])}}catch(x){}}catch(r){if(J.current!==n)return;console.error("Phone history fetch error:",r),le([])}finally{if(J.current!==n)return;o(!1)}},ga),()=>{K.current&&(clearTimeout(K.current),K.current=null)}},[Ae,l==null?void 0:l.phone]),useEffect(()=>{Qs()},[]),useEffect(()=>{$e||Ha()},[v,$e]),useEffect(()=>{_n()},[]),useEffect(()=>{A&&It.current!==A&&(It.current=A,Tn(_))},[A]);const pa=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",en=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",$a=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(ee),a=$t;if(!a||!(a instanceof Set)||a.size===0)return e;const t=Array.isArray(e)?e.slice():[];return t.sort((n,i)=>{var m,x;const r=a.has(String((m=n==null?void 0:n.id)!=null?m:""))?1:0;return(a.has(String((x=i==null?void 0:i.id)!=null?x:""))?1:0)-r}),t},[ee,$t]),Bn=React.useMemo(()=>window.KTM.orders.sortOrders(He),[He]),Cn=React.useMemo(()=>{const a=(Array.isArray(Bn)?Bn:[]).filter(t=>yn(t));return a.sort((t,n)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),r=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(r)?r:0)}),a},[Bn]),vs=React.useMemo(()=>{const a=(Array.isArray(Xe)?Xe:[]).filter(t=>wn(t));return a.sort((t,n)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),r=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(r)?r:0)}),a},[Xe]),cn=React.useMemo(()=>{if(he)return Cn;let e=$a;if(Ct){const a=$t;e=(Array.isArray(e)?e:[]).filter(t=>{var n,i;return(i=a==null?void 0:a.has)==null?void 0:i.call(a,String((n=t==null?void 0:t.id)!=null?n:""))})}return la&&(e=(Array.isArray(e)?e:[]).filter(a=>is(a))),e},[he,Cn,$a,Ct,$t,la]),An=React.useMemo(()=>{if(he)return cn;const e=String(B||"").trim();return e?(Array.isArray(cn)?cn:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):cn},[cn,B,he]),ys=React.useMemo(()=>window.KTM.orders.sortOrders(Je),[Je]),wt=React.useMemo(()=>$e?ys:An,[An,$e,ys]),Ns=React.useMemo(()=>{const e=Array.isArray(wt)?wt:[];return Dt?e.slice(0,Math.max(0,Number(Ta)||0)):e},[Dt,Ta,wt]);useEffect(()=>{Dt&&Ja(za)},[Dt,B,he,v,Ie]),useEffect(()=>{if(!Dt)return;const e=Array.isArray(wt)?wt.length:0;if(Ta>=e)return;const a=Ga.current;if(!a)return;const t=new IntersectionObserver(n=>{Array.isArray(n)&&n.some(r=>r==null?void 0:r.isIntersecting)&&Ja(r=>Math.min((Number(r)||0)+Xa,e))},{root:null,rootMargin:"520px 0px",threshold:0});return t.observe(a),()=>t.disconnect()},[Dt,Ta,wt]),useEffect(()=>{if(!Dt){Aa(!1),Xt(!1);return}const e=()=>{s.current||(s.current=window.requestAnimationFrame(()=>{s.current=null;const a=window.scrollY||document.documentElement.scrollTop||0;Aa(a>140),Xt(a>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),s.current&&(window.cancelAnimationFrame(s.current),s.current=null)}},[Dt]),useEffect(()=>{if(!Dt){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(a){}return}const e=()=>{try{const a=document.querySelector(".mobile-bottom-nav"),t=a&&a.offsetHeight?a.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${t}px`)}catch(a){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[Dt]);const Ia=React.useMemo(()=>{const e=Array.isArray(wt)?wt:[],a={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const n=Et(t==null?void 0:t.status);n==="draft"?a.draft+=1:n==="pending"?a.pending+=1:n==="processing"?a.processing+=1:n==="done"?a.done+=1:n==="paid"?a.paid+=1:n==="canceled"?a.canceled+=1:a.other+=1}return a},[wt]),Us=React.useMemo(()=>{const e=$t;return!e||e.size===0?0:(Array.isArray($a)?$a:[]).reduce((a,t)=>{var n;return a+(e.has(String((n=t==null?void 0:t.id)!=null?n:""))?1:0)},0)},[$t,$a]),Ys=React.useMemo(()=>(Array.isArray($a)?$a:[]).filter(e=>is(e)).length,[$a]),ws=React.useMemo(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`},[]),Ca=e=>{if($e&&de(""),e==="thisMonth"){oe(!1),ne(""),$(ws);return}if(e==="overduePending"){$(""),oe(!0),ne("pending");return}if(e==="draftExpiring"){oe(!1),ne("draft"),$(""),_n();return}if(e==="all"){oe(!1),ne(""),$(ws);return}},tn=e=>window.KTM.date.formatDateTime(e),Qs=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");lt(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),lt([])}},Ha=async()=>{qe(!0),ke(!1);try{const a=new URLSearchParams;v&&a.set("month",String(v)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(es)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),i=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],r=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;z(Array.isArray(i)?i:[]),F(Array.isArray(i)?i.length:0),ve(!!(r!=null&&r.hasMore)),_n()}catch(a){console.error("Load orders error:",a),z([]),F(0),ve(!1)}finally{qe(!1),ke(!1)}},Zs=async()=>{if(!(xe||se||$e)&&fe){ke(!0);try{const e=new URLSearchParams;v&&e.set("month",String(v)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(es)),e.set("offset",String(E));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],i=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;z(r=>Xs(r,Array.isArray(n)?n:[])),F(r=>r+(Array.isArray(n)?n.length:0)),ve(!!(i!=null&&i.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{ke(!1)}}},xs=async e=>{var i;const a=ds(e);if(!a){ht([]),yt(""),Me(!1);return}const t=Vs(a);if(a.length<Qn&&t.length<Zn){ht([]),yt(`Nh\u1EADp \xEDt nh\u1EA5t ${Qn} k\xFD t\u1EF1 (ho\u1EB7c ${Zn} s\u1ED1) \u0111\u1EC3 search nhanh`),Me(!1);return}try{const r=(i=Pe.current)==null?void 0:i.get(a);if(r&&Number.isFinite(r.ts)&&Date.now()-r.ts<=Rs){ht(Array.isArray(r.results)?r.results:[]),yt(""),Me(!1);return}}catch(r){}const n=++ce.current;Me(!0),yt("");try{const r=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,h=await window.KTM.api.getJSON(r,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(ce.current!==n)return;const m=Array.isArray(h)?h:[];ht(m);try{const x=Pe.current;if(x&&typeof x.set=="function"&&(x.set(a,{ts:Date.now(),results:m}),x.size>Yn)){const f=Array.from(x.entries()).sort((b,k)=>{var U,Y;return(Number((U=b==null?void 0:b[1])==null?void 0:U.ts)||0)-(Number((Y=k==null?void 0:k[1])==null?void 0:Y.ts)||0)}),c=Math.max(0,f.length-Yn);for(let b=0;b<c;b++)x.delete(f[b][0])}}catch(x){}}catch(r){if(ce.current!==n)return;console.error("Order search error:",r),ht([]),yt((r==null?void 0:r.message)||"Search l\u1ED7i")}finally{if(ce.current!==n)return;Me(!1)}};useEffect(()=>{pe.current&&(clearTimeout(pe.current),pe.current=null);const e=ds(Ie);if(!e){ht([]),yt(""),Me(!1);return}return he&&oe(!1),pe.current=setTimeout(()=>{xs(e)},js),()=>{pe.current&&(clearTimeout(pe.current),pe.current=null)}},[Ie]);const _n=async()=>{L(!0),Se(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Na)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Dn)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);ye(Array.isArray(e)?e:[]),rt(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),ye([]),rt([])}finally{L(!1),Se(!1)}},Vn=async e=>{const a=await xn(e);if(!a)return;et(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(m=>{var x,f,c,b;return{product_id:(m==null?void 0:m.product_id)||"",quantity:Number((x=m==null?void 0:m.quantity)!=null?x:1)||1,unit_price:(()=>{var Y;const k=(Y=m==null?void 0:m.unit_price)!=null?Y:m==null?void 0:m.unitPrice,U=k==null||k===""?NaN:Number(k);return Number.isFinite(U)?Math.trunc(U):null})(),variant:String((f=m==null?void 0:m.variant)!=null?f:"").trim(),variant_json:(b=(c=m==null?void 0:m.variant_json)!=null?c:m==null?void 0:m.variantJson)!=null?b:null}}).filter(m=>m.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=zs(a),i=Ya(n),r=Qa(i),h=Fn(i);H({customer_name:a.customer_name||"",phone:dt(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:r,adjustment_note:h||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),q(new Array(t.length?t.length:1).fill("")),R(new Array(t.length?t.length:1).fill(!0)),P(null),_e(!1),Ke(a),mt(!0),St(""),Ze(!1),Kt(!0),a.phone&&Sn(dt(a.phone))},dn=async e=>{if(!e)return;mt(!0),St(""),Ze(!0),Kt(!1),Ke(e);const a=++S.current;try{const t=await xn(e);if(S.current!==a)return;Ke(t||e)}catch(t){if(S.current!==a)return;St((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(S.current!==a)return;Ze(!1)}},ei=()=>{w||Z||(mt(!1),Ze(!1),St(""),Kt(!1),et(null),Fa(""),g(!1),R([]))};function Tn(e){mt(!1),Kt(!1),Ze(!1),St(""),et(null),Fa(e||""),g(!1),R([]),_e(!0)}const zn=()=>{w||Z||(_e(!1),et(null),Fa(""),g(!1),R([]))},Ss=async()=>{var m,x,f;if(!Ee||Z||w)return;const e=(Array.isArray(ee)?ee:[]).find(c=>String(c==null?void 0:c.id)===String(Ee))||null,a=String((e==null?void 0:e.status)||(l==null?void 0:l.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const c="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof O=="function"?O(c,"warning"):alert(c);return}const t=dt(l.phone),i=(Array.isArray(l.items)?l.items:[]).map((c,b)=>{var k,U;return{idx:b,product_id:String((c==null?void 0:c.product_id)||"").trim(),quantity:Number((k=c==null?void 0:c.quantity)!=null?k:0),variant:String((c==null?void 0:c.variant)||"").trim()||null,variant_json:(U=c==null?void 0:c.variant_json)!=null?U:null,unit_price:(()=>{const Y=c==null?void 0:c.unit_price,Fe=Y===""||Y==null?NaN:Number(Y);if(Number.isFinite(Fe))return Math.max(0,Math.trunc(Fe));const Oe=sa(c==null?void 0:c.product_id),vt=c!=null&&c.variant_json&&typeof c.variant_json=="object"?c.variant_json:null;return an(Oe,vt)})()}}).filter(c=>c.product_id&&Number.isFinite(c.quantity)&&c.quantity>0);if(i.length<2){const c="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof O=="function"?O(c,"warning"):alert(c);return}const r=[],h=[];for(const c of i){const b=!!N[c.idx],k={product_id:c.product_id,quantity:c.quantity,unit_price:c.unit_price,variant:c.variant,variant_json:c.variant_json};b?r.push(k):h.push(k)}if(!r.length||!h.length){const c="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof O=="function"?O(c,"warning"):alert(c);return}me(!0);try{const c=Array.isArray(l==null?void 0:l.adjustment_items)?l.adjustment_items:[],b=Ya(c),k=Qa(b),U=Fn(b),Y={customer_name:l.customer_name,phone:t,address:l.address,note:(l.note||"").trim(),adjustment_amount:k,adjustment_note:U,adjustment_items:b,status:"processing",items:r,product_id:r[0].product_id,quantity:r[0].quantity,split_seq:1},Fe=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,Y,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),Oe=(f=(x=Fe==null?void 0:Fe.id)!=null?x:(m=Fe==null?void 0:Fe.order)==null?void 0:m.id)!=null?f:null;if(!Oe)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const vt={id:Ee,customer_name:l.customer_name,phone:t,address:l.address,note:(l.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:h,product_id:h[0].product_id,quantity:h[0].quantity,parent_order_id:String(Oe),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${Ee}`,vt,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),zn(),Ha();const We=Oe?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${Oe}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof O=="function"?O(We,"success"):alert(We)}catch(c){console.error(c);const b=(c==null?void 0:c.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof O=="function"?O(b,"danger"):alert(b)}finally{me(!1)}},ks=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=Le.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},xa=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},ti=e=>{const t=xa(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},Cs=React.useMemo(()=>(Array.isArray(Le)?Le:[]).map((e,a)=>{var f,c,b,k,U,Y;const t=xa((f=e==null?void 0:e.name)!=null?f:""),n=xa((c=e==null?void 0:e.code)!=null?c:""),i=xa((b=e==null?void 0:e.category)!=null?b:""),r=xa((k=e==null?void 0:e.note)!=null?k:""),h=xa((U=e==null?void 0:e.id)!=null?U:""),m=xa((Y=e==null?void 0:e.stt)!=null?Y:""),x=`${t} ${n} ${i} ${r} ${h} ${m}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:i,note:r,haystackAll:x}}),[Le]),ai=(e,a,t)=>{var b,k,U,Y,Fe;const n=Array.isArray(a)?a:[],i=xa(t).trim();if(!n.length&&!i)return 0;const r=(b=e==null?void 0:e.name)!=null?b:"",h=(k=e==null?void 0:e.code)!=null?k:"",m=(U=e==null?void 0:e.category)!=null?U:"",x=(Y=e==null?void 0:e.note)!=null?Y:"";if(!((Fe=e==null?void 0:e.haystackAll)!=null?Fe:""))return 0;let c=0;i&&(r===i&&(c+=220),r.includes(i)&&(c+=140),r.startsWith(i)&&(c+=160),h&&h===i&&(c+=180),h&&h.includes(i)&&(c+=90));for(const Oe of n){if(!Oe)continue;const vt=new RegExp(`(?:^|\\s)${Oe.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);r.includes(Oe)&&(c+=35),vt.test(r)&&(c+=25),h&&h.includes(Oe)&&(c+=20),h&&vt.test(h)&&(c+=10),m&&m.includes(Oe)&&(c+=12),x&&x.includes(Oe)&&(c+=6)}return c>0&&r&&(c+=Math.max(0,10-Math.min(10,Math.floor(r.length/10)))),c},Xn=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const i=t.length,r=n.length;if(r>i)return Xn(n,t);let h=new Array(r+1),m=new Array(r+1);for(let x=0;x<=r;x++)h[x]=x;for(let x=1;x<=i;x++){m[0]=x;const f=t.charCodeAt(x-1);for(let b=1;b<=r;b++){const k=f===n.charCodeAt(b-1)?0:1;m[b]=Math.min(h[b]+1,m[b-1]+1,h[b-1]+k)}const c=h;h=m,m=c}return h[r]},ni=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const i=n.split(/\s+/).filter(Boolean);if(!i.length)return!1;const r=t.length<=4?1:2;for(const h of i)if(!(Math.abs(h.length-t.length)>r)&&Xn(t,h)<=r)return!0;return!1},Mn=e=>{const a=xa(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},si=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=Mn((e==null?void 0:e.name)||""),i=Mn((e==null?void 0:e.code)||""),r=Mn((e==null?void 0:e.category)||""),h=Mn((e==null?void 0:e.note)||""),m=(f,c,b)=>{const k=String(f||"").trim();if(!k||!c.length)return 0;const U=k.length<=4?1:2;let Y=1/0,Fe=-1;for(let We=0;We<c.length;We++){const ia=c[We];if(!ia||Math.abs(ia.length-k.length)>U)continue;const ct=Xn(k,ia);if(ct<Y&&(Y=ct,Fe=We,ct===0))break}if(Y===1/0||Y>U)return 0;let vt=Math.round(b*(Y===0?1:Y===1?.65:.45));return Fe===0?vt+=Math.round(b*.25):Fe===1&&(vt+=Math.round(b*.12)),vt};let x=0;for(const f of t){if(!f)continue;const c=m(f,n,180),b=m(f,i,120),k=m(f,r,60),U=m(f,h,30);x+=Math.max(c,b,k,U)}if(x>0){const f=((e==null?void 0:e.name)||"").length;x+=Math.max(0,60-Math.min(60,Math.floor(f/2)))}return x},Jn=React.useRef(new Map);React.useEffect(()=>{Jn.current=new Map},[Le]);const As=e=>{var f,c;const a=String(ge[e]||"").trim();if(!a)return Le;const{contentTokens:t,cleanedQuery:n}=ti(a);if(t.length===0)return Le;const i=xa(a).trim(),r=Jn.current.get(i);if(r)return r;const h=[];for(const b of Cs){const k=b.haystackAll;k&&t.some(U=>k.includes(U))&&h.push(b)}let m=h;if(m.length<8&&t.length>0){const b=[],k=new Set(m.map(U=>{var Y,Fe;return String((Fe=(Y=U.p)==null?void 0:Y.id)!=null?Fe:"")+":"+String(U.originalIndex)}));for(const U of Cs){const Y=String((c=(f=U.p)==null?void 0:f.id)!=null?c:"")+":"+String(U.originalIndex);if(k.has(Y))continue;const Fe=U.haystackAll;Fe&&t.some(Oe=>ni(Oe,Fe))&&(b.push(U),k.add(Y))}b.length&&(m=m.concat(b))}const x=m.map(b=>({entry:b,score:ai(b,t,n)})).map(b=>{if(b.score>0)return b;const k=si(b.entry,t);return k>0?{...b,score:k}:b}).filter(b=>b.score>0).sort((b,k)=>k.score!==b.score?k.score-b.score:b.entry.originalIndex-k.entry.originalIndex).slice(0,40).map(b=>b.entry.p);return Jn.current.set(i,x),x},sa=e=>{if(!e)return null;const a=String(e);return Le.find(t=>String(t==null?void 0:t.id)===a)||null},Oa=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var h;if(!t||typeof t!="object")return null;const i=String((h=t.name)!=null?h:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,r=(Array.isArray(t.options)?t.options:[]).map(m=>{var Fe,Oe,vt,We,ia,ct,Sa;if(!m||typeof m!="object")return null;const x=String((Fe=m.label)!=null?Fe:"").trim();if(!x)return null;const f=(ia=(We=(vt=(Oe=m.price)!=null?Oe:m.priceValue)!=null?vt:m.unit_price)!=null?We:m.unitPrice)!=null?ia:null,c=f==null||f===""?NaN:typeof f=="number"?f:typeof f=="string"?us(f):Number(f),b=Number.isFinite(c)?Math.trunc(c):null,k=(Sa=(ct=m.price_delta)!=null?ct:m.priceDelta)!=null?Sa:null,U=Number(k),Y=Number.isFinite(U)?Math.trunc(U):0;return{label:x,price:b,price_delta:Y}}).filter(Boolean);return{name:i,options:r}}).filter(Boolean):[]},fi=e=>{const a=sa(e);return Oa(a==null?void 0:a.variants)},$n=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const i=String(t||"").trim(),r=String(n||"").trim();!i||!r||a.push(`${i}: ${r}`)}return a.join(", ")},an=(e,a)=>{const t=us(e==null?void 0:e.price),n=Oa(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let i=t,r=!1;for(const h of n){const m=String((h==null?void 0:h.name)||"").trim(),x=String((a==null?void 0:a[m])||"").trim();if(!m||!x)continue;const f=(Array.isArray(h.options)?h.options:[]).find(Y=>String((Y==null?void 0:Y.label)||"").trim()===x);if(!f)continue;const c=f==null?void 0:f.price,b=c==null||c===""?NaN:Number(c);if(Number.isFinite(b)){i=Math.max(0,Math.trunc(b)),r=!0;continue}const k=f==null?void 0:f.price_delta,U=k==null||k===""?NaN:Number(k);Number.isFinite(U)&&(i+=Math.trunc(U))}return i},Gn=e=>window.KTM.orders.getOrderItems(e),_s=e=>window.KTM.orders.getOrderTotalQty(e),nn=e=>window.KTM.orders.getOrderProductSummary(e,sa),In=e=>window.KTM.orders.getOrderItemRows(e,sa),mn=e=>window.KTM.orders.getOrderAdjustmentMoney(e),qa=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),ii=e=>{const a=Gn(e),t=In(e),n=pn(a),i=un(a),r=i.fee,h=mn(e),m=n+r+h,x=c=>{const b=Number(c)||0;return b>0?`+${it(b)}`:it(b)},f=[];if(e!=null&&e.customer_name&&f.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&f.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&f.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&f.push(`GHI CH\xDA: ${(e.note||"").trim()}`),f.push(""),f.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const c of t)f.push(`- ${c.name} (SL: ${c.qty})`);else{const c=nn(e);c&&c!=="\u2014"&&f.push(`- ${c}`)}f.push(""),f.push(`T\u1EA0M T\xCDNH: ${it(n)}`),i.found&&r!==0&&f.push(`SHIP: ${it(r)}`);{const c=window.KTM.orders.getOrderAdjustmentItems(e),b=(Array.isArray(c)?c:[]).map(Y=>{var Fe;return{amount:Number((Fe=Y==null?void 0:Y.amount)!=null?Fe:0)||0,note:String((Y==null?void 0:Y.note)||"").trim()}}).filter(Y=>Y.amount!==0||!!Y.note),k=qa(e);if(h!==0||b.length>0||!!k)if(b.length===1){const Y=b[0];f.push(`\u0110I\u1EC0U CH\u1EC8NH: ${x(h)}${Y.note?` \u2014 ${Y.note}`:""}`)}else{f.push(`\u0110I\u1EC0U CH\u1EC8NH: ${x(h)}${!b.length&&k?` \u2014 ${k}`:""}`);for(const Y of b)f.push(`- ${x(Y.amount)}${Y.note?`: ${Y.note}`:""}`)}}return f.push(`T\u1ED4NG: ${it(m)}`),f.filter(Boolean).join(`
`)},On=async e=>{try{const a=await xn(e),t=ii(a);await window.KTM.clipboard.writeText(t),typeof O=="function"?O("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof O=="function"?O("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},un=e=>window.KTM.orders.getOrderShipInfo(e,sa),pn=e=>window.KTM.orders.getItemsSubtotal(e,sa),Wn=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},Un=()=>v?String(v):Wn(new Date),Ts=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=dt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=Kn(e).amount,h=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(m=>{var x;return{product_id:String((m==null?void 0:m.product_id)||"").trim(),quantity:Number((x=m==null?void 0:m.quantity)!=null?x:0),variant:String((m==null?void 0:m.variant)||"").trim()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0).sort((m,x)=>m.product_id<x.product_id?-1:m.product_id>x.product_id?1:m.variant<x.variant?-1:m.variant>x.variant?1:m.quantity-x.quantity);return JSON.stringify({name:a,phone:t,address:n,items:h,adj:i})},Vt=React.useMemo(()=>{const e=dt((l==null?void 0:l.phone)||"");if(!e)return{count:0,orders:[],monthKey:Un()};const a=Un(),n=(Array.isArray(W)?W:[]).filter(i=>{if(!i||Ee&&String(i.id)===String(Ee)||dt(i.phone||"")!==e)return!1;const r=Wn(i.created_at);return r&&r===a}).sort((i,r)=>{const h=new Date(i.created_at).getTime(),m=new Date(r.created_at).getTime();return(Number.isFinite(m)?m:0)-(Number.isFinite(h)?h:0)});return{count:n.length,orders:n,monthKey:a}},[W,l==null?void 0:l.phone,v,Ee]),ri=e=>{var m;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=dt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ps((m=e==null?void 0:e.adjustment_amount)!=null?m:0),r=Gn(e),h=(Array.isArray(r)?r:[]).map(x=>{var f;return{product_id:String((x==null?void 0:x.product_id)||"").trim(),quantity:Number((f=x==null?void 0:x.quantity)!=null?f:0),variant:String((x==null?void 0:x.variant)||"").trim()}}).filter(x=>x.product_id&&Number.isFinite(x.quantity)&&x.quantity>0).sort((x,f)=>x.product_id<f.product_id?-1:x.product_id>f.product_id?1:x.variant<f.variant?-1:x.variant>f.variant?1:x.quantity-f.quantity);return JSON.stringify({name:a,phone:t,address:n,items:h,adj:i})},Ms=React.useMemo(()=>{if(Ee)return"";const e=dt((l==null?void 0:l.phone)||"");if(!e)return"";const a=Un(),t=Ts(l),n=Array.isArray(W)?W:[];for(const i of n){if(!i||Ee&&String(i.id)===String(Ee)||dt(i.phone||"")!==e)continue;const r=Wn(i.created_at);if(!r||r!==a)continue;const h=ri(i);if(h&&h===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${i!=null&&i.id?` (#${i.id})`:""}`}return""},[W,l,v,Ee]),$s=e=>{var ia;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),i=dt((e==null?void 0:e.phone)||""),r=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),i||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),i&&!Za(i)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),r||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const m=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(ct=>ct&&ct.product_id);m.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),m.some(ct=>{var Va;const Sa=Number((Va=ct==null?void 0:ct.quantity)!=null?Va:0);return!Number.isFinite(Sa)||Sa<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const f=new Set;let c=!1;for(const ct of m){const Sa=String(ct.product_id||"").trim(),Va=String((ct==null?void 0:ct.variant)||"").trim();if(!Sa)continue;const at=`${Sa}||${Va}`;if(f.has(at)){c=!0;break}f.add(at)}c&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const b=pn(m),k=un(m),U=k!=null&&k.found?Number((ia=k==null?void 0:k.fee)!=null?ia:0):0,Y=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],Fe=Ya(Y),Oe=Qa(Fe),vt=Fe.some(ct=>(Number(ct==null?void 0:ct.amount)||0)!==0&&!String((ct==null?void 0:ct.note)||"").trim());k!=null&&k.found&&(U>=2e5||b>0&&U>b*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${it(U)}`),vt&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const We=Math.abs(Oe);return(We>=5e5||b>0&&We>b*.5)&&Oe!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${it(Oe)}`),{errors:a,warnings:t,canSubmit:a.length===0}},bi=React.useMemo(()=>$s(l),[l,Le]),Ue=React.useMemo(()=>{var Va;const e=String((l==null?void 0:l.customer_name)||"").trim(),a=dt((l==null?void 0:l.phone)||""),t=String((l==null?void 0:l.address)||"").trim(),n=Array.isArray(l==null?void 0:l.items)?l.items:[],i=new Map;for(const at of n){const sn=String((at==null?void 0:at.product_id)||"").trim(),Rn=String((at==null?void 0:at.variant)||"").trim();if(!sn)continue;const Ln=`${sn}||${Rn}`;i.set(Ln,(i.get(Ln)||0)+1)}const r=n.map(at=>{var Is;const sn=String((at==null?void 0:at.product_id)||"").trim(),Rn=Number((Is=at==null?void 0:at.quantity)!=null?Is:0),Ln=sn?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",di=Number.isFinite(Rn)&&Rn>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",mi=String((at==null?void 0:at.variant)||"").trim(),ui=`${sn}||${mi}`,pi=sn&&(i.get(ui)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Ln,qtyError:di,dupWarn:pi}}),h=n.filter(at=>at&&at.product_id),m=pn(h),x=un(h),f=x!=null&&x.found?Number((Va=x==null?void 0:x.fee)!=null?Va:0):0,c=Array.isArray(l==null?void 0:l.adjustment_items)?l.adjustment_items:[],b=Ya(c),k=Qa(b),U=b.some(at=>(Number(at==null?void 0:at.amount)||0)!==0&&!String((at==null?void 0:at.note)||"").trim()),Y=Math.abs(k),Fe=U?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Oe=k!==0&&(Y>=5e5||m>0&&Y>m*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${it(k)}`:"",vt=x!=null&&x.found&&(f>=2e5||m>0&&f>m*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${it(f)}`:"",We=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",ia=a?Za(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",ct=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Sa=!We&&!ia&&r.every(at=>!at.productError&&!at.qtyError);return{nameError:We,phoneError:ia,addressWarn:ct,items:r,shipAbnormalWarn:vt,adjustmentNoteWarn:Fe,adjustmentAbnormalWarn:Oe,canSubmit:Sa}},[l,Le]),jn=async e=>{var m,x,f;const a=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",n=$s(l);if(!n.canSubmit){const c=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof O=="function"?O(c,"danger"):alert(c);return}if(!Ee&&Ms){const c=`${Ms}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(c)){(Vt==null?void 0:Vt.count)>0&&g(!0),setTimeout(()=>{var U;const k=document.getElementById("order-phone-input");k&&typeof k.scrollIntoView=="function"&&(k.scrollIntoView({block:"center",behavior:"smooth"}),(U=k.focus)==null||U.call(k))},0);return}}const i=dt(l.phone),h=(Array.isArray(l.items)?l.items:[]).map(c=>{var b,k;return{product_id:(c==null?void 0:c.product_id)||"",quantity:Number((b=c==null?void 0:c.quantity)!=null?b:1),variant:String((c==null?void 0:c.variant)||"").trim()||null,variant_json:(k=c==null?void 0:c.variant_json)!=null?k:null,unit_price:(()=>{const U=c==null?void 0:c.unit_price,Y=U===""||U==null?NaN:Number(U);if(Number.isFinite(Y))return Math.max(0,Math.trunc(Y));const Fe=sa(c==null?void 0:c.product_id),Oe=c!=null&&c.variant_json&&typeof c.variant_json=="object"?c.variant_json:null;return an(Fe,Oe)})()}}).filter(c=>c.product_id&&Number.isFinite(c.quantity)&&c.quantity>0);y(!0);try{const c=Ee,b=Ee?`${API_BASE}/api/orders/${Ee}`:`${API_BASE}/api/orders`,k=h[0],U=Array.isArray(l==null?void 0:l.adjustment_items)?l.adjustment_items:[],Y=Ya(U),Fe=Qa(Y),Oe=Fn(Y),vt={customer_name:l.customer_name,phone:i,address:l.address,note:(l.note||"").trim(),adjustment_amount:Fe,adjustment_note:Oe,adjustment_items:Y,product_id:k.product_id,quantity:k.quantity,status:l.status,items:h,...Ee?{id:Ee}:{}};if(Ee)await window.KTM.api.putJSON(b,vt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const We=await window.KTM.api.postJSON(b,vt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");aa.current={id:(f=(x=We==null?void 0:We.id)!=null?x:(m=We==null?void 0:We.order)==null?void 0:m.id)!=null?f:null,fingerprint:Ts(l),ts:Date.now()}}if(Ws(i,l.customer_name,l.address),t==="drawer"){if(Fa(""),et(null),_e(!1),Kt(!1),g(!1),R([]),Ha(),c){Ze(!0),St("");try{const We=await Hn(c);We&&typeof We=="object"&&Ke(We)}catch(We){St((We==null?void 0:We.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Ze(!1)}}}else a==="new"&&!Ee?(Fa(""),et(null),_e(!0)):(Fa(""),et(null),_e(!1)),Ha()}catch(c){console.error(c),typeof O=="function"?O(c.message,"danger"):alert(c.message);return}finally{y(!1)}},hn=e=>window.KTM.orders.getOrderTotalMoney(e,sa),gi=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){te(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Ha(),_n()}catch(a){console.error(a),typeof O=="function"?O(a.message,"danger"):alert(a.message)}finally{te(null)}}},oi=()=>{const e=Wa.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(r){}e.timer=null}const a=Array.isArray(e.events)?e.events.splice(0):[];if(!a.length||typeof O!="function")return;const t=new Map;for(const r of a){const h=String((r==null?void 0:r.orderId)||"").trim();h&&t.set(h,r)}const n=Array.from(t.values());if(!n.length)return;const i=r=>async()=>{try{for(const h of r)!(h!=null&&h.prevStatus)||!(h!=null&&h.orderId)||await Ba({id:h.orderId,status:h.nextStatus},h.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});O(r.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${r.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(h){O("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(n.length===1){const r=n[0],h=`${pa(r.prevStatus)} \u2192 ${pa(r.nextStatus)}`.trim();O(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${h}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:i([r])});return}O(`\u0110\xE3 c\u1EADp nh\u1EADt ${n.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:i(n)})},li=e=>{const a=Wa.current;a&&(Array.isArray(a.events)||(a.events=[]),a.events.push(e),!a.timer&&(a.timer=setTimeout(()=>oi(),320)))};useEffect(()=>()=>{try{const e=Wa.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Ba=async(e,a,t={})=>{var h;const n=await xn(e),i=n==null?void 0:n.id;if(!i||!a)return;const r=Et(n==null?void 0:n.status);G(i);try{const m=Gn(n),x=(Array.isArray(m)?m:[]).map(b=>{var k,U;return{product_id:(b==null?void 0:b.product_id)||"",quantity:Number((k=b==null?void 0:b.quantity)!=null?k:1),variant:String((b==null?void 0:b.variant)||"").trim()||null,variant_json:(U=b==null?void 0:b.variant_json)!=null?U:null,unit_price:(()=>{var Oe;const Y=(Oe=b==null?void 0:b.unit_price)!=null?Oe:b==null?void 0:b.unitPrice,Fe=Number(Y);return Number.isFinite(Fe)?Math.max(0,Math.trunc(Fe)):null})()}}).filter(b=>b.product_id&&Number.isFinite(b.quantity)&&b.quantity>0);if(!x.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const f=x[0],c={id:i,customer_name:(n==null?void 0:n.customer_name)||"",phone:dt((n==null?void 0:n.phone)||""),address:(n==null?void 0:n.address)||"",note:((n==null?void 0:n.note)||"").trim(),adjustment_amount:Number((h=n==null?void 0:n.adjustment_amount)!=null?h:0)||0,adjustment_note:(n==null?void 0:n.adjustment_note)||"",product_id:f.product_id,quantity:f.quantity,status:a,items:x};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${i}`,c,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),z(b=>Array.isArray(b)?b.map(k=>(k==null?void 0:k.id)===i?{...k,status:a}:k):b),ye(b=>Array.isArray(b)?b.map(k=>(k==null?void 0:k.id)===i?{...k,status:a}:k):b),gn(i,!1),Bs(i),t!=null&&t.silentToast)return;if(t!=null&&t.skipToastBatch){typeof O=="function"&&O("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}li({orderId:i,prevStatus:r,nextStatus:Et(a)})}catch(m){if(console.error(m),(!navigator.onLine||(m==null?void 0:m.name)==="TypeError"||String((m==null?void 0:m.message)||"").toLowerCase().includes("failed to fetch"))&&!(t!=null&&t.fromSync)){z(f=>Array.isArray(f)?f.map(c=>(c==null?void 0:c.id)===i?{...c,status:a}:c):f),ye(f=>Array.isArray(f)?f.map(c=>(c==null?void 0:c.id)===i?{...c,status:a}:c):f),Hs(i,a,r),typeof O=="function"&&O("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof O=="function"?O(m.message,"danger"):alert(m.message)}finally{G(null)}};useEffect(()=>{const e=a=>{var n;const t=(n=a==null?void 0:a.detail)==null?void 0:n.key;if(t){if(t==="/"){setTimeout(()=>{var i,r;(r=(i=Ot.current)==null?void 0:i.focus)==null||r.call(i)},0);return}if(t==="N"||t==="n"){Tn();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&Qe&&(re!=null&&re.id)){const i=Array.isArray(wt)?wt:[],r=i.findIndex(x=>String(x==null?void 0:x.id)===String(re==null?void 0:re.id));if(r<0)return;const m=i[r+(t==="j"||t==="J"?-1:1)];m&&dn(m)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[wt,Qe,re]);const ci=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:l.customer_name,onChange:e=>H({...l,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Ue.nameError&&React.createElement("div",{className:"form-text text-danger"},Ue.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:l.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Ue.phoneError&&React.createElement("div",{className:"form-text text-danger"},Ue.phoneError),!Ue.phoneError&&Vt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Vt.count," \u0111\u01A1n trong th\xE1ng ",Vt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>g(e=>!e)},C?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),C&&Vt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>g(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Vt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${en(e.status)}`},pa(e.status))),React.createElement("div",{className:"text-muted small"},tn(e.created_at)," \u2022 ",it(hn(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},nn(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Vn(e)}},"M\u1EDF")))),Vt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(T==null?void 0:T.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(T==null?void 0:T.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(T==null?void 0:T.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(T==null?void 0:T.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:l.status,onChange:e=>H({...l,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:l.address,onChange:e=>H({...l,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Ue.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Ue.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:l.note,onChange:e=>H({...l,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{H(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},wa(l.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;H(i=>{const r=wa(i.adjustment_items);return r[a]={...r[a],amount:n},{...i,adjustment_items:r}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;H(i=>{const r=wa(i.adjustment_items);return r[a]={...r[a],note:n},{...i,adjustment_items:r}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{H(t=>{const n=wa(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:w||wa(l.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Ue.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Ue.adjustmentAbnormalWarn),!!Ue.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Ue.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{H(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),q(e=>[...Array.isArray(e)?e:[],""]),Ee&&R(e=>[...Array.isArray(e)?e:[],!0])},disabled:w},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(l.items)?l.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Re.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{ze(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),we===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:ge[a]||"",onChange:t=>{const n=t.target.value;q(i=>{const r=Array.isArray(i)?[...i]:[];return r[a]=n,r})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(n.id),r=Oa(n==null?void 0:n.variants),h={};for(const f of r){const c=String((f==null?void 0:f.name)||"").trim(),b=Array.isArray(f==null?void 0:f.options)?f.options[0]:null,k=String((b==null?void 0:b.label)||"").trim();c&&k&&(h[c]=k)}const m=$n(h),x=an(n,h);H(f=>{const c=Array.isArray(f.items)?[...f.items]:[];return c[a]={...c[a]||{quantity:1},product_id:i,variant_json:Object.keys(h).length?h:null,variant:m,unit_price:r.length?x:null},{...f,items:c}}),ze(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Le.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Ue.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=sa(e.product_id),n=Oa(t==null?void 0:t.variants);if(!n.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((r,h)=>{const m=String((r==null?void 0:r.name)||`Bi\u1EBFn th\u1EC3 ${h+1}`).trim(),x=String((i==null?void 0:i[m])||"").trim();return React.createElement("div",{key:m},React.createElement("label",{className:"form-label small text-muted mb-1"},m),React.createElement("select",{className:"form-select",value:x,onChange:f=>{const c=String(f.target.value||"").trim();H(b=>{const k=Array.isArray(b.items)?[...b.items]:[],U={...k[a]||{}},Y=sa(U.product_id),Fe=Oa(Y==null?void 0:Y.variants),Oe=U!=null&&U.variant_json&&typeof U.variant_json=="object"?{...U.variant_json}:{};c?Oe[m]=c:delete Oe[m];const vt=$n(Oe),We=an(Y,Oe);return k[a]={...U,variant_json:Object.keys(Oe).length?Oe:null,variant:vt,unit_price:We},{...b,items:k}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",m," --"),(Array.isArray(r==null?void 0:r.options)?r.options:[]).map(f=>React.createElement("option",{key:f.label,value:f.label},f.label,Number.isFinite(Number(f==null?void 0:f.price))?` (${it(Number(f.price))})`:Number(f==null?void 0:f.price_delta)?` (${f.price_delta>0?"+":""}${f.price_delta})`:""))))}))})(),Ee&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!N[a],onChange:t=>{const n=!!t.target.checked;R(i=>{const r=Array.isArray(i)?[...i]:[],h=Array.isArray(l.items)?l.items.length:0;for(;r.length<h;)r.push(!0);return r[a]=n,r})},disabled:w||Z}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;H(i=>{const r=Array.isArray(i.items)?[...i.items]:[];return r[a]={...r[a]||{product_id:""},quantity:n},{...i,items:r}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Ue.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{H(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),q(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),R(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),ze(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:w||Z||(Array.isArray(l.items)?l.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(l.items)?l.items:[]).filter(m=>m==null?void 0:m.product_id),t=pn(a),n=un(a),i=Kn(l),r=i.amount,h=t+(n.found?n.fee:0)+r;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},it(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},it(n.fee))),!!Ue.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Ue.shipAbnormalWarn),r!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},it(r))),(l.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(l.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},it(h)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:w||!!I||!!ae}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ia.all," \u0111\u01A1n"),$e&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>$e?xs(Ie):Ha(),disabled:At,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>Tn(),disabled:w||!!I},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${Ct&&!he&&!$e?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),Mt(!1),Zt(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Us)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${la&&!he&&!$e?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),Zt(!1),Mt(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ys)),React.createElement("button",{type:"button",className:`orders-chip ${!B&&!he&&!$e?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),ne("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ia.all)),React.createElement("button",{type:"button",className:`orders-chip ${B==="draft"&&!he&&!$e?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),ne("draft"),$("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ia.draft)),React.createElement("button",{type:"button",className:`orders-chip ${B==="pending"&&!he&&!$e?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),ne("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ia.pending)),React.createElement("button",{type:"button",className:`orders-chip ${B==="processing"&&!he&&!$e?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),ne("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ia.processing)),React.createElement("button",{type:"button",className:`orders-chip ${B==="done"&&!he&&!$e?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),ne("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ia.done)),React.createElement("button",{type:"button",className:`orders-chip ${B==="paid"&&!he&&!$e?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),ne("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ia.paid)),React.createElement("button",{type:"button",className:`orders-chip ${B==="canceled"&&!he&&!$e?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),ne("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ia.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Ca("thisMonth"),disabled:$e},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ca("overduePending"),disabled:$e},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",Na," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Ca("draftExpiring"),disabled:$e},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y"),(B||he||!v&&!$e)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ca("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:Ot,type:"text",className:"form-control",value:Ie,onChange:e=>de(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(Ie||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>de(""),disabled:At},React.createElement("i",{className:"fas fa-times"})),At&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:v,onChange:e=>$(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:he||$e})),React.createElement("div",{className:"text-muted small ms-auto"},$e?"Search b\u1ECF qua filter":he?"\u0110ang xem \u0111\u01A1n ch\u1EADm":B?`L\u1ECDc: ${pa(B)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${oa?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if($e){const e=String(Ie||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${wt.length} k\u1EBFt qu\u1EA3`}return he?`\u0110\u01A1n ch\u1EADm \u2022 ${wt.length} \u0111\u01A1n`:Ct?`\u01AFu ti\xEAn \u2022 ${wt.length} \u0111\u01A1n`:la?`H\xF4m nay \u2022 ${wt.length} \u0111\u01A1n`:B?`L\u1ECDc: ${pa(B)} \u2022 ${wt.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${wt.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{de(""),Zt(!1),Mt(!1),Ca("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},$e?`${wt.length} k\u1EBFt qu\u1EA3`:B?`${An.length}/${ee.length} \u0111\u01A1n`:`${ee.length}${fe?"+":""} \u0111\u01A1n`)),$e&&ot&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},ot),Cn.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Cn.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Na," ng\xE0y.",Ne&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{oe(!0),ne("pending")}},"Xem ngay")),vs.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,vs.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 h\u1EE7y (c\xF2n \u2264 ",Dn," ng\xE0y).",Ye&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{oe(!1),ne("draft"),$(""),Ha()}},"Xem ngay")),($e?At:xe)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,a)=>React.createElement("div",{key:a,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,a)=>React.createElement("tr",{key:a},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):($e?wt.length===0:ee.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},$e?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!$e&&An.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Ns.map(e=>{var a;return React.createElement("div",{key:e.id,className:`orders-mobile-swipe-shell mb-2 ${(Ge==null?void 0:Ge.id)===String(e.id)?`swipe-preview swipe-${(Ge==null?void 0:Ge.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>{if(Pt.current){Pt.current=!1;return}dn(e)},onPointerDown:t=>{if(X||Ut||ft||t.button!=null&&t.button!==0)return;const n=String(e.id);Pt.current=!1,Ce.current={active:!0,id:n,startX:t.clientX,startY:t.clientY,dx:0,dy:0,lock:null,pointerId:t.pointerId,captured:!1},Te(i=>(i==null?void 0:i.id)===n?i:{id:n,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}try{_t.current&&clearTimeout(_t.current)}catch(i){}Ht.current=n,_t.current=setTimeout(async()=>{var r,h,m,x;const i=Ht.current;if(i)try{if((h=(r=bt.current)==null?void 0:r.has)!=null&&h.call(r,i))return;const f=await Hn(i);f&&typeof f=="object"&&((x=(m=bt.current)==null?void 0:m.set)==null||x.call(m,i,f))}catch(f){}},150)},onPointerMove:t=>{const n=Ce.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id))return;const i=t.clientX-n.startX,r=t.clientY-n.startY;if(n.dx=i,n.dy=r,Math.abs(i)>14||Math.abs(r)>14){try{_t.current&&clearTimeout(_t.current)}catch(k){}_t.current=null,Ht.current=null}if(!n.lock){const k=Math.abs(i),U=Math.abs(r);if((k>10||U>10)&&(n.lock=k>U*1.2?"x":"y",n.lock==="x"&&!n.captured))try{t.currentTarget.setPointerCapture(t.pointerId),n.captured=!0}catch(Y){}}if(n.lock!=="x"){try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(k){}Math.abs(r)>24&&Te(k=>(k==null?void 0:k.id)===n.id?{id:n.id,dir:null}:k);return}const h=!!Ua(e==null?void 0:e.status,"right"),m=!!Ua(e==null?void 0:e.status,"left"),x=(k,U,Y)=>Math.max(U,Math.min(Y,k)),f=x(i,-140,140),c=f>0&&!h||f<0&&!m?f*.35:f,b=x(Math.abs(c)/88,0,1);try{t.currentTarget.classList.add("swiping"),t.currentTarget.style.setProperty("--swipe-x",`${c}px`),t.currentTarget.style.setProperty("--swipe-p",String(b)),t.currentTarget.style.setProperty("--swipe-l",c>0&&h?String(b):"0"),t.currentTarget.style.setProperty("--swipe-r",c<0&&m?String(b):"0")}catch(k){}Math.abs(c)>12&&(Pt.current=!0),i>72&&h?Te({id:n.id,dir:"right"}):i<-72&&m?Te({id:n.id,dir:"left"}):Te({id:n.id,dir:null})},onPointerCancel:t=>{try{_t.current&&clearTimeout(_t.current)}catch(i){}_t.current=null,Ht.current=null;const n=Ce.current;try{n!=null&&n.captured&&(n==null?void 0:n.pointerId)!=null&&t.currentTarget.releasePointerCapture(n.pointerId)}catch(i){}Ce.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1},Te({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}},onPointerUp:t=>{try{_t.current&&clearTimeout(_t.current)}catch(c){}_t.current=null,Ht.current=null;const n=Ce.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id)){Te({id:null,dir:null});return}try{n!=null&&n.captured&&(n==null?void 0:n.pointerId)!=null&&t.currentTarget.releasePointerCapture(n.pointerId)}catch(c){}Ce.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1};const i=Number(n.dx)||0,r=Math.abs(i),h=n.lock==="x",m=Et(e==null?void 0:e.status);Te({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(c){}if(h&&r>12&&(Pt.current=!0),!h||r<88)return;t.preventDefault(),t.stopPropagation();const x=i>0?Ua(e==null?void 0:e.status,"right"):Ua(e==null?void 0:e.status,"left"),f=Et(x);!f||f===m||Ba(e,f)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),dn(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"orders-mobile-swipe-bg","aria-hidden":"true"},React.createElement("div",{className:"orders-mobile-swipe-bg-left"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Ua(e==null?void 0:e.status,"right"),n=ms(t),i=(n==null?void 0:n.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${n.icon||"fa-circle"}`}),i):null})())),React.createElement("div",{className:"orders-mobile-swipe-bg-right"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Ua(e==null?void 0:e.status,"left"),n=ms(t),i=(n==null?void 0:n.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${n.icon||"fa-circle"}`}),i):null})()))),React.createElement("div",{className:`card orders-mobile-card ${je!=null&&je[String(e.id)]?"order-recent-updated":""}`},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:t=>qs(t,e.phone),onPointerMove:vn,onPointerUp:vn,onPointerCancel:vn,onPointerLeave:vn,onClick:t=>{if(t.stopPropagation(),ba.current){ba.current=!1;return}ls(e.phone)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),ls(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=rs(e);if(!t)return null;const n=fa.has(String(e.id)),i=t.length>84||os(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${n?"":"order-text-collapsed"}`},t),i&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:r=>{r.stopPropagation(),ns(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const t=os(e);if(!t)return null;const n=fa.has(String(e.id)),i=rs(e).length,r=i>84||t.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${n?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t),r&&i<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:h=>{h.stopPropagation(),ns(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${$t.has(String(e.id))?"active":""}`,onClick:t=>{t.stopPropagation(),Ds(e.id)},title:$t.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":$t.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:$t.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(ra!=null&&ra[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${en(e.status)} order-status-badge-btn`,onPointerDown:t=>{t.stopPropagation(),be.current=!1;try{ue.current&&clearTimeout(ue.current)}catch(n){}ue.current=setTimeout(()=>{be.current=!0,as(e,t.currentTarget)},420)},onPointerUp:t=>{t.stopPropagation();try{ue.current&&clearTimeout(ue.current)}catch(n){}ue.current=null},onPointerCancel:t=>{t.stopPropagation();try{ue.current&&clearTimeout(ue.current)}catch(n){}ue.current=null},onClick:t=>{if(t.stopPropagation(),be.current){be.current=!1;return}ft&&String(M==null?void 0:M.id)===String(e.id)?Pa():as(e,t.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},pa(e.status)),yn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Na} ng\xE0y`},"\u26A0 Ch\u1EADm ",ln(e),"d"),wn(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Ea} ng\xE0y`},"\u23F3 C\xF2n ",Nn(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=In(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,i)=>React.createElement("div",{key:i,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${it(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},nn(e))})()),(mn(e)!==0||qa(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},it(mn(e))),qa(e)?React.createElement("span",{className:"text-muted"}," ","(",qa(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},it(hn(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",tn(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),On(e)},disabled:w||!!I||ae===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),ts(e)},disabled:w||!!I||ae===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c")))))}),React.createElement("div",{ref:Ga,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(wt)&&Ns.length<wt.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),ft&&M&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>Pa()},React.createElement("div",{className:`orders-status-popover ${(D==null?void 0:D.placement)||""}`,style:{left:D.left,top:D.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},M.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Pa(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},rn.map(e=>{const a=Et(M.status)===Et(e.value),t=w||!!I||ae===M.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Ba(M,e.value),Pa())},disabled:t},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{ts(M),Pa()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),X&&ut&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Ka()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},ut.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},ut.phone||""),React.createElement("span",{className:`badge ${en(ut.status)}`},pa(ut.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ka(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{On(ut),Ka()},disabled:w||!!I||ae===ut.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(ut.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(ut.phone||"").trim()}`,onClick:()=>Ka()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{dn(ut),Ka()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},rn.map(e=>{const a=Et(ut.status)===Et(e.value),t=w||!!I||ae===ut.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Ba(ut,e.value),Ka())},disabled:t},e.label)})))),Ut&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>bn()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>bn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Ca("thisMonth"),disabled:$e},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ca("overduePending"),disabled:$e},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Ca("draftExpiring"),disabled:$e},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!B&&!he?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),ne("")}},"T\u1EA5t c\u1EA3"),rn.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${B===e.value&&!he?"active":""}`,onClick:()=>{$e&&de(""),oe(!1),ne(e.value),e.value==="draft"&&$("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:v,onChange:e=>$(e.target.value),disabled:he||$e}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:he,onChange:e=>{$e&&de("");const a=!!e.target.checked;oe(a),a&&($(""),ne("pending"))},disabled:$e}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",Na," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Ca("all"),disabled:$e},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>bn()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${nt?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){da.current=!1;try{pt.current&&clearTimeout(pt.current)}catch(a){}pt.current=setTimeout(()=>{da.current=!0,ss(Ie)},460)}},onPointerUp:()=>{try{pt.current&&clearTimeout(pt.current)}catch(e){}pt.current=null},onPointerCancel:()=>{try{pt.current&&clearTimeout(pt.current)}catch(e){}pt.current=null},onClick:()=>{if(da.current){da.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,a;return(a=(e=Ot.current)==null?void 0:e.focus)==null?void 0:a.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>Tn(),disabled:w||!!I,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Ls(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),gt&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{on(Jt),ua()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const a=e.touches&&e.touches[0];a&&(qt.current={active:!0,startY:a.clientY,startX:a.clientX,fired:!1})},onTouchMove:e=>{const a=qt.current;if(!(a!=null&&a.active)||a.fired)return;const t=e.touches&&e.touches[0];if(!t)return;const n=t.clientY-a.startY,i=t.clientX-a.startX;Math.abs(i)>24||n>90&&(a.fired=!0,on(Jt),ua())},onTouchEnd:()=>{qt.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{on(Jt),ua()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:ea,type:"text",className:"form-control",value:Jt,onChange:e=>{const a=e.target.value;Yt(a),de(a)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(on(Jt),ua())}}),!!String(Jt||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Yt(""),de("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(_a)&&_a.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},_a.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{Yt(e),de(e),on(e),ua()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${Ct?"active":""}`,onClick:()=>{de(""),Yt(""),oe(!1),Mt(!1),Zt(e=>!e),ua()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${la?"active":""}`,onClick:()=>{de(""),Yt(""),oe(!1),Zt(!1),Mt(e=>!e),ua()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${he?"active":""}`,onClick:()=>{de(""),Yt(""),oe(e=>!e),he||($(""),ne("pending")),ua()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!B&&!he&&!Ct&&!la?"active":""}`,onClick:()=>{de(""),Yt(""),oe(!1),Zt(!1),Mt(!1),ne(""),ua()}},"T\u1EA5t c\u1EA3"),rn.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${B===e.value&&!he?"active":""}`,onClick:()=>{de(""),Yt(""),oe(!1),Zt(!1),Mt(!1),ne(e.value),e.value==="draft"&&$(""),ua()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,wt.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>dn(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=In(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",it(t.unitPrice))))):nn(e)})()),React.createElement("td",null,_s(e)),React.createElement("td",{className:"fw-semibold"},it(hn(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${en(e.status)}`},pa(e.status)),yn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Na} ng\xE0y`},"\u26A0 Ch\u1EADm ",ln(e),"d"),wn(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Ea} ng\xE0y`},"\u23F3 C\xF2n ",Nn(e),"d"))),React.createElement("td",null,tn(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),On(e)},disabled:w||!!I||ae===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation();const t=String(a.target.value||"").trim();a.target.value="",t&&Ba(e,t)},disabled:w||!!I||ae===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!$e&&fe&&!he&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Zs,disabled:xe||se},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:Qe,title:(()=>{const e=re,a=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${pa(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${a} ${t}`.trim()})(),subtitle:(()=>{const e=re,a=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?tn(e.created_at):"";return[a||t||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:ei,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},Wt?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Kt(!1),et(null),Fa(""),g(!1),R([])},disabled:w||Z},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!Ee&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:Ss,disabled:w||Z,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>jn({mode:"close",origin:"drawer"}),disabled:w||Z||!Ue.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>re&&On(re),disabled:!re||xt||w||!!I},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>re&&Vn(re),disabled:!re||xt||w||!!I},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const a=String(e.target.value||"").trim();e.target.value="",a&&re&&Ba(re,a)},disabled:!re||xt||w||!!I||ae===(re==null?void 0:re.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},Wt?React.createElement("form",{onSubmit:e=>{e.preventDefault(),jn({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),ci())):xt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):jt?React.createElement("div",{className:"alert alert-danger",role:"alert"},jt):re?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${en(re.status)}`},pa(re.status)),yn(re)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Na} ng\xE0y`},"\u26A0 Ch\u1EADm ",ln(re),"d"),wn(re)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Ea} ng\xE0y`},"\u23F3 C\xF2n ",Nn(re),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},it(hn(re))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},_s(re)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},tn(re.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},re.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},re.phone||"\u2014"),!!String(re.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(re.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},re.address||"\u2014")),((re==null?void 0:re.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(re.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=In(re);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((a,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),a.name),a.variant?React.createElement("div",{className:"text-muted small"},a.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${it(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},nn(re)||"\u2014")})(),(mn(re)!==0||qa(re))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},it(mn(re))),qa(re)?React.createElement("span",{className:"text-muted"}," ","(",qa(re),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Ae&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),Ee?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:zn})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),jn({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Nt},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:l.customer_name,onChange:e=>H({...l,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Ue.nameError&&React.createElement("div",{className:"form-text text-danger"},Ue.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:l.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Ue.phoneError&&React.createElement("div",{className:"form-text text-danger"},Ue.phoneError),!Ue.phoneError&&Vt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Vt.count," \u0111\u01A1n trong th\xE1ng ",Vt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>g(e=>!e)},C?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),C&&Vt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>g(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Vt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${en(e.status)}`},pa(e.status))),React.createElement("div",{className:"text-muted small"},tn(e.created_at)," \u2022 ",it(hn(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},nn(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Vn(e)}},"M\u1EDF")))),Vt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(T==null?void 0:T.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(T==null?void 0:T.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(T==null?void 0:T.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(T==null?void 0:T.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:l.status,onChange:e=>H({...l,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:l.address,onChange:e=>H({...l,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Ue.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Ue.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:l.note,onChange:e=>H({...l,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{H(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},wa(l.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;H(i=>{const r=wa(i.adjustment_items);return r[a]={...r[a],amount:n},{...i,adjustment_items:r}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;H(i=>{const r=wa(i.adjustment_items);return r[a]={...r[a],note:n},{...i,adjustment_items:r}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{H(t=>{const n=wa(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:w||wa(l.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Ue.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Ue.adjustmentAbnormalWarn),!!Ue.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Ue.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{H(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),q(e=>[...Array.isArray(e)?e:[],""]),Ee&&R(e=>[...Array.isArray(e)?e:[],!0])},disabled:w},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(l.items)?l.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Re.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{ze(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),we===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:ge[a]||"",onChange:t=>{const n=t.target.value;q(i=>{const r=Array.isArray(i)?[...i]:[];return r[a]=n,r})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(n.id),r=Oa(n==null?void 0:n.variants),h={};for(const f of r){const c=String((f==null?void 0:f.name)||"").trim(),b=Array.isArray(f==null?void 0:f.options)?f.options[0]:null,k=String((b==null?void 0:b.label)||"").trim();c&&k&&(h[c]=k)}const m=$n(h),x=an(n,h);H(f=>{const c=Array.isArray(f.items)?[...f.items]:[];return c[a]={...c[a]||{quantity:1},product_id:i,variant_json:Object.keys(h).length?h:null,variant:m,unit_price:r.length?x:null},{...f,items:c}}),ze(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Le.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Ue.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=sa(e.product_id),n=Oa(t==null?void 0:t.variants);if(!n.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((r,h)=>{const m=String((r==null?void 0:r.name)||`Bi\u1EBFn th\u1EC3 ${h+1}`).trim(),x=String((i==null?void 0:i[m])||"").trim();return React.createElement("div",{key:m},React.createElement("label",{className:"form-label small text-muted mb-1"},m),React.createElement("select",{className:"form-select",value:x,onChange:f=>{const c=String(f.target.value||"").trim();H(b=>{const k=Array.isArray(b.items)?[...b.items]:[],U={...k[a]||{}},Y=sa(U.product_id),Fe=Oa(Y==null?void 0:Y.variants),Oe=U!=null&&U.variant_json&&typeof U.variant_json=="object"?{...U.variant_json}:{};c?Oe[m]=c:delete Oe[m];const vt=$n(Oe),We=an(Y,Oe);return k[a]={...U,variant_json:Object.keys(Oe).length?Oe:null,variant:vt,unit_price:We},{...b,items:k}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",m," --"),(Array.isArray(r==null?void 0:r.options)?r.options:[]).map(f=>React.createElement("option",{key:f.label,value:f.label},f.label,Number.isFinite(Number(f==null?void 0:f.price))?` (${it(Number(f.price))})`:Number(f==null?void 0:f.price_delta)?` (${f.price_delta>0?"+":""}${f.price_delta})`:""))))}))})(),Ee&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!N[a],onChange:t=>{const n=!!t.target.checked;R(i=>{const r=Array.isArray(i)?[...i]:[],h=Array.isArray(l.items)?l.items.length:0;for(;r.length<h;)r.push(!0);return r[a]=n,r})},disabled:w||Z}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;H(i=>{const r=Array.isArray(i.items)?[...i.items]:[];return r[a]={...r[a]||{product_id:""},quantity:n},{...i,items:r}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Ue.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{H(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),q(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),R(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),ze(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:w||Z||(Array.isArray(l.items)?l.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(l.items)?l.items:[]).filter(m=>m==null?void 0:m.product_id),t=pn(a),n=un(a),i=Kn(l),r=i.amount,h=t+(n.found?n.fee:0)+r;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},it(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},it(n.fee))),!!Ue.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Ue.shipAbnormalWarn),r!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},it(r))),(l.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(l.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},it(h)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:zn,disabled:w||Z,style:{borderRadius:10}},"H\u1EE7y"),!!Ee&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:Ss,disabled:w||Z,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!Ee&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>jn({mode:"new",origin:"modal"}),disabled:w||!Ue.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:w||Z||!Ue.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

