const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:N,error:u}){const[M,L]=useState(""),[A,r]=useState(""),[v,w]=useState(!1),[P,b]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),u&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),u),React.createElement("form",{onSubmit:async J=>{J.preventDefault(),w(!0),await N(M,A),w(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:M,onChange:J=>L(J.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:P?"text":"password",className:"form-control",value:A,onChange:J=>r(J.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>b(!P)},React.createElement("i",{className:`fas fa-eye${P?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:N,type:u,onClose:M}){return useEffect(()=>{const L=setTimeout(M,3e3);return()=>clearTimeout(L)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${u} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},N),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:M})))}function Loading({show:N}){return N?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:N,onMenuChange:u,onLogout:M,currentUser:L}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(r=>React.createElement("a",{key:r.id,href:"#",className:`nav-link ${N===r.id?"active":""} ${r.disabled?"opacity-50":""} ${r.highlight?"text-warning":""}`,onClick:v=>{v.preventDefault(),r.disabled||u(r.id)}},React.createElement("i",{className:`fas ${r.icon}`})," ",r.label,r.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),r.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),M&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:M,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:N,onSelect:u,onCreate:M,onEdit:L,onDelete:A,loading:r,currentFolder:v,onBack:w,breadcrumb:P}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},v&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:w},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),v?v.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:M},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),P&&P.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),w("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),P.map((b,W)=>React.createElement("li",{key:b.id,className:`breadcrumb-item ${W===P.length-1?"active":""}`},W===P.length-1?b.title:React.createElement("a",{href:"#",onClick:J=>{J.preventDefault(),w(b)},className:"text-warning"},b.title))))),r?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):N.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},v?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},N.map(b=>React.createElement("div",{key:b.uuid||b.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>u(b)},b.cover?React.createElement("img",{src:b.cover,className:"album-cover",alt:b.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},b.title),React.createElement("small",{className:"text-muted"},b.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),b.subfolderCount),b.subfolderCount>0&&b.count>0&&" \u2022 ",b.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),b.count),b.subfolderCount===0&&b.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:W=>{W.stopPropagation(),L(b)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:W=>{W.stopPropagation(),A(b)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:N,album:u,onClose:M,onSave:L,parentId:A}){const[r,v]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[w,P]=useState(!1),[b,W]=useState(!1),J=useRef(null);useEffect(()=>{v(u?{slug:u.id||"",title:u.title||"",description:u.description||"",cover_url:u.cover||"",parent_id:u.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:A||null})},[u,N,A]);const O=async K=>{K.preventDefault(),P(!0),await L(r),P(!1)},R=K=>K.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Q=async K=>{const X=K.type==="image/heic"||K.type==="image/heif"||/\.heic$/i.test(K.name);if(K.size<=2097152&&!X)return K;try{const c=await createImageBitmap(K),B=document.createElement("canvas");let f=c.width,z=c.height;const ne=800;return(f>ne||z>ne)&&(f>z?(z=Math.round(z/f*ne),f=ne):(f=Math.round(f/z*ne),z=ne)),B.width=f,B.height=z,B.getContext("2d").drawImage(c,0,0,f,z),c.close(),new Promise((be,G)=>{B.toBlob(pe=>{pe?be(new File([pe],K.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):G(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(c){throw console.error("Compress cover error:",c),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Z=async K=>{var c;const ee=K.target.files[0];if(!ee)return;if(!(ee.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ee.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}W(!0);try{const B=await Q(ee),f=await window.KTM.cloudinary.uploadImage({file:B,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!f.secure_url)throw console.error("Cloudinary error:",f),new Error(((c=f.error)==null?void 0:c.message)||"Upload failed");v(z=>({...z,cover_url:f.secure_url}))}catch(B){console.error("Cover upload error:",B),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+B.message)}W(!1),K.target.value=""};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},u?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:M})),React.createElement("form",{onSubmit:O},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:r.title,onChange:K=>v({...r,title:K.target.value,slug:r.slug||R(K.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:r.slug,onChange:K=>v({...r,slug:K.target.value}),required:!0,disabled:!!u}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:r.description,onChange:K=>v({...r,description:K.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},r.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:r.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>v(K=>({...K,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:J,type:"file",accept:"image/*",className:"d-none",onChange:Z}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var K;return(K=J.current)==null?void 0:K.click()},disabled:b},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:r.cover_url,onChange:K=>v({...r,cover_url:K.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:M},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:w||b},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:N,allAlbums:u,currentAlbumId:M,targetAlbum:L,onSelect:A,level:r=0}){const[v,w]=useState(!0),P=N.uuid||N.id,b=P===M,W=L===P,J=u.filter(R=>R.parentId===P),O=J.length>0;return React.createElement("div",{style:{marginLeft:r*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${W?"bg-info text-white":b?"bg-light text-muted":"hover-bg"}`,style:{cursor:b?"not-allowed":"pointer",opacity:b?.5:1,transition:"background 0.2s"},onClick:()=>!b&&A(P)},O&&React.createElement("i",{className:`fas fa-chevron-${v?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:R=>{R.stopPropagation(),w(!v)}}),!O&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${W?"-open":""} me-2 ${W?"":"text-warning"}`}),React.createElement("span",{className:"small"},N.title),b&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),N.count>0&&!b&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},N.count)),v&&O&&React.createElement("div",null,J.map(R=>React.createElement(FolderTreeItem,{key:R.uuid||R.id,folder:R,allAlbums:u,currentAlbumId:M,targetAlbum:L,onSelect:A,level:r+1}))))}function AlbumDetail({album:N,onBack:u,onRefresh:M,showToast:L,onNavigateToFolder:A,onEditSubfolder:r,parentAlbum:v}){const[w,P]=useState([]),[b,W]=useState([]),[J,O]=useState(!0),[R,Q]=useState(!1),[Z,K]=useState(""),[ee,X]=useState([]),[c,B]=useState([]),[f,z]=useState({}),[ne,C]=useState(null),[be,G]=useState(!1),[pe,oe]=useState(""),[me,re]=useState(!1),ue=useRef(null),te=useRef(null),[fe,ye]=useState(!1),[ce,xe]=useState([]),[Ke,Ce]=useState([]),[Ie,ze]=useState(""),[a,i]=useState(!1),I=async(l,S=2)=>{const ae=S*1024*1024,ke=l.type==="image/heic"||l.type==="image/heif"||/\.heic$/i.test(l.name);if(l.size<=ae&&!ke)return l;try{const Se=await createImageBitmap(l),Me=document.createElement("canvas");let Oe=Se.width,Ee=Se.height;const Pe=1200;return(Oe>Pe||Ee>Pe)&&(Oe>Ee?(Ee=Math.round(Ee/Oe*Pe),Oe=Pe):(Oe=Math.round(Oe/Ee*Pe),Ee=Pe)),Me.width=Oe,Me.height=Ee,Me.getContext("2d").drawImage(Se,0,0,Oe,Ee),Se.close(),new Promise((Ye,Je)=>{Me.toBlob(F=>{F?Ye(new File([F],l.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Je(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Se){throw console.error("Compress error:",Se),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{ge(),$e()},[N.id,N.uuid]);const ge=async()=>{O(!0);try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");P(l.images||[]);const S=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");W(Array.isArray(S)?S:[])}catch(l){console.error(l),L("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}O(!1)},$e=async()=>{try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");Ce(Array.isArray(l)?l:[])}catch(l){console.error("Error loading albums:",l)}},Le=l=>{xe(S=>S.includes(l)?S.filter(ae=>ae!==l):[...S,l])},ie=async()=>{if(!Ie||ce.length===0){L("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}i(!0);let l=0;for(const S of ce)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${S}`,{album_id:Ie},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),l++}catch(ae){console.error("Move error:",ae)}i(!1),ye(!1),xe([]),ze(""),l>0?(L("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),ge(),M()):L("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Be,Re]=useState(!1),k=async()=>{if(ce.length===0||!confirm(`X\xF3a ${ce.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Re(!0);let l=0;for(const S of ce)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${S}`,"L\u1ED7i x\xF3a \u1EA3nh"),l++}catch(ae){console.error("Delete error:",ae)}Re(!1),xe([]),l>0?(L(`\u0110\xE3 x\xF3a ${l} \u1EA3nh!`,"success"),ge(),M()):L("X\xF3a th\u1EA5t b\u1EA1i","danger")},Ne=()=>{ce.length===w.length?xe([]):xe(w.map(l=>l.id))},Fe=async()=>{if(pe.trim()){re(!0);try{const l=pe.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:l+"-"+Date.now(),title:pe,parent_id:N.uuid||N.id},"L\u1ED7i t\u1EA1o folder"),L("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),oe(""),G(!1),ge(),M()}catch(l){L(l.message,"danger")}re(!1)}},se=async l=>{if(confirm(`X\xF3a folder "${l.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${l.uuid||l.id}`,"L\u1ED7i x\xF3a folder"),L("\u0110\xE3 x\xF3a folder","success"),ge(),M()}catch(S){L("L\u1ED7i x\xF3a folder","danger")}},x=l=>{const S=Array.from(l).filter(ae=>ae.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ae.name));X(ae=>[...ae,...S]),S.forEach(ae=>{const ke=new FileReader;ke.onload=Se=>{B(Me=>[...Me,{file:ae,preview:Se.target.result}])},ke.readAsDataURL(ae)})},Ge=l=>{X(S=>S.filter((ae,ke)=>ke!==l)),B(S=>S.filter((ae,ke)=>ke!==l))},qe=async l=>{var ae;const S=await window.KTM.cloudinary.uploadImage({file:l,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${N.id}`});if(!S.secure_url)throw console.error("Cloudinary error:",S),new Error(((ae=S.error)==null?void 0:ae.message)||"Upload failed");return S},We=async()=>{if(ee.length===0)return;Q(!0);let l=0;for(let S=0;S<ee.length;S++)try{K(`\u0110ang x\u1EED l\xFD ${S+1}/${ee.length}...`);const ae=await I(ee[S],2);K(`\u0110ang upload ${S+1}/${ee.length}...`);const ke=await qe(ae);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${N.id}`,{url:ke.secure_url,caption:f[S]||ee[S].name.replace(/\.[^/.]+$/,""),sort_order:w.length+S},"L\u1ED7i l\u01B0u \u1EA3nh"),l++}catch(ae){console.error("Upload error:",ae)}Q(!1),K(""),X([]),B([]),z({}),l>0?(L(`\u0110\xE3 upload ${l} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),ge(),M()):L("Upload th\u1EA5t b\u1EA1i","danger")},et=async(l,S)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${l}`,"L\u1ED7i x\xF3a \u1EA3nh"),L("\u0110\xE3 x\xF3a \u1EA3nh","success"),ge(),M()}catch(ae){L("L\u1ED7i x\xF3a \u1EA3nh","danger")}},De=l=>{var S;l.preventDefault(),(S=te.current)==null||S.classList.add("dragover")},Te=()=>{var l;(l=te.current)==null||l.classList.remove("dragover")},He=l=>{var S;l.preventDefault(),(S=te.current)==null||S.classList.remove("dragover"),x(l.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:u},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},N.title),React.createElement("small",{className:"text-muted"},b.length>0&&React.createElement("span",null,b.length," folder \u2022 "),w.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>G(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),be&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:pe,onChange:l=>oe(l.target.value),onKeyPress:l=>l.key==="Enter"&&Fe(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Fe,disabled:me||!pe.trim()},me?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{G(!1),oe("")}},"H\u1EE7y")))),b.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},b.map(l=>React.createElement("div",{key:l.uuid||l.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>A&&A(l)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},l.title),React.createElement("small",{className:"text-muted"},l.subfolderCount>0&&React.createElement("span",null,l.subfolderCount," folder"),l.subfolderCount>0&&l.count>0&&" \u2022 ",l.count>0&&React.createElement("span",null,l.count," \u1EA3nh"),l.subfolderCount===0&&l.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:S=>{S.stopPropagation(),r&&r(l)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:S=>{S.stopPropagation(),se(l)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:te,className:"upload-zone",onClick:()=>{var l;return(l=ue.current)==null?void 0:l.click()},onDragOver:De,onDragLeave:Te,onDrop:He},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:ue,type:"file",multiple:!0,accept:"image/*",onChange:l=>x(l.target.files)})),c.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},c.map((l,S)=>React.createElement("div",{key:S,className:"upload-preview-item"},React.createElement("img",{src:l.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Ge(S)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:We,disabled:R},R?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Z||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",ee.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",w.length,")"),w.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Ne},ce.length===w.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ce.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ce.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>ye(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:k,disabled:Be},Be?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>xe([])},React.createElement("i",{className:"fas fa-times"})))),J?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):w.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},w.map((l,S)=>React.createElement("div",{key:S,className:`image-item ${ce.includes(l.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Le(l.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ce.includes(l.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ce.includes(l.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ce.includes(l.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:l.src,alt:l.caption,style:{opacity:ce.includes(l.id)?.7:1,border:ce.includes(l.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:ae=>{ae.stopPropagation(),et(l.id,S)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),l.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},l.caption)))))),fe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ce.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>ye(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},Ke.filter(l=>!l.parentId).map(l=>React.createElement(FolderTreeItem,{key:l.uuid||l.id,folder:l,allAlbums:Ke,currentAlbumId:N.uuid||N.id,targetAlbum:Ie,onSelect:ze})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>ye(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ie,disabled:!Ie||a},a?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),ne&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>C(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>C(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:ne.src,alt:ne.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:l=>l.stopPropagation()}),ne.caption&&React.createElement("div",{className:"text-white text-center mt-2"},ne.caption)))))}function SearchCenter({showToast:N,onNavigate:u}){const[M,L]=useState(""),[A,r]=useState([]),[v,w]=useState([]),[P,b]=useState([]),[W,J]=useState("all"),[O,R]=useState(null),[Q,Z]=useState("list"),[K,ee]=useState(!0),[X,c]=useState([]),[B,f]=useState([]),z=useRef(null),[ne,C]=useState(!0),[be,G]=useState(!1),pe=useRef(null),[oe,me]=useState(!1),[re,ue]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[te,fe]=useState(""),[ye,ce]=useState(!1),xe=useRef(null),Ke=useRef(null),[Ce,Ie]=useState(null),[ze,a]=useState(!1),[i,I]=useState(null),[ge,$e]=useState(!1),[Le,ie]=useState(!1),[Be,Re]=useState(null),[k,Ne]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),Fe=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],se=t=>{t._type==="product"&&(I(t),Ne({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||""}),a(!0))},x=async()=>{if(i)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${i.id}`,k,"L\u1ED7i c\u1EADp nh\u1EADt"),N("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),a(!1),I(null),De()}catch(t){N(t.message,"danger")}},Ge=async t=>{const h=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${h} "${t.name}"?`))try{let g="";t._type==="product"?g=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?g=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(g=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(g,"L\u1ED7i x\xF3a"),N(`\u0110\xE3 x\xF3a ${h}`,"success"),De()}catch(g){N(g.message,"danger")}},qe=async t=>{try{const h=Be?`${API_BASE}/api/products?id=${Be.id}`:`${API_BASE}/api/products`;Be?await window.KTM.api.putJSON(h,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(h,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(Be?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ie(!1),Re(null),De()}catch(h){N(h.message,"danger")}},We="ktm_admin_data_cache_v1",et=1e3*60*10,De=async()=>{let t=null,h=!1;const g=window.KTM.cache.read(We,{ttlMs:et,validate:Array.isArray});g.hit?(t=g.value,console.log("[CACHE] Using cache, items:",t.length),w(t),r(t),ee(!1),h=!0):g.status==="miss"?console.log("[CACHE] No cache found"):g.status==="expired"||g.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):g.status==="error"&&console.error("[CACHE] Error parsing cache"),h||ee(!0);try{const _=async(de,we)=>{try{const le=await window.KTM.api.getJSON(de,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return le!=null?le:we}catch(le){return we}},[$,p,m]=await Promise.all([_(`${API_BASE}/api/products`,[]),_(`${API_BASE}/api/albums`,[]),_(`${API_BASE}/api/video-folders?withVideos=true`,[])]),T=Array.isArray($)?$.map(de=>({...de,_type:"product",_source:"database"})):[];c(p);let V=[];Array.isArray(p)&&p.length>0&&(await Promise.all(p.map(we=>_(`${API_BASE}/api/albums/${we.id}`,{})))).forEach((we,le)=>{const Ve=p[le];we.images&&we.images.length>0&&we.images.forEach(_e=>{V.push({id:_e.id,name:_e.caption||"\u1EA2nh t\u1EEB "+Ve.title,image:_e.src,folder:Ve.title,_type:"album",_source:"database"})})}),f(m);let q=[];Array.isArray(m)&&m.forEach(de=>{de.videos&&de.videos.forEach(we=>{q.push({id:we.id,name:we.title,folder:de.name,image:we.thumb,youtubeId:we.youtubeId,url:we.url,_type:"video",_source:"database"})})});const H=[...T,...V,...q];(!t||JSON.stringify(H)!==JSON.stringify(t))&&(w(H),r(H),window.KTM.cache.write(We,H))}catch(_){console.error("Song song fetch error:",_)}ee(!1)};useEffect(()=>{De(),setTimeout(()=>{var t;return(t=z.current)==null?void 0:t.focus()},100)},[]);const Te=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(h){return String(t!=null?t:"").toLowerCase()}},He=t=>{const g=Te(t).trim().split(/\s+/).filter(Boolean),_=g.includes("anh"),$=g.includes("video"),p=g.filter(V=>V!=="anh"&&V!=="video"),m=p.join(" "),T=new Set(["product"]);return _&&T.add("album"),$&&T.add("video"),{allowedTypes:T,includeAlbum:_,includeVideo:$,contentTokens:p,cleanedQuery:m}},l=(t,h,g)=>{var de,we,le,Ve,_e;const _=Array.isArray(h)?h:[],$=Te(g).trim();if(!_.length&&!$)return 0;const p=Te((de=t==null?void 0:t.name)!=null?de:""),m=Te((we=t==null?void 0:t.code)!=null?we:""),T=Te((le=t==null?void 0:t.category)!=null?le:""),V=Te((Ve=t==null?void 0:t.note)!=null?Ve:""),q=Te((_e=t==null?void 0:t.folder)!=null?_e:"");if(!`${p} ${m} ${T} ${V} ${q}`.trim())return 0;let j=0;$&&(p===$&&(j+=220),p.includes($)&&(j+=140),p.startsWith($)&&(j+=160),m&&m===$&&(j+=180),m&&m.includes($)&&(j+=90));for(const Ue of _){if(!Ue)continue;const e=new RegExp(`(?:^|\\s)${Ue.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);p.includes(Ue)&&(j+=35),e.test(p)&&(j+=25),m&&m.includes(Ue)&&(j+=20),m&&e.test(m)&&(j+=10),T&&T.includes(Ue)&&(j+=12),q&&q.includes(Ue)&&(j+=12),V&&V.includes(Ue)&&(j+=6)}return j>0&&p&&(j+=Math.max(0,10-Math.min(10,Math.floor(p.length/10)))),j},S=(t,h,g)=>{const _=Array.isArray(t)?t:[];return _.length?_.map((p,m)=>({it:p,idx:m,score:l(p,h,g)})).sort((p,m)=>m.score!==p.score?m.score-p.score:p.idx-m.idx).map(p=>p.it):[]},ae=async(t,h)=>{if(!(!ne||h.length===0)){G(!0);try{const g=h.map($=>({id:$.id,name:$.name,price:$.price,category:$.category,note:$.note,folder:$.folder,_type:$._type})),_=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:g},"AI Search error");if(_&&_.matchedIds&&_.matchedIds.length>0){const{contentTokens:$,cleanedQuery:p}=He(t),m=new Set(_.matchedIds),T=h.filter(V=>m.has(V.id)).sort((V,q)=>l(q,$,p)-l(V,$,p));T.length>0&&r(T)}else _&&_.matchedIds&&_.matchedIds.length===0&&r([])}catch(g){console.error("AI Search error:",g)}G(!1)}},ke=t=>{if(L(t),pe.current&&clearTimeout(pe.current),!t.trim()){Se(W);return}const{allowedTypes:h,contentTokens:g,cleanedQuery:_}=He(t),$=v.filter(m=>{if(!h.has(m==null?void 0:m._type))return!1;if(g.length===0)return!0;const T=Te(Object.entries(m).filter(([V])=>!V.startsWith("_")).map(([,V])=>String(V||"")).join(" "));return g.some(V=>T.includes(V))});let p=$;W!=="all"&&(p=$.filter(m=>(m.category||m._type)===W)),r(S(p,g,_)),ne&&_.length>=3&&(pe.current=setTimeout(()=>{ae(_,p)},500))},Se=t=>{J(t);const{allowedTypes:h,contentTokens:g}=He(M),{cleanedQuery:_}=He(M);let $=v.filter(p=>h.has(p==null?void 0:p._type));t!=="all"&&($=$.filter(p=>(p.category||p._type)===t)),M.trim()&&g.length>0&&($=$.filter(p=>{const m=Te(Object.entries(p).filter(([T])=>!T.startsWith("_")).map(([,T])=>String(T||"")).join(" "));return g.every(T=>m.includes(T))})),r(S($,g,_))},Me=(t,h)=>{window.KTM.clipboard.writeText(t).then(()=>{R(h),N("\u0110\xE3 copy!","success"),setTimeout(()=>R(null),1500)})},Oe=async(t,h)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),R(h+"-img"),N("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>R(null),1500)}catch(g){Me(t,h+"-img")}},Ee=t=>{let h=t.toLowerCase();const g=[],_=v.filter(m=>m._type==="product");if(h.includes("ty")||h.includes("xy lanh")){if(h.includes("gi\u1EEFa")||h.includes("giua")){const m=_.find(T=>{var V;return(V=T.name)==null?void 0:V.toLowerCase().includes("xy lanh gi\u1EEFa")});m&&!g.find(T=>T.id===m.id)&&g.push(m)}if(h.includes("nghi\xEAng")||h.includes("nghieng")){const m=_.find(T=>{var V;return(V=T.name)==null?void 0:V.toLowerCase().includes("xy lanh nghi\xEAng")});m&&!g.find(T=>T.id===m.id)&&g.push(m)}if(h.includes("\u1EE7i")||h.includes("ui")){const m=_.find(T=>{var V;return(V=T.name)==null?void 0:V.toLowerCase().includes("xy lanh \u1EE7i")});m&&!g.find(T=>T.id===m.id)&&g.push(m)}}const $=h.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if($){const m=$[1],T=$[2],V=_.find(q=>{var j;const H=((j=q.name)==null?void 0:j.toLowerCase())||"";return H.includes("combo")&&H.includes(`${m} tay`)&&(H.includes(`${T} xy`)||H.includes(`${T} xylanh`))});if(V&&!g.find(q=>q.id===V.id))g.push(V);else{const q=_.find(H=>{var de;const j=((de=H.name)==null?void 0:de.toLowerCase())||"";return j.includes("combo")&&j.includes(`${m} tay`)});q&&!g.find(H=>H.id===q.id)&&g.push(q)}}if(h.includes("combo")&&!$){const m=h.match(/combo.*?(\d+)\s*tay/);if(m){const T=m[1];_.filter(q=>{var j;const H=((j=q.name)==null?void 0:j.toLowerCase())||"";return H.includes("combo")&&H.includes(`${T} tay`)}).forEach(q=>{g.find(H=>H.id===q.id)||g.push(q)})}}const p=h.match(/van\s*(\d+)\s*tay/);if(p&&!h.includes("ty")&&!h.includes("combo")){const m=p[1],T=_.find(V=>{var H;const q=((H=V.name)==null?void 0:H.toLowerCase())||"";return q.includes(`van ${m} tay`)&&!q.includes("combo")});T&&!g.find(V=>V.id===T.id)&&g.push(T)}return g.slice(0,4)},Pe=async t=>{if(!t.trim())return;const h={role:"user",content:t,attachments:[]};ue(_=>[..._,h]),fe(""),ce(!0);const g=Ee(t);setTimeout(()=>{var _;return(_=xe.current)==null?void 0:_.scrollIntoView({behavior:"smooth"})},100);try{const $=v.filter(H=>H._type==="product").map(H=>{let j=`- ${H.name}`;return H.code&&(j+=` (M\xE3: ${H.code})`),H.price&&(j+=` - Gi\xE1: ${H.price.replace(/[đ\s]/g,"")}\u0111`),H.category&&(j+=` [${H.category}]`),H.note&&(j+=` (${H.note})`),j}).join(`
`),m=re.slice(-6).map(H=>`${H.role==="user"?"Kh\xE1ch":"AI"}: ${H.content}`).join(`
`),T=m?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${m}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${$}`:$,q=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:T,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";ue(H=>[...H,{role:"assistant",content:q,attachments:g}])}catch(_){console.error("AI Error:",_);const $=t.toLowerCase(),p=v.filter(T=>{const V=Object.values(T).join(" ").toLowerCase();return $.split(" ").some(q=>V.includes(q))});let m="";p.length>0?(m=`T\xECm th\u1EA5y ${p.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,p.slice(0,5).forEach(T=>{m+=`\u2022 ${T.name}`,T.price&&(m+=` - ${T.price.replace(/[đ\s]/g,"")}\u0111`),T.note&&(m+=` (${T.note})`),m+=`
`}),p.length>5&&(m+=`
...v\xE0 ${p.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):m='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',ue(T=>[...T,{role:"assistant",content:m,attachments:p.slice(0,4)}])}ce(!1),setTimeout(()=>{var _,$;(_=xe.current)==null||_.scrollIntoView({behavior:"smooth"}),($=Ke.current)==null||$.focus()},100)};function Qe({show:t,product:h,categories:g,onClose:_,onSave:$}){const[p,m]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[T,V]=useState(!1),[q,H]=useState(!1),j=useRef(null),de=s=>window.KTM.money.formatVNDInputDigits(s);useEffect(()=>{if(h)if(m({name:h.name||"",code:h.code||"",price:h.price||"",image:h.image||"",category:h.category||"",note:h.note||"",sort_order:h.sort_order||0}),h.price){const s=window.KTM.money.getDigits(h.price);_e(s),m(d=>({...d,price:de(s)}))}else _e("");else m({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),_e("")},[h,t]);const[we,le]=React.useState(""),[Ve,_e]=React.useState(""),Ue=s=>{const d=window.KTM.money.nextPriceInputState(s.target.value,Ve);_e(d.digits),m({...p,price:d.price})},e=async(s,d=2)=>{const E=d*1024*1024;if(s.size<=E)return s;try{const Y=await createImageBitmap(s),D=document.createElement("canvas");let y=Y.width,U=Y.height;const he=1200;return(y>he||U>he)&&(y>U?(U=Math.round(U/y*he),y=he):(y=Math.round(y/U*he),U=he)),D.width=y,D.height=U,D.getContext("2d").drawImage(Y,0,0,y,U),Y.close(),new Promise((ve,at)=>{D.toBlob(Ze=>{Ze?ve(new File([Ze],s.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):at(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Y){throw console.error("Compress error:",Y),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},o=async s=>{var Y;const d=s.target.files[0];if(!d)return;if(!(d.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(d.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}H(!0);try{const D=await e(d),y=await window.KTM.cloudinary.uploadImage({file:D,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!y.secure_url)throw console.error("Cloudinary error:",y),new Error(((Y=y.error)==null?void 0:Y.message)||"Upload failed");m(U=>({...U,image:y.secure_url}))}catch(D){console.error("Upload error:",D),alert("L\u1ED7i upload \u1EA3nh: "+D.message)}H(!1),s.target.value=""},n=async s=>{s.preventDefault(),V(!0),await $(p),V(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),h?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:_})),React.createElement("form",{onSubmit:n},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:p.name,onChange:s=>m({...p,name:s.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:p.code,onChange:s=>m({...p,code:s.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:p.price,onChange:Ue,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:p.category,onChange:s=>m({...p,category:s.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),g.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:p.note,onChange:s=>m({...p,note:s.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},p.image?React.createElement(React.Fragment,null,React.createElement("img",{src:p.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>m({...p,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var s;return(s=j.current)==null?void 0:s.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:j,type:"file",accept:"image/*",className:"d-none",onChange:o}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var s;return(s=j.current)==null?void 0:s.click()},disabled:q,style:{borderRadius:"10px"}},q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:p.image,onChange:s=>m({...p,image:s.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:_,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:T,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},T?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Ye=(t,h)=>{const g=t._type==="product",_=t._type==="album",$=t._type==="video",p=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale"));return Q==="grid"?React.createElement("div",{key:t.id||h,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>Ie({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${$?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${g?"product":_?"album":"video"}`},g?"SP":_?"\u1EA2nh":"Video"),p&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:O===t.id+"-img"?"copied":"",onClick:()=>Oe(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:O===t.id+"-price"?"copied":"",onClick:()=>Me(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||h,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${g?"product":_?"album":"video"}`},g?"S\u1EA3n ph\u1EA9m":_?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>Ie({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${$?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),p&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),$&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},g&&React.createElement("button",{onClick:()=>u&&u("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:O===t.id+"-price"?"copied":"",onClick:()=>Me(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:O===t.id+"-name"?"copied":"",onClick:()=>Me(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),$&&t.youtubeId&&React.createElement("button",{className:O===t.id+"-yt"?"copied":"",onClick:()=>Me(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),g&&React.createElement("button",{className:"action-edit",onClick:()=>se(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Ge(t)},React.createElement("i",{className:"fas fa-trash"}))))},[Je,F]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,A.length)," k\u1EBFt qu\u1EA3",ne&&M.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),W!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},W==="product"?"S\u1EA3n ph\u1EA9m":W==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Q==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Z("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Q==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Z("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},K?React.createElement("div",null,[...Array(8)].map((t,h)=>React.createElement("div",{key:h,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):A.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',M,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{L(""),ke("")}},"Xem t\u1EA5t c\u1EA3")):Q==="grid"?React.createElement("div",{className:"product-grid-mobile"},A.map((t,h)=>Ye(t,h))):React.createElement("div",null,A.map((t,h)=>Ye(t,h)))),Je&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>F(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${W==="all"?"active":""}`,onClick:()=>{Se("all"),F(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${W==="product"?"active":""}`,onClick:()=>{Se("product"),F(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${W==="album"?"active":""}`,onClick:()=>{Se("album"),F(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${W==="video"?"active":""}`,onClick:()=>{Se("video"),F(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:ne,onChange:t=>C(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:z,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:M,onChange:t=>ke(t.target.value)}),React.createElement("button",{className:`filter-btn ${Je||W!=="all"?"active":""}`,onClick:()=>F(!Je)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:ge?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>me(!0),onTouchStart:()=>me(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),oe&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>me(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},re.map((t,h)=>React.createElement("div",{key:h,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:O===`chat-${h}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:O===`chat-${h}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),R(`chat-${h}`),setTimeout(()=>R(null),1500)}},React.createElement("i",{className:`fas ${O===`chat-${h}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((g,_)=>React.createElement("div",{key:_,style:{width:70},className:"text-center"},g.image&&React.createElement("img",{src:g.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>Ie({url:g.image,name:g.name,price:g.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},g.name),g.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},g.price.replace(/[đ\s]/g,""),"\u0111"))))))),ye&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:xe})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Pe(t),disabled:ye,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),Pe(te)},className:"chat-input-wrap"},React.createElement("input",{ref:Ke,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:te,onChange:t=>fe(t.target.value),disabled:ye}),React.createElement("button",{type:"submit",className:"send-btn",disabled:ye||!te.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),Ce&&React.createElement("div",{className:"preview-modal",onClick:()=>Ie(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>Ie(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:Ce.url,alt:Ce.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},Ce.name),Ce.price&&React.createElement("div",{className:"price"},Ce.price.replace(/[đ\s]/g,""),"\u0111"),Ce.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},Ce.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:O==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:O==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Oe(Ce.url,"preview")},React.createElement("i",{className:`fas ${O==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),Ce.price&&React.createElement("button",{className:O==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Me(Ce.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${O==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Qe,{show:Le,product:Be,categories:P,onClose:()=>{ie(!1),Re(null)},onSave:qe}),React.createElement("div",{className:`fab-container mobile-only ${ge?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{$e(!1),ie(!0),Re(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{$e(!1),u&&u("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${ge?"open":""}`,onClick:()=>$e(!ge)},React.createElement("i",{className:"fas fa-plus"}))),ze&&i&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>a(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:k.name,onChange:t=>Ne({...k,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:k.code,onChange:t=>Ne({...k,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:k.price,onChange:t=>Ne({...k,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:k.category,onChange:t=>Ne({...k,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Fe.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:k.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>Ne({...k,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>a(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:x},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:N,showToast:u}){const[M,L]=useState([]),[A,r]=useState([]),[v,w]=useState(!0),[P,b]=useState(null),[W,J]=useState(!1),[O,R]=useState(null),[Q,Z]=useState(!1),[K,ee]=useState(null),[X,c]=useState(null),[B,f]=useState([]);useEffect(()=>{z()},[]);const z=async(a=null)=>{w(!0);try{const i=a?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${a}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,I=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");L(Array.isArray(I)?I:[])}catch(i){console.error(i),u("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}w(!1)},ne=async a=>{try{const i=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${a}`,"L\u1ED7i t\u1EA3i video");r(Array.isArray(i)?i:[])}catch(i){console.error(i)}},C=async a=>{if(a===0)return;const i=[...M];[i[a-1],i[a]]=[i[a],i[a-1]],L(i),await G(i)},be=async a=>{if(a===M.length-1)return;const i=[...M];[i[a],i[a+1]]=[i[a+1],i[a]],L(i),await G(i)},G=async a=>{try{await Promise.all(a.map((i,I)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${i.id}`,{sortOrder:I},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),u("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(i){u("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),z(X==null?void 0:X.id)}},pe=async a=>{if(a===0)return;const i=[...A];[i[a-1],i[a]]=[i[a],i[a-1]],r(i),await me(i)},oe=async a=>{if(a===A.length-1)return;const i=[...A];[i[a],i[a+1]]=[i[a+1],i[a]],r(i),await me(i)},me=async a=>{try{await Promise.all(a.map((i,I)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${i.id}`,{sort_order:I},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),u("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(i){u("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ne(P.id)}},re=()=>{R(null),J(!0)},ue=a=>{R(a),J(!0)},te=async a=>{try{!O&&X&&(a.parent_id=X.id);const i=O?`${API_BASE}/api/video-folders/${O.id}`:`${API_BASE}/api/video-folders`;O?await window.KTM.api.putJSON(i,a,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(i,a,"L\u1ED7i l\u01B0u folder"),u(O?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),J(!1),z(X==null?void 0:X.id)}catch(i){u(i.message,"danger")}},fe=async a=>{const i=a.subfolderCount>0?`X\xF3a folder "${a.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${a.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(i))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${a.id}`,"L\u1ED7i x\xF3a folder"),u("\u0110\xE3 x\xF3a folder","success"),b(null),z(X==null?void 0:X.id)}catch(I){u("L\u1ED7i x\xF3a folder","danger")}},ye=a=>{a.subfolderCount>0?(f(i=>[...i,a]),c(a),z(a.id)):(b(a),r(a.videos||[]))},ce=a=>{if(a==="root")f([]),c(null),z(null);else if(a){const i=B.findIndex(I=>I.id===a.id);i>=0&&(f(B.slice(0,i+1)),c(a),z(a.id))}else{const i=[...B];i.pop();const I=i[i.length-1]||null;f(i),c(I),z(I==null?void 0:I.id)}},xe=()=>{ee(null),Z(!0)},Ke=a=>{ee(a),Z(!0)},Ce=async a=>{try{a.folder_id=P==null?void 0:P.id;const i=K?`${API_BASE}/api/videos/${K.id}`:`${API_BASE}/api/videos`;K?await window.KTM.api.putJSON(i,a,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(i,a,"L\u1ED7i l\u01B0u video"),u(K?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),Z(!1),z(),P&&ne(P.id)}catch(i){u(i.message,"danger")}},Ie=async a=>{if(confirm(`X\xF3a video "${a.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${a.id}`,"L\u1ED7i x\xF3a video"),u("\u0110\xE3 x\xF3a video","success"),z(),P&&ne(P.id)}catch(i){u("L\u1ED7i x\xF3a video","danger")}},ze=a=>{const i=`https://www.youtube.com/watch?v=${a.youtubeId}`;window.KTM.clipboard.writeText(i).then(()=>{u("\u0110\xE3 copy link!","success")}).catch(()=>{u("Kh\xF4ng th\u1EC3 copy link","danger")})};return P?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>b(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${P.slug==="shorts"?"text-danger":"text-warning"}`}),P.name)),React.createElement("button",{className:"btn btn-warning",onClick:xe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),A.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},A.map((a,i)=>React.createElement("div",{key:a.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>pe(i),disabled:i===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},i+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>oe(i),disabled:i===A.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:a.thumb,className:"card-img-top",alt:a.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${a.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:a.title},a.title),React.createElement("small",{className:"text-muted"},a.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>ze(a),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Ke(a),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Ie(a),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Q,video:K,onClose:()=>Z(!1),onSave:Ce})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},X&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ce()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),X?X.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:re},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),B.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:a=>{a.preventDefault(),ce("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),B.map((a,i)=>React.createElement("li",{key:a.id,className:`breadcrumb-item ${i===B.length-1?"active":""}`},i===B.length-1?a.name:React.createElement("a",{href:"#",onClick:I=>{I.preventDefault(),ce(a)},className:"text-warning"},a.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),v?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):M.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},X?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:re},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",X?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},M.map((a,i)=>{var I,ge,$e,Le;return React.createElement("div",{key:a.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ie=>{ie.stopPropagation(),C(i)},disabled:i===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},i+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ie=>{ie.stopPropagation(),be(i)},disabled:i===M.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>ye(a),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${a.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},a.name),React.createElement("p",{className:"text-muted mb-0"},a.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),a.subfolderCount," folder"),a.subfolderCount>0&&(a.videoCount>0||((I=a.videos)==null?void 0:I.length)>0)&&" \u2022 ",(a.videoCount>0||((ge=a.videos)==null?void 0:ge.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),a.videoCount||(($e=a.videos)==null?void 0:$e.length)||0," videos"),a.subfolderCount===0&&!a.videoCount&&!((Le=a.videos)!=null&&Le.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ie=>{ie.stopPropagation(),ue(a)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ie=>{ie.stopPropagation(),fe(a)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:W,folder:O,onClose:()=>J(!1),onSave:te}))}function VideoFolderModal({show:N,folder:u,onClose:M,onSave:L}){const[A,r]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[v,w]=useState(!1),[P,b]=useState(!1);useEffect(()=>{r(u?{name:u.name||"",description:u.description||"",sortOrder:u.sortOrder||0,coverImage:u.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[u,N]);const W=async O=>{const R=O.target.files[0];if(R){b(!0);try{const Q=await window.KTM.cloudinary.uploadImage({file:R,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Q.secure_url&&r(Z=>({...Z,coverImage:Q.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Q){console.error("Cloudinary upload error:",Q),alert("L\u1ED7i upload \u1EA3nh: "+(Q.message||Q))}finally{b(!1)}}},J=async O=>{O.preventDefault(),w(!0),await L(A),w(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},u?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:M})),React.createElement("form",{onSubmit:J},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:A.name,onChange:O=>r({...A,name:O.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:A.description,onChange:O=>r({...A,description:O.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:A.sortOrder,onChange:O=>r({...A,sortOrder:parseInt(O.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},A.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:A.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>r({...A,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:W,disabled:P}),P&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:A.coverImage,onChange:O=>r({...A,coverImage:O.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:M},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:N}){const[u,M]=useState([]),[L,A]=useState(!0),[r,v]=useState(!1),[w,P]=useState(null),[b,W]=useState(""),[J,O]=useState(""),R=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Q()},[]);const Q=async()=>{A(!0);try{const f=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");M(Array.isArray(f)?f:[])}catch(f){console.error(f),N("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}A(!1)},Z=()=>{P(null),v(!0)},K=f=>{P(f),v(!0)},ee=async f=>{if(!(!f||!f.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:f},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),N(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Q()}catch(z){N("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},X=async f=>{try{const z=w?`${API_BASE}/api/products?id=${w.id}`:`${API_BASE}/api/products`;w?await window.KTM.api.putJSON(z,f,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(z,f,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(w?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),v(!1),Q()}catch(z){N(z.message,"danger")}},c=async f=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${f.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${f.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),N("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Q()}catch(z){N(z.message,"danger")}},B=u.filter(f=>{const z=!b||f.name.toLowerCase().includes(b.toLowerCase())||f.code&&f.code.toLowerCase().includes(b.toLowerCase()),ne=!J||f.category===J;return z&&ne});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Z},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:b,onChange:f=>W(f.target.value)})),React.createElement("span",{className:"product-count"},B.length)),React.createElement("select",{className:"form-select",value:J,onChange:f=>O(f.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),R.map(f=>React.createElement("option",{key:f,value:f},f)))),L?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):B.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Z},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},B.map(f=>React.createElement("div",{key:f.id,className:"product-item d-flex align-items-center gap-3"},f.image?React.createElement("img",{src:f.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},f.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},f.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},f.category),f.code&&React.createElement("span",{className:"product-badge bg-secondary"},f.code)),React.createElement("div",{className:"product-price"},f.price?f.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),f.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},f.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>K(f),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>c(f),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:r,product:w,categories:R,onClose:()=>v(!1),onSave:X}))}function ProductModal({show:N,product:u,categories:M,onClose:L,onSave:A}){const[r,v]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[w,P]=useState(!1),[b,W]=useState(!1);useEffect(()=>{v(u?{name:u.name||"",code:u.code||"",price:u.price||"",image:u.image||"",category:u.category||"",note:u.note||"",sort_order:u.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[u,N]);const[J,O]=React.useState(""),R=C=>window.KTM.money.formatVNDInputDigits(C),[Q,Z]=React.useState(""),K=C=>{const be=window.KTM.money.nextPriceInputState(C.target.value,Q);Z(be.digits),v({...r,price:be.price})},[ee,X]=React.useState("");React.useEffect(()=>{u!=null&&u.image&&X(u.image)},[u]);const c=async C=>{if(!(!C||!C.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:C},"L\u1ED7i x\xF3a \u1EA3nh")}catch(be){console.error("Delete cloudinary image error:",be)}},B=async(C,be=2,G)=>{const pe=be*1024*1024,oe=C.type==="image/heic"||C.type==="image/heif"||/\.heic$/i.test(C.name);if(C.size<=pe&&!oe)return C;G==null||G("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const me=await createImageBitmap(C);G==null||G("\u0110ang n\xE9n \u1EA3nh...");const re=document.createElement("canvas");let ue=me.width,te=me.height;const fe=1200;return(ue>fe||te>fe)&&(ue>te?(te=Math.round(te/ue*fe),ue=fe):(ue=Math.round(ue/te*fe),te=fe)),re.width=ue,re.height=te,re.getContext("2d").drawImage(me,0,0,ue,te),me.close(),new Promise((ce,xe)=>{re.toBlob(Ke=>{Ke?(G==null||G("Ho\xE0n t\u1EA5t!"),ce(new File([Ke],C.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):xe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(me){throw console.error("createImageBitmap error:",me),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},f=async C=>{var pe,oe;const be=(pe=C.target.files)==null?void 0:pe[0];if(!be)return;if(!(be.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(be.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}W(!0),O("\u0110ang chu\u1EA9n b\u1ECB...");try{const me=(be.size/1024/1024).toFixed(1);O(`File ${me}MB - \u0110ang n\xE9n...`);const re=await B(be,2,fe=>{O(fe)}),ue=(re.size/1024/1024).toFixed(1);O(`\u0110\xE3 n\xE9n: ${ue}MB - \u0110ang upload...`);const te=await window.KTM.cloudinary.uploadImage({file:re,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});te.secure_url?(r.image&&r.image!==ee&&c(r.image),v(fe=>({...fe,image:te.secure_url})),O("")):(console.error("Cloudinary error:",te),alert("Upload th\u1EA5t b\u1EA1i: "+(((oe=te.error)==null?void 0:oe.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),O(""))}catch(me){console.error("Upload error:",me),alert("L\u1ED7i: "+me.message),O("")}W(!1),C.target.value=""},z=()=>{r.image&&(r.image!==ee&&c(r.image),v(C=>({...C,image:""})))},ne=async C=>{C.preventDefault(),P(!0),ee&&r.image&&ee!==r.image&&await c(ee),ee&&!r.image&&await c(ee),await A(r),P(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${u?"fa-edit":"fa-plus-circle"} me-2`}),u?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:ne},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},r.image?React.createElement(React.Fragment,null,React.createElement("img",{src:r.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:z,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${b?"fa-spinner fa-spin":"fa-camera"} me-1`}),b?J||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:f,disabled:b,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),b&&J&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},J))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:r.name,onChange:C=>v({...r,name:C.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:r.code,onChange:C=>v({...r,code:C.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:r.price,onChange:K,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:r.category,onChange:C=>v({...r,category:C.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),M.map(C=>React.createElement("option",{key:C,value:C},C)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:r.note,onChange:C=>v({...r,note:C.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:r.image,onChange:C=>v({...r,image:C.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:L,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:w,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:N,video:u,onClose:M,onSave:L}){const[A,r]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[v,w]=useState(!1),[P,b]=useState("");useEffect(()=>{u?(r({title:u.title||"",youtube_url:`https://www.youtube.com/watch?v=${u.youtubeId}`,thumbnail_url:u.thumb||"",sort_order:u.sortOrder||0}),b(u.thumb)):(r({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),b(""))},[u,N]);const W=R=>{const Q=R.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Q?Q[1]:null},J=R=>{r({...A,youtube_url:R});const Q=W(R);Q&&b(`https://img.youtube.com/vi/${Q}/hqdefault.jpg`)},O=async R=>{R.preventDefault(),w(!0),await L(A),w(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},u?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:M})),React.createElement("form",{onSubmit:O},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:A.youtube_url,onChange:R=>J(R.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),P&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:P,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:A.title,onChange:R=>r({...A,title:R.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:A.sort_order,onChange:R=>r({...A,sort_order:parseInt(R.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:A.thumbnail_url,onChange:R=>r({...A,thumbnail_url:R.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:M},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[N,u]=useState(!1),[M,L]=useState(""),[A,r]=useState(null),[v,w]=useState("search"),[P,b]=useState(null),[W,J]=useState(""),[O,R]=useState([]),[Q,Z]=useState(null),[K,ee]=useState(!1),[X,c]=useState(null),[B,f]=useState(!0),[z,ne]=useState([]),[C,be]=useState(null),[G,pe]=useState([]);useEffect(()=>{const a=localStorage.getItem("ktm_admin_session");if(a)try{const i=JSON.parse(a);i.expiry>Date.now()?(u(!0),r(i.user)):localStorage.removeItem("ktm_admin_session")}catch(i){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{N&&te()},[N]);const oe=async(a,i)=>{L("");try{const I=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:a,password:i},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),ge={user:I.user,token:I.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(ge)),r(I.user),u(!0)}catch(I){L(I.message)}},me=()=>{localStorage.removeItem("ktm_admin_session"),u(!1),r(null),R([]),Z(null)},re=(a,i="success")=>{const I=Date.now();ne(ge=>[...ge,{id:I,message:a,type:i}])},ue=a=>{ne(i=>i.filter(I=>I.id!==a))},te=async(a=null)=>{f(!0);try{const i=a?`${API_BASE}/api/albums?parent_id=${a}`:`${API_BASE}/api/albums?parent_id=root`,I=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i danh s\xE1ch album");R(Array.isArray(I)?I:[])}catch(i){console.error(i),re("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}f(!1)},fe=()=>{c(null),ee(!0)},ye=a=>{c(a),ee(!0)},ce=async a=>{try{const i=X&&X.uuid;!i&&C&&(a.parent_id=C.uuid);const I=i?`${API_BASE}/api/albums/${X.uuid||X.id}`:`${API_BASE}/api/albums`;i?await window.KTM.api.putJSON(I,a,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(I,a,"L\u1ED7i t\u1EA1o"),re(i?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),ee(!1),te(C==null?void 0:C.uuid)}catch(i){re(i.message,"danger")}},xe=a=>{Z(a)},Ke=a=>{if(a==="root")pe([]),be(null),te(null);else if(a){const i=G.findIndex(I=>I.uuid===a.uuid);i>=0&&(pe(G.slice(0,i+1)),be(a),te(a.uuid))}else{const i=[...G];i.pop();const I=i[i.length-1]||null;pe(i),be(I),te(I==null?void 0:I.uuid)}},Ce=async a=>{const i=`X\xF3a folder "${a.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(i))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${a.uuid||a.id}`,"L\u1ED7i x\xF3a album"),re("\u0110\xE3 x\xF3a","success"),te(C==null?void 0:C.uuid)}catch(I){re("L\u1ED7i x\xF3a album","danger")}};if(!N)return React.createElement(LoginPage,{onLogin:oe,error:M});const Ie=()=>{const a=new Date,i=a.getFullYear(),I=String(a.getMonth()+1).padStart(2,"0");return`${i}-${I}`};function ze(){const[a,i]=useState(Ie()),[I,ge]=useState(!0),[$e,Le]=useState([]),{parseMoney:ie,parseShipFeeFromNote:Be,getShipFeeForItems:Re,formatNumber:k,formatVND:Ne}=window.KTM.money,Fe=async()=>{ge(!0);try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(a)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA");Le(Array.isArray(x)?x:[])}catch(x){console.error("Load stats error:",x),Le([])}finally{ge(!1)}};useEffect(()=>{Fe()},[a]);const se=React.useMemo(()=>{var Je;const x={pending:0,processing:0,done:0,paid:0,other:0};let Ge=0,qe=0,We=0,et=0,De=0;const Te=F=>F.customer_id||F.phone||"unknown",He=F=>window.KTM.orders.getOrderItems(F),l=new Map,S=new Map,ae=new Map;for(const F of $e){const t=He(F);let h=0,g=0;for(const j of t){const de=Number((j==null?void 0:j.quantity)||0)||0,we=ie(j==null?void 0:j.product_price),le=de*we;h+=de,g+=le;const Ve=(j==null?void 0:j.product_id)||"unknown",_e=l.get(Ve)||{product_id:Ve,product_name:(j==null?void 0:j.product_name)||"\u2014",product_code:(j==null?void 0:j.product_code)||"",orders:0,quantity:0,revenue:0};_e.orders+=1,_e.quantity+=de,_e.revenue+=le,l.set(Ve,_e)}const _=Re(t),$=Number((Je=F==null?void 0:F.adjustment_amount)!=null?Je:0)||0,p=g+(_.found?_.fee:0)+$,m=g+$;Ge+=h,qe+=p,et+=m;const T=F.status==="done"||F.status==="paid";F.status==="pending"?x.pending+=1:F.status==="processing"?x.processing+=1:F.status==="paid"?(x.paid+=1,x.done+=1,We+=p,De+=m):F.status==="done"?(x.done+=1,We+=p,De+=m):x.other+=1;const V=Te(F),q=S.get(V)||{key:V,customer_name:F.customer_name||"",phone:F.phone||"",orders:0,quantity:0,revenue:0};q.orders+=1,q.quantity+=h,q.revenue+=p,!q.customer_name&&F.customer_name&&(q.customer_name=F.customer_name),!q.phone&&F.phone&&(q.phone=F.phone),S.set(V,q);const H=F.created_at?new Date(F.created_at):null;if(H&&!Number.isNaN(H.getTime())){const j=`${H.getFullYear()}-${String(H.getMonth()+1).padStart(2,"0")}-${String(H.getDate()).padStart(2,"0")}`,de=ae.get(j)||{day:j,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};de.orders+=1,de.quantity+=h,de.revenue+=p,T&&(de.doneOrders+=1,de.doneRevenue+=p),ae.set(j,de)}}const ke=Array.from(l.values()).sort((F,t)=>t.revenue-F.revenue),Se=Array.from(S.values()).sort((F,t)=>t.revenue-F.revenue),Me=Array.from(ae.values()).sort((F,t)=>F.day.localeCompare(t.day)),Oe=S.size,Ee=$e.length?Math.round(qe/$e.length):0,Pe=$e.length?Ge/$e.length:0,Qe=Math.round(De*.05),Ye=Math.round(et*.05);return{statusCounts:x,totalQty:Ge,totalRevenue:qe,doneRevenue:We,tempCommission:Qe,tempCommissionAll:Ye,products:ke,customers:Se,days:Me,uniqueCustomers:Oe,avgOrderValue:Ee,avgQtyPerOrder:Pe}},[$e,a]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:I}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:Fe,disabled:I},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:a,onChange:x=>i(x.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),k($e.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),k(se.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),k(se.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",k(se.statusCounts.paid),"/",k(se.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},k($e.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ne(se.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ne(se.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ne(se.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ne(se.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",se.avgQtyPerOrder?se.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},k(se.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},k(se.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},k(se.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},k(se.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},k(se.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,k(se.statusCounts.pending)),React.createElement("td",null,k(se.statusCounts.processing)),React.createElement("td",null,k(se.statusCounts.done)),React.createElement("td",null,k(se.statusCounts.paid)),React.createElement("td",null,k(se.statusCounts.other)),React.createElement("td",null,k(se.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},se.products.slice(0,10).map(x=>React.createElement("div",{key:x.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},x.product_name),React.createElement("div",{className:"text-muted small text-truncate"},x.product_code?`#${x.product_code} \u2022 `:"",k(x.orders)," \u0111\u01A1n \u2022 ",k(x.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ne(x.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,se.products.slice(0,10).map(x=>React.createElement("tr",{key:x.product_id},React.createElement("td",null,x.product_name),React.createElement("td",null,x.product_code||"\u2014"),React.createElement("td",null,k(x.orders)),React.createElement("td",null,k(x.quantity)),React.createElement("td",{className:"fw-semibold"},Ne(x.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},se.customers.slice(0,10).map(x=>React.createElement("div",{key:x.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},x.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},x.phone||"\u2014"," \u2022 ",k(x.orders)," \u0111\u01A1n \u2022 ",k(x.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ne(x.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,se.customers.slice(0,10).map(x=>React.createElement("tr",{key:x.key},React.createElement("td",null,x.customer_name||"\u2014"),React.createElement("td",null,x.phone||"\u2014"),React.createElement("td",null,k(x.orders)),React.createElement("td",null,k(x.quantity)),React.createElement("td",{className:"fw-semibold"},Ne(x.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},se.days.map(x=>React.createElement("div",{key:x.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},x.day),React.createElement("div",{className:"text-muted small"},k(x.orders)," \u0111\u01A1n \u2022 ",k(x.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",k(x.doneOrders)," \u2022 ",Ne(x.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Ne(x.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,se.days.map(x=>React.createElement("tr",{key:x.day},React.createElement("td",null,x.day),React.createElement("td",null,k(x.orders)),React.createElement("td",null,k(x.quantity)),React.createElement("td",{className:"fw-semibold"},Ne(x.revenue)),React.createElement("td",null,k(x.doneOrders)),React.createElement("td",{className:"fw-semibold"},Ne(x.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:v,onMenuChange:a=>{w(a),a==="albums"&&(be(null),pe([]),te(null))},onLogout:me,currentUser:A}),React.createElement("div",{className:"main-content"},v==="albums"&&!Q&&React.createElement(AlbumList,{albums:O,loading:B,currentFolder:C,breadcrumb:G,onSelect:xe,onCreate:fe,onEdit:ye,onDelete:Ce,onBack:Ke}),v==="search"&&React.createElement(SearchCenter,{showToast:re,onNavigate:(a,i,I)=>{w(a),a==="orders"&&i==="create"&&(b(Date.now()),J((I==null?void 0:I.productId)||""))}}),v==="albums"&&Q&&React.createElement(AlbumDetail,{album:Q,parentAlbum:G.length>0?G[G.length-1]:null,onBack:()=>{if(Q.parentId){const a=G.findIndex(i=>i.uuid===Q.parentId);a>=0?Z(G[a]):Z(null)}else Z(null)},onRefresh:()=>te(C==null?void 0:C.uuid),showToast:re,onNavigateToFolder:a=>{pe(i=>[...i,Q]),Z(a)},onEditSubfolder:a=>{c(a),ee(!0)}}),v==="videos"&&React.createElement(VideoList,{showToast:re}),v==="products"&&React.createElement(ProductManager,{showToast:re}),v==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:P,autoOpenCreateProductId:W,showToast:re}),v==="stats"&&React.createElement(ze,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${v==="search"?"active":""}`,onClick:a=>{a.preventDefault(),w("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${v==="albums"?"active":""}`,onClick:a=>{a.preventDefault(),w("albums"),Z(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${v==="videos"?"active":""}`,onClick:a=>{a.preventDefault(),w("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${v==="products"?"active":""}`,onClick:a=>{a.preventDefault(),w("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${v==="orders"?"active":""}`,onClick:a=>{a.preventDefault(),w("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${v==="stats"?"active":""}`,onClick:a=>{a.preventDefault(),w("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:K,album:X,parentId:C==null?void 0:C.uuid,onClose:()=>ee(!1),onSave:ce}),React.createElement("div",{className:"toast-container"},z.map(a=>React.createElement(Toast,{key:a.id,message:a.message,type:a.type,onClose:()=>ue(a.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:N,autoOpenCreateProductId:u,showToast:M}){const[L,A]=useState([]),[r,v]=useState(!0),[w,P]=useState(!1),[b,W]=useState(null),[J,O]=useState(""),[R,Q]=useState(!1),[Z,K]=useState(null),[ee,X]=useState(!1),[c,B]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[f,z]=useState([""]),[ne,C]=useState(null),be=useRef({}),[G,pe]=useState([]),[oe,me]=useState(null),re=useRef(null),ue=useRef(null),te=useRef(0),fe=useRef(new Map),ye=useRef(""),ce=useRef(null),xe=useRef(0),Ke=useRef(null),Ce=9,Ie=150,ze=24*60*60*1e3,a=5*60*1e3,i="ktm_customer_lookup_cache_v1",I=200,ge=e=>{B({customer_name:"",phone:"",address:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),z([""]),K(null),C(null)};useEffect(()=>{const e=o=>{var s;if(ne==null)return;const n=(s=be.current)==null?void 0:s[ne];n&&!n.contains(o.target)&&C(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ne]);const $e=e=>window.KTM.money.parseMoney(e),Le=e=>window.KTM.money.parseSignedMoney(e),ie=e=>window.KTM.money.formatVND(e),Be=e=>window.KTM.money.parseShipFeeFromNote(e),Re=e=>window.KTM.phone.isValid(e),k=e=>window.KTM.phone.normalize(e),Ne=()=>{var e;try{const o=localStorage.getItem(i);if(!o)return;const n=JSON.parse(o);if(!n||typeof n!="object")return;const s=Object.entries(n);for(const[d,E]of s)!d||!E||typeof E!="object"||(e=fe.current)==null||e.set(String(d),E)}catch(o){}},Fe=()=>{try{const e=fe.current;if(!e||typeof e.entries!="function")return;const o=Array.from(e.entries()).filter(([s,d])=>s&&d&&typeof d=="object"&&Number.isFinite(d.ts)).sort((s,d)=>(Number(d[1].ts)||0)-(Number(s[1].ts)||0)).slice(0,I),n={};for(const[s,d]of o)n[s]=d;localStorage.setItem(i,JSON.stringify(n))}catch(e){}};useEffect(()=>{Ne()},[]);const se=e=>{const o=k(e);if(!o)return null;const n=Array.isArray(L)?L:[];let s=null,d=-1;for(const E of n){if(!E||k(E.phone||"")!==o)continue;const Y=new Date(E.created_at).getTime(),D=Number.isFinite(Y)?Y:0;D>=d&&(d=D,s=E)}return s?{name:String(s.customer_name||"").trim(),address:String(s.address||"").trim()}:null},x=(e,o)=>{e&&B(n=>o&&k(n.phone)!==o?n:{...n,customer_name:e.name||n.customer_name,address:e.address||n.address})},Ge=e=>{const o=se(e);if(!o)return;const n=k(e);B(s=>{if(n&&k(s.phone)!==n)return s;const d={...s};return!String(s.customer_name||"").trim()&&o.name&&(d.customer_name=o.name),!String(s.address||"").trim()&&o.address&&(d.address=o.address),d})},qe=async e=>{var d,E,Y;const o=k(e);if(!o)return;Ge(o);const n=(d=fe.current)==null?void 0:d.get(o);if(n&&Number.isFinite(n.ts)){const D=Date.now()-n.ts,y=n.status==="found"?ze:a;if(D>=0&&D<=y){K({status:n.status,phone:o,customer:n.customer}),n.status==="found"&&n.customer&&x(n.customer,o);return}}const s=++te.current;K({status:"loading",phone:o});try{const D=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(o)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(te.current!==s)return;if(D&&D.exists&&D.customer){(E=fe.current)==null||E.set(o,{ts:Date.now(),status:"found",customer:D.customer}),Fe(),K({status:"found",phone:o,customer:D.customer}),x(D.customer,o);return}(Y=fe.current)==null||Y.set(o,{ts:Date.now(),status:"not-found",customer:null}),Fe(),K({status:"not-found",phone:o})}catch(D){if(te.current!==s)return;console.error("Customer lookup error:",D),K({status:"error",phone:o})}},We=e=>{const o=k(e),n=se(o);B(d=>{const E={...d,phone:o};return n&&(!String(d.customer_name||"").trim()&&n.name&&(E.customer_name=n.name),!String(d.address||"").trim()&&n.address&&(E.address=n.address)),E}),X(!1),ue.current&&(clearTimeout(ue.current),ue.current=null);const s=o;if(s.length<Ce){K(null);return}if(Re(s)&&s!==ye.current){ye.current=s,qe(s);return}ue.current=setTimeout(()=>{const d=k(o);Re(d)&&d!==ye.current&&(ye.current=d,qe(d))},Ie)},et=()=>{const e=k(c.phone);e.length<Ce||Re(e)&&e!==ye.current&&(ye.current=e,qe(e))};useEffect(()=>(R?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[R]);const De=Array.isArray(c.items)?c.items.length:0;useEffect(()=>{if(!R){xe.current=De;return}De>xe.current&&setTimeout(()=>{const e=ce.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),xe.current=De},[R,De]),useEffect(()=>()=>{ue.current&&(clearTimeout(ue.current),ue.current=null)},[]),useEffect(()=>{ae()},[]),useEffect(()=>{ke()},[J]),useEffect(()=>{N&&re.current!==N&&(re.current=N,Me(u))},[N]);const Te=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e||"",He=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":"bg-light text-dark",l=React.useMemo(()=>window.KTM.orders.sortOrders(L),[L]),S=e=>window.KTM.date.formatDateTime(e),ae=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");pe(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),pe([])}},ke=async()=>{v(!0);try{let e=`${API_BASE}/api/orders`;J&&(e+=`?month=${J}`);const o=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");A(Array.isArray(o)?o:[])}catch(e){console.error("Load orders error:",e),A([])}finally{v(!1)}},Se=e=>{var n;me(e.id);const o=Array.isArray(e.items)&&e.items.length?e.items.map(s=>{var d;return{product_id:(s==null?void 0:s.product_id)||"",quantity:Number((d=s==null?void 0:s.quantity)!=null?d:1)||1}}).filter(s=>s.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];B({customer_name:e.customer_name||"",phone:k(e.phone||""),address:e.address||"",items:o.length?o:[{product_id:"",quantity:1}],adjustment_amount:Number((n=e==null?void 0:e.adjustment_amount)!=null?n:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),z(new Array(o.length?o.length:1).fill("")),K(null),Q(!0),e.phone&&qe(k(e.phone))};function Me(e){me(null),ge(e||""),X(!1),Q(!0)}const Oe=()=>{w||(Q(!1),me(null),ge(""),X(!1))},Ee=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const o=String(e),n=G.find(s=>String(s==null?void 0:s.id)===o);return n?`${n.name}${n.code?` (${n.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Pe=e=>{const o=String(f[e]||"").trim().toLowerCase();return o?G.filter(n=>{const s=String((n==null?void 0:n.name)||"").toLowerCase(),d=String((n==null?void 0:n.code)||"").toLowerCase();return s.includes(o)||d.includes(o)}):G},Qe=e=>{if(!e)return null;const o=String(e);return G.find(n=>String(n==null?void 0:n.id)===o)||null},Ye=e=>window.KTM.orders.getOrderItems(e),Je=e=>window.KTM.orders.getOrderTotalQty(e),F=e=>window.KTM.orders.getOrderProductSummary(e,Qe),t=e=>window.KTM.orders.getOrderItemRows(e,Qe),h=e=>window.KTM.orders.getOrderAdjustmentMoney(e),g=e=>{var U;const o=Ye(e),n=t(e),s=p(o),d=$(o),E=d.fee,Y=h(e),D=s+E+Y,y=[];if(y.push(`\u0110\u01A0N H\xC0NG #${(U=e==null?void 0:e.id)!=null?U:""}`.trim()),e!=null&&e.customer_name&&y.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&y.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&y.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),e!=null&&e.status&&y.push(`Tr\u1EA1ng th\xE1i: ${Te(e.status)}`),e!=null&&e.created_at&&y.push(`Th\u1EDDi gian: ${S(e.created_at)}`),y.push(""),y.push("S\u1EA3n ph\u1EA9m:"),n.length)for(const he of n)y.push(`- ${he.name} x${he.qty}`);else{const he=F(e);he&&he!=="\u2014"&&y.push(`- ${he}`)}return y.push(""),y.push(`T\u1EA1m t\xEDnh: ${ie(s)}`),y.push(`Ship: ${ie(d.found?E:0)}`),Y!==0&&y.push(`\u0110i\u1EC1u ch\u1EC9nh: ${ie(Y)}`),e!=null&&e.adjustment_note&&y.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),y.push(`T\u1ED5ng: ${ie(D)}`),y.filter(Boolean).join(`
`)},_=async e=>{try{const o=g(e);await window.KTM.clipboard.writeText(o),typeof M=="function"?M("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(o){console.error(o),typeof M=="function"?M("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},$=e=>window.KTM.orders.getOrderShipInfo(e,Qe),p=e=>window.KTM.orders.getItemsSubtotal(e,Qe),m=e=>{try{const o=e instanceof Date?e:new Date(e);if(!o||Number.isNaN(o.getTime()))return"";const n=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0");return`${n}-${s}`}catch(o){return""}},T=()=>J?String(J):m(new Date),V=e=>{const o=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),n=k((e==null?void 0:e.phone)||""),s=String((e==null?void 0:e.address)||"").trim().toLowerCase(),d=Le(e==null?void 0:e.adjustment_amount),Y=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(D=>{var y;return{product_id:String((D==null?void 0:D.product_id)||"").trim(),quantity:Number((y=D==null?void 0:D.quantity)!=null?y:0)}}).filter(D=>D.product_id&&Number.isFinite(D.quantity)&&D.quantity>0).sort((D,y)=>D.product_id<y.product_id?-1:D.product_id>y.product_id?1:D.quantity-y.quantity);return JSON.stringify({name:o,phone:n,address:s,items:Y,adj:d})},q=React.useMemo(()=>{const e=k((c==null?void 0:c.phone)||"");if(!e)return{count:0,orders:[],monthKey:T()};const o=T(),n=(Array.isArray(L)?L:[]).filter(s=>{if(!s||oe&&String(s.id)===String(oe)||k(s.phone||"")!==e)return!1;const d=m(s.created_at);return d&&d===o}).sort((s,d)=>{const E=new Date(s.created_at).getTime(),Y=new Date(d.created_at).getTime();return(Number.isFinite(Y)?Y:0)-(Number.isFinite(E)?E:0)});return{count:n.length,orders:n,monthKey:o}},[L,c==null?void 0:c.phone,J,oe]),H=e=>{var D;const o=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),n=k((e==null?void 0:e.phone)||""),s=String((e==null?void 0:e.address)||"").trim().toLowerCase(),d=Le((D=e==null?void 0:e.adjustment_amount)!=null?D:0),E=Ye(e),Y=(Array.isArray(E)?E:[]).map(y=>{var U;return{product_id:String((y==null?void 0:y.product_id)||"").trim(),quantity:Number((U=y==null?void 0:y.quantity)!=null?U:0)}}).filter(y=>y.product_id&&Number.isFinite(y.quantity)&&y.quantity>0).sort((y,U)=>y.product_id<U.product_id?-1:y.product_id>U.product_id?1:y.quantity-U.quantity);return JSON.stringify({name:o,phone:n,address:s,items:Y,adj:d})},j=React.useMemo(()=>{if(oe)return"";const e=k((c==null?void 0:c.phone)||"");if(!e)return"";const o=T(),n=V(c),s=Array.isArray(L)?L:[];for(const d of s){if(!d||oe&&String(d.id)===String(oe)||k(d.phone||"")!==e)continue;const E=m(d.created_at);if(!E||E!==o)continue;const Y=H(d);if(Y&&Y===n)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${o}${d!=null&&d.id?` (#${d.id})`:""}`}return""},[L,c,J,oe]),de=e=>{var it;const o=[],n=[],s=String((e==null?void 0:e.customer_name)||"").trim(),d=k((e==null?void 0:e.phone)||""),E=String((e==null?void 0:e.address)||"").trim();s||o.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),d||o.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),d&&!Re(d)&&o.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),E||n.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const D=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Xe=>Xe&&Xe.product_id);D.length===0&&o.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),D.some(Xe=>{var ot;const tt=Number((ot=Xe==null?void 0:Xe.quantity)!=null?ot:0);return!Number.isFinite(tt)||tt<=0})&&o.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const U=new Set;let he=!1;for(const Xe of D){const tt=String(Xe.product_id||"").trim();if(tt){if(U.has(tt)){he=!0;break}U.add(tt)}}he&&n.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const Ae=p(D),ve=$(D),at=ve!=null&&ve.found?Number((it=ve==null?void 0:ve.fee)!=null?it:0):0,Ze=Le(e==null?void 0:e.adjustment_amount),lt=String((e==null?void 0:e.adjustment_note)||"").trim();ve!=null&&ve.found&&(at>=2e5||Ae>0&&at>Ae*.6)&&n.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ie(at)}`),Ze!==0&&!lt&&n.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const nt=Math.abs(Ze);return(nt>=5e5||Ae>0&&nt>Ae*.5)&&Ze!==0&&n.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ie(Ze)}`),{errors:o,warnings:n,canSubmit:o.length===0}},we=React.useMemo(()=>de(c),[c,G]),le=React.useMemo(()=>{var ot;const e=String((c==null?void 0:c.customer_name)||"").trim(),o=k((c==null?void 0:c.phone)||""),n=String((c==null?void 0:c.address)||"").trim(),s=Array.isArray(c==null?void 0:c.items)?c.items:[],d=new Map;for(const je of s){const st=String((je==null?void 0:je.product_id)||"").trim();st&&d.set(st,(d.get(st)||0)+1)}const E=s.map(je=>{var ct;const st=String((je==null?void 0:je.product_id)||"").trim(),rt=Number((ct=je==null?void 0:je.quantity)!=null?ct:0),dt=st?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",mt=Number.isFinite(rt)&&rt>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",ut=st&&(d.get(st)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:dt,qtyError:mt,dupWarn:ut}}),Y=s.filter(je=>je&&je.product_id),D=p(Y),y=$(Y),U=y!=null&&y.found?Number((ot=y==null?void 0:y.fee)!=null?ot:0):0,he=Le(c==null?void 0:c.adjustment_amount),Ae=String((c==null?void 0:c.adjustment_note)||"").trim(),ve=Math.abs(he),at=he!==0&&!Ae?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Ze=he!==0&&(ve>=5e5||D>0&&ve>D*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ie(he)}`:"",lt=y!=null&&y.found&&(U>=2e5||D>0&&U>D*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ie(U)}`:"",nt=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",it=o?Re(o)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Xe=n?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",tt=!nt&&!it&&E.every(je=>!je.productError&&!je.qtyError);return{nameError:nt,phoneError:it,addressWarn:Xe,items:E,shipAbnormalWarn:lt,adjustmentNoteWarn:at,adjustmentAbnormalWarn:Ze,canSubmit:tt}},[c,G]),Ve=async e=>{var Y,D,y;const o=(e==null?void 0:e.mode)||"close",n=de(c);if(!n.canSubmit){const U=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof M=="function"?M(U,"danger"):alert(U);return}if(!oe&&j){const U=`${j}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(U)){(q==null?void 0:q.count)>0&&X(!0),setTimeout(()=>{var ve;const Ae=document.getElementById("order-phone-input");Ae&&typeof Ae.scrollIntoView=="function"&&(Ae.scrollIntoView({block:"center",behavior:"smooth"}),(ve=Ae.focus)==null||ve.call(Ae))},0);return}}const s=k(c.phone),E=(Array.isArray(c.items)?c.items:[]).map(U=>{var he;return{product_id:(U==null?void 0:U.product_id)||"",quantity:Number((he=U==null?void 0:U.quantity)!=null?he:1)}}).filter(U=>U.product_id&&Number.isFinite(U.quantity)&&U.quantity>0);P(!0);try{const U=oe?`${API_BASE}/api/orders/${oe}`:`${API_BASE}/api/orders`,he=E[0],Ae={customer_name:c.customer_name,phone:s,address:c.address,adjustment_amount:Le(c.adjustment_amount),adjustment_note:(c.adjustment_note||"").trim(),product_id:he.product_id,quantity:he.quantity,status:c.status,items:E,...oe?{id:oe}:{}};if(oe)await window.KTM.api.putJSON(U,Ae,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const ve=await window.KTM.api.postJSON(U,Ae,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Ke.current={id:(y=(D=ve==null?void 0:ve.id)!=null?D:(Y=ve==null?void 0:ve.order)==null?void 0:Y.id)!=null?y:null,fingerprint:V(c),ts:Date.now()}}o==="new"&&!oe?(ge(""),me(null),Q(!0)):(ge(""),me(null),Q(!1)),ke()}catch(U){console.error(U),typeof M=="function"?M(U.message,"danger"):alert(U.message);return}finally{P(!1)}},_e=e=>window.KTM.orders.getOrderTotalMoney(e,Qe),Ue=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){W(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),ke()}catch(o){console.error(o),typeof M=="function"?M(o.message,"danger"):alert(o.message)}finally{W(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:r&&!R||w||!!b}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Me,disabled:w||!!b},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:J,onChange:e=>O(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),J&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{O("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:r},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ke,disabled:r},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},L.length," \u0111\u01A1n")),r?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):L.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},l.map(e=>React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"text-muted small"},e.phone),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address)),React.createElement("span",{className:`badge ${He(e.status)}`},Te(e.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const o=t(e);return o.length?React.createElement("div",{className:"mt-1"},o.map((n,s)=>React.createElement("div",{key:s,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},n.name),React.createElement("div",{className:"text-muted",style:{flexShrink:0}},"x",n.qty)))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},F(e))})()),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},Je(e))),(h(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ie(h(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},ie(_e(e)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",S(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>Se(e),disabled:w||!!b},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>_(e),disabled:w||!!b},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>Ue(e.id),disabled:w||b===e.id},b===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,l.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,F(e)),React.createElement("td",null,Je(e)),React.createElement("td",{className:"fw-semibold"},ie(_e(e))),React.createElement("td",null,React.createElement("span",{className:`badge ${He(e.status)}`},Te(e.status))),React.createElement("td",null,S(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>Se(e),disabled:w||!!b},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>_(e),disabled:w||!!b},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>Ue(e.id),disabled:w||b===e.id},b===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),R&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),oe?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Oe})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ve({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:ce},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:c.customer_name,onChange:e=>B({...c,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!le.nameError&&React.createElement("div",{className:"form-text text-danger"},le.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:c.phone,onChange:e=>We(e.target.value),onBlur:et,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!le.phoneError&&React.createElement("div",{className:"form-text text-danger"},le.phoneError),!le.phoneError&&q.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",q.count," \u0111\u01A1n trong th\xE1ng ",q.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>X(e=>!e)},ee?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),ee&&q.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>X(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},q.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${He(e.status)}`},Te(e.status))),React.createElement("div",{className:"text-muted small"},S(e.created_at)," \u2022 ",ie(_e(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},F(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Se(e)}},"M\u1EDF")))),q.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(Z==null?void 0:Z.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(Z==null?void 0:Z.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(Z==null?void 0:Z.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(Z==null?void 0:Z.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:c.status,onChange:e=>B({...c,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:c.address,onChange:e=>B({...c,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!le.addressWarn&&React.createElement("div",{className:"form-text text-warning"},le.addressWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:c.adjustment_amount,onChange:e=>B({...c,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!le.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},le.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:c.adjustment_note,onChange:e=>B({...c,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!le.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},le.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{B(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),z(e=>[...Array.isArray(e)?e:[],""])},disabled:w},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(c.items)?c.items:[{product_id:"",quantity:1}]).map((e,o)=>React.createElement("div",{key:o,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:n=>{be.current[o]=n}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{C(n=>n===o?null:o),setTimeout(()=>{const n=document.getElementById(`order-product-search-${o}`);n&&n.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Ee(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ne===o&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${o}`,className:"form-control",value:f[o]||"",onChange:n=>{const s=n.target.value;z(d=>{const E=Array.isArray(d)?[...d]:[];return E[o]=s,E})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),Pe(o).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):Pe(o).map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const s=String(n.id);B(d=>{const E=Array.isArray(d.items)?[...d.items]:[];return E[o]={...E[o]||{quantity:1},product_id:s},{...d,items:E}}),C(null)}},n.name,n.code?` (${n.code})`:""))),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),G.map(n=>React.createElement("option",{key:n.id,value:n.id},n.name)))),(()=>{var s;const n=(s=le.items)==null?void 0:s[o];return n?React.createElement(React.Fragment,null,!!n.productError&&React.createElement("div",{className:"form-text text-danger"},n.productError),!!n.dupWarn&&React.createElement("div",{className:"form-text text-warning"},n.dupWarn)):null})()),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:n=>{const s=n.target.value;B(d=>{const E=Array.isArray(d.items)?[...d.items]:[];return E[o]={...E[o]||{product_id:""},quantity:s},{...d,items:E}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var s;const n=(s=le.items)==null?void 0:s[o];return n&&n.qtyError?React.createElement("div",{className:"form-text text-danger"},n.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{B(n=>{const s=Array.isArray(n.items)?[...n.items]:[];return s.splice(o,1),{...n,items:s.length?s:[{product_id:"",quantity:1}]}}),z(n=>{const s=Array.isArray(n)?[...n]:[];return s.splice(o,1),s.length?s:[""]}),C(n=>n==null?n:n===o?null:n>o?n-1:n)},disabled:w||(Array.isArray(c.items)?c.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const o=(Array.isArray(c.items)?c.items:[]).filter(Y=>Y==null?void 0:Y.product_id),n=p(o),s=$(o),d=Le(c.adjustment_amount),E=n+(s.found?s.fee:0)+d;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ie(n))),s.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ie(s.fee))),!!le.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},le.shipAbnormalWarn),d!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ie(d))),(c.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(c.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ie(E)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Oe,disabled:w,style:{borderRadius:10}},"H\u1EE7y"),!oe&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Ve({mode:"new"}),disabled:w||!le.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:w||!le.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

