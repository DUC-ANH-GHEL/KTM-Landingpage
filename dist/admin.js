const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:y,error:h}){const[$,D]=useState(""),[_,r]=useState(""),[N,x]=useState(!1),[K,b]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),h&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),h),React.createElement("form",{onSubmit:async F=>{F.preventDefault(),x(!0),await y($,_),x(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:$,onChange:F=>D(F.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:K?"text":"password",className:"form-control",value:_,onChange:F=>r(F.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>b(!K)},React.createElement("i",{className:`fas fa-eye${K?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:N},N?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:y,type:h,onClose:$}){return useEffect(()=>{const D=setTimeout($,3e3);return()=>clearTimeout(D)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${h} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},y),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:$})))}function Loading({show:y}){return y?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:y,onMenuChange:h,onLogout:$,currentUser:D}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(r=>React.createElement("a",{key:r.id,href:"#",className:`nav-link ${y===r.id?"active":""} ${r.disabled?"opacity-50":""} ${r.highlight?"text-warning":""}`,onClick:N=>{N.preventDefault(),r.disabled||h(r.id)}},React.createElement("i",{className:`fas ${r.icon}`})," ",r.label,r.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),r.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),$&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:$,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:y,onSelect:h,onCreate:$,onEdit:D,onDelete:_,loading:r,currentFolder:N,onBack:x,breadcrumb:K}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},N&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:x},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),N?N.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:$},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),K&&K.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),x("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),K.map((b,V)=>React.createElement("li",{key:b.id,className:`breadcrumb-item ${V===K.length-1?"active":""}`},V===K.length-1?b.title:React.createElement("a",{href:"#",onClick:F=>{F.preventDefault(),x(b)},className:"text-warning"},b.title))))),r?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):y.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},N?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},y.map(b=>React.createElement("div",{key:b.uuid||b.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>h(b)},b.cover?React.createElement("img",{src:b.cover,className:"album-cover",alt:b.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},b.title),React.createElement("small",{className:"text-muted"},b.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),b.subfolderCount),b.subfolderCount>0&&b.count>0&&" \u2022 ",b.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),b.count),b.subfolderCount===0&&b.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:V=>{V.stopPropagation(),D(b)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:V=>{V.stopPropagation(),_(b)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:y,album:h,onClose:$,onSave:D,parentId:_}){const[r,N]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[x,K]=useState(!1),[b,V]=useState(!1),F=useRef(null);useEffect(()=>{N(h?{slug:h.id||"",title:h.title||"",description:h.description||"",cover_url:h.cover||"",parent_id:h.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:_||null})},[h,y,_]);const M=async A=>{A.preventDefault(),K(!0),await D(r),K(!1)},I=A=>A.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),q=async A=>{const E=A.type==="image/heic"||A.type==="image/heif"||/\.heic$/i.test(A.name);if(A.size<=2097152&&!E)return A;try{const X=await createImageBitmap(A),W=document.createElement("canvas");let g=X.width,P=X.height;const G=800;return(g>G||P>G)&&(g>P?(P=Math.round(P/g*G),g=G):(g=Math.round(g/P*G),P=G)),W.width=g,W.height=P,W.getContext("2d").drawImage(X,0,0,g,P),X.close(),new Promise((ie,H)=>{W.toBlob(Y=>{Y?ie(new File([Y],A.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):H(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(X){throw console.error("Compress cover error:",X),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},J=async A=>{var X;const u=A.target.files[0];if(!u)return;if(!(u.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(u.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}V(!0);try{const W=await q(u),g=await window.KTM.cloudinary.uploadImage({file:W,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!g.secure_url)throw console.error("Cloudinary error:",g),new Error(((X=g.error)==null?void 0:X.message)||"Upload failed");N(P=>({...P,cover_url:g.secure_url}))}catch(W){console.error("Cover upload error:",W),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+W.message)}V(!1),A.target.value=""};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},h?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:M},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:r.title,onChange:A=>N({...r,title:A.target.value,slug:r.slug||I(A.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:r.slug,onChange:A=>N({...r,slug:A.target.value}),required:!0,disabled:!!h}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:r.description,onChange:A=>N({...r,description:A.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},r.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:r.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>N(A=>({...A,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:F,type:"file",accept:"image/*",className:"d-none",onChange:J}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var A;return(A=F.current)==null?void 0:A.click()},disabled:b},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:r.cover_url,onChange:A=>N({...r,cover_url:A.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:x||b},x?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:y,allAlbums:h,currentAlbumId:$,targetAlbum:D,onSelect:_,level:r=0}){const[N,x]=useState(!0),K=y.uuid||y.id,b=K===$,V=D===K,F=h.filter(I=>I.parentId===K),M=F.length>0;return React.createElement("div",{style:{marginLeft:r*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${V?"bg-info text-white":b?"bg-light text-muted":"hover-bg"}`,style:{cursor:b?"not-allowed":"pointer",opacity:b?.5:1,transition:"background 0.2s"},onClick:()=>!b&&_(K)},M&&React.createElement("i",{className:`fas fa-chevron-${N?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:I=>{I.stopPropagation(),x(!N)}}),!M&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${V?"-open":""} me-2 ${V?"":"text-warning"}`}),React.createElement("span",{className:"small"},y.title),b&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),y.count>0&&!b&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},y.count)),N&&M&&React.createElement("div",null,F.map(I=>React.createElement(FolderTreeItem,{key:I.uuid||I.id,folder:I,allAlbums:h,currentAlbumId:$,targetAlbum:D,onSelect:_,level:r+1}))))}function AlbumDetail({album:y,onBack:h,onRefresh:$,showToast:D,onNavigateToFolder:_,onEditSubfolder:r,parentAlbum:N}){const[x,K]=useState([]),[b,V]=useState([]),[F,M]=useState(!0),[I,q]=useState(!1),[J,A]=useState(""),[u,E]=useState([]),[X,W]=useState([]),[g,P]=useState({}),[G,w]=useState(null),[ie,H]=useState(!1),[Y,Ce]=useState(""),[Z,ee]=useState(!1),re=useRef(null),B=useRef(null),[me,fe]=useState(!1),[se,pe]=useState([]),[ne,ye]=useState([]),[ke,we]=useState(""),[t,s]=useState(!1),T=async(o,k=2)=>{const z=k*1024*1024,ge=o.type==="image/heic"||o.type==="image/heif"||/\.heic$/i.test(o.name);if(o.size<=z&&!ge)return o;try{const ve=await createImageBitmap(o),$e=document.createElement("canvas");let te=ve.width,_e=ve.height;const Ie=1200;return(te>Ie||_e>Ie)&&(te>_e?(_e=Math.round(_e/te*Ie),te=Ie):(te=Math.round(te/_e*Ie),_e=Ie)),$e.width=te,$e.height=_e,$e.getContext("2d").drawImage(ve,0,0,te,_e),ve.close(),new Promise((a,p)=>{$e.toBlob(n=>{n?a(new File([n],o.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):p(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ve){throw console.error("Compress error:",ve),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{oe(),he()},[y.id,y.uuid]);const oe=async()=>{M(!0);try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");K(o.images||[]);const k=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");V(Array.isArray(k)?k:[])}catch(o){console.error(o),D("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}M(!1)},he=async()=>{try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");ye(Array.isArray(o)?o:[])}catch(o){console.error("Error loading albums:",o)}},De=o=>{pe(k=>k.includes(o)?k.filter(z=>z!==o):[...k,o])},xe=async()=>{if(!ke||se.length===0){D("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}s(!0);let o=0;for(const k of se)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${k}`,{album_id:ke},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),o++}catch(z){console.error("Move error:",z)}s(!1),fe(!1),pe([]),we(""),o>0?(D("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),oe(),$()):D("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Ae,Ee]=useState(!1),R=async()=>{if(se.length===0||!confirm(`X\xF3a ${se.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Ee(!0);let o=0;for(const k of se)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${k}`,"L\u1ED7i x\xF3a \u1EA3nh"),o++}catch(z){console.error("Delete error:",z)}Ee(!1),pe([]),o>0?(D(`\u0110\xE3 x\xF3a ${o} \u1EA3nh!`,"success"),oe(),$()):D("X\xF3a th\u1EA5t b\u1EA1i","danger")},de=()=>{se.length===x.length?pe([]):pe(x.map(o=>o.id))},Pe=async()=>{if(Y.trim()){ee(!0);try{const o=Y.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:o+"-"+Date.now(),title:Y,parent_id:y.uuid||y.id},"L\u1ED7i t\u1EA1o folder"),D("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Ce(""),H(!1),oe(),$()}catch(o){D(o.message,"danger")}ee(!1)}},Q=async o=>{if(confirm(`X\xF3a folder "${o.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${o.uuid||o.id}`,"L\u1ED7i x\xF3a folder"),D("\u0110\xE3 x\xF3a folder","success"),oe(),$()}catch(k){D("L\u1ED7i x\xF3a folder","danger")}},C=o=>{const k=Array.from(o).filter(z=>z.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(z.name));E(z=>[...z,...k]),k.forEach(z=>{const ge=new FileReader;ge.onload=ve=>{W($e=>[...$e,{file:z,preview:ve.target.result}])},ge.readAsDataURL(z)})},Ve=o=>{E(k=>k.filter((z,ge)=>ge!==o)),W(k=>k.filter((z,ge)=>ge!==o))},Le=async o=>{var z;const k=await window.KTM.cloudinary.uploadImage({file:o,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${y.id}`});if(!k.secure_url)throw console.error("Cloudinary error:",k),new Error(((z=k.error)==null?void 0:z.message)||"Upload failed");return k},qe=async()=>{if(u.length===0)return;q(!0);let o=0;for(let k=0;k<u.length;k++)try{A(`\u0110ang x\u1EED l\xFD ${k+1}/${u.length}...`);const z=await T(u[k],2);A(`\u0110ang upload ${k+1}/${u.length}...`);const ge=await Le(z);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${y.id}`,{url:ge.secure_url,caption:g[k]||u[k].name.replace(/\.[^/.]+$/,""),sort_order:x.length+k},"L\u1ED7i l\u01B0u \u1EA3nh"),o++}catch(z){console.error("Upload error:",z)}q(!1),A(""),E([]),W([]),P({}),o>0?(D(`\u0110\xE3 upload ${o} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),oe(),$()):D("Upload th\u1EA5t b\u1EA1i","danger")},He=async(o,k)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${o}`,"L\u1ED7i x\xF3a \u1EA3nh"),D("\u0110\xE3 x\xF3a \u1EA3nh","success"),oe(),$()}catch(z){D("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Me=o=>{var k;o.preventDefault(),(k=B.current)==null||k.classList.add("dragover")},Se=()=>{var o;(o=B.current)==null||o.classList.remove("dragover")},Ke=o=>{var k;o.preventDefault(),(k=B.current)==null||k.classList.remove("dragover"),C(o.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:h},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},y.title),React.createElement("small",{className:"text-muted"},b.length>0&&React.createElement("span",null,b.length," folder \u2022 "),x.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>H(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ie&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Y,onChange:o=>Ce(o.target.value),onKeyPress:o=>o.key==="Enter"&&Pe(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Pe,disabled:Z||!Y.trim()},Z?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{H(!1),Ce("")}},"H\u1EE7y")))),b.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},b.map(o=>React.createElement("div",{key:o.uuid||o.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>_&&_(o)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},o.title),React.createElement("small",{className:"text-muted"},o.subfolderCount>0&&React.createElement("span",null,o.subfolderCount," folder"),o.subfolderCount>0&&o.count>0&&" \u2022 ",o.count>0&&React.createElement("span",null,o.count," \u1EA3nh"),o.subfolderCount===0&&o.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:k=>{k.stopPropagation(),r&&r(o)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:k=>{k.stopPropagation(),Q(o)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:B,className:"upload-zone",onClick:()=>{var o;return(o=re.current)==null?void 0:o.click()},onDragOver:Me,onDragLeave:Se,onDrop:Ke},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:re,type:"file",multiple:!0,accept:"image/*",onChange:o=>C(o.target.files)})),X.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},X.map((o,k)=>React.createElement("div",{key:k,className:"upload-preview-item"},React.createElement("img",{src:o.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Ve(k)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:qe,disabled:I},I?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),J||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",u.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",x.length,")"),x.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:de},se.length===x.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),se.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},se.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>fe(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:R,disabled:Ae},Ae?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>pe([])},React.createElement("i",{className:"fas fa-times"})))),F?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):x.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},x.map((o,k)=>React.createElement("div",{key:k,className:`image-item ${se.includes(o.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>De(o.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:se.includes(o.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:se.includes(o.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},se.includes(o.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:o.src,alt:o.caption,style:{opacity:se.includes(o.id)?.7:1,border:se.includes(o.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:z=>{z.stopPropagation(),He(o.id,k)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),o.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},o.caption)))))),me&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",se.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>fe(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},ne.filter(o=>!o.parentId).map(o=>React.createElement(FolderTreeItem,{key:o.uuid||o.id,folder:o,allAlbums:ne,currentAlbumId:y.uuid||y.id,targetAlbum:ke,onSelect:we})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>fe(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:xe,disabled:!ke||t},t?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),G&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>w(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>w(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:G.src,alt:G.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:o=>o.stopPropagation()}),G.caption&&React.createElement("div",{className:"text-white text-center mt-2"},G.caption)))))}function SearchCenter({showToast:y,onNavigate:h}){const[$,D]=useState(""),[_,r]=useState([]),[N,x]=useState([]),[K,b]=useState([]),[V,F]=useState("all"),[M,I]=useState(null),[q,J]=useState("list"),[A,u]=useState(!0),[E,X]=useState([]),[W,g]=useState([]),P=useRef(null),[G,w]=useState(!0),[ie,H]=useState(!1),Y=useRef(null),[Ce,Z]=useState(!1),[ee,re]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[B,me]=useState(""),[fe,se]=useState(!1),pe=useRef(null),ne=useRef(null),[ye,ke]=useState(null),[we,t]=useState(!1),[s,T]=useState(null),[oe,he]=useState(!1),[De,xe]=useState(!1),[Ae,Ee]=useState(null),[R,de]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),Pe=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Q=e=>{e._type==="product"&&(T(e),de({name:e.name||"",code:e.code||"",price:e.price||"",image:e.image||"",category:e.category||"",note:e.note||""}),t(!0))},C=async()=>{if(s)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${s.id}`,R,"L\u1ED7i c\u1EADp nh\u1EADt"),y("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),t(!1),T(null),Me()}catch(e){y(e.message,"danger")}},Ve=async e=>{const i=e._type==="product"?"s\u1EA3n ph\u1EA9m":e._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${i} "${e.name}"?`))try{let c="";e._type==="product"?c=`${API_BASE}/api/products?id=${e.id}`:e._type==="album"?c=`${API_BASE}/api/images/${e.id}`:e._type==="video"&&(c=`${API_BASE}/api/videos/${e.id}`),await window.KTM.api.deleteJSON(c,"L\u1ED7i x\xF3a"),y(`\u0110\xE3 x\xF3a ${i}`,"success"),Me()}catch(c){y(c.message,"danger")}},Le=async e=>{try{const i=Ae?`${API_BASE}/api/products?id=${Ae.id}`:`${API_BASE}/api/products`;Ae?await window.KTM.api.putJSON(i,e,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(i,e,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(Ae?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),xe(!1),Ee(null),Me()}catch(i){y(i.message,"danger")}},qe="ktm_admin_data_cache_v1",He=1e3*60*10,Me=async()=>{let e=null,i=!1;const c=window.KTM.cache.read(qe,{ttlMs:He,validate:Array.isArray});c.hit?(e=c.value,console.log("[CACHE] Using cache, items:",e.length),x(e),r(e),u(!1),i=!0):c.status==="miss"?console.log("[CACHE] No cache found"):c.status==="expired"||c.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):c.status==="error"&&console.error("[CACHE] Error parsing cache"),i||u(!0);try{const d=async(ae,le)=>{try{const Ne=await window.KTM.api.getJSON(ae,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Ne!=null?Ne:le}catch(Ne){return le}},[f,l,m]=await Promise.all([d(`${API_BASE}/api/products`,[]),d(`${API_BASE}/api/albums`,[]),d(`${API_BASE}/api/video-folders?withVideos=true`,[])]),v=Array.isArray(f)?f.map(ae=>({...ae,_type:"product",_source:"database"})):[];X(l);let L=[];Array.isArray(l)&&l.length>0&&(await Promise.all(l.map(le=>d(`${API_BASE}/api/albums/${le.id}`,{})))).forEach((le,Ne)=>{const ue=l[Ne];le.images&&le.images.length>0&&le.images.forEach(ce=>{L.push({id:ce.id,name:ce.caption||"\u1EA2nh t\u1EEB "+ue.title,image:ce.src,folder:ue.title,_type:"album",_source:"database"})})}),g(m);let O=[];Array.isArray(m)&&m.forEach(ae=>{ae.videos&&ae.videos.forEach(le=>{O.push({id:le.id,name:le.title,folder:ae.name,image:le.thumb,youtubeId:le.youtubeId,url:le.url,_type:"video",_source:"database"})})});const j=[...v,...L,...O];(!e||JSON.stringify(j)!==JSON.stringify(e))&&(x(j),r(j),window.KTM.cache.write(qe,j))}catch(d){console.error("Song song fetch error:",d)}u(!1)};useEffect(()=>{Me(),setTimeout(()=>{var e;return(e=P.current)==null?void 0:e.focus()},100)},[]);const Se=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(i){return String(e!=null?e:"").toLowerCase()}},Ke=e=>{const c=Se(e).trim().split(/\s+/).filter(Boolean),d=c.includes("anh"),f=c.includes("video"),l=c.filter(L=>L!=="anh"&&L!=="video"),m=l.join(" "),v=new Set(["product"]);return d&&v.add("album"),f&&v.add("video"),{allowedTypes:v,includeAlbum:d,includeVideo:f,contentTokens:l,cleanedQuery:m}},o=(e,i,c)=>{var ae,le,Ne,ue,ce;const d=Array.isArray(i)?i:[],f=Se(c).trim();if(!d.length&&!f)return 0;const l=Se((ae=e==null?void 0:e.name)!=null?ae:""),m=Se((le=e==null?void 0:e.code)!=null?le:""),v=Se((Ne=e==null?void 0:e.category)!=null?Ne:""),L=Se((ue=e==null?void 0:e.note)!=null?ue:""),O=Se((ce=e==null?void 0:e.folder)!=null?ce:"");if(!`${l} ${m} ${v} ${L} ${O}`.trim())return 0;let S=0;f&&(l===f&&(S+=220),l.includes(f)&&(S+=140),l.startsWith(f)&&(S+=160),m&&m===f&&(S+=180),m&&m.includes(f)&&(S+=90));for(const Te of d){if(!Te)continue;const be=new RegExp(`(?:^|\\s)${Te.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);l.includes(Te)&&(S+=35),be.test(l)&&(S+=25),m&&m.includes(Te)&&(S+=20),m&&be.test(m)&&(S+=10),v&&v.includes(Te)&&(S+=12),O&&O.includes(Te)&&(S+=12),L&&L.includes(Te)&&(S+=6)}return S>0&&l&&(S+=Math.max(0,10-Math.min(10,Math.floor(l.length/10)))),S},k=(e,i,c)=>{const d=Array.isArray(e)?e:[];return d.length?d.map((l,m)=>({it:l,idx:m,score:o(l,i,c)})).sort((l,m)=>m.score!==l.score?m.score-l.score:l.idx-m.idx).map(l=>l.it):[]},z=async(e,i)=>{if(!(!G||i.length===0)){H(!0);try{const c=i.map(f=>({id:f.id,name:f.name,price:f.price,category:f.category,note:f.note,folder:f.folder,_type:f._type})),d=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:e,products:c},"AI Search error");if(d&&d.matchedIds&&d.matchedIds.length>0){const{contentTokens:f,cleanedQuery:l}=Ke(e),m=new Set(d.matchedIds),v=i.filter(L=>m.has(L.id)).sort((L,O)=>o(O,f,l)-o(L,f,l));v.length>0&&r(v)}else d&&d.matchedIds&&d.matchedIds.length===0&&r([])}catch(c){console.error("AI Search error:",c)}H(!1)}},ge=e=>{if(D(e),Y.current&&clearTimeout(Y.current),!e.trim()){ve(V);return}const{allowedTypes:i,contentTokens:c,cleanedQuery:d}=Ke(e),f=N.filter(m=>{if(!i.has(m==null?void 0:m._type))return!1;if(c.length===0)return!0;const v=Se(Object.entries(m).filter(([L])=>!L.startsWith("_")).map(([,L])=>String(L||"")).join(" "));return c.some(L=>v.includes(L))});let l=f;V!=="all"&&(l=f.filter(m=>(m.category||m._type)===V)),r(k(l,c,d)),G&&d.length>=3&&(Y.current=setTimeout(()=>{z(d,l)},500))},ve=e=>{F(e);const{allowedTypes:i,contentTokens:c}=Ke($),{cleanedQuery:d}=Ke($);let f=N.filter(l=>i.has(l==null?void 0:l._type));e!=="all"&&(f=f.filter(l=>(l.category||l._type)===e)),$.trim()&&c.length>0&&(f=f.filter(l=>{const m=Se(Object.entries(l).filter(([v])=>!v.startsWith("_")).map(([,v])=>String(v||"")).join(" "));return c.every(v=>m.includes(v))})),r(k(f,c,d))},$e=(e,i)=>{window.KTM.clipboard.writeText(e).then(()=>{I(i),y("\u0110\xE3 copy!","success"),setTimeout(()=>I(null),1500)})},te=async(e,i)=>{try{await window.KTM.clipboard.writeImageFromUrl(e),I(i+"-img"),y("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>I(null),1500)}catch(c){$e(e,i+"-img")}},_e=e=>{let i=e.toLowerCase();const c=[],d=N.filter(m=>m._type==="product");if(i.includes("ty")||i.includes("xy lanh")){if(i.includes("gi\u1EEFa")||i.includes("giua")){const m=d.find(v=>{var L;return(L=v.name)==null?void 0:L.toLowerCase().includes("xy lanh gi\u1EEFa")});m&&!c.find(v=>v.id===m.id)&&c.push(m)}if(i.includes("nghi\xEAng")||i.includes("nghieng")){const m=d.find(v=>{var L;return(L=v.name)==null?void 0:L.toLowerCase().includes("xy lanh nghi\xEAng")});m&&!c.find(v=>v.id===m.id)&&c.push(m)}if(i.includes("\u1EE7i")||i.includes("ui")){const m=d.find(v=>{var L;return(L=v.name)==null?void 0:L.toLowerCase().includes("xy lanh \u1EE7i")});m&&!c.find(v=>v.id===m.id)&&c.push(m)}}const f=i.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(f){const m=f[1],v=f[2],L=d.find(O=>{var S;const j=((S=O.name)==null?void 0:S.toLowerCase())||"";return j.includes("combo")&&j.includes(`${m} tay`)&&(j.includes(`${v} xy`)||j.includes(`${v} xylanh`))});if(L&&!c.find(O=>O.id===L.id))c.push(L);else{const O=d.find(j=>{var ae;const S=((ae=j.name)==null?void 0:ae.toLowerCase())||"";return S.includes("combo")&&S.includes(`${m} tay`)});O&&!c.find(j=>j.id===O.id)&&c.push(O)}}if(i.includes("combo")&&!f){const m=i.match(/combo.*?(\d+)\s*tay/);if(m){const v=m[1];d.filter(O=>{var S;const j=((S=O.name)==null?void 0:S.toLowerCase())||"";return j.includes("combo")&&j.includes(`${v} tay`)}).forEach(O=>{c.find(j=>j.id===O.id)||c.push(O)})}}const l=i.match(/van\s*(\d+)\s*tay/);if(l&&!i.includes("ty")&&!i.includes("combo")){const m=l[1],v=d.find(L=>{var j;const O=((j=L.name)==null?void 0:j.toLowerCase())||"";return O.includes(`van ${m} tay`)&&!O.includes("combo")});v&&!c.find(L=>L.id===v.id)&&c.push(v)}return c.slice(0,4)},Ie=async e=>{if(!e.trim())return;const i={role:"user",content:e,attachments:[]};re(d=>[...d,i]),me(""),se(!0);const c=_e(e);setTimeout(()=>{var d;return(d=pe.current)==null?void 0:d.scrollIntoView({behavior:"smooth"})},100);try{const f=N.filter(j=>j._type==="product").map(j=>{let S=`- ${j.name}`;return j.code&&(S+=` (M\xE3: ${j.code})`),j.price&&(S+=` - Gi\xE1: ${j.price.replace(/[đ\s]/g,"")}\u0111`),j.category&&(S+=` [${j.category}]`),j.note&&(S+=` (${j.note})`),S}).join(`
`),m=ee.slice(-6).map(j=>`${j.role==="user"?"Kh\xE1ch":"AI"}: ${j.content}`).join(`
`),v=m?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${m}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${f}`:f,O=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:e,context:v,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";re(j=>[...j,{role:"assistant",content:O,attachments:c}])}catch(d){console.error("AI Error:",d);const f=e.toLowerCase(),l=N.filter(v=>{const L=Object.values(v).join(" ").toLowerCase();return f.split(" ").some(O=>L.includes(O))});let m="";l.length>0?(m=`T\xECm th\u1EA5y ${l.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,l.slice(0,5).forEach(v=>{m+=`\u2022 ${v.name}`,v.price&&(m+=` - ${v.price.replace(/[đ\s]/g,"")}\u0111`),v.note&&(m+=` (${v.note})`),m+=`
`}),l.length>5&&(m+=`
...v\xE0 ${l.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):m='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',re(v=>[...v,{role:"assistant",content:m,attachments:l.slice(0,4)}])}se(!1),setTimeout(()=>{var d,f;(d=pe.current)==null||d.scrollIntoView({behavior:"smooth"}),(f=ne.current)==null||f.focus()},100)};function Ue({show:e,product:i,categories:c,onClose:d,onSave:f}){const[l,m]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[v,L]=useState(!1),[O,j]=useState(!1),S=useRef(null),ae=U=>window.KTM.money.formatVNDInputDigits(U);useEffect(()=>{if(i)if(m({name:i.name||"",code:i.code||"",price:i.price||"",image:i.image||"",category:i.category||"",note:i.note||"",sort_order:i.sort_order||0}),i.price){const U=window.KTM.money.getDigits(i.price);ce(U),m(je=>({...je,price:ae(U)}))}else ce("");else m({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),ce("")},[i,e]);const[le,Ne]=React.useState(""),[ue,ce]=React.useState(""),Te=U=>{const je=window.KTM.money.nextPriceInputState(U.target.value,ue);ce(je.digits),m({...l,price:je.price})},be=async(U,je=2)=>{const Qe=je*1024*1024;if(U.size<=Qe)return U;try{const Re=await createImageBitmap(U),ze=document.createElement("canvas");let Oe=Re.width,Fe=Re.height;const Be=1200;return(Oe>Be||Fe>Be)&&(Oe>Fe?(Fe=Math.round(Fe/Oe*Be),Oe=Be):(Oe=Math.round(Oe/Fe*Be),Fe=Be)),ze.width=Oe,ze.height=Fe,ze.getContext("2d").drawImage(Re,0,0,Oe,Fe),Re.close(),new Promise((Ge,Ye)=>{ze.toBlob(Xe=>{Xe?Ge(new File([Xe],U.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ye(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Re){throw console.error("Compress error:",Re),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Je=async U=>{var Re;const je=U.target.files[0];if(!je)return;if(!(je.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(je.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}j(!0);try{const ze=await be(je),Oe=await window.KTM.cloudinary.uploadImage({file:ze,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!Oe.secure_url)throw console.error("Cloudinary error:",Oe),new Error(((Re=Oe.error)==null?void 0:Re.message)||"Upload failed");m(Fe=>({...Fe,image:Oe.secure_url}))}catch(ze){console.error("Upload error:",ze),alert("L\u1ED7i upload \u1EA3nh: "+ze.message)}j(!1),U.target.value=""},We=async U=>{U.preventDefault(),L(!0),await f(l),L(!1)};return e?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),i?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:d})),React.createElement("form",{onSubmit:We},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:l.name,onChange:U=>m({...l,name:U.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:l.code,onChange:U=>m({...l,code:U.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:l.price,onChange:Te,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:l.category,onChange:U=>m({...l,category:U.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),c.map(U=>React.createElement("option",{key:U,value:U},U)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:l.note,onChange:U=>m({...l,note:U.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},l.image?React.createElement(React.Fragment,null,React.createElement("img",{src:l.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>m({...l,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var U;return(U=S.current)==null?void 0:U.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:S,type:"file",accept:"image/*",className:"d-none",onChange:Je}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var U;return(U=S.current)==null?void 0:U.click()},disabled:O,style:{borderRadius:"10px"}},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:l.image,onChange:U=>m({...l,image:U.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:d,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:v,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const a=(e,i)=>{const c=e._type==="product",d=e._type==="album",f=e._type==="video",l=e.note&&(e.note.toLowerCase().includes("free")||e.note.toLowerCase().includes("gi\u1EA3m")||e.note.toLowerCase().includes("sale"));return q==="grid"?React.createElement("div",{key:e.id||i,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>ke({url:e.image,name:e.name,price:e.price,note:e.note,item:e})},e.image?React.createElement("img",{src:e.image,alt:e.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${f?"fa-video":"fa-image"} fa-2x text-muted`})),e.price&&React.createElement("div",{className:"price-overlay"},e.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${c?"product":d?"album":"video"}`},c?"SP":d?"\u1EA2nh":"Video"),l&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},e.name),e.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},e.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:M===e.id+"-img"?"copied":"",onClick:()=>te(e.image,e.id)},React.createElement("i",{className:"fas fa-image"})),e.price&&React.createElement("button",{className:M===e.id+"-price"?"copied":"",onClick:()=>$e(e.price.replace(/[đ\s]/g,""),e.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:e.id||i,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${c?"product":d?"album":"video"}`},c?"S\u1EA3n ph\u1EA9m":d?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},e.image?React.createElement("img",{src:e.image,alt:e.name,className:"thumb",loading:"lazy",onClick:()=>ke({url:e.image,name:e.name,price:e.price,note:e.note,item:e})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${f?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},e.name),React.createElement("div",{className:"price-row"},e.price&&React.createElement("span",{className:"price"},e.price.replace(/[đ\s]/g,""),"\u0111"),l&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},e.code&&React.createElement("span",{className:"meta-tag"},"#",e.code),e.category&&React.createElement("span",{className:"meta-tag"},e.category),e.note&&React.createElement("span",{className:"meta-tag highlight"},e.note),e.folder&&React.createElement("span",{className:"meta-tag"},e.folder),f&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},c&&React.createElement("button",{onClick:()=>h&&h("orders","create",{productId:e.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),e.price&&React.createElement("button",{className:M===e.id+"-price"?"copied":"",onClick:()=>$e(e.price.replace(/[đ\s]/g,""),e.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:M===e.id+"-name"?"copied":"",onClick:()=>$e(e.name,e.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),f&&e.youtubeId&&React.createElement("button",{className:M===e.id+"-yt"?"copied":"",onClick:()=>$e(`https://www.youtube.com/watch?v=${e.youtubeId}`,e.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),c&&React.createElement("button",{className:"action-edit",onClick:()=>Q(e)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Ve(e)},React.createElement("i",{className:"fas fa-trash"}))))},[p,n]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,_.length)," k\u1EBFt qu\u1EA3",G&&$.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),V!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},V==="product"?"S\u1EA3n ph\u1EA9m":V==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${q==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>J("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${q==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>J("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},A?React.createElement("div",null,[...Array(8)].map((e,i)=>React.createElement("div",{key:i,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):_.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',$,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{D(""),ge("")}},"Xem t\u1EA5t c\u1EA3")):q==="grid"?React.createElement("div",{className:"product-grid-mobile"},_.map((e,i)=>a(e,i))):React.createElement("div",null,_.map((e,i)=>a(e,i)))),p&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>n(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${V==="all"?"active":""}`,onClick:()=>{ve("all"),n(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${V==="product"?"active":""}`,onClick:()=>{ve("product"),n(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${V==="album"?"active":""}`,onClick:()=>{ve("album"),n(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${V==="video"?"active":""}`,onClick:()=>{ve("video"),n(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:G,onChange:e=>w(e.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:P,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:$,onChange:e=>ge(e.target.value)}),React.createElement("button",{className:`filter-btn ${p||V!=="all"?"active":""}`,onClick:()=>n(!p)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:oe?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>Z(!0),onTouchStart:()=>Z(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Ce&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>Z(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},ee.map((e,i)=>React.createElement("div",{key:i,className:`mb-3 ${e.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${e.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:e.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},e.content,e.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:M===`chat-${i}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:M===`chat-${i}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(e.content),I(`chat-${i}`),setTimeout(()=>I(null),1500)}},React.createElement("i",{className:`fas ${M===`chat-${i}`?"fa-check":"fa-copy"}`})),e.attachments&&e.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},e.attachments.map((c,d)=>React.createElement("div",{key:d,style:{width:70},className:"text-center"},c.image&&React.createElement("img",{src:c.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>ke({url:c.image,name:c.name,price:c.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},c.name),c.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},c.price.replace(/[đ\s]/g,""),"\u0111"))))))),fe&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:pe})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(e=>React.createElement("button",{key:e,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Ie(e),disabled:fe,style:{whiteSpace:"nowrap"}},e))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ie(B)},className:"chat-input-wrap"},React.createElement("input",{ref:ne,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:B,onChange:e=>me(e.target.value),disabled:fe}),React.createElement("button",{type:"submit",className:"send-btn",disabled:fe||!B.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),ye&&React.createElement("div",{className:"preview-modal",onClick:()=>ke(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>ke(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:e=>e.stopPropagation()},React.createElement("img",{src:ye.url,alt:ye.name})),React.createElement("div",{className:"preview-footer",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"name"},ye.name),ye.price&&React.createElement("div",{className:"price"},ye.price.replace(/[đ\s]/g,""),"\u0111"),ye.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},ye.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:M==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:M==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>te(ye.url,"preview")},React.createElement("i",{className:`fas ${M==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),ye.price&&React.createElement("button",{className:M==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>$e(ye.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${M==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Ue,{show:De,product:Ae,categories:K,onClose:()=>{xe(!1),Ee(null)},onSave:Le}),React.createElement("div",{className:`fab-container mobile-only ${oe?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{he(!1),xe(!0),Ee(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{he(!1),h&&h("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${oe?"open":""}`,onClick:()=>he(!oe)},React.createElement("i",{className:"fas fa-plus"}))),we&&s&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>t(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:R.name,onChange:e=>de({...R,name:e.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:R.code,onChange:e=>de({...R,code:e.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:R.price,onChange:e=>de({...R,price:e.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:R.category,onChange:e=>de({...R,category:e.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Pe.map(e=>React.createElement("option",{key:e,value:e},e)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:R.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:e=>de({...R,note:e.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>t(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:C},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:y,showToast:h}){const[$,D]=useState([]),[_,r]=useState([]),[N,x]=useState(!0),[K,b]=useState(null),[V,F]=useState(!1),[M,I]=useState(null),[q,J]=useState(!1),[A,u]=useState(null),[E,X]=useState(null),[W,g]=useState([]);useEffect(()=>{P()},[]);const P=async(t=null)=>{x(!0);try{const s=t?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${t}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,T=await window.KTM.api.getJSON(s,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");D(Array.isArray(T)?T:[])}catch(s){console.error(s),h("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}x(!1)},G=async t=>{try{const s=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${t}`,"L\u1ED7i t\u1EA3i video");r(Array.isArray(s)?s:[])}catch(s){console.error(s)}},w=async t=>{if(t===0)return;const s=[...$];[s[t-1],s[t]]=[s[t],s[t-1]],D(s),await H(s)},ie=async t=>{if(t===$.length-1)return;const s=[...$];[s[t],s[t+1]]=[s[t+1],s[t]],D(s),await H(s)},H=async t=>{try{await Promise.all(t.map((s,T)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${s.id}`,{sortOrder:T},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),h("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(s){h("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),P(E==null?void 0:E.id)}},Y=async t=>{if(t===0)return;const s=[..._];[s[t-1],s[t]]=[s[t],s[t-1]],r(s),await Z(s)},Ce=async t=>{if(t===_.length-1)return;const s=[..._];[s[t],s[t+1]]=[s[t+1],s[t]],r(s),await Z(s)},Z=async t=>{try{await Promise.all(t.map((s,T)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${s.id}`,{sort_order:T},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),h("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(s){h("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),G(K.id)}},ee=()=>{I(null),F(!0)},re=t=>{I(t),F(!0)},B=async t=>{try{!M&&E&&(t.parent_id=E.id);const s=M?`${API_BASE}/api/video-folders/${M.id}`:`${API_BASE}/api/video-folders`;M?await window.KTM.api.putJSON(s,t,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(s,t,"L\u1ED7i l\u01B0u folder"),h(M?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),F(!1),P(E==null?void 0:E.id)}catch(s){h(s.message,"danger")}},me=async t=>{const s=t.subfolderCount>0?`X\xF3a folder "${t.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${t.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(s))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${t.id}`,"L\u1ED7i x\xF3a folder"),h("\u0110\xE3 x\xF3a folder","success"),b(null),P(E==null?void 0:E.id)}catch(T){h("L\u1ED7i x\xF3a folder","danger")}},fe=t=>{t.subfolderCount>0?(g(s=>[...s,t]),X(t),P(t.id)):(b(t),r(t.videos||[]))},se=t=>{if(t==="root")g([]),X(null),P(null);else if(t){const s=W.findIndex(T=>T.id===t.id);s>=0&&(g(W.slice(0,s+1)),X(t),P(t.id))}else{const s=[...W];s.pop();const T=s[s.length-1]||null;g(s),X(T),P(T==null?void 0:T.id)}},pe=()=>{u(null),J(!0)},ne=t=>{u(t),J(!0)},ye=async t=>{try{t.folder_id=K==null?void 0:K.id;const s=A?`${API_BASE}/api/videos/${A.id}`:`${API_BASE}/api/videos`;A?await window.KTM.api.putJSON(s,t,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(s,t,"L\u1ED7i l\u01B0u video"),h(A?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),J(!1),P(),K&&G(K.id)}catch(s){h(s.message,"danger")}},ke=async t=>{if(confirm(`X\xF3a video "${t.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${t.id}`,"L\u1ED7i x\xF3a video"),h("\u0110\xE3 x\xF3a video","success"),P(),K&&G(K.id)}catch(s){h("L\u1ED7i x\xF3a video","danger")}},we=t=>{const s=`https://www.youtube.com/watch?v=${t.youtubeId}`;window.KTM.clipboard.writeText(s).then(()=>{h("\u0110\xE3 copy link!","success")}).catch(()=>{h("Kh\xF4ng th\u1EC3 copy link","danger")})};return K?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>b(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${K.slug==="shorts"?"text-danger":"text-warning"}`}),K.name)),React.createElement("button",{className:"btn btn-warning",onClick:pe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),_.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},_.map((t,s)=>React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Y(s),disabled:s===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},s+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Ce(s),disabled:s===_.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:t.thumb,className:"card-img-top",alt:t.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${t.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:t.title},t.title),React.createElement("small",{className:"text-muted"},t.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>we(t),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>ne(t),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>ke(t),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:q,video:A,onClose:()=>J(!1),onSave:ye})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},E&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>se()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),E?E.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:ee},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),W.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:t=>{t.preventDefault(),se("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),W.map((t,s)=>React.createElement("li",{key:t.id,className:`breadcrumb-item ${s===W.length-1?"active":""}`},s===W.length-1?t.name:React.createElement("a",{href:"#",onClick:T=>{T.preventDefault(),se(t)},className:"text-warning"},t.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),N?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):$.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},E?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ee},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",E?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},$.map((t,s)=>{var T,oe,he,De;return React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:xe=>{xe.stopPropagation(),w(s)},disabled:s===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},s+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:xe=>{xe.stopPropagation(),ie(s)},disabled:s===$.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>fe(t),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${t.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},t.name),React.createElement("p",{className:"text-muted mb-0"},t.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),t.subfolderCount," folder"),t.subfolderCount>0&&(t.videoCount>0||((T=t.videos)==null?void 0:T.length)>0)&&" \u2022 ",(t.videoCount>0||((oe=t.videos)==null?void 0:oe.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),t.videoCount||((he=t.videos)==null?void 0:he.length)||0," videos"),t.subfolderCount===0&&!t.videoCount&&!((De=t.videos)!=null&&De.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:xe=>{xe.stopPropagation(),re(t)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:xe=>{xe.stopPropagation(),me(t)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:V,folder:M,onClose:()=>F(!1),onSave:B}))}function VideoFolderModal({show:y,folder:h,onClose:$,onSave:D}){const[_,r]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[N,x]=useState(!1),[K,b]=useState(!1);useEffect(()=>{r(h?{name:h.name||"",description:h.description||"",sortOrder:h.sortOrder||0,coverImage:h.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[h,y]);const V=async M=>{const I=M.target.files[0];if(I){b(!0);try{const q=await window.KTM.cloudinary.uploadImage({file:I,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});q.secure_url&&r(J=>({...J,coverImage:q.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(q){console.error("Cloudinary upload error:",q),alert("L\u1ED7i upload \u1EA3nh: "+(q.message||q))}finally{b(!1)}}},F=async M=>{M.preventDefault(),x(!0),await D(_),x(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},h?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:F},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:_.name,onChange:M=>r({..._,name:M.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:_.description,onChange:M=>r({..._,description:M.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:_.sortOrder,onChange:M=>r({..._,sortOrder:parseInt(M.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},_.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:_.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>r({..._,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:V,disabled:K}),K&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:_.coverImage,onChange:M=>r({..._,coverImage:M.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:N},N?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:y}){const[h,$]=useState([]),[D,_]=useState(!0),[r,N]=useState(!1),[x,K]=useState(null),[b,V]=useState(""),[F,M]=useState(""),I=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{q()},[]);const q=async()=>{_(!0);try{const g=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");$(Array.isArray(g)?g:[])}catch(g){console.error(g),y("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}_(!1)},J=()=>{K(null),N(!0)},A=g=>{K(g),N(!0)},u=async g=>{if(!(!g||!g.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:g},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),y(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),q()}catch(P){y("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},E=async g=>{try{const P=x?`${API_BASE}/api/products?id=${x.id}`:`${API_BASE}/api/products`;x?await window.KTM.api.putJSON(P,g,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(P,g,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(x?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),N(!1),q()}catch(P){y(P.message,"danger")}},X=async g=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${g.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${g.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),y("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),q()}catch(P){y(P.message,"danger")}},W=h.filter(g=>{const P=!b||g.name.toLowerCase().includes(b.toLowerCase())||g.code&&g.code.toLowerCase().includes(b.toLowerCase()),G=!F||g.category===F;return P&&G});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:J},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:b,onChange:g=>V(g.target.value)})),React.createElement("span",{className:"product-count"},W.length)),React.createElement("select",{className:"form-select",value:F,onChange:g=>M(g.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),I.map(g=>React.createElement("option",{key:g,value:g},g)))),D?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):W.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:J},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},W.map(g=>React.createElement("div",{key:g.id,className:"product-item d-flex align-items-center gap-3"},g.image?React.createElement("img",{src:g.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},g.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},g.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},g.category),g.code&&React.createElement("span",{className:"product-badge bg-secondary"},g.code)),React.createElement("div",{className:"product-price"},g.price?g.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),g.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},g.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>A(g),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>X(g),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:r,product:x,categories:I,onClose:()=>N(!1),onSave:E}))}function ProductModal({show:y,product:h,categories:$,onClose:D,onSave:_}){const[r,N]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[x,K]=useState(!1),[b,V]=useState(!1);useEffect(()=>{N(h?{name:h.name||"",code:h.code||"",price:h.price||"",image:h.image||"",category:h.category||"",note:h.note||"",sort_order:h.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[h,y]);const[F,M]=React.useState(""),I=w=>window.KTM.money.formatVNDInputDigits(w),[q,J]=React.useState(""),A=w=>{const ie=window.KTM.money.nextPriceInputState(w.target.value,q);J(ie.digits),N({...r,price:ie.price})},[u,E]=React.useState("");React.useEffect(()=>{h!=null&&h.image&&E(h.image)},[h]);const X=async w=>{if(!(!w||!w.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:w},"L\u1ED7i x\xF3a \u1EA3nh")}catch(ie){console.error("Delete cloudinary image error:",ie)}},W=async(w,ie=2,H)=>{const Y=ie*1024*1024,Ce=w.type==="image/heic"||w.type==="image/heif"||/\.heic$/i.test(w.name);if(w.size<=Y&&!Ce)return w;H==null||H("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const Z=await createImageBitmap(w);H==null||H("\u0110ang n\xE9n \u1EA3nh...");const ee=document.createElement("canvas");let re=Z.width,B=Z.height;const me=1200;return(re>me||B>me)&&(re>B?(B=Math.round(B/re*me),re=me):(re=Math.round(re/B*me),B=me)),ee.width=re,ee.height=B,ee.getContext("2d").drawImage(Z,0,0,re,B),Z.close(),new Promise((se,pe)=>{ee.toBlob(ne=>{ne?(H==null||H("Ho\xE0n t\u1EA5t!"),se(new File([ne],w.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):pe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Z){throw console.error("createImageBitmap error:",Z),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},g=async w=>{var Y,Ce;const ie=(Y=w.target.files)==null?void 0:Y[0];if(!ie)return;if(!(ie.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ie.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}V(!0),M("\u0110ang chu\u1EA9n b\u1ECB...");try{const Z=(ie.size/1024/1024).toFixed(1);M(`File ${Z}MB - \u0110ang n\xE9n...`);const ee=await W(ie,2,me=>{M(me)}),re=(ee.size/1024/1024).toFixed(1);M(`\u0110\xE3 n\xE9n: ${re}MB - \u0110ang upload...`);const B=await window.KTM.cloudinary.uploadImage({file:ee,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});B.secure_url?(r.image&&r.image!==u&&X(r.image),N(me=>({...me,image:B.secure_url})),M("")):(console.error("Cloudinary error:",B),alert("Upload th\u1EA5t b\u1EA1i: "+(((Ce=B.error)==null?void 0:Ce.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),M(""))}catch(Z){console.error("Upload error:",Z),alert("L\u1ED7i: "+Z.message),M("")}V(!1),w.target.value=""},P=()=>{r.image&&(r.image!==u&&X(r.image),N(w=>({...w,image:""})))},G=async w=>{w.preventDefault(),K(!0),u&&r.image&&u!==r.image&&await X(u),u&&!r.image&&await X(u),await _(r),K(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${h?"fa-edit":"fa-plus-circle"} me-2`}),h?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:D})),React.createElement("form",{onSubmit:G},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},r.image?React.createElement(React.Fragment,null,React.createElement("img",{src:r.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:P,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${b?"fa-spinner fa-spin":"fa-camera"} me-1`}),b?F||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:g,disabled:b,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),b&&F&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},F))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:r.name,onChange:w=>N({...r,name:w.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:r.code,onChange:w=>N({...r,code:w.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:r.price,onChange:A,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:r.category,onChange:w=>N({...r,category:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),$.map(w=>React.createElement("option",{key:w,value:w},w)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:r.note,onChange:w=>N({...r,note:w.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:r.image,onChange:w=>N({...r,image:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:D,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:x,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},x?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:y,video:h,onClose:$,onSave:D}){const[_,r]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[N,x]=useState(!1),[K,b]=useState("");useEffect(()=>{h?(r({title:h.title||"",youtube_url:`https://www.youtube.com/watch?v=${h.youtubeId}`,thumbnail_url:h.thumb||"",sort_order:h.sortOrder||0}),b(h.thumb)):(r({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),b(""))},[h,y]);const V=I=>{const q=I.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return q?q[1]:null},F=I=>{r({..._,youtube_url:I});const q=V(I);q&&b(`https://img.youtube.com/vi/${q}/hqdefault.jpg`)},M=async I=>{I.preventDefault(),x(!0),await D(_),x(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},h?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:M},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:_.youtube_url,onChange:I=>F(I.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),K&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:K,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:_.title,onChange:I=>r({..._,title:I.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:_.sort_order,onChange:I=>r({..._,sort_order:parseInt(I.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:_.thumbnail_url,onChange:I=>r({..._,thumbnail_url:I.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:N},N?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[y,h]=useState(!1),[$,D]=useState(""),[_,r]=useState(null),[N,x]=useState("search"),[K,b]=useState(null),[V,F]=useState(""),[M,I]=useState([]),[q,J]=useState(null),[A,u]=useState(!1),[E,X]=useState(null),[W,g]=useState(!0),[P,G]=useState([]),[w,ie]=useState(null),[H,Y]=useState([]);useEffect(()=>{const t=localStorage.getItem("ktm_admin_session");if(t)try{const s=JSON.parse(t);s.expiry>Date.now()?(h(!0),r(s.user)):localStorage.removeItem("ktm_admin_session")}catch(s){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{y&&B()},[y]);const Ce=async(t,s)=>{D("");try{const T=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:t,password:s},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),oe={user:T.user,token:T.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(oe)),r(T.user),h(!0)}catch(T){D(T.message)}},Z=()=>{localStorage.removeItem("ktm_admin_session"),h(!1),r(null),I([]),J(null)},ee=(t,s="success")=>{const T=Date.now();G(oe=>[...oe,{id:T,message:t,type:s}])},re=t=>{G(s=>s.filter(T=>T.id!==t))},B=async(t=null)=>{g(!0);try{const s=t?`${API_BASE}/api/albums?parent_id=${t}`:`${API_BASE}/api/albums?parent_id=root`,T=await window.KTM.api.getJSON(s,"L\u1ED7i t\u1EA3i danh s\xE1ch album");I(Array.isArray(T)?T:[])}catch(s){console.error(s),ee("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}g(!1)},me=()=>{X(null),u(!0)},fe=t=>{X(t),u(!0)},se=async t=>{try{const s=E&&E.uuid;!s&&w&&(t.parent_id=w.uuid);const T=s?`${API_BASE}/api/albums/${E.uuid||E.id}`:`${API_BASE}/api/albums`;s?await window.KTM.api.putJSON(T,t,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(T,t,"L\u1ED7i t\u1EA1o"),ee(s?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),u(!1),B(w==null?void 0:w.uuid)}catch(s){ee(s.message,"danger")}},pe=t=>{J(t)},ne=t=>{if(t==="root")Y([]),ie(null),B(null);else if(t){const s=H.findIndex(T=>T.uuid===t.uuid);s>=0&&(Y(H.slice(0,s+1)),ie(t),B(t.uuid))}else{const s=[...H];s.pop();const T=s[s.length-1]||null;Y(s),ie(T),B(T==null?void 0:T.uuid)}},ye=async t=>{const s=`X\xF3a folder "${t.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(s))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${t.uuid||t.id}`,"L\u1ED7i x\xF3a album"),ee("\u0110\xE3 x\xF3a","success"),B(w==null?void 0:w.uuid)}catch(T){ee("L\u1ED7i x\xF3a album","danger")}};if(!y)return React.createElement(LoginPage,{onLogin:Ce,error:$});const ke=()=>{const t=new Date,s=t.getFullYear(),T=String(t.getMonth()+1).padStart(2,"0");return`${s}-${T}`};function we(){const[t,s]=useState(ke()),[T,oe]=useState(!0),[he,De]=useState([]),{parseMoney:xe,parseShipFeeFromNote:Ae,getShipFeeForItems:Ee,formatNumber:R,formatVND:de}=window.KTM.money,Pe=async()=>{oe(!0);try{const C=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(t)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA");De(Array.isArray(C)?C:[])}catch(C){console.error("Load stats error:",C),De([])}finally{oe(!1)}};useEffect(()=>{Pe()},[t]);const Q=React.useMemo(()=>{var p;const C={pending:0,processing:0,done:0,paid:0,other:0};let Ve=0,Le=0,qe=0,He=0,Me=0;const Se=n=>n.customer_id||n.phone||"unknown",Ke=n=>window.KTM.orders.getOrderItems(n),o=new Map,k=new Map,z=new Map;for(const n of he){const e=Ke(n);let i=0,c=0;for(const S of e){const ae=Number((S==null?void 0:S.quantity)||0)||0,le=xe(S==null?void 0:S.product_price),Ne=ae*le;i+=ae,c+=Ne;const ue=(S==null?void 0:S.product_id)||"unknown",ce=o.get(ue)||{product_id:ue,product_name:(S==null?void 0:S.product_name)||"\u2014",product_code:(S==null?void 0:S.product_code)||"",orders:0,quantity:0,revenue:0};ce.orders+=1,ce.quantity+=ae,ce.revenue+=Ne,o.set(ue,ce)}const d=Ee(e),f=Number((p=n==null?void 0:n.adjustment_amount)!=null?p:0)||0,l=c+(d.found?d.fee:0)+f,m=c+f;Ve+=i,Le+=l,He+=m;const v=n.status==="done"||n.status==="paid";n.status==="pending"?C.pending+=1:n.status==="processing"?C.processing+=1:n.status==="paid"?(C.paid+=1,C.done+=1,qe+=l,Me+=m):n.status==="done"?(C.done+=1,qe+=l,Me+=m):C.other+=1;const L=Se(n),O=k.get(L)||{key:L,customer_name:n.customer_name||"",phone:n.phone||"",orders:0,quantity:0,revenue:0};O.orders+=1,O.quantity+=i,O.revenue+=l,!O.customer_name&&n.customer_name&&(O.customer_name=n.customer_name),!O.phone&&n.phone&&(O.phone=n.phone),k.set(L,O);const j=n.created_at?new Date(n.created_at):null;if(j&&!Number.isNaN(j.getTime())){const S=`${j.getFullYear()}-${String(j.getMonth()+1).padStart(2,"0")}-${String(j.getDate()).padStart(2,"0")}`,ae=z.get(S)||{day:S,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};ae.orders+=1,ae.quantity+=i,ae.revenue+=l,v&&(ae.doneOrders+=1,ae.doneRevenue+=l),z.set(S,ae)}}const ge=Array.from(o.values()).sort((n,e)=>e.revenue-n.revenue),ve=Array.from(k.values()).sort((n,e)=>e.revenue-n.revenue),$e=Array.from(z.values()).sort((n,e)=>n.day.localeCompare(e.day)),te=k.size,_e=he.length?Math.round(Le/he.length):0,Ie=he.length?Ve/he.length:0,Ue=Math.round(Me*.05),a=Math.round(He*.05);return{statusCounts:C,totalQty:Ve,totalRevenue:Le,doneRevenue:qe,tempCommission:Ue,tempCommissionAll:a,products:ge,customers:ve,days:$e,uniqueCustomers:te,avgOrderValue:_e,avgQtyPerOrder:Ie}},[he,t]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:T}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:Pe,disabled:T},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:t,onChange:C=>s(C.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),R(he.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),R(Q.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),R(Q.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",R(Q.statusCounts.paid),"/",R(Q.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},R(he.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},de(Q.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},de(Q.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},de(Q.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},de(Q.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",Q.avgQtyPerOrder?Q.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},R(Q.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},R(Q.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},R(Q.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},R(Q.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},R(Q.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,R(Q.statusCounts.pending)),React.createElement("td",null,R(Q.statusCounts.processing)),React.createElement("td",null,R(Q.statusCounts.done)),React.createElement("td",null,R(Q.statusCounts.paid)),React.createElement("td",null,R(Q.statusCounts.other)),React.createElement("td",null,R(Q.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Q.products.slice(0,10).map(C=>React.createElement("div",{key:C.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.product_name),React.createElement("div",{className:"text-muted small text-truncate"},C.product_code?`#${C.product_code} \u2022 `:"",R(C.orders)," \u0111\u01A1n \u2022 ",R(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},de(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Q.products.slice(0,10).map(C=>React.createElement("tr",{key:C.product_id},React.createElement("td",null,C.product_name),React.createElement("td",null,C.product_code||"\u2014"),React.createElement("td",null,R(C.orders)),React.createElement("td",null,R(C.quantity)),React.createElement("td",{className:"fw-semibold"},de(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Q.customers.slice(0,10).map(C=>React.createElement("div",{key:C.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},C.phone||"\u2014"," \u2022 ",R(C.orders)," \u0111\u01A1n \u2022 ",R(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},de(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Q.customers.slice(0,10).map(C=>React.createElement("tr",{key:C.key},React.createElement("td",null,C.customer_name||"\u2014"),React.createElement("td",null,C.phone||"\u2014"),React.createElement("td",null,R(C.orders)),React.createElement("td",null,R(C.quantity)),React.createElement("td",{className:"fw-semibold"},de(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},Q.days.map(C=>React.createElement("div",{key:C.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},C.day),React.createElement("div",{className:"text-muted small"},R(C.orders)," \u0111\u01A1n \u2022 ",R(C.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",R(C.doneOrders)," \u2022 ",de(C.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},de(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,Q.days.map(C=>React.createElement("tr",{key:C.day},React.createElement("td",null,C.day),React.createElement("td",null,R(C.orders)),React.createElement("td",null,R(C.quantity)),React.createElement("td",{className:"fw-semibold"},de(C.revenue)),React.createElement("td",null,R(C.doneOrders)),React.createElement("td",{className:"fw-semibold"},de(C.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:N,onMenuChange:t=>{x(t),t==="albums"&&(ie(null),Y([]),B(null))},onLogout:Z,currentUser:_}),React.createElement("div",{className:"main-content"},N==="albums"&&!q&&React.createElement(AlbumList,{albums:M,loading:W,currentFolder:w,breadcrumb:H,onSelect:pe,onCreate:me,onEdit:fe,onDelete:ye,onBack:ne}),N==="search"&&React.createElement(SearchCenter,{showToast:ee,onNavigate:(t,s,T)=>{x(t),t==="orders"&&s==="create"&&(b(Date.now()),F((T==null?void 0:T.productId)||""))}}),N==="albums"&&q&&React.createElement(AlbumDetail,{album:q,parentAlbum:H.length>0?H[H.length-1]:null,onBack:()=>{if(q.parentId){const t=H.findIndex(s=>s.uuid===q.parentId);t>=0?J(H[t]):J(null)}else J(null)},onRefresh:()=>B(w==null?void 0:w.uuid),showToast:ee,onNavigateToFolder:t=>{Y(s=>[...s,q]),J(t)},onEditSubfolder:t=>{X(t),u(!0)}}),N==="videos"&&React.createElement(VideoList,{showToast:ee}),N==="products"&&React.createElement(ProductManager,{showToast:ee}),N==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:K,autoOpenCreateProductId:V,showToast:ee}),N==="stats"&&React.createElement(we,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${N==="search"?"active":""}`,onClick:t=>{t.preventDefault(),x("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${N==="albums"?"active":""}`,onClick:t=>{t.preventDefault(),x("albums"),J(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${N==="videos"?"active":""}`,onClick:t=>{t.preventDefault(),x("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${N==="products"?"active":""}`,onClick:t=>{t.preventDefault(),x("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${N==="orders"?"active":""}`,onClick:t=>{t.preventDefault(),x("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${N==="stats"?"active":""}`,onClick:t=>{t.preventDefault(),x("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:A,album:E,parentId:w==null?void 0:w.uuid,onClose:()=>u(!1),onSave:se}),React.createElement("div",{className:"toast-container"},P.map(t=>React.createElement(Toast,{key:t.id,message:t.message,type:t.type,onClose:()=>re(t.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:y,autoOpenCreateProductId:h,showToast:$}){const[D,_]=useState([]),[r,N]=useState(!0),[x,K]=useState(!1),[b,V]=useState(null),[F,M]=useState(""),[I,q]=useState(!1),[J,A]=useState(null),[u,E]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[X,W]=useState([""]),[g,P]=useState(null),G=useRef({}),[w,ie]=useState([]),[H,Y]=useState(null),Ce=useRef(null),Z=useRef(null),ee=useRef(0),re=useRef(null),B=useRef(0),me=3,fe=a=>{E({customer_name:"",phone:"",address:"",items:[{product_id:a||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),W([""]),A(null),P(null)};useEffect(()=>{const a=p=>{var e;if(g==null)return;const n=(e=G.current)==null?void 0:e[g];n&&!n.contains(p.target)&&P(null)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[g]);const se=a=>window.KTM.money.parseMoney(a),pe=a=>window.KTM.money.parseSignedMoney(a),ne=a=>window.KTM.money.formatVND(a),ye=a=>window.KTM.money.parseShipFeeFromNote(a),ke=a=>window.KTM.phone.isValid(a),we=a=>window.KTM.phone.normalize(a),t=async a=>{const p=we(a);if(!p)return;const n=++ee.current;A({status:"loading",phone:p});try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(p)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(ee.current!==n)return;if(e&&e.exists&&e.customer){A({status:"found",phone:p,customer:e.customer}),E(i=>we(i.phone)!==p?i:{...i,customer_name:e.customer.name||i.customer_name,address:e.customer.address||i.address});return}A({status:"not-found",phone:p})}catch(e){if(ee.current!==n)return;console.error("Customer lookup error:",e),A({status:"error",phone:p})}},s=a=>{const p=we(a);if(E(e=>({...e,phone:p})),Z.current&&(clearTimeout(Z.current),Z.current=null),p.length<me){A(null);return}Z.current=setTimeout(()=>{t(p)},350)},T=()=>{const a=we(u.phone);a.length<me||t(a)};useEffect(()=>(I?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[I]);const oe=Array.isArray(u.items)?u.items.length:0;useEffect(()=>{if(!I){B.current=oe;return}oe>B.current&&setTimeout(()=>{const a=re.current;a&&a.scrollTo({top:a.scrollHeight,behavior:"smooth"})},0),B.current=oe},[I,oe]),useEffect(()=>()=>{Z.current&&(clearTimeout(Z.current),Z.current=null)},[]),useEffect(()=>{Ee()},[]),useEffect(()=>{R()},[F]),useEffect(()=>{y&&Ce.current!==y&&(Ce.current=y,Pe(h))},[y]);const he=a=>a==="pending"?"Ch\u1EDD x\u1EED l\xFD":a==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":a==="done"?"Ho\xE0n th\xE0nh":a==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":a||"",De=a=>a==="pending"?"bg-secondary":a==="processing"?"bg-warning text-dark":a==="done"?"bg-success":a==="paid"?"bg-primary":"bg-light text-dark",xe=React.useMemo(()=>window.KTM.orders.sortOrders(D),[D]),Ae=a=>window.KTM.date.formatDateTime(a),Ee=async()=>{try{const a=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");ie(Array.isArray(a)?a:[])}catch(a){console.error("Load products error:",a),ie([])}},R=async()=>{N(!0);try{let a=`${API_BASE}/api/orders`;F&&(a+=`?month=${F}`);const p=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");_(Array.isArray(p)?p:[])}catch(a){console.error("Load orders error:",a),_([])}finally{N(!1)}},de=a=>{var n;Y(a.id);const p=Array.isArray(a.items)&&a.items.length?a.items.map(e=>{var i;return{product_id:(e==null?void 0:e.product_id)||"",quantity:Number((i=e==null?void 0:e.quantity)!=null?i:1)||1}}).filter(e=>e.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1}];E({customer_name:a.customer_name||"",phone:we(a.phone||""),address:a.address||"",items:p.length?p:[{product_id:"",quantity:1}],adjustment_amount:Number((n=a==null?void 0:a.adjustment_amount)!=null?n:0)||0,adjustment_note:(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),W(new Array(p.length?p.length:1).fill("")),A(null),q(!0),a.phone&&t(we(a.phone))};function Pe(a){Y(null),fe(a||""),q(!0)}const Q=()=>{x||(q(!1),Y(null),fe(""))},C=a=>{if(!a)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const p=String(a),n=w.find(e=>String(e==null?void 0:e.id)===p);return n?`${n.name}${n.code?` (${n.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Ve=a=>{const p=String(X[a]||"").trim().toLowerCase();return p?w.filter(n=>{const e=String((n==null?void 0:n.name)||"").toLowerCase(),i=String((n==null?void 0:n.code)||"").toLowerCase();return e.includes(p)||i.includes(p)}):w},Le=a=>{if(!a)return null;const p=String(a);return w.find(n=>String(n==null?void 0:n.id)===p)||null},qe=a=>window.KTM.orders.getOrderItems(a),He=a=>window.KTM.orders.getOrderTotalQty(a),Me=a=>window.KTM.orders.getOrderProductSummary(a,Le),Se=a=>window.KTM.orders.getOrderItemRows(a,Le),Ke=a=>window.KTM.orders.getOrderAdjustmentMoney(a),o=a=>{var m;const p=qe(a),n=Se(a),e=ge(p),i=z(p),c=i.fee,d=Ke(a),f=e+c+d,l=[];if(l.push(`\u0110\u01A0N H\xC0NG #${(m=a==null?void 0:a.id)!=null?m:""}`.trim()),a!=null&&a.customer_name&&l.push(`Kh\xE1ch: ${a.customer_name}`),a!=null&&a.phone&&l.push(`S\u0110T: ${a.phone}`),a!=null&&a.address&&l.push(`\u0110\u1ECBa ch\u1EC9: ${a.address}`),a!=null&&a.status&&l.push(`Tr\u1EA1ng th\xE1i: ${he(a.status)}`),a!=null&&a.created_at&&l.push(`Th\u1EDDi gian: ${Ae(a.created_at)}`),l.push(""),l.push("S\u1EA3n ph\u1EA9m:"),n.length)for(const v of n)l.push(`- ${v.name} x${v.qty}`);else{const v=Me(a);v&&v!=="\u2014"&&l.push(`- ${v}`)}return l.push(""),l.push(`T\u1EA1m t\xEDnh: ${ne(e)}`),l.push(`Ship: ${ne(i.found?c:0)}`),d!==0&&l.push(`\u0110i\u1EC1u ch\u1EC9nh: ${ne(d)}`),a!=null&&a.adjustment_note&&l.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${a.adjustment_note}`),l.push(`T\u1ED5ng: ${ne(f)}`),l.filter(Boolean).join(`
`)},k=async a=>{try{const p=o(a);await window.KTM.clipboard.writeText(p),typeof $=="function"?$("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(p){console.error(p),typeof $=="function"?$("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},z=a=>window.KTM.orders.getOrderShipInfo(a,Le),ge=a=>window.KTM.orders.getItemsSubtotal(a,Le),ve=a=>{var Ne;const p=[],n=[],e=String((a==null?void 0:a.customer_name)||"").trim(),i=we((a==null?void 0:a.phone)||""),c=String((a==null?void 0:a.address)||"").trim();e||p.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),i||p.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),i&&!ke(i)&&p.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),c||n.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const f=(Array.isArray(a==null?void 0:a.items)?a.items:[]).filter(ue=>ue&&ue.product_id);f.length===0&&p.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),f.some(ue=>{var Te;const ce=Number((Te=ue==null?void 0:ue.quantity)!=null?Te:0);return!Number.isFinite(ce)||ce<=0})&&p.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const m=new Set;let v=!1;for(const ue of f){const ce=String(ue.product_id||"").trim();if(ce){if(m.has(ce)){v=!0;break}m.add(ce)}}v&&n.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const L=ge(f),O=z(f),j=O!=null&&O.found?Number((Ne=O==null?void 0:O.fee)!=null?Ne:0):0,S=pe(a==null?void 0:a.adjustment_amount),ae=String((a==null?void 0:a.adjustment_note)||"").trim();O!=null&&O.found&&(j>=2e5||L>0&&j>L*.6)&&n.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ne(j)}`),S!==0&&!ae&&n.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const le=Math.abs(S);return(le>=5e5||L>0&&le>L*.5)&&S!==0&&n.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ne(S)}`),{errors:p,warnings:n,canSubmit:p.length===0}},$e=React.useMemo(()=>ve(u),[u,w]),te=React.useMemo(()=>{var Te;const a=String((u==null?void 0:u.customer_name)||"").trim(),p=we((u==null?void 0:u.phone)||""),n=String((u==null?void 0:u.address)||"").trim(),e=Array.isArray(u==null?void 0:u.items)?u.items:[],i=new Map;for(const be of e){const Je=String((be==null?void 0:be.product_id)||"").trim();Je&&i.set(Je,(i.get(Je)||0)+1)}const c=e.map(be=>{var Re;const Je=String((be==null?void 0:be.product_id)||"").trim(),We=Number((Re=be==null?void 0:be.quantity)!=null?Re:0),U=Je?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",je=Number.isFinite(We)&&We>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",Qe=Je&&(i.get(Je)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:U,qtyError:je,dupWarn:Qe}}),d=e.filter(be=>be&&be.product_id),f=ge(d),l=z(d),m=l!=null&&l.found?Number((Te=l==null?void 0:l.fee)!=null?Te:0):0,v=pe(u==null?void 0:u.adjustment_amount),L=String((u==null?void 0:u.adjustment_note)||"").trim(),O=Math.abs(v),j=v!==0&&!L?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",S=v!==0&&(O>=5e5||f>0&&O>f*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ne(v)}`:"",ae=l!=null&&l.found&&(m>=2e5||f>0&&m>f*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ne(m)}`:"",le=a?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Ne=p?ke(p)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",ue=n?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",ce=!le&&!Ne&&c.every(be=>!be.productError&&!be.qtyError);return{nameError:le,phoneError:Ne,addressWarn:ue,items:c,shipAbnormalWarn:ae,adjustmentNoteWarn:j,adjustmentAbnormalWarn:S,canSubmit:ce}},[u,w]),_e=async a=>{const p=(a==null?void 0:a.mode)||"close",n=ve(u);if(!n.canSubmit){const d=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof $=="function"?$(d,"danger"):alert(d);return}const e=we(u.phone),c=(Array.isArray(u.items)?u.items:[]).map(d=>{var f;return{product_id:(d==null?void 0:d.product_id)||"",quantity:Number((f=d==null?void 0:d.quantity)!=null?f:1)}}).filter(d=>d.product_id&&Number.isFinite(d.quantity)&&d.quantity>0);K(!0);try{const d=H?`${API_BASE}/api/orders/${H}`:`${API_BASE}/api/orders`,f=c[0],l={customer_name:u.customer_name,phone:e,address:u.address,adjustment_amount:pe(u.adjustment_amount),adjustment_note:(u.adjustment_note||"").trim(),product_id:f.product_id,quantity:f.quantity,status:u.status,items:c,...H?{id:H}:{}};H?await window.KTM.api.putJSON(d,l,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng"):await window.KTM.api.postJSON(d,l,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng"),p==="new"&&!H?(fe(""),Y(null),q(!0)):(fe(""),Y(null),q(!1)),R()}catch(d){console.error(d),typeof $=="function"?$(d.message,"danger"):alert(d.message);return}finally{K(!1)}},Ie=a=>window.KTM.orders.getOrderTotalMoney(a,Le),Ue=async a=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){V(a);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${a}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),R()}catch(p){console.error(p),typeof $=="function"?$(p.message,"danger"):alert(p.message)}finally{V(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:r&&!I||x||!!b}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Pe,disabled:x||!!b},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:F,onChange:a=>M(a.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),F&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{M("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:r},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:R,disabled:r},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},D.length," \u0111\u01A1n")),r?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):D.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},xe.map(a=>React.createElement("div",{key:a.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},a.customer_name),React.createElement("div",{className:"text-muted small"},a.phone),a.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},a.address)),React.createElement("span",{className:`badge ${De(a.status)}`},he(a.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const p=Se(a);return p.length?React.createElement("div",{className:"mt-1"},p.map((n,e)=>React.createElement("div",{key:e,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},n.name),React.createElement("div",{className:"text-muted",style:{flexShrink:0}},"x",n.qty)))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Me(a))})()),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},He(a))),(Ke(a)!==0||((a==null?void 0:a.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ne(Ke(a))),((a==null?void 0:a.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(a.adjustment_note||"").trim(),")"):null),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},ne(Ie(a)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",Ae(a.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>de(a),disabled:x||!!b},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>k(a),disabled:x||!!b},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>Ue(a.id),disabled:x||b===a.id},b===a.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,xe.map(a=>React.createElement("tr",{key:a.id},React.createElement("td",null,a.customer_name),React.createElement("td",null,a.phone),React.createElement("td",null,Me(a)),React.createElement("td",null,He(a)),React.createElement("td",{className:"fw-semibold"},ne(Ie(a))),React.createElement("td",null,React.createElement("span",{className:`badge ${De(a.status)}`},he(a.status))),React.createElement("td",null,Ae(a.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>de(a),disabled:x||!!b},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>k(a),disabled:x||!!b},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>Ue(a.id),disabled:x||b===a.id},b===a.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),I&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),H?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Q})),React.createElement("form",{onSubmit:a=>{a.preventDefault(),_e({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:re},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:u.customer_name,onChange:a=>E({...u,customer_name:a.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!te.nameError&&React.createElement("div",{className:"form-text text-danger"},te.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",value:u.phone,onChange:a=>s(a.target.value),onBlur:T,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!te.phoneError&&React.createElement("div",{className:"form-text text-danger"},te.phoneError),(J==null?void 0:J.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(J==null?void 0:J.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(J==null?void 0:J.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(J==null?void 0:J.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:u.status,onChange:a=>E({...u,status:a.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:u.address,onChange:a=>E({...u,address:a.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!te.addressWarn&&React.createElement("div",{className:"form-text text-warning"},te.addressWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:u.adjustment_amount,onChange:a=>E({...u,adjustment_amount:a.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!te.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},te.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:u.adjustment_note,onChange:a=>E({...u,adjustment_note:a.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!te.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},te.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{E(a=>({...a,items:[...Array.isArray(a.items)?a.items:[],{product_id:"",quantity:1}]})),W(a=>[...Array.isArray(a)?a:[],""])},disabled:x},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(u.items)?u.items:[{product_id:"",quantity:1}]).map((a,p)=>React.createElement("div",{key:p,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:n=>{G.current[p]=n}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{P(n=>n===p?null:p),setTimeout(()=>{const n=document.getElementById(`order-product-search-${p}`);n&&n.focus()},0)}},React.createElement("span",{className:a.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},C(a.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),g===p&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${p}`,className:"form-control",value:X[p]||"",onChange:n=>{const e=n.target.value;W(i=>{const c=Array.isArray(i)?[...i]:[];return c[p]=e,c})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),Ve(p).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):Ve(p).map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const e=String(n.id);E(i=>{const c=Array.isArray(i.items)?[...i.items]:[];return c[p]={...c[p]||{quantity:1},product_id:e},{...i,items:c}}),P(null)}},n.name,n.code?` (${n.code})`:""))),React.createElement("select",{className:"form-select",value:a.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),w.map(n=>React.createElement("option",{key:n.id,value:n.id},n.name)))),(()=>{var e;const n=(e=te.items)==null?void 0:e[p];return n?React.createElement(React.Fragment,null,!!n.productError&&React.createElement("div",{className:"form-text text-danger"},n.productError),!!n.dupWarn&&React.createElement("div",{className:"form-text text-warning"},n.dupWarn)):null})()),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:a.quantity,onChange:n=>{const e=n.target.value;E(i=>{const c=Array.isArray(i.items)?[...i.items]:[];return c[p]={...c[p]||{product_id:""},quantity:e},{...i,items:c}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var e;const n=(e=te.items)==null?void 0:e[p];return n&&n.qtyError?React.createElement("div",{className:"form-text text-danger"},n.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{E(n=>{const e=Array.isArray(n.items)?[...n.items]:[];return e.splice(p,1),{...n,items:e.length?e:[{product_id:"",quantity:1}]}}),W(n=>{const e=Array.isArray(n)?[...n]:[];return e.splice(p,1),e.length?e:[""]}),P(n=>n==null?n:n===p?null:n>p?n-1:n)},disabled:x||(Array.isArray(u.items)?u.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const p=(Array.isArray(u.items)?u.items:[]).filter(d=>d==null?void 0:d.product_id),n=ge(p),e=z(p),i=pe(u.adjustment_amount),c=n+(e.found?e.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ne(n))),e.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ne(e.fee))),!!te.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},te.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ne(i))),(u.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(u.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ne(c)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Q,disabled:x,style:{borderRadius:10}},"H\u1EE7y"),!H&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>_e({mode:"new"}),disabled:x||!te.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:x||!te.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},x?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

