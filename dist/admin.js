const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:N,error:b}){const[C,q]=useState(""),[H,v]=useState(""),[D,G]=useState(!1),[ae,P]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),b&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),b),React.createElement("form",{onSubmit:async Ne=>{Ne.preventDefault(),G(!0),await N(C,H),G(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:C,onChange:Ne=>q(Ne.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:ae?"text":"password",className:"form-control",value:H,onChange:Ne=>v(Ne.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>P(!ae)},React.createElement("i",{className:`fas fa-eye${ae?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:D},D?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:N,type:b,onClose:C}){return useEffect(()=>{const q=setTimeout(C,3e3);return()=>clearTimeout(q)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${b} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},N),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:C})))}function Loading({show:N}){return N?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:N,onMenuChange:b,onLogout:C,currentUser:q}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(v=>React.createElement("a",{key:v.id,href:"#",className:`nav-link ${N===v.id?"active":""} ${v.disabled?"opacity-50":""} ${v.highlight?"text-warning":""}`,onClick:D=>{D.preventDefault(),v.disabled||b(v.id)}},React.createElement("i",{className:`fas ${v.icon}`})," ",v.label,v.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),v.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),C&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:C,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(N){const b=typeof N=="number"?N:parseFloat(String(N!=null?N:"").trim());return Number.isFinite(b)?Math.max(0,Math.min(100,b)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var N;try{const b=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!b)return{ship_percent:DEFAULT_SHIP_PERCENT};const C=JSON.parse(b);return{ship_percent:normalizeShipPercent((N=C==null?void 0:C.ship_percent)!=null?N:C==null?void 0:C.shipPercent)}}catch(b){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(N){var b;try{const C={ship_percent:normalizeShipPercent((b=N==null?void 0:N.ship_percent)!=null?b:N==null?void 0:N.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(C)),C}catch(C){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var b;const N=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((b=N==null?void 0:N.ship_percent)!=null?b:N==null?void 0:N.shipPercent)}}async function saveAdminSettingsToServer(N){var q,H,v;const b={ship_percent:normalizeShipPercent((q=N==null?void 0:N.ship_percent)!=null?q:N==null?void 0:N.shipPercent)},C=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,b,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((v=(H=C==null?void 0:C.ship_percent)!=null?H:C==null?void 0:C.shipPercent)!=null?v:b.ship_percent)}}function AlbumList({albums:N,onSelect:b,onCreate:C,onEdit:q,onDelete:H,loading:v,currentFolder:D,onBack:G,breadcrumb:ae}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},D&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:G},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),D?D.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:C},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),ae&&ae.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:P=>{P.preventDefault(),G("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ae.map((P,ce)=>React.createElement("li",{key:P.id,className:`breadcrumb-item ${ce===ae.length-1?"active":""}`},ce===ae.length-1?P.title:React.createElement("a",{href:"#",onClick:Ne=>{Ne.preventDefault(),G(P)},className:"text-warning"},P.title))))),v?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):N.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},D?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},N.map(P=>React.createElement("div",{key:P.uuid||P.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>b(P)},P.cover?React.createElement("img",{src:P.cover,className:"album-cover",alt:P.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},P.title),React.createElement("small",{className:"text-muted"},P.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),P.subfolderCount),P.subfolderCount>0&&P.count>0&&" \u2022 ",P.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),P.count),P.subfolderCount===0&&P.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:ce=>{ce.stopPropagation(),q(P)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:ce=>{ce.stopPropagation(),H(P)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:N,album:b,onClose:C,onSave:q,parentId:H}){const[v,D]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[G,ae]=useState(!1),[P,ce]=useState(!1),Ne=useRef(null);useEffect(()=>{D(b?{slug:b.id||"",title:b.title||"",description:b.description||"",cover_url:b.cover||"",parent_id:b.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:H||null})},[b,N,H]);const Y=async Q=>{Q.preventDefault(),ae(!0),await q(v),ae(!1)},le=Q=>Q.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),xe=async Q=>{const we=Q.type==="image/heic"||Q.type==="image/heif"||/\.heic$/i.test(Q.name);if(Q.size<=2097152&&!we)return Q;try{const he=await createImageBitmap(Q),De=document.createElement("canvas");let be=he.width,Ae=he.height;const ve=800;return(be>ve||Ae>ve)&&(be>Ae?(Ae=Math.round(Ae/be*ve),be=ve):(be=Math.round(be/Ae*ve),Ae=ve)),De.width=be,De.height=Ae,De.getContext("2d").drawImage(he,0,0,be,Ae),he.close(),new Promise((Ze,Ce)=>{De.toBlob(_=>{_?Ze(new File([_],Q.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ce(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(he){throw console.error("Compress cover error:",he),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Z=async Q=>{var he;const ie=Q.target.files[0];if(!ie)return;if(!(ie.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ie.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ce(!0);try{const De=await xe(ie),be=await window.KTM.cloudinary.uploadImage({file:De,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!be.secure_url)throw console.error("Cloudinary error:",be),new Error(((he=be.error)==null?void 0:he.message)||"Upload failed");D(Ae=>({...Ae,cover_url:be.secure_url}))}catch(De){console.error("Cover upload error:",De),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+De.message)}ce(!1),Q.target.value=""};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},b?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:C})),React.createElement("form",{onSubmit:Y},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:v.title,onChange:Q=>D({...v,title:Q.target.value,slug:v.slug||le(Q.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:v.slug,onChange:Q=>D({...v,slug:Q.target.value}),required:!0,disabled:!!b}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:v.description,onChange:Q=>D({...v,description:Q.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},v.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:v.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>D(Q=>({...Q,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:Ne,type:"file",accept:"image/*",className:"d-none",onChange:Z}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var Q;return(Q=Ne.current)==null?void 0:Q.click()},disabled:P},P?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:v.cover_url,onChange:Q=>D({...v,cover_url:Q.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:C},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:G||P},G?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:N,allAlbums:b,currentAlbumId:C,targetAlbum:q,onSelect:H,level:v=0}){const[D,G]=useState(!0),ae=N.uuid||N.id,P=ae===C,ce=q===ae,Ne=b.filter(le=>le.parentId===ae),Y=Ne.length>0;return React.createElement("div",{style:{marginLeft:v*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${ce?"bg-info text-white":P?"bg-light text-muted":"hover-bg"}`,style:{cursor:P?"not-allowed":"pointer",opacity:P?.5:1,transition:"background 0.2s"},onClick:()=>!P&&H(ae)},Y&&React.createElement("i",{className:`fas fa-chevron-${D?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:le=>{le.stopPropagation(),G(!D)}}),!Y&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${ce?"-open":""} me-2 ${ce?"":"text-warning"}`}),React.createElement("span",{className:"small"},N.title),P&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),N.count>0&&!P&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},N.count)),D&&Y&&React.createElement("div",null,Ne.map(le=>React.createElement(FolderTreeItem,{key:le.uuid||le.id,folder:le,allAlbums:b,currentAlbumId:C,targetAlbum:q,onSelect:H,level:v+1}))))}function AlbumDetail({album:N,onBack:b,onRefresh:C,showToast:q,onNavigateToFolder:H,onEditSubfolder:v,parentAlbum:D}){const[G,ae]=useState([]),[P,ce]=useState([]),[Ne,Y]=useState(!0),[le,xe]=useState(!1),[Z,Q]=useState(""),[ie,we]=useState([]),[he,De]=useState([]),[be,Ae]=useState({}),[ve,Ie]=useState(null),[Ze,Ce]=useState(!1),[_,u]=useState(""),[A,O]=useState(!1),B=useRef(null),K=useRef(null),[se,U]=useState(!1),[F,ee]=useState([]),[d,de]=useState([]),[Ke,qe]=useState(""),[o,f]=useState(!1),Se=async(m,k=2)=>{const y=k*1024*1024,Fe=m.type==="image/heic"||m.type==="image/heif"||/\.heic$/i.test(m.name);if(m.size<=y&&!Fe)return m;try{const Ve=await createImageBitmap(m),Je=document.createElement("canvas");let et=Ve.width,tt=Ve.height;const at=1200;return(et>at||tt>at)&&(et>tt?(tt=Math.round(tt/et*at),et=at):(et=Math.round(et/tt*at),tt=at)),Je.width=et,Je.height=tt,Je.getContext("2d").drawImage(Ve,0,0,et,tt),Ve.close(),new Promise((Ct,ut)=>{Je.toBlob(Oe=>{Oe?Ct(new File([Oe],m.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ut(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Ve){throw console.error("Compress error:",Ve),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{h(),R()},[N.id,N.uuid]);const h=async()=>{Y(!0);try{const m=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ae(m.images||[]);const k=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ce(Array.isArray(k)?k:[])}catch(m){console.error(m),q("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}Y(!1)},R=async()=>{try{const m=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");de(Array.isArray(m)?m:[])}catch(m){console.error("Error loading albums:",m)}},j=m=>{ee(k=>k.includes(m)?k.filter(y=>y!==m):[...k,m])},Me=async()=>{if(!Ke||F.length===0){q("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}f(!0);let m=0;for(const k of F)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${k}`,{album_id:Ke},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),m++}catch(y){console.error("Move error:",y)}f(!1),U(!1),ee([]),qe(""),m>0?(q("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),h(),C()):q("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[st,je]=useState(!1),Re=async()=>{if(F.length===0||!confirm(`X\xF3a ${F.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;je(!0);let m=0;for(const k of F)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${k}`,"L\u1ED7i x\xF3a \u1EA3nh"),m++}catch(y){console.error("Delete error:",y)}je(!1),ee([]),m>0?(q(`\u0110\xE3 x\xF3a ${m} \u1EA3nh!`,"success"),h(),C()):q("X\xF3a th\u1EA5t b\u1EA1i","danger")},Xe=()=>{F.length===G.length?ee([]):ee(G.map(m=>m.id))},mt=async()=>{if(_.trim()){O(!0);try{const m=_.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:m+"-"+Date.now(),title:_,parent_id:N.uuid||N.id},"L\u1ED7i t\u1EA1o folder"),q("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),u(""),Ce(!1),h(),C()}catch(m){q(m.message,"danger")}O(!1)}},_t=async m=>{if(confirm(`X\xF3a folder "${m.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${m.uuid||m.id}`,"L\u1ED7i x\xF3a folder"),q("\u0110\xE3 x\xF3a folder","success"),h(),C()}catch(k){q("L\u1ED7i x\xF3a folder","danger")}},gt=m=>{const k=Array.from(m).filter(y=>y.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(y.name));we(y=>[...y,...k]),k.forEach(y=>{const Fe=new FileReader;Fe.onload=Ve=>{De(Je=>[...Je,{file:y,preview:Ve.target.result}])},Fe.readAsDataURL(y)})},jt=m=>{we(k=>k.filter((y,Fe)=>Fe!==m)),De(k=>k.filter((y,Fe)=>Fe!==m))},Rt=async m=>{var y;const k=await window.KTM.cloudinary.uploadImage({file:m,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${N.id}`});if(!k.secure_url)throw console.error("Cloudinary error:",k),new Error(((y=k.error)==null?void 0:y.message)||"Upload failed");return k},It=async()=>{if(ie.length===0)return;xe(!0);let m=0;for(let k=0;k<ie.length;k++)try{Q(`\u0110ang x\u1EED l\xFD ${k+1}/${ie.length}...`);const y=await Se(ie[k],2);Q(`\u0110ang upload ${k+1}/${ie.length}...`);const Fe=await Rt(y);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${N.id}`,{url:Fe.secure_url,caption:be[k]||ie[k].name.replace(/\.[^/.]+$/,""),sort_order:G.length+k},"L\u1ED7i l\u01B0u \u1EA3nh"),m++}catch(y){console.error("Upload error:",y)}xe(!1),Q(""),we([]),De([]),Ae({}),m>0?(q(`\u0110\xE3 upload ${m} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),h(),C()):q("Upload th\u1EA5t b\u1EA1i","danger")},ye=async(m,k)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${m}`,"L\u1ED7i x\xF3a \u1EA3nh"),q("\u0110\xE3 x\xF3a \u1EA3nh","success"),h(),C()}catch(y){q("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Ye=m=>{var k;m.preventDefault(),(k=K.current)==null||k.classList.add("dragover")},lt=()=>{var m;(m=K.current)==null||m.classList.remove("dragover")},xt=m=>{var k;m.preventDefault(),(k=K.current)==null||k.classList.remove("dragover"),gt(m.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:b},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},N.title),React.createElement("small",{className:"text-muted"},P.length>0&&React.createElement("span",null,P.length," folder \u2022 "),G.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Ce(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),Ze&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:_,onChange:m=>u(m.target.value),onKeyPress:m=>m.key==="Enter"&&mt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:mt,disabled:A||!_.trim()},A?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Ce(!1),u("")}},"H\u1EE7y")))),P.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},P.map(m=>React.createElement("div",{key:m.uuid||m.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>H&&H(m)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},m.title),React.createElement("small",{className:"text-muted"},m.subfolderCount>0&&React.createElement("span",null,m.subfolderCount," folder"),m.subfolderCount>0&&m.count>0&&" \u2022 ",m.count>0&&React.createElement("span",null,m.count," \u1EA3nh"),m.subfolderCount===0&&m.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:k=>{k.stopPropagation(),v&&v(m)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:k=>{k.stopPropagation(),_t(m)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:K,className:"upload-zone",onClick:()=>{var m;return(m=B.current)==null?void 0:m.click()},onDragOver:Ye,onDragLeave:lt,onDrop:xt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:B,type:"file",multiple:!0,accept:"image/*",onChange:m=>gt(m.target.files)})),he.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},he.map((m,k)=>React.createElement("div",{key:k,className:"upload-preview-item"},React.createElement("img",{src:m.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>jt(k)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:It,disabled:le},le?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Z||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",ie.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",G.length,")"),G.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Xe},F.length===G.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),F.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},F.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>U(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Re,disabled:st},st?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ee([])},React.createElement("i",{className:"fas fa-times"})))),Ne?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):G.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},G.map((m,k)=>React.createElement("div",{key:k,className:`image-item ${F.includes(m.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>j(m.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:F.includes(m.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:F.includes(m.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},F.includes(m.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:m.src,alt:m.caption,style:{opacity:F.includes(m.id)?.7:1,border:F.includes(m.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:y=>{y.stopPropagation(),ye(m.id,k)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),m.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},m.caption)))))),se&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",F.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>U(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},d.filter(m=>!m.parentId).map(m=>React.createElement(FolderTreeItem,{key:m.uuid||m.id,folder:m,allAlbums:d,currentAlbumId:N.uuid||N.id,targetAlbum:Ke,onSelect:qe})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>U(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:Me,disabled:!Ke||o},o?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),ve&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Ie(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Ie(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:ve.src,alt:ve.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:m=>m.stopPropagation()}),ve.caption&&React.createElement("div",{className:"text-white text-center mt-2"},ve.caption)))))}function SearchCenter({showToast:N,onNavigate:b}){const[C,q]=useState(""),[H,v]=useState([]),[D,G]=useState([]),[ae,P]=useState([]),[ce,Ne]=useState("all"),[Y,le]=useState(null),[xe,Z]=useState("list"),[Q,ie]=useState(!0),[we,he]=useState([]),[De,be]=useState([]),Ae=useRef(null),[ve,Ie]=useState(!0),[Ze,Ce]=useState(!1),_=useRef(null),[u,A]=useState(!1),[O,B]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[K,se]=useState(""),[U,F]=useState(!1),ee=useRef(null),d=useRef(null),[de,Ke]=useState(null),[qe,o]=useState(!1),[f,Se]=useState(null),[h,R]=useState(!1),[j,Me]=useState(!1),[st,je]=useState(null),[Re,Xe]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),mt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],_t=n=>{var S,w;n._type==="product"&&(Se(n),Xe({name:n.name||"",code:n.code||"",price:n.price||"",image:n.image||"",category:n.category||"",note:n.note||"",commission_percent:(w=(S=n.commission_percent)!=null?S:n.commissionPercent)!=null?w:""}),o(!0))},gt=async()=>{if(f)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${f.id}`,Re,"L\u1ED7i c\u1EADp nh\u1EADt"),N("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),o(!1),Se(null),Ye()}catch(n){N(n.message,"danger")}},jt=async n=>{const S=n._type==="product"?"s\u1EA3n ph\u1EA9m":n._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${S} "${n.name}"?`))try{let w="";n._type==="product"?w=`${API_BASE}/api/products?id=${n.id}`:n._type==="album"?w=`${API_BASE}/api/images/${n.id}`:n._type==="video"&&(w=`${API_BASE}/api/videos/${n.id}`),await window.KTM.api.deleteJSON(w,"L\u1ED7i x\xF3a"),N(`\u0110\xE3 x\xF3a ${S}`,"success"),Ye()}catch(w){N(w.message,"danger")}},Rt=async n=>{try{const S=st?`${API_BASE}/api/products?id=${st.id}`:`${API_BASE}/api/products`;st?await window.KTM.api.putJSON(S,n,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(S,n,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(st?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Me(!1),je(null),Ye()}catch(S){N(S.message,"danger")}},It="ktm_admin_data_cache_v1",ye=1e3*60*10,Ye=async()=>{let n=null,S=!1;const w=window.KTM.cache.read(It,{ttlMs:ye,validate:Array.isArray});w.hit?(n=w.value,console.log("[CACHE] Using cache, items:",n.length),G(n),v(n),ie(!1),S=!0):w.status==="miss"?console.log("[CACHE] No cache found"):w.status==="expired"||w.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):w.status==="error"&&console.error("[CACHE] Error parsing cache"),S||ie(!0);try{const V=async(Ge,Pe)=>{try{const it=await window.KTM.api.getJSON(Ge,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return it!=null?it:Pe}catch(it){return Pe}},[z,$,x]=await Promise.all([V(`${API_BASE}/api/products`,[]),V(`${API_BASE}/api/albums`,[]),V(`${API_BASE}/api/video-folders?withVideos=true`,[])]),J=Array.isArray(z)?z.map(Ge=>({...Ge,_type:"product",_source:"database"})):[];he($);let oe=[];Array.isArray($)&&$.length>0&&(await Promise.all($.map(Pe=>V(`${API_BASE}/api/albums/${Pe.id}`,{})))).forEach((Pe,it)=>{const ne=$[it];Pe.images&&Pe.images.length>0&&Pe.images.forEach(Te=>{oe.push({id:Te.id,name:Te.caption||"\u1EA2nh t\u1EEB "+ne.title,image:Te.src,folder:ne.title,_type:"album",_source:"database"})})}),be(x);let $e=[];Array.isArray(x)&&x.forEach(Ge=>{Ge.videos&&Ge.videos.forEach(Pe=>{$e.push({id:Pe.id,name:Pe.title,folder:Ge.name,image:Pe.thumb,youtubeId:Pe.youtubeId,url:Pe.url,_type:"video",_source:"database"})})});const me=[...J,...oe,...$e];(!n||JSON.stringify(me)!==JSON.stringify(n))&&(G(me),v(me),window.KTM.cache.write(It,me))}catch(V){console.error("Song song fetch error:",V)}ie(!1)};useEffect(()=>{Ye(),setTimeout(()=>{var n;return(n=Ae.current)==null?void 0:n.focus()},100)},[]);const lt=n=>{try{return String(n!=null?n:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(S){return String(n!=null?n:"").toLowerCase()}},xt=n=>{const w=lt(n).trim().split(/\s+/).filter(Boolean),V=w.includes("anh"),z=w.includes("video"),$=w.filter(oe=>oe!=="anh"&&oe!=="video"),x=$.join(" "),J=new Set(["product"]);return V&&J.add("album"),z&&J.add("video"),{allowedTypes:J,includeAlbum:V,includeVideo:z,contentTokens:$,cleanedQuery:x}},m=(n,S,w)=>{var Ge,Pe,it,ne,Te;const V=Array.isArray(S)?S:[],z=lt(w).trim();if(!V.length&&!z)return 0;const $=lt((Ge=n==null?void 0:n.name)!=null?Ge:""),x=lt((Pe=n==null?void 0:n.code)!=null?Pe:""),J=lt((it=n==null?void 0:n.category)!=null?it:""),oe=lt((ne=n==null?void 0:n.note)!=null?ne:""),$e=lt((Te=n==null?void 0:n.folder)!=null?Te:"");if(!`${$} ${x} ${J} ${oe} ${$e}`.trim())return 0;let fe=0;z&&($===z&&(fe+=220),$.includes(z)&&(fe+=140),$.startsWith(z)&&(fe+=160),x&&x===z&&(fe+=180),x&&x.includes(z)&&(fe+=90));for(const pt of V){if(!pt)continue;const vt=new RegExp(`(?:^|\\s)${pt.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);$.includes(pt)&&(fe+=35),vt.test($)&&(fe+=25),x&&x.includes(pt)&&(fe+=20),x&&vt.test(x)&&(fe+=10),J&&J.includes(pt)&&(fe+=12),$e&&$e.includes(pt)&&(fe+=12),oe&&oe.includes(pt)&&(fe+=6)}return fe>0&&$&&(fe+=Math.max(0,10-Math.min(10,Math.floor($.length/10)))),fe},k=(n,S,w)=>{const V=Array.isArray(n)?n:[];return V.length?V.map(($,x)=>({it:$,idx:x,score:m($,S,w)})).sort(($,x)=>x.score!==$.score?x.score-$.score:$.idx-x.idx).map($=>$.it):[]},y=async(n,S)=>{if(!(!ve||S.length===0)){Ce(!0);try{const w=S.map(z=>({id:z.id,name:z.name,price:z.price,category:z.category,note:z.note,folder:z.folder,_type:z._type})),V=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:n,products:w},"AI Search error");if(V&&V.matchedIds&&V.matchedIds.length>0){const{contentTokens:z,cleanedQuery:$}=xt(n),x=new Set(V.matchedIds),J=S.filter(oe=>x.has(oe.id)).sort((oe,$e)=>m($e,z,$)-m(oe,z,$));J.length>0&&v(J)}else V&&V.matchedIds&&V.matchedIds.length===0&&v([])}catch(w){console.error("AI Search error:",w)}Ce(!1)}},Fe=n=>{if(q(n),_.current&&clearTimeout(_.current),!n.trim()){Ve(ce);return}const{allowedTypes:S,contentTokens:w,cleanedQuery:V}=xt(n),z=D.filter(x=>{if(!S.has(x==null?void 0:x._type))return!1;if(w.length===0)return!0;const J=lt(Object.entries(x).filter(([oe])=>!oe.startsWith("_")).map(([,oe])=>String(oe||"")).join(" "));return w.some(oe=>J.includes(oe))});let $=z;ce!=="all"&&($=z.filter(x=>(x.category||x._type)===ce)),v(k($,w,V)),ve&&V.length>=3&&(_.current=setTimeout(()=>{y(V,$)},500))},Ve=n=>{Ne(n);const{allowedTypes:S,contentTokens:w}=xt(C),{cleanedQuery:V}=xt(C);let z=D.filter($=>S.has($==null?void 0:$._type));n!=="all"&&(z=z.filter($=>($.category||$._type)===n)),C.trim()&&w.length>0&&(z=z.filter($=>{const x=lt(Object.entries($).filter(([J])=>!J.startsWith("_")).map(([,J])=>String(J||"")).join(" "));return w.every(J=>x.includes(J))})),v(k(z,w,V))},Je=(n,S)=>{window.KTM.clipboard.writeText(n).then(()=>{le(S),N("\u0110\xE3 copy!","success"),setTimeout(()=>le(null),1500)})},et=async(n,S)=>{try{await window.KTM.clipboard.writeImageFromUrl(n),le(S+"-img"),N("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>le(null),1500)}catch(w){Je(n,S+"-img")}},tt=n=>{let S=n.toLowerCase();const w=[],V=D.filter(x=>x._type==="product");if(S.includes("ty")||S.includes("xy lanh")){if(S.includes("gi\u1EEFa")||S.includes("giua")){const x=V.find(J=>{var oe;return(oe=J.name)==null?void 0:oe.toLowerCase().includes("xy lanh gi\u1EEFa")});x&&!w.find(J=>J.id===x.id)&&w.push(x)}if(S.includes("nghi\xEAng")||S.includes("nghieng")){const x=V.find(J=>{var oe;return(oe=J.name)==null?void 0:oe.toLowerCase().includes("xy lanh nghi\xEAng")});x&&!w.find(J=>J.id===x.id)&&w.push(x)}if(S.includes("\u1EE7i")||S.includes("ui")){const x=V.find(J=>{var oe;return(oe=J.name)==null?void 0:oe.toLowerCase().includes("xy lanh \u1EE7i")});x&&!w.find(J=>J.id===x.id)&&w.push(x)}}const z=S.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(z){const x=z[1],J=z[2],oe=V.find($e=>{var fe;const me=((fe=$e.name)==null?void 0:fe.toLowerCase())||"";return me.includes("combo")&&me.includes(`${x} tay`)&&(me.includes(`${J} xy`)||me.includes(`${J} xylanh`))});if(oe&&!w.find($e=>$e.id===oe.id))w.push(oe);else{const $e=V.find(me=>{var Ge;const fe=((Ge=me.name)==null?void 0:Ge.toLowerCase())||"";return fe.includes("combo")&&fe.includes(`${x} tay`)});$e&&!w.find(me=>me.id===$e.id)&&w.push($e)}}if(S.includes("combo")&&!z){const x=S.match(/combo.*?(\d+)\s*tay/);if(x){const J=x[1];V.filter($e=>{var fe;const me=((fe=$e.name)==null?void 0:fe.toLowerCase())||"";return me.includes("combo")&&me.includes(`${J} tay`)}).forEach($e=>{w.find(me=>me.id===$e.id)||w.push($e)})}}const $=S.match(/van\s*(\d+)\s*tay/);if($&&!S.includes("ty")&&!S.includes("combo")){const x=$[1],J=V.find(oe=>{var me;const $e=((me=oe.name)==null?void 0:me.toLowerCase())||"";return $e.includes(`van ${x} tay`)&&!$e.includes("combo")});J&&!w.find(oe=>oe.id===J.id)&&w.push(J)}return w.slice(0,4)},at=async n=>{if(!n.trim())return;const S={role:"user",content:n,attachments:[]};B(V=>[...V,S]),se(""),F(!0);const w=tt(n);setTimeout(()=>{var V;return(V=ee.current)==null?void 0:V.scrollIntoView({behavior:"smooth"})},100);try{const z=D.filter(me=>me._type==="product").map(me=>{let fe=`- ${me.name}`;return me.code&&(fe+=` (M\xE3: ${me.code})`),me.price&&(fe+=` - Gi\xE1: ${me.price.replace(/[đ\s]/g,"")}\u0111`),me.category&&(fe+=` [${me.category}]`),me.note&&(fe+=` (${me.note})`),fe}).join(`
`),x=O.slice(-6).map(me=>`${me.role==="user"?"Kh\xE1ch":"AI"}: ${me.content}`).join(`
`),J=x?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${x}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${z}`:z,$e=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:n,context:J,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";B(me=>[...me,{role:"assistant",content:$e,attachments:w}])}catch(V){console.error("AI Error:",V);const z=n.toLowerCase(),$=D.filter(J=>{const oe=Object.values(J).join(" ").toLowerCase();return z.split(" ").some($e=>oe.includes($e))});let x="";$.length>0?(x=`T\xECm th\u1EA5y ${$.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,$.slice(0,5).forEach(J=>{x+=`\u2022 ${J.name}`,J.price&&(x+=` - ${J.price.replace(/[đ\s]/g,"")}\u0111`),J.note&&(x+=` (${J.note})`),x+=`
`}),$.length>5&&(x+=`
...v\xE0 ${$.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):x='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',B(J=>[...J,{role:"assistant",content:x,attachments:$.slice(0,4)}])}F(!1),setTimeout(()=>{var V,z;(V=ee.current)==null||V.scrollIntoView({behavior:"smooth"}),(z=d.current)==null||z.focus()},100)};function St({show:n,product:S,categories:w,onClose:V,onSave:z}){const[$,x]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[]}),[J,oe]=useState(!1),[$e,me]=useState(!1),fe=useRef(null),Ge=I=>window.KTM.money.formatVNDInputDigits(I),Pe=I=>{const E=window.KTM.money.getDigits(String(I!=null?I:"")),X=Number(E);return E&&Number.isFinite(X)?Math.trunc(X):0},it=(I,E)=>{if(I==null||I==="")return[];let X=I;if(typeof X=="string"){const re=X.trim();if(!re)return[];try{X=JSON.parse(re)}catch(pe){return[]}}if(!Array.isArray(X))return[];const ue=Pe(E);return X.map(re=>{var te;if(!re||typeof re!="object")return null;const pe=String((te=re.name)!=null?te:"").trim(),ke=(Array.isArray(re.options)?re.options:[]).map(_e=>{var We,nt,$t,wt,kt,Tt,qt;if(!_e||typeof _e!="object")return null;const Be=String((We=_e.label)!=null?We:"").trim();if(!Be)return null;const ze=(kt=(wt=($t=(nt=_e.price)!=null?nt:_e.priceValue)!=null?$t:_e.unit_price)!=null?wt:_e.unitPrice)!=null?kt:null,Ue=Number(ze);let dt=Number.isFinite(Ue)?Math.trunc(Ue):null;if(dt==null){const Pt=(qt=(Tt=_e.price_delta)!=null?Tt:_e.priceDelta)!=null?qt:null,Kt=Number(Pt);Number.isFinite(Kt)&&(dt=ue+Math.trunc(Kt))}dt==null&&(dt=ue);const ht=String(Math.max(0,Math.trunc(Number(dt)||0)));return{label:Be,price:Math.max(0,Math.trunc(Number(dt)||0)),priceDigits:ht}}).filter(Boolean);return{name:pe||"Bi\u1EBFn th\u1EC3",options:ke}}).filter(Boolean)};useEffect(()=>{var I,E;if(S)if(x({name:S.name||"",code:S.code||"",price:S.price||"",image:S.image||"",category:S.category||"",note:S.note||"",sort_order:S.sort_order||0,commission_percent:(E=(I=S.commission_percent)!=null?I:S.commissionPercent)!=null?E:5,variants:it(S.variants,S.price)}),S.price){const X=window.KTM.money.getDigits(S.price);Nt(X),x(ue=>({...ue,price:Ge(X)}))}else Nt("");else x({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[]}),Nt("")},[S,n]);const ne=I=>{x(E=>{var ke;const X=Pe(E.price),ue=String(X),re=Array.isArray(E.variants)?[...E.variants]:[],pe={...re[I]||{},options:Array.isArray((ke=re[I])==null?void 0:ke.options)?[...re[I].options]:[]};return pe.options=pe.options.map(te=>({label:String((te==null?void 0:te.label)||""),price:X,priceDigits:ue})),re[I]=pe,{...E,variants:re}})},Te=()=>{x(I=>{const E=Pe(I.price),X=String(E),re=(Array.isArray(I.variants)?[...I.variants]:[]).map(pe=>{const ke=(Array.isArray(pe==null?void 0:pe.options)?pe.options:[]).map(te=>({label:String((te==null?void 0:te.label)||""),price:E,priceDigits:X}));return{name:String((pe==null?void 0:pe.name)||"Bi\u1EBFn th\u1EC3"),options:ke}});return{...I,variants:re}})},[pt,vt]=React.useState(""),[yt,Nt]=React.useState(""),Ot=I=>{const E=window.KTM.money.nextPriceInputState(I.target.value,yt);Nt(E.digits),x({...$,price:E.price})},ct=async(I,E=2)=>{const X=E*1024*1024;if(I.size<=X)return I;try{const ue=await createImageBitmap(I),re=document.createElement("canvas");let pe=ue.width,ke=ue.height;const te=1200;return(pe>te||ke>te)&&(pe>ke?(ke=Math.round(ke/pe*te),pe=te):(pe=Math.round(pe/ke*te),ke=te)),re.width=pe,re.height=ke,re.getContext("2d").drawImage(ue,0,0,pe,ke),ue.close(),new Promise((Be,ze)=>{re.toBlob(Ue=>{Ue?Be(new File([Ue],I.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ze(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ue){throw console.error("Compress error:",ue),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},At=async I=>{var ue;const E=I.target.files[0];if(!E)return;if(!(E.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(E.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}me(!0);try{const re=await ct(E),pe=await window.KTM.cloudinary.uploadImage({file:re,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!pe.secure_url)throw console.error("Cloudinary error:",pe),new Error(((ue=pe.error)==null?void 0:ue.message)||"Upload failed");x(ke=>({...ke,image:pe.secure_url}))}catch(re){console.error("Upload error:",re),alert("L\u1ED7i upload \u1EA3nh: "+re.message)}me(!1),I.target.value=""},Mt=async I=>{I.preventDefault(),oe(!0),await z($),oe(!1)};return n?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),S?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:V})),React.createElement("form",{onSubmit:Mt},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:$.name,onChange:I=>x({...$,name:I.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:$.code,onChange:I=>x({...$,code:I.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:$.price,onChange:Ot,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:$.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:I=>x({...$,commission_percent:I.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:$.category,onChange:I=>x({...$,category:I.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),w.map(I=>React.createElement("option",{key:I,value:I},I)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:$.note,onChange:I=>x({...$,note:I.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray($.variants)?$.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray($.variants)?$.variants:[]).map((I,E)=>React.createElement("div",{key:E,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(I==null?void 0:I.name)||"",onChange:X=>{const ue=X.target.value;x(re=>{var ke;const pe=Array.isArray(re.variants)?[...re.variants]:[];return pe[E]={...pe[E]||{},name:ue,options:Array.isArray((ke=pe[E])==null?void 0:ke.options)?pe[E].options:[]},{...re,variants:pe}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ne(E),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(I==null?void 0:I.options)||I.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{x(X=>{const ue=Array.isArray(X.variants)?[...X.variants]:[];return ue.splice(E,1),{...X,variants:ue}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(I==null?void 0:I.options)?I.options:[]).map((X,ue)=>{var re,pe;return React.createElement("div",{key:ue,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(X==null?void 0:X.label)||"",onChange:ke=>{const te=ke.target.value;x(_e=>{var ht,We,nt,$t,wt;const Be=Array.isArray(_e.variants)?[..._e.variants]:[],ze={...Be[E]||{},options:Array.isArray((ht=Be[E])==null?void 0:ht.options)?[...Be[E].options]:[]},Ue=Number((nt=(We=ze.options[ue])==null?void 0:We.price)!=null?nt:0)||0,dt=String((wt=($t=ze.options[ue])==null?void 0:$t.priceDigits)!=null?wt:Math.max(0,Math.trunc(Ue)));return ze.options[ue]={...ze.options[ue]||{},label:te,price:Math.max(0,Math.trunc(Ue)),priceDigits:dt},Be[E]=ze,{..._e,variants:Be}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Ge(String((pe=X==null?void 0:X.priceDigits)!=null?pe:window.KTM.money.getDigits(String((re=X==null?void 0:X.price)!=null?re:"")))),onChange:ke=>{x(te=>{var nt,$t,wt,kt,Tt;const _e=String(($t=X==null?void 0:X.priceDigits)!=null?$t:window.KTM.money.getDigits(String((nt=X==null?void 0:X.price)!=null?nt:""))),Be=window.KTM.money.nextPriceInputState(ke.target.value,_e),ze=String((wt=Be.digits)!=null?wt:""),Ue=Number(ze),dt=Number.isFinite(Ue)?Math.max(0,Math.trunc(Ue)):0,ht=Array.isArray(te.variants)?[...te.variants]:[],We={...ht[E]||{},options:Array.isArray((kt=ht[E])==null?void 0:kt.options)?[...ht[E].options]:[]};return We.options[ue]={...We.options[ue]||{},label:String(((Tt=We.options[ue])==null?void 0:Tt.label)||""),price:dt,priceDigits:ze},ht[E]=We,{...te,variants:ht}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{x(ke=>{var Be;const te=Array.isArray(ke.variants)?[...ke.variants]:[],_e={...te[E]||{},options:Array.isArray((Be=te[E])==null?void 0:Be.options)?[...te[E].options]:[]};return _e.options.splice(ue,1),te[E]=_e,{...ke,variants:te}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{x(X=>{var ke;const ue=Array.isArray(X.variants)?[...X.variants]:[],re={...ue[E]||{},options:Array.isArray((ke=ue[E])==null?void 0:ke.options)?[...ue[E].options]:[]},pe=Pe(X.price);return re.options.push({label:"",price:pe,priceDigits:String(pe)}),ue[E]=re,{...X,variants:ue}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{x(I=>{const E=Pe(I.price),X=Array.isArray(I.variants)?[...I.variants]:[],ue=String(E);return X.push({name:"Size",options:[{label:"S",price:E,priceDigits:ue},{label:"M",price:E,priceDigits:ue},{label:"L",price:E,priceDigits:ue}]}),{...I,variants:X}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Te,disabled:!Array.isArray($.variants)||$.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},$.image?React.createElement(React.Fragment,null,React.createElement("img",{src:$.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>x({...$,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var I;return(I=fe.current)==null?void 0:I.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:fe,type:"file",accept:"image/*",className:"d-none",onChange:At}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var I;return(I=fe.current)==null?void 0:I.click()},disabled:$e,style:{borderRadius:"10px"}},$e?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:$.image,onChange:I=>x({...$,image:I.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:V,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:J,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},J?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Ct=(n,S)=>{const w=n._type==="product",V=n._type==="album",z=n._type==="video",$=n.note&&(n.note.toLowerCase().includes("free")||n.note.toLowerCase().includes("gi\u1EA3m")||n.note.toLowerCase().includes("sale"));return xe==="grid"?React.createElement("div",{key:n.id||S,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>Ke({url:n.image,name:n.name,price:n.price,note:n.note,item:n})},n.image?React.createElement("img",{src:n.image,alt:n.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${z?"fa-video":"fa-image"} fa-2x text-muted`})),n.price&&React.createElement("div",{className:"price-overlay"},n.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${w?"product":V?"album":"video"}`},w?"SP":V?"\u1EA2nh":"Video"),$&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},n.name),n.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},n.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:Y===n.id+"-img"?"copied":"",onClick:()=>et(n.image,n.id)},React.createElement("i",{className:"fas fa-image"})),n.price&&React.createElement("button",{className:Y===n.id+"-price"?"copied":"",onClick:()=>Je(n.price.replace(/[đ\s]/g,""),n.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:n.id||S,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${w?"product":V?"album":"video"}`},w?"S\u1EA3n ph\u1EA9m":V?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},n.image?React.createElement("img",{src:n.image,alt:n.name,className:"thumb",loading:"lazy",onClick:()=>Ke({url:n.image,name:n.name,price:n.price,note:n.note,item:n})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${z?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},n.name),React.createElement("div",{className:"price-row"},n.price&&React.createElement("span",{className:"price"},n.price.replace(/[đ\s]/g,""),"\u0111"),$&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},n.code&&React.createElement("span",{className:"meta-tag"},"#",n.code),n.category&&React.createElement("span",{className:"meta-tag"},n.category),n.note&&React.createElement("span",{className:"meta-tag highlight"},n.note),n.folder&&React.createElement("span",{className:"meta-tag"},n.folder),z&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},w&&React.createElement("button",{onClick:()=>b&&b("orders","create",{productId:n.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),n.price&&React.createElement("button",{className:Y===n.id+"-price"?"copied":"",onClick:()=>Je(n.price.replace(/[đ\s]/g,""),n.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:Y===n.id+"-name"?"copied":"",onClick:()=>Je(n.name,n.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),z&&n.youtubeId&&React.createElement("button",{className:Y===n.id+"-yt"?"copied":"",onClick:()=>Je(`https://www.youtube.com/watch?v=${n.youtubeId}`,n.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),w&&React.createElement("button",{className:"action-edit",onClick:()=>_t(n)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>jt(n)},React.createElement("i",{className:"fas fa-trash"}))))},[ut,Oe]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,H.length)," k\u1EBFt qu\u1EA3",ve&&C.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),ce!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},ce==="product"?"S\u1EA3n ph\u1EA9m":ce==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${xe==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Z("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${xe==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Z("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},Q?React.createElement("div",null,[...Array(8)].map((n,S)=>React.createElement("div",{key:S,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):H.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',C,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{q(""),Fe("")}},"Xem t\u1EA5t c\u1EA3")):xe==="grid"?React.createElement("div",{className:"product-grid-mobile"},H.map((n,S)=>Ct(n,S))):React.createElement("div",null,H.map((n,S)=>Ct(n,S)))),ut&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Oe(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${ce==="all"?"active":""}`,onClick:()=>{Ve("all"),Oe(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${ce==="product"?"active":""}`,onClick:()=>{Ve("product"),Oe(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${ce==="album"?"active":""}`,onClick:()=>{Ve("album"),Oe(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${ce==="video"?"active":""}`,onClick:()=>{Ve("video"),Oe(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:ve,onChange:n=>Ie(n.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:Ae,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:C,onChange:n=>Fe(n.target.value)}),React.createElement("button",{className:`filter-btn ${ut||ce!=="all"?"active":""}`,onClick:()=>Oe(!ut)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:h?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>A(!0),onTouchStart:()=>A(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),u&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>A(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},O.map((n,S)=>React.createElement("div",{key:S,className:`mb-3 ${n.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${n.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:n.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},n.content,n.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:Y===`chat-${S}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:Y===`chat-${S}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(n.content),le(`chat-${S}`),setTimeout(()=>le(null),1500)}},React.createElement("i",{className:`fas ${Y===`chat-${S}`?"fa-check":"fa-copy"}`})),n.attachments&&n.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},n.attachments.map((w,V)=>React.createElement("div",{key:V,style:{width:70},className:"text-center"},w.image&&React.createElement("img",{src:w.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>Ke({url:w.image,name:w.name,price:w.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},w.name),w.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},w.price.replace(/[đ\s]/g,""),"\u0111"))))))),U&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:ee})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(n=>React.createElement("button",{key:n,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>at(n),disabled:U,style:{whiteSpace:"nowrap"}},n))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:n=>{n.preventDefault(),at(K)},className:"chat-input-wrap"},React.createElement("input",{ref:d,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:K,onChange:n=>se(n.target.value),disabled:U}),React.createElement("button",{type:"submit",className:"send-btn",disabled:U||!K.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),de&&React.createElement("div",{className:"preview-modal",onClick:()=>Ke(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>Ke(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:n=>n.stopPropagation()},React.createElement("img",{src:de.url,alt:de.name})),React.createElement("div",{className:"preview-footer",onClick:n=>n.stopPropagation()},React.createElement("div",{className:"name"},de.name),de.price&&React.createElement("div",{className:"price"},de.price.replace(/[đ\s]/g,""),"\u0111"),de.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},de.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:Y==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:Y==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>et(de.url,"preview")},React.createElement("i",{className:`fas ${Y==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),de.price&&React.createElement("button",{className:Y==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Je(de.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${Y==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(St,{show:j,product:st,categories:ae,onClose:()=>{Me(!1),je(null)},onSave:Rt}),React.createElement("div",{className:`fab-container mobile-only ${h?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{R(!1),Me(!0),je(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{R(!1),b&&b("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${h?"open":""}`,onClick:()=>R(!h)},React.createElement("i",{className:"fas fa-plus"}))),qe&&f&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>o(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Re.name,onChange:n=>Xe({...Re,name:n.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Re.code,onChange:n=>Xe({...Re,code:n.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Re.price,onChange:n=>Xe({...Re,price:n.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Re.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:n=>Xe({...Re,commission_percent:n.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Re.category,onChange:n=>Xe({...Re,category:n.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),mt.map(n=>React.createElement("option",{key:n,value:n},n)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Re.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:n=>Xe({...Re,note:n.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>o(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:gt},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:N,showToast:b}){const[C,q]=useState([]),[H,v]=useState([]),[D,G]=useState(!0),[ae,P]=useState(null),[ce,Ne]=useState(!1),[Y,le]=useState(null),[xe,Z]=useState(!1),[Q,ie]=useState(null),[we,he]=useState(null),[De,be]=useState([]);useEffect(()=>{Ae()},[]);const Ae=async(o=null)=>{G(!0);try{const f=o?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${o}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Se=await window.KTM.api.getJSON(f,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");q(Array.isArray(Se)?Se:[])}catch(f){console.error(f),b("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}G(!1)},ve=async o=>{try{const f=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${o}`,"L\u1ED7i t\u1EA3i video");v(Array.isArray(f)?f:[])}catch(f){console.error(f)}},Ie=async o=>{if(o===0)return;const f=[...C];[f[o-1],f[o]]=[f[o],f[o-1]],q(f),await Ce(f)},Ze=async o=>{if(o===C.length-1)return;const f=[...C];[f[o],f[o+1]]=[f[o+1],f[o]],q(f),await Ce(f)},Ce=async o=>{try{await Promise.all(o.map((f,Se)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${f.id}`,{sortOrder:Se},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),b("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(f){b("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),Ae(we==null?void 0:we.id)}},_=async o=>{if(o===0)return;const f=[...H];[f[o-1],f[o]]=[f[o],f[o-1]],v(f),await A(f)},u=async o=>{if(o===H.length-1)return;const f=[...H];[f[o],f[o+1]]=[f[o+1],f[o]],v(f),await A(f)},A=async o=>{try{await Promise.all(o.map((f,Se)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${f.id}`,{sort_order:Se},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),b("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(f){b("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ve(ae.id)}},O=()=>{le(null),Ne(!0)},B=o=>{le(o),Ne(!0)},K=async o=>{try{!Y&&we&&(o.parent_id=we.id);const f=Y?`${API_BASE}/api/video-folders/${Y.id}`:`${API_BASE}/api/video-folders`;Y?await window.KTM.api.putJSON(f,o,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(f,o,"L\u1ED7i l\u01B0u folder"),b(Y?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),Ne(!1),Ae(we==null?void 0:we.id)}catch(f){b(f.message,"danger")}},se=async o=>{const f=o.subfolderCount>0?`X\xF3a folder "${o.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${o.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(f))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${o.id}`,"L\u1ED7i x\xF3a folder"),b("\u0110\xE3 x\xF3a folder","success"),P(null),Ae(we==null?void 0:we.id)}catch(Se){b("L\u1ED7i x\xF3a folder","danger")}},U=o=>{o.subfolderCount>0?(be(f=>[...f,o]),he(o),Ae(o.id)):(P(o),v(o.videos||[]))},F=o=>{if(o==="root")be([]),he(null),Ae(null);else if(o){const f=De.findIndex(Se=>Se.id===o.id);f>=0&&(be(De.slice(0,f+1)),he(o),Ae(o.id))}else{const f=[...De];f.pop();const Se=f[f.length-1]||null;be(f),he(Se),Ae(Se==null?void 0:Se.id)}},ee=()=>{ie(null),Z(!0)},d=o=>{ie(o),Z(!0)},de=async o=>{try{o.folder_id=ae==null?void 0:ae.id;const f=Q?`${API_BASE}/api/videos/${Q.id}`:`${API_BASE}/api/videos`;Q?await window.KTM.api.putJSON(f,o,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(f,o,"L\u1ED7i l\u01B0u video"),b(Q?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),Z(!1),Ae(),ae&&ve(ae.id)}catch(f){b(f.message,"danger")}},Ke=async o=>{if(confirm(`X\xF3a video "${o.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${o.id}`,"L\u1ED7i x\xF3a video"),b("\u0110\xE3 x\xF3a video","success"),Ae(),ae&&ve(ae.id)}catch(f){b("L\u1ED7i x\xF3a video","danger")}},qe=o=>{const f=`https://www.youtube.com/watch?v=${o.youtubeId}`;window.KTM.clipboard.writeText(f).then(()=>{b("\u0110\xE3 copy link!","success")}).catch(()=>{b("Kh\xF4ng th\u1EC3 copy link","danger")})};return ae?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>P(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${ae.slug==="shorts"?"text-danger":"text-warning"}`}),ae.name)),React.createElement("button",{className:"btn btn-warning",onClick:ee},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),H.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},H.map((o,f)=>React.createElement("div",{key:o.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>_(f),disabled:f===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},f+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>u(f),disabled:f===H.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:o.thumb,className:"card-img-top",alt:o.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${o.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:o.title},o.title),React.createElement("small",{className:"text-muted"},o.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>qe(o),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>d(o),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Ke(o),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:xe,video:Q,onClose:()=>Z(!1),onSave:de})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},we&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>F()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),we?we.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:O},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),De.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:o=>{o.preventDefault(),F("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),De.map((o,f)=>React.createElement("li",{key:o.id,className:`breadcrumb-item ${f===De.length-1?"active":""}`},f===De.length-1?o.name:React.createElement("a",{href:"#",onClick:Se=>{Se.preventDefault(),F(o)},className:"text-warning"},o.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),D?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):C.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},we?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:O},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",we?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},C.map((o,f)=>{var Se,h,R,j;return React.createElement("div",{key:o.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Me=>{Me.stopPropagation(),Ie(f)},disabled:f===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},f+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Me=>{Me.stopPropagation(),Ze(f)},disabled:f===C.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>U(o),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${o.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},o.name),React.createElement("p",{className:"text-muted mb-0"},o.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),o.subfolderCount," folder"),o.subfolderCount>0&&(o.videoCount>0||((Se=o.videos)==null?void 0:Se.length)>0)&&" \u2022 ",(o.videoCount>0||((h=o.videos)==null?void 0:h.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),o.videoCount||((R=o.videos)==null?void 0:R.length)||0," videos"),o.subfolderCount===0&&!o.videoCount&&!((j=o.videos)!=null&&j.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Me=>{Me.stopPropagation(),B(o)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Me=>{Me.stopPropagation(),se(o)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:ce,folder:Y,onClose:()=>Ne(!1),onSave:K}))}function VideoFolderModal({show:N,folder:b,onClose:C,onSave:q}){const[H,v]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[D,G]=useState(!1),[ae,P]=useState(!1);useEffect(()=>{v(b?{name:b.name||"",description:b.description||"",sortOrder:b.sortOrder||0,coverImage:b.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[b,N]);const ce=async Y=>{const le=Y.target.files[0];if(le){P(!0);try{const xe=await window.KTM.cloudinary.uploadImage({file:le,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});xe.secure_url&&v(Z=>({...Z,coverImage:xe.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(xe){console.error("Cloudinary upload error:",xe),alert("L\u1ED7i upload \u1EA3nh: "+(xe.message||xe))}finally{P(!1)}}},Ne=async Y=>{Y.preventDefault(),G(!0),await q(H),G(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},b?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:C})),React.createElement("form",{onSubmit:Ne},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:H.name,onChange:Y=>v({...H,name:Y.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:H.description,onChange:Y=>v({...H,description:Y.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:H.sortOrder,onChange:Y=>v({...H,sortOrder:parseInt(Y.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},H.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:H.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>v({...H,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:ce,disabled:ae}),ae&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:H.coverImage,onChange:Y=>v({...H,coverImage:Y.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:C},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:D},D?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:N,settings:b}){const[C,q]=useState([]),[H,v]=useState(!0),[D,G]=useState(!1),[ae,P]=useState(null),[ce,Ne]=useState(""),[Y,le]=useState(""),xe=normalizeShipPercent(b==null?void 0:b.ship_percent),{parseMoney:Z,formatVND:Q}=window.KTM.money,ie=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{we()},[]);const we=async()=>{v(!0);try{const _=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");q(Array.isArray(_)?_:[])}catch(_){console.error(_),N("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}v(!1)},he=()=>{P(null),G(!0)},De=_=>{P(_),G(!0)},be=async _=>{if(!(!_||!_.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:_},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),N(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),we()}catch(u){N("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},Ae=async _=>{try{const u=ae?`${API_BASE}/api/products?id=${ae.id}`:`${API_BASE}/api/products`;ae?await window.KTM.api.putJSON(u,_,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(u,_,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(ae?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),G(!1),we()}catch(u){N(u.message,"danger")}},ve=async _=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${_.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${_.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),N("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),we()}catch(u){N(u.message,"danger")}},Ie=C.filter(_=>{const u=!ce||_.name.toLowerCase().includes(ce.toLowerCase())||_.code&&_.code.toLowerCase().includes(ce.toLowerCase()),A=!Y||_.category===Y;return u&&A}),Ze=_=>{var O;const u=(O=_==null?void 0:_.commission_percent)!=null?O:_==null?void 0:_.commissionPercent,A=u===""||u==null?NaN:Number(u);return Number.isFinite(A)?Math.max(0,Math.min(100,A)):5},Ce=_=>{const u=Ze(_),A=Number.isInteger(u)?String(u):String(Math.round(u*100)/100),O=Z(_==null?void 0:_.price);if(!Number.isFinite(O)||O<=0)return`${A}%`;const B=(Number(u)||0)/100,se=window.KTM.money.parseShipFeeFromNote(_==null?void 0:_.note)!=null?0:xe>0?O*xe/100:0,U=O*B-se*B,F=Math.max(0,Math.round(U));return`${A}% - ${Q(F)}`};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:he},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:ce,onChange:_=>Ne(_.target.value)})),React.createElement("span",{className:"product-count"},Ie.length)),React.createElement("select",{className:"form-select",value:Y,onChange:_=>le(_.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),ie.map(_=>React.createElement("option",{key:_,value:_},_)))),H?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):Ie.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:he},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},Ie.map(_=>React.createElement("div",{key:_.id,className:"product-item d-flex align-items-center gap-3"},_.image?React.createElement("img",{src:_.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},_.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},_.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},_.category),_.code&&React.createElement("span",{className:"product-badge bg-secondary"},_.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),Ce(_))),React.createElement("div",{className:"product-price"},_.price?_.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),_.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},_.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>De(_),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>ve(_),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:D,product:ae,categories:ie,onClose:()=>G(!1),onSave:Ae}))}function ProductModal({show:N,product:b,categories:C,onClose:q,onSave:H}){const[v,D]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[]}),[G,ae]=useState(!1),[P,ce]=useState(!1),Ne=u=>{const A=window.KTM.money.getDigits(String(u!=null?u:"")),O=Number(A);return A&&Number.isFinite(O)?Math.trunc(O):0},Y=(u,A)=>{if(u==null||u==="")return[];let O=u;if(typeof O=="string"){const K=O.trim();if(!K)return[];try{O=JSON.parse(K)}catch(se){return[]}}if(!Array.isArray(O))return[];const B=Ne(A);return O.map(K=>{var F;if(!K||typeof K!="object")return null;const se=String((F=K.name)!=null?F:"").trim(),U=(Array.isArray(K.options)?K.options:[]).map(ee=>{var f,Se,h,R,j,Me,st;if(!ee||typeof ee!="object")return null;const d=String((f=ee.label)!=null?f:"").trim();if(!d)return null;const de=(j=(R=(h=(Se=ee.price)!=null?Se:ee.priceValue)!=null?h:ee.unit_price)!=null?R:ee.unitPrice)!=null?j:null,Ke=Number(de);let qe=Number.isFinite(Ke)?Math.trunc(Ke):null;if(qe==null){const je=(st=(Me=ee.price_delta)!=null?Me:ee.priceDelta)!=null?st:null,Re=Number(je);Number.isFinite(Re)&&(qe=B+Math.trunc(Re))}qe==null&&(qe=B);const o=String(Math.max(0,Math.trunc(Number(qe)||0)));return{label:d,price:Math.max(0,Math.trunc(Number(qe)||0)),priceDigits:o}}).filter(Boolean);return{name:se||"Bi\u1EBFn th\u1EC3",options:U}}).filter(Boolean)};useEffect(()=>{var u,A;D(b?{name:b.name||"",code:b.code||"",price:b.price||"",image:b.image||"",category:b.category||"",note:b.note||"",sort_order:b.sort_order||0,commission_percent:(A=(u=b.commission_percent)!=null?u:b.commissionPercent)!=null?A:5,variants:Y(b.variants,b.price)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[]})},[b,N]);const le=u=>{D(A=>{var U;const O=Ne(A.price),B=String(O),K=Array.isArray(A.variants)?[...A.variants]:[],se={...K[u]||{},options:Array.isArray((U=K[u])==null?void 0:U.options)?[...K[u].options]:[]};return se.options=se.options.map(F=>({label:String((F==null?void 0:F.label)||""),price:O,priceDigits:B})),K[u]=se,{...A,variants:K}})},xe=()=>{D(u=>{const A=Ne(u.price),O=String(A),K=(Array.isArray(u.variants)?[...u.variants]:[]).map(se=>{const U=(Array.isArray(se==null?void 0:se.options)?se.options:[]).map(F=>({label:String((F==null?void 0:F.label)||""),price:A,priceDigits:O}));return{name:String((se==null?void 0:se.name)||"Bi\u1EBFn th\u1EC3"),options:U}});return{...u,variants:K}})},[Z,Q]=React.useState(""),ie=u=>window.KTM.money.formatVNDInputDigits(u),[we,he]=React.useState(""),De=u=>{const A=window.KTM.money.nextPriceInputState(u.target.value,we);he(A.digits),D({...v,price:A.price})},[be,Ae]=React.useState("");React.useEffect(()=>{b!=null&&b.image&&Ae(b.image)},[b]);const ve=async u=>{if(!(!u||!u.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:u},"L\u1ED7i x\xF3a \u1EA3nh")}catch(A){console.error("Delete cloudinary image error:",A)}},Ie=async(u,A=2,O)=>{const B=A*1024*1024,K=u.type==="image/heic"||u.type==="image/heif"||/\.heic$/i.test(u.name);if(u.size<=B&&!K)return u;O==null||O("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const se=await createImageBitmap(u);O==null||O("\u0110ang n\xE9n \u1EA3nh...");const U=document.createElement("canvas");let F=se.width,ee=se.height;const d=1200;return(F>d||ee>d)&&(F>ee?(ee=Math.round(ee/F*d),F=d):(F=Math.round(F/ee*d),ee=d)),U.width=F,U.height=ee,U.getContext("2d").drawImage(se,0,0,F,ee),se.close(),new Promise((Ke,qe)=>{U.toBlob(o=>{o?(O==null||O("Ho\xE0n t\u1EA5t!"),Ke(new File([o],u.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):qe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(se){throw console.error("createImageBitmap error:",se),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ze=async u=>{var B,K;const A=(B=u.target.files)==null?void 0:B[0];if(!A)return;if(!(A.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(A.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ce(!0),Q("\u0110ang chu\u1EA9n b\u1ECB...");try{const se=(A.size/1024/1024).toFixed(1);Q(`File ${se}MB - \u0110ang n\xE9n...`);const U=await Ie(A,2,d=>{Q(d)}),F=(U.size/1024/1024).toFixed(1);Q(`\u0110\xE3 n\xE9n: ${F}MB - \u0110ang upload...`);const ee=await window.KTM.cloudinary.uploadImage({file:U,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});ee.secure_url?(v.image&&v.image!==be&&ve(v.image),D(d=>({...d,image:ee.secure_url})),Q("")):(console.error("Cloudinary error:",ee),alert("Upload th\u1EA5t b\u1EA1i: "+(((K=ee.error)==null?void 0:K.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Q(""))}catch(se){console.error("Upload error:",se),alert("L\u1ED7i: "+se.message),Q("")}ce(!1),u.target.value=""},Ce=()=>{v.image&&(v.image!==be&&ve(v.image),D(u=>({...u,image:""})))},_=async u=>{u.preventDefault(),ae(!0),be&&v.image&&be!==v.image&&await ve(be),be&&!v.image&&await ve(be),await H(v),ae(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${b?"fa-edit":"fa-plus-circle"} me-2`}),b?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:q})),React.createElement("form",{onSubmit:_},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},v.image?React.createElement(React.Fragment,null,React.createElement("img",{src:v.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Ce,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${P?"fa-spinner fa-spin":"fa-camera"} me-1`}),P?Z||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Ze,disabled:P,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),P&&Z&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},Z))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:v.name,onChange:u=>D({...v,name:u.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:v.code,onChange:u=>D({...v,code:u.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:v.price,onChange:De,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:v.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:u=>D({...v,commission_percent:u.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:v.category,onChange:u=>D({...v,category:u.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),C.map(u=>React.createElement("option",{key:u,value:u},u)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:v.note,onChange:u=>D({...v,note:u.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(v.variants)?v.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(v.variants)?v.variants:[]).map((u,A)=>React.createElement("div",{key:A,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(u==null?void 0:u.name)||"",onChange:O=>{const B=O.target.value;D(K=>{var U;const se=Array.isArray(K.variants)?[...K.variants]:[];return se[A]={...se[A]||{},name:B,options:Array.isArray((U=se[A])==null?void 0:U.options)?se[A].options:[]},{...K,variants:se}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>le(A),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(u==null?void 0:u.options)||u.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{D(O=>{const B=Array.isArray(O.variants)?[...O.variants]:[];return B.splice(A,1),{...O,variants:B}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(u==null?void 0:u.options)?u.options:[]).map((O,B)=>{var K,se;return React.createElement("div",{key:B,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.label)||"",onChange:U=>{const F=U.target.value;D(ee=>{var o,f,Se,h,R;const d=Array.isArray(ee.variants)?[...ee.variants]:[],de={...d[A]||{},options:Array.isArray((o=d[A])==null?void 0:o.options)?[...d[A].options]:[]},Ke=Number((Se=(f=de.options[B])==null?void 0:f.price)!=null?Se:0)||0,qe=String((R=(h=de.options[B])==null?void 0:h.priceDigits)!=null?R:Math.max(0,Math.trunc(Ke)));return de.options[B]={...de.options[B]||{},label:F,price:Math.max(0,Math.trunc(Ke)),priceDigits:qe},d[A]=de,{...ee,variants:d}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:ie(String((se=O==null?void 0:O.priceDigits)!=null?se:window.KTM.money.getDigits(String((K=O==null?void 0:O.price)!=null?K:"")))),onChange:U=>{D(F=>{var Se,h,R,j,Me;const ee=String((h=O==null?void 0:O.priceDigits)!=null?h:window.KTM.money.getDigits(String((Se=O==null?void 0:O.price)!=null?Se:""))),d=window.KTM.money.nextPriceInputState(U.target.value,ee),de=String((R=d.digits)!=null?R:""),Ke=Number(de),qe=Number.isFinite(Ke)?Math.max(0,Math.trunc(Ke)):0,o=Array.isArray(F.variants)?[...F.variants]:[],f={...o[A]||{},options:Array.isArray((j=o[A])==null?void 0:j.options)?[...o[A].options]:[]};return f.options[B]={...f.options[B]||{},label:String(((Me=f.options[B])==null?void 0:Me.label)||""),price:qe,priceDigits:de},o[A]=f,{...F,variants:o}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{D(U=>{var d;const F=Array.isArray(U.variants)?[...U.variants]:[],ee={...F[A]||{},options:Array.isArray((d=F[A])==null?void 0:d.options)?[...F[A].options]:[]};return ee.options.splice(B,1),F[A]=ee,{...U,variants:F}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{D(O=>{var U;const B=Array.isArray(O.variants)?[...O.variants]:[],K={...B[A]||{},options:Array.isArray((U=B[A])==null?void 0:U.options)?[...B[A].options]:[]},se=Ne(O.price);return K.options.push({label:"",price:se,priceDigits:String(se)}),B[A]=K,{...O,variants:B}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{D(u=>{const A=Ne(u.price),O=Array.isArray(u.variants)?[...u.variants]:[],B=String(A);return O.push({name:"Size",options:[{label:"S",price:A,priceDigits:B},{label:"M",price:A,priceDigits:B},{label:"L",price:A,priceDigits:B}]}),{...u,variants:O}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:xe,disabled:!Array.isArray(v.variants)||v.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:v.image,onChange:u=>D({...v,image:u.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:q,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:G,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},G?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:N,video:b,onClose:C,onSave:q}){const[H,v]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[D,G]=useState(!1),[ae,P]=useState("");useEffect(()=>{b?(v({title:b.title||"",youtube_url:`https://www.youtube.com/watch?v=${b.youtubeId}`,thumbnail_url:b.thumb||"",sort_order:b.sortOrder||0}),P(b.thumb)):(v({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),P(""))},[b,N]);const ce=le=>{const xe=le.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return xe?xe[1]:null},Ne=le=>{v({...H,youtube_url:le});const xe=ce(le);xe&&P(`https://img.youtube.com/vi/${xe}/hqdefault.jpg`)},Y=async le=>{le.preventDefault(),G(!0),await q(H),G(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},b?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:C})),React.createElement("form",{onSubmit:Y},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:H.youtube_url,onChange:le=>Ne(le.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),ae&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:ae,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:H.title,onChange:le=>v({...H,title:le.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:H.sort_order,onChange:le=>v({...H,sort_order:parseInt(le.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:H.thumbnail_url,onChange:le=>v({...H,thumbnail_url:le.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:C},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:D},D?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[N,b]=useState(!1),[C,q]=useState(""),[H,v]=useState(null),[D,G]=useState("search"),[ae,P]=useState(null),[ce,Ne]=useState(""),[Y,le]=useState([]),[xe,Z]=useState(null),[Q,ie]=useState(!1),[we,he]=useState(null),[De,be]=useState(!0),[Ae,ve]=useState([]),[Ie,Ze]=useState(()=>loadAdminSettings()),[Ce,_]=useState(null),[u,A]=useState([]);useEffect(()=>{const h=localStorage.getItem("ktm_admin_session");if(h)try{const R=JSON.parse(h);R.expiry>Date.now()?(b(!0),v(R.user)):localStorage.removeItem("ktm_admin_session")}catch(R){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{N&&U()},[N]),useEffect(()=>{if(!N)return;let h=!1;return(async()=>{try{const R=await fetchAdminSettingsFromServer();if(h)return;Ze(R),saveAdminSettings(R)}catch(R){}})(),()=>{h=!0}},[N]);const O=async(h,R)=>{q("");try{const j=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:h,password:R},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),Me={user:j.user,token:j.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(Me)),v(j.user),b(!0)}catch(j){q(j.message)}},B=()=>{localStorage.removeItem("ktm_admin_session"),b(!1),v(null),le([]),Z(null)},K=(h,R="success")=>{const j=Date.now();ve(Me=>[...Me,{id:j,message:h,type:R}])},se=h=>{ve(R=>R.filter(j=>j.id!==h))},U=async(h=null)=>{be(!0);try{const R=h?`${API_BASE}/api/albums?parent_id=${h}`:`${API_BASE}/api/albums?parent_id=root`,j=await window.KTM.api.getJSON(R,"L\u1ED7i t\u1EA3i danh s\xE1ch album");le(Array.isArray(j)?j:[])}catch(R){console.error(R),K("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}be(!1)},F=()=>{he(null),ie(!0)},ee=h=>{he(h),ie(!0)},d=async h=>{try{const R=we&&we.uuid;!R&&Ce&&(h.parent_id=Ce.uuid);const j=R?`${API_BASE}/api/albums/${we.uuid||we.id}`:`${API_BASE}/api/albums`;R?await window.KTM.api.putJSON(j,h,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(j,h,"L\u1ED7i t\u1EA1o"),K(R?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),ie(!1),U(Ce==null?void 0:Ce.uuid)}catch(R){K(R.message,"danger")}},de=h=>{Z(h)},Ke=h=>{if(h==="root")A([]),_(null),U(null);else if(h){const R=u.findIndex(j=>j.uuid===h.uuid);R>=0&&(A(u.slice(0,R+1)),_(h),U(h.uuid))}else{const R=[...u];R.pop();const j=R[R.length-1]||null;A(R),_(j),U(j==null?void 0:j.uuid)}},qe=async h=>{const R=`X\xF3a folder "${h.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(R))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${h.uuid||h.id}`,"L\u1ED7i x\xF3a album"),K("\u0110\xE3 x\xF3a","success"),U(Ce==null?void 0:Ce.uuid)}catch(j){K("L\u1ED7i x\xF3a album","danger")}};if(!N)return React.createElement(LoginPage,{onLogin:O,error:C});const o=()=>{const h=new Date,R=h.getFullYear(),j=String(h.getMonth()+1).padStart(2,"0");return`${R}-${j}`};function f(){const[h,R]=useState(()=>{var je;return String((je=Ie==null?void 0:Ie.ship_percent)!=null?je:DEFAULT_SHIP_PERCENT)}),[j,Me]=useState(!1);return useEffect(()=>{var je;R(String((je=Ie==null?void 0:Ie.ship_percent)!=null?je:DEFAULT_SHIP_PERCENT))},[Ie==null?void 0:Ie.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async je=>{je.preventDefault(),Me(!0);const Re=saveAdminSettings({ship_percent:h});try{const Xe=await saveAdminSettingsToServer(Re);Ze(Xe),saveAdminSettings(Xe),K("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Xe){Ze(Re),K("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{Me(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:h,min:"0",max:"100",step:"0.01",onChange:je=>R(je.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:j},j?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function Se(){const[h,R]=useState(o()),[j,Me]=useState(!0),[st,je]=useState([]),[Re,Xe]=useState([]),mt=useRef(!1),_t=useRef(new Map),gt=normalizeShipPercent(Ie==null?void 0:Ie.ship_percent),{parseMoney:jt,parseShipFeeFromNote:Rt,getShipFeeForItems:It,formatNumber:ye,formatVND:Ye}=window.KTM.money,lt=async()=>{if(!mt.current)try{const y=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m");Xe(Array.isArray(y)?y:[]),mt.current=!0}catch(y){console.error("Load products for stats error:",y),Xe([]),mt.current=!0}},xt=async y=>{var tt,at;const Fe=String(y||"").trim();if(!Fe)return[];const Ve=(tt=_t.current)==null?void 0:tt.get(Fe);if(Ve&&Array.isArray(Ve))return Ve;const Je=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(Fe)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),et=Array.isArray(Je)?Je:[];return(at=_t.current)==null||at.set(Fe,et),et},m=async()=>{Me(!0);try{await lt();const y=await xt(h);je(Array.isArray(y)?y:[])}catch(y){console.error("Load stats error:",y),je([])}finally{Me(!1)}};useEffect(()=>{m()},[h]);const k=React.useMemo(()=>{var it;const y={draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};let Fe=0,Ve=0,Je=0,et=0,tt=0,at=0,St=0,Ct=0;const ut=ne=>ne.customer_id||ne.phone||"unknown",Oe=ne=>window.KTM.orders.getOrderItems(ne),n=new Map,S=new Map,w=new Map,V=5,z=new Map((Array.isArray(Re)?Re:[]).map(ne=>{var yt;const Te=(yt=ne==null?void 0:ne.commission_percent)!=null?yt:ne==null?void 0:ne.commissionPercent,pt=Number(Te),vt=Number.isFinite(pt)?Math.max(0,Math.min(100,pt)):V;return[String(ne==null?void 0:ne.id),vt]})),$=ne=>{const Te=String(ne!=null?ne:"").trim().toLowerCase();return Te==="cancelled"?"canceled":Te};for(const ne of st){const Te=$(ne==null?void 0:ne.status),yt=Te==="canceled"||Te==="draft",Nt=Oe(ne);let Ot=0,ct=0,At=0;for(const te of Nt){const _e=Number((te==null?void 0:te.quantity)||0)||0,Be=jt(te==null?void 0:te.product_price),ze=_e*Be,Ue=String((te==null?void 0:te.product_id)||""),dt=z.has(Ue)?z.get(Ue):V,ht=(Number(dt)||0)/100;if(Ot+=_e,ct+=ze,At+=ze*ht,!yt){const We=(te==null?void 0:te.product_id)||"unknown",nt=n.get(Ue)||{product_id:We,product_name:(te==null?void 0:te.product_name)||"\u2014",product_code:(te==null?void 0:te.product_code)||"",orders:0,quantity:0,revenue:0};nt.orders+=1,nt.quantity+=_e,nt.revenue+=ze,n.set(We,nt)}}const Mt=It(Nt),I=Number((it=ne==null?void 0:ne.adjustment_amount)!=null?it:0)||0,E=ct+(Mt.found?Mt.fee:0)+I,X=ct+I,ue=!Mt.found&&gt>0&&ct>0?ct*gt/100:0,re=ct>0?At/ct:V/100,pe=At+I*re-ue*re,ke=Te==="done"||Te==="paid";if(Te==="draft"?y.draft+=1:Te==="pending"?y.pending+=1:Te==="processing"?y.processing+=1:Te==="canceled"?y.canceled+=1:Te==="paid"?(y.paid+=1,y.done+=1,et+=E,at+=X,Ct+=pe):Te==="done"?(y.done+=1,et+=E,at+=X,Ct+=pe):y.other+=1,!yt){Fe+=1,Ve+=Ot,Je+=E,tt+=X,St+=pe;const te=ut(ne),_e=S.get(te)||{key:te,customer_name:ne.customer_name||"",phone:ne.phone||"",orders:0,quantity:0,revenue:0};_e.orders+=1,_e.quantity+=Ot,_e.revenue+=E,!_e.customer_name&&ne.customer_name&&(_e.customer_name=ne.customer_name),!_e.phone&&ne.phone&&(_e.phone=ne.phone),S.set(te,_e);const Be=ne.created_at?new Date(ne.created_at):null;if(Be&&!Number.isNaN(Be.getTime())){const ze=`${Be.getFullYear()}-${String(Be.getMonth()+1).padStart(2,"0")}-${String(Be.getDate()).padStart(2,"0")}`,Ue=w.get(ze)||{day:ze,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};Ue.orders+=1,Ue.quantity+=Ot,Ue.revenue+=E,ke&&(Ue.doneOrders+=1,Ue.doneRevenue+=E),w.set(ze,Ue)}}}const x=Array.from(n.values()).sort((ne,Te)=>Te.revenue-ne.revenue),J=Array.from(S.values()).sort((ne,Te)=>Te.revenue-ne.revenue),oe=Array.from(w.values()).sort((ne,Te)=>ne.day.localeCompare(Te.day)),$e=S.size,me=Fe?Math.round(Je/Fe):0,fe=Fe?Ve/Fe:0,Ge=Math.round(Ct),Pe=Math.round(St);return{statusCounts:y,activeOrders:Fe,totalQty:Ve,totalRevenue:Je,doneRevenue:et,tempCommission:Ge,tempCommissionAll:Pe,products:x,customers:J,days:oe,uniqueCustomers:$e,avgOrderValue:me,avgQtyPerOrder:fe}},[st,Re,h]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:j}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:m,disabled:j},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:h,onChange:y=>R(y.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",gt,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),ye(k.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),ye(k.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),ye(k.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",ye(k.statusCounts.paid),"/",ye(k.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ye(k.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ye(k.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ye(k.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ye(k.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ye(k.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",k.avgQtyPerOrder?k.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},ye(k.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},ye(k.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},ye(k.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},ye(k.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},ye(k.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},ye(k.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},ye(k.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,ye(k.statusCounts.draft)),React.createElement("td",null,ye(k.statusCounts.pending)),React.createElement("td",null,ye(k.statusCounts.processing)),React.createElement("td",null,ye(k.statusCounts.canceled)),React.createElement("td",null,ye(k.statusCounts.done)),React.createElement("td",null,ye(k.statusCounts.paid)),React.createElement("td",null,ye(k.statusCounts.other)),React.createElement("td",null,ye(k.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},k.products.slice(0,10).map(y=>React.createElement("div",{key:y.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},y.product_name),React.createElement("div",{className:"text-muted small text-truncate"},y.product_code?`#${y.product_code} \u2022 `:"",ye(y.orders)," \u0111\u01A1n \u2022 ",ye(y.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ye(y.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,k.products.slice(0,10).map(y=>React.createElement("tr",{key:y.product_id},React.createElement("td",null,y.product_name),React.createElement("td",null,y.product_code||"\u2014"),React.createElement("td",null,ye(y.orders)),React.createElement("td",null,ye(y.quantity)),React.createElement("td",{className:"fw-semibold"},Ye(y.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},k.customers.slice(0,10).map(y=>React.createElement("div",{key:y.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},y.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},y.phone||"\u2014"," \u2022 ",ye(y.orders)," \u0111\u01A1n \u2022 ",ye(y.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ye(y.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,k.customers.slice(0,10).map(y=>React.createElement("tr",{key:y.key},React.createElement("td",null,y.customer_name||"\u2014"),React.createElement("td",null,y.phone||"\u2014"),React.createElement("td",null,ye(y.orders)),React.createElement("td",null,ye(y.quantity)),React.createElement("td",{className:"fw-semibold"},Ye(y.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},k.days.map(y=>React.createElement("div",{key:y.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},y.day),React.createElement("div",{className:"text-muted small"},ye(y.orders)," \u0111\u01A1n \u2022 ",ye(y.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",ye(y.doneOrders)," \u2022 ",Ye(y.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Ye(y.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,k.days.map(y=>React.createElement("tr",{key:y.day},React.createElement("td",null,y.day),React.createElement("td",null,ye(y.orders)),React.createElement("td",null,ye(y.quantity)),React.createElement("td",{className:"fw-semibold"},Ye(y.revenue)),React.createElement("td",null,ye(y.doneOrders)),React.createElement("td",{className:"fw-semibold"},Ye(y.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:D,onMenuChange:h=>{G(h),h==="albums"&&(_(null),A([]),U(null))},onLogout:B,currentUser:H}),React.createElement("div",{className:"main-content"},D==="albums"&&!xe&&React.createElement(AlbumList,{albums:Y,loading:De,currentFolder:Ce,breadcrumb:u,onSelect:de,onCreate:F,onEdit:ee,onDelete:qe,onBack:Ke}),D==="search"&&React.createElement(SearchCenter,{showToast:K,onNavigate:(h,R,j)=>{G(h),h==="orders"&&R==="create"&&(P(Date.now()),Ne((j==null?void 0:j.productId)||""))}}),D==="albums"&&xe&&React.createElement(AlbumDetail,{album:xe,parentAlbum:u.length>0?u[u.length-1]:null,onBack:()=>{if(xe.parentId){const h=u.findIndex(R=>R.uuid===xe.parentId);h>=0?Z(u[h]):Z(null)}else Z(null)},onRefresh:()=>U(Ce==null?void 0:Ce.uuid),showToast:K,onNavigateToFolder:h=>{A(R=>[...R,xe]),Z(h)},onEditSubfolder:h=>{he(h),ie(!0)}}),D==="videos"&&React.createElement(VideoList,{showToast:K}),D==="products"&&React.createElement(ProductManager,{showToast:K,settings:Ie}),D==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:ae,autoOpenCreateProductId:ce,showToast:K}),D==="stats"&&React.createElement(Se,null),D==="settings"&&React.createElement(f,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${D==="search"?"active":""}`,onClick:h=>{h.preventDefault(),G("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${D==="albums"?"active":""}`,onClick:h=>{h.preventDefault(),G("albums"),Z(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${D==="videos"?"active":""}`,onClick:h=>{h.preventDefault(),G("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${D==="products"?"active":""}`,onClick:h=>{h.preventDefault(),G("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${D==="orders"?"active":""}`,onClick:h=>{h.preventDefault(),G("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${D==="stats"?"active":""}`,onClick:h=>{h.preventDefault(),G("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:Q,album:we,parentId:Ce==null?void 0:Ce.uuid,onClose:()=>ie(!1),onSave:d}),React.createElement("div",{className:"toast-container"},Ae.map(h=>React.createElement(Toast,{key:h.id,message:h.message,type:h.type,onClose:()=>se(h.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:N,autoOpenCreateProductId:b,showToast:C}){const[q,H]=useState([]),[v,D]=useState([]),[G,ae]=useState(!0),[P,ce]=useState(!1),[Ne,Y]=useState([]),[le,xe]=useState(!1),[Z,Q]=useState(!1),[ie,we]=useState(null),[he,De]=useState(null),[be,Ae]=useState(!1),[ve,Ie]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[Ze,Ce]=useState(""),[_,u]=useState(!1),[A,O]=useState(!1),[B,K]=useState(null),[se,U]=useState(!1),[F,ee]=useState([]),[d,de]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Ke,qe]=useState([""]),[o,f]=useState(null),Se=useRef({}),[h,R]=useState([]),[j,Me]=useState(null),st=useRef(null),je=useRef(null),Re=useRef(0),Xe=useRef(new Map),mt=useRef(""),_t=useRef(null),gt=useRef(0),jt=useRef(null),Rt=9,It=150,ye=24*60*60*1e3,Ye=5*60*1e3,lt="ktm_customer_lookup_cache_v1",xt=200,m=3,k=7,y=3,Fe=24*60*60*1e3,Ve=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/Fe)}catch(a){return 0}},Je=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:Ve(e)>=m,et=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},tt=e=>{if(et(e==null?void 0:e.status)!=="draft")return null;const t=k-Ve(e);return Number.isFinite(t)?t:null},at=e=>{const a=tt(e);return Number.isFinite(a)?a>0&&a<=y:!1},St=e=>{de({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:0,adjustment_note:"",status:"pending"}),qe([""]),K(null),f(null)};useEffect(()=>{const e=a=>{var s;if(o==null)return;const t=(s=Se.current)==null?void 0:s[o];t&&!t.contains(a.target)&&f(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[o]);const Ct=e=>window.KTM.money.parseMoney(e),ut=e=>window.KTM.money.parseSignedMoney(e),Oe=e=>window.KTM.money.formatVND(e),n=e=>window.KTM.money.parseShipFeeFromNote(e),S=e=>window.KTM.phone.isValid(e),w=e=>window.KTM.phone.normalize(e),V=()=>{var e;try{const a=localStorage.getItem(lt);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const s=Object.entries(t);for(const[r,p]of s)!r||!p||typeof p!="object"||(e=Xe.current)==null||e.set(String(r),p)}catch(a){}},z=()=>{try{const e=Xe.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([s,r])=>s&&r&&typeof r=="object"&&Number.isFinite(r.ts)).sort((s,r)=>(Number(r[1].ts)||0)-(Number(s[1].ts)||0)).slice(0,xt),t={};for(const[s,r]of a)t[s]=r;localStorage.setItem(lt,JSON.stringify(t))}catch(e){}};useEffect(()=>{V()},[]);const $=e=>{const a=w(e);if(!a)return null;const t=Array.isArray(q)?q:[];let s=null,r=-1;for(const p of t){if(!p||w(p.phone||"")!==a)continue;const T=new Date(p.created_at).getTime(),g=Number.isFinite(T)?T:0;g>=r&&(r=g,s=p)}return s?{name:String(s.customer_name||"").trim(),address:String(s.address||"").trim()}:null},x=(e,a)=>{e&&de(t=>a&&w(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},J=e=>{const a=$(e);if(!a)return;const t=w(e);de(s=>{if(t&&w(s.phone)!==t)return s;const r={...s};return!String(s.customer_name||"").trim()&&a.name&&(r.customer_name=a.name),!String(s.address||"").trim()&&a.address&&(r.address=a.address),r})},oe=async e=>{var r,p,T;const a=w(e);if(!a)return;J(a);const t=(r=Xe.current)==null?void 0:r.get(a);if(t&&Number.isFinite(t.ts)){const g=Date.now()-t.ts,l=t.status==="found"?ye:Ye;if(g>=0&&g<=l){K({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&x(t.customer,a);return}}const s=++Re.current;K({status:"loading",phone:a});try{const g=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Re.current!==s)return;if(g&&g.exists&&g.customer){(p=Xe.current)==null||p.set(a,{ts:Date.now(),status:"found",customer:g.customer}),z(),K({status:"found",phone:a,customer:g.customer}),x(g.customer,a);return}(T=Xe.current)==null||T.set(a,{ts:Date.now(),status:"not-found",customer:null}),z(),K({status:"not-found",phone:a})}catch(g){if(Re.current!==s)return;console.error("Customer lookup error:",g),K({status:"error",phone:a})}},$e=e=>{const a=w(e),t=$(a);de(r=>{const p={...r,phone:a};return t&&(!String(r.customer_name||"").trim()&&t.name&&(p.customer_name=t.name),!String(r.address||"").trim()&&t.address&&(p.address=t.address)),p}),U(!1),je.current&&(clearTimeout(je.current),je.current=null);const s=a;if(s.length<Rt){K(null);return}if(S(s)&&s!==mt.current){mt.current=s,oe(s);return}je.current=setTimeout(()=>{const r=w(a);S(r)&&r!==mt.current&&(mt.current=r,oe(r))},It)},me=()=>{const e=w(d.phone);e.length<Rt||S(e)&&e!==mt.current&&(mt.current=e,oe(e))};useEffect(()=>(A?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[A]);const fe=Array.isArray(d.items)?d.items.length:0;useEffect(()=>{if(!A){gt.current=fe;return}fe>gt.current&&setTimeout(()=>{const e=_t.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),gt.current=fe},[A,fe]),useEffect(()=>()=>{je.current&&(clearTimeout(je.current),je.current=null)},[]),useEffect(()=>{Ot()},[]),useEffect(()=>{ct()},[ve]),useEffect(()=>{At()},[]),useEffect(()=>{N&&st.current!==N&&(st.current=N,I(b))},[N]);const Ge=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",Pe=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",it=React.useMemo(()=>window.KTM.orders.sortOrders(q),[q]),ne=React.useMemo(()=>window.KTM.orders.sortOrders(v),[v]),Te=React.useMemo(()=>{const a=(Array.isArray(ne)?ne:[]).filter(t=>Je(t));return a.sort((t,s)=>{const r=new Date(t==null?void 0:t.created_at).getTime(),p=new Date(s==null?void 0:s.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(p)?p:0)}),a},[ne]),pt=React.useMemo(()=>{const a=(Array.isArray(Ne)?Ne:[]).filter(t=>at(t));return a.sort((t,s)=>{const r=new Date(t==null?void 0:t.created_at).getTime(),p=new Date(s==null?void 0:s.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(p)?p:0)}),a},[Ne]),vt=React.useMemo(()=>_?Te:it,[_,Te,it]),yt=React.useMemo(()=>{if(_)return vt;const e=String(Ze||"").trim();return e?(Array.isArray(vt)?vt:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):vt},[vt,Ze,_]),Nt=e=>window.KTM.date.formatDateTime(e),Ot=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");R(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),R([])}},ct=async()=>{ae(!0);try{let e=`${API_BASE}/api/orders`;ve&&(e+=`?month=${ve}`);const a=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");H(Array.isArray(a)?a:[]),At()}catch(e){console.error("Load orders error:",e),H([])}finally{ae(!1)}},At=async()=>{ce(!0),xe(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(m)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(y)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);D(Array.isArray(e)?e:[]),Y(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),D([]),Y([])}finally{ce(!1),xe(!1)}},Mt=e=>{var t;Me(e.id);const a=Array.isArray(e.items)&&e.items.length?e.items.map(s=>{var r,p,T,g;return{product_id:(s==null?void 0:s.product_id)||"",quantity:Number((r=s==null?void 0:s.quantity)!=null?r:1)||1,unit_price:(()=>{var c;const l=(c=s==null?void 0:s.unit_price)!=null?c:s==null?void 0:s.unitPrice,i=Number(l);return Number.isFinite(i)?Math.trunc(i):null})(),variant:String((p=s==null?void 0:s.variant)!=null?p:"").trim(),variant_json:(g=(T=s==null?void 0:s.variant_json)!=null?T:s==null?void 0:s.variantJson)!=null?g:null}}).filter(s=>s.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1,unit_price:null,variant:"",variant_json:null}];de({customer_name:e.customer_name||"",phone:w(e.phone||""),address:e.address||"",note:(e==null?void 0:e.note)||"",items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:Number((t=e==null?void 0:e.adjustment_amount)!=null?t:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),qe(new Array(a.length?a.length:1).fill("")),ee(new Array(a.length?a.length:1).fill(!0)),K(null),O(!0),e.phone&&oe(w(e.phone))};function I(e){Me(null),St(e||""),U(!1),ee([]),O(!0)}const E=()=>{Z||be||(O(!1),Me(null),St(""),U(!1),ee([]))},X=async()=>{var g,l,i;if(!j||be||Z)return;const e=(Array.isArray(q)?q:[]).find(c=>String(c==null?void 0:c.id)===String(j))||null,a=String((e==null?void 0:e.status)||(d==null?void 0:d.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const c="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof C=="function"?C(c,"warning"):alert(c);return}const t=w(d.phone),r=(Array.isArray(d.items)?d.items:[]).map((c,M)=>{var L,W;return{idx:M,product_id:String((c==null?void 0:c.product_id)||"").trim(),quantity:Number((L=c==null?void 0:c.quantity)!=null?L:0),variant:String((c==null?void 0:c.variant)||"").trim()||null,variant_json:(W=c==null?void 0:c.variant_json)!=null?W:null,unit_price:(()=>{const ge=Number(c==null?void 0:c.unit_price);if(Number.isFinite(ge))return Math.max(0,Math.trunc(ge));const He=We(c==null?void 0:c.product_id),Le=c!=null&&c.variant_json&&typeof c.variant_json=="object"?c.variant_json:null;return kt(He,Le)})()}}).filter(c=>c.product_id&&Number.isFinite(c.quantity)&&c.quantity>0);if(r.length<2){const c="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof C=="function"?C(c,"warning"):alert(c);return}const p=[],T=[];for(const c of r){const M=!!F[c.idx],L={product_id:c.product_id,quantity:c.quantity,unit_price:c.unit_price,variant:c.variant,variant_json:c.variant_json};M?p.push(L):T.push(L)}if(!p.length||!T.length){const c="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof C=="function"?C(c,"warning"):alert(c);return}Ae(!0);try{const c=ut(d.adjustment_amount),M=(d.adjustment_note||"").trim(),L={customer_name:d.customer_name,phone:t,address:d.address,note:(d.note||"").trim(),adjustment_amount:c,adjustment_note:M,status:"processing",items:p,product_id:p[0].product_id,quantity:p[0].quantity,split_seq:1},W=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,L,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),ge=(i=(l=W==null?void 0:W.id)!=null?l:(g=W==null?void 0:W.order)==null?void 0:g.id)!=null?i:null;if(!ge)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const He={id:j,customer_name:d.customer_name,phone:t,address:d.address,note:(d.note||"").trim(),adjustment_amount:0,adjustment_note:"",status:"pending",items:T,product_id:T[0].product_id,quantity:T[0].quantity,parent_order_id:String(ge),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${j}`,He,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),E(),ct();const Le=ge?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${ge}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof C=="function"?C(Le,"success"):alert(Le)}catch(c){console.error(c);const M=(c==null?void 0:c.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof C=="function"?C(M,"danger"):alert(M)}finally{Ae(!1)}},ue=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=h.find(s=>String(s==null?void 0:s.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},re=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},pe=e=>{const t=re(e).trim().split(/\s+/).filter(Boolean),s=t.join(" ");return{contentTokens:t,cleanedQuery:s}},ke=React.useMemo(()=>(Array.isArray(h)?h:[]).map((e,a)=>{var i,c,M,L,W,ge;const t=re((i=e==null?void 0:e.name)!=null?i:""),s=re((c=e==null?void 0:e.code)!=null?c:""),r=re((M=e==null?void 0:e.category)!=null?M:""),p=re((L=e==null?void 0:e.note)!=null?L:""),T=re((W=e==null?void 0:e.id)!=null?W:""),g=re((ge=e==null?void 0:e.stt)!=null?ge:""),l=`${t} ${s} ${r} ${p} ${T} ${g}`.trim();return{p:e,originalIndex:a,name:t,code:s,category:r,note:p,haystackAll:l}}),[h]),te=(e,a,t)=>{var M,L,W,ge,He;const s=Array.isArray(a)?a:[],r=re(t).trim();if(!s.length&&!r)return 0;const p=(M=e==null?void 0:e.name)!=null?M:"",T=(L=e==null?void 0:e.code)!=null?L:"",g=(W=e==null?void 0:e.category)!=null?W:"",l=(ge=e==null?void 0:e.note)!=null?ge:"";if(!((He=e==null?void 0:e.haystackAll)!=null?He:""))return 0;let c=0;r&&(p===r&&(c+=220),p.includes(r)&&(c+=140),p.startsWith(r)&&(c+=160),T&&T===r&&(c+=180),T&&T.includes(r)&&(c+=90));for(const Le of s){if(!Le)continue;const rt=new RegExp(`(?:^|\\s)${Le.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);p.includes(Le)&&(c+=35),rt.test(p)&&(c+=25),T&&T.includes(Le)&&(c+=20),T&&rt.test(T)&&(c+=10),g&&g.includes(Le)&&(c+=12),l&&l.includes(Le)&&(c+=6)}return c>0&&p&&(c+=Math.max(0,10-Math.min(10,Math.floor(p.length/10)))),c},_e=(e,a)=>{const t=String(e||""),s=String(a||"");if(t===s)return 0;if(!t)return s.length;if(!s)return t.length;const r=t.length,p=s.length;if(p>r)return _e(s,t);let T=new Array(p+1),g=new Array(p+1);for(let l=0;l<=p;l++)T[l]=l;for(let l=1;l<=r;l++){g[0]=l;const i=t.charCodeAt(l-1);for(let M=1;M<=p;M++){const L=i===s.charCodeAt(M-1)?0:1;g[M]=Math.min(T[M]+1,g[M-1]+1,T[M-1]+L)}const c=T;T=g,g=c}return T[p]},Be=(e,a)=>{const t=String(e||"").trim(),s=String(a||"");if(!t||!s)return!1;if(s.includes(t))return!0;const r=s.split(/\s+/).filter(Boolean);if(!r.length)return!1;const p=t.length<=4?1:2;for(const T of r)if(!(Math.abs(T.length-t.length)>p)&&_e(t,T)<=p)return!0;return!1},ze=e=>{const a=re(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},Ue=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const s=ze((e==null?void 0:e.name)||""),r=ze((e==null?void 0:e.code)||""),p=ze((e==null?void 0:e.category)||""),T=ze((e==null?void 0:e.note)||""),g=(i,c,M)=>{const L=String(i||"").trim();if(!L||!c.length)return 0;const W=L.length<=4?1:2;let ge=1/0,He=-1;for(let Qe=0;Qe<c.length;Qe++){const bt=c[Qe];if(!bt||Math.abs(bt.length-L.length)>W)continue;const ft=_e(L,bt);if(ft<ge&&(ge=ft,He=Qe,ft===0))break}if(ge===1/0||ge>W)return 0;let rt=Math.round(M*(ge===0?1:ge===1?.65:.45));return He===0?rt+=Math.round(M*.25):He===1&&(rt+=Math.round(M*.12)),rt};let l=0;for(const i of t){if(!i)continue;const c=g(i,s,180),M=g(i,r,120),L=g(i,p,60),W=g(i,T,30);l+=Math.max(c,M,L,W)}if(l>0){const i=((e==null?void 0:e.name)||"").length;l+=Math.max(0,60-Math.min(60,Math.floor(i/2)))}return l},dt=React.useRef(new Map);React.useEffect(()=>{dt.current=new Map},[h]);const ht=e=>{var i,c;const a=String(Ke[e]||"").trim();if(!a)return h;const{contentTokens:t,cleanedQuery:s}=pe(a);if(t.length===0)return h;const r=re(a).trim(),p=dt.current.get(r);if(p)return p;const T=[];for(const M of ke){const L=M.haystackAll;L&&t.some(W=>L.includes(W))&&T.push(M)}let g=T;if(g.length<8&&t.length>0){const M=[],L=new Set(g.map(W=>{var ge,He;return String((He=(ge=W.p)==null?void 0:ge.id)!=null?He:"")+":"+String(W.originalIndex)}));for(const W of ke){const ge=String((c=(i=W.p)==null?void 0:i.id)!=null?c:"")+":"+String(W.originalIndex);if(L.has(ge))continue;const He=W.haystackAll;He&&t.some(Le=>Be(Le,He))&&(M.push(W),L.add(ge))}M.length&&(g=g.concat(M))}const l=g.map(M=>({entry:M,score:te(M,t,s)})).map(M=>{if(M.score>0)return M;const L=Ue(M.entry,t);return L>0?{...M,score:L}:M}).filter(M=>M.score>0).sort((M,L)=>L.score!==M.score?L.score-M.score:M.entry.originalIndex-L.entry.originalIndex).slice(0,40).map(M=>M.entry.p);return dt.current.set(r,l),l},We=e=>{if(!e)return null;const a=String(e);return h.find(t=>String(t==null?void 0:t.id)===a)||null},nt=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(s){return[]}}return Array.isArray(a)?a.map((t,s)=>{var T;if(!t||typeof t!="object")return null;const r=String((T=t.name)!=null?T:"").trim()||`Bi\u1EBFn th\u1EC3 ${s+1}`,p=(Array.isArray(t.options)?t.options:[]).map(g=>{var He,Le,rt,Qe,bt,ft,Ee;if(!g||typeof g!="object")return null;const l=String((He=g.label)!=null?He:"").trim();if(!l)return null;const i=(bt=(Qe=(rt=(Le=g.price)!=null?Le:g.priceValue)!=null?rt:g.unit_price)!=null?Qe:g.unitPrice)!=null?bt:null,c=Number(i),M=Number.isFinite(c)?Math.trunc(c):null,L=(Ee=(ft=g.price_delta)!=null?ft:g.priceDelta)!=null?Ee:null,W=Number(L),ge=Number.isFinite(W)?Math.trunc(W):0;return{label:l,price:M,price_delta:ge}}).filter(Boolean);return{name:r,options:p}}).filter(Boolean):[]},$t=e=>{const a=We(e);return nt(a==null?void 0:a.variants)},wt=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,s]of Object.entries(e)){const r=String(t||"").trim(),p=String(s||"").trim();!r||!p||a.push(`${r}: ${p}`)}return a.join(", ")},kt=(e,a)=>{var T;const t=Ct(e==null?void 0:e.price),s=nt(e==null?void 0:e.variants);if(!s.length||!a||typeof a!="object")return t;let r=t,p=!1;for(const g of s){const l=String((g==null?void 0:g.name)||"").trim(),i=String((a==null?void 0:a[l])||"").trim();if(!l||!i)continue;const c=(Array.isArray(g.options)?g.options:[]).find(W=>String((W==null?void 0:W.label)||"").trim()===i);if(!c)continue;const M=Number(c==null?void 0:c.price);if(Number.isFinite(M)){r=Math.max(0,Math.trunc(M)),p=!0;continue}const L=Number((T=c==null?void 0:c.price_delta)!=null?T:0);Number.isFinite(L)&&(r+=Math.trunc(L))}return r},Tt=e=>window.KTM.orders.getOrderItems(e),qt=e=>window.KTM.orders.getOrderTotalQty(e),Pt=e=>window.KTM.orders.getOrderProductSummary(e,We),Kt=e=>window.KTM.orders.getOrderItemRows(e,We),zt=e=>window.KTM.orders.getOrderAdjustmentMoney(e),aa=e=>{const a=Tt(e),t=Kt(e),s=Vt(a),r=Ft(a),p=r.fee,T=zt(e),g=s+p+T,l=[];if(e!=null&&e.customer_name&&l.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&l.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&l.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&l.push(`GHI CH\xDA: ${(e.note||"").trim()}`),l.push(""),l.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const i of t)l.push(`- ${i.name} (SL: ${i.qty})`);else{const i=Pt(e);i&&i!=="\u2014"&&l.push(`- ${i}`)}l.push(""),l.push(`T\u1EA0M T\xCDNH: ${Oe(s)}`),r.found&&p!==0&&l.push(`SHIP: ${Oe(p)}`);{const i=String((e==null?void 0:e.adjustment_note)||"").trim();(T!==0||i)&&l.push(`\u0110I\u1EC0U CH\u1EC8NH: ${Oe(T)}${i?` (${i})`:""}`)}return l.push(`T\u1ED4NG: ${Oe(g)}`),l.filter(Boolean).join(`
`)},Gt=async e=>{try{const a=aa(e);await window.KTM.clipboard.writeText(a),typeof C=="function"?C("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof C=="function"?C("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Ft=e=>window.KTM.orders.getOrderShipInfo(e,We),Vt=e=>window.KTM.orders.getItemsSubtotal(e,We),Jt=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0");return`${t}-${s}`}catch(a){return""}},Ut=()=>ve?String(ve):Jt(new Date),Qt=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=w((e==null?void 0:e.phone)||""),s=String((e==null?void 0:e.address)||"").trim().toLowerCase(),r=ut(e==null?void 0:e.adjustment_amount),T=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(g=>{var l;return{product_id:String((g==null?void 0:g.product_id)||"").trim(),quantity:Number((l=g==null?void 0:g.quantity)!=null?l:0),variant:String((g==null?void 0:g.variant)||"").trim()}}).filter(g=>g.product_id&&Number.isFinite(g.quantity)&&g.quantity>0).sort((g,l)=>g.product_id<l.product_id?-1:g.product_id>l.product_id?1:g.variant<l.variant?-1:g.variant>l.variant?1:g.quantity-l.quantity);return JSON.stringify({name:a,phone:t,address:s,items:T,adj:r})},Dt=React.useMemo(()=>{const e=w((d==null?void 0:d.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ut()};const a=Ut(),t=(Array.isArray(q)?q:[]).filter(s=>{if(!s||j&&String(s.id)===String(j)||w(s.phone||"")!==e)return!1;const r=Jt(s.created_at);return r&&r===a}).sort((s,r)=>{const p=new Date(s.created_at).getTime(),T=new Date(r.created_at).getTime();return(Number.isFinite(T)?T:0)-(Number.isFinite(p)?p:0)});return{count:t.length,orders:t,monthKey:a}},[q,d==null?void 0:d.phone,ve,j]),na=e=>{var g;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=w((e==null?void 0:e.phone)||""),s=String((e==null?void 0:e.address)||"").trim().toLowerCase(),r=ut((g=e==null?void 0:e.adjustment_amount)!=null?g:0),p=Tt(e),T=(Array.isArray(p)?p:[]).map(l=>{var i;return{product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((i=l==null?void 0:l.quantity)!=null?i:0),variant:String((l==null?void 0:l.variant)||"").trim()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0).sort((l,i)=>l.product_id<i.product_id?-1:l.product_id>i.product_id?1:l.variant<i.variant?-1:l.variant>i.variant?1:l.quantity-i.quantity);return JSON.stringify({name:a,phone:t,address:s,items:T,adj:r})},Xt=React.useMemo(()=>{if(j)return"";const e=w((d==null?void 0:d.phone)||"");if(!e)return"";const a=Ut(),t=Qt(d),s=Array.isArray(q)?q:[];for(const r of s){if(!r||j&&String(r.id)===String(j)||w(r.phone||"")!==e)continue;const p=Jt(r.created_at);if(!p||p!==a)continue;const T=na(r);if(T&&T===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${r!=null&&r.id?` (#${r.id})`:""}`}return""},[q,d,ve,j]),Yt=e=>{var rt;const a=[],t=[],s=String((e==null?void 0:e.customer_name)||"").trim(),r=w((e==null?void 0:e.phone)||""),p=String((e==null?void 0:e.address)||"").trim();s||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),r||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),r&&!S(r)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),p||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const g=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Qe=>Qe&&Qe.product_id);g.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),g.some(Qe=>{var ft;const bt=Number((ft=Qe==null?void 0:Qe.quantity)!=null?ft:0);return!Number.isFinite(bt)||bt<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const i=new Set;let c=!1;for(const Qe of g){const bt=String(Qe.product_id||"").trim(),ft=String((Qe==null?void 0:Qe.variant)||"").trim();if(!bt)continue;const Ee=`${bt}||${ft}`;if(i.has(Ee)){c=!0;break}i.add(Ee)}c&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const M=Vt(g),L=Ft(g),W=L!=null&&L.found?Number((rt=L==null?void 0:L.fee)!=null?rt:0):0,ge=ut(e==null?void 0:e.adjustment_amount),He=String((e==null?void 0:e.adjustment_note)||"").trim();L!=null&&L.found&&(W>=2e5||M>0&&W>M*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Oe(W)}`),ge!==0&&!He&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Le=Math.abs(ge);return(Le>=5e5||M>0&&Le>M*.5)&&ge!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Oe(ge)}`),{errors:a,warnings:t,canSubmit:a.length===0}},la=React.useMemo(()=>Yt(d),[d,h]),ot=React.useMemo(()=>{var ft;const e=String((d==null?void 0:d.customer_name)||"").trim(),a=w((d==null?void 0:d.phone)||""),t=String((d==null?void 0:d.address)||"").trim(),s=Array.isArray(d==null?void 0:d.items)?d.items:[],r=new Map;for(const Ee of s){const Et=String((Ee==null?void 0:Ee.product_id)||"").trim(),Ht=String((Ee==null?void 0:Ee.variant)||"").trim();if(!Et)continue;const Bt=`${Et}||${Ht}`;r.set(Bt,(r.get(Bt)||0)+1)}const p=s.map(Ee=>{var ta;const Et=String((Ee==null?void 0:Ee.product_id)||"").trim(),Ht=Number((ta=Ee==null?void 0:Ee.quantity)!=null?ta:0),Bt=Et?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",sa=Number.isFinite(Ht)&&Ht>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",ia=String((Ee==null?void 0:Ee.variant)||"").trim(),oa=`${Et}||${ia}`,ra=Et&&(r.get(oa)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Bt,qtyError:sa,dupWarn:ra}}),T=s.filter(Ee=>Ee&&Ee.product_id),g=Vt(T),l=Ft(T),i=l!=null&&l.found?Number((ft=l==null?void 0:l.fee)!=null?ft:0):0,c=ut(d==null?void 0:d.adjustment_amount),M=String((d==null?void 0:d.adjustment_note)||"").trim(),L=Math.abs(c),W=c!==0&&!M?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ge=c!==0&&(L>=5e5||g>0&&L>g*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Oe(c)}`:"",He=l!=null&&l.found&&(i>=2e5||g>0&&i>g*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Oe(i)}`:"",Le=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",rt=a?S(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Qe=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",bt=!Le&&!rt&&p.every(Ee=>!Ee.productError&&!Ee.qtyError);return{nameError:Le,phoneError:rt,addressWarn:Qe,items:p,shipAbnormalWarn:He,adjustmentNoteWarn:W,adjustmentAbnormalWarn:ge,canSubmit:bt}},[d,h]),Zt=async e=>{var T,g,l;const a=(e==null?void 0:e.mode)||"close",t=Yt(d);if(!t.canSubmit){const i=t.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof C=="function"?C(i,"danger"):alert(i);return}if(!j&&Xt){const i=`${Xt}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(i)){(Dt==null?void 0:Dt.count)>0&&U(!0),setTimeout(()=>{var L;const M=document.getElementById("order-phone-input");M&&typeof M.scrollIntoView=="function"&&(M.scrollIntoView({block:"center",behavior:"smooth"}),(L=M.focus)==null||L.call(M))},0);return}}const s=w(d.phone),p=(Array.isArray(d.items)?d.items:[]).map(i=>{var c,M;return{product_id:(i==null?void 0:i.product_id)||"",quantity:Number((c=i==null?void 0:i.quantity)!=null?c:1),variant:String((i==null?void 0:i.variant)||"").trim()||null,variant_json:(M=i==null?void 0:i.variant_json)!=null?M:null,unit_price:(()=>{const L=i==null?void 0:i.unit_price,W=Number(L);if(Number.isFinite(W))return Math.max(0,Math.trunc(W));const ge=We(i==null?void 0:i.product_id),He=i!=null&&i.variant_json&&typeof i.variant_json=="object"?i.variant_json:null;return kt(ge,He)})()}}).filter(i=>i.product_id&&Number.isFinite(i.quantity)&&i.quantity>0);Q(!0);try{const i=j?`${API_BASE}/api/orders/${j}`:`${API_BASE}/api/orders`,c=p[0],M={customer_name:d.customer_name,phone:s,address:d.address,note:(d.note||"").trim(),adjustment_amount:ut(d.adjustment_amount),adjustment_note:(d.adjustment_note||"").trim(),product_id:c.product_id,quantity:c.quantity,status:d.status,items:p,...j?{id:j}:{}};if(j)await window.KTM.api.putJSON(i,M,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const L=await window.KTM.api.postJSON(i,M,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");jt.current={id:(l=(g=L==null?void 0:L.id)!=null?g:(T=L==null?void 0:L.order)==null?void 0:T.id)!=null?l:null,fingerprint:Qt(d),ts:Date.now()}}a==="new"&&!j?(St(""),Me(null),O(!0)):(St(""),Me(null),O(!1)),ct()}catch(i){console.error(i),typeof C=="function"?C(i.message,"danger"):alert(i.message);return}finally{Q(!1)}},Wt=e=>window.KTM.orders.getOrderTotalMoney(e,We),ea=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){we(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),ct(),At()}catch(a){console.error(a),typeof C=="function"?C(a.message,"danger"):alert(a.message)}finally{we(null)}}},Lt=async(e,a)=>{var s;const t=e==null?void 0:e.id;if(!(!t||!a)){De(t);try{const r=Tt(e),p=(Array.isArray(r)?r:[]).map(l=>{var i,c;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((i=l==null?void 0:l.quantity)!=null?i:1),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(c=l==null?void 0:l.variant_json)!=null?c:null,unit_price:(()=>{var W;const M=(W=l==null?void 0:l.unit_price)!=null?W:l==null?void 0:l.unitPrice,L=Number(M);return Number.isFinite(L)?Math.max(0,Math.trunc(L)):null})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);if(!p.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const T=p[0],g={id:t,customer_name:(e==null?void 0:e.customer_name)||"",phone:w((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",note:((e==null?void 0:e.note)||"").trim(),adjustment_amount:Number((s=e==null?void 0:e.adjustment_amount)!=null?s:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:T.product_id,quantity:T.quantity,status:a,items:p};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${t}`,g,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),H(l=>Array.isArray(l)?l.map(i=>(i==null?void 0:i.id)===t?{...i,status:a}:i):l),D(l=>Array.isArray(l)?l.map(i=>(i==null?void 0:i.id)===t?{...i,status:a}:i):l),typeof C=="function"&&C("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(r){console.error(r),typeof C=="function"?C(r.message,"danger"):alert(r.message)}finally{De(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:G&&!A||Z||!!ie||!!he}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:I,disabled:Z||!!ie},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:ve,onChange:e=>Ie(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:_}),ve&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Ie("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:G},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:Ze,onChange:e=>Ce(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:_},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),Ze&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Ce(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:G},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:_,onChange:e=>{const a=!!e.target.checked;u(a),a&&Ce("pending")}}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",m," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ct,disabled:G},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},Ze?`${yt.length}/${q.length} \u0111\u01A1n`:`${q.length} \u0111\u01A1n`)),Te.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Te.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",m," ng\xE0y.",P&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{u(!0),Ce("pending")}},"Xem ngay")),pt.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,pt.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",y," ng\xE0y).",le&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{u(!1),Ce("draft"),Ie(""),ct()}},"Xem ngay")),G?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):q.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):yt.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},yt.map(e=>{var a;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${Pe(e.status)}`},Ge(e.status)),Je(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${m} ng\xE0y`},"\u26A0 Ch\u1EADm ",Ve(e),"d"),at(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${k} ng\xE0y`},"\u23F3 C\xF2n ",tt(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=Kt(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((s,r)=>React.createElement("div",{key:r,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},r+1,"."),s.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",s.qty,Number(s.unitPrice)>0?` \u2022 ${Oe(s.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Pt(e))})()),(zt(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Oe(zt(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Oe(Wt(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",Nt(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary flex-fill",onClick:()=>Mt(e),disabled:Z||!!ie||he===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>Gt(e),disabled:Z||!!ie||he===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger flex-fill",onClick:()=>ea(e.id),disabled:Z||ie===e.id||he===e.id},ie===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>Lt(e,"processing"),disabled:Z||!!ie||he===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>Lt(e,"done"),disabled:Z||!!ie||he===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>Lt(e,"paid"),disabled:Z||!!ie||he===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:()=>Lt(e,"canceled"),disabled:Z||!!ie||he===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,yt.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=Kt(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,s)=>React.createElement("div",{key:s,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},s+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Oe(t.unitPrice))))):Pt(e)})()),React.createElement("td",null,qt(e)),React.createElement("td",{className:"fw-semibold"},Oe(Wt(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${Pe(e.status)}`},Ge(e.status)),Je(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${m} ng\xE0y`},"\u26A0 Ch\u1EADm ",Ve(e),"d"),at(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${k} ng\xE0y`},"\u23F3 C\xF2n ",tt(e),"d"))),React.createElement("td",null,Nt(e.created_at)),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary me-1",onClick:()=>Mt(e),disabled:Z||!!ie||he===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>Gt(e),disabled:Z||!!ie||he===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>Lt(e,"processing"),disabled:Z||!!ie||he===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>Lt(e,"done"),disabled:Z||!!ie||he===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>Lt(e,"paid"),disabled:Z||!!ie||he===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:()=>Lt(e,"canceled"),disabled:Z||!!ie||he===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>ea(e.id),disabled:Z||ie===e.id},ie===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))))))),A&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),j?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:E})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Zt({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:_t},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:d.customer_name,onChange:e=>de({...d,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!ot.nameError&&React.createElement("div",{className:"form-text text-danger"},ot.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:d.phone,onChange:e=>$e(e.target.value),onBlur:me,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!ot.phoneError&&React.createElement("div",{className:"form-text text-danger"},ot.phoneError),!ot.phoneError&&Dt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Dt.count," \u0111\u01A1n trong th\xE1ng ",Dt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>U(e=>!e)},se?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),se&&Dt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>U(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Dt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Pe(e.status)}`},Ge(e.status))),React.createElement("div",{className:"text-muted small"},Nt(e.created_at)," \u2022 ",Oe(Wt(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Pt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Mt(e)}},"M\u1EDF")))),Dt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(B==null?void 0:B.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(B==null?void 0:B.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(B==null?void 0:B.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(B==null?void 0:B.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:d.status,onChange:e=>de({...d,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:d.address,onChange:e=>de({...d,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!ot.addressWarn&&React.createElement("div",{className:"form-text text-warning"},ot.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:d.note,onChange:e=>de({...d,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:d.adjustment_amount,onChange:e=>de({...d,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!ot.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},ot.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:d.adjustment_note,onChange:e=>de({...d,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!ot.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},ot.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{de(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),qe(e=>[...Array.isArray(e)?e:[],""]),j&&ee(e=>[...Array.isArray(e)?e:[],!0])},disabled:Z},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(d.items)?d.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Se.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{f(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ue(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),o===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:Ke[a]||"",onChange:t=>{const s=t.target.value;qe(r=>{const p=Array.isArray(r)?[...r]:[];return p[a]=s,p})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=ht(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(s=>React.createElement("button",{key:s.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(s.id),p=nt(s==null?void 0:s.variants),T={};for(const i of p){const c=String((i==null?void 0:i.name)||"").trim(),M=Array.isArray(i==null?void 0:i.options)?i.options[0]:null,L=String((M==null?void 0:M.label)||"").trim();c&&L&&(T[c]=L)}const g=wt(T),l=kt(s,T);de(i=>{const c=Array.isArray(i.items)?[...i.items]:[];return c[a]={...c[a]||{quantity:1},product_id:r,variant_json:Object.keys(T).length?T:null,variant:g,unit_price:p.length?l:null},{...i,items:c}}),f(null)}},s.name,s.code?` (${s.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),h.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var s;const t=(s=ot.items)==null?void 0:s[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=We(e.product_id),s=nt(t==null?void 0:t.variants);if(!s.length)return null;const r=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},s.map((p,T)=>{const g=String((p==null?void 0:p.name)||`Bi\u1EBFn th\u1EC3 ${T+1}`).trim(),l=String((r==null?void 0:r[g])||"").trim();return React.createElement("div",{key:g},React.createElement("label",{className:"form-label small text-muted mb-1"},g),React.createElement("select",{className:"form-select",value:l,onChange:i=>{const c=String(i.target.value||"").trim();de(M=>{const L=Array.isArray(M.items)?[...M.items]:[],W={...L[a]||{}},ge=We(W.product_id),He=nt(ge==null?void 0:ge.variants),Le=W!=null&&W.variant_json&&typeof W.variant_json=="object"?{...W.variant_json}:{};c?Le[g]=c:delete Le[g];const rt=wt(Le),Qe=kt(ge,Le);return L[a]={...W,variant_json:Object.keys(Le).length?Le:null,variant:rt,unit_price:Qe},{...M,items:L}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",g," --"),(Array.isArray(p==null?void 0:p.options)?p.options:[]).map(i=>React.createElement("option",{key:i.label,value:i.label},i.label,Number.isFinite(Number(i==null?void 0:i.price))?` (${Oe(Number(i.price))})`:Number(i==null?void 0:i.price_delta)?` (${i.price_delta>0?"+":""}${i.price_delta})`:""))))}))})(),j&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!F[a],onChange:t=>{const s=!!t.target.checked;ee(r=>{const p=Array.isArray(r)?[...r]:[],T=Array.isArray(d.items)?d.items.length:0;for(;p.length<T;)p.push(!0);return p[a]=s,p})},disabled:Z||be}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const s=t.target.value;de(r=>{const p=Array.isArray(r.items)?[...r.items]:[];return p[a]={...p[a]||{product_id:""},quantity:s},{...r,items:p}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var s;const t=(s=ot.items)==null?void 0:s[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{de(t=>{const s=Array.isArray(t.items)?[...t.items]:[];return s.splice(a,1),{...t,items:s.length?s:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),qe(t=>{const s=Array.isArray(t)?[...t]:[];return s.splice(a,1),s.length?s:[""]}),ee(t=>{const s=Array.isArray(t)?[...t]:[];return s.splice(a,1),s}),f(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:Z||be||(Array.isArray(d.items)?d.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(d.items)?d.items:[]).filter(T=>T==null?void 0:T.product_id),t=Vt(a),s=Ft(a),r=ut(d.adjustment_amount),p=t+(s.found?s.fee:0)+r;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Oe(t))),s.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Oe(s.fee))),!!ot.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},ot.shipAbnormalWarn),r!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Oe(r))),(d.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(d.note||"").trim()),(d.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",(d.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Oe(p)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:E,disabled:Z||be,style:{borderRadius:10}},"H\u1EE7y"),!!j&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:X,disabled:Z||be,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},be?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!j&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Zt({mode:"new"}),disabled:Z||!ot.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:Z||be||!ot.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

