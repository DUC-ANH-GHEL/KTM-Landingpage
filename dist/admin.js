const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:_,error:M}){const[L,oe]=useState(""),[W,F]=useState(""),[q,Se]=useState(!1),[Ce,pe]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),M&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),M),React.createElement("form",{onSubmit:async Je=>{Je.preventDefault(),Se(!0),await _(L,W),Se(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:L,onChange:Je=>oe(Je.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:Ce?"text":"password",className:"form-control",value:W,onChange:Je=>F(Je.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>pe(!Ce)},React.createElement("i",{className:`fas fa-eye${Ce?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:q},q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:_,type:M,onClose:L,actionLabel:oe,onAction:W,durationMs:F}){return useEffect(()=>{const q=Number(F),Se=Number.isFinite(q)&&q>0?q:3e3,Ce=setTimeout(L,Se);return()=>clearTimeout(Ce)},[L,F]),React.createElement("div",{className:`toast show align-items-center text-white bg-${M} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},_),oe&&typeof W=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{W()}finally{L()}}},oe),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:L})))}function Loading({show:_}){return _?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:_,title:M,subtitle:L,onClose:oe,footer:W,children:F}){return useEffect(()=>{if(!_)return;const q=Se=>{Se.key==="Escape"&&(Se.preventDefault(),typeof oe=="function"&&oe())};return document.addEventListener("keydown",q),()=>document.removeEventListener("keydown",q)},[_,oe]),_?React.createElement("div",{className:`admin-drawer-root ${_?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:oe,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},M),L?React.createElement("div",{className:"admin-drawer-subtitle"},L):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:oe,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},F),W?React.createElement("div",{className:"admin-drawer-footer"},W):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(_){try{const M=localStorage.getItem(_);if(!M)return[];const L=JSON.parse(M);return Array.isArray(L)?L.map(oe=>String(oe||"").trim()).filter(Boolean):[]}catch(M){return[]}}function saveAdminMenuIdsToStorage(_,M){try{localStorage.setItem(_,JSON.stringify(Array.isArray(M)?M:[]))}catch(L){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(_){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,_),_}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(_){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,_),_}function Sidebar({activeMenu:_,onMenuChange:M,onLogout:L,currentUser:oe,pinnedMenus:W,recentMenus:F,onTogglePin:q}){const Se=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],Ce=(oe==null?void 0:oe.username)||(oe==null?void 0:oe.name)||(oe==null?void 0:oe.email)||"Admin",pe=useMemo(()=>{const Te=new Map;for(const P of Se)Te.set(P.id,P);return Te},[]),Oe=Array.isArray(W)?W:[],Je=Array.isArray(F)?F:[],Ae=Oe.map(Te=>pe.get(Te)).filter(Boolean),Me=Je.filter(Te=>Te!==_).map(Te=>pe.get(Te)).filter(Boolean).slice(0,5),Ge=Te=>Oe.includes(Te);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},Ce),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},Ae.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},Ae.map(Te=>React.createElement("a",{key:`pin-${Te.id}`,href:"#",className:`nav-link ${_===Te.id?"active":""} sidebar-quicklink`,onClick:P=>{P.preventDefault(),M(Te.id)}},React.createElement("i",{className:`fas ${Te.icon}`})," ",Te.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:P=>{P.preventDefault(),P.stopPropagation(),q&&q(Te.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),Me.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},Me.map(Te=>React.createElement("a",{key:`recent-${Te.id}`,href:"#",className:`nav-link ${_===Te.id?"active":""} sidebar-quicklink`,onClick:P=>{P.preventDefault(),M(Te.id)}},React.createElement("i",{className:`fas ${Te.icon}`})," ",Te.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),Se.map(Te=>React.createElement("a",{key:Te.id,href:"#",className:`nav-link ${_===Te.id?"active":""} ${Te.disabled?"opacity-50":""} ${Te.highlight?"text-warning":""}`,onClick:P=>{P.preventDefault(),Te.disabled||M(Te.id)}},React.createElement("i",{className:`fas ${Te.icon}`})," ",Te.label,Te.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),Te.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${Ge(Te.id)?"pinned":""}`,onClick:P=>{P.preventDefault(),P.stopPropagation(),q&&q(Te.id)},title:Ge(Te.id)?"B\u1ECF ghim":"Ghim","aria-label":Ge(Te.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),L&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:L,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(_){const M=typeof _=="number"?_:parseFloat(String(_!=null?_:"").trim());return Number.isFinite(M)?Math.max(0,Math.min(100,M)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var _;try{const M=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!M)return{ship_percent:DEFAULT_SHIP_PERCENT};const L=JSON.parse(M);return{ship_percent:normalizeShipPercent((_=L==null?void 0:L.ship_percent)!=null?_:L==null?void 0:L.shipPercent)}}catch(M){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(_){var M;try{const L={ship_percent:normalizeShipPercent((M=_==null?void 0:_.ship_percent)!=null?M:_==null?void 0:_.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(L)),L}catch(L){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var M;const _=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((M=_==null?void 0:_.ship_percent)!=null?M:_==null?void 0:_.shipPercent)}}async function saveAdminSettingsToServer(_){var oe,W,F;const M={ship_percent:normalizeShipPercent((oe=_==null?void 0:_.ship_percent)!=null?oe:_==null?void 0:_.shipPercent)},L=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,M,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((F=(W=L==null?void 0:L.ship_percent)!=null?W:L==null?void 0:L.shipPercent)!=null?F:M.ship_percent)}}function AlbumList({albums:_,onSelect:M,onCreate:L,onEdit:oe,onDelete:W,loading:F,currentFolder:q,onBack:Se,breadcrumb:Ce}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},q&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:Se},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),q?q.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:L},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),Ce&&Ce.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:pe=>{pe.preventDefault(),Se("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Ce.map((pe,Oe)=>React.createElement("li",{key:pe.id,className:`breadcrumb-item ${Oe===Ce.length-1?"active":""}`},Oe===Ce.length-1?pe.title:React.createElement("a",{href:"#",onClick:Je=>{Je.preventDefault(),Se(pe)},className:"text-warning"},pe.title))))),F?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):_.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},q?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},_.map(pe=>React.createElement("div",{key:pe.uuid||pe.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>M(pe)},pe.cover?React.createElement("img",{src:pe.cover,className:"album-cover",alt:pe.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},pe.title),React.createElement("small",{className:"text-muted"},pe.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),pe.subfolderCount),pe.subfolderCount>0&&pe.count>0&&" \u2022 ",pe.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),pe.count),pe.subfolderCount===0&&pe.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Oe=>{Oe.stopPropagation(),oe(pe)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Oe=>{Oe.stopPropagation(),W(pe)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:_,album:M,onClose:L,onSave:oe,parentId:W}){const[F,q]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[Se,Ce]=useState(!1),[pe,Oe]=useState(!1),Je=useRef(null);useEffect(()=>{q(M?{slug:M.id||"",title:M.title||"",description:M.description||"",cover_url:M.cover||"",parent_id:M.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:W||null})},[M,_,W]);const Ae=async P=>{P.preventDefault(),Ce(!0),await oe(F),Ce(!1)},Me=P=>P.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Ge=async P=>{const pt=P.type==="image/heic"||P.type==="image/heif"||/\.heic$/i.test(P.name);if(P.size<=2097152&&!pt)return P;try{const it=await createImageBitmap(P),$e=document.createElement("canvas");let He=it.width,ye=it.height;const Ze=800;return(He>Ze||ye>Ze)&&(He>ye?(ye=Math.round(ye/He*Ze),He=Ze):(He=Math.round(He/ye*Ze),ye=Ze)),$e.width=He,$e.height=ye,$e.getContext("2d").drawImage(it,0,0,He,ye),it.close(),new Promise((jt,Ke)=>{$e.toBlob(ht=>{ht?jt(new File([ht],P.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ke(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(it){throw console.error("Compress cover error:",it),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Te=async P=>{var it;const Qe=P.target.files[0];if(!Qe)return;if(!(Qe.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Qe.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Oe(!0);try{const $e=await Ge(Qe),He=await window.KTM.cloudinary.uploadImage({file:$e,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!He.secure_url)throw console.error("Cloudinary error:",He),new Error(((it=He.error)==null?void 0:it.message)||"Upload failed");q(ye=>({...ye,cover_url:He.secure_url}))}catch($e){console.error("Cover upload error:",$e),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+$e.message)}Oe(!1),P.target.value=""};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},M?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:Ae},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:F.title,onChange:P=>q({...F,title:P.target.value,slug:F.slug||Me(P.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:F.slug,onChange:P=>q({...F,slug:P.target.value}),required:!0,disabled:!!M}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:F.description,onChange:P=>q({...F,description:P.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},F.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:F.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>q(P=>({...P,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:Je,type:"file",accept:"image/*",className:"d-none",onChange:Te}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var P;return(P=Je.current)==null?void 0:P.click()},disabled:pe},pe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:F.cover_url,onChange:P=>q({...F,cover_url:P.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:Se||pe},Se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:_,allAlbums:M,currentAlbumId:L,targetAlbum:oe,onSelect:W,level:F=0}){const[q,Se]=useState(!0),Ce=_.uuid||_.id,pe=Ce===L,Oe=oe===Ce,Je=M.filter(Me=>Me.parentId===Ce),Ae=Je.length>0;return React.createElement("div",{style:{marginLeft:F*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Oe?"bg-info text-white":pe?"bg-light text-muted":"hover-bg"}`,style:{cursor:pe?"not-allowed":"pointer",opacity:pe?.5:1,transition:"background 0.2s"},onClick:()=>!pe&&W(Ce)},Ae&&React.createElement("i",{className:`fas fa-chevron-${q?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:Me=>{Me.stopPropagation(),Se(!q)}}),!Ae&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Oe?"-open":""} me-2 ${Oe?"":"text-warning"}`}),React.createElement("span",{className:"small"},_.title),pe&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),_.count>0&&!pe&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},_.count)),q&&Ae&&React.createElement("div",null,Je.map(Me=>React.createElement(FolderTreeItem,{key:Me.uuid||Me.id,folder:Me,allAlbums:M,currentAlbumId:L,targetAlbum:oe,onSelect:W,level:F+1}))))}function AlbumDetail({album:_,onBack:M,onRefresh:L,showToast:oe,onNavigateToFolder:W,onEditSubfolder:F,parentAlbum:q}){const[Se,Ce]=useState([]),[pe,Oe]=useState([]),[Je,Ae]=useState(!0),[Me,Ge]=useState(!1),[Te,P]=useState(""),[Qe,pt]=useState([]),[it,$e]=useState([]),[He,ye]=useState({}),[Ze,xt]=useState(null),[jt,Ke]=useState(!1),[ht,Tt]=useState(""),[w,N]=useState(!1),D=useRef(null),le=useRef(null),[de,Z]=useState(!1),[ie,Ne]=useState([]),[y,j]=useState([]),[z,me]=useState(""),[xe,be]=useState(!1),Le=async(I,c=2)=>{const E=c*1024*1024,J=I.type==="image/heic"||I.type==="image/heif"||/\.heic$/i.test(I.name);if(I.size<=E&&!J)return I;try{const we=await createImageBitmap(I),ke=document.createElement("canvas");let je=we.width,et=we.height;const Pe=1200;return(je>Pe||et>Pe)&&(je>et?(et=Math.round(et/je*Pe),je=Pe):(je=Math.round(je/et*Pe),et=Pe)),ke.width=je,ke.height=et,ke.getContext("2d").drawImage(we,0,0,je,et),we.close(),new Promise((kt,Dt)=>{ke.toBlob(Wt=>{Wt?kt(new File([Wt],I.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Dt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(we){throw console.error("Compress error:",we),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{Re(),rt()},[_.id,_.uuid]);const Re=async()=>{Ae(!0);try{const I=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${_.uuid||_.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Ce(I.images||[]);const c=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${_.uuid||_.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Oe(Array.isArray(c)?c:[])}catch(I){console.error(I),oe("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}Ae(!1)},rt=async()=>{try{const I=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");j(Array.isArray(I)?I:[])}catch(I){console.error("Error loading albums:",I)}},vt=I=>{Ne(c=>c.includes(I)?c.filter(E=>E!==I):[...c,I])},fe=async()=>{if(!z||ie.length===0){oe("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}be(!0);let I=0;for(const c of ie)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${c}`,{album_id:z},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),I++}catch(E){console.error("Move error:",E)}be(!1),Z(!1),Ne([]),me(""),I>0?(oe("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),Re(),L()):oe("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[ze,Mt]=useState(!1),ot=async()=>{if(ie.length===0||!confirm(`X\xF3a ${ie.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Mt(!0);let I=0;for(const c of ie)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${c}`,"L\u1ED7i x\xF3a \u1EA3nh"),I++}catch(E){console.error("Delete error:",E)}Mt(!1),Ne([]),I>0?(oe(`\u0110\xE3 x\xF3a ${I} \u1EA3nh!`,"success"),Re(),L()):oe("X\xF3a th\u1EA5t b\u1EA1i","danger")},Kt=()=>{ie.length===Se.length?Ne([]):Ne(Se.map(I=>I.id))},$t=async()=>{if(ht.trim()){N(!0);try{const I=ht.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:I+"-"+Date.now(),title:ht,parent_id:_.uuid||_.id},"L\u1ED7i t\u1EA1o folder"),oe("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Tt(""),Ke(!1),Re(),L()}catch(I){oe(I.message,"danger")}N(!1)}},aa=async I=>{if(confirm(`X\xF3a folder "${I.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${I.uuid||I.id}`,"L\u1ED7i x\xF3a folder"),oe("\u0110\xE3 x\xF3a folder","success"),Re(),L()}catch(c){oe("L\u1ED7i x\xF3a folder","danger")}},Jt=I=>{const c=Array.from(I).filter(E=>E.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(E.name));pt(E=>[...E,...c]),c.forEach(E=>{const J=new FileReader;J.onload=we=>{$e(ke=>[...ke,{file:E,preview:we.target.result}])},J.readAsDataURL(E)})},k=I=>{pt(c=>c.filter((E,J)=>J!==I)),$e(c=>c.filter((E,J)=>J!==I))},U=async I=>{var E;const c=await window.KTM.cloudinary.uploadImage({file:I,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${_.id}`});if(!c.secure_url)throw console.error("Cloudinary error:",c),new Error(((E=c.error)==null?void 0:E.message)||"Upload failed");return c},We=async()=>{if(Qe.length===0)return;Ge(!0);let I=0;for(let c=0;c<Qe.length;c++)try{P(`\u0110ang x\u1EED l\xFD ${c+1}/${Qe.length}...`);const E=await Le(Qe[c],2);P(`\u0110ang upload ${c+1}/${Qe.length}...`);const J=await U(E);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${_.id}`,{url:J.secure_url,caption:He[c]||Qe[c].name.replace(/\.[^/.]+$/,""),sort_order:Se.length+c},"L\u1ED7i l\u01B0u \u1EA3nh"),I++}catch(E){console.error("Upload error:",E)}Ge(!1),P(""),pt([]),$e([]),ye({}),I>0?(oe(`\u0110\xE3 upload ${I} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),Re(),L()):oe("Upload th\u1EA5t b\u1EA1i","danger")},yt=async(I,c)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${I}`,"L\u1ED7i x\xF3a \u1EA3nh"),oe("\u0110\xE3 x\xF3a \u1EA3nh","success"),Re(),L()}catch(E){oe("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Gt=I=>{var c;I.preventDefault(),(c=le.current)==null||c.classList.add("dragover")},St=()=>{var I;(I=le.current)==null||I.classList.remove("dragover")},It=I=>{var c;I.preventDefault(),(c=le.current)==null||c.classList.remove("dragover"),Jt(I.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:M},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},_.title),React.createElement("small",{className:"text-muted"},pe.length>0&&React.createElement("span",null,pe.length," folder \u2022 "),Se.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Ke(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),jt&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:ht,onChange:I=>Tt(I.target.value),onKeyPress:I=>I.key==="Enter"&&$t(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:$t,disabled:w||!ht.trim()},w?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Ke(!1),Tt("")}},"H\u1EE7y")))),pe.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},pe.map(I=>React.createElement("div",{key:I.uuid||I.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>W&&W(I)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},I.title),React.createElement("small",{className:"text-muted"},I.subfolderCount>0&&React.createElement("span",null,I.subfolderCount," folder"),I.subfolderCount>0&&I.count>0&&" \u2022 ",I.count>0&&React.createElement("span",null,I.count," \u1EA3nh"),I.subfolderCount===0&&I.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:c=>{c.stopPropagation(),F&&F(I)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:c=>{c.stopPropagation(),aa(I)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:le,className:"upload-zone",onClick:()=>{var I;return(I=D.current)==null?void 0:I.click()},onDragOver:Gt,onDragLeave:St,onDrop:It},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:D,type:"file",multiple:!0,accept:"image/*",onChange:I=>Jt(I.target.files)})),it.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},it.map((I,c)=>React.createElement("div",{key:c,className:"upload-preview-item"},React.createElement("img",{src:I.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>k(c)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:We,disabled:Me},Me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Te||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Qe.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",Se.length,")"),Se.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Kt},ie.length===Se.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ie.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ie.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>Z(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:ot,disabled:ze},ze?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Ne([])},React.createElement("i",{className:"fas fa-times"})))),Je?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):Se.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},Se.map((I,c)=>React.createElement("div",{key:c,className:`image-item ${ie.includes(I.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>vt(I.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ie.includes(I.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ie.includes(I.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ie.includes(I.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:I.src,alt:I.caption,style:{opacity:ie.includes(I.id)?.7:1,border:ie.includes(I.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:E=>{E.stopPropagation(),yt(I.id,c)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),I.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},I.caption)))))),de&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ie.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>Z(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},y.filter(I=>!I.parentId).map(I=>React.createElement(FolderTreeItem,{key:I.uuid||I.id,folder:I,allAlbums:y,currentAlbumId:_.uuid||_.id,targetAlbum:z,onSelect:me})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>Z(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:fe,disabled:!z||xe},xe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Ze&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>xt(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>xt(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Ze.src,alt:Ze.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:I=>I.stopPropagation()}),Ze.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Ze.caption)))))}function SearchCenter({showToast:_,onNavigate:M}){const[L,oe]=useState(""),[W,F]=useState([]),[q,Se]=useState([]),[Ce,pe]=useState([]),[Oe,Je]=useState("all"),[Ae,Me]=useState(null),[Ge,Te]=useState("list"),[P,Qe]=useState(!0),[pt,it]=useState([]),[$e,He]=useState([]),ye=useRef(null),[Ze,xt]=useState(!0),[jt,Ke]=useState(!1),ht=useRef(null),Tt=useRef(null),w=useRef(null),[N,D]=useState(!1),[le,de]=useState([]),[Z,ie]=useState([]),[Ne,y]=useState(""),j=useRef(null),z=useRef(new Map),[me,xe]=useState("auto"),[be,Le]=useState({start:0,end:20}),[Re,rt]=useState(!1),[vt,fe]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[ze,Mt]=useState(""),[ot,Kt]=useState(!1),$t=useRef(null),aa=useRef(null),Jt=s=>s?String(s).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",k=s=>s?String(s).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",U=(s,u)=>{if(!s||!u)return s;const m=new RegExp(`(${u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return s.replace(m,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const s=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),u=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");de(Array.isArray(s)?s.slice(0,10):[]),ie(Array.isArray(u)?u:[])}catch(s){}},[]);const We=s=>{if(!s.trim())return;const u=[s,...le.filter(m=>m!==s)].slice(0,10);de(u);try{localStorage.setItem("ktm_search_history",JSON.stringify(u))}catch(m){}},yt=s=>{if(!s.trim())return;const u=Z.includes(s)?Z.filter(m=>m!==s):[s,...Z].slice(0,5);ie(u);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(u))}catch(m){}},Gt="ktm_search_query_stats_v1",St="ktm_search_product_stats_v1",It=(s,u)=>{try{const m=localStorage.getItem(s);if(!m)return u;const $=JSON.parse(m);return $!=null?$:u}catch(m){return u}},I=(s,u)=>{try{localStorage.setItem(s,JSON.stringify(u))}catch(m){}},[c,E]=useState(()=>It(Gt,{})),[J,we]=useState(()=>It(St,{})),ke=useRef(!1),je=useRef(new Map);useEffect(()=>{const s=u=>{u&&(u.key===Gt&&E(It(Gt,{})),u.key===St&&we(It(St,{})))};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const et=s=>{const u=String(s||"").trim();if(!u)return;const m=Ct(u).trim();if(m.length<3||m==="sdt:"||m==="#"||m.endsWith(":"))return;const $=Date.now(),H=It(Gt,c&&typeof c=="object"?c:{}),A={...H&&typeof H=="object"?H:{}},v=A[m]&&typeof A[m]=="object"?A[m]:{};A[m]={q:u,count:(Number(v.count)||0)+1,lastAt:$},E(A),I(Gt,A)},Pe=(s,u)=>{if(!s||s._type!=="product")return;const m=String(s.id||"").trim();if(!m)return;const $=Date.now(),H=It(St,J&&typeof J=="object"?J:{}),A={...H&&typeof H=="object"?H:{}},v=A[m]&&typeof A[m]=="object"?A[m]:{};A[m]={id:m,name:String(s.name||v.name||"").trim(),code:String(s.code||v.code||"").trim(),count:(Number(v.count)||0)+1,lastAt:$,action:String(u||v.action||"").trim()},we(A),I(St,A)},Vt=(s,u)=>{const m=String(s||"").trim();if(!m)return;const $=Ct(m).trim();if($.length<3||$==="sdt:"||$==="#"||$.endsWith(":"))return;const H=Date.now(),A=Number(je.current.get($)||0);if(H-A<3e4)return;const ne=(Array.isArray(u)?u:[]).find(ve=>ve&&ve._type==="product");ne&&(je.current.set($,H),Pe(ne,"search"))},kt=useMemo(()=>Object.values(c&&typeof c=="object"?c:{}).map(m=>({q:String((m==null?void 0:m.q)||"").trim(),count:Number(m==null?void 0:m.count)||0,lastAt:Number(m==null?void 0:m.lastAt)||0})).filter(m=>m.q&&m.count>0).sort((m,$)=>$.count-m.count||$.lastAt-m.lastAt).slice(0,6),[c]),Dt=useMemo(()=>Object.values(J&&typeof J=="object"?J:{}).map(m=>({id:String((m==null?void 0:m.id)||"").trim(),name:String((m==null?void 0:m.name)||"").trim(),code:String((m==null?void 0:m.code)||"").trim(),count:Number(m==null?void 0:m.count)||0,lastAt:Number(m==null?void 0:m.lastAt)||0})).filter(m=>m.id&&m.count>0).sort((m,$)=>$.count-m.count||$.lastAt-m.lastAt).slice(0,8).map(m=>{const $=q.find(H=>H&&H._type==="product"&&String(H.id)===m.id);return $?{...m,item:$}:{...m,item:null}}),[J,q]),Wt=(s,u={})=>{const m=String(s||"");ea(m),u.addToHistory!==!1&&We(m),D(!1),va(!1),lt(!1),u.focus!==!1?(ke.current=!0,setTimeout(()=>{var A;const H=ye.current;(A=H==null?void 0:H.focus)==null||A.call(H);try{if(u.caret==="end"&&H&&typeof H.setSelectionRange=="function"){const v=String(H.value||"").length;H.setSelectionRange(v,v)}}catch(v){}},0)):(ke.current=!1,setTimeout(()=>{var H,A,v,ne;try{(A=(H=ye.current)==null?void 0:H.blur)==null||A.call(H),(ne=(v=document.activeElement)==null?void 0:v.blur)==null||ne.call(v)}catch(ve){}},0))},[Ht,Ft]=useState(null),[Ta,ua]=useState(!1),[Yt,na]=useState(null),[wa,lt]=useState(!1),[$a,pa]=useState(!1),[Qt,xa]=useState(null),[Lt,qe]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),Ra=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Pa=s=>{var u,m;s._type==="product"&&(na(s),qe({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(m=(u=s.commission_percent)!=null?u:s.commissionPercent)!=null?m:""}),ua(!0))},Et=async()=>{if(Yt)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${Yt.id}`,Lt,"L\u1ED7i c\u1EADp nh\u1EADt"),_("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),ua(!1),na(null),Rt()}catch(s){_(s.message,"danger")}},Ue=async s=>{const u=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${u} "${s.name}"?`))try{let m="";s._type==="product"?m=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?m=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(m=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(m,"L\u1ED7i x\xF3a"),_(`\u0110\xE3 x\xF3a ${u}`,"success"),Rt()}catch(m){_(m.message,"danger")}},Ot=async s=>{try{const u=Qt?`${API_BASE}/api/products?id=${Qt.id}`:`${API_BASE}/api/products`;Qt?await window.KTM.api.putJSON(u,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(u,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),_(Qt?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),pa(!1),xa(null),Rt()}catch(u){_(u.message,"danger")}},ra="ktm_admin_data_cache_v1",ha=1e3*60*10,Rt=async()=>{let s=null,u=!1;const m=window.KTM.cache.read(ra,{ttlMs:ha,validate:Array.isArray});m.hit?(s=m.value,console.log("[CACHE] Using cache, items:",s.length),Se(s),F(s),Qe(!1),u=!0):m.status==="miss"?console.log("[CACHE] No cache found"):m.status==="expired"||m.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):m.status==="error"&&console.error("[CACHE] Error parsing cache"),u||Qe(!0);try{const $=async(Ye,f)=>{try{const r=await window.KTM.api.getJSON(Ye,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return r!=null?r:f}catch(r){return f}},[H,A,v]=await Promise.all([$(`${API_BASE}/api/products?fields=search`,[]),$(`${API_BASE}/api/albums`,[]),$(`${API_BASE}/api/video-folders?withVideos=true`,[])]),ne=Array.isArray(H)?H.map(Ye=>({...Ye,_type:"product",_source:"database"})):[];it(A);let ve=[];Array.isArray(A)&&A.length>0&&(await Promise.all(A.map(f=>$(`${API_BASE}/api/albums/${f.id}`,{})))).forEach((f,r)=>{const b=A[r];f.images&&f.images.length>0&&f.images.forEach(K=>{ve.push({id:K.id,name:K.caption||"\u1EA2nh t\u1EEB "+b.title,image:K.src,folder:b.title,_type:"album",_source:"database"})})}),He(v);let se=[];Array.isArray(v)&&v.forEach(Ye=>{Ye.videos&&Ye.videos.forEach(f=>{se.push({id:f.id,name:f.title,folder:Ye.name,image:f.thumb,youtubeId:f.youtubeId,url:f.url,_type:"video",_source:"database"})})});const ce=[...ne,...ve,...se];(!s||JSON.stringify(ce)!==JSON.stringify(s))&&(Se(ce),F(ce),window.KTM.cache.write(ra,ce))}catch($){console.error("Song song fetch error:",$)}Qe(!1)};useEffect(()=>{Rt(),setTimeout(()=>{var u;return(u=ye.current)==null?void 0:u.focus()},100);const s=u=>{var m,$;(u.ctrlKey||u.metaKey)&&u.key==="k"&&(u.preventDefault(),D(!0),setTimeout(()=>{var H;return(H=j.current)==null?void 0:H.focus()},0)),u.key==="/"&&!N&&((m=document.activeElement)==null?void 0:m.tagName)!=="INPUT"&&(u.preventDefault(),($=ye.current)==null||$.focus()),u.key==="Escape"&&N&&D(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[N]);const Ct=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(u){return String(s!=null?s:"").toLowerCase()}},fa=s=>{const m=Ct(s).trim().split(/\s+/).filter(Boolean).map(ve=>{const se=String(ve||"").trim();return se?se.startsWith("#")?se.slice(1):se.startsWith("sdt:")?se.slice(4):se.startsWith("phone:")?se.slice(6):se:""}).filter(Boolean),$=m.includes("anh"),H=m.includes("video"),A=m.filter(ve=>ve!=="anh"&&ve!=="video"),v=A.join(" "),ne=new Set(["product"]);return $&&ne.add("album"),H&&ne.add("video"),{allowedTypes:ne,includeAlbum:$,includeVideo:H,contentTokens:A,cleanedQuery:v}},Zt=(s,u,m)=>{var r,b,K,ee,V;const $=Array.isArray(u)?u:[],H=Ct(m).trim();if(!$.length&&!H)return 0;const A=Ct((r=s==null?void 0:s.name)!=null?r:""),v=Ct((b=s==null?void 0:s.code)!=null?b:""),ne=Ct((K=s==null?void 0:s.category)!=null?K:""),ve=Ct((ee=s==null?void 0:s.note)!=null?ee:""),se=Ct((V=s==null?void 0:s.folder)!=null?V:"");if(!`${A} ${v} ${ne} ${ve} ${se}`.trim())return 0;const Ee=A.replace(/\s+/g,""),Ye=H.replace(/\s+/g,"");let f=0;H&&(A===H&&(f+=220),A.includes(H)&&(f+=140),A.startsWith(H)&&(f+=160),Ye&&(Ee===Ye?f+=280:Ee.startsWith(Ye)?f+=180:Ee.includes(Ye)&&(f+=110)),v&&v===H&&(f+=180),v&&v.includes(H)&&(f+=90));for(const X of $){if(!X)continue;const T=new RegExp(`(?:^|\\s)${X.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`),Y=String(X).replace(/\s+/g,"");A.includes(X)&&(f+=35),T.test(A)&&(f+=25),Y&&(Ee===Y?f+=90:Ee.startsWith(Y)?f+=50:Ee.includes(Y)&&(f+=28)),v&&v.includes(X)&&(f+=20),v&&T.test(v)&&(f+=10),ne&&ne.includes(X)&&(f+=12),se&&se.includes(X)&&(f+=12),ve&&ve.includes(X)&&(f+=6)}return f>0&&A&&(f+=Math.max(0,10-Math.min(10,Math.floor(A.length/10)))),f},sa=(s,u,m)=>{const $=Array.isArray(s)?s:[];return $.length?$.map((A,v)=>({it:A,idx:v,score:Zt(A,u,m)})).sort((A,v)=>v.score!==A.score?v.score-A.score:A.idx-v.idx).map(A=>A.it):[]},Ia=async(s,u)=>{if(!(!Ze||u.length===0)){Ke(!0);try{const m=u.map(H=>({id:H.id,name:H.name,price:H.price,category:H.category,note:H.note,folder:H.folder,_type:H._type})),$=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:m},"AI Search error");if($&&$.matchedIds&&$.matchedIds.length>0){const{contentTokens:H,cleanedQuery:A}=fa(s),v=new Set($.matchedIds),ne=u.filter(ve=>v.has(ve.id)).sort((ve,se)=>Zt(se,H,A)-Zt(ve,H,A));ne.length>0&&F(ne)}else $&&$.matchedIds&&$.matchedIds.length===0&&F([])}catch(m){console.error("AI Search error:",m)}Ke(!1)}},ea=s=>{if(oe(s),y(s),Tt.current&&clearTimeout(Tt.current),ht.current&&clearTimeout(ht.current),w.current&&w.current.abort(),!s.trim()){oa(Oe);return}const m=`v2|${Ct(s).trim().replace(/\s+/g,"")}|${Oe}`;if(z.current.has(m)){F(z.current.get(m));return}const{allowedTypes:$,contentTokens:H,cleanedQuery:A}=fa(s);Tt.current=setTimeout(()=>{const v=q.filter(se=>{if(!$.has(se==null?void 0:se._type))return!1;if(H.length===0)return!0;const ce=Jt(Object.entries(se).filter(([r])=>!r.startsWith("_")).map(([,r])=>String(r||"")).join(" ")),Ee=se.phone?k(se.phone):"",Ye=`${ce} ${Ee}`.trim(),f=Ye.replace(/\s+/g,"");return H.every(r=>{const b=String(r||"").trim();return b?Ye.includes(b)||f.includes(b.replace(/\s+/g,"")):!0})});let ne=v;Oe!=="all"&&(ne=v.filter(se=>(se==null?void 0:se._type)===Oe));const ve=sa(ne,H,A);if(et(s),Vt(s,ve),z.current.size>20){const se=z.current.keys().next().value;z.current.delete(se)}z.current.set(m,ve),F(ve),Ze&&A.length>=3&&(ht.current=setTimeout(()=>{Ia(A,ne)},500))},200)},oa=s=>{Je(s);const{allowedTypes:u,contentTokens:m}=fa(L),{cleanedQuery:$}=fa(L);let H=q.filter(A=>u.has(A==null?void 0:A._type));s!=="all"&&(H=H.filter(A=>(A==null?void 0:A._type)===s)),L.trim()&&m.length>0&&(H=H.filter(A=>{const v=Ct(Object.entries(A).filter(([ce])=>!ce.startsWith("_")).map(([,ce])=>String(ce||"")).join(" ")),ne=A.phone?k(A.phone):"",ve=`${v} ${ne}`.trim(),se=ve.replace(/\s+/g,"");return m.every(ce=>{const Ee=String(ce||"").trim();return Ee?ve.includes(Ee)||se.includes(Ee.replace(/\s+/g,"")):!0})})),F(sa(H,m,$))},Nt=(s,u,m)=>{m&&m.item&&Pe(m.item,m.action||"copy"),window.KTM.clipboard.writeText(s).then(()=>{Me(u),_("\u0110\xE3 copy!","success"),setTimeout(()=>Me(null),1500)})},ba=async(s,u,m)=>{try{m&&m.item&&Pe(m.item,m.action||"copy_image"),await window.KTM.clipboard.writeImageFromUrl(s),Me(u+"-img"),_("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>Me(null),1500)}catch($){Nt(s,u+"-img",m)}},zt=s=>{let u=s.toLowerCase();const m=[],$=q.filter(v=>v._type==="product");if(u.includes("ty")||u.includes("xy lanh")){if(u.includes("gi\u1EEFa")||u.includes("giua")){const v=$.find(ne=>{var ve;return(ve=ne.name)==null?void 0:ve.toLowerCase().includes("xy lanh gi\u1EEFa")});v&&!m.find(ne=>ne.id===v.id)&&m.push(v)}if(u.includes("nghi\xEAng")||u.includes("nghieng")){const v=$.find(ne=>{var ve;return(ve=ne.name)==null?void 0:ve.toLowerCase().includes("xy lanh nghi\xEAng")});v&&!m.find(ne=>ne.id===v.id)&&m.push(v)}if(u.includes("\u1EE7i")||u.includes("ui")){const v=$.find(ne=>{var ve;return(ve=ne.name)==null?void 0:ve.toLowerCase().includes("xy lanh \u1EE7i")});v&&!m.find(ne=>ne.id===v.id)&&m.push(v)}}const H=u.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(H){const v=H[1],ne=H[2],ve=$.find(se=>{var Ee;const ce=((Ee=se.name)==null?void 0:Ee.toLowerCase())||"";return ce.includes("combo")&&ce.includes(`${v} tay`)&&(ce.includes(`${ne} xy`)||ce.includes(`${ne} xylanh`))});if(ve&&!m.find(se=>se.id===ve.id))m.push(ve);else{const se=$.find(ce=>{var Ye;const Ee=((Ye=ce.name)==null?void 0:Ye.toLowerCase())||"";return Ee.includes("combo")&&Ee.includes(`${v} tay`)});se&&!m.find(ce=>ce.id===se.id)&&m.push(se)}}if(u.includes("combo")&&!H){const v=u.match(/combo.*?(\d+)\s*tay/);if(v){const ne=v[1];$.filter(se=>{var Ee;const ce=((Ee=se.name)==null?void 0:Ee.toLowerCase())||"";return ce.includes("combo")&&ce.includes(`${ne} tay`)}).forEach(se=>{m.find(ce=>ce.id===se.id)||m.push(se)})}}const A=u.match(/van\s*(\d+)\s*tay/);if(A&&!u.includes("ty")&&!u.includes("combo")){const v=A[1],ne=$.find(ve=>{var ce;const se=((ce=ve.name)==null?void 0:ce.toLowerCase())||"";return se.includes(`van ${v} tay`)&&!se.includes("combo")});ne&&!m.find(ve=>ve.id===ne.id)&&m.push(ne)}return m.slice(0,4)},Bt=async s=>{if(!s.trim())return;const u={role:"user",content:s,attachments:[]};fe($=>[...$,u]),Mt(""),Kt(!0);const m=zt(s);setTimeout(()=>{var $;return($=$t.current)==null?void 0:$.scrollIntoView({behavior:"smooth"})},100);try{const H=q.filter(ce=>ce._type==="product").map(ce=>{let Ee=`- ${ce.name}`;return ce.code&&(Ee+=` (M\xE3: ${ce.code})`),ce.price&&(Ee+=` - Gi\xE1: ${ce.price.replace(/[đ\s]/g,"")}\u0111`),ce.category&&(Ee+=` [${ce.category}]`),ce.note&&(Ee+=` (${ce.note})`),Ee}).join(`
`),v=vt.slice(-6).map(ce=>`${ce.role==="user"?"Kh\xE1ch":"AI"}: ${ce.content}`).join(`
`),ne=v?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${v}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${H}`:H,se=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:ne,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";fe(ce=>[...ce,{role:"assistant",content:se,attachments:m}])}catch($){console.error("AI Error:",$);const H=s.toLowerCase(),A=q.filter(ne=>{const ve=Object.values(ne).join(" ").toLowerCase();return H.split(" ").some(se=>ve.includes(se))});let v="";A.length>0?(v=`T\xECm th\u1EA5y ${A.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,A.slice(0,5).forEach(ne=>{v+=`\u2022 ${ne.name}`,ne.price&&(v+=` - ${ne.price.replace(/[đ\s]/g,"")}\u0111`),ne.note&&(v+=` (${ne.note})`),v+=`
`}),A.length>5&&(v+=`
...v\xE0 ${A.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):v='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',fe(ne=>[...ne,{role:"assistant",content:v,attachments:A.slice(0,4)}])}Kt(!1),setTimeout(()=>{var $,H;($=$t.current)==null||$.scrollIntoView({behavior:"smooth"}),(H=aa.current)==null||H.focus()},100)};function Ea({show:s,product:u,categories:m,onClose:$,onSave:H}){const[A,v]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[ne,ve]=useState(!1),[se,ce]=useState(!1),Ee=useRef(null),Ye=O=>window.KTM.money.formatVNDInputDigits(O),f=O=>{const B=window.KTM.money.getDigits(String(O!=null?O:"")),G=Number(B);return B&&Number.isFinite(G)?Math.trunc(G):0},r=(O,B)=>{if(O==null||O==="")return[];let G=O;if(typeof G=="string"){const re=G.trim();if(!re)return[];try{G=JSON.parse(re)}catch(x){return[]}}if(!Array.isArray(G))return[];const ue=f(B);return G.map(re=>{var R;if(!re||typeof re!="object")return null;const x=String((R=re.name)!=null?R:"").trim(),Q=(Array.isArray(re.options)?re.options:[]).map(he=>{var bt,ta,ia,Xt,wt,Pt,la;if(!he||typeof he!="object")return null;const De=String((bt=he.label)!=null?bt:"").trim();if(!De)return null;const Ie=(wt=(Xt=(ia=(ta=he.price)!=null?ta:he.priceValue)!=null?ia:he.unit_price)!=null?Xt:he.unitPrice)!=null?wt:null,Ve=Number(Ie);let at=Number.isFinite(Ve)?Math.trunc(Ve):null;if(at==null){const ca=(la=(Pt=he.price_delta)!=null?Pt:he.priceDelta)!=null?la:null,Fa=Number(ca);Number.isFinite(Fa)&&(at=ue+Math.trunc(Fa))}at==null&&(at=ue);const mt=String(Math.max(0,Math.trunc(Number(at)||0)));return{label:De,price:Math.max(0,Math.trunc(Number(at)||0)),priceDigits:mt}}).filter(Boolean);return{name:x||"Bi\u1EBFn th\u1EC3",options:Q}}).filter(Boolean)},b=O=>{if(O==null||O==="")return[];let B=O;if(typeof B=="string"){const G=B.trim();if(!G)return[];try{B=JSON.parse(G)}catch(ue){return[]}}return B&&typeof B=="object"&&!Array.isArray(B)&&(B=Object.entries(B).map(([G,ue])=>({key:G,value:ue}))),Array.isArray(B)?B.map(G=>{var Q,R,he,De,Ie;if(!G||typeof G!="object")return null;const ue=String((he=(R=(Q=G.key)!=null?Q:G.name)!=null?R:G.label)!=null?he:"").trim(),re=String((De=G.value)!=null?De:"").trim(),x=String((Ie=G.unit)!=null?Ie:"").trim();return ue?{key:ue,value:re,unit:x}:null}).filter(Boolean):[]};useEffect(()=>{var O,B;if(u)if(v({name:u.name||"",code:u.code||"",price:u.price||"",image:u.image||"",category:u.category||"",note:u.note||"",sort_order:u.sort_order||0,commission_percent:(B=(O=u.commission_percent)!=null?O:u.commissionPercent)!=null?B:5,variants:r(u.variants,u.price),attributes:b(u.attributes)}),u.price){const G=window.KTM.money.getDigits(u.price);Y(G),v(ue=>({...ue,price:Ye(G)}))}else Y("");else v({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Y("")},[u,s]);const K=O=>{v(B=>{var Q;const G=f(B.price),ue=String(G),re=Array.isArray(B.variants)?[...B.variants]:[],x={...re[O]||{},options:Array.isArray((Q=re[O])==null?void 0:Q.options)?[...re[O].options]:[]};return x.options=x.options.map(R=>({label:String((R==null?void 0:R.label)||""),price:G,priceDigits:ue})),re[O]=x,{...B,variants:re}})},ee=()=>{v(O=>{const B=f(O.price),G=String(B),re=(Array.isArray(O.variants)?[...O.variants]:[]).map(x=>{const Q=(Array.isArray(x==null?void 0:x.options)?x.options:[]).map(R=>({label:String((R==null?void 0:R.label)||""),price:B,priceDigits:G}));return{name:String((x==null?void 0:x.name)||"Bi\u1EBFn th\u1EC3"),options:Q}});return{...O,variants:re}})},[V,X]=React.useState(""),[T,Y]=React.useState(""),ge=O=>{const B=window.KTM.money.nextPriceInputState(O.target.value,T);Y(B.digits),v({...A,price:B.price})},_e=async(O,B=2)=>{const G=B*1024*1024;if(O.size<=G)return O;try{const ue=await createImageBitmap(O),re=document.createElement("canvas");let x=ue.width,Q=ue.height;const R=1200;return(x>R||Q>R)&&(x>Q?(Q=Math.round(Q/x*R),x=R):(x=Math.round(x/Q*R),Q=R)),re.width=x,re.height=Q,re.getContext("2d").drawImage(ue,0,0,x,Q),ue.close(),new Promise((De,Ie)=>{re.toBlob(Ve=>{Ve?De(new File([Ve],O.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ie(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ue){throw console.error("Compress error:",ue),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},nt=async O=>{var ue;const B=O.target.files[0];if(!B)return;if(!(B.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(B.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ce(!0);try{const re=await _e(B),x=await window.KTM.cloudinary.uploadImage({file:re,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!x.secure_url)throw console.error("Cloudinary error:",x),new Error(((ue=x.error)==null?void 0:ue.message)||"Upload failed");v(Q=>({...Q,image:x.secure_url}))}catch(re){console.error("Upload error:",re),alert("L\u1ED7i upload \u1EA3nh: "+re.message)}ce(!1),O.target.value=""},dt=async O=>{O.preventDefault(),ve(!0);const B={...A,variants:r(A.variants,A.price),attributes:b(A.attributes)};await H(B),ve(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),u?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:dt},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:A.name,onChange:O=>v({...A,name:O.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:A.code,onChange:O=>v({...A,code:O.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:A.price,onChange:ge,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:A.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:O=>v({...A,commission_percent:O.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:A.category,onChange:O=>v({...A,category:O.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),m.map(O=>React.createElement("option",{key:O,value:O},O)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:A.note,onChange:O=>v({...A,note:O.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(A.attributes)?A.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(A.attributes)?A.attributes:[]).map((O,B)=>React.createElement("div",{key:B,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.key)||"",onChange:G=>{const ue=G.target.value;v(re=>{const x=Array.isArray(re.attributes)?[...re.attributes]:[];return x[B]={...x[B]||{},key:ue},{...re,attributes:x}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.value)||"",onChange:G=>{const ue=G.target.value;v(re=>{const x=Array.isArray(re.attributes)?[...re.attributes]:[];return x[B]={...x[B]||{},value:ue},{...re,attributes:x}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.unit)||"",onChange:G=>{const ue=G.target.value;v(re=>{const x=Array.isArray(re.attributes)?[...re.attributes]:[];return x[B]={...x[B]||{},unit:ue},{...re,attributes:x}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{v(G=>{const ue=Array.isArray(G.attributes)?[...G.attributes]:[];return ue.splice(B,1),{...G,attributes:ue}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{v(O=>{const B=Array.isArray(O.attributes)?[...O.attributes]:[];return B.push({key:"",value:"",unit:""}),{...O,attributes:B}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(A.variants)?A.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(A.variants)?A.variants:[]).map((O,B)=>React.createElement("div",{key:B,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(O==null?void 0:O.name)||"",onChange:G=>{const ue=G.target.value;v(re=>{var Q;const x=Array.isArray(re.variants)?[...re.variants]:[];return x[B]={...x[B]||{},name:ue,options:Array.isArray((Q=x[B])==null?void 0:Q.options)?x[B].options:[]},{...re,variants:x}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>K(B),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(O==null?void 0:O.options)||O.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{v(G=>{const ue=Array.isArray(G.variants)?[...G.variants]:[];return ue.splice(B,1),{...G,variants:ue}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(O==null?void 0:O.options)?O.options:[]).map((G,ue)=>{var re,x;return React.createElement("div",{key:ue,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(G==null?void 0:G.label)||"",onChange:Q=>{const R=Q.target.value;v(he=>{var mt,bt,ta,ia,Xt;const De=Array.isArray(he.variants)?[...he.variants]:[],Ie={...De[B]||{},options:Array.isArray((mt=De[B])==null?void 0:mt.options)?[...De[B].options]:[]},Ve=Number((ta=(bt=Ie.options[ue])==null?void 0:bt.price)!=null?ta:0)||0,at=String((Xt=(ia=Ie.options[ue])==null?void 0:ia.priceDigits)!=null?Xt:Math.max(0,Math.trunc(Ve)));return Ie.options[ue]={...Ie.options[ue]||{},label:R,price:Math.max(0,Math.trunc(Ve)),priceDigits:at},De[B]=Ie,{...he,variants:De}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Ye(String((x=G==null?void 0:G.priceDigits)!=null?x:window.KTM.money.getDigits(String((re=G==null?void 0:G.price)!=null?re:"")))),onChange:Q=>{v(R=>{var ta,ia,Xt,wt,Pt;const he=String((ia=G==null?void 0:G.priceDigits)!=null?ia:window.KTM.money.getDigits(String((ta=G==null?void 0:G.price)!=null?ta:""))),De=window.KTM.money.nextPriceInputState(Q.target.value,he),Ie=String((Xt=De.digits)!=null?Xt:""),Ve=Number(Ie),at=Number.isFinite(Ve)?Math.max(0,Math.trunc(Ve)):0,mt=Array.isArray(R.variants)?[...R.variants]:[],bt={...mt[B]||{},options:Array.isArray((wt=mt[B])==null?void 0:wt.options)?[...mt[B].options]:[]};return bt.options[ue]={...bt.options[ue]||{},label:String(((Pt=bt.options[ue])==null?void 0:Pt.label)||""),price:at,priceDigits:Ie},mt[B]=bt,{...R,variants:mt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{v(Q=>{var De;const R=Array.isArray(Q.variants)?[...Q.variants]:[],he={...R[B]||{},options:Array.isArray((De=R[B])==null?void 0:De.options)?[...R[B].options]:[]};return he.options.splice(ue,1),R[B]=he,{...Q,variants:R}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{v(G=>{var Q;const ue=Array.isArray(G.variants)?[...G.variants]:[],re={...ue[B]||{},options:Array.isArray((Q=ue[B])==null?void 0:Q.options)?[...ue[B].options]:[]},x=f(G.price);return re.options.push({label:"",price:x,priceDigits:String(x)}),ue[B]=re,{...G,variants:ue}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{v(O=>{const B=f(O.price),G=Array.isArray(O.variants)?[...O.variants]:[],ue=String(B);return G.push({name:"Size",options:[{label:"S",price:B,priceDigits:ue},{label:"M",price:B,priceDigits:ue},{label:"L",price:B,priceDigits:ue}]}),{...O,variants:G}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ee,disabled:!Array.isArray(A.variants)||A.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},A.image?React.createElement(React.Fragment,null,React.createElement("img",{src:A.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>v({...A,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var O;return(O=Ee.current)==null?void 0:O.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:Ee,type:"file",accept:"image/*",className:"d-none",onChange:nt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var O;return(O=Ee.current)==null?void 0:O.click()},disabled:se,style:{borderRadius:"10px"}},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:A.image,onChange:O=>v({...A,image:O.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:$,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:ne,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ne?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Ga=s=>window.KTM.money.formatVND(s),Oa=s=>{if(s==null||s==="")return[];let u=s;if(typeof u=="string"){const m=u.trim();if(!m)return[];try{u=JSON.parse(m)}catch($){return[]}}return Array.isArray(u)?u:[]},_a=s=>{if(s==null||s==="")return[];let u=s;if(typeof u=="string"){const m=u.trim();if(!m)return[];try{u=JSON.parse(m)}catch($){return[]}}return u&&typeof u=="object"&&!Array.isArray(u)&&(u=Object.entries(u).map(([m,$])=>({key:m,value:$}))),Array.isArray(u)?u:[]},Wa=(s,u={})=>{var A;const m=_a(s).map(v=>{var ne,ve,se,ce,Ee;return{key:String((se=(ve=(ne=v==null?void 0:v.key)!=null?ne:v==null?void 0:v.name)!=null?ve:v==null?void 0:v.label)!=null?se:"").trim(),value:String((ce=v==null?void 0:v.value)!=null?ce:"").trim(),unit:String((Ee=v==null?void 0:v.unit)!=null?Ee:"").trim()}}).filter(v=>!!v.key);if(!m.length)return null;const $=!!u.compact,H=String((A=u.className)!=null?A:"").trim();return React.createElement("div",{className:`ktm-variants-preview${$?" compact":""}${H?" "+H:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},m.map((v,ne)=>{const ve=v.key,se=`${v.value||""}${v.unit?(v.value?" ":"")+v.unit:""}`.trim();return React.createElement("div",{key:`${ve}-${ne}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ve),se?React.createElement("span",{className:"ktm-chip ktm-chip-option"},se):null)})))},Ka=(s,u={})=>{var ve;const m=Oa(s).map(se=>{var ce;return{name:String((ce=se==null?void 0:se.name)!=null?ce:"").trim(),options:Array.isArray(se==null?void 0:se.options)?se.options:[]}}).map(se=>({...se,options:se.options.map(ce=>{var Ee;return{label:String((Ee=ce==null?void 0:ce.label)!=null?Ee:"").trim(),price:Number(ce==null?void 0:ce.price)}}).filter(ce=>!!ce.label)})).filter(se=>se.options.length>0);if(!m.length)return null;const $=Number.isFinite(u.maxGroups)?Math.max(1,Math.trunc(u.maxGroups)):m.length,H=Number.isFinite(u.maxOptionsPerGroup)?Math.max(1,Math.trunc(u.maxOptionsPerGroup)):3,A=!!u.compact,v=String((ve=u.className)!=null?ve:"").trim(),ne=m.slice(0,$);return React.createElement("div",{className:`ktm-variants-preview${A?" compact":""}${v?" "+v:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},ne.map((se,ce)=>{const Ee=se.name||"Bi\u1EBFn th\u1EC3",Ye=se.options.slice(0,H),f=se.options.length-Ye.length;return React.createElement("div",{key:`${Ee}-${ce}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Ee),Ye.map((r,b)=>{const K=r.price,ee=Number.isFinite(K)&&K>=0?Ga(Math.trunc(K)):"",V=ee?`${r.label} \xB7 ${ee}`:r.label;return React.createElement("span",{key:`${Ee}-${ce}-${b}`,className:"ktm-chip ktm-chip-option"},V)}),f>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",f))})))},ga=(s,u)=>{const m=s._type==="product",$=s._type==="album",H=s._type==="video",A=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),v=m?Wa(s.attributes,{compact:Ge==="grid",className:Ge==="grid"?"meta text-muted":"text-muted"}):null,ne=m?Ka(s.variants,{compact:Ge==="grid",maxOptionsPerGroup:999,className:Ge==="grid"?"meta text-muted":"text-muted"}):null;return Ge==="grid"?React.createElement("div",{key:s.id||u,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>{Pe(s,"preview"),Ft({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${H?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${m?"product":$?"album":"video"}`},m?"SP":$?"\u1EA2nh":"Video"),A&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),v&&React.createElement("div",{style:{marginTop:2}},v),ne&&React.createElement("div",{style:{marginTop:2}},ne),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:Ae===s.id+"-img"?"copied":"",onClick:()=>ba(s.image,s.id,{item:s,action:"copy_image"})},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:Ae===s.id+"-price"?"copied":"",onClick:()=>Nt(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||u,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${m?"product":$?"album":"video"}`},m?"S\u1EA3n ph\u1EA9m":$?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>{Pe(s,"preview"),Ft({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${H?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),A&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),v&&React.createElement("div",{style:{marginTop:4}},v),ne&&React.createElement("div",{style:{marginTop:4}},ne)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),H&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},m&&React.createElement("button",{onClick:()=>{Pe(s,"create_order"),M&&M("orders","create",{productId:s.id})}},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:Ae===s.id+"-price"?"copied":"",onClick:()=>Nt(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:Ae===s.id+"-name"?"copied":"",onClick:()=>Nt(s.name,s.id+"-name",{item:s,action:"copy_name"})},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),H&&s.youtubeId&&React.createElement("button",{className:Ae===s.id+"-yt"?"copied":"",onClick:()=>Nt(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),m&&React.createElement("button",{className:"action-edit",onClick:()=>Pa(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Ue(s)},React.createElement("i",{className:"fas fa-trash"}))))},[Sa,va]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"search-suggestions mobile-only"},React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"G\u1EE3i \xFD nhanh"),React.createElement("div",{className:"search-suggestions-row"},[{label:"van 2 tay",query:"van 2 tay"},{label:"combo r\u1EBB",query:"combo r\u1EBB"},{label:"xylanh",query:"xylanh"},{label:"sdt:\u2026",query:"sdt:",caret:"end",addToHistory:!1},{label:"#m\xE3\u2026",query:"#",caret:"end",addToHistory:!1}].map(s=>React.createElement("button",{key:s.label,type:"button",className:"suggestion-chip",onClick:()=>Wt(s.query,{caret:s.caret,addToHistory:s.addToHistory,focus:!1})},s.label)))),Dt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"S\u1EA3n ph\u1EA9m hay t\xECm"),React.createElement("div",{className:"search-suggestions-row"},Dt.map(s=>{var H,A;const u=(((H=s.item)==null?void 0:H.name)||s.name||"").trim();if(!u)return null;const m=String(((A=s.item)==null?void 0:A.code)||s.code||"").trim(),$=m?`#${m}`:u;return React.createElement("button",{key:s.id,type:"button",className:"suggestion-chip suggestion-chip-popular",onClick:()=>{s.item&&Pe(s.item,"suggestion"),Wt($,{caret:"end",focus:!1})},title:m?`#${m}`:u},u)}))),kt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"T\xECm g\u1EA7n \u0111\xE2y / hay d\xF9ng"),React.createElement("div",{className:"search-suggestions-row"},kt.map(s=>React.createElement("button",{key:s.q,type:"button",className:"suggestion-chip suggestion-chip-query",onClick:()=>Wt(s.q,{caret:"end",focus:!1}),title:`${s.q} (${s.count})`},s.q))))),React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,W.length)," k\u1EBFt qu\u1EA3",Ze&&L.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Oe!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Oe==="product"?"S\u1EA3n ph\u1EA9m":Oe==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Ge==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Te("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Ge==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Te("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},P?React.createElement("div",null,[...Array(8)].map((s,u)=>React.createElement("div",{key:u,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):W.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',L,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{oe(""),ea("")}},"Xem t\u1EA5t c\u1EA3")):Ge==="grid"?React.createElement("div",{className:"product-grid-mobile"},W.map((s,u)=>ga(s,u))):React.createElement("div",null,W.map((s,u)=>ga(s,u)))),Sa&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>va(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Oe==="all"?"active":""}`,onClick:()=>{oa("all"),va(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Oe==="product"?"active":""}`,onClick:()=>{oa("product"),va(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Oe==="album"?"active":""}`,onClick:()=>{oa("album"),va(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Oe==="video"?"active":""}`,onClick:()=>{oa("video"),va(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Ze,onChange:s=>xt(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:ye,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:L,onChange:s=>ea(s.target.value)}),React.createElement("button",{className:`filter-btn ${Sa||Oe!=="all"?"active":""}`,onClick:()=>va(!Sa)},React.createElement("i",{className:"fas fa-filter"})))),N&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>D(!1)},React.createElement("div",{className:"search-palette",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:j,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:Ne,onChange:s=>ea(s.target.value),onKeyDown:s=>{s.key==="Enter"&&W.length>0?(We(Ne),D(!1)):s.key==="Escape"&&D(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>D(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((s,u)=>React.createElement("span",{key:s,className:`filter-chip ${Oe===["all","product","album","video"][u]?"active":""}`,onClick:()=>{oa(["all","product","album","video"][u])}},s)))),Z.length>0&&!Ne.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},Z.map((s,u)=>React.createElement("div",{key:u,className:"palette-item",onClick:()=>{ea(s),We(s)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,s),React.createElement("button",{className:"unsave-btn",onClick:m=>{m.stopPropagation(),yt(s)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),le.length>0&&!Ne.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},le.map((s,u)=>React.createElement("div",{key:u,className:"palette-item",onClick:()=>{ea(s)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,s),React.createElement("button",{className:"save-btn",onClick:m=>{m.stopPropagation(),yt(s)}},React.createElement("i",{className:`fas fa-star${Z.includes(s)?"":"-o"}`})))))),Ne.trim()&&W.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",W.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},W.slice(0,8).map((s,u)=>React.createElement("div",{key:s.id||u,className:"palette-result-item",onClick:()=>{We(Ne),D(!1)}},s.image&&React.createElement("img",{src:s.image,alt:s.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},s.name),s.price&&React.createElement("div",{className:"result-meta"},s.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:m=>{m.stopPropagation(),yt(Ne)}},React.createElement("i",{className:`fas fa-star${Z.includes(Ne)?"":"-o"}`})))))),Ne.trim()&&W.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',Ne,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:wa?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>rt(!0),onTouchStart:()=>rt(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Re&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>rt(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},vt.map((s,u)=>React.createElement("div",{key:u,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:Ae===`chat-${u}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:Ae===`chat-${u}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),Me(`chat-${u}`),setTimeout(()=>Me(null),1500)}},React.createElement("i",{className:`fas ${Ae===`chat-${u}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((m,$)=>React.createElement("div",{key:$,style:{width:70},className:"text-center"},m.image&&React.createElement("img",{src:m.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>Ft({url:m.image,name:m.name,price:m.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},m.name),m.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},m.price.replace(/[đ\s]/g,""),"\u0111"))))))),ot&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:$t})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Bt(s),disabled:ot,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),Bt(ze)},className:"chat-input-wrap"},React.createElement("input",{ref:aa,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:ze,onChange:s=>Mt(s.target.value),disabled:ot}),React.createElement("button",{type:"submit",className:"send-btn",disabled:ot||!ze.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),Ht&&React.createElement("div",{className:"preview-modal",onClick:()=>Ft(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>Ft(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:Ht.url,alt:Ht.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},Ht.name),Ht.price&&React.createElement("div",{className:"price"},Ht.price.replace(/[đ\s]/g,""),"\u0111"),Ht.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},Ht.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:Ae==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:Ae==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>ba(Ht.url,"preview")},React.createElement("i",{className:`fas ${Ae==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),Ht.price&&React.createElement("button",{className:Ae==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Nt(Ht.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${Ae==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Ea,{show:$a,product:Qt,categories:Ce,onClose:()=>{pa(!1),xa(null)},onSave:Ot}),React.createElement("div",{className:`fab-container mobile-only ${wa?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{lt(!1),pa(!0),xa(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{lt(!1),M&&M("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${wa?"open":""}`,onClick:()=>lt(!wa)},React.createElement("i",{className:"fas fa-plus"}))),Ta&&Yt&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>ua(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Lt.name,onChange:s=>qe({...Lt,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Lt.code,onChange:s=>qe({...Lt,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Lt.price,onChange:s=>qe({...Lt,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Lt.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>qe({...Lt,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Lt.category,onChange:s=>qe({...Lt,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Ra.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Lt.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>qe({...Lt,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>ua(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:Et},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:_,showToast:M}){const[L,oe]=useState([]),[W,F]=useState([]),[q,Se]=useState(!0),[Ce,pe]=useState(null),[Oe,Je]=useState(!1),[Ae,Me]=useState(null),[Ge,Te]=useState(!1),[P,Qe]=useState(null),[pt,it]=useState(!1),[$e,He]=useState(null),[ye,Ze]=useState(!1),[xt,jt]=useState(!1),[Ke,ht]=useState(null),[Tt,w]=useState(!1),[N,D]=useState(null),[le,de]=useState([]);useEffect(()=>{Z()},[]);const Z=async(k=null)=>{Se(!0);try{const U=k?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${k}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,We=await window.KTM.api.getJSON(U,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");oe(Array.isArray(We)?We:[])}catch(U){console.error(U),M("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}Se(!1)},ie=async k=>{try{const U=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${k}`,"L\u1ED7i t\u1EA3i video");F(Array.isArray(U)?U:[])}catch(U){console.error(U)}},Ne=async k=>{if(k===0)return;const U=[...L];[U[k-1],U[k]]=[U[k],U[k-1]],oe(U),await j(U)},y=async k=>{if(k===L.length-1)return;const U=[...L];[U[k],U[k+1]]=[U[k+1],U[k]],oe(U),await j(U)},j=async k=>{try{await Promise.all(k.map((U,We)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${U.id}`,{sortOrder:We},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),M("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(U){M("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),Z(N==null?void 0:N.id)}},z=async k=>{if(k===0)return;const U=[...W];[U[k-1],U[k]]=[U[k],U[k-1]],F(U),await xe(U)},me=async k=>{if(k===W.length-1)return;const U=[...W];[U[k],U[k+1]]=[U[k+1],U[k]],F(U),await xe(U)},xe=async k=>{try{await Promise.all(k.map((U,We)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${U.id}`,{sort_order:We},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),M("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(U){M("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ie(Ce.id)}},be=()=>{Me(null),Je(!0)},Le=k=>{ht(k),jt(!0),w(!0)},Re=async(k,U="modal")=>{try{!Ae&&N&&(k.parent_id=N.id);const We=Ae?`${API_BASE}/api/video-folders/${Ae.id}`:`${API_BASE}/api/video-folders`;Ae?await window.KTM.api.putJSON(We,k,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(We,k,"L\u1ED7i l\u01B0u folder"),M(Ae?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),U==="drawer"?(w(!1),Me(null),Z(N==null?void 0:N.id),Ae&&Ke&&ht({...Ke,...k})):(Je(!1),Me(null),Z(N==null?void 0:N.id))}catch(We){M(We.message,"danger")}},rt=async k=>{const U=k.subfolderCount>0?`X\xF3a folder "${k.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${k.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(U))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${k.id}`,"L\u1ED7i x\xF3a folder"),M("\u0110\xE3 x\xF3a folder","success"),pe(null),Z(N==null?void 0:N.id)}catch(We){M("L\u1ED7i x\xF3a folder","danger")}},vt=k=>{k.subfolderCount>0?(de(U=>[...U,k]),D(k),Z(k.id)):(pe(k),F(k.videos||[]))},fe=k=>{if(k==="root")de([]),D(null),Z(null);else if(k){const U=le.findIndex(We=>We.id===k.id);U>=0&&(de(le.slice(0,U+1)),D(k),Z(k.id))}else{const U=[...le];U.pop();const We=U[U.length-1]||null;de(U),D(We),Z(We==null?void 0:We.id)}},ze=()=>{jt(!1),w(!1),ht(null)},Mt=()=>{it(!1),Ze(!1),He(null)},ot=()=>{Qe(null),Te(!0)},Kt=k=>{He(k),it(!0),Ze(!0)},$t=async(k,U="modal")=>{try{k.folder_id=Ce==null?void 0:Ce.id;const We=P?`${API_BASE}/api/videos/${P.id}`:`${API_BASE}/api/videos`;P?await window.KTM.api.putJSON(We,k,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(We,k,"L\u1ED7i l\u01B0u video"),M(P?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),U==="drawer"?(Ze(!1),Qe(null),Z(),Ce&&ie(Ce.id),P&&$e&&He({...$e,...k})):(Te(!1),Qe(null),Z(),Ce&&ie(Ce.id))}catch(We){M(We.message,"danger")}},aa=async k=>{if(confirm(`X\xF3a video "${k.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${k.id}`,"L\u1ED7i x\xF3a video"),M("\u0110\xE3 x\xF3a video","success"),Z(),Ce&&ie(Ce.id)}catch(U){M("L\u1ED7i x\xF3a video","danger")}},Jt=k=>{const U=`https://www.youtube.com/watch?v=${k.youtubeId}`;window.KTM.clipboard.writeText(U).then(()=>{M("\u0110\xE3 copy link!","success")}).catch(()=>{M("Kh\xF4ng th\u1EC3 copy link","danger")})};return Ce?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>pe(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${Ce.slug==="shorts"?"text-danger":"text-warning"}`}),Ce.name)),React.createElement("button",{className:"btn btn-warning",onClick:ot},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),W.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},W.map((k,U)=>React.createElement("div",{key:k.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>z(U),disabled:U===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},U+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>me(U),disabled:U===W.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:k.thumb,className:"card-img-top",alt:k.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${k.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:k.title},k.title),React.createElement("small",{className:"text-muted"},k.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Jt(k),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Kt(k),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>aa(k),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Ge,video:P,onClose:()=>Te(!1),onSave:$t}),React.createElement(AdminDrawer,{open:xt,title:Ke?Ke.name:"Folder",subtitle:Ke?`${Ke.subfolderCount||0} subfolder \u2022 ${Ke.videoCount||0} videos`:"",onClose:ze,footer:Tt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:ze},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Ke&&Re({name:Ke.name||"",description:Ke.description||"",sortOrder:Ke.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Ke?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Ke.name),M("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{w(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Ke.name}"?`)&&(rt(Ke),ze())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Tt&&Ke?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Ke.name||"",onChange:k=>ht({...Ke,name:k.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Ke.description||"",onChange:k=>ht({...Ke,description:k.target.value})}))):Ke?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Ke.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Ke.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Ke.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Ke.videoCount||0))),Ke.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Ke.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:pt,title:$e?$e.title:"Video",subtitle:$e?`${$e.youtubeId}`:"",onClose:Mt,footer:ye?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:Mt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{$e&&$t({youtube_url:`https://www.youtube.com/watch?v=${$e.youtubeId}`,title:$e.title||"",thumbnail_url:$e.thumb||"",sort_order:$e.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):$e?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const k=`https://www.youtube.com/watch?v=${$e.youtubeId}`;window.KTM.clipboard.writeText(k).then(()=>{M("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Ze(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${$e.title}"?`)&&(aa($e),Mt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ye&&$e?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:$e.title||"",onChange:k=>He({...$e,title:k.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:$e.youtubeId||"",onChange:k=>He({...$e,youtubeId:k.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:$e.sortOrder||0,onChange:k=>He({...$e,sortOrder:parseInt(k.target.value)||0})}))):$e?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},$e.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},$e.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},$e.sortOrder||0))),$e.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:$e.thumb,alt:$e.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},N&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>fe()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),N?N.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:be},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),le.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:k=>{k.preventDefault(),fe("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),le.map((k,U)=>React.createElement("li",{key:k.id,className:`breadcrumb-item ${U===le.length-1?"active":""}`},U===le.length-1?k.name:React.createElement("a",{href:"#",onClick:We=>{We.preventDefault(),fe(k)},className:"text-warning"},k.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),q?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):L.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},N?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:be},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",N?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},L.map((k,U)=>{var We,yt,Gt,St;return React.createElement("div",{key:k.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:It=>{It.stopPropagation(),Ne(U)},disabled:U===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},U+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:It=>{It.stopPropagation(),y(U)},disabled:U===L.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>vt(k),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${k.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},k.name),React.createElement("p",{className:"text-muted mb-0"},k.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),k.subfolderCount," folder"),k.subfolderCount>0&&(k.videoCount>0||((We=k.videos)==null?void 0:We.length)>0)&&" \u2022 ",(k.videoCount>0||((yt=k.videos)==null?void 0:yt.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),k.videoCount||((Gt=k.videos)==null?void 0:Gt.length)||0," videos"),k.subfolderCount===0&&!k.videoCount&&!((St=k.videos)!=null&&St.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:It=>{It.stopPropagation(),Le(k)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:It=>{It.stopPropagation(),rt(k)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Oe,folder:Ae,onClose:()=>Je(!1),onSave:Re}))}function VideoFolderModal({show:_,folder:M,onClose:L,onSave:oe}){const[W,F]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[q,Se]=useState(!1),[Ce,pe]=useState(!1);useEffect(()=>{F(M?{name:M.name||"",description:M.description||"",sortOrder:M.sortOrder||0,coverImage:M.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[M,_]);const Oe=async Ae=>{const Me=Ae.target.files[0];if(Me){pe(!0);try{const Ge=await window.KTM.cloudinary.uploadImage({file:Me,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Ge.secure_url&&F(Te=>({...Te,coverImage:Ge.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Ge){console.error("Cloudinary upload error:",Ge),alert("L\u1ED7i upload \u1EA3nh: "+(Ge.message||Ge))}finally{pe(!1)}}},Je=async Ae=>{Ae.preventDefault(),Se(!0);const Me={...W,variants:normalizeVariants(W.variants,W.price),attributes:normalizeAttributes(W.attributes)};await oe(Me),Se(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},M?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:Je},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:W.name,onChange:Ae=>F({...W,name:Ae.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:W.description,onChange:Ae=>F({...W,description:Ae.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:W.sortOrder,onChange:Ae=>F({...W,sortOrder:parseInt(Ae.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},W.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:W.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>F({...W,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Oe,disabled:Ce}),Ce&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:W.coverImage,onChange:Ae=>F({...W,coverImage:Ae.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:q},q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:_,settings:M}){const[L,oe]=useState([]),[W,F]=useState(!0),[q,Se]=useState(!1),[Ce,pe]=useState(null),[Oe,Je]=useState(""),[Ae,Me]=useState(""),[Ge,Te]=useState(!1),[P,Qe]=useState(null),pt=normalizeShipPercent(M==null?void 0:M.ship_percent),{parseMoney:it,formatVND:$e}=window.KTM.money,He=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{ye()},[]);const ye=async()=>{F(!0);try{const y=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");oe(Array.isArray(y)?y:[])}catch(y){console.error(y),_("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}F(!1)},Ze=()=>{pe(null),Se(!0)},xt=y=>{pe(y),Se(!0)},jt=y=>{y&&(Qe(y),Te(!0))},Ke=()=>{Te(!1)},ht=async y=>{if(!(!y||!y.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:y},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),_(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),ye()}catch(j){_("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},Tt=async y=>{try{const j=Ce?`${API_BASE}/api/products?id=${Ce.id}`:`${API_BASE}/api/products`;Ce?await window.KTM.api.putJSON(j,y,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(j,y,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),_(Ce?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Se(!1),ye()}catch(j){_(j.message,"danger")}},w=async y=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${y.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${y.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),_("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ye()}catch(j){_(j.message,"danger")}},N=L.filter(y=>{const j=!Oe||y.name.toLowerCase().includes(Oe.toLowerCase())||y.code&&y.code.toLowerCase().includes(Oe.toLowerCase()),z=!Ae||y.category===Ae;return j&&z}),D=y=>{var me;const j=(me=y==null?void 0:y.commission_percent)!=null?me:y==null?void 0:y.commissionPercent,z=j===""||j==null?NaN:Number(j);return Number.isFinite(z)?Math.max(0,Math.min(100,z)):5},le=y=>{const j=D(y),z=Number.isInteger(j)?String(j):String(Math.round(j*100)/100),me=it(y==null?void 0:y.price);if(!Number.isFinite(me)||me<=0)return`${z}%`;const xe=(Number(j)||0)/100,Le=window.KTM.money.parseShipFeeFromNote(y==null?void 0:y.note)!=null?0:pt>0?me*pt/100:0,Re=me*xe-Le*xe,rt=Math.max(0,Math.round(Re));return`${z}% - ${$e(rt)}`},de=y=>{if(y==null||y==="")return[];let j=y;if(typeof j=="string"){const z=j.trim();if(!z)return[];try{j=JSON.parse(z)}catch(me){return[]}}return Array.isArray(j)?j:[]},Z=y=>{if(y==null||y==="")return[];let j=y;if(typeof j=="string"){const z=j.trim();if(!z)return[];try{j=JSON.parse(z)}catch(me){return[]}}return j&&typeof j=="object"&&!Array.isArray(j)&&(j=Object.entries(j).map(([z,me])=>({key:z,value:me}))),Array.isArray(j)?j:[]},ie=y=>{const j=Z(y).map(z=>{var me,xe,be,Le,Re;return{key:String((be=(xe=(me=z==null?void 0:z.key)!=null?me:z==null?void 0:z.name)!=null?xe:z==null?void 0:z.label)!=null?be:"").trim(),value:String((Le=z==null?void 0:z.value)!=null?Le:"").trim(),unit:String((Re=z==null?void 0:z.unit)!=null?Re:"").trim()}}).filter(z=>!!z.key);return j.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},j.map((z,me)=>{const xe=z.key,be=`${z.value||""}${z.unit?(z.value?" ":"")+z.unit:""}`.trim();return React.createElement("div",{key:`${xe}-${me}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},xe),be?React.createElement("span",{className:"ktm-chip ktm-chip-option"},be):null)}))):null},Ne=(y,j={})=>{const z=de(y).map(Le=>{var Re;return{name:String((Re=Le==null?void 0:Le.name)!=null?Re:"").trim(),options:Array.isArray(Le==null?void 0:Le.options)?Le.options:[]}}).map(Le=>({...Le,options:Le.options.map(Re=>{var rt;return{label:String((rt=Re==null?void 0:Re.label)!=null?rt:"").trim(),price:Number(Re==null?void 0:Re.price)}}).filter(Re=>!!Re.label)})).filter(Le=>Le.options.length>0);if(!z.length)return null;const me=Number.isFinite(j.maxGroups)?Math.max(1,Math.trunc(j.maxGroups)):z.length,xe=Number.isFinite(j.maxOptionsPerGroup)?Math.max(1,Math.trunc(j.maxOptionsPerGroup)):4,be=z.slice(0,me);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},be.map((Le,Re)=>{const rt=Le.name||"Bi\u1EBFn th\u1EC3",vt=Le.options.slice(0,xe),fe=Le.options.length-vt.length;return React.createElement("div",{key:`${rt}-${Re}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},rt),vt.map((ze,Mt)=>{const ot=ze.price,Kt=Number.isFinite(ot)&&ot>=0?$e(Math.trunc(ot)):"",$t=Kt?`${ze.label} \xB7 ${Kt}`:ze.label;return React.createElement("span",{key:`${rt}-${Re}-${Mt}`,className:"ktm-chip ktm-chip-option"},$t)}),fe>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",fe))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Ze},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:Oe,onChange:y=>Je(y.target.value)})),React.createElement("span",{className:"product-count"},N.length)),React.createElement("select",{className:"form-select",value:Ae,onChange:y=>Me(y.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),He.map(y=>React.createElement("option",{key:y,value:y},y)))),W?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):N.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Ze},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},N.map(y=>React.createElement("div",{key:y.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>jt(y),onKeyDown:j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),jt(y))},title:"Xem chi ti\u1EBFt"},y.image?React.createElement("img",{src:y.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},y.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},y.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},y.category),y.code&&React.createElement("span",{className:"product-badge bg-secondary"},y.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),le(y))),React.createElement("div",{className:"product-price"},y.price?y.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),y.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},y.note),ie(y.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},ie(y.attributes)),Ne(y.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},Ne(y.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:j=>{j.stopPropagation(),xt(y)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:j=>{j.stopPropagation(),w(y)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:Ge,title:String((P==null?void 0:P.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((P==null?void 0:P.code)||"").trim()||null,String((P==null?void 0:P.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Ke,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const y=String((P==null?void 0:P.code)||"").trim();y&&window.KTM.clipboard.writeText(y).then(()=>_("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((P==null?void 0:P.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const y=String((P==null?void 0:P.price)||"").trim();y&&window.KTM.clipboard.writeText(y).then(()=>_("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((P==null?void 0:P.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>P&&xt(P),disabled:!P},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>P&&w(P),disabled:!P},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},P?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const y=String((P==null?void 0:P.price)||"").trim(),j=it(y);return Number.isFinite(j)&&j>0?$e(Math.trunc(j)):y||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},le(P)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},P.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},P.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),P.image?React.createElement("img",{src:P.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(P.note||"").trim()||P.attributes||P.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(P.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(P.note||"").trim()),ie(P.attributes)?React.createElement("div",{className:"mt-2"},ie(P.attributes)):null,Ne(P.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},Ne(P.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:q,product:Ce,categories:He,onClose:()=>Se(!1),onSave:Tt}))}function ProductModal({show:_,product:M,categories:L,onClose:oe,onSave:W}){const[F,q]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Se,Ce]=useState(!1),[pe,Oe]=useState(!1),Je=w=>{const N=window.KTM.money.getDigits(String(w!=null?w:"")),D=Number(N);return N&&Number.isFinite(D)?Math.trunc(D):0},Ae=w=>{if(w==null||w==="")return[];let N=w;if(typeof N=="string"){const D=N.trim();if(!D)return[];try{N=JSON.parse(D)}catch(le){return[]}}return N&&typeof N=="object"&&!Array.isArray(N)&&(N=Object.entries(N).map(([D,le])=>({key:D,value:le}))),Array.isArray(N)?N.map(D=>{var ie,Ne,y,j,z;if(!D||typeof D!="object")return null;const le=String((y=(Ne=(ie=D.key)!=null?ie:D.name)!=null?Ne:D.label)!=null?y:"").trim(),de=String((j=D.value)!=null?j:"").trim(),Z=String((z=D.unit)!=null?z:"").trim();return le?{key:le,value:de,unit:Z}:null}).filter(Boolean):[]},Me=(w,N)=>{if(w==null||w==="")return[];let D=w;if(typeof D=="string"){const de=D.trim();if(!de)return[];try{D=JSON.parse(de)}catch(Z){return[]}}if(!Array.isArray(D))return[];const le=Je(N);return D.map(de=>{var Ne;if(!de||typeof de!="object")return null;const Z=String((Ne=de.name)!=null?Ne:"").trim(),ie=(Array.isArray(de.options)?de.options:[]).map(y=>{var Le,Re,rt,vt,fe,ze,Mt;if(!y||typeof y!="object")return null;const j=String((Le=y.label)!=null?Le:"").trim();if(!j)return null;const z=(fe=(vt=(rt=(Re=y.price)!=null?Re:y.priceValue)!=null?rt:y.unit_price)!=null?vt:y.unitPrice)!=null?fe:null,me=Number(z);let xe=Number.isFinite(me)?Math.trunc(me):null;if(xe==null){const ot=(Mt=(ze=y.price_delta)!=null?ze:y.priceDelta)!=null?Mt:null,Kt=Number(ot);Number.isFinite(Kt)&&(xe=le+Math.trunc(Kt))}xe==null&&(xe=le);const be=String(Math.max(0,Math.trunc(Number(xe)||0)));return{label:j,price:Math.max(0,Math.trunc(Number(xe)||0)),priceDigits:be}}).filter(Boolean);return{name:Z||"Bi\u1EBFn th\u1EC3",options:ie}}).filter(Boolean)};useEffect(()=>{var w,N;q(M?{name:M.name||"",code:M.code||"",price:M.price||"",image:M.image||"",category:M.category||"",note:M.note||"",sort_order:M.sort_order||0,commission_percent:(N=(w=M.commission_percent)!=null?w:M.commissionPercent)!=null?N:5,variants:Me(M.variants,M.price),attributes:Ae(M.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[M,_]);const Ge=w=>{q(N=>{var ie;const D=Je(N.price),le=String(D),de=Array.isArray(N.variants)?[...N.variants]:[],Z={...de[w]||{},options:Array.isArray((ie=de[w])==null?void 0:ie.options)?[...de[w].options]:[]};return Z.options=Z.options.map(Ne=>({label:String((Ne==null?void 0:Ne.label)||""),price:D,priceDigits:le})),de[w]=Z,{...N,variants:de}})},Te=()=>{q(w=>{const N=Je(w.price),D=String(N),de=(Array.isArray(w.variants)?[...w.variants]:[]).map(Z=>{const ie=(Array.isArray(Z==null?void 0:Z.options)?Z.options:[]).map(Ne=>({label:String((Ne==null?void 0:Ne.label)||""),price:N,priceDigits:D}));return{name:String((Z==null?void 0:Z.name)||"Bi\u1EBFn th\u1EC3"),options:ie}});return{...w,variants:de}})},[P,Qe]=React.useState(""),pt=w=>window.KTM.money.formatVNDInputDigits(w),[it,$e]=React.useState(""),He=w=>{const N=window.KTM.money.nextPriceInputState(w.target.value,it);$e(N.digits),q({...F,price:N.price})},[ye,Ze]=React.useState("");React.useEffect(()=>{M!=null&&M.image&&Ze(M.image)},[M]);const xt=async w=>{if(!(!w||!w.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:w},"L\u1ED7i x\xF3a \u1EA3nh")}catch(N){console.error("Delete cloudinary image error:",N)}},jt=async(w,N=2,D)=>{const le=N*1024*1024,de=w.type==="image/heic"||w.type==="image/heif"||/\.heic$/i.test(w.name);if(w.size<=le&&!de)return w;D==null||D("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const Z=await createImageBitmap(w);D==null||D("\u0110ang n\xE9n \u1EA3nh...");const ie=document.createElement("canvas");let Ne=Z.width,y=Z.height;const j=1200;return(Ne>j||y>j)&&(Ne>y?(y=Math.round(y/Ne*j),Ne=j):(Ne=Math.round(Ne/y*j),y=j)),ie.width=Ne,ie.height=y,ie.getContext("2d").drawImage(Z,0,0,Ne,y),Z.close(),new Promise((me,xe)=>{ie.toBlob(be=>{be?(D==null||D("Ho\xE0n t\u1EA5t!"),me(new File([be],w.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):xe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Z){throw console.error("createImageBitmap error:",Z),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ke=async w=>{var le,de;const N=(le=w.target.files)==null?void 0:le[0];if(!N)return;if(!(N.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(N.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Oe(!0),Qe("\u0110ang chu\u1EA9n b\u1ECB...");try{const Z=(N.size/1024/1024).toFixed(1);Qe(`File ${Z}MB - \u0110ang n\xE9n...`);const ie=await jt(N,2,j=>{Qe(j)}),Ne=(ie.size/1024/1024).toFixed(1);Qe(`\u0110\xE3 n\xE9n: ${Ne}MB - \u0110ang upload...`);const y=await window.KTM.cloudinary.uploadImage({file:ie,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});y.secure_url?(F.image&&F.image!==ye&&xt(F.image),q(j=>({...j,image:y.secure_url})),Qe("")):(console.error("Cloudinary error:",y),alert("Upload th\u1EA5t b\u1EA1i: "+(((de=y.error)==null?void 0:de.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Qe(""))}catch(Z){console.error("Upload error:",Z),alert("L\u1ED7i: "+Z.message),Qe("")}Oe(!1),w.target.value=""},ht=()=>{F.image&&(F.image!==ye&&xt(F.image),q(w=>({...w,image:""})))},Tt=async w=>{w.preventDefault(),Ce(!0),ye&&F.image&&ye!==F.image&&await xt(ye),ye&&!F.image&&await xt(ye),await W(F),Ce(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${M?"fa-edit":"fa-plus-circle"} me-2`}),M?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:oe})),React.createElement("form",{onSubmit:Tt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},F.image?React.createElement(React.Fragment,null,React.createElement("img",{src:F.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:ht,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${pe?"fa-spinner fa-spin":"fa-camera"} me-1`}),pe?P||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Ke,disabled:pe,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),pe&&P&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},P))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:F.name,onChange:w=>q({...F,name:w.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:F.code,onChange:w=>q({...F,code:w.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:F.price,onChange:He,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:F.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:w=>q({...F,commission_percent:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:F.category,onChange:w=>q({...F,category:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),L.map(w=>React.createElement("option",{key:w,value:w},w)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:F.note,onChange:w=>q({...F,note:w.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(F.attributes)?F.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(F.attributes)?F.attributes:[]).map((w,N)=>React.createElement("div",{key:N,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(w==null?void 0:w.key)||"",onChange:D=>{const le=D.target.value;q(de=>{const Z=Array.isArray(de.attributes)?[...de.attributes]:[];return Z[N]={...Z[N]||{},key:le},{...de,attributes:Z}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(w==null?void 0:w.value)||"",onChange:D=>{const le=D.target.value;q(de=>{const Z=Array.isArray(de.attributes)?[...de.attributes]:[];return Z[N]={...Z[N]||{},value:le},{...de,attributes:Z}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(w==null?void 0:w.unit)||"",onChange:D=>{const le=D.target.value;q(de=>{const Z=Array.isArray(de.attributes)?[...de.attributes]:[];return Z[N]={...Z[N]||{},unit:le},{...de,attributes:Z}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{q(D=>{const le=Array.isArray(D.attributes)?[...D.attributes]:[];return le.splice(N,1),{...D,attributes:le}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{q(w=>{const N=Array.isArray(w.attributes)?[...w.attributes]:[];return N.push({key:"",value:"",unit:""}),{...w,attributes:N}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(F.variants)?F.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(F.variants)?F.variants:[]).map((w,N)=>React.createElement("div",{key:N,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(w==null?void 0:w.name)||"",onChange:D=>{const le=D.target.value;q(de=>{var ie;const Z=Array.isArray(de.variants)?[...de.variants]:[];return Z[N]={...Z[N]||{},name:le,options:Array.isArray((ie=Z[N])==null?void 0:ie.options)?Z[N].options:[]},{...de,variants:Z}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Ge(N),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(w==null?void 0:w.options)||w.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{q(D=>{const le=Array.isArray(D.variants)?[...D.variants]:[];return le.splice(N,1),{...D,variants:le}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(w==null?void 0:w.options)?w.options:[]).map((D,le)=>{var de,Z;return React.createElement("div",{key:le,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.label)||"",onChange:ie=>{const Ne=ie.target.value;q(y=>{var be,Le,Re,rt,vt;const j=Array.isArray(y.variants)?[...y.variants]:[],z={...j[N]||{},options:Array.isArray((be=j[N])==null?void 0:be.options)?[...j[N].options]:[]},me=Number((Re=(Le=z.options[le])==null?void 0:Le.price)!=null?Re:0)||0,xe=String((vt=(rt=z.options[le])==null?void 0:rt.priceDigits)!=null?vt:Math.max(0,Math.trunc(me)));return z.options[le]={...z.options[le]||{},label:Ne,price:Math.max(0,Math.trunc(me)),priceDigits:xe},j[N]=z,{...y,variants:j}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:pt(String((Z=D==null?void 0:D.priceDigits)!=null?Z:window.KTM.money.getDigits(String((de=D==null?void 0:D.price)!=null?de:"")))),onChange:ie=>{q(Ne=>{var Re,rt,vt,fe,ze;const y=String((rt=D==null?void 0:D.priceDigits)!=null?rt:window.KTM.money.getDigits(String((Re=D==null?void 0:D.price)!=null?Re:""))),j=window.KTM.money.nextPriceInputState(ie.target.value,y),z=String((vt=j.digits)!=null?vt:""),me=Number(z),xe=Number.isFinite(me)?Math.max(0,Math.trunc(me)):0,be=Array.isArray(Ne.variants)?[...Ne.variants]:[],Le={...be[N]||{},options:Array.isArray((fe=be[N])==null?void 0:fe.options)?[...be[N].options]:[]};return Le.options[le]={...Le.options[le]||{},label:String(((ze=Le.options[le])==null?void 0:ze.label)||""),price:xe,priceDigits:z},be[N]=Le,{...Ne,variants:be}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{q(ie=>{var j;const Ne=Array.isArray(ie.variants)?[...ie.variants]:[],y={...Ne[N]||{},options:Array.isArray((j=Ne[N])==null?void 0:j.options)?[...Ne[N].options]:[]};return y.options.splice(le,1),Ne[N]=y,{...ie,variants:Ne}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{q(D=>{var ie;const le=Array.isArray(D.variants)?[...D.variants]:[],de={...le[N]||{},options:Array.isArray((ie=le[N])==null?void 0:ie.options)?[...le[N].options]:[]},Z=Je(D.price);return de.options.push({label:"",price:Z,priceDigits:String(Z)}),le[N]=de,{...D,variants:le}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{q(w=>{const N=Je(w.price),D=Array.isArray(w.variants)?[...w.variants]:[],le=String(N);return D.push({name:"Size",options:[{label:"S",price:N,priceDigits:le},{label:"M",price:N,priceDigits:le},{label:"L",price:N,priceDigits:le}]}),{...w,variants:D}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Te,disabled:!Array.isArray(F.variants)||F.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:F.image,onChange:w=>q({...F,image:w.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:oe,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Se,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:_,video:M,onClose:L,onSave:oe}){const[W,F]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[q,Se]=useState(!1),[Ce,pe]=useState("");useEffect(()=>{M?(F({title:M.title||"",youtube_url:`https://www.youtube.com/watch?v=${M.youtubeId}`,thumbnail_url:M.thumb||"",sort_order:M.sortOrder||0}),pe(M.thumb)):(F({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),pe(""))},[M,_]);const Oe=Me=>{const Ge=Me.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Ge?Ge[1]:null},Je=Me=>{F({...W,youtube_url:Me});const Ge=Oe(Me);Ge&&pe(`https://img.youtube.com/vi/${Ge}/hqdefault.jpg`)},Ae=async Me=>{Me.preventDefault(),Se(!0),await oe(W),Se(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},M?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:Ae},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:W.youtube_url,onChange:Me=>Je(Me.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),Ce&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:Ce,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:W.title,onChange:Me=>F({...W,title:Me.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:W.sort_order,onChange:Me=>F({...W,sort_order:parseInt(Me.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:W.thumbnail_url,onChange:Me=>F({...W,thumbnail_url:Me.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:q},q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[_,M]=useState(!1),[L,oe]=useState(""),[W,F]=useState(null),[q,Se]=useState("search"),[Ce,pe]=useState(()=>loadAdminPins()),[Oe,Je]=useState(()=>loadAdminRecent()),[Ae,Me]=useState(null),[Ge,Te]=useState(""),[P,Qe]=useState([]),[pt,it]=useState(null),[$e,He]=useState(!1),[ye,Ze]=useState(null),[xt,jt]=useState(!0),[Ke,ht]=useState([]),[Tt,w]=useState(!1),[N,D]=useState(null),[le,de]=useState(!1),[Z,ie]=useState(!1),[Ne,y]=useState(""),[j,z]=useState(()=>loadAdminSettings()),[me,xe]=useState(null),[be,Le]=useState([]);useEffect(()=>{const c=localStorage.getItem("ktm_admin_session");if(c)try{const E=JSON.parse(c);E.expiry>Date.now()?(M(!0),F(E.user)):localStorage.removeItem("ktm_admin_session")}catch(E){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{_&&ot()},[_]),useEffect(()=>{const c=()=>{try{const J=document.querySelector(".admin-topbar");if(!J)return;const we=J.getBoundingClientRect(),ke=Math.max(0,Math.round(we.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${ke+10}px`)}catch(J){}};c(),window.addEventListener("resize",c);const E=setTimeout(c,0);return()=>{clearTimeout(E),window.removeEventListener("resize",c)}},[_,q]),useEffect(()=>{var J,we;const c=window.visualViewport,E=()=>{try{const ke=Number(window.innerHeight)||0,je=Number(c==null?void 0:c.height)||ke,et=Number(c==null?void 0:c.offsetTop)||0,Pe=Math.max(0,Math.round(ke-je-et));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${Pe}px`)}catch(ke){}};E(),window.addEventListener("resize",E);try{(J=c==null?void 0:c.addEventListener)==null||J.call(c,"resize",E),(we=c==null?void 0:c.addEventListener)==null||we.call(c,"scroll",E)}catch(ke){}return()=>{var ke,je;window.removeEventListener("resize",E);try{(ke=c==null?void 0:c.removeEventListener)==null||ke.call(c,"resize",E),(je=c==null?void 0:c.removeEventListener)==null||je.call(c,"scroll",E)}catch(et){}}},[]),useEffect(()=>{if(!_)return;const c=J=>{if(!J)return!1;const we=String(J.tagName||"").toLowerCase();return!!(we==="input"||we==="textarea"||we==="select"||J.isContentEditable)},E=J=>{if(!J||J.ctrlKey||J.metaKey||J.altKey||c(J.target))return;const we=J.key;(we==="/"||we==="N"||we==="n"||we==="Escape"||we==="j"||we==="J"||we==="k"||we==="K")&&(we==="/"&&J.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:we}})))};return document.addEventListener("keydown",E),()=>document.removeEventListener("keydown",E)},[_]),useEffect(()=>{_&&Je(c=>{const E=Array.isArray(c)?c:[],J=[q,...E.filter(we=>we!==q)].slice(0,8);return saveAdminRecent(J),J})},[_]);const Re=c=>{const E=String(c||"").trim();E&&Je(J=>{const we=Array.isArray(J)?J:[],ke=[E,...we.filter(je=>je!==E)].slice(0,8);return saveAdminRecent(ke),ke})},rt=c=>{const E=String(c||"").trim();E&&pe(J=>{const we=Array.isArray(J)?J:[],je=we.includes(E)?we.filter(et=>et!==E):[E,...we].slice(0,10);return saveAdminPins(je),je})};useEffect(()=>{if(!_)return;let c=!1;return(async()=>{try{const E=await fetchAdminSettingsFromServer();if(c)return;z(E),saveAdminSettings(E)}catch(E){}})(),()=>{c=!0}},[_]);const vt=async(c,E)=>{oe("");try{const J=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:c,password:E},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),we={user:J.user,token:J.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(we)),F(J.user),M(!0)}catch(J){oe(J.message)}},fe=()=>{localStorage.removeItem("ktm_admin_session"),M(!1),F(null),Qe([]),it(null)},ze=(c,E="success",J=null)=>{const we=Date.now()+Math.floor(Math.random()*1e3);if(c&&typeof c=="object"){const je=c;ht(et=>[...et,{id:we,message:String(je.message||""),type:String(je.type||E||"success"),actionLabel:je.actionLabel||null,onAction:typeof je.onAction=="function"?je.onAction:null,durationMs:je.durationMs||null}]);return}const ke=J&&typeof J=="object"?J:null;ht(je=>[...je,{id:we,message:String(c||""),type:String(E||"success"),actionLabel:(ke==null?void 0:ke.actionLabel)||null,onAction:typeof(ke==null?void 0:ke.onAction)=="function"?ke.onAction:null,durationMs:(ke==null?void 0:ke.durationMs)||null}])},Mt=c=>{ht(E=>E.filter(J=>J.id!==c))},ot=async(c=null)=>{jt(!0);try{const E=c?`${API_BASE}/api/albums?parent_id=${c}`:`${API_BASE}/api/albums?parent_id=root`,J=await window.KTM.api.getJSON(E,"L\u1ED7i t\u1EA3i danh s\xE1ch album");Qe(Array.isArray(J)?J:[])}catch(E){console.error(E),ze("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}jt(!1)},Kt=()=>{Ze(null),He(!0)},$t=c=>{We(c),de(!0)},aa=async(c,E="modal")=>{try{const J=ye&&ye.uuid;!J&&me&&(c.parent_id=me.uuid);const we=J?`${API_BASE}/api/albums/${ye.uuid||ye.id}`:`${API_BASE}/api/albums`;J?await window.KTM.api.putJSON(we,c,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(we,c,"L\u1ED7i t\u1EA1o"),ze(J?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),E==="drawer"?(de(!1),Ze(null),ot(me==null?void 0:me.uuid),J&&N&&D({...N,...c})):(He(!1),Ze(null),ot(me==null?void 0:me.uuid))}catch(J){ze(J.message,"danger")}},Jt=c=>{it(c)},k=c=>{if(c==="root")Le([]),xe(null),ot(null);else if(c){const E=be.findIndex(J=>J.uuid===c.uuid);E>=0&&(Le(be.slice(0,E+1)),xe(c),ot(c.uuid))}else{const E=[...be];E.pop();const J=E[E.length-1]||null;Le(E),xe(J),ot(J==null?void 0:J.uuid)}},U=async c=>{const E=`X\xF3a folder "${c.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(E))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${c.uuid||c.id}`,"L\u1ED7i x\xF3a album"),ze("\u0110\xE3 x\xF3a","success"),ot(me==null?void 0:me.uuid)}catch(J){ze("L\u1ED7i x\xF3a album","danger")}},We=async c=>{c&&(w(!0),y(""),ie(!1),de(!1),D(c))},yt=()=>{w(!1),ie(!1),y(""),de(!1),D(null)},Gt=c=>{de(!0)};if(!_)return React.createElement(LoginPage,{onLogin:vt,error:L});const St=()=>{const c=new Date,E=c.getFullYear(),J=String(c.getMonth()+1).padStart(2,"0");return`${E}-${J}`};function It(){const[c,E]=useState(()=>{var je;return String((je=j==null?void 0:j.ship_percent)!=null?je:DEFAULT_SHIP_PERCENT)}),[J,we]=useState(!1);return useEffect(()=>{var je;E(String((je=j==null?void 0:j.ship_percent)!=null?je:DEFAULT_SHIP_PERCENT))},[j==null?void 0:j.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async je=>{je.preventDefault(),we(!0);const et=saveAdminSettings({ship_percent:c});try{const Pe=await saveAdminSettingsToServer(et);z(Pe),saveAdminSettings(Pe),ze("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Pe){z(et),ze("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{we(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:c,min:"0",max:"100",step:"0.01",onChange:je=>E(je.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:J},J?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function I(){const[c,E]=useState(St()),[J,we]=useState(!0),ke=useRef(null),je=useRef(null),[et,Pe]=useState(0),[Vt,kt]=useState(!1),Dt=useRef(0),[Wt,Ht]=useState(!1),[Ft,Ta]=useState(""),[ua,Yt]=useState(""),[na,wa]=useState(""),[lt,$a]=useState(null),pa=useRef(new Map),[Qt,xa]=useState(window!=null&&window.XLSX?"ready":"loading"),Lt=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[qe,Ra]=useState(Lt),Pa=useRef(new Map),Et=normalizeShipPercent(j==null?void 0:j.ship_percent),{formatNumber:Ue,formatVND:Ot}=window.KTM.money,ra=async(r,b=!1)=>{var _e,nt;const K=String(r||"").trim();if(!K)return Lt();const ee=`${K}|${Et}`,V=(_e=Pa.current)==null?void 0:_e.get(ee);if(!b&&V)return V;const X=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(K)}&ship_percent=${encodeURIComponent(Et)}`,T=await window.KTM.api.getJSON(X,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Y=T!=null&&T.stats&&(T!=null&&T.meta)?T.stats:T,ge=Y&&typeof Y=="object"?Y:Lt();return(nt=Pa.current)==null||nt.set(ee,ge),ge},ha=async(r=!1)=>{we(!0);try{const b=await ra(c,r);Ra(b)}catch(b){console.error("Load stats error:",b),Ra(Lt())}finally{we(!1)}};useEffect(()=>{ha()},[c,Et]);const Rt=(r,b)=>{const K=String(r||"").trim(),ee=K.match(/^(\d{4})-(\d{2})$/);if(!ee)return K;const V=Number(ee[1]),X=Number(ee[2])-1,T=new Date(V,X,1);T.setMonth(T.getMonth()+Number(b||0));const Y=T.getFullYear(),ge=String(T.getMonth()+1).padStart(2,"0");return`${Y}-${ge}`},Ct=St(),fa=Rt(Ct,-5),Zt=r=>{const b=String(r||"").trim();return b?b>=fa&&b<=Ct:!1},sa=r=>{const b=String(r||"").trim();return b&&(b<fa?fa:b>Ct?Ct:b)},Ia=r=>{const b=Date.now();b-Number(Dt.current||0)<1200||(Dt.current=b,ze(r==="future"?"Kh\xF4ng xem \u0111\u01B0\u1EE3c th\xE1ng t\u01B0\u01A1ng lai":"Ch\u1EC9 xem t\u1ED1i \u0111a 5 th\xE1ng g\u1EA7n nh\u1EA5t","warning"))},ea=(r,b,K)=>Math.max(b,Math.min(K,r)),oa=()=>{var r;return Math.max(320,Number((r=je.current)==null?void 0:r.clientWidth)||360)},Nt=()=>{const r=oa();return ea(Math.floor(r*.35),110,180)},ba=()=>{const r=oa();return ea(Math.floor(r*.22),70,140)};useEffect(()=>{let r=!1;const b=()=>!!(window!=null&&window.XLSX&&typeof window.XLSX.read=="function"),K=V=>new Promise((X,T)=>{try{if(Array.from(document.querySelectorAll("script")).find(_e=>((_e==null?void 0:_e.src)||"").includes(V))){const _e=Date.now(),nt=setInterval(()=>{b()?(clearInterval(nt),X(!0)):Date.now()-_e>2500&&(clearInterval(nt),T(new Error("existing script not loaded")))},100);return}const ge=document.createElement("script");ge.src=V,ge.async=!0,ge.onload=()=>X(!0),ge.onerror=()=>T(new Error(`load failed: ${V}`)),document.head.appendChild(ge)}catch(Y){T(Y)}}),ee=async()=>{if(b())return!0;const V=["https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js","https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js","https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"];for(const X of V){if(b())return!0;try{if(await K(X),b())return!0}catch(T){}}return b()};return(async()=>{if(Qt==="ready"||Qt==="failed")return;if(b()){r||xa("ready");return}r||xa("loading"),await new Promise(X=>setTimeout(X,300));const V=await ee();r||xa(V?"ready":"failed")})(),()=>{r=!0}},[Qt]);const zt=r=>{const b=String(r!=null?r:"").trim().toLowerCase();if(!b)return"";try{return b.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/đ/g,"d").replace(/[^a-z0-9\s\.\-\/\+]/g," ").replace(/\s+/g," ").trim()}catch(K){return b.replace(/\s+/g," ").trim()}},Bt=r=>{var X,T;if(r==null||r==="")return"";if(typeof r=="number"&&Number.isFinite(r)&&((T=(X=window==null?void 0:window.XLSX)==null?void 0:X.SSF)!=null&&T.parse_date_code))try{const Y=window.XLSX.SSF.parse_date_code(r);return!Y||!Y.y||!Y.m?"":`${String(Y.y).padStart(4,"0")}-${String(Y.m).padStart(2,"0")}`}catch(Y){}const b=String(r).trim(),K=b.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(K){const Y=String(Number(K[2])||0).padStart(2,"0");return`${K[3]}-${Y}`}const ee=b.match(/^(\d{4})-(\d{2})-(\d{2})/);if(ee)return`${ee[1]}-${ee[2]}`;const V=new Date(b);return Number.isNaN(V.getTime())?"":`${V.getFullYear()}-${String(V.getMonth()+1).padStart(2,"0")}`},Ea=r=>{var X,T;if(r==null||r==="")return"";if(typeof r=="number"&&Number.isFinite(r)&&((T=(X=window==null?void 0:window.XLSX)==null?void 0:X.SSF)!=null&&T.parse_date_code))try{const Y=window.XLSX.SSF.parse_date_code(r);return!Y||!Y.y||!Y.m||!Y.d?"":`${String(Y.y).padStart(4,"0")}-${String(Y.m).padStart(2,"0")}-${String(Y.d).padStart(2,"0")}`}catch(Y){}const b=String(r).trim(),K=b.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(K){const Y=String(Number(K[1])||0).padStart(2,"0"),ge=String(Number(K[2])||0).padStart(2,"0");return`${K[3]}-${ge}-${Y}`}const ee=b.match(/^(\d{4})-(\d{2})-(\d{2})/);if(ee)return`${ee[1]}-${ee[2]}-${ee[3]}`;const V=new Date(b);return Number.isNaN(V.getTime())?"":`${V.getFullYear()}-${String(V.getMonth()+1).padStart(2,"0")}-${String(V.getDate()).padStart(2,"0")}`},Ga=r=>r==null||r===""?0:typeof r=="number"&&Number.isFinite(r)?Math.trunc(r):window.KTM.money.parseMoney(String(r)),Oa=r=>{var K,ee;let b="";try{(ee=(K=window==null?void 0:window.KTM)==null?void 0:K.phone)!=null&&ee.normalize&&(b=window.KTM.phone.normalize(r))}catch(V){}return b||(b=String(r!=null?r:"").replace(/[^0-9]/g,"")),b=String(b||"").replace(/[^0-9]/g,""),b?(b.startsWith("840")?b=`0${b.slice(3)}`:b.startsWith("84")&&(b.length===11?b=`0${b.slice(2)}`:b.length===12&&b[2]!=="0"&&(b=`0${b.slice(2)}`)),b.length===9&&(b=`0${b}`),b):""},_a=r=>{const b=String(r!=null?r:"");if(!b.trim())return{phone:"",phoneNorm:"",cleanedText:String(r!=null?r:"").trim()};const K=/(?:\+?84|0)\s*[0-9\s\-.()]{8,16}/g;let ee=null,V;for(;(V=K.exec(b))!=null;){const ge=V[0],_e=Oa(ge);_e&&(_e.length<9||_e.length>12||(ee={raw:ge,digits:_e}))}if(!ee){const ge=Oa(b);if(ge.length>=9){const _e=ge.slice(-12);_e.length>=9&&(ee={raw:_e,digits:_e})}}if(!ee)return{phone:"",phoneNorm:"",cleanedText:b.trim()};const X=ee.digits,T=X;let Y=b;return ee.raw&&b.includes(ee.raw)?Y=Y.replace(ee.raw," "):Y=Y.replace(new RegExp(`${ee.digits}$`)," "),Y=Y.replace(/[\-–—•|]+\s*$/g," ").replace(/\s+[\-–—•|]+\s*/g," ").replace(/\s+/g," ").trim(),{phone:T,phoneNorm:X,cleanedText:Y}},Wa=async()=>{var b;const r=pa.current;if(r&&r.size>0)return r;try{const K=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m"),ee=Array.isArray(K==null?void 0:K.products)?K.products:Array.isArray(K)?K:[],V=new Map;for(const X of ee){const T=String((b=X==null?void 0:X.id)!=null?b:"").trim();T&&V.set(T,X)}return pa.current=V,V}catch(K){return pa.current=new Map,pa.current}},Ka=r=>{var K;const b=String(r!=null?r:"").trim();return b&&((K=pa.current)==null?void 0:K.get(b))||null},ga=async r=>{var O,B,G,ue;if(!r)throw new Error("Ch\u01B0a ch\u1ECDn file");if(!((O=window==null?void 0:window.XLSX)!=null&&O.read))throw new Error("Thi\u1EBFu th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). Vui l\xF2ng t\u1EA3i l\u1EA1i trang admin.");const b=await r.arrayBuffer(),K=window.XLSX.read(b,{type:"array"}),ee=(B=K==null?void 0:K.SheetNames)==null?void 0:B[0],V=ee?K.Sheets[ee]:null;if(!V)throw new Error("Kh\xF4ng \u0111\u1ECDc \u0111\u01B0\u1EE3c sheet trong file");const X=window.XLSX.utils.sheet_to_json(V,{header:1,raw:!0,defval:""}),T=Array.isArray(X)?X:[];if(!T.length)throw new Error("File r\u1ED7ng");const Y={product:["ten san pham","tensanpham","san pham","t\xEAn s\u1EA3n ph\u1EA9m"],cod:["tong tien thu ho","t\u1ED5ng ti\u1EC1n thu h\u1ED9","thu ho","thu h\u1ED9","tong thu ho","t\u1ED5ng thu h\u1ED9"],date:["ngay","ng\xE0y","date"],phone:["sdt","s\u0111t","so dien thoai","s\u1ED1 \u0111i\u1EC7n tho\u1EA1i","dien thoai","\u0111i\u1EC7n tho\u1EA1i","phone"]},_e=(()=>{const re=Math.min(30,T.length);for(let x=0;x<re;x++){const R=(Array.isArray(T[x])?T[x]:[]).map(Ve=>zt(Ve)),he=Ve=>{for(let at=0;at<R.length;at++){const mt=R[at];if(mt&&Ve.some(bt=>mt.includes(zt(bt))))return at}return-1},De=he(Y.product),Ie=he(Y.cod);if(De>=0&&Ie>=0){const Ve=he(Y.date),at=he(Y.phone);return{headerRow:x,productCol:De,codCol:Ie,dateCol:Ve,phoneCol:at}}}return null})();if(!_e)throw new Error('Kh\xF4ng t\xECm th\u1EA5y header c\u1ED9t "T\xEAn s\u1EA3n ph\u1EA9m" v\xE0 "T\u1ED5ng ti\u1EC1n thu h\u1ED9"');const nt=[],dt=new Set;for(let re=_e.headerRow+1;re<T.length;re++){const x=Array.isArray(T[re])?T[re]:[],Q=String((G=x[_e.productCol])!=null?G:"").trim(),R=Ga(x[_e.codCol]);if(!Q&&!R)continue;const he=_e.phoneCol>=0?String((ue=x[_e.phoneCol])!=null?ue:"").trim():"",De=Oa(he);let Ie=_a(Q);if(De&&(Ie={...Ie,phone:De,phoneNorm:De}),!Ie.phoneNorm){const ia=x.map(wt=>String(wt!=null?wt:"")).join(" | "),Xt=_a(ia);Xt.phoneNorm&&(Ie={...Ie,phone:Xt.phone,phoneNorm:Xt.phoneNorm})}const Ve=Ie.cleanedText||Q,at=zt(Ve);if(!at||at.includes("tong tien")||at.includes("tong")||at.includes("thanh toan")||at.includes("thanh to\xE1n"))continue;const mt=_e.dateCol>=0?x[_e.dateCol]:"",bt=mt?Bt(mt):"";bt&&dt.add(bt);const ta=mt?Ea(mt):"";nt.push({rowIndex:re+1,dateRaw:mt,monthKey:bt,dayKey:ta,product:Ve,productNorm:zt(Ve),productCompact:zt(Ve).replace(/\s+/g,""),phone:Ie.phone,phoneNorm:Ie.phoneNorm,cod:R})}return{rows:nt,monthKeys:Array.from(dt.values()).sort()}},Sa=r=>{const b=new Map,K=(V,X)=>{const T=b.get(V)||{key:V,rows:[],phoneNorm:"",phone:"",monthKey:""};T.rows.push(X),!T.phoneNorm&&X.phoneNorm&&(T.phoneNorm=X.phoneNorm,T.phone=X.phone||X.phoneNorm),!T.monthKey&&X.monthKey&&(T.monthKey=X.monthKey),b.set(V,T)};for(const V of Array.isArray(r)?r:[]){const X=String((V==null?void 0:V.phoneNorm)||"").trim(),T=String((V==null?void 0:V.dayKey)||"").trim(),Y=String((V==null?void 0:V.monthKey)||"").trim();if(X){const ge=T?`p:${X}:d:${T}`:Y?`p:${X}:m:${Y}`:`p:${X}`;K(ge,V)}else K(`r:${V==null?void 0:V.rowIndex}`,V)}const ee=V=>{var re,x,Q;const X=V.rows.slice().filter(Boolean),T=X.map(R=>R.rowIndex).filter(Boolean),Y=[],ge=new Set;for(const R of X){const he=String((R==null?void 0:R.productNorm)||"").trim();he&&(ge.has(he)||(ge.add(he),Y.push(String((R==null?void 0:R.product)||"").trim())))}const _e=Y.filter(Boolean).join(" + "),nt=zt(_e),dt=X.map(R=>Number((R==null?void 0:R.cod)||0)||0).filter(R=>R>0);let O=0;if(!dt.length)O=0;else{const R=new Map;for(const De of dt)R.set(De,(R.get(De)||0)+1);const he=Array.from(R.keys());if(he.length===1)O=he[0];else{let De=null,Ie=0;for(const[Ve,at]of R.entries())at>Ie&&(Ie=at,De=Ve);De!=null&&Ie>=2?O=De:O=dt.reduce((Ve,at)=>Ve+at,0)}}const B=V.monthKey||((re=X.find(R=>R==null?void 0:R.monthKey))==null?void 0:re.monthKey)||"",G=((x=X.find(R=>R==null?void 0:R.dayKey))==null?void 0:x.dayKey)||"",ue=((Q=X.find(R=>R==null?void 0:R.dateRaw))==null?void 0:Q.dateRaw)||"";return{key:V.key,phoneNorm:V.phoneNorm||"",phone:V.phone||V.phoneNorm||"",monthKey:B,dayKey:G,dateRaw:ue,rowIndices:T,rowIndexFirst:T.length?Math.min(...T):null,rowCount:X.length,productDisplay:_e,productNorm:nt,productCompact:String(nt||"").replace(/\s+/g,""),cod:O,rows:X}};return Array.from(b.values()).map(ee)},va=async r=>{const b=`${API_BASE}/api/orders?month=${encodeURIComponent(r)}&includeItems=1`,K=await window.KTM.api.getJSON(b,"L\u1ED7i t\u1EA3i danh s\xE1ch \u0111\u01A1n");return Array.isArray(K==null?void 0:K.orders)?K.orders:Array.isArray(K)?K:[]},Ua=async r=>{const b=Array.isArray(r)&&r.length?r:[c],K=[];for(let T=0;T<b.length;T++){const Y=b[T];Yt(`\u0110ang t\u1EA3i \u0111\u01A1n h\u1EC7 th\u1ED1ng th\xE1ng ${Y} (${T+1}/${b.length})...`);const ge=await va(Y);K.push(...ge)}const ee=T=>String(T||"").trim().toLowerCase();return K.filter(T=>{const Y=ee(T==null?void 0:T.status);return Y!=="draft"&&Y!=="canceled"}).map(T=>{var B,G,ue,re,x,Q;const Y=window.KTM.orders.getOrderProductSummary(T,Ka),ge=window.KTM.orders.getOrderTotalMoney(T,Ka),_e=zt(Y),nt=Oa((B=T==null?void 0:T.phone)!=null?B:""),dt=(G=T==null?void 0:T.created_at)!=null?G:null,O=(()=>{if(!dt)return"";const R=new Date(dt);return Number.isNaN(R.getTime())?"":`${R.getFullYear()}-${String(R.getMonth()+1).padStart(2,"0")}-${String(R.getDate()).padStart(2,"0")}`})();return{id:String((ue=T==null?void 0:T.id)!=null?ue:""),created_at:(re=T==null?void 0:T.created_at)!=null?re:null,dayKey:O,status:String((x=T==null?void 0:T.status)!=null?x:""),phone:String((Q=T==null?void 0:T.phone)!=null?Q:""),phoneNorm:nt,productSummary:Y,productNorm:_e,productCompact:_e.replace(/\s+/g,""),cod:Number(ge||0)||0,raw:T}}).filter(T=>T.id&&T.cod>0)},s=(r,b)=>{const K=String(r||"").trim(),ee=String(b||"").trim();if(!K||!ee)return 0;if(K===ee)return 1;const V=K.replace(/\s+/g,""),X=ee.replace(/\s+/g,"");if(V&&X&&V===X)return 1;if(V&&X&&(X.includes(V)||V.includes(X)))return .92;const T=x=>String(x||"").replace(/[\+]/g," ").replace(/[()\[\]{},.;:!?]/g," ").replace(/\s+/g," ").trim().split(" ").map(he=>he.trim()).filter(Boolean).map(he=>he.replace(/[^a-z0-9]/g,"")).filter(Boolean).filter(he=>he.length>1),Y=T(K),ge=T(ee);if(!Y.length||!ge.length)return 0;const _e=new Set(ge),nt=(x,Q)=>{if(x===Q)return 0;const R=x.length,he=Q.length;if(Math.abs(R-he)>1)return 2;let De=0,Ie=0,Ve=0;for(;De<R&&Ie<he;){if(x[De]===Q[Ie]){De+=1,Ie+=1;continue}if(Ve+=1,Ve>1)return Ve;R>he?De+=1:(he>R||(De+=1),Ie+=1)}return(De<R||Ie<he)&&(Ve+=1),Ve},dt=x=>/[0-9]/.test(x)?2:1;let O=0,B=0;for(const x of Y){const Q=dt(x);if(B+=Q,_e.has(x)||X&&X.includes(x)){O+=Q;continue}if(x.length>=4){let R=!1;for(const he of ge){if(he===x){R=!0;break}if(he.includes(x)||x.includes(he)){R=!0;break}if(X&&X.includes(x)){R=!0;break}if(nt(x,he)<=1){R=!0;break}}R&&(O+=Q*.8)}}const G=O/Math.max(1,B),ue=Math.min(.12,Math.abs(K.length-ee.length)/Math.max(1,Math.max(K.length,ee.length))),re=(()=>{const x=Y.filter(R=>/[0-9]/.test(R)&&R.length>=3);if(!x.length)return 0;let Q=0;for(const R of x)(_e.has(R)||X&&X.includes(R))&&(Q+=1);return Math.min(.08,.04*Q)})();return Math.max(0,Math.min(1,G-ue+re))},u=async r=>{Ta(""),$a(null),wa((r==null?void 0:r.name)||""),Ht(!0),Yt("\u0110ang \u0111\u1ECDc file Excel...");try{await Wa();const b=await ga(r),K=b.rows,ee=b.monthKeys.length?b.monthKeys:[c],V=Sa(K);Yt(`\u0110\u1ECDc \u0111\u01B0\u1EE3c ${K.length} d\xF2ng (${V.length} c\u1EE5m). \u0110ang chu\u1EA9n b\u1ECB \u0111\u1ED1i so\xE1t...`);const X=await Ua(ee);Yt(`\u0110ang \u0111\u1ED1i so\xE1t (${V.length} c\u1EE5m Excel vs ${X.length} \u0111\u01A1n h\u1EC7 th\u1ED1ng)...`);const T=new Set,Y=[],ge=[],_e=[],nt=new Map,dt=new Map;for(const x of X){const Q=String(x.phoneNorm||"").trim();if(!Q)continue;const R=nt.get(Q)||[];R.push(x),nt.set(Q,R);const he=`${Q}|${String(x.cod)}`,De=dt.get(he)||[];De.push(x),dt.set(he,De)}const O=new Map;for(const x of X){const Q=String(x.cod),R=O.get(Q)||[];R.push(x),O.set(Q,R)}const B=[];for(const x of V){const Q=String(x.phoneNorm||"").trim(),R=Q?nt.get(Q)||[]:[],he=Q?`${Q}|${String(x.cod)}`:"",De=Q&&x.cod>0?dt.get(he)||[]:[];let Ie=(Q?R:O.get(String(x.cod))||[]).filter(wt=>!T.has(wt.id));if(Q&&x.cod>0){let Pt=De.filter(la=>!T.has(la.id));if(x.dayKey){const la=Pt.filter(ca=>String(ca.dayKey||"")===String(x.dayKey||""));la.length&&(Pt=la)}if(Pt.length===1){const la=Pt[0];T.add(la.id),Y.push({group:x,order:la,score:1});continue}Pt.length&&(Ie=Pt)}if(x.dayKey){const wt=Ie.filter(Pt=>String(Pt.dayKey||"")===String(x.dayKey||""));wt.length&&(Ie=wt)}if(!Ie.length){B.push(x);continue}let Ve=Ie;const at=x.cod>0?Ie.filter(wt=>Number(wt.cod||0)===Number(x.cod||0)):[];if(x.cod>0){if(at.length)Ve=at;else if(Q){B.push(x);continue}}let mt=null,bt=-1;for(const wt of Ve){const Pt=s(x.productNorm,wt.productNorm);Pt>bt&&(bt=Pt,mt=wt)}const ta=Q?x.dayKey?.3:.36:.55,Xt=!!(!!(Q&&x.cod>0&&at.length>=1)&&bt>=.12);if(mt&&(bt>=ta||Xt)){T.add(mt.id);const wt=Number(x.cod||0)-Number(mt.cod||0);x.cod>0&&mt.cod>0&&wt!==0&&bt>=.68&&Q&&String(mt.phoneNorm||"")===Q?_e.push({group:x,order:mt,score:bt,diff:wt}):Y.push({group:x,order:mt,score:bt})}else B.push(x)}const G=[];for(const x of B){const Q=String(x.phoneNorm||"").trim();let R=Q?nt.get(Q)||[]:X;if(Q&&x.dayKey){const Ie=R.filter(Ve=>String(Ve.dayKey||"")===String(x.dayKey||""));Ie.length&&(R=Ie)}let he=null,De=-1;for(const Ie of R){const Ve=s(x.productNorm,Ie.productNorm);Ve>De&&(De=Ve,he=Ie)}he&&De>=(Q?.52:.72)&&Number(he.cod||0)!==Number(x.cod||0)?_e.push({group:x,order:he,score:De,diff:Number(x.cod||0)-Number(he.cod||0)}):G.push(x)}const ue=X.filter(x=>!T.has(x.id)),re=G.length===0&&ue.length===0&&_e.length===0;$a({ok:re,monthKeys:ee,excelCount:K.length,excelGroupCount:V.length,systemCount:X.length,matches:Y,excelOnly:G,systemOnly:ue,amountMismatch:_e}),Yt(re?"OK \u2705":"\u0110\xE3 \u0111\u1ED1i so\xE1t xong")}catch(b){Ta(String((b==null?void 0:b.message)||b||"L\u1ED7i \u0111\u1ED1i so\xE1t")),Yt("")}finally{Ht(!1)}},m=r=>{try{if(!(r!=null&&r.touches)||r.touches.length!==1||Vt)return;const b=r.target;if(b&&typeof b.closest=="function"&&b.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){ke.current=null;return}const K=r.touches[0];ke.current={x:K.clientX,y:K.clientY,at:Date.now(),swiping:!1}}catch(b){ke.current=null}},$=r=>{const b=ke.current;if(!b||Vt)return;const K=(r==null?void 0:r.touches)&&r.touches[0];if(!K)return;const ee=K.clientX-b.x,V=K.clientY-b.y,X=Math.abs(ee),T=Math.abs(V);if(!b.swiping)if(X>12&&X>T*1.2)b.swiping=!0,kt(!1);else return;const Y=Nt();Pe(ea(ee,-Y,Y))},H=r=>{const b=ke.current;if(ke.current=null,!b||Vt||!b.swiping){Pe(0);return}const K=(r==null?void 0:r.changedTouches)&&r.changedTouches[0];if(!K)return;const ee=K.clientX-b.x,V=K.clientY-b.y,X=Date.now()-b.at,T=Math.abs(ee),Y=Math.abs(V);if(X>1e3)return;if(T<30){Pe(0);return}if(T<Y*1.5)return;const ge=ba(),_e=T>=ge,nt=ee>0?1:-1;if(!_e){kt(!0),Pe(0),setTimeout(()=>kt(!1),220);return}const dt=nt>0?-1:1,O=Rt(c,dt);if(!Zt(O)){kt(!0),Pe(nt*Math.floor(Nt()*.55)),setTimeout(()=>{Pe(0),setTimeout(()=>kt(!1),200)},140),Ia(O>Ct?"future":"past");return}kt(!0),Pe(nt*Nt()),setTimeout(()=>{E(B=>Rt(B,dt)),Pe(-nt*Nt()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Pe(0),setTimeout(()=>kt(!1),220)})})},140)},A=()=>{ke.current=null,Pe(0)},v=r=>{var b,K;try{if(!r||r.pointerType==="touch"||typeof r.button=="number"&&r.button!==0||Vt)return;const ee=r.target;if(ee&&typeof ee.closest=="function"&&ee.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){ke.current=null;return}ke.current={x:r.clientX,y:r.clientY,at:Date.now(),swiping:!1};try{(K=(b=r.currentTarget)==null?void 0:b.setPointerCapture)==null||K.call(b,r.pointerId)}catch(V){}}catch(ee){ke.current=null}},ne=r=>{try{if(!r||r.pointerType==="touch")return;const b=ke.current;if(!b||Vt)return;const K=r.clientX-b.x,ee=r.clientY-b.y,V=Math.abs(K),X=Math.abs(ee);if(!b.swiping)if(V>12&&V>X*1.2)b.swiping=!0,kt(!1);else return;const T=Nt();Pe(ea(K,-T,T))}catch(b){}},ve=r=>{try{if(!r||r.pointerType==="touch")return;const b=ke.current;if(ke.current=null,!b||Vt||!b.swiping){Pe(0);return}const K=r.clientX-b.x,ee=r.clientY-b.y,V=Date.now()-b.at,X=Math.abs(K),T=Math.abs(ee);if(V>1e3)return;if(X<30){Pe(0);return}if(X<T*1.5)return;const Y=ba(),ge=X>=Y,_e=K>0?1:-1;if(!ge){kt(!0),Pe(0),setTimeout(()=>kt(!1),220);return}const nt=_e>0?-1:1,dt=Rt(c,nt);if(!Zt(dt)){kt(!0),Pe(_e*Math.floor(Nt()*.55)),setTimeout(()=>{Pe(0),setTimeout(()=>kt(!1),200)},140),Ia(dt>Ct?"future":"past");return}kt(!0),Pe(_e*Nt()),setTimeout(()=>{E(O=>Rt(O,nt)),Pe(-_e*Nt()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Pe(0),setTimeout(()=>kt(!1),220)})})},140)}catch(b){ke.current=null}},se=()=>{ke.current=null,Pe(0)},ce=et>0?"Th\xE1ng tr\u01B0\u1EDBc":et<0?"Th\xE1ng sau":"",Ee=et>0?Rt(c,-1):et<0?Rt(c,1):"",Ye=Ee&&Zt(Ee)?Ee:"",f=Math.min(1,Math.abs(et)/Math.max(1,ba()));return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager",ref:je,style:{touchAction:"pan-y",transform:`translateX(${et}px)`,transition:Vt?"transform 220ms ease":"none",willChange:"transform"},onTouchStartCapture:m,onTouchMoveCapture:$,onTouchEndCapture:H,onTouchCancelCapture:A,onPointerDown:v,onPointerMove:ne,onPointerUp:ve,onPointerCancel:se},!!ce&&React.createElement("div",{"aria-hidden":"true",style:{position:"fixed",left:0,right:0,top:84,zIndex:1060,pointerEvents:"none",opacity:.15+.55*f,transform:"translateZ(0)"}},React.createElement("div",{className:"d-flex justify-content-center"},React.createElement("div",{className:"px-3 py-2 rounded-pill bg-dark text-white shadow-sm",style:{fontSize:13}},et>0?"\u2190":"\u2192"," ",ce," \xB7 ",Ye))),React.createElement(Loading,{show:J}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>ha(!0),disabled:J},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:c,onChange:r=>E(r.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",Et,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),Ue(qe.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),Ue(qe.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),Ue(qe.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",Ue(qe.statusCounts.paid),"/",Ue(qe.statusCounts.done)))))),React.createElement("div",{className:"card border-0 shadow-sm mb-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{className:"fw-semibold"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 (Excel)"),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("span",{className:"text-muted small"},"Check: ",React.createElement("span",{className:"fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m")," + ",React.createElement("span",{className:"fw-semibold"},"T\u1ED5ng ti\u1EC1n thu h\u1ED9")))),Qt==="loading"&&React.createElement("div",{className:"alert alert-info mt-3 mb-0"},"\u0110ang t\u1EA3i th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX)..."),Qt==="failed"&&React.createElement("div",{className:"alert alert-warning mt-3 mb-0"},"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). H\xE3y ki\u1EC3m tra m\u1EA1ng / ch\u1EB7n CDN (AdBlock) ho\u1EB7c refresh l\u1EA1i trang."),React.createElement("div",{className:"row g-2 align-items-end mt-2"},React.createElement("div",{className:"col-12 col-md-7"},React.createElement("label",{className:"form-label mb-1"},"Upload file Excel"),React.createElement("input",{type:"file",className:"form-control",accept:".xlsx,.xls,.csv",disabled:Wt,onChange:async r=>{const b=r.target.files&&r.target.files[0];b&&await u(b)}}),React.createElement("div",{className:"form-text"},na?`File: ${na}`:'Header c\u1EA7n c\xF3: "T\xEAn s\u1EA3n ph\u1EA9m" v\xE0 "T\u1ED5ng Ti\u1EC1n Thu H\u1ED9". C\xF3 c\u1ED9t "Ng\xE0y" th\xEC s\u1EBD t\u1EF1 t\u1EA3i \u0111\xFAng th\xE1ng trong file.')),React.createElement("div",{className:"col-12 col-md-5 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",disabled:Wt,onClick:()=>{Ta(""),Yt(""),$a(null),wa(""),ze("\u0110\xE3 reset \u0111\u1ED1i so\xE1t","info")}},React.createElement("i",{className:"fas fa-rotate-left me-2"}),"Reset"))),ua&&React.createElement("div",{className:"mt-2 small text-muted"},ua),Ft&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0"},Ft),lt&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:`alert ${lt.ok?"alert-success":"alert-warning"} mb-3`},lt.ok?React.createElement("div",{className:"fw-semibold"},"OK \u2014 File Excel \u0111\xE3 kh\u1EDBp \u0111\u1EA7y \u0111\u1EE7 v\u1EDBi h\u1EC7 th\u1ED1ng."):React.createElement("div",{className:"fw-semibold"},"CH\u01AFA KH\u1EDAP \u2014 C\xF3 thi\u1EBFu/sai l\u1EC7ch so v\u1EDBi h\u1EC7 th\u1ED1ng."),React.createElement("div",{className:"small mt-1"},"Th\xE1ng \u0111\u1ED1i so\xE1t: ",Array.isArray(lt.monthKeys)?lt.monthKeys.join(", "):""," \xB7 Excel: ",lt.excelCount," d\xF2ng",Number(lt.excelGroupCount||0)?` (${lt.excelGroupCount} c\u1EE5m)`:""," \xB7 H\u1EC7 th\u1ED1ng: ",lt.systemCount," \u0111\u01A1n")),!lt.ok&&React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-12"},Array.isArray(lt.amountMismatch)&&lt.amountMismatch.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-danger"},"Sai l\u1EC7ch s\u1ED1 ti\u1EC1n (t\xECm theo t\xEAn s\u1EA3n ph\u1EA9m)"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m (Excel)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (Excel)"),React.createElement("th",null,"Order ID"),React.createElement("th",null,"T\xEAn SP (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"L\u1EC7ch"))),React.createElement("tbody",null,lt.amountMismatch.slice(0,30).map(r=>{var b,K,ee,V,X,T,Y;return React.createElement("tr",{key:`mm-${String(((b=r==null?void 0:r.group)==null?void 0:b.key)||((K=r==null?void 0:r.order)==null?void 0:K.id)||Math.random())}`,className:"table-danger"},React.createElement("td",null,((ee=r==null?void 0:r.group)==null?void 0:ee.rowIndexFirst)||"\u2014",Number(((V=r==null?void 0:r.group)==null?void 0:V.rowCount)||0)>1?` (+${Number(r.group.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},((X=r==null?void 0:r.group)==null?void 0:X.phone)||"\u2014"),React.createElement("td",{style:{minWidth:260}},((T=r==null?void 0:r.group)==null?void 0:T.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number(((Y=r==null?void 0:r.group)==null?void 0:Y.cod)||0))),React.createElement("td",{className:"text-muted"},r.order.id),React.createElement("td",{style:{minWidth:240}},r.order.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(r.order.cod)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(r.diff)))})))),lt.amountMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",lt.amountMismatch.length," d\xF2ng."))),Array.isArray(lt.systemOnly)&&lt.systemOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong h\u1EC7 th\u1ED1ng nh\u01B0ng thi\u1EBFu trong Excel"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y t\u1EA1o"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,lt.systemOnly.slice(0,30).map(r=>React.createElement("tr",{key:`so-${r.id}`,className:"table-warning"},React.createElement("td",{className:"text-muted"},r.id),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(r.created_at)),React.createElement("td",{className:"text-muted"},r.phone||"\u2014"),React.createElement("td",{style:{minWidth:280}},r.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(r.cod)),React.createElement("td",{className:"text-muted"},r.status)))))),lt.systemOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",lt.systemOnly.length," \u0111\u01A1n."))),Array.isArray(lt.excelOnly)&&lt.excelOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong Excel nh\u01B0ng kh\xF4ng th\u1EA5y \u0111\u01A1n kh\u1EDBp trong h\u1EC7 th\u1ED1ng"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"))),React.createElement("tbody",null,lt.excelOnly.slice(0,30).map(r=>React.createElement("tr",{key:`eo-${String((r==null?void 0:r.key)||(r==null?void 0:r.rowIndexFirst)||Math.random())}`,className:"table-warning"},React.createElement("td",null,(r==null?void 0:r.rowIndexFirst)||"\u2014",Number((r==null?void 0:r.rowCount)||0)>1?` (+${Number(r.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},String((r==null?void 0:r.dateRaw)||"")),React.createElement("td",{className:"text-muted"},(r==null?void 0:r.phone)||"\u2014"),React.createElement("td",{style:{minWidth:280}},(r==null?void 0:r.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number((r==null?void 0:r.cod)||0)))))))),lt.excelOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",lt.excelOnly.length," d\xF2ng.")))))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ue(qe.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ot(qe.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ot(qe.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ot(qe.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ot(qe.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",qe.avgQtyPerOrder?qe.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},Ue(qe.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},Ue(qe.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},Ue(qe.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},Ue(qe.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},Ue(qe.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},Ue(qe.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},Ue(qe.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,Ue(qe.statusCounts.draft)),React.createElement("td",null,Ue(qe.statusCounts.pending)),React.createElement("td",null,Ue(qe.statusCounts.processing)),React.createElement("td",null,Ue(qe.statusCounts.canceled)),React.createElement("td",null,Ue(qe.statusCounts.done)),React.createElement("td",null,Ue(qe.statusCounts.paid)),React.createElement("td",null,Ue(qe.statusCounts.other)),React.createElement("td",null,Ue(qe.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},qe.products.slice(0,10).map(r=>React.createElement("div",{key:r.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},r.product_name),React.createElement("div",{className:"text-muted small text-truncate"},r.product_code?`#${r.product_code} \u2022 `:"",Ue(r.orders)," \u0111\u01A1n \u2022 ",Ue(r.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ot(r.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,qe.products.slice(0,10).map(r=>React.createElement("tr",{key:r.product_id},React.createElement("td",null,r.product_name),React.createElement("td",null,r.product_code||"\u2014"),React.createElement("td",null,Ue(r.orders)),React.createElement("td",null,Ue(r.quantity)),React.createElement("td",{className:"fw-semibold"},Ot(r.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},qe.customers.slice(0,10).map(r=>React.createElement("div",{key:r.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},r.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},r.phone||"\u2014"," \u2022 ",Ue(r.orders)," \u0111\u01A1n \u2022 ",Ue(r.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ot(r.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,qe.customers.slice(0,10).map(r=>React.createElement("tr",{key:r.key},React.createElement("td",null,r.customer_name||"\u2014"),React.createElement("td",null,r.phone||"\u2014"),React.createElement("td",null,Ue(r.orders)),React.createElement("td",null,Ue(r.quantity)),React.createElement("td",{className:"fw-semibold"},Ot(r.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},qe.days.map(r=>React.createElement("div",{key:r.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},r.day),React.createElement("div",{className:"text-muted small"},Ue(r.orders)," \u0111\u01A1n \u2022 ",Ue(r.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",Ue(r.doneOrders)," \u2022 ",Ot(r.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Ot(r.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,qe.days.map(r=>React.createElement("tr",{key:r.day},React.createElement("td",null,r.day),React.createElement("td",null,Ue(r.orders)),React.createElement("td",null,Ue(r.quantity)),React.createElement("td",{className:"fw-semibold"},Ot(r.revenue)),React.createElement("td",null,Ue(r.doneOrders)),React.createElement("td",{className:"fw-semibold"},Ot(r.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:q,onMenuChange:c=>{Re(c),Se(c),c==="albums"&&(xe(null),Le([]),ot(null))},onLogout:fe,currentUser:W,pinnedMenus:Ce,recentMenus:Oe,onTogglePin:rt}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const E={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[q]||{title:"KTM Admin",icon:"fa-tractor",sub:""},J=(W==null?void 0:W.username)||(W==null?void 0:W.name)||(W==null?void 0:W.email)||"Admin",we=(()=>{if(q!=="albums")return"";const ke=[];return ke.push("Root"),Array.isArray(be)&&be.length>0&&ke.push(...be.map(je=>je==null?void 0:je.title).filter(Boolean)),pt!=null&&pt.title&&ke.push(pt.title),ke.length>0?ke.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${E.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},E.title),React.createElement("div",{className:"admin-page-subtitle"},we||E.sub))),React.createElement("div",{className:"admin-topbar-right"},q==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:Kt,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:J},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},J)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:fe,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},q==="albums"&&!pt&&React.createElement(AlbumList,{albums:P,loading:xt,currentFolder:me,breadcrumb:be,onSelect:Jt,onCreate:Kt,onEdit:$t,onDelete:U,onBack:k}),q==="search"&&React.createElement(SearchCenter,{showToast:ze,onNavigate:(c,E,J)=>{Se(c),c==="orders"&&E==="create"&&(Me(Date.now()),Te((J==null?void 0:J.productId)||""))}}),q==="albums"&&pt&&React.createElement(AlbumDetail,{album:pt,parentAlbum:be.length>0?be[be.length-1]:null,onBack:()=>{if(pt.parentId){const c=be.findIndex(E=>E.uuid===pt.parentId);c>=0?it(be[c]):it(null)}else it(null)},onRefresh:()=>ot(me==null?void 0:me.uuid),showToast:ze,onNavigateToFolder:c=>{Le(E=>[...E,pt]),it(c)},onEditSubfolder:c=>{Ze(c),He(!0)}}),q==="videos"&&React.createElement(VideoList,{showToast:ze}),q==="products"&&React.createElement(ProductManager,{showToast:ze,settings:j}),q==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:Ae,autoOpenCreateProductId:Ge,showToast:ze}),q==="stats"&&React.createElement(I,null),q==="settings"&&React.createElement(It,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${q==="search"?"active":""}`,onClick:c=>{c.preventDefault(),Se("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${q==="albums"?"active":""}`,onClick:c=>{c.preventDefault(),Se("albums"),it(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${q==="videos"?"active":""}`,onClick:c=>{c.preventDefault(),Se("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${q==="products"?"active":""}`,onClick:c=>{c.preventDefault(),Se("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${q==="orders"?"active":""}`,onClick:c=>{c.preventDefault(),Se("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${q==="stats"?"active":""}`,onClick:c=>{c.preventDefault(),Se("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:$e,album:ye,parentId:me==null?void 0:me.uuid,onClose:()=>He(!1),onSave:aa}),React.createElement(AdminDrawer,{open:Tt,title:N?N.title:"Album",subtitle:N?`${N.subfolderCount||0} subfolder \u2022 ${N.count||0} \u1EA3nh`:"",onClose:yt,footer:le?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{de(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{N&&(Ze(N),aa({slug:N.id||"",title:N.title||"",description:N.description||"",cover_url:N.cover||"",parent_id:N.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):N?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(N.title),ze("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>Gt(N)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{N&&confirm(`X\xF3a folder "${N.title}"?`)&&(U(N),yt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},le&&N?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:N.title,onChange:c=>D({...N,title:c.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:N.description,onChange:c=>D({...N,description:c.target.value})}))):N?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},N.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},N.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},N.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},N.count||0))),N.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,N.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Ke.map(c=>React.createElement(Toast,{key:c.id,message:c.message,type:c.type,actionLabel:c.actionLabel,onAction:c.onAction,durationMs:c.durationMs,onClose:()=>Mt(c.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:_,autoOpenCreateProductId:M,showToast:L}){const[oe,W]=useState([]),[F,q]=useState(0),[Se,Ce]=useState(!1),[pe,Oe]=useState(!1),[Je,Ae]=useState([]),[Me,Ge]=useState(!0),[Te,P]=useState(!1),[Qe,pt]=useState([]),[it,$e]=useState(!1),[He,ye]=useState(""),[Ze,xt]=useState([]),[jt,Ke]=useState(!1),[ht,Tt]=useState(""),[w,N]=useState(!1),[D,le]=useState(null),[de,Z]=useState(null),[ie,Ne]=useState(!1),[y,j]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[z,me]=useState(""),[xe,be]=useState(!1),[Le,Re]=useState(!1),[rt,vt]=useState(!1),[fe,ze]=useState(null),[Mt,ot]=useState(!1),[Kt,$t]=useState(""),[aa,Jt]=useState(!1),k=useRef(0),[U,We]=useState(!1),[yt,Gt]=useState(null),[St,It]=useState(!1),[I,c]=useState(null),[E,J]=useState(()=>({left:12,top:12,placement:"bottom"})),we=useRef(null),ke=useRef(!1),je=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1}),[et,Pe]=useState(()=>({id:null,dir:null})),Vt=useRef(!1),kt=useRef(new Map),Dt=useRef(null),Wt=useRef(null),Ht="ktm_orders_status_sync_queue_v1",Ft=useRef([]),Ta=useRef(!1),[ua,Yt]=useState(()=>({})),[na,wa]=useState(!1),[lt,$a]=useState(!1),[pa,Qt]=useState(!1),[xa,Lt]=useState(()=>new Set),[qe,Ra]=useState(()=>({})),Pa="ktm_orders_pinned_v1",[Et,Ue]=useState(()=>new Set),[Ot,ra]=useState(!1),[ha,Rt]=useState(!1),[Ct,fa]=useState(!1),[Zt,sa]=useState(""),[Ia,ea]=useState(()=>[]),oa=useRef(null),Nt=useRef(null),ba=useRef(!1),zt=useRef({active:!1,startY:0,startX:0,fired:!1}),[Bt,Ea]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),Ga=24,Oa=20,[_a,Wa]=useState(Ga),Ka=useRef(null),ga=useRef(null),Sa=useRef(!1),va=useRef(new Map),Ua=useRef({timer:null,events:[]}),s=useRef(null),u="ktm_orders_phone_tip_v1",m="ktm_orders_search_history_v1",[$,H]=useState(null),[A,v]=useState(!1),[ne,ve]=useState([]),[se,ce]=useState(!1),[Ee,Ye]=useState([]),[f,r]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[b,K]=useState([""]),[ee,V]=useState(null),X=useRef({}),[T,Y]=useState([]),[ge,_e]=useState(null),nt=useRef(null),dt=useRef(null),O=useRef(0),B=useRef(null),G=useRef(0),ue=useRef(new Map),re=useRef(null),x=useRef(0),Q=useRef(new Map),R=useRef(new Map),he=useRef(""),De=useRef(null),Ie=useRef(null),Ve=useRef(0),at=useRef(null),mt=9,bt=150,ta=250,ia=3*60*1e3,Xt=24*60*60*1e3,wt=5*60*1e3,Pt="ktm_customer_lookup_cache_v1",la=200,ca=3,Fa=3,Rn=1,Os=24*60*60*1e3,js=120,Ds=5*60*1e3,Yn=80,Qn=2,Zn=4,es=60,Fe=React.useMemo(()=>String(He||"").trim().length>0,[He]),on=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),ts=e=>{Gt(e),We(!0)},as=(e,a)=>{var t,n,i,o;try{const p=(t=a==null?void 0:a.getBoundingClientRect)==null?void 0:t.call(a),d=window.innerWidth||360,S=window.innerHeight||640,h=230,l=280,g=Math.min(Math.max(10,Math.round((n=p==null?void 0:p.left)!=null?n:10)),Math.max(10,d-h-10));let C=Math.round(((i=p==null?void 0:p.bottom)!=null?i:10)+8),te="bottom";C+l>S-10&&(C=Math.max(10,Math.round(((o=p==null?void 0:p.top)!=null?o:10)-8-l)),te="top"),J({left:g,top:C,placement:te})}catch(p){J({left:12,top:12,placement:"bottom"})}c(e),It(!0)},Ha=()=>{It(!1),setTimeout(()=>c(null),120)};useEffect(()=>{if(!St)return;const e=a=>{a.key==="Escape"&&Ha()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[St]);const Ba=()=>{We(!1),setTimeout(()=>Gt(null),180)},Ls=()=>{wa(!0)},bn=()=>{wa(!1)},ns=e=>{const a=String(e||"").trim();a&&Lt(t=>{const n=new Set(t);return n.has(a)?n.delete(a):n.add(a),n})};useEffect(()=>{try{const e=localStorage.getItem(Pa);if(!e)return;const a=JSON.parse(e);if(!Array.isArray(a))return;Ue(new Set(a.map(t=>String(t||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from(Et||[]).map(a=>String(a||"").trim()).filter(Boolean);localStorage.setItem(Pa,JSON.stringify(e))}catch(e){}},[Et]);const Rs=e=>{const a=String(e||"").trim();a&&Ue(t=>{const n=new Set(t);return n.has(a)?n.delete(a):n.add(a),n})};useEffect(()=>{try{const e=localStorage.getItem(m);if(!e)return;const a=JSON.parse(e);if(!Array.isArray(a))return;ea(a.map(t=>String(t||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Ps=e=>{try{localStorage.setItem(m,JSON.stringify(e))}catch(a){}},ln=e=>{const a=String(e||"").trim();a&&ea(t=>{const n=Array.isArray(t)?t:[],i=[a,...n.filter(o=>String(o||"").trim().toLowerCase()!==a.toLowerCase())].slice(0,10);return Ps(i),i})},ss=e=>{var t;const a=String((t=e!=null?e:He)!=null?t:"").trim();sa(a),fa(!0),setTimeout(()=>{var n,i;try{(i=(n=oa.current)==null?void 0:n.focus)==null||i.call(n)}catch(o){}},0)},ya=()=>{fa(!1)};useEffect(()=>{if(!Ct)return;const e=a=>{a.key==="Escape"&&ya()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Ct]),useEffect(()=>{if(!Bt)return;const e=n=>{if(Ct||(window.scrollY||0)>6)return;const i=n.touches&&n.touches[0];i&&(zt.current={active:!0,startY:i.clientY,startX:i.clientX,fired:!1})},a=n=>{const i=zt.current;if(!(i!=null&&i.active)||i.fired||(window.scrollY||0)>6)return;const o=n.touches&&n.touches[0];if(!o)return;const p=o.clientY-i.startY,d=o.clientX-i.startX;Math.abs(d)>24||p>92&&(i.fired=!0,ss(He))},t=()=>{zt.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",a,{passive:!0}),window.addEventListener("touchend",t,{passive:!0}),window.addEventListener("touchcancel",t,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)}},[Bt,Ct,He]);const is=e=>{try{const a=qt(e==null?void 0:e.status);if(!(a==="pending"||a==="processing"))return!1;const t=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(t.getTime()))return!1;const n=new Date;return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate()}catch(a){return!1}};useEffect(()=>{var t;let e;const a=()=>{try{Ea(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(n){Ea(!1)}};try{e=(t=window.matchMedia)==null?void 0:t.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",a):e!=null&&e.addListener&&e.addListener(a)}catch(n){e=null}return window.addEventListener("resize",a),a(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",a):e!=null&&e.removeListener&&e.removeListener(a)}catch(n){}window.removeEventListener("resize",a)}},[]),useEffect(()=>{const e="admin-sheet-open";return U||na||St?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[U,na,St]),useEffect(()=>{if(!U&&!na&&!St)return;const e=a=>{a.key==="Escape"&&(U&&Ba(),na&&bn(),St&&Ha())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[U,na,St]);const Es=()=>{try{if(localStorage.getItem(u))return;localStorage.setItem(u,"1"),typeof L=="function"&&L("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},rs=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),os=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),ls=e=>{const a=gt(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{window.location.href=`tel:${a}`}catch(t){}},Ks=async e=>{var t,n,i;const a=gt(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{await((i=(n=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:n.call(t,a))!=null?i:Promise.reject(new Error("Clipboard not available"))),typeof L=="function"&&L("\u0110\xE3 copy S\u0110T","success")}catch(o){typeof L=="function"&&L("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Fs=()=>{try{const e=localStorage.getItem(Ht),a=e?JSON.parse(e):[];return Array.isArray(a)?a:[]}catch(e){return[]}},cs=e=>{try{localStorage.setItem(Ht,JSON.stringify(Array.isArray(e)?e:[]))}catch(a){}},gn=(e,a)=>{const t=String(e||"").trim();t&&Yt(n=>{const i={...n||{}};return a?i[t]=!0:delete i[t],i})},Hs=(e,a,t)=>{const n=String(e||"").trim(),i=qt(a),o=qt(t);if(!n||!i)return;const p=Array.isArray(Ft.current)?Ft.current:[],d=new Map(p.map(h=>[String((h==null?void 0:h.orderId)||""),h]));d.set(n,{orderId:n,nextStatus:i,prevStatus:o,ts:Date.now()});const S=Array.from(d.values()).sort((h,l)=>(Number(h.ts)||0)-(Number(l.ts)||0));Ft.current=S,cs(S),gn(n,!0)},Pn=async()=>{if(Ta.current||!navigator.onLine)return;const e=Array.isArray(Ft.current)?Ft.current.slice():[];if(e.length){Ta.current=!0;try{for(const a of e){const t=String((a==null?void 0:a.orderId)||"").trim(),n=qt(a==null?void 0:a.nextStatus);if(!(!t||!n)){gn(t,!0);try{await Xa({id:t,status:(a==null?void 0:a.prevStatus)||""},n,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const i=(Array.isArray(Ft.current)?Ft.current:[]).filter(o=>String((o==null?void 0:o.orderId)||"")!==t);Ft.current=i,cs(i),gn(t,!1)}catch(i){if(!navigator.onLine)break}}}}finally{Ta.current=!1}}};useEffect(()=>{const e=Fs();Ft.current=e;try{const a={};for(const t of e){const n=String((t==null?void 0:t.orderId)||"").trim();n&&(a[n]=!0)}Yt(a)}catch(a){}setTimeout(()=>Pn(),600)},[]),useEffect(()=>{const e=()=>Pn();window.addEventListener("online",e);const a=setInterval(()=>Pn(),8e3);return()=>{clearInterval(a),window.removeEventListener("online",e)}},[]);const Bs=(e,a)=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e),Sa.current=!1,Es();try{ga.current&&clearTimeout(ga.current)}catch(n){}ga.current=setTimeout(()=>{Sa.current=!0,Ks(a)},520)},vn=e=>{var a;(a=e==null?void 0:e.stopPropagation)==null||a.call(e);try{ga.current&&clearTimeout(ga.current)}catch(t){}ga.current=null},qs=e=>{const a=String(e||"").trim();if(!a)return;Ra(i=>({...i,[a]:Date.now()}));const t=va.current;try{const i=t.get(a);i&&clearTimeout(i)}catch(i){}const n=setTimeout(()=>{Ra(i=>{const o={...i||{}};return delete o[a],o});try{t.delete(a)}catch(i){}},9e3);t.set(a,n)},ds=e=>String(e||"").replace(/\s+/g," ").trim(),Vs=e=>String(e||"").replace(/[^0-9]+/g,""),cn=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/Os)}catch(a){return 0}},yn=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:cn(e)>=ca,qt=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},En=React.useMemo(()=>["draft","pending","processing","done","paid"],[]),Ya=(e,a)=>{const t=qt(e);if(!t||t==="canceled")return null;const n=En.indexOf(t);return n<0?null:a==="left"?En[n+1]||null:a==="right"&&En[n-1]||null},ms=e=>{var i;const a=qt(e);if(!a)return{label:"",icon:"fa-circle"};const t=((i=on.find(o=>qt(o==null?void 0:o.value)===a))==null?void 0:i.label)||"",n=(()=>{switch(a){case"draft":return"fa-file-lines";case"pending":return"fa-hourglass-half";case"processing":return"fa-truck";case"done":return"fa-check";case"paid":return"fa-money-bill-wave";case"canceled":return"fa-ban";default:return"fa-circle"}})();return{label:t,icon:n}},Nn=e=>{if(qt(e==null?void 0:e.status)!=="draft")return null;const t=Fa-cn(e);return Number.isFinite(t)?t:null},wn=e=>{const a=Nn(e);return Number.isFinite(a)?a>0&&a<=Rn:!1},qa=e=>{r({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),K([""]),H(null),V(null)};useEffect(()=>{const e=a=>{var n;if(ee==null)return;const t=(n=X.current)==null?void 0:n[ee];t&&!t.contains(a.target)&&V(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ee]);const us=e=>window.KTM.money.parseMoney(e),ps=e=>window.KTM.money.parseSignedMoney(e),ut=e=>window.KTM.money.formatVND(e),ka=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var i,o;return{amount:String((i=n==null?void 0:n.amount)!=null?i:""),note:String((o=n==null?void 0:n.note)!=null?o:"")}});return t.length?t:[{amount:"",note:""}]},zs=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var i,o;return{amount:(n==null?void 0:n.amount)===0?"":String((i=n==null?void 0:n.amount)!=null?i:""),note:String((o=n==null?void 0:n.note)!=null?o:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},Qa=e=>(Array.isArray(e)?e:[]).map(t=>({amount:ps(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),Kn=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Qa(a),n=Za(t),i=(()=>{if(!t.length)return"";const o=t.map(p=>String((p==null?void 0:p.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:i}},Za=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),Fn=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},hi=e=>window.KTM.money.parseShipFeeFromNote(e),en=e=>window.KTM.phone.isValid(e),gt=e=>window.KTM.phone.normalize(e),Hn=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},Xs=(e,a)=>{var o;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const i=new Map(t.map(p=>{var d;return[String((d=p==null?void 0:p.id)!=null?d:""),p]}));for(const p of n){const d=String((o=p==null?void 0:p.id)!=null?o:"");d&&i.set(d,p)}return Array.from(i.values())},xn=async e=>{var a,t,n,i;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const o=(t=(a=kt.current)==null?void 0:a.get)==null?void 0:t.call(a,String(e.id));if(o&&typeof o=="object"&&Array.isArray(o.items)&&o.items.length)return o}catch(o){}try{const o=await Hn(e.id);if(o&&typeof o=="object"){try{(i=(n=kt.current)==null?void 0:n.set)==null||i.call(n,String(e.id),o)}catch(p){}return W(p=>Array.isArray(p)?p.map(d=>String(d==null?void 0:d.id)===String(e.id)?o:d):p),o}}catch(o){console.error("Fetch order by id error:",o)}return e},Js=()=>{var e;try{const a=localStorage.getItem(Pt);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[i,o]of n)!i||!o||typeof o!="object"||(e=R.current)==null||e.set(String(i),o)}catch(a){}},Bn=()=>{try{const e=R.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,i])=>n&&i&&typeof i=="object"&&Number.isFinite(i.ts)).sort((n,i)=>(Number(i[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,la),t={};for(const[n,i]of a)t[n]=i;localStorage.setItem(Pt,JSON.stringify(t))}catch(e){}};useEffect(()=>{Js()},[]);const hs=e=>{const a=gt(e);if(!a)return null;const t=Array.isArray(oe)?oe:[];let n=null,i=-1;for(const o of t){if(!o||gt(o.phone||"")!==a)continue;const p=new Date(o.created_at).getTime(),d=Number.isFinite(p)?p:0;d>=i&&(i=d,n=o)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},fs=(e,a)=>{e&&r(t=>a&&gt(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Gs=e=>{const a=hs(e);if(!a)return;const t=gt(e);r(n=>{if(t&&gt(n.phone)!==t)return n;const i={...n};return!String(n.customer_name||"").trim()&&a.name&&(i.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(i.address=a.address),i})},Ws=(e,a,t)=>{var n;try{const i=gt(e);if(!i)return;const o=String(a||"").trim(),p=String(t||"").trim();if(!o&&!p)return;(n=R.current)==null||n.set(i,{ts:Date.now(),status:"found",customer:{phone:i,name:o||null,address:p||null}}),Bn()}catch(i){}},Sn=async e=>{var i,o,p;const a=gt(e);if(!a)return;Gs(a);const t=(i=R.current)==null?void 0:i.get(a);if(t&&Number.isFinite(t.ts)){const d=Date.now()-t.ts,S=t.status==="found"?Xt:wt;if(d>=0&&d<=S){H({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&fs(t.customer,a);return}}const n=++O.current;H({status:"loading",phone:a});try{const d=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(O.current!==n)return;if(d&&d.exists&&d.customer){(o=R.current)==null||o.set(a,{ts:Date.now(),status:"found",customer:d.customer}),Bn(),H({status:"found",phone:a,customer:d.customer}),fs(d.customer,a);return}(p=R.current)==null||p.set(a,{ts:Date.now(),status:"not-found",customer:null}),Bn(),H({status:"not-found",phone:a})}catch(d){if(O.current!==n)return;console.error("Customer lookup error:",d),H({status:"error",phone:a})}},bs=e=>{const a=gt(e),t=hs(a);r(i=>{const o={...i,phone:a};return t&&(!String(i.customer_name||"").trim()&&t.name&&(o.customer_name=t.name),!String(i.address||"").trim()&&t.address&&(o.address=t.address)),o}),v(!1),dt.current&&(clearTimeout(dt.current),dt.current=null);const n=a;if(n.length<mt){H(null);return}if(en(n)&&n!==he.current){he.current=n,Sn(n);return}dt.current=setTimeout(()=>{const i=gt(a);en(i)&&i!==he.current&&(he.current=i,Sn(i))},bt)},gs=()=>{const e=gt(f.phone);e.length<mt||en(e)&&e!==he.current&&(he.current=e,Sn(e))};useEffect(()=>(Le?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Le]);const kn=Array.isArray(f.items)?f.items.length:0;useEffect(()=>{if(!Le){Ve.current=kn;return}kn>Ve.current&&setTimeout(()=>{const e=De.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Ve.current=kn},[Le,kn]),useEffect(()=>()=>{dt.current&&(clearTimeout(dt.current),dt.current=null),B.current&&(clearTimeout(B.current),B.current=null)},[]),useEffect(()=>{if(!Le)return;B.current&&(clearTimeout(B.current),B.current=null);const e=gt((f==null?void 0:f.phone)||"");if(!en(e)){ve([]),ce(!1);return}return B.current=setTimeout(async()=>{var i;const a=String(e),t=(i=ue.current)==null?void 0:i.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=ia){ve(Array.isArray(t.orders)?t.orders:[]),ce(!1);return}const n=++G.current;ce(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,p=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(G.current!==n)return;const d=Array.isArray(p)?p:Array.isArray(p==null?void 0:p.orders)?p.orders:[];ve(d);try{const S=ue.current;if(S&&typeof S.set=="function"&&(S.set(a,{ts:Date.now(),orders:d}),S.size>100)){const h=Array.from(S.entries()).sort((g,C)=>{var te,ae;return(Number((te=g==null?void 0:g[1])==null?void 0:te.ts)||0)-(Number((ae=C==null?void 0:C[1])==null?void 0:ae.ts)||0)}),l=Math.max(0,h.length-100);for(let g=0;g<l;g++)S.delete(h[g][0])}}catch(S){}}catch(o){if(G.current!==n)return;console.error("Phone history fetch error:",o),ve([])}finally{if(G.current!==n)return;ce(!1)}},ta),()=>{B.current&&(clearTimeout(B.current),B.current=null)}},[Le,f==null?void 0:f.phone]),useEffect(()=>{Qs()},[]),useEffect(()=>{Fe||Va()},[y,Fe]),useEffect(()=>{Tn()},[]),useEffect(()=>{_&&nt.current!==_&&(nt.current=_,_n(M))},[_]);const Na=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",tn=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",ja=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(oe),a=Et;if(!a||!(a instanceof Set)||a.size===0)return e;const t=Array.isArray(e)?e.slice():[];return t.sort((n,i)=>{var d,S;const o=a.has(String((d=n==null?void 0:n.id)!=null?d:""))?1:0;return(a.has(String((S=i==null?void 0:i.id)!=null?S:""))?1:0)-o}),t},[oe,Et]),qn=React.useMemo(()=>window.KTM.orders.sortOrders(Je),[Je]),Cn=React.useMemo(()=>{const a=(Array.isArray(qn)?qn:[]).filter(t=>yn(t));return a.sort((t,n)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),a},[qn]),vs=React.useMemo(()=>{const a=(Array.isArray(Qe)?Qe:[]).filter(t=>wn(t));return a.sort((t,n)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),a},[Qe]),dn=React.useMemo(()=>{if(xe)return Cn;let e=ja;if(Ot){const a=Et;e=(Array.isArray(e)?e:[]).filter(t=>{var n,i;return(i=a==null?void 0:a.has)==null?void 0:i.call(a,String((n=t==null?void 0:t.id)!=null?n:""))})}return ha&&(e=(Array.isArray(e)?e:[]).filter(a=>is(a))),e},[xe,Cn,ja,Ot,Et,ha]),An=React.useMemo(()=>{if(xe)return dn;const e=String(z||"").trim();return e?(Array.isArray(dn)?dn:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):dn},[dn,z,xe]),ys=React.useMemo(()=>window.KTM.orders.sortOrders(Ze),[Ze]),_t=React.useMemo(()=>Fe?ys:An,[An,Fe,ys]),Ns=React.useMemo(()=>{const e=Array.isArray(_t)?_t:[];return Bt?e.slice(0,Math.max(0,Number(_a)||0)):e},[Bt,_a,_t]);useEffect(()=>{Bt&&Wa(Ga)},[Bt,z,xe,y,He]),useEffect(()=>{if(!Bt)return;const e=Array.isArray(_t)?_t.length:0;if(_a>=e)return;const a=Ka.current;if(!a)return;const t=new IntersectionObserver(n=>{Array.isArray(n)&&n.some(o=>o==null?void 0:o.isIntersecting)&&Wa(o=>Math.min((Number(o)||0)+Oa,e))},{root:null,rootMargin:"520px 0px",threshold:0});return t.observe(a),()=>t.disconnect()},[Bt,_a,_t]),useEffect(()=>{if(!Bt){$a(!1),Qt(!1);return}const e=()=>{s.current||(s.current=window.requestAnimationFrame(()=>{s.current=null;const a=window.scrollY||document.documentElement.scrollTop||0;$a(a>140),Qt(a>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),s.current&&(window.cancelAnimationFrame(s.current),s.current=null)}},[Bt]),useEffect(()=>{if(!Bt){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(a){}return}const e=()=>{try{const a=document.querySelector(".mobile-bottom-nav"),t=a&&a.offsetHeight?a.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${t}px`)}catch(a){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[Bt]);const Da=React.useMemo(()=>{const e=Array.isArray(_t)?_t:[],a={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const n=qt(t==null?void 0:t.status);n==="draft"?a.draft+=1:n==="pending"?a.pending+=1:n==="processing"?a.processing+=1:n==="done"?a.done+=1:n==="paid"?a.paid+=1:n==="canceled"?a.canceled+=1:a.other+=1}return a},[_t]),Us=React.useMemo(()=>{const e=Et;return!e||e.size===0?0:(Array.isArray(ja)?ja:[]).reduce((a,t)=>{var n;return a+(e.has(String((n=t==null?void 0:t.id)!=null?n:""))?1:0)},0)},[Et,ja]),Ys=React.useMemo(()=>(Array.isArray(ja)?ja:[]).filter(e=>is(e)).length,[ja]),ws=React.useMemo(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`},[]),Ma=e=>{if(Fe&&ye(""),e==="thisMonth"){be(!1),me(""),j(ws);return}if(e==="overduePending"){j(""),be(!0),me("pending");return}if(e==="draftExpiring"){be(!1),me("draft"),j(""),Tn();return}if(e==="all"){be(!1),me(""),j(ws);return}},an=e=>window.KTM.date.formatDateTime(e),Qs=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Y(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Y([])}},Va=async()=>{Ge(!0),Oe(!1);try{const a=new URLSearchParams;y&&a.set("month",String(y)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(es)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),i=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],o=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;W(Array.isArray(i)?i:[]),q(Array.isArray(i)?i.length:0),Ce(!!(o!=null&&o.hasMore)),Tn()}catch(a){console.error("Load orders error:",a),W([]),q(0),Ce(!1)}finally{Ge(!1),Oe(!1)}},Zs=async()=>{if(!(Me||pe||Fe)&&Se){Oe(!0);try{const e=new URLSearchParams;y&&e.set("month",String(y)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(es)),e.set("offset",String(F));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],i=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;W(o=>Xs(o,Array.isArray(n)?n:[])),q(o=>o+(Array.isArray(n)?n.length:0)),Ce(!!(i!=null&&i.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{Oe(!1)}}},xs=async e=>{var i;const a=ds(e);if(!a){xt([]),Tt(""),Ke(!1);return}const t=Vs(a);if(a.length<Qn&&t.length<Zn){xt([]),Tt(`Nh\u1EADp \xEDt nh\u1EA5t ${Qn} k\xFD t\u1EF1 (ho\u1EB7c ${Zn} s\u1ED1) \u0111\u1EC3 search nhanh`),Ke(!1);return}try{const o=(i=Q.current)==null?void 0:i.get(a);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=Ds){xt(Array.isArray(o.results)?o.results:[]),Tt(""),Ke(!1);return}}catch(o){}const n=++x.current;Ke(!0),Tt("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,p=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(x.current!==n)return;const d=Array.isArray(p)?p:[];xt(d);try{const S=Q.current;if(S&&typeof S.set=="function"&&(S.set(a,{ts:Date.now(),results:d}),S.size>Yn)){const h=Array.from(S.entries()).sort((g,C)=>{var te,ae;return(Number((te=g==null?void 0:g[1])==null?void 0:te.ts)||0)-(Number((ae=C==null?void 0:C[1])==null?void 0:ae.ts)||0)}),l=Math.max(0,h.length-Yn);for(let g=0;g<l;g++)S.delete(h[g][0])}}catch(S){}}catch(o){if(x.current!==n)return;console.error("Order search error:",o),xt([]),Tt((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if(x.current!==n)return;Ke(!1)}};useEffect(()=>{re.current&&(clearTimeout(re.current),re.current=null);const e=ds(He);if(!e){xt([]),Tt(""),Ke(!1);return}return xe&&be(!1),re.current=setTimeout(()=>{xs(e)},js),()=>{re.current&&(clearTimeout(re.current),re.current=null)}},[He]);const Tn=async()=>{P(!0),$e(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(ca)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Rn)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);Ae(Array.isArray(e)?e:[]),pt(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),Ae([]),pt([])}finally{P(!1),$e(!1)}},Vn=async e=>{const a=await xn(e);if(!a)return;_e(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(d=>{var S,h,l,g;return{product_id:(d==null?void 0:d.product_id)||"",quantity:Number((S=d==null?void 0:d.quantity)!=null?S:1)||1,unit_price:(()=>{var ae;const C=(ae=d==null?void 0:d.unit_price)!=null?ae:d==null?void 0:d.unitPrice,te=C==null||C===""?NaN:Number(C);return Number.isFinite(te)?Math.trunc(te):null})(),variant:String((h=d==null?void 0:d.variant)!=null?h:"").trim(),variant_json:(g=(l=d==null?void 0:d.variant_json)!=null?l:d==null?void 0:d.variantJson)!=null?g:null}}).filter(d=>d.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=zs(a),i=Qa(n),o=Za(i),p=Fn(i);r({customer_name:a.customer_name||"",phone:gt(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:o,adjustment_note:p||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),K(new Array(t.length?t.length:1).fill("")),Ye(new Array(t.length?t.length:1).fill(!0)),H(null),Re(!1),ze(a),vt(!0),$t(""),ot(!1),Jt(!0),a.phone&&Sn(gt(a.phone))},mn=async e=>{if(!e)return;vt(!0),$t(""),ot(!0),Jt(!1),ze(e);const a=++k.current;try{const t=await xn(e);if(k.current!==a)return;ze(t||e)}catch(t){if(k.current!==a)return;$t((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(k.current!==a)return;ot(!1)}},ei=()=>{w||ie||(vt(!1),ot(!1),$t(""),Jt(!1),_e(null),qa(""),v(!1),Ye([]))};function _n(e){vt(!1),Jt(!1),ot(!1),$t(""),_e(null),qa(e||""),v(!1),Ye([]),Re(!0)}const zn=()=>{w||ie||(Re(!1),_e(null),qa(""),v(!1),Ye([]))},Ss=async()=>{var d,S,h;if(!ge||ie||w)return;const e=(Array.isArray(oe)?oe:[]).find(l=>String(l==null?void 0:l.id)===String(ge))||null,a=String((e==null?void 0:e.status)||(f==null?void 0:f.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const l="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof L=="function"?L(l,"warning"):alert(l);return}const t=gt(f.phone),i=(Array.isArray(f.items)?f.items:[]).map((l,g)=>{var C,te;return{idx:g,product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((C=l==null?void 0:l.quantity)!=null?C:0),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(te=l==null?void 0:l.variant_json)!=null?te:null,unit_price:(()=>{const ae=l==null?void 0:l.unit_price,Xe=ae===""||ae==null?NaN:Number(ae);if(Number.isFinite(Xe))return Math.max(0,Math.trunc(Xe));const Be=da(l==null?void 0:l.product_id),At=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return nn(Be,At)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);if(i.length<2){const l="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof L=="function"?L(l,"warning"):alert(l);return}const o=[],p=[];for(const l of i){const g=!!Ee[l.idx],C={product_id:l.product_id,quantity:l.quantity,unit_price:l.unit_price,variant:l.variant,variant_json:l.variant_json};g?o.push(C):p.push(C)}if(!o.length||!p.length){const l="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof L=="function"?L(l,"warning"):alert(l);return}Ne(!0);try{const l=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],g=Qa(l),C=Za(g),te=Fn(g),ae={customer_name:f.customer_name,phone:t,address:f.address,note:(f.note||"").trim(),adjustment_amount:C,adjustment_note:te,adjustment_items:g,status:"processing",items:o,product_id:o[0].product_id,quantity:o[0].quantity,split_seq:1},Xe=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,ae,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),Be=(h=(S=Xe==null?void 0:Xe.id)!=null?S:(d=Xe==null?void 0:Xe.order)==null?void 0:d.id)!=null?h:null;if(!Be)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const At={id:ge,customer_name:f.customer_name,phone:t,address:f.address,note:(f.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:p,product_id:p[0].product_id,quantity:p[0].quantity,parent_order_id:String(Be),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${ge}`,At,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),zn(),Va();const tt=Be?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${Be}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof L=="function"?L(tt,"success"):alert(tt)}catch(l){console.error(l);const g=(l==null?void 0:l.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof L=="function"?L(g,"danger"):alert(g)}finally{Ne(!1)}},ks=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=T.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Ca=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},ti=e=>{const t=Ca(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},Cs=React.useMemo(()=>(Array.isArray(T)?T:[]).map((e,a)=>{var h,l,g,C,te,ae;const t=Ca((h=e==null?void 0:e.name)!=null?h:""),n=Ca((l=e==null?void 0:e.code)!=null?l:""),i=Ca((g=e==null?void 0:e.category)!=null?g:""),o=Ca((C=e==null?void 0:e.note)!=null?C:""),p=Ca((te=e==null?void 0:e.id)!=null?te:""),d=Ca((ae=e==null?void 0:e.stt)!=null?ae:""),S=`${t} ${n} ${i} ${o} ${p} ${d}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:i,note:o,haystackAll:S}}),[T]),ai=(e,a,t)=>{var g,C,te,ae,Xe;const n=Array.isArray(a)?a:[],i=Ca(t).trim();if(!n.length&&!i)return 0;const o=(g=e==null?void 0:e.name)!=null?g:"",p=(C=e==null?void 0:e.code)!=null?C:"",d=(te=e==null?void 0:e.category)!=null?te:"",S=(ae=e==null?void 0:e.note)!=null?ae:"";if(!((Xe=e==null?void 0:e.haystackAll)!=null?Xe:""))return 0;let l=0;i&&(o===i&&(l+=220),o.includes(i)&&(l+=140),o.startsWith(i)&&(l+=160),p&&p===i&&(l+=180),p&&p.includes(i)&&(l+=90));for(const Be of n){if(!Be)continue;const At=new RegExp(`(?:^|\\s)${Be.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(Be)&&(l+=35),At.test(o)&&(l+=25),p&&p.includes(Be)&&(l+=20),p&&At.test(p)&&(l+=10),d&&d.includes(Be)&&(l+=12),S&&S.includes(Be)&&(l+=6)}return l>0&&o&&(l+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),l},Xn=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const i=t.length,o=n.length;if(o>i)return Xn(n,t);let p=new Array(o+1),d=new Array(o+1);for(let S=0;S<=o;S++)p[S]=S;for(let S=1;S<=i;S++){d[0]=S;const h=t.charCodeAt(S-1);for(let g=1;g<=o;g++){const C=h===n.charCodeAt(g-1)?0:1;d[g]=Math.min(p[g]+1,d[g-1]+1,p[g-1]+C)}const l=p;p=d,d=l}return p[o]},ni=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const i=n.split(/\s+/).filter(Boolean);if(!i.length)return!1;const o=t.length<=4?1:2;for(const p of i)if(!(Math.abs(p.length-t.length)>o)&&Xn(t,p)<=o)return!0;return!1},Mn=e=>{const a=Ca(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},si=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=Mn((e==null?void 0:e.name)||""),i=Mn((e==null?void 0:e.code)||""),o=Mn((e==null?void 0:e.category)||""),p=Mn((e==null?void 0:e.note)||""),d=(h,l,g)=>{const C=String(h||"").trim();if(!C||!l.length)return 0;const te=C.length<=4?1:2;let ae=1/0,Xe=-1;for(let tt=0;tt<l.length;tt++){const ma=l[tt];if(!ma||Math.abs(ma.length-C.length)>te)continue;const ft=Xn(C,ma);if(ft<ae&&(ae=ft,Xe=tt,ft===0))break}if(ae===1/0||ae>te)return 0;let At=Math.round(g*(ae===0?1:ae===1?.65:.45));return Xe===0?At+=Math.round(g*.25):Xe===1&&(At+=Math.round(g*.12)),At};let S=0;for(const h of t){if(!h)continue;const l=d(h,n,180),g=d(h,i,120),C=d(h,o,60),te=d(h,p,30);S+=Math.max(l,g,C,te)}if(S>0){const h=((e==null?void 0:e.name)||"").length;S+=Math.max(0,60-Math.min(60,Math.floor(h/2)))}return S},Jn=React.useRef(new Map);React.useEffect(()=>{Jn.current=new Map},[T]);const As=e=>{var h,l;const a=String(b[e]||"").trim();if(!a)return T;const{contentTokens:t,cleanedQuery:n}=ti(a);if(t.length===0)return T;const i=Ca(a).trim(),o=Jn.current.get(i);if(o)return o;const p=[];for(const g of Cs){const C=g.haystackAll;C&&t.some(te=>C.includes(te))&&p.push(g)}let d=p;if(d.length<8&&t.length>0){const g=[],C=new Set(d.map(te=>{var ae,Xe;return String((Xe=(ae=te.p)==null?void 0:ae.id)!=null?Xe:"")+":"+String(te.originalIndex)}));for(const te of Cs){const ae=String((l=(h=te.p)==null?void 0:h.id)!=null?l:"")+":"+String(te.originalIndex);if(C.has(ae))continue;const Xe=te.haystackAll;Xe&&t.some(Be=>ni(Be,Xe))&&(g.push(te),C.add(ae))}g.length&&(d=d.concat(g))}const S=d.map(g=>({entry:g,score:ai(g,t,n)})).map(g=>{if(g.score>0)return g;const C=si(g.entry,t);return C>0?{...g,score:C}:g}).filter(g=>g.score>0).sort((g,C)=>C.score!==g.score?C.score-g.score:g.entry.originalIndex-C.entry.originalIndex).slice(0,40).map(g=>g.entry.p);return Jn.current.set(i,S),S},da=e=>{if(!e)return null;const a=String(e);return T.find(t=>String(t==null?void 0:t.id)===a)||null},La=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var p;if(!t||typeof t!="object")return null;const i=String((p=t.name)!=null?p:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,o=(Array.isArray(t.options)?t.options:[]).map(d=>{var Xe,Be,At,tt,ma,ft,Aa;if(!d||typeof d!="object")return null;const S=String((Xe=d.label)!=null?Xe:"").trim();if(!S)return null;const h=(ma=(tt=(At=(Be=d.price)!=null?Be:d.priceValue)!=null?At:d.unit_price)!=null?tt:d.unitPrice)!=null?ma:null,l=h==null||h===""?NaN:typeof h=="number"?h:typeof h=="string"?us(h):Number(h),g=Number.isFinite(l)?Math.trunc(l):null,C=(Aa=(ft=d.price_delta)!=null?ft:d.priceDelta)!=null?Aa:null,te=Number(C),ae=Number.isFinite(te)?Math.trunc(te):0;return{label:S,price:g,price_delta:ae}}).filter(Boolean);return{name:i,options:o}}).filter(Boolean):[]},fi=e=>{const a=da(e);return La(a==null?void 0:a.variants)},$n=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const i=String(t||"").trim(),o=String(n||"").trim();!i||!o||a.push(`${i}: ${o}`)}return a.join(", ")},nn=(e,a)=>{const t=us(e==null?void 0:e.price),n=La(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let i=t,o=!1;for(const p of n){const d=String((p==null?void 0:p.name)||"").trim(),S=String((a==null?void 0:a[d])||"").trim();if(!d||!S)continue;const h=(Array.isArray(p.options)?p.options:[]).find(ae=>String((ae==null?void 0:ae.label)||"").trim()===S);if(!h)continue;const l=h==null?void 0:h.price,g=l==null||l===""?NaN:Number(l);if(Number.isFinite(g)){i=Math.max(0,Math.trunc(g)),o=!0;continue}const C=h==null?void 0:h.price_delta,te=C==null||C===""?NaN:Number(C);Number.isFinite(te)&&(i+=Math.trunc(te))}return i},Gn=e=>window.KTM.orders.getOrderItems(e),Ts=e=>window.KTM.orders.getOrderTotalQty(e),sn=e=>window.KTM.orders.getOrderProductSummary(e,da),In=e=>window.KTM.orders.getOrderItemRows(e,da),un=e=>window.KTM.orders.getOrderAdjustmentMoney(e),za=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),ii=e=>{const a=Gn(e),t=In(e),n=hn(a),i=pn(a),o=i.fee,p=un(e),d=n+o+p,S=l=>{const g=Number(l)||0;return g>0?`+${ut(g)}`:ut(g)},h=[];if(e!=null&&e.customer_name&&h.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&h.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&h.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&h.push(`GHI CH\xDA: ${(e.note||"").trim()}`),h.push(""),h.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const l of t)h.push(`- ${l.name} (SL: ${l.qty})`);else{const l=sn(e);l&&l!=="\u2014"&&h.push(`- ${l}`)}h.push(""),h.push(`T\u1EA0M T\xCDNH: ${ut(n)}`),i.found&&o!==0&&h.push(`SHIP: ${ut(o)}`);{const l=window.KTM.orders.getOrderAdjustmentItems(e),g=(Array.isArray(l)?l:[]).map(ae=>{var Xe;return{amount:Number((Xe=ae==null?void 0:ae.amount)!=null?Xe:0)||0,note:String((ae==null?void 0:ae.note)||"").trim()}}).filter(ae=>ae.amount!==0||!!ae.note),C=za(e);if(p!==0||g.length>0||!!C)if(g.length===1){const ae=g[0];h.push(`\u0110I\u1EC0U CH\u1EC8NH: ${S(p)}${ae.note?` \u2014 ${ae.note}`:""}`)}else{h.push(`\u0110I\u1EC0U CH\u1EC8NH: ${S(p)}${!g.length&&C?` \u2014 ${C}`:""}`);for(const ae of g)h.push(`- ${S(ae.amount)}${ae.note?`: ${ae.note}`:""}`)}}return h.push(`T\u1ED4NG: ${ut(d)}`),h.filter(Boolean).join(`
`)},On=async e=>{try{const a=await xn(e),t=ii(a);await window.KTM.clipboard.writeText(t),typeof L=="function"?L("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof L=="function"?L("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},pn=e=>window.KTM.orders.getOrderShipInfo(e,da),hn=e=>window.KTM.orders.getItemsSubtotal(e,da),Wn=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},Un=()=>y?String(y):Wn(new Date),_s=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=gt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=Kn(e).amount,p=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(d=>{var S;return{product_id:String((d==null?void 0:d.product_id)||"").trim(),quantity:Number((S=d==null?void 0:d.quantity)!=null?S:0),variant:String((d==null?void 0:d.variant)||"").trim()}}).filter(d=>d.product_id&&Number.isFinite(d.quantity)&&d.quantity>0).sort((d,S)=>d.product_id<S.product_id?-1:d.product_id>S.product_id?1:d.variant<S.variant?-1:d.variant>S.variant?1:d.quantity-S.quantity);return JSON.stringify({name:a,phone:t,address:n,items:p,adj:i})},Ut=React.useMemo(()=>{const e=gt((f==null?void 0:f.phone)||"");if(!e)return{count:0,orders:[],monthKey:Un()};const a=Un(),n=(Array.isArray(ne)?ne:[]).filter(i=>{if(!i||ge&&String(i.id)===String(ge)||gt(i.phone||"")!==e)return!1;const o=Wn(i.created_at);return o&&o===a}).sort((i,o)=>{const p=new Date(i.created_at).getTime(),d=new Date(o.created_at).getTime();return(Number.isFinite(d)?d:0)-(Number.isFinite(p)?p:0)});return{count:n.length,orders:n,monthKey:a}},[ne,f==null?void 0:f.phone,y,ge]),ri=e=>{var d;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=gt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ps((d=e==null?void 0:e.adjustment_amount)!=null?d:0),o=Gn(e),p=(Array.isArray(o)?o:[]).map(S=>{var h;return{product_id:String((S==null?void 0:S.product_id)||"").trim(),quantity:Number((h=S==null?void 0:S.quantity)!=null?h:0),variant:String((S==null?void 0:S.variant)||"").trim()}}).filter(S=>S.product_id&&Number.isFinite(S.quantity)&&S.quantity>0).sort((S,h)=>S.product_id<h.product_id?-1:S.product_id>h.product_id?1:S.variant<h.variant?-1:S.variant>h.variant?1:S.quantity-h.quantity);return JSON.stringify({name:a,phone:t,address:n,items:p,adj:i})},Ms=React.useMemo(()=>{if(ge)return"";const e=gt((f==null?void 0:f.phone)||"");if(!e)return"";const a=Un(),t=_s(f),n=Array.isArray(ne)?ne:[];for(const i of n){if(!i||ge&&String(i.id)===String(ge)||gt(i.phone||"")!==e)continue;const o=Wn(i.created_at);if(!o||o!==a)continue;const p=ri(i);if(p&&p===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${i!=null&&i.id?` (#${i.id})`:""}`}return""},[ne,f,y,ge]),$s=e=>{var ma;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),i=gt((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),i||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),i&&!en(i)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const d=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(ft=>ft&&ft.product_id);d.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),d.some(ft=>{var Ja;const Aa=Number((Ja=ft==null?void 0:ft.quantity)!=null?Ja:0);return!Number.isFinite(Aa)||Aa<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const h=new Set;let l=!1;for(const ft of d){const Aa=String(ft.product_id||"").trim(),Ja=String((ft==null?void 0:ft.variant)||"").trim();if(!Aa)continue;const ct=`${Aa}||${Ja}`;if(h.has(ct)){l=!0;break}h.add(ct)}l&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const g=hn(d),C=pn(d),te=C!=null&&C.found?Number((ma=C==null?void 0:C.fee)!=null?ma:0):0,ae=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],Xe=Qa(ae),Be=Za(Xe),At=Xe.some(ft=>(Number(ft==null?void 0:ft.amount)||0)!==0&&!String((ft==null?void 0:ft.note)||"").trim());C!=null&&C.found&&(te>=2e5||g>0&&te>g*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ut(te)}`),At&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const tt=Math.abs(Be);return(tt>=5e5||g>0&&tt>g*.5)&&Be!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ut(Be)}`),{errors:a,warnings:t,canSubmit:a.length===0}},bi=React.useMemo(()=>$s(f),[f,T]),st=React.useMemo(()=>{var Ja;const e=String((f==null?void 0:f.customer_name)||"").trim(),a=gt((f==null?void 0:f.phone)||""),t=String((f==null?void 0:f.address)||"").trim(),n=Array.isArray(f==null?void 0:f.items)?f.items:[],i=new Map;for(const ct of n){const rn=String((ct==null?void 0:ct.product_id)||"").trim(),Dn=String((ct==null?void 0:ct.variant)||"").trim();if(!rn)continue;const Ln=`${rn}||${Dn}`;i.set(Ln,(i.get(Ln)||0)+1)}const o=n.map(ct=>{var Is;const rn=String((ct==null?void 0:ct.product_id)||"").trim(),Dn=Number((Is=ct==null?void 0:ct.quantity)!=null?Is:0),Ln=rn?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",di=Number.isFinite(Dn)&&Dn>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",mi=String((ct==null?void 0:ct.variant)||"").trim(),ui=`${rn}||${mi}`,pi=rn&&(i.get(ui)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Ln,qtyError:di,dupWarn:pi}}),p=n.filter(ct=>ct&&ct.product_id),d=hn(p),S=pn(p),h=S!=null&&S.found?Number((Ja=S==null?void 0:S.fee)!=null?Ja:0):0,l=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],g=Qa(l),C=Za(g),te=g.some(ct=>(Number(ct==null?void 0:ct.amount)||0)!==0&&!String((ct==null?void 0:ct.note)||"").trim()),ae=Math.abs(C),Xe=te?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Be=C!==0&&(ae>=5e5||d>0&&ae>d*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ut(C)}`:"",At=S!=null&&S.found&&(h>=2e5||d>0&&h>d*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ut(h)}`:"",tt=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",ma=a?en(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",ft=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Aa=!tt&&!ma&&o.every(ct=>!ct.productError&&!ct.qtyError);return{nameError:tt,phoneError:ma,addressWarn:ft,items:o,shipAbnormalWarn:At,adjustmentNoteWarn:Xe,adjustmentAbnormalWarn:Be,canSubmit:Aa}},[f,T]),jn=async e=>{var d,S,h;const a=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",n=$s(f);if(!n.canSubmit){const l=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof L=="function"?L(l,"danger"):alert(l);return}if(!ge&&Ms){const l=`${Ms}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(l)){(Ut==null?void 0:Ut.count)>0&&v(!0),setTimeout(()=>{var te;const C=document.getElementById("order-phone-input");C&&typeof C.scrollIntoView=="function"&&(C.scrollIntoView({block:"center",behavior:"smooth"}),(te=C.focus)==null||te.call(C))},0);return}}const i=gt(f.phone),p=(Array.isArray(f.items)?f.items:[]).map(l=>{var g,C;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((g=l==null?void 0:l.quantity)!=null?g:1),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(C=l==null?void 0:l.variant_json)!=null?C:null,unit_price:(()=>{const te=l==null?void 0:l.unit_price,ae=te===""||te==null?NaN:Number(te);if(Number.isFinite(ae))return Math.max(0,Math.trunc(ae));const Xe=da(l==null?void 0:l.product_id),Be=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return nn(Xe,Be)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);N(!0);try{const l=ge,g=ge?`${API_BASE}/api/orders/${ge}`:`${API_BASE}/api/orders`,C=p[0],te=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],ae=Qa(te),Xe=Za(ae),Be=Fn(ae),At={customer_name:f.customer_name,phone:i,address:f.address,note:(f.note||"").trim(),adjustment_amount:Xe,adjustment_note:Be,adjustment_items:ae,product_id:C.product_id,quantity:C.quantity,status:f.status,items:p,...ge?{id:ge}:{}};if(ge)await window.KTM.api.putJSON(g,At,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const tt=await window.KTM.api.postJSON(g,At,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");at.current={id:(h=(S=tt==null?void 0:tt.id)!=null?S:(d=tt==null?void 0:tt.order)==null?void 0:d.id)!=null?h:null,fingerprint:_s(f),ts:Date.now()}}if(Ws(i,f.customer_name,f.address),t==="drawer"){if(qa(""),_e(null),Re(!1),Jt(!1),v(!1),Ye([]),Va(),l){ot(!0),$t("");try{const tt=await Hn(l);tt&&typeof tt=="object"&&ze(tt)}catch(tt){$t((tt==null?void 0:tt.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{ot(!1)}}}else a==="new"&&!ge?(qa(""),_e(null),Re(!0)):(qa(""),_e(null),Re(!1)),Va()}catch(l){console.error(l),typeof L=="function"?L(l.message,"danger"):alert(l.message);return}finally{N(!1)}},fn=e=>window.KTM.orders.getOrderTotalMoney(e,da),gi=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){le(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Va(),Tn()}catch(a){console.error(a),typeof L=="function"?L(a.message,"danger"):alert(a.message)}finally{le(null)}}},oi=()=>{const e=Ua.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(o){}e.timer=null}const a=Array.isArray(e.events)?e.events.splice(0):[];if(!a.length||typeof L!="function")return;const t=new Map;for(const o of a){const p=String((o==null?void 0:o.orderId)||"").trim();p&&t.set(p,o)}const n=Array.from(t.values());if(!n.length)return;const i=o=>async()=>{try{for(const p of o)!(p!=null&&p.prevStatus)||!(p!=null&&p.orderId)||await Xa({id:p.orderId,status:p.nextStatus},p.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});L(o.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${o.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(p){L("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(n.length===1){const o=n[0],p=`${Na(o.prevStatus)} \u2192 ${Na(o.nextStatus)}`.trim();L(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${p}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:i([o])});return}L(`\u0110\xE3 c\u1EADp nh\u1EADt ${n.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:i(n)})},li=e=>{const a=Ua.current;a&&(Array.isArray(a.events)||(a.events=[]),a.events.push(e),!a.timer&&(a.timer=setTimeout(()=>oi(),320)))};useEffect(()=>()=>{try{const e=Ua.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Xa=async(e,a,t={})=>{var p;const n=await xn(e),i=n==null?void 0:n.id;if(!i||!a)return;const o=qt(n==null?void 0:n.status);Z(i);try{const d=Gn(n),S=(Array.isArray(d)?d:[]).map(g=>{var C,te;return{product_id:(g==null?void 0:g.product_id)||"",quantity:Number((C=g==null?void 0:g.quantity)!=null?C:1),variant:String((g==null?void 0:g.variant)||"").trim()||null,variant_json:(te=g==null?void 0:g.variant_json)!=null?te:null,unit_price:(()=>{var Be;const ae=(Be=g==null?void 0:g.unit_price)!=null?Be:g==null?void 0:g.unitPrice,Xe=Number(ae);return Number.isFinite(Xe)?Math.max(0,Math.trunc(Xe)):null})()}}).filter(g=>g.product_id&&Number.isFinite(g.quantity)&&g.quantity>0);if(!S.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const h=S[0],l={id:i,customer_name:(n==null?void 0:n.customer_name)||"",phone:gt((n==null?void 0:n.phone)||""),address:(n==null?void 0:n.address)||"",note:((n==null?void 0:n.note)||"").trim(),adjustment_amount:Number((p=n==null?void 0:n.adjustment_amount)!=null?p:0)||0,adjustment_note:(n==null?void 0:n.adjustment_note)||"",product_id:h.product_id,quantity:h.quantity,status:a,items:S};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${i}`,l,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),W(g=>Array.isArray(g)?g.map(C=>(C==null?void 0:C.id)===i?{...C,status:a}:C):g),Ae(g=>Array.isArray(g)?g.map(C=>(C==null?void 0:C.id)===i?{...C,status:a}:C):g),gn(i,!1),qs(i),t!=null&&t.silentToast)return;if(t!=null&&t.skipToastBatch){typeof L=="function"&&L("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}li({orderId:i,prevStatus:o,nextStatus:qt(a)})}catch(d){if(console.error(d),(!navigator.onLine||(d==null?void 0:d.name)==="TypeError"||String((d==null?void 0:d.message)||"").toLowerCase().includes("failed to fetch"))&&!(t!=null&&t.fromSync)){W(h=>Array.isArray(h)?h.map(l=>(l==null?void 0:l.id)===i?{...l,status:a}:l):h),Ae(h=>Array.isArray(h)?h.map(l=>(l==null?void 0:l.id)===i?{...l,status:a}:l):h),Hs(i,a,o),typeof L=="function"&&L("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof L=="function"?L(d.message,"danger"):alert(d.message)}finally{Z(null)}};useEffect(()=>{const e=a=>{var n;const t=(n=a==null?void 0:a.detail)==null?void 0:n.key;if(t){if(t==="/"){setTimeout(()=>{var i,o;(o=(i=Ie.current)==null?void 0:i.focus)==null||o.call(i)},0);return}if(t==="N"||t==="n"){_n();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&rt&&(fe!=null&&fe.id)){const i=Array.isArray(_t)?_t:[],o=i.findIndex(S=>String(S==null?void 0:S.id)===String(fe==null?void 0:fe.id));if(o<0)return;const d=i[o+(t==="j"||t==="J"?-1:1)];d&&mn(d)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[_t,rt,fe]);const ci=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:f.customer_name,onChange:e=>r({...f,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!st.nameError&&React.createElement("div",{className:"form-text text-danger"},st.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:f.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!st.phoneError&&React.createElement("div",{className:"form-text text-danger"},st.phoneError),!st.phoneError&&Ut.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Ut.count," \u0111\u01A1n trong th\xE1ng ",Ut.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>v(e=>!e)},A?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),A&&Ut.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>v(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Ut.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${tn(e.status)}`},Na(e.status))),React.createElement("div",{className:"text-muted small"},an(e.created_at)," \u2022 ",ut(fn(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sn(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Vn(e)}},"M\u1EDF")))),Ut.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),($==null?void 0:$.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),($==null?void 0:$.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),($==null?void 0:$.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),($==null?void 0:$.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:f.status,onChange:e=>r({...f,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:f.address,onChange:e=>r({...f,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!st.addressWarn&&React.createElement("div",{className:"form-text text-warning"},st.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:f.note,onChange:e=>r({...f,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{r(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},ka(f.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;r(i=>{const o=ka(i.adjustment_items);return o[a]={...o[a],amount:n},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;r(i=>{const o=ka(i.adjustment_items);return o[a]={...o[a],note:n},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{r(t=>{const n=ka(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:w||ka(f.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!st.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},st.adjustmentAbnormalWarn),!!st.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},st.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{r(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),K(e=>[...Array.isArray(e)?e:[],""]),ge&&Ye(e=>[...Array.isArray(e)?e:[],!0])},disabled:w},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(f.items)?f.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{X.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{V(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ee===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:b[a]||"",onChange:t=>{const n=t.target.value;K(i=>{const o=Array.isArray(i)?[...i]:[];return o[a]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(n.id),o=La(n==null?void 0:n.variants),p={};for(const h of o){const l=String((h==null?void 0:h.name)||"").trim(),g=Array.isArray(h==null?void 0:h.options)?h.options[0]:null,C=String((g==null?void 0:g.label)||"").trim();l&&C&&(p[l]=C)}const d=$n(p),S=nn(n,p);r(h=>{const l=Array.isArray(h.items)?[...h.items]:[];return l[a]={...l[a]||{quantity:1},product_id:i,variant_json:Object.keys(p).length?p:null,variant:d,unit_price:o.length?S:null},{...h,items:l}}),V(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),T.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=st.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=da(e.product_id),n=La(t==null?void 0:t.variants);if(!n.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,p)=>{const d=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${p+1}`).trim(),S=String((i==null?void 0:i[d])||"").trim();return React.createElement("div",{key:d},React.createElement("label",{className:"form-label small text-muted mb-1"},d),React.createElement("select",{className:"form-select",value:S,onChange:h=>{const l=String(h.target.value||"").trim();r(g=>{const C=Array.isArray(g.items)?[...g.items]:[],te={...C[a]||{}},ae=da(te.product_id),Xe=La(ae==null?void 0:ae.variants),Be=te!=null&&te.variant_json&&typeof te.variant_json=="object"?{...te.variant_json}:{};l?Be[d]=l:delete Be[d];const At=$n(Be),tt=nn(ae,Be);return C[a]={...te,variant_json:Object.keys(Be).length?Be:null,variant:At,unit_price:tt},{...g,items:C}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",d," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(h=>React.createElement("option",{key:h.label,value:h.label},h.label,Number.isFinite(Number(h==null?void 0:h.price))?` (${ut(Number(h.price))})`:Number(h==null?void 0:h.price_delta)?` (${h.price_delta>0?"+":""}${h.price_delta})`:""))))}))})(),ge&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!Ee[a],onChange:t=>{const n=!!t.target.checked;Ye(i=>{const o=Array.isArray(i)?[...i]:[],p=Array.isArray(f.items)?f.items.length:0;for(;o.length<p;)o.push(!0);return o[a]=n,o})},disabled:w||ie}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;r(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[a]={...o[a]||{product_id:""},quantity:n},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=st.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{r(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),K(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),Ye(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),V(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:w||ie||(Array.isArray(f.items)?f.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(f.items)?f.items:[]).filter(d=>d==null?void 0:d.product_id),t=hn(a),n=pn(a),i=Kn(f),o=i.amount,p=t+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ut(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ut(n.fee))),!!st.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},st.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ut(o))),(f.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(f.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ut(p)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:w||!!D||!!de}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Da.all," \u0111\u01A1n"),Fe&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>Fe?xs(He):Va(),disabled:jt,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>_n(),disabled:w||!!D},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${Ot&&!xe&&!Fe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),Rt(!1),ra(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Us)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${ha&&!xe&&!Fe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),ra(!1),Rt(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ys)),React.createElement("button",{type:"button",className:`orders-chip ${!z&&!xe&&!Fe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),me("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Da.all)),React.createElement("button",{type:"button",className:`orders-chip ${z==="draft"&&!xe&&!Fe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),me("draft"),j("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Da.draft)),React.createElement("button",{type:"button",className:`orders-chip ${z==="pending"&&!xe&&!Fe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),me("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Da.pending)),React.createElement("button",{type:"button",className:`orders-chip ${z==="processing"&&!xe&&!Fe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),me("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Da.processing)),React.createElement("button",{type:"button",className:`orders-chip ${z==="done"&&!xe&&!Fe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),me("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Da.done)),React.createElement("button",{type:"button",className:`orders-chip ${z==="paid"&&!xe&&!Fe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),me("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Da.paid)),React.createElement("button",{type:"button",className:`orders-chip ${z==="canceled"&&!xe&&!Fe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),me("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Da.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Ma("thisMonth"),disabled:Fe},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ma("overduePending"),disabled:Fe},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",ca," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Ma("draftExpiring"),disabled:Fe},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y"),(z||xe||!y&&!Fe)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ma("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:Ie,type:"text",className:"form-control",value:He,onChange:e=>ye(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(He||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ye(""),disabled:jt},React.createElement("i",{className:"fas fa-times"})),jt&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:y,onChange:e=>j(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:xe||Fe})),React.createElement("div",{className:"text-muted small ms-auto"},Fe?"Search b\u1ECF qua filter":xe?"\u0110ang xem \u0111\u01A1n ch\u1EADm":z?`L\u1ECDc: ${Na(z)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${pa?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if(Fe){const e=String(He||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${_t.length} k\u1EBFt qu\u1EA3`}return xe?`\u0110\u01A1n ch\u1EADm \u2022 ${_t.length} \u0111\u01A1n`:Ot?`\u01AFu ti\xEAn \u2022 ${_t.length} \u0111\u01A1n`:ha?`H\xF4m nay \u2022 ${_t.length} \u0111\u01A1n`:z?`L\u1ECDc: ${Na(z)} \u2022 ${_t.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${_t.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{ye(""),ra(!1),Rt(!1),Ma("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},Fe?`${_t.length} k\u1EBFt qu\u1EA3`:z?`${An.length}/${oe.length} \u0111\u01A1n`:`${oe.length}${Se?"+":""} \u0111\u01A1n`)),Fe&&ht&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},ht),Cn.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Cn.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",ca," ng\xE0y.",Te&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{be(!0),me("pending")}},"Xem ngay")),vs.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,vs.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 h\u1EE7y (c\xF2n \u2264 ",Rn," ng\xE0y).",it&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{be(!1),me("draft"),j(""),Va()}},"Xem ngay")),(Fe?jt:Me)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,a)=>React.createElement("div",{key:a,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,a)=>React.createElement("tr",{key:a},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(Fe?_t.length===0:oe.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},Fe?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!Fe&&An.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Ns.map(e=>{var a;return React.createElement("div",{key:e.id,className:`orders-mobile-swipe-shell mb-2 ${(et==null?void 0:et.id)===String(e.id)?`swipe-preview swipe-${(et==null?void 0:et.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>{if(Vt.current){Vt.current=!1;return}mn(e)},onPointerDown:t=>{if(U||na||St||t.button!=null&&t.button!==0)return;const n=String(e.id);Vt.current=!1,je.current={active:!0,id:n,startX:t.clientX,startY:t.clientY,dx:0,dy:0,lock:null,pointerId:t.pointerId,captured:!1},Pe(i=>(i==null?void 0:i.id)===n?i:{id:n,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}try{Dt.current&&clearTimeout(Dt.current)}catch(i){}Wt.current=n,Dt.current=setTimeout(async()=>{var o,p,d,S;const i=Wt.current;if(i)try{if((p=(o=kt.current)==null?void 0:o.has)!=null&&p.call(o,i))return;const h=await Hn(i);h&&typeof h=="object"&&((S=(d=kt.current)==null?void 0:d.set)==null||S.call(d,i,h))}catch(h){}},150)},onPointerMove:t=>{const n=je.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id))return;const i=t.clientX-n.startX,o=t.clientY-n.startY;if(n.dx=i,n.dy=o,Math.abs(i)>14||Math.abs(o)>14){try{Dt.current&&clearTimeout(Dt.current)}catch(C){}Dt.current=null,Wt.current=null}if(!n.lock){const C=Math.abs(i),te=Math.abs(o);if((C>10||te>10)&&(n.lock=C>te*1.2?"x":"y",n.lock==="x"&&!n.captured))try{t.currentTarget.setPointerCapture(t.pointerId),n.captured=!0}catch(ae){}}if(n.lock!=="x"){try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(C){}Math.abs(o)>24&&Pe(C=>(C==null?void 0:C.id)===n.id?{id:n.id,dir:null}:C);return}const p=!!Ya(e==null?void 0:e.status,"right"),d=!!Ya(e==null?void 0:e.status,"left"),S=(C,te,ae)=>Math.max(te,Math.min(ae,C)),h=S(i,-140,140),l=h>0&&!p||h<0&&!d?h*.35:h,g=S(Math.abs(l)/88,0,1);try{t.currentTarget.classList.add("swiping"),t.currentTarget.style.setProperty("--swipe-x",`${l}px`),t.currentTarget.style.setProperty("--swipe-p",String(g)),t.currentTarget.style.setProperty("--swipe-l",l>0&&p?String(g):"0"),t.currentTarget.style.setProperty("--swipe-r",l<0&&d?String(g):"0")}catch(C){}Math.abs(l)>12&&(Vt.current=!0),i>72&&p?Pe({id:n.id,dir:"right"}):i<-72&&d?Pe({id:n.id,dir:"left"}):Pe({id:n.id,dir:null})},onPointerCancel:t=>{try{Dt.current&&clearTimeout(Dt.current)}catch(i){}Dt.current=null,Wt.current=null;const n=je.current;try{n!=null&&n.captured&&(n==null?void 0:n.pointerId)!=null&&t.currentTarget.releasePointerCapture(n.pointerId)}catch(i){}je.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1},Pe({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}},onPointerUp:t=>{try{Dt.current&&clearTimeout(Dt.current)}catch(l){}Dt.current=null,Wt.current=null;const n=je.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id)){Pe({id:null,dir:null});return}try{n!=null&&n.captured&&(n==null?void 0:n.pointerId)!=null&&t.currentTarget.releasePointerCapture(n.pointerId)}catch(l){}je.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1};const i=Number(n.dx)||0,o=Math.abs(i),p=n.lock==="x",d=qt(e==null?void 0:e.status);Pe({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(l){}if(p&&o>12&&(Vt.current=!0),!p||o<88)return;t.preventDefault(),t.stopPropagation();const S=i>0?Ya(e==null?void 0:e.status,"right"):Ya(e==null?void 0:e.status,"left"),h=qt(S);!h||h===d||Xa(e,h)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),mn(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"orders-mobile-swipe-bg","aria-hidden":"true"},React.createElement("div",{className:"orders-mobile-swipe-bg-left"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Ya(e==null?void 0:e.status,"right"),n=ms(t),i=(n==null?void 0:n.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${n.icon||"fa-circle"}`}),i):null})())),React.createElement("div",{className:"orders-mobile-swipe-bg-right"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Ya(e==null?void 0:e.status,"left"),n=ms(t),i=(n==null?void 0:n.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${n.icon||"fa-circle"}`}),i):null})()))),React.createElement("div",{className:`card orders-mobile-card ${qe!=null&&qe[String(e.id)]?"order-recent-updated":""}`},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:t=>Bs(t,e.phone),onPointerMove:vn,onPointerUp:vn,onPointerCancel:vn,onPointerLeave:vn,onClick:t=>{if(t.stopPropagation(),Sa.current){Sa.current=!1;return}ls(e.phone)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),ls(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=rs(e);if(!t)return null;const n=xa.has(String(e.id)),i=t.length>84||os(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${n?"":"order-text-collapsed"}`},t),i&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:o=>{o.stopPropagation(),ns(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const t=os(e);if(!t)return null;const n=xa.has(String(e.id)),i=rs(e).length,o=i>84||t.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${n?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t),o&&i<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:p=>{p.stopPropagation(),ns(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${Et.has(String(e.id))?"active":""}`,onClick:t=>{t.stopPropagation(),Rs(e.id)},title:Et.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":Et.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:Et.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(ua!=null&&ua[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${tn(e.status)} order-status-badge-btn`,onPointerDown:t=>{t.stopPropagation(),ke.current=!1;try{we.current&&clearTimeout(we.current)}catch(n){}we.current=setTimeout(()=>{ke.current=!0,as(e,t.currentTarget)},420)},onPointerUp:t=>{t.stopPropagation();try{we.current&&clearTimeout(we.current)}catch(n){}we.current=null},onPointerCancel:t=>{t.stopPropagation();try{we.current&&clearTimeout(we.current)}catch(n){}we.current=null},onClick:t=>{if(t.stopPropagation(),ke.current){ke.current=!1;return}St&&String(I==null?void 0:I.id)===String(e.id)?Ha():as(e,t.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},Na(e.status)),yn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ca} ng\xE0y`},"\u26A0 Ch\u1EADm ",cn(e),"d"),wn(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Fa} ng\xE0y`},"\u23F3 C\xF2n ",Nn(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=In(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,i)=>React.createElement("div",{key:i,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${ut(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sn(e))})()),(un(e)!==0||za(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ut(un(e))),za(e)?React.createElement("span",{className:"text-muted"}," ","(",za(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},ut(fn(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",an(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),On(e)},disabled:w||!!D||de===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),ts(e)},disabled:w||!!D||de===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c")))))}),React.createElement("div",{ref:Ka,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(_t)&&Ns.length<_t.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),St&&I&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>Ha()},React.createElement("div",{className:`orders-status-popover ${(E==null?void 0:E.placement)||""}`,style:{left:E.left,top:E.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},I.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ha(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},on.map(e=>{const a=qt(I.status)===qt(e.value),t=w||!!D||de===I.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Xa(I,e.value),Ha())},disabled:t},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{ts(I),Ha()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),U&&yt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Ba()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},yt.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},yt.phone||""),React.createElement("span",{className:`badge ${tn(yt.status)}`},Na(yt.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ba(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{On(yt),Ba()},disabled:w||!!D||de===yt.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(yt.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(yt.phone||"").trim()}`,onClick:()=>Ba()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{mn(yt),Ba()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},on.map(e=>{const a=qt(yt.status)===qt(e.value),t=w||!!D||de===yt.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Xa(yt,e.value),Ba())},disabled:t},e.label)})))),na&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>bn()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>bn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Ma("thisMonth"),disabled:Fe},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ma("overduePending"),disabled:Fe},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Ma("draftExpiring"),disabled:Fe},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!z&&!xe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),me("")}},"T\u1EA5t c\u1EA3"),on.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${z===e.value&&!xe?"active":""}`,onClick:()=>{Fe&&ye(""),be(!1),me(e.value),e.value==="draft"&&j("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:y,onChange:e=>j(e.target.value),disabled:xe||Fe}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:xe,onChange:e=>{Fe&&ye("");const a=!!e.target.checked;be(a),a&&(j(""),me("pending"))},disabled:Fe}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",ca," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Ma("all"),disabled:Fe},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>bn()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${lt?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){ba.current=!1;try{Nt.current&&clearTimeout(Nt.current)}catch(a){}Nt.current=setTimeout(()=>{ba.current=!0,ss(He)},460)}},onPointerUp:()=>{try{Nt.current&&clearTimeout(Nt.current)}catch(e){}Nt.current=null},onPointerCancel:()=>{try{Nt.current&&clearTimeout(Nt.current)}catch(e){}Nt.current=null},onClick:()=>{if(ba.current){ba.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,a;return(a=(e=Ie.current)==null?void 0:e.focus)==null?void 0:a.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>_n(),disabled:w||!!D,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Ls(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),Ct&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{ln(Zt),ya()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const a=e.touches&&e.touches[0];a&&(zt.current={active:!0,startY:a.clientY,startX:a.clientX,fired:!1})},onTouchMove:e=>{const a=zt.current;if(!(a!=null&&a.active)||a.fired)return;const t=e.touches&&e.touches[0];if(!t)return;const n=t.clientY-a.startY,i=t.clientX-a.startX;Math.abs(i)>24||n>90&&(a.fired=!0,ln(Zt),ya())},onTouchEnd:()=>{zt.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{ln(Zt),ya()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:oa,type:"text",className:"form-control",value:Zt,onChange:e=>{const a=e.target.value;sa(a),ye(a)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(ln(Zt),ya())}}),!!String(Zt||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{sa(""),ye("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(Ia)&&Ia.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},Ia.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{sa(e),ye(e),ln(e),ya()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${Ot?"active":""}`,onClick:()=>{ye(""),sa(""),be(!1),Rt(!1),ra(e=>!e),ya()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${ha?"active":""}`,onClick:()=>{ye(""),sa(""),be(!1),ra(!1),Rt(e=>!e),ya()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${xe?"active":""}`,onClick:()=>{ye(""),sa(""),be(e=>!e),xe||(j(""),me("pending")),ya()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!z&&!xe&&!Ot&&!ha?"active":""}`,onClick:()=>{ye(""),sa(""),be(!1),ra(!1),Rt(!1),me(""),ya()}},"T\u1EA5t c\u1EA3"),on.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${z===e.value&&!xe?"active":""}`,onClick:()=>{ye(""),sa(""),be(!1),ra(!1),Rt(!1),me(e.value),e.value==="draft"&&j(""),ya()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,_t.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>mn(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=In(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",ut(t.unitPrice))))):sn(e)})()),React.createElement("td",null,Ts(e)),React.createElement("td",{className:"fw-semibold"},ut(fn(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${tn(e.status)}`},Na(e.status)),yn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ca} ng\xE0y`},"\u26A0 Ch\u1EADm ",cn(e),"d"),wn(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Fa} ng\xE0y`},"\u23F3 C\xF2n ",Nn(e),"d"))),React.createElement("td",null,an(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),On(e)},disabled:w||!!D||de===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation();const t=String(a.target.value||"").trim();a.target.value="",t&&Xa(e,t)},disabled:w||!!D||de===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!Fe&&Se&&!xe&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Zs,disabled:Me||pe},pe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:rt,title:(()=>{const e=fe,a=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Na(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${a} ${t}`.trim()})(),subtitle:(()=>{const e=fe,a=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?an(e.created_at):"";return[a||t||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:ei,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},aa?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Jt(!1),_e(null),qa(""),v(!1),Ye([])},disabled:w||ie},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!ge&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:Ss,disabled:w||ie,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},ie?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>jn({mode:"close",origin:"drawer"}),disabled:w||ie||!st.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>fe&&On(fe),disabled:!fe||Mt||w||!!D},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>fe&&Vn(fe),disabled:!fe||Mt||w||!!D},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const a=String(e.target.value||"").trim();e.target.value="",a&&fe&&Xa(fe,a)},disabled:!fe||Mt||w||!!D||de===(fe==null?void 0:fe.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},aa?React.createElement("form",{onSubmit:e=>{e.preventDefault(),jn({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),ci())):Mt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):Kt?React.createElement("div",{className:"alert alert-danger",role:"alert"},Kt):fe?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${tn(fe.status)}`},Na(fe.status)),yn(fe)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ca} ng\xE0y`},"\u26A0 Ch\u1EADm ",cn(fe),"d"),wn(fe)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Fa} ng\xE0y`},"\u23F3 C\xF2n ",Nn(fe),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},ut(fn(fe))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},Ts(fe)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},an(fe.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},fe.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},fe.phone||"\u2014"),!!String(fe.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(fe.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},fe.address||"\u2014")),((fe==null?void 0:fe.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(fe.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=In(fe);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((a,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),a.name),a.variant?React.createElement("div",{className:"text-muted small"},a.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${ut(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sn(fe)||"\u2014")})(),(un(fe)!==0||za(fe))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ut(un(fe))),za(fe)?React.createElement("span",{className:"text-muted"}," ","(",za(fe),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Le&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),ge?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:zn})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),jn({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:De},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:f.customer_name,onChange:e=>r({...f,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!st.nameError&&React.createElement("div",{className:"form-text text-danger"},st.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:f.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!st.phoneError&&React.createElement("div",{className:"form-text text-danger"},st.phoneError),!st.phoneError&&Ut.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Ut.count," \u0111\u01A1n trong th\xE1ng ",Ut.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>v(e=>!e)},A?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),A&&Ut.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>v(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Ut.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${tn(e.status)}`},Na(e.status))),React.createElement("div",{className:"text-muted small"},an(e.created_at)," \u2022 ",ut(fn(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sn(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Vn(e)}},"M\u1EDF")))),Ut.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),($==null?void 0:$.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),($==null?void 0:$.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),($==null?void 0:$.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),($==null?void 0:$.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:f.status,onChange:e=>r({...f,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:f.address,onChange:e=>r({...f,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!st.addressWarn&&React.createElement("div",{className:"form-text text-warning"},st.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:f.note,onChange:e=>r({...f,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{r(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},ka(f.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;r(i=>{const o=ka(i.adjustment_items);return o[a]={...o[a],amount:n},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;r(i=>{const o=ka(i.adjustment_items);return o[a]={...o[a],note:n},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{r(t=>{const n=ka(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:w||ka(f.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!st.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},st.adjustmentAbnormalWarn),!!st.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},st.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{r(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),K(e=>[...Array.isArray(e)?e:[],""]),ge&&Ye(e=>[...Array.isArray(e)?e:[],!0])},disabled:w},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(f.items)?f.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{X.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{V(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ee===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:b[a]||"",onChange:t=>{const n=t.target.value;K(i=>{const o=Array.isArray(i)?[...i]:[];return o[a]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(n.id),o=La(n==null?void 0:n.variants),p={};for(const h of o){const l=String((h==null?void 0:h.name)||"").trim(),g=Array.isArray(h==null?void 0:h.options)?h.options[0]:null,C=String((g==null?void 0:g.label)||"").trim();l&&C&&(p[l]=C)}const d=$n(p),S=nn(n,p);r(h=>{const l=Array.isArray(h.items)?[...h.items]:[];return l[a]={...l[a]||{quantity:1},product_id:i,variant_json:Object.keys(p).length?p:null,variant:d,unit_price:o.length?S:null},{...h,items:l}}),V(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),T.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=st.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=da(e.product_id),n=La(t==null?void 0:t.variants);if(!n.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,p)=>{const d=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${p+1}`).trim(),S=String((i==null?void 0:i[d])||"").trim();return React.createElement("div",{key:d},React.createElement("label",{className:"form-label small text-muted mb-1"},d),React.createElement("select",{className:"form-select",value:S,onChange:h=>{const l=String(h.target.value||"").trim();r(g=>{const C=Array.isArray(g.items)?[...g.items]:[],te={...C[a]||{}},ae=da(te.product_id),Xe=La(ae==null?void 0:ae.variants),Be=te!=null&&te.variant_json&&typeof te.variant_json=="object"?{...te.variant_json}:{};l?Be[d]=l:delete Be[d];const At=$n(Be),tt=nn(ae,Be);return C[a]={...te,variant_json:Object.keys(Be).length?Be:null,variant:At,unit_price:tt},{...g,items:C}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",d," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(h=>React.createElement("option",{key:h.label,value:h.label},h.label,Number.isFinite(Number(h==null?void 0:h.price))?` (${ut(Number(h.price))})`:Number(h==null?void 0:h.price_delta)?` (${h.price_delta>0?"+":""}${h.price_delta})`:""))))}))})(),ge&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!Ee[a],onChange:t=>{const n=!!t.target.checked;Ye(i=>{const o=Array.isArray(i)?[...i]:[],p=Array.isArray(f.items)?f.items.length:0;for(;o.length<p;)o.push(!0);return o[a]=n,o})},disabled:w||ie}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;r(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[a]={...o[a]||{product_id:""},quantity:n},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=st.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{r(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),K(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),Ye(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),V(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:w||ie||(Array.isArray(f.items)?f.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(f.items)?f.items:[]).filter(d=>d==null?void 0:d.product_id),t=hn(a),n=pn(a),i=Kn(f),o=i.amount,p=t+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ut(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ut(n.fee))),!!st.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},st.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ut(o))),(f.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(f.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ut(p)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:zn,disabled:w||ie,style:{borderRadius:10}},"H\u1EE7y"),!!ge&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:Ss,disabled:w||ie,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},ie?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!ge&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>jn({mode:"new",origin:"modal"}),disabled:w||!st.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:w||ie||!st.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

