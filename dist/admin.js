const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:E,error:q}){const[B,yt]=useState(""),[it,Y]=useState(""),[G,Ot]=useState(!1),[Xt,Ct]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),q&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),q),React.createElement("form",{onSubmit:async ue=>{ue.preventDefault(),Ot(!0),await E(B,it),Ot(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:B,onChange:ue=>yt(ue.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:Xt?"text":"password",className:"form-control",value:it,onChange:ue=>Y(ue.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Ct(!Xt)},React.createElement("i",{className:`fas fa-eye${Xt?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:G},G?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:E,type:q,onClose:B,actionLabel:yt,onAction:it,durationMs:Y}){return useEffect(()=>{const G=Number(Y),Ot=Number.isFinite(G)&&G>0?G:3e3,Xt=setTimeout(B,Ot);return()=>clearTimeout(Xt)},[B,Y]),React.createElement("div",{className:`toast show align-items-center text-white bg-${q} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},E),yt&&typeof it=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{it()}finally{B()}}},yt),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:B})))}function Loading({show:E}){return E?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:E,title:q,subtitle:B,onClose:yt,footer:it,children:Y}){return useEffect(()=>{if(!E)return;const G=Ot=>{Ot.key==="Escape"&&(Ot.preventDefault(),typeof yt=="function"&&yt())};return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[E,yt]),E?React.createElement("div",{className:`admin-drawer-root ${E?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:yt,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},q),B?React.createElement("div",{className:"admin-drawer-subtitle"},B):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:yt,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},Y),it?React.createElement("div",{className:"admin-drawer-footer"},it):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(E){try{const q=localStorage.getItem(E);if(!q)return[];const B=JSON.parse(q);return Array.isArray(B)?B.map(yt=>String(yt||"").trim()).filter(Boolean):[]}catch(q){return[]}}function saveAdminMenuIdsToStorage(E,q){try{localStorage.setItem(E,JSON.stringify(Array.isArray(q)?q:[]))}catch(B){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(E){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,E),E}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(E){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,E),E}function Sidebar({activeMenu:E,onMenuChange:q,onLogout:B,currentUser:yt,pinnedMenus:it,recentMenus:Y,onTogglePin:G}){const Ot=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"recon",icon:"fa-file-excel",label:"\u0110\u1ED1i so\xE1t Excel"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],Xt=(yt==null?void 0:yt.username)||(yt==null?void 0:yt.name)||(yt==null?void 0:yt.email)||"Admin",Ct=useMemo(()=>{const jt=new Map;for(const X of Ot)jt.set(X.id,X);return jt},[]),Ut=Array.isArray(it)?it:[],ue=Array.isArray(Y)?Y:[],Lt=Ut.map(jt=>Ct.get(jt)).filter(Boolean),Gt=ue.filter(jt=>jt!==E).map(jt=>Ct.get(jt)).filter(Boolean).slice(0,2),ot=jt=>Ut.includes(jt);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},Xt),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3 sidebar-nav"},Lt.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},Lt.map(jt=>React.createElement("a",{key:`pin-${jt.id}`,href:"#",className:`nav-link ${E===jt.id?"active":""} sidebar-quicklink`,onClick:X=>{X.preventDefault(),q(jt.id)}},React.createElement("i",{className:`fas ${jt.icon}`})," ",jt.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:X=>{X.preventDefault(),X.stopPropagation(),G&&G(jt.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),Gt.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},Gt.map(jt=>React.createElement("a",{key:`recent-${jt.id}`,href:"#",className:`nav-link ${E===jt.id?"active":""} sidebar-quicklink`,onClick:X=>{X.preventDefault(),q(jt.id)}},React.createElement("i",{className:`fas ${jt.icon}`})," ",jt.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),React.createElement("div",{className:"sidebar-menu-scroll","aria-label":"Danh s\xE1ch menu"},Ot.map(jt=>React.createElement("a",{key:jt.id,href:"#",className:`nav-link ${E===jt.id?"active":""} ${jt.disabled?"opacity-50":""} ${jt.highlight?"text-warning":""}`,onClick:X=>{X.preventDefault(),jt.disabled||q(jt.id)}},React.createElement("i",{className:`fas ${jt.icon}`})," ",jt.label,jt.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),jt.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${ot(jt.id)?"pinned":""}`,onClick:X=>{X.preventDefault(),X.stopPropagation(),G&&G(jt.id)},title:ot(jt.id)?"B\u1ECF ghim":"Ghim","aria-label":ot(jt.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),React.createElement("div",{className:"sidebar-footer w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),B&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:B,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(E){const q=typeof E=="number"?E:parseFloat(String(E!=null?E:"").trim());return Number.isFinite(q)?Math.max(0,Math.min(100,q)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var E;try{const q=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!q)return{ship_percent:DEFAULT_SHIP_PERCENT};const B=JSON.parse(q);return{ship_percent:normalizeShipPercent((E=B==null?void 0:B.ship_percent)!=null?E:B==null?void 0:B.shipPercent)}}catch(q){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(E){var q;try{const B={ship_percent:normalizeShipPercent((q=E==null?void 0:E.ship_percent)!=null?q:E==null?void 0:E.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(B)),B}catch(B){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var q;const E=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((q=E==null?void 0:E.ship_percent)!=null?q:E==null?void 0:E.shipPercent)}}async function saveAdminSettingsToServer(E){var yt,it,Y;const q={ship_percent:normalizeShipPercent((yt=E==null?void 0:E.ship_percent)!=null?yt:E==null?void 0:E.shipPercent)},B=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,q,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((Y=(it=B==null?void 0:B.ship_percent)!=null?it:B==null?void 0:B.shipPercent)!=null?Y:q.ship_percent)}}function AlbumList({albums:E,onSelect:q,onCreate:B,onEdit:yt,onDelete:it,loading:Y,currentFolder:G,onBack:Ot,breadcrumb:Xt}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},G&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:Ot},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),G?G.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:B},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),Xt&&Xt.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Ct=>{Ct.preventDefault(),Ot("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Xt.map((Ct,Ut)=>React.createElement("li",{key:Ct.id,className:`breadcrumb-item ${Ut===Xt.length-1?"active":""}`},Ut===Xt.length-1?Ct.title:React.createElement("a",{href:"#",onClick:ue=>{ue.preventDefault(),Ot(Ct)},className:"text-warning"},Ct.title))))),Y?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):E.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},G?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},E.map(Ct=>React.createElement("div",{key:Ct.uuid||Ct.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>q(Ct)},Ct.cover?React.createElement("img",{src:Ct.cover,className:"album-cover",alt:Ct.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Ct.title),React.createElement("small",{className:"text-muted"},Ct.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Ct.subfolderCount),Ct.subfolderCount>0&&Ct.count>0&&" \u2022 ",Ct.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Ct.count),Ct.subfolderCount===0&&Ct.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Ut=>{Ut.stopPropagation(),yt(Ct)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Ut=>{Ut.stopPropagation(),it(Ct)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:E,album:q,onClose:B,onSave:yt,parentId:it}){const[Y,G]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[Ot,Xt]=useState(!1),[Ct,Ut]=useState(!1),ue=useRef(null);useEffect(()=>{G(q?{slug:q.id||"",title:q.title||"",description:q.description||"",cover_url:q.cover||"",parent_id:q.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:it||null})},[q,E,it]);const Lt=async X=>{X.preventDefault(),Xt(!0),await yt(Y),Xt(!1)},Gt=X=>X.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),ot=async X=>{const we=X.type==="image/heic"||X.type==="image/heif"||/\.heic$/i.test(X.name);if(X.size<=2097152&&!we)return X;try{const Te=await createImageBitmap(X),Jt=document.createElement("canvas");let oe=Te.width,Rt=Te.height;const Ce=800;return(oe>Ce||Rt>Ce)&&(oe>Rt?(Rt=Math.round(Rt/oe*Ce),oe=Ce):(oe=Math.round(oe/Rt*Ce),Rt=Ce)),Jt.width=oe,Jt.height=Rt,Jt.getContext("2d").drawImage(Te,0,0,oe,Rt),Te.close(),new Promise((sn,ae)=>{Jt.toBlob(Fe=>{Fe?sn(new File([Fe],X.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ae(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Te){throw console.error("Compress cover error:",Te),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},jt=async X=>{var Te;const ye=X.target.files[0];if(!ye)return;if(!(ye.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ye.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ut(!0);try{const Jt=await ot(ye),oe=await window.KTM.cloudinary.uploadImage({file:Jt,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!oe.secure_url)throw console.error("Cloudinary error:",oe),new Error(((Te=oe.error)==null?void 0:Te.message)||"Upload failed");G(Rt=>({...Rt,cover_url:oe.secure_url}))}catch(Jt){console.error("Cover upload error:",Jt),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Jt.message)}Ut(!1),X.target.value=""};return E?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},q?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:B})),React.createElement("form",{onSubmit:Lt},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Y.title,onChange:X=>G({...Y,title:X.target.value,slug:Y.slug||Gt(X.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:Y.slug,onChange:X=>G({...Y,slug:X.target.value}),required:!0,disabled:!!q}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Y.description,onChange:X=>G({...Y,description:X.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},Y.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:Y.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>G(X=>({...X,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:ue,type:"file",accept:"image/*",className:"d-none",onChange:jt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var X;return(X=ue.current)==null?void 0:X.click()},disabled:Ct},Ct?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:Y.cover_url,onChange:X=>G({...Y,cover_url:X.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:B},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:Ot||Ct},Ot?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:E,allAlbums:q,currentAlbumId:B,targetAlbum:yt,onSelect:it,level:Y=0}){const[G,Ot]=useState(!0),Xt=E.uuid||E.id,Ct=Xt===B,Ut=yt===Xt,ue=q.filter(Gt=>Gt.parentId===Xt),Lt=ue.length>0;return React.createElement("div",{style:{marginLeft:Y*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Ut?"bg-info text-white":Ct?"bg-light text-muted":"hover-bg"}`,style:{cursor:Ct?"not-allowed":"pointer",opacity:Ct?.5:1,transition:"background 0.2s"},onClick:()=>!Ct&&it(Xt)},Lt&&React.createElement("i",{className:`fas fa-chevron-${G?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:Gt=>{Gt.stopPropagation(),Ot(!G)}}),!Lt&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Ut?"-open":""} me-2 ${Ut?"":"text-warning"}`}),React.createElement("span",{className:"small"},E.title),Ct&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),E.count>0&&!Ct&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},E.count)),G&&Lt&&React.createElement("div",null,ue.map(Gt=>React.createElement(FolderTreeItem,{key:Gt.uuid||Gt.id,folder:Gt,allAlbums:q,currentAlbumId:B,targetAlbum:yt,onSelect:it,level:Y+1}))))}function AlbumDetail({album:E,onBack:q,onRefresh:B,showToast:yt,onNavigateToFolder:it,onEditSubfolder:Y,parentAlbum:G}){const[Ot,Xt]=useState([]),[Ct,Ut]=useState([]),[ue,Lt]=useState(!0),[Gt,ot]=useState(!1),[jt,X]=useState(""),[ye,we]=useState([]),[Te,Jt]=useState([]),[oe,Rt]=useState({}),[Ce,_e]=useState(null),[sn,ae]=useState(!1),[Fe,Ge]=useState(""),[C,M]=useState(!1),H=useRef(null),ft=useRef(null),[vt,dt]=useState(!1),[wt,At]=useState([]),[N,J]=useState([]),[at,_t]=useState(""),[qt,Vt]=useState(!1),$t=async(O,h=2)=>{const V=h*1024*1024,st=O.type==="image/heic"||O.type==="image/heif"||/\.heic$/i.test(O.name);if(O.size<=V&&!st)return O;try{const Pt=await createImageBitmap(O),Bt=document.createElement("canvas");let Yt=Pt.width,$e=Pt.height;const se=1200;return(Yt>se||$e>se)&&(Yt>$e?($e=Math.round($e/Yt*se),Yt=se):(Yt=Math.round(Yt/$e*se),$e=se)),Bt.width=Yt,Bt.height=$e,Bt.getContext("2d").drawImage(Pt,0,0,Yt,$e),Pt.close(),new Promise((We,Cn)=>{Bt.toBlob(ln=>{ln?We(new File([ln],O.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Cn(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Pt){throw console.error("Compress error:",Pt),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{It(),Ft()},[E.id,E.uuid]);const It=async()=>{Lt(!0);try{const O=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${E.uuid||E.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Xt(O.images||[]);const h=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${E.uuid||E.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Ut(Array.isArray(h)?h:[])}catch(O){console.error(O),yt("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}Lt(!1)},Ft=async()=>{try{const O=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");J(Array.isArray(O)?O:[])}catch(O){console.error("Error loading albums:",O)}},ce=O=>{At(h=>h.includes(O)?h.filter(V=>V!==O):[...h,O])},Ie=async()=>{if(!at||wt.length===0){yt("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}Vt(!0);let O=0;for(const h of wt)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${h}`,{album_id:at},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),O++}catch(V){console.error("Move error:",V)}Vt(!1),dt(!1),At([]),_t(""),O>0?(yt("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),It(),B()):yt("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[pe,Ue]=useState(!1),Le=async()=>{if(wt.length===0||!confirm(`X\xF3a ${wt.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Ue(!0);let O=0;for(const h of wt)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${h}`,"L\u1ED7i x\xF3a \u1EA3nh"),O++}catch(V){console.error("Delete error:",V)}Ue(!1),At([]),O>0?(yt(`\u0110\xE3 x\xF3a ${O} \u1EA3nh!`,"success"),It(),B()):yt("X\xF3a th\u1EA5t b\u1EA1i","danger")},Mt=()=>{wt.length===Ot.length?At([]):At(Ot.map(O=>O.id))},Ve=async()=>{if(Fe.trim()){M(!0);try{const O=Fe.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:O+"-"+Date.now(),title:Fe,parent_id:E.uuid||E.id},"L\u1ED7i t\u1EA1o folder"),yt("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Ge(""),ae(!1),It(),B()}catch(O){yt(O.message,"danger")}M(!1)}},on=async O=>{if(confirm(`X\xF3a folder "${O.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${O.uuid||O.id}`,"L\u1ED7i x\xF3a folder"),yt("\u0110\xE3 x\xF3a folder","success"),It(),B()}catch(h){yt("L\u1ED7i x\xF3a folder","danger")}},mn=O=>{const h=Array.from(O).filter(V=>V.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(V.name));we(V=>[...V,...h]),h.forEach(V=>{const st=new FileReader;st.onload=Pt=>{Jt(Bt=>[...Bt,{file:V,preview:Pt.target.result}])},st.readAsDataURL(V)})},F=O=>{we(h=>h.filter((V,st)=>st!==O)),Jt(h=>h.filter((V,st)=>st!==O))},rt=async O=>{var V;const h=await window.KTM.cloudinary.uploadImage({file:O,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${E.id}`});if(!h.secure_url)throw console.error("Cloudinary error:",h),new Error(((V=h.error)==null?void 0:V.message)||"Upload failed");return h},Qt=async()=>{if(ye.length===0)return;ot(!0);let O=0;for(let h=0;h<ye.length;h++)try{X(`\u0110ang x\u1EED l\xFD ${h+1}/${ye.length}...`);const V=await $t(ye[h],2);X(`\u0110ang upload ${h+1}/${ye.length}...`);const st=await rt(V);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${E.id}`,{url:st.secure_url,caption:oe[h]||ye[h].name.replace(/\.[^/.]+$/,""),sort_order:Ot.length+h},"L\u1ED7i l\u01B0u \u1EA3nh"),O++}catch(V){console.error("Upload error:",V)}ot(!1),X(""),we([]),Jt([]),Rt({}),O>0?(yt(`\u0110\xE3 upload ${O} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),It(),B()):yt("Upload th\u1EA5t b\u1EA1i","danger")},cn=async(O,h)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${O}`,"L\u1ED7i x\xF3a \u1EA3nh"),yt("\u0110\xE3 x\xF3a \u1EA3nh","success"),It(),B()}catch(V){yt("L\u1ED7i x\xF3a \u1EA3nh","danger")}},un=O=>{var h;O.preventDefault(),(h=ft.current)==null||h.classList.add("dragover")},Qe=()=>{var O;(O=ft.current)==null||O.classList.remove("dragover")},Ze=O=>{var h;O.preventDefault(),(h=ft.current)==null||h.classList.remove("dragover"),mn(O.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:q},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},E.title),React.createElement("small",{className:"text-muted"},Ct.length>0&&React.createElement("span",null,Ct.length," folder \u2022 "),Ot.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>ae(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),sn&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Fe,onChange:O=>Ge(O.target.value),onKeyPress:O=>O.key==="Enter"&&Ve(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Ve,disabled:C||!Fe.trim()},C?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{ae(!1),Ge("")}},"H\u1EE7y")))),Ct.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Ct.map(O=>React.createElement("div",{key:O.uuid||O.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>it&&it(O)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},O.title),React.createElement("small",{className:"text-muted"},O.subfolderCount>0&&React.createElement("span",null,O.subfolderCount," folder"),O.subfolderCount>0&&O.count>0&&" \u2022 ",O.count>0&&React.createElement("span",null,O.count," \u1EA3nh"),O.subfolderCount===0&&O.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:h=>{h.stopPropagation(),Y&&Y(O)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:h=>{h.stopPropagation(),on(O)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:ft,className:"upload-zone",onClick:()=>{var O;return(O=H.current)==null?void 0:O.click()},onDragOver:un,onDragLeave:Qe,onDrop:Ze},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:H,type:"file",multiple:!0,accept:"image/*",onChange:O=>mn(O.target.files)})),Te.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Te.map((O,h)=>React.createElement("div",{key:h,className:"upload-preview-item"},React.createElement("img",{src:O.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>F(h)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Qt,disabled:Gt},Gt?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),jt||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",ye.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",Ot.length,")"),Ot.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Mt},wt.length===Ot.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),wt.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},wt.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>dt(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Le,disabled:pe},pe?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>At([])},React.createElement("i",{className:"fas fa-times"})))),ue?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):Ot.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},Ot.map((O,h)=>React.createElement("div",{key:h,className:`image-item ${wt.includes(O.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>ce(O.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:wt.includes(O.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:wt.includes(O.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},wt.includes(O.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:O.src,alt:O.caption,style:{opacity:wt.includes(O.id)?.7:1,border:wt.includes(O.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:V=>{V.stopPropagation(),cn(O.id,h)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),O.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},O.caption)))))),vt&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",wt.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>dt(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},N.filter(O=>!O.parentId).map(O=>React.createElement(FolderTreeItem,{key:O.uuid||O.id,folder:O,allAlbums:N,currentAlbumId:E.uuid||E.id,targetAlbum:at,onSelect:_t})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>dt(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:Ie,disabled:!at||qt},qt?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Ce&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>_e(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>_e(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Ce.src,alt:Ce.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:O=>O.stopPropagation()}),Ce.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Ce.caption)))))}function SearchCenter({showToast:E,onNavigate:q}){const[B,yt]=useState(""),[it,Y]=useState([]),[G,Ot]=useState([]),[Xt,Ct]=useState([]),[Ut,ue]=useState("all"),[Lt,Gt]=useState(null),[ot,jt]=useState("list"),[X,ye]=useState(!0),[we,Te]=useState([]),[Jt,oe]=useState([]),Rt=useRef(null),[Ce,_e]=useState(!0),[sn,ae]=useState(!1),Fe=useRef(null),Ge=useRef(null),C=useRef(null),[M,H]=useState(!1),[ft,vt]=useState([]),[dt,wt]=useState([]),[At,N]=useState(""),J=useRef(null),at=useRef(new Map),[_t,qt]=useState("auto"),[Vt,$t]=useState({start:0,end:20}),[It,Ft]=useState(!1),[ce,Ie]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[pe,Ue]=useState(""),[Le,Mt]=useState(!1),Ve=useRef(null),on=useRef(null),mn=s=>s?String(s).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",F=s=>s?String(s).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",rt=(s,u)=>{if(!s||!u)return s;const c=new RegExp(`(${u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return s.replace(c,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const s=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),u=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");vt(Array.isArray(s)?s.slice(0,10):[]),wt(Array.isArray(u)?u:[])}catch(s){}},[]);const Qt=s=>{if(!s.trim())return;const u=[s,...ft.filter(c=>c!==s)].slice(0,10);vt(u);try{localStorage.setItem("ktm_search_history",JSON.stringify(u))}catch(c){}},cn=s=>{if(!s.trim())return;const u=dt.includes(s)?dt.filter(c=>c!==s):[s,...dt].slice(0,5);wt(u);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(u))}catch(c){}},un="ktm_search_query_stats_v1",Qe="ktm_search_product_stats_v1",Ze=(s,u)=>{try{const c=localStorage.getItem(s);if(!c)return u;const I=JSON.parse(c);return I!=null?I:u}catch(c){return u}},O=(s,u)=>{try{localStorage.setItem(s,JSON.stringify(u))}catch(c){}},[h,V]=useState(()=>Ze(un,{})),[st,Pt]=useState(()=>Ze(Qe,{})),Bt=useRef(!1),Yt=useRef(new Map);useEffect(()=>{const s=u=>{u&&(u.key===un&&V(Ze(un,{})),u.key===Qe&&Pt(Ze(Qe,{})))};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const $e=s=>{const u=String(s||"").trim();if(!u)return;const c=xt(u).trim();if(c.length<3||c==="sdt:"||c==="#"||c.endsWith(":"))return;const I=Date.now(),R=Ze(un,h&&typeof h=="object"?h:{}),v={...R&&typeof R=="object"?R:{}},S=v[c]&&typeof v[c]=="object"?v[c]:{};v[c]={q:u,count:(Number(S.count)||0)+1,lastAt:I},V(v),O(un,v)},se=(s,u)=>{if(!s||s._type!=="product")return;const c=String(s.id||"").trim();if(!c)return;const I=Date.now(),R=Ze(Qe,st&&typeof st=="object"?st:{}),v={...R&&typeof R=="object"?R:{}},S=v[c]&&typeof v[c]=="object"?v[c]:{};v[c]={id:c,name:String(s.name||S.name||"").trim(),code:String(s.code||S.code||"").trim(),count:(Number(S.count)||0)+1,lastAt:I,action:String(u||S.action||"").trim()},Pt(v),O(Qe,v)},hn=(s,u)=>{const c=String(s||"").trim();if(!c)return;const I=xt(c).trim();if(I.length<3||I==="sdt:"||I==="#"||I.endsWith(":"))return;const R=Date.now(),v=Number(Yt.current.get(I)||0);if(R-v<3e4)return;const Z=(Array.isArray(u)?u:[]).find(Q=>Q&&Q._type==="product");Z&&(Yt.current.set(I,R),se(Z,"search"))},We=useMemo(()=>Object.values(h&&typeof h=="object"?h:{}).map(c=>({q:String((c==null?void 0:c.q)||"").trim(),count:Number(c==null?void 0:c.count)||0,lastAt:Number(c==null?void 0:c.lastAt)||0})).filter(c=>c.q&&c.count>0).sort((c,I)=>I.count-c.count||I.lastAt-c.lastAt).slice(0,6),[h]),Cn=useMemo(()=>Object.values(st&&typeof st=="object"?st:{}).map(c=>({id:String((c==null?void 0:c.id)||"").trim(),name:String((c==null?void 0:c.name)||"").trim(),code:String((c==null?void 0:c.code)||"").trim(),count:Number(c==null?void 0:c.count)||0,lastAt:Number(c==null?void 0:c.lastAt)||0})).filter(c=>c.id&&c.count>0).sort((c,I)=>I.count-c.count||I.lastAt-c.lastAt).slice(0,8).map(c=>{const I=G.find(R=>R&&R._type==="product"&&String(R.id)===c.id);return I?{...c,item:I}:{...c,item:null}}),[st,G]),ln=(s,u={})=>{const c=String(s||"");Ae(c),u.addToHistory!==!1&&Qt(c),H(!1),pn(!1),x(!1),u.focus!==!1?(Bt.current=!0,setTimeout(()=>{var v;const R=Rt.current;(v=R==null?void 0:R.focus)==null||v.call(R);try{if(u.caret==="end"&&R&&typeof R.setSelectionRange=="function"){const S=String(R.value||"").length;R.setSelectionRange(S,S)}}catch(S){}},0)):(Bt.current=!1,setTimeout(()=>{var R,v,S,Z;try{(v=(R=Rt.current)==null?void 0:R.blur)==null||v.call(R),(Z=(S=document.activeElement)==null?void 0:S.blur)==null||Z.call(S)}catch(Q){}},0))},[re,An]=useState(null),[fn,wn]=useState(!1),[be,i]=useState(null),[l,x]=useState(!1),[g,f]=useState(!1),[L,P]=useState(null),[b,A]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),D=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],U=s=>{var u,c;s._type==="product"&&(i(s),A({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(c=(u=s.commission_percent)!=null?u:s.commissionPercent)!=null?c:""}),wn(!0))},lt=async()=>{if(be)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${be.id}`,b,"L\u1ED7i c\u1EADp nh\u1EADt"),E("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),wn(!1),i(null),Zt()}catch(s){E(s.message,"danger")}},gt=async s=>{const u=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${u} "${s.name}"?`))try{let c="";s._type==="product"?c=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?c=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(c=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(c,"L\u1ED7i x\xF3a"),E(`\u0110\xE3 x\xF3a ${u}`,"success"),Zt()}catch(c){E(c.message,"danger")}},ct=async s=>{try{const u=L?`${API_BASE}/api/products?id=${L.id}`:`${API_BASE}/api/products`;L?await window.KTM.api.putJSON(u,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(u,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),E(L?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),f(!1),P(null),Zt()}catch(u){E(u.message,"danger")}},Et="ktm_admin_data_cache_v1",St=1e3*60*10,Zt=async()=>{let s=null,u=!1;const c=window.KTM.cache.read(Et,{ttlMs:St,validate:Array.isArray});c.hit?(s=c.value,console.log("[CACHE] Using cache, items:",s.length),Ot(s),Y(s),ye(!1),u=!0):c.status==="miss"?console.log("[CACHE] No cache found"):c.status==="expired"||c.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):c.status==="error"&&console.error("[CACHE] Error parsing cache"),u||ye(!0);try{const I=async(Kt,bt)=>{try{const de=await window.KTM.api.getJSON(Kt,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return de!=null?de:bt}catch(de){return bt}},[R,v,S]=await Promise.all([I(`${API_BASE}/api/products?fields=search`,[]),I(`${API_BASE}/api/albums`,[]),I(`${API_BASE}/api/video-folders?withVideos=true`,[])]),Z=Array.isArray(R)?R.map(Kt=>({...Kt,_type:"product",_source:"database"})):[];Te(v);let Q=[];Array.isArray(v)&&v.length>0&&(await Promise.all(v.map(bt=>I(`${API_BASE}/api/albums/${bt.id}`,{})))).forEach((bt,de)=>{const ht=v[de];bt.images&&bt.images.length>0&&bt.images.forEach(ve=>{Q.push({id:ve.id,name:ve.caption||"\u1EA2nh t\u1EEB "+ht.title,image:ve.src,folder:ht.title,_type:"album",_source:"database"})})}),oe(S);let W=[];Array.isArray(S)&&S.forEach(Kt=>{Kt.videos&&Kt.videos.forEach(bt=>{W.push({id:bt.id,name:bt.title,folder:Kt.name,image:bt.thumb,youtubeId:bt.youtubeId,url:bt.url,_type:"video",_source:"database"})})});const et=[...Z,...Q,...W];(!s||JSON.stringify(et)!==JSON.stringify(s))&&(Ot(et),Y(et),window.KTM.cache.write(Et,et))}catch(I){console.error("Song song fetch error:",I)}ye(!1)};useEffect(()=>{Zt(),setTimeout(()=>{var u;return(u=Rt.current)==null?void 0:u.focus()},100);const s=u=>{var c,I;(u.ctrlKey||u.metaKey)&&u.key==="k"&&(u.preventDefault(),H(!0),setTimeout(()=>{var R;return(R=J.current)==null?void 0:R.focus()},0)),u.key==="/"&&!M&&((c=document.activeElement)==null?void 0:c.tagName)!=="INPUT"&&(u.preventDefault(),(I=Rt.current)==null||I.focus()),u.key==="Escape"&&M&&H(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[M]);const xt=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(u){return String(s!=null?s:"").toLowerCase()}},me=s=>{const c=xt(s).trim().split(/\s+/).filter(Boolean).map(Q=>{const W=String(Q||"").trim();return W?W.startsWith("#")?W.slice(1):W.startsWith("sdt:")?W.slice(4):W.startsWith("phone:")?W.slice(6):W:""}).filter(Boolean),I=c.includes("anh"),R=c.includes("video"),v=c.filter(Q=>Q!=="anh"&&Q!=="video"),S=v.join(" "),Z=new Set(["product"]);return I&&Z.add("album"),R&&Z.add("video"),{allowedTypes:Z,includeAlbum:I,includeVideo:R,contentTokens:v,cleanedQuery:S}},mt=(s,u,c)=>{var de,ht,ve,te,$;const I=Array.isArray(u)?u:[],R=xt(c).trim();if(!I.length&&!R)return 0;const v=xt((de=s==null?void 0:s.name)!=null?de:""),S=xt((ht=s==null?void 0:s.code)!=null?ht:""),Z=xt((ve=s==null?void 0:s.category)!=null?ve:""),Q=xt((te=s==null?void 0:s.note)!=null?te:""),W=xt(($=s==null?void 0:s.folder)!=null?$:"");if(!`${v} ${S} ${Z} ${Q} ${W}`.trim())return 0;const kt=v.replace(/\s+/g,""),Kt=R.replace(/\s+/g,"");let bt=0;R&&(v===R&&(bt+=220),v.includes(R)&&(bt+=140),v.startsWith(R)&&(bt+=160),Kt&&(kt===Kt?bt+=280:kt.startsWith(Kt)?bt+=180:kt.includes(Kt)&&(bt+=110)),S&&S===R&&(bt+=180),S&&S.includes(R)&&(bt+=90));for(const ee of I){if(!ee)continue;const yn=new RegExp(`(?:^|\\s)${ee.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`),Ke=String(ee).replace(/\s+/g,"");v.includes(ee)&&(bt+=35),yn.test(v)&&(bt+=25),Ke&&(kt===Ke?bt+=90:kt.startsWith(Ke)?bt+=50:kt.includes(Ke)&&(bt+=28)),S&&S.includes(ee)&&(bt+=20),S&&yn.test(S)&&(bt+=10),Z&&Z.includes(ee)&&(bt+=12),W&&W.includes(ee)&&(bt+=12),Q&&Q.includes(ee)&&(bt+=6)}return bt>0&&v&&(bt+=Math.max(0,10-Math.min(10,Math.floor(v.length/10)))),bt},Wt=(s,u,c)=>{const I=Array.isArray(s)?s:[];return I.length?I.map((v,S)=>({it:v,idx:S,score:mt(v,u,c)})).sort((v,S)=>S.score!==v.score?S.score-v.score:v.idx-S.idx).map(v=>v.it):[]},Me=async(s,u)=>{if(!(!Ce||u.length===0)){ae(!0);try{const c=u.map(R=>({id:R.id,name:R.name,price:R.price,category:R.category,note:R.note,folder:R.folder,_type:R._type})),I=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:c},"AI Search error");if(I&&I.matchedIds&&I.matchedIds.length>0){const{contentTokens:R,cleanedQuery:v}=me(s),S=new Set(I.matchedIds),Z=u.filter(Q=>S.has(Q.id)).sort((Q,W)=>mt(W,R,v)-mt(Q,R,v));Z.length>0&&Y(Z)}else I&&I.matchedIds&&I.matchedIds.length===0&&Y([])}catch(c){console.error("AI Search error:",c)}ae(!1)}},Ae=s=>{if(yt(s),N(s),Ge.current&&clearTimeout(Ge.current),Fe.current&&clearTimeout(Fe.current),C.current&&C.current.abort(),!s.trim()){xe(Ut);return}const c=`v2|${xt(s).trim().replace(/\s+/g,"")}|${Ut}`;if(at.current.has(c)){Y(at.current.get(c));return}const{allowedTypes:I,contentTokens:R,cleanedQuery:v}=me(s);Ge.current=setTimeout(()=>{const S=G.filter(W=>{if(!I.has(W==null?void 0:W._type))return!1;if(R.length===0)return!0;const et=mn(Object.entries(W).filter(([de])=>!de.startsWith("_")).map(([,de])=>String(de||"")).join(" ")),kt=W.phone?F(W.phone):"",Kt=`${et} ${kt}`.trim(),bt=Kt.replace(/\s+/g,"");return R.every(de=>{const ht=String(de||"").trim();return ht?Kt.includes(ht)||bt.includes(ht.replace(/\s+/g,"")):!0})});let Z=S;Ut!=="all"&&(Z=S.filter(W=>(W==null?void 0:W._type)===Ut));const Q=Wt(Z,R,v);if($e(s),hn(s,Q),at.current.size>20){const W=at.current.keys().next().value;at.current.delete(W)}at.current.set(c,Q),Y(Q),Ce&&v.length>=3&&(Fe.current=setTimeout(()=>{Me(v,Z)},500))},200)},xe=s=>{ue(s);const{allowedTypes:u,contentTokens:c}=me(B),{cleanedQuery:I}=me(B);let R=G.filter(v=>u.has(v==null?void 0:v._type));s!=="all"&&(R=R.filter(v=>(v==null?void 0:v._type)===s)),B.trim()&&c.length>0&&(R=R.filter(v=>{const S=xt(Object.entries(v).filter(([et])=>!et.startsWith("_")).map(([,et])=>String(et||"")).join(" ")),Z=v.phone?F(v.phone):"",Q=`${S} ${Z}`.trim(),W=Q.replace(/\s+/g,"");return c.every(et=>{const kt=String(et||"").trim();return kt?Q.includes(kt)||W.includes(kt.replace(/\s+/g,"")):!0})})),Y(Wt(R,c,I))},Ht=(s,u,c)=>{c&&c.item&&se(c.item,c.action||"copy"),window.KTM.clipboard.writeText(s).then(()=>{Gt(u),E("\u0110\xE3 copy!","success"),setTimeout(()=>Gt(null),1500)})},j=async(s,u,c)=>{try{c&&c.item&&se(c.item,c.action||"copy_image"),await window.KTM.clipboard.writeImageFromUrl(s),Gt(u+"-img"),E("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>Gt(null),1500)}catch(I){Ht(s,u+"-img",c)}},ut=s=>{let u=s.toLowerCase();const c=[],I=G.filter(S=>S._type==="product");if(u.includes("ty")||u.includes("xy lanh")){if(u.includes("gi\u1EEFa")||u.includes("giua")){const S=I.find(Z=>{var Q;return(Q=Z.name)==null?void 0:Q.toLowerCase().includes("xy lanh gi\u1EEFa")});S&&!c.find(Z=>Z.id===S.id)&&c.push(S)}if(u.includes("nghi\xEAng")||u.includes("nghieng")){const S=I.find(Z=>{var Q;return(Q=Z.name)==null?void 0:Q.toLowerCase().includes("xy lanh nghi\xEAng")});S&&!c.find(Z=>Z.id===S.id)&&c.push(S)}if(u.includes("\u1EE7i")||u.includes("ui")){const S=I.find(Z=>{var Q;return(Q=Z.name)==null?void 0:Q.toLowerCase().includes("xy lanh \u1EE7i")});S&&!c.find(Z=>Z.id===S.id)&&c.push(S)}}const R=u.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(R){const S=R[1],Z=R[2],Q=I.find(W=>{var kt;const et=((kt=W.name)==null?void 0:kt.toLowerCase())||"";return et.includes("combo")&&et.includes(`${S} tay`)&&(et.includes(`${Z} xy`)||et.includes(`${Z} xylanh`))});if(Q&&!c.find(W=>W.id===Q.id))c.push(Q);else{const W=I.find(et=>{var Kt;const kt=((Kt=et.name)==null?void 0:Kt.toLowerCase())||"";return kt.includes("combo")&&kt.includes(`${S} tay`)});W&&!c.find(et=>et.id===W.id)&&c.push(W)}}if(u.includes("combo")&&!R){const S=u.match(/combo.*?(\d+)\s*tay/);if(S){const Z=S[1];I.filter(W=>{var kt;const et=((kt=W.name)==null?void 0:kt.toLowerCase())||"";return et.includes("combo")&&et.includes(`${Z} tay`)}).forEach(W=>{c.find(et=>et.id===W.id)||c.push(W)})}}const v=u.match(/van\s*(\d+)\s*tay/);if(v&&!u.includes("ty")&&!u.includes("combo")){const S=v[1],Z=I.find(Q=>{var et;const W=((et=Q.name)==null?void 0:et.toLowerCase())||"";return W.includes(`van ${S} tay`)&&!W.includes("combo")});Z&&!c.find(Q=>Q.id===Z.id)&&c.push(Z)}return c.slice(0,4)},le=async s=>{if(!s.trim())return;const u={role:"user",content:s,attachments:[]};Ie(I=>[...I,u]),Ue(""),Mt(!0);const c=ut(s);setTimeout(()=>{var I;return(I=Ve.current)==null?void 0:I.scrollIntoView({behavior:"smooth"})},100);try{const R=G.filter(et=>et._type==="product").map(et=>{let kt=`- ${et.name}`;return et.code&&(kt+=` (M\xE3: ${et.code})`),et.price&&(kt+=` - Gi\xE1: ${et.price.replace(/[đ\s]/g,"")}\u0111`),et.category&&(kt+=` [${et.category}]`),et.note&&(kt+=` (${et.note})`),kt}).join(`
`),S=ce.slice(-6).map(et=>`${et.role==="user"?"Kh\xE1ch":"AI"}: ${et.content}`).join(`
`),Z=S?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${S}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${R}`:R,W=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:Z,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";Ie(et=>[...et,{role:"assistant",content:W,attachments:c}])}catch(I){console.error("AI Error:",I);const R=s.toLowerCase(),v=G.filter(Z=>{const Q=Object.values(Z).join(" ").toLowerCase();return R.split(" ").some(W=>Q.includes(W))});let S="";v.length>0?(S=`T\xECm th\u1EA5y ${v.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,v.slice(0,5).forEach(Z=>{S+=`\u2022 ${Z.name}`,Z.price&&(S+=` - ${Z.price.replace(/[đ\s]/g,"")}\u0111`),Z.note&&(S+=` (${Z.note})`),S+=`
`}),v.length>5&&(S+=`
...v\xE0 ${v.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):S='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',Ie(Z=>[...Z,{role:"assistant",content:S,attachments:v.slice(0,4)}])}Mt(!1),setTimeout(()=>{var I,R;(I=Ve.current)==null||I.scrollIntoView({behavior:"smooth"}),(R=on.current)==null||R.focus()},100)};function he({show:s,product:u,categories:c,onClose:I,onSave:R}){const[v,S]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Z,Q]=useState(!1),[W,et]=useState(!1),kt=useRef(null),Kt=tt=>window.KTM.money.formatVNDInputDigits(tt),bt=tt=>{const z=window.KTM.money.getDigits(String(tt!=null?tt:"")),pt=Number(z);return z&&Number.isFinite(pt)?Math.trunc(pt):0},de=(tt,z)=>{if(tt==null||tt==="")return[];let pt=tt;if(typeof pt=="string"){const Dt=pt.trim();if(!Dt)return[];try{pt=JSON.parse(Dt)}catch(Tt){return[]}}if(!Array.isArray(pt))return[];const zt=bt(z);return pt.map(Dt=>{var Ne;if(!Dt||typeof Dt!="object")return null;const Tt=String((Ne=Dt.name)!=null?Ne:"").trim(),ie=(Array.isArray(Dt.options)?Dt.options:[]).map(Pe=>{var _n,$n,Dn,Pn,Bn,Un,ka;if(!Pe||typeof Pe!="object")return null;const qe=String((_n=Pe.label)!=null?_n:"").trim();if(!qe)return null;const nn=(Bn=(Pn=(Dn=($n=Pe.price)!=null?$n:Pe.priceValue)!=null?Dn:Pe.unit_price)!=null?Pn:Pe.unitPrice)!=null?Bn:null,Tn=Number(nn);let Sn=Number.isFinite(Tn)?Math.trunc(Tn):null;if(Sn==null){const Wa=(ka=(Un=Pe.price_delta)!=null?Un:Pe.priceDelta)!=null?ka:null,Ca=Number(Wa);Number.isFinite(Ca)&&(Sn=zt+Math.trunc(Ca))}Sn==null&&(Sn=zt);const xn=String(Math.max(0,Math.trunc(Number(Sn)||0)));return{label:qe,price:Math.max(0,Math.trunc(Number(Sn)||0)),priceDigits:xn}}).filter(Boolean);return{name:Tt||"Bi\u1EBFn th\u1EC3",options:ie}}).filter(Boolean)},ht=tt=>{if(tt==null||tt==="")return[];let z=tt;if(typeof z=="string"){const pt=z.trim();if(!pt)return[];try{z=JSON.parse(pt)}catch(zt){return[]}}return z&&typeof z=="object"&&!Array.isArray(z)&&(z=Object.entries(z).map(([pt,zt])=>({key:pt,value:zt}))),Array.isArray(z)?z.map(pt=>{var ie,Ne,Pe,qe,nn;if(!pt||typeof pt!="object")return null;const zt=String((Pe=(Ne=(ie=pt.key)!=null?ie:pt.name)!=null?Ne:pt.label)!=null?Pe:"").trim(),Dt=String((qe=pt.value)!=null?qe:"").trim(),Tt=String((nn=pt.unit)!=null?nn:"").trim();return zt?{key:zt,value:Dt,unit:Tt}:null}).filter(Boolean):[]};useEffect(()=>{var tt,z;if(u)if(S({name:u.name||"",code:u.code||"",price:u.price||"",image:u.image||"",category:u.category||"",note:u.note||"",sort_order:u.sort_order||0,commission_percent:(z=(tt=u.commission_percent)!=null?tt:u.commissionPercent)!=null?z:5,variants:de(u.variants,u.price),attributes:ht(u.attributes)}),u.price){const pt=window.KTM.money.getDigits(u.price);Ke(pt),S(zt=>({...zt,price:Kt(pt)}))}else Ke("");else S({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Ke("")},[u,s]);const ve=tt=>{S(z=>{var ie;const pt=bt(z.price),zt=String(pt),Dt=Array.isArray(z.variants)?[...z.variants]:[],Tt={...Dt[tt]||{},options:Array.isArray((ie=Dt[tt])==null?void 0:ie.options)?[...Dt[tt].options]:[]};return Tt.options=Tt.options.map(Ne=>({label:String((Ne==null?void 0:Ne.label)||""),price:pt,priceDigits:zt})),Dt[tt]=Tt,{...z,variants:Dt}})},te=()=>{S(tt=>{const z=bt(tt.price),pt=String(z),Dt=(Array.isArray(tt.variants)?[...tt.variants]:[]).map(Tt=>{const ie=(Array.isArray(Tt==null?void 0:Tt.options)?Tt.options:[]).map(Ne=>({label:String((Ne==null?void 0:Ne.label)||""),price:z,priceDigits:pt}));return{name:String((Tt==null?void 0:Tt.name)||"Bi\u1EBFn th\u1EC3"),options:ie}});return{...tt,variants:Dt}})},[$,ee]=React.useState(""),[yn,Ke]=React.useState(""),vn=tt=>{const z=window.KTM.money.nextPriceInputState(tt.target.value,yn);Ke(z.digits),S({...v,price:z.price})},rn=async(tt,z=2)=>{const pt=z*1024*1024;if(tt.size<=pt)return tt;try{const zt=await createImageBitmap(tt),Dt=document.createElement("canvas");let Tt=zt.width,ie=zt.height;const Ne=1200;return(Tt>Ne||ie>Ne)&&(Tt>ie?(ie=Math.round(ie/Tt*Ne),Tt=Ne):(Tt=Math.round(Tt/ie*Ne),ie=Ne)),Dt.width=Tt,Dt.height=ie,Dt.getContext("2d").drawImage(zt,0,0,Tt,ie),zt.close(),new Promise((qe,nn)=>{Dt.toBlob(Tn=>{Tn?qe(new File([Tn],tt.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):nn(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(zt){throw console.error("Compress error:",zt),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},dn=async tt=>{var zt;const z=tt.target.files[0];if(!z)return;if(!(z.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(z.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}et(!0);try{const Dt=await rn(z),Tt=await window.KTM.cloudinary.uploadImage({file:Dt,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!Tt.secure_url)throw console.error("Cloudinary error:",Tt),new Error(((zt=Tt.error)==null?void 0:zt.message)||"Upload failed");S(ie=>({...ie,image:Tt.secure_url}))}catch(Dt){console.error("Upload error:",Dt),alert("L\u1ED7i upload \u1EA3nh: "+Dt.message)}et(!1),tt.target.value=""},Je=async tt=>{tt.preventDefault(),Q(!0);const z={...v,variants:de(v.variants,v.price),attributes:ht(v.attributes)};await R(z),Q(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),u?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:I})),React.createElement("form",{onSubmit:Je},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:v.name,onChange:tt=>S({...v,name:tt.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:v.code,onChange:tt=>S({...v,code:tt.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:v.price,onChange:vn,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:v.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:tt=>S({...v,commission_percent:tt.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:v.category,onChange:tt=>S({...v,category:tt.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),c.map(tt=>React.createElement("option",{key:tt,value:tt},tt)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:v.note,onChange:tt=>S({...v,note:tt.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(v.attributes)?v.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(v.attributes)?v.attributes:[]).map((tt,z)=>React.createElement("div",{key:z,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(tt==null?void 0:tt.key)||"",onChange:pt=>{const zt=pt.target.value;S(Dt=>{const Tt=Array.isArray(Dt.attributes)?[...Dt.attributes]:[];return Tt[z]={...Tt[z]||{},key:zt},{...Dt,attributes:Tt}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(tt==null?void 0:tt.value)||"",onChange:pt=>{const zt=pt.target.value;S(Dt=>{const Tt=Array.isArray(Dt.attributes)?[...Dt.attributes]:[];return Tt[z]={...Tt[z]||{},value:zt},{...Dt,attributes:Tt}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(tt==null?void 0:tt.unit)||"",onChange:pt=>{const zt=pt.target.value;S(Dt=>{const Tt=Array.isArray(Dt.attributes)?[...Dt.attributes]:[];return Tt[z]={...Tt[z]||{},unit:zt},{...Dt,attributes:Tt}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{S(pt=>{const zt=Array.isArray(pt.attributes)?[...pt.attributes]:[];return zt.splice(z,1),{...pt,attributes:zt}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{S(tt=>{const z=Array.isArray(tt.attributes)?[...tt.attributes]:[];return z.push({key:"",value:"",unit:""}),{...tt,attributes:z}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(v.variants)?v.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(v.variants)?v.variants:[]).map((tt,z)=>React.createElement("div",{key:z,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(tt==null?void 0:tt.name)||"",onChange:pt=>{const zt=pt.target.value;S(Dt=>{var ie;const Tt=Array.isArray(Dt.variants)?[...Dt.variants]:[];return Tt[z]={...Tt[z]||{},name:zt,options:Array.isArray((ie=Tt[z])==null?void 0:ie.options)?Tt[z].options:[]},{...Dt,variants:Tt}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ve(z),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(tt==null?void 0:tt.options)||tt.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{S(pt=>{const zt=Array.isArray(pt.variants)?[...pt.variants]:[];return zt.splice(z,1),{...pt,variants:zt}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(tt==null?void 0:tt.options)?tt.options:[]).map((pt,zt)=>{var Dt,Tt;return React.createElement("div",{key:zt,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(pt==null?void 0:pt.label)||"",onChange:ie=>{const Ne=ie.target.value;S(Pe=>{var xn,_n,$n,Dn,Pn;const qe=Array.isArray(Pe.variants)?[...Pe.variants]:[],nn={...qe[z]||{},options:Array.isArray((xn=qe[z])==null?void 0:xn.options)?[...qe[z].options]:[]},Tn=Number(($n=(_n=nn.options[zt])==null?void 0:_n.price)!=null?$n:0)||0,Sn=String((Pn=(Dn=nn.options[zt])==null?void 0:Dn.priceDigits)!=null?Pn:Math.max(0,Math.trunc(Tn)));return nn.options[zt]={...nn.options[zt]||{},label:Ne,price:Math.max(0,Math.trunc(Tn)),priceDigits:Sn},qe[z]=nn,{...Pe,variants:qe}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Kt(String((Tt=pt==null?void 0:pt.priceDigits)!=null?Tt:window.KTM.money.getDigits(String((Dt=pt==null?void 0:pt.price)!=null?Dt:"")))),onChange:ie=>{S(Ne=>{var $n,Dn,Pn,Bn,Un;const Pe=String((Dn=pt==null?void 0:pt.priceDigits)!=null?Dn:window.KTM.money.getDigits(String(($n=pt==null?void 0:pt.price)!=null?$n:""))),qe=window.KTM.money.nextPriceInputState(ie.target.value,Pe),nn=String((Pn=qe.digits)!=null?Pn:""),Tn=Number(nn),Sn=Number.isFinite(Tn)?Math.max(0,Math.trunc(Tn)):0,xn=Array.isArray(Ne.variants)?[...Ne.variants]:[],_n={...xn[z]||{},options:Array.isArray((Bn=xn[z])==null?void 0:Bn.options)?[...xn[z].options]:[]};return _n.options[zt]={..._n.options[zt]||{},label:String(((Un=_n.options[zt])==null?void 0:Un.label)||""),price:Sn,priceDigits:nn},xn[z]=_n,{...Ne,variants:xn}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{S(ie=>{var qe;const Ne=Array.isArray(ie.variants)?[...ie.variants]:[],Pe={...Ne[z]||{},options:Array.isArray((qe=Ne[z])==null?void 0:qe.options)?[...Ne[z].options]:[]};return Pe.options.splice(zt,1),Ne[z]=Pe,{...ie,variants:Ne}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{S(pt=>{var ie;const zt=Array.isArray(pt.variants)?[...pt.variants]:[],Dt={...zt[z]||{},options:Array.isArray((ie=zt[z])==null?void 0:ie.options)?[...zt[z].options]:[]},Tt=bt(pt.price);return Dt.options.push({label:"",price:Tt,priceDigits:String(Tt)}),zt[z]=Dt,{...pt,variants:zt}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{S(tt=>{const z=bt(tt.price),pt=Array.isArray(tt.variants)?[...tt.variants]:[],zt=String(z);return pt.push({name:"Size",options:[{label:"S",price:z,priceDigits:zt},{label:"M",price:z,priceDigits:zt},{label:"L",price:z,priceDigits:zt}]}),{...tt,variants:pt}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:te,disabled:!Array.isArray(v.variants)||v.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},v.image?React.createElement(React.Fragment,null,React.createElement("img",{src:v.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>S({...v,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var tt;return(tt=kt.current)==null?void 0:tt.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:kt,type:"file",accept:"image/*",className:"d-none",onChange:dn}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var tt;return(tt=kt.current)==null?void 0:tt.click()},disabled:W,style:{borderRadius:"10px"}},W?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:v.image,onChange:tt=>S({...v,image:tt.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:I,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Z,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const ke=s=>window.KTM.money.formatVND(s),Be=s=>{if(s==null||s==="")return[];let u=s;if(typeof u=="string"){const c=u.trim();if(!c)return[];try{u=JSON.parse(c)}catch(I){return[]}}return Array.isArray(u)?u:[]},fe=s=>{if(s==null||s==="")return[];let u=s;if(typeof u=="string"){const c=u.trim();if(!c)return[];try{u=JSON.parse(c)}catch(I){return[]}}return u&&typeof u=="object"&&!Array.isArray(u)&&(u=Object.entries(u).map(([c,I])=>({key:c,value:I}))),Array.isArray(u)?u:[]},Re=(s,u={})=>{var v;const c=fe(s).map(S=>{var Z,Q,W,et,kt;return{key:String((W=(Q=(Z=S==null?void 0:S.key)!=null?Z:S==null?void 0:S.name)!=null?Q:S==null?void 0:S.label)!=null?W:"").trim(),value:String((et=S==null?void 0:S.value)!=null?et:"").trim(),unit:String((kt=S==null?void 0:S.unit)!=null?kt:"").trim()}}).filter(S=>!!S.key);if(!c.length)return null;const I=!!u.compact,R=String((v=u.className)!=null?v:"").trim();return React.createElement("div",{className:`ktm-variants-preview${I?" compact":""}${R?" "+R:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},c.map((S,Z)=>{const Q=S.key,W=`${S.value||""}${S.unit?(S.value?" ":"")+S.unit:""}`.trim();return React.createElement("div",{key:`${Q}-${Z}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Q),W?React.createElement("span",{className:"ktm-chip ktm-chip-option"},W):null)})))},tn=(s,u={})=>{var Q;const c=Be(s).map(W=>{var et;return{name:String((et=W==null?void 0:W.name)!=null?et:"").trim(),options:Array.isArray(W==null?void 0:W.options)?W.options:[]}}).map(W=>({...W,options:W.options.map(et=>{var kt;return{label:String((kt=et==null?void 0:et.label)!=null?kt:"").trim(),price:Number(et==null?void 0:et.price)}}).filter(et=>!!et.label)})).filter(W=>W.options.length>0);if(!c.length)return null;const I=Number.isFinite(u.maxGroups)?Math.max(1,Math.trunc(u.maxGroups)):c.length,R=Number.isFinite(u.maxOptionsPerGroup)?Math.max(1,Math.trunc(u.maxOptionsPerGroup)):3,v=!!u.compact,S=String((Q=u.className)!=null?Q:"").trim(),Z=c.slice(0,I);return React.createElement("div",{className:`ktm-variants-preview${v?" compact":""}${S?" "+S:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Z.map((W,et)=>{const kt=W.name||"Bi\u1EBFn th\u1EC3",Kt=W.options.slice(0,R),bt=W.options.length-Kt.length;return React.createElement("div",{key:`${kt}-${et}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},kt),Kt.map((de,ht)=>{const ve=de.price,te=Number.isFinite(ve)&&ve>=0?ke(Math.trunc(ve)):"",$=te?`${de.label} \xB7 ${te}`:de.label;return React.createElement("span",{key:`${kt}-${et}-${ht}`,className:"ktm-chip ktm-chip-option"},$)}),bt>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",bt))})))},je=(s,u)=>{const c=s._type==="product",I=s._type==="album",R=s._type==="video",v=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),S=c?Re(s.attributes,{compact:ot==="grid",className:ot==="grid"?"meta text-muted":"text-muted"}):null,Z=c?tn(s.variants,{compact:ot==="grid",maxOptionsPerGroup:999,className:ot==="grid"?"meta text-muted":"text-muted"}):null;return ot==="grid"?React.createElement("div",{key:s.id||u,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>{se(s,"preview"),An({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${R?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${c?"product":I?"album":"video"}`},c?"SP":I?"\u1EA2nh":"Video"),v&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),S&&React.createElement("div",{style:{marginTop:2}},S),Z&&React.createElement("div",{style:{marginTop:2}},Z),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:Lt===s.id+"-img"?"copied":"",onClick:()=>j(s.image,s.id,{item:s,action:"copy_image"})},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:Lt===s.id+"-price"?"copied":"",onClick:()=>Ht(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||u,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${c?"product":I?"album":"video"}`},c?"S\u1EA3n ph\u1EA9m":I?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>{se(s,"preview"),An({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${R?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),v&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),S&&React.createElement("div",{style:{marginTop:4}},S),Z&&React.createElement("div",{style:{marginTop:4}},Z)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),R&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},c&&React.createElement("button",{onClick:()=>{se(s,"create_order"),q&&q("orders","create",{productId:s.id})}},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:Lt===s.id+"-price"?"copied":"",onClick:()=>Ht(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:Lt===s.id+"-name"?"copied":"",onClick:()=>Ht(s.name,s.id+"-name",{item:s,action:"copy_name"})},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),R&&s.youtubeId&&React.createElement("button",{className:Lt===s.id+"-yt"?"copied":"",onClick:()=>Ht(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),c&&React.createElement("button",{className:"action-edit",onClick:()=>U(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>gt(s)},React.createElement("i",{className:"fas fa-trash"}))))},[en,pn]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"search-suggestions mobile-only"},React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"G\u1EE3i \xFD nhanh"),React.createElement("div",{className:"search-suggestions-row"},[{label:"van 2 tay",query:"van 2 tay"},{label:"combo r\u1EBB",query:"combo r\u1EBB"},{label:"xylanh",query:"xylanh"},{label:"sdt:\u2026",query:"sdt:",caret:"end",addToHistory:!1},{label:"#m\xE3\u2026",query:"#",caret:"end",addToHistory:!1}].map(s=>React.createElement("button",{key:s.label,type:"button",className:"suggestion-chip",onClick:()=>ln(s.query,{caret:s.caret,addToHistory:s.addToHistory,focus:!1})},s.label)))),Cn.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"S\u1EA3n ph\u1EA9m hay t\xECm"),React.createElement("div",{className:"search-suggestions-row"},Cn.map(s=>{var R,v;const u=(((R=s.item)==null?void 0:R.name)||s.name||"").trim();if(!u)return null;const c=String(((v=s.item)==null?void 0:v.code)||s.code||"").trim(),I=c?`#${c}`:u;return React.createElement("button",{key:s.id,type:"button",className:"suggestion-chip suggestion-chip-popular",onClick:()=>{s.item&&se(s.item,"suggestion"),ln(I,{caret:"end",focus:!1})},title:c?`#${c}`:u},u)}))),We.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"T\xECm g\u1EA7n \u0111\xE2y / hay d\xF9ng"),React.createElement("div",{className:"search-suggestions-row"},We.map(s=>React.createElement("button",{key:s.q,type:"button",className:"suggestion-chip suggestion-chip-query",onClick:()=>ln(s.q,{caret:"end",focus:!1}),title:`${s.q} (${s.count})`},s.q))))),React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,it.length)," k\u1EBFt qu\u1EA3",Ce&&B.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Ut!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Ut==="product"?"S\u1EA3n ph\u1EA9m":Ut==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${ot==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>jt("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${ot==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>jt("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},X?React.createElement("div",null,[...Array(8)].map((s,u)=>React.createElement("div",{key:u,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):it.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',B,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{yt(""),Ae("")}},"Xem t\u1EA5t c\u1EA3")):ot==="grid"?React.createElement("div",{className:"product-grid-mobile"},it.map((s,u)=>je(s,u))):React.createElement("div",null,it.map((s,u)=>je(s,u)))),en&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>pn(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Ut==="all"?"active":""}`,onClick:()=>{xe("all"),pn(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Ut==="product"?"active":""}`,onClick:()=>{xe("product"),pn(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Ut==="album"?"active":""}`,onClick:()=>{xe("album"),pn(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Ut==="video"?"active":""}`,onClick:()=>{xe("video"),pn(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Ce,onChange:s=>_e(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:Rt,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:B,onChange:s=>Ae(s.target.value)}),React.createElement("button",{className:`filter-btn ${en||Ut!=="all"?"active":""}`,onClick:()=>pn(!en)},React.createElement("i",{className:"fas fa-filter"})))),M&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>H(!1)},React.createElement("div",{className:"search-palette",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:J,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:At,onChange:s=>Ae(s.target.value),onKeyDown:s=>{s.key==="Enter"&&it.length>0?(Qt(At),H(!1)):s.key==="Escape"&&H(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>H(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((s,u)=>React.createElement("span",{key:s,className:`filter-chip ${Ut===["all","product","album","video"][u]?"active":""}`,onClick:()=>{xe(["all","product","album","video"][u])}},s)))),dt.length>0&&!At.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},dt.map((s,u)=>React.createElement("div",{key:u,className:"palette-item",onClick:()=>{Ae(s),Qt(s)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,s),React.createElement("button",{className:"unsave-btn",onClick:c=>{c.stopPropagation(),cn(s)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),ft.length>0&&!At.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},ft.map((s,u)=>React.createElement("div",{key:u,className:"palette-item",onClick:()=>{Ae(s)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,s),React.createElement("button",{className:"save-btn",onClick:c=>{c.stopPropagation(),cn(s)}},React.createElement("i",{className:`fas fa-star${dt.includes(s)?"":"-o"}`})))))),At.trim()&&it.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",it.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},it.slice(0,8).map((s,u)=>React.createElement("div",{key:s.id||u,className:"palette-result-item",onClick:()=>{Qt(At),H(!1)}},s.image&&React.createElement("img",{src:s.image,alt:s.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},s.name),s.price&&React.createElement("div",{className:"result-meta"},s.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:c=>{c.stopPropagation(),cn(At)}},React.createElement("i",{className:`fas fa-star${dt.includes(At)?"":"-o"}`})))))),At.trim()&&it.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',At,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:l?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>Ft(!0),onTouchStart:()=>Ft(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),It&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>Ft(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},ce.map((s,u)=>React.createElement("div",{key:u,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:Lt===`chat-${u}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:Lt===`chat-${u}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),Gt(`chat-${u}`),setTimeout(()=>Gt(null),1500)}},React.createElement("i",{className:`fas ${Lt===`chat-${u}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((c,I)=>React.createElement("div",{key:I,style:{width:70},className:"text-center"},c.image&&React.createElement("img",{src:c.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>An({url:c.image,name:c.name,price:c.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},c.name),c.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},c.price.replace(/[đ\s]/g,""),"\u0111"))))))),Le&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Ve})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>le(s),disabled:Le,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),le(pe)},className:"chat-input-wrap"},React.createElement("input",{ref:on,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:pe,onChange:s=>Ue(s.target.value),disabled:Le}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Le||!pe.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),re&&React.createElement("div",{className:"preview-modal",onClick:()=>An(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>An(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:re.url,alt:re.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},re.name),re.price&&React.createElement("div",{className:"price"},re.price.replace(/[đ\s]/g,""),"\u0111"),re.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},re.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:Lt==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:Lt==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>j(re.url,"preview")},React.createElement("i",{className:`fas ${Lt==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),re.price&&React.createElement("button",{className:Lt==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Ht(re.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${Lt==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(he,{show:g,product:L,categories:Xt,onClose:()=>{f(!1),P(null)},onSave:ct}),React.createElement("div",{className:`fab-container mobile-only ${l?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{x(!1),f(!0),P(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{x(!1),q&&q("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${l?"open":""}`,onClick:()=>x(!l)},React.createElement("i",{className:"fas fa-plus"}))),fn&&be&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>wn(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:b.name,onChange:s=>A({...b,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:b.code,onChange:s=>A({...b,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:b.price,onChange:s=>A({...b,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:b.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>A({...b,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:b.category,onChange:s=>A({...b,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),D.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:b.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>A({...b,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>wn(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:lt},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:E,showToast:q}){const[B,yt]=useState([]),[it,Y]=useState([]),[G,Ot]=useState(!0),[Xt,Ct]=useState(null),[Ut,ue]=useState(!1),[Lt,Gt]=useState(null),[ot,jt]=useState(!1),[X,ye]=useState(null),[we,Te]=useState(!1),[Jt,oe]=useState(null),[Rt,Ce]=useState(!1),[_e,sn]=useState(!1),[ae,Fe]=useState(null),[Ge,C]=useState(!1),[M,H]=useState(null),[ft,vt]=useState([]);useEffect(()=>{dt()},[]);const dt=async(F=null)=>{Ot(!0);try{const rt=F?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${F}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Qt=await window.KTM.api.getJSON(rt,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");yt(Array.isArray(Qt)?Qt:[])}catch(rt){console.error(rt),q("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}Ot(!1)},wt=async F=>{try{const rt=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${F}`,"L\u1ED7i t\u1EA3i video");Y(Array.isArray(rt)?rt:[])}catch(rt){console.error(rt)}},At=async F=>{if(F===0)return;const rt=[...B];[rt[F-1],rt[F]]=[rt[F],rt[F-1]],yt(rt),await J(rt)},N=async F=>{if(F===B.length-1)return;const rt=[...B];[rt[F],rt[F+1]]=[rt[F+1],rt[F]],yt(rt),await J(rt)},J=async F=>{try{await Promise.all(F.map((rt,Qt)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${rt.id}`,{sortOrder:Qt},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),q("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(rt){q("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),dt(M==null?void 0:M.id)}},at=async F=>{if(F===0)return;const rt=[...it];[rt[F-1],rt[F]]=[rt[F],rt[F-1]],Y(rt),await qt(rt)},_t=async F=>{if(F===it.length-1)return;const rt=[...it];[rt[F],rt[F+1]]=[rt[F+1],rt[F]],Y(rt),await qt(rt)},qt=async F=>{try{await Promise.all(F.map((rt,Qt)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${rt.id}`,{sort_order:Qt},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),q("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(rt){q("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),wt(Xt.id)}},Vt=()=>{Gt(null),ue(!0)},$t=F=>{Fe(F),sn(!0),C(!0)},It=async(F,rt="modal")=>{try{!Lt&&M&&(F.parent_id=M.id);const Qt=Lt?`${API_BASE}/api/video-folders/${Lt.id}`:`${API_BASE}/api/video-folders`;Lt?await window.KTM.api.putJSON(Qt,F,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Qt,F,"L\u1ED7i l\u01B0u folder"),q(Lt?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),rt==="drawer"?(C(!1),Gt(null),dt(M==null?void 0:M.id),Lt&&ae&&Fe({...ae,...F})):(ue(!1),Gt(null),dt(M==null?void 0:M.id))}catch(Qt){q(Qt.message,"danger")}},Ft=async F=>{const rt=F.subfolderCount>0?`X\xF3a folder "${F.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${F.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(rt))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${F.id}`,"L\u1ED7i x\xF3a folder"),q("\u0110\xE3 x\xF3a folder","success"),Ct(null),dt(M==null?void 0:M.id)}catch(Qt){q("L\u1ED7i x\xF3a folder","danger")}},ce=F=>{F.subfolderCount>0?(vt(rt=>[...rt,F]),H(F),dt(F.id)):(Ct(F),Y(F.videos||[]))},Ie=F=>{if(F==="root")vt([]),H(null),dt(null);else if(F){const rt=ft.findIndex(Qt=>Qt.id===F.id);rt>=0&&(vt(ft.slice(0,rt+1)),H(F),dt(F.id))}else{const rt=[...ft];rt.pop();const Qt=rt[rt.length-1]||null;vt(rt),H(Qt),dt(Qt==null?void 0:Qt.id)}},pe=()=>{sn(!1),C(!1),Fe(null)},Ue=()=>{Te(!1),Ce(!1),oe(null)},Le=()=>{ye(null),jt(!0)},Mt=F=>{oe(F),Te(!0),Ce(!0)},Ve=async(F,rt="modal")=>{try{F.folder_id=Xt==null?void 0:Xt.id;const Qt=X?`${API_BASE}/api/videos/${X.id}`:`${API_BASE}/api/videos`;X?await window.KTM.api.putJSON(Qt,F,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Qt,F,"L\u1ED7i l\u01B0u video"),q(X?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),rt==="drawer"?(Ce(!1),ye(null),dt(),Xt&&wt(Xt.id),X&&Jt&&oe({...Jt,...F})):(jt(!1),ye(null),dt(),Xt&&wt(Xt.id))}catch(Qt){q(Qt.message,"danger")}},on=async F=>{if(confirm(`X\xF3a video "${F.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${F.id}`,"L\u1ED7i x\xF3a video"),q("\u0110\xE3 x\xF3a video","success"),dt(),Xt&&wt(Xt.id)}catch(rt){q("L\u1ED7i x\xF3a video","danger")}},mn=F=>{const rt=`https://www.youtube.com/watch?v=${F.youtubeId}`;window.KTM.clipboard.writeText(rt).then(()=>{q("\u0110\xE3 copy link!","success")}).catch(()=>{q("Kh\xF4ng th\u1EC3 copy link","danger")})};return Xt?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Ct(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${Xt.slug==="shorts"?"text-danger":"text-warning"}`}),Xt.name)),React.createElement("button",{className:"btn btn-warning",onClick:Le},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),it.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},it.map((F,rt)=>React.createElement("div",{key:F.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>at(rt),disabled:rt===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},rt+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>_t(rt),disabled:rt===it.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:F.thumb,className:"card-img-top",alt:F.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${F.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:F.title},F.title),React.createElement("small",{className:"text-muted"},F.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>mn(F),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Mt(F),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>on(F),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:ot,video:X,onClose:()=>jt(!1),onSave:Ve}),React.createElement(AdminDrawer,{open:_e,title:ae?ae.name:"Folder",subtitle:ae?`${ae.subfolderCount||0} subfolder \u2022 ${ae.videoCount||0} videos`:"",onClose:pe,footer:Ge?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:pe},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{ae&&It({name:ae.name||"",description:ae.description||"",sortOrder:ae.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):ae?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(ae.name),q("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{C(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${ae.name}"?`)&&(Ft(ae),pe())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Ge&&ae?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:ae.name||"",onChange:F=>Fe({...ae,name:F.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:ae.description||"",onChange:F=>Fe({...ae,description:F.target.value})}))):ae?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},ae.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},ae.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},ae.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},ae.videoCount||0))),ae.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,ae.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:we,title:Jt?Jt.title:"Video",subtitle:Jt?`${Jt.youtubeId}`:"",onClose:Ue,footer:Rt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:Ue},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Jt&&Ve({youtube_url:`https://www.youtube.com/watch?v=${Jt.youtubeId}`,title:Jt.title||"",thumbnail_url:Jt.thumb||"",sort_order:Jt.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Jt?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const F=`https://www.youtube.com/watch?v=${Jt.youtubeId}`;window.KTM.clipboard.writeText(F).then(()=>{q("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Ce(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${Jt.title}"?`)&&(on(Jt),Ue())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Rt&&Jt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:Jt.title||"",onChange:F=>oe({...Jt,title:F.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:Jt.youtubeId||"",onChange:F=>oe({...Jt,youtubeId:F.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Jt.sortOrder||0,onChange:F=>oe({...Jt,sortOrder:parseInt(F.target.value)||0})}))):Jt?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},Jt.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},Jt.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},Jt.sortOrder||0))),Jt.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:Jt.thumb,alt:Jt.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},M&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Ie()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),M?M.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:Vt},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),ft.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:F=>{F.preventDefault(),Ie("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ft.map((F,rt)=>React.createElement("li",{key:F.id,className:`breadcrumb-item ${rt===ft.length-1?"active":""}`},rt===ft.length-1?F.name:React.createElement("a",{href:"#",onClick:Qt=>{Qt.preventDefault(),Ie(F)},className:"text-warning"},F.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),G?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):B.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},M?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Vt},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",M?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},B.map((F,rt)=>{var Qt,cn,un,Qe;return React.createElement("div",{key:F.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Ze=>{Ze.stopPropagation(),At(rt)},disabled:rt===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},rt+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Ze=>{Ze.stopPropagation(),N(rt)},disabled:rt===B.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>ce(F),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${F.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},F.name),React.createElement("p",{className:"text-muted mb-0"},F.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),F.subfolderCount," folder"),F.subfolderCount>0&&(F.videoCount>0||((Qt=F.videos)==null?void 0:Qt.length)>0)&&" \u2022 ",(F.videoCount>0||((cn=F.videos)==null?void 0:cn.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),F.videoCount||((un=F.videos)==null?void 0:un.length)||0," videos"),F.subfolderCount===0&&!F.videoCount&&!((Qe=F.videos)!=null&&Qe.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Ze=>{Ze.stopPropagation(),$t(F)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Ze=>{Ze.stopPropagation(),Ft(F)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Ut,folder:Lt,onClose:()=>ue(!1),onSave:It}))}function VideoFolderModal({show:E,folder:q,onClose:B,onSave:yt}){const[it,Y]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[G,Ot]=useState(!1),[Xt,Ct]=useState(!1);useEffect(()=>{Y(q?{name:q.name||"",description:q.description||"",sortOrder:q.sortOrder||0,coverImage:q.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[q,E]);const Ut=async Lt=>{const Gt=Lt.target.files[0];if(Gt){Ct(!0);try{const ot=await window.KTM.cloudinary.uploadImage({file:Gt,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});ot.secure_url&&Y(jt=>({...jt,coverImage:ot.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(ot){console.error("Cloudinary upload error:",ot),alert("L\u1ED7i upload \u1EA3nh: "+(ot.message||ot))}finally{Ct(!1)}}},ue=async Lt=>{Lt.preventDefault(),Ot(!0);const Gt={...it,variants:normalizeVariants(it.variants,it.price),attributes:normalizeAttributes(it.attributes)};await yt(Gt),Ot(!1)};return E?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},q?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:B})),React.createElement("form",{onSubmit:ue},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:it.name,onChange:Lt=>Y({...it,name:Lt.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:it.description,onChange:Lt=>Y({...it,description:Lt.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:it.sortOrder,onChange:Lt=>Y({...it,sortOrder:parseInt(Lt.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},it.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:it.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>Y({...it,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Ut,disabled:Xt}),Xt&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:it.coverImage,onChange:Lt=>Y({...it,coverImage:Lt.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:B},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:G},G?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:E,settings:q}){const[B,yt]=useState([]),[it,Y]=useState(!0),[G,Ot]=useState(!1),[Xt,Ct]=useState(null),[Ut,ue]=useState(""),[Lt,Gt]=useState(""),[ot,jt]=useState(!1),[X,ye]=useState(null),we=normalizeShipPercent(q==null?void 0:q.ship_percent),{parseMoney:Te,formatVND:Jt}=window.KTM.money,oe=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Rt()},[]);const Rt=async()=>{Y(!0);try{const N=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");yt(Array.isArray(N)?N:[])}catch(N){console.error(N),E("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}Y(!1)},Ce=()=>{Ct(null),Ot(!0)},_e=N=>{Ct(N),Ot(!0)},sn=N=>{N&&(ye(N),jt(!0))},ae=()=>{jt(!1)},Fe=async N=>{if(!(!N||!N.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:N},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),E(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Rt()}catch(J){E("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},Ge=async N=>{try{const J=Xt?`${API_BASE}/api/products?id=${Xt.id}`:`${API_BASE}/api/products`;Xt?await window.KTM.api.putJSON(J,N,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(J,N,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),E(Xt?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Ot(!1),Rt()}catch(J){E(J.message,"danger")}},C=async N=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${N.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${N.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),E("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Rt()}catch(J){E(J.message,"danger")}},M=B.filter(N=>{const J=!Ut||N.name.toLowerCase().includes(Ut.toLowerCase())||N.code&&N.code.toLowerCase().includes(Ut.toLowerCase()),at=!Lt||N.category===Lt;return J&&at}),H=N=>{var _t;const J=(_t=N==null?void 0:N.commission_percent)!=null?_t:N==null?void 0:N.commissionPercent,at=J===""||J==null?NaN:Number(J);return Number.isFinite(at)?Math.max(0,Math.min(100,at)):5},ft=N=>{const J=H(N),at=Number.isInteger(J)?String(J):String(Math.round(J*100)/100),_t=Te(N==null?void 0:N.price);if(!Number.isFinite(_t)||_t<=0)return`${at}%`;const qt=(Number(J)||0)/100,$t=window.KTM.money.parseShipFeeFromNote(N==null?void 0:N.note)!=null?0:we>0?_t*we/100:0,It=_t*qt-$t*qt,Ft=Math.max(0,Math.round(It));return`${at}% - ${Jt(Ft)}`},vt=N=>{if(N==null||N==="")return[];let J=N;if(typeof J=="string"){const at=J.trim();if(!at)return[];try{J=JSON.parse(at)}catch(_t){return[]}}return Array.isArray(J)?J:[]},dt=N=>{if(N==null||N==="")return[];let J=N;if(typeof J=="string"){const at=J.trim();if(!at)return[];try{J=JSON.parse(at)}catch(_t){return[]}}return J&&typeof J=="object"&&!Array.isArray(J)&&(J=Object.entries(J).map(([at,_t])=>({key:at,value:_t}))),Array.isArray(J)?J:[]},wt=N=>{const J=dt(N).map(at=>{var _t,qt,Vt,$t,It;return{key:String((Vt=(qt=(_t=at==null?void 0:at.key)!=null?_t:at==null?void 0:at.name)!=null?qt:at==null?void 0:at.label)!=null?Vt:"").trim(),value:String(($t=at==null?void 0:at.value)!=null?$t:"").trim(),unit:String((It=at==null?void 0:at.unit)!=null?It:"").trim()}}).filter(at=>!!at.key);return J.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},J.map((at,_t)=>{const qt=at.key,Vt=`${at.value||""}${at.unit?(at.value?" ":"")+at.unit:""}`.trim();return React.createElement("div",{key:`${qt}-${_t}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},qt),Vt?React.createElement("span",{className:"ktm-chip ktm-chip-option"},Vt):null)}))):null},At=(N,J={})=>{const at=vt(N).map($t=>{var It;return{name:String((It=$t==null?void 0:$t.name)!=null?It:"").trim(),options:Array.isArray($t==null?void 0:$t.options)?$t.options:[]}}).map($t=>({...$t,options:$t.options.map(It=>{var Ft;return{label:String((Ft=It==null?void 0:It.label)!=null?Ft:"").trim(),price:Number(It==null?void 0:It.price)}}).filter(It=>!!It.label)})).filter($t=>$t.options.length>0);if(!at.length)return null;const _t=Number.isFinite(J.maxGroups)?Math.max(1,Math.trunc(J.maxGroups)):at.length,qt=Number.isFinite(J.maxOptionsPerGroup)?Math.max(1,Math.trunc(J.maxOptionsPerGroup)):4,Vt=at.slice(0,_t);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Vt.map(($t,It)=>{const Ft=$t.name||"Bi\u1EBFn th\u1EC3",ce=$t.options.slice(0,qt),Ie=$t.options.length-ce.length;return React.createElement("div",{key:`${Ft}-${It}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Ft),ce.map((pe,Ue)=>{const Le=pe.price,Mt=Number.isFinite(Le)&&Le>=0?Jt(Math.trunc(Le)):"",Ve=Mt?`${pe.label} \xB7 ${Mt}`:pe.label;return React.createElement("span",{key:`${Ft}-${It}-${Ue}`,className:"ktm-chip ktm-chip-option"},Ve)}),Ie>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",Ie))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Ce},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:Ut,onChange:N=>ue(N.target.value)})),React.createElement("span",{className:"product-count"},M.length)),React.createElement("select",{className:"form-select",value:Lt,onChange:N=>Gt(N.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),oe.map(N=>React.createElement("option",{key:N,value:N},N)))),it?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):M.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Ce},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},M.map(N=>React.createElement("div",{key:N.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>sn(N),onKeyDown:J=>{(J.key==="Enter"||J.key===" ")&&(J.preventDefault(),sn(N))},title:"Xem chi ti\u1EBFt"},N.image?React.createElement("img",{src:N.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},N.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},N.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},N.category),N.code&&React.createElement("span",{className:"product-badge bg-secondary"},N.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),ft(N))),React.createElement("div",{className:"product-price"},N.price?N.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),N.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},N.note),wt(N.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},wt(N.attributes)),At(N.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},At(N.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:J=>{J.stopPropagation(),_e(N)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:J=>{J.stopPropagation(),C(N)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:ot,title:String((X==null?void 0:X.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((X==null?void 0:X.code)||"").trim()||null,String((X==null?void 0:X.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:ae,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const N=String((X==null?void 0:X.code)||"").trim();N&&window.KTM.clipboard.writeText(N).then(()=>E("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((X==null?void 0:X.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const N=String((X==null?void 0:X.price)||"").trim();N&&window.KTM.clipboard.writeText(N).then(()=>E("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((X==null?void 0:X.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>X&&_e(X),disabled:!X},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>X&&C(X),disabled:!X},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},X?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const N=String((X==null?void 0:X.price)||"").trim(),J=Te(N);return Number.isFinite(J)&&J>0?Jt(Math.trunc(J)):N||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},ft(X)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},X.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},X.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),X.image?React.createElement("img",{src:X.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(X.note||"").trim()||X.attributes||X.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(X.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(X.note||"").trim()),wt(X.attributes)?React.createElement("div",{className:"mt-2"},wt(X.attributes)):null,At(X.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},At(X.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:G,product:Xt,categories:oe,onClose:()=>Ot(!1),onSave:Ge}))}function ProductModal({show:E,product:q,categories:B,onClose:yt,onSave:it}){const[Y,G]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Ot,Xt]=useState(!1),[Ct,Ut]=useState(!1),ue=C=>{const M=window.KTM.money.getDigits(String(C!=null?C:"")),H=Number(M);return M&&Number.isFinite(H)?Math.trunc(H):0},Lt=C=>{if(C==null||C==="")return[];let M=C;if(typeof M=="string"){const H=M.trim();if(!H)return[];try{M=JSON.parse(H)}catch(ft){return[]}}return M&&typeof M=="object"&&!Array.isArray(M)&&(M=Object.entries(M).map(([H,ft])=>({key:H,value:ft}))),Array.isArray(M)?M.map(H=>{var wt,At,N,J,at;if(!H||typeof H!="object")return null;const ft=String((N=(At=(wt=H.key)!=null?wt:H.name)!=null?At:H.label)!=null?N:"").trim(),vt=String((J=H.value)!=null?J:"").trim(),dt=String((at=H.unit)!=null?at:"").trim();return ft?{key:ft,value:vt,unit:dt}:null}).filter(Boolean):[]},Gt=(C,M)=>{if(C==null||C==="")return[];let H=C;if(typeof H=="string"){const vt=H.trim();if(!vt)return[];try{H=JSON.parse(vt)}catch(dt){return[]}}if(!Array.isArray(H))return[];const ft=ue(M);return H.map(vt=>{var At;if(!vt||typeof vt!="object")return null;const dt=String((At=vt.name)!=null?At:"").trim(),wt=(Array.isArray(vt.options)?vt.options:[]).map(N=>{var $t,It,Ft,ce,Ie,pe,Ue;if(!N||typeof N!="object")return null;const J=String(($t=N.label)!=null?$t:"").trim();if(!J)return null;const at=(Ie=(ce=(Ft=(It=N.price)!=null?It:N.priceValue)!=null?Ft:N.unit_price)!=null?ce:N.unitPrice)!=null?Ie:null,_t=Number(at);let qt=Number.isFinite(_t)?Math.trunc(_t):null;if(qt==null){const Le=(Ue=(pe=N.price_delta)!=null?pe:N.priceDelta)!=null?Ue:null,Mt=Number(Le);Number.isFinite(Mt)&&(qt=ft+Math.trunc(Mt))}qt==null&&(qt=ft);const Vt=String(Math.max(0,Math.trunc(Number(qt)||0)));return{label:J,price:Math.max(0,Math.trunc(Number(qt)||0)),priceDigits:Vt}}).filter(Boolean);return{name:dt||"Bi\u1EBFn th\u1EC3",options:wt}}).filter(Boolean)};useEffect(()=>{var C,M;G(q?{name:q.name||"",code:q.code||"",price:q.price||"",image:q.image||"",category:q.category||"",note:q.note||"",sort_order:q.sort_order||0,commission_percent:(M=(C=q.commission_percent)!=null?C:q.commissionPercent)!=null?M:5,variants:Gt(q.variants,q.price),attributes:Lt(q.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[q,E]);const ot=C=>{G(M=>{var wt;const H=ue(M.price),ft=String(H),vt=Array.isArray(M.variants)?[...M.variants]:[],dt={...vt[C]||{},options:Array.isArray((wt=vt[C])==null?void 0:wt.options)?[...vt[C].options]:[]};return dt.options=dt.options.map(At=>({label:String((At==null?void 0:At.label)||""),price:H,priceDigits:ft})),vt[C]=dt,{...M,variants:vt}})},jt=()=>{G(C=>{const M=ue(C.price),H=String(M),vt=(Array.isArray(C.variants)?[...C.variants]:[]).map(dt=>{const wt=(Array.isArray(dt==null?void 0:dt.options)?dt.options:[]).map(At=>({label:String((At==null?void 0:At.label)||""),price:M,priceDigits:H}));return{name:String((dt==null?void 0:dt.name)||"Bi\u1EBFn th\u1EC3"),options:wt}});return{...C,variants:vt}})},[X,ye]=React.useState(""),we=C=>window.KTM.money.formatVNDInputDigits(C),[Te,Jt]=React.useState(""),oe=C=>{const M=window.KTM.money.nextPriceInputState(C.target.value,Te);Jt(M.digits),G({...Y,price:M.price})},[Rt,Ce]=React.useState("");React.useEffect(()=>{q!=null&&q.image&&Ce(q.image)},[q]);const _e=async C=>{if(!(!C||!C.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:C},"L\u1ED7i x\xF3a \u1EA3nh")}catch(M){console.error("Delete cloudinary image error:",M)}},sn=async(C,M=2,H)=>{const ft=M*1024*1024,vt=C.type==="image/heic"||C.type==="image/heif"||/\.heic$/i.test(C.name);if(C.size<=ft&&!vt)return C;H==null||H("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const dt=await createImageBitmap(C);H==null||H("\u0110ang n\xE9n \u1EA3nh...");const wt=document.createElement("canvas");let At=dt.width,N=dt.height;const J=1200;return(At>J||N>J)&&(At>N?(N=Math.round(N/At*J),At=J):(At=Math.round(At/N*J),N=J)),wt.width=At,wt.height=N,wt.getContext("2d").drawImage(dt,0,0,At,N),dt.close(),new Promise((_t,qt)=>{wt.toBlob(Vt=>{Vt?(H==null||H("Ho\xE0n t\u1EA5t!"),_t(new File([Vt],C.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):qt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(dt){throw console.error("createImageBitmap error:",dt),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ae=async C=>{var ft,vt;const M=(ft=C.target.files)==null?void 0:ft[0];if(!M)return;if(!(M.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(M.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ut(!0),ye("\u0110ang chu\u1EA9n b\u1ECB...");try{const dt=(M.size/1024/1024).toFixed(1);ye(`File ${dt}MB - \u0110ang n\xE9n...`);const wt=await sn(M,2,J=>{ye(J)}),At=(wt.size/1024/1024).toFixed(1);ye(`\u0110\xE3 n\xE9n: ${At}MB - \u0110ang upload...`);const N=await window.KTM.cloudinary.uploadImage({file:wt,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});N.secure_url?(Y.image&&Y.image!==Rt&&_e(Y.image),G(J=>({...J,image:N.secure_url})),ye("")):(console.error("Cloudinary error:",N),alert("Upload th\u1EA5t b\u1EA1i: "+(((vt=N.error)==null?void 0:vt.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),ye(""))}catch(dt){console.error("Upload error:",dt),alert("L\u1ED7i: "+dt.message),ye("")}Ut(!1),C.target.value=""},Fe=()=>{Y.image&&(Y.image!==Rt&&_e(Y.image),G(C=>({...C,image:""})))},Ge=async C=>{C.preventDefault(),Xt(!0),Rt&&Y.image&&Rt!==Y.image&&await _e(Rt),Rt&&!Y.image&&await _e(Rt),await it(Y),Xt(!1)};return E?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${q?"fa-edit":"fa-plus-circle"} me-2`}),q?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:yt})),React.createElement("form",{onSubmit:Ge},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},Y.image?React.createElement(React.Fragment,null,React.createElement("img",{src:Y.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Fe,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Ct?"fa-spinner fa-spin":"fa-camera"} me-1`}),Ct?X||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:ae,disabled:Ct,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Ct&&X&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},X))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:Y.name,onChange:C=>G({...Y,name:C.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Y.code,onChange:C=>G({...Y,code:C.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Y.price,onChange:oe,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Y.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:C=>G({...Y,commission_percent:C.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Y.category,onChange:C=>G({...Y,category:C.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),B.map(C=>React.createElement("option",{key:C,value:C},C)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:Y.note,onChange:C=>G({...Y,note:C.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(Y.attributes)?Y.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(Y.attributes)?Y.attributes:[]).map((C,M)=>React.createElement("div",{key:M,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(C==null?void 0:C.key)||"",onChange:H=>{const ft=H.target.value;G(vt=>{const dt=Array.isArray(vt.attributes)?[...vt.attributes]:[];return dt[M]={...dt[M]||{},key:ft},{...vt,attributes:dt}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(C==null?void 0:C.value)||"",onChange:H=>{const ft=H.target.value;G(vt=>{const dt=Array.isArray(vt.attributes)?[...vt.attributes]:[];return dt[M]={...dt[M]||{},value:ft},{...vt,attributes:dt}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(C==null?void 0:C.unit)||"",onChange:H=>{const ft=H.target.value;G(vt=>{const dt=Array.isArray(vt.attributes)?[...vt.attributes]:[];return dt[M]={...dt[M]||{},unit:ft},{...vt,attributes:dt}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{G(H=>{const ft=Array.isArray(H.attributes)?[...H.attributes]:[];return ft.splice(M,1),{...H,attributes:ft}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{G(C=>{const M=Array.isArray(C.attributes)?[...C.attributes]:[];return M.push({key:"",value:"",unit:""}),{...C,attributes:M}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(Y.variants)?Y.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(Y.variants)?Y.variants:[]).map((C,M)=>React.createElement("div",{key:M,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(C==null?void 0:C.name)||"",onChange:H=>{const ft=H.target.value;G(vt=>{var wt;const dt=Array.isArray(vt.variants)?[...vt.variants]:[];return dt[M]={...dt[M]||{},name:ft,options:Array.isArray((wt=dt[M])==null?void 0:wt.options)?dt[M].options:[]},{...vt,variants:dt}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ot(M),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(C==null?void 0:C.options)||C.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{G(H=>{const ft=Array.isArray(H.variants)?[...H.variants]:[];return ft.splice(M,1),{...H,variants:ft}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(C==null?void 0:C.options)?C.options:[]).map((H,ft)=>{var vt,dt;return React.createElement("div",{key:ft,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(H==null?void 0:H.label)||"",onChange:wt=>{const At=wt.target.value;G(N=>{var Vt,$t,It,Ft,ce;const J=Array.isArray(N.variants)?[...N.variants]:[],at={...J[M]||{},options:Array.isArray((Vt=J[M])==null?void 0:Vt.options)?[...J[M].options]:[]},_t=Number((It=($t=at.options[ft])==null?void 0:$t.price)!=null?It:0)||0,qt=String((ce=(Ft=at.options[ft])==null?void 0:Ft.priceDigits)!=null?ce:Math.max(0,Math.trunc(_t)));return at.options[ft]={...at.options[ft]||{},label:At,price:Math.max(0,Math.trunc(_t)),priceDigits:qt},J[M]=at,{...N,variants:J}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:we(String((dt=H==null?void 0:H.priceDigits)!=null?dt:window.KTM.money.getDigits(String((vt=H==null?void 0:H.price)!=null?vt:"")))),onChange:wt=>{G(At=>{var It,Ft,ce,Ie,pe;const N=String((Ft=H==null?void 0:H.priceDigits)!=null?Ft:window.KTM.money.getDigits(String((It=H==null?void 0:H.price)!=null?It:""))),J=window.KTM.money.nextPriceInputState(wt.target.value,N),at=String((ce=J.digits)!=null?ce:""),_t=Number(at),qt=Number.isFinite(_t)?Math.max(0,Math.trunc(_t)):0,Vt=Array.isArray(At.variants)?[...At.variants]:[],$t={...Vt[M]||{},options:Array.isArray((Ie=Vt[M])==null?void 0:Ie.options)?[...Vt[M].options]:[]};return $t.options[ft]={...$t.options[ft]||{},label:String(((pe=$t.options[ft])==null?void 0:pe.label)||""),price:qt,priceDigits:at},Vt[M]=$t,{...At,variants:Vt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{G(wt=>{var J;const At=Array.isArray(wt.variants)?[...wt.variants]:[],N={...At[M]||{},options:Array.isArray((J=At[M])==null?void 0:J.options)?[...At[M].options]:[]};return N.options.splice(ft,1),At[M]=N,{...wt,variants:At}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{G(H=>{var wt;const ft=Array.isArray(H.variants)?[...H.variants]:[],vt={...ft[M]||{},options:Array.isArray((wt=ft[M])==null?void 0:wt.options)?[...ft[M].options]:[]},dt=ue(H.price);return vt.options.push({label:"",price:dt,priceDigits:String(dt)}),ft[M]=vt,{...H,variants:ft}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{G(C=>{const M=ue(C.price),H=Array.isArray(C.variants)?[...C.variants]:[],ft=String(M);return H.push({name:"Size",options:[{label:"S",price:M,priceDigits:ft},{label:"M",price:M,priceDigits:ft},{label:"L",price:M,priceDigits:ft}]}),{...C,variants:H}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:jt,disabled:!Array.isArray(Y.variants)||Y.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:Y.image,onChange:C=>G({...Y,image:C.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:yt,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Ot,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Ot?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:E,video:q,onClose:B,onSave:yt}){const[it,Y]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[G,Ot]=useState(!1),[Xt,Ct]=useState("");useEffect(()=>{q?(Y({title:q.title||"",youtube_url:`https://www.youtube.com/watch?v=${q.youtubeId}`,thumbnail_url:q.thumb||"",sort_order:q.sortOrder||0}),Ct(q.thumb)):(Y({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Ct(""))},[q,E]);const Ut=Gt=>{const ot=Gt.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return ot?ot[1]:null},ue=Gt=>{Y({...it,youtube_url:Gt});const ot=Ut(Gt);ot&&Ct(`https://img.youtube.com/vi/${ot}/hqdefault.jpg`)},Lt=async Gt=>{Gt.preventDefault(),Ot(!0),await yt(it),Ot(!1)};return E?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},q?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:B})),React.createElement("form",{onSubmit:Lt},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:it.youtube_url,onChange:Gt=>ue(Gt.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),Xt&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:Xt,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:it.title,onChange:Gt=>Y({...it,title:Gt.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:it.sort_order,onChange:Gt=>Y({...it,sort_order:parseInt(Gt.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:it.thumbnail_url,onChange:Gt=>Y({...it,thumbnail_url:Gt.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:B},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:G},G?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function getCurrentMonth(){const E=new Date,q=E.getFullYear(),B=String(E.getMonth()+1).padStart(2,"0");return`${q}-${B}`}function ReconExcelManager({showToast:E}){var be;const q=typeof E=="function"?E:()=>{},[B,yt]=useState(getCurrentMonth()),it=B,Y=yt,[G,Ot]=useState(!1),[Xt,Ct]=useState(""),[Ut,ue]=useState(""),[Lt,Gt]=useState(""),[ot,jt]=useState(null),[X,ye]=useState("matches"),[we,Te]=useState(""),[Jt,oe]=useState(!0),[Rt,Ce]=useState(!0),[_e,sn]=useState(!1),[ae,Fe]=useState("created_at"),[Ge,C]=useState(!1),[M,H]=useState(0),[ft,vt]=useState(!1),[dt,wt]=useState(""),[At,N]=useState(()=>new Set),[J,at]=useState(!1),[_t,qt]=useState(null),Vt=useRef(new Map),$t=useRef(new Map),It=useRef(null),[Ft,ce]=useState(()=>{var i;return(i=window==null?void 0:window.XLSX)!=null&&i.read?"ready":"loading"}),Ie=i=>new Promise((l,x)=>{var g;try{if(!i)return l();const f=String(i),L=document.querySelector(`script[data-ktm-src="${f}"]`)||document.querySelector(`script[src="${f}"]`);if(L){if(L.getAttribute("data-ktm-loaded")==="1"||(g=window==null?void 0:window.XLSX)!=null&&g.read)return l();L.addEventListener("load",()=>l(),{once:!0}),L.addEventListener("error",()=>x(new Error(`Failed to load ${f}`)),{once:!0});return}const P=document.createElement("script");P.src=f,P.async=!0,P.defer=!0,P.setAttribute("data-ktm-src",f),P.addEventListener("load",()=>{P.setAttribute("data-ktm-loaded","1"),l()},{once:!0}),P.addEventListener("error",()=>x(new Error(`Failed to load ${f}`)),{once:!0}),document.head.appendChild(P)}catch(f){x(f)}}),pe=()=>!!(window!=null&&window.XLSX&&typeof window.XLSX.read=="function"),Ue=async()=>{if(pe())return ce("ready"),!0;if(It.current)return It.current;const i=["https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js","https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js","https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"],l=async x=>{const g=Date.now();for(;Date.now()-g<x;){if(pe())return!0;await new Promise(f=>setTimeout(f,50))}return pe()};return ce("loading"),It.current=(async()=>{try{for(const x of i)try{if(await Ie(x),await l(1500))return ce("ready"),!0}catch(g){}return ce("failed"),!1}finally{It.current=null}})(),It.current};useEffect(()=>{if(pe()){ce("ready");return}Ue()},[]);const Le=i=>{const l=[],x=String(i!=null?i:"").split(/\s+/g);for(const g of x){const f=String(g||"").trim();f&&l.push(f)}return l.join(" ").replace(/\s+/g," ").trim()},Mt=i=>{try{return String(i!=null?i:"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,l=>l==="\u0111"?"d":"D")}catch(l){return String(i!=null?i:"").replace(/[đĐ]/g,x=>x==="\u0111"?"d":"D")}},Ve=i=>{const l=Le(String(i!=null?i:""));return l?Mt(l).toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim():""},on=i=>{const l=Ve(i);return l?l.replace(/\b(combo|set|sp|san\s*pham|sanpham|hang|ship|freeship|free\s*ship)\b/g," ").replace(/\s+/g," ").trim():""},mn=i=>{var L,P;if(i==null||i==="")return"";if(typeof i=="number"&&Number.isFinite(i)&&((P=(L=window==null?void 0:window.XLSX)==null?void 0:L.SSF)!=null&&P.parse_date_code))try{const b=window.XLSX.SSF.parse_date_code(i);return!b||!b.y||!b.m?"":`${String(b.y).padStart(4,"0")}-${String(b.m).padStart(2,"0")}`}catch(b){}const l=String(i).trim(),x=l.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(x){const b=String(Number(x[2])||0).padStart(2,"0");return`${x[3]}-${b}`}const g=l.match(/^(\d{4})-(\d{2})-(\d{2})/);if(g)return`${g[1]}-${g[2]}`;const f=new Date(l);return Number.isNaN(f.getTime())?"":`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}`},F=i=>{var L,P;if(i==null||i==="")return"";if(typeof i=="number"&&Number.isFinite(i)&&((P=(L=window==null?void 0:window.XLSX)==null?void 0:L.SSF)!=null&&P.parse_date_code))try{const b=window.XLSX.SSF.parse_date_code(i);return!b||!b.y||!b.m||!b.d?"":`${String(b.y).padStart(4,"0")}-${String(b.m).padStart(2,"0")}-${String(b.d).padStart(2,"0")}`}catch(b){}const l=String(i).trim(),x=l.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(x){const b=String(Number(x[1])||0).padStart(2,"0"),A=String(Number(x[2])||0).padStart(2,"0");return`${x[3]}-${A}-${b}`}const g=l.match(/^(\d{4})-(\d{2})-(\d{2})/);if(g)return`${g[1]}-${g[2]}-${g[3]}`;const f=new Date(l);return Number.isNaN(f.getTime())?"":`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}-${String(f.getDate()).padStart(2,"0")}`},rt=i=>{if(i==null||i==="")return 0;if(typeof i=="number"&&Number.isFinite(i))return Math.trunc(i);const l=String(i!=null?i:"").trim();if(!l)return 0;try{const L=window.KTM.money.parseMoney(l);if(Number.isFinite(L)&&L>0)return Math.trunc(L)}catch(L){}const g=l.toLowerCase().replace(/vnd|đ|d/g," ").replace(/\s+/g," ").trim().replace(/[^0-9]/g,"");if(!g)return 0;const f=Number(g);return Number.isFinite(f)?Math.trunc(f):0},Qt=i=>{var x,g;let l="";try{(g=(x=window==null?void 0:window.KTM)==null?void 0:x.phone)!=null&&g.normalize&&(l=window.KTM.phone.normalize(i))}catch(f){}return l||(l=String(i!=null?i:"").replace(/[^0-9]/g,"")),l=String(l||"").replace(/[^0-9]/g,""),l?(l.startsWith("840")?l=`0${l.slice(3)}`:l.startsWith("84")&&(l.length===11?l=`0${l.slice(2)}`:l.length===12&&l[2]!=="0"&&(l=`0${l.slice(2)}`)),l.length===9&&(l=`0${l}`),l):""},cn=(i,l)=>{try{const x=Array.isArray(l)?l:[],g=A=>{const D=String(A!=null?A:"");return/[\n\r",]/.test(D)?`"${D.replace(/"/g,'""')}"`:D},f=x.map(A=>Array.isArray(A)?A.map(g).join(","):"").join(`
`),L=new Blob([`\uFEFF${f}`],{type:"text/csv;charset=utf-8"}),P=URL.createObjectURL(L),b=document.createElement("a");b.href=P,b.download=i,document.body.appendChild(b),b.click(),setTimeout(()=>{try{URL.revokeObjectURL(P)}catch(A){}try{b.remove()}catch(A){}},0)}catch(x){}},un=i=>{const l=String(i!=null?i:"");if(!l.trim())return{phone:"",phoneNorm:"",cleanedText:String(i!=null?i:"").trim()};const x=/(?:\+?84|0)\s*[0-9\s\-.()]{8,16}/g;let g=null,f;for(;(f=x.exec(l))!=null;){const A=f[0],D=Qt(A);D&&(D.length<9||D.length>12||(g={raw:A,digits:D}))}if(!g){const A=Qt(l);if(A.length>=9){const D=A.slice(-12);D.length>=9&&(g={raw:D,digits:D})}}if(!g)return{phone:"",phoneNorm:"",cleanedText:l.trim()};const L=g.digits,P=L;let b=l;return g.raw&&l.includes(g.raw)?b=b.replace(g.raw," "):b=b.replace(new RegExp(`${g.digits}$`)," "),b=b.replace(/[\-–—•|]+\s*$/g," ").replace(/\s+[\-–—•|]+\s*/g," ").replace(/\s+/g," ").trim(),{phone:P,phoneNorm:L,cleanedText:b}},Qe=async()=>{var l;const i=Vt.current;if(i&&i.size>0)return i;try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m"),g=Array.isArray(x==null?void 0:x.products)?x.products:Array.isArray(x)?x:[],f=new Map;for(const L of g){const P=String((l=L==null?void 0:L.id)!=null?l:"").trim();P&&f.set(P,L)}return Vt.current=f,f}catch(x){return Vt.current=new Map,Vt.current}},Ze=i=>{var x;const l=String(i!=null?i:"").trim();return l&&((x=Vt.current)==null?void 0:x.get(l))||null},O=async i=>{var A,D,U;if(!i)throw new Error("Ch\u01B0a ch\u1ECDn file");const l=await i.arrayBuffer(),x=Number(i.size||0)||0;if(!!!(window!=null&&window.Worker&&typeof Blob!="undefined"&&typeof URL!="undefined")||x<450*1024){if(!((A=window==null?void 0:window.XLSX)!=null&&A.read))try{await Ue()}catch(Et){}if(!((D=window==null?void 0:window.XLSX)!=null&&D.read))throw new Error("Thi\u1EBFu th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). Vui l\xF2ng t\u1EA3i l\u1EA1i trang admin.");const lt=window.XLSX.read(l,{type:"array"}),gt=(U=lt==null?void 0:lt.SheetNames)==null?void 0:U[0],ct=gt?lt.Sheets[gt]:null;if(!ct)throw new Error("Kh\xF4ng \u0111\u1ECDc \u0111\u01B0\u1EE3c sheet trong file");return window.XLSX.utils.sheet_to_json(ct,{header:1,raw:!0,defval:""})}const f=`
					const sources = [
						'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js',
						'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js',
						'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js',
					];

					const hasXlsx = () => Boolean(self.XLSX && typeof self.XLSX.read === 'function');
					const ensureXlsx = async () => {
						if (hasXlsx()) return true;
						for (const src of sources) {
							try {
								self.importScripts(src);
								if (hasXlsx()) return true;
							} catch (e) {
								// try next
							}
						}
						return hasXlsx();
					};

					self.onmessage = async (ev) => {
						try {
							const data = ev && ev.data;
							const buf = data && data.buf;
							const ok = await ensureXlsx();
							if (!ok) throw new Error('XLSX not available');
							const wb = self.XLSX.read(buf, { type: 'array' });
							const sheetName = wb && wb.SheetNames && wb.SheetNames[0];
							const ws = sheetName ? wb.Sheets[sheetName] : null;
							if (!ws) throw new Error('No sheet');
							const grid = self.XLSX.utils.sheet_to_json(ws, { header: 1, raw: true, defval: '' });
							self.postMessage({ ok: true, grid });
						} catch (e) {
							self.postMessage({ ok: false, error: String((e && e.message) || e || 'worker error') });
						}
					};
				`,L=new Blob([f],{type:"application/javascript"}),P=URL.createObjectURL(L),b=new Worker(P);try{return await new Promise((gt,ct)=>{const Et=setTimeout(()=>{try{b.terminate()}catch(St){}ct(new Error("Worker timeout"))},12e3);b.onmessage=St=>{const Zt=St&&St.data;Zt&&Zt.ok?(clearTimeout(Et),gt(Zt.grid)):Zt&&Zt.ok===!1&&(clearTimeout(Et),ct(new Error(Zt.error||"Worker failed")))},b.onerror=()=>{clearTimeout(Et),ct(new Error("Worker error"))};try{b.postMessage({buf:l},[l])}catch(St){b.postMessage({buf:l})}})}finally{try{b.terminate()}catch(lt){}try{URL.revokeObjectURL(P)}catch(lt){}}},h=async i=>{var D,U;if(!i)throw new Error("Ch\u01B0a ch\u1ECDn file");const l=await O(i),x=Array.isArray(l)?l:[];if(!x.length)throw new Error("File r\u1ED7ng");const g={product:["ten san pham","tensanpham","san pham","t\xEAn s\u1EA3n ph\u1EA9m"],cod:["tong tien thu ho","t\u1ED5ng ti\u1EC1n thu h\u1ED9","thu ho","thu h\u1ED9","tong thu ho","t\u1ED5ng thu h\u1ED9"],date:["ngay","ng\xE0y","date"],phone:["sdt","s\u0111t","so dien thoai","s\u1ED1 \u0111i\u1EC7n tho\u1EA1i","dien thoai","\u0111i\u1EC7n tho\u1EA1i","phone"],qty:["sl","so luong","s\u1ED1 l\u01B0\u1EE3ng","qty","quantity"]},L=(()=>{const lt=Math.min(30,x.length);for(let gt=0;gt<lt;gt++){const Et=(Array.isArray(x[gt])?x[gt]:[]).map(me=>Ve(me)),St=me=>{for(let mt=0;mt<Et.length;mt++){const Wt=Et[mt];if(Wt&&me.some(Me=>Wt.includes(Ve(Me))))return mt}return-1},Zt=St(g.product),xt=St(g.cod);if(xt>=0){const me=St(g.date),mt=St(g.phone),Wt=St(g.qty);return{headerRow:gt,productCol:Zt,codCol:xt,dateCol:me,phoneCol:mt,qtyCol:Wt}}}return null})();if(!L)throw new Error('Kh\xF4ng t\xECm th\u1EA5y header c\u1ED9t "T\u1ED5ng ti\u1EC1n thu h\u1ED9"');const P=[],b=new Set,A=lt=>{const gt=String(lt!=null?lt:"").trim();if(!gt)return{text:"",qty:null};let ct=gt.match(/^\s*x\s*(\d{1,3})\s+(.+)$/i);return ct?{text:String(ct[2]||"").trim(),qty:Number(ct[1])}:(ct=gt.match(/^\s*(\d{1,3})\s*(?:x|\*|×)?\s+(.+)$/i),ct?{text:String(ct[2]||"").trim(),qty:Number(ct[1])}:{text:gt,qty:null})};for(let lt=L.headerRow+1;lt<x.length;lt++){const gt=Array.isArray(x[lt])?x[lt]:[],ct=L.productCol>=0?String((D=gt[L.productCol])!=null?D:"").trim():"",Et=A(ct),St=Et.text,Zt=rt(gt[L.codCol]),xt=L.qtyCol>=0?gt[L.qtyCol]:"",me=(()=>{if(xt!=null&&xt!==""){if(typeof xt=="number"&&Number.isFinite(xt))return{qty:Math.max(1,Math.trunc(xt)),source:"cell"};const tn=String(xt).trim(),je=Number(tn.replace(/[^0-9]/g,""));if(Number.isFinite(je)&&je>0)return{qty:Math.max(1,Math.trunc(je)),source:"cell"}}const Re=Number(Et.qty);return Number.isFinite(Re)&&Re>1?{qty:Math.max(1,Math.trunc(Re)),source:"text"}:{qty:1,source:"default"}})(),mt=me.qty,Wt=me.source,Me=Wt==="cell"&&mt>1&&Zt>0&&mt<=50?Zt*mt:0,Ae=Array.from(new Set([Zt,Me].filter(Re=>Number(Re||0)>0))),xe=Zt;if(!St&&!xe)continue;const Ht=L.phoneCol>=0?String((U=gt[L.phoneCol])!=null?U:"").trim():"",j=Qt(Ht);let ut=un(St);if(j&&(ut={...ut,phone:j,phoneNorm:j}),!ut.phoneNorm){const Re=gt.map(je=>String(je!=null?je:"")).join(" | "),tn=un(Re);tn.phoneNorm&&(ut={...ut,phone:tn.phone,phoneNorm:tn.phoneNorm})}const le=ut.cleanedText||St||"",he=Ve(le);if(he&&(he.includes("tong tien")||he.includes("tong")||he.includes("thanh toan")||he.includes("thanh to\xE1n")))continue;const ke=L.dateCol>=0?gt[L.dateCol]:"",Be=ke?mn(ke):"";Be&&b.add(Be);const fe=ke?F(ke):"";P.push({rowIndex:lt+1,dateRaw:ke,monthKey:Be,dayKey:fe,product:le,productNorm:on(le),productCompact:on(le).replace(/\s+/g,""),phone:ut.phone,phoneNorm:ut.phoneNorm,cod:xe,codRaw:Zt,qty:mt,qtySource:Wt,codAlt:Me,codCandidates:Ae})}return{rows:P,monthKeys:Array.from(b.values()).sort()}},V=i=>{const l=new Map,x=(b,A)=>{const D=l.get(b)||{key:b,rows:[],phoneNorm:"",phone:"",monthKey:"",dayKey:""};D.rows.push(A),!D.phoneNorm&&A.phoneNorm&&(D.phoneNorm=A.phoneNorm,D.phone=A.phone||A.phoneNorm),!D.monthKey&&A.monthKey&&(D.monthKey=A.monthKey),!D.dayKey&&A.dayKey&&(D.dayKey=A.dayKey),l.set(b,D)};for(const b of Array.isArray(i)?i:[]){const A=String((b==null?void 0:b.phoneNorm)||"").trim(),D=String((b==null?void 0:b.dayKey)||"").trim(),U=String((b==null?void 0:b.monthKey)||"").trim();if(A){const lt=D?`p:${A}:d:${D}`:U?`p:${A}:m:${U}`:`p:${A}`;x(lt,b)}else x(`r:${b==null?void 0:b.rowIndex}`,b)}const g=b=>{const A=Number((b==null?void 0:b.cod)||0)||0;if(A>0)return A;const D=Number((b==null?void 0:b.codAlt)||0)||0;return D>0?D:0},f=b=>{var lt;const A=((b==null?void 0:b.rows)||[]).slice().filter(Boolean);if(A.length<=1)return[{key:b.key,rows:A,phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey}];const D=A.map(g).filter(gt=>gt>0),U=Array.from(new Set(D));if(b.phoneNorm&&b.dayKey&&U.length>1&&U.length<=8){const gt=new Map;for(const Et of U)gt.set(String(Et),{key:`${b.key}:t:${Et}`,rows:[],phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey});const ct=[];for(const Et of A){const St=g(Et);St>0?gt.get(String(St)).rows.push(Et):ct.push(Et)}if(ct.length){const Et=Array.from(gt.values()).map(St=>{const Zt=St.rows.find(xt=>String((xt==null?void 0:xt.productNorm)||"").trim())||null;return{group:St,seedNorm:String((Zt==null?void 0:Zt.productNorm)||"")}});for(const St of ct){const Zt=String((St==null?void 0:St.productNorm)||"");let xt=null,me=-1;for(const mt of Et){const Wt=Bt(Zt,mt.seedNorm);Wt>me&&(me=Wt,xt=mt.group)}(xt||((lt=Et[0])==null?void 0:lt.group)).rows.push(St)}}return Array.from(gt.values()).filter(Et=>Et.rows.length>0)}return[{key:b.key,rows:A,phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey}]},L=[];for(const b of l.values())L.push(...f(b));const P=b=>{var Me,Ae,xe;const A=b.rows.slice().filter(Boolean),D=A.map(Ht=>Ht.rowIndex).filter(Boolean),U=[],lt=new Set;for(const Ht of A){const j=String((Ht==null?void 0:Ht.productNorm)||"").trim();j&&(lt.has(j)||(lt.add(j),U.push(String((Ht==null?void 0:Ht.product)||"").trim())))}const gt=U.filter(Boolean).join(" + "),ct=Ve(gt),Et=[];for(const Ht of A){const j=Array.isArray(Ht==null?void 0:Ht.codCandidates)?Ht.codCandidates:[];for(const ut of j){const le=Number(ut||0)||0;le>0&&Et.push(le)}}const St=Array.from(new Set(Et)).sort((Ht,j)=>Ht-j),Zt=A.map(Ht=>g(Ht)).filter(Ht=>Ht>0);let xt=0;if(!Zt.length)xt=0;else{const Ht=new Map;for(const ut of Zt)Ht.set(ut,(Ht.get(ut)||0)+1);const j=Array.from(Ht.keys());if(j.length===1)xt=j[0];else{let ut=null,le=0;for(const[he,ke]of Ht.entries())ke>le&&(le=ke,ut=he);ut!=null&&le>=2?xt=ut:xt=Zt.reduce((he,ke)=>he+ke,0)}}const me=b.monthKey||((Me=A.find(Ht=>Ht==null?void 0:Ht.monthKey))==null?void 0:Me.monthKey)||"",mt=((Ae=A.find(Ht=>Ht==null?void 0:Ht.dayKey))==null?void 0:Ae.dayKey)||"",Wt=((xe=A.find(Ht=>Ht==null?void 0:Ht.dateRaw))==null?void 0:xe.dateRaw)||"";return{key:b.key,phoneNorm:b.phoneNorm||"",phone:b.phone||b.phoneNorm||"",monthKey:me,dayKey:mt,dateRaw:Wt,rowIndices:D,rowIndexFirst:D.length?Math.min(...D):null,rowCount:A.length,productDisplay:gt,productNorm:ct,productCompact:String(ct||"").replace(/\s+/g,""),cod:xt,codCandidates:St,rows:A}};return L.map(P)},st=async i=>{const l=`${API_BASE}/api/orders?month=${encodeURIComponent(i)}&includeItems=1`,x=await window.KTM.api.getJSON(l,"L\u1ED7i t\u1EA3i danh s\xE1ch \u0111\u01A1n");return Array.isArray(x==null?void 0:x.orders)?x.orders:Array.isArray(x)?x:[]},Pt=async i=>{var A,D;const l=Array.isArray(i)&&i.length?i:[B],x=[],g=5*60*1e3;for(let U=0;U<l.length;U++){const lt=l[U],gt=(A=$t.current)==null?void 0:A.get(lt);if(gt&&Date.now()-Number(gt.at||0)<g&&Array.isArray(gt.records)){x.push(...gt.records);continue}ue(`\u0110ang t\u1EA3i \u0111\u01A1n h\u1EC7 th\u1ED1ng th\xE1ng ${lt} (${U+1}/${l.length})...`);const ct=await st(lt);(D=$t.current)==null||D.set(lt,{at:Date.now(),records:ct}),x.push(...ct)}const f=U=>String(U||"").trim().toLowerCase(),L=x.filter(U=>{const lt=f(U==null?void 0:U.status);return!(Jt&&lt==="draft"||Rt&&lt==="canceled"||_e&&(lt==="paid"||lt==="done"))}),P=U=>{var gt,ct,Et;return String(ae||"created_at")==="updated_at"?(ct=(gt=U==null?void 0:U.updated_at)!=null?gt:U==null?void 0:U.created_at)!=null?ct:null:(Et=U==null?void 0:U.created_at)!=null?Et:null};return L.map(U=>{var xt,me,mt,Wt,Me,Ae;const lt=window.KTM.orders.getOrderProductSummary(U,Ze),gt=window.KTM.orders.getOrderTotalMoney(U,Ze),ct=on(lt),Et=Qt((xt=U==null?void 0:U.phone)!=null?xt:""),St=P(U),Zt=(()=>{if(!St)return"";const xe=new Date(St);return Number.isNaN(xe.getTime())?"":`${xe.getFullYear()}-${String(xe.getMonth()+1).padStart(2,"0")}-${String(xe.getDate()).padStart(2,"0")}`})();return{id:String((me=U==null?void 0:U.id)!=null?me:""),created_at:(mt=U==null?void 0:U.created_at)!=null?mt:null,updated_at:(Wt=U==null?void 0:U.updated_at)!=null?Wt:null,dayKey:Zt,status:String((Me=U==null?void 0:U.status)!=null?Me:""),phone:String((Ae=U==null?void 0:U.phone)!=null?Ae:""),phoneNorm:Et,productSummary:lt,productNorm:ct,productCompact:ct.replace(/\s+/g,""),cod:Number(gt||0)||0,raw:U}}).filter(U=>U.id&&U.cod>0)},Bt=(i,l)=>{const x=String(i||"").trim(),g=String(l||"").trim();if(!x||!g)return 0;if(x===g)return 1;const f=x.replace(/\s+/g,""),L=g.replace(/\s+/g,"");if(f&&L&&f===L)return 1;if(f&&L&&(L.includes(f)||f.includes(L)))return .92;const P=xt=>String(xt||"").replace(/[\+]/g," ").replace(/[()\[\]{},.;:!?]/g," ").replace(/\s+/g," ").trim().split(" ").map(Wt=>Wt.trim()).filter(Boolean).map(Wt=>Wt.replace(/[^a-z0-9]/g,"")).filter(Boolean).filter(Wt=>Wt.length>1),b=P(x),A=P(g);if(!b.length||!A.length)return 0;const D=new Set(A),U=(xt,me)=>{if(xt===me)return 0;const mt=xt.length,Wt=me.length;if(Math.abs(mt-Wt)>1)return 2;let Me=0,Ae=0,xe=0;for(;Me<mt&&Ae<Wt;){if(xt[Me]===me[Ae]){Me+=1,Ae+=1;continue}if(xe+=1,xe>1)return xe;mt>Wt?Me+=1:(Wt>mt||(Me+=1),Ae+=1)}return(Me<mt||Ae<Wt)&&(xe+=1),xe},lt=xt=>/[0-9]/.test(xt)?2:1;let gt=0,ct=0;for(const xt of b){const me=lt(xt);if(ct+=me,D.has(xt)||L&&L.includes(xt)){gt+=me;continue}if(xt.length>=4){let mt=!1;for(const Wt of A){if(Wt===xt){mt=!0;break}if(Wt.includes(xt)||xt.includes(Wt)){mt=!0;break}if(L&&L.includes(xt)){mt=!0;break}if(U(xt,Wt)<=1){mt=!0;break}}mt&&(gt+=me*.8)}}const Et=gt/Math.max(1,ct),St=Math.min(.12,Math.abs(x.length-g.length)/Math.max(1,Math.max(x.length,g.length))),Zt=(()=>{const xt=b.filter(mt=>/[0-9]/.test(mt)&&mt.length>=3);if(!xt.length)return 0;let me=0;for(const mt of xt)(D.has(mt)||L&&L.includes(mt))&&(me+=1);return Math.min(.08,.04*me)})();return Math.max(0,Math.min(1,Et-St+Zt))},Yt=i=>{const x=String(i||"").trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!x)return null;const g=new Date(Number(x[1]),Number(x[2])-1,Number(x[3]));return Number.isNaN(g.getTime())?null:g.getTime()},$e=(i,l)=>{const x=Array.isArray(i==null?void 0:i.codCandidates)&&i.codCandidates.length?i.codCandidates:[Number((i==null?void 0:i.cod)||0)||0],g=Number((l==null?void 0:l.cod)||0)||0;let f=1/0,L=0;for(const P of x){const b=Number(P||0)||0;if(b<=0)continue;const A=Math.abs(g-b);A<f&&(f=A,L=b)}return Number.isFinite(f)||(f=1/0),{bestDiff:f,bestCand:L,oCod:g}},se=(i,l,x)=>{const g=String((i==null?void 0:i.phoneNorm)||"").trim(),f=!!(g&&String((l==null?void 0:l.phoneNorm)||"")===g),L=Math.max(0,Number((x==null?void 0:x.codTolerance)||0)||0),{bestDiff:P,bestCand:b}=$e(i,l),A=P===0,D=Number.isFinite(P)&&L>0&&P>0&&P<=L,U=String((i==null?void 0:i.dayKey)||"").trim(),lt=String((l==null?void 0:l.dayKey)||"").trim(),gt=!!(U&&lt&&U===lt),ct=(()=>{if(!U||!lt)return!1;const Me=Yt(U),Ae=Yt(lt);if(Me==null||Ae==null)return!1;const xe=Math.abs(Me-Ae)/(24*60*60*1e3);return xe>0&&xe<=1.01})(),St=!!g?{phone:.65,cod:.27,day:.08}:{phone:0,cod:.85,day:.15},Zt=f?St.phone:0,xt=A?St.cod:D?St.cod*(1-P/Math.max(1,L)):0,me=gt?St.day:ct?St.day*.6:0,mt=Zt+xt+me,Wt=[];return f&&Wt.push("S\u0110T tr\xF9ng"),A?Wt.push("COD tr\xF9ng"):D?Wt.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(P)} (<= ${window.KTM.money.formatNumber(L)})`):b>0&&Number.isFinite(P)&&P!==1/0&&Wt.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(P)}`),gt?Wt.push("C\xF9ng ng\xE0y"):ct&&Wt.push("Ng\xE0y g\u1EA7n \u0111\xFAng (\xB11)"),{score:mt,reasons:Wt,nameSim:null,phoneMatch:f,codExact:A,codWithin:D,codDiff:P,bestCand:b}},hn=i=>{let l=String(i!=null?i:"");return l=l.replace(/^\s*(?:x\s*)?(\d{1,3})\s*(?:x|\*|×)?\s*/i," "),l=l.replace(/\s+/g," ").trim(),on(l)},We=i=>{var L;const l=new Map,x=new Map,g=Array.isArray(i==null?void 0:i.rows)?i.rows:[],f=g.length>1||g.some(P=>String((P==null?void 0:P.qtySource)||"default")!=="default");for(const P of g){const b=String((P==null?void 0:P.product)||"").trim(),A=hn(b);if(!A)continue;const D=Math.max(1,Number((L=P==null?void 0:P.qty)!=null?L:1)||1),U=f?D:1;l.set(A,(l.get(A)||0)+U),x.has(A)||x.set(A,b)}return{qtyByKey:l,labelByKey:x,qtyReliable:f}},Cn=i=>{var b;const l=new Map,x=new Map,g=(i==null?void 0:i.raw)||null,f=Array.isArray(g==null?void 0:g.items)?g.items:[];if(f.length){for(const A of f){const D=A==null?void 0:A.product_id,U=D?Ze(D):null,lt=String((U==null?void 0:U.name)||(A==null?void 0:A.product_name)||"").trim(),gt=String((A==null?void 0:A.variant)||"").trim(),ct=(lt||(i==null?void 0:i.productSummary)||"").trim()+(gt?` (${gt})`:""),Et=hn(ct);if(!Et)continue;const St=Math.max(1,Number((b=A==null?void 0:A.quantity)!=null?b:1)||1);l.set(Et,(l.get(Et)||0)+St),x.has(Et)||x.set(Et,lt||ct)}return{qtyByKey:l,labelByKey:x}}const L=String((i==null?void 0:i.productSummary)||"").trim();if(!L)return{qtyByKey:l,labelByKey:x};const P=L.split("+").map(A=>String(A||"").trim()).filter(Boolean);for(const A of P){const D=A.match(/\bx\s*(\d{1,3})\b/i),U=D?Math.max(1,Number(D[1])||1):1,lt=A.replace(/\bx\s*\d{1,3}\b/ig," ").replace(/\s+/g," ").trim(),gt=hn(lt);gt&&(l.set(gt,(l.get(gt)||0)+U),x.has(gt)||x.set(gt,lt))}return{qtyByKey:l,labelByKey:x}},ln=(i,l)=>{const x=We(i),g=Cn(l),f=Array.from(x.qtyByKey.keys()),L=Array.from(g.qtyByKey.keys()),P=[];for(const ct of f)for(const Et of L){const St=Bt(ct,Et);St>=.9&&P.push({ek:ct,sk:Et,sc:St})}P.sort((ct,Et)=>Et.sc-ct.sc);const b=new Map,A=new Set,D=new Set;for(const ct of P)A.has(ct.ek)||D.has(ct.sk)||(b.set(ct.ek,ct.sk),A.add(ct.ek),D.add(ct.sk));const U=[],lt=[];for(const[ct,Et]of x.qtyByKey.entries()){const St=b.get(ct)||ct,Zt=g.qtyByKey.get(St)||0;Zt<Et&&U.push({name:x.labelByKey.get(ct)||ct,qty:Et-Zt})}for(const[ct,Et]of g.qtyByKey.entries()){let St=x.qtyByKey.get(ct)||0;if(!St){for(const[Zt,xt]of b.entries())if(xt===ct){St=x.qtyByKey.get(Zt)||0;break}}St<Et&&lt.push({name:g.labelByKey.get(ct)||ct,qty:Et-St})}return{hasDiff:U.length>0||lt.length>0,missingInSystem:U,missingInExcel:lt}},re=i=>{if(!(i!=null&&i.hasDiff))return"";const l=g=>g.slice(0,4).map(f=>`${f.name} x${f.qty}`).join(", ")+(g.length>4?` (+${g.length-4})`:""),x=[];return Array.isArray(i.missingInExcel)&&i.missingInExcel.length&&x.push(`Thi\u1EBFu trong Excel: ${l(i.missingInExcel)}`),Array.isArray(i.missingInSystem)&&i.missingInSystem.length&&x.push(`Thi\u1EBFu trong h\u1EC7 th\u1ED1ng: ${l(i.missingInSystem)}`),x.join(" \xB7 ")},An=async i=>{Ct(""),jt(null),Gt((i==null?void 0:i.name)||""),Ot(!0),ue("\u0110ang \u0111\u1ECDc file Excel...");try{await Qe();const l=await h(i),x=Array.isArray(l.rows)?l.rows:[],g=String(B||"").trim()||getCurrentMonth(),f=nt=>{const s=String(nt||"").match(/^(\d{4})-(\d{2})$/);if(!s)return NaN;const u=Number(s[1]),c=Number(s[2]);return!Number.isFinite(u)||!Number.isFinite(c)||c<1||c>12?NaN:u*12+(c-1)},L=nt=>{if(!Number.isFinite(nt))return"";const s=Math.floor(nt/12),u=nt%12+1;return!Number.isFinite(s)||!Number.isFinite(u)||u<1||u>12?"":`${String(s).padStart(4,"0")}-${String(u).padStart(2,"0")}`},P=f(g),b=Number.isFinite(P)?P-2:NaN,A=nt=>{const s=f(nt);return!Number.isFinite(s)||!Number.isFinite(P)||!Number.isFinite(b)?!1:s>=b&&s<=P},D=(()=>{if(!Number.isFinite(P)||!Number.isFinite(b))return[g];const nt=[];for(let s=b;s<=P;s++){const u=L(s);u&&nt.push(u)}return nt.length?nt:[g]})(),U=x.filter(nt=>{const s=String((nt==null?void 0:nt.monthKey)||"").trim();return s?A(s):!0}),lt=x.filter(nt=>{const s=String((nt==null?void 0:nt.monthKey)||"").trim();return s?!A(s):!1});if(!U.length)throw new Error(`File kh\xF4ng c\xF3 d\u1EEF li\u1EC7u trong 3 th\xE1ng g\u1EA7n nh\u1EA5t quanh ${g}.`);const gt=D,ct=await Pt(gt),Et=(()=>{const nt=new Map;for(const s of Array.isArray(ct)?ct:[]){const u=String((s==null?void 0:s.phoneNorm)||"").trim(),c=String((s==null?void 0:s.dayKey)||"").trim();if(!u||!c)continue;const I=`${u}|${c}`;nt.set(I,(nt.get(I)||0)+1)}return nt})(),St=nt=>{const s=Number(nt);return Number.isFinite(s)?Math.trunc(s):0},Zt=(nt,s)=>{const u=String(nt||"").trim(),c=St(s);return!u||!c?"":`${u}|${c}`},xt=(()=>{const nt=new Map;for(const s of Array.isArray(ct)?ct:[]){const u=Zt(s==null?void 0:s.phoneNorm,s==null?void 0:s.cod);u&&nt.set(u,(nt.get(u)||0)+1)}return nt})(),me=new Set(ct.map(nt=>Zt(nt==null?void 0:nt.phoneNorm,nt==null?void 0:nt.cod)).filter(Boolean)),mt=(()=>{var s,u,c,I,R;const nt=new Map;for(const v of lt){const S=Zt(v==null?void 0:v.phoneNorm,v==null?void 0:v.cod);if(!S||!me.has(S))continue;const Z=nt.get(S)||[];Z.push({rowIndex:(s=v==null?void 0:v.rowIndex)!=null?s:null,dateRaw:(u=v==null?void 0:v.dateRaw)!=null?u:"",monthKey:(c=v==null?void 0:v.monthKey)!=null?c:"",dayKey:(I=v==null?void 0:v.dayKey)!=null?I:"",product:(R=v==null?void 0:v.product)!=null?R:""}),nt.set(S,Z)}return nt})(),Wt=U,Me=nt=>{const s=Number((nt==null?void 0:nt.cod)||0)||0;if(s>0)return s;const u=Number((nt==null?void 0:nt.codAlt)||0)||0;return u>0?u:0},Ae=nt=>{var c;const s=new Map;for(const I of Array.isArray(nt)?nt:[]){const R=String((I==null?void 0:I.phoneNorm)||"").trim(),v=String((I==null?void 0:I.dayKey)||"").trim();if(!R||!v)continue;const S=`${R}|${v}`,Z=s.get(S)||[];Z.push(I),s.set(S,Z)}const u=[];for(const[I,R]of s.entries()){if(!Array.isArray(R)||R.length<2)continue;const[v,S]=String(I).split("|"),Z=S&&S.length>=7?S.slice(0,7):"",Q=R.map(Me).filter(Kt=>Kt>0).reduce((Kt,bt)=>Kt+bt,0);if(!Q)continue;const W=R.map(Kt=>Kt==null?void 0:Kt.rowIndex).filter(Boolean),et=[],kt=new Set;for(const Kt of R){const bt=String((Kt==null?void 0:Kt.product)||"").trim();bt&&(kt.has(bt)||(kt.add(bt),et.push(bt)))}u.push({key:`merge:p:${v}:d:${S}`,isMerged:!0,phoneNorm:v,phone:v,monthKey:Z,dayKey:S,dateRaw:((c=R.find(Kt=>Kt==null?void 0:Kt.dateRaw))==null?void 0:c.dateRaw)||"",rowIndices:W,rowIndexFirst:W.length?Math.min(...W):null,rowCount:R.length,productDisplay:et.join(" + "),productNorm:"",productCompact:"",cod:Q,codCandidates:[],rows:R})}return u},xe=V(Wt),Ht=Ae(Wt),j=Ht.length?xe.concat(Ht):xe;ue(`\u0110\u1ECDc \u0111\u01B0\u1EE3c ${Wt.length} d\xF2ng (${xe.length} c\u1EE5m; +${Ht.length} c\u1EE5m g\u1ED9p) trong 3 th\xE1ng g\u1EA7n nh\u1EA5t. \u0110ang chu\u1EA9n b\u1ECB \u0111\u1ED1i so\xE1t...`),ue(`\u0110ang \u0111\u1ED1i so\xE1t (${j.length} c\u1EE5m Excel vs ${ct.length} \u0111\u01A1n h\u1EC7 th\u1ED1ng)...`);const ut=new Map,le=new Map,he=new Map;for(const nt of j){const s=String(nt.phoneNorm||"").trim();if(!s)continue;const u=ut.get(s)||[];u.push(nt),ut.set(s,u);const c=Zt(s,nt.cod);if(c){const I=le.get(c)||[];I.push(nt),le.set(c,I);const R=String((nt==null?void 0:nt.dayKey)||"").trim();if(R){const v=`${c}|${R}`,S=he.get(v)||[];S.push(nt),he.set(v,S)}}}const ke=new Set,Be=(()=>{const nt=new Map;for(const s of j){const u=String((s==null?void 0:s.key)||"").trim();if(!u)continue;const c=Array.isArray(s==null?void 0:s.rowIndices)?s.rowIndices:[];for(const I of c){const R=Number(I);if(!Number.isFinite(R))continue;const v=nt.get(R)||[];v.push(u),nt.set(R,v)}}return nt})(),fe=nt=>{const s=Array.isArray(nt==null?void 0:nt.rowIndices)?nt.rowIndices:[];for(const c of s){const I=Number(c);if(!Number.isFinite(I))continue;const R=Be.get(I)||[];for(const v of R)ke.add(String(v))}const u=String((nt==null?void 0:nt.key)||"").trim();u&&ke.add(u)},Re=[],tn=[],je=[],en=nt=>{const s=Array.isArray(nt)?nt.filter(Boolean):[];return s.length?`C\xF3 d\xF2ng Excel ngo\xE0i 3 th\xE1ng tr\xF9ng S\u0110T+COD: ${s.slice(0,2).map(c=>{const I=String((c==null?void 0:c.dateRaw)||(c==null?void 0:c.dayKey)||(c==null?void 0:c.monthKey)||"").trim(),R=c!=null&&c.rowIndex?`d\xF2ng ${c.rowIndex}`:"";return[I,R].filter(Boolean).join(" \xB7 ")}).join(" | ")}`:""};for(const nt of ct){const s=String(nt.phoneNorm||"").trim(),u=St(nt.cod);if(!s||!u){je.push(nt);continue}const c=Zt(s,u),I=String(nt.dayKey||"").trim();let R=c?le.get(c)||[]:[],v=[];if(c&&I&&(v=he.get(`${c}|${I}`)||[]),I&&R.length){const ht=(xt.get(c)||0)>1;R=R.filter(ve=>{const te=String((ve==null?void 0:ve.dayKey)||"").trim();return te?te===I:!ht})}const S=ht=>{if(!(ht!=null&&ht.isMerged))return!0;const ve=String((ht==null?void 0:ht.dayKey)||"").trim();return!I||!ve||ve!==I?!1:(Et.get(`${s}|${I}`)||0)===1},Z=ht=>{const ve=(Array.isArray(ht)?ht:[]).filter($=>!ke.has(String($==null?void 0:$.key)));if(!ve.length)return null;let te=ve.find($=>!($!=null&&$.isMerged))||null;return te||(te=ve.find($=>S($))||null),te&&(te!=null&&te.isMerged)&&!S(te)?null:te};if(v.length){const ht=Z(v);if(ht){fe(ht),Re.push({group:ht,order:nt,score:1,reasons:["S\u0110T tr\xF9ng","COD tr\xF9ng","C\xF9ng ng\xE0y"]});continue}}if(R.length){const ht=Z(R);if(ht){fe(ht),Re.push({group:ht,order:nt,score:1,reasons:["S\u0110T tr\xF9ng","COD tr\xF9ng",...ht.dayKey&&I&&ht.dayKey===I?["C\xF9ng ng\xE0y"]:[]]});continue}}const Q=ut.get(s)||[];if(!Q.length){const ht=mt.get(c)||[];je.push(ht.length?{...nt,excelOutsideHints:ht,excelOutsideHintText:en(ht)}:nt);continue}let W=Q.filter(ht=>!ke.has(String(ht==null?void 0:ht.key)));if(I){const ht=W.filter(ve=>String(ve.dayKey||"").trim()===I);ht.length&&(W=ht)}if(!W.length){const ht=mt.get(c)||[];je.push(ht.length?{...nt,excelOutsideHints:ht,excelOutsideHintText:en(ht)}:nt);continue}let et=null,kt=Number.POSITIVE_INFINITY;for(const ht of W){const ve=St(ht.cod);if(!ve)continue;const te=Math.abs(ve-u);te<kt&&(kt=te,et=ht)}if(!et){const ht=mt.get(c)||[];je.push(ht.length?{...nt,excelOutsideHints:ht,excelOutsideHintText:en(ht)}:nt);continue}const Kt=St(et.cod)-u,bt=Math.abs(Kt),de=Ge?Math.max(0,St(M)):0;if(bt===0||de>0&&bt<=de){fe(et),Re.push({group:et,order:nt,score:1,reasons:["S\u0110T tr\xF9ng","COD tr\xF9ng",...de>0&&bt>0?[`Trong ng\u01B0\u1EE1ng \xB1${de}`]:[],...I&&String(et.dayKey||"").trim()===I?["C\xF9ng ng\xE0y"]:[]]});continue}tn.push({group:et,order:nt,score:0,diff:Kt,reason:I&&String(et.dayKey||"").trim()===I?"S\u0110T tr\xF9ng \xB7 C\xF9ng ng\xE0y":"S\u0110T tr\xF9ng",suggestions:W.slice(0,3).map(ht=>({key:ht.key,cod:St(ht.cod),productSummary:String(ht.product||"").trim(),score:0,reasons:["Excel c\xF9ng S\u0110T"]}))})}const pn=je.length===0&&tn.length===0;jt({ok:pn,monthKeys:gt,excelCount:Wt.length,excelGroupCount:j.length,systemCount:ct.length,matches:Re,systemOnly:je,moneyMismatch:tn}),ye(je.length?"systemOnly":tn.length?"moneyMismatch":"matches"),N(new Set),ue(pn?"OK \u2705":"\u0110\xE3 \u0111\u1ED1i so\xE1t xong")}catch(l){Ct(String((l==null?void 0:l.message)||l||"L\u1ED7i \u0111\u1ED1i so\xE1t")),ue("")}finally{Ot(!1)}},fn=(i,l)=>{var D,U,lt,gt,ct,Et,St,Zt,xt,me;const x=mt=>String(mt||"").replace(/[^0-9]/g,""),g=(i==null?void 0:i.raw)||{},f=String((U=(D=i==null?void 0:i.id)!=null?D:g==null?void 0:g.id)!=null?U:"").trim(),L=x((gt=(lt=g==null?void 0:g.phone)!=null?lt:i==null?void 0:i.phone)!=null?gt:"");if(!f||!L)return null;let b=(Array.isArray(g==null?void 0:g.items)?g.items:[]).map(mt=>{var Wt,Me;return{product_id:(mt==null?void 0:mt.product_id)||"",quantity:Number((Wt=mt==null?void 0:mt.quantity)!=null?Wt:1),variant:String((mt==null?void 0:mt.variant)||"").trim()||null,variant_json:(Me=mt==null?void 0:mt.variant_json)!=null?Me:null,unit_price:(()=>{var Ht;const Ae=(Ht=mt==null?void 0:mt.unit_price)!=null?Ht:mt==null?void 0:mt.unitPrice,xe=Ae==null||Ae===""?NaN:Number(Ae);return Number.isFinite(xe)?Math.max(0,Math.trunc(xe)):null})()}}).filter(mt=>mt.product_id&&Number.isFinite(mt.quantity)&&mt.quantity>0);if(!b.length&&(g!=null&&g.product_id)){const mt=Number((ct=g==null?void 0:g.quantity)!=null?ct:1);b=[{product_id:g.product_id,quantity:Number.isFinite(mt)&&mt>0?mt:1,variant:null,variant_json:null,unit_price:null}]}if(!b.length)return null;const A=b[0];return{id:f,customer_name:String((Et=g==null?void 0:g.customer_name)!=null?Et:"").trim(),phone:L,address:String((St=g==null?void 0:g.address)!=null?St:"").trim(),note:String((Zt=g==null?void 0:g.note)!=null?Zt:"").trim(),adjustment_amount:Number((xt=g==null?void 0:g.adjustment_amount)!=null?xt:0)||0,adjustment_note:String((me=g==null?void 0:g.adjustment_note)!=null?me:"").trim(),product_id:A.product_id,quantity:A.quantity,status:l,items:b}},wn=async()=>{if(!ot||ft)return;const i=Array.from(At.values()).map(g=>String(g||"").trim()).filter(Boolean);if(!i.length||!confirm(`\u0110\xE1nh d\u1EA5u Ho\xE0n th\xE0nh cho ${i.length} \u0111\u01A1n kh\u1EDBp?`))return;vt(!0),wt("\u0110ang c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i...");let l=0;const x=[];try{for(let g=0;g<i.length;g++){const f=i[g];wt(`\u0110ang c\u1EADp nh\u1EADt (${g+1}/${i.length})...`);const L=(Array.isArray(ot==null?void 0:ot.matches)?ot.matches:[]).find(b=>{var A;return String(((A=b==null?void 0:b.order)==null?void 0:A.id)||"")===f}),P=fn(L==null?void 0:L.order,"done");if(!P){x.push({id:f,error:"Thi\u1EBFu d\u1EEF li\u1EC7u (phone/items)"});continue}try{await window.KTM.api.putJSON(`${API_BASE}/api/orders/${encodeURIComponent(f)}`,P,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),l+=1}catch(b){x.push({id:f,error:String((b==null?void 0:b.message)||b||"L\u1ED7i")})}}}finally{vt(!1),wt("")}if(l>0){q(`\u0110\xE3 c\u1EADp nh\u1EADt ${l} \u0111\u01A1n sang Ho\xE0n th\xE0nh`,"success");const g=new Set(i);jt(f=>{if(!f)return f;const L=P=>{if(!P||!g.has(String(P.id)))return P;const b=P.raw?{...P.raw,status:"done"}:P.raw;return{...P,status:"done",raw:b}};return{...f,matches:Array.isArray(f.matches)?f.matches.map(P=>({...P,order:L(P==null?void 0:P.order)})):f.matches,systemOnly:Array.isArray(f.systemOnly)?f.systemOnly.map(L):f.systemOnly,moneyMismatch:Array.isArray(f.moneyMismatch)?f.moneyMismatch.map(P=>({...P,order:L(P==null?void 0:P.order)})):f.moneyMismatch}}),N(new Set)}x.length&&(q(`C\xF3 ${x.length} \u0111\u01A1n c\u1EADp nh\u1EADt l\u1ED7i (xem console)`,"warning"),console.warn("Recon paid update failures:",x))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t Excel")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Th\xE1ng m\u1EB7c \u0111\u1ECBnh (n\u1EBFu Excel kh\xF4ng c\xF3 c\u1ED9t ng\xE0y)"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:it,onChange:i=>Y(i.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:G}))))),React.createElement("div",{className:"card border-0 shadow-sm mb-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{className:"fw-semibold"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 (Excel)"),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("span",{className:"text-muted small"},"\u0110\u1ED1i so\xE1t theo: ",React.createElement("span",{className:"fw-semibold"},"S\u0110T")," + ",React.createElement("span",{className:"fw-semibold"},"T\u1ED5ng ti\u1EC1n thu h\u1ED9")))),Ft==="loading"&&React.createElement("div",{className:"alert alert-info mt-3 mb-0"},"\u0110ang t\u1EA3i th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX)..."),Ft==="failed"&&React.createElement("div",{className:"alert alert-warning mt-3 mb-0"},"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). H\xE3y ki\u1EC3m tra m\u1EA1ng / ch\u1EB7n CDN (AdBlock) ho\u1EB7c refresh l\u1EA1i trang."),React.createElement("div",{className:"row g-2 align-items-end mt-2"},React.createElement("div",{className:"col-12 col-md-7"},React.createElement("label",{className:"form-label mb-1"},"Upload file Excel"),React.createElement("input",{type:"file",className:"form-control",accept:".xlsx,.xls,.csv",disabled:G,onChange:async i=>{const l=i.target.files&&i.target.files[0];l&&await An(l)}}),React.createElement("div",{className:"form-text"},Lt?`File: ${Lt}`:'Header c\u1EA7n c\xF3: "T\u1ED5ng Ti\u1EC1n Thu H\u1ED9". "T\xEAn s\u1EA3n ph\u1EA9m" (n\u1EBFu c\xF3) s\u1EBD gi\xFAp g\u1EE3i \xFD kh\u1EDBp t\u1ED1t h\u01A1n. C\xF3 c\u1ED9t "Ng\xE0y" th\xEC s\u1EBD t\u1EF1 t\u1EA3i \u0111\xFAng th\xE1ng trong file.')),React.createElement("div",{className:"col-12 col-md-5"},React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("label",{className:"form-label mb-0 small text-muted"},"Ng\xE0y theo"),React.createElement("select",{className:"form-select form-select-sm",style:{width:150},value:ae,disabled:G,onChange:i=>Fe(i.target.value)},React.createElement("option",{value:"created_at"},"created_at"),React.createElement("option",{value:"updated_at"},"updated_at"))),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-draft",checked:Jt,disabled:G,onChange:i=>oe(!!i.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-draft"},"B\u1ECF nh\xE1p")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-canceled",checked:Rt,disabled:G,onChange:i=>Ce(!!i.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-canceled"},"B\u1ECF h\u1EE7y")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-paid",checked:_e,disabled:G,onChange:i=>sn(!!i.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-paid"},"B\u1ECF \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n")),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("div",{className:"form-check mb-0"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-cod-tol",checked:Ge,disabled:G,onChange:i=>C(!!i.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-cod-tol"},"Cho l\u1EC7ch COD")),React.createElement("input",{type:"number",className:"form-control form-control-sm",style:{width:110},value:M,min:"0",step:"1000",disabled:G||!Ge,onChange:i=>H(i.target.value)})))),React.createElement("div",{className:"col-12 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",disabled:G,onClick:()=>{Ct(""),ue(""),jt(null),Gt(""),ye("matches"),Te(""),q("\u0110\xE3 reset \u0111\u1ED1i so\xE1t","info")}},React.createElement("i",{className:"fas fa-rotate-left me-2"}),"Reset"))),Ut&&React.createElement("div",{className:"mt-2 small text-muted"},Ut),Xt&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0"},Xt),ot&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:`alert ${ot.ok?"alert-success":"alert-warning"} mb-3`},ot.ok?React.createElement("div",{className:"fw-semibold"},"OK \u2014 Kh\xF4ng th\u1EA5y \u0111\u01A1n h\u1EC7 th\u1ED1ng b\u1ECB thi\u1EBFu trong Excel ho\u1EB7c l\u1EC7ch ti\u1EC1n."):React.createElement("div",{className:"fw-semibold"},"CH\u01AFA KH\u1EDAP \u2014 C\xF3 \u0111\u01A1n h\u1EC7 th\u1ED1ng thi\u1EBFu trong Excel ho\u1EB7c l\u1EC7ch ti\u1EC1n."),React.createElement("div",{className:"small mt-1"},"Th\xE1ng \u0111\u1ED1i so\xE1t: ",Array.isArray(ot.monthKeys)?ot.monthKeys.join(", "):""," \xB7 Excel: ",ot.excelCount," d\xF2ng",Number(ot.excelGroupCount||0)?` (${ot.excelGroupCount} c\u1EE5m)`:""," \xB7 H\u1EC7 th\u1ED1ng: ",ot.systemCount," \u0111\u01A1n")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center justify-content-between mb-2"},React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Recon view"},React.createElement("button",{type:"button",className:`btn ${X==="matches"?"btn-success":"btn-outline-success"}`,disabled:!Array.isArray(ot.matches)||ot.matches.length===0,onClick:()=>ye("matches")},"Kh\u1EDBp (",Array.isArray(ot.matches)?ot.matches.length:0,")"),React.createElement("button",{type:"button",className:`btn ${X==="systemOnly"?"btn-warning":"btn-outline-warning"}`,disabled:!Array.isArray(ot.systemOnly)||ot.systemOnly.length===0,onClick:()=>ye("systemOnly")},"Thi\u1EBFu Excel (",Array.isArray(ot.systemOnly)?ot.systemOnly.length:0,")"),React.createElement("button",{type:"button",className:`btn ${X==="moneyMismatch"?"btn-danger":"btn-outline-danger"}`,disabled:!Array.isArray(ot.moneyMismatch)||ot.moneyMismatch.length===0,onClick:()=>ye("moneyMismatch")},"Sai ti\u1EC1n (",Array.isArray(ot.moneyMismatch)?ot.moneyMismatch.length:0,")")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("input",{type:"text",className:"form-control form-control-sm recon-phone-input",placeholder:"L\u1ECDc theo S\u0110T...",value:we,onChange:i=>Te(i.target.value)}),React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Export CSV"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{var x,g,f,L,P,b,A;const i=Qt(we),l=[["type","order_id","date","phone","product","cod_excel","cod_system","diff","reason"]];for(const D of Array.isArray(ot.moneyMismatch)?ot.moneyMismatch:[])i&&String(((x=D==null?void 0:D.group)==null?void 0:x.phoneNorm)||"").indexOf(i)<0||l.push(["moneyMismatch",((g=D==null?void 0:D.order)==null?void 0:g.id)||"",String(((f=D==null?void 0:D.group)==null?void 0:f.dateRaw)||""),((L=D==null?void 0:D.group)==null?void 0:L.phone)||"",((P=D==null?void 0:D.group)==null?void 0:P.productDisplay)||"",Number(((b=D==null?void 0:D.group)==null?void 0:b.cod)||0),Number(((A=D==null?void 0:D.order)==null?void 0:A.cod)||0),Number((D==null?void 0:D.diff)||0),String((D==null?void 0:D.reason)||"")]);for(const D of Array.isArray(ot.systemOnly)?ot.systemOnly:[])i&&String((D==null?void 0:D.phoneNorm)||"").indexOf(i)<0||l.push(["systemOnly",(D==null?void 0:D.id)||"",window.KTM.date.formatDateTime(D==null?void 0:D.created_at),(D==null?void 0:D.phone)||"",(D==null?void 0:D.productSummary)||"","",Number((D==null?void 0:D.cod)||0),"",String((D==null?void 0:D.excelOutsideHintText)||"")]);cn(`recon_${String(B||"").replace(/[^0-9\-]/g,"")}.csv`,l)}},"Export CSV")))),Array.isArray(ot.moneyMismatch)&&ot.moneyMismatch.length>0&&X==="moneyMismatch"&&React.createElement("div",{className:"card border-0 shadow-sm mb-2"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-danger"},"Sai l\u1EC7ch s\u1ED1 ti\u1EC1n"),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m (Excel)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (Excel)"),React.createElement("th",null,"Order ID"),React.createElement("th",null,"T\xEAn SP (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"L\u1EC7ch"),React.createElement("th",null,"L\xFD do"))),React.createElement("tbody",null,ot.moneyMismatch.filter(i=>{var x;const l=Qt(we);return l?String(((x=i==null?void 0:i.group)==null?void 0:x.phoneNorm)||"").includes(l):!0}).slice(0,30).map(i=>{var l,x,g,f,L,P,b,A,D,U;return React.createElement("tr",{key:`mm-${String(((l=i==null?void 0:i.group)==null?void 0:l.key)||((x=i==null?void 0:i.order)==null?void 0:x.id)||Math.random())}`,className:"table-danger"},React.createElement("td",null,((g=i==null?void 0:i.group)==null?void 0:g.rowIndexFirst)||"\u2014",Number(((f=i==null?void 0:i.group)==null?void 0:f.rowCount)||0)>1?` (+${Number(i.group.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},((L=i==null?void 0:i.group)==null?void 0:L.phone)||"\u2014"),React.createElement("td",{style:{minWidth:260}},((P=i==null?void 0:i.group)==null?void 0:P.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number(((b=i==null?void 0:i.group)==null?void 0:b.cod)||0))),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{qt((i==null?void 0:i.order)||null),at(!0)}},(A=i==null?void 0:i.order)==null?void 0:A.id)),React.createElement("td",{style:{minWidth:240}},(D=i==null?void 0:i.order)==null?void 0:D.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber((U=i==null?void 0:i.order)==null?void 0:U.cod)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(i==null?void 0:i.diff)),React.createElement("td",{className:"text-muted",style:{minWidth:220}},(i==null?void 0:i.reason)||""))})))),ot.moneyMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ot.moneyMismatch.length," d\xF2ng.")),React.createElement("div",{className:"d-md-none"},ot.moneyMismatch.filter(i=>{var x;const l=Qt(we);return l?String(((x=i==null?void 0:i.group)==null?void 0:x.phoneNorm)||"").includes(l):!0}).slice(0,30).map(i=>{var g,f,L,P,b,A,D,U,lt,gt,ct,Et;const l=`${((g=i==null?void 0:i.group)==null?void 0:g.rowIndexFirst)||"\u2014"}${Number(((f=i==null?void 0:i.group)==null?void 0:f.rowCount)||0)>1?` (+${Number(i.group.rowCount)-1})`:""}`,x=String(((L=i==null?void 0:i.group)==null?void 0:L.dateRaw)||((P=i==null?void 0:i.group)==null?void 0:P.dayKey)||"").trim();return React.createElement("div",{key:`mm-m-${String(((b=i==null?void 0:i.group)==null?void 0:b.key)||((A=i==null?void 0:i.order)==null?void 0:A.id)||Math.random())}`,className:"recon-mobile-card recon-mobile-card-danger"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold text-truncate",style:{maxWidth:"70%"}},((D=i==null?void 0:i.group)==null?void 0:D.phone)||"\u2014"),React.createElement("div",{className:"fw-semibold text-danger"},window.KTM.money.formatNumber(i==null?void 0:i.diff))),React.createElement("div",{className:"small text-muted mt-1"},"Excel d\xF2ng ",l,x?` \u2022 ${x}`:""),React.createElement("div",{className:"mt-2"},React.createElement("div",{className:"recon-mobile-kv"},React.createElement("span",{className:"text-muted"},"Thu h\u1ED9 (Excel)"),React.createElement("span",{className:"fw-semibold"},window.KTM.money.formatNumber(Number(((U=i==null?void 0:i.group)==null?void 0:U.cod)||0)))),React.createElement("div",{className:"recon-mobile-value mt-1"},((lt=i==null?void 0:i.group)==null?void 0:lt.productDisplay)||"\u2014")),React.createElement("div",{className:"mt-2 pt-2 border-top"},React.createElement("div",{className:"recon-mobile-kv"},React.createElement("span",{className:"text-muted"},"Order"),React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{qt((i==null?void 0:i.order)||null),at(!0)}},((gt=i==null?void 0:i.order)==null?void 0:gt.id)||"\u2014")),React.createElement("div",{className:"recon-mobile-value mt-1"},((ct=i==null?void 0:i.order)==null?void 0:ct.productSummary)||"\u2014"),React.createElement("div",{className:"recon-mobile-kv mt-1"},React.createElement("span",{className:"text-muted"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("span",{className:"fw-semibold"},window.KTM.money.formatNumber(Number(((Et=i==null?void 0:i.order)==null?void 0:Et.cod)||0))))),i!=null&&i.reason?React.createElement("div",{className:"small text-muted mt-2"},"L\xFD do: ",i.reason):null)}),ot.moneyMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ot.moneyMismatch.length," d\xF2ng.")))),Array.isArray(ot.systemOnly)&&ot.systemOnly.length>0&&X==="systemOnly"&&React.createElement("div",{className:"card border-0 shadow-sm mb-2"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong h\u1EC7 th\u1ED1ng nh\u01B0ng thi\u1EBFu trong Excel"),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y t\u1EA1o"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,ot.systemOnly.filter(i=>{const l=Qt(we);return l?String((i==null?void 0:i.phoneNorm)||"").includes(l):!0}).slice(0,30).map(i=>React.createElement("tr",{key:`so-${i.id}`,className:"table-warning"},React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{qt(i||null),at(!0)}},i.id)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(i.created_at)),React.createElement("td",{className:"text-muted"},i.phone||"\u2014"),React.createElement("td",{style:{minWidth:280}},i.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(i.cod)),React.createElement("td",{className:"text-muted"},i.status,i!=null&&i.excelOutsideHintText?React.createElement("div",{className:"small text-muted mt-1"},i.excelOutsideHintText):null)))))),ot.systemOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ot.systemOnly.length," \u0111\u01A1n.")),React.createElement("div",{className:"d-md-none"},ot.systemOnly.filter(i=>{const l=Qt(we);return l?String((i==null?void 0:i.phoneNorm)||"").includes(l):!0}).slice(0,30).map(i=>React.createElement("div",{key:`so-m-${i.id}`,className:"recon-mobile-card recon-mobile-card-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{qt(i||null),at(!0)}},i.id),React.createElement("span",{className:"badge bg-secondary"},i.status||"\u2014")),React.createElement("div",{className:"small text-muted mt-1"},window.KTM.date.formatDateTime(i.created_at),i.phone?` \u2022 ${i.phone}`:""),React.createElement("div",{className:"recon-mobile-value mt-2"},i.productSummary||"\u2014"),React.createElement("div",{className:"recon-mobile-kv mt-2"},React.createElement("span",{className:"text-muted"},"Thu h\u1ED9"),React.createElement("span",{className:"fw-semibold"},window.KTM.money.formatNumber(i.cod))),i!=null&&i.excelOutsideHintText?React.createElement("div",{className:"small text-muted mt-2"},i.excelOutsideHintText):null)),ot.systemOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ot.systemOnly.length," \u0111\u01A1n.")))),X==="matches"&&Array.isArray(ot.matches)&&ot.matches.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2"},React.createElement("div",{className:"fw-semibold"},"\u0110\u01A1n \u0111\xE3 kh\u1EDBp"),React.createElement("div",{className:"d-flex flex-wrap align-items-center gap-2"},dt?React.createElement("span",{className:"text-muted small"},dt):null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",disabled:ft||!(At&&At.size),onClick:wn},"\u0110\xE1nh d\u1EA5u ho\xE0n th\xE0nh"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:34}},React.createElement("input",{type:"checkbox",checked:(()=>{var x;const i=Qt(we),l=(ot.matches||[]).filter(g=>{var P;const f=g==null?void 0:g.order;if(!(f!=null&&f.id))return!1;const L=String((f==null?void 0:f.status)||((P=f==null?void 0:f.raw)==null?void 0:P.status)||"").toLowerCase();return!(_e&&(L==="paid"||L==="done")||i&&!String((f==null?void 0:f.phoneNorm)||"").includes(i))});if(!l.length)return!1;for(const g of l)if(!At.has(String(((x=g==null?void 0:g.order)==null?void 0:x.id)||"")))return!1;return!0})(),onChange:i=>{const l=!!i.target.checked;N(x=>{var P;const g=new Set(x),f=Qt(we),L=(ot.matches||[]).filter(b=>{var U;const A=b==null?void 0:b.order;if(!(A!=null&&A.id))return!1;const D=String((A==null?void 0:A.status)||((U=A==null?void 0:A.raw)==null?void 0:U.status)||"").toLowerCase();return!(_e&&(D==="paid"||D==="done")||f&&!String((A==null?void 0:A.phoneNorm)||"").includes(f))});for(const b of L){const A=String(((P=b==null?void 0:b.order)==null?void 0:P.id)||"").trim();A&&(l?g.add(A):g.delete(A))}return g})}})),React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"Excel"),React.createElement("th",null,"H\u1EC7 th\u1ED1ng"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,(ot.matches||[]).filter(i=>{var f;const l=i==null?void 0:i.order;if(!(l!=null&&l.id))return!1;const x=String((l==null?void 0:l.status)||((f=l==null?void 0:l.raw)==null?void 0:f.status)||"").toLowerCase();if(_e&&(x==="paid"||x==="done"))return!1;const g=Qt(we);return!(g&&!String((l==null?void 0:l.phoneNorm)||"").includes(g))}).slice(0,50).map(i=>{var g,f,L,P,b;const l=i.order,x=String(l.id);return React.createElement("tr",{key:`match-${x}`},React.createElement("td",null,React.createElement("input",{type:"checkbox",checked:At.has(x),onChange:A=>{const D=!!A.target.checked;N(U=>{const lt=new Set(U);return D?lt.add(x):lt.delete(x),lt})}})),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{qt(l||null),at(!0)}},x)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(l.created_at)),React.createElement("td",{className:"text-muted"},l.phone||"\u2014"),React.createElement("td",{style:{minWidth:240}},((g=i==null?void 0:i.group)==null?void 0:g.productDisplay)||"\u2014"),React.createElement("td",{style:{minWidth:240}},l.productSummary||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(l.cod)),React.createElement("td",null,React.createElement("span",{className:`badge ${String((l==null?void 0:l.status)||((f=l==null?void 0:l.raw)==null?void 0:f.status)||"").toLowerCase()==="paid"||String((l==null?void 0:l.status)||((L=l==null?void 0:l.raw)==null?void 0:L.status)||"").toLowerCase()==="done"?"bg-primary":"bg-secondary"}`},String((l==null?void 0:l.status)||((P=l==null?void 0:l.raw)==null?void 0:P.status)||"").toLowerCase()==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":(l==null?void 0:l.status)||((b=l==null?void 0:l.raw)==null?void 0:b.status)||"\u2014")))})))),React.createElement("div",{className:"text-muted small mt-2"},"Hi\u1EC3n th\u1ECB t\u1ED1i \u0111a 50 \u0111\u01A1n. D\xF9ng l\u1ECDc S\u0110T \u0111\u1EC3 thu h\u1EB9p.")),React.createElement("div",{className:"d-md-none"},(()=>{const i=(ot.matches||[]).filter(g=>{var b;const f=g==null?void 0:g.order;if(!(f!=null&&f.id))return!1;const L=String((f==null?void 0:f.status)||((b=f==null?void 0:f.raw)==null?void 0:b.status)||"").toLowerCase();if(_e&&(L==="paid"||L==="done"))return!1;const P=Qt(we);return!(P&&!String((f==null?void 0:f.phoneNorm)||"").includes(P))}).slice(0,50),l=i.map(g=>{var f;return String(((f=g==null?void 0:g.order)==null?void 0:f.id)||"").trim()}).filter(Boolean),x=(()=>{if(!l.length)return!1;for(const g of l)if(!At.has(g))return!1;return!0})();return React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-2"},React.createElement("label",{className:"d-flex align-items-center gap-2 small mb-0"},React.createElement("input",{type:"checkbox",checked:x,disabled:!l.length,onChange:g=>{const f=!!g.target.checked;N(L=>{const P=new Set(L);for(const b of l)f?P.add(b):P.delete(b);return P})}}),React.createElement("span",null,"Ch\u1ECDn t\u1EA5t c\u1EA3 (\u0111ang hi\u1EC3n th\u1ECB)")),React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",disabled:!l.length,onClick:()=>{N(g=>{const f=new Set(g);for(const L of l)f.delete(L);return f})}},"B\u1ECF ch\u1ECDn")),i.map(g=>{var b,A,D;const f=g==null?void 0:g.order,L=String((f==null?void 0:f.id)||"").trim(),P=String((f==null?void 0:f.status)||((b=f==null?void 0:f.raw)==null?void 0:b.status)||"").toLowerCase();return React.createElement("div",{key:`match-m-${L||String((f==null?void 0:f.created_at)||"")}`,className:"recon-mobile-card recon-mobile-card-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2",style:{minWidth:0}},React.createElement("input",{type:"checkbox",checked:!!L&&At.has(L),onChange:U=>{const lt=!!U.target.checked;N(gt=>{const ct=new Set(gt);return L&&(lt?ct.add(L):ct.delete(L)),ct})}}),React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none text-truncate",onClick:()=>{qt(f||null),at(!0)}},L||"\u2014")),React.createElement("span",{className:`badge ${P==="paid"||P==="done"?"bg-primary":"bg-secondary"}`},P==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":(f==null?void 0:f.status)||((A=f==null?void 0:f.raw)==null?void 0:A.status)||"\u2014")),React.createElement("div",{className:"small text-muted mt-1"},window.KTM.date.formatDateTime(f==null?void 0:f.created_at),f!=null&&f.phone?` \u2022 ${f.phone}`:""),React.createElement("div",{className:"recon-mobile-kv mt-2"},React.createElement("span",{className:"text-muted"},"Thu h\u1ED9"),React.createElement("span",{className:"fw-semibold"},window.KTM.money.formatNumber(f==null?void 0:f.cod))),React.createElement("div",{className:"recon-mobile-value mt-2"},React.createElement("span",{className:"text-muted"},"Excel:")," ",((D=g==null?void 0:g.group)==null?void 0:D.productDisplay)||"\u2014"),React.createElement("div",{className:"recon-mobile-value mt-1"},React.createElement("span",{className:"text-muted"},"H\u1EC7 th\u1ED1ng:")," ",(f==null?void 0:f.productSummary)||"\u2014"))}))})(),React.createElement("div",{className:"text-muted small mt-2"},"Hi\u1EC3n th\u1ECB t\u1ED1i \u0111a 50 \u0111\u01A1n. D\xF9ng l\u1ECDc S\u0110T \u0111\u1EC3 thu h\u1EB9p."))))))),React.createElement(AdminDrawer,{open:J,title:_t?`Order #${_t.id}`:"Order",subtitle:_t?`${_t.phone||""} \u2022 ${window.KTM.money.formatNumber(Number(_t.cod||0))}`:"",onClose:()=>{at(!1),qt(null)}},_t?React.createElement("div",{className:"small"},React.createElement("div",{className:"mb-2"},React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Tr\u1EA1ng th\xE1i:")," ",_t.status||"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"created_at:")," ",window.KTM.date.formatDateTime(_t.created_at)),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"updated_at:")," ",_t.updated_at?window.KTM.date.formatDateTime(_t.updated_at):"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:")," ",_t.productSummary||"\u2014")),React.createElement("div",{className:"fw-semibold mb-1"},"Line items"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"#"),React.createElement("th",null,"product_id"),React.createElement("th",{className:"text-end"},"qty"),React.createElement("th",{className:"text-end"},"price"),React.createElement("th",{className:"text-end"},"total"))),React.createElement("tbody",null,(Array.isArray((be=_t==null?void 0:_t.raw)==null?void 0:be.items)?_t.raw.items:[]).map((i,l)=>{var P,b,A,D,U,lt;const x=String((b=(P=i==null?void 0:i.product_id)!=null?P:i==null?void 0:i.id)!=null?b:"").trim(),g=Number((D=(A=i==null?void 0:i.qty)!=null?A:i==null?void 0:i.quantity)!=null?D:0)||0,f=Number((lt=(U=i==null?void 0:i.price)!=null?U:i==null?void 0:i.unit_price)!=null?lt:0)||0,L=g*f;return React.createElement("tr",{key:`li-${l}-${x}`},React.createElement("td",{className:"text-muted"},l+1),React.createElement("td",{className:"text-muted"},x||"\u2014"),React.createElement("td",{className:"text-end"},g),React.createElement("td",{className:"text-end"},window.KTM.money.formatNumber(f)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(L)))}))))):null))}function AdminApp(){const[E,q]=useState(!1),[B,yt]=useState(""),[it,Y]=useState(null),[G,Ot]=useState("search"),[Xt,Ct]=useState(()=>loadAdminPins()),[Ut,ue]=useState(()=>loadAdminRecent()),[Lt,Gt]=useState(null),[ot,jt]=useState(""),[X,ye]=useState([]),[we,Te]=useState(null),[Jt,oe]=useState(!1),[Rt,Ce]=useState(null),[_e,sn]=useState(!0),[ae,Fe]=useState([]),[Ge,C]=useState(!1),[M,H]=useState(null),[ft,vt]=useState(!1),[dt,wt]=useState(!1),[At,N]=useState(""),[J,at]=useState(()=>loadAdminSettings()),[_t,qt]=useState(null),[Vt,$t]=useState([]);useEffect(()=>{const h=localStorage.getItem("ktm_admin_session");if(h)try{const V=JSON.parse(h);V.expiry>Date.now()?(q(!0),Y(V.user)):localStorage.removeItem("ktm_admin_session")}catch(V){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{E&&Le()},[E]),useEffect(()=>{const h=()=>{try{const st=document.querySelector(".admin-topbar");if(!st)return;const Pt=st.getBoundingClientRect(),Bt=Math.max(0,Math.round(Pt.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${Bt+10}px`)}catch(st){}};h(),window.addEventListener("resize",h);const V=setTimeout(h,0);return()=>{clearTimeout(V),window.removeEventListener("resize",h)}},[E,G]),useEffect(()=>{var st,Pt;const h=window.visualViewport,V=()=>{try{const Bt=Number(window.innerHeight)||0,Yt=Number(h==null?void 0:h.height)||Bt,$e=Number(h==null?void 0:h.offsetTop)||0,se=Math.max(0,Math.round(Bt-Yt-$e));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${se}px`)}catch(Bt){}};V(),window.addEventListener("resize",V);try{(st=h==null?void 0:h.addEventListener)==null||st.call(h,"resize",V),(Pt=h==null?void 0:h.addEventListener)==null||Pt.call(h,"scroll",V)}catch(Bt){}return()=>{var Bt,Yt;window.removeEventListener("resize",V);try{(Bt=h==null?void 0:h.removeEventListener)==null||Bt.call(h,"resize",V),(Yt=h==null?void 0:h.removeEventListener)==null||Yt.call(h,"scroll",V)}catch($e){}}},[]),useEffect(()=>{if(!E)return;const h=st=>{if(!st)return!1;const Pt=String(st.tagName||"").toLowerCase();return!!(Pt==="input"||Pt==="textarea"||Pt==="select"||st.isContentEditable)},V=st=>{if(!st||st.ctrlKey||st.metaKey||st.altKey||h(st.target))return;const Pt=st.key;(Pt==="/"||Pt==="N"||Pt==="n"||Pt==="Escape"||Pt==="j"||Pt==="J"||Pt==="k"||Pt==="K")&&(Pt==="/"&&st.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:Pt}})))};return document.addEventListener("keydown",V),()=>document.removeEventListener("keydown",V)},[E]),useEffect(()=>{E&&ue(h=>{const V=Array.isArray(h)?h:[],st=[G,...V.filter(Pt=>Pt!==G)].slice(0,8);return saveAdminRecent(st),st})},[E]);const It=h=>{const V=String(h||"").trim();V&&ue(st=>{const Pt=Array.isArray(st)?st:[],Bt=[V,...Pt.filter(Yt=>Yt!==V)].slice(0,8);return saveAdminRecent(Bt),Bt})},Ft=h=>{const V=String(h||"").trim();V&&Ct(st=>{const Pt=Array.isArray(st)?st:[],Yt=Pt.includes(V)?Pt.filter($e=>$e!==V):[V,...Pt].slice(0,10);return saveAdminPins(Yt),Yt})};useEffect(()=>{if(!E)return;let h=!1;return(async()=>{try{const V=await fetchAdminSettingsFromServer();if(h)return;at(V),saveAdminSettings(V)}catch(V){}})(),()=>{h=!0}},[E]);const ce=async(h,V)=>{yt("");try{const st=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:h,password:V},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),Pt={user:st.user,token:st.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(Pt)),Y(st.user),q(!0)}catch(st){yt(st.message)}},Ie=()=>{localStorage.removeItem("ktm_admin_session"),q(!1),Y(null),ye([]),Te(null)},pe=(h,V="success",st=null)=>{const Pt=Date.now()+Math.floor(Math.random()*1e3);if(h&&typeof h=="object"){const Yt=h;Fe($e=>[...$e,{id:Pt,message:String(Yt.message||""),type:String(Yt.type||V||"success"),actionLabel:Yt.actionLabel||null,onAction:typeof Yt.onAction=="function"?Yt.onAction:null,durationMs:Yt.durationMs||null}]);return}const Bt=st&&typeof st=="object"?st:null;Fe(Yt=>[...Yt,{id:Pt,message:String(h||""),type:String(V||"success"),actionLabel:(Bt==null?void 0:Bt.actionLabel)||null,onAction:typeof(Bt==null?void 0:Bt.onAction)=="function"?Bt.onAction:null,durationMs:(Bt==null?void 0:Bt.durationMs)||null}])},Ue=h=>{Fe(V=>V.filter(st=>st.id!==h))},Le=async(h=null)=>{sn(!0);try{const V=h?`${API_BASE}/api/albums?parent_id=${h}`:`${API_BASE}/api/albums?parent_id=root`,st=await window.KTM.api.getJSON(V,"L\u1ED7i t\u1EA3i danh s\xE1ch album");ye(Array.isArray(st)?st:[])}catch(V){console.error(V),pe("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}sn(!1)},Mt=()=>{Ce(null),oe(!0)},Ve=h=>{Qt(h),vt(!0)},on=async(h,V="modal")=>{try{const st=Rt&&Rt.uuid;!st&&_t&&(h.parent_id=_t.uuid);const Pt=st?`${API_BASE}/api/albums/${Rt.uuid||Rt.id}`:`${API_BASE}/api/albums`;st?await window.KTM.api.putJSON(Pt,h,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(Pt,h,"L\u1ED7i t\u1EA1o"),pe(st?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),V==="drawer"?(vt(!1),Ce(null),Le(_t==null?void 0:_t.uuid),st&&M&&H({...M,...h})):(oe(!1),Ce(null),Le(_t==null?void 0:_t.uuid))}catch(st){pe(st.message,"danger")}},mn=h=>{Te(h)},F=h=>{if(h==="root")$t([]),qt(null),Le(null);else if(h){const V=Vt.findIndex(st=>st.uuid===h.uuid);V>=0&&($t(Vt.slice(0,V+1)),qt(h),Le(h.uuid))}else{const V=[...Vt];V.pop();const st=V[V.length-1]||null;$t(V),qt(st),Le(st==null?void 0:st.uuid)}},rt=async h=>{const V=`X\xF3a folder "${h.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(V))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${h.uuid||h.id}`,"L\u1ED7i x\xF3a album"),pe("\u0110\xE3 x\xF3a","success"),Le(_t==null?void 0:_t.uuid)}catch(st){pe("L\u1ED7i x\xF3a album","danger")}},Qt=async h=>{h&&(C(!0),N(""),wt(!1),vt(!1),H(h))},cn=()=>{C(!1),wt(!1),N(""),vt(!1),H(null)},un=h=>{vt(!0)};if(!E)return React.createElement(LoginPage,{onLogin:ce,error:B});const Qe=()=>{const h=new Date,V=h.getFullYear(),st=String(h.getMonth()+1).padStart(2,"0");return`${V}-${st}`};function Ze(){const[h,V]=useState(()=>{var Yt;return String((Yt=J==null?void 0:J.ship_percent)!=null?Yt:DEFAULT_SHIP_PERCENT)}),[st,Pt]=useState(!1);return useEffect(()=>{var Yt;V(String((Yt=J==null?void 0:J.ship_percent)!=null?Yt:DEFAULT_SHIP_PERCENT))},[J==null?void 0:J.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Yt=>{Yt.preventDefault(),Pt(!0);const $e=saveAdminSettings({ship_percent:h});try{const se=await saveAdminSettingsToServer($e);at(se),saveAdminSettings(se),pe("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(se){at($e),pe("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{Pt(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:h,min:"0",max:"100",step:"0.01",onChange:Yt=>V(Yt.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:st},st?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function O(){const[h,V]=useState(Qe()),[st,Pt]=useState(!0),Bt=useRef(null),Yt=useRef(null),[$e,se]=useState(0),[hn,We]=useState(!1),Cn=useRef(0),ln=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[re,An]=useState(ln),fn=useRef(new Map),wn=normalizeShipPercent(J==null?void 0:J.ship_percent),{formatNumber:be,formatVND:i}=window.KTM.money,l=async(j,ut=!1)=>{var je,en;const le=String(j||"").trim();if(!le)return ln();const he=`${le}|${wn}`,ke=(je=fn.current)==null?void 0:je.get(he);if(!ut&&ke)return ke;const Be=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(le)}&ship_percent=${encodeURIComponent(wn)}`,fe=await window.KTM.api.getJSON(Be,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Re=fe!=null&&fe.stats&&(fe!=null&&fe.meta)?fe.stats:fe,tn=Re&&typeof Re=="object"?Re:ln();return(en=fn.current)==null||en.set(he,tn),tn},x=async(j=!1)=>{Pt(!0);try{const ut=await l(h,j);An(ut)}catch(ut){console.error("Load stats error:",ut),An(ln())}finally{Pt(!1)}};useEffect(()=>{x()},[h,wn]);const g=(j,ut)=>{const le=String(j||"").trim(),he=le.match(/^(\d{4})-(\d{2})$/);if(!he)return le;const ke=Number(he[1]),Be=Number(he[2])-1,fe=new Date(ke,Be,1);fe.setMonth(fe.getMonth()+Number(ut||0));const Re=fe.getFullYear(),tn=String(fe.getMonth()+1).padStart(2,"0");return`${Re}-${tn}`},f=Qe(),L=g(f,-5),P=j=>{const ut=String(j||"").trim();return ut?ut>=L&&ut<=f:!1},b=j=>{const ut=String(j||"").trim();return ut&&(ut<L?L:ut>f?f:ut)},A=j=>{const ut=Date.now();ut-Number(Cn.current||0)<1200||(Cn.current=ut,pe(j==="future"?"Kh\xF4ng xem \u0111\u01B0\u1EE3c th\xE1ng t\u01B0\u01A1ng lai":"Ch\u1EC9 xem t\u1ED1i \u0111a 5 th\xE1ng g\u1EA7n nh\u1EA5t","warning"))},D=(j,ut,le)=>Math.max(ut,Math.min(le,j)),U=()=>{var j;return Math.max(320,Number((j=Yt.current)==null?void 0:j.clientWidth)||360)},lt=()=>{const j=U();return D(Math.floor(j*.35),110,180)},gt=()=>{const j=U();return D(Math.floor(j*.22),70,140)},ct=j=>{try{if(!(j!=null&&j.touches)||j.touches.length!==1||hn)return;const ut=j.target;if(ut&&typeof ut.closest=="function"&&ut.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Bt.current=null;return}const le=j.touches[0];Bt.current={x:le.clientX,y:le.clientY,at:Date.now(),swiping:!1}}catch(ut){Bt.current=null}},Et=j=>{const ut=Bt.current;if(!ut||hn)return;const le=(j==null?void 0:j.touches)&&j.touches[0];if(!le)return;const he=le.clientX-ut.x,ke=le.clientY-ut.y,Be=Math.abs(he),fe=Math.abs(ke);if(!ut.swiping)if(Be>12&&Be>fe*1.2)ut.swiping=!0,We(!1);else return;const Re=lt();se(D(he,-Re,Re))},St=j=>{const ut=Bt.current;if(Bt.current=null,!ut||hn||!ut.swiping){se(0);return}const le=(j==null?void 0:j.changedTouches)&&j.changedTouches[0];if(!le)return;const he=le.clientX-ut.x,ke=le.clientY-ut.y,Be=Date.now()-ut.at,fe=Math.abs(he),Re=Math.abs(ke);if(Be>1e3)return;if(fe<30){se(0);return}if(fe<Re*1.5)return;const tn=gt(),je=fe>=tn,en=he>0?1:-1;if(!je){We(!0),se(0),setTimeout(()=>We(!1),220);return}const pn=en>0?-1:1,nt=g(h,pn);if(!P(nt)){We(!0),se(en*Math.floor(lt()*.55)),setTimeout(()=>{se(0),setTimeout(()=>We(!1),200)},140),A(nt>f?"future":"past");return}We(!0),se(en*lt()),setTimeout(()=>{V(s=>g(s,pn)),se(-en*lt()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{se(0),setTimeout(()=>We(!1),220)})})},140)},Zt=()=>{Bt.current=null,se(0)},xt=j=>{var ut,le;try{if(!j||j.pointerType==="touch"||typeof j.button=="number"&&j.button!==0||hn)return;const he=j.target;if(he&&typeof he.closest=="function"&&he.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Bt.current=null;return}Bt.current={x:j.clientX,y:j.clientY,at:Date.now(),swiping:!1};try{(le=(ut=j.currentTarget)==null?void 0:ut.setPointerCapture)==null||le.call(ut,j.pointerId)}catch(ke){}}catch(he){Bt.current=null}},me=j=>{try{if(!j||j.pointerType==="touch")return;const ut=Bt.current;if(!ut||hn)return;const le=j.clientX-ut.x,he=j.clientY-ut.y,ke=Math.abs(le),Be=Math.abs(he);if(!ut.swiping)if(ke>12&&ke>Be*1.2)ut.swiping=!0,We(!1);else return;const fe=lt();se(D(le,-fe,fe))}catch(ut){}},mt=j=>{try{if(!j||j.pointerType==="touch")return;const ut=Bt.current;if(Bt.current=null,!ut||hn||!ut.swiping){se(0);return}const le=j.clientX-ut.x,he=j.clientY-ut.y,ke=Date.now()-ut.at,Be=Math.abs(le),fe=Math.abs(he);if(ke>1e3)return;if(Be<30){se(0);return}if(Be<fe*1.5)return;const Re=gt(),tn=Be>=Re,je=le>0?1:-1;if(!tn){We(!0),se(0),setTimeout(()=>We(!1),220);return}const en=je>0?-1:1,pn=g(h,en);if(!P(pn)){We(!0),se(je*Math.floor(lt()*.55)),setTimeout(()=>{se(0),setTimeout(()=>We(!1),200)},140),A(pn>f?"future":"past");return}We(!0),se(je*lt()),setTimeout(()=>{V(nt=>g(nt,en)),se(-je*lt()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{se(0),setTimeout(()=>We(!1),220)})})},140)}catch(ut){Bt.current=null}},Wt=()=>{Bt.current=null,se(0)},Me=$e>0?"Th\xE1ng tr\u01B0\u1EDBc":$e<0?"Th\xE1ng sau":"",Ae=$e>0?g(h,-1):$e<0?g(h,1):"",xe=Ae&&P(Ae)?Ae:"",Ht=Math.min(1,Math.abs($e)/Math.max(1,gt()));return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager",ref:Yt,style:{touchAction:"pan-y",transform:`translateX(${$e}px)`,transition:hn?"transform 220ms ease":"none",willChange:"transform"},onTouchStartCapture:ct,onTouchMoveCapture:Et,onTouchEndCapture:St,onTouchCancelCapture:Zt,onPointerDown:xt,onPointerMove:me,onPointerUp:mt,onPointerCancel:Wt},!!Me&&React.createElement("div",{"aria-hidden":"true",style:{position:"fixed",left:0,right:0,top:84,zIndex:1060,pointerEvents:"none",opacity:.15+.55*Ht,transform:"translateZ(0)"}},React.createElement("div",{className:"d-flex justify-content-center"},React.createElement("div",{className:"px-3 py-2 rounded-pill bg-dark text-white shadow-sm",style:{fontSize:13}},$e>0?"\u2190":"\u2192"," ",Me," \xB7 ",xe))),React.createElement(Loading,{show:st}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>x(!0),disabled:st},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:h,onChange:j=>V(j.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",wn,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),be(re.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),be(re.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),be(re.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",be(re.statusCounts.paid),"/",be(re.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},be(re.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},i(re.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},i(re.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},i(re.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},i(re.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",re.avgQtyPerOrder?re.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},be(re.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},be(re.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},be(re.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},be(re.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},be(re.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},be(re.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},be(re.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,be(re.statusCounts.draft)),React.createElement("td",null,be(re.statusCounts.pending)),React.createElement("td",null,be(re.statusCounts.processing)),React.createElement("td",null,be(re.statusCounts.canceled)),React.createElement("td",null,be(re.statusCounts.done)),React.createElement("td",null,be(re.statusCounts.paid)),React.createElement("td",null,be(re.statusCounts.other)),React.createElement("td",null,be(re.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},re.products.slice(0,10).map(j=>React.createElement("div",{key:j.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},j.product_name),React.createElement("div",{className:"text-muted small text-truncate"},j.product_code?`#${j.product_code} \u2022 `:"",be(j.orders)," \u0111\u01A1n \u2022 ",be(j.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},i(j.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,re.products.slice(0,10).map(j=>React.createElement("tr",{key:j.product_id},React.createElement("td",null,j.product_name),React.createElement("td",null,j.product_code||"\u2014"),React.createElement("td",null,be(j.orders)),React.createElement("td",null,be(j.quantity)),React.createElement("td",{className:"fw-semibold"},i(j.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},re.customers.slice(0,10).map(j=>React.createElement("div",{key:j.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},j.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},j.phone||"\u2014"," \u2022 ",be(j.orders)," \u0111\u01A1n \u2022 ",be(j.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},i(j.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,re.customers.slice(0,10).map(j=>React.createElement("tr",{key:j.key},React.createElement("td",null,j.customer_name||"\u2014"),React.createElement("td",null,j.phone||"\u2014"),React.createElement("td",null,be(j.orders)),React.createElement("td",null,be(j.quantity)),React.createElement("td",{className:"fw-semibold"},i(j.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},re.days.map(j=>React.createElement("div",{key:j.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},j.day),React.createElement("div",{className:"text-muted small"},be(j.orders)," \u0111\u01A1n \u2022 ",be(j.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",be(j.doneOrders)," \u2022 ",i(j.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},i(j.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,re.days.map(j=>React.createElement("tr",{key:j.day},React.createElement("td",null,j.day),React.createElement("td",null,be(j.orders)),React.createElement("td",null,be(j.quantity)),React.createElement("td",{className:"fw-semibold"},i(j.revenue)),React.createElement("td",null,be(j.doneOrders)),React.createElement("td",{className:"fw-semibold"},i(j.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:G,onMenuChange:h=>{It(h),Ot(h),h==="albums"&&(qt(null),$t([]),Le(null))},onLogout:Ie,currentUser:it,pinnedMenus:Xt,recentMenus:Ut,onTogglePin:Ft}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const V={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},recon:{title:"\u0110\u1ED1i so\xE1t Excel",icon:"fa-file-excel",sub:"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 t\u1EEB Excel"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[G]||{title:"KTM Admin",icon:"fa-tractor",sub:""},st=(it==null?void 0:it.username)||(it==null?void 0:it.name)||(it==null?void 0:it.email)||"Admin",Pt=(()=>{if(G!=="albums")return"";const Bt=[];return Bt.push("Root"),Array.isArray(Vt)&&Vt.length>0&&Bt.push(...Vt.map(Yt=>Yt==null?void 0:Yt.title).filter(Boolean)),we!=null&&we.title&&Bt.push(we.title),Bt.length>0?Bt.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${V.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},V.title),React.createElement("div",{className:"admin-page-subtitle"},Pt||V.sub))),React.createElement("div",{className:"admin-topbar-right"},G==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:Mt,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:st},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},st)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:Ie,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},G==="albums"&&!we&&React.createElement(AlbumList,{albums:X,loading:_e,currentFolder:_t,breadcrumb:Vt,onSelect:mn,onCreate:Mt,onEdit:Ve,onDelete:rt,onBack:F}),G==="search"&&React.createElement(SearchCenter,{showToast:pe,onNavigate:(h,V,st)=>{Ot(h),h==="orders"&&V==="create"&&(Gt(Date.now()),jt((st==null?void 0:st.productId)||""))}}),G==="albums"&&we&&React.createElement(AlbumDetail,{album:we,parentAlbum:Vt.length>0?Vt[Vt.length-1]:null,onBack:()=>{if(we.parentId){const h=Vt.findIndex(V=>V.uuid===we.parentId);h>=0?Te(Vt[h]):Te(null)}else Te(null)},onRefresh:()=>Le(_t==null?void 0:_t.uuid),showToast:pe,onNavigateToFolder:h=>{$t(V=>[...V,we]),Te(h)},onEditSubfolder:h=>{Ce(h),oe(!0)}}),G==="videos"&&React.createElement(VideoList,{showToast:pe}),G==="products"&&React.createElement(ProductManager,{showToast:pe,settings:J}),G==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:Lt,autoOpenCreateProductId:ot,showToast:pe}),G==="recon"&&React.createElement(ReconExcelManager,{showToast:pe}),G==="stats"&&React.createElement(O,null),G==="settings"&&React.createElement(Ze,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${G==="search"?"active":""}`,onClick:h=>{h.preventDefault(),Ot("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${G==="albums"?"active":""}`,onClick:h=>{h.preventDefault(),Ot("albums"),Te(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${G==="videos"?"active":""}`,onClick:h=>{h.preventDefault(),Ot("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${G==="products"?"active":""}`,onClick:h=>{h.preventDefault(),Ot("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${G==="orders"?"active":""}`,onClick:h=>{h.preventDefault(),Ot("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${G==="recon"?"active":""}`,onClick:h=>{h.preventDefault(),Ot("recon")}},React.createElement("i",{className:"fas fa-file-excel"}),React.createElement("span",null,"\u0110\u1ED1i so\xE1t")),React.createElement("a",{href:"#",className:`nav-item ${G==="stats"?"active":""}`,onClick:h=>{h.preventDefault(),Ot("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:Jt,album:Rt,parentId:_t==null?void 0:_t.uuid,onClose:()=>oe(!1),onSave:on}),React.createElement(AdminDrawer,{open:Ge,title:M?M.title:"Album",subtitle:M?`${M.subfolderCount||0} subfolder \u2022 ${M.count||0} \u1EA3nh`:"",onClose:cn,footer:ft?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{vt(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{M&&(Ce(M),on({slug:M.id||"",title:M.title||"",description:M.description||"",cover_url:M.cover||"",parent_id:M.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):M?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(M.title),pe("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>un(M)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{M&&confirm(`X\xF3a folder "${M.title}"?`)&&(rt(M),cn())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ft&&M?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:M.title,onChange:h=>H({...M,title:h.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:M.description,onChange:h=>H({...M,description:h.target.value})}))):M?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},M.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},M.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},M.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},M.count||0))),M.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,M.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},ae.map(h=>React.createElement(Toast,{key:h.id,message:h.message,type:h.type,actionLabel:h.actionLabel,onAction:h.onAction,durationMs:h.durationMs,onClose:()=>Ue(h.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:E,autoOpenCreateProductId:q,showToast:B}){const[yt,it]=useState([]),[Y,G]=useState(0),[Ot,Xt]=useState(!1),[Ct,Ut]=useState(!1),[ue,Lt]=useState([]),[Gt,ot]=useState(!0),[jt,X]=useState(!1),[ye,we]=useState([]),[Te,Jt]=useState(!1),[oe,Rt]=useState(""),[Ce,_e]=useState([]),[sn,ae]=useState(!1),[Fe,Ge]=useState(""),[C,M]=useState(!1),[H,ft]=useState(null),[vt,dt]=useState(null),[wt,At]=useState(!1),[N,J]=useState(()=>new Set),[at,_t]=useState(!1),[qt,Vt]=useState(()=>{const t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0");return`${e}-${a}`}),[$t,It]=useState(""),[Ft,ce]=useState(!1),[Ie,pe]=useState(!1),[Ue,Le]=useState(!1),[Mt,Ve]=useState(null),[on,mn]=useState(!1),[F,rt]=useState(""),[Qt,cn]=useState(!1),un=useRef(0),[Qe,Ze]=useState(!1),[O,h]=useState(null),[V,st]=useState(!1),[Pt,Bt]=useState(null),[Yt,$e]=useState(()=>({left:12,top:12,placement:"bottom"})),se=useRef(null),hn=useRef(!1),We=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1}),[Cn,ln]=useState(()=>({id:null,dir:null})),re=useRef(!1),An=useRef(new Map),fn=useRef(null),wn=useRef(null),be="ktm_orders_status_sync_queue_v1",i=useRef([]),l=useRef(!1),[x,g]=useState(()=>({})),[f,L]=useState(!1),[P,b]=useState(!1),[A,D]=useState(!1),[U,lt]=useState(()=>new Set),[gt,ct]=useState(()=>({})),Et="ktm_orders_pinned_v1",[St,Zt]=useState(()=>new Set),[xt,me]=useState(!1),[mt,Wt]=useState(!1),[Me,Ae]=useState(!1),[xe,Ht]=useState(""),[j,ut]=useState(()=>[]),le=useRef(null),he=useRef(null),ke=useRef(!1),Be=useRef({active:!1,startY:0,startX:0,fired:!1}),[fe,Re]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(t){return!1}}),tn=24,je=20,[en,pn]=useState(tn),nt=useRef(null),s=useRef(null),u=useRef(!1),c=useRef(new Map),I=useRef({timer:null,events:[]}),R=useRef(null),v=useRef(null),S="ktm_orders_phone_tip_v1",Z="ktm_orders_search_history_v1",[Q,W]=useState(null),[et,kt]=useState(!1),[Kt,bt]=useState([]),[de,ht]=useState(!1),[ve,te]=useState([]),[$,ee]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[yn,Ke]=useState([""]),[vn,rn]=useState(null),dn=useRef({}),[Je,tt]=useState([]),[z,pt]=useState(null),zt=useRef(null),Dt=useRef(null),Tt=useRef(0),ie=useRef(null),Ne=useRef(0),Pe=useRef(new Map),qe=useRef(null),nn=useRef(0),Tn=useRef(new Map),Sn=useRef(new Map),xn=useRef(""),_n=useRef(null),$n=useRef(null),Dn=useRef(0),Pn=useRef(null),Bn=9,Un=150,ka=250,Wa=3*60*1e3,Ca=24*60*60*1e3,lr=5*60*1e3,ps="ktm_customer_lookup_cache_v1",dr=200,qn=3,Aa=3,Ga=1,mr=24*60*60*1e3,ur=120,pr=5*60*1e3,hs=80,fs=2,gs=4,bs=60,ne=React.useMemo(()=>String(oe||"").trim().length>0,[oe]),na=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),ys=t=>{h(t),Ze(!0)},vs=(t,e)=>{var a,n,r,o;try{const d=(a=e==null?void 0:e.getBoundingClientRect)==null?void 0:a.call(e),m=window.innerWidth||360,T=window.innerHeight||640,y=230,w=280,_=Math.min(Math.max(10,Math.round((n=d==null?void 0:d.left)!=null?n:10)),Math.max(10,m-y-10));let p=Math.round(((r=d==null?void 0:d.bottom)!=null?r:10)+8),K="bottom";p+w>T-10&&(p=Math.max(10,Math.round(((o=d==null?void 0:d.top)!=null?o:10)-8-w)),K="top"),$e({left:_,top:p,placement:K})}catch(d){$e({left:12,top:12,placement:"bottom"})}Bt(t),st(!0)},Yn=()=>{st(!1),setTimeout(()=>Bt(null),120)};useEffect(()=>{if(!V)return;const t=e=>{e.key==="Escape"&&Yn()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[V]);const Ln=()=>{Ze(!1),setTimeout(()=>h(null),180)},hr=()=>{L(!0)},Ma=()=>{L(!1)},Ns=t=>{const e=String(t||"").trim();e&&lt(a=>{const n=new Set(a);return n.has(e)?n.delete(e):n.add(e),n})};useEffect(()=>{try{const t=localStorage.getItem(Et);if(!t)return;const e=JSON.parse(t);if(!Array.isArray(e))return;Zt(new Set(e.map(a=>String(a||"").trim()).filter(Boolean)))}catch(t){}},[]),useEffect(()=>{try{const t=Array.from(St||[]).map(e=>String(e||"").trim()).filter(Boolean);localStorage.setItem(Et,JSON.stringify(t))}catch(t){}},[St]);const fr=t=>{const e=String(t||"").trim();e&&Zt(a=>{const n=new Set(a);return n.has(e)?n.delete(e):n.add(e),n})};useEffect(()=>{try{const t=localStorage.getItem(Z);if(!t)return;const e=JSON.parse(t);if(!Array.isArray(e))return;ut(e.map(a=>String(a||"").trim()).filter(Boolean).slice(0,10))}catch(t){}},[]);const gr=t=>{try{localStorage.setItem(Z,JSON.stringify(t))}catch(e){}},ha=t=>{const e=String(t||"").trim();e&&ut(a=>{const n=Array.isArray(a)?a:[],r=[e,...n.filter(o=>String(o||"").trim().toLowerCase()!==e.toLowerCase())].slice(0,10);return gr(r),r})},ws=t=>{var a;const e=String((a=t!=null?t:oe)!=null?a:"").trim();Ht(e),Ae(!0),setTimeout(()=>{var n,r;try{(r=(n=le.current)==null?void 0:n.focus)==null||r.call(n)}catch(o){}},0)},Rn=()=>{Ae(!1)};useEffect(()=>{if(!Me)return;const t=e=>{e.key==="Escape"&&Rn()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[Me]),useEffect(()=>{if(!fe)return;const t=n=>{if(Me||(window.scrollY||0)>6)return;const r=n.touches&&n.touches[0];r&&(Be.current={active:!0,startY:r.clientY,startX:r.clientX,fired:!1})},e=n=>{const r=Be.current;if(!(r!=null&&r.active)||r.fired||(window.scrollY||0)>6)return;const o=n.touches&&n.touches[0];if(!o)return;const d=o.clientY-r.startY,m=o.clientX-r.startX;Math.abs(m)>24||d>92&&(r.fired=!0,ws(oe))},a=()=>{Be.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",t,{passive:!0}),window.addEventListener("touchmove",e,{passive:!0}),window.addEventListener("touchend",a,{passive:!0}),window.addEventListener("touchcancel",a,{passive:!0}),()=>{window.removeEventListener("touchstart",t),window.removeEventListener("touchmove",e),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)}},[fe,Me,oe]);const Ss=t=>{try{const e=gn(t==null?void 0:t.status);if(!(e==="pending"||e==="processing"))return!1;const a=new Date(t==null?void 0:t.created_at);if(!Number.isFinite(a.getTime()))return!1;const n=new Date;return a.getFullYear()===n.getFullYear()&&a.getMonth()===n.getMonth()&&a.getDate()===n.getDate()}catch(e){return!1}};useEffect(()=>{var a;let t;const e=()=>{try{Re(t?!!t.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(n){Re(!1)}};try{t=(a=window.matchMedia)==null?void 0:a.call(window,"(max-width: 767.98px)"),t!=null&&t.addEventListener?t.addEventListener("change",e):t!=null&&t.addListener&&t.addListener(e)}catch(n){t=null}return window.addEventListener("resize",e),e(),()=>{try{t!=null&&t.removeEventListener?t.removeEventListener("change",e):t!=null&&t.removeListener&&t.removeListener(e)}catch(n){}window.removeEventListener("resize",e)}},[]),useEffect(()=>{const t="admin-sheet-open";return Qe||f||V?document.body.classList.add(t):document.body.classList.remove(t),()=>document.body.classList.remove(t)},[Qe,f,V]),useEffect(()=>{if(!Qe&&!f&&!V)return;const t=e=>{e.key==="Escape"&&(Qe&&Ln(),f&&Ma(),V&&Yn())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[Qe,f,V]);const br=()=>{try{if(localStorage.getItem(S))return;localStorage.setItem(S,"1"),typeof B=="function"&&B("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 copy \u2022 Gi\u1EEF \u0111\u1EC3 g\u1ECDi","info",{durationMs:7e3})}catch(t){}},xs=t=>String((t==null?void 0:t.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),ks=t=>String((t==null?void 0:t.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),yr=t=>{const e=Ye(String(t||"")).replace(/[^0-9+]/g,"");if(e)try{window.location.href=`tel:${e}`}catch(a){}},Cs=async t=>{var a,n,r,o,d;const e=Ye(String(t||"")).replace(/[^0-9+]/g,"");if(e)try{(n=(a=window==null?void 0:window.KTM)==null?void 0:a.clipboard)!=null&&n.writeText?await window.KTM.clipboard.writeText(e):await((d=(o=(r=navigator.clipboard)==null?void 0:r.writeText)==null?void 0:o.call(r,e))!=null?d:Promise.reject(new Error("Clipboard not available"))),typeof B=="function"&&B("\u0110\xE3 copy S\u0110T","success")}catch(m){typeof B=="function"&&B("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},vr=()=>{try{const t=localStorage.getItem(be),e=t?JSON.parse(t):[];return Array.isArray(e)?e:[]}catch(t){return[]}},As=t=>{try{localStorage.setItem(be,JSON.stringify(Array.isArray(t)?t:[]))}catch(e){}},Ta=(t,e)=>{const a=String(t||"").trim();a&&g(n=>{const r={...n||{}};return e?r[a]=!0:delete r[a],r})},Nr=(t,e,a)=>{const n=String(t||"").trim(),r=gn(e),o=gn(a);if(!n||!r)return;const d=Array.isArray(i.current)?i.current:[],m=new Map(d.map(y=>[String((y==null?void 0:y.orderId)||""),y]));m.set(n,{orderId:n,nextStatus:r,prevStatus:o,ts:Date.now()});const T=Array.from(m.values()).sort((y,w)=>(Number(y.ts)||0)-(Number(w.ts)||0));i.current=T,As(T),Ta(n,!0)},Ja=async()=>{if(l.current||!navigator.onLine)return;const t=Array.isArray(i.current)?i.current.slice():[];if(t.length){l.current=!0;try{for(const e of t){const a=String((e==null?void 0:e.orderId)||"").trim(),n=gn(e==null?void 0:e.nextStatus);if(!(!a||!n)){Ta(a,!0);try{await Gn({id:a,status:(e==null?void 0:e.prevStatus)||""},n,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const r=(Array.isArray(i.current)?i.current:[]).filter(o=>String((o==null?void 0:o.orderId)||"")!==a);i.current=r,As(r),Ta(a,!1)}catch(r){if(!navigator.onLine)break}}}}finally{l.current=!1}}};useEffect(()=>{const t=vr();i.current=t;try{const e={};for(const a of t){const n=String((a==null?void 0:a.orderId)||"").trim();n&&(e[n]=!0)}g(e)}catch(e){}setTimeout(()=>Ja(),600)},[]),useEffect(()=>{const t=()=>Ja();window.addEventListener("online",t);const e=setInterval(()=>Ja(),8e3);return()=>{clearInterval(e),window.removeEventListener("online",t)}},[]);const wr=(t,e)=>{var a;(a=t==null?void 0:t.stopPropagation)==null||a.call(t),u.current=!1,br(),s.current={t0:Date.now(),phoneRaw:e}},Ua=t=>{var e;(e=t==null?void 0:t.stopPropagation)==null||e.call(t),s.current=null},Sr=(t,e)=>{var o;(o=t==null?void 0:t.stopPropagation)==null||o.call(t);const a=s.current;s.current=null;const n=Number(a==null?void 0:a.t0)||0;(n?Date.now()-n:0)>=520&&(u.current=!0,yr(e!=null?e:a==null?void 0:a.phoneRaw))},xr=t=>{const e=String(t||"").trim();if(!e)return;ct(r=>({...r,[e]:Date.now()}));const a=c.current;try{const r=a.get(e);r&&clearTimeout(r)}catch(r){}const n=setTimeout(()=>{ct(r=>{const o={...r||{}};return delete o[e],o});try{a.delete(e)}catch(r){}},9e3);a.set(e,n)},Ms=t=>String(t||"").replace(/\s+/g," ").trim(),kr=t=>String(t||"").replace(/[^0-9]+/g,""),fa=t=>{try{const e=new Date(t==null?void 0:t.created_at).getTime();if(!Number.isFinite(e))return 0;const a=Date.now()-e;return!Number.isFinite(a)||a<=0?0:Math.floor(a/mr)}catch(e){return 0}},_a=t=>String((t==null?void 0:t.status)||"").trim()!=="pending"?!1:fa(t)>=qn,gn=t=>{const e=String(t!=null?t:"").trim().toLowerCase();return e==="cancelled"?"canceled":e},Ya=React.useMemo(()=>["draft","pending","processing","done","paid"],[]),aa=(t,e)=>{const a=gn(t);if(!a||a==="canceled")return null;const n=Ya.indexOf(a);return n<0?null:e==="left"?Ya[n+1]||null:e==="right"&&Ya[n-1]||null},Ts=t=>{var r;const e=gn(t);if(!e)return{label:"",icon:"fa-circle"};const a=((r=na.find(o=>gn(o==null?void 0:o.value)===e))==null?void 0:r.label)||"",n=(()=>{switch(e){case"draft":return"fa-file-lines";case"pending":return"fa-hourglass-half";case"processing":return"fa-truck";case"done":return"fa-check";case"paid":return"fa-money-bill-wave";case"canceled":return"fa-ban";default:return"fa-circle"}})();return{label:a,icon:n}},$a=t=>{if(gn(t==null?void 0:t.status)!=="draft")return null;const a=Aa-fa(t);return Number.isFinite(a)?a:null},Da=t=>{const e=$a(t);return Number.isFinite(e)?e>0&&e<=Ga:!1},Hn=t=>{ee({customer_name:"",phone:"",address:"",note:"",items:[{product_id:t||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Ke([""]),W(null),rn(null)};useEffect(()=>{const t=e=>{var n;if(vn==null)return;const a=(n=dn.current)==null?void 0:n[vn];a&&!a.contains(e.target)&&rn(null)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[vn]);const _s=t=>window.KTM.money.parseMoney(t),$s=t=>window.KTM.money.parseSignedMoney(t),ze=t=>window.KTM.money.formatVND(t),On=t=>{const a=(Array.isArray(t)?t:[]).map(n=>{var r,o;return{amount:String((r=n==null?void 0:n.amount)!=null?r:""),note:String((o=n==null?void 0:n.note)!=null?o:"")}});return a.length?a:[{amount:"",note:""}]},Cr=t=>{try{const e=window.KTM.orders.getOrderAdjustmentItems(t),a=(Array.isArray(e)?e:[]).map(n=>{var r,o;return{amount:(n==null?void 0:n.amount)===0?"":String((r=n==null?void 0:n.amount)!=null?r:""),note:String((o=n==null?void 0:n.note)!=null?o:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return a.length?a:[{amount:"",note:""}]}catch(e){return[{amount:"",note:""}]}},sa=t=>(Array.isArray(t)?t:[]).map(a=>({amount:$s(a==null?void 0:a.amount),note:String((a==null?void 0:a.note)||"").trim()})).filter(a=>a.amount!==0||!!a.note),Qa=t=>{const e=Array.isArray(t==null?void 0:t.adjustment_items)?t.adjustment_items:[],a=sa(e),n=ra(a),r=(()=>{if(!a.length)return"";const o=a.map(d=>String((d==null?void 0:d.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):a.length>1?`${a.length} m\u1EE5c`:""})();return{cleanAdjItems:a,amount:n,summaryText:r}},ra=t=>(Array.isArray(t)?t:[]).reduce((a,n)=>a+(Number(n==null?void 0:n.amount)||0),0),Za=t=>{const e=Array.isArray(t)?t:[];return e.length?JSON.stringify(e):""},Yr=t=>window.KTM.money.parseShipFeeFromNote(t),ia=t=>window.KTM.phone.isValid(t),Ye=t=>window.KTM.phone.normalize(t),Ia=async t=>{if(!t)return null;const e=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${t}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return e&&typeof e=="object"&&e.order&&typeof e.order=="object"?e.order:e},Ar=(t,e)=>{var o;const a=Array.isArray(t)?t:[],n=Array.isArray(e)?e:[];if(!a.length)return n;if(!n.length)return a;const r=new Map(a.map(d=>{var m;return[String((m=d==null?void 0:d.id)!=null?m:""),d]}));for(const d of n){const m=String((o=d==null?void 0:d.id)!=null?o:"");m&&r.set(m,d)}return Array.from(r.values())},Ra=async t=>{var e,a,n,r;if(!(t!=null&&t.id)||Array.isArray(t.items)&&t.items.length)return t;try{const o=(a=(e=An.current)==null?void 0:e.get)==null?void 0:a.call(e,String(t.id));if(o&&typeof o=="object"&&Array.isArray(o.items)&&o.items.length)return o}catch(o){}try{const o=await Ia(t.id);if(o&&typeof o=="object"){try{(r=(n=An.current)==null?void 0:n.set)==null||r.call(n,String(t.id),o)}catch(d){}return it(d=>Array.isArray(d)?d.map(m=>String(m==null?void 0:m.id)===String(t.id)?o:m):d),o}}catch(o){console.error("Fetch order by id error:",o)}return t},Mr=()=>{var t;try{const e=localStorage.getItem(ps);if(!e)return;const a=JSON.parse(e);if(!a||typeof a!="object")return;const n=Object.entries(a);for(const[r,o]of n)!r||!o||typeof o!="object"||(t=Sn.current)==null||t.set(String(r),o)}catch(e){}},ts=()=>{try{const t=Sn.current;if(!t||typeof t.entries!="function")return;const e=Array.from(t.entries()).filter(([n,r])=>n&&r&&typeof r=="object"&&Number.isFinite(r.ts)).sort((n,r)=>(Number(r[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,dr),a={};for(const[n,r]of e)a[n]=r;localStorage.setItem(ps,JSON.stringify(a))}catch(t){}};useEffect(()=>{Mr()},[]);const Ds=t=>{const e=Ye(t);if(!e)return null;const a=Array.isArray(yt)?yt:[];let n=null,r=-1;for(const o of a){if(!o||Ye(o.phone||"")!==e)continue;const d=new Date(o.created_at).getTime(),m=Number.isFinite(d)?d:0;m>=r&&(r=m,n=o)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},Is=(t,e)=>{t&&ee(a=>e&&Ye(a.phone)!==e?a:{...a,customer_name:t.name||a.customer_name,address:t.address||a.address})},Tr=t=>{const e=Ds(t);if(!e)return;const a=Ye(t);ee(n=>{if(a&&Ye(n.phone)!==a)return n;const r={...n};return!String(n.customer_name||"").trim()&&e.name&&(r.customer_name=e.name),!String(n.address||"").trim()&&e.address&&(r.address=e.address),r})},_r=(t,e,a)=>{var n;try{const r=Ye(t);if(!r)return;const o=String(e||"").trim(),d=String(a||"").trim();if(!o&&!d)return;(n=Sn.current)==null||n.set(r,{ts:Date.now(),status:"found",customer:{phone:r,name:o||null,address:d||null}}),ts()}catch(r){}},Ka=async t=>{var r,o,d;const e=Ye(t);if(!e)return;Tr(e);const a=(r=Sn.current)==null?void 0:r.get(e);if(a&&Number.isFinite(a.ts)){const m=Date.now()-a.ts,T=a.status==="found"?Ca:lr;if(m>=0&&m<=T){W({status:a.status,phone:e,customer:a.customer}),a.status==="found"&&a.customer&&Is(a.customer,e);return}}const n=++Tt.current;W({status:"loading",phone:e});try{const m=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(e)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Tt.current!==n)return;if(m&&m.exists&&m.customer){(o=Sn.current)==null||o.set(e,{ts:Date.now(),status:"found",customer:m.customer}),ts(),W({status:"found",phone:e,customer:m.customer}),Is(m.customer,e);return}(d=Sn.current)==null||d.set(e,{ts:Date.now(),status:"not-found",customer:null}),ts(),W({status:"not-found",phone:e})}catch(m){if(Tt.current!==n)return;console.error("Customer lookup error:",m),W({status:"error",phone:e})}},Rs=t=>{const e=Ye(t),a=Ds(e);ee(r=>{const o={...r,phone:e};return a&&(!String(r.customer_name||"").trim()&&a.name&&(o.customer_name=a.name),!String(r.address||"").trim()&&a.address&&(o.address=a.address)),o}),kt(!1),Dt.current&&(clearTimeout(Dt.current),Dt.current=null);const n=e;if(n.length<Bn){W(null);return}if(ia(n)&&n!==xn.current){xn.current=n,Ka(n);return}Dt.current=setTimeout(()=>{const r=Ye(e);ia(r)&&r!==xn.current&&(xn.current=r,Ka(r))},Un)},Ks=()=>{const t=Ye($.phone);t.length<Bn||ia(t)&&t!==xn.current&&(xn.current=t,Ka(t))};useEffect(()=>(Ie?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Ie]);const Pa=Array.isArray($.items)?$.items.length:0;useEffect(()=>{if(!Ie){Dn.current=Pa;return}Pa>Dn.current&&setTimeout(()=>{const t=_n.current;t&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})},0),Dn.current=Pa},[Ie,Pa]),useEffect(()=>()=>{Dt.current&&(clearTimeout(Dt.current),Dt.current=null),ie.current&&(clearTimeout(ie.current),ie.current=null)},[]),useEffect(()=>{if(!Ie)return;ie.current&&(clearTimeout(ie.current),ie.current=null);const t=Ye(($==null?void 0:$.phone)||"");if(!ia(t)){bt([]),ht(!1);return}return ie.current=setTimeout(async()=>{var r;const e=String(t),a=(r=Pe.current)==null?void 0:r.get(e);if(a&&Number.isFinite(a.ts)&&Date.now()-a.ts<=Wa){bt(Array.isArray(a.orders)?a.orders:[]),ht(!1);return}const n=++Ne.current;ht(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(t)}`,d=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(Ne.current!==n)return;const m=Array.isArray(d)?d:Array.isArray(d==null?void 0:d.orders)?d.orders:[];bt(m);try{const T=Pe.current;if(T&&typeof T.set=="function"&&(T.set(e,{ts:Date.now(),orders:m}),T.size>100)){const y=Array.from(T.entries()).sort((_,p)=>{var K,k;return(Number((K=_==null?void 0:_[1])==null?void 0:K.ts)||0)-(Number((k=p==null?void 0:p[1])==null?void 0:k.ts)||0)}),w=Math.max(0,y.length-100);for(let _=0;_<w;_++)T.delete(y[_][0])}}catch(T){}}catch(o){if(Ne.current!==n)return;console.error("Phone history fetch error:",o),bt([])}finally{if(Ne.current!==n)return;ht(!1)}},ka),()=>{ie.current&&(clearTimeout(ie.current),ie.current=null)}},[Ie,$==null?void 0:$.phone]),useEffect(()=>{Ir()},[]),useEffect(()=>{ne||Vn()},[qt,ne]),useEffect(()=>{da()},[]),useEffect(()=>{E&&zt.current!==E&&(zt.current=E,La(q))},[E]);const Kn=t=>t==="draft"?"\u0110\u01A1n nh\xE1p":t==="pending"?"Ch\u1EDD x\u1EED l\xFD":t==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":t==="done"?"Ho\xE0n th\xE0nh":t==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":t==="cancelled"||t==="canceled"?"H\u1EE7y \u0111\u01A1n":t||"",oa=t=>t==="draft"?"bg-light text-dark":t==="pending"?"bg-secondary":t==="processing"?"bg-warning text-dark":t==="done"?"bg-success":t==="paid"?"bg-primary":t==="cancelled"||t==="canceled"?"bg-danger":"bg-light text-dark",zn=React.useMemo(()=>{const t=window.KTM.orders.sortOrders(yt),e=St;if(!e||!(e instanceof Set)||e.size===0)return t;const a=Array.isArray(t)?t.slice():[];return a.sort((n,r)=>{var m,T;const o=e.has(String((m=n==null?void 0:n.id)!=null?m:""))?1:0;return(e.has(String((T=r==null?void 0:r.id)!=null?T:""))?1:0)-o}),a},[yt,St]),es=React.useMemo(()=>window.KTM.orders.sortOrders(ue),[ue]),Oa=React.useMemo(()=>{const e=(Array.isArray(es)?es:[]).filter(a=>_a(a));return e.sort((a,n)=>{const r=new Date(a==null?void 0:a.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(o)?o:0)}),e},[es]),Ps=React.useMemo(()=>{const e=(Array.isArray(ye)?ye:[]).filter(a=>Da(a));return e.sort((a,n)=>{const r=new Date(a==null?void 0:a.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(o)?o:0)}),e},[ye]),ga=React.useMemo(()=>{if(Ft)return Oa;let t=zn;if(xt){const a=St;t=(Array.isArray(t)?t:[]).filter(n=>{var r,o;return(o=a==null?void 0:a.has)==null?void 0:o.call(a,String((r=n==null?void 0:n.id)!=null?r:""))})}mt&&(t=(Array.isArray(t)?t:[]).filter(a=>Ss(a)));const e=String(qt||"").trim();if(e){const a=n=>{try{const r=new Date(n==null?void 0:n.created_at);if(!r||Number.isNaN(r.getTime()))return"";const o=r.getFullYear(),d=String(r.getMonth()+1).padStart(2,"0");return`${o}-${d}`}catch(r){return""}};t=(Array.isArray(t)?t:[]).filter(n=>a(n)===e)}return t},[Ft,Oa,zn,xt,St,mt,qt]),Ea=React.useMemo(()=>{if(Ft)return ga;const t=String($t||"").trim();return t?(Array.isArray(ga)?ga:[]).filter(e=>String((e==null?void 0:e.status)||"").trim()===t):ga},[ga,$t,Ft]),Os=React.useMemo(()=>window.KTM.orders.sortOrders(Ce),[Ce]),Xe=React.useMemo(()=>ne?Os:Ea,[Ea,ne,Os]),ca=React.useMemo(()=>(Array.isArray(Xe)?Xe:[]).map(t=>{var e;return String((e=t==null?void 0:t.id)!=null?e:"").trim()}).filter(Boolean),[Xe]),ns=React.useMemo(()=>{if(!ca.length)return!1;const t=N;return!t||typeof t.has!="function"?!1:ca.every(e=>t.has(e))},[ca,N]),Es=React.useMemo(()=>{if(!ca.length)return!1;const t=N;return!t||typeof t.has!="function"?!1:ca.some(e=>t.has(e))},[ca,N]),Ls=React.useMemo(()=>{const t=Array.isArray(Xe)?Xe:[];return fe?t.slice(0,Math.max(0,Number(en)||0)):t},[fe,en,Xe]);useEffect(()=>{try{const t=v==null?void 0:v.current;if(!t)return;t.indeterminate=!ns&&Es}catch(t){}},[ns,Es]),useEffect(()=>{J(new Set)},[$t,Ft,qt,oe,xt,mt]),useEffect(()=>{fe&&pn(tn)},[fe,$t,Ft,qt,oe]),useEffect(()=>{if(!fe)return;const t=Array.isArray(Xe)?Xe.length:0;if(en>=t)return;const e=nt.current;if(!e)return;const a=new IntersectionObserver(n=>{Array.isArray(n)&&n.some(o=>o==null?void 0:o.isIntersecting)&&pn(o=>Math.min((Number(o)||0)+je,t))},{root:null,rootMargin:"520px 0px",threshold:0});return a.observe(e),()=>a.disconnect()},[fe,en,Xe]),useEffect(()=>{if(!fe){b(!1),D(!1);return}const t=()=>{R.current||(R.current=window.requestAnimationFrame(()=>{R.current=null;const e=window.scrollY||document.documentElement.scrollTop||0;b(e>140),D(e>60)}))};return window.addEventListener("scroll",t,{passive:!0}),t(),()=>{window.removeEventListener("scroll",t),R.current&&(window.cancelAnimationFrame(R.current),R.current=null)}},[fe]),useEffect(()=>{if(!fe){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(e){}return}const t=()=>{try{const e=document.querySelector(".mobile-bottom-nav"),a=e&&e.offsetHeight?e.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${a}px`)}catch(e){}};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[fe]);const Xn=React.useMemo(()=>{const t=Array.isArray(Xe)?Xe:[],e={all:t.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const a of t){const n=gn(a==null?void 0:a.status);n==="draft"?e.draft+=1:n==="pending"?e.pending+=1:n==="processing"?e.processing+=1:n==="done"?e.done+=1:n==="paid"?e.paid+=1:n==="canceled"?e.canceled+=1:e.other+=1}return e},[Xe]),$r=React.useMemo(()=>{const t=St;return!t||t.size===0?0:(Array.isArray(zn)?zn:[]).reduce((e,a)=>{var n;return e+(t.has(String((n=a==null?void 0:a.id)!=null?n:""))?1:0)},0)},[St,zn]),Dr=React.useMemo(()=>(Array.isArray(zn)?zn:[]).filter(t=>Ss(t)).length,[zn]),jn=React.useMemo(()=>{const t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0");return`${e}-${a}`},[]),Fn=t=>{if(ne&&Rt(""),t==="thisMonth"){ce(!1),It(""),Vt(jn);return}if(t==="overduePending"){Vt(""),ce(!0),It("pending");return}if(t==="draftExpiring"){ce(!1),It("draft"),Vt(""),da();return}if(t==="all"){ce(!1),It(""),Vt(jn);return}},la=t=>window.KTM.date.formatDateTime(t),Ir=async()=>{try{const t=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");tt(Array.isArray(t)?t:[])}catch(t){console.error("Load products error:",t),tt([])}},Vn=async()=>{ot(!0),Ut(!1);try{const e=new URLSearchParams;qt&&e.set("month",String(qt)),e.set("includeItems","1"),e.set("meta","1"),e.set("limit",String(bs)),e.set("offset","0");const a=`${API_BASE}/api/orders?${e.toString()}`,n=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),r=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],o=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;it(Array.isArray(r)?r:[]),G(Array.isArray(r)?r.length:0),Xt(!!(o!=null&&o.hasMore)),da()}catch(e){console.error("Load orders error:",e),it([]),G(0),Xt(!1)}finally{ot(!1),Ut(!1)}},Rr=async()=>{if(!(Gt||Ct||ne)&&Ot){Ut(!0);try{const t=new URLSearchParams;qt&&t.set("month",String(qt)),t.set("includeItems","1"),t.set("meta","1"),t.set("limit",String(bs)),t.set("offset",String(Y));const e=`${API_BASE}/api/orders?${t.toString()}`,a=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.orders)?a.orders:[],r=!Array.isArray(a)&&a&&typeof a=="object"&&a.meta||null;it(o=>Ar(o,Array.isArray(n)?n:[])),G(o=>o+(Array.isArray(n)?n.length:0)),Xt(!!(r!=null&&r.hasMore))}catch(t){console.error("Load more orders error:",t)}finally{Ut(!1)}}},js=async t=>{var r;const e=Ms(t);if(!e){_e([]),Ge(""),ae(!1);return}const a=kr(e);if(e.length<fs&&a.length<gs){_e([]),Ge(`Nh\u1EADp \xEDt nh\u1EA5t ${fs} k\xFD t\u1EF1 (ho\u1EB7c ${gs} s\u1ED1) \u0111\u1EC3 search nhanh`),ae(!1);return}try{const o=(r=Tn.current)==null?void 0:r.get(e);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=pr){_e(Array.isArray(o.results)?o.results:[]),Ge(""),ae(!1);return}}catch(o){}const n=++nn.current;ae(!0),Ge("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,d=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(nn.current!==n)return;const m=Array.isArray(d)?d:[];_e(m);try{const T=Tn.current;if(T&&typeof T.set=="function"&&(T.set(e,{ts:Date.now(),results:m}),T.size>hs)){const y=Array.from(T.entries()).sort((_,p)=>{var K,k;return(Number((K=_==null?void 0:_[1])==null?void 0:K.ts)||0)-(Number((k=p==null?void 0:p[1])==null?void 0:k.ts)||0)}),w=Math.max(0,y.length-hs);for(let _=0;_<w;_++)T.delete(y[_][0])}}catch(T){}}catch(o){if(nn.current!==n)return;console.error("Order search error:",o),_e([]),Ge((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if(nn.current!==n)return;ae(!1)}};useEffect(()=>{qe.current&&(clearTimeout(qe.current),qe.current=null);const t=Ms(oe);if(!t){_e([]),Ge(""),ae(!1);return}return Ft&&ce(!1),qe.current=setTimeout(()=>{js(t)},ur),()=>{qe.current&&(clearTimeout(qe.current),qe.current=null)}},[oe]);const da=async()=>{X(!0),Jt(!0);try{const[t,e]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(qn)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Ga)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);Lt(Array.isArray(t)?t:[]),we(Array.isArray(e)?e:[])}catch(t){console.error("Load all orders error:",t),Lt([]),we([])}finally{X(!1),Jt(!1)}},as=async t=>{const e=await Ra(t);if(!e)return;pt(e.id);const a=Array.isArray(e.items)&&e.items.length?e.items.map(m=>{var T,y,w,_;return{product_id:(m==null?void 0:m.product_id)||"",quantity:Number((T=m==null?void 0:m.quantity)!=null?T:1)||1,unit_price:(()=>{var k;const p=(k=m==null?void 0:m.unit_price)!=null?k:m==null?void 0:m.unitPrice,K=p==null||p===""?NaN:Number(p);return Number.isFinite(K)?Math.trunc(K):null})(),variant:String((y=m==null?void 0:m.variant)!=null?y:"").trim(),variant_json:(_=(w=m==null?void 0:m.variant_json)!=null?w:m==null?void 0:m.variantJson)!=null?_:null}}).filter(m=>m.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=Cr(e),r=sa(n),o=ra(r),d=Za(r);ee({customer_name:e.customer_name||"",phone:Ye(e.phone||""),address:e.address||"",note:(e==null?void 0:e.note)||"",items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:o,adjustment_note:d||(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),Ke(new Array(a.length?a.length:1).fill("")),te(new Array(a.length?a.length:1).fill(!0)),W(null),pe(!1),Ve(e),Le(!0),rt(""),mn(!1),cn(!0),e.phone&&Ka(Ye(e.phone))},ba=async t=>{if(!t)return;Le(!0),rt(""),mn(!0),cn(!1),Ve(t);const e=++un.current;try{const a=await Ra(t);if(un.current!==e)return;Ve(a||t)}catch(a){if(un.current!==e)return;rt((a==null?void 0:a.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(un.current!==e)return;mn(!1)}},ss=(t={})=>{!(t!=null&&t.force)&&(C||at)||(Le(!1),mn(!1),rt(""),cn(!1),pt(null),Hn(""),kt(!1),te([]))};function La(t){Le(!1),cn(!1),mn(!1),rt(""),pt(null),Hn(t||""),kt(!1),te([]),pe(!0)}const rs=(t={})=>{!(t!=null&&t.force)&&(C||at)||(pe(!1),pt(null),Hn(""),kt(!1),te([]))},Fs=async t=>{var y,w,_;if(!z||at||C)return;const e=t||(Ie?"modal":Ue?"drawer":"modal"),a=(Array.isArray(yt)?yt:[]).find(p=>String(p==null?void 0:p.id)===String(z))||null,n=String((a==null?void 0:a.status)||($==null?void 0:$.status)||"").trim();if(n==="done"||n==="paid"||n==="canceled"){const p="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof B=="function"?B(p,"warning"):alert(p);return}const r=Ye($.phone),d=(Array.isArray($.items)?$.items:[]).map((p,K)=>{var k,Nt;return{idx:K,product_id:String((p==null?void 0:p.product_id)||"").trim(),quantity:Number((k=p==null?void 0:p.quantity)!=null?k:0),variant:String((p==null?void 0:p.variant)||"").trim()||null,variant_json:(Nt=p==null?void 0:p.variant_json)!=null?Nt:null,unit_price:(()=>{const ge=p==null?void 0:p.unit_price,Oe=ge===""||ge==null?NaN:Number(ge);if(Number.isFinite(Oe))return Math.max(0,Math.trunc(Oe));const Se=In(p==null?void 0:p.product_id),bn=p!=null&&p.variant_json&&typeof p.variant_json=="object"?p.variant_json:null;return ma(Se,bn)})()}}).filter(p=>p.product_id&&Number.isFinite(p.quantity)&&p.quantity>0);if(d.length<2){const p="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof B=="function"?B(p,"warning"):alert(p);return}const m=[],T=[];for(const p of d){const K=!!ve[p.idx],k={product_id:p.product_id,quantity:p.quantity,unit_price:p.unit_price,variant:p.variant,variant_json:p.variant_json};K?m.push(k):T.push(k)}if(!m.length||!T.length){const p="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof B=="function"?B(p,"warning"):alert(p);return}_t(!0);try{const p=Array.isArray($==null?void 0:$.adjustment_items)?$.adjustment_items:[],K=sa(p),k=ra(K),Nt=Za(K),ge={customer_name:$.customer_name,phone:r,address:$.address,note:($.note||"").trim(),adjustment_amount:k,adjustment_note:Nt,adjustment_items:K,status:"processing",items:m,created_at_from_order_id:String(z),product_id:m[0].product_id,quantity:m[0].quantity,split_seq:1},Oe=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,ge,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),Se=(_=(w=Oe==null?void 0:Oe.id)!=null?w:(y=Oe==null?void 0:Oe.order)==null?void 0:y.id)!=null?_:null;if(!Se)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const bn={id:z,customer_name:$.customer_name,phone:r,address:$.address,note:($.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:T,product_id:T[0].product_id,quantity:T[0].quantity,parent_order_id:String(Se),split_seq:2};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${z}`,bn,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),e==="drawer"){cn(!1),pt(null),Hn(""),kt(!1),te([]),rt(""),mn(!0);try{const Nn=await Ia(Se);Nn&&typeof Nn=="object"?Ve(Nn):(Ve(null),rt("Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c \u0111\u01A1n giao ngay sau khi t\xE1ch"))}catch(Nn){rt((Nn==null?void 0:Nn.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c \u0111\u01A1n giao ngay sau khi t\xE1ch")}finally{mn(!1)}}else rs({force:!0});Vn(),da();const He=Se?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${Se}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof B=="function"?B(He,"success"):alert(He)}catch(p){console.error(p);const K=(p==null?void 0:p.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof B=="function"?B(K,"danger"):alert(K)}finally{_t(!1)}},Bs=t=>{if(!t)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const e=String(t),a=Je.find(n=>String(n==null?void 0:n.id)===e);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},En=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(e){return String(t!=null?t:"").toLowerCase()}},Kr=t=>{const a=En(t).trim().split(/\s+/).filter(Boolean),n=a.join(" ");return{contentTokens:a,cleanedQuery:n}},qs=React.useMemo(()=>(Array.isArray(Je)?Je:[]).map((t,e)=>{var y,w,_,p,K,k;const a=En((y=t==null?void 0:t.name)!=null?y:""),n=En((w=t==null?void 0:t.code)!=null?w:""),r=En((_=t==null?void 0:t.category)!=null?_:""),o=En((p=t==null?void 0:t.note)!=null?p:""),d=En((K=t==null?void 0:t.id)!=null?K:""),m=En((k=t==null?void 0:t.stt)!=null?k:""),T=`${a} ${n} ${r} ${o} ${d} ${m}`.trim();return{p:t,originalIndex:e,name:a,code:n,category:r,note:o,haystackAll:T}}),[Je]),Pr=(t,e,a)=>{var _,p,K,k,Nt;const n=Array.isArray(e)?e:[],r=En(a).trim();if(!n.length&&!r)return 0;const o=(_=t==null?void 0:t.name)!=null?_:"",d=(p=t==null?void 0:t.code)!=null?p:"",m=(K=t==null?void 0:t.category)!=null?K:"",T=(k=t==null?void 0:t.note)!=null?k:"";if(!((Nt=t==null?void 0:t.haystackAll)!=null?Nt:""))return 0;let w=0;r&&(o===r&&(w+=220),o.includes(r)&&(w+=140),o.startsWith(r)&&(w+=160),d&&d===r&&(w+=180),d&&d.includes(r)&&(w+=90));for(const ge of n){if(!ge)continue;const Oe=new RegExp(`(?:^|\\s)${ge.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(ge)&&(w+=35),Oe.test(o)&&(w+=25),d&&d.includes(ge)&&(w+=20),d&&Oe.test(d)&&(w+=10),m&&m.includes(ge)&&(w+=12),T&&T.includes(ge)&&(w+=6)}return w>0&&o&&(w+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),w},is=(t,e)=>{const a=String(t||""),n=String(e||"");if(a===n)return 0;if(!a)return n.length;if(!n)return a.length;const r=a.length,o=n.length;if(o>r)return is(n,a);let d=new Array(o+1),m=new Array(o+1);for(let T=0;T<=o;T++)d[T]=T;for(let T=1;T<=r;T++){m[0]=T;const y=a.charCodeAt(T-1);for(let _=1;_<=o;_++){const p=y===n.charCodeAt(_-1)?0:1;m[_]=Math.min(d[_]+1,m[_-1]+1,d[_-1]+p)}const w=d;d=m,m=w}return d[o]},Or=(t,e)=>{const a=String(t||"").trim(),n=String(e||"");if(!a||!n)return!1;if(n.includes(a))return!0;const r=n.split(/\s+/).filter(Boolean);if(!r.length)return!1;const o=a.length<=4?1:2;for(const d of r)if(!(Math.abs(d.length-a.length)>o)&&is(a,d)<=o)return!0;return!1},ja=t=>{const e=En(t).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return e?e.split(" ").filter(Boolean):[]},Er=(t,e)=>{const a=Array.isArray(e)?e:[];if(!a.length)return 0;const n=ja((t==null?void 0:t.name)||""),r=ja((t==null?void 0:t.code)||""),o=ja((t==null?void 0:t.category)||""),d=ja((t==null?void 0:t.note)||""),m=(y,w,_)=>{const p=String(y||"").trim();if(!p||!w.length)return 0;const K=p.length<=4?1:2;let k=1/0,Nt=-1;for(let Se=0;Se<w.length;Se++){const bn=w[Se];if(!bn||Math.abs(bn.length-p.length)>K)continue;const He=is(p,bn);if(He<k&&(k=He,Nt=Se,He===0))break}if(k===1/0||k>K)return 0;let Oe=Math.round(_*(k===0?1:k===1?.65:.45));return Nt===0?Oe+=Math.round(_*.25):Nt===1&&(Oe+=Math.round(_*.12)),Oe};let T=0;for(const y of a){if(!y)continue;const w=m(y,n,180),_=m(y,r,120),p=m(y,o,60),K=m(y,d,30);T+=Math.max(w,_,p,K)}if(T>0){const y=((t==null?void 0:t.name)||"").length;T+=Math.max(0,60-Math.min(60,Math.floor(y/2)))}return T},os=React.useRef(new Map);React.useEffect(()=>{os.current=new Map},[Je]);const Hs=t=>{var y,w;const e=String(yn[t]||"").trim();if(!e)return Je;const{contentTokens:a,cleanedQuery:n}=Kr(e);if(a.length===0)return Je;const r=En(e).trim(),o=os.current.get(r);if(o)return o;const d=[];for(const _ of qs){const p=_.haystackAll;p&&a.some(K=>p.includes(K))&&d.push(_)}let m=d;if(m.length<8&&a.length>0){const _=[],p=new Set(m.map(K=>{var k,Nt;return String((Nt=(k=K.p)==null?void 0:k.id)!=null?Nt:"")+":"+String(K.originalIndex)}));for(const K of qs){const k=String((w=(y=K.p)==null?void 0:y.id)!=null?w:"")+":"+String(K.originalIndex);if(p.has(k))continue;const Nt=K.haystackAll;Nt&&a.some(ge=>Or(ge,Nt))&&(_.push(K),p.add(k))}_.length&&(m=m.concat(_))}const T=m.map(_=>({entry:_,score:Pr(_,a,n)})).map(_=>{if(_.score>0)return _;const p=Er(_.entry,a);return p>0?{..._,score:p}:_}).filter(_=>_.score>0).sort((_,p)=>p.score!==_.score?p.score-_.score:_.entry.originalIndex-p.entry.originalIndex).slice(0,40).map(_=>_.entry.p);return os.current.set(r,T),T},In=t=>{if(!t)return null;const e=String(t);return Je.find(a=>String(a==null?void 0:a.id)===e)||null},Wn=t=>{if(t==null||t==="")return[];let e=t;if(typeof e=="string"){const a=e.trim();if(!a)return[];try{e=JSON.parse(a)}catch(n){return[]}}return Array.isArray(e)?e.map((a,n)=>{var d;if(!a||typeof a!="object")return null;const r=String((d=a.name)!=null?d:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,o=(Array.isArray(a.options)?a.options:[]).map(m=>{var Nt,ge,Oe,Se,bn,He,Nn;if(!m||typeof m!="object")return null;const T=String((Nt=m.label)!=null?Nt:"").trim();if(!T)return null;const y=(bn=(Se=(Oe=(ge=m.price)!=null?ge:m.priceValue)!=null?Oe:m.unit_price)!=null?Se:m.unitPrice)!=null?bn:null,w=y==null||y===""?NaN:typeof y=="number"?y:typeof y=="string"?_s(y):Number(y),_=Number.isFinite(w)?Math.trunc(w):null,p=(Nn=(He=m.price_delta)!=null?He:m.priceDelta)!=null?Nn:null,K=Number(p),k=Number.isFinite(K)?Math.trunc(K):0;return{label:T,price:_,price_delta:k}}).filter(Boolean);return{name:r,options:o}}).filter(Boolean):[]},Qr=t=>{const e=In(t);return Wn(e==null?void 0:e.variants)},Fa=t=>{if(!t||typeof t!="object")return"";const e=[];for(const[a,n]of Object.entries(t)){const r=String(a||"").trim(),o=String(n||"").trim();!r||!o||e.push(`${r}: ${o}`)}return e.join(", ")},ma=(t,e)=>{const a=_s(t==null?void 0:t.price),n=Wn(t==null?void 0:t.variants);if(!n.length||!e||typeof e!="object")return a;let r=a,o=!1;for(const d of n){const m=String((d==null?void 0:d.name)||"").trim(),T=String((e==null?void 0:e[m])||"").trim();if(!m||!T)continue;const y=(Array.isArray(d.options)?d.options:[]).find(k=>String((k==null?void 0:k.label)||"").trim()===T);if(!y)continue;const w=y==null?void 0:y.price,_=w==null||w===""?NaN:Number(w);if(Number.isFinite(_)){r=Math.max(0,Math.trunc(_)),o=!0;continue}const p=y==null?void 0:y.price_delta,K=p==null||p===""?NaN:Number(p);Number.isFinite(K)&&(r+=Math.trunc(K))}return r},cs=t=>window.KTM.orders.getOrderItems(t),zs=t=>window.KTM.orders.getOrderTotalQty(t),ua=t=>window.KTM.orders.getOrderProductSummary(t,In),Ba=t=>window.KTM.orders.getOrderItemRows(t,In),ya=t=>window.KTM.orders.getOrderAdjustmentMoney(t),Qn=t=>window.KTM.orders.getOrderAdjustmentSummaryText(t),Lr=t=>{const e=cs(t),a=Ba(t),n=Na(e),r=va(e),o=r.fee,d=ya(t),m=n+o+d,T=w=>{const _=Number(w)||0;return _>0?`+${ze(_)}`:ze(_)},y=[];if(t!=null&&t.customer_name&&y.push(`KH\xC1CH: ${t.customer_name}`),t!=null&&t.phone&&y.push(`S\u0110T: ${t.phone}`),t!=null&&t.address&&y.push(`\u0110\u1ECAA CH\u1EC8: ${t.address}`),((t==null?void 0:t.note)||"").trim()&&y.push(`GHI CH\xDA: ${(t.note||"").trim()}`),y.push(""),y.push("S\u1EA2N PH\u1EA8M:"),a.length)for(const w of a)y.push(`- ${w.name} (SL: ${w.qty})`);else{const w=ua(t);w&&w!=="\u2014"&&y.push(`- ${w}`)}y.push(""),y.push(`T\u1EA0M T\xCDNH: ${ze(n)}`),r.found&&o!==0&&y.push(`SHIP: ${ze(o)}`);{const w=window.KTM.orders.getOrderAdjustmentItems(t),_=(Array.isArray(w)?w:[]).map(k=>{var Nt;return{amount:Number((Nt=k==null?void 0:k.amount)!=null?Nt:0)||0,note:String((k==null?void 0:k.note)||"").trim()}}).filter(k=>k.amount!==0||!!k.note),p=Qn(t);if(d!==0||_.length>0||!!p)if(_.length===1){const k=_[0];y.push(`\u0110I\u1EC0U CH\u1EC8NH: ${T(d)}${k.note?` \u2014 ${k.note}`:""}`)}else{y.push(`\u0110I\u1EC0U CH\u1EC8NH: ${T(d)}${!_.length&&p?` \u2014 ${p}`:""}`);for(const k of _)y.push(`- ${T(k.amount)}${k.note?`: ${k.note}`:""}`)}}return y.push(`T\u1ED4NG: ${ze(m)}`),y.filter(Boolean).join(`
`)},qa=t=>{try{const e=Lr(t);Promise.resolve(window.KTM.clipboard.writeText(e)).then(()=>{typeof B=="function"?B("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}).catch(a=>{console.error(a),typeof B=="function"?B("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")});try{Ra(t)}catch(a){}}catch(e){console.error(e),typeof B=="function"?B("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},va=t=>window.KTM.orders.getOrderShipInfo(t,In),Na=t=>window.KTM.orders.getItemsSubtotal(t,In),ls=t=>{try{const e=t instanceof Date?t:new Date(t);if(!e||Number.isNaN(e.getTime()))return"";const a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0");return`${a}-${n}`}catch(e){return""}},ds=()=>qt?String(qt):ls(new Date),Xs=t=>{const e=String((t==null?void 0:t.customer_name)||"").trim().toLowerCase(),a=Ye((t==null?void 0:t.phone)||""),n=String((t==null?void 0:t.address)||"").trim().toLowerCase(),r=Qa(t).amount,d=(Array.isArray(t==null?void 0:t.items)?t.items:[]).map(m=>{var T;return{product_id:String((m==null?void 0:m.product_id)||"").trim(),quantity:Number((T=m==null?void 0:m.quantity)!=null?T:0),variant:String((m==null?void 0:m.variant)||"").trim()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0).sort((m,T)=>m.product_id<T.product_id?-1:m.product_id>T.product_id?1:m.variant<T.variant?-1:m.variant>T.variant?1:m.quantity-T.quantity);return JSON.stringify({name:e,phone:a,address:n,items:d,adj:r})},Mn=React.useMemo(()=>{const t=Ye(($==null?void 0:$.phone)||"");if(!t)return{count:0,orders:[],monthKey:ds()};const e=ds(),n=(Array.isArray(Kt)?Kt:[]).filter(r=>{if(!r||z&&String(r.id)===String(z)||Ye(r.phone||"")!==t)return!1;const o=ls(r.created_at);return o&&o===e}).sort((r,o)=>{const d=new Date(r.created_at).getTime(),m=new Date(o.created_at).getTime();return(Number.isFinite(m)?m:0)-(Number.isFinite(d)?d:0)});return{count:n.length,orders:n,monthKey:e}},[Kt,$==null?void 0:$.phone,qt,z]),jr=t=>{var m;const e=String((t==null?void 0:t.customer_name)||"").trim().toLowerCase(),a=Ye((t==null?void 0:t.phone)||""),n=String((t==null?void 0:t.address)||"").trim().toLowerCase(),r=$s((m=t==null?void 0:t.adjustment_amount)!=null?m:0),o=cs(t),d=(Array.isArray(o)?o:[]).map(T=>{var y;return{product_id:String((T==null?void 0:T.product_id)||"").trim(),quantity:Number((y=T==null?void 0:T.quantity)!=null?y:0),variant:String((T==null?void 0:T.variant)||"").trim()}}).filter(T=>T.product_id&&Number.isFinite(T.quantity)&&T.quantity>0).sort((T,y)=>T.product_id<y.product_id?-1:T.product_id>y.product_id?1:T.variant<y.variant?-1:T.variant>y.variant?1:T.quantity-y.quantity);return JSON.stringify({name:e,phone:a,address:n,items:d,adj:r})},Vs=React.useMemo(()=>{if(z)return"";const t=Ye(($==null?void 0:$.phone)||"");if(!t)return"";const e=ds(),a=Xs($),n=Array.isArray(Kt)?Kt:[];for(const r of n){if(!r||z&&String(r.id)===String(z)||Ye(r.phone||"")!==t)continue;const o=ls(r.created_at);if(!o||o!==e)continue;const d=jr(r);if(d&&d===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${e}${r!=null&&r.id?` (#${r.id})`:""}`}return""},[Kt,$,qt,z]),Ws=t=>{var bn;const e=[],a=[],n=String((t==null?void 0:t.customer_name)||"").trim(),r=Ye((t==null?void 0:t.phone)||""),o=String((t==null?void 0:t.address)||"").trim();n||e.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),r||e.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),r&&!ia(r)&&e.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const m=(Array.isArray(t==null?void 0:t.items)?t.items:[]).filter(He=>He&&He.product_id);m.length===0&&e.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),m.some(He=>{var ea;const Nn=Number((ea=He==null?void 0:He.quantity)!=null?ea:0);return!Number.isFinite(Nn)||Nn<=0})&&e.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const y=new Set;let w=!1;for(const He of m){const Nn=String(He.product_id||"").trim(),ea=String((He==null?void 0:He.variant)||"").trim();if(!Nn)continue;const Ee=`${Nn}||${ea}`;if(y.has(Ee)){w=!0;break}y.add(Ee)}w&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const _=Na(m),p=va(m),K=p!=null&&p.found?Number((bn=p==null?void 0:p.fee)!=null?bn:0):0,k=Array.isArray(t==null?void 0:t.adjustment_items)?t.adjustment_items:[],Nt=sa(k),ge=ra(Nt),Oe=Nt.some(He=>(Number(He==null?void 0:He.amount)||0)!==0&&!String((He==null?void 0:He.note)||"").trim());p!=null&&p.found&&(K>=2e5||_>0&&K>_*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ze(K)}`),Oe&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Se=Math.abs(ge);return(Se>=5e5||_>0&&Se>_*.5)&&ge!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ze(ge)}`),{errors:e,warnings:a,canSubmit:e.length===0}},Zr=React.useMemo(()=>Ws($),[$,Je]),De=React.useMemo(()=>{var ea;const t=String(($==null?void 0:$.customer_name)||"").trim(),e=Ye(($==null?void 0:$.phone)||""),a=String(($==null?void 0:$.address)||"").trim(),n=Array.isArray($==null?void 0:$.items)?$.items:[],r=new Map;for(const Ee of n){const pa=String((Ee==null?void 0:Ee.product_id)||"").trim(),Xa=String((Ee==null?void 0:Ee.variant)||"").trim();if(!pa)continue;const Va=`${pa}||${Xa}`;r.set(Va,(r.get(Va)||0)+1)}const o=n.map(Ee=>{var cr;const pa=String((Ee==null?void 0:Ee.product_id)||"").trim(),Xa=Number((cr=Ee==null?void 0:Ee.quantity)!=null?cr:0),Va=pa?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",Wr=Number.isFinite(Xa)&&Xa>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",Gr=String((Ee==null?void 0:Ee.variant)||"").trim(),Jr=`${pa}||${Gr}`,Ur=pa&&(r.get(Jr)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Va,qtyError:Wr,dupWarn:Ur}}),d=n.filter(Ee=>Ee&&Ee.product_id),m=Na(d),T=va(d),y=T!=null&&T.found?Number((ea=T==null?void 0:T.fee)!=null?ea:0):0,w=Array.isArray($==null?void 0:$.adjustment_items)?$.adjustment_items:[],_=sa(w),p=ra(_),K=_.some(Ee=>(Number(Ee==null?void 0:Ee.amount)||0)!==0&&!String((Ee==null?void 0:Ee.note)||"").trim()),k=Math.abs(p),Nt=K?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ge=p!==0&&(k>=5e5||m>0&&k>m*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ze(p)}`:"",Oe=T!=null&&T.found&&(y>=2e5||m>0&&y>m*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ze(y)}`:"",Se=t?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",bn=e?ia(e)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",He=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Nn=!Se&&!bn&&o.every(Ee=>!Ee.productError&&!Ee.qtyError);return{nameError:Se,phoneError:bn,addressWarn:He,items:o,shipAbnormalWarn:Oe,adjustmentNoteWarn:Nt,adjustmentAbnormalWarn:ge,canSubmit:Nn}},[$,Je]),Ha=async t=>{var m,T,y;const e=(t==null?void 0:t.mode)||"close",a=(t==null?void 0:t.origin)||"modal",n=Ws($);if(!n.canSubmit){const w=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof B=="function"?B(w,"danger"):alert(w);return}if(!z&&Vs){const w=`${Vs}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(w)){(Mn==null?void 0:Mn.count)>0&&kt(!0),setTimeout(()=>{var K;const p=document.getElementById("order-phone-input");p&&typeof p.scrollIntoView=="function"&&(p.scrollIntoView({block:"center",behavior:"smooth"}),(K=p.focus)==null||K.call(p))},0);return}}const r=Ye($.phone),d=(Array.isArray($.items)?$.items:[]).map(w=>{var _,p;return{product_id:(w==null?void 0:w.product_id)||"",quantity:Number((_=w==null?void 0:w.quantity)!=null?_:1),variant:String((w==null?void 0:w.variant)||"").trim()||null,variant_json:(p=w==null?void 0:w.variant_json)!=null?p:null,unit_price:(()=>{const K=w==null?void 0:w.unit_price,k=K===""||K==null?NaN:Number(K);if(Number.isFinite(k))return Math.max(0,Math.trunc(k));const Nt=In(w==null?void 0:w.product_id),ge=w!=null&&w.variant_json&&typeof w.variant_json=="object"?w.variant_json:null;return ma(Nt,ge)})()}}).filter(w=>w.product_id&&Number.isFinite(w.quantity)&&w.quantity>0);M(!0);try{const w=z,_=z?`${API_BASE}/api/orders/${z}`:`${API_BASE}/api/orders`,p=d[0],K=Array.isArray($==null?void 0:$.adjustment_items)?$.adjustment_items:[],k=sa(K),Nt=ra(k),ge=Za(k),Oe={customer_name:$.customer_name,phone:r,address:$.address,note:($.note||"").trim(),adjustment_amount:Nt,adjustment_note:ge,adjustment_items:k,product_id:p.product_id,quantity:p.quantity,status:$.status,items:d,...z?{id:z}:{}};if(z)await window.KTM.api.putJSON(_,Oe,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Se=await window.KTM.api.postJSON(_,Oe,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Pn.current={id:(y=(T=Se==null?void 0:Se.id)!=null?T:(m=Se==null?void 0:Se.order)==null?void 0:m.id)!=null?y:null,fingerprint:Xs($),ts:Date.now()}}if(_r(r,$.customer_name,$.address),a==="drawer"){if(Hn(""),pt(null),pe(!1),cn(!1),kt(!1),te([]),Vn(),w){mn(!0),rt("");try{const Se=await Ia(w);Se&&typeof Se=="object"&&Ve(Se)}catch(Se){rt((Se==null?void 0:Se.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{mn(!1)}}}else e==="new"&&!z?(Hn(""),pt(null),pe(!0)):(Hn(""),pt(null),pe(!1)),Vn()}catch(w){console.error(w),typeof B=="function"?B(w.message,"danger"):alert(w.message);return}finally{M(!1)}},wa=t=>window.KTM.orders.getOrderTotalMoney(t,In),Gs=()=>{J(new Set)},Js=(t,e)=>{const a=String(t!=null?t:"").trim();a&&J(n=>{const r=new Set(n);return e?r.add(a):r.delete(a),r})},Fr=(t,e)=>{const a=Array.isArray(t)?t:[];a.length&&J(n=>{var o;const r=new Set(n);for(const d of a){const m=String((o=d==null?void 0:d.id)!=null?o:"").trim();m&&(e?r.add(m):r.delete(m))}return r})},Br=async t=>{const e=String(t||"").trim();if(!e||wt)return;const a=Array.from(N||[]).map(n=>String(n).trim()).filter(Boolean);if(a.length){At(!0);try{const n=new Map((Array.isArray(Xe)?Xe:[]).map(d=>{var m;return[String((m=d==null?void 0:d.id)!=null?m:"").trim(),d]}));let r=0,o=0;for(const d of a){const m=n.get(d)||{id:d};await Gn(m,e,{silentToast:!0,skipToastBatch:!0})?r+=1:o+=1}typeof B=="function"&&(o===0?B(`\u0110\xE3 c\u1EADp nh\u1EADt ${r} \u0111\u01A1n`,"success",{durationMs:4500}):B(`\u0110\xE3 c\u1EADp nh\u1EADt ${r}/${a.length} \u0111\u01A1n (${o} l\u1ED7i)`,"warning",{durationMs:6500}))}finally{At(!1)}}},qr=async()=>{if(wt)return;const t=Array.from(N||[]).map(e=>String(e).trim()).filter(Boolean);if(t.length&&confirm(`X\xF3a ${t.length} \u0111\u01A1n \u0111\xE3 ch\u1ECDn?`)){At(!0),ft("__bulk__");try{let e=0,a=0;for(const n of t)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${n}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),e+=1;try{const r=String(n);it(o=>Array.isArray(o)?o.filter(d=>String(d==null?void 0:d.id)!==r):o),Lt(o=>Array.isArray(o)?o.filter(d=>String(d==null?void 0:d.id)!==r):o),we(o=>Array.isArray(o)?o.filter(d=>String(d==null?void 0:d.id)!==r):o),_e(o=>Array.isArray(o)?o.filter(d=>String(d==null?void 0:d.id)!==r):o),bt(o=>Array.isArray(o)?o.filter(d=>String(d==null?void 0:d.id)!==r):o)}catch(r){}try{Ue&&String(Mt==null?void 0:Mt.id)===String(n)&&ss()}catch(r){}try{Qe&&String(O==null?void 0:O.id)===String(n)&&Ln()}catch(r){}}catch(r){a+=1}Gs(),Vn(),da(),typeof B=="function"&&(a===0?B(`\u0110\xE3 x\xF3a ${e} \u0111\u01A1n`,"success",{durationMs:4500}):B(`\u0110\xE3 x\xF3a ${e}/${t.length} \u0111\u01A1n (${a} l\u1ED7i)`,"warning",{durationMs:6500}))}finally{ft(null),At(!1)}}},Us=async t=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){ft(t);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${t}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng");try{const e=String(t);it(a=>Array.isArray(a)?a.filter(n=>String(n==null?void 0:n.id)!==e):a),Lt(a=>Array.isArray(a)?a.filter(n=>String(n==null?void 0:n.id)!==e):a),we(a=>Array.isArray(a)?a.filter(n=>String(n==null?void 0:n.id)!==e):a),_e(a=>Array.isArray(a)?a.filter(n=>String(n==null?void 0:n.id)!==e):a),bt(a=>Array.isArray(a)?a.filter(n=>String(n==null?void 0:n.id)!==e):a)}catch(e){}try{Ue&&String(Mt==null?void 0:Mt.id)===String(t)&&ss()}catch(e){}try{Qe&&String(O==null?void 0:O.id)===String(t)&&Ln()}catch(e){}Vn(),da()}catch(e){console.error(e),typeof B=="function"?B(e.message,"danger"):alert(e.message)}finally{ft(null)}}},Hr=()=>{const t=I.current;if(!t)return;if(t.timer){try{clearTimeout(t.timer)}catch(o){}t.timer=null}const e=Array.isArray(t.events)?t.events.splice(0):[];if(!e.length||typeof B!="function")return;const a=new Map;for(const o of e){const d=String((o==null?void 0:o.orderId)||"").trim();d&&a.set(d,o)}const n=Array.from(a.values());if(!n.length)return;const r=o=>async()=>{try{for(const d of o)!(d!=null&&d.prevStatus)||!(d!=null&&d.orderId)||await Gn({id:d.orderId,status:d.nextStatus},d.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});B(o.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${o.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(d){B("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(n.length===1){const o=n[0],d=`${Kn(o.prevStatus)} \u2192 ${Kn(o.nextStatus)}`.trim();B(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${d}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:r([o])});return}B(`\u0110\xE3 c\u1EADp nh\u1EADt ${n.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:r(n)})},zr=t=>{const e=I.current;e&&(Array.isArray(e.events)||(e.events=[]),e.events.push(t),!e.timer&&(e.timer=setTimeout(()=>Hr(),320)))};useEffect(()=>()=>{try{const t=I.current;t!=null&&t.timer&&clearTimeout(t.timer)}catch(t){}},[]);const Gn=async(t,e,a={})=>{var d;const n=await Ra(t),r=n==null?void 0:n.id;if(!r||!e)return;const o=gn(n==null?void 0:n.status);dt(r);try{const m=cs(n),T=(Array.isArray(m)?m:[]).map(k=>{var Nt,ge;return{product_id:(k==null?void 0:k.product_id)||"",quantity:Number((Nt=k==null?void 0:k.quantity)!=null?Nt:1),variant:String((k==null?void 0:k.variant)||"").trim()||null,variant_json:(ge=k==null?void 0:k.variant_json)!=null?ge:null,unit_price:(()=>{var bn;const Oe=(bn=k==null?void 0:k.unit_price)!=null?bn:k==null?void 0:k.unitPrice,Se=Number(Oe);return Number.isFinite(Se)?Math.max(0,Math.trunc(Se)):null})()}}).filter(k=>k.product_id&&Number.isFinite(k.quantity)&&k.quantity>0);if(!T.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const y=T[0],w={id:r,customer_name:(n==null?void 0:n.customer_name)||"",phone:Ye((n==null?void 0:n.phone)||""),address:(n==null?void 0:n.address)||"",note:((n==null?void 0:n.note)||"").trim(),adjustment_amount:Number((d=n==null?void 0:n.adjustment_amount)!=null?d:0)||0,adjustment_note:(n==null?void 0:n.adjustment_note)||"",product_id:y.product_id,quantity:y.quantity,status:e,items:T};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${r}`,w,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i");const _=String(r),p=k=>({...k||{},status:e}),K=gn(e);return it(k=>Array.isArray(k)?k.map(Nt=>String(Nt==null?void 0:Nt.id)===_?p(Nt):Nt):k),Lt(k=>Array.isArray(k)?k.flatMap(Nt=>String(Nt==null?void 0:Nt.id)!==_?[Nt]:K==="pending"?[p(Nt)]:[]):k),we(k=>Array.isArray(k)?K==="draft"?k.map(Nt=>String(Nt==null?void 0:Nt.id)===_?p(Nt):Nt):k.filter(Nt=>String(Nt==null?void 0:Nt.id)!==_):k),_e(k=>Array.isArray(k)?k.map(Nt=>String(Nt==null?void 0:Nt.id)===_?p(Nt):Nt):k),bt(k=>Array.isArray(k)?k.map(Nt=>String(Nt==null?void 0:Nt.id)===_?p(Nt):Nt):k),Ve(k=>String(k==null?void 0:k.id)===_?p(k):k),h(k=>String(k==null?void 0:k.id)===_?p(k):k),Bt(k=>String(k==null?void 0:k.id)===_?p(k):k),Ta(r,!1),xr(r),a!=null&&a.silentToast?!0:a!=null&&a.skipToastBatch?(typeof B=="function"&&B("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500}),!0):(zr({orderId:r,prevStatus:o,nextStatus:gn(e)}),!0)}catch(m){if(console.error(m),(!navigator.onLine||(m==null?void 0:m.name)==="TypeError"||String((m==null?void 0:m.message)||"").toLowerCase().includes("failed to fetch"))&&!(a!=null&&a.fromSync)){const y=String(r),w=p=>({...p||{},status:e}),_=gn(e);return it(p=>Array.isArray(p)?p.map(K=>String(K==null?void 0:K.id)===y?w(K):K):p),Lt(p=>Array.isArray(p)?p.flatMap(K=>String(K==null?void 0:K.id)!==y?[K]:_==="pending"?[w(K)]:[]):p),we(p=>Array.isArray(p)?_==="draft"?p.map(K=>String(K==null?void 0:K.id)===y?w(K):K):p.filter(K=>String(K==null?void 0:K.id)!==y):p),_e(p=>Array.isArray(p)?p.map(K=>String(K==null?void 0:K.id)===y?w(K):K):p),bt(p=>Array.isArray(p)?p.map(K=>String(K==null?void 0:K.id)===y?w(K):K):p),Ve(p=>String(p==null?void 0:p.id)===y?w(p):p),h(p=>String(p==null?void 0:p.id)===y?w(p):p),Bt(p=>String(p==null?void 0:p.id)===y?w(p):p),Nr(r,e,o),typeof B=="function"&&B("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500}),!0}return typeof B=="function"?B(m.message,"danger"):alert(m.message),!1}finally{dt(null)}};useEffect(()=>{const t=e=>{var n;const a=(n=e==null?void 0:e.detail)==null?void 0:n.key;if(a){if(a==="/"){setTimeout(()=>{var r,o;(o=(r=$n.current)==null?void 0:r.focus)==null||o.call(r)},0);return}if(a==="N"||a==="n"){La();return}if((a==="j"||a==="J"||a==="k"||a==="K")&&Ue&&(Mt!=null&&Mt.id)){const r=Array.isArray(Xe)?Xe:[],o=r.findIndex(T=>String(T==null?void 0:T.id)===String(Mt==null?void 0:Mt.id));if(o<0)return;const m=r[o+(a==="j"||a==="J"?-1:1)];m&&ba(m)}}};return window.addEventListener("ktm-admin-hotkey",t),()=>window.removeEventListener("ktm-admin-hotkey",t)},[Xe,Ue,Mt]);const Xr=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:$.customer_name,onChange:t=>ee({...$,customer_name:t.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!De.nameError&&React.createElement("div",{className:"form-text text-danger"},De.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",id:"order-phone-input",value:$.phone,onChange:t=>Rs(t.target.value),onBlur:Ks,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!De.phoneError&&React.createElement("div",{className:"form-text text-danger"},De.phoneError),!De.phoneError&&Mn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Mn.count," \u0111\u01A1n trong th\xE1ng ",Mn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>kt(t=>!t)},et?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),et&&Mn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>kt(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Mn.orders.slice(0,5).map(t=>React.createElement("div",{key:t.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",t.id," \u2022 ",React.createElement("span",{className:`badge ${oa(t.status)}`},Kn(t.status))),React.createElement("div",{className:"text-muted small"},la(t.created_at)," \u2022 ",ze(wa(t))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ua(t))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${t.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&as(t)}},"M\u1EDF")))),Mn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(Q==null?void 0:Q.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(Q==null?void 0:Q.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(Q==null?void 0:Q.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(Q==null?void 0:Q.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:$.status,onChange:t=>ee({...$,status:t.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:$.address,onChange:t=>ee({...$,address:t.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!De.addressWarn&&React.createElement("div",{className:"form-text text-warning"},De.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:$.note,onChange:t=>ee({...$,note:t.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ee(t=>({...t,adjustment_items:[...Array.isArray(t.adjustment_items)?t.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},On($.adjustment_items).map((t,e)=>React.createElement("div",{key:e,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:t.amount,onChange:a=>{const n=a.target.value;ee(r=>{const o=On(r.adjustment_items);return o[e]={...o[e],amount:n},{...r,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:t.note,onChange:a=>{const n=a.target.value;ee(r=>{const o=On(r.adjustment_items);return o[e]={...o[e],note:n},{...r,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{ee(a=>{const n=On(a.adjustment_items);return n.splice(e,1),{...a,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:C||On($.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!De.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},De.adjustmentAbnormalWarn),!!De.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},De.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ee(t=>({...t,items:[...Array.isArray(t.items)?t.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Ke(t=>[...Array.isArray(t)?t:[],""]),z&&te(t=>[...Array.isArray(t)?t:[],!0])},disabled:C},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray($.items)?$.items:[{product_id:"",quantity:1}]).map((t,e)=>React.createElement("div",{key:e,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{dn.current[e]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{rn(a=>a===e?null:e),setTimeout(()=>{const a=document.getElementById(`order-product-search-${e}`);a&&a.focus()},0)}},React.createElement("span",{className:t.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Bs(t.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),vn===e&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${e}`,className:"form-control",value:yn[e]||"",onChange:a=>{const n=a.target.value;Ke(r=>{const o=Array.isArray(r)?[...r]:[];return o[e]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=Hs(e);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(n.id),o=Wn(n==null?void 0:n.variants),d={};for(const y of o){const w=String((y==null?void 0:y.name)||"").trim(),_=Array.isArray(y==null?void 0:y.options)?y.options[0]:null,p=String((_==null?void 0:_.label)||"").trim();w&&p&&(d[w]=p)}const m=Fa(d),T=ma(n,d);ee(y=>{const w=Array.isArray(y.items)?[...y.items]:[];return w[e]={...w[e]||{quantity:1},product_id:r,variant_json:Object.keys(d).length?d:null,variant:m,unit_price:o.length?T:null},{...y,items:w}}),rn(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:t.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Je.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var n;const a=(n=De.items)==null?void 0:n[e];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),(()=>{if(!(t!=null&&t.product_id))return null;const a=In(t.product_id),n=Wn(a==null?void 0:a.variants);if(!n.length)return null;const r=t!=null&&t.variant_json&&typeof t.variant_json=="object"?t.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,d)=>{const m=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${d+1}`).trim(),T=String((r==null?void 0:r[m])||"").trim();return React.createElement("div",{key:m},React.createElement("label",{className:"form-label small text-muted mb-1"},m),React.createElement("select",{className:"form-select",value:T,onChange:y=>{const w=String(y.target.value||"").trim();ee(_=>{const p=Array.isArray(_.items)?[..._.items]:[],K={...p[e]||{}},k=In(K.product_id),Nt=Wn(k==null?void 0:k.variants),ge=K!=null&&K.variant_json&&typeof K.variant_json=="object"?{...K.variant_json}:{};w?ge[m]=w:delete ge[m];const Oe=Fa(ge),Se=ma(k,ge);return p[e]={...K,variant_json:Object.keys(ge).length?ge:null,variant:Oe,unit_price:Se},{..._,items:p}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",m," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(y=>React.createElement("option",{key:y.label,value:y.label},y.label,Number.isFinite(Number(y==null?void 0:y.price))?` (${ze(Number(y.price))})`:Number(y==null?void 0:y.price_delta)?` (${y.price_delta>0?"+":""}${y.price_delta})`:""))))}))})(),z&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${e}`,checked:!!ve[e],onChange:a=>{const n=!!a.target.checked;te(r=>{const o=Array.isArray(r)?[...r]:[],d=Array.isArray($.items)?$.items.length:0;for(;o.length<d;)o.push(!0);return o[e]=n,o})},disabled:C||at}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${e}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:t.quantity,onChange:a=>{const n=a.target.value;ee(r=>{const o=Array.isArray(r.items)?[...r.items]:[];return o[e]={...o[e]||{product_id:""},quantity:n},{...r,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const a=(n=De.items)==null?void 0:n[e];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{ee(a=>{const n=Array.isArray(a.items)?[...a.items]:[];return n.splice(e,1),{...a,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Ke(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(e,1),n.length?n:[""]}),te(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(e,1),n}),rn(a=>a==null?a:a===e?null:a>e?a-1:a)},disabled:C||at||(Array.isArray($.items)?$.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const e=(Array.isArray($.items)?$.items:[]).filter(m=>m==null?void 0:m.product_id),a=Na(e),n=va(e),r=Qa($),o=r.amount,d=a+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ze(a))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ze(n.fee))),!!De.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},De.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ze(o))),($.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",($.note||"").trim()),!!r.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",r.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ze(d)))))})()),[Zn,an]=useState(0),[Sa,kn]=useState(!1),ta=useRef(null),Jn=useRef(null),Ys=t=>{try{return!t||typeof t.closest!="function"?!1:!!(t.closest(".modal, .dropdown-menu")||t.closest('[contenteditable="true"]')||t.closest(".orders-search")||t.closest('button, a, [role="button"]'))}catch(e){return!1}},za=(t,e)=>{const n=String(t||"").trim().split("-"),r=Number(n[0]||0),o=Number(n[1]||0);if(!r||!o)return"";const d=new Date(r,o-1+Number(e||0),1);return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`},xa=()=>{try{const t=(window==null?void 0:window.innerWidth)||360;return Math.max(110,Math.min(180,Math.floor(t*.28)))}catch(t){return 140}},ms=()=>Math.min(96,Math.max(66,Math.floor(xa()*.62))),Qs=t=>{var e;try{if(Ft||ne||$t==="draft"||!(t!=null&&t.touches)||t.touches.length!==1||Sa||(e=Jn.current)!=null&&e.active)return;const a=t.target;if(Ys(a))return;const n=t.touches[0];ta.current={x:n.clientX,y:n.clientY,at:Date.now(),swiping:!1}}catch(a){ta.current=null}},Zs=t=>{var y,w,_,p;const e=ta.current;if(!e||Sa)return;const a=(t==null?void 0:t.touches)&&t.touches[0];if(!a)return;const n=a.clientX-e.x,r=a.clientY-e.y,o=Math.abs(n),d=Math.abs(r);if(!e.swiping)if(o>10&&o>d*1.15){e.swiping=!0,kn(!1);try{(y=t.preventDefault)==null||y.call(t),(w=t.stopPropagation)==null||w.call(t)}catch(K){}}else return;const m=xa(),T=Math.max(-m,Math.min(m,n));an(T);try{(_=t.preventDefault)==null||_.call(t),(p=t.stopPropagation)==null||p.call(t)}catch(K){}},tr=t=>{const e=ta.current;ta.current=null;try{if(!e||Ft||ne||$t==="draft")return;if(!e.swiping){an(0);return}const a=(t==null?void 0:t.changedTouches)&&t.changedTouches[0];if(!a)return;const n=a.clientX-e.x,r=a.clientY-e.y,o=Date.now()-e.at,d=Math.abs(n),m=Math.abs(r);if(o>1e3)return;if(d<24){an(0);return}if(d<m*1.45)return;const T=ms(),y=d>=T,w=n>0?1:-1,_=xa();if(!y){kn(!0),an(0),setTimeout(()=>kn(!1),220);return}const p=w>0?-1:1,K=String(qt||jn||"").trim(),k=za(K,p);if(!k){kn(!0),an(0),setTimeout(()=>kn(!1),220);return}if(String(k)>String(jn)){kn(!0),an(w*Math.floor(_*.55)),setTimeout(()=>{an(0),setTimeout(()=>kn(!1),200)},140);return}kn(!0),an(w*_),setTimeout(()=>{Vt(k),an(-w*_),requestAnimationFrame(()=>{requestAnimationFrame(()=>{an(0),setTimeout(()=>kn(!1),220)})})},140)}catch(a){}},er=()=>{ta.current=null,an(0)},nr=t=>{var e,a;try{if(Ft||ne||$t==="draft"||Sa||(t==null?void 0:t.pointerType)==="mouse"&&t.button!=null&&t.button!==0)return;const n=t.target;if(Ys(n))return;ta.current=null,Jn.current={active:!0,pointerId:t.pointerId,startX:t.clientX,startY:t.clientY,at:Date.now(),lock:null,swiping:!1,captured:!1};try{(a=(e=t.currentTarget)==null?void 0:e.setPointerCapture)==null||a.call(e,t.pointerId),Jn.current.captured=!0}catch(r){}}catch(n){Jn.current=null}},ar=t=>{var T,y;const e=Jn.current;if(!e||!e.active||Sa)return;const a=t.clientX-e.startX,n=t.clientY-e.startY,r=Math.abs(a),o=Math.abs(n);if(e.lock||(r>10||o>10)&&(e.lock=r>o*1.15?"x":"y"),e.lock!=="x"){e.swiping&&an(0);return}e.swiping=!0;const d=xa(),m=Math.max(-d,Math.min(d,a));an(m);try{(T=t.preventDefault)==null||T.call(t),(y=t.stopPropagation)==null||y.call(t)}catch(w){}},sr=t=>{var a,n;const e=Jn.current;Jn.current=null;try{if(!e||!e.active||Ft||ne||$t==="draft")return;if(e.captured)try{(n=(a=t.currentTarget)==null?void 0:a.releasePointerCapture)==null||n.call(a,e.pointerId)}catch(ge){}if(!e.swiping){an(0);return}const r=t.clientX-e.startX,o=t.clientY-e.startY,d=Date.now()-e.at,m=Math.abs(r),T=Math.abs(o);if(d>1e3)return;if(m<24){an(0);return}if(m<T*1.45)return;const y=ms(),w=m>=y,_=r>0?1:-1,p=xa();if(!w){kn(!0),an(0),setTimeout(()=>kn(!1),220);return}const K=_>0?-1:1,k=String(qt||jn||"").trim(),Nt=za(k,K);if(!Nt){kn(!0),an(0),setTimeout(()=>kn(!1),220);return}if(String(Nt)>String(jn)){kn(!0),an(_*Math.floor(p*.55)),setTimeout(()=>{an(0),setTimeout(()=>kn(!1),200)},140);return}kn(!0),an(_*p),setTimeout(()=>{Vt(Nt),an(-_*p),requestAnimationFrame(()=>{requestAnimationFrame(()=>{an(0),setTimeout(()=>kn(!1),220)})})},140)}catch(r){}},rr=()=>{Jn.current=null,an(0)},ir=Zn>0?"Th\xE1ng tr\u01B0\u1EDBc":Zn<0?"Th\xE1ng sau":"",us=Zn>0?za(String(qt||jn||"").trim(),-1):Zn<0?za(String(qt||jn||"").trim(),1):"",or=us&&String(us)<=String(jn)?us:"",Vr=Math.min(1,Math.abs(Zn)/Math.max(1,ms()));return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:C||!!H||!!vt}),!!ir&&React.createElement("div",{"aria-hidden":"true",style:{position:"fixed",left:0,right:0,top:84,zIndex:1060,pointerEvents:"none",opacity:.15+.55*Vr,transform:"translateZ(0)"}},React.createElement("div",{className:"d-flex justify-content-center"},React.createElement("div",{className:"px-3 py-2 rounded-pill bg-dark text-white shadow-sm",style:{fontSize:13}},Zn>0?"\u2190":"\u2192"," ",ir,or?` \xB7 ${or}`:""))),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xn.all," \u0111\u01A1n"),ne&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>ne?js(oe):Vn(),disabled:sn,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>La(),disabled:C||!!H},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${xt&&!Ft&&!ne?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),Wt(!1),me(t=>!t)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},$r)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${mt&&!Ft&&!ne?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),me(!1),Wt(t=>!t)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Dr)),React.createElement("button",{type:"button",className:`orders-chip ${!$t&&!Ft&&!ne?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),It("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xn.all)),React.createElement("button",{type:"button",className:`orders-chip ${$t==="draft"&&!Ft&&!ne?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),It("draft"),Vt("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xn.draft)),React.createElement("button",{type:"button",className:`orders-chip ${$t==="pending"&&!Ft&&!ne?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),It("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xn.pending)),React.createElement("button",{type:"button",className:`orders-chip ${$t==="processing"&&!Ft&&!ne?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),It("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xn.processing)),React.createElement("button",{type:"button",className:`orders-chip ${$t==="done"&&!Ft&&!ne?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),It("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xn.done)),React.createElement("button",{type:"button",className:`orders-chip ${$t==="paid"&&!Ft&&!ne?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),It("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xn.paid)),React.createElement("button",{type:"button",className:`orders-chip ${$t==="canceled"&&!Ft&&!ne?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),It("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xn.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Fn("thisMonth"),disabled:ne},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Fn("overduePending"),disabled:ne},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",qn," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Fn("draftExpiring"),disabled:ne},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y"),($t||Ft||!qt&&!ne)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Fn("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center",style:{touchAction:"pan-y",transform:`translateX(${Zn}px)`,transition:Sa?"transform 220ms ease":"none",willChange:"transform"},onTouchStartCapture:Qs,onTouchMoveCapture:Zs,onTouchEndCapture:tr,onTouchCancelCapture:er,onPointerDownCapture:nr,onPointerMoveCapture:ar,onPointerUpCapture:sr,onPointerCancelCapture:rr},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:$n,type:"text",className:"form-control",value:oe,onChange:t=>Rt(t.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(oe||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Rt(""),disabled:sn},React.createElement("i",{className:"fas fa-times"})),sn&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:qt,onChange:t=>Vt(t.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:Ft||ne})),React.createElement("div",{className:"text-muted small ms-auto"},ne?"Search b\u1ECF qua filter":Ft?"\u0110ang xem \u0111\u01A1n ch\u1EADm":$t?`L\u1ECDc: ${Kn($t)}`:fe?"Vu\u1ED1t tr\xE1i/ph\u1EA3i \u0111\u1EC3 \u0111\u1ED5i th\xE1ng":""))),React.createElement("div",{className:`orders-context-header d-md-none ${A?"visible":""}`,title:"Vu\u1ED1t tr\xE1i/ph\u1EA3i \u0111\u1EC3 \u0111\u1ED5i th\xE1ng",onTouchStartCapture:Qs,onTouchMoveCapture:Zs,onTouchEndCapture:tr,onTouchCancelCapture:er,onPointerDownCapture:nr,onPointerMoveCapture:ar,onPointerUpCapture:sr,onPointerCancelCapture:rr},React.createElement("div",{className:"orders-context-text"},(()=>{if(ne){const t=String(oe||"").trim();return`Search: ${t?`"${t}"`:""} \u2022 ${Xe.length} k\u1EBFt qu\u1EA3`}return Ft?`\u0110\u01A1n ch\u1EADm \u2022 ${Xe.length} \u0111\u01A1n`:xt?`\u01AFu ti\xEAn \u2022 ${Xe.length} \u0111\u01A1n`:mt?`H\xF4m nay \u2022 ${Xe.length} \u0111\u01A1n`:$t?`L\u1ECDc: ${Kn($t)} \u2022 ${Xe.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${Xe.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Rt(""),me(!1),Wt(!1),Fn("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},ne?`${Xe.length} k\u1EBFt qu\u1EA3`:$t?`${Ea.length}/${yt.length} \u0111\u01A1n`:`${yt.length}${Ot?"+":""} \u0111\u01A1n`)),ne&&Fe&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Fe),Oa.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Oa.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",qn," ng\xE0y.",jt&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ce(!0),It("pending")}},"Xem ngay")),Ps.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,Ps.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 h\u1EE7y (c\xF2n \u2264 ",Ga," ng\xE0y).",Te&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ce(!1),It("draft"),Vt(""),Vn()}},"Xem ngay")),(N==null?void 0:N.size)>0&&React.createElement("div",{className:"alert alert-secondary d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-check-square me-2"}),"\u0110\xE3 ch\u1ECDn ",React.createElement("strong",null,N.size)," \u0111\u01A1n"),React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Gs(),disabled:wt},"B\u1ECF ch\u1ECDn"),React.createElement("select",{className:"form-select form-select-sm",style:{width:170},defaultValue:"",onChange:t=>{const e=String(t.target.value||"").trim();t.target.value="",e&&Br(e)},disabled:wt,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i h\xE0ng lo\u1EA1t"},React.createElement("option",{value:""},"\u0110\u1ED5i status\u2026"),na.map(t=>React.createElement("option",{key:t.value,value:t.value},t.label))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>qr(),disabled:wt||C||!!H},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))),(ne?sn:Gt)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((t,e)=>React.createElement("div",{key:e,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:40}}),React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((t,e)=>React.createElement("tr",{key:e},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(ne?Xe.length===0:yt.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},ne?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!ne&&Ea.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Ls.map(t=>{var e,a;return React.createElement("div",{key:t.id,className:`orders-mobile-swipe-shell mb-2 ${(Cn==null?void 0:Cn.id)===String(t.id)?`swipe-preview swipe-${(Cn==null?void 0:Cn.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>{if(re.current){re.current=!1;return}ba(t)},onPointerDown:n=>{if(Qe||f||V||n.button!=null&&n.button!==0)return;const r=String(t.id);re.current=!1,We.current={active:!0,id:r,startX:n.clientX,startY:n.clientY,dx:0,dy:0,lock:null,pointerId:n.pointerId,captured:!1},ln(o=>(o==null?void 0:o.id)===r?o:{id:r,dir:null});try{n.currentTarget.classList.remove("swiping"),n.currentTarget.style.setProperty("--swipe-x","0px"),n.currentTarget.style.setProperty("--swipe-p","0"),n.currentTarget.style.setProperty("--swipe-l","0"),n.currentTarget.style.setProperty("--swipe-r","0")}catch(o){}try{fn.current&&clearTimeout(fn.current)}catch(o){}wn.current=r,fn.current=setTimeout(async()=>{var d,m,T,y;const o=wn.current;if(o)try{if((m=(d=An.current)==null?void 0:d.has)!=null&&m.call(d,o))return;const w=await Ia(o);w&&typeof w=="object"&&((y=(T=An.current)==null?void 0:T.set)==null||y.call(T,o,w))}catch(w){}},150)},onPointerMove:n=>{const r=We.current;if(!(r!=null&&r.active)||String(r.id)!==String(t.id))return;const o=n.clientX-r.startX,d=n.clientY-r.startY;if(r.dx=o,r.dy=d,Math.abs(o)>14||Math.abs(d)>14){try{fn.current&&clearTimeout(fn.current)}catch(K){}fn.current=null,wn.current=null}if(!r.lock){const K=Math.abs(o),k=Math.abs(d);if((K>10||k>10)&&(r.lock=K>k*1.2?"x":"y",r.lock==="x"&&!r.captured))try{n.currentTarget.setPointerCapture(n.pointerId),r.captured=!0}catch(Nt){}}if(r.lock!=="x"){try{n.currentTarget.classList.remove("swiping"),n.currentTarget.style.setProperty("--swipe-x","0px"),n.currentTarget.style.setProperty("--swipe-p","0"),n.currentTarget.style.setProperty("--swipe-l","0"),n.currentTarget.style.setProperty("--swipe-r","0")}catch(K){}Math.abs(d)>24&&ln(K=>(K==null?void 0:K.id)===r.id?{id:r.id,dir:null}:K);return}const m=!!aa(t==null?void 0:t.status,"right"),T=!!aa(t==null?void 0:t.status,"left"),y=(K,k,Nt)=>Math.max(k,Math.min(Nt,K)),w=y(o,-140,140),_=w>0&&!m||w<0&&!T?w*.35:w,p=y(Math.abs(_)/88,0,1);try{n.currentTarget.classList.add("swiping"),n.currentTarget.style.setProperty("--swipe-x",`${_}px`),n.currentTarget.style.setProperty("--swipe-p",String(p)),n.currentTarget.style.setProperty("--swipe-l",_>0&&m?String(p):"0"),n.currentTarget.style.setProperty("--swipe-r",_<0&&T?String(p):"0")}catch(K){}Math.abs(_)>12&&(re.current=!0),o>72&&m?ln({id:r.id,dir:"right"}):o<-72&&T?ln({id:r.id,dir:"left"}):ln({id:r.id,dir:null})},onPointerCancel:n=>{try{fn.current&&clearTimeout(fn.current)}catch(o){}fn.current=null,wn.current=null;const r=We.current;try{r!=null&&r.captured&&(r==null?void 0:r.pointerId)!=null&&n.currentTarget.releasePointerCapture(r.pointerId)}catch(o){}We.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1},ln({id:null,dir:null});try{n.currentTarget.classList.remove("swiping"),n.currentTarget.style.setProperty("--swipe-x","0px"),n.currentTarget.style.setProperty("--swipe-p","0"),n.currentTarget.style.setProperty("--swipe-l","0"),n.currentTarget.style.setProperty("--swipe-r","0")}catch(o){}},onPointerUp:n=>{try{fn.current&&clearTimeout(fn.current)}catch(_){}fn.current=null,wn.current=null;const r=We.current;if(!(r!=null&&r.active)||String(r.id)!==String(t.id)){ln({id:null,dir:null});return}try{r!=null&&r.captured&&(r==null?void 0:r.pointerId)!=null&&n.currentTarget.releasePointerCapture(r.pointerId)}catch(_){}We.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1};const o=Number(r.dx)||0,d=Math.abs(o),m=r.lock==="x",T=gn(t==null?void 0:t.status);ln({id:null,dir:null});try{n.currentTarget.classList.remove("swiping"),n.currentTarget.style.setProperty("--swipe-x","0px"),n.currentTarget.style.setProperty("--swipe-p","0"),n.currentTarget.style.setProperty("--swipe-l","0"),n.currentTarget.style.setProperty("--swipe-r","0")}catch(_){}if(m&&d>12&&(re.current=!0),!m||d<88)return;n.preventDefault(),n.stopPropagation();const y=o>0?aa(t==null?void 0:t.status,"right"):aa(t==null?void 0:t.status,"left"),w=gn(y);!w||w===T||Gn(t,w)},onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),ba(t))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"orders-mobile-swipe-bg","aria-hidden":"true"},React.createElement("div",{className:"orders-mobile-swipe-bg-left"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const n=aa(t==null?void 0:t.status,"right"),r=Ts(n),o=(r==null?void 0:r.label)||String(n||"").trim();return o?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${r.icon||"fa-circle"}`}),o):null})())),React.createElement("div",{className:"orders-mobile-swipe-bg-right"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const n=aa(t==null?void 0:t.status,"left"),r=Ts(n),o=(r==null?void 0:r.label)||String(n||"").trim();return o?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${r.icon||"fa-circle"}`}),o):null})()))),React.createElement("div",{className:`card orders-mobile-card ${gt!=null&&gt[String(t.id)]?"order-recent-updated":""}`},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},t.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:n=>wr(n,t.phone),onPointerMove:Ua,onPointerUp:n=>Sr(n,t.phone),onPointerCancel:Ua,onPointerLeave:Ua,onContextMenu:n=>{n.preventDefault(),n.stopPropagation()},onClick:n=>{if(n.stopPropagation(),u.current){u.current=!1;return}Cs(t.phone)},onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),n.stopPropagation(),Cs(t.phone))},title:"Ch\u1EA1m \u0111\u1EC3 copy \u2022 Gi\u1EEF \u0111\u1EC3 g\u1ECDi"},t.phone),Number((e=t==null?void 0:t.split_seq)!=null?e:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",t.split_seq),(()=>{const n=xs(t);if(!n)return null;const r=U.has(String(t.id)),o=n.length>84||ks(t).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${r?"":"order-text-collapsed"}`},n),o&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:d=>{d.stopPropagation(),Ns(t.id)}},r?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const n=ks(t);if(!n)return null;const r=U.has(String(t.id)),o=xs(t).length,d=o>84||n.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${r?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",n),d&&o<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:m=>{m.stopPropagation(),Ns(t.id)}},r?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("div",{className:"form-check m-0",onClick:n=>n.stopPropagation(),onPointerDown:n=>n.stopPropagation()},React.createElement("input",{className:"form-check-input",type:"checkbox",checked:(a=N==null?void 0:N.has)==null?void 0:a.call(N,String(t.id)),onClick:n=>n.stopPropagation(),onChange:n=>{n.stopPropagation(),Js(t.id,!!n.target.checked)},disabled:wt||C||!!H,"aria-label":"Ch\u1ECDn \u0111\u01A1n",title:"Ch\u1ECDn \u0111\u01A1n"})),React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${St.has(String(t.id))?"active":""}`,onClick:n=>{n.stopPropagation(),fr(t.id)},title:St.has(String(t.id))?"B\u1ECF ghim":"Ghim","aria-label":St.has(String(t.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:St.has(String(t.id))?"fas fa-star":"far fa-star"})),!!(x!=null&&x[String(t.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${oa(t.status)} order-status-badge-btn`,onPointerDown:n=>{n.stopPropagation(),hn.current=!1;try{se.current&&clearTimeout(se.current)}catch(r){}se.current=setTimeout(()=>{hn.current=!0,vs(t,n.currentTarget)},420)},onPointerUp:n=>{n.stopPropagation();try{se.current&&clearTimeout(se.current)}catch(r){}se.current=null},onPointerCancel:n=>{n.stopPropagation();try{se.current&&clearTimeout(se.current)}catch(r){}se.current=null},onClick:n=>{if(n.stopPropagation(),hn.current){hn.current=!1;return}V&&String(Pt==null?void 0:Pt.id)===String(t.id)?Yn():vs(t,n.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},Kn(t.status)),_a(t)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${qn} ng\xE0y`},"\u26A0 Ch\u1EADm ",fa(t),"d"),Da(t)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Aa} ng\xE0y`},"\u23F3 C\xF2n ",$a(t),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const n=Ba(t);return n.length?React.createElement("div",{className:"mt-1"},n.map((r,o)=>React.createElement("div",{key:o,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},o+1,"."),r.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",r.qty,Number(r.unitPrice)>0?` \u2022 ${ze(r.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},ua(t))})()),(ya(t)!==0||Qn(t))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ze(ya(t))),Qn(t)?React.createElement("span",{className:"text-muted"}," ","(",Qn(t),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},ze(wa(t)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",la(t.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:n=>{n.stopPropagation(),qa(t)},disabled:C||!!H||vt===t.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:n=>{n.stopPropagation(),ys(t)},disabled:C||!!H||vt===t.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c")))))}),React.createElement("div",{ref:nt,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(Xe)&&Ls.length<Xe.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),V&&Pt&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>Yn()},React.createElement("div",{className:`orders-status-popover ${(Yt==null?void 0:Yt.placement)||""}`,style:{left:Yt.left,top:Yt.top},onClick:t=>t.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},Pt.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Yn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},na.map(t=>{const e=gn(Pt.status)===gn(t.value),a=C||!!H||vt===Pt.id;return React.createElement("button",{key:t.value,type:"button",className:`orders-status-chip ${e?"active":""}`,onClick:()=>{e||(Gn(Pt,t.value),Yn())},disabled:a},t.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{ys(Pt),Yn()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),Qe&&O&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Ln()},React.createElement("div",{className:"admin-sheet",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},O.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},O.phone||""),React.createElement("span",{className:`badge ${oa(O.status)}`},Kn(O.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ln(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{qa(O),Ln()},disabled:C||!!H||vt===O.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(O.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(O.phone||"").trim()}`,onClick:()=>Ln()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{ba(O),Ln()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt"),React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Us(O.id),disabled:C||!!H||vt===O.id},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},na.map(t=>{const e=gn(O.status)===gn(t.value),a=C||!!H||vt===O.id;return React.createElement("button",{key:t.value,type:"button",className:`orders-status-chip ${e?"active":""}`,onClick:()=>{e||(Gn(O,t.value),Ln())},disabled:a},t.label)})))),f&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Ma()},React.createElement("div",{className:"admin-sheet",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ma(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Fn("thisMonth"),disabled:ne},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Fn("overduePending"),disabled:ne},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Fn("draftExpiring"),disabled:ne},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!$t&&!Ft?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),It("")}},"T\u1EA5t c\u1EA3"),na.map(t=>React.createElement("button",{key:t.value,type:"button",className:`orders-filter-chip ${$t===t.value&&!Ft?"active":""}`,onClick:()=>{ne&&Rt(""),ce(!1),It(t.value),t.value==="draft"&&Vt("")}},t.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:qt,onChange:t=>Vt(t.target.value),disabled:Ft||ne}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:Ft,onChange:t=>{ne&&Rt("");const e=!!t.target.checked;ce(e),e&&(Vt(""),It("pending"))},disabled:ne}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",qn," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Fn("all"),disabled:ne},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>Ma()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${P?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:t=>{if(!(t.button!=null&&t.button!==0)){ke.current=!1;try{he.current&&clearTimeout(he.current)}catch(e){}he.current=setTimeout(()=>{ke.current=!0,ws(oe)},460)}},onPointerUp:()=>{try{he.current&&clearTimeout(he.current)}catch(t){}he.current=null},onPointerCancel:()=>{try{he.current&&clearTimeout(he.current)}catch(t){}he.current=null},onClick:()=>{if(ke.current){ke.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(t){}setTimeout(()=>{var t,e;return(e=(t=$n.current)==null?void 0:t.focus)==null?void 0:e.call(t)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>La(),disabled:C||!!H,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>hr(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),Me&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{ha(xe),Rn()}},React.createElement("div",{className:"orders-search-palette",onClick:t=>t.stopPropagation(),onTouchStart:t=>{const e=t.touches&&t.touches[0];e&&(Be.current={active:!0,startY:e.clientY,startX:e.clientX,fired:!1})},onTouchMove:t=>{const e=Be.current;if(!(e!=null&&e.active)||e.fired)return;const a=t.touches&&t.touches[0];if(!a)return;const n=a.clientY-e.startY,r=a.clientX-e.startX;Math.abs(r)>24||n>90&&(e.fired=!0,ha(xe),Rn())},onTouchEnd:()=>{Be.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{ha(xe),Rn()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:le,type:"text",className:"form-control",value:xe,onChange:t=>{const e=t.target.value;Ht(e),Rt(e)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:t=>{t.key==="Enter"&&(ha(xe),Rn())}}),!!String(xe||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Ht(""),Rt("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(j)&&j.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},j.slice(0,8).map(t=>React.createElement("button",{key:t,type:"button",className:"orders-chip",onClick:()=>{Ht(t),Rt(t),ha(t),Rn()}},t)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${xt?"active":""}`,onClick:()=>{Rt(""),Ht(""),ce(!1),Wt(!1),me(t=>!t),Rn()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${mt?"active":""}`,onClick:()=>{Rt(""),Ht(""),ce(!1),me(!1),Wt(t=>!t),Rn()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${Ft?"active":""}`,onClick:()=>{Rt(""),Ht(""),ce(t=>!t),Ft||(Vt(""),It("pending")),Rn()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!$t&&!Ft&&!xt&&!mt?"active":""}`,onClick:()=>{Rt(""),Ht(""),ce(!1),me(!1),Wt(!1),It(""),Rn()}},"T\u1EA5t c\u1EA3"),na.map(t=>React.createElement("button",{key:t.value,type:"button",className:`orders-filter-chip ${$t===t.value&&!Ft?"active":""}`,onClick:()=>{Rt(""),Ht(""),ce(!1),me(!1),Wt(!1),It(t.value),t.value==="draft"&&Vt(""),Rn()}},t.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:40}},React.createElement("input",{ref:v,className:"form-check-input",type:"checkbox",checked:ns,onClick:t=>t.stopPropagation(),onChange:t=>{t.stopPropagation(),Fr(Xe,!!t.target.checked)},disabled:wt||C||!!H,"aria-label":"Ch\u1ECDn t\u1EA5t c\u1EA3",title:"Ch\u1ECDn t\u1EA5t c\u1EA3"})),React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,Xe.map(t=>{var e;return React.createElement("tr",{key:t.id,style:{cursor:"pointer"},onClick:()=>ba(t),title:"Xem chi ti\u1EBFt"},React.createElement("td",{onClick:a=>a.stopPropagation()},React.createElement("input",{className:"form-check-input",type:"checkbox",checked:(e=N==null?void 0:N.has)==null?void 0:e.call(N,String(t.id)),onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation(),Js(t.id,!!a.target.checked)},disabled:wt||C||!!H,"aria-label":"Ch\u1ECDn \u0111\u01A1n",title:"Ch\u1ECDn \u0111\u01A1n"})),React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},t.customer_name),((t==null?void 0:t.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(t.note||"").trim())),React.createElement("td",null,t.phone),React.createElement("td",null,(()=>{const a=Ba(t);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((n,r)=>React.createElement("div",{key:r,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},r+1,"."),React.createElement("span",{className:"fw-semibold"},n.name)," ",React.createElement("span",{className:"text-muted"},"x",n.qty),Number(n.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",ze(n.unitPrice))))):ua(t)})()),React.createElement("td",null,zs(t)),React.createElement("td",{className:"fw-semibold"},ze(wa(t))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${oa(t.status)}`},Kn(t.status)),_a(t)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${qn} ng\xE0y`},"\u26A0 Ch\u1EADm ",fa(t),"d"),Da(t)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Aa} ng\xE0y`},"\u23F3 C\xF2n ",$a(t),"d"))),React.createElement("td",null,la(t.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),qa(t)},disabled:C||!!H||vt===t.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation();const n=String(a.target.value||"").trim();a.target.value="",n&&Gn(t,n)},disabled:C||!!H||vt===t.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))}))))),!ne&&Ot&&!Ft&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Rr,disabled:Gt||Ct},Ct?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:Ue,title:(()=>{const t=Mt,e=t!=null&&t.id?`#${t.id}`:"",a=t!=null&&t.status?`\u2022 ${Kn(t.status)}`:"";return`\u0110\u01A1n h\xE0ng ${e} ${a}`.trim()})(),subtitle:(()=>{const t=Mt,e=String((t==null?void 0:t.customer_name)||"").trim(),a=String((t==null?void 0:t.phone)||"").trim(),n=t!=null&&t.created_at?la(t.created_at):"";return[e||a||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:ss,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},Qt?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{cn(!1),pt(null),Hn(""),kt(!1),te([])},disabled:C||at},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!z&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:()=>Fs("drawer"),disabled:C||at,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},at?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>Ha({mode:"close",origin:"drawer"}),disabled:C||at||!De.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Mt&&qa(Mt),disabled:!Mt||on||C||!!H},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>Mt&&as(Mt),disabled:!Mt||on||C||!!H},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Mt&&Us(Mt.id),disabled:!Mt||on||C||!!H},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:t=>{const e=String(t.target.value||"").trim();t.target.value="",e&&Mt&&Gn(Mt,e)},disabled:!Mt||on||C||!!H||vt===(Mt==null?void 0:Mt.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},Qt?React.createElement("form",{onSubmit:t=>{t.preventDefault(),Ha({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),Xr())):on?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):F?React.createElement("div",{className:"alert alert-danger",role:"alert"},F):Mt?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${oa(Mt.status)}`},Kn(Mt.status)),_a(Mt)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${qn} ng\xE0y`},"\u26A0 Ch\u1EADm ",fa(Mt),"d"),Da(Mt)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Aa} ng\xE0y`},"\u23F3 C\xF2n ",$a(Mt),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},ze(wa(Mt))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},zs(Mt)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},la(Mt.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Mt.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},Mt.phone||"\u2014"),!!String(Mt.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(Mt.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},Mt.address||"\u2014")),((Mt==null?void 0:Mt.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(Mt.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const t=Ba(Mt);return t.length?React.createElement("div",{className:"d-grid gap-2"},t.map((e,a)=>React.createElement("div",{key:a,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},a+1,"."),e.name),e.variant?React.createElement("div",{className:"text-muted small"},e.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",e.qty,Number(e.unitPrice)>0?` \u2022 ${ze(e.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},ua(Mt)||"\u2014")})(),(ya(Mt)!==0||Qn(Mt))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ze(ya(Mt))),Qn(Mt)?React.createElement("span",{className:"text-muted"}," ","(",Qn(Mt),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Ie&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),z?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:rs})),React.createElement("form",{onSubmit:t=>{t.preventDefault(),Ha({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:_n},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:$.customer_name,onChange:t=>ee({...$,customer_name:t.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!De.nameError&&React.createElement("div",{className:"form-text text-danger"},De.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",id:"order-phone-input",value:$.phone,onChange:t=>Rs(t.target.value),onBlur:Ks,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!De.phoneError&&React.createElement("div",{className:"form-text text-danger"},De.phoneError),!De.phoneError&&Mn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Mn.count," \u0111\u01A1n trong th\xE1ng ",Mn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>kt(t=>!t)},et?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),et&&Mn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>kt(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Mn.orders.slice(0,5).map(t=>React.createElement("div",{key:t.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",t.id," \u2022 ",React.createElement("span",{className:`badge ${oa(t.status)}`},Kn(t.status))),React.createElement("div",{className:"text-muted small"},la(t.created_at)," \u2022 ",ze(wa(t))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ua(t))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${t.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&as(t)}},"M\u1EDF")))),Mn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(Q==null?void 0:Q.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(Q==null?void 0:Q.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(Q==null?void 0:Q.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(Q==null?void 0:Q.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:$.status,onChange:t=>ee({...$,status:t.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:$.address,onChange:t=>ee({...$,address:t.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!De.addressWarn&&React.createElement("div",{className:"form-text text-warning"},De.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:$.note,onChange:t=>ee({...$,note:t.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ee(t=>({...t,adjustment_items:[...Array.isArray(t.adjustment_items)?t.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},On($.adjustment_items).map((t,e)=>React.createElement("div",{key:e,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:t.amount,onChange:a=>{const n=a.target.value;ee(r=>{const o=On(r.adjustment_items);return o[e]={...o[e],amount:n},{...r,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:t.note,onChange:a=>{const n=a.target.value;ee(r=>{const o=On(r.adjustment_items);return o[e]={...o[e],note:n},{...r,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{ee(a=>{const n=On(a.adjustment_items);return n.splice(e,1),{...a,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:C||On($.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!De.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},De.adjustmentAbnormalWarn),!!De.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},De.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ee(t=>({...t,items:[...Array.isArray(t.items)?t.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Ke(t=>[...Array.isArray(t)?t:[],""]),z&&te(t=>[...Array.isArray(t)?t:[],!0])},disabled:C},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray($.items)?$.items:[{product_id:"",quantity:1}]).map((t,e)=>React.createElement("div",{key:e,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{dn.current[e]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{rn(a=>a===e?null:e),setTimeout(()=>{const a=document.getElementById(`order-product-search-${e}`);a&&a.focus()},0)}},React.createElement("span",{className:t.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Bs(t.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),vn===e&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${e}`,className:"form-control",value:yn[e]||"",onChange:a=>{const n=a.target.value;Ke(r=>{const o=Array.isArray(r)?[...r]:[];return o[e]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=Hs(e);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(n.id),o=Wn(n==null?void 0:n.variants),d={};for(const y of o){const w=String((y==null?void 0:y.name)||"").trim(),_=Array.isArray(y==null?void 0:y.options)?y.options[0]:null,p=String((_==null?void 0:_.label)||"").trim();w&&p&&(d[w]=p)}const m=Fa(d),T=ma(n,d);ee(y=>{const w=Array.isArray(y.items)?[...y.items]:[];return w[e]={...w[e]||{quantity:1},product_id:r,variant_json:Object.keys(d).length?d:null,variant:m,unit_price:o.length?T:null},{...y,items:w}}),rn(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:t.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Je.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var n;const a=(n=De.items)==null?void 0:n[e];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),(()=>{if(!(t!=null&&t.product_id))return null;const a=In(t.product_id),n=Wn(a==null?void 0:a.variants);if(!n.length)return null;const r=t!=null&&t.variant_json&&typeof t.variant_json=="object"?t.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,d)=>{const m=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${d+1}`).trim(),T=String((r==null?void 0:r[m])||"").trim();return React.createElement("div",{key:m},React.createElement("label",{className:"form-label small text-muted mb-1"},m),React.createElement("select",{className:"form-select",value:T,onChange:y=>{const w=String(y.target.value||"").trim();ee(_=>{const p=Array.isArray(_.items)?[..._.items]:[],K={...p[e]||{}},k=In(K.product_id),Nt=Wn(k==null?void 0:k.variants),ge=K!=null&&K.variant_json&&typeof K.variant_json=="object"?{...K.variant_json}:{};w?ge[m]=w:delete ge[m];const Oe=Fa(ge),Se=ma(k,ge);return p[e]={...K,variant_json:Object.keys(ge).length?ge:null,variant:Oe,unit_price:Se},{..._,items:p}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",m," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(y=>React.createElement("option",{key:y.label,value:y.label},y.label,Number.isFinite(Number(y==null?void 0:y.price))?` (${ze(Number(y.price))})`:Number(y==null?void 0:y.price_delta)?` (${y.price_delta>0?"+":""}${y.price_delta})`:""))))}))})(),z&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${e}`,checked:!!ve[e],onChange:a=>{const n=!!a.target.checked;te(r=>{const o=Array.isArray(r)?[...r]:[],d=Array.isArray($.items)?$.items.length:0;for(;o.length<d;)o.push(!0);return o[e]=n,o})},disabled:C||at}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${e}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:t.quantity,onChange:a=>{const n=a.target.value;ee(r=>{const o=Array.isArray(r.items)?[...r.items]:[];return o[e]={...o[e]||{product_id:""},quantity:n},{...r,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const a=(n=De.items)==null?void 0:n[e];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{ee(a=>{const n=Array.isArray(a.items)?[...a.items]:[];return n.splice(e,1),{...a,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Ke(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(e,1),n.length?n:[""]}),te(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(e,1),n}),rn(a=>a==null?a:a===e?null:a>e?a-1:a)},disabled:C||at||(Array.isArray($.items)?$.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const e=(Array.isArray($.items)?$.items:[]).filter(m=>m==null?void 0:m.product_id),a=Na(e),n=va(e),r=Qa($),o=r.amount,d=a+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ze(a))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ze(n.fee))),!!De.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},De.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ze(o))),($.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",($.note||"").trim()),!!r.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",r.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ze(d)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:rs,disabled:C||at,style:{borderRadius:10}},"H\u1EE7y"),!!z&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:()=>Fs("modal"),disabled:C||at,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},at?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!z&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Ha({mode:"new",origin:"modal"}),disabled:C||!De.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:C||at||!De.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

