const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:d,error:l}){const[f,M]=useState(""),[A,m]=useState(""),[C,R]=useState(!1),[E,_]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),l&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),l),React.createElement("form",{onSubmit:async ie=>{ie.preventDefault(),R(!0),await d(f,A),R(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:f,onChange:ie=>M(ie.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:E?"text":"password",className:"form-control",value:A,onChange:ie=>m(ie.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>_(!E)},React.createElement("i",{className:`fas fa-eye${E?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:C},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:d,type:l,onClose:f}){return useEffect(()=>{const M=setTimeout(f,3e3);return()=>clearTimeout(M)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${l} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},d),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:f})))}function Loading({show:d}){return d?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:d,onMenuChange:l,onLogout:f,currentUser:M}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(m=>React.createElement("a",{key:m.id,href:"#",className:`nav-link ${d===m.id?"active":""} ${m.disabled?"opacity-50":""} ${m.highlight?"text-warning":""}`,onClick:C=>{C.preventDefault(),m.disabled||l(m.id)}},React.createElement("i",{className:`fas ${m.icon}`})," ",m.label,m.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),m.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),f&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:f,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(d){const l=typeof d=="number"?d:parseFloat(String(d!=null?d:"").trim());return Number.isFinite(l)?Math.max(0,Math.min(100,l)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var d;try{const l=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!l)return{ship_percent:DEFAULT_SHIP_PERCENT};const f=JSON.parse(l);return{ship_percent:normalizeShipPercent((d=f==null?void 0:f.ship_percent)!=null?d:f==null?void 0:f.shipPercent)}}catch(l){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(d){var l;try{const f={ship_percent:normalizeShipPercent((l=d==null?void 0:d.ship_percent)!=null?l:d==null?void 0:d.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(f)),f}catch(f){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var l;const d=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((l=d==null?void 0:d.ship_percent)!=null?l:d==null?void 0:d.shipPercent)}}async function saveAdminSettingsToServer(d){var M,A,m;const l={ship_percent:normalizeShipPercent((M=d==null?void 0:d.ship_percent)!=null?M:d==null?void 0:d.shipPercent)},f=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,l,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((m=(A=f==null?void 0:f.ship_percent)!=null?A:f==null?void 0:f.shipPercent)!=null?m:l.ship_percent)}}function AlbumList({albums:d,onSelect:l,onCreate:f,onEdit:M,onDelete:A,loading:m,currentFolder:C,onBack:R,breadcrumb:E}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},C&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:R},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),C?C.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:f},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),E&&E.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:_=>{_.preventDefault(),R("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),E.map((_,B)=>React.createElement("li",{key:_.id,className:`breadcrumb-item ${B===E.length-1?"active":""}`},B===E.length-1?_.title:React.createElement("a",{href:"#",onClick:ie=>{ie.preventDefault(),R(_)},className:"text-warning"},_.title))))),m?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):d.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},C?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},d.map(_=>React.createElement("div",{key:_.uuid||_.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>l(_)},_.cover?React.createElement("img",{src:_.cover,className:"album-cover",alt:_.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},_.title),React.createElement("small",{className:"text-muted"},_.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),_.subfolderCount),_.subfolderCount>0&&_.count>0&&" \u2022 ",_.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),_.count),_.subfolderCount===0&&_.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:B=>{B.stopPropagation(),M(_)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:B=>{B.stopPropagation(),A(_)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:d,album:l,onClose:f,onSave:M,parentId:A}){const[m,C]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[R,E]=useState(!1),[_,B]=useState(!1),ie=useRef(null);useEffect(()=>{C(l?{slug:l.id||"",title:l.title||"",description:l.description||"",cover_url:l.cover||"",parent_id:l.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:A||null})},[l,d,A]);const O=async U=>{U.preventDefault(),E(!0),await M(m),E(!1)},J=U=>U.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),ne=async U=>{const se=U.type==="image/heic"||U.type==="image/heif"||/\.heic$/i.test(U.name);if(U.size<=2097152&&!se)return U;try{const W=await createImageBitmap(U),ge=document.createElement("canvas");let re=W.width,de=W.height;const oe=800;return(re>oe||de>oe)&&(re>de?(de=Math.round(de/re*oe),re=oe):(re=Math.round(re/de*oe),de=oe)),ge.width=re,ge.height=de,ge.getContext("2d").drawImage(W,0,0,re,de),W.close(),new Promise((ue,G)=>{ge.toBlob(g=>{g?ue(new File([g],U.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):G(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(W){throw console.error("Compress cover error:",W),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},F=async U=>{var W;const K=U.target.files[0];if(!K)return;if(!(K.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(K.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}B(!0);try{const ge=await ne(K),re=await window.KTM.cloudinary.uploadImage({file:ge,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!re.secure_url)throw console.error("Cloudinary error:",re),new Error(((W=re.error)==null?void 0:W.message)||"Upload failed");C(de=>({...de,cover_url:re.secure_url}))}catch(ge){console.error("Cover upload error:",ge),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+ge.message)}B(!1),U.target.value=""};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},l?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:f})),React.createElement("form",{onSubmit:O},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:m.title,onChange:U=>C({...m,title:U.target.value,slug:m.slug||J(U.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:m.slug,onChange:U=>C({...m,slug:U.target.value}),required:!0,disabled:!!l}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:m.description,onChange:U=>C({...m,description:U.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},m.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:m.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>C(U=>({...U,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:ie,type:"file",accept:"image/*",className:"d-none",onChange:F}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var U;return(U=ie.current)==null?void 0:U.click()},disabled:_},_?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:m.cover_url,onChange:U=>C({...m,cover_url:U.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:f},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:R||_},R?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:d,allAlbums:l,currentAlbumId:f,targetAlbum:M,onSelect:A,level:m=0}){const[C,R]=useState(!0),E=d.uuid||d.id,_=E===f,B=M===E,ie=l.filter(J=>J.parentId===E),O=ie.length>0;return React.createElement("div",{style:{marginLeft:m*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${B?"bg-info text-white":_?"bg-light text-muted":"hover-bg"}`,style:{cursor:_?"not-allowed":"pointer",opacity:_?.5:1,transition:"background 0.2s"},onClick:()=>!_&&A(E)},O&&React.createElement("i",{className:`fas fa-chevron-${C?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:J=>{J.stopPropagation(),R(!C)}}),!O&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${B?"-open":""} me-2 ${B?"":"text-warning"}`}),React.createElement("span",{className:"small"},d.title),_&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),d.count>0&&!_&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},d.count)),C&&O&&React.createElement("div",null,ie.map(J=>React.createElement(FolderTreeItem,{key:J.uuid||J.id,folder:J,allAlbums:l,currentAlbumId:f,targetAlbum:M,onSelect:A,level:m+1}))))}function AlbumDetail({album:d,onBack:l,onRefresh:f,showToast:M,onNavigateToFolder:A,onEditSubfolder:m,parentAlbum:C}){const[R,E]=useState([]),[_,B]=useState([]),[ie,O]=useState(!0),[J,ne]=useState(!1),[F,U]=useState(""),[K,se]=useState([]),[W,ge]=useState([]),[re,de]=useState({}),[oe,k]=useState(null),[ue,G]=useState(!1),[g,X]=useState(""),[Z,he]=useState(!1),ce=useRef(null),z=useRef(null),[Te,fe]=useState(!1),[be,Le]=useState([]),[u,pe]=useState([]),[He,Ze]=useState(""),[i,h]=useState(!1),ye=async(o,v=2)=>{const r=v*1024*1024,Ce=o.type==="image/heic"||o.type==="image/heif"||/\.heic$/i.test(o.name);if(o.size<=r&&!Ce)return o;try{const ke=await createImageBitmap(o),Ae=document.createElement("canvas");let Ke=ke.width,Pe=ke.height;const Ee=1200;return(Ke>Ee||Pe>Ee)&&(Ke>Pe?(Pe=Math.round(Pe/Ke*Ee),Ke=Ee):(Ke=Math.round(Ke/Pe*Ee),Pe=Ee)),Ae.width=Ke,Ae.height=Pe,Ae.getContext("2d").drawImage(ke,0,0,Ke,Pe),ke.close(),new Promise((bt,Ye)=>{Ae.toBlob(ve=>{ve?bt(new File([ve],o.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ye(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ke){throw console.error("Compress error:",ke),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{b(),D()},[d.id,d.uuid]);const b=async()=>{O(!0);try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${d.uuid||d.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");E(o.images||[]);const v=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${d.uuid||d.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");B(Array.isArray(v)?v:[])}catch(o){console.error(o),M("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}O(!1)},D=async()=>{try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");pe(Array.isArray(o)?o:[])}catch(o){console.error("Error loading albums:",o)}},$=o=>{Le(v=>v.includes(o)?v.filter(r=>r!==o):[...v,o])},we=async()=>{if(!He||be.length===0){M("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}h(!0);let o=0;for(const v of be)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${v}`,{album_id:He},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),o++}catch(r){console.error("Move error:",r)}h(!1),fe(!1),Le([]),Ze(""),o>0?(M("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),b(),f()):M("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Qe,xe]=useState(!1),$e=async()=>{if(be.length===0||!confirm(`X\xF3a ${be.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;xe(!0);let o=0;for(const v of be)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${v}`,"L\u1ED7i x\xF3a \u1EA3nh"),o++}catch(r){console.error("Delete error:",r)}xe(!1),Le([]),o>0?(M(`\u0110\xE3 x\xF3a ${o} \u1EA3nh!`,"success"),b(),f()):M("X\xF3a th\u1EA5t b\u1EA1i","danger")},je=()=>{be.length===R.length?Le([]):Le(R.map(o=>o.id))},Xe=async()=>{if(g.trim()){he(!0);try{const o=g.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:o+"-"+Date.now(),title:g,parent_id:d.uuid||d.id},"L\u1ED7i t\u1EA1o folder"),M("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),X(""),G(!1),b(),f()}catch(o){M(o.message,"danger")}he(!1)}},ht=async o=>{if(confirm(`X\xF3a folder "${o.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${o.uuid||o.id}`,"L\u1ED7i x\xF3a folder"),M("\u0110\xE3 x\xF3a folder","success"),b(),f()}catch(v){M("L\u1ED7i x\xF3a folder","danger")}},at=o=>{const v=Array.from(o).filter(r=>r.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(r.name));se(r=>[...r,...v]),v.forEach(r=>{const Ce=new FileReader;Ce.onload=ke=>{ge(Ae=>[...Ae,{file:r,preview:ke.target.result}])},Ce.readAsDataURL(r)})},Ct=o=>{se(v=>v.filter((r,Ce)=>Ce!==o)),ge(v=>v.filter((r,Ce)=>Ce!==o))},kt=async o=>{var r;const v=await window.KTM.cloudinary.uploadImage({file:o,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${d.id}`});if(!v.secure_url)throw console.error("Cloudinary error:",v),new Error(((r=v.error)==null?void 0:r.message)||"Upload failed");return v},vt=async()=>{if(K.length===0)return;ne(!0);let o=0;for(let v=0;v<K.length;v++)try{U(`\u0110ang x\u1EED l\xFD ${v+1}/${K.length}...`);const r=await ye(K[v],2);U(`\u0110ang upload ${v+1}/${K.length}...`);const Ce=await kt(r);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${d.id}`,{url:Ce.secure_url,caption:re[v]||K[v].name.replace(/\.[^/.]+$/,""),sort_order:R.length+v},"L\u1ED7i l\u01B0u \u1EA3nh"),o++}catch(r){console.error("Upload error:",r)}ne(!1),U(""),se([]),ge([]),de({}),o>0?(M(`\u0110\xE3 upload ${o} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),b(),f()):M("Upload th\u1EA5t b\u1EA1i","danger")},te=async(o,v)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${o}`,"L\u1ED7i x\xF3a \u1EA3nh"),M("\u0110\xE3 x\xF3a \u1EA3nh","success"),b(),f()}catch(r){M("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Re=o=>{var v;o.preventDefault(),(v=z.current)==null||v.classList.add("dragover")},Ue=()=>{var o;(o=z.current)==null||o.classList.remove("dragover")},dt=o=>{var v;o.preventDefault(),(v=z.current)==null||v.classList.remove("dragover"),at(o.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:l},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},d.title),React.createElement("small",{className:"text-muted"},_.length>0&&React.createElement("span",null,_.length," folder \u2022 "),R.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>G(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ue&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:g,onChange:o=>X(o.target.value),onKeyPress:o=>o.key==="Enter"&&Xe(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Xe,disabled:Z||!g.trim()},Z?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{G(!1),X("")}},"H\u1EE7y")))),_.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},_.map(o=>React.createElement("div",{key:o.uuid||o.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>A&&A(o)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},o.title),React.createElement("small",{className:"text-muted"},o.subfolderCount>0&&React.createElement("span",null,o.subfolderCount," folder"),o.subfolderCount>0&&o.count>0&&" \u2022 ",o.count>0&&React.createElement("span",null,o.count," \u1EA3nh"),o.subfolderCount===0&&o.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:v=>{v.stopPropagation(),m&&m(o)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:v=>{v.stopPropagation(),ht(o)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:z,className:"upload-zone",onClick:()=>{var o;return(o=ce.current)==null?void 0:o.click()},onDragOver:Re,onDragLeave:Ue,onDrop:dt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:ce,type:"file",multiple:!0,accept:"image/*",onChange:o=>at(o.target.files)})),W.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},W.map((o,v)=>React.createElement("div",{key:v,className:"upload-preview-item"},React.createElement("img",{src:o.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Ct(v)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:vt,disabled:J},J?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),F||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",K.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",R.length,")"),R.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:je},be.length===R.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),be.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},be.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>fe(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:$e,disabled:Qe},Qe?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Le([])},React.createElement("i",{className:"fas fa-times"})))),ie?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):R.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},R.map((o,v)=>React.createElement("div",{key:v,className:`image-item ${be.includes(o.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>$(o.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:be.includes(o.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:be.includes(o.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},be.includes(o.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:o.src,alt:o.caption,style:{opacity:be.includes(o.id)?.7:1,border:be.includes(o.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:r=>{r.stopPropagation(),te(o.id,v)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),o.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},o.caption)))))),Te&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",be.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>fe(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},u.filter(o=>!o.parentId).map(o=>React.createElement(FolderTreeItem,{key:o.uuid||o.id,folder:o,allAlbums:u,currentAlbumId:d.uuid||d.id,targetAlbum:He,onSelect:Ze})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>fe(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:we,disabled:!He||i},i?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),oe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>k(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>k(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:oe.src,alt:oe.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:o=>o.stopPropagation()}),oe.caption&&React.createElement("div",{className:"text-white text-center mt-2"},oe.caption)))))}function SearchCenter({showToast:d,onNavigate:l}){const[f,M]=useState(""),[A,m]=useState([]),[C,R]=useState([]),[E,_]=useState([]),[B,ie]=useState("all"),[O,J]=useState(null),[ne,F]=useState("list"),[U,K]=useState(!0),[se,W]=useState([]),[ge,re]=useState([]),de=useRef(null),[oe,k]=useState(!0),[ue,G]=useState(!1),g=useRef(null),[X,Z]=useState(!1),[he,ce]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[z,Te]=useState(""),[fe,be]=useState(!1),Le=useRef(null),u=useRef(null),[pe,He]=useState(null),[Ze,i]=useState(!1),[h,ye]=useState(null),[b,D]=useState(!1),[$,we]=useState(!1),[Qe,xe]=useState(null),[$e,je]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),Xe=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ht=t=>{var N,p;t._type==="product"&&(ye(t),je({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||"",commission_percent:(p=(N=t.commission_percent)!=null?N:t.commissionPercent)!=null?p:""}),i(!0))},at=async()=>{if(h)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${h.id}`,$e,"L\u1ED7i c\u1EADp nh\u1EADt"),d("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),i(!1),ye(null),Re()}catch(t){d(t.message,"danger")}},Ct=async t=>{const N=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${N} "${t.name}"?`))try{let p="";t._type==="product"?p=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?p=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(p=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(p,"L\u1ED7i x\xF3a"),d(`\u0110\xE3 x\xF3a ${N}`,"success"),Re()}catch(p){d(p.message,"danger")}},kt=async t=>{try{const N=Qe?`${API_BASE}/api/products?id=${Qe.id}`:`${API_BASE}/api/products`;Qe?await window.KTM.api.putJSON(N,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(N,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),d(Qe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),we(!1),xe(null),Re()}catch(N){d(N.message,"danger")}},vt="ktm_admin_data_cache_v1",te=1e3*60*10,Re=async()=>{let t=null,N=!1;const p=window.KTM.cache.read(vt,{ttlMs:te,validate:Array.isArray});p.hit?(t=p.value,console.log("[CACHE] Using cache, items:",t.length),R(t),m(t),K(!1),N=!0):p.status==="miss"?console.log("[CACHE] No cache found"):p.status==="expired"||p.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):p.status==="error"&&console.error("[CACHE] Error parsing cache"),N||K(!0);try{const T=async(De,Oe)=>{try{const Je=await window.KTM.api.getJSON(De,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Je!=null?Je:Oe}catch(Je){return Oe}},[I,w,y]=await Promise.all([T(`${API_BASE}/api/products`,[]),T(`${API_BASE}/api/albums`,[]),T(`${API_BASE}/api/video-folders?withVideos=true`,[])]),L=Array.isArray(I)?I.map(De=>({...De,_type:"product",_source:"database"})):[];W(w);let V=[];Array.isArray(w)&&w.length>0&&(await Promise.all(w.map(Oe=>T(`${API_BASE}/api/albums/${Oe.id}`,{})))).forEach((Oe,Je)=>{const q=w[Je];Oe.images&&Oe.images.length>0&&Oe.images.forEach(le=>{V.push({id:le.id,name:le.caption||"\u1EA2nh t\u1EEB "+q.title,image:le.src,folder:q.title,_type:"album",_source:"database"})})}),re(y);let me=[];Array.isArray(y)&&y.forEach(De=>{De.videos&&De.videos.forEach(Oe=>{me.push({id:Oe.id,name:Oe.title,folder:De.name,image:Oe.thumb,youtubeId:Oe.youtubeId,url:Oe.url,_type:"video",_source:"database"})})});const Q=[...L,...V,...me];(!t||JSON.stringify(Q)!==JSON.stringify(t))&&(R(Q),m(Q),window.KTM.cache.write(vt,Q))}catch(T){console.error("Song song fetch error:",T)}K(!1)};useEffect(()=>{Re(),setTimeout(()=>{var t;return(t=de.current)==null?void 0:t.focus()},100)},[]);const Ue=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(N){return String(t!=null?t:"").toLowerCase()}},dt=t=>{const p=Ue(t).trim().split(/\s+/).filter(Boolean),T=p.includes("anh"),I=p.includes("video"),w=p.filter(V=>V!=="anh"&&V!=="video"),y=w.join(" "),L=new Set(["product"]);return T&&L.add("album"),I&&L.add("video"),{allowedTypes:L,includeAlbum:T,includeVideo:I,contentTokens:w,cleanedQuery:y}},o=(t,N,p)=>{var De,Oe,Je,q,le;const T=Array.isArray(N)?N:[],I=Ue(p).trim();if(!T.length&&!I)return 0;const w=Ue((De=t==null?void 0:t.name)!=null?De:""),y=Ue((Oe=t==null?void 0:t.code)!=null?Oe:""),L=Ue((Je=t==null?void 0:t.category)!=null?Je:""),V=Ue((q=t==null?void 0:t.note)!=null?q:""),me=Ue((le=t==null?void 0:t.folder)!=null?le:"");if(!`${w} ${y} ${L} ${V} ${me}`.trim())return 0;let ee=0;I&&(w===I&&(ee+=220),w.includes(I)&&(ee+=140),w.startsWith(I)&&(ee+=160),y&&y===I&&(ee+=180),y&&y.includes(I)&&(ee+=90));for(const Be of T){if(!Be)continue;const et=new RegExp(`(?:^|\\s)${Be.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);w.includes(Be)&&(ee+=35),et.test(w)&&(ee+=25),y&&y.includes(Be)&&(ee+=20),y&&et.test(y)&&(ee+=10),L&&L.includes(Be)&&(ee+=12),me&&me.includes(Be)&&(ee+=12),V&&V.includes(Be)&&(ee+=6)}return ee>0&&w&&(ee+=Math.max(0,10-Math.min(10,Math.floor(w.length/10)))),ee},v=(t,N,p)=>{const T=Array.isArray(t)?t:[];return T.length?T.map((w,y)=>({it:w,idx:y,score:o(w,N,p)})).sort((w,y)=>y.score!==w.score?y.score-w.score:w.idx-y.idx).map(w=>w.it):[]},r=async(t,N)=>{if(!(!oe||N.length===0)){G(!0);try{const p=N.map(I=>({id:I.id,name:I.name,price:I.price,category:I.category,note:I.note,folder:I.folder,_type:I._type})),T=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:p},"AI Search error");if(T&&T.matchedIds&&T.matchedIds.length>0){const{contentTokens:I,cleanedQuery:w}=dt(t),y=new Set(T.matchedIds),L=N.filter(V=>y.has(V.id)).sort((V,me)=>o(me,I,w)-o(V,I,w));L.length>0&&m(L)}else T&&T.matchedIds&&T.matchedIds.length===0&&m([])}catch(p){console.error("AI Search error:",p)}G(!1)}},Ce=t=>{if(M(t),g.current&&clearTimeout(g.current),!t.trim()){ke(B);return}const{allowedTypes:N,contentTokens:p,cleanedQuery:T}=dt(t),I=C.filter(y=>{if(!N.has(y==null?void 0:y._type))return!1;if(p.length===0)return!0;const L=Ue(Object.entries(y).filter(([V])=>!V.startsWith("_")).map(([,V])=>String(V||"")).join(" "));return p.some(V=>L.includes(V))});let w=I;B!=="all"&&(w=I.filter(y=>(y.category||y._type)===B)),m(v(w,p,T)),oe&&T.length>=3&&(g.current=setTimeout(()=>{r(T,w)},500))},ke=t=>{ie(t);const{allowedTypes:N,contentTokens:p}=dt(f),{cleanedQuery:T}=dt(f);let I=C.filter(w=>N.has(w==null?void 0:w._type));t!=="all"&&(I=I.filter(w=>(w.category||w._type)===t)),f.trim()&&p.length>0&&(I=I.filter(w=>{const y=Ue(Object.entries(w).filter(([L])=>!L.startsWith("_")).map(([,L])=>String(L||"")).join(" "));return p.every(L=>y.includes(L))})),m(v(I,p,T))},Ae=(t,N)=>{window.KTM.clipboard.writeText(t).then(()=>{J(N),d("\u0110\xE3 copy!","success"),setTimeout(()=>J(null),1500)})},Ke=async(t,N)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),J(N+"-img"),d("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>J(null),1500)}catch(p){Ae(t,N+"-img")}},Pe=t=>{let N=t.toLowerCase();const p=[],T=C.filter(y=>y._type==="product");if(N.includes("ty")||N.includes("xy lanh")){if(N.includes("gi\u1EEFa")||N.includes("giua")){const y=T.find(L=>{var V;return(V=L.name)==null?void 0:V.toLowerCase().includes("xy lanh gi\u1EEFa")});y&&!p.find(L=>L.id===y.id)&&p.push(y)}if(N.includes("nghi\xEAng")||N.includes("nghieng")){const y=T.find(L=>{var V;return(V=L.name)==null?void 0:V.toLowerCase().includes("xy lanh nghi\xEAng")});y&&!p.find(L=>L.id===y.id)&&p.push(y)}if(N.includes("\u1EE7i")||N.includes("ui")){const y=T.find(L=>{var V;return(V=L.name)==null?void 0:V.toLowerCase().includes("xy lanh \u1EE7i")});y&&!p.find(L=>L.id===y.id)&&p.push(y)}}const I=N.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(I){const y=I[1],L=I[2],V=T.find(me=>{var ee;const Q=((ee=me.name)==null?void 0:ee.toLowerCase())||"";return Q.includes("combo")&&Q.includes(`${y} tay`)&&(Q.includes(`${L} xy`)||Q.includes(`${L} xylanh`))});if(V&&!p.find(me=>me.id===V.id))p.push(V);else{const me=T.find(Q=>{var De;const ee=((De=Q.name)==null?void 0:De.toLowerCase())||"";return ee.includes("combo")&&ee.includes(`${y} tay`)});me&&!p.find(Q=>Q.id===me.id)&&p.push(me)}}if(N.includes("combo")&&!I){const y=N.match(/combo.*?(\d+)\s*tay/);if(y){const L=y[1];T.filter(me=>{var ee;const Q=((ee=me.name)==null?void 0:ee.toLowerCase())||"";return Q.includes("combo")&&Q.includes(`${L} tay`)}).forEach(me=>{p.find(Q=>Q.id===me.id)||p.push(me)})}}const w=N.match(/van\s*(\d+)\s*tay/);if(w&&!N.includes("ty")&&!N.includes("combo")){const y=w[1],L=T.find(V=>{var Q;const me=((Q=V.name)==null?void 0:Q.toLowerCase())||"";return me.includes(`van ${y} tay`)&&!me.includes("combo")});L&&!p.find(V=>V.id===L.id)&&p.push(L)}return p.slice(0,4)},Ee=async t=>{if(!t.trim())return;const N={role:"user",content:t,attachments:[]};ce(T=>[...T,N]),Te(""),be(!0);const p=Pe(t);setTimeout(()=>{var T;return(T=Le.current)==null?void 0:T.scrollIntoView({behavior:"smooth"})},100);try{const I=C.filter(Q=>Q._type==="product").map(Q=>{let ee=`- ${Q.name}`;return Q.code&&(ee+=` (M\xE3: ${Q.code})`),Q.price&&(ee+=` - Gi\xE1: ${Q.price.replace(/[đ\s]/g,"")}\u0111`),Q.category&&(ee+=` [${Q.category}]`),Q.note&&(ee+=` (${Q.note})`),ee}).join(`
`),y=he.slice(-6).map(Q=>`${Q.role==="user"?"Kh\xE1ch":"AI"}: ${Q.content}`).join(`
`),L=y?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${y}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${I}`:I,me=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:L,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";ce(Q=>[...Q,{role:"assistant",content:me,attachments:p}])}catch(T){console.error("AI Error:",T);const I=t.toLowerCase(),w=C.filter(L=>{const V=Object.values(L).join(" ").toLowerCase();return I.split(" ").some(me=>V.includes(me))});let y="";w.length>0?(y=`T\xECm th\u1EA5y ${w.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,w.slice(0,5).forEach(L=>{y+=`\u2022 ${L.name}`,L.price&&(y+=` - ${L.price.replace(/[đ\s]/g,"")}\u0111`),L.note&&(y+=` (${L.note})`),y+=`
`}),w.length>5&&(y+=`
...v\xE0 ${w.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):y='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',ce(L=>[...L,{role:"assistant",content:y,attachments:w.slice(0,4)}])}be(!1),setTimeout(()=>{var T,I;(T=Le.current)==null||T.scrollIntoView({behavior:"smooth"}),(I=u.current)==null||I.focus()},100)};function mt({show:t,product:N,categories:p,onClose:T,onSave:I}){const[w,y]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[L,V]=useState(!1),[me,Q]=useState(!1),ee=useRef(null),De=Y=>window.KTM.money.formatVNDInputDigits(Y);useEffect(()=>{var Y,Se;if(N)if(y({name:N.name||"",code:N.code||"",price:N.price||"",image:N.image||"",category:N.category||"",note:N.note||"",sort_order:N.sort_order||0,commission_percent:(Se=(Y=N.commission_percent)!=null?Y:N.commissionPercent)!=null?Se:5}),N.price){const tt=window.KTM.money.getDigits(N.price);le(tt),y(qe=>({...qe,price:De(tt)}))}else le("");else y({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),le("")},[N,t]);const[Oe,Je]=React.useState(""),[q,le]=React.useState(""),Be=Y=>{const Se=window.KTM.money.nextPriceInputState(Y.target.value,q);le(Se.digits),y({...w,price:Se.price})},et=async(Y,Se=2)=>{const tt=Se*1024*1024;if(Y.size<=tt)return Y;try{const qe=await createImageBitmap(Y),ze=document.createElement("canvas");let Ie=qe.width,We=qe.height;const ut=1200;return(Ie>ut||We>ut)&&(Ie>We?(We=Math.round(We/Ie*ut),Ie=ut):(Ie=Math.round(Ie/We*ut),We=ut)),ze.width=Ie,ze.height=We,ze.getContext("2d").drawImage(qe,0,0,Ie,We),qe.close(),new Promise((ot,St)=>{ze.toBlob(_e=>{_e?ot(new File([_e],Y.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):St(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(qe){throw console.error("Compress error:",qe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},st=async Y=>{var qe;const Se=Y.target.files[0];if(!Se)return;if(!(Se.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Se.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Q(!0);try{const ze=await et(Se),Ie=await window.KTM.cloudinary.uploadImage({file:ze,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!Ie.secure_url)throw console.error("Cloudinary error:",Ie),new Error(((qe=Ie.error)==null?void 0:qe.message)||"Upload failed");y(We=>({...We,image:Ie.secure_url}))}catch(ze){console.error("Upload error:",ze),alert("L\u1ED7i upload \u1EA3nh: "+ze.message)}Q(!1),Y.target.value=""},gt=async Y=>{Y.preventDefault(),V(!0),await I(w),V(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),N?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:gt},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:w.name,onChange:Y=>y({...w,name:Y.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:w.code,onChange:Y=>y({...w,code:Y.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:w.price,onChange:Be,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:w.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:Y=>y({...w,commission_percent:Y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:w.category,onChange:Y=>y({...w,category:Y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),p.map(Y=>React.createElement("option",{key:Y,value:Y},Y)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:w.note,onChange:Y=>y({...w,note:Y.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},w.image?React.createElement(React.Fragment,null,React.createElement("img",{src:w.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>y({...w,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var Y;return(Y=ee.current)==null?void 0:Y.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:ee,type:"file",accept:"image/*",className:"d-none",onChange:st}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var Y;return(Y=ee.current)==null?void 0:Y.click()},disabled:me,style:{borderRadius:"10px"}},me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:w.image,onChange:Y=>y({...w,image:Y.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:T,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:L,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},L?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const bt=(t,N)=>{const p=t._type==="product",T=t._type==="album",I=t._type==="video",w=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale"));return ne==="grid"?React.createElement("div",{key:t.id||N,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>He({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${I?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${p?"product":T?"album":"video"}`},p?"SP":T?"\u1EA2nh":"Video"),w&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:O===t.id+"-img"?"copied":"",onClick:()=>Ke(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:O===t.id+"-price"?"copied":"",onClick:()=>Ae(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||N,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${p?"product":T?"album":"video"}`},p?"S\u1EA3n ph\u1EA9m":T?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>He({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${I?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),w&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),I&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},p&&React.createElement("button",{onClick:()=>l&&l("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:O===t.id+"-price"?"copied":"",onClick:()=>Ae(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:O===t.id+"-name"?"copied":"",onClick:()=>Ae(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),I&&t.youtubeId&&React.createElement("button",{className:O===t.id+"-yt"?"copied":"",onClick:()=>Ae(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),p&&React.createElement("button",{className:"action-edit",onClick:()=>ht(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Ct(t)},React.createElement("i",{className:"fas fa-trash"}))))},[Ye,ve]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,A.length)," k\u1EBFt qu\u1EA3",oe&&f.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),B!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},B==="product"?"S\u1EA3n ph\u1EA9m":B==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${ne==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>F("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${ne==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>F("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},U?React.createElement("div",null,[...Array(8)].map((t,N)=>React.createElement("div",{key:N,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):A.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',f,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{M(""),Ce("")}},"Xem t\u1EA5t c\u1EA3")):ne==="grid"?React.createElement("div",{className:"product-grid-mobile"},A.map((t,N)=>bt(t,N))):React.createElement("div",null,A.map((t,N)=>bt(t,N)))),Ye&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ve(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${B==="all"?"active":""}`,onClick:()=>{ke("all"),ve(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${B==="product"?"active":""}`,onClick:()=>{ke("product"),ve(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${B==="album"?"active":""}`,onClick:()=>{ke("album"),ve(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${B==="video"?"active":""}`,onClick:()=>{ke("video"),ve(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:oe,onChange:t=>k(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:de,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:f,onChange:t=>Ce(t.target.value)}),React.createElement("button",{className:`filter-btn ${Ye||B!=="all"?"active":""}`,onClick:()=>ve(!Ye)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:b?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>Z(!0),onTouchStart:()=>Z(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),X&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>Z(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},he.map((t,N)=>React.createElement("div",{key:N,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:O===`chat-${N}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:O===`chat-${N}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),J(`chat-${N}`),setTimeout(()=>J(null),1500)}},React.createElement("i",{className:`fas ${O===`chat-${N}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((p,T)=>React.createElement("div",{key:T,style:{width:70},className:"text-center"},p.image&&React.createElement("img",{src:p.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>He({url:p.image,name:p.name,price:p.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},p.name),p.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},p.price.replace(/[đ\s]/g,""),"\u0111"))))))),fe&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Le})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Ee(t),disabled:fe,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),Ee(z)},className:"chat-input-wrap"},React.createElement("input",{ref:u,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:z,onChange:t=>Te(t.target.value),disabled:fe}),React.createElement("button",{type:"submit",className:"send-btn",disabled:fe||!z.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),pe&&React.createElement("div",{className:"preview-modal",onClick:()=>He(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>He(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:pe.url,alt:pe.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},pe.name),pe.price&&React.createElement("div",{className:"price"},pe.price.replace(/[đ\s]/g,""),"\u0111"),pe.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},pe.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:O==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:O==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Ke(pe.url,"preview")},React.createElement("i",{className:`fas ${O==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),pe.price&&React.createElement("button",{className:O==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Ae(pe.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${O==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(mt,{show:$,product:Qe,categories:E,onClose:()=>{we(!1),xe(null)},onSave:kt}),React.createElement("div",{className:`fab-container mobile-only ${b?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{D(!1),we(!0),xe(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{D(!1),l&&l("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${b?"open":""}`,onClick:()=>D(!b)},React.createElement("i",{className:"fas fa-plus"}))),Ze&&h&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>i(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:$e.name,onChange:t=>je({...$e,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:$e.code,onChange:t=>je({...$e,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:$e.price,onChange:t=>je({...$e,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:$e.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:t=>je({...$e,commission_percent:t.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:$e.category,onChange:t=>je({...$e,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Xe.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:$e.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>je({...$e,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>i(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:at},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:d,showToast:l}){const[f,M]=useState([]),[A,m]=useState([]),[C,R]=useState(!0),[E,_]=useState(null),[B,ie]=useState(!1),[O,J]=useState(null),[ne,F]=useState(!1),[U,K]=useState(null),[se,W]=useState(null),[ge,re]=useState([]);useEffect(()=>{de()},[]);const de=async(i=null)=>{R(!0);try{const h=i?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${i}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,ye=await window.KTM.api.getJSON(h,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");M(Array.isArray(ye)?ye:[])}catch(h){console.error(h),l("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}R(!1)},oe=async i=>{try{const h=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${i}`,"L\u1ED7i t\u1EA3i video");m(Array.isArray(h)?h:[])}catch(h){console.error(h)}},k=async i=>{if(i===0)return;const h=[...f];[h[i-1],h[i]]=[h[i],h[i-1]],M(h),await G(h)},ue=async i=>{if(i===f.length-1)return;const h=[...f];[h[i],h[i+1]]=[h[i+1],h[i]],M(h),await G(h)},G=async i=>{try{await Promise.all(i.map((h,ye)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${h.id}`,{sortOrder:ye},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),l("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(h){l("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),de(se==null?void 0:se.id)}},g=async i=>{if(i===0)return;const h=[...A];[h[i-1],h[i]]=[h[i],h[i-1]],m(h),await Z(h)},X=async i=>{if(i===A.length-1)return;const h=[...A];[h[i],h[i+1]]=[h[i+1],h[i]],m(h),await Z(h)},Z=async i=>{try{await Promise.all(i.map((h,ye)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${h.id}`,{sort_order:ye},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),l("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(h){l("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),oe(E.id)}},he=()=>{J(null),ie(!0)},ce=i=>{J(i),ie(!0)},z=async i=>{try{!O&&se&&(i.parent_id=se.id);const h=O?`${API_BASE}/api/video-folders/${O.id}`:`${API_BASE}/api/video-folders`;O?await window.KTM.api.putJSON(h,i,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(h,i,"L\u1ED7i l\u01B0u folder"),l(O?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),ie(!1),de(se==null?void 0:se.id)}catch(h){l(h.message,"danger")}},Te=async i=>{const h=i.subfolderCount>0?`X\xF3a folder "${i.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${i.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(h))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${i.id}`,"L\u1ED7i x\xF3a folder"),l("\u0110\xE3 x\xF3a folder","success"),_(null),de(se==null?void 0:se.id)}catch(ye){l("L\u1ED7i x\xF3a folder","danger")}},fe=i=>{i.subfolderCount>0?(re(h=>[...h,i]),W(i),de(i.id)):(_(i),m(i.videos||[]))},be=i=>{if(i==="root")re([]),W(null),de(null);else if(i){const h=ge.findIndex(ye=>ye.id===i.id);h>=0&&(re(ge.slice(0,h+1)),W(i),de(i.id))}else{const h=[...ge];h.pop();const ye=h[h.length-1]||null;re(h),W(ye),de(ye==null?void 0:ye.id)}},Le=()=>{K(null),F(!0)},u=i=>{K(i),F(!0)},pe=async i=>{try{i.folder_id=E==null?void 0:E.id;const h=U?`${API_BASE}/api/videos/${U.id}`:`${API_BASE}/api/videos`;U?await window.KTM.api.putJSON(h,i,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(h,i,"L\u1ED7i l\u01B0u video"),l(U?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),F(!1),de(),E&&oe(E.id)}catch(h){l(h.message,"danger")}},He=async i=>{if(confirm(`X\xF3a video "${i.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${i.id}`,"L\u1ED7i x\xF3a video"),l("\u0110\xE3 x\xF3a video","success"),de(),E&&oe(E.id)}catch(h){l("L\u1ED7i x\xF3a video","danger")}},Ze=i=>{const h=`https://www.youtube.com/watch?v=${i.youtubeId}`;window.KTM.clipboard.writeText(h).then(()=>{l("\u0110\xE3 copy link!","success")}).catch(()=>{l("Kh\xF4ng th\u1EC3 copy link","danger")})};return E?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>_(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${E.slug==="shorts"?"text-danger":"text-warning"}`}),E.name)),React.createElement("button",{className:"btn btn-warning",onClick:Le},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),A.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},A.map((i,h)=>React.createElement("div",{key:i.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>g(h),disabled:h===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},h+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>X(h),disabled:h===A.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:i.thumb,className:"card-img-top",alt:i.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${i.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:i.title},i.title),React.createElement("small",{className:"text-muted"},i.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Ze(i),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>u(i),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>He(i),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:ne,video:U,onClose:()=>F(!1),onSave:pe})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},se&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>be()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),se?se.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:he},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),ge.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:i=>{i.preventDefault(),be("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ge.map((i,h)=>React.createElement("li",{key:i.id,className:`breadcrumb-item ${h===ge.length-1?"active":""}`},h===ge.length-1?i.name:React.createElement("a",{href:"#",onClick:ye=>{ye.preventDefault(),be(i)},className:"text-warning"},i.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),C?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):f.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},se?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:he},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",se?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},f.map((i,h)=>{var ye,b,D,$;return React.createElement("div",{key:i.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:we=>{we.stopPropagation(),k(h)},disabled:h===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},h+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:we=>{we.stopPropagation(),ue(h)},disabled:h===f.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>fe(i),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${i.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},i.name),React.createElement("p",{className:"text-muted mb-0"},i.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),i.subfolderCount," folder"),i.subfolderCount>0&&(i.videoCount>0||((ye=i.videos)==null?void 0:ye.length)>0)&&" \u2022 ",(i.videoCount>0||((b=i.videos)==null?void 0:b.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),i.videoCount||((D=i.videos)==null?void 0:D.length)||0," videos"),i.subfolderCount===0&&!i.videoCount&&!(($=i.videos)!=null&&$.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:we=>{we.stopPropagation(),ce(i)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:we=>{we.stopPropagation(),Te(i)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:B,folder:O,onClose:()=>ie(!1),onSave:z}))}function VideoFolderModal({show:d,folder:l,onClose:f,onSave:M}){const[A,m]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[C,R]=useState(!1),[E,_]=useState(!1);useEffect(()=>{m(l?{name:l.name||"",description:l.description||"",sortOrder:l.sortOrder||0,coverImage:l.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[l,d]);const B=async O=>{const J=O.target.files[0];if(J){_(!0);try{const ne=await window.KTM.cloudinary.uploadImage({file:J,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});ne.secure_url&&m(F=>({...F,coverImage:ne.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(ne){console.error("Cloudinary upload error:",ne),alert("L\u1ED7i upload \u1EA3nh: "+(ne.message||ne))}finally{_(!1)}}},ie=async O=>{O.preventDefault(),R(!0),await M(A),R(!1)};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},l?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:f})),React.createElement("form",{onSubmit:ie},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:A.name,onChange:O=>m({...A,name:O.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:A.description,onChange:O=>m({...A,description:O.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:A.sortOrder,onChange:O=>m({...A,sortOrder:parseInt(O.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},A.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:A.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>m({...A,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:B,disabled:E}),E&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:A.coverImage,onChange:O=>m({...A,coverImage:O.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:f},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:C},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:d,settings:l}){const[f,M]=useState([]),[A,m]=useState(!0),[C,R]=useState(!1),[E,_]=useState(null),[B,ie]=useState(""),[O,J]=useState(""),ne=normalizeShipPercent(l==null?void 0:l.ship_percent),{parseMoney:F,formatVND:U}=window.KTM.money,K=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{se()},[]);const se=async()=>{m(!0);try{const g=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");M(Array.isArray(g)?g:[])}catch(g){console.error(g),d("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}m(!1)},W=()=>{_(null),R(!0)},ge=g=>{_(g),R(!0)},re=async g=>{if(!(!g||!g.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:g},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),d(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),se()}catch(X){d("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},de=async g=>{try{const X=E?`${API_BASE}/api/products?id=${E.id}`:`${API_BASE}/api/products`;E?await window.KTM.api.putJSON(X,g,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(X,g,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),d(E?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),R(!1),se()}catch(X){d(X.message,"danger")}},oe=async g=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${g.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${g.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),d("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),se()}catch(X){d(X.message,"danger")}},k=f.filter(g=>{const X=!B||g.name.toLowerCase().includes(B.toLowerCase())||g.code&&g.code.toLowerCase().includes(B.toLowerCase()),Z=!O||g.category===O;return X&&Z}),ue=g=>{var he;const X=(he=g==null?void 0:g.commission_percent)!=null?he:g==null?void 0:g.commissionPercent,Z=X===""||X==null?NaN:Number(X);return Number.isFinite(Z)?Math.max(0,Math.min(100,Z)):5},G=g=>{const X=ue(g),Z=Number.isInteger(X)?String(X):String(Math.round(X*100)/100),he=F(g==null?void 0:g.price);if(!Number.isFinite(he)||he<=0)return`${Z}%`;const ce=(Number(X)||0)/100,Te=window.KTM.money.parseShipFeeFromNote(g==null?void 0:g.note)!=null?0:ne>0?he*ne/100:0,fe=he*ce-Te*ce,be=Math.max(0,Math.round(fe));return`${Z}% - ${U(be)}`};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:W},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:B,onChange:g=>ie(g.target.value)})),React.createElement("span",{className:"product-count"},k.length)),React.createElement("select",{className:"form-select",value:O,onChange:g=>J(g.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),K.map(g=>React.createElement("option",{key:g,value:g},g)))),A?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):k.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:W},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},k.map(g=>React.createElement("div",{key:g.id,className:"product-item d-flex align-items-center gap-3"},g.image?React.createElement("img",{src:g.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},g.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},g.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},g.category),g.code&&React.createElement("span",{className:"product-badge bg-secondary"},g.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),G(g))),React.createElement("div",{className:"product-price"},g.price?g.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),g.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},g.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>ge(g),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>oe(g),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:C,product:E,categories:K,onClose:()=>R(!1),onSave:de}))}function ProductModal({show:d,product:l,categories:f,onClose:M,onSave:A}){const[m,C]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[R,E]=useState(!1),[_,B]=useState(!1);useEffect(()=>{var k,ue;C(l?{name:l.name||"",code:l.code||"",price:l.price||"",image:l.image||"",category:l.category||"",note:l.note||"",sort_order:l.sort_order||0,commission_percent:(ue=(k=l.commission_percent)!=null?k:l.commissionPercent)!=null?ue:5}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5})},[l,d]);const[ie,O]=React.useState(""),J=k=>window.KTM.money.formatVNDInputDigits(k),[ne,F]=React.useState(""),U=k=>{const ue=window.KTM.money.nextPriceInputState(k.target.value,ne);F(ue.digits),C({...m,price:ue.price})},[K,se]=React.useState("");React.useEffect(()=>{l!=null&&l.image&&se(l.image)},[l]);const W=async k=>{if(!(!k||!k.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:k},"L\u1ED7i x\xF3a \u1EA3nh")}catch(ue){console.error("Delete cloudinary image error:",ue)}},ge=async(k,ue=2,G)=>{const g=ue*1024*1024,X=k.type==="image/heic"||k.type==="image/heif"||/\.heic$/i.test(k.name);if(k.size<=g&&!X)return k;G==null||G("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const Z=await createImageBitmap(k);G==null||G("\u0110ang n\xE9n \u1EA3nh...");const he=document.createElement("canvas");let ce=Z.width,z=Z.height;const Te=1200;return(ce>Te||z>Te)&&(ce>z?(z=Math.round(z/ce*Te),ce=Te):(ce=Math.round(ce/z*Te),z=Te)),he.width=ce,he.height=z,he.getContext("2d").drawImage(Z,0,0,ce,z),Z.close(),new Promise((be,Le)=>{he.toBlob(u=>{u?(G==null||G("Ho\xE0n t\u1EA5t!"),be(new File([u],k.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):Le(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Z){throw console.error("createImageBitmap error:",Z),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},re=async k=>{var g,X;const ue=(g=k.target.files)==null?void 0:g[0];if(!ue)return;if(!(ue.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ue.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}B(!0),O("\u0110ang chu\u1EA9n b\u1ECB...");try{const Z=(ue.size/1024/1024).toFixed(1);O(`File ${Z}MB - \u0110ang n\xE9n...`);const he=await ge(ue,2,Te=>{O(Te)}),ce=(he.size/1024/1024).toFixed(1);O(`\u0110\xE3 n\xE9n: ${ce}MB - \u0110ang upload...`);const z=await window.KTM.cloudinary.uploadImage({file:he,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});z.secure_url?(m.image&&m.image!==K&&W(m.image),C(Te=>({...Te,image:z.secure_url})),O("")):(console.error("Cloudinary error:",z),alert("Upload th\u1EA5t b\u1EA1i: "+(((X=z.error)==null?void 0:X.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),O(""))}catch(Z){console.error("Upload error:",Z),alert("L\u1ED7i: "+Z.message),O("")}B(!1),k.target.value=""},de=()=>{m.image&&(m.image!==K&&W(m.image),C(k=>({...k,image:""})))},oe=async k=>{k.preventDefault(),E(!0),K&&m.image&&K!==m.image&&await W(K),K&&!m.image&&await W(K),await A(m),E(!1)};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${l?"fa-edit":"fa-plus-circle"} me-2`}),l?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:M})),React.createElement("form",{onSubmit:oe},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},m.image?React.createElement(React.Fragment,null,React.createElement("img",{src:m.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:de,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${_?"fa-spinner fa-spin":"fa-camera"} me-1`}),_?ie||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:re,disabled:_,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),_&&ie&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},ie))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:m.name,onChange:k=>C({...m,name:k.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:m.code,onChange:k=>C({...m,code:k.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:m.price,onChange:U,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:m.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:k=>C({...m,commission_percent:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:m.category,onChange:k=>C({...m,category:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),f.map(k=>React.createElement("option",{key:k,value:k},k)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:m.note,onChange:k=>C({...m,note:k.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:m.image,onChange:k=>C({...m,image:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:M,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:R,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},R?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:d,video:l,onClose:f,onSave:M}){const[A,m]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[C,R]=useState(!1),[E,_]=useState("");useEffect(()=>{l?(m({title:l.title||"",youtube_url:`https://www.youtube.com/watch?v=${l.youtubeId}`,thumbnail_url:l.thumb||"",sort_order:l.sortOrder||0}),_(l.thumb)):(m({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),_(""))},[l,d]);const B=J=>{const ne=J.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return ne?ne[1]:null},ie=J=>{m({...A,youtube_url:J});const ne=B(J);ne&&_(`https://img.youtube.com/vi/${ne}/hqdefault.jpg`)},O=async J=>{J.preventDefault(),R(!0),await M(A),R(!1)};return d?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},l?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:f})),React.createElement("form",{onSubmit:O},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:A.youtube_url,onChange:J=>ie(J.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),E&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:E,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:A.title,onChange:J=>m({...A,title:J.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:A.sort_order,onChange:J=>m({...A,sort_order:parseInt(J.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:A.thumbnail_url,onChange:J=>m({...A,thumbnail_url:J.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:f},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:C},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[d,l]=useState(!1),[f,M]=useState(""),[A,m]=useState(null),[C,R]=useState("search"),[E,_]=useState(null),[B,ie]=useState(""),[O,J]=useState([]),[ne,F]=useState(null),[U,K]=useState(!1),[se,W]=useState(null),[ge,re]=useState(!0),[de,oe]=useState([]),[k,ue]=useState(()=>loadAdminSettings()),[G,g]=useState(null),[X,Z]=useState([]);useEffect(()=>{const b=localStorage.getItem("ktm_admin_session");if(b)try{const D=JSON.parse(b);D.expiry>Date.now()?(l(!0),m(D.user)):localStorage.removeItem("ktm_admin_session")}catch(D){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{d&&fe()},[d]),useEffect(()=>{if(!d)return;let b=!1;return(async()=>{try{const D=await fetchAdminSettingsFromServer();if(b)return;ue(D),saveAdminSettings(D)}catch(D){}})(),()=>{b=!0}},[d]);const he=async(b,D)=>{M("");try{const $=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:b,password:D},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),we={user:$.user,token:$.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(we)),m($.user),l(!0)}catch($){M($.message)}},ce=()=>{localStorage.removeItem("ktm_admin_session"),l(!1),m(null),J([]),F(null)},z=(b,D="success")=>{const $=Date.now();oe(we=>[...we,{id:$,message:b,type:D}])},Te=b=>{oe(D=>D.filter($=>$.id!==b))},fe=async(b=null)=>{re(!0);try{const D=b?`${API_BASE}/api/albums?parent_id=${b}`:`${API_BASE}/api/albums?parent_id=root`,$=await window.KTM.api.getJSON(D,"L\u1ED7i t\u1EA3i danh s\xE1ch album");J(Array.isArray($)?$:[])}catch(D){console.error(D),z("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}re(!1)},be=()=>{W(null),K(!0)},Le=b=>{W(b),K(!0)},u=async b=>{try{const D=se&&se.uuid;!D&&G&&(b.parent_id=G.uuid);const $=D?`${API_BASE}/api/albums/${se.uuid||se.id}`:`${API_BASE}/api/albums`;D?await window.KTM.api.putJSON($,b,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON($,b,"L\u1ED7i t\u1EA1o"),z(D?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),K(!1),fe(G==null?void 0:G.uuid)}catch(D){z(D.message,"danger")}},pe=b=>{F(b)},He=b=>{if(b==="root")Z([]),g(null),fe(null);else if(b){const D=X.findIndex($=>$.uuid===b.uuid);D>=0&&(Z(X.slice(0,D+1)),g(b),fe(b.uuid))}else{const D=[...X];D.pop();const $=D[D.length-1]||null;Z(D),g($),fe($==null?void 0:$.uuid)}},Ze=async b=>{const D=`X\xF3a folder "${b.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(D))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${b.uuid||b.id}`,"L\u1ED7i x\xF3a album"),z("\u0110\xE3 x\xF3a","success"),fe(G==null?void 0:G.uuid)}catch($){z("L\u1ED7i x\xF3a album","danger")}};if(!d)return React.createElement(LoginPage,{onLogin:he,error:f});const i=()=>{const b=new Date,D=b.getFullYear(),$=String(b.getMonth()+1).padStart(2,"0");return`${D}-${$}`};function h(){const[b,D]=useState(()=>{var xe;return String((xe=k==null?void 0:k.ship_percent)!=null?xe:DEFAULT_SHIP_PERCENT)}),[$,we]=useState(!1);return useEffect(()=>{var xe;D(String((xe=k==null?void 0:k.ship_percent)!=null?xe:DEFAULT_SHIP_PERCENT))},[k==null?void 0:k.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async xe=>{xe.preventDefault(),we(!0);const $e=saveAdminSettings({ship_percent:b});try{const je=await saveAdminSettingsToServer($e);ue(je),saveAdminSettings(je),z("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(je){ue($e),z("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{we(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:b,min:"0",max:"100",step:"0.01",onChange:xe=>D(xe.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:$},$?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function ye(){const[b,D]=useState(i()),[$,we]=useState(!0),[Qe,xe]=useState([]),[$e,je]=useState([]),Xe=useRef(!1),ht=useRef(new Map),at=normalizeShipPercent(k==null?void 0:k.ship_percent),{parseMoney:Ct,parseShipFeeFromNote:kt,getShipFeeForItems:vt,formatNumber:te,formatVND:Re}=window.KTM.money,Ue=async()=>{if(!Xe.current)try{const r=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m");je(Array.isArray(r)?r:[]),Xe.current=!0}catch(r){console.error("Load products for stats error:",r),je([]),Xe.current=!0}},dt=async r=>{var Pe,Ee;const Ce=String(r||"").trim();if(!Ce)return[];const ke=(Pe=ht.current)==null?void 0:Pe.get(Ce);if(ke&&Array.isArray(ke))return ke;const Ae=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(Ce)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Ke=Array.isArray(Ae)?Ae:[];return(Ee=ht.current)==null||Ee.set(Ce,Ke),Ke},o=async()=>{we(!0);try{await Ue();const r=await dt(b);xe(Array.isArray(r)?r:[])}catch(r){console.error("Load stats error:",r),xe([])}finally{we(!1)}};useEffect(()=>{o()},[b]);const v=React.useMemo(()=>{var Je;const r={draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};let Ce=0,ke=0,Ae=0,Ke=0,Pe=0,Ee=0,mt=0,bt=0;const Ye=q=>q.customer_id||q.phone||"unknown",ve=q=>window.KTM.orders.getOrderItems(q),t=new Map,N=new Map,p=new Map,T=5,I=new Map((Array.isArray($e)?$e:[]).map(q=>{var st;const le=(st=q==null?void 0:q.commission_percent)!=null?st:q==null?void 0:q.commissionPercent,Be=Number(le),et=Number.isFinite(Be)?Math.max(0,Math.min(100,Be)):T;return[String(q==null?void 0:q.id),et]})),w=q=>{const le=String(q!=null?q:"").trim().toLowerCase();return le==="cancelled"?"canceled":le};for(const q of Qe){const le=w(q==null?void 0:q.status),st=le==="canceled"||le==="draft",gt=ve(q);let Y=0,Se=0,tt=0;for(const _e of gt){const Fe=Number((_e==null?void 0:_e.quantity)||0)||0,lt=Ct(_e==null?void 0:_e.product_price),rt=Fe*lt,nt=String((_e==null?void 0:_e.product_id)||""),Lt=I.has(nt)?I.get(nt):T,Tt=(Number(Lt)||0)/100;if(Y+=Fe,Se+=rt,tt+=rt*Tt,!st){const _t=(_e==null?void 0:_e.product_id)||"unknown",Nt=t.get(nt)||{product_id:_t,product_name:(_e==null?void 0:_e.product_name)||"\u2014",product_code:(_e==null?void 0:_e.product_code)||"",orders:0,quantity:0,revenue:0};Nt.orders+=1,Nt.quantity+=Fe,Nt.revenue+=rt,t.set(_t,Nt)}}const qe=vt(gt),ze=Number((Je=q==null?void 0:q.adjustment_amount)!=null?Je:0)||0,Ie=Se+(qe.found?qe.fee:0)+ze,We=Se+ze,ut=!qe.found&&at>0&&Se>0?Se*at/100:0,Mt=Se>0?tt/Se:T/100,ot=tt+ze*Mt-ut*Mt,St=le==="done"||le==="paid";if(le==="draft"?r.draft+=1:le==="pending"?r.pending+=1:le==="processing"?r.processing+=1:le==="canceled"?r.canceled+=1:le==="paid"?(r.paid+=1,r.done+=1,Ke+=Ie,Ee+=We,bt+=ot):le==="done"?(r.done+=1,Ke+=Ie,Ee+=We,bt+=ot):r.other+=1,!st){Ce+=1,ke+=Y,Ae+=Ie,Pe+=We,mt+=ot;const _e=Ye(q),Fe=N.get(_e)||{key:_e,customer_name:q.customer_name||"",phone:q.phone||"",orders:0,quantity:0,revenue:0};Fe.orders+=1,Fe.quantity+=Y,Fe.revenue+=Ie,!Fe.customer_name&&q.customer_name&&(Fe.customer_name=q.customer_name),!Fe.phone&&q.phone&&(Fe.phone=q.phone),N.set(_e,Fe);const lt=q.created_at?new Date(q.created_at):null;if(lt&&!Number.isNaN(lt.getTime())){const rt=`${lt.getFullYear()}-${String(lt.getMonth()+1).padStart(2,"0")}-${String(lt.getDate()).padStart(2,"0")}`,nt=p.get(rt)||{day:rt,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};nt.orders+=1,nt.quantity+=Y,nt.revenue+=Ie,St&&(nt.doneOrders+=1,nt.doneRevenue+=Ie),p.set(rt,nt)}}}const y=Array.from(t.values()).sort((q,le)=>le.revenue-q.revenue),L=Array.from(N.values()).sort((q,le)=>le.revenue-q.revenue),V=Array.from(p.values()).sort((q,le)=>q.day.localeCompare(le.day)),me=N.size,Q=Ce?Math.round(Ae/Ce):0,ee=Ce?ke/Ce:0,De=Math.round(bt),Oe=Math.round(mt);return{statusCounts:r,activeOrders:Ce,totalQty:ke,totalRevenue:Ae,doneRevenue:Ke,tempCommission:De,tempCommissionAll:Oe,products:y,customers:L,days:V,uniqueCustomers:me,avgOrderValue:Q,avgQtyPerOrder:ee}},[Qe,$e,b]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:$}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:o,disabled:$},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:b,onChange:r=>D(r.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",at,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),te(v.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),te(v.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),te(v.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",te(v.statusCounts.paid),"/",te(v.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},te(v.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Re(v.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Re(v.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Re(v.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Re(v.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",v.avgQtyPerOrder?v.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},te(v.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},te(v.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},te(v.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},te(v.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},te(v.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},te(v.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},te(v.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,te(v.statusCounts.draft)),React.createElement("td",null,te(v.statusCounts.pending)),React.createElement("td",null,te(v.statusCounts.processing)),React.createElement("td",null,te(v.statusCounts.canceled)),React.createElement("td",null,te(v.statusCounts.done)),React.createElement("td",null,te(v.statusCounts.paid)),React.createElement("td",null,te(v.statusCounts.other)),React.createElement("td",null,te(v.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},v.products.slice(0,10).map(r=>React.createElement("div",{key:r.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},r.product_name),React.createElement("div",{className:"text-muted small text-truncate"},r.product_code?`#${r.product_code} \u2022 `:"",te(r.orders)," \u0111\u01A1n \u2022 ",te(r.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Re(r.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,v.products.slice(0,10).map(r=>React.createElement("tr",{key:r.product_id},React.createElement("td",null,r.product_name),React.createElement("td",null,r.product_code||"\u2014"),React.createElement("td",null,te(r.orders)),React.createElement("td",null,te(r.quantity)),React.createElement("td",{className:"fw-semibold"},Re(r.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},v.customers.slice(0,10).map(r=>React.createElement("div",{key:r.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},r.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},r.phone||"\u2014"," \u2022 ",te(r.orders)," \u0111\u01A1n \u2022 ",te(r.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Re(r.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,v.customers.slice(0,10).map(r=>React.createElement("tr",{key:r.key},React.createElement("td",null,r.customer_name||"\u2014"),React.createElement("td",null,r.phone||"\u2014"),React.createElement("td",null,te(r.orders)),React.createElement("td",null,te(r.quantity)),React.createElement("td",{className:"fw-semibold"},Re(r.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},v.days.map(r=>React.createElement("div",{key:r.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},r.day),React.createElement("div",{className:"text-muted small"},te(r.orders)," \u0111\u01A1n \u2022 ",te(r.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",te(r.doneOrders)," \u2022 ",Re(r.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Re(r.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,v.days.map(r=>React.createElement("tr",{key:r.day},React.createElement("td",null,r.day),React.createElement("td",null,te(r.orders)),React.createElement("td",null,te(r.quantity)),React.createElement("td",{className:"fw-semibold"},Re(r.revenue)),React.createElement("td",null,te(r.doneOrders)),React.createElement("td",{className:"fw-semibold"},Re(r.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:C,onMenuChange:b=>{R(b),b==="albums"&&(g(null),Z([]),fe(null))},onLogout:ce,currentUser:A}),React.createElement("div",{className:"main-content"},C==="albums"&&!ne&&React.createElement(AlbumList,{albums:O,loading:ge,currentFolder:G,breadcrumb:X,onSelect:pe,onCreate:be,onEdit:Le,onDelete:Ze,onBack:He}),C==="search"&&React.createElement(SearchCenter,{showToast:z,onNavigate:(b,D,$)=>{R(b),b==="orders"&&D==="create"&&(_(Date.now()),ie(($==null?void 0:$.productId)||""))}}),C==="albums"&&ne&&React.createElement(AlbumDetail,{album:ne,parentAlbum:X.length>0?X[X.length-1]:null,onBack:()=>{if(ne.parentId){const b=X.findIndex(D=>D.uuid===ne.parentId);b>=0?F(X[b]):F(null)}else F(null)},onRefresh:()=>fe(G==null?void 0:G.uuid),showToast:z,onNavigateToFolder:b=>{Z(D=>[...D,ne]),F(b)},onEditSubfolder:b=>{W(b),K(!0)}}),C==="videos"&&React.createElement(VideoList,{showToast:z}),C==="products"&&React.createElement(ProductManager,{showToast:z,settings:k}),C==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:E,autoOpenCreateProductId:B,showToast:z}),C==="stats"&&React.createElement(ye,null),C==="settings"&&React.createElement(h,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${C==="search"?"active":""}`,onClick:b=>{b.preventDefault(),R("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${C==="albums"?"active":""}`,onClick:b=>{b.preventDefault(),R("albums"),F(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${C==="videos"?"active":""}`,onClick:b=>{b.preventDefault(),R("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${C==="products"?"active":""}`,onClick:b=>{b.preventDefault(),R("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${C==="orders"?"active":""}`,onClick:b=>{b.preventDefault(),R("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${C==="stats"?"active":""}`,onClick:b=>{b.preventDefault(),R("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:U,album:se,parentId:G==null?void 0:G.uuid,onClose:()=>K(!1),onSave:u}),React.createElement("div",{className:"toast-container"},de.map(b=>React.createElement(Toast,{key:b.id,message:b.message,type:b.type,onClose:()=>Te(b.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:d,autoOpenCreateProductId:l,showToast:f}){const[M,A]=useState([]),[m,C]=useState([]),[R,E]=useState(!0),[_,B]=useState(!1),[ie,O]=useState([]),[J,ne]=useState(!1),[F,U]=useState(!1),[K,se]=useState(null),[W,ge]=useState(null),[re,de]=useState(!1),[oe,k]=useState(()=>{const e=new Date,s=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${s}-${a}`}),[ue,G]=useState(""),[g,X]=useState(!1),[Z,he]=useState(!1),[ce,z]=useState(null),[Te,fe]=useState(!1),[be,Le]=useState([]),[u,pe]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[He,Ze]=useState([""]),[i,h]=useState(null),ye=useRef({}),[b,D]=useState([]),[$,we]=useState(null),Qe=useRef(null),xe=useRef(null),$e=useRef(0),je=useRef(new Map),Xe=useRef(""),ht=useRef(null),at=useRef(0),Ct=useRef(null),kt=9,vt=150,te=24*60*60*1e3,Re=5*60*1e3,Ue="ktm_customer_lookup_cache_v1",dt=200,o=3,v=7,r=3,Ce=24*60*60*1e3,ke=e=>{try{const s=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(s))return 0;const a=Date.now()-s;return!Number.isFinite(a)||a<=0?0:Math.floor(a/Ce)}catch(s){return 0}},Ae=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:ke(e)>=o,Ke=e=>{const s=String(e!=null?e:"").trim().toLowerCase();return s==="cancelled"?"canceled":s},Pe=e=>{if(Ke(e==null?void 0:e.status)!=="draft")return null;const a=v-ke(e);return Number.isFinite(a)?a:null},Ee=e=>{const s=Pe(e);return Number.isFinite(s)?s>0&&s<=r:!1},mt=e=>{pe({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Ze([""]),z(null),h(null)};useEffect(()=>{const e=s=>{var n;if(i==null)return;const a=(n=ye.current)==null?void 0:n[i];a&&!a.contains(s.target)&&h(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[i]);const bt=e=>window.KTM.money.parseMoney(e),Ye=e=>window.KTM.money.parseSignedMoney(e),ve=e=>window.KTM.money.formatVND(e),t=e=>window.KTM.money.parseShipFeeFromNote(e),N=e=>window.KTM.phone.isValid(e),p=e=>window.KTM.phone.normalize(e),T=()=>{var e;try{const s=localStorage.getItem(Ue);if(!s)return;const a=JSON.parse(s);if(!a||typeof a!="object")return;const n=Object.entries(a);for(const[c,S]of n)!c||!S||typeof S!="object"||(e=je.current)==null||e.set(String(c),S)}catch(s){}},I=()=>{try{const e=je.current;if(!e||typeof e.entries!="function")return;const s=Array.from(e.entries()).filter(([n,c])=>n&&c&&typeof c=="object"&&Number.isFinite(c.ts)).sort((n,c)=>(Number(c[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,dt),a={};for(const[n,c]of s)a[n]=c;localStorage.setItem(Ue,JSON.stringify(a))}catch(e){}};useEffect(()=>{T()},[]);const w=e=>{const s=p(e);if(!s)return null;const a=Array.isArray(M)?M:[];let n=null,c=-1;for(const S of a){if(!S||p(S.phone||"")!==s)continue;const ae=new Date(S.created_at).getTime(),H=Number.isFinite(ae)?ae:0;H>=c&&(c=H,n=S)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},y=(e,s)=>{e&&pe(a=>s&&p(a.phone)!==s?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},L=e=>{const s=w(e);if(!s)return;const a=p(e);pe(n=>{if(a&&p(n.phone)!==a)return n;const c={...n};return!String(n.customer_name||"").trim()&&s.name&&(c.customer_name=s.name),!String(n.address||"").trim()&&s.address&&(c.address=s.address),c})},V=async e=>{var c,S,ae;const s=p(e);if(!s)return;L(s);const a=(c=je.current)==null?void 0:c.get(s);if(a&&Number.isFinite(a.ts)){const H=Date.now()-a.ts,x=a.status==="found"?te:Re;if(H>=0&&H<=x){z({status:a.status,phone:s,customer:a.customer}),a.status==="found"&&a.customer&&y(a.customer,s);return}}const n=++$e.current;z({status:"loading",phone:s});try{const H=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(s)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if($e.current!==n)return;if(H&&H.exists&&H.customer){(S=je.current)==null||S.set(s,{ts:Date.now(),status:"found",customer:H.customer}),I(),z({status:"found",phone:s,customer:H.customer}),y(H.customer,s);return}(ae=je.current)==null||ae.set(s,{ts:Date.now(),status:"not-found",customer:null}),I(),z({status:"not-found",phone:s})}catch(H){if($e.current!==n)return;console.error("Customer lookup error:",H),z({status:"error",phone:s})}},me=e=>{const s=p(e),a=w(s);pe(c=>{const S={...c,phone:s};return a&&(!String(c.customer_name||"").trim()&&a.name&&(S.customer_name=a.name),!String(c.address||"").trim()&&a.address&&(S.address=a.address)),S}),fe(!1),xe.current&&(clearTimeout(xe.current),xe.current=null);const n=s;if(n.length<kt){z(null);return}if(N(n)&&n!==Xe.current){Xe.current=n,V(n);return}xe.current=setTimeout(()=>{const c=p(s);N(c)&&c!==Xe.current&&(Xe.current=c,V(c))},vt)},Q=()=>{const e=p(u.phone);e.length<kt||N(e)&&e!==Xe.current&&(Xe.current=e,V(e))};useEffect(()=>(Z?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Z]);const ee=Array.isArray(u.items)?u.items.length:0;useEffect(()=>{if(!Z){at.current=ee;return}ee>at.current&&setTimeout(()=>{const e=ht.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),at.current=ee},[Z,ee]),useEffect(()=>()=>{xe.current&&(clearTimeout(xe.current),xe.current=null)},[]),useEffect(()=>{Y()},[]),useEffect(()=>{Se()},[oe]),useEffect(()=>{tt()},[]),useEffect(()=>{d&&Qe.current!==d&&(Qe.current=d,ze(l))},[d]);const De=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",Oe=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",Je=React.useMemo(()=>window.KTM.orders.sortOrders(M),[M]),q=React.useMemo(()=>window.KTM.orders.sortOrders(m),[m]),le=React.useMemo(()=>{const s=(Array.isArray(q)?q:[]).filter(a=>Ae(a));return s.sort((a,n)=>{const c=new Date(a==null?void 0:a.created_at).getTime(),S=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(c)?c:0)-(Number.isFinite(S)?S:0)}),s},[q]),Be=React.useMemo(()=>{const s=(Array.isArray(ie)?ie:[]).filter(a=>Ee(a));return s.sort((a,n)=>{const c=new Date(a==null?void 0:a.created_at).getTime(),S=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(c)?c:0)-(Number.isFinite(S)?S:0)}),s},[ie]),et=React.useMemo(()=>g?le:Je,[g,le,Je]),st=React.useMemo(()=>{if(g)return et;const e=String(ue||"").trim();return e?(Array.isArray(et)?et:[]).filter(s=>String((s==null?void 0:s.status)||"").trim()===e):et},[et,ue,g]),gt=e=>window.KTM.date.formatDateTime(e),Y=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");D(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),D([])}},Se=async()=>{E(!0);try{let e=`${API_BASE}/api/orders`;oe&&(e+=`?month=${oe}`);const s=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");A(Array.isArray(s)?s:[]),tt()}catch(e){console.error("Load orders error:",e),A([])}finally{E(!1)}},tt=async()=>{B(!0),ne(!0);try{const[e,s]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(o)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(r)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);C(Array.isArray(e)?e:[]),O(Array.isArray(s)?s:[])}catch(e){console.error("Load all orders error:",e),C([]),O([])}finally{B(!1),ne(!1)}},qe=e=>{var a;we(e.id);const s=Array.isArray(e.items)&&e.items.length?e.items.map(n=>{var c;return{product_id:(n==null?void 0:n.product_id)||"",quantity:Number((c=n==null?void 0:n.quantity)!=null?c:1)||1}}).filter(n=>n.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];pe({customer_name:e.customer_name||"",phone:p(e.phone||""),address:e.address||"",note:(e==null?void 0:e.note)||"",items:s.length?s:[{product_id:"",quantity:1}],adjustment_amount:Number((a=e==null?void 0:e.adjustment_amount)!=null?a:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),Ze(new Array(s.length?s.length:1).fill("")),Le(new Array(s.length?s.length:1).fill(!0)),z(null),he(!0),e.phone&&V(p(e.phone))};function ze(e){we(null),mt(e||""),fe(!1),Le([]),he(!0)}const Ie=()=>{F||re||(he(!1),we(null),mt(""),fe(!1),Le([]))},We=async()=>{var H,x,j;if(!$||re||F)return;const e=(Array.isArray(M)?M:[]).find(P=>String(P==null?void 0:P.id)===String($))||null,s=String((e==null?void 0:e.status)||(u==null?void 0:u.status)||"").trim();if(s==="done"||s==="paid"||s==="canceled"){const P="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof f=="function"?f(P,"warning"):alert(P);return}const a=p(u.phone),c=(Array.isArray(u.items)?u.items:[]).map((P,Me)=>{var Ne;return{idx:Me,product_id:String((P==null?void 0:P.product_id)||"").trim(),quantity:Number((Ne=P==null?void 0:P.quantity)!=null?Ne:0)}}).filter(P=>P.product_id&&Number.isFinite(P.quantity)&&P.quantity>0);if(c.length<2){const P="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof f=="function"?f(P,"warning"):alert(P);return}const S=[],ae=[];for(const P of c){const Me=!!be[P.idx],Ne={product_id:P.product_id,quantity:P.quantity};Me?S.push(Ne):ae.push(Ne)}if(!S.length||!ae.length){const P="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof f=="function"?f(P,"warning"):alert(P);return}de(!0);try{const P=Ye(u.adjustment_amount),Me=(u.adjustment_note||"").trim(),Ne={customer_name:u.customer_name,phone:a,address:u.address,note:(u.note||"").trim(),adjustment_amount:P,adjustment_note:Me,status:"processing",items:S,product_id:S[0].product_id,quantity:S[0].quantity,split_seq:1},it=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,Ne,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),ct=(j=(x=it==null?void 0:it.id)!=null?x:(H=it==null?void 0:it.order)==null?void 0:H.id)!=null?j:null;if(!ct)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const At={id:$,customer_name:u.customer_name,phone:a,address:u.address,note:(u.note||"").trim(),adjustment_amount:0,adjustment_note:"",status:"pending",items:ae,product_id:ae[0].product_id,quantity:ae[0].quantity,parent_order_id:String(ct),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${$}`,At,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Ie(),Se();const wt=ct?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${ct}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof f=="function"?f(wt,"success"):alert(wt)}catch(P){console.error(P);const Me=(P==null?void 0:P.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof f=="function"?f(Me,"danger"):alert(Me)}finally{de(!1)}},ut=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const s=String(e),a=b.find(n=>String(n==null?void 0:n.id)===s);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Mt=e=>{const s=String(He[e]||"").trim().toLowerCase();return s?b.filter(a=>{const n=String((a==null?void 0:a.name)||"").toLowerCase(),c=String((a==null?void 0:a.code)||"").toLowerCase();return n.includes(s)||c.includes(s)}):b},ot=e=>{if(!e)return null;const s=String(e);return b.find(a=>String(a==null?void 0:a.id)===s)||null},St=e=>window.KTM.orders.getOrderItems(e),_e=e=>window.KTM.orders.getOrderTotalQty(e),Fe=e=>window.KTM.orders.getOrderProductSummary(e,ot),lt=e=>window.KTM.orders.getOrderItemRows(e,ot),rt=e=>window.KTM.orders.getOrderAdjustmentMoney(e),nt=e=>{var j;const s=St(e),a=lt(e),n=_t(s),c=Tt(s),S=c.fee,ae=rt(e),H=n+S+ae,x=[];if(x.push(`\u0110\u01A0N H\xC0NG #${(j=e==null?void 0:e.id)!=null?j:""}`.trim()),e!=null&&e.customer_name&&x.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&x.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&x.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&x.push(`Ghi ch\xFA: ${(e.note||"").trim()}`),e!=null&&e.status&&x.push(`Tr\u1EA1ng th\xE1i: ${De(e.status)}`),e!=null&&e.created_at&&x.push(`Th\u1EDDi gian: ${gt(e.created_at)}`),x.push(""),x.push("S\u1EA3n ph\u1EA9m:"),a.length)for(const P of a)x.push(`- ${P.name} x${P.qty}`);else{const P=Fe(e);P&&P!=="\u2014"&&x.push(`- ${P}`)}return x.push(""),x.push(`T\u1EA1m t\xEDnh: ${ve(n)}`),x.push(`Ship: ${ve(c.found?S:0)}`),ae!==0&&x.push(`\u0110i\u1EC1u ch\u1EC9nh: ${ve(ae)}`),e!=null&&e.adjustment_note&&x.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),x.push(`T\u1ED5ng: ${ve(H)}`),x.filter(Boolean).join(`
`)},Lt=async e=>{try{const s=nt(e);await window.KTM.clipboard.writeText(s),typeof f=="function"?f("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(s){console.error(s),typeof f=="function"?f("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Tt=e=>window.KTM.orders.getOrderShipInfo(e,ot),_t=e=>window.KTM.orders.getItemsSubtotal(e,ot),Nt=e=>{try{const s=e instanceof Date?e:new Date(e);if(!s||Number.isNaN(s.getTime()))return"";const a=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0");return`${a}-${n}`}catch(s){return""}},Dt=()=>oe?String(oe):Nt(new Date),Rt=e=>{const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=p((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),c=Ye(e==null?void 0:e.adjustment_amount),ae=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(H=>{var x;return{product_id:String((H==null?void 0:H.product_id)||"").trim(),quantity:Number((x=H==null?void 0:H.quantity)!=null?x:0)}}).filter(H=>H.product_id&&Number.isFinite(H.quantity)&&H.quantity>0).sort((H,x)=>H.product_id<x.product_id?-1:H.product_id>x.product_id?1:H.quantity-x.quantity);return JSON.stringify({name:s,phone:a,address:n,items:ae,adj:c})},ft=React.useMemo(()=>{const e=p((u==null?void 0:u.phone)||"");if(!e)return{count:0,orders:[],monthKey:Dt()};const s=Dt(),a=(Array.isArray(M)?M:[]).filter(n=>{if(!n||$&&String(n.id)===String($)||p(n.phone||"")!==e)return!1;const c=Nt(n.created_at);return c&&c===s}).sort((n,c)=>{const S=new Date(n.created_at).getTime(),ae=new Date(c.created_at).getTime();return(Number.isFinite(ae)?ae:0)-(Number.isFinite(S)?S:0)});return{count:a.length,orders:a,monthKey:s}},[M,u==null?void 0:u.phone,oe,$]),Vt=e=>{var H;const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=p((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),c=Ye((H=e==null?void 0:e.adjustment_amount)!=null?H:0),S=St(e),ae=(Array.isArray(S)?S:[]).map(x=>{var j;return{product_id:String((x==null?void 0:x.product_id)||"").trim(),quantity:Number((j=x==null?void 0:x.quantity)!=null?j:0)}}).filter(x=>x.product_id&&Number.isFinite(x.quantity)&&x.quantity>0).sort((x,j)=>x.product_id<j.product_id?-1:x.product_id>j.product_id?1:x.quantity-j.quantity);return JSON.stringify({name:s,phone:a,address:n,items:ae,adj:c})},Kt=React.useMemo(()=>{if($)return"";const e=p((u==null?void 0:u.phone)||"");if(!e)return"";const s=Dt(),a=Rt(u),n=Array.isArray(M)?M:[];for(const c of n){if(!c||$&&String(c.id)===String($)||p(c.phone||"")!==e)continue;const S=Nt(c.created_at);if(!S||S!==s)continue;const ae=Vt(c);if(ae&&ae===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${s}${c!=null&&c.id?` (#${c.id})`:""}`}return""},[M,u,oe,$]),Pt=e=>{var Ot;const s=[],a=[],n=String((e==null?void 0:e.customer_name)||"").trim(),c=p((e==null?void 0:e.phone)||""),S=String((e==null?void 0:e.address)||"").trim();n||s.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),c||s.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),c&&!N(c)&&s.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),S||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const H=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(pt=>pt&&pt.product_id);H.length===0&&s.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),H.some(pt=>{var It;const xt=Number((It=pt==null?void 0:pt.quantity)!=null?It:0);return!Number.isFinite(xt)||xt<=0})&&s.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const j=new Set;let P=!1;for(const pt of H){const xt=String(pt.product_id||"").trim();if(xt){if(j.has(xt)){P=!0;break}j.add(xt)}}P&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const Me=_t(H),Ne=Tt(H),it=Ne!=null&&Ne.found?Number((Ot=Ne==null?void 0:Ne.fee)!=null?Ot:0):0,ct=Ye(e==null?void 0:e.adjustment_amount),At=String((e==null?void 0:e.adjustment_note)||"").trim();Ne!=null&&Ne.found&&(it>=2e5||Me>0&&it>Me*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ve(it)}`),ct!==0&&!At&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const wt=Math.abs(ct);return(wt>=5e5||Me>0&&wt>Me*.5)&&ct!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ve(ct)}`),{errors:s,warnings:a,canSubmit:s.length===0}},zt=React.useMemo(()=>Pt(u),[u,b]),Ve=React.useMemo(()=>{var It;const e=String((u==null?void 0:u.customer_name)||"").trim(),s=p((u==null?void 0:u.phone)||""),a=String((u==null?void 0:u.address)||"").trim(),n=Array.isArray(u==null?void 0:u.items)?u.items:[],c=new Map;for(const Ge of n){const $t=String((Ge==null?void 0:Ge.product_id)||"").trim();$t&&c.set($t,(c.get($t)||0)+1)}const S=n.map(Ge=>{var Ft;const $t=String((Ge==null?void 0:Ge.product_id)||"").trim(),Ht=Number((Ft=Ge==null?void 0:Ge.quantity)!=null?Ft:0),Ut=$t?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",Jt=Number.isFinite(Ht)&&Ht>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",Bt=$t&&(c.get($t)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Ut,qtyError:Jt,dupWarn:Bt}}),ae=n.filter(Ge=>Ge&&Ge.product_id),H=_t(ae),x=Tt(ae),j=x!=null&&x.found?Number((It=x==null?void 0:x.fee)!=null?It:0):0,P=Ye(u==null?void 0:u.adjustment_amount),Me=String((u==null?void 0:u.adjustment_note)||"").trim(),Ne=Math.abs(P),it=P!==0&&!Me?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ct=P!==0&&(Ne>=5e5||H>0&&Ne>H*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ve(P)}`:"",At=x!=null&&x.found&&(j>=2e5||H>0&&j>H*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ve(j)}`:"",wt=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Ot=s?N(s)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",pt=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",xt=!wt&&!Ot&&S.every(Ge=>!Ge.productError&&!Ge.qtyError);return{nameError:wt,phoneError:Ot,addressWarn:pt,items:S,shipAbnormalWarn:At,adjustmentNoteWarn:it,adjustmentAbnormalWarn:ct,canSubmit:xt}},[u,b]),Et=async e=>{var ae,H,x;const s=(e==null?void 0:e.mode)||"close",a=Pt(u);if(!a.canSubmit){const j=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof f=="function"?f(j,"danger"):alert(j);return}if(!$&&Kt){const j=`${Kt}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(j)){(ft==null?void 0:ft.count)>0&&fe(!0),setTimeout(()=>{var Ne;const Me=document.getElementById("order-phone-input");Me&&typeof Me.scrollIntoView=="function"&&(Me.scrollIntoView({block:"center",behavior:"smooth"}),(Ne=Me.focus)==null||Ne.call(Me))},0);return}}const n=p(u.phone),S=(Array.isArray(u.items)?u.items:[]).map(j=>{var P;return{product_id:(j==null?void 0:j.product_id)||"",quantity:Number((P=j==null?void 0:j.quantity)!=null?P:1)}}).filter(j=>j.product_id&&Number.isFinite(j.quantity)&&j.quantity>0);U(!0);try{const j=$?`${API_BASE}/api/orders/${$}`:`${API_BASE}/api/orders`,P=S[0],Me={customer_name:u.customer_name,phone:n,address:u.address,note:(u.note||"").trim(),adjustment_amount:Ye(u.adjustment_amount),adjustment_note:(u.adjustment_note||"").trim(),product_id:P.product_id,quantity:P.quantity,status:u.status,items:S,...$?{id:$}:{}};if($)await window.KTM.api.putJSON(j,Me,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Ne=await window.KTM.api.postJSON(j,Me,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Ct.current={id:(x=(H=Ne==null?void 0:Ne.id)!=null?H:(ae=Ne==null?void 0:Ne.order)==null?void 0:ae.id)!=null?x:null,fingerprint:Rt(u),ts:Date.now()}}s==="new"&&!$?(mt(""),we(null),he(!0)):(mt(""),we(null),he(!1)),Se()}catch(j){console.error(j),typeof f=="function"?f(j.message,"danger"):alert(j.message);return}finally{U(!1)}},jt=e=>window.KTM.orders.getOrderTotalMoney(e,ot),qt=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){se(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Se(),tt()}catch(s){console.error(s),typeof f=="function"?f(s.message,"danger"):alert(s.message)}finally{se(null)}}},yt=async(e,s)=>{var n;const a=e==null?void 0:e.id;if(!(!a||!s)){ge(a);try{const c=St(e),S=(Array.isArray(c)?c:[]).map(x=>{var j;return{product_id:(x==null?void 0:x.product_id)||"",quantity:Number((j=x==null?void 0:x.quantity)!=null?j:1)}}).filter(x=>x.product_id&&Number.isFinite(x.quantity)&&x.quantity>0);if(!S.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const ae=S[0],H={id:a,customer_name:(e==null?void 0:e.customer_name)||"",phone:p((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",note:((e==null?void 0:e.note)||"").trim(),adjustment_amount:Number((n=e==null?void 0:e.adjustment_amount)!=null?n:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:ae.product_id,quantity:ae.quantity,status:s,items:S};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${a}`,H,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),A(x=>Array.isArray(x)?x.map(j=>(j==null?void 0:j.id)===a?{...j,status:s}:j):x),C(x=>Array.isArray(x)?x.map(j=>(j==null?void 0:j.id)===a?{...j,status:s}:j):x),typeof f=="function"&&f("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(c){console.error(c),typeof f=="function"?f(c.message,"danger"):alert(c.message)}finally{ge(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:R&&!Z||F||!!K||!!W}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:ze,disabled:F||!!K},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:oe,onChange:e=>k(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:g}),oe&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{k("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:R},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:ue,onChange:e=>G(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:g},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),ue&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>G(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:R},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:g,onChange:e=>{const s=!!e.target.checked;X(s),s&&G("pending")}}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",o," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Se,disabled:R},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},ue?`${st.length}/${M.length} \u0111\u01A1n`:`${M.length} \u0111\u01A1n`)),le.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,le.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",o," ng\xE0y.",_&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{X(!0),G("pending")}},"Xem ngay")),Be.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,Be.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",r," ng\xE0y).",J&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{X(!1),G("draft"),k(""),Se()}},"Xem ngay")),R?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):M.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):st.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},st.map(e=>{var s;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((s=e==null?void 0:e.split_seq)!=null?s:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${Oe(e.status)}`},De(e.status)),Ae(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${o} ng\xE0y`},"\u26A0 Ch\u1EADm ",ke(e),"d"),Ee(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${v} ng\xE0y`},"\u23F3 C\xF2n ",Pe(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=lt(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((n,c)=>React.createElement("div",{key:c,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},c+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${ve(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Fe(e))})()),(rt(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ve(rt(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},ve(jt(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",gt(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary flex-fill",onClick:()=>qe(e),disabled:F||!!K||W===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>Lt(e),disabled:F||!!K||W===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger flex-fill",onClick:()=>qt(e.id),disabled:F||K===e.id||W===e.id},K===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>yt(e,"processing"),disabled:F||!!K||W===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>yt(e,"done"),disabled:F||!!K||W===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>yt(e,"paid"),disabled:F||!!K||W===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:()=>yt(e,"canceled"),disabled:F||!!K||W===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,st.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const s=lt(e);return s.length?React.createElement("div",{className:"d-grid gap-1"},s.map((a,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",ve(a.unitPrice))))):Fe(e)})()),React.createElement("td",null,_e(e)),React.createElement("td",{className:"fw-semibold"},ve(jt(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${Oe(e.status)}`},De(e.status)),Ae(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${o} ng\xE0y`},"\u26A0 Ch\u1EADm ",ke(e),"d"),Ee(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${v} ng\xE0y`},"\u23F3 C\xF2n ",Pe(e),"d"))),React.createElement("td",null,gt(e.created_at)),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary me-1",onClick:()=>qe(e),disabled:F||!!K||W===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>Lt(e),disabled:F||!!K||W===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>yt(e,"processing"),disabled:F||!!K||W===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>yt(e,"done"),disabled:F||!!K||W===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>yt(e,"paid"),disabled:F||!!K||W===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:()=>yt(e,"canceled"),disabled:F||!!K||W===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>qt(e.id),disabled:F||K===e.id},K===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))))))),Z&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),$?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Ie})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Et({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:ht},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:u.customer_name,onChange:e=>pe({...u,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Ve.nameError&&React.createElement("div",{className:"form-text text-danger"},Ve.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:u.phone,onChange:e=>me(e.target.value),onBlur:Q,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Ve.phoneError&&React.createElement("div",{className:"form-text text-danger"},Ve.phoneError),!Ve.phoneError&&ft.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",ft.count," \u0111\u01A1n trong th\xE1ng ",ft.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>fe(e=>!e)},Te?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),Te&&ft.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>fe(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},ft.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Oe(e.status)}`},De(e.status))),React.createElement("div",{className:"text-muted small"},gt(e.created_at)," \u2022 ",ve(jt(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Fe(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&qe(e)}},"M\u1EDF")))),ft.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(ce==null?void 0:ce.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(ce==null?void 0:ce.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(ce==null?void 0:ce.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(ce==null?void 0:ce.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:u.status,onChange:e=>pe({...u,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:u.address,onChange:e=>pe({...u,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Ve.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Ve.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:u.note,onChange:e=>pe({...u,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:u.adjustment_amount,onChange:e=>pe({...u,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Ve.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Ve.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:u.adjustment_note,onChange:e=>pe({...u,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!Ve.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Ve.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{pe(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),Ze(e=>[...Array.isArray(e)?e:[],""]),$&&Le(e=>[...Array.isArray(e)?e:[],!0])},disabled:F},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(u.items)?u.items:[{product_id:"",quantity:1}]).map((e,s)=>React.createElement("div",{key:s,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{ye.current[s]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{h(a=>a===s?null:s),setTimeout(()=>{const a=document.getElementById(`order-product-search-${s}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ut(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),i===s&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${s}`,className:"form-control",value:He[s]||"",onChange:a=>{const n=a.target.value;Ze(c=>{const S=Array.isArray(c)?[...c]:[];return S[s]=n,S})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),Mt(s).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):Mt(s).map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const n=String(a.id);pe(c=>{const S=Array.isArray(c.items)?[...c.items]:[];return S[s]={...S[s]||{quantity:1},product_id:n},{...c,items:S}}),h(null)}},a.name,a.code?` (${a.code})`:""))),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),b.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var n;const a=(n=Ve.items)==null?void 0:n[s];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),$&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${s}`,checked:!!be[s],onChange:a=>{const n=!!a.target.checked;Le(c=>{const S=Array.isArray(c)?[...c]:[],ae=Array.isArray(u.items)?u.items.length:0;for(;S.length<ae;)S.push(!0);return S[s]=n,S})},disabled:F||re}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${s}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const n=a.target.value;pe(c=>{const S=Array.isArray(c.items)?[...c.items]:[];return S[s]={...S[s]||{product_id:""},quantity:n},{...c,items:S}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const a=(n=Ve.items)==null?void 0:n[s];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{pe(a=>{const n=Array.isArray(a.items)?[...a.items]:[];return n.splice(s,1),{...a,items:n.length?n:[{product_id:"",quantity:1}]}}),Ze(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(s,1),n.length?n:[""]}),Le(a=>{const n=Array.isArray(a)?[...a]:[];return n.splice(s,1),n}),h(a=>a==null?a:a===s?null:a>s?a-1:a)},disabled:F||re||(Array.isArray(u.items)?u.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const s=(Array.isArray(u.items)?u.items:[]).filter(ae=>ae==null?void 0:ae.product_id),a=_t(s),n=Tt(s),c=Ye(u.adjustment_amount),S=a+(n.found?n.fee:0)+c;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ve(a))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ve(n.fee))),!!Ve.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Ve.shipAbnormalWarn),c!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ve(c))),(u.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(u.note||"").trim()),(u.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",(u.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ve(S)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Ie,disabled:F||re,style:{borderRadius:10}},"H\u1EE7y"),!!$&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:We,disabled:F||re,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},re?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!$&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Et({mode:"new"}),disabled:F||!Ve.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:F||re||!Ve.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},F?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

