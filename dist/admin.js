const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:N,error:x}){const[A,z]=useState(""),[K,$]=useState(""),[O,ne]=useState(!1),[le,Z]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),x&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),x),React.createElement("form",{onSubmit:async $e=>{$e.preventDefault(),ne(!0),await N(A,K),ne(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:A,onChange:$e=>z($e.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:le?"text":"password",className:"form-control",value:K,onChange:$e=>$($e.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Z(!le)},React.createElement("i",{className:`fas fa-eye${le?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:N,type:x,onClose:A,actionLabel:z,onAction:K,durationMs:$}){return useEffect(()=>{const O=Number($),ne=Number.isFinite(O)&&O>0?O:3e3,le=setTimeout(A,ne);return()=>clearTimeout(le)},[A,$]),React.createElement("div",{className:`toast show align-items-center text-white bg-${x} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},N),z&&typeof K=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{K()}finally{A()}}},z),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:A})))}function Loading({show:N}){return N?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:N,title:x,subtitle:A,onClose:z,footer:K,children:$}){return useEffect(()=>{if(!N)return;const O=ne=>{ne.key==="Escape"&&(ne.preventDefault(),typeof z=="function"&&z())};return document.addEventListener("keydown",O),()=>document.removeEventListener("keydown",O)},[N,z]),N?React.createElement("div",{className:`admin-drawer-root ${N?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:z,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},x),A?React.createElement("div",{className:"admin-drawer-subtitle"},A):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:z,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},$),K?React.createElement("div",{className:"admin-drawer-footer"},K):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(N){try{const x=localStorage.getItem(N);if(!x)return[];const A=JSON.parse(x);return Array.isArray(A)?A.map(z=>String(z||"").trim()).filter(Boolean):[]}catch(x){return[]}}function saveAdminMenuIdsToStorage(N,x){try{localStorage.setItem(N,JSON.stringify(Array.isArray(x)?x:[]))}catch(A){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(N){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,N),N}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(N){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,N),N}function Sidebar({activeMenu:N,onMenuChange:x,onLogout:A,currentUser:z,pinnedMenus:K,recentMenus:$,onTogglePin:O}){const ne=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],le=(z==null?void 0:z.username)||(z==null?void 0:z.name)||(z==null?void 0:z.email)||"Admin",Z=useMemo(()=>{const ce=new Map;for(const _ of ne)ce.set(_.id,_);return ce},[]),we=Array.isArray(K)?K:[],$e=Array.isArray($)?$:[],de=we.map(ce=>Z.get(ce)).filter(Boolean),he=$e.filter(ce=>ce!==N).map(ce=>Z.get(ce)).filter(Boolean).slice(0,5),Ie=ce=>we.includes(ce);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},le),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},de.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},de.map(ce=>React.createElement("a",{key:`pin-${ce.id}`,href:"#",className:`nav-link ${N===ce.id?"active":""} sidebar-quicklink`,onClick:_=>{_.preventDefault(),x(ce.id)}},React.createElement("i",{className:`fas ${ce.icon}`})," ",ce.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:_=>{_.preventDefault(),_.stopPropagation(),O&&O(ce.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),he.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},he.map(ce=>React.createElement("a",{key:`recent-${ce.id}`,href:"#",className:`nav-link ${N===ce.id?"active":""} sidebar-quicklink`,onClick:_=>{_.preventDefault(),x(ce.id)}},React.createElement("i",{className:`fas ${ce.icon}`})," ",ce.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),ne.map(ce=>React.createElement("a",{key:ce.id,href:"#",className:`nav-link ${N===ce.id?"active":""} ${ce.disabled?"opacity-50":""} ${ce.highlight?"text-warning":""}`,onClick:_=>{_.preventDefault(),ce.disabled||x(ce.id)}},React.createElement("i",{className:`fas ${ce.icon}`})," ",ce.label,ce.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),ce.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${Ie(ce.id)?"pinned":""}`,onClick:_=>{_.preventDefault(),_.stopPropagation(),O&&O(ce.id)},title:Ie(ce.id)?"B\u1ECF ghim":"Ghim","aria-label":Ie(ce.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),A&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:A,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(N){const x=typeof N=="number"?N:parseFloat(String(N!=null?N:"").trim());return Number.isFinite(x)?Math.max(0,Math.min(100,x)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var N;try{const x=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!x)return{ship_percent:DEFAULT_SHIP_PERCENT};const A=JSON.parse(x);return{ship_percent:normalizeShipPercent((N=A==null?void 0:A.ship_percent)!=null?N:A==null?void 0:A.shipPercent)}}catch(x){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(N){var x;try{const A={ship_percent:normalizeShipPercent((x=N==null?void 0:N.ship_percent)!=null?x:N==null?void 0:N.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(A)),A}catch(A){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var x;const N=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((x=N==null?void 0:N.ship_percent)!=null?x:N==null?void 0:N.shipPercent)}}async function saveAdminSettingsToServer(N){var z,K,$;const x={ship_percent:normalizeShipPercent((z=N==null?void 0:N.ship_percent)!=null?z:N==null?void 0:N.shipPercent)},A=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,x,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent(($=(K=A==null?void 0:A.ship_percent)!=null?K:A==null?void 0:A.shipPercent)!=null?$:x.ship_percent)}}function AlbumList({albums:N,onSelect:x,onCreate:A,onEdit:z,onDelete:K,loading:$,currentFolder:O,onBack:ne,breadcrumb:le}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},O&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:ne},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),O?O.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:A},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),le&&le.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Z=>{Z.preventDefault(),ne("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),le.map((Z,we)=>React.createElement("li",{key:Z.id,className:`breadcrumb-item ${we===le.length-1?"active":""}`},we===le.length-1?Z.title:React.createElement("a",{href:"#",onClick:$e=>{$e.preventDefault(),ne(Z)},className:"text-warning"},Z.title))))),$?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):N.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},O?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},N.map(Z=>React.createElement("div",{key:Z.uuid||Z.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>x(Z)},Z.cover?React.createElement("img",{src:Z.cover,className:"album-cover",alt:Z.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Z.title),React.createElement("small",{className:"text-muted"},Z.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Z.subfolderCount),Z.subfolderCount>0&&Z.count>0&&" \u2022 ",Z.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Z.count),Z.subfolderCount===0&&Z.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:we=>{we.stopPropagation(),z(Z)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:we=>{we.stopPropagation(),K(Z)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:N,album:x,onClose:A,onSave:z,parentId:K}){const[$,O]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[ne,le]=useState(!1),[Z,we]=useState(!1),$e=useRef(null);useEffect(()=>{O(x?{slug:x.id||"",title:x.title||"",description:x.description||"",cover_url:x.cover||"",parent_id:x.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:K||null})},[x,N,K]);const de=async _=>{_.preventDefault(),le(!0),await z($),le(!1)},he=_=>_.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Ie=async _=>{const Je=_.type==="image/heic"||_.type==="image/heif"||/\.heic$/i.test(_.name);if(_.size<=2097152&&!Je)return _;try{const He=await createImageBitmap(_),fe=document.createElement("canvas");let Me=He.width,ke=He.height;const Ee=800;return(Me>Ee||ke>Ee)&&(Me>ke?(ke=Math.round(ke/Me*Ee),Me=Ee):(Me=Math.round(Me/ke*Ee),ke=Ee)),fe.width=Me,fe.height=ke,fe.getContext("2d").drawImage(He,0,0,Me,ke),He.close(),new Promise((mt,Se)=>{fe.toBlob(We=>{We?mt(new File([We],_.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Se(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(He){throw console.error("Compress cover error:",He),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ce=async _=>{var He;const Re=_.target.files[0];if(!Re)return;if(!(Re.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Re.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}we(!0);try{const fe=await Ie(Re),Me=await window.KTM.cloudinary.uploadImage({file:fe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Me.secure_url)throw console.error("Cloudinary error:",Me),new Error(((He=Me.error)==null?void 0:He.message)||"Upload failed");O(ke=>({...ke,cover_url:Me.secure_url}))}catch(fe){console.error("Cover upload error:",fe),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+fe.message)}we(!1),_.target.value=""};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:de},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:$.title,onChange:_=>O({...$,title:_.target.value,slug:$.slug||he(_.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:$.slug,onChange:_=>O({...$,slug:_.target.value}),required:!0,disabled:!!x}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:$.description,onChange:_=>O({...$,description:_.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},$.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:$.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>O(_=>({..._,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:$e,type:"file",accept:"image/*",className:"d-none",onChange:ce}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var _;return(_=$e.current)==null?void 0:_.click()},disabled:Z},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:$.cover_url,onChange:_=>O({...$,cover_url:_.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:A},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:ne||Z},ne?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:N,allAlbums:x,currentAlbumId:A,targetAlbum:z,onSelect:K,level:$=0}){const[O,ne]=useState(!0),le=N.uuid||N.id,Z=le===A,we=z===le,$e=x.filter(he=>he.parentId===le),de=$e.length>0;return React.createElement("div",{style:{marginLeft:$*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${we?"bg-info text-white":Z?"bg-light text-muted":"hover-bg"}`,style:{cursor:Z?"not-allowed":"pointer",opacity:Z?.5:1,transition:"background 0.2s"},onClick:()=>!Z&&K(le)},de&&React.createElement("i",{className:`fas fa-chevron-${O?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:he=>{he.stopPropagation(),ne(!O)}}),!de&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${we?"-open":""} me-2 ${we?"":"text-warning"}`}),React.createElement("span",{className:"small"},N.title),Z&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),N.count>0&&!Z&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},N.count)),O&&de&&React.createElement("div",null,$e.map(he=>React.createElement(FolderTreeItem,{key:he.uuid||he.id,folder:he,allAlbums:x,currentAlbumId:A,targetAlbum:z,onSelect:K,level:$+1}))))}function AlbumDetail({album:N,onBack:x,onRefresh:A,showToast:z,onNavigateToFolder:K,onEditSubfolder:$,parentAlbum:O}){const[ne,le]=useState([]),[Z,we]=useState([]),[$e,de]=useState(!0),[he,Ie]=useState(!1),[ce,_]=useState(""),[Re,Je]=useState([]),[He,fe]=useState([]),[Me,ke]=useState({}),[Ee,et]=useState(null),[mt,Se]=useState(!1),[We,lt]=useState(""),[b,p]=useState(!1),M=useRef(null),G=useRef(null),[X,H]=useState(!1),[V,me]=useState([]),[m,w]=useState([]),[L,Y]=useState(""),[re,ae]=useState(!1),ge=async(S,o=2)=>{const I=o*1024*1024,E=S.type==="image/heic"||S.type==="image/heif"||/\.heic$/i.test(S.name);if(S.size<=I&&!E)return S;try{const se=await createImageBitmap(S),ye=document.createElement("canvas");let P=se.width,Ue=se.height;const ct=1200;return(P>ct||Ue>ct)&&(P>Ue?(Ue=Math.round(Ue/P*ct),P=ct):(P=Math.round(P/Ue*ct),Ue=ct)),ye.width=P,ye.height=Ue,ye.getContext("2d").drawImage(se,0,0,P,Ue),se.close(),new Promise((Ae,bt)=>{ye.toBlob(zt=>{zt?Ae(new File([zt],S.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):bt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(se){throw console.error("Compress error:",se),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{ve(),Ve()},[N.id,N.uuid]);const ve=async()=>{de(!0);try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");le(S.images||[]);const o=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");we(Array.isArray(o)?o:[])}catch(S){console.error(S),z("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}de(!1)},Ve=async()=>{try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");w(Array.isArray(S)?S:[])}catch(S){console.error("Error loading albums:",S)}},tt=S=>{me(o=>o.includes(S)?o.filter(I=>I!==S):[...o,S])},ee=async()=>{if(!L||V.length===0){z("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}ae(!0);let S=0;for(const o of V)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${o}`,{album_id:L},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),S++}catch(I){console.error("Move error:",I)}ae(!1),H(!1),me([]),Y(""),S>0?(z("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),ve(),A()):z("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[je,rt]=useState(!1),Oe=async()=>{if(V.length===0||!confirm(`X\xF3a ${V.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;rt(!0);let S=0;for(const o of V)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${o}`,"L\u1ED7i x\xF3a \u1EA3nh"),S++}catch(I){console.error("Delete error:",I)}rt(!1),me([]),S>0?(z(`\u0110\xE3 x\xF3a ${S} \u1EA3nh!`,"success"),ve(),A()):z("X\xF3a th\u1EA5t b\u1EA1i","danger")},nt=()=>{V.length===ne.length?me([]):me(ne.map(S=>S.id))},ut=async()=>{if(We.trim()){p(!0);try{const S=We.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:S+"-"+Date.now(),title:We,parent_id:N.uuid||N.id},"L\u1ED7i t\u1EA1o folder"),z("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),lt(""),Se(!1),ve(),A()}catch(S){z(S.message,"danger")}p(!1)}},_t=async S=>{if(confirm(`X\xF3a folder "${S.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${S.uuid||S.id}`,"L\u1ED7i x\xF3a folder"),z("\u0110\xE3 x\xF3a folder","success"),ve(),A()}catch(o){z("L\u1ED7i x\xF3a folder","danger")}},wt=S=>{const o=Array.from(S).filter(I=>I.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(I.name));Je(I=>[...I,...o]),o.forEach(I=>{const E=new FileReader;E.onload=se=>{fe(ye=>[...ye,{file:I,preview:se.target.result}])},E.readAsDataURL(I)})},y=S=>{Je(o=>o.filter((I,E)=>E!==S)),fe(o=>o.filter((I,E)=>E!==S))},R=async S=>{var I;const o=await window.KTM.cloudinary.uploadImage({file:S,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${N.id}`});if(!o.secure_url)throw console.error("Cloudinary error:",o),new Error(((I=o.error)==null?void 0:I.message)||"Upload failed");return o},Le=async()=>{if(Re.length===0)return;Ie(!0);let S=0;for(let o=0;o<Re.length;o++)try{_(`\u0110ang x\u1EED l\xFD ${o+1}/${Re.length}...`);const I=await ge(Re[o],2);_(`\u0110ang upload ${o+1}/${Re.length}...`);const E=await R(I);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${N.id}`,{url:E.secure_url,caption:Me[o]||Re[o].name.replace(/\.[^/.]+$/,""),sort_order:ne.length+o},"L\u1ED7i l\u01B0u \u1EA3nh"),S++}catch(I){console.error("Upload error:",I)}Ie(!1),_(""),Je([]),fe([]),ke({}),S>0?(z(`\u0110\xE3 upload ${S} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),ve(),A()):z("Upload th\u1EA5t b\u1EA1i","danger")},st=async(S,o)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${S}`,"L\u1ED7i x\xF3a \u1EA3nh"),z("\u0110\xE3 x\xF3a \u1EA3nh","success"),ve(),A()}catch(I){z("L\u1ED7i x\xF3a \u1EA3nh","danger")}},kt=S=>{var o;S.preventDefault(),(o=G.current)==null||o.classList.add("dragover")},it=()=>{var S;(S=G.current)==null||S.classList.remove("dragover")},pt=S=>{var o;S.preventDefault(),(o=G.current)==null||o.classList.remove("dragover"),wt(S.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:x},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},N.title),React.createElement("small",{className:"text-muted"},Z.length>0&&React.createElement("span",null,Z.length," folder \u2022 "),ne.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Se(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),mt&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:We,onChange:S=>lt(S.target.value),onKeyPress:S=>S.key==="Enter"&&ut(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:ut,disabled:b||!We.trim()},b?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Se(!1),lt("")}},"H\u1EE7y")))),Z.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Z.map(S=>React.createElement("div",{key:S.uuid||S.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>K&&K(S)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},S.title),React.createElement("small",{className:"text-muted"},S.subfolderCount>0&&React.createElement("span",null,S.subfolderCount," folder"),S.subfolderCount>0&&S.count>0&&" \u2022 ",S.count>0&&React.createElement("span",null,S.count," \u1EA3nh"),S.subfolderCount===0&&S.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:o=>{o.stopPropagation(),$&&$(S)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:o=>{o.stopPropagation(),_t(S)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:G,className:"upload-zone",onClick:()=>{var S;return(S=M.current)==null?void 0:S.click()},onDragOver:kt,onDragLeave:it,onDrop:pt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:M,type:"file",multiple:!0,accept:"image/*",onChange:S=>wt(S.target.files)})),He.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},He.map((S,o)=>React.createElement("div",{key:o,className:"upload-preview-item"},React.createElement("img",{src:S.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>y(o)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Le,disabled:he},he?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),ce||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Re.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",ne.length,")"),ne.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:nt},V.length===ne.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),V.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},V.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>H(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Oe,disabled:je},je?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>me([])},React.createElement("i",{className:"fas fa-times"})))),$e?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):ne.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},ne.map((S,o)=>React.createElement("div",{key:o,className:`image-item ${V.includes(S.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>tt(S.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:V.includes(S.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:V.includes(S.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},V.includes(S.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:S.src,alt:S.caption,style:{opacity:V.includes(S.id)?.7:1,border:V.includes(S.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:I=>{I.stopPropagation(),st(S.id,o)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),S.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},S.caption)))))),X&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",V.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>H(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},m.filter(S=>!S.parentId).map(S=>React.createElement(FolderTreeItem,{key:S.uuid||S.id,folder:S,allAlbums:m,currentAlbumId:N.uuid||N.id,targetAlbum:L,onSelect:Y})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>H(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ee,disabled:!L||re},re?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Ee&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>et(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>et(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Ee.src,alt:Ee.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:S=>S.stopPropagation()}),Ee.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Ee.caption)))))}function SearchCenter({showToast:N,onNavigate:x}){const[A,z]=useState(""),[K,$]=useState([]),[O,ne]=useState([]),[le,Z]=useState([]),[we,$e]=useState("all"),[de,he]=useState(null),[Ie,ce]=useState("list"),[_,Re]=useState(!0),[Je,He]=useState([]),[fe,Me]=useState([]),ke=useRef(null),[Ee,et]=useState(!0),[mt,Se]=useState(!1),We=useRef(null),[lt,b]=useState(!1),[p,M]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[G,X]=useState(""),[H,V]=useState(!1),me=useRef(null),m=useRef(null),[w,L]=useState(null),[Y,re]=useState(!1),[ae,ge]=useState(null),[ve,Ve]=useState(!1),[tt,ee]=useState(!1),[je,rt]=useState(null),[Oe,nt]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),ut=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],_t=r=>{var g,T;r._type==="product"&&(ge(r),nt({name:r.name||"",code:r.code||"",price:r.price||"",image:r.image||"",category:r.category||"",note:r.note||"",commission_percent:(T=(g=r.commission_percent)!=null?g:r.commissionPercent)!=null?T:""}),re(!0))},wt=async()=>{if(ae)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${ae.id}`,Oe,"L\u1ED7i c\u1EADp nh\u1EADt"),N("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),re(!1),ge(null),kt()}catch(r){N(r.message,"danger")}},y=async r=>{const g=r._type==="product"?"s\u1EA3n ph\u1EA9m":r._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${g} "${r.name}"?`))try{let T="";r._type==="product"?T=`${API_BASE}/api/products?id=${r.id}`:r._type==="album"?T=`${API_BASE}/api/images/${r.id}`:r._type==="video"&&(T=`${API_BASE}/api/videos/${r.id}`),await window.KTM.api.deleteJSON(T,"L\u1ED7i x\xF3a"),N(`\u0110\xE3 x\xF3a ${g}`,"success"),kt()}catch(T){N(T.message,"danger")}},R=async r=>{try{const g=je?`${API_BASE}/api/products?id=${je.id}`:`${API_BASE}/api/products`;je?await window.KTM.api.putJSON(g,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(g,r,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(je?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ee(!1),rt(null),kt()}catch(g){N(g.message,"danger")}},Le="ktm_admin_data_cache_v1",st=1e3*60*10,kt=async()=>{let r=null,g=!1;const T=window.KTM.cache.read(Le,{ttlMs:st,validate:Array.isArray});T.hit?(r=T.value,console.log("[CACHE] Using cache, items:",r.length),ne(r),$(r),Re(!1),g=!0):T.status==="miss"?console.log("[CACHE] No cache found"):T.status==="expired"||T.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):T.status==="error"&&console.error("[CACHE] Error parsing cache"),g||Re(!0);try{const J=async(xe,Be)=>{try{const Ze=await window.KTM.api.getJSON(xe,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Ze!=null?Ze:Be}catch(Ze){return Be}},[U,j,v]=await Promise.all([J(`${API_BASE}/api/products?fields=search`,[]),J(`${API_BASE}/api/albums`,[]),J(`${API_BASE}/api/video-folders?withVideos=true`,[])]),te=Array.isArray(U)?U.map(xe=>({...xe,_type:"product",_source:"database"})):[];He(j);let be=[];Array.isArray(j)&&j.length>0&&(await Promise.all(j.map(Be=>J(`${API_BASE}/api/albums/${Be.id}`,{})))).forEach((Be,Ze)=>{const yt=j[Ze];Be.images&&Be.images.length>0&&Be.images.forEach(dt=>{be.push({id:dt.id,name:dt.caption||"\u1EA2nh t\u1EEB "+yt.title,image:dt.src,folder:yt.title,_type:"album",_source:"database"})})}),Me(v);let ue=[];Array.isArray(v)&&v.forEach(xe=>{xe.videos&&xe.videos.forEach(Be=>{ue.push({id:Be.id,name:Be.title,folder:xe.name,image:Be.thumb,youtubeId:Be.youtubeId,url:Be.url,_type:"video",_source:"database"})})});const Q=[...te,...be,...ue];(!r||JSON.stringify(Q)!==JSON.stringify(r))&&(ne(Q),$(Q),window.KTM.cache.write(Le,Q))}catch(J){console.error("Song song fetch error:",J)}Re(!1)};useEffect(()=>{kt(),setTimeout(()=>{var r;return(r=ke.current)==null?void 0:r.focus()},100)},[]);const it=r=>{try{return String(r!=null?r:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(g){return String(r!=null?r:"").toLowerCase()}},pt=r=>{const T=it(r).trim().split(/\s+/).filter(Boolean),J=T.includes("anh"),U=T.includes("video"),j=T.filter(be=>be!=="anh"&&be!=="video"),v=j.join(" "),te=new Set(["product"]);return J&&te.add("album"),U&&te.add("video"),{allowedTypes:te,includeAlbum:J,includeVideo:U,contentTokens:j,cleanedQuery:v}},S=(r,g,T)=>{var xe,Be,Ze,yt,dt;const J=Array.isArray(g)?g:[],U=it(T).trim();if(!J.length&&!U)return 0;const j=it((xe=r==null?void 0:r.name)!=null?xe:""),v=it((Be=r==null?void 0:r.code)!=null?Be:""),te=it((Ze=r==null?void 0:r.category)!=null?Ze:""),be=it((yt=r==null?void 0:r.note)!=null?yt:""),ue=it((dt=r==null?void 0:r.folder)!=null?dt:"");if(!`${j} ${v} ${te} ${be} ${ue}`.trim())return 0;let d=0;U&&(j===U&&(d+=220),j.includes(U)&&(d+=140),j.startsWith(U)&&(d+=160),v&&v===U&&(d+=180),v&&v.includes(U)&&(d+=90));for(const Nt of J){if(!Nt)continue;const ht=new RegExp(`(?:^|\\s)${Nt.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);j.includes(Nt)&&(d+=35),ht.test(j)&&(d+=25),v&&v.includes(Nt)&&(d+=20),v&&ht.test(v)&&(d+=10),te&&te.includes(Nt)&&(d+=12),ue&&ue.includes(Nt)&&(d+=12),be&&be.includes(Nt)&&(d+=6)}return d>0&&j&&(d+=Math.max(0,10-Math.min(10,Math.floor(j.length/10)))),d},o=(r,g,T)=>{const J=Array.isArray(r)?r:[];return J.length?J.map((j,v)=>({it:j,idx:v,score:S(j,g,T)})).sort((j,v)=>v.score!==j.score?v.score-j.score:j.idx-v.idx).map(j=>j.it):[]},I=async(r,g)=>{if(!(!Ee||g.length===0)){Se(!0);try{const T=g.map(U=>({id:U.id,name:U.name,price:U.price,category:U.category,note:U.note,folder:U.folder,_type:U._type})),J=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:r,products:T},"AI Search error");if(J&&J.matchedIds&&J.matchedIds.length>0){const{contentTokens:U,cleanedQuery:j}=pt(r),v=new Set(J.matchedIds),te=g.filter(be=>v.has(be.id)).sort((be,ue)=>S(ue,U,j)-S(be,U,j));te.length>0&&$(te)}else J&&J.matchedIds&&J.matchedIds.length===0&&$([])}catch(T){console.error("AI Search error:",T)}Se(!1)}},E=r=>{if(z(r),We.current&&clearTimeout(We.current),!r.trim()){se(we);return}const{allowedTypes:g,contentTokens:T,cleanedQuery:J}=pt(r),U=O.filter(v=>{if(!g.has(v==null?void 0:v._type))return!1;if(T.length===0)return!0;const te=it(Object.entries(v).filter(([be])=>!be.startsWith("_")).map(([,be])=>String(be||"")).join(" "));return T.some(be=>te.includes(be))});let j=U;we!=="all"&&(j=U.filter(v=>(v.category||v._type)===we)),$(o(j,T,J)),Ee&&J.length>=3&&(We.current=setTimeout(()=>{I(J,j)},500))},se=r=>{$e(r);const{allowedTypes:g,contentTokens:T}=pt(A),{cleanedQuery:J}=pt(A);let U=O.filter(j=>g.has(j==null?void 0:j._type));r!=="all"&&(U=U.filter(j=>(j.category||j._type)===r)),A.trim()&&T.length>0&&(U=U.filter(j=>{const v=it(Object.entries(j).filter(([te])=>!te.startsWith("_")).map(([,te])=>String(te||"")).join(" "));return T.every(te=>v.includes(te))})),$(o(U,T,J))},ye=(r,g)=>{window.KTM.clipboard.writeText(r).then(()=>{he(g),N("\u0110\xE3 copy!","success"),setTimeout(()=>he(null),1500)})},P=async(r,g)=>{try{await window.KTM.clipboard.writeImageFromUrl(r),he(g+"-img"),N("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>he(null),1500)}catch(T){ye(r,g+"-img")}},Ue=r=>{let g=r.toLowerCase();const T=[],J=O.filter(v=>v._type==="product");if(g.includes("ty")||g.includes("xy lanh")){if(g.includes("gi\u1EEFa")||g.includes("giua")){const v=J.find(te=>{var be;return(be=te.name)==null?void 0:be.toLowerCase().includes("xy lanh gi\u1EEFa")});v&&!T.find(te=>te.id===v.id)&&T.push(v)}if(g.includes("nghi\xEAng")||g.includes("nghieng")){const v=J.find(te=>{var be;return(be=te.name)==null?void 0:be.toLowerCase().includes("xy lanh nghi\xEAng")});v&&!T.find(te=>te.id===v.id)&&T.push(v)}if(g.includes("\u1EE7i")||g.includes("ui")){const v=J.find(te=>{var be;return(be=te.name)==null?void 0:be.toLowerCase().includes("xy lanh \u1EE7i")});v&&!T.find(te=>te.id===v.id)&&T.push(v)}}const U=g.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(U){const v=U[1],te=U[2],be=J.find(ue=>{var d;const Q=((d=ue.name)==null?void 0:d.toLowerCase())||"";return Q.includes("combo")&&Q.includes(`${v} tay`)&&(Q.includes(`${te} xy`)||Q.includes(`${te} xylanh`))});if(be&&!T.find(ue=>ue.id===be.id))T.push(be);else{const ue=J.find(Q=>{var xe;const d=((xe=Q.name)==null?void 0:xe.toLowerCase())||"";return d.includes("combo")&&d.includes(`${v} tay`)});ue&&!T.find(Q=>Q.id===ue.id)&&T.push(ue)}}if(g.includes("combo")&&!U){const v=g.match(/combo.*?(\d+)\s*tay/);if(v){const te=v[1];J.filter(ue=>{var d;const Q=((d=ue.name)==null?void 0:d.toLowerCase())||"";return Q.includes("combo")&&Q.includes(`${te} tay`)}).forEach(ue=>{T.find(Q=>Q.id===ue.id)||T.push(ue)})}}const j=g.match(/van\s*(\d+)\s*tay/);if(j&&!g.includes("ty")&&!g.includes("combo")){const v=j[1],te=J.find(be=>{var Q;const ue=((Q=be.name)==null?void 0:Q.toLowerCase())||"";return ue.includes(`van ${v} tay`)&&!ue.includes("combo")});te&&!T.find(be=>be.id===te.id)&&T.push(te)}return T.slice(0,4)},ct=async r=>{if(!r.trim())return;const g={role:"user",content:r,attachments:[]};M(J=>[...J,g]),X(""),V(!0);const T=Ue(r);setTimeout(()=>{var J;return(J=me.current)==null?void 0:J.scrollIntoView({behavior:"smooth"})},100);try{const U=O.filter(Q=>Q._type==="product").map(Q=>{let d=`- ${Q.name}`;return Q.code&&(d+=` (M\xE3: ${Q.code})`),Q.price&&(d+=` - Gi\xE1: ${Q.price.replace(/[đ\s]/g,"")}\u0111`),Q.category&&(d+=` [${Q.category}]`),Q.note&&(d+=` (${Q.note})`),d}).join(`
`),v=p.slice(-6).map(Q=>`${Q.role==="user"?"Kh\xE1ch":"AI"}: ${Q.content}`).join(`
`),te=v?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${v}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${U}`:U,ue=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:r,context:te,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";M(Q=>[...Q,{role:"assistant",content:ue,attachments:T}])}catch(J){console.error("AI Error:",J);const U=r.toLowerCase(),j=O.filter(te=>{const be=Object.values(te).join(" ").toLowerCase();return U.split(" ").some(ue=>be.includes(ue))});let v="";j.length>0?(v=`T\xECm th\u1EA5y ${j.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,j.slice(0,5).forEach(te=>{v+=`\u2022 ${te.name}`,te.price&&(v+=` - ${te.price.replace(/[đ\s]/g,"")}\u0111`),te.note&&(v+=` (${te.note})`),v+=`
`}),j.length>5&&(v+=`
...v\xE0 ${j.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):v='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',M(te=>[...te,{role:"assistant",content:v,attachments:j.slice(0,4)}])}V(!1),setTimeout(()=>{var J,U;(J=me.current)==null||J.scrollIntoView({behavior:"smooth"}),(U=m.current)==null||U.focus()},100)};function Bt({show:r,product:g,categories:T,onClose:J,onSave:U}){const[j,v]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[te,be]=useState(!1),[ue,Q]=useState(!1),d=useRef(null),xe=D=>window.KTM.money.formatVNDInputDigits(D),Be=D=>{const F=window.KTM.money.getDigits(String(D!=null?D:"")),q=Number(F);return F&&Number.isFinite(q)?Math.trunc(q):0},Ze=(D,F)=>{if(D==null||D==="")return[];let q=D;if(typeof q=="string"){const Ne=q.trim();if(!Ne)return[];try{q=JSON.parse(Ne)}catch(oe){return[]}}if(!Array.isArray(q))return[];const ie=Be(F);return q.map(Ne=>{var Pe;if(!Ne||typeof Ne!="object")return null;const oe=String((Pe=Ne.name)!=null?Pe:"").trim(),De=(Array.isArray(Ne.options)?Ne.options:[]).map(Qe=>{var It,Pt,Kt,Rt,Xt,Ct,Qt;if(!Qe||typeof Qe!="object")return null;const ot=String((It=Qe.label)!=null?It:"").trim();if(!ot)return null;const ft=(Xt=(Rt=(Kt=(Pt=Qe.price)!=null?Pt:Qe.priceValue)!=null?Kt:Qe.unit_price)!=null?Rt:Qe.unitPrice)!=null?Xt:null,St=Number(ft);let Tt=Number.isFinite(St)?Math.trunc(St):null;if(Tt==null){const pa=(Qt=(Ct=Qe.price_delta)!=null?Ct:Qe.priceDelta)!=null?Qt:null,xa=Number(pa);Number.isFinite(xa)&&(Tt=ie+Math.trunc(xa))}Tt==null&&(Tt=ie);const $t=String(Math.max(0,Math.trunc(Number(Tt)||0)));return{label:ot,price:Math.max(0,Math.trunc(Number(Tt)||0)),priceDigits:$t}}).filter(Boolean);return{name:oe||"Bi\u1EBFn th\u1EC3",options:De}}).filter(Boolean)},yt=D=>{if(D==null||D==="")return[];let F=D;if(typeof F=="string"){const q=F.trim();if(!q)return[];try{F=JSON.parse(q)}catch(ie){return[]}}return F&&typeof F=="object"&&!Array.isArray(F)&&(F=Object.entries(F).map(([q,ie])=>({key:q,value:ie}))),Array.isArray(F)?F.map(q=>{var De,Pe,Qe,ot,ft;if(!q||typeof q!="object")return null;const ie=String((Qe=(Pe=(De=q.key)!=null?De:q.name)!=null?Pe:q.label)!=null?Qe:"").trim(),Ne=String((ot=q.value)!=null?ot:"").trim(),oe=String((ft=q.unit)!=null?ft:"").trim();return ie?{key:ie,value:Ne,unit:oe}:null}).filter(Boolean):[]};useEffect(()=>{var D,F;if(g)if(v({name:g.name||"",code:g.code||"",price:g.price||"",image:g.image||"",category:g.category||"",note:g.note||"",sort_order:g.sort_order||0,commission_percent:(F=(D=g.commission_percent)!=null?D:g.commissionPercent)!=null?F:5,variants:Ze(g.variants,g.price),attributes:yt(g.attributes)}),g.price){const q=window.KTM.money.getDigits(g.price);At(q),v(ie=>({...ie,price:xe(q)}))}else At("");else v({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),At("")},[g,r]);const dt=D=>{v(F=>{var De;const q=Be(F.price),ie=String(q),Ne=Array.isArray(F.variants)?[...F.variants]:[],oe={...Ne[D]||{},options:Array.isArray((De=Ne[D])==null?void 0:De.options)?[...Ne[D].options]:[]};return oe.options=oe.options.map(Pe=>({label:String((Pe==null?void 0:Pe.label)||""),price:q,priceDigits:ie})),Ne[D]=oe,{...F,variants:Ne}})},Nt=()=>{v(D=>{const F=Be(D.price),q=String(F),Ne=(Array.isArray(D.variants)?[...D.variants]:[]).map(oe=>{const De=(Array.isArray(oe==null?void 0:oe.options)?oe.options:[]).map(Pe=>({label:String((Pe==null?void 0:Pe.label)||""),price:F,priceDigits:q}));return{name:String((oe==null?void 0:oe.name)||"Bi\u1EBFn th\u1EC3"),options:De}});return{...D,variants:Ne}})},[ht,qa]=React.useState(""),[ze,At]=React.useState(""),wa=D=>{const F=window.KTM.money.nextPriceInputState(D.target.value,ze);At(F.digits),v({...j,price:F.price})},Gt=async(D,F=2)=>{const q=F*1024*1024;if(D.size<=q)return D;try{const ie=await createImageBitmap(D),Ne=document.createElement("canvas");let oe=ie.width,De=ie.height;const Pe=1200;return(oe>Pe||De>Pe)&&(oe>De?(De=Math.round(De/oe*Pe),oe=Pe):(oe=Math.round(oe/De*Pe),De=Pe)),Ne.width=oe,Ne.height=De,Ne.getContext("2d").drawImage(ie,0,0,oe,De),ie.close(),new Promise((ot,ft)=>{Ne.toBlob(St=>{St?ot(new File([St],D.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ft(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ie){throw console.error("Compress error:",ie),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ua=async D=>{var ie;const F=D.target.files[0];if(!F)return;if(!(F.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(F.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Q(!0);try{const Ne=await Gt(F),oe=await window.KTM.cloudinary.uploadImage({file:Ne,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!oe.secure_url)throw console.error("Cloudinary error:",oe),new Error(((ie=oe.error)==null?void 0:ie.message)||"Upload failed");v(De=>({...De,image:oe.secure_url}))}catch(Ne){console.error("Upload error:",Ne),alert("L\u1ED7i upload \u1EA3nh: "+Ne.message)}Q(!1),D.target.value=""},Mt=async D=>{D.preventDefault(),be(!0);const F={...j,variants:Ze(j.variants,j.price),attributes:yt(j.attributes)};await U(F),be(!1)};return r?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),g?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:J})),React.createElement("form",{onSubmit:Mt},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:j.name,onChange:D=>v({...j,name:D.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:j.code,onChange:D=>v({...j,code:D.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:j.price,onChange:wa,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:j.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:D=>v({...j,commission_percent:D.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:j.category,onChange:D=>v({...j,category:D.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),T.map(D=>React.createElement("option",{key:D,value:D},D)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:j.note,onChange:D=>v({...j,note:D.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(j.attributes)?j.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(j.attributes)?j.attributes:[]).map((D,F)=>React.createElement("div",{key:F,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.key)||"",onChange:q=>{const ie=q.target.value;v(Ne=>{const oe=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return oe[F]={...oe[F]||{},key:ie},{...Ne,attributes:oe}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.value)||"",onChange:q=>{const ie=q.target.value;v(Ne=>{const oe=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return oe[F]={...oe[F]||{},value:ie},{...Ne,attributes:oe}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.unit)||"",onChange:q=>{const ie=q.target.value;v(Ne=>{const oe=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return oe[F]={...oe[F]||{},unit:ie},{...Ne,attributes:oe}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{v(q=>{const ie=Array.isArray(q.attributes)?[...q.attributes]:[];return ie.splice(F,1),{...q,attributes:ie}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{v(D=>{const F=Array.isArray(D.attributes)?[...D.attributes]:[];return F.push({key:"",value:"",unit:""}),{...D,attributes:F}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(j.variants)?j.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(j.variants)?j.variants:[]).map((D,F)=>React.createElement("div",{key:F,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.name)||"",onChange:q=>{const ie=q.target.value;v(Ne=>{var De;const oe=Array.isArray(Ne.variants)?[...Ne.variants]:[];return oe[F]={...oe[F]||{},name:ie,options:Array.isArray((De=oe[F])==null?void 0:De.options)?oe[F].options:[]},{...Ne,variants:oe}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>dt(F),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(D==null?void 0:D.options)||D.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{v(q=>{const ie=Array.isArray(q.variants)?[...q.variants]:[];return ie.splice(F,1),{...q,variants:ie}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(D==null?void 0:D.options)?D.options:[]).map((q,ie)=>{var Ne,oe;return React.createElement("div",{key:ie,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(q==null?void 0:q.label)||"",onChange:De=>{const Pe=De.target.value;v(Qe=>{var $t,It,Pt,Kt,Rt;const ot=Array.isArray(Qe.variants)?[...Qe.variants]:[],ft={...ot[F]||{},options:Array.isArray(($t=ot[F])==null?void 0:$t.options)?[...ot[F].options]:[]},St=Number((Pt=(It=ft.options[ie])==null?void 0:It.price)!=null?Pt:0)||0,Tt=String((Rt=(Kt=ft.options[ie])==null?void 0:Kt.priceDigits)!=null?Rt:Math.max(0,Math.trunc(St)));return ft.options[ie]={...ft.options[ie]||{},label:Pe,price:Math.max(0,Math.trunc(St)),priceDigits:Tt},ot[F]=ft,{...Qe,variants:ot}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:xe(String((oe=q==null?void 0:q.priceDigits)!=null?oe:window.KTM.money.getDigits(String((Ne=q==null?void 0:q.price)!=null?Ne:"")))),onChange:De=>{v(Pe=>{var Pt,Kt,Rt,Xt,Ct;const Qe=String((Kt=q==null?void 0:q.priceDigits)!=null?Kt:window.KTM.money.getDigits(String((Pt=q==null?void 0:q.price)!=null?Pt:""))),ot=window.KTM.money.nextPriceInputState(De.target.value,Qe),ft=String((Rt=ot.digits)!=null?Rt:""),St=Number(ft),Tt=Number.isFinite(St)?Math.max(0,Math.trunc(St)):0,$t=Array.isArray(Pe.variants)?[...Pe.variants]:[],It={...$t[F]||{},options:Array.isArray((Xt=$t[F])==null?void 0:Xt.options)?[...$t[F].options]:[]};return It.options[ie]={...It.options[ie]||{},label:String(((Ct=It.options[ie])==null?void 0:Ct.label)||""),price:Tt,priceDigits:ft},$t[F]=It,{...Pe,variants:$t}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{v(De=>{var ot;const Pe=Array.isArray(De.variants)?[...De.variants]:[],Qe={...Pe[F]||{},options:Array.isArray((ot=Pe[F])==null?void 0:ot.options)?[...Pe[F].options]:[]};return Qe.options.splice(ie,1),Pe[F]=Qe,{...De,variants:Pe}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{v(q=>{var De;const ie=Array.isArray(q.variants)?[...q.variants]:[],Ne={...ie[F]||{},options:Array.isArray((De=ie[F])==null?void 0:De.options)?[...ie[F].options]:[]},oe=Be(q.price);return Ne.options.push({label:"",price:oe,priceDigits:String(oe)}),ie[F]=Ne,{...q,variants:ie}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{v(D=>{const F=Be(D.price),q=Array.isArray(D.variants)?[...D.variants]:[],ie=String(F);return q.push({name:"Size",options:[{label:"S",price:F,priceDigits:ie},{label:"M",price:F,priceDigits:ie},{label:"L",price:F,priceDigits:ie}]}),{...D,variants:q}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Nt,disabled:!Array.isArray(j.variants)||j.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},j.image?React.createElement(React.Fragment,null,React.createElement("img",{src:j.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>v({...j,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var D;return(D=d.current)==null?void 0:D.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:d,type:"file",accept:"image/*",className:"d-none",onChange:ua}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var D;return(D=d.current)==null?void 0:D.click()},disabled:ue,style:{borderRadius:"10px"}},ue?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:j.image,onChange:D=>v({...j,image:D.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:J,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:te,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},te?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Ae=r=>window.KTM.money.formatVND(r),bt=r=>{if(r==null||r==="")return[];let g=r;if(typeof g=="string"){const T=g.trim();if(!T)return[];try{g=JSON.parse(T)}catch(J){return[]}}return Array.isArray(g)?g:[]},zt=r=>{if(r==null||r==="")return[];let g=r;if(typeof g=="string"){const T=g.trim();if(!T)return[];try{g=JSON.parse(T)}catch(J){return[]}}return g&&typeof g=="object"&&!Array.isArray(g)&&(g=Object.entries(g).map(([T,J])=>({key:T,value:J}))),Array.isArray(g)?g:[]},Dt=(r,g={})=>{var j;const T=zt(r).map(v=>{var te,be,ue,Q,d;return{key:String((ue=(be=(te=v==null?void 0:v.key)!=null?te:v==null?void 0:v.name)!=null?be:v==null?void 0:v.label)!=null?ue:"").trim(),value:String((Q=v==null?void 0:v.value)!=null?Q:"").trim(),unit:String((d=v==null?void 0:v.unit)!=null?d:"").trim()}}).filter(v=>!!v.key);if(!T.length)return null;const J=!!g.compact,U=String((j=g.className)!=null?j:"").trim();return React.createElement("div",{className:`ktm-variants-preview${J?" compact":""}${U?" "+U:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},T.map((v,te)=>{const be=v.key,ue=`${v.value||""}${v.unit?(v.value?" ":"")+v.unit:""}`.trim();return React.createElement("div",{key:`${be}-${te}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},be),ue?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ue):null)})))},pe=(r,g={})=>{var be;const T=bt(r).map(ue=>{var Q;return{name:String((Q=ue==null?void 0:ue.name)!=null?Q:"").trim(),options:Array.isArray(ue==null?void 0:ue.options)?ue.options:[]}}).map(ue=>({...ue,options:ue.options.map(Q=>{var d;return{label:String((d=Q==null?void 0:Q.label)!=null?d:"").trim(),price:Number(Q==null?void 0:Q.price)}}).filter(Q=>!!Q.label)})).filter(ue=>ue.options.length>0);if(!T.length)return null;const J=Number.isFinite(g.maxGroups)?Math.max(1,Math.trunc(g.maxGroups)):T.length,U=Number.isFinite(g.maxOptionsPerGroup)?Math.max(1,Math.trunc(g.maxOptionsPerGroup)):3,j=!!g.compact,v=String((be=g.className)!=null?be:"").trim(),te=T.slice(0,J);return React.createElement("div",{className:`ktm-variants-preview${j?" compact":""}${v?" "+v:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},te.map((ue,Q)=>{const d=ue.name||"Bi\u1EBFn th\u1EC3",xe=ue.options.slice(0,U),Be=ue.options.length-xe.length;return React.createElement("div",{key:`${d}-${Q}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},d),xe.map((Ze,yt)=>{const dt=Ze.price,Nt=Number.isFinite(dt)&&dt>=0?Ae(Math.trunc(dt)):"",ht=Nt?`${Ze.label} \xB7 ${Nt}`:Ze.label;return React.createElement("span",{key:`${d}-${Q}-${yt}`,className:"ktm-chip ktm-chip-option"},ht)}),Be>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",Be))})))},Et=(r,g)=>{const T=r._type==="product",J=r._type==="album",U=r._type==="video",j=r.note&&(r.note.toLowerCase().includes("free")||r.note.toLowerCase().includes("gi\u1EA3m")||r.note.toLowerCase().includes("sale")),v=T?Dt(r.attributes,{compact:Ie==="grid",className:Ie==="grid"?"meta text-muted":"text-muted"}):null,te=T?pe(r.variants,{compact:Ie==="grid",maxOptionsPerGroup:999,className:Ie==="grid"?"meta text-muted":"text-muted"}):null;return Ie==="grid"?React.createElement("div",{key:r.id||g,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>L({url:r.image,name:r.name,price:r.price,note:r.note,item:r})},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${U?"fa-video":"fa-image"} fa-2x text-muted`})),r.price&&React.createElement("div",{className:"price-overlay"},r.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${T?"product":J?"album":"video"}`},T?"SP":J?"\u1EA2nh":"Video"),j&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},r.name),r.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},r.note),v&&React.createElement("div",{style:{marginTop:2}},v),te&&React.createElement("div",{style:{marginTop:2}},te),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:de===r.id+"-img"?"copied":"",onClick:()=>P(r.image,r.id)},React.createElement("i",{className:"fas fa-image"})),r.price&&React.createElement("button",{className:de===r.id+"-price"?"copied":"",onClick:()=>ye(r.price.replace(/[đ\s]/g,""),r.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:r.id||g,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${T?"product":J?"album":"video"}`},T?"S\u1EA3n ph\u1EA9m":J?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},r.image?React.createElement("img",{src:r.image,alt:r.name,className:"thumb",loading:"lazy",onClick:()=>L({url:r.image,name:r.name,price:r.price,note:r.note,item:r})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${U?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},r.name),React.createElement("div",{className:"price-row"},r.price&&React.createElement("span",{className:"price"},r.price.replace(/[đ\s]/g,""),"\u0111"),j&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),v&&React.createElement("div",{style:{marginTop:4}},v),te&&React.createElement("div",{style:{marginTop:4}},te)),React.createElement("div",{className:"meta"},r.code&&React.createElement("span",{className:"meta-tag"},"#",r.code),r.category&&React.createElement("span",{className:"meta-tag"},r.category),r.note&&React.createElement("span",{className:"meta-tag highlight"},r.note),r.folder&&React.createElement("span",{className:"meta-tag"},r.folder),U&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},T&&React.createElement("button",{onClick:()=>x&&x("orders","create",{productId:r.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),r.price&&React.createElement("button",{className:de===r.id+"-price"?"copied":"",onClick:()=>ye(r.price.replace(/[đ\s]/g,""),r.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:de===r.id+"-name"?"copied":"",onClick:()=>ye(r.name,r.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),U&&r.youtubeId&&React.createElement("button",{className:de===r.id+"-yt"?"copied":"",onClick:()=>ye(`https://www.youtube.com/watch?v=${r.youtubeId}`,r.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),T&&React.createElement("button",{className:"action-edit",onClick:()=>_t(r)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>y(r)},React.createElement("i",{className:"fas fa-trash"}))))},[Lt,vt]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,K.length)," k\u1EBFt qu\u1EA3",Ee&&A.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),we!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},we==="product"?"S\u1EA3n ph\u1EA9m":we==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Ie==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ce("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Ie==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ce("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},_?React.createElement("div",null,[...Array(8)].map((r,g)=>React.createElement("div",{key:g,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):K.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',A,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{z(""),E("")}},"Xem t\u1EA5t c\u1EA3")):Ie==="grid"?React.createElement("div",{className:"product-grid-mobile"},K.map((r,g)=>Et(r,g))):React.createElement("div",null,K.map((r,g)=>Et(r,g)))),Lt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>vt(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${we==="all"?"active":""}`,onClick:()=>{se("all"),vt(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${we==="product"?"active":""}`,onClick:()=>{se("product"),vt(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${we==="album"?"active":""}`,onClick:()=>{se("album"),vt(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${we==="video"?"active":""}`,onClick:()=>{se("video"),vt(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Ee,onChange:r=>et(r.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:ke,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:A,onChange:r=>E(r.target.value)}),React.createElement("button",{className:`filter-btn ${Lt||we!=="all"?"active":""}`,onClick:()=>vt(!Lt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:ve?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>b(!0),onTouchStart:()=>b(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),lt&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>b(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},p.map((r,g)=>React.createElement("div",{key:g,className:`mb-3 ${r.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${r.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:r.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},r.content,r.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:de===`chat-${g}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:de===`chat-${g}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(r.content),he(`chat-${g}`),setTimeout(()=>he(null),1500)}},React.createElement("i",{className:`fas ${de===`chat-${g}`?"fa-check":"fa-copy"}`})),r.attachments&&r.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},r.attachments.map((T,J)=>React.createElement("div",{key:J,style:{width:70},className:"text-center"},T.image&&React.createElement("img",{src:T.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>L({url:T.image,name:T.name,price:T.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},T.name),T.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},T.price.replace(/[đ\s]/g,""),"\u0111"))))))),H&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:me})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(r=>React.createElement("button",{key:r,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>ct(r),disabled:H,style:{whiteSpace:"nowrap"}},r))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:r=>{r.preventDefault(),ct(G)},className:"chat-input-wrap"},React.createElement("input",{ref:m,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:G,onChange:r=>X(r.target.value),disabled:H}),React.createElement("button",{type:"submit",className:"send-btn",disabled:H||!G.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),w&&React.createElement("div",{className:"preview-modal",onClick:()=>L(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>L(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:r=>r.stopPropagation()},React.createElement("img",{src:w.url,alt:w.name})),React.createElement("div",{className:"preview-footer",onClick:r=>r.stopPropagation()},React.createElement("div",{className:"name"},w.name),w.price&&React.createElement("div",{className:"price"},w.price.replace(/[đ\s]/g,""),"\u0111"),w.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},w.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:de==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:de==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>P(w.url,"preview")},React.createElement("i",{className:`fas ${de==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),w.price&&React.createElement("button",{className:de==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>ye(w.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${de==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Bt,{show:tt,product:je,categories:le,onClose:()=>{ee(!1),rt(null)},onSave:R}),React.createElement("div",{className:`fab-container mobile-only ${ve?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{Ve(!1),ee(!0),rt(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{Ve(!1),x&&x("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${ve?"open":""}`,onClick:()=>Ve(!ve)},React.createElement("i",{className:"fas fa-plus"}))),Y&&ae&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>re(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Oe.name,onChange:r=>nt({...Oe,name:r.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Oe.code,onChange:r=>nt({...Oe,code:r.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Oe.price,onChange:r=>nt({...Oe,price:r.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Oe.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:r=>nt({...Oe,commission_percent:r.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Oe.category,onChange:r=>nt({...Oe,category:r.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),ut.map(r=>React.createElement("option",{key:r,value:r},r)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Oe.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:r=>nt({...Oe,note:r.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>re(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:wt},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:N,showToast:x}){const[A,z]=useState([]),[K,$]=useState([]),[O,ne]=useState(!0),[le,Z]=useState(null),[we,$e]=useState(!1),[de,he]=useState(null),[Ie,ce]=useState(!1),[_,Re]=useState(null),[Je,He]=useState(!1),[fe,Me]=useState(null),[ke,Ee]=useState(!1),[et,mt]=useState(!1),[Se,We]=useState(null),[lt,b]=useState(!1),[p,M]=useState(null),[G,X]=useState([]);useEffect(()=>{H()},[]);const H=async(y=null)=>{ne(!0);try{const R=y?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${y}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Le=await window.KTM.api.getJSON(R,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");z(Array.isArray(Le)?Le:[])}catch(R){console.error(R),x("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}ne(!1)},V=async y=>{try{const R=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${y}`,"L\u1ED7i t\u1EA3i video");$(Array.isArray(R)?R:[])}catch(R){console.error(R)}},me=async y=>{if(y===0)return;const R=[...A];[R[y-1],R[y]]=[R[y],R[y-1]],z(R),await w(R)},m=async y=>{if(y===A.length-1)return;const R=[...A];[R[y],R[y+1]]=[R[y+1],R[y]],z(R),await w(R)},w=async y=>{try{await Promise.all(y.map((R,Le)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${R.id}`,{sortOrder:Le},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),x("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(R){x("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),H(p==null?void 0:p.id)}},L=async y=>{if(y===0)return;const R=[...K];[R[y-1],R[y]]=[R[y],R[y-1]],$(R),await re(R)},Y=async y=>{if(y===K.length-1)return;const R=[...K];[R[y],R[y+1]]=[R[y+1],R[y]],$(R),await re(R)},re=async y=>{try{await Promise.all(y.map((R,Le)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${R.id}`,{sort_order:Le},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),x("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(R){x("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),V(le.id)}},ae=()=>{he(null),$e(!0)},ge=y=>{We(y),mt(!0),b(!0)},ve=async(y,R="modal")=>{try{!de&&p&&(y.parent_id=p.id);const Le=de?`${API_BASE}/api/video-folders/${de.id}`:`${API_BASE}/api/video-folders`;de?await window.KTM.api.putJSON(Le,y,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Le,y,"L\u1ED7i l\u01B0u folder"),x(de?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),R==="drawer"?(b(!1),he(null),H(p==null?void 0:p.id),de&&Se&&We({...Se,...y})):($e(!1),he(null),H(p==null?void 0:p.id))}catch(Le){x(Le.message,"danger")}},Ve=async y=>{const R=y.subfolderCount>0?`X\xF3a folder "${y.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${y.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(R))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${y.id}`,"L\u1ED7i x\xF3a folder"),x("\u0110\xE3 x\xF3a folder","success"),Z(null),H(p==null?void 0:p.id)}catch(Le){x("L\u1ED7i x\xF3a folder","danger")}},tt=y=>{y.subfolderCount>0?(X(R=>[...R,y]),M(y),H(y.id)):(Z(y),$(y.videos||[]))},ee=y=>{if(y==="root")X([]),M(null),H(null);else if(y){const R=G.findIndex(Le=>Le.id===y.id);R>=0&&(X(G.slice(0,R+1)),M(y),H(y.id))}else{const R=[...G];R.pop();const Le=R[R.length-1]||null;X(R),M(Le),H(Le==null?void 0:Le.id)}},je=()=>{mt(!1),b(!1),We(null)},rt=()=>{He(!1),Ee(!1),Me(null)},Oe=()=>{Re(null),ce(!0)},nt=y=>{Me(y),He(!0),Ee(!0)},ut=async(y,R="modal")=>{try{y.folder_id=le==null?void 0:le.id;const Le=_?`${API_BASE}/api/videos/${_.id}`:`${API_BASE}/api/videos`;_?await window.KTM.api.putJSON(Le,y,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Le,y,"L\u1ED7i l\u01B0u video"),x(_?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),R==="drawer"?(Ee(!1),Re(null),H(),le&&V(le.id),_&&fe&&Me({...fe,...y})):(ce(!1),Re(null),H(),le&&V(le.id))}catch(Le){x(Le.message,"danger")}},_t=async y=>{if(confirm(`X\xF3a video "${y.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${y.id}`,"L\u1ED7i x\xF3a video"),x("\u0110\xE3 x\xF3a video","success"),H(),le&&V(le.id)}catch(R){x("L\u1ED7i x\xF3a video","danger")}},wt=y=>{const R=`https://www.youtube.com/watch?v=${y.youtubeId}`;window.KTM.clipboard.writeText(R).then(()=>{x("\u0110\xE3 copy link!","success")}).catch(()=>{x("Kh\xF4ng th\u1EC3 copy link","danger")})};return le?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Z(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${le.slug==="shorts"?"text-danger":"text-warning"}`}),le.name)),React.createElement("button",{className:"btn btn-warning",onClick:Oe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),K.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},K.map((y,R)=>React.createElement("div",{key:y.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>L(R),disabled:R===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},R+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Y(R),disabled:R===K.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:y.thumb,className:"card-img-top",alt:y.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${y.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:y.title},y.title),React.createElement("small",{className:"text-muted"},y.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>wt(y),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>nt(y),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>_t(y),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Ie,video:_,onClose:()=>ce(!1),onSave:ut}),React.createElement(AdminDrawer,{open:et,title:Se?Se.name:"Folder",subtitle:Se?`${Se.subfolderCount||0} subfolder \u2022 ${Se.videoCount||0} videos`:"",onClose:je,footer:lt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:je},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Se&&ve({name:Se.name||"",description:Se.description||"",sortOrder:Se.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Se?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Se.name),x("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{b(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Se.name}"?`)&&(Ve(Se),je())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},lt&&Se?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Se.name||"",onChange:y=>We({...Se,name:y.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Se.description||"",onChange:y=>We({...Se,description:y.target.value})}))):Se?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Se.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Se.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Se.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Se.videoCount||0))),Se.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Se.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:Je,title:fe?fe.title:"Video",subtitle:fe?`${fe.youtubeId}`:"",onClose:rt,footer:ke?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:rt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{fe&&ut({youtube_url:`https://www.youtube.com/watch?v=${fe.youtubeId}`,title:fe.title||"",thumbnail_url:fe.thumb||"",sort_order:fe.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):fe?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const y=`https://www.youtube.com/watch?v=${fe.youtubeId}`;window.KTM.clipboard.writeText(y).then(()=>{x("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Ee(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${fe.title}"?`)&&(_t(fe),rt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ke&&fe?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:fe.title||"",onChange:y=>Me({...fe,title:y.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:fe.youtubeId||"",onChange:y=>Me({...fe,youtubeId:y.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:fe.sortOrder||0,onChange:y=>Me({...fe,sortOrder:parseInt(y.target.value)||0})}))):fe?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},fe.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},fe.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},fe.sortOrder||0))),fe.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:fe.thumb,alt:fe.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},p&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ee()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),p?p.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:ae},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),G.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:y=>{y.preventDefault(),ee("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),G.map((y,R)=>React.createElement("li",{key:y.id,className:`breadcrumb-item ${R===G.length-1?"active":""}`},R===G.length-1?y.name:React.createElement("a",{href:"#",onClick:Le=>{Le.preventDefault(),ee(y)},className:"text-warning"},y.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),O?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):A.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},p?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ae},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",p?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},A.map((y,R)=>{var Le,st,kt,it;return React.createElement("div",{key:y.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:pt=>{pt.stopPropagation(),me(R)},disabled:R===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},R+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:pt=>{pt.stopPropagation(),m(R)},disabled:R===A.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>tt(y),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${y.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},y.name),React.createElement("p",{className:"text-muted mb-0"},y.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),y.subfolderCount," folder"),y.subfolderCount>0&&(y.videoCount>0||((Le=y.videos)==null?void 0:Le.length)>0)&&" \u2022 ",(y.videoCount>0||((st=y.videos)==null?void 0:st.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),y.videoCount||((kt=y.videos)==null?void 0:kt.length)||0," videos"),y.subfolderCount===0&&!y.videoCount&&!((it=y.videos)!=null&&it.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:pt=>{pt.stopPropagation(),ge(y)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:pt=>{pt.stopPropagation(),Ve(y)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:we,folder:de,onClose:()=>$e(!1),onSave:ve}))}function VideoFolderModal({show:N,folder:x,onClose:A,onSave:z}){const[K,$]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[O,ne]=useState(!1),[le,Z]=useState(!1);useEffect(()=>{$(x?{name:x.name||"",description:x.description||"",sortOrder:x.sortOrder||0,coverImage:x.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[x,N]);const we=async de=>{const he=de.target.files[0];if(he){Z(!0);try{const Ie=await window.KTM.cloudinary.uploadImage({file:he,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Ie.secure_url&&$(ce=>({...ce,coverImage:Ie.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Ie){console.error("Cloudinary upload error:",Ie),alert("L\u1ED7i upload \u1EA3nh: "+(Ie.message||Ie))}finally{Z(!1)}}},$e=async de=>{de.preventDefault(),ne(!0);const he={...K,variants:normalizeVariants(K.variants,K.price),attributes:normalizeAttributes(K.attributes)};await z(he),ne(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:$e},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:K.name,onChange:de=>$({...K,name:de.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:K.description,onChange:de=>$({...K,description:de.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:K.sortOrder,onChange:de=>$({...K,sortOrder:parseInt(de.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},K.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:K.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>$({...K,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:we,disabled:le}),le&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:K.coverImage,onChange:de=>$({...K,coverImage:de.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:A},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:N,settings:x}){const[A,z]=useState([]),[K,$]=useState(!0),[O,ne]=useState(!1),[le,Z]=useState(null),[we,$e]=useState(""),[de,he]=useState(""),[Ie,ce]=useState(!1),[_,Re]=useState(null),Je=normalizeShipPercent(x==null?void 0:x.ship_percent),{parseMoney:He,formatVND:fe}=window.KTM.money,Me=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{ke()},[]);const ke=async()=>{$(!0);try{const m=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");z(Array.isArray(m)?m:[])}catch(m){console.error(m),N("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}$(!1)},Ee=()=>{Z(null),ne(!0)},et=m=>{Z(m),ne(!0)},mt=m=>{m&&(Re(m),ce(!0))},Se=()=>{ce(!1)},We=async m=>{if(!(!m||!m.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:m},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),N(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),ke()}catch(w){N("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},lt=async m=>{try{const w=le?`${API_BASE}/api/products?id=${le.id}`:`${API_BASE}/api/products`;le?await window.KTM.api.putJSON(w,m,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(w,m,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(le?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ne(!1),ke()}catch(w){N(w.message,"danger")}},b=async m=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${m.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${m.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),N("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ke()}catch(w){N(w.message,"danger")}},p=A.filter(m=>{const w=!we||m.name.toLowerCase().includes(we.toLowerCase())||m.code&&m.code.toLowerCase().includes(we.toLowerCase()),L=!de||m.category===de;return w&&L}),M=m=>{var Y;const w=(Y=m==null?void 0:m.commission_percent)!=null?Y:m==null?void 0:m.commissionPercent,L=w===""||w==null?NaN:Number(w);return Number.isFinite(L)?Math.max(0,Math.min(100,L)):5},G=m=>{const w=M(m),L=Number.isInteger(w)?String(w):String(Math.round(w*100)/100),Y=He(m==null?void 0:m.price);if(!Number.isFinite(Y)||Y<=0)return`${L}%`;const re=(Number(w)||0)/100,ge=window.KTM.money.parseShipFeeFromNote(m==null?void 0:m.note)!=null?0:Je>0?Y*Je/100:0,ve=Y*re-ge*re,Ve=Math.max(0,Math.round(ve));return`${L}% - ${fe(Ve)}`},X=m=>{if(m==null||m==="")return[];let w=m;if(typeof w=="string"){const L=w.trim();if(!L)return[];try{w=JSON.parse(L)}catch(Y){return[]}}return Array.isArray(w)?w:[]},H=m=>{if(m==null||m==="")return[];let w=m;if(typeof w=="string"){const L=w.trim();if(!L)return[];try{w=JSON.parse(L)}catch(Y){return[]}}return w&&typeof w=="object"&&!Array.isArray(w)&&(w=Object.entries(w).map(([L,Y])=>({key:L,value:Y}))),Array.isArray(w)?w:[]},V=m=>{const w=H(m).map(L=>{var Y,re,ae,ge,ve;return{key:String((ae=(re=(Y=L==null?void 0:L.key)!=null?Y:L==null?void 0:L.name)!=null?re:L==null?void 0:L.label)!=null?ae:"").trim(),value:String((ge=L==null?void 0:L.value)!=null?ge:"").trim(),unit:String((ve=L==null?void 0:L.unit)!=null?ve:"").trim()}}).filter(L=>!!L.key);return w.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},w.map((L,Y)=>{const re=L.key,ae=`${L.value||""}${L.unit?(L.value?" ":"")+L.unit:""}`.trim();return React.createElement("div",{key:`${re}-${Y}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},re),ae?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ae):null)}))):null},me=(m,w={})=>{const L=X(m).map(ge=>{var ve;return{name:String((ve=ge==null?void 0:ge.name)!=null?ve:"").trim(),options:Array.isArray(ge==null?void 0:ge.options)?ge.options:[]}}).map(ge=>({...ge,options:ge.options.map(ve=>{var Ve;return{label:String((Ve=ve==null?void 0:ve.label)!=null?Ve:"").trim(),price:Number(ve==null?void 0:ve.price)}}).filter(ve=>!!ve.label)})).filter(ge=>ge.options.length>0);if(!L.length)return null;const Y=Number.isFinite(w.maxGroups)?Math.max(1,Math.trunc(w.maxGroups)):L.length,re=Number.isFinite(w.maxOptionsPerGroup)?Math.max(1,Math.trunc(w.maxOptionsPerGroup)):4,ae=L.slice(0,Y);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},ae.map((ge,ve)=>{const Ve=ge.name||"Bi\u1EBFn th\u1EC3",tt=ge.options.slice(0,re),ee=ge.options.length-tt.length;return React.createElement("div",{key:`${Ve}-${ve}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Ve),tt.map((je,rt)=>{const Oe=je.price,nt=Number.isFinite(Oe)&&Oe>=0?fe(Math.trunc(Oe)):"",ut=nt?`${je.label} \xB7 ${nt}`:je.label;return React.createElement("span",{key:`${Ve}-${ve}-${rt}`,className:"ktm-chip ktm-chip-option"},ut)}),ee>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",ee))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Ee},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:we,onChange:m=>$e(m.target.value)})),React.createElement("span",{className:"product-count"},p.length)),React.createElement("select",{className:"form-select",value:de,onChange:m=>he(m.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),Me.map(m=>React.createElement("option",{key:m,value:m},m)))),K?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):p.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Ee},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},p.map(m=>React.createElement("div",{key:m.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>mt(m),onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),mt(m))},title:"Xem chi ti\u1EBFt"},m.image?React.createElement("img",{src:m.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},m.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},m.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},m.category),m.code&&React.createElement("span",{className:"product-badge bg-secondary"},m.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),G(m))),React.createElement("div",{className:"product-price"},m.price?m.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),m.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},m.note),V(m.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},V(m.attributes)),me(m.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},me(m.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:w=>{w.stopPropagation(),et(m)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:w=>{w.stopPropagation(),b(m)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:Ie,title:String((_==null?void 0:_.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((_==null?void 0:_.code)||"").trim()||null,String((_==null?void 0:_.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Se,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const m=String((_==null?void 0:_.code)||"").trim();m&&window.KTM.clipboard.writeText(m).then(()=>N("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((_==null?void 0:_.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const m=String((_==null?void 0:_.price)||"").trim();m&&window.KTM.clipboard.writeText(m).then(()=>N("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((_==null?void 0:_.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>_&&et(_),disabled:!_},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>_&&b(_),disabled:!_},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},_?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const m=String((_==null?void 0:_.price)||"").trim(),w=He(m);return Number.isFinite(w)&&w>0?fe(Math.trunc(w)):m||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},G(_)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},_.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},_.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),_.image?React.createElement("img",{src:_.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(_.note||"").trim()||_.attributes||_.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(_.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(_.note||"").trim()),V(_.attributes)?React.createElement("div",{className:"mt-2"},V(_.attributes)):null,me(_.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},me(_.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:O,product:le,categories:Me,onClose:()=>ne(!1),onSave:lt}))}function ProductModal({show:N,product:x,categories:A,onClose:z,onSave:K}){const[$,O]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[ne,le]=useState(!1),[Z,we]=useState(!1),$e=b=>{const p=window.KTM.money.getDigits(String(b!=null?b:"")),M=Number(p);return p&&Number.isFinite(M)?Math.trunc(M):0},de=b=>{if(b==null||b==="")return[];let p=b;if(typeof p=="string"){const M=p.trim();if(!M)return[];try{p=JSON.parse(M)}catch(G){return[]}}return p&&typeof p=="object"&&!Array.isArray(p)&&(p=Object.entries(p).map(([M,G])=>({key:M,value:G}))),Array.isArray(p)?p.map(M=>{var V,me,m,w,L;if(!M||typeof M!="object")return null;const G=String((m=(me=(V=M.key)!=null?V:M.name)!=null?me:M.label)!=null?m:"").trim(),X=String((w=M.value)!=null?w:"").trim(),H=String((L=M.unit)!=null?L:"").trim();return G?{key:G,value:X,unit:H}:null}).filter(Boolean):[]},he=(b,p)=>{if(b==null||b==="")return[];let M=b;if(typeof M=="string"){const X=M.trim();if(!X)return[];try{M=JSON.parse(X)}catch(H){return[]}}if(!Array.isArray(M))return[];const G=$e(p);return M.map(X=>{var me;if(!X||typeof X!="object")return null;const H=String((me=X.name)!=null?me:"").trim(),V=(Array.isArray(X.options)?X.options:[]).map(m=>{var ge,ve,Ve,tt,ee,je,rt;if(!m||typeof m!="object")return null;const w=String((ge=m.label)!=null?ge:"").trim();if(!w)return null;const L=(ee=(tt=(Ve=(ve=m.price)!=null?ve:m.priceValue)!=null?Ve:m.unit_price)!=null?tt:m.unitPrice)!=null?ee:null,Y=Number(L);let re=Number.isFinite(Y)?Math.trunc(Y):null;if(re==null){const Oe=(rt=(je=m.price_delta)!=null?je:m.priceDelta)!=null?rt:null,nt=Number(Oe);Number.isFinite(nt)&&(re=G+Math.trunc(nt))}re==null&&(re=G);const ae=String(Math.max(0,Math.trunc(Number(re)||0)));return{label:w,price:Math.max(0,Math.trunc(Number(re)||0)),priceDigits:ae}}).filter(Boolean);return{name:H||"Bi\u1EBFn th\u1EC3",options:V}}).filter(Boolean)};useEffect(()=>{var b,p;O(x?{name:x.name||"",code:x.code||"",price:x.price||"",image:x.image||"",category:x.category||"",note:x.note||"",sort_order:x.sort_order||0,commission_percent:(p=(b=x.commission_percent)!=null?b:x.commissionPercent)!=null?p:5,variants:he(x.variants,x.price),attributes:de(x.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[x,N]);const Ie=b=>{O(p=>{var V;const M=$e(p.price),G=String(M),X=Array.isArray(p.variants)?[...p.variants]:[],H={...X[b]||{},options:Array.isArray((V=X[b])==null?void 0:V.options)?[...X[b].options]:[]};return H.options=H.options.map(me=>({label:String((me==null?void 0:me.label)||""),price:M,priceDigits:G})),X[b]=H,{...p,variants:X}})},ce=()=>{O(b=>{const p=$e(b.price),M=String(p),X=(Array.isArray(b.variants)?[...b.variants]:[]).map(H=>{const V=(Array.isArray(H==null?void 0:H.options)?H.options:[]).map(me=>({label:String((me==null?void 0:me.label)||""),price:p,priceDigits:M}));return{name:String((H==null?void 0:H.name)||"Bi\u1EBFn th\u1EC3"),options:V}});return{...b,variants:X}})},[_,Re]=React.useState(""),Je=b=>window.KTM.money.formatVNDInputDigits(b),[He,fe]=React.useState(""),Me=b=>{const p=window.KTM.money.nextPriceInputState(b.target.value,He);fe(p.digits),O({...$,price:p.price})},[ke,Ee]=React.useState("");React.useEffect(()=>{x!=null&&x.image&&Ee(x.image)},[x]);const et=async b=>{if(!(!b||!b.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:b},"L\u1ED7i x\xF3a \u1EA3nh")}catch(p){console.error("Delete cloudinary image error:",p)}},mt=async(b,p=2,M)=>{const G=p*1024*1024,X=b.type==="image/heic"||b.type==="image/heif"||/\.heic$/i.test(b.name);if(b.size<=G&&!X)return b;M==null||M("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const H=await createImageBitmap(b);M==null||M("\u0110ang n\xE9n \u1EA3nh...");const V=document.createElement("canvas");let me=H.width,m=H.height;const w=1200;return(me>w||m>w)&&(me>m?(m=Math.round(m/me*w),me=w):(me=Math.round(me/m*w),m=w)),V.width=me,V.height=m,V.getContext("2d").drawImage(H,0,0,me,m),H.close(),new Promise((Y,re)=>{V.toBlob(ae=>{ae?(M==null||M("Ho\xE0n t\u1EA5t!"),Y(new File([ae],b.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):re(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(H){throw console.error("createImageBitmap error:",H),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Se=async b=>{var G,X;const p=(G=b.target.files)==null?void 0:G[0];if(!p)return;if(!(p.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(p.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}we(!0),Re("\u0110ang chu\u1EA9n b\u1ECB...");try{const H=(p.size/1024/1024).toFixed(1);Re(`File ${H}MB - \u0110ang n\xE9n...`);const V=await mt(p,2,w=>{Re(w)}),me=(V.size/1024/1024).toFixed(1);Re(`\u0110\xE3 n\xE9n: ${me}MB - \u0110ang upload...`);const m=await window.KTM.cloudinary.uploadImage({file:V,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});m.secure_url?($.image&&$.image!==ke&&et($.image),O(w=>({...w,image:m.secure_url})),Re("")):(console.error("Cloudinary error:",m),alert("Upload th\u1EA5t b\u1EA1i: "+(((X=m.error)==null?void 0:X.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Re(""))}catch(H){console.error("Upload error:",H),alert("L\u1ED7i: "+H.message),Re("")}we(!1),b.target.value=""},We=()=>{$.image&&($.image!==ke&&et($.image),O(b=>({...b,image:""})))},lt=async b=>{b.preventDefault(),le(!0),ke&&$.image&&ke!==$.image&&await et(ke),ke&&!$.image&&await et(ke),await K($),le(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${x?"fa-edit":"fa-plus-circle"} me-2`}),x?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:z})),React.createElement("form",{onSubmit:lt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},$.image?React.createElement(React.Fragment,null,React.createElement("img",{src:$.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:We,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Z?"fa-spinner fa-spin":"fa-camera"} me-1`}),Z?_||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Se,disabled:Z,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Z&&_&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},_))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:$.name,onChange:b=>O({...$,name:b.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:$.code,onChange:b=>O({...$,code:b.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:$.price,onChange:Me,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:$.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:b=>O({...$,commission_percent:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:$.category,onChange:b=>O({...$,category:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),A.map(b=>React.createElement("option",{key:b,value:b},b)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:$.note,onChange:b=>O({...$,note:b.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray($.attributes)?$.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray($.attributes)?$.attributes:[]).map((b,p)=>React.createElement("div",{key:p,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.key)||"",onChange:M=>{const G=M.target.value;O(X=>{const H=Array.isArray(X.attributes)?[...X.attributes]:[];return H[p]={...H[p]||{},key:G},{...X,attributes:H}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.value)||"",onChange:M=>{const G=M.target.value;O(X=>{const H=Array.isArray(X.attributes)?[...X.attributes]:[];return H[p]={...H[p]||{},value:G},{...X,attributes:H}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.unit)||"",onChange:M=>{const G=M.target.value;O(X=>{const H=Array.isArray(X.attributes)?[...X.attributes]:[];return H[p]={...H[p]||{},unit:G},{...X,attributes:H}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{O(M=>{const G=Array.isArray(M.attributes)?[...M.attributes]:[];return G.splice(p,1),{...M,attributes:G}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{O(b=>{const p=Array.isArray(b.attributes)?[...b.attributes]:[];return p.push({key:"",value:"",unit:""}),{...b,attributes:p}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray($.variants)?$.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray($.variants)?$.variants:[]).map((b,p)=>React.createElement("div",{key:p,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.name)||"",onChange:M=>{const G=M.target.value;O(X=>{var V;const H=Array.isArray(X.variants)?[...X.variants]:[];return H[p]={...H[p]||{},name:G,options:Array.isArray((V=H[p])==null?void 0:V.options)?H[p].options:[]},{...X,variants:H}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Ie(p),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(b==null?void 0:b.options)||b.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{O(M=>{const G=Array.isArray(M.variants)?[...M.variants]:[];return G.splice(p,1),{...M,variants:G}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(b==null?void 0:b.options)?b.options:[]).map((M,G)=>{var X,H;return React.createElement("div",{key:G,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.label)||"",onChange:V=>{const me=V.target.value;O(m=>{var ae,ge,ve,Ve,tt;const w=Array.isArray(m.variants)?[...m.variants]:[],L={...w[p]||{},options:Array.isArray((ae=w[p])==null?void 0:ae.options)?[...w[p].options]:[]},Y=Number((ve=(ge=L.options[G])==null?void 0:ge.price)!=null?ve:0)||0,re=String((tt=(Ve=L.options[G])==null?void 0:Ve.priceDigits)!=null?tt:Math.max(0,Math.trunc(Y)));return L.options[G]={...L.options[G]||{},label:me,price:Math.max(0,Math.trunc(Y)),priceDigits:re},w[p]=L,{...m,variants:w}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Je(String((H=M==null?void 0:M.priceDigits)!=null?H:window.KTM.money.getDigits(String((X=M==null?void 0:M.price)!=null?X:"")))),onChange:V=>{O(me=>{var ve,Ve,tt,ee,je;const m=String((Ve=M==null?void 0:M.priceDigits)!=null?Ve:window.KTM.money.getDigits(String((ve=M==null?void 0:M.price)!=null?ve:""))),w=window.KTM.money.nextPriceInputState(V.target.value,m),L=String((tt=w.digits)!=null?tt:""),Y=Number(L),re=Number.isFinite(Y)?Math.max(0,Math.trunc(Y)):0,ae=Array.isArray(me.variants)?[...me.variants]:[],ge={...ae[p]||{},options:Array.isArray((ee=ae[p])==null?void 0:ee.options)?[...ae[p].options]:[]};return ge.options[G]={...ge.options[G]||{},label:String(((je=ge.options[G])==null?void 0:je.label)||""),price:re,priceDigits:L},ae[p]=ge,{...me,variants:ae}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{O(V=>{var w;const me=Array.isArray(V.variants)?[...V.variants]:[],m={...me[p]||{},options:Array.isArray((w=me[p])==null?void 0:w.options)?[...me[p].options]:[]};return m.options.splice(G,1),me[p]=m,{...V,variants:me}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{O(M=>{var V;const G=Array.isArray(M.variants)?[...M.variants]:[],X={...G[p]||{},options:Array.isArray((V=G[p])==null?void 0:V.options)?[...G[p].options]:[]},H=$e(M.price);return X.options.push({label:"",price:H,priceDigits:String(H)}),G[p]=X,{...M,variants:G}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{O(b=>{const p=$e(b.price),M=Array.isArray(b.variants)?[...b.variants]:[],G=String(p);return M.push({name:"Size",options:[{label:"S",price:p,priceDigits:G},{label:"M",price:p,priceDigits:G},{label:"L",price:p,priceDigits:G}]}),{...b,variants:M}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ce,disabled:!Array.isArray($.variants)||$.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:$.image,onChange:b=>O({...$,image:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:z,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:ne,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ne?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:N,video:x,onClose:A,onSave:z}){const[K,$]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[O,ne]=useState(!1),[le,Z]=useState("");useEffect(()=>{x?($({title:x.title||"",youtube_url:`https://www.youtube.com/watch?v=${x.youtubeId}`,thumbnail_url:x.thumb||"",sort_order:x.sortOrder||0}),Z(x.thumb)):($({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Z(""))},[x,N]);const we=he=>{const Ie=he.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Ie?Ie[1]:null},$e=he=>{$({...K,youtube_url:he});const Ie=we(he);Ie&&Z(`https://img.youtube.com/vi/${Ie}/hqdefault.jpg`)},de=async he=>{he.preventDefault(),ne(!0),await z(K),ne(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:A})),React.createElement("form",{onSubmit:de},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:K.youtube_url,onChange:he=>$e(he.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),le&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:le,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:K.title,onChange:he=>$({...K,title:he.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:K.sort_order,onChange:he=>$({...K,sort_order:parseInt(he.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:K.thumbnail_url,onChange:he=>$({...K,thumbnail_url:he.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:A},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:O},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[N,x]=useState(!1),[A,z]=useState(""),[K,$]=useState(null),[O,ne]=useState("search"),[le,Z]=useState(()=>loadAdminPins()),[we,$e]=useState(()=>loadAdminRecent()),[de,he]=useState(null),[Ie,ce]=useState(""),[_,Re]=useState([]),[Je,He]=useState(null),[fe,Me]=useState(!1),[ke,Ee]=useState(null),[et,mt]=useState(!0),[Se,We]=useState([]),[lt,b]=useState(!1),[p,M]=useState(null),[G,X]=useState(!1),[H,V]=useState(!1),[me,m]=useState(""),[w,L]=useState(()=>loadAdminSettings()),[Y,re]=useState(null),[ae,ge]=useState([]);useEffect(()=>{const o=localStorage.getItem("ktm_admin_session");if(o)try{const I=JSON.parse(o);I.expiry>Date.now()?(x(!0),$(I.user)):localStorage.removeItem("ktm_admin_session")}catch(I){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{N&&Oe()},[N]),useEffect(()=>{const o=()=>{try{const E=document.querySelector(".admin-topbar");if(!E)return;const se=E.getBoundingClientRect(),ye=Math.max(0,Math.round(se.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${ye+10}px`)}catch(E){}};o(),window.addEventListener("resize",o);const I=setTimeout(o,0);return()=>{clearTimeout(I),window.removeEventListener("resize",o)}},[N,O]),useEffect(()=>{var E,se;const o=window.visualViewport,I=()=>{try{const ye=Number(window.innerHeight)||0,P=Number(o==null?void 0:o.height)||ye,Ue=Number(o==null?void 0:o.offsetTop)||0,ct=Math.max(0,Math.round(ye-P-Ue));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${ct}px`)}catch(ye){}};I(),window.addEventListener("resize",I);try{(E=o==null?void 0:o.addEventListener)==null||E.call(o,"resize",I),(se=o==null?void 0:o.addEventListener)==null||se.call(o,"scroll",I)}catch(ye){}return()=>{var ye,P;window.removeEventListener("resize",I);try{(ye=o==null?void 0:o.removeEventListener)==null||ye.call(o,"resize",I),(P=o==null?void 0:o.removeEventListener)==null||P.call(o,"scroll",I)}catch(Ue){}}},[]),useEffect(()=>{if(!N)return;const o=E=>{if(!E)return!1;const se=String(E.tagName||"").toLowerCase();return!!(se==="input"||se==="textarea"||se==="select"||E.isContentEditable)},I=E=>{if(!E||E.ctrlKey||E.metaKey||E.altKey||o(E.target))return;const se=E.key;(se==="/"||se==="N"||se==="n"||se==="Escape"||se==="j"||se==="J"||se==="k"||se==="K")&&(se==="/"&&E.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:se}})))};return document.addEventListener("keydown",I),()=>document.removeEventListener("keydown",I)},[N]),useEffect(()=>{N&&$e(o=>{const I=Array.isArray(o)?o:[],E=[O,...I.filter(se=>se!==O)].slice(0,8);return saveAdminRecent(E),E})},[N]);const ve=o=>{const I=String(o||"").trim();I&&$e(E=>{const se=Array.isArray(E)?E:[],ye=[I,...se.filter(P=>P!==I)].slice(0,8);return saveAdminRecent(ye),ye})},Ve=o=>{const I=String(o||"").trim();I&&Z(E=>{const se=Array.isArray(E)?E:[],P=se.includes(I)?se.filter(Ue=>Ue!==I):[I,...se].slice(0,10);return saveAdminPins(P),P})};useEffect(()=>{if(!N)return;let o=!1;return(async()=>{try{const I=await fetchAdminSettingsFromServer();if(o)return;L(I),saveAdminSettings(I)}catch(I){}})(),()=>{o=!0}},[N]);const tt=async(o,I)=>{z("");try{const E=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:o,password:I},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),se={user:E.user,token:E.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(se)),$(E.user),x(!0)}catch(E){z(E.message)}},ee=()=>{localStorage.removeItem("ktm_admin_session"),x(!1),$(null),Re([]),He(null)},je=(o,I="success",E=null)=>{const se=Date.now()+Math.floor(Math.random()*1e3);if(o&&typeof o=="object"){const P=o;We(Ue=>[...Ue,{id:se,message:String(P.message||""),type:String(P.type||I||"success"),actionLabel:P.actionLabel||null,onAction:typeof P.onAction=="function"?P.onAction:null,durationMs:P.durationMs||null}]);return}const ye=E&&typeof E=="object"?E:null;We(P=>[...P,{id:se,message:String(o||""),type:String(I||"success"),actionLabel:(ye==null?void 0:ye.actionLabel)||null,onAction:typeof(ye==null?void 0:ye.onAction)=="function"?ye.onAction:null,durationMs:(ye==null?void 0:ye.durationMs)||null}])},rt=o=>{We(I=>I.filter(E=>E.id!==o))},Oe=async(o=null)=>{mt(!0);try{const I=o?`${API_BASE}/api/albums?parent_id=${o}`:`${API_BASE}/api/albums?parent_id=root`,E=await window.KTM.api.getJSON(I,"L\u1ED7i t\u1EA3i danh s\xE1ch album");Re(Array.isArray(E)?E:[])}catch(I){console.error(I),je("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}mt(!1)},nt=()=>{Ee(null),Me(!0)},ut=o=>{Le(o),X(!0)},_t=async(o,I="modal")=>{try{const E=ke&&ke.uuid;!E&&Y&&(o.parent_id=Y.uuid);const se=E?`${API_BASE}/api/albums/${ke.uuid||ke.id}`:`${API_BASE}/api/albums`;E?await window.KTM.api.putJSON(se,o,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(se,o,"L\u1ED7i t\u1EA1o"),je(E?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),I==="drawer"?(X(!1),Ee(null),Oe(Y==null?void 0:Y.uuid),E&&p&&M({...p,...o})):(Me(!1),Ee(null),Oe(Y==null?void 0:Y.uuid))}catch(E){je(E.message,"danger")}},wt=o=>{He(o)},y=o=>{if(o==="root")ge([]),re(null),Oe(null);else if(o){const I=ae.findIndex(E=>E.uuid===o.uuid);I>=0&&(ge(ae.slice(0,I+1)),re(o),Oe(o.uuid))}else{const I=[...ae];I.pop();const E=I[I.length-1]||null;ge(I),re(E),Oe(E==null?void 0:E.uuid)}},R=async o=>{const I=`X\xF3a folder "${o.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(I))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${o.uuid||o.id}`,"L\u1ED7i x\xF3a album"),je("\u0110\xE3 x\xF3a","success"),Oe(Y==null?void 0:Y.uuid)}catch(E){je("L\u1ED7i x\xF3a album","danger")}},Le=async o=>{o&&(b(!0),m(""),V(!1),X(!1),M(o))},st=()=>{b(!1),V(!1),m(""),X(!1),M(null)},kt=o=>{X(!0)};if(!N)return React.createElement(LoginPage,{onLogin:tt,error:A});const it=()=>{const o=new Date,I=o.getFullYear(),E=String(o.getMonth()+1).padStart(2,"0");return`${I}-${E}`};function pt(){const[o,I]=useState(()=>{var P;return String((P=w==null?void 0:w.ship_percent)!=null?P:DEFAULT_SHIP_PERCENT)}),[E,se]=useState(!1);return useEffect(()=>{var P;I(String((P=w==null?void 0:w.ship_percent)!=null?P:DEFAULT_SHIP_PERCENT))},[w==null?void 0:w.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async P=>{P.preventDefault(),se(!0);const Ue=saveAdminSettings({ship_percent:o});try{const ct=await saveAdminSettingsToServer(Ue);L(ct),saveAdminSettings(ct),je("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(ct){L(Ue),je("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{se(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:o,min:"0",max:"100",step:"0.01",onChange:P=>I(P.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:E},E?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function S(){const[o,I]=useState(it()),[E,se]=useState(!0),ye=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[P,Ue]=useState(ye),ct=useRef(new Map),Bt=normalizeShipPercent(w==null?void 0:w.ship_percent),{formatNumber:Ae,formatVND:bt}=window.KTM.money,zt=async(pe,Et=!1)=>{var j,v;const Lt=String(pe||"").trim();if(!Lt)return ye();const vt=`${Lt}|${Bt}`,r=(j=ct.current)==null?void 0:j.get(vt);if(!Et&&r)return r;const g=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(Lt)}&ship_percent=${encodeURIComponent(Bt)}`,T=await window.KTM.api.getJSON(g,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),J=T!=null&&T.stats&&(T!=null&&T.meta)?T.stats:T,U=J&&typeof J=="object"?J:ye();return(v=ct.current)==null||v.set(vt,U),U},Dt=async(pe=!1)=>{se(!0);try{const Et=await zt(o,pe);Ue(Et)}catch(Et){console.error("Load stats error:",Et),Ue(ye())}finally{se(!1)}};return useEffect(()=>{Dt()},[o,Bt]),React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:E}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>Dt(!0),disabled:E},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:o,onChange:pe=>I(pe.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",Bt,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),Ae(P.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),Ae(P.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),Ae(P.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",Ae(P.statusCounts.paid),"/",Ae(P.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ae(P.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},bt(P.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},bt(P.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},bt(P.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},bt(P.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",P.avgQtyPerOrder?P.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},Ae(P.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},Ae(P.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},Ae(P.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},Ae(P.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},Ae(P.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},Ae(P.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},Ae(P.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,Ae(P.statusCounts.draft)),React.createElement("td",null,Ae(P.statusCounts.pending)),React.createElement("td",null,Ae(P.statusCounts.processing)),React.createElement("td",null,Ae(P.statusCounts.canceled)),React.createElement("td",null,Ae(P.statusCounts.done)),React.createElement("td",null,Ae(P.statusCounts.paid)),React.createElement("td",null,Ae(P.statusCounts.other)),React.createElement("td",null,Ae(P.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},P.products.slice(0,10).map(pe=>React.createElement("div",{key:pe.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},pe.product_name),React.createElement("div",{className:"text-muted small text-truncate"},pe.product_code?`#${pe.product_code} \u2022 `:"",Ae(pe.orders)," \u0111\u01A1n \u2022 ",Ae(pe.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},bt(pe.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,P.products.slice(0,10).map(pe=>React.createElement("tr",{key:pe.product_id},React.createElement("td",null,pe.product_name),React.createElement("td",null,pe.product_code||"\u2014"),React.createElement("td",null,Ae(pe.orders)),React.createElement("td",null,Ae(pe.quantity)),React.createElement("td",{className:"fw-semibold"},bt(pe.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},P.customers.slice(0,10).map(pe=>React.createElement("div",{key:pe.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},pe.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},pe.phone||"\u2014"," \u2022 ",Ae(pe.orders)," \u0111\u01A1n \u2022 ",Ae(pe.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},bt(pe.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,P.customers.slice(0,10).map(pe=>React.createElement("tr",{key:pe.key},React.createElement("td",null,pe.customer_name||"\u2014"),React.createElement("td",null,pe.phone||"\u2014"),React.createElement("td",null,Ae(pe.orders)),React.createElement("td",null,Ae(pe.quantity)),React.createElement("td",{className:"fw-semibold"},bt(pe.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},P.days.map(pe=>React.createElement("div",{key:pe.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},pe.day),React.createElement("div",{className:"text-muted small"},Ae(pe.orders)," \u0111\u01A1n \u2022 ",Ae(pe.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",Ae(pe.doneOrders)," \u2022 ",bt(pe.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},bt(pe.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,P.days.map(pe=>React.createElement("tr",{key:pe.day},React.createElement("td",null,pe.day),React.createElement("td",null,Ae(pe.orders)),React.createElement("td",null,Ae(pe.quantity)),React.createElement("td",{className:"fw-semibold"},bt(pe.revenue)),React.createElement("td",null,Ae(pe.doneOrders)),React.createElement("td",{className:"fw-semibold"},bt(pe.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:O,onMenuChange:o=>{ve(o),ne(o),o==="albums"&&(re(null),ge([]),Oe(null))},onLogout:ee,currentUser:K,pinnedMenus:le,recentMenus:we,onTogglePin:Ve}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const I={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[O]||{title:"KTM Admin",icon:"fa-tractor",sub:""},E=(K==null?void 0:K.username)||(K==null?void 0:K.name)||(K==null?void 0:K.email)||"Admin",se=(()=>{if(O!=="albums")return"";const ye=[];return ye.push("Root"),Array.isArray(ae)&&ae.length>0&&ye.push(...ae.map(P=>P==null?void 0:P.title).filter(Boolean)),Je!=null&&Je.title&&ye.push(Je.title),ye.length>0?ye.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${I.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},I.title),React.createElement("div",{className:"admin-page-subtitle"},se||I.sub))),React.createElement("div",{className:"admin-topbar-right"},O==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:nt,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:E},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},E)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:ee,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},O==="albums"&&!Je&&React.createElement(AlbumList,{albums:_,loading:et,currentFolder:Y,breadcrumb:ae,onSelect:wt,onCreate:nt,onEdit:ut,onDelete:R,onBack:y}),O==="search"&&React.createElement(SearchCenter,{showToast:je,onNavigate:(o,I,E)=>{ne(o),o==="orders"&&I==="create"&&(he(Date.now()),ce((E==null?void 0:E.productId)||""))}}),O==="albums"&&Je&&React.createElement(AlbumDetail,{album:Je,parentAlbum:ae.length>0?ae[ae.length-1]:null,onBack:()=>{if(Je.parentId){const o=ae.findIndex(I=>I.uuid===Je.parentId);o>=0?He(ae[o]):He(null)}else He(null)},onRefresh:()=>Oe(Y==null?void 0:Y.uuid),showToast:je,onNavigateToFolder:o=>{ge(I=>[...I,Je]),He(o)},onEditSubfolder:o=>{Ee(o),Me(!0)}}),O==="videos"&&React.createElement(VideoList,{showToast:je}),O==="products"&&React.createElement(ProductManager,{showToast:je,settings:w}),O==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:de,autoOpenCreateProductId:Ie,showToast:je}),O==="stats"&&React.createElement(S,null),O==="settings"&&React.createElement(pt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${O==="search"?"active":""}`,onClick:o=>{o.preventDefault(),ne("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${O==="albums"?"active":""}`,onClick:o=>{o.preventDefault(),ne("albums"),He(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${O==="videos"?"active":""}`,onClick:o=>{o.preventDefault(),ne("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${O==="products"?"active":""}`,onClick:o=>{o.preventDefault(),ne("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${O==="orders"?"active":""}`,onClick:o=>{o.preventDefault(),ne("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${O==="stats"?"active":""}`,onClick:o=>{o.preventDefault(),ne("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:fe,album:ke,parentId:Y==null?void 0:Y.uuid,onClose:()=>Me(!1),onSave:_t}),React.createElement(AdminDrawer,{open:lt,title:p?p.title:"Album",subtitle:p?`${p.subfolderCount||0} subfolder \u2022 ${p.count||0} \u1EA3nh`:"",onClose:st,footer:G?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{X(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{p&&(Ee(p),_t({slug:p.id||"",title:p.title||"",description:p.description||"",cover_url:p.cover||"",parent_id:p.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):p?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(p.title),je("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>kt(p)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{p&&confirm(`X\xF3a folder "${p.title}"?`)&&(R(p),st())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},G&&p?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:p.title,onChange:o=>M({...p,title:o.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:p.description,onChange:o=>M({...p,description:o.target.value})}))):p?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},p.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},p.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},p.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},p.count||0))),p.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,p.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Se.map(o=>React.createElement(Toast,{key:o.id,message:o.message,type:o.type,actionLabel:o.actionLabel,onAction:o.onAction,durationMs:o.durationMs,onClose:()=>rt(o.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:N,autoOpenCreateProductId:x,showToast:A}){const[z,K]=useState([]),[$,O]=useState(0),[ne,le]=useState(!1),[Z,we]=useState(!1),[$e,de]=useState([]),[he,Ie]=useState(!0),[ce,_]=useState(!1),[Re,Je]=useState([]),[He,fe]=useState(!1),[Me,ke]=useState(""),[Ee,et]=useState([]),[mt,Se]=useState(!1),[We,lt]=useState(""),[b,p]=useState(!1),[M,G]=useState(null),[X,H]=useState(null),[V,me]=useState(!1),[m,w]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[L,Y]=useState(""),[re,ae]=useState(!1),[ge,ve]=useState(!1),[Ve,tt]=useState(!1),[ee,je]=useState(null),[rt,Oe]=useState(!1),[nt,ut]=useState(""),[_t,wt]=useState(!1),y=useRef(0),[R,Le]=useState(!1),[st,kt]=useState(null),[it,pt]=useState(!1),[S,o]=useState(!1),[I,E]=useState(()=>new Set),[se,ye]=useState(()=>({})),[P,Ue]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),ct=24,Bt=20,[Ae,bt]=useState(ct),zt=useRef(null),Dt=useRef(null),pe=useRef(!1),Et=useRef(new Map),Lt=useRef({timer:null,events:[]}),vt=useRef(null),r="ktm_orders_phone_tip_v1",[g,T]=useState(null),[J,U]=useState(!1),[j,v]=useState([]),[te,be]=useState(!1),[ue,Q]=useState([]),[d,xe]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Be,Ze]=useState([""]),[yt,dt]=useState(null),Nt=useRef({}),[ht,qa]=useState([]),[ze,At]=useState(null),wa=useRef(null),Gt=useRef(null),ua=useRef(0),Mt=useRef(null),D=useRef(0),F=useRef(new Map),q=useRef(null),ie=useRef(0),Ne=useRef(new Map),oe=useRef(new Map),De=useRef(""),Pe=useRef(null),Qe=useRef(null),ot=useRef(0),ft=useRef(null),St=9,Tt=150,$t=250,It=3*60*1e3,Pt=24*60*60*1e3,Kt=5*60*1e3,Rt="ktm_customer_lookup_cache_v1",Xt=200,Ct=3,Qt=3,pa=1,xa=24*60*60*1e3,Ln=120,Rn=5*60*1e3,tn=80,an=2,nn=4,sn=60,_e=React.useMemo(()=>String(Me||"").trim().length>0,[Me]),rn=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),on=e=>{kt(e),Le(!0)},Yt=()=>{Le(!1),setTimeout(()=>kt(null),180)},En=()=>{pt(!0)},ka=()=>{pt(!1)},ln=e=>{const a=String(e||"").trim();a&&E(t=>{const n=new Set(t);return n.has(a)?n.delete(a):n.add(a),n})};useEffect(()=>{var t;let e;const a=()=>{try{Ue(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(n){Ue(!1)}};try{e=(t=window.matchMedia)==null?void 0:t.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",a):e!=null&&e.addListener&&e.addListener(a)}catch(n){e=null}return window.addEventListener("resize",a),a(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",a):e!=null&&e.removeListener&&e.removeListener(a)}catch(n){}window.removeEventListener("resize",a)}},[]),useEffect(()=>{const e="admin-sheet-open";return R||it?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[R,it]),useEffect(()=>{if(!R&&!it)return;const e=a=>{a.key==="Escape"&&(R&&Yt(),it&&ka())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[R,it]);const Pn=()=>{try{if(localStorage.getItem(r))return;localStorage.setItem(r,"1"),typeof A=="function"&&A("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},cn=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),dn=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),mn=e=>{const a=Ye(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{window.location.href=`tel:${a}`}catch(t){}},Kn=async e=>{var t,n,s;const a=Ye(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{await((s=(n=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:n.call(t,a))!=null?s:Promise.reject(new Error("Clipboard not available"))),typeof A=="function"&&A("\u0110\xE3 copy S\u0110T","success")}catch(i){typeof A=="function"&&A("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Fn=(e,a)=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e),pe.current=!1,Pn();try{Dt.current&&clearTimeout(Dt.current)}catch(n){}Dt.current=setTimeout(()=>{pe.current=!0,Kn(a)},520)},Sa=e=>{var a;(a=e==null?void 0:e.stopPropagation)==null||a.call(e);try{Dt.current&&clearTimeout(Dt.current)}catch(t){}Dt.current=null},Hn=e=>{const a=String(e||"").trim();if(!a)return;ye(s=>({...s,[a]:Date.now()}));const t=Et.current;try{const s=t.get(a);s&&clearTimeout(s)}catch(s){}const n=setTimeout(()=>{ye(s=>{const i={...s||{}};return delete i[a],i});try{t.delete(a)}catch(s){}},9e3);t.set(a,n)},un=e=>String(e||"").replace(/\s+/g," ").trim(),Vn=e=>String(e||"").replace(/[^0-9]+/g,""),ba=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/xa)}catch(a){return 0}},Ca=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:ba(e)>=Ct,na=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},Aa=e=>{if(na(e==null?void 0:e.status)!=="draft")return null;const t=Qt-ba(e);return Number.isFinite(t)?t:null},_a=e=>{const a=Aa(e);return Number.isFinite(a)?a>0&&a<=pa:!1},Zt=e=>{xe({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Ze([""]),T(null),dt(null)};useEffect(()=>{const e=a=>{var n;if(yt==null)return;const t=(n=Nt.current)==null?void 0:n[yt];t&&!t.contains(a.target)&&dt(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[yt]);const pn=e=>window.KTM.money.parseMoney(e),bn=e=>window.KTM.money.parseSignedMoney(e),Ge=e=>window.KTM.money.formatVND(e),Ft=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var s,i;return{amount:String((s=n==null?void 0:n.amount)!=null?s:""),note:String((i=n==null?void 0:n.note)!=null?i:"")}});return t.length?t:[{amount:"",note:""}]},qn=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var s,i;return{amount:(n==null?void 0:n.amount)===0?"":String((s=n==null?void 0:n.amount)!=null?s:""),note:String((i=n==null?void 0:n.note)!=null?i:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},sa=e=>(Array.isArray(e)?e:[]).map(t=>({amount:bn(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),Ba=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=sa(a),n=ia(t),s=(()=>{if(!t.length)return"";const i=t.map(h=>String((h==null?void 0:h.note)||"").trim()).filter(Boolean);return i.length?i.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:s}},ia=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),za=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},ds=e=>window.KTM.money.parseShipFeeFromNote(e),ra=e=>window.KTM.phone.isValid(e),Ye=e=>window.KTM.phone.normalize(e),hn=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},Bn=(e,a)=>{var i;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const s=new Map(t.map(h=>{var c;return[String((c=h==null?void 0:h.id)!=null?c:""),h]}));for(const h of n){const c=String((i=h==null?void 0:h.id)!=null?i:"");c&&s.set(c,h)}return Array.from(s.values())},Ma=async e=>{if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const a=await hn(e.id);if(a&&typeof a=="object")return K(t=>Array.isArray(t)?t.map(n=>String(n==null?void 0:n.id)===String(e.id)?a:n):t),a}catch(a){console.error("Fetch order by id error:",a)}return e},zn=()=>{var e;try{const a=localStorage.getItem(Rt);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[s,i]of n)!s||!i||typeof i!="object"||(e=oe.current)==null||e.set(String(s),i)}catch(a){}},Ga=()=>{try{const e=oe.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,s])=>n&&s&&typeof s=="object"&&Number.isFinite(s.ts)).sort((n,s)=>(Number(s[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,Xt),t={};for(const[n,s]of a)t[n]=s;localStorage.setItem(Rt,JSON.stringify(t))}catch(e){}};useEffect(()=>{zn()},[]);const fn=e=>{const a=Ye(e);if(!a)return null;const t=Array.isArray(z)?z:[];let n=null,s=-1;for(const i of t){if(!i||Ye(i.phone||"")!==a)continue;const h=new Date(i.created_at).getTime(),c=Number.isFinite(h)?h:0;c>=s&&(s=c,n=i)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},gn=(e,a)=>{e&&xe(t=>a&&Ye(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Gn=e=>{const a=fn(e);if(!a)return;const t=Ye(e);xe(n=>{if(t&&Ye(n.phone)!==t)return n;const s={...n};return!String(n.customer_name||"").trim()&&a.name&&(s.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(s.address=a.address),s})},Jn=(e,a,t)=>{var n;try{const s=Ye(e);if(!s)return;const i=String(a||"").trim(),h=String(t||"").trim();if(!i&&!h)return;(n=oe.current)==null||n.set(s,{ts:Date.now(),status:"found",customer:{phone:s,name:i||null,address:h||null}}),Ga()}catch(s){}},Ta=async e=>{var s,i,h;const a=Ye(e);if(!a)return;Gn(a);const t=(s=oe.current)==null?void 0:s.get(a);if(t&&Number.isFinite(t.ts)){const c=Date.now()-t.ts,k=t.status==="found"?Pt:Kt;if(c>=0&&c<=k){T({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&gn(t.customer,a);return}}const n=++ua.current;T({status:"loading",phone:a});try{const c=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(ua.current!==n)return;if(c&&c.exists&&c.customer){(i=oe.current)==null||i.set(a,{ts:Date.now(),status:"found",customer:c.customer}),Ga(),T({status:"found",phone:a,customer:c.customer}),gn(c.customer,a);return}(h=oe.current)==null||h.set(a,{ts:Date.now(),status:"not-found",customer:null}),Ga(),T({status:"not-found",phone:a})}catch(c){if(ua.current!==n)return;console.error("Customer lookup error:",c),T({status:"error",phone:a})}},vn=e=>{const a=Ye(e),t=fn(a);xe(s=>{const i={...s,phone:a};return t&&(!String(s.customer_name||"").trim()&&t.name&&(i.customer_name=t.name),!String(s.address||"").trim()&&t.address&&(i.address=t.address)),i}),U(!1),Gt.current&&(clearTimeout(Gt.current),Gt.current=null);const n=a;if(n.length<St){T(null);return}if(ra(n)&&n!==De.current){De.current=n,Ta(n);return}Gt.current=setTimeout(()=>{const s=Ye(a);ra(s)&&s!==De.current&&(De.current=s,Ta(s))},Tt)},yn=()=>{const e=Ye(d.phone);e.length<St||ra(e)&&e!==De.current&&(De.current=e,Ta(e))};useEffect(()=>(ge?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[ge]);const $a=Array.isArray(d.items)?d.items.length:0;useEffect(()=>{if(!ge){ot.current=$a;return}$a>ot.current&&setTimeout(()=>{const e=Pe.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),ot.current=$a},[ge,$a]),useEffect(()=>()=>{Gt.current&&(clearTimeout(Gt.current),Gt.current=null),Mt.current&&(clearTimeout(Mt.current),Mt.current=null)},[]),useEffect(()=>{if(!ge)return;Mt.current&&(clearTimeout(Mt.current),Mt.current=null);const e=Ye((d==null?void 0:d.phone)||"");if(!ra(e)){v([]),be(!1);return}return Mt.current=setTimeout(async()=>{var s;const a=String(e),t=(s=F.current)==null?void 0:s.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=It){v(Array.isArray(t.orders)?t.orders:[]),be(!1);return}const n=++D.current;be(!0);try{const i=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,h=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(D.current!==n)return;const c=Array.isArray(h)?h:Array.isArray(h==null?void 0:h.orders)?h.orders:[];v(c);try{const k=F.current;if(k&&typeof k.set=="function"&&(k.set(a,{ts:Date.now(),orders:c}),k.size>100)){const f=Array.from(k.entries()).sort((u,C)=>{var W,B;return(Number((W=u==null?void 0:u[1])==null?void 0:W.ts)||0)-(Number((B=C==null?void 0:C[1])==null?void 0:B.ts)||0)}),l=Math.max(0,f.length-100);for(let u=0;u<l;u++)k.delete(f[u][0])}}catch(k){}}catch(i){if(D.current!==n)return;console.error("Phone history fetch error:",i),v([])}finally{if(D.current!==n)return;be(!1)}},$t),()=>{Mt.current&&(clearTimeout(Mt.current),Mt.current=null)}},[ge,d==null?void 0:d.phone]),useEffect(()=>{Wn()},[]),useEffect(()=>{_e||ea()},[m,_e]),useEffect(()=>{Oa()},[]),useEffect(()=>{N&&wa.current!==N&&(wa.current=N,Da(x))},[N]);const Ht=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",oa=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",Nn=React.useMemo(()=>window.KTM.orders.sortOrders(z),[z]),Ja=React.useMemo(()=>window.KTM.orders.sortOrders($e),[$e]),Ia=React.useMemo(()=>{const a=(Array.isArray(Ja)?Ja:[]).filter(t=>Ca(t));return a.sort((t,n)=>{const s=new Date(t==null?void 0:t.created_at).getTime(),i=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(s)?s:0)-(Number.isFinite(i)?i:0)}),a},[Ja]),wn=React.useMemo(()=>{const a=(Array.isArray(Re)?Re:[]).filter(t=>_a(t));return a.sort((t,n)=>{const s=new Date(t==null?void 0:t.created_at).getTime(),i=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(s)?s:0)-(Number.isFinite(i)?i:0)}),a},[Re]),ha=React.useMemo(()=>re?Ia:Nn,[re,Ia,Nn]),ja=React.useMemo(()=>{if(re)return ha;const e=String(L||"").trim();return e?(Array.isArray(ha)?ha:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):ha},[ha,L,re]),xn=React.useMemo(()=>window.KTM.orders.sortOrders(Ee),[Ee]),gt=React.useMemo(()=>_e?xn:ja,[ja,_e,xn]),kn=React.useMemo(()=>{const e=Array.isArray(gt)?gt:[];return P?e.slice(0,Math.max(0,Number(Ae)||0)):e},[P,Ae,gt]);useEffect(()=>{P&&bt(ct)},[P,L,re,m,Me]),useEffect(()=>{if(!P)return;const e=Array.isArray(gt)?gt.length:0;if(Ae>=e)return;const a=zt.current;if(!a)return;const t=new IntersectionObserver(n=>{Array.isArray(n)&&n.some(i=>i==null?void 0:i.isIntersecting)&&bt(i=>Math.min((Number(i)||0)+Bt,e))},{root:null,rootMargin:"520px 0px",threshold:0});return t.observe(a),()=>t.disconnect()},[P,Ae,gt]),useEffect(()=>{if(!P){o(!1);return}const e=()=>{vt.current||(vt.current=window.requestAnimationFrame(()=>{vt.current=null;const a=window.scrollY||document.documentElement.scrollTop||0;o(a>140)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),vt.current&&(window.cancelAnimationFrame(vt.current),vt.current=null)}},[P]),useEffect(()=>{if(!P){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(a){}return}const e=()=>{try{const a=document.querySelector(".mobile-bottom-nav"),t=a&&a.offsetHeight?a.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${t}px`)}catch(a){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[P]);const Jt=React.useMemo(()=>{const e=Array.isArray(gt)?gt:[],a={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const n=na(t==null?void 0:t.status);n==="draft"?a.draft+=1:n==="pending"?a.pending+=1:n==="processing"?a.processing+=1:n==="done"?a.done+=1:n==="paid"?a.paid+=1:n==="canceled"?a.canceled+=1:a.other+=1}return a},[gt]),Sn=React.useMemo(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`},[]),Wt=e=>{if(_e&&ke(""),e==="thisMonth"){ae(!1),Y(""),w(Sn);return}if(e==="overduePending"){w(""),ae(!0),Y("pending");return}if(e==="draftExpiring"){ae(!1),Y("draft"),w(""),Oa();return}if(e==="all"){ae(!1),Y(""),w(Sn);return}},la=e=>window.KTM.date.formatDateTime(e),Wn=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");qa(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),qa([])}},ea=async()=>{Ie(!0),we(!1);try{const a=new URLSearchParams;m&&a.set("month",String(m)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(sn)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),s=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],i=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;K(Array.isArray(s)?s:[]),O(Array.isArray(s)?s.length:0),le(!!(i!=null&&i.hasMore)),Oa()}catch(a){console.error("Load orders error:",a),K([]),O(0),le(!1)}finally{Ie(!1),we(!1)}},Un=async()=>{if(!(he||Z||_e)&&ne){we(!0);try{const e=new URLSearchParams;m&&e.set("month",String(m)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(sn)),e.set("offset",String($));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],s=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;K(i=>Bn(i,Array.isArray(n)?n:[])),O(i=>i+(Array.isArray(n)?n.length:0)),le(!!(s!=null&&s.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{we(!1)}}},Cn=async e=>{var s;const a=un(e);if(!a){et([]),lt(""),Se(!1);return}const t=Vn(a);if(a.length<an&&t.length<nn){et([]),lt(`Nh\u1EADp \xEDt nh\u1EA5t ${an} k\xFD t\u1EF1 (ho\u1EB7c ${nn} s\u1ED1) \u0111\u1EC3 search nhanh`),Se(!1);return}try{const i=(s=Ne.current)==null?void 0:s.get(a);if(i&&Number.isFinite(i.ts)&&Date.now()-i.ts<=Rn){et(Array.isArray(i.results)?i.results:[]),lt(""),Se(!1);return}}catch(i){}const n=++ie.current;Se(!0),lt("");try{const i=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,h=await window.KTM.api.getJSON(i,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(ie.current!==n)return;const c=Array.isArray(h)?h:[];et(c);try{const k=Ne.current;if(k&&typeof k.set=="function"&&(k.set(a,{ts:Date.now(),results:c}),k.size>tn)){const f=Array.from(k.entries()).sort((u,C)=>{var W,B;return(Number((W=u==null?void 0:u[1])==null?void 0:W.ts)||0)-(Number((B=C==null?void 0:C[1])==null?void 0:B.ts)||0)}),l=Math.max(0,f.length-tn);for(let u=0;u<l;u++)k.delete(f[u][0])}}catch(k){}}catch(i){if(ie.current!==n)return;console.error("Order search error:",i),et([]),lt((i==null?void 0:i.message)||"Search l\u1ED7i")}finally{if(ie.current!==n)return;Se(!1)}};useEffect(()=>{q.current&&(clearTimeout(q.current),q.current=null);const e=un(Me);if(!e){et([]),lt(""),Se(!1);return}return re&&ae(!1),q.current=setTimeout(()=>{Cn(e)},Ln),()=>{q.current&&(clearTimeout(q.current),q.current=null)}},[Me]);const Oa=async()=>{_(!0),fe(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Ct)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(pa)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);de(Array.isArray(e)?e:[]),Je(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),de([]),Je([])}finally{_(!1),fe(!1)}},Wa=async e=>{const a=await Ma(e);if(!a)return;At(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(c=>{var k,f,l,u;return{product_id:(c==null?void 0:c.product_id)||"",quantity:Number((k=c==null?void 0:c.quantity)!=null?k:1)||1,unit_price:(()=>{var B;const C=(B=c==null?void 0:c.unit_price)!=null?B:c==null?void 0:c.unitPrice,W=C==null||C===""?NaN:Number(C);return Number.isFinite(W)?Math.trunc(W):null})(),variant:String((f=c==null?void 0:c.variant)!=null?f:"").trim(),variant_json:(u=(l=c==null?void 0:c.variant_json)!=null?l:c==null?void 0:c.variantJson)!=null?u:null}}).filter(c=>c.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=qn(a),s=sa(n),i=ia(s),h=za(s);xe({customer_name:a.customer_name||"",phone:Ye(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:i,adjustment_note:h||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),Ze(new Array(t.length?t.length:1).fill("")),Q(new Array(t.length?t.length:1).fill(!0)),T(null),ve(!1),je(a),tt(!0),ut(""),Oe(!1),wt(!0),a.phone&&Ta(Ye(a.phone))},fa=async e=>{if(!e)return;tt(!0),ut(""),Oe(!0),wt(!1),je(e);const a=++y.current;try{const t=await Ma(e);if(y.current!==a)return;je(t||e)}catch(t){if(y.current!==a)return;ut((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(y.current!==a)return;Oe(!1)}},Xn=()=>{b||V||(tt(!1),Oe(!1),ut(""),wt(!1),At(null),Zt(""),U(!1),Q([]))};function Da(e){tt(!1),wt(!1),Oe(!1),ut(""),At(null),Zt(e||""),U(!1),Q([]),ve(!0)}const Ua=()=>{b||V||(ve(!1),At(null),Zt(""),U(!1),Q([]))},An=async()=>{var c,k,f;if(!ze||V||b)return;const e=(Array.isArray(z)?z:[]).find(l=>String(l==null?void 0:l.id)===String(ze))||null,a=String((e==null?void 0:e.status)||(d==null?void 0:d.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const l="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof A=="function"?A(l,"warning"):alert(l);return}const t=Ye(d.phone),s=(Array.isArray(d.items)?d.items:[]).map((l,u)=>{var C,W;return{idx:u,product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((C=l==null?void 0:l.quantity)!=null?C:0),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(W=l==null?void 0:l.variant_json)!=null?W:null,unit_price:(()=>{const B=l==null?void 0:l.unit_price,Te=B===""||B==null?NaN:Number(B);if(Number.isFinite(Te))return Math.max(0,Math.trunc(Te));const Ce=jt(l==null?void 0:l.product_id),at=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return ca(Ce,at)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);if(s.length<2){const l="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof A=="function"?A(l,"warning"):alert(l);return}const i=[],h=[];for(const l of s){const u=!!ue[l.idx],C={product_id:l.product_id,quantity:l.quantity,unit_price:l.unit_price,variant:l.variant,variant_json:l.variant_json};u?i.push(C):h.push(C)}if(!i.length||!h.length){const l="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof A=="function"?A(l,"warning"):alert(l);return}me(!0);try{const l=Array.isArray(d==null?void 0:d.adjustment_items)?d.adjustment_items:[],u=sa(l),C=ia(u),W=za(u),B={customer_name:d.customer_name,phone:t,address:d.address,note:(d.note||"").trim(),adjustment_amount:C,adjustment_note:W,adjustment_items:u,status:"processing",items:i,product_id:i[0].product_id,quantity:i[0].quantity,split_seq:1},Te=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,B,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),Ce=(f=(k=Te==null?void 0:Te.id)!=null?k:(c=Te==null?void 0:Te.order)==null?void 0:c.id)!=null?f:null;if(!Ce)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const at={id:ze,customer_name:d.customer_name,phone:t,address:d.address,note:(d.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:h,product_id:h[0].product_id,quantity:h[0].quantity,parent_order_id:String(Ce),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${ze}`,at,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Ua(),ea();const Ke=Ce?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${Ce}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof A=="function"?A(Ke,"success"):alert(Ke)}catch(l){console.error(l);const u=(l==null?void 0:l.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof A=="function"?A(u,"danger"):alert(u)}finally{me(!1)}},_n=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=ht.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Vt=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},Qn=e=>{const t=Vt(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},Mn=React.useMemo(()=>(Array.isArray(ht)?ht:[]).map((e,a)=>{var f,l,u,C,W,B;const t=Vt((f=e==null?void 0:e.name)!=null?f:""),n=Vt((l=e==null?void 0:e.code)!=null?l:""),s=Vt((u=e==null?void 0:e.category)!=null?u:""),i=Vt((C=e==null?void 0:e.note)!=null?C:""),h=Vt((W=e==null?void 0:e.id)!=null?W:""),c=Vt((B=e==null?void 0:e.stt)!=null?B:""),k=`${t} ${n} ${s} ${i} ${h} ${c}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:s,note:i,haystackAll:k}}),[ht]),Yn=(e,a,t)=>{var u,C,W,B,Te;const n=Array.isArray(a)?a:[],s=Vt(t).trim();if(!n.length&&!s)return 0;const i=(u=e==null?void 0:e.name)!=null?u:"",h=(C=e==null?void 0:e.code)!=null?C:"",c=(W=e==null?void 0:e.category)!=null?W:"",k=(B=e==null?void 0:e.note)!=null?B:"";if(!((Te=e==null?void 0:e.haystackAll)!=null?Te:""))return 0;let l=0;s&&(i===s&&(l+=220),i.includes(s)&&(l+=140),i.startsWith(s)&&(l+=160),h&&h===s&&(l+=180),h&&h.includes(s)&&(l+=90));for(const Ce of n){if(!Ce)continue;const at=new RegExp(`(?:^|\\s)${Ce.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);i.includes(Ce)&&(l+=35),at.test(i)&&(l+=25),h&&h.includes(Ce)&&(l+=20),h&&at.test(h)&&(l+=10),c&&c.includes(Ce)&&(l+=12),k&&k.includes(Ce)&&(l+=6)}return l>0&&i&&(l+=Math.max(0,10-Math.min(10,Math.floor(i.length/10)))),l},Xa=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const s=t.length,i=n.length;if(i>s)return Xa(n,t);let h=new Array(i+1),c=new Array(i+1);for(let k=0;k<=i;k++)h[k]=k;for(let k=1;k<=s;k++){c[0]=k;const f=t.charCodeAt(k-1);for(let u=1;u<=i;u++){const C=f===n.charCodeAt(u-1)?0:1;c[u]=Math.min(h[u]+1,c[u-1]+1,h[u-1]+C)}const l=h;h=c,c=l}return h[i]},Zn=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const s=n.split(/\s+/).filter(Boolean);if(!s.length)return!1;const i=t.length<=4?1:2;for(const h of s)if(!(Math.abs(h.length-t.length)>i)&&Xa(t,h)<=i)return!0;return!1},La=e=>{const a=Vt(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},es=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=La((e==null?void 0:e.name)||""),s=La((e==null?void 0:e.code)||""),i=La((e==null?void 0:e.category)||""),h=La((e==null?void 0:e.note)||""),c=(f,l,u)=>{const C=String(f||"").trim();if(!C||!l.length)return 0;const W=C.length<=4?1:2;let B=1/0,Te=-1;for(let Ke=0;Ke<l.length;Ke++){const Ot=l[Ke];if(!Ot||Math.abs(Ot.length-C.length)>W)continue;const Xe=Xa(C,Ot);if(Xe<B&&(B=Xe,Te=Ke,Xe===0))break}if(B===1/0||B>W)return 0;let at=Math.round(u*(B===0?1:B===1?.65:.45));return Te===0?at+=Math.round(u*.25):Te===1&&(at+=Math.round(u*.12)),at};let k=0;for(const f of t){if(!f)continue;const l=c(f,n,180),u=c(f,s,120),C=c(f,i,60),W=c(f,h,30);k+=Math.max(l,u,C,W)}if(k>0){const f=((e==null?void 0:e.name)||"").length;k+=Math.max(0,60-Math.min(60,Math.floor(f/2)))}return k},Qa=React.useRef(new Map);React.useEffect(()=>{Qa.current=new Map},[ht]);const Tn=e=>{var f,l;const a=String(Be[e]||"").trim();if(!a)return ht;const{contentTokens:t,cleanedQuery:n}=Qn(a);if(t.length===0)return ht;const s=Vt(a).trim(),i=Qa.current.get(s);if(i)return i;const h=[];for(const u of Mn){const C=u.haystackAll;C&&t.some(W=>C.includes(W))&&h.push(u)}let c=h;if(c.length<8&&t.length>0){const u=[],C=new Set(c.map(W=>{var B,Te;return String((Te=(B=W.p)==null?void 0:B.id)!=null?Te:"")+":"+String(W.originalIndex)}));for(const W of Mn){const B=String((l=(f=W.p)==null?void 0:f.id)!=null?l:"")+":"+String(W.originalIndex);if(C.has(B))continue;const Te=W.haystackAll;Te&&t.some(Ce=>Zn(Ce,Te))&&(u.push(W),C.add(B))}u.length&&(c=c.concat(u))}const k=c.map(u=>({entry:u,score:Yn(u,t,n)})).map(u=>{if(u.score>0)return u;const C=es(u.entry,t);return C>0?{...u,score:C}:u}).filter(u=>u.score>0).sort((u,C)=>C.score!==u.score?C.score-u.score:u.entry.originalIndex-C.entry.originalIndex).slice(0,40).map(u=>u.entry.p);return Qa.current.set(s,k),k},jt=e=>{if(!e)return null;const a=String(e);return ht.find(t=>String(t==null?void 0:t.id)===a)||null},Ut=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var h;if(!t||typeof t!="object")return null;const s=String((h=t.name)!=null?h:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,i=(Array.isArray(t.options)?t.options:[]).map(c=>{var Te,Ce,at,Ke,Ot,Xe,qt;if(!c||typeof c!="object")return null;const k=String((Te=c.label)!=null?Te:"").trim();if(!k)return null;const f=(Ot=(Ke=(at=(Ce=c.price)!=null?Ce:c.priceValue)!=null?at:c.unit_price)!=null?Ke:c.unitPrice)!=null?Ot:null,l=f==null||f===""?NaN:typeof f=="number"?f:typeof f=="string"?pn(f):Number(f),u=Number.isFinite(l)?Math.trunc(l):null,C=(qt=(Xe=c.price_delta)!=null?Xe:c.priceDelta)!=null?qt:null,W=Number(C),B=Number.isFinite(W)?Math.trunc(W):0;return{label:k,price:u,price_delta:B}}).filter(Boolean);return{name:s,options:i}}).filter(Boolean):[]},ms=e=>{const a=jt(e);return Ut(a==null?void 0:a.variants)},Ra=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const s=String(t||"").trim(),i=String(n||"").trim();!s||!i||a.push(`${s}: ${i}`)}return a.join(", ")},ca=(e,a)=>{const t=pn(e==null?void 0:e.price),n=Ut(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let s=t,i=!1;for(const h of n){const c=String((h==null?void 0:h.name)||"").trim(),k=String((a==null?void 0:a[c])||"").trim();if(!c||!k)continue;const f=(Array.isArray(h.options)?h.options:[]).find(B=>String((B==null?void 0:B.label)||"").trim()===k);if(!f)continue;const l=f==null?void 0:f.price,u=l==null||l===""?NaN:Number(l);if(Number.isFinite(u)){s=Math.max(0,Math.trunc(u)),i=!0;continue}const C=f==null?void 0:f.price_delta,W=C==null||C===""?NaN:Number(C);Number.isFinite(W)&&(s+=Math.trunc(W))}return s},Ya=e=>window.KTM.orders.getOrderItems(e),$n=e=>window.KTM.orders.getOrderTotalQty(e),da=e=>window.KTM.orders.getOrderProductSummary(e,jt),Ea=e=>window.KTM.orders.getOrderItemRows(e,jt),ga=e=>window.KTM.orders.getOrderAdjustmentMoney(e),ta=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),ts=e=>{const a=Ya(e),t=Ea(e),n=ya(a),s=va(a),i=s.fee,h=ga(e),c=n+i+h,k=l=>{const u=Number(l)||0;return u>0?`+${Ge(u)}`:Ge(u)},f=[];if(e!=null&&e.customer_name&&f.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&f.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&f.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&f.push(`GHI CH\xDA: ${(e.note||"").trim()}`),f.push(""),f.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const l of t)f.push(`- ${l.name} (SL: ${l.qty})`);else{const l=da(e);l&&l!=="\u2014"&&f.push(`- ${l}`)}f.push(""),f.push(`T\u1EA0M T\xCDNH: ${Ge(n)}`),s.found&&i!==0&&f.push(`SHIP: ${Ge(i)}`);{const l=window.KTM.orders.getOrderAdjustmentItems(e),u=(Array.isArray(l)?l:[]).map(B=>{var Te;return{amount:Number((Te=B==null?void 0:B.amount)!=null?Te:0)||0,note:String((B==null?void 0:B.note)||"").trim()}}).filter(B=>B.amount!==0||!!B.note),C=ta(e);if(h!==0||u.length>0||!!C)if(u.length===1){const B=u[0];f.push(`\u0110I\u1EC0U CH\u1EC8NH: ${k(h)}${B.note?` \u2014 ${B.note}`:""}`)}else{f.push(`\u0110I\u1EC0U CH\u1EC8NH: ${k(h)}${!u.length&&C?` \u2014 ${C}`:""}`);for(const B of u)f.push(`- ${k(B.amount)}${B.note?`: ${B.note}`:""}`)}}return f.push(`T\u1ED4NG: ${Ge(c)}`),f.filter(Boolean).join(`
`)},Pa=async e=>{try{const a=await Ma(e),t=ts(a);await window.KTM.clipboard.writeText(t),typeof A=="function"?A("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof A=="function"?A("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},va=e=>window.KTM.orders.getOrderShipInfo(e,jt),ya=e=>window.KTM.orders.getItemsSubtotal(e,jt),Za=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},en=()=>m?String(m):Za(new Date),In=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Ye((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),s=Ba(e).amount,h=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(c=>{var k;return{product_id:String((c==null?void 0:c.product_id)||"").trim(),quantity:Number((k=c==null?void 0:c.quantity)!=null?k:0),variant:String((c==null?void 0:c.variant)||"").trim()}}).filter(c=>c.product_id&&Number.isFinite(c.quantity)&&c.quantity>0).sort((c,k)=>c.product_id<k.product_id?-1:c.product_id>k.product_id?1:c.variant<k.variant?-1:c.variant>k.variant?1:c.quantity-k.quantity);return JSON.stringify({name:a,phone:t,address:n,items:h,adj:s})},xt=React.useMemo(()=>{const e=Ye((d==null?void 0:d.phone)||"");if(!e)return{count:0,orders:[],monthKey:en()};const a=en(),n=(Array.isArray(j)?j:[]).filter(s=>{if(!s||ze&&String(s.id)===String(ze)||Ye(s.phone||"")!==e)return!1;const i=Za(s.created_at);return i&&i===a}).sort((s,i)=>{const h=new Date(s.created_at).getTime(),c=new Date(i.created_at).getTime();return(Number.isFinite(c)?c:0)-(Number.isFinite(h)?h:0)});return{count:n.length,orders:n,monthKey:a}},[j,d==null?void 0:d.phone,m,ze]),as=e=>{var c;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Ye((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),s=bn((c=e==null?void 0:e.adjustment_amount)!=null?c:0),i=Ya(e),h=(Array.isArray(i)?i:[]).map(k=>{var f;return{product_id:String((k==null?void 0:k.product_id)||"").trim(),quantity:Number((f=k==null?void 0:k.quantity)!=null?f:0),variant:String((k==null?void 0:k.variant)||"").trim()}}).filter(k=>k.product_id&&Number.isFinite(k.quantity)&&k.quantity>0).sort((k,f)=>k.product_id<f.product_id?-1:k.product_id>f.product_id?1:k.variant<f.variant?-1:k.variant>f.variant?1:k.quantity-f.quantity);return JSON.stringify({name:a,phone:t,address:n,items:h,adj:s})},jn=React.useMemo(()=>{if(ze)return"";const e=Ye((d==null?void 0:d.phone)||"");if(!e)return"";const a=en(),t=In(d),n=Array.isArray(j)?j:[];for(const s of n){if(!s||ze&&String(s.id)===String(ze)||Ye(s.phone||"")!==e)continue;const i=Za(s.created_at);if(!i||i!==a)continue;const h=as(s);if(h&&h===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${s!=null&&s.id?` (#${s.id})`:""}`}return""},[j,d,m,ze]),On=e=>{var Ot;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),s=Ye((e==null?void 0:e.phone)||""),i=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),s||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),s&&!ra(s)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),i||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const c=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Xe=>Xe&&Xe.product_id);c.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),c.some(Xe=>{var aa;const qt=Number((aa=Xe==null?void 0:Xe.quantity)!=null?aa:0);return!Number.isFinite(qt)||qt<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const f=new Set;let l=!1;for(const Xe of c){const qt=String(Xe.product_id||"").trim(),aa=String((Xe==null?void 0:Xe.variant)||"").trim();if(!qt)continue;const qe=`${qt}||${aa}`;if(f.has(qe)){l=!0;break}f.add(qe)}l&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const u=ya(c),C=va(c),W=C!=null&&C.found?Number((Ot=C==null?void 0:C.fee)!=null?Ot:0):0,B=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],Te=sa(B),Ce=ia(Te),at=Te.some(Xe=>(Number(Xe==null?void 0:Xe.amount)||0)!==0&&!String((Xe==null?void 0:Xe.note)||"").trim());C!=null&&C.found&&(W>=2e5||u>0&&W>u*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(W)}`),at&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Ke=Math.abs(Ce);return(Ke>=5e5||u>0&&Ke>u*.5)&&Ce!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(Ce)}`),{errors:a,warnings:t,canSubmit:a.length===0}},us=React.useMemo(()=>On(d),[d,ht]),Fe=React.useMemo(()=>{var aa;const e=String((d==null?void 0:d.customer_name)||"").trim(),a=Ye((d==null?void 0:d.phone)||""),t=String((d==null?void 0:d.address)||"").trim(),n=Array.isArray(d==null?void 0:d.items)?d.items:[],s=new Map;for(const qe of n){const ma=String((qe==null?void 0:qe.product_id)||"").trim(),Ha=String((qe==null?void 0:qe.variant)||"").trim();if(!ma)continue;const Va=`${ma}||${Ha}`;s.set(Va,(s.get(Va)||0)+1)}const i=n.map(qe=>{var Dn;const ma=String((qe==null?void 0:qe.product_id)||"").trim(),Ha=Number((Dn=qe==null?void 0:qe.quantity)!=null?Dn:0),Va=ma?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",rs=Number.isFinite(Ha)&&Ha>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",os=String((qe==null?void 0:qe.variant)||"").trim(),ls=`${ma}||${os}`,cs=ma&&(s.get(ls)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Va,qtyError:rs,dupWarn:cs}}),h=n.filter(qe=>qe&&qe.product_id),c=ya(h),k=va(h),f=k!=null&&k.found?Number((aa=k==null?void 0:k.fee)!=null?aa:0):0,l=Array.isArray(d==null?void 0:d.adjustment_items)?d.adjustment_items:[],u=sa(l),C=ia(u),W=u.some(qe=>(Number(qe==null?void 0:qe.amount)||0)!==0&&!String((qe==null?void 0:qe.note)||"").trim()),B=Math.abs(C),Te=W?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Ce=C!==0&&(B>=5e5||c>0&&B>c*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(C)}`:"",at=k!=null&&k.found&&(f>=2e5||c>0&&f>c*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(f)}`:"",Ke=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Ot=a?ra(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Xe=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",qt=!Ke&&!Ot&&i.every(qe=>!qe.productError&&!qe.qtyError);return{nameError:Ke,phoneError:Ot,addressWarn:Xe,items:i,shipAbnormalWarn:at,adjustmentNoteWarn:Te,adjustmentAbnormalWarn:Ce,canSubmit:qt}},[d,ht]),Ka=async e=>{var c,k,f;const a=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",n=On(d);if(!n.canSubmit){const l=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof A=="function"?A(l,"danger"):alert(l);return}if(!ze&&jn){const l=`${jn}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(l)){(xt==null?void 0:xt.count)>0&&U(!0),setTimeout(()=>{var W;const C=document.getElementById("order-phone-input");C&&typeof C.scrollIntoView=="function"&&(C.scrollIntoView({block:"center",behavior:"smooth"}),(W=C.focus)==null||W.call(C))},0);return}}const s=Ye(d.phone),h=(Array.isArray(d.items)?d.items:[]).map(l=>{var u,C;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((u=l==null?void 0:l.quantity)!=null?u:1),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(C=l==null?void 0:l.variant_json)!=null?C:null,unit_price:(()=>{const W=l==null?void 0:l.unit_price,B=W===""||W==null?NaN:Number(W);if(Number.isFinite(B))return Math.max(0,Math.trunc(B));const Te=jt(l==null?void 0:l.product_id),Ce=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return ca(Te,Ce)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);p(!0);try{const l=ze,u=ze?`${API_BASE}/api/orders/${ze}`:`${API_BASE}/api/orders`,C=h[0],W=Array.isArray(d==null?void 0:d.adjustment_items)?d.adjustment_items:[],B=sa(W),Te=ia(B),Ce=za(B),at={customer_name:d.customer_name,phone:s,address:d.address,note:(d.note||"").trim(),adjustment_amount:Te,adjustment_note:Ce,adjustment_items:B,product_id:C.product_id,quantity:C.quantity,status:d.status,items:h,...ze?{id:ze}:{}};if(ze)await window.KTM.api.putJSON(u,at,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Ke=await window.KTM.api.postJSON(u,at,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");ft.current={id:(f=(k=Ke==null?void 0:Ke.id)!=null?k:(c=Ke==null?void 0:Ke.order)==null?void 0:c.id)!=null?f:null,fingerprint:In(d),ts:Date.now()}}if(Jn(s,d.customer_name,d.address),t==="drawer"){if(Zt(""),At(null),ve(!1),wt(!1),U(!1),Q([]),ea(),l){Oe(!0),ut("");try{const Ke=await hn(l);Ke&&typeof Ke=="object"&&je(Ke)}catch(Ke){ut((Ke==null?void 0:Ke.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Oe(!1)}}}else a==="new"&&!ze?(Zt(""),At(null),ve(!0)):(Zt(""),At(null),ve(!1)),ea()}catch(l){console.error(l),typeof A=="function"?A(l.message,"danger"):alert(l.message);return}finally{p(!1)}},Na=e=>window.KTM.orders.getOrderTotalMoney(e,jt),ps=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){G(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),ea(),Oa()}catch(a){console.error(a),typeof A=="function"?A(a.message,"danger"):alert(a.message)}finally{G(null)}}},ns=()=>{const e=Lt.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(i){}e.timer=null}const a=Array.isArray(e.events)?e.events.splice(0):[];if(!a.length||typeof A!="function")return;const t=new Map;for(const i of a){const h=String((i==null?void 0:i.orderId)||"").trim();h&&t.set(h,i)}const n=Array.from(t.values());if(!n.length)return;const s=i=>async()=>{try{for(const h of i)!(h!=null&&h.prevStatus)||!(h!=null&&h.orderId)||await Fa({id:h.orderId,status:h.nextStatus},h.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});A(i.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${i.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(h){A("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(n.length===1){const i=n[0],h=`${Ht(i.prevStatus)} \u2192 ${Ht(i.nextStatus)}`.trim();A(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${h}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:s([i])});return}A(`\u0110\xE3 c\u1EADp nh\u1EADt ${n.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:s(n)})},ss=e=>{const a=Lt.current;a&&(Array.isArray(a.events)||(a.events=[]),a.events.push(e),!a.timer&&(a.timer=setTimeout(()=>ns(),320)))};useEffect(()=>()=>{try{const e=Lt.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Fa=async(e,a,t={})=>{var h;const n=await Ma(e),s=n==null?void 0:n.id;if(!s||!a)return;const i=na(n==null?void 0:n.status);H(s);try{const c=Ya(n),k=(Array.isArray(c)?c:[]).map(u=>{var C,W;return{product_id:(u==null?void 0:u.product_id)||"",quantity:Number((C=u==null?void 0:u.quantity)!=null?C:1),variant:String((u==null?void 0:u.variant)||"").trim()||null,variant_json:(W=u==null?void 0:u.variant_json)!=null?W:null,unit_price:(()=>{var Ce;const B=(Ce=u==null?void 0:u.unit_price)!=null?Ce:u==null?void 0:u.unitPrice,Te=Number(B);return Number.isFinite(Te)?Math.max(0,Math.trunc(Te)):null})()}}).filter(u=>u.product_id&&Number.isFinite(u.quantity)&&u.quantity>0);if(!k.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const f=k[0],l={id:s,customer_name:(n==null?void 0:n.customer_name)||"",phone:Ye((n==null?void 0:n.phone)||""),address:(n==null?void 0:n.address)||"",note:((n==null?void 0:n.note)||"").trim(),adjustment_amount:Number((h=n==null?void 0:n.adjustment_amount)!=null?h:0)||0,adjustment_note:(n==null?void 0:n.adjustment_note)||"",product_id:f.product_id,quantity:f.quantity,status:a,items:k};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${s}`,l,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),K(u=>Array.isArray(u)?u.map(C=>(C==null?void 0:C.id)===s?{...C,status:a}:C):u),de(u=>Array.isArray(u)?u.map(C=>(C==null?void 0:C.id)===s?{...C,status:a}:C):u),Hn(s),t!=null&&t.silentToast)return;if(t!=null&&t.skipToastBatch){typeof A=="function"&&A("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}ss({orderId:s,prevStatus:i,nextStatus:na(a)})}catch(c){console.error(c),typeof A=="function"?A(c.message,"danger"):alert(c.message)}finally{H(null)}};useEffect(()=>{const e=a=>{var n;const t=(n=a==null?void 0:a.detail)==null?void 0:n.key;if(t){if(t==="/"){setTimeout(()=>{var s,i;(i=(s=Qe.current)==null?void 0:s.focus)==null||i.call(s)},0);return}if(t==="N"||t==="n"){Da();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&Ve&&(ee!=null&&ee.id)){const s=Array.isArray(gt)?gt:[],i=s.findIndex(k=>String(k==null?void 0:k.id)===String(ee==null?void 0:ee.id));if(i<0)return;const c=s[i+(t==="j"||t==="J"?-1:1)];c&&fa(c)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[gt,Ve,ee]);const is=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:d.customer_name,onChange:e=>xe({...d,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Fe.nameError&&React.createElement("div",{className:"form-text text-danger"},Fe.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:d.phone,onChange:e=>vn(e.target.value),onBlur:yn,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Fe.phoneError&&React.createElement("div",{className:"form-text text-danger"},Fe.phoneError),!Fe.phoneError&&xt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",xt.count," \u0111\u01A1n trong th\xE1ng ",xt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>U(e=>!e)},J?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),J&&xt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>U(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},xt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${oa(e.status)}`},Ht(e.status))),React.createElement("div",{className:"text-muted small"},la(e.created_at)," \u2022 ",Ge(Na(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},da(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Wa(e)}},"M\u1EDF")))),xt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(g==null?void 0:g.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(g==null?void 0:g.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(g==null?void 0:g.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(g==null?void 0:g.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:d.status,onChange:e=>xe({...d,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:d.address,onChange:e=>xe({...d,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Fe.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:d.note,onChange:e=>xe({...d,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{xe(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Ft(d.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;xe(s=>{const i=Ft(s.adjustment_items);return i[a]={...i[a],amount:n},{...s,adjustment_items:i}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;xe(s=>{const i=Ft(s.adjustment_items);return i[a]={...i[a],note:n},{...s,adjustment_items:i}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{xe(t=>{const n=Ft(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:b||Ft(d.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Fe.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.adjustmentAbnormalWarn),!!Fe.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{xe(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Ze(e=>[...Array.isArray(e)?e:[],""]),ze&&Q(e=>[...Array.isArray(e)?e:[],!0])},disabled:b},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(d.items)?d.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Nt.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{dt(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},_n(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),yt===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:Be[a]||"",onChange:t=>{const n=t.target.value;Ze(s=>{const i=Array.isArray(s)?[...s]:[];return i[a]=n,i})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=Tn(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const s=String(n.id),i=Ut(n==null?void 0:n.variants),h={};for(const f of i){const l=String((f==null?void 0:f.name)||"").trim(),u=Array.isArray(f==null?void 0:f.options)?f.options[0]:null,C=String((u==null?void 0:u.label)||"").trim();l&&C&&(h[l]=C)}const c=Ra(h),k=ca(n,h);xe(f=>{const l=Array.isArray(f.items)?[...f.items]:[];return l[a]={...l[a]||{quantity:1},product_id:s,variant_json:Object.keys(h).length?h:null,variant:c,unit_price:i.length?k:null},{...f,items:l}}),dt(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),ht.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Fe.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=jt(e.product_id),n=Ut(t==null?void 0:t.variants);if(!n.length)return null;const s=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((i,h)=>{const c=String((i==null?void 0:i.name)||`Bi\u1EBFn th\u1EC3 ${h+1}`).trim(),k=String((s==null?void 0:s[c])||"").trim();return React.createElement("div",{key:c},React.createElement("label",{className:"form-label small text-muted mb-1"},c),React.createElement("select",{className:"form-select",value:k,onChange:f=>{const l=String(f.target.value||"").trim();xe(u=>{const C=Array.isArray(u.items)?[...u.items]:[],W={...C[a]||{}},B=jt(W.product_id),Te=Ut(B==null?void 0:B.variants),Ce=W!=null&&W.variant_json&&typeof W.variant_json=="object"?{...W.variant_json}:{};l?Ce[c]=l:delete Ce[c];const at=Ra(Ce),Ke=ca(B,Ce);return C[a]={...W,variant_json:Object.keys(Ce).length?Ce:null,variant:at,unit_price:Ke},{...u,items:C}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",c," --"),(Array.isArray(i==null?void 0:i.options)?i.options:[]).map(f=>React.createElement("option",{key:f.label,value:f.label},f.label,Number.isFinite(Number(f==null?void 0:f.price))?` (${Ge(Number(f.price))})`:Number(f==null?void 0:f.price_delta)?` (${f.price_delta>0?"+":""}${f.price_delta})`:""))))}))})(),ze&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!ue[a],onChange:t=>{const n=!!t.target.checked;Q(s=>{const i=Array.isArray(s)?[...s]:[],h=Array.isArray(d.items)?d.items.length:0;for(;i.length<h;)i.push(!0);return i[a]=n,i})},disabled:b||V}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;xe(s=>{const i=Array.isArray(s.items)?[...s.items]:[];return i[a]={...i[a]||{product_id:""},quantity:n},{...s,items:i}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Fe.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{xe(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Ze(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),Q(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),dt(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:b||V||(Array.isArray(d.items)?d.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(d.items)?d.items:[]).filter(c=>c==null?void 0:c.product_id),t=ya(a),n=va(a),s=Ba(d),i=s.amount,h=t+(n.found?n.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ge(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ge(n.fee))),!!Fe.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Fe.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ge(i))),(d.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(d.note||"").trim()),!!s.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",s.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ge(h)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:b||!!M||!!X}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Jt.all," \u0111\u01A1n"),_e&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>_e?Cn(Me):ea(),disabled:mt,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>Da(),disabled:b||!!M},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip ${!L&&!re&&!_e?"active":""}`,onClick:()=>{_e&&ke(""),ae(!1),Y("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Jt.all)),React.createElement("button",{type:"button",className:`orders-chip ${L==="draft"&&!re&&!_e?"active":""}`,onClick:()=>{_e&&ke(""),ae(!1),Y("draft"),w("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Jt.draft)),React.createElement("button",{type:"button",className:`orders-chip ${L==="pending"&&!re&&!_e?"active":""}`,onClick:()=>{_e&&ke(""),ae(!1),Y("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Jt.pending)),React.createElement("button",{type:"button",className:`orders-chip ${L==="processing"&&!re&&!_e?"active":""}`,onClick:()=>{_e&&ke(""),ae(!1),Y("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Jt.processing)),React.createElement("button",{type:"button",className:`orders-chip ${L==="done"&&!re&&!_e?"active":""}`,onClick:()=>{_e&&ke(""),ae(!1),Y("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Jt.done)),React.createElement("button",{type:"button",className:`orders-chip ${L==="paid"&&!re&&!_e?"active":""}`,onClick:()=>{_e&&ke(""),ae(!1),Y("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Jt.paid)),React.createElement("button",{type:"button",className:`orders-chip ${L==="canceled"&&!re&&!_e?"active":""}`,onClick:()=>{_e&&ke(""),ae(!1),Y("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Jt.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Wt("thisMonth"),disabled:_e},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Wt("overduePending"),disabled:_e},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",Ct," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Wt("draftExpiring"),disabled:_e},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a"),(L||re||!m&&!_e)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Wt("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:Qe,type:"text",className:"form-control",value:Me,onChange:e=>ke(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(Me||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ke(""),disabled:mt},React.createElement("i",{className:"fas fa-times"})),mt&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:m,onChange:e=>w(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:re||_e})),React.createElement("div",{className:"text-muted small ms-auto"},_e?"Search b\u1ECF qua filter":re?"\u0110ang xem \u0111\u01A1n ch\u1EADm":L?`L\u1ECDc: ${Ht(L)}`:""))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},_e?`${gt.length} k\u1EBFt qu\u1EA3`:L?`${ja.length}/${z.length} \u0111\u01A1n`:`${z.length}${ne?"+":""} \u0111\u01A1n`)),_e&&We&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},We),Ia.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Ia.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Ct," ng\xE0y.",ce&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ae(!0),Y("pending")}},"Xem ngay")),wn.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,wn.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",pa," ng\xE0y).",He&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ae(!1),Y("draft"),w(""),ea()}},"Xem ngay")),(_e?mt:he)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,a)=>React.createElement("div",{key:a,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,a)=>React.createElement("tr",{key:a},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(_e?gt.length===0:z.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},_e?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!_e&&ja.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},kn.map(e=>{var a;return React.createElement("div",{key:e.id,className:`card mb-2 ${se!=null&&se[String(e.id)]?"order-recent-updated":""}`,role:"button",tabIndex:0,onClick:()=>fa(e),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),fa(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:t=>Fn(t,e.phone),onPointerMove:Sa,onPointerUp:Sa,onPointerCancel:Sa,onPointerLeave:Sa,onClick:t=>{if(t.stopPropagation(),pe.current){pe.current=!1;return}mn(e.phone)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),mn(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=cn(e);if(!t)return null;const n=I.has(String(e.id)),s=t.length>84||dn(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${n?"":"order-text-collapsed"}`},t),s&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:i=>{i.stopPropagation(),ln(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const t=dn(e);if(!t)return null;const n=I.has(String(e.id)),s=cn(e).length,i=s>84||t.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${n?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t),i&&s<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:h=>{h.stopPropagation(),ln(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`badge ${oa(e.status)} order-status-badge-btn`,onClick:t=>{t.stopPropagation(),on(e)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},Ht(e.status)),Ca(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Ct} ng\xE0y`},"\u26A0 Ch\u1EADm ",ba(e),"d"),_a(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Qt} ng\xE0y`},"\u23F3 C\xF2n ",Aa(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=Ea(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,s)=>React.createElement("div",{key:s,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},s+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${Ge(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},da(e))})()),(ga(e)!==0||ta(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ge(ga(e))),ta(e)?React.createElement("span",{className:"text-muted"}," ","(",ta(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Ge(Na(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",la(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),Pa(e)},disabled:b||!!M||X===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),on(e)},disabled:b||!!M||X===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c"))))}),React.createElement("div",{ref:zt,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(gt)&&kn.length<gt.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),R&&st&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Yt()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},st.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},st.phone||""),React.createElement("span",{className:`badge ${oa(st.status)}`},Ht(st.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Yt(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Pa(st),Yt()},disabled:b||!!M||X===st.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(st.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(st.phone||"").trim()}`,onClick:()=>Yt()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{fa(st),Yt()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},rn.map(e=>{const a=na(st.status)===na(e.value),t=b||!!M||X===st.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Fa(st,e.value),Yt())},disabled:t},e.label)})))),it&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>ka()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ka(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Wt("thisMonth"),disabled:_e},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Wt("overduePending"),disabled:_e},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Wt("draftExpiring"),disabled:_e},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!L&&!re?"active":""}`,onClick:()=>{_e&&ke(""),ae(!1),Y("")}},"T\u1EA5t c\u1EA3"),rn.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${L===e.value&&!re?"active":""}`,onClick:()=>{_e&&ke(""),ae(!1),Y(e.value),e.value==="draft"&&w("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:m,onChange:e=>w(e.target.value),disabled:re||_e}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:re,onChange:e=>{_e&&ke("");const a=!!e.target.checked;ae(a),a&&(w(""),Y("pending"))},disabled:_e}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",Ct," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Wt("all"),disabled:_e},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>ka()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${S?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,a;return(a=(e=Qe.current)==null?void 0:e.focus)==null?void 0:a.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>Da(),disabled:b||!!M,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>En(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,gt.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>fa(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=Ea(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Ge(t.unitPrice))))):da(e)})()),React.createElement("td",null,$n(e)),React.createElement("td",{className:"fw-semibold"},Ge(Na(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${oa(e.status)}`},Ht(e.status)),Ca(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Ct} ng\xE0y`},"\u26A0 Ch\u1EADm ",ba(e),"d"),_a(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Qt} ng\xE0y`},"\u23F3 C\xF2n ",Aa(e),"d"))),React.createElement("td",null,la(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),Pa(e)},disabled:b||!!M||X===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation();const t=String(a.target.value||"").trim();a.target.value="",t&&Fa(e,t)},disabled:b||!!M||X===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!_e&&ne&&!re&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Un,disabled:he||Z},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:Ve,title:(()=>{const e=ee,a=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Ht(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${a} ${t}`.trim()})(),subtitle:(()=>{const e=ee,a=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?la(e.created_at):"";return[a||t||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:Xn,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},_t?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{wt(!1),At(null),Zt(""),U(!1),Q([])},disabled:b||V},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!ze&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:An,disabled:b||V,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>Ka({mode:"close",origin:"drawer"}),disabled:b||V||!Fe.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ee&&Pa(ee),disabled:!ee||rt||b||!!M},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>ee&&Wa(ee),disabled:!ee||rt||b||!!M},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const a=String(e.target.value||"").trim();e.target.value="",a&&ee&&Fa(ee,a)},disabled:!ee||rt||b||!!M||X===(ee==null?void 0:ee.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},_t?React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ka({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),is())):rt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):nt?React.createElement("div",{className:"alert alert-danger",role:"alert"},nt):ee?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${oa(ee.status)}`},Ht(ee.status)),Ca(ee)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Ct} ng\xE0y`},"\u26A0 Ch\u1EADm ",ba(ee),"d"),_a(ee)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Qt} ng\xE0y`},"\u23F3 C\xF2n ",Aa(ee),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},Ge(Na(ee))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},$n(ee)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},la(ee.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},ee.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},ee.phone||"\u2014"),!!String(ee.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(ee.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},ee.address||"\u2014")),((ee==null?void 0:ee.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(ee.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=Ea(ee);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((a,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),a.name),a.variant?React.createElement("div",{className:"text-muted small"},a.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${Ge(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},da(ee)||"\u2014")})(),(ga(ee)!==0||ta(ee))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ge(ga(ee))),ta(ee)?React.createElement("span",{className:"text-muted"}," ","(",ta(ee),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),ge&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),ze?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Ua})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ka({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Pe},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:d.customer_name,onChange:e=>xe({...d,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Fe.nameError&&React.createElement("div",{className:"form-text text-danger"},Fe.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:d.phone,onChange:e=>vn(e.target.value),onBlur:yn,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Fe.phoneError&&React.createElement("div",{className:"form-text text-danger"},Fe.phoneError),!Fe.phoneError&&xt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",xt.count," \u0111\u01A1n trong th\xE1ng ",xt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>U(e=>!e)},J?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),J&&xt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>U(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},xt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${oa(e.status)}`},Ht(e.status))),React.createElement("div",{className:"text-muted small"},la(e.created_at)," \u2022 ",Ge(Na(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},da(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Wa(e)}},"M\u1EDF")))),xt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(g==null?void 0:g.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(g==null?void 0:g.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(g==null?void 0:g.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(g==null?void 0:g.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:d.status,onChange:e=>xe({...d,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:d.address,onChange:e=>xe({...d,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Fe.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:d.note,onChange:e=>xe({...d,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{xe(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Ft(d.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;xe(s=>{const i=Ft(s.adjustment_items);return i[a]={...i[a],amount:n},{...s,adjustment_items:i}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;xe(s=>{const i=Ft(s.adjustment_items);return i[a]={...i[a],note:n},{...s,adjustment_items:i}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{xe(t=>{const n=Ft(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:b||Ft(d.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Fe.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.adjustmentAbnormalWarn),!!Fe.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Fe.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{xe(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Ze(e=>[...Array.isArray(e)?e:[],""]),ze&&Q(e=>[...Array.isArray(e)?e:[],!0])},disabled:b},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(d.items)?d.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Nt.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{dt(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},_n(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),yt===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:Be[a]||"",onChange:t=>{const n=t.target.value;Ze(s=>{const i=Array.isArray(s)?[...s]:[];return i[a]=n,i})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=Tn(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const s=String(n.id),i=Ut(n==null?void 0:n.variants),h={};for(const f of i){const l=String((f==null?void 0:f.name)||"").trim(),u=Array.isArray(f==null?void 0:f.options)?f.options[0]:null,C=String((u==null?void 0:u.label)||"").trim();l&&C&&(h[l]=C)}const c=Ra(h),k=ca(n,h);xe(f=>{const l=Array.isArray(f.items)?[...f.items]:[];return l[a]={...l[a]||{quantity:1},product_id:s,variant_json:Object.keys(h).length?h:null,variant:c,unit_price:i.length?k:null},{...f,items:l}}),dt(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),ht.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Fe.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=jt(e.product_id),n=Ut(t==null?void 0:t.variants);if(!n.length)return null;const s=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((i,h)=>{const c=String((i==null?void 0:i.name)||`Bi\u1EBFn th\u1EC3 ${h+1}`).trim(),k=String((s==null?void 0:s[c])||"").trim();return React.createElement("div",{key:c},React.createElement("label",{className:"form-label small text-muted mb-1"},c),React.createElement("select",{className:"form-select",value:k,onChange:f=>{const l=String(f.target.value||"").trim();xe(u=>{const C=Array.isArray(u.items)?[...u.items]:[],W={...C[a]||{}},B=jt(W.product_id),Te=Ut(B==null?void 0:B.variants),Ce=W!=null&&W.variant_json&&typeof W.variant_json=="object"?{...W.variant_json}:{};l?Ce[c]=l:delete Ce[c];const at=Ra(Ce),Ke=ca(B,Ce);return C[a]={...W,variant_json:Object.keys(Ce).length?Ce:null,variant:at,unit_price:Ke},{...u,items:C}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",c," --"),(Array.isArray(i==null?void 0:i.options)?i.options:[]).map(f=>React.createElement("option",{key:f.label,value:f.label},f.label,Number.isFinite(Number(f==null?void 0:f.price))?` (${Ge(Number(f.price))})`:Number(f==null?void 0:f.price_delta)?` (${f.price_delta>0?"+":""}${f.price_delta})`:""))))}))})(),ze&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!ue[a],onChange:t=>{const n=!!t.target.checked;Q(s=>{const i=Array.isArray(s)?[...s]:[],h=Array.isArray(d.items)?d.items.length:0;for(;i.length<h;)i.push(!0);return i[a]=n,i})},disabled:b||V}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;xe(s=>{const i=Array.isArray(s.items)?[...s.items]:[];return i[a]={...i[a]||{product_id:""},quantity:n},{...s,items:i}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Fe.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{xe(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Ze(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),Q(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),dt(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:b||V||(Array.isArray(d.items)?d.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(d.items)?d.items:[]).filter(c=>c==null?void 0:c.product_id),t=ya(a),n=va(a),s=Ba(d),i=s.amount,h=t+(n.found?n.fee:0)+i;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ge(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ge(n.fee))),!!Fe.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Fe.shipAbnormalWarn),i!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ge(i))),(d.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(d.note||"").trim()),!!s.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",s.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ge(h)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Ua,disabled:b||V,style:{borderRadius:10}},"H\u1EE7y"),!!ze&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:An,disabled:b||V,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!ze&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Ka({mode:"new",origin:"modal"}),disabled:b||!Fe.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:b||V||!Fe.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

