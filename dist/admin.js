const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:S,error:x}){const[I,B]=useState(""),[P,_]=useState(""),[M,se]=useState(!1),[ue,X]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),x&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),x),React.createElement("form",{onSubmit:async we=>{we.preventDefault(),se(!0),await S(I,P),se(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:I,onChange:we=>B(we.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:ue?"text":"password",className:"form-control",value:P,onChange:we=>_(we.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>X(!ue)},React.createElement("i",{className:`fas fa-eye${ue?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:M},M?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:S,type:x,onClose:I}){return useEffect(()=>{const B=setTimeout(I,3e3);return()=>clearTimeout(B)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${x} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},S),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:I})))}function Loading({show:S}){return S?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:S,title:x,subtitle:I,onClose:B,footer:P,children:_}){return useEffect(()=>{if(!S)return;const M=se=>{se.key==="Escape"&&(se.preventDefault(),typeof B=="function"&&B())};return document.addEventListener("keydown",M),()=>document.removeEventListener("keydown",M)},[S,B]),S?React.createElement("div",{className:`admin-drawer-root ${S?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:B,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},x),I?React.createElement("div",{className:"admin-drawer-subtitle"},I):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:B,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},_),P?React.createElement("div",{className:"admin-drawer-footer"},P):null)):null}function Sidebar({activeMenu:S,onMenuChange:x,onLogout:I,currentUser:B}){const P=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],_=(B==null?void 0:B.username)||(B==null?void 0:B.name)||(B==null?void 0:B.email)||"Admin";return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},_),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},P.map(M=>React.createElement("a",{key:M.id,href:"#",className:`nav-link ${S===M.id?"active":""} ${M.disabled?"opacity-50":""} ${M.highlight?"text-warning":""}`,onClick:se=>{se.preventDefault(),M.disabled||x(M.id)}},React.createElement("i",{className:`fas ${M.icon}`})," ",M.label,M.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),M.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),I&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:I,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(S){const x=typeof S=="number"?S:parseFloat(String(S!=null?S:"").trim());return Number.isFinite(x)?Math.max(0,Math.min(100,x)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var S;try{const x=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!x)return{ship_percent:DEFAULT_SHIP_PERCENT};const I=JSON.parse(x);return{ship_percent:normalizeShipPercent((S=I==null?void 0:I.ship_percent)!=null?S:I==null?void 0:I.shipPercent)}}catch(x){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(S){var x;try{const I={ship_percent:normalizeShipPercent((x=S==null?void 0:S.ship_percent)!=null?x:S==null?void 0:S.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(I)),I}catch(I){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var x;const S=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((x=S==null?void 0:S.ship_percent)!=null?x:S==null?void 0:S.shipPercent)}}async function saveAdminSettingsToServer(S){var B,P,_;const x={ship_percent:normalizeShipPercent((B=S==null?void 0:S.ship_percent)!=null?B:S==null?void 0:S.shipPercent)},I=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,x,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((_=(P=I==null?void 0:I.ship_percent)!=null?P:I==null?void 0:I.shipPercent)!=null?_:x.ship_percent)}}function AlbumList({albums:S,onSelect:x,onCreate:I,onEdit:B,onDelete:P,loading:_,currentFolder:M,onBack:se,breadcrumb:ue}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},M&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:se},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),M?M.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:I},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),ue&&ue.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:X=>{X.preventDefault(),se("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ue.map((X,be)=>React.createElement("li",{key:X.id,className:`breadcrumb-item ${be===ue.length-1?"active":""}`},be===ue.length-1?X.title:React.createElement("a",{href:"#",onClick:we=>{we.preventDefault(),se(X)},className:"text-warning"},X.title))))),_?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):S.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},M?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},S.map(X=>React.createElement("div",{key:X.uuid||X.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>x(X)},X.cover?React.createElement("img",{src:X.cover,className:"album-cover",alt:X.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},X.title),React.createElement("small",{className:"text-muted"},X.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),X.subfolderCount),X.subfolderCount>0&&X.count>0&&" \u2022 ",X.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),X.count),X.subfolderCount===0&&X.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:be=>{be.stopPropagation(),B(X)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:be=>{be.stopPropagation(),P(X)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:S,album:x,onClose:I,onSave:B,parentId:P}){const[_,M]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[se,ue]=useState(!1),[X,be]=useState(!1),we=useRef(null);useEffect(()=>{M(x?{slug:x.id||"",title:x.title||"",description:x.description||"",cover_url:x.cover||"",parent_id:x.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:P||null})},[x,S,P]);const me=async D=>{D.preventDefault(),ue(!0),await B(_),ue(!1)},le=D=>D.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),fe=async D=>{const ke=D.type==="image/heic"||D.type==="image/heif"||/\.heic$/i.test(D.name);if(D.size<=2097152&&!ke)return D;try{const Ke=await createImageBitmap(D),Ie=document.createElement("canvas");let Ce=Ke.width,ge=Ke.height;const Oe=800;return(Ce>Oe||ge>Oe)&&(Ce>ge?(ge=Math.round(ge/Ce*Oe),Ce=Oe):(Ce=Math.round(Ce/ge*Oe),ge=Oe)),Ie.width=Ce,Ie.height=ge,Ie.getContext("2d").drawImage(Ke,0,0,Ce,ge),Ke.close(),new Promise((Qe,Ae)=>{Ie.toBlob(Je=>{Je?Qe(new File([Je],D.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ae(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Ke){throw console.error("Compress cover error:",Ke),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Fe=async D=>{var Ke;const Ne=D.target.files[0];if(!Ne)return;if(!(Ne.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Ne.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}be(!0);try{const Ie=await fe(Ne),Ce=await window.KTM.cloudinary.uploadImage({file:Ie,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Ce.secure_url)throw console.error("Cloudinary error:",Ce),new Error(((Ke=Ce.error)==null?void 0:Ke.message)||"Upload failed");M(ge=>({...ge,cover_url:Ce.secure_url}))}catch(Ie){console.error("Cover upload error:",Ie),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Ie.message)}be(!1),D.target.value=""};return S?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:I})),React.createElement("form",{onSubmit:me},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:_.title,onChange:D=>M({..._,title:D.target.value,slug:_.slug||le(D.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:_.slug,onChange:D=>M({..._,slug:D.target.value}),required:!0,disabled:!!x}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:_.description,onChange:D=>M({..._,description:D.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},_.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:_.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>M(D=>({...D,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:we,type:"file",accept:"image/*",className:"d-none",onChange:Fe}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var D;return(D=we.current)==null?void 0:D.click()},disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:_.cover_url,onChange:D=>M({..._,cover_url:D.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:I},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:se||X},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:S,allAlbums:x,currentAlbumId:I,targetAlbum:B,onSelect:P,level:_=0}){const[M,se]=useState(!0),ue=S.uuid||S.id,X=ue===I,be=B===ue,we=x.filter(le=>le.parentId===ue),me=we.length>0;return React.createElement("div",{style:{marginLeft:_*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${be?"bg-info text-white":X?"bg-light text-muted":"hover-bg"}`,style:{cursor:X?"not-allowed":"pointer",opacity:X?.5:1,transition:"background 0.2s"},onClick:()=>!X&&P(ue)},me&&React.createElement("i",{className:`fas fa-chevron-${M?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:le=>{le.stopPropagation(),se(!M)}}),!me&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${be?"-open":""} me-2 ${be?"":"text-warning"}`}),React.createElement("span",{className:"small"},S.title),X&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),S.count>0&&!X&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},S.count)),M&&me&&React.createElement("div",null,we.map(le=>React.createElement(FolderTreeItem,{key:le.uuid||le.id,folder:le,allAlbums:x,currentAlbumId:I,targetAlbum:B,onSelect:P,level:_+1}))))}function AlbumDetail({album:S,onBack:x,onRefresh:I,showToast:B,onNavigateToFolder:P,onEditSubfolder:_,parentAlbum:M}){const[se,ue]=useState([]),[X,be]=useState([]),[we,me]=useState(!0),[le,fe]=useState(!1),[Fe,D]=useState(""),[Ne,ke]=useState([]),[Ke,Ie]=useState([]),[Ce,ge]=useState({}),[Oe,Me]=useState(null),[Qe,Ae]=useState(!1),[Je,Le]=useState(""),[d,j]=useState(!1),y=useRef(null),K=useRef(null),[V,H]=useState(!1),[J,ie]=useState([]),[l,k]=useState([]),[F,ve]=useState(""),[c,f]=useState(!1),Q=async(N,U=2)=>{const b=U*1024*1024,Te=N.type==="image/heic"||N.type==="image/heif"||/\.heic$/i.test(N.name);if(N.size<=b&&!Te)return N;try{const Ye=await createImageBitmap(N),We=document.createElement("canvas");let rt=Ye.width,ot=Ye.height;const wt=1200;return(rt>wt||ot>wt)&&(rt>ot?(ot=Math.round(ot/rt*wt),rt=wt):(rt=Math.round(rt/ot*wt),ot=wt)),We.width=rt,We.height=ot,We.getContext("2d").drawImage(Ye,0,0,rt,ot),Ye.close(),new Promise((Et,Ve)=>{We.toBlob(_t=>{_t?Et(new File([_t],N.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ve(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Ye){throw console.error("Compress error:",Ye),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{h(),E()},[S.id,S.uuid]);const h=async()=>{me(!0);try{const N=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${S.uuid||S.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ue(N.images||[]);const U=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${S.uuid||S.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");be(Array.isArray(U)?U:[])}catch(N){console.error(N),B("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}me(!1)},E=async()=>{try{const N=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");k(Array.isArray(N)?N:[])}catch(N){console.error("Error loading albums:",N)}},ne=N=>{ie(U=>U.includes(N)?U.filter(b=>b!==N):[...U,N])},C=async()=>{if(!F||J.length===0){B("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}f(!0);let N=0;for(const U of J)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${U}`,{album_id:F},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),N++}catch(b){console.error("Move error:",b)}f(!1),H(!1),ie([]),ve(""),N>0?(B("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),h(),I()):B("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[De,Y]=useState(!1),Pe=async()=>{if(J.length===0||!confirm(`X\xF3a ${J.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Y(!0);let N=0;for(const U of J)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${U}`,"L\u1ED7i x\xF3a \u1EA3nh"),N++}catch(b){console.error("Delete error:",b)}Y(!1),ie([]),N>0?(B(`\u0110\xE3 x\xF3a ${N} \u1EA3nh!`,"success"),h(),I()):B("X\xF3a th\u1EA5t b\u1EA1i","danger")},Ge=()=>{J.length===se.length?ie([]):ie(se.map(N=>N.id))},ct=async()=>{if(Je.trim()){j(!0);try{const N=Je.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:N+"-"+Date.now(),title:Je,parent_id:S.uuid||S.id},"L\u1ED7i t\u1EA1o folder"),B("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Le(""),Ae(!1),h(),I()}catch(N){B(N.message,"danger")}j(!1)}},ye=async N=>{if(confirm(`X\xF3a folder "${N.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${N.uuid||N.id}`,"L\u1ED7i x\xF3a folder"),B("\u0110\xE3 x\xF3a folder","success"),h(),I()}catch(U){B("L\u1ED7i x\xF3a folder","danger")}},Ee=N=>{const U=Array.from(N).filter(b=>b.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(b.name));ke(b=>[...b,...U]),U.forEach(b=>{const Te=new FileReader;Te.onload=Ye=>{Ie(We=>[...We,{file:b,preview:Ye.target.result}])},Te.readAsDataURL(b)})},bt=N=>{ke(U=>U.filter((b,Te)=>Te!==N)),Ie(U=>U.filter((b,Te)=>Te!==N))},It=async N=>{var b;const U=await window.KTM.cloudinary.uploadImage({file:N,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${S.id}`});if(!U.secure_url)throw console.error("Cloudinary error:",U),new Error(((b=U.error)==null?void 0:b.message)||"Upload failed");return U},te=async()=>{if(Ne.length===0)return;fe(!0);let N=0;for(let U=0;U<Ne.length;U++)try{D(`\u0110ang x\u1EED l\xFD ${U+1}/${Ne.length}...`);const b=await Q(Ne[U],2);D(`\u0110ang upload ${U+1}/${Ne.length}...`);const Te=await It(b);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${S.id}`,{url:Te.secure_url,caption:Ce[U]||Ne[U].name.replace(/\.[^/.]+$/,""),sort_order:se.length+U},"L\u1ED7i l\u01B0u \u1EA3nh"),N++}catch(b){console.error("Upload error:",b)}fe(!1),D(""),ke([]),Ie([]),ge({}),N>0?(B(`\u0110\xE3 upload ${N} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),h(),I()):B("Upload th\u1EA5t b\u1EA1i","danger")},it=async(N,U)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${N}`,"L\u1ED7i x\xF3a \u1EA3nh"),B("\u0110\xE3 x\xF3a \u1EA3nh","success"),h(),I()}catch(b){B("L\u1ED7i x\xF3a \u1EA3nh","danger")}},dt=N=>{var U;N.preventDefault(),(U=K.current)==null||U.classList.add("dragover")},mt=()=>{var N;(N=K.current)==null||N.classList.remove("dragover")},ht=N=>{var U;N.preventDefault(),(U=K.current)==null||U.classList.remove("dragover"),Ee(N.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:x},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},S.title),React.createElement("small",{className:"text-muted"},X.length>0&&React.createElement("span",null,X.length," folder \u2022 "),se.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Ae(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),Qe&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Je,onChange:N=>Le(N.target.value),onKeyPress:N=>N.key==="Enter"&&ct(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:ct,disabled:d||!Je.trim()},d?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Ae(!1),Le("")}},"H\u1EE7y")))),X.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},X.map(N=>React.createElement("div",{key:N.uuid||N.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>P&&P(N)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},N.title),React.createElement("small",{className:"text-muted"},N.subfolderCount>0&&React.createElement("span",null,N.subfolderCount," folder"),N.subfolderCount>0&&N.count>0&&" \u2022 ",N.count>0&&React.createElement("span",null,N.count," \u1EA3nh"),N.subfolderCount===0&&N.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:U=>{U.stopPropagation(),_&&_(N)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:U=>{U.stopPropagation(),ye(N)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:K,className:"upload-zone",onClick:()=>{var N;return(N=y.current)==null?void 0:N.click()},onDragOver:dt,onDragLeave:mt,onDrop:ht},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:y,type:"file",multiple:!0,accept:"image/*",onChange:N=>Ee(N.target.files)})),Ke.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Ke.map((N,U)=>React.createElement("div",{key:U,className:"upload-preview-item"},React.createElement("img",{src:N.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>bt(U)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:te,disabled:le},le?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Fe||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Ne.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",se.length,")"),se.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Ge},J.length===se.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),J.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},J.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>H(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Pe,disabled:De},De?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ie([])},React.createElement("i",{className:"fas fa-times"})))),we?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):se.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},se.map((N,U)=>React.createElement("div",{key:U,className:`image-item ${J.includes(N.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>ne(N.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:J.includes(N.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:J.includes(N.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},J.includes(N.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:N.src,alt:N.caption,style:{opacity:J.includes(N.id)?.7:1,border:J.includes(N.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:b=>{b.stopPropagation(),it(N.id,U)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),N.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},N.caption)))))),V&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",J.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>H(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},l.filter(N=>!N.parentId).map(N=>React.createElement(FolderTreeItem,{key:N.uuid||N.id,folder:N,allAlbums:l,currentAlbumId:S.uuid||S.id,targetAlbum:F,onSelect:ve})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>H(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:C,disabled:!F||c},c?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Oe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Me(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Me(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Oe.src,alt:Oe.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:N=>N.stopPropagation()}),Oe.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Oe.caption)))))}function SearchCenter({showToast:S,onNavigate:x}){const[I,B]=useState(""),[P,_]=useState([]),[M,se]=useState([]),[ue,X]=useState([]),[be,we]=useState("all"),[me,le]=useState(null),[fe,Fe]=useState("list"),[D,Ne]=useState(!0),[ke,Ke]=useState([]),[Ie,Ce]=useState([]),ge=useRef(null),[Oe,Me]=useState(!0),[Qe,Ae]=useState(!1),Je=useRef(null),[Le,d]=useState(!1),[j,y]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[K,V]=useState(""),[H,J]=useState(!1),ie=useRef(null),l=useRef(null),[k,F]=useState(null),[ve,c]=useState(!1),[f,Q]=useState(null),[h,E]=useState(!1),[ne,C]=useState(!1),[De,Y]=useState(null),[Pe,Ge]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),ct=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ye=s=>{var v,O;s._type==="product"&&(Q(s),Ge({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(O=(v=s.commission_percent)!=null?v:s.commissionPercent)!=null?O:""}),c(!0))},Ee=async()=>{if(f)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${f.id}`,Pe,"L\u1ED7i c\u1EADp nh\u1EADt"),S("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),c(!1),Q(null),dt()}catch(s){S(s.message,"danger")}},bt=async s=>{const v=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${v} "${s.name}"?`))try{let O="";s._type==="product"?O=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?O=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(O=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(O,"L\u1ED7i x\xF3a"),S(`\u0110\xE3 x\xF3a ${v}`,"success"),dt()}catch(O){S(O.message,"danger")}},It=async s=>{try{const v=De?`${API_BASE}/api/products?id=${De.id}`:`${API_BASE}/api/products`;De?await window.KTM.api.putJSON(v,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(v,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),S(De?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),C(!1),Y(null),dt()}catch(v){S(v.message,"danger")}},te="ktm_admin_data_cache_v1",it=1e3*60*10,dt=async()=>{let s=null,v=!1;const O=window.KTM.cache.read(te,{ttlMs:it,validate:Array.isArray});O.hit?(s=O.value,console.log("[CACHE] Using cache, items:",s.length),se(s),_(s),Ne(!1),v=!0):O.status==="miss"?console.log("[CACHE] No cache found"):O.status==="expired"||O.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):O.status==="error"&&console.error("[CACHE] Error parsing cache"),v||Ne(!0);try{const W=async(Xe,He)=>{try{const tt=await window.KTM.api.getJSON(Xe,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return tt!=null?tt:He}catch(tt){return He}},[Z,$,p]=await Promise.all([W(`${API_BASE}/api/products?fields=search`,[]),W(`${API_BASE}/api/albums`,[]),W(`${API_BASE}/api/video-folders?withVideos=true`,[])]),G=Array.isArray(Z)?Z.map(Xe=>({...Xe,_type:"product",_source:"database"})):[];Ke($);let pe=[];Array.isArray($)&&$.length>0&&(await Promise.all($.map(He=>W(`${API_BASE}/api/albums/${He.id}`,{})))).forEach((He,tt)=>{const Nt=$[tt];He.images&&He.images.length>0&&He.images.forEach(vt=>{pe.push({id:vt.id,name:vt.caption||"\u1EA2nh t\u1EEB "+Nt.title,image:vt.src,folder:Nt.title,_type:"album",_source:"database"})})}),Ce(p);let ce=[];Array.isArray(p)&&p.forEach(Xe=>{Xe.videos&&Xe.videos.forEach(He=>{ce.push({id:He.id,name:He.title,folder:Xe.name,image:He.thumb,youtubeId:He.youtubeId,url:He.url,_type:"video",_source:"database"})})});const ae=[...G,...pe,...ce];(!s||JSON.stringify(ae)!==JSON.stringify(s))&&(se(ae),_(ae),window.KTM.cache.write(te,ae))}catch(W){console.error("Song song fetch error:",W)}Ne(!1)};useEffect(()=>{dt(),setTimeout(()=>{var s;return(s=ge.current)==null?void 0:s.focus()},100)},[]);const mt=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(v){return String(s!=null?s:"").toLowerCase()}},ht=s=>{const O=mt(s).trim().split(/\s+/).filter(Boolean),W=O.includes("anh"),Z=O.includes("video"),$=O.filter(pe=>pe!=="anh"&&pe!=="video"),p=$.join(" "),G=new Set(["product"]);return W&&G.add("album"),Z&&G.add("video"),{allowedTypes:G,includeAlbum:W,includeVideo:Z,contentTokens:$,cleanedQuery:p}},N=(s,v,O)=>{var Xe,He,tt,Nt,vt;const W=Array.isArray(v)?v:[],Z=mt(O).trim();if(!W.length&&!Z)return 0;const $=mt((Xe=s==null?void 0:s.name)!=null?Xe:""),p=mt((He=s==null?void 0:s.code)!=null?He:""),G=mt((tt=s==null?void 0:s.category)!=null?tt:""),pe=mt((Nt=s==null?void 0:s.note)!=null?Nt:""),ce=mt((vt=s==null?void 0:s.folder)!=null?vt:"");if(!`${$} ${p} ${G} ${pe} ${ce}`.trim())return 0;let he=0;Z&&($===Z&&(he+=220),$.includes(Z)&&(he+=140),$.startsWith(Z)&&(he+=160),p&&p===Z&&(he+=180),p&&p.includes(Z)&&(he+=90));for(const Ze of W){if(!Ze)continue;const Mt=new RegExp(`(?:^|\\s)${Ze.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);$.includes(Ze)&&(he+=35),Mt.test($)&&(he+=25),p&&p.includes(Ze)&&(he+=20),p&&Mt.test(p)&&(he+=10),G&&G.includes(Ze)&&(he+=12),ce&&ce.includes(Ze)&&(he+=12),pe&&pe.includes(Ze)&&(he+=6)}return he>0&&$&&(he+=Math.max(0,10-Math.min(10,Math.floor($.length/10)))),he},U=(s,v,O)=>{const W=Array.isArray(s)?s:[];return W.length?W.map(($,p)=>({it:$,idx:p,score:N($,v,O)})).sort(($,p)=>p.score!==$.score?p.score-$.score:$.idx-p.idx).map($=>$.it):[]},b=async(s,v)=>{if(!(!Oe||v.length===0)){Ae(!0);try{const O=v.map(Z=>({id:Z.id,name:Z.name,price:Z.price,category:Z.category,note:Z.note,folder:Z.folder,_type:Z._type})),W=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:O},"AI Search error");if(W&&W.matchedIds&&W.matchedIds.length>0){const{contentTokens:Z,cleanedQuery:$}=ht(s),p=new Set(W.matchedIds),G=v.filter(pe=>p.has(pe.id)).sort((pe,ce)=>N(ce,Z,$)-N(pe,Z,$));G.length>0&&_(G)}else W&&W.matchedIds&&W.matchedIds.length===0&&_([])}catch(O){console.error("AI Search error:",O)}Ae(!1)}},Te=s=>{if(B(s),Je.current&&clearTimeout(Je.current),!s.trim()){Ye(be);return}const{allowedTypes:v,contentTokens:O,cleanedQuery:W}=ht(s),Z=M.filter(p=>{if(!v.has(p==null?void 0:p._type))return!1;if(O.length===0)return!0;const G=mt(Object.entries(p).filter(([pe])=>!pe.startsWith("_")).map(([,pe])=>String(pe||"")).join(" "));return O.some(pe=>G.includes(pe))});let $=Z;be!=="all"&&($=Z.filter(p=>(p.category||p._type)===be)),_(U($,O,W)),Oe&&W.length>=3&&(Je.current=setTimeout(()=>{b(W,$)},500))},Ye=s=>{we(s);const{allowedTypes:v,contentTokens:O}=ht(I),{cleanedQuery:W}=ht(I);let Z=M.filter($=>v.has($==null?void 0:$._type));s!=="all"&&(Z=Z.filter($=>($.category||$._type)===s)),I.trim()&&O.length>0&&(Z=Z.filter($=>{const p=mt(Object.entries($).filter(([G])=>!G.startsWith("_")).map(([,G])=>String(G||"")).join(" "));return O.every(G=>p.includes(G))})),_(U(Z,O,W))},We=(s,v)=>{window.KTM.clipboard.writeText(s).then(()=>{le(v),S("\u0110\xE3 copy!","success"),setTimeout(()=>le(null),1500)})},rt=async(s,v)=>{try{await window.KTM.clipboard.writeImageFromUrl(s),le(v+"-img"),S("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>le(null),1500)}catch(O){We(s,v+"-img")}},ot=s=>{let v=s.toLowerCase();const O=[],W=M.filter(p=>p._type==="product");if(v.includes("ty")||v.includes("xy lanh")){if(v.includes("gi\u1EEFa")||v.includes("giua")){const p=W.find(G=>{var pe;return(pe=G.name)==null?void 0:pe.toLowerCase().includes("xy lanh gi\u1EEFa")});p&&!O.find(G=>G.id===p.id)&&O.push(p)}if(v.includes("nghi\xEAng")||v.includes("nghieng")){const p=W.find(G=>{var pe;return(pe=G.name)==null?void 0:pe.toLowerCase().includes("xy lanh nghi\xEAng")});p&&!O.find(G=>G.id===p.id)&&O.push(p)}if(v.includes("\u1EE7i")||v.includes("ui")){const p=W.find(G=>{var pe;return(pe=G.name)==null?void 0:pe.toLowerCase().includes("xy lanh \u1EE7i")});p&&!O.find(G=>G.id===p.id)&&O.push(p)}}const Z=v.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(Z){const p=Z[1],G=Z[2],pe=W.find(ce=>{var he;const ae=((he=ce.name)==null?void 0:he.toLowerCase())||"";return ae.includes("combo")&&ae.includes(`${p} tay`)&&(ae.includes(`${G} xy`)||ae.includes(`${G} xylanh`))});if(pe&&!O.find(ce=>ce.id===pe.id))O.push(pe);else{const ce=W.find(ae=>{var Xe;const he=((Xe=ae.name)==null?void 0:Xe.toLowerCase())||"";return he.includes("combo")&&he.includes(`${p} tay`)});ce&&!O.find(ae=>ae.id===ce.id)&&O.push(ce)}}if(v.includes("combo")&&!Z){const p=v.match(/combo.*?(\d+)\s*tay/);if(p){const G=p[1];W.filter(ce=>{var he;const ae=((he=ce.name)==null?void 0:he.toLowerCase())||"";return ae.includes("combo")&&ae.includes(`${G} tay`)}).forEach(ce=>{O.find(ae=>ae.id===ce.id)||O.push(ce)})}}const $=v.match(/van\s*(\d+)\s*tay/);if($&&!v.includes("ty")&&!v.includes("combo")){const p=$[1],G=W.find(pe=>{var ae;const ce=((ae=pe.name)==null?void 0:ae.toLowerCase())||"";return ce.includes(`van ${p} tay`)&&!ce.includes("combo")});G&&!O.find(pe=>pe.id===G.id)&&O.push(G)}return O.slice(0,4)},wt=async s=>{if(!s.trim())return;const v={role:"user",content:s,attachments:[]};y(W=>[...W,v]),V(""),J(!0);const O=ot(s);setTimeout(()=>{var W;return(W=ie.current)==null?void 0:W.scrollIntoView({behavior:"smooth"})},100);try{const Z=M.filter(ae=>ae._type==="product").map(ae=>{let he=`- ${ae.name}`;return ae.code&&(he+=` (M\xE3: ${ae.code})`),ae.price&&(he+=` - Gi\xE1: ${ae.price.replace(/[đ\s]/g,"")}\u0111`),ae.category&&(he+=` [${ae.category}]`),ae.note&&(he+=` (${ae.note})`),he}).join(`
`),p=j.slice(-6).map(ae=>`${ae.role==="user"?"Kh\xE1ch":"AI"}: ${ae.content}`).join(`
`),G=p?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${p}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${Z}`:Z,ce=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:G,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";y(ae=>[...ae,{role:"assistant",content:ce,attachments:O}])}catch(W){console.error("AI Error:",W);const Z=s.toLowerCase(),$=M.filter(G=>{const pe=Object.values(G).join(" ").toLowerCase();return Z.split(" ").some(ce=>pe.includes(ce))});let p="";$.length>0?(p=`T\xECm th\u1EA5y ${$.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,$.slice(0,5).forEach(G=>{p+=`\u2022 ${G.name}`,G.price&&(p+=` - ${G.price.replace(/[đ\s]/g,"")}\u0111`),G.note&&(p+=` (${G.note})`),p+=`
`}),$.length>5&&(p+=`
...v\xE0 ${$.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):p='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',y(G=>[...G,{role:"assistant",content:p,attachments:$.slice(0,4)}])}J(!1),setTimeout(()=>{var W,Z;(W=ie.current)==null||W.scrollIntoView({behavior:"smooth"}),(Z=l.current)==null||Z.focus()},100)};function ft({show:s,product:v,categories:O,onClose:W,onSave:Z}){const[$,p]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[G,pe]=useState(!1),[ce,ae]=useState(!1),he=useRef(null),Xe=R=>window.KTM.money.formatVNDInputDigits(R),He=R=>{const T=window.KTM.money.getDigits(String(R!=null?R:"")),q=Number(T);return T&&Number.isFinite(q)?Math.trunc(q):0},tt=(R,T)=>{if(R==null||R==="")return[];let q=R;if(typeof q=="string"){const de=q.trim();if(!de)return[];try{q=JSON.parse(de)}catch(oe){return[]}}if(!Array.isArray(q))return[];const re=He(T);return q.map(de=>{var _e;if(!de||typeof de!="object")return null;const oe=String((_e=de.name)!=null?_e:"").trim(),$e=(Array.isArray(de.options)?de.options:[]).map(qe=>{var xt,ut,At,pt,Ot,Vt,Rt;if(!qe||typeof qe!="object")return null;const Ue=String((xt=qe.label)!=null?xt:"").trim();if(!Ue)return null;const at=(Ot=(pt=(At=(ut=qe.price)!=null?ut:qe.priceValue)!=null?At:qe.unit_price)!=null?pt:qe.unitPrice)!=null?Ot:null,yt=Number(at);let je=Number.isFinite(yt)?Math.trunc(yt):null;if(je==null){const ze=(Rt=(Vt=qe.price_delta)!=null?Vt:qe.priceDelta)!=null?Rt:null,aa=Number(ze);Number.isFinite(aa)&&(je=re+Math.trunc(aa))}je==null&&(je=re);const lt=String(Math.max(0,Math.trunc(Number(je)||0)));return{label:Ue,price:Math.max(0,Math.trunc(Number(je)||0)),priceDigits:lt}}).filter(Boolean);return{name:oe||"Bi\u1EBFn th\u1EC3",options:$e}}).filter(Boolean)},Nt=R=>{if(R==null||R==="")return[];let T=R;if(typeof T=="string"){const q=T.trim();if(!q)return[];try{T=JSON.parse(q)}catch(re){return[]}}return T&&typeof T=="object"&&!Array.isArray(T)&&(T=Object.entries(T).map(([q,re])=>({key:q,value:re}))),Array.isArray(T)?T.map(q=>{var $e,_e,qe,Ue,at;if(!q||typeof q!="object")return null;const re=String((qe=(_e=($e=q.key)!=null?$e:q.name)!=null?_e:q.label)!=null?qe:"").trim(),de=String((Ue=q.value)!=null?Ue:"").trim(),oe=String((at=q.unit)!=null?at:"").trim();return re?{key:re,value:de,unit:oe}:null}).filter(Boolean):[]};useEffect(()=>{var R,T;if(v)if(p({name:v.name||"",code:v.code||"",price:v.price||"",image:v.image||"",category:v.category||"",note:v.note||"",sort_order:v.sort_order||0,commission_percent:(T=(R=v.commission_percent)!=null?R:v.commissionPercent)!=null?T:5,variants:tt(v.variants,v.price),attributes:Nt(v.attributes)}),v.price){const q=window.KTM.money.getDigits(v.price);Ht(q),p(re=>({...re,price:Xe(q)}))}else Ht("");else p({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Ht("")},[v,s]);const vt=R=>{p(T=>{var $e;const q=He(T.price),re=String(q),de=Array.isArray(T.variants)?[...T.variants]:[],oe={...de[R]||{},options:Array.isArray(($e=de[R])==null?void 0:$e.options)?[...de[R].options]:[]};return oe.options=oe.options.map(_e=>({label:String((_e==null?void 0:_e.label)||""),price:q,priceDigits:re})),de[R]=oe,{...T,variants:de}})},Ze=()=>{p(R=>{const T=He(R.price),q=String(T),de=(Array.isArray(R.variants)?[...R.variants]:[]).map(oe=>{const $e=(Array.isArray(oe==null?void 0:oe.options)?oe.options:[]).map(_e=>({label:String((_e==null?void 0:_e.label)||""),price:T,priceDigits:q}));return{name:String((oe==null?void 0:oe.name)||"Bi\u1EBFn th\u1EC3"),options:$e}});return{...R,variants:de}})},[Mt,Yt]=React.useState(""),[ya,Ht]=React.useState(""),Na=R=>{const T=window.KTM.money.nextPriceInputState(R.target.value,ya);Ht(T.digits),p({...$,price:T.price})},Zt=async(R,T=2)=>{const q=T*1024*1024;if(R.size<=q)return R;try{const re=await createImageBitmap(R),de=document.createElement("canvas");let oe=re.width,$e=re.height;const _e=1200;return(oe>_e||$e>_e)&&(oe>$e?($e=Math.round($e/oe*_e),oe=_e):(oe=Math.round(oe/$e*_e),$e=_e)),de.width=oe,de.height=$e,de.getContext("2d").drawImage(re,0,0,oe,$e),re.close(),new Promise((Ue,at)=>{de.toBlob(yt=>{yt?Ue(new File([yt],R.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):at(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(re){throw console.error("Compress error:",re),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ea=async R=>{var re;const T=R.target.files[0];if(!T)return;if(!(T.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(T.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ae(!0);try{const de=await Zt(T),oe=await window.KTM.cloudinary.uploadImage({file:de,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!oe.secure_url)throw console.error("Cloudinary error:",oe),new Error(((re=oe.error)==null?void 0:re.message)||"Upload failed");p($e=>({...$e,image:oe.secure_url}))}catch(de){console.error("Upload error:",de),alert("L\u1ED7i upload \u1EA3nh: "+de.message)}ae(!1),R.target.value=""},ta=async R=>{R.preventDefault(),pe(!0);const T={...$,variants:tt($.variants,$.price),attributes:Nt($.attributes)};await Z(T),pe(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),v?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:W})),React.createElement("form",{onSubmit:ta},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:$.name,onChange:R=>p({...$,name:R.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:$.code,onChange:R=>p({...$,code:R.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:$.price,onChange:Na,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:$.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:R=>p({...$,commission_percent:R.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:$.category,onChange:R=>p({...$,category:R.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),O.map(R=>React.createElement("option",{key:R,value:R},R)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:$.note,onChange:R=>p({...$,note:R.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray($.attributes)?$.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray($.attributes)?$.attributes:[]).map((R,T)=>React.createElement("div",{key:T,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(R==null?void 0:R.key)||"",onChange:q=>{const re=q.target.value;p(de=>{const oe=Array.isArray(de.attributes)?[...de.attributes]:[];return oe[T]={...oe[T]||{},key:re},{...de,attributes:oe}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(R==null?void 0:R.value)||"",onChange:q=>{const re=q.target.value;p(de=>{const oe=Array.isArray(de.attributes)?[...de.attributes]:[];return oe[T]={...oe[T]||{},value:re},{...de,attributes:oe}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(R==null?void 0:R.unit)||"",onChange:q=>{const re=q.target.value;p(de=>{const oe=Array.isArray(de.attributes)?[...de.attributes]:[];return oe[T]={...oe[T]||{},unit:re},{...de,attributes:oe}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{p(q=>{const re=Array.isArray(q.attributes)?[...q.attributes]:[];return re.splice(T,1),{...q,attributes:re}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{p(R=>{const T=Array.isArray(R.attributes)?[...R.attributes]:[];return T.push({key:"",value:"",unit:""}),{...R,attributes:T}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray($.variants)?$.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray($.variants)?$.variants:[]).map((R,T)=>React.createElement("div",{key:T,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(R==null?void 0:R.name)||"",onChange:q=>{const re=q.target.value;p(de=>{var $e;const oe=Array.isArray(de.variants)?[...de.variants]:[];return oe[T]={...oe[T]||{},name:re,options:Array.isArray(($e=oe[T])==null?void 0:$e.options)?oe[T].options:[]},{...de,variants:oe}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>vt(T),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(R==null?void 0:R.options)||R.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{p(q=>{const re=Array.isArray(q.variants)?[...q.variants]:[];return re.splice(T,1),{...q,variants:re}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(R==null?void 0:R.options)?R.options:[]).map((q,re)=>{var de,oe;return React.createElement("div",{key:re,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(q==null?void 0:q.label)||"",onChange:$e=>{const _e=$e.target.value;p(qe=>{var lt,xt,ut,At,pt;const Ue=Array.isArray(qe.variants)?[...qe.variants]:[],at={...Ue[T]||{},options:Array.isArray((lt=Ue[T])==null?void 0:lt.options)?[...Ue[T].options]:[]},yt=Number((ut=(xt=at.options[re])==null?void 0:xt.price)!=null?ut:0)||0,je=String((pt=(At=at.options[re])==null?void 0:At.priceDigits)!=null?pt:Math.max(0,Math.trunc(yt)));return at.options[re]={...at.options[re]||{},label:_e,price:Math.max(0,Math.trunc(yt)),priceDigits:je},Ue[T]=at,{...qe,variants:Ue}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Xe(String((oe=q==null?void 0:q.priceDigits)!=null?oe:window.KTM.money.getDigits(String((de=q==null?void 0:q.price)!=null?de:"")))),onChange:$e=>{p(_e=>{var ut,At,pt,Ot,Vt;const qe=String((At=q==null?void 0:q.priceDigits)!=null?At:window.KTM.money.getDigits(String((ut=q==null?void 0:q.price)!=null?ut:""))),Ue=window.KTM.money.nextPriceInputState($e.target.value,qe),at=String((pt=Ue.digits)!=null?pt:""),yt=Number(at),je=Number.isFinite(yt)?Math.max(0,Math.trunc(yt)):0,lt=Array.isArray(_e.variants)?[..._e.variants]:[],xt={...lt[T]||{},options:Array.isArray((Ot=lt[T])==null?void 0:Ot.options)?[...lt[T].options]:[]};return xt.options[re]={...xt.options[re]||{},label:String(((Vt=xt.options[re])==null?void 0:Vt.label)||""),price:je,priceDigits:at},lt[T]=xt,{..._e,variants:lt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{p($e=>{var Ue;const _e=Array.isArray($e.variants)?[...$e.variants]:[],qe={..._e[T]||{},options:Array.isArray((Ue=_e[T])==null?void 0:Ue.options)?[..._e[T].options]:[]};return qe.options.splice(re,1),_e[T]=qe,{...$e,variants:_e}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{p(q=>{var $e;const re=Array.isArray(q.variants)?[...q.variants]:[],de={...re[T]||{},options:Array.isArray(($e=re[T])==null?void 0:$e.options)?[...re[T].options]:[]},oe=He(q.price);return de.options.push({label:"",price:oe,priceDigits:String(oe)}),re[T]=de,{...q,variants:re}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{p(R=>{const T=He(R.price),q=Array.isArray(R.variants)?[...R.variants]:[],re=String(T);return q.push({name:"Size",options:[{label:"S",price:T,priceDigits:re},{label:"M",price:T,priceDigits:re},{label:"L",price:T,priceDigits:re}]}),{...R,variants:q}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Ze,disabled:!Array.isArray($.variants)||$.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},$.image?React.createElement(React.Fragment,null,React.createElement("img",{src:$.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>p({...$,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var R;return(R=he.current)==null?void 0:R.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:he,type:"file",accept:"image/*",className:"d-none",onChange:ea}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var R;return(R=he.current)==null?void 0:R.click()},disabled:ce,style:{borderRadius:"10px"}},ce?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:$.image,onChange:R=>p({...$,image:R.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:W,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:G,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},G?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Et=s=>window.KTM.money.formatVND(s),Ve=s=>{if(s==null||s==="")return[];let v=s;if(typeof v=="string"){const O=v.trim();if(!O)return[];try{v=JSON.parse(O)}catch(W){return[]}}return Array.isArray(v)?v:[]},_t=s=>{if(s==null||s==="")return[];let v=s;if(typeof v=="string"){const O=v.trim();if(!O)return[];try{v=JSON.parse(O)}catch(W){return[]}}return v&&typeof v=="object"&&!Array.isArray(v)&&(v=Object.entries(v).map(([O,W])=>({key:O,value:W}))),Array.isArray(v)?v:[]},Qt=(s,v={})=>{var $;const O=_t(s).map(p=>{var G,pe,ce,ae,he;return{key:String((ce=(pe=(G=p==null?void 0:p.key)!=null?G:p==null?void 0:p.name)!=null?pe:p==null?void 0:p.label)!=null?ce:"").trim(),value:String((ae=p==null?void 0:p.value)!=null?ae:"").trim(),unit:String((he=p==null?void 0:p.unit)!=null?he:"").trim()}}).filter(p=>!!p.key);if(!O.length)return null;const W=!!v.compact,Z=String(($=v.className)!=null?$:"").trim();return React.createElement("div",{className:`ktm-variants-preview${W?" compact":""}${Z?" "+Z:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},O.map((p,G)=>{const pe=p.key,ce=`${p.value||""}${p.unit?(p.value?" ":"")+p.unit:""}`.trim();return React.createElement("div",{key:`${pe}-${G}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},pe),ce?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ce):null)})))},Dt=(s,v={})=>{var pe;const O=Ve(s).map(ce=>{var ae;return{name:String((ae=ce==null?void 0:ce.name)!=null?ae:"").trim(),options:Array.isArray(ce==null?void 0:ce.options)?ce.options:[]}}).map(ce=>({...ce,options:ce.options.map(ae=>{var he;return{label:String((he=ae==null?void 0:ae.label)!=null?he:"").trim(),price:Number(ae==null?void 0:ae.price)}}).filter(ae=>!!ae.label)})).filter(ce=>ce.options.length>0);if(!O.length)return null;const W=Number.isFinite(v.maxGroups)?Math.max(1,Math.trunc(v.maxGroups)):O.length,Z=Number.isFinite(v.maxOptionsPerGroup)?Math.max(1,Math.trunc(v.maxOptionsPerGroup)):3,$=!!v.compact,p=String((pe=v.className)!=null?pe:"").trim(),G=O.slice(0,W);return React.createElement("div",{className:`ktm-variants-preview${$?" compact":""}${p?" "+p:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},G.map((ce,ae)=>{const he=ce.name||"Bi\u1EBFn th\u1EC3",Xe=ce.options.slice(0,Z),He=ce.options.length-Xe.length;return React.createElement("div",{key:`${he}-${ae}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},he),Xe.map((tt,Nt)=>{const vt=tt.price,Ze=Number.isFinite(vt)&&vt>=0?Et(Math.trunc(vt)):"",Mt=Ze?`${tt.label} \xB7 ${Ze}`:tt.label;return React.createElement("span",{key:`${he}-${ae}-${Nt}`,className:"ktm-chip ktm-chip-option"},Mt)}),He>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",He))})))},Ft=(s,v)=>{const O=s._type==="product",W=s._type==="album",Z=s._type==="video",$=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),p=O?Qt(s.attributes,{compact:fe==="grid",className:fe==="grid"?"meta text-muted":"text-muted"}):null,G=O?Dt(s.variants,{compact:fe==="grid",maxOptionsPerGroup:999,className:fe==="grid"?"meta text-muted":"text-muted"}):null;return fe==="grid"?React.createElement("div",{key:s.id||v,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>F({url:s.image,name:s.name,price:s.price,note:s.note,item:s})},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Z?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${O?"product":W?"album":"video"}`},O?"SP":W?"\u1EA2nh":"Video"),$&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),p&&React.createElement("div",{style:{marginTop:2}},p),G&&React.createElement("div",{style:{marginTop:2}},G),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:me===s.id+"-img"?"copied":"",onClick:()=>rt(s.image,s.id)},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:me===s.id+"-price"?"copied":"",onClick:()=>We(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||v,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${O?"product":W?"album":"video"}`},O?"S\u1EA3n ph\u1EA9m":W?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>F({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Z?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),$&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),p&&React.createElement("div",{style:{marginTop:4}},p),G&&React.createElement("div",{style:{marginTop:4}},G)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),Z&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},O&&React.createElement("button",{onClick:()=>x&&x("orders","create",{productId:s.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:me===s.id+"-price"?"copied":"",onClick:()=>We(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:me===s.id+"-name"?"copied":"",onClick:()=>We(s.name,s.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),Z&&s.youtubeId&&React.createElement("button",{className:me===s.id+"-yt"?"copied":"",onClick:()=>We(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),O&&React.createElement("button",{className:"action-edit",onClick:()=>ye(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>bt(s)},React.createElement("i",{className:"fas fa-trash"}))))},[gt,Ct]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,P.length)," k\u1EBFt qu\u1EA3",Oe&&I.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),be!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},be==="product"?"S\u1EA3n ph\u1EA9m":be==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${fe==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Fe("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${fe==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Fe("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},D?React.createElement("div",null,[...Array(8)].map((s,v)=>React.createElement("div",{key:v,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):P.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',I,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{B(""),Te("")}},"Xem t\u1EA5t c\u1EA3")):fe==="grid"?React.createElement("div",{className:"product-grid-mobile"},P.map((s,v)=>Ft(s,v))):React.createElement("div",null,P.map((s,v)=>Ft(s,v)))),gt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Ct(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${be==="all"?"active":""}`,onClick:()=>{Ye("all"),Ct(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${be==="product"?"active":""}`,onClick:()=>{Ye("product"),Ct(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${be==="album"?"active":""}`,onClick:()=>{Ye("album"),Ct(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${be==="video"?"active":""}`,onClick:()=>{Ye("video"),Ct(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Oe,onChange:s=>Me(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:ge,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:I,onChange:s=>Te(s.target.value)}),React.createElement("button",{className:`filter-btn ${gt||be!=="all"?"active":""}`,onClick:()=>Ct(!gt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:h?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>d(!0),onTouchStart:()=>d(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Le&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>d(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},j.map((s,v)=>React.createElement("div",{key:v,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:me===`chat-${v}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:me===`chat-${v}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),le(`chat-${v}`),setTimeout(()=>le(null),1500)}},React.createElement("i",{className:`fas ${me===`chat-${v}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((O,W)=>React.createElement("div",{key:W,style:{width:70},className:"text-center"},O.image&&React.createElement("img",{src:O.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>F({url:O.image,name:O.name,price:O.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},O.name),O.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},O.price.replace(/[đ\s]/g,""),"\u0111"))))))),H&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:ie})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>wt(s),disabled:H,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),wt(K)},className:"chat-input-wrap"},React.createElement("input",{ref:l,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:K,onChange:s=>V(s.target.value),disabled:H}),React.createElement("button",{type:"submit",className:"send-btn",disabled:H||!K.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),k&&React.createElement("div",{className:"preview-modal",onClick:()=>F(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>F(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:k.url,alt:k.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},k.name),k.price&&React.createElement("div",{className:"price"},k.price.replace(/[đ\s]/g,""),"\u0111"),k.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},k.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:me==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:me==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>rt(k.url,"preview")},React.createElement("i",{className:`fas ${me==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),k.price&&React.createElement("button",{className:me==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>We(k.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${me==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(ft,{show:ne,product:De,categories:ue,onClose:()=>{C(!1),Y(null)},onSave:It}),React.createElement("div",{className:`fab-container mobile-only ${h?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{E(!1),C(!0),Y(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{E(!1),x&&x("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${h?"open":""}`,onClick:()=>E(!h)},React.createElement("i",{className:"fas fa-plus"}))),ve&&f&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>c(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Pe.name,onChange:s=>Ge({...Pe,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Pe.code,onChange:s=>Ge({...Pe,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Pe.price,onChange:s=>Ge({...Pe,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Pe.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>Ge({...Pe,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Pe.category,onChange:s=>Ge({...Pe,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),ct.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Pe.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>Ge({...Pe,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>c(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:Ee},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:S,showToast:x}){const[I,B]=useState([]),[P,_]=useState([]),[M,se]=useState(!0),[ue,X]=useState(null),[be,we]=useState(!1),[me,le]=useState(null),[fe,Fe]=useState(!1),[D,Ne]=useState(null),[ke,Ke]=useState(null),[Ie,Ce]=useState([]);useEffect(()=>{ge()},[]);const ge=async(c=null)=>{se(!0);try{const f=c?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${c}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Q=await window.KTM.api.getJSON(f,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");B(Array.isArray(Q)?Q:[])}catch(f){console.error(f),x("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}se(!1)},Oe=async c=>{try{const f=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${c}`,"L\u1ED7i t\u1EA3i video");_(Array.isArray(f)?f:[])}catch(f){console.error(f)}},Me=async c=>{if(c===0)return;const f=[...I];[f[c-1],f[c]]=[f[c],f[c-1]],B(f),await Ae(f)},Qe=async c=>{if(c===I.length-1)return;const f=[...I];[f[c],f[c+1]]=[f[c+1],f[c]],B(f),await Ae(f)},Ae=async c=>{try{await Promise.all(c.map((f,Q)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${f.id}`,{sortOrder:Q},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),x("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(f){x("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ge(ke==null?void 0:ke.id)}},Je=async c=>{if(c===0)return;const f=[...P];[f[c-1],f[c]]=[f[c],f[c-1]],_(f),await d(f)},Le=async c=>{if(c===P.length-1)return;const f=[...P];[f[c],f[c+1]]=[f[c+1],f[c]],_(f),await d(f)},d=async c=>{try{await Promise.all(c.map((f,Q)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${f.id}`,{sort_order:Q},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),x("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(f){x("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),Oe(ue.id)}},j=()=>{le(null),we(!0)},y=c=>{le(c),we(!0)},K=async c=>{try{!me&&ke&&(c.parent_id=ke.id);const f=me?`${API_BASE}/api/video-folders/${me.id}`:`${API_BASE}/api/video-folders`;me?await window.KTM.api.putJSON(f,c,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(f,c,"L\u1ED7i l\u01B0u folder"),x(me?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),we(!1),ge(ke==null?void 0:ke.id)}catch(f){x(f.message,"danger")}},V=async c=>{const f=c.subfolderCount>0?`X\xF3a folder "${c.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${c.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(f))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${c.id}`,"L\u1ED7i x\xF3a folder"),x("\u0110\xE3 x\xF3a folder","success"),X(null),ge(ke==null?void 0:ke.id)}catch(Q){x("L\u1ED7i x\xF3a folder","danger")}},H=c=>{c.subfolderCount>0?(Ce(f=>[...f,c]),Ke(c),ge(c.id)):(X(c),_(c.videos||[]))},J=c=>{if(c==="root")Ce([]),Ke(null),ge(null);else if(c){const f=Ie.findIndex(Q=>Q.id===c.id);f>=0&&(Ce(Ie.slice(0,f+1)),Ke(c),ge(c.id))}else{const f=[...Ie];f.pop();const Q=f[f.length-1]||null;Ce(f),Ke(Q),ge(Q==null?void 0:Q.id)}},ie=()=>{Ne(null),Fe(!0)},l=c=>{Ne(c),Fe(!0)},k=async c=>{try{c.folder_id=ue==null?void 0:ue.id;const f=D?`${API_BASE}/api/videos/${D.id}`:`${API_BASE}/api/videos`;D?await window.KTM.api.putJSON(f,c,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(f,c,"L\u1ED7i l\u01B0u video"),x(D?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),Fe(!1),ge(),ue&&Oe(ue.id)}catch(f){x(f.message,"danger")}},F=async c=>{if(confirm(`X\xF3a video "${c.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${c.id}`,"L\u1ED7i x\xF3a video"),x("\u0110\xE3 x\xF3a video","success"),ge(),ue&&Oe(ue.id)}catch(f){x("L\u1ED7i x\xF3a video","danger")}},ve=c=>{const f=`https://www.youtube.com/watch?v=${c.youtubeId}`;window.KTM.clipboard.writeText(f).then(()=>{x("\u0110\xE3 copy link!","success")}).catch(()=>{x("Kh\xF4ng th\u1EC3 copy link","danger")})};return ue?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>X(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${ue.slug==="shorts"?"text-danger":"text-warning"}`}),ue.name)),React.createElement("button",{className:"btn btn-warning",onClick:ie},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),P.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},P.map((c,f)=>React.createElement("div",{key:c.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Je(f),disabled:f===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},f+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Le(f),disabled:f===P.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:c.thumb,className:"card-img-top",alt:c.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${c.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:c.title},c.title),React.createElement("small",{className:"text-muted"},c.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>ve(c),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>l(c),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>F(c),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:fe,video:D,onClose:()=>Fe(!1),onSave:k})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},ke&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>J()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),ke?ke.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:j},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Ie.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:c=>{c.preventDefault(),J("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Ie.map((c,f)=>React.createElement("li",{key:c.id,className:`breadcrumb-item ${f===Ie.length-1?"active":""}`},f===Ie.length-1?c.name:React.createElement("a",{href:"#",onClick:Q=>{Q.preventDefault(),J(c)},className:"text-warning"},c.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),M?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):I.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},ke?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:j},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",ke?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},I.map((c,f)=>{var Q,h,E,ne;return React.createElement("div",{key:c.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:C=>{C.stopPropagation(),Me(f)},disabled:f===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},f+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:C=>{C.stopPropagation(),Qe(f)},disabled:f===I.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>H(c),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${c.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},c.name),React.createElement("p",{className:"text-muted mb-0"},c.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),c.subfolderCount," folder"),c.subfolderCount>0&&(c.videoCount>0||((Q=c.videos)==null?void 0:Q.length)>0)&&" \u2022 ",(c.videoCount>0||((h=c.videos)==null?void 0:h.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),c.videoCount||((E=c.videos)==null?void 0:E.length)||0," videos"),c.subfolderCount===0&&!c.videoCount&&!((ne=c.videos)!=null&&ne.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:C=>{C.stopPropagation(),y(c)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:C=>{C.stopPropagation(),V(c)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:be,folder:me,onClose:()=>we(!1),onSave:K}))}function VideoFolderModal({show:S,folder:x,onClose:I,onSave:B}){const[P,_]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[M,se]=useState(!1),[ue,X]=useState(!1);useEffect(()=>{_(x?{name:x.name||"",description:x.description||"",sortOrder:x.sortOrder||0,coverImage:x.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[x,S]);const be=async me=>{const le=me.target.files[0];if(le){X(!0);try{const fe=await window.KTM.cloudinary.uploadImage({file:le,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});fe.secure_url&&_(Fe=>({...Fe,coverImage:fe.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(fe){console.error("Cloudinary upload error:",fe),alert("L\u1ED7i upload \u1EA3nh: "+(fe.message||fe))}finally{X(!1)}}},we=async me=>{me.preventDefault(),se(!0);const le={...P,variants:normalizeVariants(P.variants,P.price),attributes:normalizeAttributes(P.attributes)};await B(le),se(!1)};return S?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:I})),React.createElement("form",{onSubmit:we},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:P.name,onChange:me=>_({...P,name:me.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:P.description,onChange:me=>_({...P,description:me.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sortOrder,onChange:me=>_({...P,sortOrder:parseInt(me.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},P.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:P.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>_({...P,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:be,disabled:ue}),ue&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:P.coverImage,onChange:me=>_({...P,coverImage:me.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:I},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:M},M?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:S,settings:x}){const[I,B]=useState([]),[P,_]=useState(!0),[M,se]=useState(!1),[ue,X]=useState(null),[be,we]=useState(""),[me,le]=useState(""),[fe,Fe]=useState(!1),[D,Ne]=useState(null),ke=normalizeShipPercent(x==null?void 0:x.ship_percent),{parseMoney:Ke,formatVND:Ie}=window.KTM.money,Ce=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{ge()},[]);const ge=async()=>{_(!0);try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");B(Array.isArray(l)?l:[])}catch(l){console.error(l),S("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}_(!1)},Oe=()=>{X(null),se(!0)},Me=l=>{X(l),se(!0)},Qe=l=>{l&&(Ne(l),Fe(!0))},Ae=()=>{Fe(!1)},Je=async l=>{if(!(!l||!l.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:l},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),S(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),ge()}catch(k){S("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},Le=async l=>{try{const k=ue?`${API_BASE}/api/products?id=${ue.id}`:`${API_BASE}/api/products`;ue?await window.KTM.api.putJSON(k,l,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(k,l,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),S(ue?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),se(!1),ge()}catch(k){S(k.message,"danger")}},d=async l=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${l.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${l.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),S("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ge()}catch(k){S(k.message,"danger")}},j=I.filter(l=>{const k=!be||l.name.toLowerCase().includes(be.toLowerCase())||l.code&&l.code.toLowerCase().includes(be.toLowerCase()),F=!me||l.category===me;return k&&F}),y=l=>{var ve;const k=(ve=l==null?void 0:l.commission_percent)!=null?ve:l==null?void 0:l.commissionPercent,F=k===""||k==null?NaN:Number(k);return Number.isFinite(F)?Math.max(0,Math.min(100,F)):5},K=l=>{const k=y(l),F=Number.isInteger(k)?String(k):String(Math.round(k*100)/100),ve=Ke(l==null?void 0:l.price);if(!Number.isFinite(ve)||ve<=0)return`${F}%`;const c=(Number(k)||0)/100,Q=window.KTM.money.parseShipFeeFromNote(l==null?void 0:l.note)!=null?0:ke>0?ve*ke/100:0,h=ve*c-Q*c,E=Math.max(0,Math.round(h));return`${F}% - ${Ie(E)}`},V=l=>{if(l==null||l==="")return[];let k=l;if(typeof k=="string"){const F=k.trim();if(!F)return[];try{k=JSON.parse(F)}catch(ve){return[]}}return Array.isArray(k)?k:[]},H=l=>{if(l==null||l==="")return[];let k=l;if(typeof k=="string"){const F=k.trim();if(!F)return[];try{k=JSON.parse(F)}catch(ve){return[]}}return k&&typeof k=="object"&&!Array.isArray(k)&&(k=Object.entries(k).map(([F,ve])=>({key:F,value:ve}))),Array.isArray(k)?k:[]},J=l=>{const k=H(l).map(F=>{var ve,c,f,Q,h;return{key:String((f=(c=(ve=F==null?void 0:F.key)!=null?ve:F==null?void 0:F.name)!=null?c:F==null?void 0:F.label)!=null?f:"").trim(),value:String((Q=F==null?void 0:F.value)!=null?Q:"").trim(),unit:String((h=F==null?void 0:F.unit)!=null?h:"").trim()}}).filter(F=>!!F.key);return k.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},k.map((F,ve)=>{const c=F.key,f=`${F.value||""}${F.unit?(F.value?" ":"")+F.unit:""}`.trim();return React.createElement("div",{key:`${c}-${ve}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},c),f?React.createElement("span",{className:"ktm-chip ktm-chip-option"},f):null)}))):null},ie=(l,k={})=>{const F=V(l).map(Q=>{var h;return{name:String((h=Q==null?void 0:Q.name)!=null?h:"").trim(),options:Array.isArray(Q==null?void 0:Q.options)?Q.options:[]}}).map(Q=>({...Q,options:Q.options.map(h=>{var E;return{label:String((E=h==null?void 0:h.label)!=null?E:"").trim(),price:Number(h==null?void 0:h.price)}}).filter(h=>!!h.label)})).filter(Q=>Q.options.length>0);if(!F.length)return null;const ve=Number.isFinite(k.maxGroups)?Math.max(1,Math.trunc(k.maxGroups)):F.length,c=Number.isFinite(k.maxOptionsPerGroup)?Math.max(1,Math.trunc(k.maxOptionsPerGroup)):4,f=F.slice(0,ve);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},f.map((Q,h)=>{const E=Q.name||"Bi\u1EBFn th\u1EC3",ne=Q.options.slice(0,c),C=Q.options.length-ne.length;return React.createElement("div",{key:`${E}-${h}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},E),ne.map((De,Y)=>{const Pe=De.price,Ge=Number.isFinite(Pe)&&Pe>=0?Ie(Math.trunc(Pe)):"",ct=Ge?`${De.label} \xB7 ${Ge}`:De.label;return React.createElement("span",{key:`${E}-${h}-${Y}`,className:"ktm-chip ktm-chip-option"},ct)}),C>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",C))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Oe},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:be,onChange:l=>we(l.target.value)})),React.createElement("span",{className:"product-count"},j.length)),React.createElement("select",{className:"form-select",value:me,onChange:l=>le(l.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),Ce.map(l=>React.createElement("option",{key:l,value:l},l)))),P?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):j.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Oe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},j.map(l=>React.createElement("div",{key:l.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>Qe(l),onKeyDown:k=>{(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),Qe(l))},title:"Xem chi ti\u1EBFt"},l.image?React.createElement("img",{src:l.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},l.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},l.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},l.category),l.code&&React.createElement("span",{className:"product-badge bg-secondary"},l.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),K(l))),React.createElement("div",{className:"product-price"},l.price?l.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),l.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},l.note),J(l.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},J(l.attributes)),ie(l.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},ie(l.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:k=>{k.stopPropagation(),Me(l)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:k=>{k.stopPropagation(),d(l)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:fe,title:String((D==null?void 0:D.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((D==null?void 0:D.code)||"").trim()||null,String((D==null?void 0:D.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Ae,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const l=String((D==null?void 0:D.code)||"").trim();l&&window.KTM.clipboard.writeText(l).then(()=>S("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((D==null?void 0:D.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const l=String((D==null?void 0:D.price)||"").trim();l&&window.KTM.clipboard.writeText(l).then(()=>S("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((D==null?void 0:D.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>D&&Me(D),disabled:!D},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>D&&d(D),disabled:!D},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},D?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const l=String((D==null?void 0:D.price)||"").trim(),k=Ke(l);return Number.isFinite(k)&&k>0?Ie(Math.trunc(k)):l||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},K(D)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},D.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},D.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),D.image?React.createElement("img",{src:D.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(D.note||"").trim()||D.attributes||D.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(D.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(D.note||"").trim()),J(D.attributes)?React.createElement("div",{className:"mt-2"},J(D.attributes)):null,ie(D.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},ie(D.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:M,product:ue,categories:Ce,onClose:()=>se(!1),onSave:Le}))}function ProductModal({show:S,product:x,categories:I,onClose:B,onSave:P}){const[_,M]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[se,ue]=useState(!1),[X,be]=useState(!1),we=d=>{const j=window.KTM.money.getDigits(String(d!=null?d:"")),y=Number(j);return j&&Number.isFinite(y)?Math.trunc(y):0},me=d=>{if(d==null||d==="")return[];let j=d;if(typeof j=="string"){const y=j.trim();if(!y)return[];try{j=JSON.parse(y)}catch(K){return[]}}return j&&typeof j=="object"&&!Array.isArray(j)&&(j=Object.entries(j).map(([y,K])=>({key:y,value:K}))),Array.isArray(j)?j.map(y=>{var J,ie,l,k,F;if(!y||typeof y!="object")return null;const K=String((l=(ie=(J=y.key)!=null?J:y.name)!=null?ie:y.label)!=null?l:"").trim(),V=String((k=y.value)!=null?k:"").trim(),H=String((F=y.unit)!=null?F:"").trim();return K?{key:K,value:V,unit:H}:null}).filter(Boolean):[]},le=(d,j)=>{if(d==null||d==="")return[];let y=d;if(typeof y=="string"){const V=y.trim();if(!V)return[];try{y=JSON.parse(V)}catch(H){return[]}}if(!Array.isArray(y))return[];const K=we(j);return y.map(V=>{var ie;if(!V||typeof V!="object")return null;const H=String((ie=V.name)!=null?ie:"").trim(),J=(Array.isArray(V.options)?V.options:[]).map(l=>{var Q,h,E,ne,C,De,Y;if(!l||typeof l!="object")return null;const k=String((Q=l.label)!=null?Q:"").trim();if(!k)return null;const F=(C=(ne=(E=(h=l.price)!=null?h:l.priceValue)!=null?E:l.unit_price)!=null?ne:l.unitPrice)!=null?C:null,ve=Number(F);let c=Number.isFinite(ve)?Math.trunc(ve):null;if(c==null){const Pe=(Y=(De=l.price_delta)!=null?De:l.priceDelta)!=null?Y:null,Ge=Number(Pe);Number.isFinite(Ge)&&(c=K+Math.trunc(Ge))}c==null&&(c=K);const f=String(Math.max(0,Math.trunc(Number(c)||0)));return{label:k,price:Math.max(0,Math.trunc(Number(c)||0)),priceDigits:f}}).filter(Boolean);return{name:H||"Bi\u1EBFn th\u1EC3",options:J}}).filter(Boolean)};useEffect(()=>{var d,j;M(x?{name:x.name||"",code:x.code||"",price:x.price||"",image:x.image||"",category:x.category||"",note:x.note||"",sort_order:x.sort_order||0,commission_percent:(j=(d=x.commission_percent)!=null?d:x.commissionPercent)!=null?j:5,variants:le(x.variants,x.price),attributes:me(x.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[x,S]);const fe=d=>{M(j=>{var J;const y=we(j.price),K=String(y),V=Array.isArray(j.variants)?[...j.variants]:[],H={...V[d]||{},options:Array.isArray((J=V[d])==null?void 0:J.options)?[...V[d].options]:[]};return H.options=H.options.map(ie=>({label:String((ie==null?void 0:ie.label)||""),price:y,priceDigits:K})),V[d]=H,{...j,variants:V}})},Fe=()=>{M(d=>{const j=we(d.price),y=String(j),V=(Array.isArray(d.variants)?[...d.variants]:[]).map(H=>{const J=(Array.isArray(H==null?void 0:H.options)?H.options:[]).map(ie=>({label:String((ie==null?void 0:ie.label)||""),price:j,priceDigits:y}));return{name:String((H==null?void 0:H.name)||"Bi\u1EBFn th\u1EC3"),options:J}});return{...d,variants:V}})},[D,Ne]=React.useState(""),ke=d=>window.KTM.money.formatVNDInputDigits(d),[Ke,Ie]=React.useState(""),Ce=d=>{const j=window.KTM.money.nextPriceInputState(d.target.value,Ke);Ie(j.digits),M({..._,price:j.price})},[ge,Oe]=React.useState("");React.useEffect(()=>{x!=null&&x.image&&Oe(x.image)},[x]);const Me=async d=>{if(!(!d||!d.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:d},"L\u1ED7i x\xF3a \u1EA3nh")}catch(j){console.error("Delete cloudinary image error:",j)}},Qe=async(d,j=2,y)=>{const K=j*1024*1024,V=d.type==="image/heic"||d.type==="image/heif"||/\.heic$/i.test(d.name);if(d.size<=K&&!V)return d;y==null||y("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const H=await createImageBitmap(d);y==null||y("\u0110ang n\xE9n \u1EA3nh...");const J=document.createElement("canvas");let ie=H.width,l=H.height;const k=1200;return(ie>k||l>k)&&(ie>l?(l=Math.round(l/ie*k),ie=k):(ie=Math.round(ie/l*k),l=k)),J.width=ie,J.height=l,J.getContext("2d").drawImage(H,0,0,ie,l),H.close(),new Promise((ve,c)=>{J.toBlob(f=>{f?(y==null||y("Ho\xE0n t\u1EA5t!"),ve(new File([f],d.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):c(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(H){throw console.error("createImageBitmap error:",H),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ae=async d=>{var K,V;const j=(K=d.target.files)==null?void 0:K[0];if(!j)return;if(!(j.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(j.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}be(!0),Ne("\u0110ang chu\u1EA9n b\u1ECB...");try{const H=(j.size/1024/1024).toFixed(1);Ne(`File ${H}MB - \u0110ang n\xE9n...`);const J=await Qe(j,2,k=>{Ne(k)}),ie=(J.size/1024/1024).toFixed(1);Ne(`\u0110\xE3 n\xE9n: ${ie}MB - \u0110ang upload...`);const l=await window.KTM.cloudinary.uploadImage({file:J,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});l.secure_url?(_.image&&_.image!==ge&&Me(_.image),M(k=>({...k,image:l.secure_url})),Ne("")):(console.error("Cloudinary error:",l),alert("Upload th\u1EA5t b\u1EA1i: "+(((V=l.error)==null?void 0:V.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Ne(""))}catch(H){console.error("Upload error:",H),alert("L\u1ED7i: "+H.message),Ne("")}be(!1),d.target.value=""},Je=()=>{_.image&&(_.image!==ge&&Me(_.image),M(d=>({...d,image:""})))},Le=async d=>{d.preventDefault(),ue(!0),ge&&_.image&&ge!==_.image&&await Me(ge),ge&&!_.image&&await Me(ge),await P(_),ue(!1)};return S?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${x?"fa-edit":"fa-plus-circle"} me-2`}),x?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:B})),React.createElement("form",{onSubmit:Le},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},_.image?React.createElement(React.Fragment,null,React.createElement("img",{src:_.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Je,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${X?"fa-spinner fa-spin":"fa-camera"} me-1`}),X?D||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Ae,disabled:X,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),X&&D&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},D))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:_.name,onChange:d=>M({..._,name:d.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:_.code,onChange:d=>M({..._,code:d.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:_.price,onChange:Ce,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:_.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:d=>M({..._,commission_percent:d.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:_.category,onChange:d=>M({..._,category:d.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),I.map(d=>React.createElement("option",{key:d,value:d},d)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:_.note,onChange:d=>M({..._,note:d.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(_.attributes)?_.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(_.attributes)?_.attributes:[]).map((d,j)=>React.createElement("div",{key:j,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(d==null?void 0:d.key)||"",onChange:y=>{const K=y.target.value;M(V=>{const H=Array.isArray(V.attributes)?[...V.attributes]:[];return H[j]={...H[j]||{},key:K},{...V,attributes:H}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(d==null?void 0:d.value)||"",onChange:y=>{const K=y.target.value;M(V=>{const H=Array.isArray(V.attributes)?[...V.attributes]:[];return H[j]={...H[j]||{},value:K},{...V,attributes:H}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(d==null?void 0:d.unit)||"",onChange:y=>{const K=y.target.value;M(V=>{const H=Array.isArray(V.attributes)?[...V.attributes]:[];return H[j]={...H[j]||{},unit:K},{...V,attributes:H}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{M(y=>{const K=Array.isArray(y.attributes)?[...y.attributes]:[];return K.splice(j,1),{...y,attributes:K}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{M(d=>{const j=Array.isArray(d.attributes)?[...d.attributes]:[];return j.push({key:"",value:"",unit:""}),{...d,attributes:j}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(_.variants)?_.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(_.variants)?_.variants:[]).map((d,j)=>React.createElement("div",{key:j,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(d==null?void 0:d.name)||"",onChange:y=>{const K=y.target.value;M(V=>{var J;const H=Array.isArray(V.variants)?[...V.variants]:[];return H[j]={...H[j]||{},name:K,options:Array.isArray((J=H[j])==null?void 0:J.options)?H[j].options:[]},{...V,variants:H}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>fe(j),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(d==null?void 0:d.options)||d.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{M(y=>{const K=Array.isArray(y.variants)?[...y.variants]:[];return K.splice(j,1),{...y,variants:K}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(d==null?void 0:d.options)?d.options:[]).map((y,K)=>{var V,H;return React.createElement("div",{key:K,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(y==null?void 0:y.label)||"",onChange:J=>{const ie=J.target.value;M(l=>{var f,Q,h,E,ne;const k=Array.isArray(l.variants)?[...l.variants]:[],F={...k[j]||{},options:Array.isArray((f=k[j])==null?void 0:f.options)?[...k[j].options]:[]},ve=Number((h=(Q=F.options[K])==null?void 0:Q.price)!=null?h:0)||0,c=String((ne=(E=F.options[K])==null?void 0:E.priceDigits)!=null?ne:Math.max(0,Math.trunc(ve)));return F.options[K]={...F.options[K]||{},label:ie,price:Math.max(0,Math.trunc(ve)),priceDigits:c},k[j]=F,{...l,variants:k}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:ke(String((H=y==null?void 0:y.priceDigits)!=null?H:window.KTM.money.getDigits(String((V=y==null?void 0:y.price)!=null?V:"")))),onChange:J=>{M(ie=>{var h,E,ne,C,De;const l=String((E=y==null?void 0:y.priceDigits)!=null?E:window.KTM.money.getDigits(String((h=y==null?void 0:y.price)!=null?h:""))),k=window.KTM.money.nextPriceInputState(J.target.value,l),F=String((ne=k.digits)!=null?ne:""),ve=Number(F),c=Number.isFinite(ve)?Math.max(0,Math.trunc(ve)):0,f=Array.isArray(ie.variants)?[...ie.variants]:[],Q={...f[j]||{},options:Array.isArray((C=f[j])==null?void 0:C.options)?[...f[j].options]:[]};return Q.options[K]={...Q.options[K]||{},label:String(((De=Q.options[K])==null?void 0:De.label)||""),price:c,priceDigits:F},f[j]=Q,{...ie,variants:f}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{M(J=>{var k;const ie=Array.isArray(J.variants)?[...J.variants]:[],l={...ie[j]||{},options:Array.isArray((k=ie[j])==null?void 0:k.options)?[...ie[j].options]:[]};return l.options.splice(K,1),ie[j]=l,{...J,variants:ie}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{M(y=>{var J;const K=Array.isArray(y.variants)?[...y.variants]:[],V={...K[j]||{},options:Array.isArray((J=K[j])==null?void 0:J.options)?[...K[j].options]:[]},H=we(y.price);return V.options.push({label:"",price:H,priceDigits:String(H)}),K[j]=V,{...y,variants:K}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{M(d=>{const j=we(d.price),y=Array.isArray(d.variants)?[...d.variants]:[],K=String(j);return y.push({name:"Size",options:[{label:"S",price:j,priceDigits:K},{label:"M",price:j,priceDigits:K},{label:"L",price:j,priceDigits:K}]}),{...d,variants:y}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Fe,disabled:!Array.isArray(_.variants)||_.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:_.image,onChange:d=>M({..._,image:d.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:B,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:se,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:S,video:x,onClose:I,onSave:B}){const[P,_]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[M,se]=useState(!1),[ue,X]=useState("");useEffect(()=>{x?(_({title:x.title||"",youtube_url:`https://www.youtube.com/watch?v=${x.youtubeId}`,thumbnail_url:x.thumb||"",sort_order:x.sortOrder||0}),X(x.thumb)):(_({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),X(""))},[x,S]);const be=le=>{const fe=le.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return fe?fe[1]:null},we=le=>{_({...P,youtube_url:le});const fe=be(le);fe&&X(`https://img.youtube.com/vi/${fe}/hqdefault.jpg`)},me=async le=>{le.preventDefault(),se(!0),await B(P),se(!1)};return S?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},x?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:I})),React.createElement("form",{onSubmit:me},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:P.youtube_url,onChange:le=>we(le.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),ue&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:ue,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:P.title,onChange:le=>_({...P,title:le.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sort_order,onChange:le=>_({...P,sort_order:parseInt(le.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:P.thumbnail_url,onChange:le=>_({...P,thumbnail_url:le.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:I},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:M},M?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[S,x]=useState(!1),[I,B]=useState(""),[P,_]=useState(null),[M,se]=useState("search"),[ue,X]=useState(null),[be,we]=useState(""),[me,le]=useState([]),[fe,Fe]=useState(null),[D,Ne]=useState(!1),[ke,Ke]=useState(null),[Ie,Ce]=useState(!0),[ge,Oe]=useState([]),[Me,Qe]=useState(()=>loadAdminSettings()),[Ae,Je]=useState(null),[Le,d]=useState([]);useEffect(()=>{const h=localStorage.getItem("ktm_admin_session");if(h)try{const E=JSON.parse(h);E.expiry>Date.now()?(x(!0),_(E.user)):localStorage.removeItem("ktm_admin_session")}catch(E){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{S&&H()},[S]),useEffect(()=>{if(!S)return;let h=!1;return(async()=>{try{const E=await fetchAdminSettingsFromServer();if(h)return;Qe(E),saveAdminSettings(E)}catch(E){}})(),()=>{h=!0}},[S]);const j=async(h,E)=>{B("");try{const ne=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:h,password:E},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),C={user:ne.user,token:ne.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(C)),_(ne.user),x(!0)}catch(ne){B(ne.message)}},y=()=>{localStorage.removeItem("ktm_admin_session"),x(!1),_(null),le([]),Fe(null)},K=(h,E="success")=>{const ne=Date.now();Oe(C=>[...C,{id:ne,message:h,type:E}])},V=h=>{Oe(E=>E.filter(ne=>ne.id!==h))},H=async(h=null)=>{Ce(!0);try{const E=h?`${API_BASE}/api/albums?parent_id=${h}`:`${API_BASE}/api/albums?parent_id=root`,ne=await window.KTM.api.getJSON(E,"L\u1ED7i t\u1EA3i danh s\xE1ch album");le(Array.isArray(ne)?ne:[])}catch(E){console.error(E),K("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}Ce(!1)},J=()=>{Ke(null),Ne(!0)},ie=h=>{Ke(h),Ne(!0)},l=async h=>{try{const E=ke&&ke.uuid;!E&&Ae&&(h.parent_id=Ae.uuid);const ne=E?`${API_BASE}/api/albums/${ke.uuid||ke.id}`:`${API_BASE}/api/albums`;E?await window.KTM.api.putJSON(ne,h,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(ne,h,"L\u1ED7i t\u1EA1o"),K(E?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),Ne(!1),H(Ae==null?void 0:Ae.uuid)}catch(E){K(E.message,"danger")}},k=h=>{Fe(h)},F=h=>{if(h==="root")d([]),Je(null),H(null);else if(h){const E=Le.findIndex(ne=>ne.uuid===h.uuid);E>=0&&(d(Le.slice(0,E+1)),Je(h),H(h.uuid))}else{const E=[...Le];E.pop();const ne=E[E.length-1]||null;d(E),Je(ne),H(ne==null?void 0:ne.uuid)}},ve=async h=>{const E=`X\xF3a folder "${h.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(E))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${h.uuid||h.id}`,"L\u1ED7i x\xF3a album"),K("\u0110\xE3 x\xF3a","success"),H(Ae==null?void 0:Ae.uuid)}catch(ne){K("L\u1ED7i x\xF3a album","danger")}};if(!S)return React.createElement(LoginPage,{onLogin:j,error:I});const c=()=>{const h=new Date,E=h.getFullYear(),ne=String(h.getMonth()+1).padStart(2,"0");return`${E}-${ne}`};function f(){const[h,E]=useState(()=>{var Y;return String((Y=Me==null?void 0:Me.ship_percent)!=null?Y:DEFAULT_SHIP_PERCENT)}),[ne,C]=useState(!1);return useEffect(()=>{var Y;E(String((Y=Me==null?void 0:Me.ship_percent)!=null?Y:DEFAULT_SHIP_PERCENT))},[Me==null?void 0:Me.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Y=>{Y.preventDefault(),C(!0);const Pe=saveAdminSettings({ship_percent:h});try{const Ge=await saveAdminSettingsToServer(Pe);Qe(Ge),saveAdminSettings(Ge),K("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Ge){Qe(Pe),K("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{C(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:h,min:"0",max:"100",step:"0.01",onChange:Y=>E(Y.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:ne},ne?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function Q(){const[h,E]=useState(c()),[ne,C]=useState(!0),De=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[Y,Pe]=useState(De),Ge=useRef(new Map),ct=normalizeShipPercent(Me==null?void 0:Me.ship_percent),{formatNumber:ye,formatVND:Ee}=window.KTM.money,bt=async(te,it=!1)=>{var Ye,We;const dt=String(te||"").trim();if(!dt)return De();const mt=`${dt}|${ct}`,ht=(Ye=Ge.current)==null?void 0:Ye.get(mt);if(!it&&ht)return ht;const N=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(dt)}&ship_percent=${encodeURIComponent(ct)}`,U=await window.KTM.api.getJSON(N,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),b=U!=null&&U.stats&&(U!=null&&U.meta)?U.stats:U,Te=b&&typeof b=="object"?b:De();return(We=Ge.current)==null||We.set(mt,Te),Te},It=async(te=!1)=>{C(!0);try{const it=await bt(h,te);Pe(it)}catch(it){console.error("Load stats error:",it),Pe(De())}finally{C(!1)}};return useEffect(()=>{It()},[h,ct]),React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:ne}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>It(!0),disabled:ne},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:h,onChange:te=>E(te.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",ct,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),ye(Y.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),ye(Y.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),ye(Y.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",ye(Y.statusCounts.paid),"/",ye(Y.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ye(Y.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ee(Y.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ee(Y.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ee(Y.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ee(Y.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",Y.avgQtyPerOrder?Y.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},ye(Y.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},ye(Y.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},ye(Y.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},ye(Y.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},ye(Y.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},ye(Y.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},ye(Y.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,ye(Y.statusCounts.draft)),React.createElement("td",null,ye(Y.statusCounts.pending)),React.createElement("td",null,ye(Y.statusCounts.processing)),React.createElement("td",null,ye(Y.statusCounts.canceled)),React.createElement("td",null,ye(Y.statusCounts.done)),React.createElement("td",null,ye(Y.statusCounts.paid)),React.createElement("td",null,ye(Y.statusCounts.other)),React.createElement("td",null,ye(Y.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Y.products.slice(0,10).map(te=>React.createElement("div",{key:te.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},te.product_name),React.createElement("div",{className:"text-muted small text-truncate"},te.product_code?`#${te.product_code} \u2022 `:"",ye(te.orders)," \u0111\u01A1n \u2022 ",ye(te.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ee(te.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Y.products.slice(0,10).map(te=>React.createElement("tr",{key:te.product_id},React.createElement("td",null,te.product_name),React.createElement("td",null,te.product_code||"\u2014"),React.createElement("td",null,ye(te.orders)),React.createElement("td",null,ye(te.quantity)),React.createElement("td",{className:"fw-semibold"},Ee(te.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Y.customers.slice(0,10).map(te=>React.createElement("div",{key:te.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},te.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},te.phone||"\u2014"," \u2022 ",ye(te.orders)," \u0111\u01A1n \u2022 ",ye(te.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ee(te.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Y.customers.slice(0,10).map(te=>React.createElement("tr",{key:te.key},React.createElement("td",null,te.customer_name||"\u2014"),React.createElement("td",null,te.phone||"\u2014"),React.createElement("td",null,ye(te.orders)),React.createElement("td",null,ye(te.quantity)),React.createElement("td",{className:"fw-semibold"},Ee(te.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},Y.days.map(te=>React.createElement("div",{key:te.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},te.day),React.createElement("div",{className:"text-muted small"},ye(te.orders)," \u0111\u01A1n \u2022 ",ye(te.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",ye(te.doneOrders)," \u2022 ",Ee(te.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Ee(te.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,Y.days.map(te=>React.createElement("tr",{key:te.day},React.createElement("td",null,te.day),React.createElement("td",null,ye(te.orders)),React.createElement("td",null,ye(te.quantity)),React.createElement("td",{className:"fw-semibold"},Ee(te.revenue)),React.createElement("td",null,ye(te.doneOrders)),React.createElement("td",{className:"fw-semibold"},Ee(te.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:M,onMenuChange:h=>{se(h),h==="albums"&&(Je(null),d([]),H(null))},onLogout:y,currentUser:P}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const E={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[M]||{title:"KTM Admin",icon:"fa-tractor",sub:""},ne=(P==null?void 0:P.username)||(P==null?void 0:P.name)||(P==null?void 0:P.email)||"Admin",C=(()=>{if(M!=="albums")return"";const De=[];return De.push("Root"),Array.isArray(Le)&&Le.length>0&&De.push(...Le.map(Y=>Y==null?void 0:Y.title).filter(Boolean)),fe!=null&&fe.title&&De.push(fe.title),De.length>0?De.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${E.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},E.title),React.createElement("div",{className:"admin-page-subtitle"},C||E.sub))),React.createElement("div",{className:"admin-topbar-right"},M==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:J,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:ne},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},ne)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:y,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},M==="albums"&&!fe&&React.createElement(AlbumList,{albums:me,loading:Ie,currentFolder:Ae,breadcrumb:Le,onSelect:k,onCreate:J,onEdit:ie,onDelete:ve,onBack:F}),M==="search"&&React.createElement(SearchCenter,{showToast:K,onNavigate:(h,E,ne)=>{se(h),h==="orders"&&E==="create"&&(X(Date.now()),we((ne==null?void 0:ne.productId)||""))}}),M==="albums"&&fe&&React.createElement(AlbumDetail,{album:fe,parentAlbum:Le.length>0?Le[Le.length-1]:null,onBack:()=>{if(fe.parentId){const h=Le.findIndex(E=>E.uuid===fe.parentId);h>=0?Fe(Le[h]):Fe(null)}else Fe(null)},onRefresh:()=>H(Ae==null?void 0:Ae.uuid),showToast:K,onNavigateToFolder:h=>{d(E=>[...E,fe]),Fe(h)},onEditSubfolder:h=>{Ke(h),Ne(!0)}}),M==="videos"&&React.createElement(VideoList,{showToast:K}),M==="products"&&React.createElement(ProductManager,{showToast:K,settings:Me}),M==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:ue,autoOpenCreateProductId:be,showToast:K}),M==="stats"&&React.createElement(Q,null),M==="settings"&&React.createElement(f,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${M==="search"?"active":""}`,onClick:h=>{h.preventDefault(),se("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${M==="albums"?"active":""}`,onClick:h=>{h.preventDefault(),se("albums"),Fe(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${M==="videos"?"active":""}`,onClick:h=>{h.preventDefault(),se("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${M==="products"?"active":""}`,onClick:h=>{h.preventDefault(),se("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${M==="orders"?"active":""}`,onClick:h=>{h.preventDefault(),se("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${M==="stats"?"active":""}`,onClick:h=>{h.preventDefault(),se("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:D,album:ke,parentId:Ae==null?void 0:Ae.uuid,onClose:()=>Ne(!1),onSave:l}),React.createElement("div",{className:"toast-container"},ge.map(h=>React.createElement(Toast,{key:h.id,message:h.message,type:h.type,onClose:()=>V(h.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:S,autoOpenCreateProductId:x,showToast:I}){const[B,P]=useState([]),[_,M]=useState(0),[se,ue]=useState(!1),[X,be]=useState(!1),[we,me]=useState([]),[le,fe]=useState(!0),[Fe,D]=useState(!1),[Ne,ke]=useState([]),[Ke,Ie]=useState(!1),[Ce,ge]=useState(""),[Oe,Me]=useState([]),[Qe,Ae]=useState(!1),[Je,Le]=useState(""),[d,j]=useState(!1),[y,K]=useState(null),[V,H]=useState(null),[J,ie]=useState(!1),[l,k]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[F,ve]=useState(""),[c,f]=useState(!1),[Q,h]=useState(!1),[E,ne]=useState(!1),[C,De]=useState(null),[Y,Pe]=useState(!1),[Ge,ct]=useState(""),ye=useRef(0),[Ee,bt]=useState(null),[It,te]=useState(!1),[it,dt]=useState([]),[mt,ht]=useState(!1),[N,U]=useState([]),[b,Te]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Ye,We]=useState([""]),[rt,ot]=useState(null),wt=useRef({}),[ft,Et]=useState([]),[Ve,_t]=useState(null),Qt=useRef(null),Dt=useRef(null),Ft=useRef(0),gt=useRef(null),Ct=useRef(0),s=useRef(new Map),v=useRef(null),O=useRef(0),W=useRef(new Map),Z=useRef(new Map),$=useRef(""),p=useRef(null),G=useRef(0),pe=useRef(null),ce=9,ae=150,he=250,Xe=3*60*1e3,He=24*60*60*1e3,tt=5*60*1e3,Nt="ktm_customer_lookup_cache_v1",vt=200,Ze=3,Mt=3,Yt=1,ya=24*60*60*1e3,Ht=120,Na=5*60*1e3,Zt=80,ea=2,ta=4,R=60,T=React.useMemo(()=>String(Ce||"").trim().length>0,[Ce]),q=e=>String(e||"").replace(/\s+/g," ").trim(),re=e=>String(e||"").replace(/[^0-9]+/g,""),de=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/ya)}catch(a){return 0}},oe=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:de(e)>=Ze,$e=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},_e=e=>{if($e(e==null?void 0:e.status)!=="draft")return null;const t=Mt-de(e);return Number.isFinite(t)?t:null},qe=e=>{const a=_e(e);return Number.isFinite(a)?a>0&&a<=Yt:!1},Ue=e=>{Te({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),We([""]),bt(null),ot(null)};useEffect(()=>{const e=a=>{var n;if(rt==null)return;const t=(n=wt.current)==null?void 0:n[rt];t&&!t.contains(a.target)&&ot(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[rt]);const at=e=>window.KTM.money.parseMoney(e),yt=e=>window.KTM.money.parseSignedMoney(e),je=e=>window.KTM.money.formatVND(e),lt=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var o,r;return{amount:String((o=n==null?void 0:n.amount)!=null?o:""),note:String((r=n==null?void 0:n.note)!=null?r:"")}});return t.length?t:[{amount:"",note:""}]},xt=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var o,r;return{amount:(n==null?void 0:n.amount)===0?"":String((o=n==null?void 0:n.amount)!=null?o:""),note:String((r=n==null?void 0:n.note)!=null?r:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},ut=e=>(Array.isArray(e)?e:[]).map(t=>({amount:yt(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),At=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=ut(a),n=pt(t),o=(()=>{if(!t.length)return"";const r=t.map(w=>String((w==null?void 0:w.note)||"").trim()).filter(Boolean);return r.length?r.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:o}},pt=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),Ot=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},Vt=e=>window.KTM.money.parseShipFeeFromNote(e),Rt=e=>window.KTM.phone.isValid(e),ze=e=>window.KTM.phone.normalize(e),aa=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},Ua=(e,a)=>{var r;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const o=new Map(t.map(w=>{var m;return[String((m=w==null?void 0:w.id)!=null?m:""),w]}));for(const w of n){const m=String((r=w==null?void 0:w.id)!=null?r:"");m&&o.set(m,w)}return Array.from(o.values())},na=async e=>{if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const a=await aa(e.id);if(a&&typeof a=="object")return P(t=>Array.isArray(t)?t.map(n=>String(n==null?void 0:n.id)===String(e.id)?a:n):t),a}catch(a){console.error("Fetch order by id error:",a)}return e},Wa=()=>{var e;try{const a=localStorage.getItem(Nt);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[o,r]of n)!o||!r||typeof r!="object"||(e=Z.current)==null||e.set(String(o),r)}catch(a){}},wa=()=>{try{const e=Z.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,o])=>n&&o&&typeof o=="object"&&Number.isFinite(o.ts)).sort((n,o)=>(Number(o[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,vt),t={};for(const[n,o]of a)t[n]=o;localStorage.setItem(Nt,JSON.stringify(t))}catch(e){}};useEffect(()=>{Wa()},[]);const Ia=e=>{const a=ze(e);if(!a)return null;const t=Array.isArray(B)?B:[];let n=null,o=-1;for(const r of t){if(!r||ze(r.phone||"")!==a)continue;const w=new Date(r.created_at).getTime(),m=Number.isFinite(w)?w:0;m>=o&&(o=m,n=r)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},Da=(e,a)=>{e&&Te(t=>a&&ze(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Xa=e=>{const a=Ia(e);if(!a)return;const t=ze(e);Te(n=>{if(t&&ze(n.phone)!==t)return n;const o={...n};return!String(n.customer_name||"").trim()&&a.name&&(o.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(o.address=a.address),o})},Qa=(e,a,t)=>{var n;try{const o=ze(e);if(!o)return;const r=String(a||"").trim(),w=String(t||"").trim();if(!r&&!w)return;(n=Z.current)==null||n.set(o,{ts:Date.now(),status:"found",customer:{phone:o,name:r||null,address:w||null}}),wa()}catch(o){}},sa=async e=>{var o,r,w;const a=ze(e);if(!a)return;Xa(a);const t=(o=Z.current)==null?void 0:o.get(a);if(t&&Number.isFinite(t.ts)){const m=Date.now()-t.ts,A=t.status==="found"?He:tt;if(m>=0&&m<=A){bt({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&Da(t.customer,a);return}}const n=++Ft.current;bt({status:"loading",phone:a});try{const m=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Ft.current!==n)return;if(m&&m.exists&&m.customer){(r=Z.current)==null||r.set(a,{ts:Date.now(),status:"found",customer:m.customer}),wa(),bt({status:"found",phone:a,customer:m.customer}),Da(m.customer,a);return}(w=Z.current)==null||w.set(a,{ts:Date.now(),status:"not-found",customer:null}),wa(),bt({status:"not-found",phone:a})}catch(m){if(Ft.current!==n)return;console.error("Customer lookup error:",m),bt({status:"error",phone:a})}},Ya=e=>{const a=ze(e),t=Ia(a);Te(o=>{const r={...o,phone:a};return t&&(!String(o.customer_name||"").trim()&&t.name&&(r.customer_name=t.name),!String(o.address||"").trim()&&t.address&&(r.address=t.address)),r}),te(!1),Dt.current&&(clearTimeout(Dt.current),Dt.current=null);const n=a;if(n.length<ce){bt(null);return}if(Rt(n)&&n!==$.current){$.current=n,sa(n);return}Dt.current=setTimeout(()=>{const o=ze(a);Rt(o)&&o!==$.current&&($.current=o,sa(o))},ae)},Za=()=>{const e=ze(b.phone);e.length<ce||Rt(e)&&e!==$.current&&($.current=e,sa(e))};useEffect(()=>(Q?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Q]);const ia=Array.isArray(b.items)?b.items.length:0;useEffect(()=>{if(!Q){G.current=ia;return}ia>G.current&&setTimeout(()=>{const e=p.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),G.current=ia},[Q,ia]),useEffect(()=>()=>{Dt.current&&(clearTimeout(Dt.current),Dt.current=null),gt.current&&(clearTimeout(gt.current),gt.current=null)},[]),useEffect(()=>{if(!Q)return;gt.current&&(clearTimeout(gt.current),gt.current=null);const e=ze((b==null?void 0:b.phone)||"");if(!Rt(e)){dt([]),ht(!1);return}return gt.current=setTimeout(async()=>{var o;const a=String(e),t=(o=s.current)==null?void 0:o.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=Xe){dt(Array.isArray(t.orders)?t.orders:[]),ht(!1);return}const n=++Ct.current;ht(!0);try{const r=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,w=await window.KTM.api.getJSON(r,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(Ct.current!==n)return;const m=Array.isArray(w)?w:Array.isArray(w==null?void 0:w.orders)?w.orders:[];dt(m);try{const A=s.current;if(A&&typeof A.set=="function"&&(A.set(a,{ts:Date.now(),orders:m}),A.size>100)){const i=Array.from(A.entries()).sort((g,L)=>{var ee,z;return(Number((ee=g==null?void 0:g[1])==null?void 0:ee.ts)||0)-(Number((z=L==null?void 0:L[1])==null?void 0:z.ts)||0)}),u=Math.max(0,i.length-100);for(let g=0;g<u;g++)A.delete(i[g][0])}}catch(A){}}catch(r){if(Ct.current!==n)return;console.error("Phone history fetch error:",r),dt([])}finally{if(Ct.current!==n)return;ht(!1)}},he),()=>{gt.current&&(clearTimeout(gt.current),gt.current=null)}},[Q,b==null?void 0:b.phone]),useEffect(()=>{en()},[]),useEffect(()=>{T||qt()},[l,T]),useEffect(()=>{Sa()},[]),useEffect(()=>{S&&Qt.current!==S&&(Qt.current=S,Ka(x))},[S]);const zt=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",ra=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",Oa=React.useMemo(()=>window.KTM.orders.sortOrders(B),[B]),xa=React.useMemo(()=>window.KTM.orders.sortOrders(we),[we]),oa=React.useMemo(()=>{const a=(Array.isArray(xa)?xa:[]).filter(t=>oe(t));return a.sort((t,n)=>{const o=new Date(t==null?void 0:t.created_at).getTime(),r=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(o)?o:0)-(Number.isFinite(r)?r:0)}),a},[xa]),Ra=React.useMemo(()=>{const a=(Array.isArray(Ne)?Ne:[]).filter(t=>qe(t));return a.sort((t,n)=>{const o=new Date(t==null?void 0:t.created_at).getTime(),r=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(o)?o:0)-(Number.isFinite(r)?r:0)}),a},[Ne]),Jt=React.useMemo(()=>c?oa:Oa,[c,oa,Oa]),la=React.useMemo(()=>{if(c)return Jt;const e=String(F||"").trim();return e?(Array.isArray(Jt)?Jt:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):Jt},[Jt,F,c]),La=React.useMemo(()=>window.KTM.orders.sortOrders(Oe),[Oe]),ca=React.useMemo(()=>T?La:la,[la,T,La]),Gt=e=>window.KTM.date.formatDateTime(e),en=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Et(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Et([])}},qt=async()=>{fe(!0),be(!1);try{const a=new URLSearchParams;l&&a.set("month",String(l)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(R)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),o=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],r=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;P(Array.isArray(o)?o:[]),M(Array.isArray(o)?o.length:0),ue(!!(r!=null&&r.hasMore)),Sa()}catch(a){console.error("Load orders error:",a),P([]),M(0),ue(!1)}finally{fe(!1),be(!1)}},tn=async()=>{if(!(le||X||T)&&se){be(!0);try{const e=new URLSearchParams;l&&e.set("month",String(l)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(R)),e.set("offset",String(_));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],o=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;P(r=>Ua(r,Array.isArray(n)?n:[])),M(r=>r+(Array.isArray(n)?n.length:0)),ue(!!(o!=null&&o.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{be(!1)}}},Pa=async e=>{var o;const a=q(e);if(!a){Me([]),Le(""),Ae(!1);return}const t=re(a);if(a.length<ea&&t.length<ta){Me([]),Le(`Nh\u1EADp \xEDt nh\u1EA5t ${ea} k\xFD t\u1EF1 (ho\u1EB7c ${ta} s\u1ED1) \u0111\u1EC3 search nhanh`),Ae(!1);return}try{const r=(o=W.current)==null?void 0:o.get(a);if(r&&Number.isFinite(r.ts)&&Date.now()-r.ts<=Na){Me(Array.isArray(r.results)?r.results:[]),Le(""),Ae(!1);return}}catch(r){}const n=++O.current;Ae(!0),Le("");try{const r=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,w=await window.KTM.api.getJSON(r,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(O.current!==n)return;const m=Array.isArray(w)?w:[];Me(m);try{const A=W.current;if(A&&typeof A.set=="function"&&(A.set(a,{ts:Date.now(),results:m}),A.size>Zt)){const i=Array.from(A.entries()).sort((g,L)=>{var ee,z;return(Number((ee=g==null?void 0:g[1])==null?void 0:ee.ts)||0)-(Number((z=L==null?void 0:L[1])==null?void 0:z.ts)||0)}),u=Math.max(0,i.length-Zt);for(let g=0;g<u;g++)A.delete(i[g][0])}}catch(A){}}catch(r){if(O.current!==n)return;console.error("Order search error:",r),Me([]),Le((r==null?void 0:r.message)||"Search l\u1ED7i")}finally{if(O.current!==n)return;Ae(!1)}};useEffect(()=>{v.current&&(clearTimeout(v.current),v.current=null);const e=q(Ce);if(!e){Me([]),Le(""),Ae(!1);return}return c&&f(!1),v.current=setTimeout(()=>{Pa(e)},Ht),()=>{v.current&&(clearTimeout(v.current),v.current=null)}},[Ce]);const Sa=async()=>{D(!0),Ie(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Ze)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Yt)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);me(Array.isArray(e)?e:[]),ke(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),me([]),ke([])}finally{D(!1),Ie(!1)}},da=async e=>{const a=await na(e);if(!a)return;_t(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(m=>{var A,i,u,g;return{product_id:(m==null?void 0:m.product_id)||"",quantity:Number((A=m==null?void 0:m.quantity)!=null?A:1)||1,unit_price:(()=>{var z;const L=(z=m==null?void 0:m.unit_price)!=null?z:m==null?void 0:m.unitPrice,ee=L==null||L===""?NaN:Number(L);return Number.isFinite(ee)?Math.trunc(ee):null})(),variant:String((i=m==null?void 0:m.variant)!=null?i:"").trim(),variant_json:(g=(u=m==null?void 0:m.variant_json)!=null?u:m==null?void 0:m.variantJson)!=null?g:null}}).filter(m=>m.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=xt(a),o=ut(n),r=pt(o),w=Ot(o);Te({customer_name:a.customer_name||"",phone:ze(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:r,adjustment_note:w||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),We(new Array(t.length?t.length:1).fill("")),U(new Array(t.length?t.length:1).fill(!0)),bt(null),h(!0),a.phone&&sa(ze(a.phone))},ka=async e=>{if(!e)return;ne(!0),ct(""),Pe(!0),De(e);const a=++ye.current;try{const t=await na(e);if(ye.current!==a)return;De(t||e)}catch(t){if(ye.current!==a)return;ct((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(ye.current!==a)return;Pe(!1)}},an=()=>{ne(!1),Pe(!1),ct("")};function Ka(e){_t(null),Ue(e||""),te(!1),U([]),h(!0)}const Ca=()=>{d||J||(h(!1),_t(null),Ue(""),te(!1),U([]))},nn=async()=>{var m,A,i;if(!Ve||J||d)return;const e=(Array.isArray(B)?B:[]).find(u=>String(u==null?void 0:u.id)===String(Ve))||null,a=String((e==null?void 0:e.status)||(b==null?void 0:b.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const u="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof I=="function"?I(u,"warning"):alert(u);return}const t=ze(b.phone),o=(Array.isArray(b.items)?b.items:[]).map((u,g)=>{var L,ee;return{idx:g,product_id:String((u==null?void 0:u.product_id)||"").trim(),quantity:Number((L=u==null?void 0:u.quantity)!=null?L:0),variant:String((u==null?void 0:u.variant)||"").trim()||null,variant_json:(ee=u==null?void 0:u.variant_json)!=null?ee:null,unit_price:(()=>{const z=u==null?void 0:u.unit_price,xe=z===""||z==null?NaN:Number(z);if(Number.isFinite(xe))return Math.max(0,Math.trunc(xe));const Se=Tt(u==null?void 0:u.product_id),et=u!=null&&u.variant_json&&typeof u.variant_json=="object"?u.variant_json:null;return ua(Se,et)})()}}).filter(u=>u.product_id&&Number.isFinite(u.quantity)&&u.quantity>0);if(o.length<2){const u="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof I=="function"?I(u,"warning"):alert(u);return}const r=[],w=[];for(const u of o){const g=!!N[u.idx],L={product_id:u.product_id,quantity:u.quantity,unit_price:u.unit_price,variant:u.variant,variant_json:u.variant_json};g?r.push(L):w.push(L)}if(!r.length||!w.length){const u="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof I=="function"?I(u,"warning"):alert(u);return}ie(!0);try{const u=Array.isArray(b==null?void 0:b.adjustment_items)?b.adjustment_items:[],g=ut(u),L=pt(g),ee=Ot(g),z={customer_name:b.customer_name,phone:t,address:b.address,note:(b.note||"").trim(),adjustment_amount:L,adjustment_note:ee,adjustment_items:g,status:"processing",items:r,product_id:r[0].product_id,quantity:r[0].quantity,split_seq:1},xe=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,z,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),Se=(i=(A=xe==null?void 0:xe.id)!=null?A:(m=xe==null?void 0:xe.order)==null?void 0:m.id)!=null?i:null;if(!Se)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const et={id:Ve,customer_name:b.customer_name,phone:t,address:b.address,note:(b.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:w,product_id:w[0].product_id,quantity:w[0].quantity,parent_order_id:String(Se),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${Ve}`,et,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Ca(),qt();const nt=Se?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${Se}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof I=="function"?I(nt,"success"):alert(nt)}catch(u){console.error(u);const g=(u==null?void 0:u.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof I=="function"?I(g,"danger"):alert(g)}finally{ie(!1)}},sn=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=ft.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},$t=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},rn=e=>{const t=$t(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},Ea=React.useMemo(()=>(Array.isArray(ft)?ft:[]).map((e,a)=>{var i,u,g,L,ee,z;const t=$t((i=e==null?void 0:e.name)!=null?i:""),n=$t((u=e==null?void 0:e.code)!=null?u:""),o=$t((g=e==null?void 0:e.category)!=null?g:""),r=$t((L=e==null?void 0:e.note)!=null?L:""),w=$t((ee=e==null?void 0:e.id)!=null?ee:""),m=$t((z=e==null?void 0:e.stt)!=null?z:""),A=`${t} ${n} ${o} ${r} ${w} ${m}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:o,note:r,haystackAll:A}}),[ft]),on=(e,a,t)=>{var g,L,ee,z,xe;const n=Array.isArray(a)?a:[],o=$t(t).trim();if(!n.length&&!o)return 0;const r=(g=e==null?void 0:e.name)!=null?g:"",w=(L=e==null?void 0:e.code)!=null?L:"",m=(ee=e==null?void 0:e.category)!=null?ee:"",A=(z=e==null?void 0:e.note)!=null?z:"";if(!((xe=e==null?void 0:e.haystackAll)!=null?xe:""))return 0;let u=0;o&&(r===o&&(u+=220),r.includes(o)&&(u+=140),r.startsWith(o)&&(u+=160),w&&w===o&&(u+=180),w&&w.includes(o)&&(u+=90));for(const Se of n){if(!Se)continue;const et=new RegExp(`(?:^|\\s)${Se.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);r.includes(Se)&&(u+=35),et.test(r)&&(u+=25),w&&w.includes(Se)&&(u+=20),w&&et.test(w)&&(u+=10),m&&m.includes(Se)&&(u+=12),A&&A.includes(Se)&&(u+=6)}return u>0&&r&&(u+=Math.max(0,10-Math.min(10,Math.floor(r.length/10)))),u},Aa=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const o=t.length,r=n.length;if(r>o)return Aa(n,t);let w=new Array(r+1),m=new Array(r+1);for(let A=0;A<=r;A++)w[A]=A;for(let A=1;A<=o;A++){m[0]=A;const i=t.charCodeAt(A-1);for(let g=1;g<=r;g++){const L=i===n.charCodeAt(g-1)?0:1;m[g]=Math.min(w[g]+1,m[g-1]+1,w[g-1]+L)}const u=w;w=m,m=u}return w[r]},ln=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const o=n.split(/\s+/).filter(Boolean);if(!o.length)return!1;const r=t.length<=4?1:2;for(const w of o)if(!(Math.abs(w.length-t.length)>r)&&Aa(t,w)<=r)return!0;return!1},ma=e=>{const a=$t(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},cn=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=ma((e==null?void 0:e.name)||""),o=ma((e==null?void 0:e.code)||""),r=ma((e==null?void 0:e.category)||""),w=ma((e==null?void 0:e.note)||""),m=(i,u,g)=>{const L=String(i||"").trim();if(!L||!u.length)return 0;const ee=L.length<=4?1:2;let z=1/0,xe=-1;for(let nt=0;nt<u.length;nt++){const kt=u[nt];if(!kt||Math.abs(kt.length-L.length)>ee)continue;const Be=Aa(L,kt);if(Be<z&&(z=Be,xe=nt,Be===0))break}if(z===1/0||z>ee)return 0;let et=Math.round(g*(z===0?1:z===1?.65:.45));return xe===0?et+=Math.round(g*.25):xe===1&&(et+=Math.round(g*.12)),et};let A=0;for(const i of t){if(!i)continue;const u=m(i,n,180),g=m(i,o,120),L=m(i,r,60),ee=m(i,w,30);A+=Math.max(u,g,L,ee)}if(A>0){const i=((e==null?void 0:e.name)||"").length;A+=Math.max(0,60-Math.min(60,Math.floor(i/2)))}return A},_a=React.useRef(new Map);React.useEffect(()=>{_a.current=new Map},[ft]);const dn=e=>{var i,u;const a=String(Ye[e]||"").trim();if(!a)return ft;const{contentTokens:t,cleanedQuery:n}=rn(a);if(t.length===0)return ft;const o=$t(a).trim(),r=_a.current.get(o);if(r)return r;const w=[];for(const g of Ea){const L=g.haystackAll;L&&t.some(ee=>L.includes(ee))&&w.push(g)}let m=w;if(m.length<8&&t.length>0){const g=[],L=new Set(m.map(ee=>{var z,xe;return String((xe=(z=ee.p)==null?void 0:z.id)!=null?xe:"")+":"+String(ee.originalIndex)}));for(const ee of Ea){const z=String((u=(i=ee.p)==null?void 0:i.id)!=null?u:"")+":"+String(ee.originalIndex);if(L.has(z))continue;const xe=ee.haystackAll;xe&&t.some(Se=>ln(Se,xe))&&(g.push(ee),L.add(z))}g.length&&(m=m.concat(g))}const A=m.map(g=>({entry:g,score:on(g,t,n)})).map(g=>{if(g.score>0)return g;const L=cn(g.entry,t);return L>0?{...g,score:L}:g}).filter(g=>g.score>0).sort((g,L)=>L.score!==g.score?L.score-g.score:g.entry.originalIndex-L.entry.originalIndex).slice(0,40).map(g=>g.entry.p);return _a.current.set(o,A),A},Tt=e=>{if(!e)return null;const a=String(e);return ft.find(t=>String(t==null?void 0:t.id)===a)||null},Ut=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var w;if(!t||typeof t!="object")return null;const o=String((w=t.name)!=null?w:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,r=(Array.isArray(t.options)?t.options:[]).map(m=>{var xe,Se,et,nt,kt,Be,jt;if(!m||typeof m!="object")return null;const A=String((xe=m.label)!=null?xe:"").trim();if(!A)return null;const i=(kt=(nt=(et=(Se=m.price)!=null?Se:m.priceValue)!=null?et:m.unit_price)!=null?nt:m.unitPrice)!=null?kt:null,u=i==null||i===""?NaN:typeof i=="number"?i:typeof i=="string"?at(i):Number(i),g=Number.isFinite(u)?Math.trunc(u):null,L=(jt=(Be=m.price_delta)!=null?Be:m.priceDelta)!=null?jt:null,ee=Number(L),z=Number.isFinite(ee)?Math.trunc(ee):0;return{label:A,price:g,price_delta:z}}).filter(Boolean);return{name:o,options:r}}).filter(Boolean):[]},gn=e=>{const a=Tt(e);return Ut(a==null?void 0:a.variants)},Fa=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const o=String(t||"").trim(),r=String(n||"").trim();!o||!r||a.push(`${o}: ${r}`)}return a.join(", ")},ua=(e,a)=>{const t=at(e==null?void 0:e.price),n=Ut(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let o=t,r=!1;for(const w of n){const m=String((w==null?void 0:w.name)||"").trim(),A=String((a==null?void 0:a[m])||"").trim();if(!m||!A)continue;const i=(Array.isArray(w.options)?w.options:[]).find(z=>String((z==null?void 0:z.label)||"").trim()===A);if(!i)continue;const u=i==null?void 0:i.price,g=u==null||u===""?NaN:Number(u);if(Number.isFinite(g)){o=Math.max(0,Math.trunc(g)),r=!0;continue}const L=i==null?void 0:i.price_delta,ee=L==null||L===""?NaN:Number(L);Number.isFinite(ee)&&(o+=Math.trunc(ee))}return o},Ma=e=>window.KTM.orders.getOrderItems(e),Ha=e=>window.KTM.orders.getOrderTotalQty(e),Wt=e=>window.KTM.orders.getOrderProductSummary(e,Tt),pa=e=>window.KTM.orders.getOrderItemRows(e,Tt),Xt=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Pt=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),mn=e=>{const a=Ma(e),t=pa(e),n=ha(a),o=ba(a),r=o.fee,w=Xt(e),m=n+r+w,A=u=>{const g=Number(u)||0;return g>0?`+${je(g)}`:je(g)},i=[];if(e!=null&&e.customer_name&&i.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&i.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&i.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&i.push(`GHI CH\xDA: ${(e.note||"").trim()}`),i.push(""),i.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const u of t)i.push(`- ${u.name} (SL: ${u.qty})`);else{const u=Wt(e);u&&u!=="\u2014"&&i.push(`- ${u}`)}i.push(""),i.push(`T\u1EA0M T\xCDNH: ${je(n)}`),o.found&&r!==0&&i.push(`SHIP: ${je(r)}`);{const u=window.KTM.orders.getOrderAdjustmentItems(e),g=(Array.isArray(u)?u:[]).map(z=>{var xe;return{amount:Number((xe=z==null?void 0:z.amount)!=null?xe:0)||0,note:String((z==null?void 0:z.note)||"").trim()}}).filter(z=>z.amount!==0||!!z.note),L=Pt(e);if(w!==0||g.length>0||!!L)if(g.length===1){const z=g[0];i.push(`\u0110I\u1EC0U CH\u1EC8NH: ${A(w)}${z.note?` \u2014 ${z.note}`:""}`)}else{i.push(`\u0110I\u1EC0U CH\u1EC8NH: ${A(w)}${!g.length&&L?` \u2014 ${L}`:""}`);for(const z of g)i.push(`- ${A(z.amount)}${z.note?`: ${z.note}`:""}`)}}return i.push(`T\u1ED4NG: ${je(m)}`),i.filter(Boolean).join(`
`)},$a=async e=>{try{const a=await na(e),t=mn(a);await window.KTM.clipboard.writeText(t),typeof I=="function"?I("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof I=="function"?I("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},ba=e=>window.KTM.orders.getOrderShipInfo(e,Tt),ha=e=>window.KTM.orders.getItemsSubtotal(e,Tt),Ta=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},ja=()=>l?String(l):Ta(new Date),Va=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=ze((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),o=At(e).amount,w=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(m=>{var A;return{product_id:String((m==null?void 0:m.product_id)||"").trim(),quantity:Number((A=m==null?void 0:m.quantity)!=null?A:0),variant:String((m==null?void 0:m.variant)||"").trim()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0).sort((m,A)=>m.product_id<A.product_id?-1:m.product_id>A.product_id?1:m.variant<A.variant?-1:m.variant>A.variant?1:m.quantity-A.quantity);return JSON.stringify({name:a,phone:t,address:n,items:w,adj:o})},Lt=React.useMemo(()=>{const e=ze((b==null?void 0:b.phone)||"");if(!e)return{count:0,orders:[],monthKey:ja()};const a=ja(),n=(Array.isArray(it)?it:[]).filter(o=>{if(!o||Ve&&String(o.id)===String(Ve)||ze(o.phone||"")!==e)return!1;const r=Ta(o.created_at);return r&&r===a}).sort((o,r)=>{const w=new Date(o.created_at).getTime(),m=new Date(r.created_at).getTime();return(Number.isFinite(m)?m:0)-(Number.isFinite(w)?w:0)});return{count:n.length,orders:n,monthKey:a}},[it,b==null?void 0:b.phone,l,Ve]),un=e=>{var m;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=ze((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),o=yt((m=e==null?void 0:e.adjustment_amount)!=null?m:0),r=Ma(e),w=(Array.isArray(r)?r:[]).map(A=>{var i;return{product_id:String((A==null?void 0:A.product_id)||"").trim(),quantity:Number((i=A==null?void 0:A.quantity)!=null?i:0),variant:String((A==null?void 0:A.variant)||"").trim()}}).filter(A=>A.product_id&&Number.isFinite(A.quantity)&&A.quantity>0).sort((A,i)=>A.product_id<i.product_id?-1:A.product_id>i.product_id?1:A.variant<i.variant?-1:A.variant>i.variant?1:A.quantity-i.quantity);return JSON.stringify({name:a,phone:t,address:n,items:w,adj:o})},qa=React.useMemo(()=>{if(Ve)return"";const e=ze((b==null?void 0:b.phone)||"");if(!e)return"";const a=ja(),t=Va(b),n=Array.isArray(it)?it:[];for(const o of n){if(!o||Ve&&String(o.id)===String(Ve)||ze(o.phone||"")!==e)continue;const r=Ta(o.created_at);if(!r||r!==a)continue;const w=un(o);if(w&&w===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${o!=null&&o.id?` (#${o.id})`:""}`}return""},[it,b,l,Ve]),Ba=e=>{var kt;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),o=ze((e==null?void 0:e.phone)||""),r=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),o||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),o&&!Rt(o)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),r||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const m=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Be=>Be&&Be.product_id);m.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),m.some(Be=>{var Kt;const jt=Number((Kt=Be==null?void 0:Be.quantity)!=null?Kt:0);return!Number.isFinite(jt)||jt<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const i=new Set;let u=!1;for(const Be of m){const jt=String(Be.product_id||"").trim(),Kt=String((Be==null?void 0:Be.variant)||"").trim();if(!jt)continue;const Re=`${jt}||${Kt}`;if(i.has(Re)){u=!0;break}i.add(Re)}u&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const g=ha(m),L=ba(m),ee=L!=null&&L.found?Number((kt=L==null?void 0:L.fee)!=null?kt:0):0,z=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],xe=ut(z),Se=pt(xe),et=xe.some(Be=>(Number(Be==null?void 0:Be.amount)||0)!==0&&!String((Be==null?void 0:Be.note)||"").trim());L!=null&&L.found&&(ee>=2e5||g>0&&ee>g*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${je(ee)}`),et&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const nt=Math.abs(Se);return(nt>=5e5||g>0&&nt>g*.5)&&Se!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${je(Se)}`),{errors:a,warnings:t,canSubmit:a.length===0}},vn=React.useMemo(()=>Ba(b),[b,ft]),st=React.useMemo(()=>{var Kt;const e=String((b==null?void 0:b.customer_name)||"").trim(),a=ze((b==null?void 0:b.phone)||""),t=String((b==null?void 0:b.address)||"").trim(),n=Array.isArray(b==null?void 0:b.items)?b.items:[],o=new Map;for(const Re of n){const Bt=String((Re==null?void 0:Re.product_id)||"").trim(),ga=String((Re==null?void 0:Re.variant)||"").trim();if(!Bt)continue;const va=`${Bt}||${ga}`;o.set(va,(o.get(va)||0)+1)}const r=n.map(Re=>{var Ga;const Bt=String((Re==null?void 0:Re.product_id)||"").trim(),ga=Number((Ga=Re==null?void 0:Re.quantity)!=null?Ga:0),va=Bt?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",pn=Number.isFinite(ga)&&ga>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",bn=String((Re==null?void 0:Re.variant)||"").trim(),hn=`${Bt}||${bn}`,fn=Bt&&(o.get(hn)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:va,qtyError:pn,dupWarn:fn}}),w=n.filter(Re=>Re&&Re.product_id),m=ha(w),A=ba(w),i=A!=null&&A.found?Number((Kt=A==null?void 0:A.fee)!=null?Kt:0):0,u=Array.isArray(b==null?void 0:b.adjustment_items)?b.adjustment_items:[],g=ut(u),L=pt(g),ee=g.some(Re=>(Number(Re==null?void 0:Re.amount)||0)!==0&&!String((Re==null?void 0:Re.note)||"").trim()),z=Math.abs(L),xe=ee?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Se=L!==0&&(z>=5e5||m>0&&z>m*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${je(L)}`:"",et=A!=null&&A.found&&(i>=2e5||m>0&&i>m*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${je(i)}`:"",nt=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",kt=a?Rt(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Be=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",jt=!nt&&!kt&&r.every(Re=>!Re.productError&&!Re.qtyError);return{nameError:nt,phoneError:kt,addressWarn:Be,items:r,shipAbnormalWarn:et,adjustmentNoteWarn:xe,adjustmentAbnormalWarn:Se,canSubmit:jt}},[b,ft]),za=async e=>{var w,m,A;const a=(e==null?void 0:e.mode)||"close",t=Ba(b);if(!t.canSubmit){const i=t.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof I=="function"?I(i,"danger"):alert(i);return}if(!Ve&&qa){const i=`${qa}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(i)){(Lt==null?void 0:Lt.count)>0&&te(!0),setTimeout(()=>{var L;const g=document.getElementById("order-phone-input");g&&typeof g.scrollIntoView=="function"&&(g.scrollIntoView({block:"center",behavior:"smooth"}),(L=g.focus)==null||L.call(g))},0);return}}const n=ze(b.phone),r=(Array.isArray(b.items)?b.items:[]).map(i=>{var u,g;return{product_id:(i==null?void 0:i.product_id)||"",quantity:Number((u=i==null?void 0:i.quantity)!=null?u:1),variant:String((i==null?void 0:i.variant)||"").trim()||null,variant_json:(g=i==null?void 0:i.variant_json)!=null?g:null,unit_price:(()=>{const L=i==null?void 0:i.unit_price,ee=L===""||L==null?NaN:Number(L);if(Number.isFinite(ee))return Math.max(0,Math.trunc(ee));const z=Tt(i==null?void 0:i.product_id),xe=i!=null&&i.variant_json&&typeof i.variant_json=="object"?i.variant_json:null;return ua(z,xe)})()}}).filter(i=>i.product_id&&Number.isFinite(i.quantity)&&i.quantity>0);j(!0);try{const i=Ve?`${API_BASE}/api/orders/${Ve}`:`${API_BASE}/api/orders`,u=r[0],g=Array.isArray(b==null?void 0:b.adjustment_items)?b.adjustment_items:[],L=ut(g),ee=pt(L),z=Ot(L),xe={customer_name:b.customer_name,phone:n,address:b.address,note:(b.note||"").trim(),adjustment_amount:ee,adjustment_note:z,adjustment_items:L,product_id:u.product_id,quantity:u.quantity,status:b.status,items:r,...Ve?{id:Ve}:{}};if(Ve)await window.KTM.api.putJSON(i,xe,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Se=await window.KTM.api.postJSON(i,xe,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");pe.current={id:(A=(m=Se==null?void 0:Se.id)!=null?m:(w=Se==null?void 0:Se.order)==null?void 0:w.id)!=null?A:null,fingerprint:Va(b),ts:Date.now()}}Qa(n,b.customer_name,b.address),a==="new"&&!Ve?(Ue(""),_t(null),h(!0)):(Ue(""),_t(null),h(!1)),qt()}catch(i){console.error(i),typeof I=="function"?I(i.message,"danger"):alert(i.message);return}finally{j(!1)}},fa=e=>window.KTM.orders.getOrderTotalMoney(e,Tt),Ja=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){K(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),qt(),Sa()}catch(a){console.error(a),typeof I=="function"?I(a.message,"danger"):alert(a.message)}finally{K(null)}}},St=async(e,a)=>{var o;const t=await na(e),n=t==null?void 0:t.id;if(!(!n||!a)){H(n);try{const r=Ma(t),w=(Array.isArray(r)?r:[]).map(i=>{var u,g;return{product_id:(i==null?void 0:i.product_id)||"",quantity:Number((u=i==null?void 0:i.quantity)!=null?u:1),variant:String((i==null?void 0:i.variant)||"").trim()||null,variant_json:(g=i==null?void 0:i.variant_json)!=null?g:null,unit_price:(()=>{var z;const L=(z=i==null?void 0:i.unit_price)!=null?z:i==null?void 0:i.unitPrice,ee=Number(L);return Number.isFinite(ee)?Math.max(0,Math.trunc(ee)):null})()}}).filter(i=>i.product_id&&Number.isFinite(i.quantity)&&i.quantity>0);if(!w.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const m=w[0],A={id:n,customer_name:(t==null?void 0:t.customer_name)||"",phone:ze((t==null?void 0:t.phone)||""),address:(t==null?void 0:t.address)||"",note:((t==null?void 0:t.note)||"").trim(),adjustment_amount:Number((o=t==null?void 0:t.adjustment_amount)!=null?o:0)||0,adjustment_note:(t==null?void 0:t.adjustment_note)||"",product_id:m.product_id,quantity:m.quantity,status:a,items:w};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${n}`,A,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),P(i=>Array.isArray(i)?i.map(u=>(u==null?void 0:u.id)===n?{...u,status:a}:u):i),me(i=>Array.isArray(i)?i.map(u=>(u==null?void 0:u.id)===n?{...u,status:a}:u):i),typeof I=="function"&&I("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(r){console.error(r),typeof I=="function"?I(r.message,"danger"):alert(r.message)}finally{H(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:le&&!Q&&!T||d||!!y||!!V}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Ka,disabled:d||!!y},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:l,onChange:e=>k(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:c||T}),l&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{k("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:le||T},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:F,onChange:e=>ve(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:c||T},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),F&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ve(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:le||T},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:c,onChange:e=>{if(T)return;const a=!!e.target.checked;f(a),a&&ve("pending")},disabled:T}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",Ze," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label mb-1"},"Search (t\xEAn / S\u0110T)"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{type:"text",className:"form-control",value:Ce,onChange:e=>ge(e.target.value),placeholder:"Nh\u1EADp t\xEAn ho\u1EB7c S\u0110T...","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(Ce||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ge(""),title:"X\xF3a search","aria-label":"X\xF3a search",disabled:Qe},React.createElement("i",{className:"fas fa-times"})),Qe&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"text-muted small mt-1"},"Search s\u1EBD ra to\xE0n b\u1ED9 data, b\u1ECF qua filter")),React.createElement("div",{className:"col-12 col-md-2 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>T?Pa(Ce):qt(),disabled:le||Qe},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},T?`${ca.length} k\u1EBFt qu\u1EA3`:F?`${la.length}/${B.length} \u0111\u01A1n`:`${B.length}${se?"+":""} \u0111\u01A1n`)),T&&Je&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Je),oa.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,oa.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Ze," ng\xE0y.",Fe&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{f(!0),ve("pending")}},"Xem ngay")),Ra.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,Ra.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",Yt," ng\xE0y).",Ke&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{f(!1),ve("draft"),k(""),qt()}},"Xem ngay")),(T?Qe:le)?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):(T?ca.length===0:B.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},T?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!T&&la.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},ca.map(e=>{var a;return React.createElement("div",{key:e.id,className:"card mb-2",role:"button",tabIndex:0,onClick:()=>ka(e),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),ka(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${ra(e.status)}`},zt(e.status)),oe(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Ze} ng\xE0y`},"\u26A0 Ch\u1EADm ",de(e),"d"),qe(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Mt} ng\xE0y`},"\u23F3 C\xF2n ",_e(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=pa(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,o)=>React.createElement("div",{key:o,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},o+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${je(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Wt(e))})()),(Xt(e)!==0||Pt(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},je(Xt(e))),Pt(e)?React.createElement("span",{className:"text-muted"}," ","(",Pt(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},je(fa(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",Gt(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary flex-fill",onClick:t=>{t.stopPropagation(),da(e)},disabled:d||!!y||V===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary flex-fill",onClick:t=>{t.stopPropagation(),$a(e)},disabled:d||!!y||V===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger flex-fill",onClick:t=>{t.stopPropagation(),Ja(e.id)},disabled:d||y===e.id||V===e.id},y===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:t=>{t.stopPropagation(),St(e,"processing")},disabled:d||!!y||V===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:t=>{t.stopPropagation(),St(e,"done")},disabled:d||!!y||V===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:t=>{t.stopPropagation(),St(e,"paid")},disabled:d||!!y||V===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:t=>{t.stopPropagation(),St(e,"canceled")},disabled:d||!!y||V===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,ca.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>ka(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=pa(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",je(t.unitPrice))))):Wt(e)})()),React.createElement("td",null,Ha(e)),React.createElement("td",{className:"fw-semibold"},je(fa(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${ra(e.status)}`},zt(e.status)),oe(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Ze} ng\xE0y`},"\u26A0 Ch\u1EADm ",de(e),"d"),qe(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Mt} ng\xE0y`},"\u23F3 C\xF2n ",_e(e),"d"))),React.createElement("td",null,Gt(e.created_at)),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary me-1",onClick:a=>{a.stopPropagation(),da(e)},disabled:d||!!y||V===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:a=>{a.stopPropagation(),$a(e)},disabled:d||!!y||V===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:a=>{a.stopPropagation(),St(e,"processing")},disabled:d||!!y||V===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:a=>{a.stopPropagation(),St(e,"done")},disabled:d||!!y||V===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:a=>{a.stopPropagation(),St(e,"paid")},disabled:d||!!y||V===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:a=>{a.stopPropagation(),St(e,"canceled")},disabled:d||!!y||V===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:a=>{a.stopPropagation(),Ja(e.id)},disabled:d||y===e.id},y===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))))),!T&&se&&!c&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:tn,disabled:le||X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:E,title:(()=>{const e=C,a=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${zt(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${a} ${t}`.trim()})(),subtitle:(()=>{const e=C,a=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?Gt(e.created_at):"";return[a||t||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:an,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>C&&$a(C),disabled:!C||Y||d||!!y},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>C&&da(C),disabled:!C||Y||d||!!y},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>C&&St(C,"processing"),disabled:!C||Y||d||!!y||V===(C==null?void 0:C.id)||(C==null?void 0:C.status)==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success",onClick:()=>C&&St(C,"done"),disabled:!C||Y||d||!!y||V===(C==null?void 0:C.id)||(C==null?void 0:C.status)==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>C&&St(C,"paid"),disabled:!C||Y||d||!!y||V===(C==null?void 0:C.id)||(C==null?void 0:C.status)==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>C&&St(C,"canceled"),disabled:!C||Y||d||!!y||V===(C==null?void 0:C.id)||(C==null?void 0:C.status)==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y")))},Y?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):Ge?React.createElement("div",{className:"alert alert-danger",role:"alert"},Ge):C?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${ra(C.status)}`},zt(C.status)),oe(C)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Ze} ng\xE0y`},"\u26A0 Ch\u1EADm ",de(C),"d"),qe(C)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Mt} ng\xE0y`},"\u23F3 C\xF2n ",_e(C),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},je(fa(C))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},Ha(C)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},Gt(C.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},C.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},C.phone||"\u2014"),!!String(C.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(C.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},C.address||"\u2014")),((C==null?void 0:C.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(C.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=pa(C);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((a,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),a.name),a.variant?React.createElement("div",{className:"text-muted small"},a.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${je(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Wt(C)||"\u2014")})(),(Xt(C)!==0||Pt(C))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},je(Xt(C))),Pt(C)?React.createElement("span",{className:"text-muted"}," ","(",Pt(C),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Q&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),Ve?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Ca})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),za({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:p},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:b.customer_name,onChange:e=>Te({...b,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!st.nameError&&React.createElement("div",{className:"form-text text-danger"},st.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:b.phone,onChange:e=>Ya(e.target.value),onBlur:Za,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!st.phoneError&&React.createElement("div",{className:"form-text text-danger"},st.phoneError),!st.phoneError&&Lt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Lt.count," \u0111\u01A1n trong th\xE1ng ",Lt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>te(e=>!e)},It?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),It&&Lt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>te(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Lt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ra(e.status)}`},zt(e.status))),React.createElement("div",{className:"text-muted small"},Gt(e.created_at)," \u2022 ",je(fa(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Wt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&da(e)}},"M\u1EDF")))),Lt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(Ee==null?void 0:Ee.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(Ee==null?void 0:Ee.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(Ee==null?void 0:Ee.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(Ee==null?void 0:Ee.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:b.status,onChange:e=>Te({...b,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:b.address,onChange:e=>Te({...b,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!st.addressWarn&&React.createElement("div",{className:"form-text text-warning"},st.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:b.note,onChange:e=>Te({...b,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Te(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},lt(b.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;Te(o=>{const r=lt(o.adjustment_items);return r[a]={...r[a],amount:n},{...o,adjustment_items:r}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;Te(o=>{const r=lt(o.adjustment_items);return r[a]={...r[a],note:n},{...o,adjustment_items:r}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{Te(t=>{const n=lt(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:d||lt(b.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!st.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},st.adjustmentAbnormalWarn),!!st.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},st.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Te(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),We(e=>[...Array.isArray(e)?e:[],""]),Ve&&U(e=>[...Array.isArray(e)?e:[],!0])},disabled:d},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(b.items)?b.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{wt.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{ot(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sn(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),rt===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:Ye[a]||"",onChange:t=>{const n=t.target.value;We(o=>{const r=Array.isArray(o)?[...o]:[];return r[a]=n,r})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=dn(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const o=String(n.id),r=Ut(n==null?void 0:n.variants),w={};for(const i of r){const u=String((i==null?void 0:i.name)||"").trim(),g=Array.isArray(i==null?void 0:i.options)?i.options[0]:null,L=String((g==null?void 0:g.label)||"").trim();u&&L&&(w[u]=L)}const m=Fa(w),A=ua(n,w);Te(i=>{const u=Array.isArray(i.items)?[...i.items]:[];return u[a]={...u[a]||{quantity:1},product_id:o,variant_json:Object.keys(w).length?w:null,variant:m,unit_price:r.length?A:null},{...i,items:u}}),ot(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),ft.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=st.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Tt(e.product_id),n=Ut(t==null?void 0:t.variants);if(!n.length)return null;const o=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((r,w)=>{const m=String((r==null?void 0:r.name)||`Bi\u1EBFn th\u1EC3 ${w+1}`).trim(),A=String((o==null?void 0:o[m])||"").trim();return React.createElement("div",{key:m},React.createElement("label",{className:"form-label small text-muted mb-1"},m),React.createElement("select",{className:"form-select",value:A,onChange:i=>{const u=String(i.target.value||"").trim();Te(g=>{const L=Array.isArray(g.items)?[...g.items]:[],ee={...L[a]||{}},z=Tt(ee.product_id),xe=Ut(z==null?void 0:z.variants),Se=ee!=null&&ee.variant_json&&typeof ee.variant_json=="object"?{...ee.variant_json}:{};u?Se[m]=u:delete Se[m];const et=Fa(Se),nt=ua(z,Se);return L[a]={...ee,variant_json:Object.keys(Se).length?Se:null,variant:et,unit_price:nt},{...g,items:L}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",m," --"),(Array.isArray(r==null?void 0:r.options)?r.options:[]).map(i=>React.createElement("option",{key:i.label,value:i.label},i.label,Number.isFinite(Number(i==null?void 0:i.price))?` (${je(Number(i.price))})`:Number(i==null?void 0:i.price_delta)?` (${i.price_delta>0?"+":""}${i.price_delta})`:""))))}))})(),Ve&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!N[a],onChange:t=>{const n=!!t.target.checked;U(o=>{const r=Array.isArray(o)?[...o]:[],w=Array.isArray(b.items)?b.items.length:0;for(;r.length<w;)r.push(!0);return r[a]=n,r})},disabled:d||J}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;Te(o=>{const r=Array.isArray(o.items)?[...o.items]:[];return r[a]={...r[a]||{product_id:""},quantity:n},{...o,items:r}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=st.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{Te(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),We(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),U(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),ot(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:d||J||(Array.isArray(b.items)?b.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(b.items)?b.items:[]).filter(m=>m==null?void 0:m.product_id),t=ha(a),n=ba(a),o=At(b),r=o.amount,w=t+(n.found?n.fee:0)+r;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},je(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},je(n.fee))),!!st.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},st.shipAbnormalWarn),r!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},je(r))),(b.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(b.note||"").trim()),!!o.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",o.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},je(w)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Ca,disabled:d||J,style:{borderRadius:10}},"H\u1EE7y"),!!Ve&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:nn,disabled:d||J,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},J?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!Ve&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>za({mode:"new"}),disabled:d||!st.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:d||J||!st.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},d?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

