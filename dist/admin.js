const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:M,error:w}){const[I,ee]=useState(""),[Y,N]=useState(""),[K,ne]=useState(!1),[oe,Q]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),w&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),w),React.createElement("form",{onSubmit:async ve=>{ve.preventDefault(),ne(!0),await M(I,Y),ne(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:I,onChange:ve=>ee(ve.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:oe?"text":"password",className:"form-control",value:Y,onChange:ve=>N(ve.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Q(!oe)},React.createElement("i",{className:`fas fa-eye${oe?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:K},K?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:M,type:w,onClose:I}){return useEffect(()=>{const ee=setTimeout(I,3e3);return()=>clearTimeout(ee)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${w} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},M),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:I})))}function Loading({show:M}){return M?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:M,onMenuChange:w,onLogout:I,currentUser:ee}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(N=>React.createElement("a",{key:N.id,href:"#",className:`nav-link ${M===N.id?"active":""} ${N.disabled?"opacity-50":""} ${N.highlight?"text-warning":""}`,onClick:K=>{K.preventDefault(),N.disabled||w(N.id)}},React.createElement("i",{className:`fas ${N.icon}`})," ",N.label,N.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),N.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),I&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:I,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(M){const w=typeof M=="number"?M:parseFloat(String(M!=null?M:"").trim());return Number.isFinite(w)?Math.max(0,Math.min(100,w)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var M;try{const w=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!w)return{ship_percent:DEFAULT_SHIP_PERCENT};const I=JSON.parse(w);return{ship_percent:normalizeShipPercent((M=I==null?void 0:I.ship_percent)!=null?M:I==null?void 0:I.shipPercent)}}catch(w){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(M){var w;try{const I={ship_percent:normalizeShipPercent((w=M==null?void 0:M.ship_percent)!=null?w:M==null?void 0:M.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(I)),I}catch(I){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var w;const M=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((w=M==null?void 0:M.ship_percent)!=null?w:M==null?void 0:M.shipPercent)}}async function saveAdminSettingsToServer(M){var ee,Y,N;const w={ship_percent:normalizeShipPercent((ee=M==null?void 0:M.ship_percent)!=null?ee:M==null?void 0:M.shipPercent)},I=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,w,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((N=(Y=I==null?void 0:I.ship_percent)!=null?Y:I==null?void 0:I.shipPercent)!=null?N:w.ship_percent)}}function AlbumList({albums:M,onSelect:w,onCreate:I,onEdit:ee,onDelete:Y,loading:N,currentFolder:K,onBack:ne,breadcrumb:oe}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},K&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:ne},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),K?K.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:I},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),oe&&oe.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Q=>{Q.preventDefault(),ne("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),oe.map((Q,me)=>React.createElement("li",{key:Q.id,className:`breadcrumb-item ${me===oe.length-1?"active":""}`},me===oe.length-1?Q.title:React.createElement("a",{href:"#",onClick:ve=>{ve.preventDefault(),ne(Q)},className:"text-warning"},Q.title))))),N?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):M.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},K?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},M.map(Q=>React.createElement("div",{key:Q.uuid||Q.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>w(Q)},Q.cover?React.createElement("img",{src:Q.cover,className:"album-cover",alt:Q.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Q.title),React.createElement("small",{className:"text-muted"},Q.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Q.subfolderCount),Q.subfolderCount>0&&Q.count>0&&" \u2022 ",Q.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Q.count),Q.subfolderCount===0&&Q.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:me=>{me.stopPropagation(),ee(Q)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:me=>{me.stopPropagation(),Y(Q)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:M,album:w,onClose:I,onSave:ee,parentId:Y}){const[N,K]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[ne,oe]=useState(!1),[Q,me]=useState(!1),ve=useRef(null);useEffect(()=>{K(w?{slug:w.id||"",title:w.title||"",description:w.description||"",cover_url:w.cover||"",parent_id:w.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:Y||null})},[w,M,Y]);const re=async le=>{le.preventDefault(),oe(!0),await ee(N),oe(!1)},ce=le=>le.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),pe=async le=>{const fe=le.type==="image/heic"||le.type==="image/heif"||/\.heic$/i.test(le.name);if(le.size<=2097152&&!fe)return le;try{const Ce=await createImageBitmap(le),Ae=document.createElement("canvas");let Oe=Ce.width,he=Ce.height;const ie=800;return(Oe>ie||he>ie)&&(Oe>he?(he=Math.round(he/Oe*ie),Oe=ie):(Oe=Math.round(Oe/he*ie),he=ie)),Ae.width=Oe,Ae.height=he,Ae.getContext("2d").drawImage(Ce,0,0,Oe,he),Ce.close(),new Promise((Me,ke)=>{Ae.toBlob(we=>{we?Me(new File([we],le.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ke(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Ce){throw console.error("Compress cover error:",Ce),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Se=async le=>{var Ce;const ye=le.target.files[0];if(!ye)return;if(!(ye.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ye.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}me(!0);try{const Ae=await pe(ye),Oe=await window.KTM.cloudinary.uploadImage({file:Ae,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Oe.secure_url)throw console.error("Cloudinary error:",Oe),new Error(((Ce=Oe.error)==null?void 0:Ce.message)||"Upload failed");K(he=>({...he,cover_url:Oe.secure_url}))}catch(Ae){console.error("Cover upload error:",Ae),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Ae.message)}me(!1),le.target.value=""};return M?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:I})),React.createElement("form",{onSubmit:re},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:N.title,onChange:le=>K({...N,title:le.target.value,slug:N.slug||ce(le.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:N.slug,onChange:le=>K({...N,slug:le.target.value}),required:!0,disabled:!!w}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:N.description,onChange:le=>K({...N,description:le.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},N.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:N.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>K(le=>({...le,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:ve,type:"file",accept:"image/*",className:"d-none",onChange:Se}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var le;return(le=ve.current)==null?void 0:le.click()},disabled:Q},Q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:N.cover_url,onChange:le=>K({...N,cover_url:le.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:I},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:ne||Q},ne?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:M,allAlbums:w,currentAlbumId:I,targetAlbum:ee,onSelect:Y,level:N=0}){const[K,ne]=useState(!0),oe=M.uuid||M.id,Q=oe===I,me=ee===oe,ve=w.filter(ce=>ce.parentId===oe),re=ve.length>0;return React.createElement("div",{style:{marginLeft:N*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${me?"bg-info text-white":Q?"bg-light text-muted":"hover-bg"}`,style:{cursor:Q?"not-allowed":"pointer",opacity:Q?.5:1,transition:"background 0.2s"},onClick:()=>!Q&&Y(oe)},re&&React.createElement("i",{className:`fas fa-chevron-${K?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:ce=>{ce.stopPropagation(),ne(!K)}}),!re&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${me?"-open":""} me-2 ${me?"":"text-warning"}`}),React.createElement("span",{className:"small"},M.title),Q&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),M.count>0&&!Q&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},M.count)),K&&re&&React.createElement("div",null,ve.map(ce=>React.createElement(FolderTreeItem,{key:ce.uuid||ce.id,folder:ce,allAlbums:w,currentAlbumId:I,targetAlbum:ee,onSelect:Y,level:N+1}))))}function AlbumDetail({album:M,onBack:w,onRefresh:I,showToast:ee,onNavigateToFolder:Y,onEditSubfolder:N,parentAlbum:K}){const[ne,oe]=useState([]),[Q,me]=useState([]),[ve,re]=useState(!0),[ce,pe]=useState(!1),[Se,le]=useState(""),[ye,fe]=useState([]),[Ce,Ae]=useState([]),[Oe,he]=useState({}),[ie,_e]=useState(null),[Me,ke]=useState(!1),[we,Je]=useState(""),[u,O]=useState(!1),i=useRef(null),p=useRef(null),[A,$]=useState(!1),[q,Z]=useState([]),[H,z]=useState([]),[de,De]=useState(""),[c,g]=useState(!1),ge=async(b,j=2)=>{const _=j*1024*1024,Fe=b.type==="image/heic"||b.type==="image/heif"||/\.heic$/i.test(b.name);if(b.size<=_&&!Fe)return b;try{const Be=await createImageBitmap(b),Qe=document.createElement("canvas");let tt=Be.width,lt=Be.height;const rt=1200;return(tt>rt||lt>rt)&&(tt>lt?(lt=Math.round(lt/tt*rt),tt=rt):(tt=Math.round(tt/lt*rt),lt=rt)),Qe.width=tt,Qe.height=lt,Qe.getContext("2d").drawImage(Be,0,0,tt,lt),Be.close(),new Promise((ut,Dt)=>{Qe.toBlob(_t=>{_t?ut(new File([_t],b.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Dt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Be){throw console.error("Compress error:",Be),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{x(),r()},[M.id,M.uuid]);const x=async()=>{re(!0);try{const b=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${M.uuid||M.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");oe(b.images||[]);const j=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${M.uuid||M.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");me(Array.isArray(j)?j:[])}catch(b){console.error(b),ee("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}re(!1)},r=async()=>{try{const b=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");z(Array.isArray(b)?b:[])}catch(b){console.error("Error loading albums:",b)}},U=b=>{Z(j=>j.includes(b)?j.filter(_=>_!==b):[...j,b])},$e=async()=>{if(!de||q.length===0){ee("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}g(!0);let b=0;for(const j of q)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${j}`,{album_id:de},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),b++}catch(_){console.error("Move error:",_)}g(!1),$(!1),Z([]),De(""),b>0?(ee("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),x(),I()):ee("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Ue,Ke]=useState(!1),je=async()=>{if(q.length===0||!confirm(`X\xF3a ${q.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Ke(!0);let b=0;for(const j of q)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${j}`,"L\u1ED7i x\xF3a \u1EA3nh"),b++}catch(_){console.error("Delete error:",_)}Ke(!1),Z([]),b>0?(ee(`\u0110\xE3 x\xF3a ${b} \u1EA3nh!`,"success"),x(),I()):ee("X\xF3a th\u1EA5t b\u1EA1i","danger")},Xe=()=>{q.length===ne.length?Z([]):Z(ne.map(b=>b.id))},et=async()=>{if(we.trim()){O(!0);try{const b=we.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:b+"-"+Date.now(),title:we,parent_id:M.uuid||M.id},"L\u1ED7i t\u1EA1o folder"),ee("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Je(""),ke(!1),x(),I()}catch(b){ee(b.message,"danger")}O(!1)}},Ot=async b=>{if(confirm(`X\xF3a folder "${b.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${b.uuid||b.id}`,"L\u1ED7i x\xF3a folder"),ee("\u0110\xE3 x\xF3a folder","success"),x(),I()}catch(j){ee("L\u1ED7i x\xF3a folder","danger")}},Te=b=>{const j=Array.from(b).filter(_=>_.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(_.name));fe(_=>[..._,...j]),j.forEach(_=>{const Fe=new FileReader;Fe.onload=Be=>{Ae(Qe=>[...Qe,{file:_,preview:Be.target.result}])},Fe.readAsDataURL(_)})},wt=b=>{fe(j=>j.filter((_,Fe)=>Fe!==b)),Ae(j=>j.filter((_,Fe)=>Fe!==b))},Et=async b=>{var _;const j=await window.KTM.cloudinary.uploadImage({file:b,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${M.id}`});if(!j.secure_url)throw console.error("Cloudinary error:",j),new Error(((_=j.error)==null?void 0:_.message)||"Upload failed");return j},mt=async()=>{if(ye.length===0)return;pe(!0);let b=0;for(let j=0;j<ye.length;j++)try{le(`\u0110ang x\u1EED l\xFD ${j+1}/${ye.length}...`);const _=await ge(ye[j],2);le(`\u0110ang upload ${j+1}/${ye.length}...`);const Fe=await Et(_);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${M.id}`,{url:Fe.secure_url,caption:Oe[j]||ye[j].name.replace(/\.[^/.]+$/,""),sort_order:ne.length+j},"L\u1ED7i l\u01B0u \u1EA3nh"),b++}catch(_){console.error("Upload error:",_)}pe(!1),le(""),fe([]),Ae([]),he({}),b>0?(ee(`\u0110\xE3 upload ${b} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),x(),I()):ee("Upload th\u1EA5t b\u1EA1i","danger")},be=async(b,j)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${b}`,"L\u1ED7i x\xF3a \u1EA3nh"),ee("\u0110\xE3 x\xF3a \u1EA3nh","success"),x(),I()}catch(_){ee("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Ee=b=>{var j;b.preventDefault(),(j=p.current)==null||j.classList.add("dragover")},it=()=>{var b;(b=p.current)==null||b.classList.remove("dragover")},dt=b=>{var j;b.preventDefault(),(j=p.current)==null||j.classList.remove("dragover"),Te(b.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:w},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},M.title),React.createElement("small",{className:"text-muted"},Q.length>0&&React.createElement("span",null,Q.length," folder \u2022 "),ne.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>ke(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),Me&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:we,onChange:b=>Je(b.target.value),onKeyPress:b=>b.key==="Enter"&&et(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:et,disabled:u||!we.trim()},u?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{ke(!1),Je("")}},"H\u1EE7y")))),Q.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Q.map(b=>React.createElement("div",{key:b.uuid||b.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>Y&&Y(b)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},b.title),React.createElement("small",{className:"text-muted"},b.subfolderCount>0&&React.createElement("span",null,b.subfolderCount," folder"),b.subfolderCount>0&&b.count>0&&" \u2022 ",b.count>0&&React.createElement("span",null,b.count," \u1EA3nh"),b.subfolderCount===0&&b.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:j=>{j.stopPropagation(),N&&N(b)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:j=>{j.stopPropagation(),Ot(b)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:p,className:"upload-zone",onClick:()=>{var b;return(b=i.current)==null?void 0:b.click()},onDragOver:Ee,onDragLeave:it,onDrop:dt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:i,type:"file",multiple:!0,accept:"image/*",onChange:b=>Te(b.target.files)})),Ce.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Ce.map((b,j)=>React.createElement("div",{key:j,className:"upload-preview-item"},React.createElement("img",{src:b.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>wt(j)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:mt,disabled:ce},ce?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Se||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",ye.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",ne.length,")"),ne.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Xe},q.length===ne.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),q.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},q.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>$(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:je,disabled:Ue},Ue?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Z([])},React.createElement("i",{className:"fas fa-times"})))),ve?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):ne.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},ne.map((b,j)=>React.createElement("div",{key:j,className:`image-item ${q.includes(b.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>U(b.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:q.includes(b.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:q.includes(b.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},q.includes(b.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:b.src,alt:b.caption,style:{opacity:q.includes(b.id)?.7:1,border:q.includes(b.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:_=>{_.stopPropagation(),be(b.id,j)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),b.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},b.caption)))))),A&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",q.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>$(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},H.filter(b=>!b.parentId).map(b=>React.createElement(FolderTreeItem,{key:b.uuid||b.id,folder:b,allAlbums:H,currentAlbumId:M.uuid||M.id,targetAlbum:de,onSelect:De})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>$(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:$e,disabled:!de||c},c?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),ie&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>_e(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>_e(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:ie.src,alt:ie.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:b=>b.stopPropagation()}),ie.caption&&React.createElement("div",{className:"text-white text-center mt-2"},ie.caption)))))}function SearchCenter({showToast:M,onNavigate:w}){const[I,ee]=useState(""),[Y,N]=useState([]),[K,ne]=useState([]),[oe,Q]=useState([]),[me,ve]=useState("all"),[re,ce]=useState(null),[pe,Se]=useState("list"),[le,ye]=useState(!0),[fe,Ce]=useState([]),[Ae,Oe]=useState([]),he=useRef(null),[ie,_e]=useState(!0),[Me,ke]=useState(!1),we=useRef(null),[Je,u]=useState(!1),[O,i]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[p,A]=useState(""),[$,q]=useState(!1),Z=useRef(null),H=useRef(null),[z,de]=useState(null),[De,c]=useState(!1),[g,ge]=useState(null),[x,r]=useState(!1),[U,$e]=useState(!1),[Ue,Ke]=useState(null),[je,Xe]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),et=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Ot=t=>{var v,D;t._type==="product"&&(ge(t),Xe({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||"",commission_percent:(D=(v=t.commission_percent)!=null?v:t.commissionPercent)!=null?D:""}),c(!0))},Te=async()=>{if(g)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${g.id}`,je,"L\u1ED7i c\u1EADp nh\u1EADt"),M("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),c(!1),ge(null),Ee()}catch(t){M(t.message,"danger")}},wt=async t=>{const v=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${v} "${t.name}"?`))try{let D="";t._type==="product"?D=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?D=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(D=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(D,"L\u1ED7i x\xF3a"),M(`\u0110\xE3 x\xF3a ${v}`,"success"),Ee()}catch(D){M(D.message,"danger")}},Et=async t=>{try{const v=Ue?`${API_BASE}/api/products?id=${Ue.id}`:`${API_BASE}/api/products`;Ue?await window.KTM.api.putJSON(v,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(v,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),M(Ue?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),$e(!1),Ke(null),Ee()}catch(v){M(v.message,"danger")}},mt="ktm_admin_data_cache_v1",be=1e3*60*10,Ee=async()=>{let t=null,v=!1;const D=window.KTM.cache.read(mt,{ttlMs:be,validate:Array.isArray});D.hit?(t=D.value,console.log("[CACHE] Using cache, items:",t.length),ne(t),N(t),ye(!1),v=!0):D.status==="miss"?console.log("[CACHE] No cache found"):D.status==="expired"||D.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):D.status==="error"&&console.error("[CACHE] Error parsing cache"),v||ye(!0);try{const J=async(qe,Ie)=>{try{const Ge=await window.KTM.api.getJSON(qe,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Ge!=null?Ge:Ie}catch(Ge){return Ie}},[W,y,m]=await Promise.all([J(`${API_BASE}/api/products`,[]),J(`${API_BASE}/api/albums`,[]),J(`${API_BASE}/api/video-folders?withVideos=true`,[])]),V=Array.isArray(W)?W.map(qe=>({...qe,_type:"product",_source:"database"})):[];Ce(y);let E=[];Array.isArray(y)&&y.length>0&&(await Promise.all(y.map(Ie=>J(`${API_BASE}/api/albums/${Ie.id}`,{})))).forEach((Ie,Ge)=>{const ot=y[Ge];Ie.images&&Ie.images.length>0&&Ie.images.forEach(at=>{E.push({id:at.id,name:at.caption||"\u1EA2nh t\u1EEB "+ot.title,image:at.src,folder:ot.title,_type:"album",_source:"database"})})}),Oe(m);let ae=[];Array.isArray(m)&&m.forEach(qe=>{qe.videos&&qe.videos.forEach(Ie=>{ae.push({id:Ie.id,name:Ie.title,folder:qe.name,image:Ie.thumb,youtubeId:Ie.youtubeId,url:Ie.url,_type:"video",_source:"database"})})});const k=[...V,...E,...ae];(!t||JSON.stringify(k)!==JSON.stringify(t))&&(ne(k),N(k),window.KTM.cache.write(mt,k))}catch(J){console.error("Song song fetch error:",J)}ye(!1)};useEffect(()=>{Ee(),setTimeout(()=>{var t;return(t=he.current)==null?void 0:t.focus()},100)},[]);const it=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(v){return String(t!=null?t:"").toLowerCase()}},dt=t=>{const D=it(t).trim().split(/\s+/).filter(Boolean),J=D.includes("anh"),W=D.includes("video"),y=D.filter(E=>E!=="anh"&&E!=="video"),m=y.join(" "),V=new Set(["product"]);return J&&V.add("album"),W&&V.add("video"),{allowedTypes:V,includeAlbum:J,includeVideo:W,contentTokens:y,cleanedQuery:m}},b=(t,v,D)=>{var qe,Ie,Ge,ot,at;const J=Array.isArray(v)?v:[],W=it(D).trim();if(!J.length&&!W)return 0;const y=it((qe=t==null?void 0:t.name)!=null?qe:""),m=it((Ie=t==null?void 0:t.code)!=null?Ie:""),V=it((Ge=t==null?void 0:t.category)!=null?Ge:""),E=it((ot=t==null?void 0:t.note)!=null?ot:""),ae=it((at=t==null?void 0:t.folder)!=null?at:"");if(!`${y} ${m} ${V} ${E} ${ae}`.trim())return 0;let G=0;W&&(y===W&&(G+=220),y.includes(W)&&(G+=140),y.startsWith(W)&&(G+=160),m&&m===W&&(G+=180),m&&m.includes(W)&&(G+=90));for(const Ye of J){if(!Ye)continue;const pt=new RegExp(`(?:^|\\s)${Ye.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);y.includes(Ye)&&(G+=35),pt.test(y)&&(G+=25),m&&m.includes(Ye)&&(G+=20),m&&pt.test(m)&&(G+=10),V&&V.includes(Ye)&&(G+=12),ae&&ae.includes(Ye)&&(G+=12),E&&E.includes(Ye)&&(G+=6)}return G>0&&y&&(G+=Math.max(0,10-Math.min(10,Math.floor(y.length/10)))),G},j=(t,v,D)=>{const J=Array.isArray(t)?t:[];return J.length?J.map((y,m)=>({it:y,idx:m,score:b(y,v,D)})).sort((y,m)=>m.score!==y.score?m.score-y.score:y.idx-m.idx).map(y=>y.it):[]},_=async(t,v)=>{if(!(!ie||v.length===0)){ke(!0);try{const D=v.map(W=>({id:W.id,name:W.name,price:W.price,category:W.category,note:W.note,folder:W.folder,_type:W._type})),J=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:D},"AI Search error");if(J&&J.matchedIds&&J.matchedIds.length>0){const{contentTokens:W,cleanedQuery:y}=dt(t),m=new Set(J.matchedIds),V=v.filter(E=>m.has(E.id)).sort((E,ae)=>b(ae,W,y)-b(E,W,y));V.length>0&&N(V)}else J&&J.matchedIds&&J.matchedIds.length===0&&N([])}catch(D){console.error("AI Search error:",D)}ke(!1)}},Fe=t=>{if(ee(t),we.current&&clearTimeout(we.current),!t.trim()){Be(me);return}const{allowedTypes:v,contentTokens:D,cleanedQuery:J}=dt(t),W=K.filter(m=>{if(!v.has(m==null?void 0:m._type))return!1;if(D.length===0)return!0;const V=it(Object.entries(m).filter(([E])=>!E.startsWith("_")).map(([,E])=>String(E||"")).join(" "));return D.some(E=>V.includes(E))});let y=W;me!=="all"&&(y=W.filter(m=>(m.category||m._type)===me)),N(j(y,D,J)),ie&&J.length>=3&&(we.current=setTimeout(()=>{_(J,y)},500))},Be=t=>{ve(t);const{allowedTypes:v,contentTokens:D}=dt(I),{cleanedQuery:J}=dt(I);let W=K.filter(y=>v.has(y==null?void 0:y._type));t!=="all"&&(W=W.filter(y=>(y.category||y._type)===t)),I.trim()&&D.length>0&&(W=W.filter(y=>{const m=it(Object.entries(y).filter(([V])=>!V.startsWith("_")).map(([,V])=>String(V||"")).join(" "));return D.every(V=>m.includes(V))})),N(j(W,D,J))},Qe=(t,v)=>{window.KTM.clipboard.writeText(t).then(()=>{ce(v),M("\u0110\xE3 copy!","success"),setTimeout(()=>ce(null),1500)})},tt=async(t,v)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),ce(v+"-img"),M("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>ce(null),1500)}catch(D){Qe(t,v+"-img")}},lt=t=>{let v=t.toLowerCase();const D=[],J=K.filter(m=>m._type==="product");if(v.includes("ty")||v.includes("xy lanh")){if(v.includes("gi\u1EEFa")||v.includes("giua")){const m=J.find(V=>{var E;return(E=V.name)==null?void 0:E.toLowerCase().includes("xy lanh gi\u1EEFa")});m&&!D.find(V=>V.id===m.id)&&D.push(m)}if(v.includes("nghi\xEAng")||v.includes("nghieng")){const m=J.find(V=>{var E;return(E=V.name)==null?void 0:E.toLowerCase().includes("xy lanh nghi\xEAng")});m&&!D.find(V=>V.id===m.id)&&D.push(m)}if(v.includes("\u1EE7i")||v.includes("ui")){const m=J.find(V=>{var E;return(E=V.name)==null?void 0:E.toLowerCase().includes("xy lanh \u1EE7i")});m&&!D.find(V=>V.id===m.id)&&D.push(m)}}const W=v.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(W){const m=W[1],V=W[2],E=J.find(ae=>{var G;const k=((G=ae.name)==null?void 0:G.toLowerCase())||"";return k.includes("combo")&&k.includes(`${m} tay`)&&(k.includes(`${V} xy`)||k.includes(`${V} xylanh`))});if(E&&!D.find(ae=>ae.id===E.id))D.push(E);else{const ae=J.find(k=>{var qe;const G=((qe=k.name)==null?void 0:qe.toLowerCase())||"";return G.includes("combo")&&G.includes(`${m} tay`)});ae&&!D.find(k=>k.id===ae.id)&&D.push(ae)}}if(v.includes("combo")&&!W){const m=v.match(/combo.*?(\d+)\s*tay/);if(m){const V=m[1];J.filter(ae=>{var G;const k=((G=ae.name)==null?void 0:G.toLowerCase())||"";return k.includes("combo")&&k.includes(`${V} tay`)}).forEach(ae=>{D.find(k=>k.id===ae.id)||D.push(ae)})}}const y=v.match(/van\s*(\d+)\s*tay/);if(y&&!v.includes("ty")&&!v.includes("combo")){const m=y[1],V=J.find(E=>{var k;const ae=((k=E.name)==null?void 0:k.toLowerCase())||"";return ae.includes(`van ${m} tay`)&&!ae.includes("combo")});V&&!D.find(E=>E.id===V.id)&&D.push(V)}return D.slice(0,4)},rt=async t=>{if(!t.trim())return;const v={role:"user",content:t,attachments:[]};i(J=>[...J,v]),A(""),q(!0);const D=lt(t);setTimeout(()=>{var J;return(J=Z.current)==null?void 0:J.scrollIntoView({behavior:"smooth"})},100);try{const W=K.filter(k=>k._type==="product").map(k=>{let G=`- ${k.name}`;return k.code&&(G+=` (M\xE3: ${k.code})`),k.price&&(G+=` - Gi\xE1: ${k.price.replace(/[đ\s]/g,"")}\u0111`),k.category&&(G+=` [${k.category}]`),k.note&&(G+=` (${k.note})`),G}).join(`
`),m=O.slice(-6).map(k=>`${k.role==="user"?"Kh\xE1ch":"AI"}: ${k.content}`).join(`
`),V=m?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${m}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${W}`:W,ae=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:V,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";i(k=>[...k,{role:"assistant",content:ae,attachments:D}])}catch(J){console.error("AI Error:",J);const W=t.toLowerCase(),y=K.filter(V=>{const E=Object.values(V).join(" ").toLowerCase();return W.split(" ").some(ae=>E.includes(ae))});let m="";y.length>0?(m=`T\xECm th\u1EA5y ${y.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,y.slice(0,5).forEach(V=>{m+=`\u2022 ${V.name}`,V.price&&(m+=` - ${V.price.replace(/[đ\s]/g,"")}\u0111`),V.note&&(m+=` (${V.note})`),m+=`
`}),y.length>5&&(m+=`
...v\xE0 ${y.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):m='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',i(V=>[...V,{role:"assistant",content:m,attachments:y.slice(0,4)}])}q(!1),setTimeout(()=>{var J,W;(J=Z.current)==null||J.scrollIntoView({behavior:"smooth"}),(W=H.current)==null||W.focus()},100)};function Ft({show:t,product:v,categories:D,onClose:J,onSave:W}){const[y,m]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[V,E]=useState(!1),[ae,k]=useState(!1),G=useRef(null),qe=T=>window.KTM.money.formatVNDInputDigits(T),Ie=T=>{const S=window.KTM.money.getDigits(String(T!=null?T:"")),L=Number(S);return S&&Number.isFinite(L)?Math.trunc(L):0},Ge=(T,S)=>{if(T==null||T==="")return[];let L=T;if(typeof L=="string"){const te=L.trim();if(!te)return[];try{L=JSON.parse(te)}catch(B){return[]}}if(!Array.isArray(L))return[];const X=Ie(S);return L.map(te=>{var xe;if(!te||typeof te!="object")return null;const B=String((xe=te.name)!=null?xe:"").trim(),Ne=(Array.isArray(te.options)?te.options:[]).map(Re=>{var yt,At,Mt,Nt,Ht,$t,Ut;if(!Re||typeof Re!="object")return null;const He=String((yt=Re.label)!=null?yt:"").trim();if(!He)return null;const nt=(Ht=(Nt=(Mt=(At=Re.price)!=null?At:Re.priceValue)!=null?Mt:Re.unit_price)!=null?Nt:Re.unitPrice)!=null?Ht:null,gt=Number(nt);let vt=Number.isFinite(gt)?Math.trunc(gt):null;if(vt==null){const zt=(Ut=($t=Re.price_delta)!=null?$t:Re.priceDelta)!=null?Ut:null,Gt=Number(zt);Number.isFinite(Gt)&&(vt=X+Math.trunc(Gt))}vt==null&&(vt=X);const Ze=String(Math.max(0,Math.trunc(Number(vt)||0)));return{label:He,price:Math.max(0,Math.trunc(Number(vt)||0)),priceDigits:Ze}}).filter(Boolean);return{name:B||"Bi\u1EBFn th\u1EC3",options:Ne}}).filter(Boolean)},ot=T=>{if(T==null||T==="")return[];let S=T;if(typeof S=="string"){const L=S.trim();if(!L)return[];try{S=JSON.parse(L)}catch(X){return[]}}return S&&typeof S=="object"&&!Array.isArray(S)&&(S=Object.entries(S).map(([L,X])=>({key:L,value:X}))),Array.isArray(S)?S.map(L=>{var Ne,xe,Re,He,nt;if(!L||typeof L!="object")return null;const X=String((Re=(xe=(Ne=L.key)!=null?Ne:L.name)!=null?xe:L.label)!=null?Re:"").trim(),te=String((He=L.value)!=null?He:"").trim(),B=String((nt=L.unit)!=null?nt:"").trim();return X?{key:X,value:te,unit:B}:null}).filter(Boolean):[]};useEffect(()=>{var T,S;if(v)if(m({name:v.name||"",code:v.code||"",price:v.price||"",image:v.image||"",category:v.category||"",note:v.note||"",sort_order:v.sort_order||0,commission_percent:(S=(T=v.commission_percent)!=null?T:v.commissionPercent)!=null?S:5,variants:Ge(v.variants,v.price),attributes:ot(v.attributes)}),v.price){const L=window.KTM.money.getDigits(v.price);ht(L),m(X=>({...X,price:qe(L)}))}else ht("");else m({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),ht("")},[v,t]);const at=T=>{m(S=>{var Ne;const L=Ie(S.price),X=String(L),te=Array.isArray(S.variants)?[...S.variants]:[],B={...te[T]||{},options:Array.isArray((Ne=te[T])==null?void 0:Ne.options)?[...te[T].options]:[]};return B.options=B.options.map(xe=>({label:String((xe==null?void 0:xe.label)||""),price:L,priceDigits:X})),te[T]=B,{...S,variants:te}})},Ye=()=>{m(T=>{const S=Ie(T.price),L=String(S),te=(Array.isArray(T.variants)?[...T.variants]:[]).map(B=>{const Ne=(Array.isArray(B==null?void 0:B.options)?B.options:[]).map(xe=>({label:String((xe==null?void 0:xe.label)||""),price:S,priceDigits:L}));return{name:String((B==null?void 0:B.name)||"Bi\u1EBFn th\u1EC3"),options:Ne}});return{...T,variants:te}})},[pt,Rt]=React.useState(""),[It,ht]=React.useState(""),jt=T=>{const S=window.KTM.money.nextPriceInputState(T.target.value,It);ht(S.digits),m({...y,price:S.price})},Pt=async(T,S=2)=>{const L=S*1024*1024;if(T.size<=L)return T;try{const X=await createImageBitmap(T),te=document.createElement("canvas");let B=X.width,Ne=X.height;const xe=1200;return(B>xe||Ne>xe)&&(B>Ne?(Ne=Math.round(Ne/B*xe),B=xe):(B=Math.round(B/Ne*xe),Ne=xe)),te.width=B,te.height=Ne,te.getContext("2d").drawImage(X,0,0,B,Ne),X.close(),new Promise((He,nt)=>{te.toBlob(gt=>{gt?He(new File([gt],T.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):nt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(X){throw console.error("Compress error:",X),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Vt=async T=>{var X;const S=T.target.files[0];if(!S)return;if(!(S.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(S.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}k(!0);try{const te=await Pt(S),B=await window.KTM.cloudinary.uploadImage({file:te,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!B.secure_url)throw console.error("Cloudinary error:",B),new Error(((X=B.error)==null?void 0:X.message)||"Upload failed");m(Ne=>({...Ne,image:B.secure_url}))}catch(te){console.error("Upload error:",te),alert("L\u1ED7i upload \u1EA3nh: "+te.message)}k(!1),T.target.value=""},Ct=async T=>{T.preventDefault(),E(!0);const S={...y,variants:Ge(y.variants,y.price),attributes:ot(y.attributes)};await W(S),E(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),v?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:J})),React.createElement("form",{onSubmit:Ct},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:y.name,onChange:T=>m({...y,name:T.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:y.code,onChange:T=>m({...y,code:T.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:y.price,onChange:jt,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:y.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:T=>m({...y,commission_percent:T.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:y.category,onChange:T=>m({...y,category:T.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),D.map(T=>React.createElement("option",{key:T,value:T},T)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:y.note,onChange:T=>m({...y,note:T.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(y.attributes)?y.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(y.attributes)?y.attributes:[]).map((T,S)=>React.createElement("div",{key:S,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(T==null?void 0:T.key)||"",onChange:L=>{const X=L.target.value;m(te=>{const B=Array.isArray(te.attributes)?[...te.attributes]:[];return B[S]={...B[S]||{},key:X},{...te,attributes:B}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(T==null?void 0:T.value)||"",onChange:L=>{const X=L.target.value;m(te=>{const B=Array.isArray(te.attributes)?[...te.attributes]:[];return B[S]={...B[S]||{},value:X},{...te,attributes:B}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(T==null?void 0:T.unit)||"",onChange:L=>{const X=L.target.value;m(te=>{const B=Array.isArray(te.attributes)?[...te.attributes]:[];return B[S]={...B[S]||{},unit:X},{...te,attributes:B}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{m(L=>{const X=Array.isArray(L.attributes)?[...L.attributes]:[];return X.splice(S,1),{...L,attributes:X}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{m(T=>{const S=Array.isArray(T.attributes)?[...T.attributes]:[];return S.push({key:"",value:"",unit:""}),{...T,attributes:S}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(y.variants)?y.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(y.variants)?y.variants:[]).map((T,S)=>React.createElement("div",{key:S,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(T==null?void 0:T.name)||"",onChange:L=>{const X=L.target.value;m(te=>{var Ne;const B=Array.isArray(te.variants)?[...te.variants]:[];return B[S]={...B[S]||{},name:X,options:Array.isArray((Ne=B[S])==null?void 0:Ne.options)?B[S].options:[]},{...te,variants:B}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>at(S),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(T==null?void 0:T.options)||T.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{m(L=>{const X=Array.isArray(L.variants)?[...L.variants]:[];return X.splice(S,1),{...L,variants:X}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(T==null?void 0:T.options)?T.options:[]).map((L,X)=>{var te,B;return React.createElement("div",{key:X,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(L==null?void 0:L.label)||"",onChange:Ne=>{const xe=Ne.target.value;m(Re=>{var Ze,yt,At,Mt,Nt;const He=Array.isArray(Re.variants)?[...Re.variants]:[],nt={...He[S]||{},options:Array.isArray((Ze=He[S])==null?void 0:Ze.options)?[...He[S].options]:[]},gt=Number((At=(yt=nt.options[X])==null?void 0:yt.price)!=null?At:0)||0,vt=String((Nt=(Mt=nt.options[X])==null?void 0:Mt.priceDigits)!=null?Nt:Math.max(0,Math.trunc(gt)));return nt.options[X]={...nt.options[X]||{},label:xe,price:Math.max(0,Math.trunc(gt)),priceDigits:vt},He[S]=nt,{...Re,variants:He}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:qe(String((B=L==null?void 0:L.priceDigits)!=null?B:window.KTM.money.getDigits(String((te=L==null?void 0:L.price)!=null?te:"")))),onChange:Ne=>{m(xe=>{var At,Mt,Nt,Ht,$t;const Re=String((Mt=L==null?void 0:L.priceDigits)!=null?Mt:window.KTM.money.getDigits(String((At=L==null?void 0:L.price)!=null?At:""))),He=window.KTM.money.nextPriceInputState(Ne.target.value,Re),nt=String((Nt=He.digits)!=null?Nt:""),gt=Number(nt),vt=Number.isFinite(gt)?Math.max(0,Math.trunc(gt)):0,Ze=Array.isArray(xe.variants)?[...xe.variants]:[],yt={...Ze[S]||{},options:Array.isArray((Ht=Ze[S])==null?void 0:Ht.options)?[...Ze[S].options]:[]};return yt.options[X]={...yt.options[X]||{},label:String((($t=yt.options[X])==null?void 0:$t.label)||""),price:vt,priceDigits:nt},Ze[S]=yt,{...xe,variants:Ze}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{m(Ne=>{var He;const xe=Array.isArray(Ne.variants)?[...Ne.variants]:[],Re={...xe[S]||{},options:Array.isArray((He=xe[S])==null?void 0:He.options)?[...xe[S].options]:[]};return Re.options.splice(X,1),xe[S]=Re,{...Ne,variants:xe}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{m(L=>{var Ne;const X=Array.isArray(L.variants)?[...L.variants]:[],te={...X[S]||{},options:Array.isArray((Ne=X[S])==null?void 0:Ne.options)?[...X[S].options]:[]},B=Ie(L.price);return te.options.push({label:"",price:B,priceDigits:String(B)}),X[S]=te,{...L,variants:X}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{m(T=>{const S=Ie(T.price),L=Array.isArray(T.variants)?[...T.variants]:[],X=String(S);return L.push({name:"Size",options:[{label:"S",price:S,priceDigits:X},{label:"M",price:S,priceDigits:X},{label:"L",price:S,priceDigits:X}]}),{...T,variants:L}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Ye,disabled:!Array.isArray(y.variants)||y.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},y.image?React.createElement(React.Fragment,null,React.createElement("img",{src:y.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>m({...y,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var T;return(T=G.current)==null?void 0:T.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:G,type:"file",accept:"image/*",className:"d-none",onChange:Vt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var T;return(T=G.current)==null?void 0:T.click()},disabled:ae,style:{borderRadius:"10px"}},ae?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:y.image,onChange:T=>m({...y,image:T.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:J,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:V,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const ut=t=>window.KTM.money.formatVND(t),Dt=t=>{if(t==null||t==="")return[];let v=t;if(typeof v=="string"){const D=v.trim();if(!D)return[];try{v=JSON.parse(D)}catch(J){return[]}}return Array.isArray(v)?v:[]},_t=t=>{if(t==null||t==="")return[];let v=t;if(typeof v=="string"){const D=v.trim();if(!D)return[];try{v=JSON.parse(D)}catch(J){return[]}}return v&&typeof v=="object"&&!Array.isArray(v)&&(v=Object.entries(v).map(([D,J])=>({key:D,value:J}))),Array.isArray(v)?v:[]},qt=(t,v={})=>{var y;const D=_t(t).map(m=>{var V,E,ae,k,G;return{key:String((ae=(E=(V=m==null?void 0:m.key)!=null?V:m==null?void 0:m.name)!=null?E:m==null?void 0:m.label)!=null?ae:"").trim(),value:String((k=m==null?void 0:m.value)!=null?k:"").trim(),unit:String((G=m==null?void 0:m.unit)!=null?G:"").trim()}}).filter(m=>!!m.key);if(!D.length)return null;const J=!!v.compact,W=String((y=v.className)!=null?y:"").trim();return React.createElement("div",{className:`ktm-variants-preview${J?" compact":""}${W?" "+W:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},D.map((m,V)=>{const E=m.key,ae=`${m.value||""}${m.unit?(m.value?" ":"")+m.unit:""}`.trim();return React.createElement("div",{key:`${E}-${V}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},E),ae?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ae):null)})))},ze=(t,v={})=>{var E;const D=Dt(t).map(ae=>{var k;return{name:String((k=ae==null?void 0:ae.name)!=null?k:"").trim(),options:Array.isArray(ae==null?void 0:ae.options)?ae.options:[]}}).map(ae=>({...ae,options:ae.options.map(k=>{var G;return{label:String((G=k==null?void 0:k.label)!=null?G:"").trim(),price:Number(k==null?void 0:k.price)}}).filter(k=>!!k.label)})).filter(ae=>ae.options.length>0);if(!D.length)return null;const J=Number.isFinite(v.maxGroups)?Math.max(1,Math.trunc(v.maxGroups)):D.length,W=Number.isFinite(v.maxOptionsPerGroup)?Math.max(1,Math.trunc(v.maxOptionsPerGroup)):3,y=!!v.compact,m=String((E=v.className)!=null?E:"").trim(),V=D.slice(0,J);return React.createElement("div",{className:`ktm-variants-preview${y?" compact":""}${m?" "+m:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},V.map((ae,k)=>{const G=ae.name||"Bi\u1EBFn th\u1EC3",qe=ae.options.slice(0,W),Ie=ae.options.length-qe.length;return React.createElement("div",{key:`${G}-${k}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},G),qe.map((Ge,ot)=>{const at=Ge.price,Ye=Number.isFinite(at)&&at>=0?ut(Math.trunc(at)):"",pt=Ye?`${Ge.label} \xB7 ${Ye}`:Ge.label;return React.createElement("span",{key:`${G}-${k}-${ot}`,className:"ktm-chip ktm-chip-option"},pt)}),Ie>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",Ie))})))},xt=(t,v)=>{const D=t._type==="product",J=t._type==="album",W=t._type==="video",y=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale")),m=D?qt(t.attributes,{compact:pe==="grid",className:pe==="grid"?"meta text-muted":"text-muted"}):null,V=D?ze(t.variants,{compact:pe==="grid",maxOptionsPerGroup:999,className:pe==="grid"?"meta text-muted":"text-muted"}):null;return pe==="grid"?React.createElement("div",{key:t.id||v,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>de({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${W?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${D?"product":J?"album":"video"}`},D?"SP":J?"\u1EA2nh":"Video"),y&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),m&&React.createElement("div",{style:{marginTop:2}},m),V&&React.createElement("div",{style:{marginTop:2}},V),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:re===t.id+"-img"?"copied":"",onClick:()=>tt(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:re===t.id+"-price"?"copied":"",onClick:()=>Qe(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||v,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${D?"product":J?"album":"video"}`},D?"S\u1EA3n ph\u1EA9m":J?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>de({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${W?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),y&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),m&&React.createElement("div",{style:{marginTop:4}},m),V&&React.createElement("div",{style:{marginTop:4}},V)),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),W&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},D&&React.createElement("button",{onClick:()=>w&&w("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:re===t.id+"-price"?"copied":"",onClick:()=>Qe(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:re===t.id+"-name"?"copied":"",onClick:()=>Qe(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),W&&t.youtubeId&&React.createElement("button",{className:re===t.id+"-yt"?"copied":"",onClick:()=>Qe(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),D&&React.createElement("button",{className:"action-edit",onClick:()=>Ot(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>wt(t)},React.createElement("i",{className:"fas fa-trash"}))))},[kt,St]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,Y.length)," k\u1EBFt qu\u1EA3",ie&&I.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),me!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},me==="product"?"S\u1EA3n ph\u1EA9m":me==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${pe==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Se("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${pe==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Se("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},le?React.createElement("div",null,[...Array(8)].map((t,v)=>React.createElement("div",{key:v,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):Y.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',I,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{ee(""),Fe("")}},"Xem t\u1EA5t c\u1EA3")):pe==="grid"?React.createElement("div",{className:"product-grid-mobile"},Y.map((t,v)=>xt(t,v))):React.createElement("div",null,Y.map((t,v)=>xt(t,v)))),kt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>St(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${me==="all"?"active":""}`,onClick:()=>{Be("all"),St(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${me==="product"?"active":""}`,onClick:()=>{Be("product"),St(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${me==="album"?"active":""}`,onClick:()=>{Be("album"),St(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${me==="video"?"active":""}`,onClick:()=>{Be("video"),St(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:ie,onChange:t=>_e(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:he,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:I,onChange:t=>Fe(t.target.value)}),React.createElement("button",{className:`filter-btn ${kt||me!=="all"?"active":""}`,onClick:()=>St(!kt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:x?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>u(!0),onTouchStart:()=>u(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Je&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>u(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},O.map((t,v)=>React.createElement("div",{key:v,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:re===`chat-${v}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:re===`chat-${v}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),ce(`chat-${v}`),setTimeout(()=>ce(null),1500)}},React.createElement("i",{className:`fas ${re===`chat-${v}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((D,J)=>React.createElement("div",{key:J,style:{width:70},className:"text-center"},D.image&&React.createElement("img",{src:D.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>de({url:D.image,name:D.name,price:D.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},D.name),D.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},D.price.replace(/[đ\s]/g,""),"\u0111"))))))),$&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Z})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>rt(t),disabled:$,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),rt(p)},className:"chat-input-wrap"},React.createElement("input",{ref:H,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:p,onChange:t=>A(t.target.value),disabled:$}),React.createElement("button",{type:"submit",className:"send-btn",disabled:$||!p.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),z&&React.createElement("div",{className:"preview-modal",onClick:()=>de(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>de(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:z.url,alt:z.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},z.name),z.price&&React.createElement("div",{className:"price"},z.price.replace(/[đ\s]/g,""),"\u0111"),z.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},z.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:re==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:re==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>tt(z.url,"preview")},React.createElement("i",{className:`fas ${re==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),z.price&&React.createElement("button",{className:re==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Qe(z.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${re==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Ft,{show:U,product:Ue,categories:oe,onClose:()=>{$e(!1),Ke(null)},onSave:Et}),React.createElement("div",{className:`fab-container mobile-only ${x?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{r(!1),$e(!0),Ke(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{r(!1),w&&w("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${x?"open":""}`,onClick:()=>r(!x)},React.createElement("i",{className:"fas fa-plus"}))),De&&g&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>c(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:je.name,onChange:t=>Xe({...je,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:je.code,onChange:t=>Xe({...je,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:je.price,onChange:t=>Xe({...je,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:je.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:t=>Xe({...je,commission_percent:t.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:je.category,onChange:t=>Xe({...je,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),et.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:je.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>Xe({...je,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>c(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:Te},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:M,showToast:w}){const[I,ee]=useState([]),[Y,N]=useState([]),[K,ne]=useState(!0),[oe,Q]=useState(null),[me,ve]=useState(!1),[re,ce]=useState(null),[pe,Se]=useState(!1),[le,ye]=useState(null),[fe,Ce]=useState(null),[Ae,Oe]=useState([]);useEffect(()=>{he()},[]);const he=async(c=null)=>{ne(!0);try{const g=c?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${c}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,ge=await window.KTM.api.getJSON(g,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");ee(Array.isArray(ge)?ge:[])}catch(g){console.error(g),w("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}ne(!1)},ie=async c=>{try{const g=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${c}`,"L\u1ED7i t\u1EA3i video");N(Array.isArray(g)?g:[])}catch(g){console.error(g)}},_e=async c=>{if(c===0)return;const g=[...I];[g[c-1],g[c]]=[g[c],g[c-1]],ee(g),await ke(g)},Me=async c=>{if(c===I.length-1)return;const g=[...I];[g[c],g[c+1]]=[g[c+1],g[c]],ee(g),await ke(g)},ke=async c=>{try{await Promise.all(c.map((g,ge)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${g.id}`,{sortOrder:ge},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),w("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(g){w("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),he(fe==null?void 0:fe.id)}},we=async c=>{if(c===0)return;const g=[...Y];[g[c-1],g[c]]=[g[c],g[c-1]],N(g),await u(g)},Je=async c=>{if(c===Y.length-1)return;const g=[...Y];[g[c],g[c+1]]=[g[c+1],g[c]],N(g),await u(g)},u=async c=>{try{await Promise.all(c.map((g,ge)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${g.id}`,{sort_order:ge},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),w("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(g){w("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ie(oe.id)}},O=()=>{ce(null),ve(!0)},i=c=>{ce(c),ve(!0)},p=async c=>{try{!re&&fe&&(c.parent_id=fe.id);const g=re?`${API_BASE}/api/video-folders/${re.id}`:`${API_BASE}/api/video-folders`;re?await window.KTM.api.putJSON(g,c,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(g,c,"L\u1ED7i l\u01B0u folder"),w(re?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),ve(!1),he(fe==null?void 0:fe.id)}catch(g){w(g.message,"danger")}},A=async c=>{const g=c.subfolderCount>0?`X\xF3a folder "${c.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${c.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(g))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${c.id}`,"L\u1ED7i x\xF3a folder"),w("\u0110\xE3 x\xF3a folder","success"),Q(null),he(fe==null?void 0:fe.id)}catch(ge){w("L\u1ED7i x\xF3a folder","danger")}},$=c=>{c.subfolderCount>0?(Oe(g=>[...g,c]),Ce(c),he(c.id)):(Q(c),N(c.videos||[]))},q=c=>{if(c==="root")Oe([]),Ce(null),he(null);else if(c){const g=Ae.findIndex(ge=>ge.id===c.id);g>=0&&(Oe(Ae.slice(0,g+1)),Ce(c),he(c.id))}else{const g=[...Ae];g.pop();const ge=g[g.length-1]||null;Oe(g),Ce(ge),he(ge==null?void 0:ge.id)}},Z=()=>{ye(null),Se(!0)},H=c=>{ye(c),Se(!0)},z=async c=>{try{c.folder_id=oe==null?void 0:oe.id;const g=le?`${API_BASE}/api/videos/${le.id}`:`${API_BASE}/api/videos`;le?await window.KTM.api.putJSON(g,c,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(g,c,"L\u1ED7i l\u01B0u video"),w(le?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),Se(!1),he(),oe&&ie(oe.id)}catch(g){w(g.message,"danger")}},de=async c=>{if(confirm(`X\xF3a video "${c.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${c.id}`,"L\u1ED7i x\xF3a video"),w("\u0110\xE3 x\xF3a video","success"),he(),oe&&ie(oe.id)}catch(g){w("L\u1ED7i x\xF3a video","danger")}},De=c=>{const g=`https://www.youtube.com/watch?v=${c.youtubeId}`;window.KTM.clipboard.writeText(g).then(()=>{w("\u0110\xE3 copy link!","success")}).catch(()=>{w("Kh\xF4ng th\u1EC3 copy link","danger")})};return oe?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Q(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${oe.slug==="shorts"?"text-danger":"text-warning"}`}),oe.name)),React.createElement("button",{className:"btn btn-warning",onClick:Z},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),Y.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},Y.map((c,g)=>React.createElement("div",{key:c.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>we(g),disabled:g===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},g+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Je(g),disabled:g===Y.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:c.thumb,className:"card-img-top",alt:c.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${c.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:c.title},c.title),React.createElement("small",{className:"text-muted"},c.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>De(c),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>H(c),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>de(c),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:pe,video:le,onClose:()=>Se(!1),onSave:z})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},fe&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>q()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),fe?fe.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:O},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Ae.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:c=>{c.preventDefault(),q("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Ae.map((c,g)=>React.createElement("li",{key:c.id,className:`breadcrumb-item ${g===Ae.length-1?"active":""}`},g===Ae.length-1?c.name:React.createElement("a",{href:"#",onClick:ge=>{ge.preventDefault(),q(c)},className:"text-warning"},c.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),K?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):I.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},fe?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:O},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",fe?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},I.map((c,g)=>{var ge,x,r,U;return React.createElement("div",{key:c.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:$e=>{$e.stopPropagation(),_e(g)},disabled:g===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},g+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:$e=>{$e.stopPropagation(),Me(g)},disabled:g===I.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>$(c),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${c.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},c.name),React.createElement("p",{className:"text-muted mb-0"},c.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),c.subfolderCount," folder"),c.subfolderCount>0&&(c.videoCount>0||((ge=c.videos)==null?void 0:ge.length)>0)&&" \u2022 ",(c.videoCount>0||((x=c.videos)==null?void 0:x.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),c.videoCount||((r=c.videos)==null?void 0:r.length)||0," videos"),c.subfolderCount===0&&!c.videoCount&&!((U=c.videos)!=null&&U.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:$e=>{$e.stopPropagation(),i(c)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:$e=>{$e.stopPropagation(),A(c)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:me,folder:re,onClose:()=>ve(!1),onSave:p}))}function VideoFolderModal({show:M,folder:w,onClose:I,onSave:ee}){const[Y,N]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[K,ne]=useState(!1),[oe,Q]=useState(!1);useEffect(()=>{N(w?{name:w.name||"",description:w.description||"",sortOrder:w.sortOrder||0,coverImage:w.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[w,M]);const me=async re=>{const ce=re.target.files[0];if(ce){Q(!0);try{const pe=await window.KTM.cloudinary.uploadImage({file:ce,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});pe.secure_url&&N(Se=>({...Se,coverImage:pe.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(pe){console.error("Cloudinary upload error:",pe),alert("L\u1ED7i upload \u1EA3nh: "+(pe.message||pe))}finally{Q(!1)}}},ve=async re=>{re.preventDefault(),ne(!0);const ce={...Y,variants:normalizeVariants(Y.variants,Y.price),attributes:normalizeAttributes(Y.attributes)};await ee(ce),ne(!1)};return M?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:I})),React.createElement("form",{onSubmit:ve},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:Y.name,onChange:re=>N({...Y,name:re.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:Y.description,onChange:re=>N({...Y,description:re.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Y.sortOrder,onChange:re=>N({...Y,sortOrder:parseInt(re.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},Y.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:Y.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>N({...Y,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:me,disabled:oe}),oe&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:Y.coverImage,onChange:re=>N({...Y,coverImage:re.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:I},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:K},K?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:M,settings:w}){const[I,ee]=useState([]),[Y,N]=useState(!0),[K,ne]=useState(!1),[oe,Q]=useState(null),[me,ve]=useState(""),[re,ce]=useState(""),pe=normalizeShipPercent(w==null?void 0:w.ship_percent),{parseMoney:Se,formatVND:le}=window.KTM.money,ye=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{fe()},[]);const fe=async()=>{N(!0);try{const i=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");ee(Array.isArray(i)?i:[])}catch(i){console.error(i),M("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}N(!1)},Ce=()=>{Q(null),ne(!0)},Ae=i=>{Q(i),ne(!0)},Oe=async i=>{if(!(!i||!i.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:i},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),M(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),fe()}catch(p){M("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},he=async i=>{try{const p=oe?`${API_BASE}/api/products?id=${oe.id}`:`${API_BASE}/api/products`;oe?await window.KTM.api.putJSON(p,i,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(p,i,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),M(oe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ne(!1),fe()}catch(p){M(p.message,"danger")}},ie=async i=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${i.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${i.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),M("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),fe()}catch(p){M(p.message,"danger")}},_e=I.filter(i=>{const p=!me||i.name.toLowerCase().includes(me.toLowerCase())||i.code&&i.code.toLowerCase().includes(me.toLowerCase()),A=!re||i.category===re;return p&&A}),Me=i=>{var $;const p=($=i==null?void 0:i.commission_percent)!=null?$:i==null?void 0:i.commissionPercent,A=p===""||p==null?NaN:Number(p);return Number.isFinite(A)?Math.max(0,Math.min(100,A)):5},ke=i=>{const p=Me(i),A=Number.isInteger(p)?String(p):String(Math.round(p*100)/100),$=Se(i==null?void 0:i.price);if(!Number.isFinite($)||$<=0)return`${A}%`;const q=(Number(p)||0)/100,H=window.KTM.money.parseShipFeeFromNote(i==null?void 0:i.note)!=null?0:pe>0?$*pe/100:0,z=$*q-H*q,de=Math.max(0,Math.round(z));return`${A}% - ${le(de)}`},we=i=>{if(i==null||i==="")return[];let p=i;if(typeof p=="string"){const A=p.trim();if(!A)return[];try{p=JSON.parse(A)}catch($){return[]}}return Array.isArray(p)?p:[]},Je=i=>{if(i==null||i==="")return[];let p=i;if(typeof p=="string"){const A=p.trim();if(!A)return[];try{p=JSON.parse(A)}catch($){return[]}}return p&&typeof p=="object"&&!Array.isArray(p)&&(p=Object.entries(p).map(([A,$])=>({key:A,value:$}))),Array.isArray(p)?p:[]},u=i=>{const p=Je(i).map(A=>{var $,q,Z,H,z;return{key:String((Z=(q=($=A==null?void 0:A.key)!=null?$:A==null?void 0:A.name)!=null?q:A==null?void 0:A.label)!=null?Z:"").trim(),value:String((H=A==null?void 0:A.value)!=null?H:"").trim(),unit:String((z=A==null?void 0:A.unit)!=null?z:"").trim()}}).filter(A=>!!A.key);return p.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},p.map((A,$)=>{const q=A.key,Z=`${A.value||""}${A.unit?(A.value?" ":"")+A.unit:""}`.trim();return React.createElement("div",{key:`${q}-${$}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},q),Z?React.createElement("span",{className:"ktm-chip ktm-chip-option"},Z):null)}))):null},O=(i,p={})=>{const A=we(i).map(H=>{var z;return{name:String((z=H==null?void 0:H.name)!=null?z:"").trim(),options:Array.isArray(H==null?void 0:H.options)?H.options:[]}}).map(H=>({...H,options:H.options.map(z=>{var de;return{label:String((de=z==null?void 0:z.label)!=null?de:"").trim(),price:Number(z==null?void 0:z.price)}}).filter(z=>!!z.label)})).filter(H=>H.options.length>0);if(!A.length)return null;const $=Number.isFinite(p.maxGroups)?Math.max(1,Math.trunc(p.maxGroups)):A.length,q=Number.isFinite(p.maxOptionsPerGroup)?Math.max(1,Math.trunc(p.maxOptionsPerGroup)):4,Z=A.slice(0,$);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Z.map((H,z)=>{const de=H.name||"Bi\u1EBFn th\u1EC3",De=H.options.slice(0,q),c=H.options.length-De.length;return React.createElement("div",{key:`${de}-${z}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},de),De.map((g,ge)=>{const x=g.price,r=Number.isFinite(x)&&x>=0?le(Math.trunc(x)):"",U=r?`${g.label} \xB7 ${r}`:g.label;return React.createElement("span",{key:`${de}-${z}-${ge}`,className:"ktm-chip ktm-chip-option"},U)}),c>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",c))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Ce},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:me,onChange:i=>ve(i.target.value)})),React.createElement("span",{className:"product-count"},_e.length)),React.createElement("select",{className:"form-select",value:re,onChange:i=>ce(i.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),ye.map(i=>React.createElement("option",{key:i,value:i},i)))),Y?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):_e.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Ce},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},_e.map(i=>React.createElement("div",{key:i.id,className:"product-item d-flex align-items-center gap-3"},i.image?React.createElement("img",{src:i.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},i.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},i.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},i.category),i.code&&React.createElement("span",{className:"product-badge bg-secondary"},i.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),ke(i))),React.createElement("div",{className:"product-price"},i.price?i.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),i.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},i.note),u(i.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},u(i.attributes)),O(i.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},O(i.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>Ae(i),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>ie(i),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:K,product:oe,categories:ye,onClose:()=>ne(!1),onSave:he}))}function ProductModal({show:M,product:w,categories:I,onClose:ee,onSave:Y}){const[N,K]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[ne,oe]=useState(!1),[Q,me]=useState(!1),ve=u=>{const O=window.KTM.money.getDigits(String(u!=null?u:"")),i=Number(O);return O&&Number.isFinite(i)?Math.trunc(i):0},re=u=>{if(u==null||u==="")return[];let O=u;if(typeof O=="string"){const i=O.trim();if(!i)return[];try{O=JSON.parse(i)}catch(p){return[]}}return O&&typeof O=="object"&&!Array.isArray(O)&&(O=Object.entries(O).map(([i,p])=>({key:i,value:p}))),Array.isArray(O)?O.map(i=>{var q,Z,H,z,de;if(!i||typeof i!="object")return null;const p=String((H=(Z=(q=i.key)!=null?q:i.name)!=null?Z:i.label)!=null?H:"").trim(),A=String((z=i.value)!=null?z:"").trim(),$=String((de=i.unit)!=null?de:"").trim();return p?{key:p,value:A,unit:$}:null}).filter(Boolean):[]},ce=(u,O)=>{if(u==null||u==="")return[];let i=u;if(typeof i=="string"){const A=i.trim();if(!A)return[];try{i=JSON.parse(A)}catch($){return[]}}if(!Array.isArray(i))return[];const p=ve(O);return i.map(A=>{var Z;if(!A||typeof A!="object")return null;const $=String((Z=A.name)!=null?Z:"").trim(),q=(Array.isArray(A.options)?A.options:[]).map(H=>{var ge,x,r,U,$e,Ue,Ke;if(!H||typeof H!="object")return null;const z=String((ge=H.label)!=null?ge:"").trim();if(!z)return null;const de=($e=(U=(r=(x=H.price)!=null?x:H.priceValue)!=null?r:H.unit_price)!=null?U:H.unitPrice)!=null?$e:null,De=Number(de);let c=Number.isFinite(De)?Math.trunc(De):null;if(c==null){const je=(Ke=(Ue=H.price_delta)!=null?Ue:H.priceDelta)!=null?Ke:null,Xe=Number(je);Number.isFinite(Xe)&&(c=p+Math.trunc(Xe))}c==null&&(c=p);const g=String(Math.max(0,Math.trunc(Number(c)||0)));return{label:z,price:Math.max(0,Math.trunc(Number(c)||0)),priceDigits:g}}).filter(Boolean);return{name:$||"Bi\u1EBFn th\u1EC3",options:q}}).filter(Boolean)};useEffect(()=>{var u,O;K(w?{name:w.name||"",code:w.code||"",price:w.price||"",image:w.image||"",category:w.category||"",note:w.note||"",sort_order:w.sort_order||0,commission_percent:(O=(u=w.commission_percent)!=null?u:w.commissionPercent)!=null?O:5,variants:ce(w.variants,w.price),attributes:re(w.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[w,M]);const pe=u=>{K(O=>{var q;const i=ve(O.price),p=String(i),A=Array.isArray(O.variants)?[...O.variants]:[],$={...A[u]||{},options:Array.isArray((q=A[u])==null?void 0:q.options)?[...A[u].options]:[]};return $.options=$.options.map(Z=>({label:String((Z==null?void 0:Z.label)||""),price:i,priceDigits:p})),A[u]=$,{...O,variants:A}})},Se=()=>{K(u=>{const O=ve(u.price),i=String(O),A=(Array.isArray(u.variants)?[...u.variants]:[]).map($=>{const q=(Array.isArray($==null?void 0:$.options)?$.options:[]).map(Z=>({label:String((Z==null?void 0:Z.label)||""),price:O,priceDigits:i}));return{name:String(($==null?void 0:$.name)||"Bi\u1EBFn th\u1EC3"),options:q}});return{...u,variants:A}})},[le,ye]=React.useState(""),fe=u=>window.KTM.money.formatVNDInputDigits(u),[Ce,Ae]=React.useState(""),Oe=u=>{const O=window.KTM.money.nextPriceInputState(u.target.value,Ce);Ae(O.digits),K({...N,price:O.price})},[he,ie]=React.useState("");React.useEffect(()=>{w!=null&&w.image&&ie(w.image)},[w]);const _e=async u=>{if(!(!u||!u.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:u},"L\u1ED7i x\xF3a \u1EA3nh")}catch(O){console.error("Delete cloudinary image error:",O)}},Me=async(u,O=2,i)=>{const p=O*1024*1024,A=u.type==="image/heic"||u.type==="image/heif"||/\.heic$/i.test(u.name);if(u.size<=p&&!A)return u;i==null||i("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const $=await createImageBitmap(u);i==null||i("\u0110ang n\xE9n \u1EA3nh...");const q=document.createElement("canvas");let Z=$.width,H=$.height;const z=1200;return(Z>z||H>z)&&(Z>H?(H=Math.round(H/Z*z),Z=z):(Z=Math.round(Z/H*z),H=z)),q.width=Z,q.height=H,q.getContext("2d").drawImage($,0,0,Z,H),$.close(),new Promise((De,c)=>{q.toBlob(g=>{g?(i==null||i("Ho\xE0n t\u1EA5t!"),De(new File([g],u.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):c(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch($){throw console.error("createImageBitmap error:",$),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ke=async u=>{var p,A;const O=(p=u.target.files)==null?void 0:p[0];if(!O)return;if(!(O.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(O.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}me(!0),ye("\u0110ang chu\u1EA9n b\u1ECB...");try{const $=(O.size/1024/1024).toFixed(1);ye(`File ${$}MB - \u0110ang n\xE9n...`);const q=await Me(O,2,z=>{ye(z)}),Z=(q.size/1024/1024).toFixed(1);ye(`\u0110\xE3 n\xE9n: ${Z}MB - \u0110ang upload...`);const H=await window.KTM.cloudinary.uploadImage({file:q,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});H.secure_url?(N.image&&N.image!==he&&_e(N.image),K(z=>({...z,image:H.secure_url})),ye("")):(console.error("Cloudinary error:",H),alert("Upload th\u1EA5t b\u1EA1i: "+(((A=H.error)==null?void 0:A.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),ye(""))}catch($){console.error("Upload error:",$),alert("L\u1ED7i: "+$.message),ye("")}me(!1),u.target.value=""},we=()=>{N.image&&(N.image!==he&&_e(N.image),K(u=>({...u,image:""})))},Je=async u=>{u.preventDefault(),oe(!0),he&&N.image&&he!==N.image&&await _e(he),he&&!N.image&&await _e(he),await Y(N),oe(!1)};return M?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${w?"fa-edit":"fa-plus-circle"} me-2`}),w?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:ee})),React.createElement("form",{onSubmit:Je},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},N.image?React.createElement(React.Fragment,null,React.createElement("img",{src:N.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:we,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Q?"fa-spinner fa-spin":"fa-camera"} me-1`}),Q?le||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:ke,disabled:Q,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Q&&le&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},le))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:N.name,onChange:u=>K({...N,name:u.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:N.code,onChange:u=>K({...N,code:u.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:N.price,onChange:Oe,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:N.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:u=>K({...N,commission_percent:u.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:N.category,onChange:u=>K({...N,category:u.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),I.map(u=>React.createElement("option",{key:u,value:u},u)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:N.note,onChange:u=>K({...N,note:u.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(N.attributes)?N.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(N.attributes)?N.attributes:[]).map((u,O)=>React.createElement("div",{key:O,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(u==null?void 0:u.key)||"",onChange:i=>{const p=i.target.value;K(A=>{const $=Array.isArray(A.attributes)?[...A.attributes]:[];return $[O]={...$[O]||{},key:p},{...A,attributes:$}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(u==null?void 0:u.value)||"",onChange:i=>{const p=i.target.value;K(A=>{const $=Array.isArray(A.attributes)?[...A.attributes]:[];return $[O]={...$[O]||{},value:p},{...A,attributes:$}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(u==null?void 0:u.unit)||"",onChange:i=>{const p=i.target.value;K(A=>{const $=Array.isArray(A.attributes)?[...A.attributes]:[];return $[O]={...$[O]||{},unit:p},{...A,attributes:$}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{K(i=>{const p=Array.isArray(i.attributes)?[...i.attributes]:[];return p.splice(O,1),{...i,attributes:p}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{K(u=>{const O=Array.isArray(u.attributes)?[...u.attributes]:[];return O.push({key:"",value:"",unit:""}),{...u,attributes:O}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(N.variants)?N.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(N.variants)?N.variants:[]).map((u,O)=>React.createElement("div",{key:O,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(u==null?void 0:u.name)||"",onChange:i=>{const p=i.target.value;K(A=>{var q;const $=Array.isArray(A.variants)?[...A.variants]:[];return $[O]={...$[O]||{},name:p,options:Array.isArray((q=$[O])==null?void 0:q.options)?$[O].options:[]},{...A,variants:$}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>pe(O),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(u==null?void 0:u.options)||u.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{K(i=>{const p=Array.isArray(i.variants)?[...i.variants]:[];return p.splice(O,1),{...i,variants:p}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(u==null?void 0:u.options)?u.options:[]).map((i,p)=>{var A,$;return React.createElement("div",{key:p,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(i==null?void 0:i.label)||"",onChange:q=>{const Z=q.target.value;K(H=>{var g,ge,x,r,U;const z=Array.isArray(H.variants)?[...H.variants]:[],de={...z[O]||{},options:Array.isArray((g=z[O])==null?void 0:g.options)?[...z[O].options]:[]},De=Number((x=(ge=de.options[p])==null?void 0:ge.price)!=null?x:0)||0,c=String((U=(r=de.options[p])==null?void 0:r.priceDigits)!=null?U:Math.max(0,Math.trunc(De)));return de.options[p]={...de.options[p]||{},label:Z,price:Math.max(0,Math.trunc(De)),priceDigits:c},z[O]=de,{...H,variants:z}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:fe(String(($=i==null?void 0:i.priceDigits)!=null?$:window.KTM.money.getDigits(String((A=i==null?void 0:i.price)!=null?A:"")))),onChange:q=>{K(Z=>{var x,r,U,$e,Ue;const H=String((r=i==null?void 0:i.priceDigits)!=null?r:window.KTM.money.getDigits(String((x=i==null?void 0:i.price)!=null?x:""))),z=window.KTM.money.nextPriceInputState(q.target.value,H),de=String((U=z.digits)!=null?U:""),De=Number(de),c=Number.isFinite(De)?Math.max(0,Math.trunc(De)):0,g=Array.isArray(Z.variants)?[...Z.variants]:[],ge={...g[O]||{},options:Array.isArray(($e=g[O])==null?void 0:$e.options)?[...g[O].options]:[]};return ge.options[p]={...ge.options[p]||{},label:String(((Ue=ge.options[p])==null?void 0:Ue.label)||""),price:c,priceDigits:de},g[O]=ge,{...Z,variants:g}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{K(q=>{var z;const Z=Array.isArray(q.variants)?[...q.variants]:[],H={...Z[O]||{},options:Array.isArray((z=Z[O])==null?void 0:z.options)?[...Z[O].options]:[]};return H.options.splice(p,1),Z[O]=H,{...q,variants:Z}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{K(i=>{var q;const p=Array.isArray(i.variants)?[...i.variants]:[],A={...p[O]||{},options:Array.isArray((q=p[O])==null?void 0:q.options)?[...p[O].options]:[]},$=ve(i.price);return A.options.push({label:"",price:$,priceDigits:String($)}),p[O]=A,{...i,variants:p}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{K(u=>{const O=ve(u.price),i=Array.isArray(u.variants)?[...u.variants]:[],p=String(O);return i.push({name:"Size",options:[{label:"S",price:O,priceDigits:p},{label:"M",price:O,priceDigits:p},{label:"L",price:O,priceDigits:p}]}),{...u,variants:i}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Se,disabled:!Array.isArray(N.variants)||N.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:N.image,onChange:u=>K({...N,image:u.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:ee,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:ne,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ne?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:M,video:w,onClose:I,onSave:ee}){const[Y,N]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[K,ne]=useState(!1),[oe,Q]=useState("");useEffect(()=>{w?(N({title:w.title||"",youtube_url:`https://www.youtube.com/watch?v=${w.youtubeId}`,thumbnail_url:w.thumb||"",sort_order:w.sortOrder||0}),Q(w.thumb)):(N({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Q(""))},[w,M]);const me=ce=>{const pe=ce.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return pe?pe[1]:null},ve=ce=>{N({...Y,youtube_url:ce});const pe=me(ce);pe&&Q(`https://img.youtube.com/vi/${pe}/hqdefault.jpg`)},re=async ce=>{ce.preventDefault(),ne(!0),await ee(Y),ne(!1)};return M?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:I})),React.createElement("form",{onSubmit:re},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:Y.youtube_url,onChange:ce=>ve(ce.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),oe&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:oe,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:Y.title,onChange:ce=>N({...Y,title:ce.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Y.sort_order,onChange:ce=>N({...Y,sort_order:parseInt(ce.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:Y.thumbnail_url,onChange:ce=>N({...Y,thumbnail_url:ce.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:I},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:K},K?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[M,w]=useState(!1),[I,ee]=useState(""),[Y,N]=useState(null),[K,ne]=useState("search"),[oe,Q]=useState(null),[me,ve]=useState(""),[re,ce]=useState([]),[pe,Se]=useState(null),[le,ye]=useState(!1),[fe,Ce]=useState(null),[Ae,Oe]=useState(!0),[he,ie]=useState([]),[_e,Me]=useState(()=>loadAdminSettings()),[ke,we]=useState(null),[Je,u]=useState([]);useEffect(()=>{const x=localStorage.getItem("ktm_admin_session");if(x)try{const r=JSON.parse(x);r.expiry>Date.now()?(w(!0),N(r.user)):localStorage.removeItem("ktm_admin_session")}catch(r){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{M&&$()},[M]),useEffect(()=>{if(!M)return;let x=!1;return(async()=>{try{const r=await fetchAdminSettingsFromServer();if(x)return;Me(r),saveAdminSettings(r)}catch(r){}})(),()=>{x=!0}},[M]);const O=async(x,r)=>{ee("");try{const U=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:x,password:r},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),$e={user:U.user,token:U.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify($e)),N(U.user),w(!0)}catch(U){ee(U.message)}},i=()=>{localStorage.removeItem("ktm_admin_session"),w(!1),N(null),ce([]),Se(null)},p=(x,r="success")=>{const U=Date.now();ie($e=>[...$e,{id:U,message:x,type:r}])},A=x=>{ie(r=>r.filter(U=>U.id!==x))},$=async(x=null)=>{Oe(!0);try{const r=x?`${API_BASE}/api/albums?parent_id=${x}`:`${API_BASE}/api/albums?parent_id=root`,U=await window.KTM.api.getJSON(r,"L\u1ED7i t\u1EA3i danh s\xE1ch album");ce(Array.isArray(U)?U:[])}catch(r){console.error(r),p("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}Oe(!1)},q=()=>{Ce(null),ye(!0)},Z=x=>{Ce(x),ye(!0)},H=async x=>{try{const r=fe&&fe.uuid;!r&&ke&&(x.parent_id=ke.uuid);const U=r?`${API_BASE}/api/albums/${fe.uuid||fe.id}`:`${API_BASE}/api/albums`;r?await window.KTM.api.putJSON(U,x,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(U,x,"L\u1ED7i t\u1EA1o"),p(r?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),ye(!1),$(ke==null?void 0:ke.uuid)}catch(r){p(r.message,"danger")}},z=x=>{Se(x)},de=x=>{if(x==="root")u([]),we(null),$(null);else if(x){const r=Je.findIndex(U=>U.uuid===x.uuid);r>=0&&(u(Je.slice(0,r+1)),we(x),$(x.uuid))}else{const r=[...Je];r.pop();const U=r[r.length-1]||null;u(r),we(U),$(U==null?void 0:U.uuid)}},De=async x=>{const r=`X\xF3a folder "${x.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(r))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${x.uuid||x.id}`,"L\u1ED7i x\xF3a album"),p("\u0110\xE3 x\xF3a","success"),$(ke==null?void 0:ke.uuid)}catch(U){p("L\u1ED7i x\xF3a album","danger")}};if(!M)return React.createElement(LoginPage,{onLogin:O,error:I});const c=()=>{const x=new Date,r=x.getFullYear(),U=String(x.getMonth()+1).padStart(2,"0");return`${r}-${U}`};function g(){const[x,r]=useState(()=>{var Ke;return String((Ke=_e==null?void 0:_e.ship_percent)!=null?Ke:DEFAULT_SHIP_PERCENT)}),[U,$e]=useState(!1);return useEffect(()=>{var Ke;r(String((Ke=_e==null?void 0:_e.ship_percent)!=null?Ke:DEFAULT_SHIP_PERCENT))},[_e==null?void 0:_e.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Ke=>{Ke.preventDefault(),$e(!0);const je=saveAdminSettings({ship_percent:x});try{const Xe=await saveAdminSettingsToServer(je);Me(Xe),saveAdminSettings(Xe),p("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Xe){Me(je),p("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{$e(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:x,min:"0",max:"100",step:"0.01",onChange:Ke=>r(Ke.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:U},U?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function ge(){const[x,r]=useState(c()),[U,$e]=useState(!0),[Ue,Ke]=useState([]),[je,Xe]=useState([]),et=useRef(!1),Ot=useRef(new Map),Te=normalizeShipPercent(_e==null?void 0:_e.ship_percent),{parseMoney:wt,parseShipFeeFromNote:Et,getShipFeeForItems:mt,formatNumber:be,formatVND:Ee}=window.KTM.money,it=async()=>{if(!et.current)try{const _=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m");Xe(Array.isArray(_)?_:[]),et.current=!0}catch(_){console.error("Load products for stats error:",_),Xe([]),et.current=!0}},dt=async _=>{var lt,rt;const Fe=String(_||"").trim();if(!Fe)return[];const Be=(lt=Ot.current)==null?void 0:lt.get(Fe);if(Be&&Array.isArray(Be))return Be;const Qe=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(Fe)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),tt=Array.isArray(Qe)?Qe:[];return(rt=Ot.current)==null||rt.set(Fe,tt),tt},b=async()=>{$e(!0);try{await it();const _=await dt(x);Ke(Array.isArray(_)?_:[])}catch(_){console.error("Load stats error:",_),Ke([])}finally{$e(!1)}};useEffect(()=>{b()},[x]);const j=React.useMemo(()=>{var ae;const _={draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};let Fe=0,Be=0,Qe=0,tt=0,lt=0,rt=0,Ft=0,ut=0;const Dt=k=>k.customer_id||k.phone||"unknown",_t=k=>window.KTM.orders.getOrderItems(k),qt=new Map,ze=new Map,xt=new Map,kt=5,St=new Map((Array.isArray(je)?je:[]).map(k=>{var Ge;const G=(Ge=k==null?void 0:k.commission_percent)!=null?Ge:k==null?void 0:k.commissionPercent,qe=Number(G),Ie=Number.isFinite(qe)?Math.max(0,Math.min(100,qe)):kt;return[String(k==null?void 0:k.id),Ie]})),t=k=>{const G=String(k!=null?k:"").trim().toLowerCase();return G==="cancelled"?"canceled":G};for(const k of Ue){const G=t(k==null?void 0:k.status),Ge=G==="canceled"||G==="draft",ot=_t(k);let at=0,Ye=0,pt=0;for(const S of ot){const L=Number((S==null?void 0:S.quantity)||0)||0,X=wt(S==null?void 0:S.product_price),te=L*X,B=String((S==null?void 0:S.product_id)||""),Ne=St.has(B)?St.get(B):kt,xe=(Number(Ne)||0)/100;if(at+=L,Ye+=te,pt+=te*xe,!Ge){const Re=(S==null?void 0:S.product_id)||"unknown",He=qt.get(B)||{product_id:Re,product_name:(S==null?void 0:S.product_name)||"\u2014",product_code:(S==null?void 0:S.product_code)||"",orders:0,quantity:0,revenue:0};He.orders+=1,He.quantity+=L,He.revenue+=te,qt.set(Re,He)}}const Rt=mt(ot),It=Number((ae=k==null?void 0:k.adjustment_amount)!=null?ae:0)||0,ht=Ye+(Rt.found?Rt.fee:0)+It,jt=Ye+It,Pt=!Rt.found&&Te>0&&Ye>0?Ye*Te/100:0,Vt=Ye>0?pt/Ye:kt/100,Ct=pt+It*Vt-Pt*Vt,T=G==="done"||G==="paid";if(G==="draft"?_.draft+=1:G==="pending"?_.pending+=1:G==="processing"?_.processing+=1:G==="canceled"?_.canceled+=1:G==="paid"?(_.paid+=1,_.done+=1,tt+=ht,rt+=jt,ut+=Ct):G==="done"?(_.done+=1,tt+=ht,rt+=jt,ut+=Ct):_.other+=1,!Ge){Fe+=1,Be+=at,Qe+=ht,lt+=jt,Ft+=Ct;const S=Dt(k),L=ze.get(S)||{key:S,customer_name:k.customer_name||"",phone:k.phone||"",orders:0,quantity:0,revenue:0};L.orders+=1,L.quantity+=at,L.revenue+=ht,!L.customer_name&&k.customer_name&&(L.customer_name=k.customer_name),!L.phone&&k.phone&&(L.phone=k.phone),ze.set(S,L);const X=k.created_at?new Date(k.created_at):null;if(X&&!Number.isNaN(X.getTime())){const te=`${X.getFullYear()}-${String(X.getMonth()+1).padStart(2,"0")}-${String(X.getDate()).padStart(2,"0")}`,B=xt.get(te)||{day:te,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};B.orders+=1,B.quantity+=at,B.revenue+=ht,T&&(B.doneOrders+=1,B.doneRevenue+=ht),xt.set(te,B)}}}const v=Array.from(qt.values()).sort((k,G)=>G.revenue-k.revenue),D=Array.from(ze.values()).sort((k,G)=>G.revenue-k.revenue),J=Array.from(xt.values()).sort((k,G)=>k.day.localeCompare(G.day)),W=ze.size,y=Fe?Math.round(Qe/Fe):0,m=Fe?Be/Fe:0,V=Math.round(ut),E=Math.round(Ft);return{statusCounts:_,activeOrders:Fe,totalQty:Be,totalRevenue:Qe,doneRevenue:tt,tempCommission:V,tempCommissionAll:E,products:v,customers:D,days:J,uniqueCustomers:W,avgOrderValue:y,avgQtyPerOrder:m}},[Ue,je,x]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:U}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:b,disabled:U},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:x,onChange:_=>r(_.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",Te,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),be(j.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),be(j.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),be(j.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",be(j.statusCounts.paid),"/",be(j.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},be(j.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ee(j.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ee(j.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ee(j.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ee(j.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",j.avgQtyPerOrder?j.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},be(j.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},be(j.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},be(j.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},be(j.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},be(j.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},be(j.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},be(j.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,be(j.statusCounts.draft)),React.createElement("td",null,be(j.statusCounts.pending)),React.createElement("td",null,be(j.statusCounts.processing)),React.createElement("td",null,be(j.statusCounts.canceled)),React.createElement("td",null,be(j.statusCounts.done)),React.createElement("td",null,be(j.statusCounts.paid)),React.createElement("td",null,be(j.statusCounts.other)),React.createElement("td",null,be(j.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},j.products.slice(0,10).map(_=>React.createElement("div",{key:_.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},_.product_name),React.createElement("div",{className:"text-muted small text-truncate"},_.product_code?`#${_.product_code} \u2022 `:"",be(_.orders)," \u0111\u01A1n \u2022 ",be(_.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ee(_.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,j.products.slice(0,10).map(_=>React.createElement("tr",{key:_.product_id},React.createElement("td",null,_.product_name),React.createElement("td",null,_.product_code||"\u2014"),React.createElement("td",null,be(_.orders)),React.createElement("td",null,be(_.quantity)),React.createElement("td",{className:"fw-semibold"},Ee(_.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},j.customers.slice(0,10).map(_=>React.createElement("div",{key:_.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},_.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},_.phone||"\u2014"," \u2022 ",be(_.orders)," \u0111\u01A1n \u2022 ",be(_.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Ee(_.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,j.customers.slice(0,10).map(_=>React.createElement("tr",{key:_.key},React.createElement("td",null,_.customer_name||"\u2014"),React.createElement("td",null,_.phone||"\u2014"),React.createElement("td",null,be(_.orders)),React.createElement("td",null,be(_.quantity)),React.createElement("td",{className:"fw-semibold"},Ee(_.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},j.days.map(_=>React.createElement("div",{key:_.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},_.day),React.createElement("div",{className:"text-muted small"},be(_.orders)," \u0111\u01A1n \u2022 ",be(_.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",be(_.doneOrders)," \u2022 ",Ee(_.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Ee(_.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,j.days.map(_=>React.createElement("tr",{key:_.day},React.createElement("td",null,_.day),React.createElement("td",null,be(_.orders)),React.createElement("td",null,be(_.quantity)),React.createElement("td",{className:"fw-semibold"},Ee(_.revenue)),React.createElement("td",null,be(_.doneOrders)),React.createElement("td",{className:"fw-semibold"},Ee(_.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:K,onMenuChange:x=>{ne(x),x==="albums"&&(we(null),u([]),$(null))},onLogout:i,currentUser:Y}),React.createElement("div",{className:"main-content"},K==="albums"&&!pe&&React.createElement(AlbumList,{albums:re,loading:Ae,currentFolder:ke,breadcrumb:Je,onSelect:z,onCreate:q,onEdit:Z,onDelete:De,onBack:de}),K==="search"&&React.createElement(SearchCenter,{showToast:p,onNavigate:(x,r,U)=>{ne(x),x==="orders"&&r==="create"&&(Q(Date.now()),ve((U==null?void 0:U.productId)||""))}}),K==="albums"&&pe&&React.createElement(AlbumDetail,{album:pe,parentAlbum:Je.length>0?Je[Je.length-1]:null,onBack:()=>{if(pe.parentId){const x=Je.findIndex(r=>r.uuid===pe.parentId);x>=0?Se(Je[x]):Se(null)}else Se(null)},onRefresh:()=>$(ke==null?void 0:ke.uuid),showToast:p,onNavigateToFolder:x=>{u(r=>[...r,pe]),Se(x)},onEditSubfolder:x=>{Ce(x),ye(!0)}}),K==="videos"&&React.createElement(VideoList,{showToast:p}),K==="products"&&React.createElement(ProductManager,{showToast:p,settings:_e}),K==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:oe,autoOpenCreateProductId:me,showToast:p}),K==="stats"&&React.createElement(ge,null),K==="settings"&&React.createElement(g,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${K==="search"?"active":""}`,onClick:x=>{x.preventDefault(),ne("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${K==="albums"?"active":""}`,onClick:x=>{x.preventDefault(),ne("albums"),Se(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${K==="videos"?"active":""}`,onClick:x=>{x.preventDefault(),ne("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${K==="products"?"active":""}`,onClick:x=>{x.preventDefault(),ne("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${K==="orders"?"active":""}`,onClick:x=>{x.preventDefault(),ne("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${K==="stats"?"active":""}`,onClick:x=>{x.preventDefault(),ne("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:le,album:fe,parentId:ke==null?void 0:ke.uuid,onClose:()=>ye(!1),onSave:H}),React.createElement("div",{className:"toast-container"},he.map(x=>React.createElement(Toast,{key:x.id,message:x.message,type:x.type,onClose:()=>A(x.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:M,autoOpenCreateProductId:w,showToast:I}){const[ee,Y]=useState([]),[N,K]=useState([]),[ne,oe]=useState(!0),[Q,me]=useState(!1),[ve,re]=useState([]),[ce,pe]=useState(!1),[Se,le]=useState(""),[ye,fe]=useState([]),[Ce,Ae]=useState(!1),[Oe,he]=useState(""),[ie,_e]=useState(!1),[Me,ke]=useState(null),[we,Je]=useState(null),[u,O]=useState(!1),[i,p]=useState(()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${n}-${a}`}),[A,$]=useState(""),[q,Z]=useState(!1),[H,z]=useState(!1),[de,De]=useState(null),[c,g]=useState(!1),[ge,x]=useState([]),[r,U]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[$e,Ue]=useState([""]),[Ke,je]=useState(null),Xe=useRef({}),[et,Ot]=useState([]),[Te,wt]=useState(null),Et=useRef(null),mt=useRef(null),be=useRef(0),Ee=useRef(null),it=useRef(0),dt=useRef(new Map),b=useRef(""),j=useRef(null),_=useRef(0),Fe=useRef(null),Be=9,Qe=150,tt=24*60*60*1e3,lt=5*60*1e3,rt="ktm_customer_lookup_cache_v1",Ft=200,ut=3,Dt=3,_t=1,qt=24*60*60*1e3,ze=React.useMemo(()=>String(Se||"").trim().length>0,[Se]),xt=e=>{try{const n=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(n))return 0;const a=Date.now()-n;return!Number.isFinite(a)||a<=0?0:Math.floor(a/qt)}catch(n){return 0}},kt=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:xt(e)>=ut,St=e=>{const n=String(e!=null?e:"").trim().toLowerCase();return n==="cancelled"?"canceled":n},t=e=>{if(St(e==null?void 0:e.status)!=="draft")return null;const a=Dt-xt(e);return Number.isFinite(a)?a:null},v=e=>{const n=t(e);return Number.isFinite(n)?n>0&&n<=_t:!1},D=e=>{U({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Ue([""]),De(null),je(null)};useEffect(()=>{const e=n=>{var s;if(Ke==null)return;const a=(s=Xe.current)==null?void 0:s[Ke];a&&!a.contains(n.target)&&je(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Ke]);const J=e=>window.KTM.money.parseMoney(e),W=e=>window.KTM.money.parseSignedMoney(e),y=e=>window.KTM.money.formatVND(e),m=e=>window.KTM.money.parseShipFeeFromNote(e),V=e=>window.KTM.phone.isValid(e),E=e=>window.KTM.phone.normalize(e),ae=()=>{var e;try{const n=localStorage.getItem(rt);if(!n)return;const a=JSON.parse(n);if(!a||typeof a!="object")return;const s=Object.entries(a);for(const[l,f]of s)!l||!f||typeof f!="object"||(e=dt.current)==null||e.set(String(l),f)}catch(n){}},k=()=>{try{const e=dt.current;if(!e||typeof e.entries!="function")return;const n=Array.from(e.entries()).filter(([s,l])=>s&&l&&typeof l=="object"&&Number.isFinite(l.ts)).sort((s,l)=>(Number(l[1].ts)||0)-(Number(s[1].ts)||0)).slice(0,Ft),a={};for(const[s,l]of n)a[s]=l;localStorage.setItem(rt,JSON.stringify(a))}catch(e){}};useEffect(()=>{ae()},[]);const G=e=>{const n=E(e);if(!n)return null;const a=Array.isArray(ee)?ee:[];let s=null,l=-1;for(const f of a){if(!f||E(f.phone||"")!==n)continue;const R=new Date(f.created_at).getTime(),C=Number.isFinite(R)?R:0;C>=l&&(l=C,s=f)}return s?{name:String(s.customer_name||"").trim(),address:String(s.address||"").trim()}:null},qe=(e,n)=>{e&&U(a=>n&&E(a.phone)!==n?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},Ie=e=>{const n=G(e);if(!n)return;const a=E(e);U(s=>{if(a&&E(s.phone)!==a)return s;const l={...s};return!String(s.customer_name||"").trim()&&n.name&&(l.customer_name=n.name),!String(s.address||"").trim()&&n.address&&(l.address=n.address),l})},Ge=(e,n,a)=>{var s;try{const l=E(e);if(!l)return;const f=String(n||"").trim(),R=String(a||"").trim();if(!f&&!R)return;(s=dt.current)==null||s.set(l,{ts:Date.now(),status:"found",customer:{phone:l,name:f||null,address:R||null}}),k()}catch(l){}},ot=async e=>{var l,f,R;const n=E(e);if(!n)return;Ie(n);const a=(l=dt.current)==null?void 0:l.get(n);if(a&&Number.isFinite(a.ts)){const C=Date.now()-a.ts,d=a.status==="found"?tt:lt;if(C>=0&&C<=d){De({status:a.status,phone:n,customer:a.customer}),a.status==="found"&&a.customer&&qe(a.customer,n);return}}const s=++be.current;De({status:"loading",phone:n});try{const C=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(n)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(be.current!==s)return;if(C&&C.exists&&C.customer){(f=dt.current)==null||f.set(n,{ts:Date.now(),status:"found",customer:C.customer}),k(),De({status:"found",phone:n,customer:C.customer}),qe(C.customer,n);return}(R=dt.current)==null||R.set(n,{ts:Date.now(),status:"not-found",customer:null}),k(),De({status:"not-found",phone:n})}catch(C){if(be.current!==s)return;console.error("Customer lookup error:",C),De({status:"error",phone:n})}},at=e=>{const n=E(e),a=G(n);U(l=>{const f={...l,phone:n};return a&&(!String(l.customer_name||"").trim()&&a.name&&(f.customer_name=a.name),!String(l.address||"").trim()&&a.address&&(f.address=a.address)),f}),g(!1),mt.current&&(clearTimeout(mt.current),mt.current=null);const s=n;if(s.length<Be){De(null);return}if(V(s)&&s!==b.current){b.current=s,ot(s);return}mt.current=setTimeout(()=>{const l=E(n);V(l)&&l!==b.current&&(b.current=l,ot(l))},Qe)},Ye=()=>{const e=E(r.phone);e.length<Be||V(e)&&e!==b.current&&(b.current=e,ot(e))};useEffect(()=>(H?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[H]);const pt=Array.isArray(r.items)?r.items.length:0;useEffect(()=>{if(!H){_.current=pt;return}pt>_.current&&setTimeout(()=>{const e=j.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),_.current=pt},[H,pt]),useEffect(()=>()=>{mt.current&&(clearTimeout(mt.current),mt.current=null)},[]),useEffect(()=>{te()},[]),useEffect(()=>{ze||B()},[i,ze]),useEffect(()=>{xe()},[]),useEffect(()=>{M&&Et.current!==M&&(Et.current=M,He(w))},[M]);const Rt=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",It=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",ht=React.useMemo(()=>window.KTM.orders.sortOrders(ee),[ee]),jt=React.useMemo(()=>window.KTM.orders.sortOrders(N),[N]),Pt=React.useMemo(()=>{const n=(Array.isArray(jt)?jt:[]).filter(a=>kt(a));return n.sort((a,s)=>{const l=new Date(a==null?void 0:a.created_at).getTime(),f=new Date(s==null?void 0:s.created_at).getTime();return(Number.isFinite(l)?l:0)-(Number.isFinite(f)?f:0)}),n},[jt]),Vt=React.useMemo(()=>{const n=(Array.isArray(ve)?ve:[]).filter(a=>v(a));return n.sort((a,s)=>{const l=new Date(a==null?void 0:a.created_at).getTime(),f=new Date(s==null?void 0:s.created_at).getTime();return(Number.isFinite(l)?l:0)-(Number.isFinite(f)?f:0)}),n},[ve]),Ct=React.useMemo(()=>q?Pt:ht,[q,Pt,ht]),T=React.useMemo(()=>{if(q)return Ct;const e=String(A||"").trim();return e?(Array.isArray(Ct)?Ct:[]).filter(n=>String((n==null?void 0:n.status)||"").trim()===e):Ct},[Ct,A,q]),S=React.useMemo(()=>window.KTM.orders.sortOrders(ye),[ye]),L=React.useMemo(()=>ze?S:T,[T,ze,S]),X=e=>window.KTM.date.formatDateTime(e),te=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Ot(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Ot([])}},B=async()=>{oe(!0);try{let e=`${API_BASE}/api/orders`;i&&(e+=`?month=${i}`);const n=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");Y(Array.isArray(n)?n:[]),xe()}catch(e){console.error("Load orders error:",e),Y([])}finally{oe(!1)}},Ne=async e=>{const n=String(e||"").trim();if(!n){fe([]),he(""),Ae(!1);return}const a=++it.current;Ae(!0),he("");try{const s=`${API_BASE}/api/orders?search=${encodeURIComponent(n)}`,l=await window.KTM.api.getJSON(s,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(it.current!==a)return;fe(Array.isArray(l)?l:[])}catch(s){if(it.current!==a)return;console.error("Order search error:",s),fe([]),he((s==null?void 0:s.message)||"Search l\u1ED7i")}finally{if(it.current!==a)return;Ae(!1)}};useEffect(()=>{Ee.current&&(clearTimeout(Ee.current),Ee.current=null);const e=String(Se||"").trim();if(!e){fe([]),he(""),Ae(!1);return}return q&&Z(!1),Ee.current=setTimeout(()=>{Ne(e)},200),()=>{Ee.current&&(clearTimeout(Ee.current),Ee.current=null)}},[Se]);const xe=async()=>{me(!0),pe(!0);try{const[e,n]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(ut)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(_t)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);K(Array.isArray(e)?e:[]),re(Array.isArray(n)?n:[])}catch(e){console.error("Load all orders error:",e),K([]),re([])}finally{me(!1),pe(!1)}},Re=e=>{var a;wt(e.id);const n=Array.isArray(e.items)&&e.items.length?e.items.map(s=>{var l,f,R,C;return{product_id:(s==null?void 0:s.product_id)||"",quantity:Number((l=s==null?void 0:s.quantity)!=null?l:1)||1,unit_price:(()=>{var h;const d=(h=s==null?void 0:s.unit_price)!=null?h:s==null?void 0:s.unitPrice,o=d==null||d===""?NaN:Number(d);return Number.isFinite(o)?Math.trunc(o):null})(),variant:String((f=s==null?void 0:s.variant)!=null?f:"").trim(),variant_json:(C=(R=s==null?void 0:s.variant_json)!=null?R:s==null?void 0:s.variantJson)!=null?C:null}}).filter(s=>s.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1,unit_price:null,variant:"",variant_json:null}];U({customer_name:e.customer_name||"",phone:E(e.phone||""),address:e.address||"",note:(e==null?void 0:e.note)||"",items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:Number((a=e==null?void 0:e.adjustment_amount)!=null?a:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),Ue(new Array(n.length?n.length:1).fill("")),x(new Array(n.length?n.length:1).fill(!0)),De(null),z(!0),e.phone&&ot(E(e.phone))};function He(e){wt(null),D(e||""),g(!1),x([]),z(!0)}const nt=()=>{ie||u||(z(!1),wt(null),D(""),g(!1),x([]))},gt=async()=>{var C,d,o;if(!Te||u||ie)return;const e=(Array.isArray(ee)?ee:[]).find(h=>String(h==null?void 0:h.id)===String(Te))||null,n=String((e==null?void 0:e.status)||(r==null?void 0:r.status)||"").trim();if(n==="done"||n==="paid"||n==="canceled"){const h="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof I=="function"?I(h,"warning"):alert(h);return}const a=E(r.phone),l=(Array.isArray(r.items)?r.items:[]).map((h,P)=>{var F,se;return{idx:P,product_id:String((h==null?void 0:h.product_id)||"").trim(),quantity:Number((F=h==null?void 0:h.quantity)!=null?F:0),variant:String((h==null?void 0:h.variant)||"").trim()||null,variant_json:(se=h==null?void 0:h.variant_json)!=null?se:null,unit_price:(()=>{const ue=h==null?void 0:h.unit_price,Ve=ue===""||ue==null?NaN:Number(ue);if(Number.isFinite(Ve))return Math.max(0,Math.trunc(Ve));const Le=Tt(h==null?void 0:h.product_id),st=h!=null&&h.variant_json&&typeof h.variant_json=="object"?h.variant_json:null;return Wt(Le,st)})()}}).filter(h=>h.product_id&&Number.isFinite(h.quantity)&&h.quantity>0);if(l.length<2){const h="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof I=="function"?I(h,"warning"):alert(h);return}const f=[],R=[];for(const h of l){const P=!!ge[h.idx],F={product_id:h.product_id,quantity:h.quantity,unit_price:h.unit_price,variant:h.variant,variant_json:h.variant_json};P?f.push(F):R.push(F)}if(!f.length||!R.length){const h="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof I=="function"?I(h,"warning"):alert(h);return}O(!0);try{const h=W(r.adjustment_amount),P=(r.adjustment_note||"").trim(),F={customer_name:r.customer_name,phone:a,address:r.address,note:(r.note||"").trim(),adjustment_amount:h,adjustment_note:P,status:"processing",items:f,product_id:f[0].product_id,quantity:f[0].quantity,split_seq:1},se=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,F,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),ue=(o=(d=se==null?void 0:se.id)!=null?d:(C=se==null?void 0:se.order)==null?void 0:C.id)!=null?o:null;if(!ue)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const Ve={id:Te,customer_name:r.customer_name,phone:a,address:r.address,note:(r.note||"").trim(),adjustment_amount:0,adjustment_note:"",status:"pending",items:R,product_id:R[0].product_id,quantity:R[0].quantity,parent_order_id:String(ue),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${Te}`,Ve,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),nt(),B();const Le=ue?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${ue}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof I=="function"?I(Le,"success"):alert(Le)}catch(h){console.error(h);const P=(h==null?void 0:h.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof I=="function"?I(P,"danger"):alert(P)}finally{O(!1)}},vt=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const n=String(e),a=et.find(s=>String(s==null?void 0:s.id)===n);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Ze=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(n){return String(e!=null?e:"").toLowerCase()}},yt=e=>{const a=Ze(e).trim().split(/\s+/).filter(Boolean),s=a.join(" ");return{contentTokens:a,cleanedQuery:s}},At=React.useMemo(()=>(Array.isArray(et)?et:[]).map((e,n)=>{var o,h,P,F,se,ue;const a=Ze((o=e==null?void 0:e.name)!=null?o:""),s=Ze((h=e==null?void 0:e.code)!=null?h:""),l=Ze((P=e==null?void 0:e.category)!=null?P:""),f=Ze((F=e==null?void 0:e.note)!=null?F:""),R=Ze((se=e==null?void 0:e.id)!=null?se:""),C=Ze((ue=e==null?void 0:e.stt)!=null?ue:""),d=`${a} ${s} ${l} ${f} ${R} ${C}`.trim();return{p:e,originalIndex:n,name:a,code:s,category:l,note:f,haystackAll:d}}),[et]),Mt=(e,n,a)=>{var P,F,se,ue,Ve;const s=Array.isArray(n)?n:[],l=Ze(a).trim();if(!s.length&&!l)return 0;const f=(P=e==null?void 0:e.name)!=null?P:"",R=(F=e==null?void 0:e.code)!=null?F:"",C=(se=e==null?void 0:e.category)!=null?se:"",d=(ue=e==null?void 0:e.note)!=null?ue:"";if(!((Ve=e==null?void 0:e.haystackAll)!=null?Ve:""))return 0;let h=0;l&&(f===l&&(h+=220),f.includes(l)&&(h+=140),f.startsWith(l)&&(h+=160),R&&R===l&&(h+=180),R&&R.includes(l)&&(h+=90));for(const Le of s){if(!Le)continue;const st=new RegExp(`(?:^|\\s)${Le.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);f.includes(Le)&&(h+=35),st.test(f)&&(h+=25),R&&R.includes(Le)&&(h+=20),R&&st.test(R)&&(h+=10),C&&C.includes(Le)&&(h+=12),d&&d.includes(Le)&&(h+=6)}return h>0&&f&&(h+=Math.max(0,10-Math.min(10,Math.floor(f.length/10)))),h},Nt=(e,n)=>{const a=String(e||""),s=String(n||"");if(a===s)return 0;if(!a)return s.length;if(!s)return a.length;const l=a.length,f=s.length;if(f>l)return Nt(s,a);let R=new Array(f+1),C=new Array(f+1);for(let d=0;d<=f;d++)R[d]=d;for(let d=1;d<=l;d++){C[0]=d;const o=a.charCodeAt(d-1);for(let P=1;P<=f;P++){const F=o===s.charCodeAt(P-1)?0:1;C[P]=Math.min(R[P]+1,C[P-1]+1,R[P-1]+F)}const h=R;R=C,C=h}return R[f]},Ht=(e,n)=>{const a=String(e||"").trim(),s=String(n||"");if(!a||!s)return!1;if(s.includes(a))return!0;const l=s.split(/\s+/).filter(Boolean);if(!l.length)return!1;const f=a.length<=4?1:2;for(const R of l)if(!(Math.abs(R.length-a.length)>f)&&Nt(a,R)<=f)return!0;return!1},$t=e=>{const n=Ze(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return n?n.split(" ").filter(Boolean):[]},Ut=(e,n)=>{const a=Array.isArray(n)?n:[];if(!a.length)return 0;const s=$t((e==null?void 0:e.name)||""),l=$t((e==null?void 0:e.code)||""),f=$t((e==null?void 0:e.category)||""),R=$t((e==null?void 0:e.note)||""),C=(o,h,P)=>{const F=String(o||"").trim();if(!F||!h.length)return 0;const se=F.length<=4?1:2;let ue=1/0,Ve=-1;for(let We=0;We<h.length;We++){const bt=h[We];if(!bt||Math.abs(bt.length-F.length)>se)continue;const ft=Nt(F,bt);if(ft<ue&&(ue=ft,Ve=We,ft===0))break}if(ue===1/0||ue>se)return 0;let st=Math.round(P*(ue===0?1:ue===1?.65:.45));return Ve===0?st+=Math.round(P*.25):Ve===1&&(st+=Math.round(P*.12)),st};let d=0;for(const o of a){if(!o)continue;const h=C(o,s,180),P=C(o,l,120),F=C(o,f,60),se=C(o,R,30);d+=Math.max(h,P,F,se)}if(d>0){const o=((e==null?void 0:e.name)||"").length;d+=Math.max(0,60-Math.min(60,Math.floor(o/2)))}return d},zt=React.useRef(new Map);React.useEffect(()=>{zt.current=new Map},[et]);const Gt=e=>{var o,h;const n=String($e[e]||"").trim();if(!n)return et;const{contentTokens:a,cleanedQuery:s}=yt(n);if(a.length===0)return et;const l=Ze(n).trim(),f=zt.current.get(l);if(f)return f;const R=[];for(const P of At){const F=P.haystackAll;F&&a.some(se=>F.includes(se))&&R.push(P)}let C=R;if(C.length<8&&a.length>0){const P=[],F=new Set(C.map(se=>{var ue,Ve;return String((Ve=(ue=se.p)==null?void 0:ue.id)!=null?Ve:"")+":"+String(se.originalIndex)}));for(const se of At){const ue=String((h=(o=se.p)==null?void 0:o.id)!=null?h:"")+":"+String(se.originalIndex);if(F.has(ue))continue;const Ve=se.haystackAll;Ve&&a.some(Le=>Ht(Le,Ve))&&(P.push(se),F.add(ue))}P.length&&(C=C.concat(P))}const d=C.map(P=>({entry:P,score:Mt(P,a,s)})).map(P=>{if(P.score>0)return P;const F=Ut(P.entry,a);return F>0?{...P,score:F}:P}).filter(P=>P.score>0).sort((P,F)=>F.score!==P.score?F.score-P.score:P.entry.originalIndex-F.entry.originalIndex).slice(0,40).map(P=>P.entry.p);return zt.current.set(l,d),d},Tt=e=>{if(!e)return null;const n=String(e);return et.find(a=>String(a==null?void 0:a.id)===n)||null},Jt=e=>{if(e==null||e==="")return[];let n=e;if(typeof n=="string"){const a=n.trim();if(!a)return[];try{n=JSON.parse(a)}catch(s){return[]}}return Array.isArray(n)?n.map((a,s)=>{var R;if(!a||typeof a!="object")return null;const l=String((R=a.name)!=null?R:"").trim()||`Bi\u1EBFn th\u1EC3 ${s+1}`,f=(Array.isArray(a.options)?a.options:[]).map(C=>{var Ve,Le,st,We,bt,ft,Pe;if(!C||typeof C!="object")return null;const d=String((Ve=C.label)!=null?Ve:"").trim();if(!d)return null;const o=(bt=(We=(st=(Le=C.price)!=null?Le:C.priceValue)!=null?st:C.unit_price)!=null?We:C.unitPrice)!=null?bt:null,h=o==null||o===""?NaN:typeof o=="number"?o:typeof o=="string"?J(o):Number(o),P=Number.isFinite(h)?Math.trunc(h):null,F=(Pe=(ft=C.price_delta)!=null?ft:C.priceDelta)!=null?Pe:null,se=Number(F),ue=Number.isFinite(se)?Math.trunc(se):0;return{label:d,price:P,price_delta:ue}}).filter(Boolean);return{name:l,options:f}}).filter(Boolean):[]},xa=e=>{const n=Tt(e);return Jt(n==null?void 0:n.variants)},oa=e=>{if(!e||typeof e!="object")return"";const n=[];for(const[a,s]of Object.entries(e)){const l=String(a||"").trim(),f=String(s||"").trim();!l||!f||n.push(`${l}: ${f}`)}return n.join(", ")},Wt=(e,n)=>{const a=J(e==null?void 0:e.price),s=Jt(e==null?void 0:e.variants);if(!s.length||!n||typeof n!="object")return a;let l=a,f=!1;for(const R of s){const C=String((R==null?void 0:R.name)||"").trim(),d=String((n==null?void 0:n[C])||"").trim();if(!C||!d)continue;const o=(Array.isArray(R.options)?R.options:[]).find(ue=>String((ue==null?void 0:ue.label)||"").trim()===d);if(!o)continue;const h=o==null?void 0:o.price,P=h==null||h===""?NaN:Number(h);if(Number.isFinite(P)){l=Math.max(0,Math.trunc(P)),f=!0;continue}const F=o==null?void 0:o.price_delta,se=F==null||F===""?NaN:Number(F);Number.isFinite(se)&&(l+=Math.trunc(se))}return l},ta=e=>window.KTM.orders.getOrderItems(e),ba=e=>window.KTM.orders.getOrderTotalQty(e),Xt=e=>window.KTM.orders.getOrderProductSummary(e,Tt),aa=e=>window.KTM.orders.getOrderItemRows(e,Tt),na=e=>window.KTM.orders.getOrderAdjustmentMoney(e),fa=e=>{const n=ta(e),a=aa(e),s=Yt(n),l=Qt(n),f=l.fee,R=na(e),C=s+f+R,d=[];if(e!=null&&e.customer_name&&d.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&d.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&d.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&d.push(`GHI CH\xDA: ${(e.note||"").trim()}`),d.push(""),d.push("S\u1EA2N PH\u1EA8M:"),a.length)for(const o of a)d.push(`- ${o.name} (SL: ${o.qty})`);else{const o=Xt(e);o&&o!=="\u2014"&&d.push(`- ${o}`)}d.push(""),d.push(`T\u1EA0M T\xCDNH: ${y(s)}`),l.found&&f!==0&&d.push(`SHIP: ${y(f)}`);{const o=String((e==null?void 0:e.adjustment_note)||"").trim();(R!==0||o)&&d.push(`\u0110I\u1EC0U CH\u1EC8NH: ${y(R)}${o?` (${o})`:""}`)}return d.push(`T\u1ED4NG: ${y(C)}`),d.filter(Boolean).join(`
`)},la=async e=>{try{const n=fa(e);await window.KTM.clipboard.writeText(n),typeof I=="function"?I("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(n){console.error(n),typeof I=="function"?I("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Qt=e=>window.KTM.orders.getOrderShipInfo(e,Tt),Yt=e=>window.KTM.orders.getItemsSubtotal(e,Tt),sa=e=>{try{const n=e instanceof Date?e:new Date(e);if(!n||Number.isNaN(n.getTime()))return"";const a=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0");return`${a}-${s}`}catch(n){return""}},ia=()=>i?String(i):sa(new Date),ca=e=>{const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=E((e==null?void 0:e.phone)||""),s=String((e==null?void 0:e.address)||"").trim().toLowerCase(),l=W(e==null?void 0:e.adjustment_amount),R=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(C=>{var d;return{product_id:String((C==null?void 0:C.product_id)||"").trim(),quantity:Number((d=C==null?void 0:C.quantity)!=null?d:0),variant:String((C==null?void 0:C.variant)||"").trim()}}).filter(C=>C.product_id&&Number.isFinite(C.quantity)&&C.quantity>0).sort((C,d)=>C.product_id<d.product_id?-1:C.product_id>d.product_id?1:C.variant<d.variant?-1:C.variant>d.variant?1:C.quantity-d.quantity);return JSON.stringify({name:n,phone:a,address:s,items:R,adj:l})},Lt=React.useMemo(()=>{const e=E((r==null?void 0:r.phone)||"");if(!e)return{count:0,orders:[],monthKey:ia()};const n=ia(),a=(Array.isArray(ee)?ee:[]).filter(s=>{if(!s||Te&&String(s.id)===String(Te)||E(s.phone||"")!==e)return!1;const l=sa(s.created_at);return l&&l===n}).sort((s,l)=>{const f=new Date(s.created_at).getTime(),R=new Date(l.created_at).getTime();return(Number.isFinite(R)?R:0)-(Number.isFinite(f)?f:0)});return{count:a.length,orders:a,monthKey:n}},[ee,r==null?void 0:r.phone,i,Te]),ga=e=>{var C;const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=E((e==null?void 0:e.phone)||""),s=String((e==null?void 0:e.address)||"").trim().toLowerCase(),l=W((C=e==null?void 0:e.adjustment_amount)!=null?C:0),f=ta(e),R=(Array.isArray(f)?f:[]).map(d=>{var o;return{product_id:String((d==null?void 0:d.product_id)||"").trim(),quantity:Number((o=d==null?void 0:d.quantity)!=null?o:0),variant:String((d==null?void 0:d.variant)||"").trim()}}).filter(d=>d.product_id&&Number.isFinite(d.quantity)&&d.quantity>0).sort((d,o)=>d.product_id<o.product_id?-1:d.product_id>o.product_id?1:d.variant<o.variant?-1:d.variant>o.variant?1:d.quantity-o.quantity);return JSON.stringify({name:n,phone:a,address:s,items:R,adj:l})},da=React.useMemo(()=>{if(Te)return"";const e=E((r==null?void 0:r.phone)||"");if(!e)return"";const n=ia(),a=ca(r),s=Array.isArray(ee)?ee:[];for(const l of s){if(!l||Te&&String(l.id)===String(Te)||E(l.phone||"")!==e)continue;const f=sa(l.created_at);if(!f||f!==n)continue;const R=ga(l);if(R&&R===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${n}${l!=null&&l.id?` (#${l.id})`:""}`}return""},[ee,r,i,Te]),ma=e=>{var st;const n=[],a=[],s=String((e==null?void 0:e.customer_name)||"").trim(),l=E((e==null?void 0:e.phone)||""),f=String((e==null?void 0:e.address)||"").trim();s||n.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),l||n.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),l&&!V(l)&&n.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),f||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const C=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(We=>We&&We.product_id);C.length===0&&n.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),C.some(We=>{var ft;const bt=Number((ft=We==null?void 0:We.quantity)!=null?ft:0);return!Number.isFinite(bt)||bt<=0})&&n.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const o=new Set;let h=!1;for(const We of C){const bt=String(We.product_id||"").trim(),ft=String((We==null?void 0:We.variant)||"").trim();if(!bt)continue;const Pe=`${bt}||${ft}`;if(o.has(Pe)){h=!0;break}o.add(Pe)}h&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const P=Yt(C),F=Qt(C),se=F!=null&&F.found?Number((st=F==null?void 0:F.fee)!=null?st:0):0,ue=W(e==null?void 0:e.adjustment_amount),Ve=String((e==null?void 0:e.adjustment_note)||"").trim();F!=null&&F.found&&(se>=2e5||P>0&&se>P*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${y(se)}`),ue!==0&&!Ve&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Le=Math.abs(ue);return(Le>=5e5||P>0&&Le>P*.5)&&ue!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${y(ue)}`),{errors:n,warnings:a,canSubmit:n.length===0}},ka=React.useMemo(()=>ma(r),[r,et]),ct=React.useMemo(()=>{var ft;const e=String((r==null?void 0:r.customer_name)||"").trim(),n=E((r==null?void 0:r.phone)||""),a=String((r==null?void 0:r.address)||"").trim(),s=Array.isArray(r==null?void 0:r.items)?r.items:[],l=new Map;for(const Pe of s){const Bt=String((Pe==null?void 0:Pe.product_id)||"").trim(),Zt=String((Pe==null?void 0:Pe.variant)||"").trim();if(!Bt)continue;const ea=`${Bt}||${Zt}`;l.set(ea,(l.get(ea)||0)+1)}const f=s.map(Pe=>{var ha;const Bt=String((Pe==null?void 0:Pe.product_id)||"").trim(),Zt=Number((ha=Pe==null?void 0:Pe.quantity)!=null?ha:0),ea=Bt?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",va=Number.isFinite(Zt)&&Zt>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",ya=String((Pe==null?void 0:Pe.variant)||"").trim(),Na=`${Bt}||${ya}`,wa=Bt&&(l.get(Na)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:ea,qtyError:va,dupWarn:wa}}),R=s.filter(Pe=>Pe&&Pe.product_id),C=Yt(R),d=Qt(R),o=d!=null&&d.found?Number((ft=d==null?void 0:d.fee)!=null?ft:0):0,h=W(r==null?void 0:r.adjustment_amount),P=String((r==null?void 0:r.adjustment_note)||"").trim(),F=Math.abs(h),se=h!==0&&!P?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ue=h!==0&&(F>=5e5||C>0&&F>C*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${y(h)}`:"",Ve=d!=null&&d.found&&(o>=2e5||C>0&&o>C*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${y(o)}`:"",Le=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",st=n?V(n)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",We=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",bt=!Le&&!st&&f.every(Pe=>!Pe.productError&&!Pe.qtyError);return{nameError:Le,phoneError:st,addressWarn:We,items:f,shipAbnormalWarn:Ve,adjustmentNoteWarn:se,adjustmentAbnormalWarn:ue,canSubmit:bt}},[r,et]),ua=async e=>{var R,C,d;const n=(e==null?void 0:e.mode)||"close",a=ma(r);if(!a.canSubmit){const o=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof I=="function"?I(o,"danger"):alert(o);return}if(!Te&&da){const o=`${da}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(o)){(Lt==null?void 0:Lt.count)>0&&g(!0),setTimeout(()=>{var F;const P=document.getElementById("order-phone-input");P&&typeof P.scrollIntoView=="function"&&(P.scrollIntoView({block:"center",behavior:"smooth"}),(F=P.focus)==null||F.call(P))},0);return}}const s=E(r.phone),f=(Array.isArray(r.items)?r.items:[]).map(o=>{var h,P;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((h=o==null?void 0:o.quantity)!=null?h:1),variant:String((o==null?void 0:o.variant)||"").trim()||null,variant_json:(P=o==null?void 0:o.variant_json)!=null?P:null,unit_price:(()=>{const F=o==null?void 0:o.unit_price,se=F===""||F==null?NaN:Number(F);if(Number.isFinite(se))return Math.max(0,Math.trunc(se));const ue=Tt(o==null?void 0:o.product_id),Ve=o!=null&&o.variant_json&&typeof o.variant_json=="object"?o.variant_json:null;return Wt(ue,Ve)})()}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0);_e(!0);try{const o=Te?`${API_BASE}/api/orders/${Te}`:`${API_BASE}/api/orders`,h=f[0],P={customer_name:r.customer_name,phone:s,address:r.address,note:(r.note||"").trim(),adjustment_amount:W(r.adjustment_amount),adjustment_note:(r.adjustment_note||"").trim(),product_id:h.product_id,quantity:h.quantity,status:r.status,items:f,...Te?{id:Te}:{}};if(Te)await window.KTM.api.putJSON(o,P,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const F=await window.KTM.api.postJSON(o,P,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Fe.current={id:(d=(C=F==null?void 0:F.id)!=null?C:(R=F==null?void 0:F.order)==null?void 0:R.id)!=null?d:null,fingerprint:ca(r),ts:Date.now()}}Ge(s,r.customer_name,r.address),n==="new"&&!Te?(D(""),wt(null),z(!0)):(D(""),wt(null),z(!1)),B()}catch(o){console.error(o),typeof I=="function"?I(o.message,"danger"):alert(o.message);return}finally{_e(!1)}},ra=e=>window.KTM.orders.getOrderTotalMoney(e,Tt),pa=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){ke(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),B(),xe()}catch(n){console.error(n),typeof I=="function"?I(n.message,"danger"):alert(n.message)}finally{ke(null)}}},Kt=async(e,n)=>{var s;const a=e==null?void 0:e.id;if(!(!a||!n)){Je(a);try{const l=ta(e),f=(Array.isArray(l)?l:[]).map(d=>{var o,h;return{product_id:(d==null?void 0:d.product_id)||"",quantity:Number((o=d==null?void 0:d.quantity)!=null?o:1),variant:String((d==null?void 0:d.variant)||"").trim()||null,variant_json:(h=d==null?void 0:d.variant_json)!=null?h:null,unit_price:(()=>{var se;const P=(se=d==null?void 0:d.unit_price)!=null?se:d==null?void 0:d.unitPrice,F=Number(P);return Number.isFinite(F)?Math.max(0,Math.trunc(F)):null})()}}).filter(d=>d.product_id&&Number.isFinite(d.quantity)&&d.quantity>0);if(!f.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const R=f[0],C={id:a,customer_name:(e==null?void 0:e.customer_name)||"",phone:E((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",note:((e==null?void 0:e.note)||"").trim(),adjustment_amount:Number((s=e==null?void 0:e.adjustment_amount)!=null?s:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:R.product_id,quantity:R.quantity,status:n,items:f};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${a}`,C,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),Y(d=>Array.isArray(d)?d.map(o=>(o==null?void 0:o.id)===a?{...o,status:n}:o):d),K(d=>Array.isArray(d)?d.map(o=>(o==null?void 0:o.id)===a?{...o,status:n}:o):d),typeof I=="function"&&I("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(l){console.error(l),typeof I=="function"?I(l.message,"danger"):alert(l.message)}finally{Je(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:ne&&!H&&!ze||Ce&&!H||ie||!!Me||!!we}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:He,disabled:ie||!!Me},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:i,onChange:e=>p(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:q||ze}),i&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{p("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:ne||ze},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:A,onChange:e=>$(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:q||ze},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),A&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>$(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:ne||ze},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:q,onChange:e=>{if(ze)return;const n=!!e.target.checked;Z(n),n&&$("pending")},disabled:ze}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",ut," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label mb-1"},"Search (t\xEAn / S\u0110T)"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{type:"text",className:"form-control",value:Se,onChange:e=>le(e.target.value),placeholder:"Nh\u1EADp t\xEAn ho\u1EB7c S\u0110T...","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(Se||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>le(""),title:"X\xF3a search","aria-label":"X\xF3a search",disabled:Ce},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"text-muted small mt-1"},"Search s\u1EBD ra to\xE0n b\u1ED9 data, b\u1ECF qua filter")),React.createElement("div",{className:"col-12 col-md-2 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>ze?Ne(Se):B(),disabled:ne||Ce},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},ze?`${L.length} k\u1EBFt qu\u1EA3`:A?`${T.length}/${ee.length} \u0111\u01A1n`:`${ee.length} \u0111\u01A1n`)),ze&&Oe&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Oe),Pt.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Pt.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",ut," ng\xE0y.",Q&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Z(!0),$("pending")}},"Xem ngay")),Vt.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,Vt.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",_t," ng\xE0y).",ce&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Z(!1),$("draft"),p(""),B()}},"Xem ngay")),(ze?Ce:ne)?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):(ze?L.length===0:ee.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},ze?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!ze&&T.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},L.map(e=>{var n;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((n=e==null?void 0:e.split_seq)!=null?n:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${It(e.status)}`},Rt(e.status)),kt(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ut} ng\xE0y`},"\u26A0 Ch\u1EADm ",xt(e),"d"),v(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Dt} ng\xE0y`},"\u23F3 C\xF2n ",t(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=aa(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((s,l)=>React.createElement("div",{key:l,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},l+1,"."),s.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",s.qty,Number(s.unitPrice)>0?` \u2022 ${y(s.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Xt(e))})()),(na(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},y(na(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},y(ra(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",X(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary flex-fill",onClick:()=>Re(e),disabled:ie||!!Me||we===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>la(e),disabled:ie||!!Me||we===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger flex-fill",onClick:()=>pa(e.id),disabled:ie||Me===e.id||we===e.id},Me===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>Kt(e,"processing"),disabled:ie||!!Me||we===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>Kt(e,"done"),disabled:ie||!!Me||we===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>Kt(e,"paid"),disabled:ie||!!Me||we===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:()=>Kt(e,"canceled"),disabled:ie||!!Me||we===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,L.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const n=aa(e);return n.length?React.createElement("div",{className:"d-grid gap-1"},n.map((a,s)=>React.createElement("div",{key:s,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},s+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",y(a.unitPrice))))):Xt(e)})()),React.createElement("td",null,ba(e)),React.createElement("td",{className:"fw-semibold"},y(ra(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${It(e.status)}`},Rt(e.status)),kt(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${ut} ng\xE0y`},"\u26A0 Ch\u1EADm ",xt(e),"d"),v(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Dt} ng\xE0y`},"\u23F3 C\xF2n ",t(e),"d"))),React.createElement("td",null,X(e.created_at)),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary me-1",onClick:()=>Re(e),disabled:ie||!!Me||we===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>la(e),disabled:ie||!!Me||we===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>Kt(e,"processing"),disabled:ie||!!Me||we===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>Kt(e,"done"),disabled:ie||!!Me||we===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>Kt(e,"paid"),disabled:ie||!!Me||we===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:()=>Kt(e,"canceled"),disabled:ie||!!Me||we===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>pa(e.id),disabled:ie||Me===e.id},Me===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))))))),H&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),Te?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:nt})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),ua({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:j},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:r.customer_name,onChange:e=>U({...r,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!ct.nameError&&React.createElement("div",{className:"form-text text-danger"},ct.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:r.phone,onChange:e=>at(e.target.value),onBlur:Ye,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!ct.phoneError&&React.createElement("div",{className:"form-text text-danger"},ct.phoneError),!ct.phoneError&&Lt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Lt.count," \u0111\u01A1n trong th\xE1ng ",Lt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>g(e=>!e)},c?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),c&&Lt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>g(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Lt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${It(e.status)}`},Rt(e.status))),React.createElement("div",{className:"text-muted small"},X(e.created_at)," \u2022 ",y(ra(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Xt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Re(e)}},"M\u1EDF")))),Lt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(de==null?void 0:de.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(de==null?void 0:de.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(de==null?void 0:de.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(de==null?void 0:de.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:r.status,onChange:e=>U({...r,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:r.address,onChange:e=>U({...r,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!ct.addressWarn&&React.createElement("div",{className:"form-text text-warning"},ct.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:r.note,onChange:e=>U({...r,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:r.adjustment_amount,onChange:e=>U({...r,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!ct.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},ct.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:r.adjustment_note,onChange:e=>U({...r,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!ct.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},ct.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{U(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Ue(e=>[...Array.isArray(e)?e:[],""]),Te&&x(e=>[...Array.isArray(e)?e:[],!0])},disabled:ie},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(r.items)?r.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{Xe.current[n]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{je(a=>a===n?null:n),setTimeout(()=>{const a=document.getElementById(`order-product-search-${n}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},vt(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Ke===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:$e[n]||"",onChange:a=>{const s=a.target.value;Ue(l=>{const f=Array.isArray(l)?[...l]:[];return f[n]=s,f})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=Gt(n);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(s=>React.createElement("button",{key:s.id,type:"button",className:"dropdown-item",onClick:()=>{const l=String(s.id),f=Jt(s==null?void 0:s.variants),R={};for(const o of f){const h=String((o==null?void 0:o.name)||"").trim(),P=Array.isArray(o==null?void 0:o.options)?o.options[0]:null,F=String((P==null?void 0:P.label)||"").trim();h&&F&&(R[h]=F)}const C=oa(R),d=Wt(s,R);U(o=>{const h=Array.isArray(o.items)?[...o.items]:[];return h[n]={...h[n]||{quantity:1},product_id:l,variant_json:Object.keys(R).length?R:null,variant:C,unit_price:f.length?d:null},{...o,items:h}}),je(null)}},s.name,s.code?` (${s.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),et.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var s;const a=(s=ct.items)==null?void 0:s[n];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const a=Tt(e.product_id),s=Jt(a==null?void 0:a.variants);if(!s.length)return null;const l=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},s.map((f,R)=>{const C=String((f==null?void 0:f.name)||`Bi\u1EBFn th\u1EC3 ${R+1}`).trim(),d=String((l==null?void 0:l[C])||"").trim();return React.createElement("div",{key:C},React.createElement("label",{className:"form-label small text-muted mb-1"},C),React.createElement("select",{className:"form-select",value:d,onChange:o=>{const h=String(o.target.value||"").trim();U(P=>{const F=Array.isArray(P.items)?[...P.items]:[],se={...F[n]||{}},ue=Tt(se.product_id),Ve=Jt(ue==null?void 0:ue.variants),Le=se!=null&&se.variant_json&&typeof se.variant_json=="object"?{...se.variant_json}:{};h?Le[C]=h:delete Le[C];const st=oa(Le),We=Wt(ue,Le);return F[n]={...se,variant_json:Object.keys(Le).length?Le:null,variant:st,unit_price:We},{...P,items:F}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",C," --"),(Array.isArray(f==null?void 0:f.options)?f.options:[]).map(o=>React.createElement("option",{key:o.label,value:o.label},o.label,Number.isFinite(Number(o==null?void 0:o.price))?` (${y(Number(o.price))})`:Number(o==null?void 0:o.price_delta)?` (${o.price_delta>0?"+":""}${o.price_delta})`:""))))}))})(),Te&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!ge[n],onChange:a=>{const s=!!a.target.checked;x(l=>{const f=Array.isArray(l)?[...l]:[],R=Array.isArray(r.items)?r.items.length:0;for(;f.length<R;)f.push(!0);return f[n]=s,f})},disabled:ie||u}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const s=a.target.value;U(l=>{const f=Array.isArray(l.items)?[...l.items]:[];return f[n]={...f[n]||{product_id:""},quantity:s},{...l,items:f}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var s;const a=(s=ct.items)==null?void 0:s[n];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{U(a=>{const s=Array.isArray(a.items)?[...a.items]:[];return s.splice(n,1),{...a,items:s.length?s:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Ue(a=>{const s=Array.isArray(a)?[...a]:[];return s.splice(n,1),s.length?s:[""]}),x(a=>{const s=Array.isArray(a)?[...a]:[];return s.splice(n,1),s}),je(a=>a==null?a:a===n?null:a>n?a-1:a)},disabled:ie||u||(Array.isArray(r.items)?r.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(r.items)?r.items:[]).filter(R=>R==null?void 0:R.product_id),a=Yt(n),s=Qt(n),l=W(r.adjustment_amount),f=a+(s.found?s.fee:0)+l;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},y(a))),s.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},y(s.fee))),!!ct.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},ct.shipAbnormalWarn),l!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},y(l))),(r.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(r.note||"").trim()),(r.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",(r.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},y(f)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:nt,disabled:ie||u,style:{borderRadius:10}},"H\u1EE7y"),!!Te&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:gt,disabled:ie||u,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},u?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!Te&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>ua({mode:"new"}),disabled:ie||!ct.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:ie||u||!ct.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ie?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

