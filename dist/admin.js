const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:y,error:N}){const[$,B]=useState(""),[P,_]=useState(""),[T,ae]=useState(!1),[ne,Y]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),N&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),N),React.createElement("form",{onSubmit:async Te=>{Te.preventDefault(),ae(!0),await y($,P),ae(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:$,onChange:Te=>B(Te.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:ne?"text":"password",className:"form-control",value:P,onChange:Te=>_(Te.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Y(!ne)},React.createElement("i",{className:`fas fa-eye${ne?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:T},T?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:y,type:N,onClose:$,actionLabel:B,onAction:P,durationMs:_}){return useEffect(()=>{const T=Number(_),ae=Number.isFinite(T)&&T>0?T:3e3,ne=setTimeout($,ae);return()=>clearTimeout(ne)},[$,_]),React.createElement("div",{className:`toast show align-items-center text-white bg-${N} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},y),B&&typeof P=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{P()}finally{$()}}},B),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:$})))}function Loading({show:y}){return y?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:y,title:N,subtitle:$,onClose:B,footer:P,children:_}){return useEffect(()=>{if(!y)return;const T=ae=>{ae.key==="Escape"&&(ae.preventDefault(),typeof B=="function"&&B())};return document.addEventListener("keydown",T),()=>document.removeEventListener("keydown",T)},[y,B]),y?React.createElement("div",{className:`admin-drawer-root ${y?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:B,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},N),$?React.createElement("div",{className:"admin-drawer-subtitle"},$):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:B,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},_),P?React.createElement("div",{className:"admin-drawer-footer"},P):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(y){try{const N=localStorage.getItem(y);if(!N)return[];const $=JSON.parse(N);return Array.isArray($)?$.map(B=>String(B||"").trim()).filter(Boolean):[]}catch(N){return[]}}function saveAdminMenuIdsToStorage(y,N){try{localStorage.setItem(y,JSON.stringify(Array.isArray(N)?N:[]))}catch($){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(y){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,y),y}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(y){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,y),y}function Sidebar({activeMenu:y,onMenuChange:N,onLogout:$,currentUser:B,pinnedMenus:P,recentMenus:_,onTogglePin:T}){const ae=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],ne=(B==null?void 0:B.username)||(B==null?void 0:B.name)||(B==null?void 0:B.email)||"Admin",Y=useMemo(()=>{const se=new Map;for(const C of ae)se.set(C.id,C);return se},[]),we=Array.isArray(P)?P:[],Te=Array.isArray(_)?_:[],re=we.map(se=>Y.get(se)).filter(Boolean),pe=Te.filter(se=>se!==y).map(se=>Y.get(se)).filter(Boolean).slice(0,5),je=se=>we.includes(se);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},ne),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},re.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},re.map(se=>React.createElement("a",{key:`pin-${se.id}`,href:"#",className:`nav-link ${y===se.id?"active":""} sidebar-quicklink`,onClick:C=>{C.preventDefault(),N(se.id)}},React.createElement("i",{className:`fas ${se.icon}`})," ",se.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:C=>{C.preventDefault(),C.stopPropagation(),T&&T(se.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),pe.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},pe.map(se=>React.createElement("a",{key:`recent-${se.id}`,href:"#",className:`nav-link ${y===se.id?"active":""} sidebar-quicklink`,onClick:C=>{C.preventDefault(),N(se.id)}},React.createElement("i",{className:`fas ${se.icon}`})," ",se.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),ae.map(se=>React.createElement("a",{key:se.id,href:"#",className:`nav-link ${y===se.id?"active":""} ${se.disabled?"opacity-50":""} ${se.highlight?"text-warning":""}`,onClick:C=>{C.preventDefault(),se.disabled||N(se.id)}},React.createElement("i",{className:`fas ${se.icon}`})," ",se.label,se.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),se.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${je(se.id)?"pinned":""}`,onClick:C=>{C.preventDefault(),C.stopPropagation(),T&&T(se.id)},title:je(se.id)?"B\u1ECF ghim":"Ghim","aria-label":je(se.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),$&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:$,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(y){const N=typeof y=="number"?y:parseFloat(String(y!=null?y:"").trim());return Number.isFinite(N)?Math.max(0,Math.min(100,N)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var y;try{const N=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!N)return{ship_percent:DEFAULT_SHIP_PERCENT};const $=JSON.parse(N);return{ship_percent:normalizeShipPercent((y=$==null?void 0:$.ship_percent)!=null?y:$==null?void 0:$.shipPercent)}}catch(N){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(y){var N;try{const $={ship_percent:normalizeShipPercent((N=y==null?void 0:y.ship_percent)!=null?N:y==null?void 0:y.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify($)),$}catch($){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var N;const y=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((N=y==null?void 0:y.ship_percent)!=null?N:y==null?void 0:y.shipPercent)}}async function saveAdminSettingsToServer(y){var B,P,_;const N={ship_percent:normalizeShipPercent((B=y==null?void 0:y.ship_percent)!=null?B:y==null?void 0:y.shipPercent)},$=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,N,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((_=(P=$==null?void 0:$.ship_percent)!=null?P:$==null?void 0:$.shipPercent)!=null?_:N.ship_percent)}}function AlbumList({albums:y,onSelect:N,onCreate:$,onEdit:B,onDelete:P,loading:_,currentFolder:T,onBack:ae,breadcrumb:ne}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},T&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:ae},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),T?T.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:$},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),ne&&ne.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Y=>{Y.preventDefault(),ae("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ne.map((Y,we)=>React.createElement("li",{key:Y.id,className:`breadcrumb-item ${we===ne.length-1?"active":""}`},we===ne.length-1?Y.title:React.createElement("a",{href:"#",onClick:Te=>{Te.preventDefault(),ae(Y)},className:"text-warning"},Y.title))))),_?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):y.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},T?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},y.map(Y=>React.createElement("div",{key:Y.uuid||Y.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>N(Y)},Y.cover?React.createElement("img",{src:Y.cover,className:"album-cover",alt:Y.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Y.title),React.createElement("small",{className:"text-muted"},Y.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Y.subfolderCount),Y.subfolderCount>0&&Y.count>0&&" \u2022 ",Y.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Y.count),Y.subfolderCount===0&&Y.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:we=>{we.stopPropagation(),B(Y)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:we=>{we.stopPropagation(),P(Y)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:y,album:N,onClose:$,onSave:B,parentId:P}){const[_,T]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[ae,ne]=useState(!1),[Y,we]=useState(!1),Te=useRef(null);useEffect(()=>{T(N?{slug:N.id||"",title:N.title||"",description:N.description||"",cover_url:N.cover||"",parent_id:N.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:P||null})},[N,y,P]);const re=async C=>{C.preventDefault(),ne(!0),await B(_),ne(!1)},pe=C=>C.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),je=async C=>{const Xe=C.type==="image/heic"||C.type==="image/heif"||/\.heic$/i.test(C.name);if(C.size<=2097152&&!Xe)return C;try{const ze=await createImageBitmap(C),ge=document.createElement("canvas");let Me=ze.width,Se=ze.height;const Fe=800;return(Me>Fe||Se>Fe)&&(Me>Se?(Se=Math.round(Se/Me*Fe),Me=Fe):(Me=Math.round(Me/Se*Fe),Se=Fe)),ge.width=Me,ge.height=Se,ge.getContext("2d").drawImage(ze,0,0,Me,Se),ze.close(),new Promise((mt,ke)=>{ge.toBlob(Qe=>{Qe?mt(new File([Qe],C.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ke(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ze){throw console.error("Compress cover error:",ze),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},se=async C=>{var ze;const Ee=C.target.files[0];if(!Ee)return;if(!(Ee.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Ee.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}we(!0);try{const ge=await je(Ee),Me=await window.KTM.cloudinary.uploadImage({file:ge,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Me.secure_url)throw console.error("Cloudinary error:",Me),new Error(((ze=Me.error)==null?void 0:ze.message)||"Upload failed");T(Se=>({...Se,cover_url:Me.secure_url}))}catch(ge){console.error("Cover upload error:",ge),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+ge.message)}we(!1),C.target.value=""};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},N?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:re},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:_.title,onChange:C=>T({..._,title:C.target.value,slug:_.slug||pe(C.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:_.slug,onChange:C=>T({..._,slug:C.target.value}),required:!0,disabled:!!N}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:_.description,onChange:C=>T({..._,description:C.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},_.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:_.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>T(C=>({...C,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:Te,type:"file",accept:"image/*",className:"d-none",onChange:se}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var C;return(C=Te.current)==null?void 0:C.click()},disabled:Y},Y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:_.cover_url,onChange:C=>T({..._,cover_url:C.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:ae||Y},ae?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:y,allAlbums:N,currentAlbumId:$,targetAlbum:B,onSelect:P,level:_=0}){const[T,ae]=useState(!0),ne=y.uuid||y.id,Y=ne===$,we=B===ne,Te=N.filter(pe=>pe.parentId===ne),re=Te.length>0;return React.createElement("div",{style:{marginLeft:_*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${we?"bg-info text-white":Y?"bg-light text-muted":"hover-bg"}`,style:{cursor:Y?"not-allowed":"pointer",opacity:Y?.5:1,transition:"background 0.2s"},onClick:()=>!Y&&P(ne)},re&&React.createElement("i",{className:`fas fa-chevron-${T?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:pe=>{pe.stopPropagation(),ae(!T)}}),!re&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${we?"-open":""} me-2 ${we?"":"text-warning"}`}),React.createElement("span",{className:"small"},y.title),Y&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),y.count>0&&!Y&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},y.count)),T&&re&&React.createElement("div",null,Te.map(pe=>React.createElement(FolderTreeItem,{key:pe.uuid||pe.id,folder:pe,allAlbums:N,currentAlbumId:$,targetAlbum:B,onSelect:P,level:_+1}))))}function AlbumDetail({album:y,onBack:N,onRefresh:$,showToast:B,onNavigateToFolder:P,onEditSubfolder:_,parentAlbum:T}){const[ae,ne]=useState([]),[Y,we]=useState([]),[Te,re]=useState(!0),[pe,je]=useState(!1),[se,C]=useState(""),[Ee,Xe]=useState([]),[ze,ge]=useState([]),[Me,Se]=useState({}),[Fe,tt]=useState(null),[mt,ke]=useState(!1),[Qe,ct]=useState(""),[u,m]=useState(!1),A=useRef(null),z=useRef(null),[X,K]=useState(!1),[H,le]=useState([]),[d,w]=useState([]),[R,Z]=useState(""),[be,ie]=useState(!1),ve=async(x,l=2)=>{const O=l*1024*1024,E=x.type==="image/heic"||x.type==="image/heif"||/\.heic$/i.test(x.name);if(x.size<=O&&!E)return x;try{const he=await createImageBitmap(x),Ce=document.createElement("canvas");let V=he.width,Ve=he.height;const h=1200;return(V>h||Ve>h)&&(V>Ve?(Ve=Math.round(Ve/V*h),V=h):(V=Math.round(V/Ve*h),Ve=h)),Ce.width=V,Ce.height=Ve,Ce.getContext("2d").drawImage(he,0,0,V,Ve),he.close(),new Promise((Ae,et)=>{Ce.toBlob(Tt=>{Tt?Ae(new File([Tt],x.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):et(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(he){throw console.error("Compress error:",he),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{ye(),Je()},[y.id,y.uuid]);const ye=async()=>{re(!0);try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ne(x.images||[]);const l=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");we(Array.isArray(l)?l:[])}catch(x){console.error(x),B("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}re(!1)},Je=async()=>{try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");w(Array.isArray(x)?x:[])}catch(x){console.error("Error loading albums:",x)}},at=x=>{le(l=>l.includes(x)?l.filter(O=>O!==x):[...l,x])},ee=async()=>{if(!R||H.length===0){B("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}ie(!0);let x=0;for(const l of H)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${l}`,{album_id:R},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),x++}catch(O){console.error("Move error:",O)}ie(!1),K(!1),le([]),Z(""),x>0?(B("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),ye(),$()):B("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Ie,lt]=useState(!1),Oe=async()=>{if(H.length===0||!confirm(`X\xF3a ${H.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;lt(!0);let x=0;for(const l of H)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${l}`,"L\u1ED7i x\xF3a \u1EA3nh"),x++}catch(O){console.error("Delete error:",O)}lt(!1),le([]),x>0?(B(`\u0110\xE3 x\xF3a ${x} \u1EA3nh!`,"success"),ye(),$()):B("X\xF3a th\u1EA5t b\u1EA1i","danger")},it=()=>{H.length===ae.length?le([]):le(ae.map(x=>x.id))},bt=async()=>{if(Qe.trim()){m(!0);try{const x=Qe.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:x+"-"+Date.now(),title:Qe,parent_id:y.uuid||y.id},"L\u1ED7i t\u1EA1o folder"),B("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),ct(""),ke(!1),ye(),$()}catch(x){B(x.message,"danger")}m(!1)}},$t=async x=>{if(confirm(`X\xF3a folder "${x.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${x.uuid||x.id}`,"L\u1ED7i x\xF3a folder"),B("\u0110\xE3 x\xF3a folder","success"),ye(),$()}catch(l){B("L\u1ED7i x\xF3a folder","danger")}},vt=x=>{const l=Array.from(x).filter(O=>O.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(O.name));Xe(O=>[...O,...l]),l.forEach(O=>{const E=new FileReader;E.onload=he=>{ge(Ce=>[...Ce,{file:O,preview:he.target.result}])},E.readAsDataURL(O)})},g=x=>{Xe(l=>l.filter((O,E)=>E!==x)),ge(l=>l.filter((O,E)=>E!==x))},L=async x=>{var O;const l=await window.KTM.cloudinary.uploadImage({file:x,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${y.id}`});if(!l.secure_url)throw console.error("Cloudinary error:",l),new Error(((O=l.error)==null?void 0:O.message)||"Upload failed");return l},Re=async()=>{if(Ee.length===0)return;je(!0);let x=0;for(let l=0;l<Ee.length;l++)try{C(`\u0110ang x\u1EED l\xFD ${l+1}/${Ee.length}...`);const O=await ve(Ee[l],2);C(`\u0110ang upload ${l+1}/${Ee.length}...`);const E=await L(O);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${y.id}`,{url:E.secure_url,caption:Me[l]||Ee[l].name.replace(/\.[^/.]+$/,""),sort_order:ae.length+l},"L\u1ED7i l\u01B0u \u1EA3nh"),x++}catch(O){console.error("Upload error:",O)}je(!1),C(""),Xe([]),ge([]),Se({}),x>0?(B(`\u0110\xE3 upload ${x} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),ye(),$()):B("Upload th\u1EA5t b\u1EA1i","danger")},rt=async(x,l)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${x}`,"L\u1ED7i x\xF3a \u1EA3nh"),B("\u0110\xE3 x\xF3a \u1EA3nh","success"),ye(),$()}catch(O){B("L\u1ED7i x\xF3a \u1EA3nh","danger")}},xt=x=>{var l;x.preventDefault(),(l=z.current)==null||l.classList.add("dragover")},De=()=>{var x;(x=z.current)==null||x.classList.remove("dragover")},Ze=x=>{var l;x.preventDefault(),(l=z.current)==null||l.classList.remove("dragover"),vt(x.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:N},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},y.title),React.createElement("small",{className:"text-muted"},Y.length>0&&React.createElement("span",null,Y.length," folder \u2022 "),ae.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>ke(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),mt&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Qe,onChange:x=>ct(x.target.value),onKeyPress:x=>x.key==="Enter"&&bt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:bt,disabled:u||!Qe.trim()},u?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{ke(!1),ct("")}},"H\u1EE7y")))),Y.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Y.map(x=>React.createElement("div",{key:x.uuid||x.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>P&&P(x)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},x.title),React.createElement("small",{className:"text-muted"},x.subfolderCount>0&&React.createElement("span",null,x.subfolderCount," folder"),x.subfolderCount>0&&x.count>0&&" \u2022 ",x.count>0&&React.createElement("span",null,x.count," \u1EA3nh"),x.subfolderCount===0&&x.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:l=>{l.stopPropagation(),_&&_(x)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:l=>{l.stopPropagation(),$t(x)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:z,className:"upload-zone",onClick:()=>{var x;return(x=A.current)==null?void 0:x.click()},onDragOver:xt,onDragLeave:De,onDrop:Ze},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:A,type:"file",multiple:!0,accept:"image/*",onChange:x=>vt(x.target.files)})),ze.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},ze.map((x,l)=>React.createElement("div",{key:l,className:"upload-preview-item"},React.createElement("img",{src:x.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>g(l)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Re,disabled:pe},pe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),se||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Ee.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",ae.length,")"),ae.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:it},H.length===ae.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),H.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},H.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>K(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Oe,disabled:Ie},Ie?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>le([])},React.createElement("i",{className:"fas fa-times"})))),Te?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):ae.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},ae.map((x,l)=>React.createElement("div",{key:l,className:`image-item ${H.includes(x.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>at(x.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:H.includes(x.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:H.includes(x.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},H.includes(x.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:x.src,alt:x.caption,style:{opacity:H.includes(x.id)?.7:1,border:H.includes(x.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:O=>{O.stopPropagation(),rt(x.id,l)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),x.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},x.caption)))))),X&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",H.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>K(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},d.filter(x=>!x.parentId).map(x=>React.createElement(FolderTreeItem,{key:x.uuid||x.id,folder:x,allAlbums:d,currentAlbumId:y.uuid||y.id,targetAlbum:R,onSelect:Z})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>K(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ee,disabled:!R||be},be?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Fe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>tt(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>tt(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Fe.src,alt:Fe.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:x=>x.stopPropagation()}),Fe.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Fe.caption)))))}function SearchCenter({showToast:y,onNavigate:N}){const[$,B]=useState(""),[P,_]=useState([]),[T,ae]=useState([]),[ne,Y]=useState([]),[we,Te]=useState("all"),[re,pe]=useState(null),[je,se]=useState("list"),[C,Ee]=useState(!0),[Xe,ze]=useState([]),[ge,Me]=useState([]),Se=useRef(null),[Fe,tt]=useState(!0),[mt,ke]=useState(!1),Qe=useRef(null),[ct,u]=useState(!1),[m,A]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[z,X]=useState(""),[K,H]=useState(!1),le=useRef(null),d=useRef(null),[w,R]=useState(null),[Z,be]=useState(!1),[ie,ve]=useState(null),[ye,Je]=useState(!1),[at,ee]=useState(!1),[Ie,lt]=useState(null),[Oe,it]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),bt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],$t=s=>{var k,M;s._type==="product"&&(ve(s),it({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(M=(k=s.commission_percent)!=null?k:s.commissionPercent)!=null?M:""}),be(!0))},vt=async()=>{if(ie)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${ie.id}`,Oe,"L\u1ED7i c\u1EADp nh\u1EADt"),y("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),be(!1),ve(null),xt()}catch(s){y(s.message,"danger")}},g=async s=>{const k=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${k} "${s.name}"?`))try{let M="";s._type==="product"?M=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?M=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(M=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(M,"L\u1ED7i x\xF3a"),y(`\u0110\xE3 x\xF3a ${k}`,"success"),xt()}catch(M){y(M.message,"danger")}},L=async s=>{try{const k=Ie?`${API_BASE}/api/products?id=${Ie.id}`:`${API_BASE}/api/products`;Ie?await window.KTM.api.putJSON(k,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(k,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(Ie?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ee(!1),lt(null),xt()}catch(k){y(k.message,"danger")}},Re="ktm_admin_data_cache_v1",rt=1e3*60*10,xt=async()=>{let s=null,k=!1;const M=window.KTM.cache.read(Re,{ttlMs:rt,validate:Array.isArray});M.hit?(s=M.value,console.log("[CACHE] Using cache, items:",s.length),ae(s),_(s),Ee(!1),k=!0):M.status==="miss"?console.log("[CACHE] No cache found"):M.status==="expired"||M.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):M.status==="error"&&console.error("[CACHE] Error parsing cache"),k||Ee(!0);try{const G=async(ot,Ue)=>{try{const ut=await window.KTM.api.getJSON(ot,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return ut!=null?ut:Ue}catch(ut){return Ue}},[Q,j,f]=await Promise.all([G(`${API_BASE}/api/products?fields=search`,[]),G(`${API_BASE}/api/albums`,[]),G(`${API_BASE}/api/video-folders?withVideos=true`,[])]),J=Array.isArray(Q)?Q.map(ot=>({...ot,_type:"product",_source:"database"})):[];ze(j);let de=[];Array.isArray(j)&&j.length>0&&(await Promise.all(j.map(Ue=>G(`${API_BASE}/api/albums/${Ue.id}`,{})))).forEach((Ue,ut)=>{const jt=j[ut];Ue.images&&Ue.images.length>0&&Ue.images.forEach(yt=>{de.push({id:yt.id,name:yt.caption||"\u1EA2nh t\u1EEB "+jt.title,image:yt.src,folder:jt.title,_type:"album",_source:"database"})})}),Me(f);let me=[];Array.isArray(f)&&f.forEach(ot=>{ot.videos&&ot.videos.forEach(Ue=>{me.push({id:Ue.id,name:Ue.title,folder:ot.name,image:Ue.thumb,youtubeId:Ue.youtubeId,url:Ue.url,_type:"video",_source:"database"})})});const te=[...J,...de,...me];(!s||JSON.stringify(te)!==JSON.stringify(s))&&(ae(te),_(te),window.KTM.cache.write(Re,te))}catch(G){console.error("Song song fetch error:",G)}Ee(!1)};useEffect(()=>{xt(),setTimeout(()=>{var s;return(s=Se.current)==null?void 0:s.focus()},100)},[]);const De=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(k){return String(s!=null?s:"").toLowerCase()}},Ze=s=>{const M=De(s).trim().split(/\s+/).filter(Boolean),G=M.includes("anh"),Q=M.includes("video"),j=M.filter(de=>de!=="anh"&&de!=="video"),f=j.join(" "),J=new Set(["product"]);return G&&J.add("album"),Q&&J.add("video"),{allowedTypes:J,includeAlbum:G,includeVideo:Q,contentTokens:j,cleanedQuery:f}},x=(s,k,M)=>{var ot,Ue,ut,jt,yt;const G=Array.isArray(k)?k:[],Q=De(M).trim();if(!G.length&&!Q)return 0;const j=De((ot=s==null?void 0:s.name)!=null?ot:""),f=De((Ue=s==null?void 0:s.code)!=null?Ue:""),J=De((ut=s==null?void 0:s.category)!=null?ut:""),de=De((jt=s==null?void 0:s.note)!=null?jt:""),me=De((yt=s==null?void 0:s.folder)!=null?yt:"");if(!`${j} ${f} ${J} ${de} ${me}`.trim())return 0;let xe=0;Q&&(j===Q&&(xe+=220),j.includes(Q)&&(xe+=140),j.startsWith(Q)&&(xe+=160),f&&f===Q&&(xe+=180),f&&f.includes(Q)&&(xe+=90));for(const kt of G){if(!kt)continue;const zt=new RegExp(`(?:^|\\s)${kt.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);j.includes(kt)&&(xe+=35),zt.test(j)&&(xe+=25),f&&f.includes(kt)&&(xe+=20),f&&zt.test(f)&&(xe+=10),J&&J.includes(kt)&&(xe+=12),me&&me.includes(kt)&&(xe+=12),de&&de.includes(kt)&&(xe+=6)}return xe>0&&j&&(xe+=Math.max(0,10-Math.min(10,Math.floor(j.length/10)))),xe},l=(s,k,M)=>{const G=Array.isArray(s)?s:[];return G.length?G.map((j,f)=>({it:j,idx:f,score:x(j,k,M)})).sort((j,f)=>f.score!==j.score?f.score-j.score:j.idx-f.idx).map(j=>j.it):[]},O=async(s,k)=>{if(!(!Fe||k.length===0)){ke(!0);try{const M=k.map(Q=>({id:Q.id,name:Q.name,price:Q.price,category:Q.category,note:Q.note,folder:Q.folder,_type:Q._type})),G=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:M},"AI Search error");if(G&&G.matchedIds&&G.matchedIds.length>0){const{contentTokens:Q,cleanedQuery:j}=Ze(s),f=new Set(G.matchedIds),J=k.filter(de=>f.has(de.id)).sort((de,me)=>x(me,Q,j)-x(de,Q,j));J.length>0&&_(J)}else G&&G.matchedIds&&G.matchedIds.length===0&&_([])}catch(M){console.error("AI Search error:",M)}ke(!1)}},E=s=>{if(B(s),Qe.current&&clearTimeout(Qe.current),!s.trim()){he(we);return}const{allowedTypes:k,contentTokens:M,cleanedQuery:G}=Ze(s),Q=T.filter(f=>{if(!k.has(f==null?void 0:f._type))return!1;if(M.length===0)return!0;const J=De(Object.entries(f).filter(([de])=>!de.startsWith("_")).map(([,de])=>String(de||"")).join(" "));return M.some(de=>J.includes(de))});let j=Q;we!=="all"&&(j=Q.filter(f=>(f.category||f._type)===we)),_(l(j,M,G)),Fe&&G.length>=3&&(Qe.current=setTimeout(()=>{O(G,j)},500))},he=s=>{Te(s);const{allowedTypes:k,contentTokens:M}=Ze($),{cleanedQuery:G}=Ze($);let Q=T.filter(j=>k.has(j==null?void 0:j._type));s!=="all"&&(Q=Q.filter(j=>(j.category||j._type)===s)),$.trim()&&M.length>0&&(Q=Q.filter(j=>{const f=De(Object.entries(j).filter(([J])=>!J.startsWith("_")).map(([,J])=>String(J||"")).join(" "));return M.every(J=>f.includes(J))})),_(l(Q,M,G))},Ce=(s,k)=>{window.KTM.clipboard.writeText(s).then(()=>{pe(k),y("\u0110\xE3 copy!","success"),setTimeout(()=>pe(null),1500)})},V=async(s,k)=>{try{await window.KTM.clipboard.writeImageFromUrl(s),pe(k+"-img"),y("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>pe(null),1500)}catch(M){Ce(s,k+"-img")}},Ve=s=>{let k=s.toLowerCase();const M=[],G=T.filter(f=>f._type==="product");if(k.includes("ty")||k.includes("xy lanh")){if(k.includes("gi\u1EEFa")||k.includes("giua")){const f=G.find(J=>{var de;return(de=J.name)==null?void 0:de.toLowerCase().includes("xy lanh gi\u1EEFa")});f&&!M.find(J=>J.id===f.id)&&M.push(f)}if(k.includes("nghi\xEAng")||k.includes("nghieng")){const f=G.find(J=>{var de;return(de=J.name)==null?void 0:de.toLowerCase().includes("xy lanh nghi\xEAng")});f&&!M.find(J=>J.id===f.id)&&M.push(f)}if(k.includes("\u1EE7i")||k.includes("ui")){const f=G.find(J=>{var de;return(de=J.name)==null?void 0:de.toLowerCase().includes("xy lanh \u1EE7i")});f&&!M.find(J=>J.id===f.id)&&M.push(f)}}const Q=k.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(Q){const f=Q[1],J=Q[2],de=G.find(me=>{var xe;const te=((xe=me.name)==null?void 0:xe.toLowerCase())||"";return te.includes("combo")&&te.includes(`${f} tay`)&&(te.includes(`${J} xy`)||te.includes(`${J} xylanh`))});if(de&&!M.find(me=>me.id===de.id))M.push(de);else{const me=G.find(te=>{var ot;const xe=((ot=te.name)==null?void 0:ot.toLowerCase())||"";return xe.includes("combo")&&xe.includes(`${f} tay`)});me&&!M.find(te=>te.id===me.id)&&M.push(me)}}if(k.includes("combo")&&!Q){const f=k.match(/combo.*?(\d+)\s*tay/);if(f){const J=f[1];G.filter(me=>{var xe;const te=((xe=me.name)==null?void 0:xe.toLowerCase())||"";return te.includes("combo")&&te.includes(`${J} tay`)}).forEach(me=>{M.find(te=>te.id===me.id)||M.push(me)})}}const j=k.match(/van\s*(\d+)\s*tay/);if(j&&!k.includes("ty")&&!k.includes("combo")){const f=j[1],J=G.find(de=>{var te;const me=((te=de.name)==null?void 0:te.toLowerCase())||"";return me.includes(`van ${f} tay`)&&!me.includes("combo")});J&&!M.find(de=>de.id===J.id)&&M.push(J)}return M.slice(0,4)},h=async s=>{if(!s.trim())return;const k={role:"user",content:s,attachments:[]};A(G=>[...G,k]),X(""),H(!0);const M=Ve(s);setTimeout(()=>{var G;return(G=le.current)==null?void 0:G.scrollIntoView({behavior:"smooth"})},100);try{const Q=T.filter(te=>te._type==="product").map(te=>{let xe=`- ${te.name}`;return te.code&&(xe+=` (M\xE3: ${te.code})`),te.price&&(xe+=` - Gi\xE1: ${te.price.replace(/[đ\s]/g,"")}\u0111`),te.category&&(xe+=` [${te.category}]`),te.note&&(xe+=` (${te.note})`),xe}).join(`
`),f=m.slice(-6).map(te=>`${te.role==="user"?"Kh\xE1ch":"AI"}: ${te.content}`).join(`
`),J=f?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${f}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${Q}`:Q,me=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:J,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";A(te=>[...te,{role:"assistant",content:me,attachments:M}])}catch(G){console.error("AI Error:",G);const Q=s.toLowerCase(),j=T.filter(J=>{const de=Object.values(J).join(" ").toLowerCase();return Q.split(" ").some(me=>de.includes(me))});let f="";j.length>0?(f=`T\xECm th\u1EA5y ${j.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,j.slice(0,5).forEach(J=>{f+=`\u2022 ${J.name}`,J.price&&(f+=` - ${J.price.replace(/[đ\s]/g,"")}\u0111`),J.note&&(f+=` (${J.note})`),f+=`
`}),j.length>5&&(f+=`
...v\xE0 ${j.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):f='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',A(J=>[...J,{role:"assistant",content:f,attachments:j.slice(0,4)}])}H(!1),setTimeout(()=>{var G,Q;(G=le.current)==null||G.scrollIntoView({behavior:"smooth"}),(Q=d.current)==null||Q.focus()},100)};function Le({show:s,product:k,categories:M,onClose:G,onSave:Q}){const[j,f]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[J,de]=useState(!1),[me,te]=useState(!1),xe=useRef(null),ot=D=>window.KTM.money.formatVNDInputDigits(D),Ue=D=>{const F=window.KTM.money.getDigits(String(D!=null?D:"")),W=Number(F);return F&&Number.isFinite(W)?Math.trunc(W):0},ut=(D,F)=>{if(D==null||D==="")return[];let W=D;if(typeof W=="string"){const Ne=W.trim();if(!Ne)return[];try{W=JSON.parse(Ne)}catch(ue){return[]}}if(!Array.isArray(W))return[];const oe=Ue(F);return W.map(Ne=>{var qe;if(!Ne||typeof Ne!="object")return null;const ue=String((qe=Ne.name)!=null?qe:"").trim(),Ke=(Array.isArray(Ne.options)?Ne.options:[]).map(ce=>{var gt,At,Nt,_t,Lt,Mt,ia;if(!ce||typeof ce!="object")return null;const pt=String((gt=ce.label)!=null?gt:"").trim();if(!pt)return null;const ft=(Lt=(_t=(Nt=(At=ce.price)!=null?At:ce.priceValue)!=null?Nt:ce.unit_price)!=null?_t:ce.unitPrice)!=null?Lt:null,ht=Number(ft);let Ct=Number.isFinite(ht)?Math.trunc(ht):null;if(Ct==null){const pa=(ia=(Mt=ce.price_delta)!=null?Mt:ce.priceDelta)!=null?ia:null,Ge=Number(pa);Number.isFinite(Ge)&&(Ct=oe+Math.trunc(Ge))}Ct==null&&(Ct=oe);const It=String(Math.max(0,Math.trunc(Number(Ct)||0)));return{label:pt,price:Math.max(0,Math.trunc(Number(Ct)||0)),priceDigits:It}}).filter(Boolean);return{name:ue||"Bi\u1EBFn th\u1EC3",options:Ke}}).filter(Boolean)},jt=D=>{if(D==null||D==="")return[];let F=D;if(typeof F=="string"){const W=F.trim();if(!W)return[];try{F=JSON.parse(W)}catch(oe){return[]}}return F&&typeof F=="object"&&!Array.isArray(F)&&(F=Object.entries(F).map(([W,oe])=>({key:W,value:oe}))),Array.isArray(F)?F.map(W=>{var Ke,qe,ce,pt,ft;if(!W||typeof W!="object")return null;const oe=String((ce=(qe=(Ke=W.key)!=null?Ke:W.name)!=null?qe:W.label)!=null?ce:"").trim(),Ne=String((pt=W.value)!=null?pt:"").trim(),ue=String((ft=W.unit)!=null?ft:"").trim();return oe?{key:oe,value:Ne,unit:ue}:null}).filter(Boolean):[]};useEffect(()=>{var D,F;if(k)if(f({name:k.name||"",code:k.code||"",price:k.price||"",image:k.image||"",category:k.category||"",note:k.note||"",sort_order:k.sort_order||0,commission_percent:(F=(D=k.commission_percent)!=null?D:k.commissionPercent)!=null?F:5,variants:ut(k.variants,k.price),attributes:jt(k.attributes)}),k.price){const W=window.KTM.money.getDigits(k.price);Ut(W),f(oe=>({...oe,price:ot(W)}))}else Ut("");else f({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Ut("")},[k,s]);const yt=D=>{f(F=>{var Ke;const W=Ue(F.price),oe=String(W),Ne=Array.isArray(F.variants)?[...F.variants]:[],ue={...Ne[D]||{},options:Array.isArray((Ke=Ne[D])==null?void 0:Ke.options)?[...Ne[D].options]:[]};return ue.options=ue.options.map(qe=>({label:String((qe==null?void 0:qe.label)||""),price:W,priceDigits:oe})),Ne[D]=ue,{...F,variants:Ne}})},kt=()=>{f(D=>{const F=Ue(D.price),W=String(F),Ne=(Array.isArray(D.variants)?[...D.variants]:[]).map(ue=>{const Ke=(Array.isArray(ue==null?void 0:ue.options)?ue.options:[]).map(qe=>({label:String((qe==null?void 0:qe.label)||""),price:F,priceDigits:W}));return{name:String((ue==null?void 0:ue.name)||"Bi\u1EBFn th\u1EC3"),options:Ke}});return{...D,variants:Ne}})},[zt,Va]=React.useState(""),[$a,Ut]=React.useState(""),ua=D=>{const F=window.KTM.money.nextPriceInputState(D.target.value,$a);Ut(F.digits),f({...j,price:F.price})},Ta=async(D,F=2)=>{const W=F*1024*1024;if(D.size<=W)return D;try{const oe=await createImageBitmap(D),Ne=document.createElement("canvas");let ue=oe.width,Ke=oe.height;const qe=1200;return(ue>qe||Ke>qe)&&(ue>Ke?(Ke=Math.round(Ke/ue*qe),ue=qe):(ue=Math.round(ue/Ke*qe),Ke=qe)),Ne.width=ue,Ne.height=Ke,Ne.getContext("2d").drawImage(oe,0,0,ue,Ke),oe.close(),new Promise((pt,ft)=>{Ne.toBlob(ht=>{ht?pt(new File([ht],D.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ft(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(oe){throw console.error("Compress error:",oe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ht=async D=>{var oe;const F=D.target.files[0];if(!F)return;if(!(F.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(F.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}te(!0);try{const Ne=await Ta(F),ue=await window.KTM.cloudinary.uploadImage({file:Ne,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!ue.secure_url)throw console.error("Cloudinary error:",ue),new Error(((oe=ue.error)==null?void 0:oe.message)||"Upload failed");f(Ke=>({...Ke,image:ue.secure_url}))}catch(Ne){console.error("Upload error:",Ne),alert("L\u1ED7i upload \u1EA3nh: "+Ne.message)}te(!1),D.target.value=""},Xt=async D=>{D.preventDefault(),de(!0);const F={...j,variants:ut(j.variants,j.price),attributes:jt(j.attributes)};await Q(F),de(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),k?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:G})),React.createElement("form",{onSubmit:Xt},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:j.name,onChange:D=>f({...j,name:D.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:j.code,onChange:D=>f({...j,code:D.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:j.price,onChange:ua,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:j.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:D=>f({...j,commission_percent:D.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:j.category,onChange:D=>f({...j,category:D.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),M.map(D=>React.createElement("option",{key:D,value:D},D)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:j.note,onChange:D=>f({...j,note:D.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(j.attributes)?j.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(j.attributes)?j.attributes:[]).map((D,F)=>React.createElement("div",{key:F,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.key)||"",onChange:W=>{const oe=W.target.value;f(Ne=>{const ue=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return ue[F]={...ue[F]||{},key:oe},{...Ne,attributes:ue}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.value)||"",onChange:W=>{const oe=W.target.value;f(Ne=>{const ue=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return ue[F]={...ue[F]||{},value:oe},{...Ne,attributes:ue}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.unit)||"",onChange:W=>{const oe=W.target.value;f(Ne=>{const ue=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return ue[F]={...ue[F]||{},unit:oe},{...Ne,attributes:ue}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{f(W=>{const oe=Array.isArray(W.attributes)?[...W.attributes]:[];return oe.splice(F,1),{...W,attributes:oe}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{f(D=>{const F=Array.isArray(D.attributes)?[...D.attributes]:[];return F.push({key:"",value:"",unit:""}),{...D,attributes:F}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(j.variants)?j.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(j.variants)?j.variants:[]).map((D,F)=>React.createElement("div",{key:F,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.name)||"",onChange:W=>{const oe=W.target.value;f(Ne=>{var Ke;const ue=Array.isArray(Ne.variants)?[...Ne.variants]:[];return ue[F]={...ue[F]||{},name:oe,options:Array.isArray((Ke=ue[F])==null?void 0:Ke.options)?ue[F].options:[]},{...Ne,variants:ue}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>yt(F),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(D==null?void 0:D.options)||D.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{f(W=>{const oe=Array.isArray(W.variants)?[...W.variants]:[];return oe.splice(F,1),{...W,variants:oe}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(D==null?void 0:D.options)?D.options:[]).map((W,oe)=>{var Ne,ue;return React.createElement("div",{key:oe,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(W==null?void 0:W.label)||"",onChange:Ke=>{const qe=Ke.target.value;f(ce=>{var It,gt,At,Nt,_t;const pt=Array.isArray(ce.variants)?[...ce.variants]:[],ft={...pt[F]||{},options:Array.isArray((It=pt[F])==null?void 0:It.options)?[...pt[F].options]:[]},ht=Number((At=(gt=ft.options[oe])==null?void 0:gt.price)!=null?At:0)||0,Ct=String((_t=(Nt=ft.options[oe])==null?void 0:Nt.priceDigits)!=null?_t:Math.max(0,Math.trunc(ht)));return ft.options[oe]={...ft.options[oe]||{},label:qe,price:Math.max(0,Math.trunc(ht)),priceDigits:Ct},pt[F]=ft,{...ce,variants:pt}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:ot(String((ue=W==null?void 0:W.priceDigits)!=null?ue:window.KTM.money.getDigits(String((Ne=W==null?void 0:W.price)!=null?Ne:"")))),onChange:Ke=>{f(qe=>{var At,Nt,_t,Lt,Mt;const ce=String((Nt=W==null?void 0:W.priceDigits)!=null?Nt:window.KTM.money.getDigits(String((At=W==null?void 0:W.price)!=null?At:""))),pt=window.KTM.money.nextPriceInputState(Ke.target.value,ce),ft=String((_t=pt.digits)!=null?_t:""),ht=Number(ft),Ct=Number.isFinite(ht)?Math.max(0,Math.trunc(ht)):0,It=Array.isArray(qe.variants)?[...qe.variants]:[],gt={...It[F]||{},options:Array.isArray((Lt=It[F])==null?void 0:Lt.options)?[...It[F].options]:[]};return gt.options[oe]={...gt.options[oe]||{},label:String(((Mt=gt.options[oe])==null?void 0:Mt.label)||""),price:Ct,priceDigits:ft},It[F]=gt,{...qe,variants:It}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{f(Ke=>{var pt;const qe=Array.isArray(Ke.variants)?[...Ke.variants]:[],ce={...qe[F]||{},options:Array.isArray((pt=qe[F])==null?void 0:pt.options)?[...qe[F].options]:[]};return ce.options.splice(oe,1),qe[F]=ce,{...Ke,variants:qe}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{f(W=>{var Ke;const oe=Array.isArray(W.variants)?[...W.variants]:[],Ne={...oe[F]||{},options:Array.isArray((Ke=oe[F])==null?void 0:Ke.options)?[...oe[F].options]:[]},ue=Ue(W.price);return Ne.options.push({label:"",price:ue,priceDigits:String(ue)}),oe[F]=Ne,{...W,variants:oe}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{f(D=>{const F=Ue(D.price),W=Array.isArray(D.variants)?[...D.variants]:[],oe=String(F);return W.push({name:"Size",options:[{label:"S",price:F,priceDigits:oe},{label:"M",price:F,priceDigits:oe},{label:"L",price:F,priceDigits:oe}]}),{...D,variants:W}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:kt,disabled:!Array.isArray(j.variants)||j.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},j.image?React.createElement(React.Fragment,null,React.createElement("img",{src:j.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>f({...j,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var D;return(D=xe.current)==null?void 0:D.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:xe,type:"file",accept:"image/*",className:"d-none",onChange:Ht}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var D;return(D=xe.current)==null?void 0:D.click()},disabled:me,style:{borderRadius:"10px"}},me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:j.image,onChange:D=>f({...j,image:D.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:G,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:J,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},J?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Ae=s=>window.KTM.money.formatVND(s),et=s=>{if(s==null||s==="")return[];let k=s;if(typeof k=="string"){const M=k.trim();if(!M)return[];try{k=JSON.parse(M)}catch(G){return[]}}return Array.isArray(k)?k:[]},Tt=s=>{if(s==null||s==="")return[];let k=s;if(typeof k=="string"){const M=k.trim();if(!M)return[];try{k=JSON.parse(M)}catch(G){return[]}}return k&&typeof k=="object"&&!Array.isArray(k)&&(k=Object.entries(k).map(([M,G])=>({key:M,value:G}))),Array.isArray(k)?k:[]},St=(s,k={})=>{var j;const M=Tt(s).map(f=>{var J,de,me,te,xe;return{key:String((me=(de=(J=f==null?void 0:f.key)!=null?J:f==null?void 0:f.name)!=null?de:f==null?void 0:f.label)!=null?me:"").trim(),value:String((te=f==null?void 0:f.value)!=null?te:"").trim(),unit:String((xe=f==null?void 0:f.unit)!=null?xe:"").trim()}}).filter(f=>!!f.key);if(!M.length)return null;const G=!!k.compact,Q=String((j=k.className)!=null?j:"").trim();return React.createElement("div",{className:`ktm-variants-preview${G?" compact":""}${Q?" "+Q:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},M.map((f,J)=>{const de=f.key,me=`${f.value||""}${f.unit?(f.value?" ":"")+f.unit:""}`.trim();return React.createElement("div",{key:`${de}-${J}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},de),me?React.createElement("span",{className:"ktm-chip ktm-chip-option"},me):null)})))},fe=(s,k={})=>{var de;const M=et(s).map(me=>{var te;return{name:String((te=me==null?void 0:me.name)!=null?te:"").trim(),options:Array.isArray(me==null?void 0:me.options)?me.options:[]}}).map(me=>({...me,options:me.options.map(te=>{var xe;return{label:String((xe=te==null?void 0:te.label)!=null?xe:"").trim(),price:Number(te==null?void 0:te.price)}}).filter(te=>!!te.label)})).filter(me=>me.options.length>0);if(!M.length)return null;const G=Number.isFinite(k.maxGroups)?Math.max(1,Math.trunc(k.maxGroups)):M.length,Q=Number.isFinite(k.maxOptionsPerGroup)?Math.max(1,Math.trunc(k.maxOptionsPerGroup)):3,j=!!k.compact,f=String((de=k.className)!=null?de:"").trim(),J=M.slice(0,G);return React.createElement("div",{className:`ktm-variants-preview${j?" compact":""}${f?" "+f:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},J.map((me,te)=>{const xe=me.name||"Bi\u1EBFn th\u1EC3",ot=me.options.slice(0,Q),Ue=me.options.length-ot.length;return React.createElement("div",{key:`${xe}-${te}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},xe),ot.map((ut,jt)=>{const yt=ut.price,kt=Number.isFinite(yt)&&yt>=0?Ae(Math.trunc(yt)):"",zt=kt?`${ut.label} \xB7 ${kt}`:ut.label;return React.createElement("span",{key:`${xe}-${te}-${jt}`,className:"ktm-chip ktm-chip-option"},zt)}),Ue>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",Ue))})))},dt=(s,k)=>{const M=s._type==="product",G=s._type==="album",Q=s._type==="video",j=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),f=M?St(s.attributes,{compact:je==="grid",className:je==="grid"?"meta text-muted":"text-muted"}):null,J=M?fe(s.variants,{compact:je==="grid",maxOptionsPerGroup:999,className:je==="grid"?"meta text-muted":"text-muted"}):null;return je==="grid"?React.createElement("div",{key:s.id||k,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>R({url:s.image,name:s.name,price:s.price,note:s.note,item:s})},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Q?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${M?"product":G?"album":"video"}`},M?"SP":G?"\u1EA2nh":"Video"),j&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),f&&React.createElement("div",{style:{marginTop:2}},f),J&&React.createElement("div",{style:{marginTop:2}},J),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:re===s.id+"-img"?"copied":"",onClick:()=>V(s.image,s.id)},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:re===s.id+"-price"?"copied":"",onClick:()=>Ce(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||k,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${M?"product":G?"album":"video"}`},M?"S\u1EA3n ph\u1EA9m":G?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>R({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Q?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),j&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),f&&React.createElement("div",{style:{marginTop:4}},f),J&&React.createElement("div",{style:{marginTop:4}},J)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),Q&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},M&&React.createElement("button",{onClick:()=>N&&N("orders","create",{productId:s.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:re===s.id+"-price"?"copied":"",onClick:()=>Ce(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:re===s.id+"-name"?"copied":"",onClick:()=>Ce(s.name,s.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),Q&&s.youtubeId&&React.createElement("button",{className:re===s.id+"-yt"?"copied":"",onClick:()=>Ce(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),M&&React.createElement("button",{className:"action-edit",onClick:()=>$t(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>g(s)},React.createElement("i",{className:"fas fa-trash"}))))},[Rt,Pe]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,P.length)," k\u1EBFt qu\u1EA3",Fe&&$.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),we!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},we==="product"?"S\u1EA3n ph\u1EA9m":we==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${je==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>se("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${je==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>se("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},C?React.createElement("div",null,[...Array(8)].map((s,k)=>React.createElement("div",{key:k,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):P.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',$,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{B(""),E("")}},"Xem t\u1EA5t c\u1EA3")):je==="grid"?React.createElement("div",{className:"product-grid-mobile"},P.map((s,k)=>dt(s,k))):React.createElement("div",null,P.map((s,k)=>dt(s,k)))),Rt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Pe(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${we==="all"?"active":""}`,onClick:()=>{he("all"),Pe(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${we==="product"?"active":""}`,onClick:()=>{he("product"),Pe(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${we==="album"?"active":""}`,onClick:()=>{he("album"),Pe(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${we==="video"?"active":""}`,onClick:()=>{he("video"),Pe(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Fe,onChange:s=>tt(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:Se,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:$,onChange:s=>E(s.target.value)}),React.createElement("button",{className:`filter-btn ${Rt||we!=="all"?"active":""}`,onClick:()=>Pe(!Rt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:ye?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>u(!0),onTouchStart:()=>u(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),ct&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>u(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},m.map((s,k)=>React.createElement("div",{key:k,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:re===`chat-${k}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:re===`chat-${k}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),pe(`chat-${k}`),setTimeout(()=>pe(null),1500)}},React.createElement("i",{className:`fas ${re===`chat-${k}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((M,G)=>React.createElement("div",{key:G,style:{width:70},className:"text-center"},M.image&&React.createElement("img",{src:M.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>R({url:M.image,name:M.name,price:M.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},M.name),M.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},M.price.replace(/[đ\s]/g,""),"\u0111"))))))),K&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:le})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>h(s),disabled:K,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),h(z)},className:"chat-input-wrap"},React.createElement("input",{ref:d,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:z,onChange:s=>X(s.target.value),disabled:K}),React.createElement("button",{type:"submit",className:"send-btn",disabled:K||!z.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),w&&React.createElement("div",{className:"preview-modal",onClick:()=>R(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>R(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:w.url,alt:w.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},w.name),w.price&&React.createElement("div",{className:"price"},w.price.replace(/[đ\s]/g,""),"\u0111"),w.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},w.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:re==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:re==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>V(w.url,"preview")},React.createElement("i",{className:`fas ${re==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),w.price&&React.createElement("button",{className:re==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Ce(w.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${re==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Le,{show:at,product:Ie,categories:ne,onClose:()=>{ee(!1),lt(null)},onSave:L}),React.createElement("div",{className:`fab-container mobile-only ${ye?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{Je(!1),ee(!0),lt(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{Je(!1),N&&N("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${ye?"open":""}`,onClick:()=>Je(!ye)},React.createElement("i",{className:"fas fa-plus"}))),Z&&ie&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>be(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Oe.name,onChange:s=>it({...Oe,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Oe.code,onChange:s=>it({...Oe,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Oe.price,onChange:s=>it({...Oe,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Oe.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>it({...Oe,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Oe.category,onChange:s=>it({...Oe,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),bt.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Oe.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>it({...Oe,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>be(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:vt},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:y,showToast:N}){const[$,B]=useState([]),[P,_]=useState([]),[T,ae]=useState(!0),[ne,Y]=useState(null),[we,Te]=useState(!1),[re,pe]=useState(null),[je,se]=useState(!1),[C,Ee]=useState(null),[Xe,ze]=useState(!1),[ge,Me]=useState(null),[Se,Fe]=useState(!1),[tt,mt]=useState(!1),[ke,Qe]=useState(null),[ct,u]=useState(!1),[m,A]=useState(null),[z,X]=useState([]);useEffect(()=>{K()},[]);const K=async(g=null)=>{ae(!0);try{const L=g?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${g}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Re=await window.KTM.api.getJSON(L,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");B(Array.isArray(Re)?Re:[])}catch(L){console.error(L),N("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}ae(!1)},H=async g=>{try{const L=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${g}`,"L\u1ED7i t\u1EA3i video");_(Array.isArray(L)?L:[])}catch(L){console.error(L)}},le=async g=>{if(g===0)return;const L=[...$];[L[g-1],L[g]]=[L[g],L[g-1]],B(L),await w(L)},d=async g=>{if(g===$.length-1)return;const L=[...$];[L[g],L[g+1]]=[L[g+1],L[g]],B(L),await w(L)},w=async g=>{try{await Promise.all(g.map((L,Re)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${L.id}`,{sortOrder:Re},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),N("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(L){N("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),K(m==null?void 0:m.id)}},R=async g=>{if(g===0)return;const L=[...P];[L[g-1],L[g]]=[L[g],L[g-1]],_(L),await be(L)},Z=async g=>{if(g===P.length-1)return;const L=[...P];[L[g],L[g+1]]=[L[g+1],L[g]],_(L),await be(L)},be=async g=>{try{await Promise.all(g.map((L,Re)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${L.id}`,{sort_order:Re},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),N("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(L){N("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),H(ne.id)}},ie=()=>{pe(null),Te(!0)},ve=g=>{Qe(g),mt(!0),u(!0)},ye=async(g,L="modal")=>{try{!re&&m&&(g.parent_id=m.id);const Re=re?`${API_BASE}/api/video-folders/${re.id}`:`${API_BASE}/api/video-folders`;re?await window.KTM.api.putJSON(Re,g,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Re,g,"L\u1ED7i l\u01B0u folder"),N(re?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),L==="drawer"?(u(!1),pe(null),K(m==null?void 0:m.id),re&&ke&&Qe({...ke,...g})):(Te(!1),pe(null),K(m==null?void 0:m.id))}catch(Re){N(Re.message,"danger")}},Je=async g=>{const L=g.subfolderCount>0?`X\xF3a folder "${g.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${g.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(L))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${g.id}`,"L\u1ED7i x\xF3a folder"),N("\u0110\xE3 x\xF3a folder","success"),Y(null),K(m==null?void 0:m.id)}catch(Re){N("L\u1ED7i x\xF3a folder","danger")}},at=g=>{g.subfolderCount>0?(X(L=>[...L,g]),A(g),K(g.id)):(Y(g),_(g.videos||[]))},ee=g=>{if(g==="root")X([]),A(null),K(null);else if(g){const L=z.findIndex(Re=>Re.id===g.id);L>=0&&(X(z.slice(0,L+1)),A(g),K(g.id))}else{const L=[...z];L.pop();const Re=L[L.length-1]||null;X(L),A(Re),K(Re==null?void 0:Re.id)}},Ie=()=>{mt(!1),u(!1),Qe(null)},lt=()=>{ze(!1),Fe(!1),Me(null)},Oe=()=>{Ee(null),se(!0)},it=g=>{Me(g),ze(!0),Fe(!0)},bt=async(g,L="modal")=>{try{g.folder_id=ne==null?void 0:ne.id;const Re=C?`${API_BASE}/api/videos/${C.id}`:`${API_BASE}/api/videos`;C?await window.KTM.api.putJSON(Re,g,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Re,g,"L\u1ED7i l\u01B0u video"),N(C?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),L==="drawer"?(Fe(!1),Ee(null),K(),ne&&H(ne.id),C&&ge&&Me({...ge,...g})):(se(!1),Ee(null),K(),ne&&H(ne.id))}catch(Re){N(Re.message,"danger")}},$t=async g=>{if(confirm(`X\xF3a video "${g.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${g.id}`,"L\u1ED7i x\xF3a video"),N("\u0110\xE3 x\xF3a video","success"),K(),ne&&H(ne.id)}catch(L){N("L\u1ED7i x\xF3a video","danger")}},vt=g=>{const L=`https://www.youtube.com/watch?v=${g.youtubeId}`;window.KTM.clipboard.writeText(L).then(()=>{N("\u0110\xE3 copy link!","success")}).catch(()=>{N("Kh\xF4ng th\u1EC3 copy link","danger")})};return ne?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Y(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${ne.slug==="shorts"?"text-danger":"text-warning"}`}),ne.name)),React.createElement("button",{className:"btn btn-warning",onClick:Oe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),P.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},P.map((g,L)=>React.createElement("div",{key:g.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>R(L),disabled:L===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},L+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Z(L),disabled:L===P.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:g.thumb,className:"card-img-top",alt:g.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${g.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:g.title},g.title),React.createElement("small",{className:"text-muted"},g.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>vt(g),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>it(g),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>$t(g),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:je,video:C,onClose:()=>se(!1),onSave:bt}),React.createElement(AdminDrawer,{open:tt,title:ke?ke.name:"Folder",subtitle:ke?`${ke.subfolderCount||0} subfolder \u2022 ${ke.videoCount||0} videos`:"",onClose:Ie,footer:ct?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:Ie},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{ke&&ye({name:ke.name||"",description:ke.description||"",sortOrder:ke.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):ke?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(ke.name),N("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{u(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${ke.name}"?`)&&(Je(ke),Ie())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ct&&ke?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:ke.name||"",onChange:g=>Qe({...ke,name:g.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:ke.description||"",onChange:g=>Qe({...ke,description:g.target.value})}))):ke?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},ke.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},ke.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},ke.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},ke.videoCount||0))),ke.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,ke.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:Xe,title:ge?ge.title:"Video",subtitle:ge?`${ge.youtubeId}`:"",onClose:lt,footer:Se?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:lt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{ge&&bt({youtube_url:`https://www.youtube.com/watch?v=${ge.youtubeId}`,title:ge.title||"",thumbnail_url:ge.thumb||"",sort_order:ge.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):ge?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const g=`https://www.youtube.com/watch?v=${ge.youtubeId}`;window.KTM.clipboard.writeText(g).then(()=>{N("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Fe(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${ge.title}"?`)&&($t(ge),lt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Se&&ge?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:ge.title||"",onChange:g=>Me({...ge,title:g.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:ge.youtubeId||"",onChange:g=>Me({...ge,youtubeId:g.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ge.sortOrder||0,onChange:g=>Me({...ge,sortOrder:parseInt(g.target.value)||0})}))):ge?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},ge.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},ge.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},ge.sortOrder||0))),ge.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:ge.thumb,alt:ge.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},m&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ee()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),m?m.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:ie},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),z.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:g=>{g.preventDefault(),ee("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),z.map((g,L)=>React.createElement("li",{key:g.id,className:`breadcrumb-item ${L===z.length-1?"active":""}`},L===z.length-1?g.name:React.createElement("a",{href:"#",onClick:Re=>{Re.preventDefault(),ee(g)},className:"text-warning"},g.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),T?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):$.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},m?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ie},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",m?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},$.map((g,L)=>{var Re,rt,xt,De;return React.createElement("div",{key:g.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Ze=>{Ze.stopPropagation(),le(L)},disabled:L===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},L+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Ze=>{Ze.stopPropagation(),d(L)},disabled:L===$.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>at(g),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${g.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},g.name),React.createElement("p",{className:"text-muted mb-0"},g.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),g.subfolderCount," folder"),g.subfolderCount>0&&(g.videoCount>0||((Re=g.videos)==null?void 0:Re.length)>0)&&" \u2022 ",(g.videoCount>0||((rt=g.videos)==null?void 0:rt.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),g.videoCount||((xt=g.videos)==null?void 0:xt.length)||0," videos"),g.subfolderCount===0&&!g.videoCount&&!((De=g.videos)!=null&&De.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Ze=>{Ze.stopPropagation(),ve(g)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Ze=>{Ze.stopPropagation(),Je(g)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:we,folder:re,onClose:()=>Te(!1),onSave:ye}))}function VideoFolderModal({show:y,folder:N,onClose:$,onSave:B}){const[P,_]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[T,ae]=useState(!1),[ne,Y]=useState(!1);useEffect(()=>{_(N?{name:N.name||"",description:N.description||"",sortOrder:N.sortOrder||0,coverImage:N.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[N,y]);const we=async re=>{const pe=re.target.files[0];if(pe){Y(!0);try{const je=await window.KTM.cloudinary.uploadImage({file:pe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});je.secure_url&&_(se=>({...se,coverImage:je.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(je){console.error("Cloudinary upload error:",je),alert("L\u1ED7i upload \u1EA3nh: "+(je.message||je))}finally{Y(!1)}}},Te=async re=>{re.preventDefault(),ae(!0);const pe={...P,variants:normalizeVariants(P.variants,P.price),attributes:normalizeAttributes(P.attributes)};await B(pe),ae(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},N?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:Te},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:P.name,onChange:re=>_({...P,name:re.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:P.description,onChange:re=>_({...P,description:re.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sortOrder,onChange:re=>_({...P,sortOrder:parseInt(re.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},P.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:P.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>_({...P,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:we,disabled:ne}),ne&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:P.coverImage,onChange:re=>_({...P,coverImage:re.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:T},T?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:y,settings:N}){const[$,B]=useState([]),[P,_]=useState(!0),[T,ae]=useState(!1),[ne,Y]=useState(null),[we,Te]=useState(""),[re,pe]=useState(""),[je,se]=useState(!1),[C,Ee]=useState(null),Xe=normalizeShipPercent(N==null?void 0:N.ship_percent),{parseMoney:ze,formatVND:ge}=window.KTM.money,Me=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Se()},[]);const Se=async()=>{_(!0);try{const d=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");B(Array.isArray(d)?d:[])}catch(d){console.error(d),y("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}_(!1)},Fe=()=>{Y(null),ae(!0)},tt=d=>{Y(d),ae(!0)},mt=d=>{d&&(Ee(d),se(!0))},ke=()=>{se(!1)},Qe=async d=>{if(!(!d||!d.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:d},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),y(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Se()}catch(w){y("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},ct=async d=>{try{const w=ne?`${API_BASE}/api/products?id=${ne.id}`:`${API_BASE}/api/products`;ne?await window.KTM.api.putJSON(w,d,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(w,d,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(ne?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ae(!1),Se()}catch(w){y(w.message,"danger")}},u=async d=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${d.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${d.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),y("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Se()}catch(w){y(w.message,"danger")}},m=$.filter(d=>{const w=!we||d.name.toLowerCase().includes(we.toLowerCase())||d.code&&d.code.toLowerCase().includes(we.toLowerCase()),R=!re||d.category===re;return w&&R}),A=d=>{var Z;const w=(Z=d==null?void 0:d.commission_percent)!=null?Z:d==null?void 0:d.commissionPercent,R=w===""||w==null?NaN:Number(w);return Number.isFinite(R)?Math.max(0,Math.min(100,R)):5},z=d=>{const w=A(d),R=Number.isInteger(w)?String(w):String(Math.round(w*100)/100),Z=ze(d==null?void 0:d.price);if(!Number.isFinite(Z)||Z<=0)return`${R}%`;const be=(Number(w)||0)/100,ve=window.KTM.money.parseShipFeeFromNote(d==null?void 0:d.note)!=null?0:Xe>0?Z*Xe/100:0,ye=Z*be-ve*be,Je=Math.max(0,Math.round(ye));return`${R}% - ${ge(Je)}`},X=d=>{if(d==null||d==="")return[];let w=d;if(typeof w=="string"){const R=w.trim();if(!R)return[];try{w=JSON.parse(R)}catch(Z){return[]}}return Array.isArray(w)?w:[]},K=d=>{if(d==null||d==="")return[];let w=d;if(typeof w=="string"){const R=w.trim();if(!R)return[];try{w=JSON.parse(R)}catch(Z){return[]}}return w&&typeof w=="object"&&!Array.isArray(w)&&(w=Object.entries(w).map(([R,Z])=>({key:R,value:Z}))),Array.isArray(w)?w:[]},H=d=>{const w=K(d).map(R=>{var Z,be,ie,ve,ye;return{key:String((ie=(be=(Z=R==null?void 0:R.key)!=null?Z:R==null?void 0:R.name)!=null?be:R==null?void 0:R.label)!=null?ie:"").trim(),value:String((ve=R==null?void 0:R.value)!=null?ve:"").trim(),unit:String((ye=R==null?void 0:R.unit)!=null?ye:"").trim()}}).filter(R=>!!R.key);return w.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},w.map((R,Z)=>{const be=R.key,ie=`${R.value||""}${R.unit?(R.value?" ":"")+R.unit:""}`.trim();return React.createElement("div",{key:`${be}-${Z}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},be),ie?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ie):null)}))):null},le=(d,w={})=>{const R=X(d).map(ve=>{var ye;return{name:String((ye=ve==null?void 0:ve.name)!=null?ye:"").trim(),options:Array.isArray(ve==null?void 0:ve.options)?ve.options:[]}}).map(ve=>({...ve,options:ve.options.map(ye=>{var Je;return{label:String((Je=ye==null?void 0:ye.label)!=null?Je:"").trim(),price:Number(ye==null?void 0:ye.price)}}).filter(ye=>!!ye.label)})).filter(ve=>ve.options.length>0);if(!R.length)return null;const Z=Number.isFinite(w.maxGroups)?Math.max(1,Math.trunc(w.maxGroups)):R.length,be=Number.isFinite(w.maxOptionsPerGroup)?Math.max(1,Math.trunc(w.maxOptionsPerGroup)):4,ie=R.slice(0,Z);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},ie.map((ve,ye)=>{const Je=ve.name||"Bi\u1EBFn th\u1EC3",at=ve.options.slice(0,be),ee=ve.options.length-at.length;return React.createElement("div",{key:`${Je}-${ye}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Je),at.map((Ie,lt)=>{const Oe=Ie.price,it=Number.isFinite(Oe)&&Oe>=0?ge(Math.trunc(Oe)):"",bt=it?`${Ie.label} \xB7 ${it}`:Ie.label;return React.createElement("span",{key:`${Je}-${ye}-${lt}`,className:"ktm-chip ktm-chip-option"},bt)}),ee>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",ee))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Fe},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:we,onChange:d=>Te(d.target.value)})),React.createElement("span",{className:"product-count"},m.length)),React.createElement("select",{className:"form-select",value:re,onChange:d=>pe(d.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),Me.map(d=>React.createElement("option",{key:d,value:d},d)))),P?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):m.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Fe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},m.map(d=>React.createElement("div",{key:d.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>mt(d),onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),mt(d))},title:"Xem chi ti\u1EBFt"},d.image?React.createElement("img",{src:d.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},d.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},d.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},d.category),d.code&&React.createElement("span",{className:"product-badge bg-secondary"},d.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),z(d))),React.createElement("div",{className:"product-price"},d.price?d.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),d.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},d.note),H(d.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},H(d.attributes)),le(d.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},le(d.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:w=>{w.stopPropagation(),tt(d)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:w=>{w.stopPropagation(),u(d)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:je,title:String((C==null?void 0:C.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((C==null?void 0:C.code)||"").trim()||null,String((C==null?void 0:C.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:ke,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const d=String((C==null?void 0:C.code)||"").trim();d&&window.KTM.clipboard.writeText(d).then(()=>y("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((C==null?void 0:C.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const d=String((C==null?void 0:C.price)||"").trim();d&&window.KTM.clipboard.writeText(d).then(()=>y("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((C==null?void 0:C.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>C&&tt(C),disabled:!C},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>C&&u(C),disabled:!C},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},C?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const d=String((C==null?void 0:C.price)||"").trim(),w=ze(d);return Number.isFinite(w)&&w>0?ge(Math.trunc(w)):d||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},z(C)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},C.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},C.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),C.image?React.createElement("img",{src:C.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(C.note||"").trim()||C.attributes||C.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(C.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(C.note||"").trim()),H(C.attributes)?React.createElement("div",{className:"mt-2"},H(C.attributes)):null,le(C.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},le(C.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:T,product:ne,categories:Me,onClose:()=>ae(!1),onSave:ct}))}function ProductModal({show:y,product:N,categories:$,onClose:B,onSave:P}){const[_,T]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[ae,ne]=useState(!1),[Y,we]=useState(!1),Te=u=>{const m=window.KTM.money.getDigits(String(u!=null?u:"")),A=Number(m);return m&&Number.isFinite(A)?Math.trunc(A):0},re=u=>{if(u==null||u==="")return[];let m=u;if(typeof m=="string"){const A=m.trim();if(!A)return[];try{m=JSON.parse(A)}catch(z){return[]}}return m&&typeof m=="object"&&!Array.isArray(m)&&(m=Object.entries(m).map(([A,z])=>({key:A,value:z}))),Array.isArray(m)?m.map(A=>{var H,le,d,w,R;if(!A||typeof A!="object")return null;const z=String((d=(le=(H=A.key)!=null?H:A.name)!=null?le:A.label)!=null?d:"").trim(),X=String((w=A.value)!=null?w:"").trim(),K=String((R=A.unit)!=null?R:"").trim();return z?{key:z,value:X,unit:K}:null}).filter(Boolean):[]},pe=(u,m)=>{if(u==null||u==="")return[];let A=u;if(typeof A=="string"){const X=A.trim();if(!X)return[];try{A=JSON.parse(X)}catch(K){return[]}}if(!Array.isArray(A))return[];const z=Te(m);return A.map(X=>{var le;if(!X||typeof X!="object")return null;const K=String((le=X.name)!=null?le:"").trim(),H=(Array.isArray(X.options)?X.options:[]).map(d=>{var ve,ye,Je,at,ee,Ie,lt;if(!d||typeof d!="object")return null;const w=String((ve=d.label)!=null?ve:"").trim();if(!w)return null;const R=(ee=(at=(Je=(ye=d.price)!=null?ye:d.priceValue)!=null?Je:d.unit_price)!=null?at:d.unitPrice)!=null?ee:null,Z=Number(R);let be=Number.isFinite(Z)?Math.trunc(Z):null;if(be==null){const Oe=(lt=(Ie=d.price_delta)!=null?Ie:d.priceDelta)!=null?lt:null,it=Number(Oe);Number.isFinite(it)&&(be=z+Math.trunc(it))}be==null&&(be=z);const ie=String(Math.max(0,Math.trunc(Number(be)||0)));return{label:w,price:Math.max(0,Math.trunc(Number(be)||0)),priceDigits:ie}}).filter(Boolean);return{name:K||"Bi\u1EBFn th\u1EC3",options:H}}).filter(Boolean)};useEffect(()=>{var u,m;T(N?{name:N.name||"",code:N.code||"",price:N.price||"",image:N.image||"",category:N.category||"",note:N.note||"",sort_order:N.sort_order||0,commission_percent:(m=(u=N.commission_percent)!=null?u:N.commissionPercent)!=null?m:5,variants:pe(N.variants,N.price),attributes:re(N.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[N,y]);const je=u=>{T(m=>{var H;const A=Te(m.price),z=String(A),X=Array.isArray(m.variants)?[...m.variants]:[],K={...X[u]||{},options:Array.isArray((H=X[u])==null?void 0:H.options)?[...X[u].options]:[]};return K.options=K.options.map(le=>({label:String((le==null?void 0:le.label)||""),price:A,priceDigits:z})),X[u]=K,{...m,variants:X}})},se=()=>{T(u=>{const m=Te(u.price),A=String(m),X=(Array.isArray(u.variants)?[...u.variants]:[]).map(K=>{const H=(Array.isArray(K==null?void 0:K.options)?K.options:[]).map(le=>({label:String((le==null?void 0:le.label)||""),price:m,priceDigits:A}));return{name:String((K==null?void 0:K.name)||"Bi\u1EBFn th\u1EC3"),options:H}});return{...u,variants:X}})},[C,Ee]=React.useState(""),Xe=u=>window.KTM.money.formatVNDInputDigits(u),[ze,ge]=React.useState(""),Me=u=>{const m=window.KTM.money.nextPriceInputState(u.target.value,ze);ge(m.digits),T({..._,price:m.price})},[Se,Fe]=React.useState("");React.useEffect(()=>{N!=null&&N.image&&Fe(N.image)},[N]);const tt=async u=>{if(!(!u||!u.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:u},"L\u1ED7i x\xF3a \u1EA3nh")}catch(m){console.error("Delete cloudinary image error:",m)}},mt=async(u,m=2,A)=>{const z=m*1024*1024,X=u.type==="image/heic"||u.type==="image/heif"||/\.heic$/i.test(u.name);if(u.size<=z&&!X)return u;A==null||A("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const K=await createImageBitmap(u);A==null||A("\u0110ang n\xE9n \u1EA3nh...");const H=document.createElement("canvas");let le=K.width,d=K.height;const w=1200;return(le>w||d>w)&&(le>d?(d=Math.round(d/le*w),le=w):(le=Math.round(le/d*w),d=w)),H.width=le,H.height=d,H.getContext("2d").drawImage(K,0,0,le,d),K.close(),new Promise((Z,be)=>{H.toBlob(ie=>{ie?(A==null||A("Ho\xE0n t\u1EA5t!"),Z(new File([ie],u.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):be(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(K){throw console.error("createImageBitmap error:",K),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ke=async u=>{var z,X;const m=(z=u.target.files)==null?void 0:z[0];if(!m)return;if(!(m.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(m.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}we(!0),Ee("\u0110ang chu\u1EA9n b\u1ECB...");try{const K=(m.size/1024/1024).toFixed(1);Ee(`File ${K}MB - \u0110ang n\xE9n...`);const H=await mt(m,2,w=>{Ee(w)}),le=(H.size/1024/1024).toFixed(1);Ee(`\u0110\xE3 n\xE9n: ${le}MB - \u0110ang upload...`);const d=await window.KTM.cloudinary.uploadImage({file:H,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});d.secure_url?(_.image&&_.image!==Se&&tt(_.image),T(w=>({...w,image:d.secure_url})),Ee("")):(console.error("Cloudinary error:",d),alert("Upload th\u1EA5t b\u1EA1i: "+(((X=d.error)==null?void 0:X.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Ee(""))}catch(K){console.error("Upload error:",K),alert("L\u1ED7i: "+K.message),Ee("")}we(!1),u.target.value=""},Qe=()=>{_.image&&(_.image!==Se&&tt(_.image),T(u=>({...u,image:""})))},ct=async u=>{u.preventDefault(),ne(!0),Se&&_.image&&Se!==_.image&&await tt(Se),Se&&!_.image&&await tt(Se),await P(_),ne(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${N?"fa-edit":"fa-plus-circle"} me-2`}),N?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:B})),React.createElement("form",{onSubmit:ct},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},_.image?React.createElement(React.Fragment,null,React.createElement("img",{src:_.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Qe,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Y?"fa-spinner fa-spin":"fa-camera"} me-1`}),Y?C||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:ke,disabled:Y,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Y&&C&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},C))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:_.name,onChange:u=>T({..._,name:u.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:_.code,onChange:u=>T({..._,code:u.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:_.price,onChange:Me,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:_.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:u=>T({..._,commission_percent:u.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:_.category,onChange:u=>T({..._,category:u.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),$.map(u=>React.createElement("option",{key:u,value:u},u)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:_.note,onChange:u=>T({..._,note:u.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(_.attributes)?_.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(_.attributes)?_.attributes:[]).map((u,m)=>React.createElement("div",{key:m,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(u==null?void 0:u.key)||"",onChange:A=>{const z=A.target.value;T(X=>{const K=Array.isArray(X.attributes)?[...X.attributes]:[];return K[m]={...K[m]||{},key:z},{...X,attributes:K}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(u==null?void 0:u.value)||"",onChange:A=>{const z=A.target.value;T(X=>{const K=Array.isArray(X.attributes)?[...X.attributes]:[];return K[m]={...K[m]||{},value:z},{...X,attributes:K}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(u==null?void 0:u.unit)||"",onChange:A=>{const z=A.target.value;T(X=>{const K=Array.isArray(X.attributes)?[...X.attributes]:[];return K[m]={...K[m]||{},unit:z},{...X,attributes:K}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{T(A=>{const z=Array.isArray(A.attributes)?[...A.attributes]:[];return z.splice(m,1),{...A,attributes:z}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{T(u=>{const m=Array.isArray(u.attributes)?[...u.attributes]:[];return m.push({key:"",value:"",unit:""}),{...u,attributes:m}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(_.variants)?_.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(_.variants)?_.variants:[]).map((u,m)=>React.createElement("div",{key:m,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(u==null?void 0:u.name)||"",onChange:A=>{const z=A.target.value;T(X=>{var H;const K=Array.isArray(X.variants)?[...X.variants]:[];return K[m]={...K[m]||{},name:z,options:Array.isArray((H=K[m])==null?void 0:H.options)?K[m].options:[]},{...X,variants:K}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>je(m),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(u==null?void 0:u.options)||u.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{T(A=>{const z=Array.isArray(A.variants)?[...A.variants]:[];return z.splice(m,1),{...A,variants:z}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(u==null?void 0:u.options)?u.options:[]).map((A,z)=>{var X,K;return React.createElement("div",{key:z,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(A==null?void 0:A.label)||"",onChange:H=>{const le=H.target.value;T(d=>{var ie,ve,ye,Je,at;const w=Array.isArray(d.variants)?[...d.variants]:[],R={...w[m]||{},options:Array.isArray((ie=w[m])==null?void 0:ie.options)?[...w[m].options]:[]},Z=Number((ye=(ve=R.options[z])==null?void 0:ve.price)!=null?ye:0)||0,be=String((at=(Je=R.options[z])==null?void 0:Je.priceDigits)!=null?at:Math.max(0,Math.trunc(Z)));return R.options[z]={...R.options[z]||{},label:le,price:Math.max(0,Math.trunc(Z)),priceDigits:be},w[m]=R,{...d,variants:w}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Xe(String((K=A==null?void 0:A.priceDigits)!=null?K:window.KTM.money.getDigits(String((X=A==null?void 0:A.price)!=null?X:"")))),onChange:H=>{T(le=>{var ye,Je,at,ee,Ie;const d=String((Je=A==null?void 0:A.priceDigits)!=null?Je:window.KTM.money.getDigits(String((ye=A==null?void 0:A.price)!=null?ye:""))),w=window.KTM.money.nextPriceInputState(H.target.value,d),R=String((at=w.digits)!=null?at:""),Z=Number(R),be=Number.isFinite(Z)?Math.max(0,Math.trunc(Z)):0,ie=Array.isArray(le.variants)?[...le.variants]:[],ve={...ie[m]||{},options:Array.isArray((ee=ie[m])==null?void 0:ee.options)?[...ie[m].options]:[]};return ve.options[z]={...ve.options[z]||{},label:String(((Ie=ve.options[z])==null?void 0:Ie.label)||""),price:be,priceDigits:R},ie[m]=ve,{...le,variants:ie}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{T(H=>{var w;const le=Array.isArray(H.variants)?[...H.variants]:[],d={...le[m]||{},options:Array.isArray((w=le[m])==null?void 0:w.options)?[...le[m].options]:[]};return d.options.splice(z,1),le[m]=d,{...H,variants:le}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{T(A=>{var H;const z=Array.isArray(A.variants)?[...A.variants]:[],X={...z[m]||{},options:Array.isArray((H=z[m])==null?void 0:H.options)?[...z[m].options]:[]},K=Te(A.price);return X.options.push({label:"",price:K,priceDigits:String(K)}),z[m]=X,{...A,variants:z}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{T(u=>{const m=Te(u.price),A=Array.isArray(u.variants)?[...u.variants]:[],z=String(m);return A.push({name:"Size",options:[{label:"S",price:m,priceDigits:z},{label:"M",price:m,priceDigits:z},{label:"L",price:m,priceDigits:z}]}),{...u,variants:A}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:se,disabled:!Array.isArray(_.variants)||_.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:_.image,onChange:u=>T({..._,image:u.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:B,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:ae,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ae?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:y,video:N,onClose:$,onSave:B}){const[P,_]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[T,ae]=useState(!1),[ne,Y]=useState("");useEffect(()=>{N?(_({title:N.title||"",youtube_url:`https://www.youtube.com/watch?v=${N.youtubeId}`,thumbnail_url:N.thumb||"",sort_order:N.sortOrder||0}),Y(N.thumb)):(_({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Y(""))},[N,y]);const we=pe=>{const je=pe.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return je?je[1]:null},Te=pe=>{_({...P,youtube_url:pe});const je=we(pe);je&&Y(`https://img.youtube.com/vi/${je}/hqdefault.jpg`)},re=async pe=>{pe.preventDefault(),ae(!0),await B(P),ae(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},N?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:re},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:P.youtube_url,onChange:pe=>Te(pe.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),ne&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:ne,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:P.title,onChange:pe=>_({...P,title:pe.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sort_order,onChange:pe=>_({...P,sort_order:parseInt(pe.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:P.thumbnail_url,onChange:pe=>_({...P,thumbnail_url:pe.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:T},T?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[y,N]=useState(!1),[$,B]=useState(""),[P,_]=useState(null),[T,ae]=useState("search"),[ne,Y]=useState(()=>loadAdminPins()),[we,Te]=useState(()=>loadAdminRecent()),[re,pe]=useState(null),[je,se]=useState(""),[C,Ee]=useState([]),[Xe,ze]=useState(null),[ge,Me]=useState(!1),[Se,Fe]=useState(null),[tt,mt]=useState(!0),[ke,Qe]=useState([]),[ct,u]=useState(!1),[m,A]=useState(null),[z,X]=useState(!1),[K,H]=useState(!1),[le,d]=useState(""),[w,R]=useState(()=>loadAdminSettings()),[Z,be]=useState(null),[ie,ve]=useState([]);useEffect(()=>{const l=localStorage.getItem("ktm_admin_session");if(l)try{const O=JSON.parse(l);O.expiry>Date.now()?(N(!0),_(O.user)):localStorage.removeItem("ktm_admin_session")}catch(O){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{y&&Oe()},[y]),useEffect(()=>{const l=()=>{try{const E=document.querySelector(".admin-topbar");if(!E)return;const he=E.getBoundingClientRect(),Ce=Math.max(0,Math.round(he.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${Ce+10}px`)}catch(E){}};l(),window.addEventListener("resize",l);const O=setTimeout(l,0);return()=>{clearTimeout(O),window.removeEventListener("resize",l)}},[y,T]),useEffect(()=>{if(!y)return;const l=E=>{if(!E)return!1;const he=String(E.tagName||"").toLowerCase();return!!(he==="input"||he==="textarea"||he==="select"||E.isContentEditable)},O=E=>{if(!E||E.ctrlKey||E.metaKey||E.altKey||l(E.target))return;const he=E.key;(he==="/"||he==="N"||he==="n"||he==="Escape"||he==="j"||he==="J"||he==="k"||he==="K")&&(he==="/"&&E.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:he}})))};return document.addEventListener("keydown",O),()=>document.removeEventListener("keydown",O)},[y]),useEffect(()=>{y&&Te(l=>{const O=Array.isArray(l)?l:[],E=[T,...O.filter(he=>he!==T)].slice(0,8);return saveAdminRecent(E),E})},[y]);const ye=l=>{const O=String(l||"").trim();O&&Te(E=>{const he=Array.isArray(E)?E:[],Ce=[O,...he.filter(V=>V!==O)].slice(0,8);return saveAdminRecent(Ce),Ce})},Je=l=>{const O=String(l||"").trim();O&&Y(E=>{const he=Array.isArray(E)?E:[],V=he.includes(O)?he.filter(Ve=>Ve!==O):[O,...he].slice(0,10);return saveAdminPins(V),V})};useEffect(()=>{if(!y)return;let l=!1;return(async()=>{try{const O=await fetchAdminSettingsFromServer();if(l)return;R(O),saveAdminSettings(O)}catch(O){}})(),()=>{l=!0}},[y]);const at=async(l,O)=>{B("");try{const E=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:l,password:O},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),he={user:E.user,token:E.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(he)),_(E.user),N(!0)}catch(E){B(E.message)}},ee=()=>{localStorage.removeItem("ktm_admin_session"),N(!1),_(null),Ee([]),ze(null)},Ie=(l,O="success",E=null)=>{const he=Date.now()+Math.floor(Math.random()*1e3);if(l&&typeof l=="object"){const V=l;Qe(Ve=>[...Ve,{id:he,message:String(V.message||""),type:String(V.type||O||"success"),actionLabel:V.actionLabel||null,onAction:typeof V.onAction=="function"?V.onAction:null,durationMs:V.durationMs||null}]);return}const Ce=E&&typeof E=="object"?E:null;Qe(V=>[...V,{id:he,message:String(l||""),type:String(O||"success"),actionLabel:(Ce==null?void 0:Ce.actionLabel)||null,onAction:typeof(Ce==null?void 0:Ce.onAction)=="function"?Ce.onAction:null,durationMs:(Ce==null?void 0:Ce.durationMs)||null}])},lt=l=>{Qe(O=>O.filter(E=>E.id!==l))},Oe=async(l=null)=>{mt(!0);try{const O=l?`${API_BASE}/api/albums?parent_id=${l}`:`${API_BASE}/api/albums?parent_id=root`,E=await window.KTM.api.getJSON(O,"L\u1ED7i t\u1EA3i danh s\xE1ch album");Ee(Array.isArray(E)?E:[])}catch(O){console.error(O),Ie("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}mt(!1)},it=()=>{Fe(null),Me(!0)},bt=l=>{Re(l),X(!0)},$t=async(l,O="modal")=>{try{const E=Se&&Se.uuid;!E&&Z&&(l.parent_id=Z.uuid);const he=E?`${API_BASE}/api/albums/${Se.uuid||Se.id}`:`${API_BASE}/api/albums`;E?await window.KTM.api.putJSON(he,l,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(he,l,"L\u1ED7i t\u1EA1o"),Ie(E?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),O==="drawer"?(X(!1),Fe(null),Oe(Z==null?void 0:Z.uuid),E&&m&&A({...m,...l})):(Me(!1),Fe(null),Oe(Z==null?void 0:Z.uuid))}catch(E){Ie(E.message,"danger")}},vt=l=>{ze(l)},g=l=>{if(l==="root")ve([]),be(null),Oe(null);else if(l){const O=ie.findIndex(E=>E.uuid===l.uuid);O>=0&&(ve(ie.slice(0,O+1)),be(l),Oe(l.uuid))}else{const O=[...ie];O.pop();const E=O[O.length-1]||null;ve(O),be(E),Oe(E==null?void 0:E.uuid)}},L=async l=>{const O=`X\xF3a folder "${l.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(O))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${l.uuid||l.id}`,"L\u1ED7i x\xF3a album"),Ie("\u0110\xE3 x\xF3a","success"),Oe(Z==null?void 0:Z.uuid)}catch(E){Ie("L\u1ED7i x\xF3a album","danger")}},Re=async l=>{l&&(u(!0),d(""),H(!1),X(!1),A(l))},rt=()=>{u(!1),H(!1),d(""),X(!1),A(null)},xt=l=>{X(!0)};if(!y)return React.createElement(LoginPage,{onLogin:at,error:$});const De=()=>{const l=new Date,O=l.getFullYear(),E=String(l.getMonth()+1).padStart(2,"0");return`${O}-${E}`};function Ze(){const[l,O]=useState(()=>{var V;return String((V=w==null?void 0:w.ship_percent)!=null?V:DEFAULT_SHIP_PERCENT)}),[E,he]=useState(!1);return useEffect(()=>{var V;O(String((V=w==null?void 0:w.ship_percent)!=null?V:DEFAULT_SHIP_PERCENT))},[w==null?void 0:w.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async V=>{V.preventDefault(),he(!0);const Ve=saveAdminSettings({ship_percent:l});try{const h=await saveAdminSettingsToServer(Ve);R(h),saveAdminSettings(h),Ie("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(h){R(Ve),Ie("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{he(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:l,min:"0",max:"100",step:"0.01",onChange:V=>O(V.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:E},E?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function x(){const[l,O]=useState(De()),[E,he]=useState(!0),Ce=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[V,Ve]=useState(Ce),h=useRef(new Map),Le=normalizeShipPercent(w==null?void 0:w.ship_percent),{formatNumber:Ae,formatVND:et}=window.KTM.money,Tt=async(fe,dt=!1)=>{var j,f;const Rt=String(fe||"").trim();if(!Rt)return Ce();const Pe=`${Rt}|${Le}`,s=(j=h.current)==null?void 0:j.get(Pe);if(!dt&&s)return s;const k=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(Rt)}&ship_percent=${encodeURIComponent(Le)}`,M=await window.KTM.api.getJSON(k,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),G=M!=null&&M.stats&&(M!=null&&M.meta)?M.stats:M,Q=G&&typeof G=="object"?G:Ce();return(f=h.current)==null||f.set(Pe,Q),Q},St=async(fe=!1)=>{he(!0);try{const dt=await Tt(l,fe);Ve(dt)}catch(dt){console.error("Load stats error:",dt),Ve(Ce())}finally{he(!1)}};return useEffect(()=>{St()},[l,Le]),React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:E}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>St(!0),disabled:E},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:l,onChange:fe=>O(fe.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",Le,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),Ae(V.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),Ae(V.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),Ae(V.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",Ae(V.statusCounts.paid),"/",Ae(V.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ae(V.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},et(V.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},et(V.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},et(V.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},et(V.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",V.avgQtyPerOrder?V.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},Ae(V.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},Ae(V.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},Ae(V.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},Ae(V.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},Ae(V.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},Ae(V.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},Ae(V.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,Ae(V.statusCounts.draft)),React.createElement("td",null,Ae(V.statusCounts.pending)),React.createElement("td",null,Ae(V.statusCounts.processing)),React.createElement("td",null,Ae(V.statusCounts.canceled)),React.createElement("td",null,Ae(V.statusCounts.done)),React.createElement("td",null,Ae(V.statusCounts.paid)),React.createElement("td",null,Ae(V.statusCounts.other)),React.createElement("td",null,Ae(V.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},V.products.slice(0,10).map(fe=>React.createElement("div",{key:fe.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},fe.product_name),React.createElement("div",{className:"text-muted small text-truncate"},fe.product_code?`#${fe.product_code} \u2022 `:"",Ae(fe.orders)," \u0111\u01A1n \u2022 ",Ae(fe.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},et(fe.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,V.products.slice(0,10).map(fe=>React.createElement("tr",{key:fe.product_id},React.createElement("td",null,fe.product_name),React.createElement("td",null,fe.product_code||"\u2014"),React.createElement("td",null,Ae(fe.orders)),React.createElement("td",null,Ae(fe.quantity)),React.createElement("td",{className:"fw-semibold"},et(fe.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},V.customers.slice(0,10).map(fe=>React.createElement("div",{key:fe.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},fe.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},fe.phone||"\u2014"," \u2022 ",Ae(fe.orders)," \u0111\u01A1n \u2022 ",Ae(fe.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},et(fe.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,V.customers.slice(0,10).map(fe=>React.createElement("tr",{key:fe.key},React.createElement("td",null,fe.customer_name||"\u2014"),React.createElement("td",null,fe.phone||"\u2014"),React.createElement("td",null,Ae(fe.orders)),React.createElement("td",null,Ae(fe.quantity)),React.createElement("td",{className:"fw-semibold"},et(fe.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},V.days.map(fe=>React.createElement("div",{key:fe.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},fe.day),React.createElement("div",{className:"text-muted small"},Ae(fe.orders)," \u0111\u01A1n \u2022 ",Ae(fe.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",Ae(fe.doneOrders)," \u2022 ",et(fe.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},et(fe.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,V.days.map(fe=>React.createElement("tr",{key:fe.day},React.createElement("td",null,fe.day),React.createElement("td",null,Ae(fe.orders)),React.createElement("td",null,Ae(fe.quantity)),React.createElement("td",{className:"fw-semibold"},et(fe.revenue)),React.createElement("td",null,Ae(fe.doneOrders)),React.createElement("td",{className:"fw-semibold"},et(fe.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:T,onMenuChange:l=>{ye(l),ae(l),l==="albums"&&(be(null),ve([]),Oe(null))},onLogout:ee,currentUser:P,pinnedMenus:ne,recentMenus:we,onTogglePin:Je}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const O={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[T]||{title:"KTM Admin",icon:"fa-tractor",sub:""},E=(P==null?void 0:P.username)||(P==null?void 0:P.name)||(P==null?void 0:P.email)||"Admin",he=(()=>{if(T!=="albums")return"";const Ce=[];return Ce.push("Root"),Array.isArray(ie)&&ie.length>0&&Ce.push(...ie.map(V=>V==null?void 0:V.title).filter(Boolean)),Xe!=null&&Xe.title&&Ce.push(Xe.title),Ce.length>0?Ce.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${O.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},O.title),React.createElement("div",{className:"admin-page-subtitle"},he||O.sub))),React.createElement("div",{className:"admin-topbar-right"},T==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:it,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:E},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},E)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:ee,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},T==="albums"&&!Xe&&React.createElement(AlbumList,{albums:C,loading:tt,currentFolder:Z,breadcrumb:ie,onSelect:vt,onCreate:it,onEdit:bt,onDelete:L,onBack:g}),T==="search"&&React.createElement(SearchCenter,{showToast:Ie,onNavigate:(l,O,E)=>{ae(l),l==="orders"&&O==="create"&&(pe(Date.now()),se((E==null?void 0:E.productId)||""))}}),T==="albums"&&Xe&&React.createElement(AlbumDetail,{album:Xe,parentAlbum:ie.length>0?ie[ie.length-1]:null,onBack:()=>{if(Xe.parentId){const l=ie.findIndex(O=>O.uuid===Xe.parentId);l>=0?ze(ie[l]):ze(null)}else ze(null)},onRefresh:()=>Oe(Z==null?void 0:Z.uuid),showToast:Ie,onNavigateToFolder:l=>{ve(O=>[...O,Xe]),ze(l)},onEditSubfolder:l=>{Fe(l),Me(!0)}}),T==="videos"&&React.createElement(VideoList,{showToast:Ie}),T==="products"&&React.createElement(ProductManager,{showToast:Ie,settings:w}),T==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:re,autoOpenCreateProductId:je,showToast:Ie}),T==="stats"&&React.createElement(x,null),T==="settings"&&React.createElement(Ze,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${T==="search"?"active":""}`,onClick:l=>{l.preventDefault(),ae("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${T==="albums"?"active":""}`,onClick:l=>{l.preventDefault(),ae("albums"),ze(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${T==="videos"?"active":""}`,onClick:l=>{l.preventDefault(),ae("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${T==="products"?"active":""}`,onClick:l=>{l.preventDefault(),ae("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${T==="orders"?"active":""}`,onClick:l=>{l.preventDefault(),ae("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${T==="stats"?"active":""}`,onClick:l=>{l.preventDefault(),ae("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:ge,album:Se,parentId:Z==null?void 0:Z.uuid,onClose:()=>Me(!1),onSave:$t}),React.createElement(AdminDrawer,{open:ct,title:m?m.title:"Album",subtitle:m?`${m.subfolderCount||0} subfolder \u2022 ${m.count||0} \u1EA3nh`:"",onClose:rt,footer:z?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{X(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{m&&(Fe(m),$t({slug:m.id||"",title:m.title||"",description:m.description||"",cover_url:m.cover||"",parent_id:m.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):m?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(m.title),Ie("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>xt(m)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{m&&confirm(`X\xF3a folder "${m.title}"?`)&&(L(m),rt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},z&&m?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:m.title,onChange:l=>A({...m,title:l.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:m.description,onChange:l=>A({...m,description:l.target.value})}))):m?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},m.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},m.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},m.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},m.count||0))),m.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,m.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},ke.map(l=>React.createElement(Toast,{key:l.id,message:l.message,type:l.type,actionLabel:l.actionLabel,onAction:l.onAction,durationMs:l.durationMs,onClose:()=>lt(l.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:y,autoOpenCreateProductId:N,showToast:$}){const[B,P]=useState([]),[_,T]=useState(0),[ae,ne]=useState(!1),[Y,we]=useState(!1),[Te,re]=useState([]),[pe,je]=useState(!0),[se,C]=useState(!1),[Ee,Xe]=useState([]),[ze,ge]=useState(!1),[Me,Se]=useState(""),[Fe,tt]=useState([]),[mt,ke]=useState(!1),[Qe,ct]=useState(""),[u,m]=useState(!1),[A,z]=useState(null),[X,K]=useState(null),[H,le]=useState(!1),[d,w]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[R,Z]=useState(""),[be,ie]=useState(!1),[ve,ye]=useState(!1),[Je,at]=useState(!1),[ee,Ie]=useState(null),[lt,Oe]=useState(!1),[it,bt]=useState(""),[$t,vt]=useState(!1),g=useRef(0),[L,Re]=useState(!1),[rt,xt]=useState(null),[De,Ze]=useState(null),[x,l]=useState(!1),[O,E]=useState([]),[he,Ce]=useState(!1),[V,Ve]=useState([]),[h,Le]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Ae,et]=useState([""]),[Tt,St]=useState(null),fe=useRef({}),[dt,Rt]=useState([]),[Pe,s]=useState(null),k=useRef(null),M=useRef(null),G=useRef(0),Q=useRef(null),j=useRef(0),f=useRef(new Map),J=useRef(null),de=useRef(0),me=useRef(new Map),te=useRef(new Map),xe=useRef(""),ot=useRef(null),Ue=useRef(null),ut=useRef(0),jt=useRef(null),yt=9,kt=150,zt=250,Va=3*60*1e3,$a=24*60*60*1e3,Ut=5*60*1e3,ua="ktm_customer_lookup_cache_v1",Ta=200,Ht=3,Xt=3,D=1,F=24*60*60*1e3,W=120,oe=5*60*1e3,Ne=80,ue=2,Ke=4,qe=60,ce=React.useMemo(()=>String(Me||"").trim().length>0,[Me]),pt=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),ft=e=>{xt(e),Re(!0)},ht=()=>{Re(!1),setTimeout(()=>xt(null),180)};useEffect(()=>{const e="admin-sheet-open";return L?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[L]),useEffect(()=>{if(!L)return;const e=a=>{a.key==="Escape"&&ht()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[L]);const Ct=e=>String(e||"").replace(/\s+/g," ").trim(),It=e=>String(e||"").replace(/[^0-9]+/g,""),gt=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/F)}catch(a){return 0}},At=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:gt(e)>=Ht,Nt=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},_t=e=>{if(Nt(e==null?void 0:e.status)!=="draft")return null;const t=Xt-gt(e);return Number.isFinite(t)?t:null},Lt=e=>{const a=_t(e);return Number.isFinite(a)?a>0&&a<=D:!1},Mt=e=>{Le({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),et([""]),Ze(null),St(null)};useEffect(()=>{const e=a=>{var n;if(Tt==null)return;const t=(n=fe.current)==null?void 0:n[Tt];t&&!t.contains(a.target)&&St(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Tt]);const ia=e=>window.KTM.money.parseMoney(e),pa=e=>window.KTM.money.parseSignedMoney(e),Ge=e=>window.KTM.money.formatVND(e),Et=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var i,o;return{amount:String((i=n==null?void 0:n.amount)!=null?i:""),note:String((o=n==null?void 0:n.note)!=null?o:"")}});return t.length?t:[{amount:"",note:""}]},dn=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var i,o;return{amount:(n==null?void 0:n.amount)===0?"":String((i=n==null?void 0:n.amount)!=null?i:""),note:String((o=n==null?void 0:n.note)!=null?o:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},Qt=e=>(Array.isArray(e)?e:[]).map(t=>({amount:pa(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),ja=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Qt(a),n=Yt(t),i=(()=>{if(!t.length)return"";const o=t.map(v=>String((v==null?void 0:v.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:i}},Yt=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),Ia=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},$n=e=>window.KTM.money.parseShipFeeFromNote(e),Zt=e=>window.KTM.phone.isValid(e),nt=e=>window.KTM.phone.normalize(e),Ba=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},mn=(e,a)=>{var o;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const i=new Map(t.map(v=>{var c;return[String((c=v==null?void 0:v.id)!=null?c:""),v]}));for(const v of n){const c=String((o=v==null?void 0:v.id)!=null?o:"");c&&i.set(c,v)}return Array.from(i.values())},ba=async e=>{if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const a=await Ba(e.id);if(a&&typeof a=="object")return P(t=>Array.isArray(t)?t.map(n=>String(n==null?void 0:n.id)===String(e.id)?a:n):t),a}catch(a){console.error("Fetch order by id error:",a)}return e},un=()=>{var e;try{const a=localStorage.getItem(ua);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[i,o]of n)!i||!o||typeof o!="object"||(e=te.current)==null||e.set(String(i),o)}catch(a){}},Oa=()=>{try{const e=te.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,i])=>n&&i&&typeof i=="object"&&Number.isFinite(i.ts)).sort((n,i)=>(Number(i[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,Ta),t={};for(const[n,i]of a)t[n]=i;localStorage.setItem(ua,JSON.stringify(t))}catch(e){}};useEffect(()=>{un()},[]);const za=e=>{const a=nt(e);if(!a)return null;const t=Array.isArray(B)?B:[];let n=null,i=-1;for(const o of t){if(!o||nt(o.phone||"")!==a)continue;const v=new Date(o.created_at).getTime(),c=Number.isFinite(v)?v:0;c>=i&&(i=c,n=o)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},Ja=(e,a)=>{e&&Le(t=>a&&nt(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},pn=e=>{const a=za(e);if(!a)return;const t=nt(e);Le(n=>{if(t&&nt(n.phone)!==t)return n;const i={...n};return!String(n.customer_name||"").trim()&&a.name&&(i.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(i.address=a.address),i})},bn=(e,a,t)=>{var n;try{const i=nt(e);if(!i)return;const o=String(a||"").trim(),v=String(t||"").trim();if(!o&&!v)return;(n=te.current)==null||n.set(i,{ts:Date.now(),status:"found",customer:{phone:i,name:o||null,address:v||null}}),Oa()}catch(i){}},ha=async e=>{var i,o,v;const a=nt(e);if(!a)return;pn(a);const t=(i=te.current)==null?void 0:i.get(a);if(t&&Number.isFinite(t.ts)){const c=Date.now()-t.ts,S=t.status==="found"?$a:Ut;if(c>=0&&c<=S){Ze({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&Ja(t.customer,a);return}}const n=++G.current;Ze({status:"loading",phone:a});try{const c=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(G.current!==n)return;if(c&&c.exists&&c.customer){(o=te.current)==null||o.set(a,{ts:Date.now(),status:"found",customer:c.customer}),Oa(),Ze({status:"found",phone:a,customer:c.customer}),Ja(c.customer,a);return}(v=te.current)==null||v.set(a,{ts:Date.now(),status:"not-found",customer:null}),Oa(),Ze({status:"not-found",phone:a})}catch(c){if(G.current!==n)return;console.error("Customer lookup error:",c),Ze({status:"error",phone:a})}},Ga=e=>{const a=nt(e),t=za(a);Le(i=>{const o={...i,phone:a};return t&&(!String(i.customer_name||"").trim()&&t.name&&(o.customer_name=t.name),!String(i.address||"").trim()&&t.address&&(o.address=t.address)),o}),l(!1),M.current&&(clearTimeout(M.current),M.current=null);const n=a;if(n.length<yt){Ze(null);return}if(Zt(n)&&n!==xe.current){xe.current=n,ha(n);return}M.current=setTimeout(()=>{const i=nt(a);Zt(i)&&i!==xe.current&&(xe.current=i,ha(i))},kt)},Wa=()=>{const e=nt(h.phone);e.length<yt||Zt(e)&&e!==xe.current&&(xe.current=e,ha(e))};useEffect(()=>(ve?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[ve]);const fa=Array.isArray(h.items)?h.items.length:0;useEffect(()=>{if(!ve){ut.current=fa;return}fa>ut.current&&setTimeout(()=>{const e=ot.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),ut.current=fa},[ve,fa]),useEffect(()=>()=>{M.current&&(clearTimeout(M.current),M.current=null),Q.current&&(clearTimeout(Q.current),Q.current=null)},[]),useEffect(()=>{if(!ve)return;Q.current&&(clearTimeout(Q.current),Q.current=null);const e=nt((h==null?void 0:h.phone)||"");if(!Zt(e)){E([]),Ce(!1);return}return Q.current=setTimeout(async()=>{var i;const a=String(e),t=(i=f.current)==null?void 0:i.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=Va){E(Array.isArray(t.orders)?t.orders:[]),Ce(!1);return}const n=++j.current;Ce(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,v=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(j.current!==n)return;const c=Array.isArray(v)?v:Array.isArray(v==null?void 0:v.orders)?v.orders:[];E(c);try{const S=f.current;if(S&&typeof S.set=="function"&&(S.set(a,{ts:Date.now(),orders:c}),S.size>100)){const p=Array.from(S.entries()).sort((b,I)=>{var U,q;return(Number((U=b==null?void 0:b[1])==null?void 0:U.ts)||0)-(Number((q=I==null?void 0:I[1])==null?void 0:q.ts)||0)}),r=Math.max(0,p.length-100);for(let b=0;b<r;b++)S.delete(p[b][0])}}catch(S){}}catch(o){if(j.current!==n)return;console.error("Phone history fetch error:",o),E([])}finally{if(j.current!==n)return;Ce(!1)}},zt),()=>{Q.current&&(clearTimeout(Q.current),Q.current=null)}},[ve,h==null?void 0:h.phone]),useEffect(()=>{hn()},[]),useEffect(()=>{ce||Jt()},[d,ce]),useEffect(()=>{Na()},[]),useEffect(()=>{y&&k.current!==y&&(k.current=y,La(N))},[y]);const Pt=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",ea=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",Ua=React.useMemo(()=>window.KTM.orders.sortOrders(B),[B]),Da=React.useMemo(()=>window.KTM.orders.sortOrders(Te),[Te]),ga=React.useMemo(()=>{const a=(Array.isArray(Da)?Da:[]).filter(t=>At(t));return a.sort((t,n)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),a},[Da]),Xa=React.useMemo(()=>{const a=(Array.isArray(Ee)?Ee:[]).filter(t=>Lt(t));return a.sort((t,n)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),a},[Ee]),ra=React.useMemo(()=>be?ga:Ua,[be,ga,Ua]),va=React.useMemo(()=>{if(be)return ra;const e=String(R||"").trim();return e?(Array.isArray(ra)?ra:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):ra},[ra,R,be]),Qa=React.useMemo(()=>window.KTM.orders.sortOrders(Fe),[Fe]),Kt=React.useMemo(()=>ce?Qa:va,[va,ce,Qa]),Vt=React.useMemo(()=>{const e=Array.isArray(Kt)?Kt:[],a={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const n=Nt(t==null?void 0:t.status);n==="draft"?a.draft+=1:n==="pending"?a.pending+=1:n==="processing"?a.processing+=1:n==="done"?a.done+=1:n==="paid"?a.paid+=1:n==="canceled"?a.canceled+=1:a.other+=1}return a},[Kt]),Ya=React.useMemo(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`},[]),ya=e=>{if(ce&&Se(""),e==="thisMonth"){ie(!1),Z(""),w(Ya);return}if(e==="overduePending"){w(""),ie(!0),Z("pending");return}if(e==="draftExpiring"){ie(!1),Z("draft"),w(""),Na();return}if(e==="all"){ie(!1),Z(""),w(Ya);return}},ta=e=>window.KTM.date.formatDateTime(e),hn=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Rt(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Rt([])}},Jt=async()=>{je(!0),we(!1);try{const a=new URLSearchParams;d&&a.set("month",String(d)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(qe)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),i=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],o=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;P(Array.isArray(i)?i:[]),T(Array.isArray(i)?i.length:0),ne(!!(o!=null&&o.hasMore)),Na()}catch(a){console.error("Load orders error:",a),P([]),T(0),ne(!1)}finally{je(!1),we(!1)}},fn=async()=>{if(!(pe||Y||ce)&&ae){we(!0);try{const e=new URLSearchParams;d&&e.set("month",String(d)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(qe)),e.set("offset",String(_));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],i=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;P(o=>mn(o,Array.isArray(n)?n:[])),T(o=>o+(Array.isArray(n)?n.length:0)),ne(!!(i!=null&&i.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{we(!1)}}},Za=async e=>{var i;const a=Ct(e);if(!a){tt([]),ct(""),ke(!1);return}const t=It(a);if(a.length<ue&&t.length<Ke){tt([]),ct(`Nh\u1EADp \xEDt nh\u1EA5t ${ue} k\xFD t\u1EF1 (ho\u1EB7c ${Ke} s\u1ED1) \u0111\u1EC3 search nhanh`),ke(!1);return}try{const o=(i=me.current)==null?void 0:i.get(a);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=oe){tt(Array.isArray(o.results)?o.results:[]),ct(""),ke(!1);return}}catch(o){}const n=++de.current;ke(!0),ct("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,v=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(de.current!==n)return;const c=Array.isArray(v)?v:[];tt(c);try{const S=me.current;if(S&&typeof S.set=="function"&&(S.set(a,{ts:Date.now(),results:c}),S.size>Ne)){const p=Array.from(S.entries()).sort((b,I)=>{var U,q;return(Number((U=b==null?void 0:b[1])==null?void 0:U.ts)||0)-(Number((q=I==null?void 0:I[1])==null?void 0:q.ts)||0)}),r=Math.max(0,p.length-Ne);for(let b=0;b<r;b++)S.delete(p[b][0])}}catch(S){}}catch(o){if(de.current!==n)return;console.error("Order search error:",o),tt([]),ct((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if(de.current!==n)return;ke(!1)}};useEffect(()=>{J.current&&(clearTimeout(J.current),J.current=null);const e=Ct(Me);if(!e){tt([]),ct(""),ke(!1);return}return be&&ie(!1),J.current=setTimeout(()=>{Za(e)},W),()=>{J.current&&(clearTimeout(J.current),J.current=null)}},[Me]);const Na=async()=>{C(!0),ge(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Ht)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(D)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);re(Array.isArray(e)?e:[]),Xe(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),re([]),Xe([])}finally{C(!1),ge(!1)}},Ra=async e=>{const a=await ba(e);if(!a)return;s(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(c=>{var S,p,r,b;return{product_id:(c==null?void 0:c.product_id)||"",quantity:Number((S=c==null?void 0:c.quantity)!=null?S:1)||1,unit_price:(()=>{var q;const I=(q=c==null?void 0:c.unit_price)!=null?q:c==null?void 0:c.unitPrice,U=I==null||I===""?NaN:Number(I);return Number.isFinite(U)?Math.trunc(U):null})(),variant:String((p=c==null?void 0:c.variant)!=null?p:"").trim(),variant_json:(b=(r=c==null?void 0:c.variant_json)!=null?r:c==null?void 0:c.variantJson)!=null?b:null}}).filter(c=>c.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=dn(a),i=Qt(n),o=Yt(i),v=Ia(i);Le({customer_name:a.customer_name||"",phone:nt(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:o,adjustment_note:v||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),et(new Array(t.length?t.length:1).fill("")),Ve(new Array(t.length?t.length:1).fill(!0)),Ze(null),ye(!1),Ie(a),at(!0),bt(""),Oe(!1),vt(!0),a.phone&&ha(nt(a.phone))},oa=async e=>{if(!e)return;at(!0),bt(""),Oe(!0),vt(!1),Ie(e);const a=++g.current;try{const t=await ba(e);if(g.current!==a)return;Ie(t||e)}catch(t){if(g.current!==a)return;bt((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(g.current!==a)return;Oe(!1)}},gn=()=>{u||H||(at(!1),Oe(!1),bt(""),vt(!1),s(null),Mt(""),l(!1),Ve([]))};function La(e){at(!1),vt(!1),Oe(!1),bt(""),s(null),Mt(e||""),l(!1),Ve([]),ye(!0)}const Ea=()=>{u||H||(ye(!1),s(null),Mt(""),l(!1),Ve([]))},en=async()=>{var c,S,p;if(!Pe||H||u)return;const e=(Array.isArray(B)?B:[]).find(r=>String(r==null?void 0:r.id)===String(Pe))||null,a=String((e==null?void 0:e.status)||(h==null?void 0:h.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const r="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof $=="function"?$(r,"warning"):alert(r);return}const t=nt(h.phone),i=(Array.isArray(h.items)?h.items:[]).map((r,b)=>{var I,U;return{idx:b,product_id:String((r==null?void 0:r.product_id)||"").trim(),quantity:Number((I=r==null?void 0:r.quantity)!=null?I:0),variant:String((r==null?void 0:r.variant)||"").trim()||null,variant_json:(U=r==null?void 0:r.variant_json)!=null?U:null,unit_price:(()=>{const q=r==null?void 0:r.unit_price,$e=q===""||q==null?NaN:Number(q);if(Number.isFinite($e))return Math.max(0,Math.trunc($e));const _e=Ot(r==null?void 0:r.product_id),st=r!=null&&r.variant_json&&typeof r.variant_json=="object"?r.variant_json:null;return aa(_e,st)})()}}).filter(r=>r.product_id&&Number.isFinite(r.quantity)&&r.quantity>0);if(i.length<2){const r="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof $=="function"?$(r,"warning"):alert(r);return}const o=[],v=[];for(const r of i){const b=!!V[r.idx],I={product_id:r.product_id,quantity:r.quantity,unit_price:r.unit_price,variant:r.variant,variant_json:r.variant_json};b?o.push(I):v.push(I)}if(!o.length||!v.length){const r="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof $=="function"?$(r,"warning"):alert(r);return}le(!0);try{const r=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],b=Qt(r),I=Yt(b),U=Ia(b),q={customer_name:h.customer_name,phone:t,address:h.address,note:(h.note||"").trim(),adjustment_amount:I,adjustment_note:U,adjustment_items:b,status:"processing",items:o,product_id:o[0].product_id,quantity:o[0].quantity,split_seq:1},$e=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,q,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),_e=(p=(S=$e==null?void 0:$e.id)!=null?S:(c=$e==null?void 0:$e.order)==null?void 0:c.id)!=null?p:null;if(!_e)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const st={id:Pe,customer_name:h.customer_name,phone:t,address:h.address,note:(h.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:v,product_id:v[0].product_id,quantity:v[0].quantity,parent_order_id:String(_e),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${Pe}`,st,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Ea(),Jt();const He=_e?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${_e}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof $=="function"?$(He,"success"):alert(He)}catch(r){console.error(r);const b=(r==null?void 0:r.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof $=="function"?$(b,"danger"):alert(b)}finally{le(!1)}},tn=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=dt.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Ft=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},vn=e=>{const t=Ft(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},an=React.useMemo(()=>(Array.isArray(dt)?dt:[]).map((e,a)=>{var p,r,b,I,U,q;const t=Ft((p=e==null?void 0:e.name)!=null?p:""),n=Ft((r=e==null?void 0:e.code)!=null?r:""),i=Ft((b=e==null?void 0:e.category)!=null?b:""),o=Ft((I=e==null?void 0:e.note)!=null?I:""),v=Ft((U=e==null?void 0:e.id)!=null?U:""),c=Ft((q=e==null?void 0:e.stt)!=null?q:""),S=`${t} ${n} ${i} ${o} ${v} ${c}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:i,note:o,haystackAll:S}}),[dt]),yn=(e,a,t)=>{var b,I,U,q,$e;const n=Array.isArray(a)?a:[],i=Ft(t).trim();if(!n.length&&!i)return 0;const o=(b=e==null?void 0:e.name)!=null?b:"",v=(I=e==null?void 0:e.code)!=null?I:"",c=(U=e==null?void 0:e.category)!=null?U:"",S=(q=e==null?void 0:e.note)!=null?q:"";if(!(($e=e==null?void 0:e.haystackAll)!=null?$e:""))return 0;let r=0;i&&(o===i&&(r+=220),o.includes(i)&&(r+=140),o.startsWith(i)&&(r+=160),v&&v===i&&(r+=180),v&&v.includes(i)&&(r+=90));for(const _e of n){if(!_e)continue;const st=new RegExp(`(?:^|\\s)${_e.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(_e)&&(r+=35),st.test(o)&&(r+=25),v&&v.includes(_e)&&(r+=20),v&&st.test(v)&&(r+=10),c&&c.includes(_e)&&(r+=12),S&&S.includes(_e)&&(r+=6)}return r>0&&o&&(r+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),r},Pa=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const i=t.length,o=n.length;if(o>i)return Pa(n,t);let v=new Array(o+1),c=new Array(o+1);for(let S=0;S<=o;S++)v[S]=S;for(let S=1;S<=i;S++){c[0]=S;const p=t.charCodeAt(S-1);for(let b=1;b<=o;b++){const I=p===n.charCodeAt(b-1)?0:1;c[b]=Math.min(v[b]+1,c[b-1]+1,v[b-1]+I)}const r=v;v=c,c=r}return v[o]},Nn=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const i=n.split(/\s+/).filter(Boolean);if(!i.length)return!1;const o=t.length<=4?1:2;for(const v of i)if(!(Math.abs(v.length-t.length)>o)&&Pa(t,v)<=o)return!0;return!1},wa=e=>{const a=Ft(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},wn=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=wa((e==null?void 0:e.name)||""),i=wa((e==null?void 0:e.code)||""),o=wa((e==null?void 0:e.category)||""),v=wa((e==null?void 0:e.note)||""),c=(p,r,b)=>{const I=String(p||"").trim();if(!I||!r.length)return 0;const U=I.length<=4?1:2;let q=1/0,$e=-1;for(let He=0;He<r.length;He++){const Dt=r[He];if(!Dt||Math.abs(Dt.length-I.length)>U)continue;const Ye=Pa(I,Dt);if(Ye<q&&(q=Ye,$e=He,Ye===0))break}if(q===1/0||q>U)return 0;let st=Math.round(b*(q===0?1:q===1?.65:.45));return $e===0?st+=Math.round(b*.25):$e===1&&(st+=Math.round(b*.12)),st};let S=0;for(const p of t){if(!p)continue;const r=c(p,n,180),b=c(p,i,120),I=c(p,o,60),U=c(p,v,30);S+=Math.max(r,b,I,U)}if(S>0){const p=((e==null?void 0:e.name)||"").length;S+=Math.max(0,60-Math.min(60,Math.floor(p/2)))}return S},Ka=React.useRef(new Map);React.useEffect(()=>{Ka.current=new Map},[dt]);const nn=e=>{var p,r;const a=String(Ae[e]||"").trim();if(!a)return dt;const{contentTokens:t,cleanedQuery:n}=vn(a);if(t.length===0)return dt;const i=Ft(a).trim(),o=Ka.current.get(i);if(o)return o;const v=[];for(const b of an){const I=b.haystackAll;I&&t.some(U=>I.includes(U))&&v.push(b)}let c=v;if(c.length<8&&t.length>0){const b=[],I=new Set(c.map(U=>{var q,$e;return String(($e=(q=U.p)==null?void 0:q.id)!=null?$e:"")+":"+String(U.originalIndex)}));for(const U of an){const q=String((r=(p=U.p)==null?void 0:p.id)!=null?r:"")+":"+String(U.originalIndex);if(I.has(q))continue;const $e=U.haystackAll;$e&&t.some(_e=>Nn(_e,$e))&&(b.push(U),I.add(q))}b.length&&(c=c.concat(b))}const S=c.map(b=>({entry:b,score:yn(b,t,n)})).map(b=>{if(b.score>0)return b;const I=wn(b.entry,t);return I>0?{...b,score:I}:b}).filter(b=>b.score>0).sort((b,I)=>I.score!==b.score?I.score-b.score:b.entry.originalIndex-I.entry.originalIndex).slice(0,40).map(b=>b.entry.p);return Ka.current.set(i,S),S},Ot=e=>{if(!e)return null;const a=String(e);return dt.find(t=>String(t==null?void 0:t.id)===a)||null},Bt=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var v;if(!t||typeof t!="object")return null;const i=String((v=t.name)!=null?v:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,o=(Array.isArray(t.options)?t.options:[]).map(c=>{var $e,_e,st,He,Dt,Ye,qt;if(!c||typeof c!="object")return null;const S=String(($e=c.label)!=null?$e:"").trim();if(!S)return null;const p=(Dt=(He=(st=(_e=c.price)!=null?_e:c.priceValue)!=null?st:c.unit_price)!=null?He:c.unitPrice)!=null?Dt:null,r=p==null||p===""?NaN:typeof p=="number"?p:typeof p=="string"?ia(p):Number(p),b=Number.isFinite(r)?Math.trunc(r):null,I=(qt=(Ye=c.price_delta)!=null?Ye:c.priceDelta)!=null?qt:null,U=Number(I),q=Number.isFinite(U)?Math.trunc(U):0;return{label:S,price:b,price_delta:q}}).filter(Boolean);return{name:i,options:o}}).filter(Boolean):[]},Tn=e=>{const a=Ot(e);return Bt(a==null?void 0:a.variants)},xa=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const i=String(t||"").trim(),o=String(n||"").trim();!i||!o||a.push(`${i}: ${o}`)}return a.join(", ")},aa=(e,a)=>{const t=ia(e==null?void 0:e.price),n=Bt(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let i=t,o=!1;for(const v of n){const c=String((v==null?void 0:v.name)||"").trim(),S=String((a==null?void 0:a[c])||"").trim();if(!c||!S)continue;const p=(Array.isArray(v.options)?v.options:[]).find(q=>String((q==null?void 0:q.label)||"").trim()===S);if(!p)continue;const r=p==null?void 0:p.price,b=r==null||r===""?NaN:Number(r);if(Number.isFinite(b)){i=Math.max(0,Math.trunc(b)),o=!0;continue}const I=p==null?void 0:p.price_delta,U=I==null||I===""?NaN:Number(I);Number.isFinite(U)&&(i+=Math.trunc(U))}return i},Fa=e=>window.KTM.orders.getOrderItems(e),sn=e=>window.KTM.orders.getOrderTotalQty(e),na=e=>window.KTM.orders.getOrderProductSummary(e,Ot),ka=e=>window.KTM.orders.getOrderItemRows(e,Ot),la=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Gt=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),xn=e=>{const a=Fa(e),t=ka(e),n=da(a),i=ca(a),o=i.fee,v=la(e),c=n+o+v,S=r=>{const b=Number(r)||0;return b>0?`+${Ge(b)}`:Ge(b)},p=[];if(e!=null&&e.customer_name&&p.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&p.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&p.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&p.push(`GHI CH\xDA: ${(e.note||"").trim()}`),p.push(""),p.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const r of t)p.push(`- ${r.name} (SL: ${r.qty})`);else{const r=na(e);r&&r!=="\u2014"&&p.push(`- ${r}`)}p.push(""),p.push(`T\u1EA0M T\xCDNH: ${Ge(n)}`),i.found&&o!==0&&p.push(`SHIP: ${Ge(o)}`);{const r=window.KTM.orders.getOrderAdjustmentItems(e),b=(Array.isArray(r)?r:[]).map(q=>{var $e;return{amount:Number(($e=q==null?void 0:q.amount)!=null?$e:0)||0,note:String((q==null?void 0:q.note)||"").trim()}}).filter(q=>q.amount!==0||!!q.note),I=Gt(e);if(v!==0||b.length>0||!!I)if(b.length===1){const q=b[0];p.push(`\u0110I\u1EC0U CH\u1EC8NH: ${S(v)}${q.note?` \u2014 ${q.note}`:""}`)}else{p.push(`\u0110I\u1EC0U CH\u1EC8NH: ${S(v)}${!b.length&&I?` \u2014 ${I}`:""}`);for(const q of b)p.push(`- ${S(q.amount)}${q.note?`: ${q.note}`:""}`)}}return p.push(`T\u1ED4NG: ${Ge(c)}`),p.filter(Boolean).join(`
`)},Sa=async e=>{try{const a=await ba(e),t=xn(a);await window.KTM.clipboard.writeText(t),typeof $=="function"?$("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof $=="function"?$("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},ca=e=>window.KTM.orders.getOrderShipInfo(e,Ot),da=e=>window.KTM.orders.getItemsSubtotal(e,Ot),qa=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},Ha=()=>d?String(d):qa(new Date),rn=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=nt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ja(e).amount,v=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(c=>{var S;return{product_id:String((c==null?void 0:c.product_id)||"").trim(),quantity:Number((S=c==null?void 0:c.quantity)!=null?S:0),variant:String((c==null?void 0:c.variant)||"").trim()}}).filter(c=>c.product_id&&Number.isFinite(c.quantity)&&c.quantity>0).sort((c,S)=>c.product_id<S.product_id?-1:c.product_id>S.product_id?1:c.variant<S.variant?-1:c.variant>S.variant?1:c.quantity-S.quantity);return JSON.stringify({name:a,phone:t,address:n,items:v,adj:i})},wt=React.useMemo(()=>{const e=nt((h==null?void 0:h.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ha()};const a=Ha(),n=(Array.isArray(O)?O:[]).filter(i=>{if(!i||Pe&&String(i.id)===String(Pe)||nt(i.phone||"")!==e)return!1;const o=qa(i.created_at);return o&&o===a}).sort((i,o)=>{const v=new Date(i.created_at).getTime(),c=new Date(o.created_at).getTime();return(Number.isFinite(c)?c:0)-(Number.isFinite(v)?v:0)});return{count:n.length,orders:n,monthKey:a}},[O,h==null?void 0:h.phone,d,Pe]),kn=e=>{var c;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=nt((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=pa((c=e==null?void 0:e.adjustment_amount)!=null?c:0),o=Fa(e),v=(Array.isArray(o)?o:[]).map(S=>{var p;return{product_id:String((S==null?void 0:S.product_id)||"").trim(),quantity:Number((p=S==null?void 0:S.quantity)!=null?p:0),variant:String((S==null?void 0:S.variant)||"").trim()}}).filter(S=>S.product_id&&Number.isFinite(S.quantity)&&S.quantity>0).sort((S,p)=>S.product_id<p.product_id?-1:S.product_id>p.product_id?1:S.variant<p.variant?-1:S.variant>p.variant?1:S.quantity-p.quantity);return JSON.stringify({name:a,phone:t,address:n,items:v,adj:i})},on=React.useMemo(()=>{if(Pe)return"";const e=nt((h==null?void 0:h.phone)||"");if(!e)return"";const a=Ha(),t=rn(h),n=Array.isArray(O)?O:[];for(const i of n){if(!i||Pe&&String(i.id)===String(Pe)||nt(i.phone||"")!==e)continue;const o=qa(i.created_at);if(!o||o!==a)continue;const v=kn(i);if(v&&v===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${i!=null&&i.id?` (#${i.id})`:""}`}return""},[O,h,d,Pe]),ln=e=>{var Dt;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),i=nt((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),i||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),i&&!Zt(i)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const c=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ye=>Ye&&Ye.product_id);c.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),c.some(Ye=>{var Wt;const qt=Number((Wt=Ye==null?void 0:Ye.quantity)!=null?Wt:0);return!Number.isFinite(qt)||qt<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const p=new Set;let r=!1;for(const Ye of c){const qt=String(Ye.product_id||"").trim(),Wt=String((Ye==null?void 0:Ye.variant)||"").trim();if(!qt)continue;const We=`${qt}||${Wt}`;if(p.has(We)){r=!0;break}p.add(We)}r&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const b=da(c),I=ca(c),U=I!=null&&I.found?Number((Dt=I==null?void 0:I.fee)!=null?Dt:0):0,q=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],$e=Qt(q),_e=Yt($e),st=$e.some(Ye=>(Number(Ye==null?void 0:Ye.amount)||0)!==0&&!String((Ye==null?void 0:Ye.note)||"").trim());I!=null&&I.found&&(U>=2e5||b>0&&U>b*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(U)}`),st&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const He=Math.abs(_e);return(He>=5e5||b>0&&He>b*.5)&&_e!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(_e)}`),{errors:a,warnings:t,canSubmit:a.length===0}},jn=React.useMemo(()=>ln(h),[h,dt]),Be=React.useMemo(()=>{var Wt;const e=String((h==null?void 0:h.customer_name)||"").trim(),a=nt((h==null?void 0:h.phone)||""),t=String((h==null?void 0:h.address)||"").trim(),n=Array.isArray(h==null?void 0:h.items)?h.items:[],i=new Map;for(const We of n){const sa=String((We==null?void 0:We.product_id)||"").trim(),_a=String((We==null?void 0:We.variant)||"").trim();if(!sa)continue;const Ma=`${sa}||${_a}`;i.set(Ma,(i.get(Ma)||0)+1)}const o=n.map(We=>{var cn;const sa=String((We==null?void 0:We.product_id)||"").trim(),_a=Number((cn=We==null?void 0:We.quantity)!=null?cn:0),Ma=sa?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",Cn=Number.isFinite(_a)&&_a>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",An=String((We==null?void 0:We.variant)||"").trim(),_n=`${sa}||${An}`,Mn=sa&&(i.get(_n)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Ma,qtyError:Cn,dupWarn:Mn}}),v=n.filter(We=>We&&We.product_id),c=da(v),S=ca(v),p=S!=null&&S.found?Number((Wt=S==null?void 0:S.fee)!=null?Wt:0):0,r=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],b=Qt(r),I=Yt(b),U=b.some(We=>(Number(We==null?void 0:We.amount)||0)!==0&&!String((We==null?void 0:We.note)||"").trim()),q=Math.abs(I),$e=U?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",_e=I!==0&&(q>=5e5||c>0&&q>c*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(I)}`:"",st=S!=null&&S.found&&(p>=2e5||c>0&&p>c*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Ge(p)}`:"",He=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Dt=a?Zt(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ye=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",qt=!He&&!Dt&&o.every(We=>!We.productError&&!We.qtyError);return{nameError:He,phoneError:Dt,addressWarn:Ye,items:o,shipAbnormalWarn:st,adjustmentNoteWarn:$e,adjustmentAbnormalWarn:_e,canSubmit:qt}},[h,dt]),Ca=async e=>{var c,S,p;const a=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",n=ln(h);if(!n.canSubmit){const r=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof $=="function"?$(r,"danger"):alert(r);return}if(!Pe&&on){const r=`${on}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(r)){(wt==null?void 0:wt.count)>0&&l(!0),setTimeout(()=>{var U;const I=document.getElementById("order-phone-input");I&&typeof I.scrollIntoView=="function"&&(I.scrollIntoView({block:"center",behavior:"smooth"}),(U=I.focus)==null||U.call(I))},0);return}}const i=nt(h.phone),v=(Array.isArray(h.items)?h.items:[]).map(r=>{var b,I;return{product_id:(r==null?void 0:r.product_id)||"",quantity:Number((b=r==null?void 0:r.quantity)!=null?b:1),variant:String((r==null?void 0:r.variant)||"").trim()||null,variant_json:(I=r==null?void 0:r.variant_json)!=null?I:null,unit_price:(()=>{const U=r==null?void 0:r.unit_price,q=U===""||U==null?NaN:Number(U);if(Number.isFinite(q))return Math.max(0,Math.trunc(q));const $e=Ot(r==null?void 0:r.product_id),_e=r!=null&&r.variant_json&&typeof r.variant_json=="object"?r.variant_json:null;return aa($e,_e)})()}}).filter(r=>r.product_id&&Number.isFinite(r.quantity)&&r.quantity>0);m(!0);try{const r=Pe,b=Pe?`${API_BASE}/api/orders/${Pe}`:`${API_BASE}/api/orders`,I=v[0],U=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],q=Qt(U),$e=Yt(q),_e=Ia(q),st={customer_name:h.customer_name,phone:i,address:h.address,note:(h.note||"").trim(),adjustment_amount:$e,adjustment_note:_e,adjustment_items:q,product_id:I.product_id,quantity:I.quantity,status:h.status,items:v,...Pe?{id:Pe}:{}};if(Pe)await window.KTM.api.putJSON(b,st,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const He=await window.KTM.api.postJSON(b,st,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");jt.current={id:(p=(S=He==null?void 0:He.id)!=null?S:(c=He==null?void 0:He.order)==null?void 0:c.id)!=null?p:null,fingerprint:rn(h),ts:Date.now()}}if(bn(i,h.customer_name,h.address),t==="drawer"){if(Mt(""),s(null),ye(!1),vt(!1),l(!1),Ve([]),Jt(),r){Oe(!0),bt("");try{const He=await Ba(r);He&&typeof He=="object"&&Ie(He)}catch(He){bt((He==null?void 0:He.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Oe(!1)}}}else a==="new"&&!Pe?(Mt(""),s(null),ye(!0)):(Mt(""),s(null),ye(!1)),Jt()}catch(r){console.error(r),typeof $=="function"?$(r.message,"danger"):alert(r.message);return}finally{m(!1)}},ma=e=>window.KTM.orders.getOrderTotalMoney(e,Ot),In=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){z(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Jt(),Na()}catch(a){console.error(a),typeof $=="function"?$(a.message,"danger"):alert(a.message)}finally{z(null)}}},Aa=async(e,a)=>{var o;const t=await ba(e),n=t==null?void 0:t.id;if(!n||!a)return;const i=Nt(t==null?void 0:t.status);K(n);try{const v=Fa(t),c=(Array.isArray(v)?v:[]).map(r=>{var b,I;return{product_id:(r==null?void 0:r.product_id)||"",quantity:Number((b=r==null?void 0:r.quantity)!=null?b:1),variant:String((r==null?void 0:r.variant)||"").trim()||null,variant_json:(I=r==null?void 0:r.variant_json)!=null?I:null,unit_price:(()=>{var $e;const U=($e=r==null?void 0:r.unit_price)!=null?$e:r==null?void 0:r.unitPrice,q=Number(U);return Number.isFinite(q)?Math.max(0,Math.trunc(q)):null})()}}).filter(r=>r.product_id&&Number.isFinite(r.quantity)&&r.quantity>0);if(!c.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const S=c[0],p={id:n,customer_name:(t==null?void 0:t.customer_name)||"",phone:nt((t==null?void 0:t.phone)||""),address:(t==null?void 0:t.address)||"",note:((t==null?void 0:t.note)||"").trim(),adjustment_amount:Number((o=t==null?void 0:t.adjustment_amount)!=null?o:0)||0,adjustment_note:(t==null?void 0:t.adjustment_note)||"",product_id:S.product_id,quantity:S.quantity,status:a,items:c};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${n}`,p,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),P(r=>Array.isArray(r)?r.map(b=>(b==null?void 0:b.id)===n?{...b,status:a}:b):r),re(r=>Array.isArray(r)?r.map(b=>(b==null?void 0:b.id)===n?{...b,status:a}:b):r),typeof $=="function"){const r=`${Pt(i)} \u2192 ${Pt(a)}`.trim();$(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${r}`,"success",{actionLabel:"Undo",durationMs:6500,onAction:()=>{!i||i===Nt(a)||Aa({...t,status:a},i)}})}}catch(v){console.error(v),typeof $=="function"?$(v.message,"danger"):alert(v.message)}finally{K(null)}};useEffect(()=>{const e=a=>{var n;const t=(n=a==null?void 0:a.detail)==null?void 0:n.key;if(t){if(t==="/"){setTimeout(()=>{var i,o;(o=(i=Ue.current)==null?void 0:i.focus)==null||o.call(i)},0);return}if(t==="N"||t==="n"){La();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&Je&&(ee!=null&&ee.id)){const i=Array.isArray(Kt)?Kt:[],o=i.findIndex(S=>String(S==null?void 0:S.id)===String(ee==null?void 0:ee.id));if(o<0)return;const c=i[o+(t==="j"||t==="J"?-1:1)];c&&oa(c)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[Kt,Je,ee]);const Sn=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:h.customer_name,onChange:e=>Le({...h,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Be.nameError&&React.createElement("div",{className:"form-text text-danger"},Be.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:h.phone,onChange:e=>Ga(e.target.value),onBlur:Wa,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Be.phoneError&&React.createElement("div",{className:"form-text text-danger"},Be.phoneError),!Be.phoneError&&wt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",wt.count," \u0111\u01A1n trong th\xE1ng ",wt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>l(e=>!e)},x?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),x&&wt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>l(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},wt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ea(e.status)}`},Pt(e.status))),React.createElement("div",{className:"text-muted small"},ta(e.created_at)," \u2022 ",Ge(ma(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},na(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Ra(e)}},"M\u1EDF")))),wt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(De==null?void 0:De.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(De==null?void 0:De.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(De==null?void 0:De.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(De==null?void 0:De.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:h.status,onChange:e=>Le({...h,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:h.address,onChange:e=>Le({...h,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Be.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Be.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:h.note,onChange:e=>Le({...h,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Le(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Et(h.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;Le(i=>{const o=Et(i.adjustment_items);return o[a]={...o[a],amount:n},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;Le(i=>{const o=Et(i.adjustment_items);return o[a]={...o[a],note:n},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{Le(t=>{const n=Et(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:u||Et(h.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Be.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Be.adjustmentAbnormalWarn),!!Be.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Be.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Le(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),et(e=>[...Array.isArray(e)?e:[],""]),Pe&&Ve(e=>[...Array.isArray(e)?e:[],!0])},disabled:u},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(h.items)?h.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{fe.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{St(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},tn(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Tt===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:Ae[a]||"",onChange:t=>{const n=t.target.value;et(i=>{const o=Array.isArray(i)?[...i]:[];return o[a]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=nn(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(n.id),o=Bt(n==null?void 0:n.variants),v={};for(const p of o){const r=String((p==null?void 0:p.name)||"").trim(),b=Array.isArray(p==null?void 0:p.options)?p.options[0]:null,I=String((b==null?void 0:b.label)||"").trim();r&&I&&(v[r]=I)}const c=xa(v),S=aa(n,v);Le(p=>{const r=Array.isArray(p.items)?[...p.items]:[];return r[a]={...r[a]||{quantity:1},product_id:i,variant_json:Object.keys(v).length?v:null,variant:c,unit_price:o.length?S:null},{...p,items:r}}),St(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),dt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Be.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Ot(e.product_id),n=Bt(t==null?void 0:t.variants);if(!n.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,v)=>{const c=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${v+1}`).trim(),S=String((i==null?void 0:i[c])||"").trim();return React.createElement("div",{key:c},React.createElement("label",{className:"form-label small text-muted mb-1"},c),React.createElement("select",{className:"form-select",value:S,onChange:p=>{const r=String(p.target.value||"").trim();Le(b=>{const I=Array.isArray(b.items)?[...b.items]:[],U={...I[a]||{}},q=Ot(U.product_id),$e=Bt(q==null?void 0:q.variants),_e=U!=null&&U.variant_json&&typeof U.variant_json=="object"?{...U.variant_json}:{};r?_e[c]=r:delete _e[c];const st=xa(_e),He=aa(q,_e);return I[a]={...U,variant_json:Object.keys(_e).length?_e:null,variant:st,unit_price:He},{...b,items:I}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",c," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(p=>React.createElement("option",{key:p.label,value:p.label},p.label,Number.isFinite(Number(p==null?void 0:p.price))?` (${Ge(Number(p.price))})`:Number(p==null?void 0:p.price_delta)?` (${p.price_delta>0?"+":""}${p.price_delta})`:""))))}))})(),Pe&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!V[a],onChange:t=>{const n=!!t.target.checked;Ve(i=>{const o=Array.isArray(i)?[...i]:[],v=Array.isArray(h.items)?h.items.length:0;for(;o.length<v;)o.push(!0);return o[a]=n,o})},disabled:u||H}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;Le(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[a]={...o[a]||{product_id:""},quantity:n},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Be.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{Le(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),et(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),Ve(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),St(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:u||H||(Array.isArray(h.items)?h.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(h.items)?h.items:[]).filter(c=>c==null?void 0:c.product_id),t=da(a),n=ca(a),i=ja(h),o=i.amount,v=t+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ge(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ge(n.fee))),!!Be.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Be.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ge(o))),(h.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(h.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ge(v)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:u||!!A||!!X}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Vt.all," \u0111\u01A1n"),ce&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>ce?Za(Me):Jt(),disabled:mt,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>La(),disabled:u||!!A},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip ${!R&&!be&&!ce?"active":""}`,onClick:()=>{ce&&Se(""),ie(!1),Z("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Vt.all)),React.createElement("button",{type:"button",className:`orders-chip ${R==="draft"&&!be&&!ce?"active":""}`,onClick:()=>{ce&&Se(""),ie(!1),Z("draft"),w("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Vt.draft)),React.createElement("button",{type:"button",className:`orders-chip ${R==="pending"&&!be&&!ce?"active":""}`,onClick:()=>{ce&&Se(""),ie(!1),Z("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Vt.pending)),React.createElement("button",{type:"button",className:`orders-chip ${R==="processing"&&!be&&!ce?"active":""}`,onClick:()=>{ce&&Se(""),ie(!1),Z("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Vt.processing)),React.createElement("button",{type:"button",className:`orders-chip ${R==="done"&&!be&&!ce?"active":""}`,onClick:()=>{ce&&Se(""),ie(!1),Z("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Vt.done)),React.createElement("button",{type:"button",className:`orders-chip ${R==="paid"&&!be&&!ce?"active":""}`,onClick:()=>{ce&&Se(""),ie(!1),Z("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Vt.paid)),React.createElement("button",{type:"button",className:`orders-chip ${R==="canceled"&&!be&&!ce?"active":""}`,onClick:()=>{ce&&Se(""),ie(!1),Z("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Vt.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>ya("thisMonth"),disabled:ce},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>ya("overduePending"),disabled:ce},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",Ht," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>ya("draftExpiring"),disabled:ce},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a"),(R||be||!d&&!ce)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ya("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:Ue,type:"text",className:"form-control",value:Me,onChange:e=>Se(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(Me||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Se(""),disabled:mt},React.createElement("i",{className:"fas fa-times"})),mt&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:d,onChange:e=>w(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:be||ce})),React.createElement("div",{className:"text-muted small ms-auto"},ce?"Search b\u1ECF qua filter":be?"\u0110ang xem \u0111\u01A1n ch\u1EADm":R?`L\u1ECDc: ${Pt(R)}`:""))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},ce?`${Kt.length} k\u1EBFt qu\u1EA3`:R?`${va.length}/${B.length} \u0111\u01A1n`:`${B.length}${ae?"+":""} \u0111\u01A1n`)),ce&&Qe&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Qe),ga.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,ga.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Ht," ng\xE0y.",se&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ie(!0),Z("pending")}},"Xem ngay")),Xa.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,Xa.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",D," ng\xE0y).",ze&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ie(!1),Z("draft"),w(""),Jt()}},"Xem ngay")),(ce?mt:pe)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,a)=>React.createElement("div",{key:a,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,a)=>React.createElement("tr",{key:a},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(ce?Kt.length===0:B.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},ce?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!ce&&va.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Kt.map(e=>{var a;return React.createElement("div",{key:e.id,className:"card mb-2",role:"button",tabIndex:0,onClick:()=>oa(e),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),oa(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",onClick:t=>{var n,i;t.stopPropagation(),(i=(n=navigator.clipboard)==null?void 0:n.writeText)==null||i.call(n,String(e.phone||""))},title:"Ch\u1EA1m \u0111\u1EC3 copy S\u0110T"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim();return t?React.createElement("div",{className:"text-muted small order-address"},t):null})(),(()=>{const t=String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim();return t?React.createElement("div",{className:"text-muted small order-note"},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t):null})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`badge ${ea(e.status)} order-status-badge-btn`,onClick:t=>{t.stopPropagation(),ft(e)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},Pt(e.status)),At(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Ht} ng\xE0y`},"\u26A0 Ch\u1EADm ",gt(e),"d"),Lt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Xt} ng\xE0y`},"\u23F3 C\xF2n ",_t(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=ka(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,i)=>React.createElement("div",{key:i,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${Ge(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},na(e))})()),(la(e)!==0||Gt(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ge(la(e))),Gt(e)?React.createElement("span",{className:"text-muted"}," ","(",Gt(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Ge(ma(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",ta(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),Sa(e)},disabled:u||!!A||X===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),ft(e)},disabled:u||!!A||X===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c"))))})),L&&rt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>ht()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},rt.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},rt.phone||""),React.createElement("span",{className:`badge ${ea(rt.status)}`},Pt(rt.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ht(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Sa(rt),ht()},disabled:u||!!A||X===rt.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(rt.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(rt.phone||"").trim()}`,onClick:()=>ht()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{oa(rt),ht()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},pt.map(e=>{const a=Nt(rt.status)===Nt(e.value),t=u||!!A||X===rt.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Aa(rt,e.value),ht())},disabled:t},e.label)})))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,Kt.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>oa(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=ka(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Ge(t.unitPrice))))):na(e)})()),React.createElement("td",null,sn(e)),React.createElement("td",{className:"fw-semibold"},Ge(ma(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${ea(e.status)}`},Pt(e.status)),At(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Ht} ng\xE0y`},"\u26A0 Ch\u1EADm ",gt(e),"d"),Lt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Xt} ng\xE0y`},"\u23F3 C\xF2n ",_t(e),"d"))),React.createElement("td",null,ta(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),Sa(e)},disabled:u||!!A||X===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation();const t=String(a.target.value||"").trim();a.target.value="",t&&Aa(e,t)},disabled:u||!!A||X===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!ce&&ae&&!be&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:fn,disabled:pe||Y},Y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:Je,title:(()=>{const e=ee,a=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Pt(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${a} ${t}`.trim()})(),subtitle:(()=>{const e=ee,a=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?ta(e.created_at):"";return[a||t||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:gn,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},$t?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{vt(!1),s(null),Mt(""),l(!1),Ve([])},disabled:u||H},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!Pe&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:en,disabled:u||H,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},H?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>Ca({mode:"close",origin:"drawer"}),disabled:u||H||!Be.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},u?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ee&&Sa(ee),disabled:!ee||lt||u||!!A},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>ee&&Ra(ee),disabled:!ee||lt||u||!!A},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const a=String(e.target.value||"").trim();e.target.value="",a&&ee&&Aa(ee,a)},disabled:!ee||lt||u||!!A||X===(ee==null?void 0:ee.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},$t?React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ca({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),Sn())):lt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):it?React.createElement("div",{className:"alert alert-danger",role:"alert"},it):ee?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${ea(ee.status)}`},Pt(ee.status)),At(ee)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Ht} ng\xE0y`},"\u26A0 Ch\u1EADm ",gt(ee),"d"),Lt(ee)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Xt} ng\xE0y`},"\u23F3 C\xF2n ",_t(ee),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},Ge(ma(ee))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},sn(ee)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},ta(ee.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},ee.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},ee.phone||"\u2014"),!!String(ee.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(ee.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},ee.address||"\u2014")),((ee==null?void 0:ee.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(ee.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=ka(ee);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((a,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),a.name),a.variant?React.createElement("div",{className:"text-muted small"},a.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${Ge(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},na(ee)||"\u2014")})(),(la(ee)!==0||Gt(ee))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Ge(la(ee))),Gt(ee)?React.createElement("span",{className:"text-muted"}," ","(",Gt(ee),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),ve&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),Pe?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Ea})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ca({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:ot},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:h.customer_name,onChange:e=>Le({...h,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Be.nameError&&React.createElement("div",{className:"form-text text-danger"},Be.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:h.phone,onChange:e=>Ga(e.target.value),onBlur:Wa,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Be.phoneError&&React.createElement("div",{className:"form-text text-danger"},Be.phoneError),!Be.phoneError&&wt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",wt.count," \u0111\u01A1n trong th\xE1ng ",wt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>l(e=>!e)},x?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),x&&wt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>l(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},wt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ea(e.status)}`},Pt(e.status))),React.createElement("div",{className:"text-muted small"},ta(e.created_at)," \u2022 ",Ge(ma(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},na(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Ra(e)}},"M\u1EDF")))),wt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(De==null?void 0:De.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(De==null?void 0:De.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(De==null?void 0:De.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(De==null?void 0:De.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:h.status,onChange:e=>Le({...h,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:h.address,onChange:e=>Le({...h,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Be.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Be.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:h.note,onChange:e=>Le({...h,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Le(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Et(h.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;Le(i=>{const o=Et(i.adjustment_items);return o[a]={...o[a],amount:n},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;Le(i=>{const o=Et(i.adjustment_items);return o[a]={...o[a],note:n},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{Le(t=>{const n=Et(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:u||Et(h.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Be.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Be.adjustmentAbnormalWarn),!!Be.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Be.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Le(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),et(e=>[...Array.isArray(e)?e:[],""]),Pe&&Ve(e=>[...Array.isArray(e)?e:[],!0])},disabled:u},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(h.items)?h.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{fe.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{St(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},tn(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Tt===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:Ae[a]||"",onChange:t=>{const n=t.target.value;et(i=>{const o=Array.isArray(i)?[...i]:[];return o[a]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=nn(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(n.id),o=Bt(n==null?void 0:n.variants),v={};for(const p of o){const r=String((p==null?void 0:p.name)||"").trim(),b=Array.isArray(p==null?void 0:p.options)?p.options[0]:null,I=String((b==null?void 0:b.label)||"").trim();r&&I&&(v[r]=I)}const c=xa(v),S=aa(n,v);Le(p=>{const r=Array.isArray(p.items)?[...p.items]:[];return r[a]={...r[a]||{quantity:1},product_id:i,variant_json:Object.keys(v).length?v:null,variant:c,unit_price:o.length?S:null},{...p,items:r}}),St(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),dt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Be.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Ot(e.product_id),n=Bt(t==null?void 0:t.variants);if(!n.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,v)=>{const c=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${v+1}`).trim(),S=String((i==null?void 0:i[c])||"").trim();return React.createElement("div",{key:c},React.createElement("label",{className:"form-label small text-muted mb-1"},c),React.createElement("select",{className:"form-select",value:S,onChange:p=>{const r=String(p.target.value||"").trim();Le(b=>{const I=Array.isArray(b.items)?[...b.items]:[],U={...I[a]||{}},q=Ot(U.product_id),$e=Bt(q==null?void 0:q.variants),_e=U!=null&&U.variant_json&&typeof U.variant_json=="object"?{...U.variant_json}:{};r?_e[c]=r:delete _e[c];const st=xa(_e),He=aa(q,_e);return I[a]={...U,variant_json:Object.keys(_e).length?_e:null,variant:st,unit_price:He},{...b,items:I}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",c," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(p=>React.createElement("option",{key:p.label,value:p.label},p.label,Number.isFinite(Number(p==null?void 0:p.price))?` (${Ge(Number(p.price))})`:Number(p==null?void 0:p.price_delta)?` (${p.price_delta>0?"+":""}${p.price_delta})`:""))))}))})(),Pe&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!V[a],onChange:t=>{const n=!!t.target.checked;Ve(i=>{const o=Array.isArray(i)?[...i]:[],v=Array.isArray(h.items)?h.items.length:0;for(;o.length<v;)o.push(!0);return o[a]=n,o})},disabled:u||H}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;Le(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[a]={...o[a]||{product_id:""},quantity:n},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Be.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{Le(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),et(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),Ve(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),St(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:u||H||(Array.isArray(h.items)?h.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(h.items)?h.items:[]).filter(c=>c==null?void 0:c.product_id),t=da(a),n=ca(a),i=ja(h),o=i.amount,v=t+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Ge(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Ge(n.fee))),!!Be.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Be.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Ge(o))),(h.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(h.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Ge(v)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Ea,disabled:u||H,style:{borderRadius:10}},"H\u1EE7y"),!!Pe&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:en,disabled:u||H,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},H?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!Pe&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Ca({mode:"new",origin:"modal"}),disabled:u||!Be.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:u||H||!Be.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},u?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

