const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:I,error:E}){const[F,ye]=useState(""),[ae,J]=useState(""),[X,Oe]=useState(!1),[Fe,Se]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),E&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),E),React.createElement("form",{onSubmit:async at=>{at.preventDefault(),Oe(!0),await I(F,ae),Oe(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:F,onChange:at=>ye(at.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:Fe?"text":"password",className:"form-control",value:ae,onChange:at=>J(at.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Se(!Fe)},React.createElement("i",{className:`fas fa-eye${Fe?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:I,type:E,onClose:F,actionLabel:ye,onAction:ae,durationMs:J}){return useEffect(()=>{const X=Number(J),Oe=Number.isFinite(X)&&X>0?X:3e3,Fe=setTimeout(F,Oe);return()=>clearTimeout(Fe)},[F,J]),React.createElement("div",{className:`toast show align-items-center text-white bg-${E} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},I),ye&&typeof ae=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{ae()}finally{F()}}},ye),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:F})))}function Loading({show:I}){return I?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:I,title:E,subtitle:F,onClose:ye,footer:ae,children:J}){return useEffect(()=>{if(!I)return;const X=Oe=>{Oe.key==="Escape"&&(Oe.preventDefault(),typeof ye=="function"&&ye())};return document.addEventListener("keydown",X),()=>document.removeEventListener("keydown",X)},[I,ye]),I?React.createElement("div",{className:`admin-drawer-root ${I?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:ye,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},E),F?React.createElement("div",{className:"admin-drawer-subtitle"},F):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:ye,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},J),ae?React.createElement("div",{className:"admin-drawer-footer"},ae):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(I){try{const E=localStorage.getItem(I);if(!E)return[];const F=JSON.parse(E);return Array.isArray(F)?F.map(ye=>String(ye||"").trim()).filter(Boolean):[]}catch(E){return[]}}function saveAdminMenuIdsToStorage(I,E){try{localStorage.setItem(I,JSON.stringify(Array.isArray(E)?E:[]))}catch(F){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(I){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,I),I}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(I){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,I),I}function Sidebar({activeMenu:I,onMenuChange:E,onLogout:F,currentUser:ye,pinnedMenus:ae,recentMenus:J,onTogglePin:X}){const Oe=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"recon",icon:"fa-file-excel",label:"\u0110\u1ED1i so\xE1t Excel"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],Fe=(ye==null?void 0:ye.username)||(ye==null?void 0:ye.name)||(ye==null?void 0:ye.email)||"Admin",Se=useMemo(()=>{const Ee=new Map;for(const q of Oe)Ee.set(q.id,q);return Ee},[]),Ge=Array.isArray(ae)?ae:[],at=Array.isArray(J)?J:[],Be=Ge.map(Ee=>Se.get(Ee)).filter(Boolean),ze=at.filter(Ee=>Ee!==I).map(Ee=>Se.get(Ee)).filter(Boolean).slice(0,5),we=Ee=>Ge.includes(Ee);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},Fe),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},Be.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},Be.map(Ee=>React.createElement("a",{key:`pin-${Ee.id}`,href:"#",className:`nav-link ${I===Ee.id?"active":""} sidebar-quicklink`,onClick:q=>{q.preventDefault(),E(Ee.id)}},React.createElement("i",{className:`fas ${Ee.icon}`})," ",Ee.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:q=>{q.preventDefault(),q.stopPropagation(),X&&X(Ee.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),ze.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},ze.map(Ee=>React.createElement("a",{key:`recent-${Ee.id}`,href:"#",className:`nav-link ${I===Ee.id?"active":""} sidebar-quicklink`,onClick:q=>{q.preventDefault(),E(Ee.id)}},React.createElement("i",{className:`fas ${Ee.icon}`})," ",Ee.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),Oe.map(Ee=>React.createElement("a",{key:Ee.id,href:"#",className:`nav-link ${I===Ee.id?"active":""} ${Ee.disabled?"opacity-50":""} ${Ee.highlight?"text-warning":""}`,onClick:q=>{q.preventDefault(),Ee.disabled||E(Ee.id)}},React.createElement("i",{className:`fas ${Ee.icon}`})," ",Ee.label,Ee.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),Ee.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${we(Ee.id)?"pinned":""}`,onClick:q=>{q.preventDefault(),q.stopPropagation(),X&&X(Ee.id)},title:we(Ee.id)?"B\u1ECF ghim":"Ghim","aria-label":we(Ee.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),F&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:F,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(I){const E=typeof I=="number"?I:parseFloat(String(I!=null?I:"").trim());return Number.isFinite(E)?Math.max(0,Math.min(100,E)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var I;try{const E=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!E)return{ship_percent:DEFAULT_SHIP_PERCENT};const F=JSON.parse(E);return{ship_percent:normalizeShipPercent((I=F==null?void 0:F.ship_percent)!=null?I:F==null?void 0:F.shipPercent)}}catch(E){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(I){var E;try{const F={ship_percent:normalizeShipPercent((E=I==null?void 0:I.ship_percent)!=null?E:I==null?void 0:I.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(F)),F}catch(F){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var E;const I=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((E=I==null?void 0:I.ship_percent)!=null?E:I==null?void 0:I.shipPercent)}}async function saveAdminSettingsToServer(I){var ye,ae,J;const E={ship_percent:normalizeShipPercent((ye=I==null?void 0:I.ship_percent)!=null?ye:I==null?void 0:I.shipPercent)},F=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,E,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((J=(ae=F==null?void 0:F.ship_percent)!=null?ae:F==null?void 0:F.shipPercent)!=null?J:E.ship_percent)}}function AlbumList({albums:I,onSelect:E,onCreate:F,onEdit:ye,onDelete:ae,loading:J,currentFolder:X,onBack:Oe,breadcrumb:Fe}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},X&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:Oe},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),X?X.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:F},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),Fe&&Fe.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Se=>{Se.preventDefault(),Oe("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Fe.map((Se,Ge)=>React.createElement("li",{key:Se.id,className:`breadcrumb-item ${Ge===Fe.length-1?"active":""}`},Ge===Fe.length-1?Se.title:React.createElement("a",{href:"#",onClick:at=>{at.preventDefault(),Oe(Se)},className:"text-warning"},Se.title))))),J?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):I.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},X?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},I.map(Se=>React.createElement("div",{key:Se.uuid||Se.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>E(Se)},Se.cover?React.createElement("img",{src:Se.cover,className:"album-cover",alt:Se.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Se.title),React.createElement("small",{className:"text-muted"},Se.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Se.subfolderCount),Se.subfolderCount>0&&Se.count>0&&" \u2022 ",Se.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Se.count),Se.subfolderCount===0&&Se.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Ge=>{Ge.stopPropagation(),ye(Se)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Ge=>{Ge.stopPropagation(),ae(Se)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:I,album:E,onClose:F,onSave:ye,parentId:ae}){const[J,X]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[Oe,Fe]=useState(!1),[Se,Ge]=useState(!1),at=useRef(null);useEffect(()=>{X(E?{slug:E.id||"",title:E.title||"",description:E.description||"",cover_url:E.cover||"",parent_id:E.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:ae||null})},[E,I,ae]);const Be=async q=>{q.preventDefault(),Fe(!0),await ye(J),Fe(!1)},ze=q=>q.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),we=async q=>{const wt=q.type==="image/heic"||q.type==="image/heif"||/\.heic$/i.test(q.name);if(q.size<=2097152&&!wt)return q;try{const xt=await createImageBitmap(q),Xe=document.createElement("canvas");let nt=xt.width,Re=xt.height;const gt=800;return(nt>gt||Re>gt)&&(nt>Re?(Re=Math.round(Re/nt*gt),nt=gt):(nt=Math.round(nt/Re*gt),Re=gt)),Xe.width=nt,Xe.height=Re,Xe.getContext("2d").drawImage(xt,0,0,nt,Re),xt.close(),new Promise((sn,Qe)=>{Xe.toBlob(Lt=>{Lt?sn(new File([Lt],q.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Qe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(xt){throw console.error("Compress cover error:",xt),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ee=async q=>{var xt;const ut=q.target.files[0];if(!ut)return;if(!(ut.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ut.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ge(!0);try{const Xe=await we(ut),nt=await window.KTM.cloudinary.uploadImage({file:Xe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!nt.secure_url)throw console.error("Cloudinary error:",nt),new Error(((xt=nt.error)==null?void 0:xt.message)||"Upload failed");X(Re=>({...Re,cover_url:nt.secure_url}))}catch(Xe){console.error("Cover upload error:",Xe),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Xe.message)}Ge(!1),q.target.value=""};return I?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},E?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:F})),React.createElement("form",{onSubmit:Be},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:J.title,onChange:q=>X({...J,title:q.target.value,slug:J.slug||ze(q.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:J.slug,onChange:q=>X({...J,slug:q.target.value}),required:!0,disabled:!!E}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:J.description,onChange:q=>X({...J,description:q.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},J.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:J.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>X(q=>({...q,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:at,type:"file",accept:"image/*",className:"d-none",onChange:Ee}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var q;return(q=at.current)==null?void 0:q.click()},disabled:Se},Se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:J.cover_url,onChange:q=>X({...J,cover_url:q.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:F},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:Oe||Se},Oe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:I,allAlbums:E,currentAlbumId:F,targetAlbum:ye,onSelect:ae,level:J=0}){const[X,Oe]=useState(!0),Fe=I.uuid||I.id,Se=Fe===F,Ge=ye===Fe,at=E.filter(ze=>ze.parentId===Fe),Be=at.length>0;return React.createElement("div",{style:{marginLeft:J*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Ge?"bg-info text-white":Se?"bg-light text-muted":"hover-bg"}`,style:{cursor:Se?"not-allowed":"pointer",opacity:Se?.5:1,transition:"background 0.2s"},onClick:()=>!Se&&ae(Fe)},Be&&React.createElement("i",{className:`fas fa-chevron-${X?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:ze=>{ze.stopPropagation(),Oe(!X)}}),!Be&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Ge?"-open":""} me-2 ${Ge?"":"text-warning"}`}),React.createElement("span",{className:"small"},I.title),Se&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),I.count>0&&!Se&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},I.count)),X&&Be&&React.createElement("div",null,at.map(ze=>React.createElement(FolderTreeItem,{key:ze.uuid||ze.id,folder:ze,allAlbums:E,currentAlbumId:F,targetAlbum:ye,onSelect:ae,level:J+1}))))}function AlbumDetail({album:I,onBack:E,onRefresh:F,showToast:ye,onNavigateToFolder:ae,onEditSubfolder:J,parentAlbum:X}){const[Oe,Fe]=useState([]),[Se,Ge]=useState([]),[at,Be]=useState(!0),[ze,we]=useState(!1),[Ee,q]=useState(""),[ut,wt]=useState([]),[xt,Xe]=useState([]),[nt,Re]=useState({}),[gt,Pt]=useState(null),[sn,Qe]=useState(!1),[Lt,Xt]=useState(""),[A,x]=useState(!1),H=useRef(null),ge=useRef(null),[ve,ce]=useState(!1),[ue,Te]=useState([]),[S,B]=useState([]),[Q,re]=useState(""),[Ie,Ae]=useState(!1),Ye=async(j,u=2)=>{const G=u*1024*1024,te=j.type==="image/heic"||j.type==="image/heif"||/\.heic$/i.test(j.name);if(j.size<=G&&!te)return j;try{const Ke=await createImageBitmap(j),Pe=document.createElement("canvas");let Je=Ke.width,Nt=Ke.height;const et=1200;return(Je>et||Nt>et)&&(Je>Nt?(Nt=Math.round(Nt/Je*et),Je=et):(Je=Math.round(Je/Nt*et),Nt=et)),Pe.width=Je,Pe.height=Nt,Pe.getContext("2d").drawImage(Ke,0,0,Je,Nt),Ke.close(),new Promise((Wt,rn)=>{Pe.toBlob(bn=>{bn?Wt(new File([bn],j.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):rn(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Ke){throw console.error("Compress error:",Ke),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{Ue(),kt()},[I.id,I.uuid]);const Ue=async()=>{Be(!0);try{const j=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${I.uuid||I.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Fe(j.images||[]);const u=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${I.uuid||I.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Ge(Array.isArray(u)?u:[])}catch(j){console.error(j),ye("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}Be(!1)},kt=async()=>{try{const j=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");B(Array.isArray(j)?j:[])}catch(j){console.error("Error loading albums:",j)}},Kt=j=>{Te(u=>u.includes(j)?u.filter(G=>G!==j):[...u,j])},Me=async()=>{if(!Q||ue.length===0){ye("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}Ae(!0);let j=0;for(const u of ue)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${u}`,{album_id:Q},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),j++}catch(G){console.error("Move error:",G)}Ae(!1),ce(!1),Te([]),re(""),j>0?(ye("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),Ue(),F()):ye("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[it,en]=useState(!1),Tt=async()=>{if(ue.length===0||!confirm(`X\xF3a ${ue.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;en(!0);let j=0;for(const u of ue)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${u}`,"L\u1ED7i x\xF3a \u1EA3nh"),j++}catch(G){console.error("Delete error:",G)}en(!1),Te([]),j>0?(ye(`\u0110\xE3 x\xF3a ${j} \u1EA3nh!`,"success"),Ue(),F()):ye("X\xF3a th\u1EA5t b\u1EA1i","danger")},dn=()=>{ue.length===Oe.length?Te([]):Te(Oe.map(j=>j.id))},Ft=async()=>{if(Lt.trim()){x(!0);try{const j=Lt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:j+"-"+Date.now(),title:Lt,parent_id:I.uuid||I.id},"L\u1ED7i t\u1EA1o folder"),ye("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Xt(""),Qe(!1),Ue(),F()}catch(j){ye(j.message,"danger")}x(!1)}},hn=async j=>{if(confirm(`X\xF3a folder "${j.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${j.uuid||j.id}`,"L\u1ED7i x\xF3a folder"),ye("\u0110\xE3 x\xF3a folder","success"),Ue(),F()}catch(u){ye("L\u1ED7i x\xF3a folder","danger")}},gn=j=>{const u=Array.from(j).filter(G=>G.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(G.name));wt(G=>[...G,...u]),u.forEach(G=>{const te=new FileReader;te.onload=Ke=>{Xe(Pe=>[...Pe,{file:G,preview:Ke.target.result}])},te.readAsDataURL(G)})},R=j=>{wt(u=>u.filter((G,te)=>te!==j)),Xe(u=>u.filter((G,te)=>te!==j))},se=async j=>{var G;const u=await window.KTM.cloudinary.uploadImage({file:j,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${I.id}`});if(!u.secure_url)throw console.error("Cloudinary error:",u),new Error(((G=u.error)==null?void 0:G.message)||"Upload failed");return u},Ze=async()=>{if(ut.length===0)return;we(!0);let j=0;for(let u=0;u<ut.length;u++)try{q(`\u0110ang x\u1EED l\xFD ${u+1}/${ut.length}...`);const G=await Ye(ut[u],2);q(`\u0110ang upload ${u+1}/${ut.length}...`);const te=await se(G);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${I.id}`,{url:te.secure_url,caption:nt[u]||ut[u].name.replace(/\.[^/.]+$/,""),sort_order:Oe.length+u},"L\u1ED7i l\u01B0u \u1EA3nh"),j++}catch(G){console.error("Upload error:",G)}we(!1),q(""),wt([]),Xe([]),Re({}),j>0?(ye(`\u0110\xE3 upload ${j} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),Ue(),F()):ye("Upload th\u1EA5t b\u1EA1i","danger")},Bt=async(j,u)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${j}`,"L\u1ED7i x\xF3a \u1EA3nh"),ye("\u0110\xE3 x\xF3a \u1EA3nh","success"),Ue(),F()}catch(G){ye("L\u1ED7i x\xF3a \u1EA3nh","danger")}},fn=j=>{var u;j.preventDefault(),(u=ge.current)==null||u.classList.add("dragover")},Vt=()=>{var j;(j=ge.current)==null||j.classList.remove("dragover")},Yt=j=>{var u;j.preventDefault(),(u=ge.current)==null||u.classList.remove("dragover"),gn(j.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:E},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},I.title),React.createElement("small",{className:"text-muted"},Se.length>0&&React.createElement("span",null,Se.length," folder \u2022 "),Oe.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Qe(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),sn&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Lt,onChange:j=>Xt(j.target.value),onKeyPress:j=>j.key==="Enter"&&Ft(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Ft,disabled:A||!Lt.trim()},A?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Qe(!1),Xt("")}},"H\u1EE7y")))),Se.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Se.map(j=>React.createElement("div",{key:j.uuid||j.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>ae&&ae(j)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},j.title),React.createElement("small",{className:"text-muted"},j.subfolderCount>0&&React.createElement("span",null,j.subfolderCount," folder"),j.subfolderCount>0&&j.count>0&&" \u2022 ",j.count>0&&React.createElement("span",null,j.count," \u1EA3nh"),j.subfolderCount===0&&j.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:u=>{u.stopPropagation(),J&&J(j)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:u=>{u.stopPropagation(),hn(j)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:ge,className:"upload-zone",onClick:()=>{var j;return(j=H.current)==null?void 0:j.click()},onDragOver:fn,onDragLeave:Vt,onDrop:Yt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:H,type:"file",multiple:!0,accept:"image/*",onChange:j=>gn(j.target.files)})),xt.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},xt.map((j,u)=>React.createElement("div",{key:u,className:"upload-preview-item"},React.createElement("img",{src:j.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>R(u)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Ze,disabled:ze},ze?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Ee||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",ut.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",Oe.length,")"),Oe.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:dn},ue.length===Oe.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ue.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ue.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>ce(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Tt,disabled:it},it?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Te([])},React.createElement("i",{className:"fas fa-times"})))),at?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):Oe.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},Oe.map((j,u)=>React.createElement("div",{key:u,className:`image-item ${ue.includes(j.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Kt(j.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ue.includes(j.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ue.includes(j.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ue.includes(j.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:j.src,alt:j.caption,style:{opacity:ue.includes(j.id)?.7:1,border:ue.includes(j.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:G=>{G.stopPropagation(),Bt(j.id,u)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),j.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},j.caption)))))),ve&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ue.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>ce(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},S.filter(j=>!j.parentId).map(j=>React.createElement(FolderTreeItem,{key:j.uuid||j.id,folder:j,allAlbums:S,currentAlbumId:I.uuid||I.id,targetAlbum:Q,onSelect:re})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>ce(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:Me,disabled:!Q||Ie},Ie?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),gt&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Pt(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Pt(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:gt.src,alt:gt.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:j=>j.stopPropagation()}),gt.caption&&React.createElement("div",{className:"text-white text-center mt-2"},gt.caption)))))}function SearchCenter({showToast:I,onNavigate:E}){const[F,ye]=useState(""),[ae,J]=useState([]),[X,Oe]=useState([]),[Fe,Se]=useState([]),[Ge,at]=useState("all"),[Be,ze]=useState(null),[we,Ee]=useState("list"),[q,ut]=useState(!0),[wt,xt]=useState([]),[Xe,nt]=useState([]),Re=useRef(null),[gt,Pt]=useState(!0),[sn,Qe]=useState(!1),Lt=useRef(null),Xt=useRef(null),A=useRef(null),[x,H]=useState(!1),[ge,ve]=useState([]),[ce,ue]=useState([]),[Te,S]=useState(""),B=useRef(null),Q=useRef(new Map),[re,Ie]=useState("auto"),[Ae,Ye]=useState({start:0,end:20}),[Ue,kt]=useState(!1),[Kt,Me]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[it,en]=useState(""),[Tt,dn]=useState(!1),Ft=useRef(null),hn=useRef(null),gn=s=>s?String(s).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",R=s=>s?String(s).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",se=(s,d)=>{if(!s||!d)return s;const c=new RegExp(`(${d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return s.replace(c,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const s=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),d=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");ve(Array.isArray(s)?s.slice(0,10):[]),ue(Array.isArray(d)?d:[])}catch(s){}},[]);const Ze=s=>{if(!s.trim())return;const d=[s,...ge.filter(c=>c!==s)].slice(0,10);ve(d);try{localStorage.setItem("ktm_search_history",JSON.stringify(d))}catch(c){}},Bt=s=>{if(!s.trim())return;const d=ce.includes(s)?ce.filter(c=>c!==s):[s,...ce].slice(0,5);ue(d);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(d))}catch(c){}},fn="ktm_search_query_stats_v1",Vt="ktm_search_product_stats_v1",Yt=(s,d)=>{try{const c=localStorage.getItem(s);if(!c)return d;const v=JSON.parse(c);return v!=null?v:d}catch(c){return d}},j=(s,d)=>{try{localStorage.setItem(s,JSON.stringify(d))}catch(c){}},[u,G]=useState(()=>Yt(fn,{})),[te,Ke]=useState(()=>Yt(Vt,{})),Pe=useRef(!1),Je=useRef(new Map);useEffect(()=>{const s=d=>{d&&(d.key===fn&&G(Yt(fn,{})),d.key===Vt&&Ke(Yt(Vt,{})))};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const Nt=s=>{const d=String(s||"").trim();if(!d)return;const c=xe(d).trim();if(c.length<3||c==="sdt:"||c==="#"||c.endsWith(":"))return;const v=Date.now(),P=Yt(fn,u&&typeof u=="object"?u:{}),T={...P&&typeof P=="object"?P:{}},N=T[c]&&typeof T[c]=="object"?T[c]:{};T[c]={q:d,count:(Number(N.count)||0)+1,lastAt:v},G(T),j(fn,T)},et=(s,d)=>{if(!s||s._type!=="product")return;const c=String(s.id||"").trim();if(!c)return;const v=Date.now(),P=Yt(Vt,te&&typeof te=="object"?te:{}),T={...P&&typeof P=="object"?P:{}},N=T[c]&&typeof T[c]=="object"?T[c]:{};T[c]={id:c,name:String(s.name||N.name||"").trim(),code:String(s.code||N.code||"").trim(),count:(Number(N.count)||0)+1,lastAt:v,action:String(d||N.action||"").trim()},Ke(T),j(Vt,T)},mn=(s,d)=>{const c=String(s||"").trim();if(!c)return;const v=xe(c).trim();if(v.length<3||v==="sdt:"||v==="#"||v.endsWith(":"))return;const P=Date.now(),T=Number(Je.current.get(v)||0);if(P-T<3e4)return;const $=(Array.isArray(d)?d:[]).find(ne=>ne&&ne._type==="product");$&&(Je.current.set(v,P),et($,"search"))},Wt=useMemo(()=>Object.values(u&&typeof u=="object"?u:{}).map(c=>({q:String((c==null?void 0:c.q)||"").trim(),count:Number(c==null?void 0:c.count)||0,lastAt:Number(c==null?void 0:c.lastAt)||0})).filter(c=>c.q&&c.count>0).sort((c,v)=>v.count-c.count||v.lastAt-c.lastAt).slice(0,6),[u]),rn=useMemo(()=>Object.values(te&&typeof te=="object"?te:{}).map(c=>({id:String((c==null?void 0:c.id)||"").trim(),name:String((c==null?void 0:c.name)||"").trim(),code:String((c==null?void 0:c.code)||"").trim(),count:Number(c==null?void 0:c.count)||0,lastAt:Number(c==null?void 0:c.lastAt)||0})).filter(c=>c.id&&c.count>0).sort((c,v)=>v.count-c.count||v.lastAt-c.lastAt).slice(0,8).map(c=>{const v=X.find(P=>P&&P._type==="product"&&String(P.id)===c.id);return v?{...c,item:v}:{...c,item:null}}),[te,X]),bn=(s,d={})=>{const c=String(s||"");bt(c),d.addToHistory!==!1&&Ze(c),H(!1),fe(!1),k(!1),d.focus!==!1?(Pe.current=!0,setTimeout(()=>{var T;const P=Re.current;(T=P==null?void 0:P.focus)==null||T.call(P);try{if(d.caret==="end"&&P&&typeof P.setSelectionRange=="function"){const N=String(P.value||"").length;P.setSelectionRange(N,N)}}catch(N){}},0)):(Pe.current=!1,setTimeout(()=>{var P,T,N,$;try{(T=(P=Re.current)==null?void 0:P.blur)==null||T.call(P),($=(N=document.activeElement)==null?void 0:N.blur)==null||$.call(N)}catch(ne){}},0))},[st,un]=useState(null),[_n,vn]=useState(!1),[dt,i]=useState(null),[l,k]=useState(!1),[g,M]=useState(!1),[V,L]=useState(null),[h,C]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),_=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],U=s=>{var d,c;s._type==="product"&&(i(s),C({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(c=(d=s.commission_percent)!=null?d:s.commissionPercent)!=null?c:""}),vn(!0))},ie=async()=>{if(dt)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${dt.id}`,h,"L\u1ED7i c\u1EADp nh\u1EADt"),I("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),vn(!1),i(null),Ve()}catch(s){I(s.message,"danger")}},Ce=async s=>{const d=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${d} "${s.name}"?`))try{let c="";s._type==="product"?c=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?c=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(c=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(c,"L\u1ED7i x\xF3a"),I(`\u0110\xE3 x\xF3a ${d}`,"success"),Ve()}catch(c){I(c.message,"danger")}},me=async s=>{try{const d=V?`${API_BASE}/api/products?id=${V.id}`:`${API_BASE}/api/products`;V?await window.KTM.api.putJSON(d,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(d,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),I(V?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),M(!1),L(null),Ve()}catch(d){I(d.message,"danger")}},De="ktm_admin_data_cache_v1",_e=1e3*60*10,Ve=async()=>{let s=null,d=!1;const c=window.KTM.cache.read(De,{ttlMs:_e,validate:Array.isArray});c.hit?(s=c.value,console.log("[CACHE] Using cache, items:",s.length),Oe(s),J(s),ut(!1),d=!0):c.status==="miss"?console.log("[CACHE] No cache found"):c.status==="expired"||c.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):c.status==="error"&&console.error("[CACHE] Error parsing cache"),d||ut(!0);try{const v=async(We,f)=>{try{const Ne=await window.KTM.api.getJSON(We,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Ne!=null?Ne:f}catch(Ne){return f}},[P,T,N]=await Promise.all([v(`${API_BASE}/api/products?fields=search`,[]),v(`${API_BASE}/api/albums`,[]),v(`${API_BASE}/api/video-folders?withVideos=true`,[])]),$=Array.isArray(P)?P.map(We=>({...We,_type:"product",_source:"database"})):[];xt(T);let ne=[];Array.isArray(T)&&T.length>0&&(await Promise.all(T.map(f=>v(`${API_BASE}/api/albums/${f.id}`,{})))).forEach((f,Ne)=>{const Ct=T[Ne];f.images&&f.images.length>0&&f.images.forEach($t=>{ne.push({id:$t.id,name:$t.caption||"\u1EA2nh t\u1EEB "+Ct.title,image:$t.src,folder:Ct.title,_type:"album",_source:"database"})})}),nt(N);let z=[];Array.isArray(N)&&N.forEach(We=>{We.videos&&We.videos.forEach(f=>{z.push({id:f.id,name:f.title,folder:We.name,image:f.thumb,youtubeId:f.youtubeId,url:f.url,_type:"video",_source:"database"})})});const W=[...$,...ne,...z];(!s||JSON.stringify(W)!==JSON.stringify(s))&&(Oe(W),J(W),window.KTM.cache.write(De,W))}catch(v){console.error("Song song fetch error:",v)}ut(!1)};useEffect(()=>{Ve(),setTimeout(()=>{var d;return(d=Re.current)==null?void 0:d.focus()},100);const s=d=>{var c,v;(d.ctrlKey||d.metaKey)&&d.key==="k"&&(d.preventDefault(),H(!0),setTimeout(()=>{var P;return(P=B.current)==null?void 0:P.focus()},0)),d.key==="/"&&!x&&((c=document.activeElement)==null?void 0:c.tagName)!=="INPUT"&&(d.preventDefault(),(v=Re.current)==null||v.focus()),d.key==="Escape"&&x&&H(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[x]);const xe=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(d){return String(s!=null?s:"").toLowerCase()}},ot=s=>{const c=xe(s).trim().split(/\s+/).filter(Boolean).map(ne=>{const z=String(ne||"").trim();return z?z.startsWith("#")?z.slice(1):z.startsWith("sdt:")?z.slice(4):z.startsWith("phone:")?z.slice(6):z:""}).filter(Boolean),v=c.includes("anh"),P=c.includes("video"),T=c.filter(ne=>ne!=="anh"&&ne!=="video"),N=T.join(" "),$=new Set(["product"]);return v&&$.add("album"),P&&$.add("video"),{allowedTypes:$,includeAlbum:v,includeVideo:P,contentTokens:T,cleanedQuery:N}},le=(s,d,c)=>{var Ne,Ct,$t,Et,qt;const v=Array.isArray(d)?d:[],P=xe(c).trim();if(!v.length&&!P)return 0;const T=xe((Ne=s==null?void 0:s.name)!=null?Ne:""),N=xe((Ct=s==null?void 0:s.code)!=null?Ct:""),$=xe(($t=s==null?void 0:s.category)!=null?$t:""),ne=xe((Et=s==null?void 0:s.note)!=null?Et:""),z=xe((qt=s==null?void 0:s.folder)!=null?qt:"");if(!`${T} ${N} ${$} ${ne} ${z}`.trim())return 0;const de=T.replace(/\s+/g,""),We=P.replace(/\s+/g,"");let f=0;P&&(T===P&&(f+=220),T.includes(P)&&(f+=140),T.startsWith(P)&&(f+=160),We&&(de===We?f+=280:de.startsWith(We)?f+=180:de.includes(We)&&(f+=110)),N&&N===P&&(f+=180),N&&N.includes(P)&&(f+=90));for(const Qt of v){if(!Qt)continue;const Ht=new RegExp(`(?:^|\\s)${Qt.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`),Jt=String(Qt).replace(/\s+/g,"");T.includes(Qt)&&(f+=35),Ht.test(T)&&(f+=25),Jt&&(de===Jt?f+=90:de.startsWith(Jt)?f+=50:de.includes(Jt)&&(f+=28)),N&&N.includes(Qt)&&(f+=20),N&&Ht.test(N)&&(f+=10),$&&$.includes(Qt)&&(f+=12),z&&z.includes(Qt)&&(f+=12),ne&&ne.includes(Qt)&&(f+=6)}return f>0&&T&&(f+=Math.max(0,10-Math.min(10,Math.floor(T.length/10)))),f},He=(s,d,c)=>{const v=Array.isArray(s)?s:[];return v.length?v.map((T,N)=>({it:T,idx:N,score:le(T,d,c)})).sort((T,N)=>N.score!==T.score?N.score-T.score:T.idx-N.idx).map(T=>T.it):[]},Mt=async(s,d)=>{if(!(!gt||d.length===0)){Qe(!0);try{const c=d.map(P=>({id:P.id,name:P.name,price:P.price,category:P.category,note:P.note,folder:P.folder,_type:P._type})),v=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:c},"AI Search error");if(v&&v.matchedIds&&v.matchedIds.length>0){const{contentTokens:P,cleanedQuery:T}=ot(s),N=new Set(v.matchedIds),$=d.filter(ne=>N.has(ne.id)).sort((ne,z)=>le(z,P,T)-le(ne,P,T));$.length>0&&J($)}else v&&v.matchedIds&&v.matchedIds.length===0&&J([])}catch(c){console.error("AI Search error:",c)}Qe(!1)}},bt=s=>{if(ye(s),S(s),Xt.current&&clearTimeout(Xt.current),Lt.current&&clearTimeout(Lt.current),A.current&&A.current.abort(),!s.trim()){yt(Ge);return}const c=`v2|${xe(s).trim().replace(/\s+/g,"")}|${Ge}`;if(Q.current.has(c)){J(Q.current.get(c));return}const{allowedTypes:v,contentTokens:P,cleanedQuery:T}=ot(s);Xt.current=setTimeout(()=>{const N=X.filter(z=>{if(!v.has(z==null?void 0:z._type))return!1;if(P.length===0)return!0;const W=gn(Object.entries(z).filter(([Ne])=>!Ne.startsWith("_")).map(([,Ne])=>String(Ne||"")).join(" ")),de=z.phone?R(z.phone):"",We=`${W} ${de}`.trim(),f=We.replace(/\s+/g,"");return P.every(Ne=>{const Ct=String(Ne||"").trim();return Ct?We.includes(Ct)||f.includes(Ct.replace(/\s+/g,"")):!0})});let $=N;Ge!=="all"&&($=N.filter(z=>(z==null?void 0:z._type)===Ge));const ne=He($,P,T);if(Nt(s),mn(s,ne),Q.current.size>20){const z=Q.current.keys().next().value;Q.current.delete(z)}Q.current.set(c,ne),J(ne),gt&&T.length>=3&&(Lt.current=setTimeout(()=>{Mt(T,$)},500))},200)},yt=s=>{at(s);const{allowedTypes:d,contentTokens:c}=ot(F),{cleanedQuery:v}=ot(F);let P=X.filter(T=>d.has(T==null?void 0:T._type));s!=="all"&&(P=P.filter(T=>(T==null?void 0:T._type)===s)),F.trim()&&c.length>0&&(P=P.filter(T=>{const N=xe(Object.entries(T).filter(([W])=>!W.startsWith("_")).map(([,W])=>String(W||"")).join(" ")),$=T.phone?R(T.phone):"",ne=`${N} ${$}`.trim(),z=ne.replace(/\s+/g,"");return c.every(W=>{const de=String(W||"").trim();return de?ne.includes(de)||z.includes(de.replace(/\s+/g,"")):!0})})),J(He(P,c,v))},Le=(s,d,c)=>{c&&c.item&&et(c.item,c.action||"copy"),window.KTM.clipboard.writeText(s).then(()=>{ze(d),I("\u0110\xE3 copy!","success"),setTimeout(()=>ze(null),1500)})},D=async(s,d,c)=>{try{c&&c.item&&et(c.item,c.action||"copy_image"),await window.KTM.clipboard.writeImageFromUrl(s),ze(d+"-img"),I("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>ze(null),1500)}catch(v){Le(s,d+"-img",c)}},oe=s=>{let d=s.toLowerCase();const c=[],v=X.filter(N=>N._type==="product");if(d.includes("ty")||d.includes("xy lanh")){if(d.includes("gi\u1EEFa")||d.includes("giua")){const N=v.find($=>{var ne;return(ne=$.name)==null?void 0:ne.toLowerCase().includes("xy lanh gi\u1EEFa")});N&&!c.find($=>$.id===N.id)&&c.push(N)}if(d.includes("nghi\xEAng")||d.includes("nghieng")){const N=v.find($=>{var ne;return(ne=$.name)==null?void 0:ne.toLowerCase().includes("xy lanh nghi\xEAng")});N&&!c.find($=>$.id===N.id)&&c.push(N)}if(d.includes("\u1EE7i")||d.includes("ui")){const N=v.find($=>{var ne;return(ne=$.name)==null?void 0:ne.toLowerCase().includes("xy lanh \u1EE7i")});N&&!c.find($=>$.id===N.id)&&c.push(N)}}const P=d.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(P){const N=P[1],$=P[2],ne=v.find(z=>{var de;const W=((de=z.name)==null?void 0:de.toLowerCase())||"";return W.includes("combo")&&W.includes(`${N} tay`)&&(W.includes(`${$} xy`)||W.includes(`${$} xylanh`))});if(ne&&!c.find(z=>z.id===ne.id))c.push(ne);else{const z=v.find(W=>{var We;const de=((We=W.name)==null?void 0:We.toLowerCase())||"";return de.includes("combo")&&de.includes(`${N} tay`)});z&&!c.find(W=>W.id===z.id)&&c.push(z)}}if(d.includes("combo")&&!P){const N=d.match(/combo.*?(\d+)\s*tay/);if(N){const $=N[1];v.filter(z=>{var de;const W=((de=z.name)==null?void 0:de.toLowerCase())||"";return W.includes("combo")&&W.includes(`${$} tay`)}).forEach(z=>{c.find(W=>W.id===z.id)||c.push(z)})}}const T=d.match(/van\s*(\d+)\s*tay/);if(T&&!d.includes("ty")&&!d.includes("combo")){const N=T[1],$=v.find(ne=>{var W;const z=((W=ne.name)==null?void 0:W.toLowerCase())||"";return z.includes(`van ${N} tay`)&&!z.includes("combo")});$&&!c.find(ne=>ne.id===$.id)&&c.push($)}return c.slice(0,4)},qe=async s=>{if(!s.trim())return;const d={role:"user",content:s,attachments:[]};Me(v=>[...v,d]),en(""),dn(!0);const c=oe(s);setTimeout(()=>{var v;return(v=Ft.current)==null?void 0:v.scrollIntoView({behavior:"smooth"})},100);try{const P=X.filter(W=>W._type==="product").map(W=>{let de=`- ${W.name}`;return W.code&&(de+=` (M\xE3: ${W.code})`),W.price&&(de+=` - Gi\xE1: ${W.price.replace(/[đ\s]/g,"")}\u0111`),W.category&&(de+=` [${W.category}]`),W.note&&(de+=` (${W.note})`),de}).join(`
`),N=Kt.slice(-6).map(W=>`${W.role==="user"?"Kh\xE1ch":"AI"}: ${W.content}`).join(`
`),$=N?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${N}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${P}`:P,z=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:$,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";Me(W=>[...W,{role:"assistant",content:z,attachments:c}])}catch(v){console.error("AI Error:",v);const P=s.toLowerCase(),T=X.filter($=>{const ne=Object.values($).join(" ").toLowerCase();return P.split(" ").some(z=>ne.includes(z))});let N="";T.length>0?(N=`T\xECm th\u1EA5y ${T.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,T.slice(0,5).forEach($=>{N+=`\u2022 ${$.name}`,$.price&&(N+=` - ${$.price.replace(/[đ\s]/g,"")}\u0111`),$.note&&(N+=` (${$.note})`),N+=`
`}),T.length>5&&(N+=`
...v\xE0 ${T.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):N='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',Me($=>[...$,{role:"assistant",content:N,attachments:T.slice(0,4)}])}dn(!1),setTimeout(()=>{var v,P;(v=Ft.current)==null||v.scrollIntoView({behavior:"smooth"}),(P=hn.current)==null||P.focus()},100)};function ht({show:s,product:d,categories:c,onClose:v,onSave:P}){const[T,N]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[$,ne]=useState(!1),[z,W]=useState(!1),de=useRef(null),We=Y=>window.KTM.money.formatVNDInputDigits(Y),f=Y=>{const ee=window.KTM.money.getDigits(String(Y!=null?Y:"")),be=Number(ee);return ee&&Number.isFinite(be)?Math.trunc(be):0},Ne=(Y,ee)=>{if(Y==null||Y==="")return[];let be=Y;if(typeof be=="string"){const $e=be.trim();if(!$e)return[];try{be=JSON.parse($e)}catch(ke){return[]}}if(!Array.isArray(be))return[];const je=f(ee);return be.map($e=>{var ct;if(!$e||typeof $e!="object")return null;const ke=String((ct=$e.name)!=null?ct:"").trim(),mt=(Array.isArray($e.options)?$e.options:[]).map(St=>{var kn,$n,In,Rn,qn,Ln,fa;if(!St||typeof St!="object")return null;const Zt=String((kn=St.label)!=null?kn:"").trim();if(!Zt)return null;const ln=(qn=(Rn=(In=($n=St.price)!=null?$n:St.priceValue)!=null?In:St.unit_price)!=null?Rn:St.unitPrice)!=null?qn:null,Nn=Number(ln);let xn=Number.isFinite(Nn)?Math.trunc(Nn):null;if(xn==null){const Dn=(fa=(Ln=St.price_delta)!=null?Ln:St.priceDelta)!=null?fa:null,Hn=Number(Dn);Number.isFinite(Hn)&&(xn=je+Math.trunc(Hn))}xn==null&&(xn=je);const Sn=String(Math.max(0,Math.trunc(Number(xn)||0)));return{label:Zt,price:Math.max(0,Math.trunc(Number(xn)||0)),priceDigits:Sn}}).filter(Boolean);return{name:ke||"Bi\u1EBFn th\u1EC3",options:mt}}).filter(Boolean)},Ct=Y=>{if(Y==null||Y==="")return[];let ee=Y;if(typeof ee=="string"){const be=ee.trim();if(!be)return[];try{ee=JSON.parse(be)}catch(je){return[]}}return ee&&typeof ee=="object"&&!Array.isArray(ee)&&(ee=Object.entries(ee).map(([be,je])=>({key:be,value:je}))),Array.isArray(ee)?ee.map(be=>{var mt,ct,St,Zt,ln;if(!be||typeof be!="object")return null;const je=String((St=(ct=(mt=be.key)!=null?mt:be.name)!=null?ct:be.label)!=null?St:"").trim(),$e=String((Zt=be.value)!=null?Zt:"").trim(),ke=String((ln=be.unit)!=null?ln:"").trim();return je?{key:je,value:$e,unit:ke}:null}).filter(Boolean):[]};useEffect(()=>{var Y,ee;if(d)if(N({name:d.name||"",code:d.code||"",price:d.price||"",image:d.image||"",category:d.category||"",note:d.note||"",sort_order:d.sort_order||0,commission_percent:(ee=(Y=d.commission_percent)!=null?Y:d.commissionPercent)!=null?ee:5,variants:Ne(d.variants,d.price),attributes:Ct(d.attributes)}),d.price){const be=window.KTM.money.getDigits(d.price);Jt(be),N(je=>({...je,price:We(be)}))}else Jt("");else N({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Jt("")},[d,s]);const $t=Y=>{N(ee=>{var mt;const be=f(ee.price),je=String(be),$e=Array.isArray(ee.variants)?[...ee.variants]:[],ke={...$e[Y]||{},options:Array.isArray((mt=$e[Y])==null?void 0:mt.options)?[...$e[Y].options]:[]};return ke.options=ke.options.map(ct=>({label:String((ct==null?void 0:ct.label)||""),price:be,priceDigits:je})),$e[Y]=ke,{...ee,variants:$e}})},Et=()=>{N(Y=>{const ee=f(Y.price),be=String(ee),$e=(Array.isArray(Y.variants)?[...Y.variants]:[]).map(ke=>{const mt=(Array.isArray(ke==null?void 0:ke.options)?ke.options:[]).map(ct=>({label:String((ct==null?void 0:ct.label)||""),price:ee,priceDigits:be}));return{name:String((ke==null?void 0:ke.name)||"Bi\u1EBFn th\u1EC3"),options:mt}});return{...Y,variants:$e}})},[qt,Qt]=React.useState(""),[Ht,Jt]=React.useState(""),ft=Y=>{const ee=window.KTM.money.nextPriceInputState(Y.target.value,Ht);Jt(ee.digits),N({...T,price:ee.price})},on=async(Y,ee=2)=>{const be=ee*1024*1024;if(Y.size<=be)return Y;try{const je=await createImageBitmap(Y),$e=document.createElement("canvas");let ke=je.width,mt=je.height;const ct=1200;return(ke>ct||mt>ct)&&(ke>mt?(mt=Math.round(mt/ke*ct),ke=ct):(ke=Math.round(ke/mt*ct),mt=ct)),$e.width=ke,$e.height=mt,$e.getContext("2d").drawImage(je,0,0,ke,mt),je.close(),new Promise((Zt,ln)=>{$e.toBlob(Nn=>{Nn?Zt(new File([Nn],Y.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ln(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(je){throw console.error("Compress error:",je),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},pn=async Y=>{var je;const ee=Y.target.files[0];if(!ee)return;if(!(ee.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(ee.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}W(!0);try{const $e=await on(ee),ke=await window.KTM.cloudinary.uploadImage({file:$e,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!ke.secure_url)throw console.error("Cloudinary error:",ke),new Error(((je=ke.error)==null?void 0:je.message)||"Upload failed");N(mt=>({...mt,image:ke.secure_url}))}catch($e){console.error("Upload error:",$e),alert("L\u1ED7i upload \u1EA3nh: "+$e.message)}W(!1),Y.target.value=""},cn=async Y=>{Y.preventDefault(),ne(!0);const ee={...T,variants:Ne(T.variants,T.price),attributes:Ct(T.attributes)};await P(ee),ne(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),d?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:v})),React.createElement("form",{onSubmit:cn},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:T.name,onChange:Y=>N({...T,name:Y.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:T.code,onChange:Y=>N({...T,code:Y.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:T.price,onChange:ft,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:T.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:Y=>N({...T,commission_percent:Y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:T.category,onChange:Y=>N({...T,category:Y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),c.map(Y=>React.createElement("option",{key:Y,value:Y},Y)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:T.note,onChange:Y=>N({...T,note:Y.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.attributes)?T.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(T.attributes)?T.attributes:[]).map((Y,ee)=>React.createElement("div",{key:ee,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(Y==null?void 0:Y.key)||"",onChange:be=>{const je=be.target.value;N($e=>{const ke=Array.isArray($e.attributes)?[...$e.attributes]:[];return ke[ee]={...ke[ee]||{},key:je},{...$e,attributes:ke}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(Y==null?void 0:Y.value)||"",onChange:be=>{const je=be.target.value;N($e=>{const ke=Array.isArray($e.attributes)?[...$e.attributes]:[];return ke[ee]={...ke[ee]||{},value:je},{...$e,attributes:ke}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(Y==null?void 0:Y.unit)||"",onChange:be=>{const je=be.target.value;N($e=>{const ke=Array.isArray($e.attributes)?[...$e.attributes]:[];return ke[ee]={...ke[ee]||{},unit:je},{...$e,attributes:ke}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{N(be=>{const je=Array.isArray(be.attributes)?[...be.attributes]:[];return je.splice(ee,1),{...be,attributes:je}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{N(Y=>{const ee=Array.isArray(Y.attributes)?[...Y.attributes]:[];return ee.push({key:"",value:"",unit:""}),{...Y,attributes:ee}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.variants)?T.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(T.variants)?T.variants:[]).map((Y,ee)=>React.createElement("div",{key:ee,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(Y==null?void 0:Y.name)||"",onChange:be=>{const je=be.target.value;N($e=>{var mt;const ke=Array.isArray($e.variants)?[...$e.variants]:[];return ke[ee]={...ke[ee]||{},name:je,options:Array.isArray((mt=ke[ee])==null?void 0:mt.options)?ke[ee].options:[]},{...$e,variants:ke}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>$t(ee),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(Y==null?void 0:Y.options)||Y.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{N(be=>{const je=Array.isArray(be.variants)?[...be.variants]:[];return je.splice(ee,1),{...be,variants:je}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(Y==null?void 0:Y.options)?Y.options:[]).map((be,je)=>{var $e,ke;return React.createElement("div",{key:je,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(be==null?void 0:be.label)||"",onChange:mt=>{const ct=mt.target.value;N(St=>{var Sn,kn,$n,In,Rn;const Zt=Array.isArray(St.variants)?[...St.variants]:[],ln={...Zt[ee]||{},options:Array.isArray((Sn=Zt[ee])==null?void 0:Sn.options)?[...Zt[ee].options]:[]},Nn=Number(($n=(kn=ln.options[je])==null?void 0:kn.price)!=null?$n:0)||0,xn=String((Rn=(In=ln.options[je])==null?void 0:In.priceDigits)!=null?Rn:Math.max(0,Math.trunc(Nn)));return ln.options[je]={...ln.options[je]||{},label:ct,price:Math.max(0,Math.trunc(Nn)),priceDigits:xn},Zt[ee]=ln,{...St,variants:Zt}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:We(String((ke=be==null?void 0:be.priceDigits)!=null?ke:window.KTM.money.getDigits(String(($e=be==null?void 0:be.price)!=null?$e:"")))),onChange:mt=>{N(ct=>{var $n,In,Rn,qn,Ln;const St=String((In=be==null?void 0:be.priceDigits)!=null?In:window.KTM.money.getDigits(String(($n=be==null?void 0:be.price)!=null?$n:""))),Zt=window.KTM.money.nextPriceInputState(mt.target.value,St),ln=String((Rn=Zt.digits)!=null?Rn:""),Nn=Number(ln),xn=Number.isFinite(Nn)?Math.max(0,Math.trunc(Nn)):0,Sn=Array.isArray(ct.variants)?[...ct.variants]:[],kn={...Sn[ee]||{},options:Array.isArray((qn=Sn[ee])==null?void 0:qn.options)?[...Sn[ee].options]:[]};return kn.options[je]={...kn.options[je]||{},label:String(((Ln=kn.options[je])==null?void 0:Ln.label)||""),price:xn,priceDigits:ln},Sn[ee]=kn,{...ct,variants:Sn}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{N(mt=>{var Zt;const ct=Array.isArray(mt.variants)?[...mt.variants]:[],St={...ct[ee]||{},options:Array.isArray((Zt=ct[ee])==null?void 0:Zt.options)?[...ct[ee].options]:[]};return St.options.splice(je,1),ct[ee]=St,{...mt,variants:ct}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{N(be=>{var mt;const je=Array.isArray(be.variants)?[...be.variants]:[],$e={...je[ee]||{},options:Array.isArray((mt=je[ee])==null?void 0:mt.options)?[...je[ee].options]:[]},ke=f(be.price);return $e.options.push({label:"",price:ke,priceDigits:String(ke)}),je[ee]=$e,{...be,variants:je}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{N(Y=>{const ee=f(Y.price),be=Array.isArray(Y.variants)?[...Y.variants]:[],je=String(ee);return be.push({name:"Size",options:[{label:"S",price:ee,priceDigits:je},{label:"M",price:ee,priceDigits:je},{label:"L",price:ee,priceDigits:je}]}),{...Y,variants:be}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Et,disabled:!Array.isArray(T.variants)||T.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},T.image?React.createElement(React.Fragment,null,React.createElement("img",{src:T.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>N({...T,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var Y;return(Y=de.current)==null?void 0:Y.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:de,type:"file",accept:"image/*",className:"d-none",onChange:pn}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var Y;return(Y=de.current)==null?void 0:Y.click()},disabled:z,style:{borderRadius:"10px"}},z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:T.image,onChange:Y=>N({...T,image:Y.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:v,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:$,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},$?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const _t=s=>window.KTM.money.formatVND(s),Gt=s=>{if(s==null||s==="")return[];let d=s;if(typeof d=="string"){const c=d.trim();if(!c)return[];try{d=JSON.parse(c)}catch(v){return[]}}return Array.isArray(d)?d:[]},vt=s=>{if(s==null||s==="")return[];let d=s;if(typeof d=="string"){const c=d.trim();if(!c)return[];try{d=JSON.parse(c)}catch(v){return[]}}return d&&typeof d=="object"&&!Array.isArray(d)&&(d=Object.entries(d).map(([c,v])=>({key:c,value:v}))),Array.isArray(d)?d:[]},Rt=(s,d={})=>{var T;const c=vt(s).map(N=>{var $,ne,z,W,de;return{key:String((z=(ne=($=N==null?void 0:N.key)!=null?$:N==null?void 0:N.name)!=null?ne:N==null?void 0:N.label)!=null?z:"").trim(),value:String((W=N==null?void 0:N.value)!=null?W:"").trim(),unit:String((de=N==null?void 0:N.unit)!=null?de:"").trim()}}).filter(N=>!!N.key);if(!c.length)return null;const v=!!d.compact,P=String((T=d.className)!=null?T:"").trim();return React.createElement("div",{className:`ktm-variants-preview${v?" compact":""}${P?" "+P:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},c.map((N,$)=>{const ne=N.key,z=`${N.value||""}${N.unit?(N.value?" ":"")+N.unit:""}`.trim();return React.createElement("div",{key:`${ne}-${$}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ne),z?React.createElement("span",{className:"ktm-chip ktm-chip-option"},z):null)})))},nn=(s,d={})=>{var ne;const c=Gt(s).map(z=>{var W;return{name:String((W=z==null?void 0:z.name)!=null?W:"").trim(),options:Array.isArray(z==null?void 0:z.options)?z.options:[]}}).map(z=>({...z,options:z.options.map(W=>{var de;return{label:String((de=W==null?void 0:W.label)!=null?de:"").trim(),price:Number(W==null?void 0:W.price)}}).filter(W=>!!W.label)})).filter(z=>z.options.length>0);if(!c.length)return null;const v=Number.isFinite(d.maxGroups)?Math.max(1,Math.trunc(d.maxGroups)):c.length,P=Number.isFinite(d.maxOptionsPerGroup)?Math.max(1,Math.trunc(d.maxOptionsPerGroup)):3,T=!!d.compact,N=String((ne=d.className)!=null?ne:"").trim(),$=c.slice(0,v);return React.createElement("div",{className:`ktm-variants-preview${T?" compact":""}${N?" "+N:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},$.map((z,W)=>{const de=z.name||"Bi\u1EBFn th\u1EC3",We=z.options.slice(0,P),f=z.options.length-We.length;return React.createElement("div",{key:`${de}-${W}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},de),We.map((Ne,Ct)=>{const $t=Ne.price,Et=Number.isFinite($t)&&$t>=0?_t(Math.trunc($t)):"",qt=Et?`${Ne.label} \xB7 ${Et}`:Ne.label;return React.createElement("span",{key:`${de}-${W}-${Ct}`,className:"ktm-chip ktm-chip-option"},qt)}),f>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",f))})))},Ot=(s,d)=>{const c=s._type==="product",v=s._type==="album",P=s._type==="video",T=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),N=c?Rt(s.attributes,{compact:we==="grid",className:we==="grid"?"meta text-muted":"text-muted"}):null,$=c?nn(s.variants,{compact:we==="grid",maxOptionsPerGroup:999,className:we==="grid"?"meta text-muted":"text-muted"}):null;return we==="grid"?React.createElement("div",{key:s.id||d,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>{et(s,"preview"),un({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${P?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${c?"product":v?"album":"video"}`},c?"SP":v?"\u1EA2nh":"Video"),T&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),N&&React.createElement("div",{style:{marginTop:2}},N),$&&React.createElement("div",{style:{marginTop:2}},$),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:Be===s.id+"-img"?"copied":"",onClick:()=>D(s.image,s.id,{item:s,action:"copy_image"})},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:Be===s.id+"-price"?"copied":"",onClick:()=>Le(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||d,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${c?"product":v?"album":"video"}`},c?"S\u1EA3n ph\u1EA9m":v?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>{et(s,"preview"),un({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${P?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),T&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),N&&React.createElement("div",{style:{marginTop:4}},N),$&&React.createElement("div",{style:{marginTop:4}},$)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),P&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},c&&React.createElement("button",{onClick:()=>{et(s,"create_order"),E&&E("orders","create",{productId:s.id})}},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:Be===s.id+"-price"?"copied":"",onClick:()=>Le(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:Be===s.id+"-name"?"copied":"",onClick:()=>Le(s.name,s.id+"-name",{item:s,action:"copy_name"})},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),P&&s.youtubeId&&React.createElement("button",{className:Be===s.id+"-yt"?"copied":"",onClick:()=>Le(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),c&&React.createElement("button",{className:"action-edit",onClick:()=>U(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Ce(s)},React.createElement("i",{className:"fas fa-trash"}))))},[Z,fe]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"search-suggestions mobile-only"},React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"G\u1EE3i \xFD nhanh"),React.createElement("div",{className:"search-suggestions-row"},[{label:"van 2 tay",query:"van 2 tay"},{label:"combo r\u1EBB",query:"combo r\u1EBB"},{label:"xylanh",query:"xylanh"},{label:"sdt:\u2026",query:"sdt:",caret:"end",addToHistory:!1},{label:"#m\xE3\u2026",query:"#",caret:"end",addToHistory:!1}].map(s=>React.createElement("button",{key:s.label,type:"button",className:"suggestion-chip",onClick:()=>bn(s.query,{caret:s.caret,addToHistory:s.addToHistory,focus:!1})},s.label)))),rn.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"S\u1EA3n ph\u1EA9m hay t\xECm"),React.createElement("div",{className:"search-suggestions-row"},rn.map(s=>{var P,T;const d=(((P=s.item)==null?void 0:P.name)||s.name||"").trim();if(!d)return null;const c=String(((T=s.item)==null?void 0:T.code)||s.code||"").trim(),v=c?`#${c}`:d;return React.createElement("button",{key:s.id,type:"button",className:"suggestion-chip suggestion-chip-popular",onClick:()=>{s.item&&et(s.item,"suggestion"),bn(v,{caret:"end",focus:!1})},title:c?`#${c}`:d},d)}))),Wt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"T\xECm g\u1EA7n \u0111\xE2y / hay d\xF9ng"),React.createElement("div",{className:"search-suggestions-row"},Wt.map(s=>React.createElement("button",{key:s.q,type:"button",className:"suggestion-chip suggestion-chip-query",onClick:()=>bn(s.q,{caret:"end",focus:!1}),title:`${s.q} (${s.count})`},s.q))))),React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,ae.length)," k\u1EBFt qu\u1EA3",gt&&F.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Ge!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Ge==="product"?"S\u1EA3n ph\u1EA9m":Ge==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${we==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Ee("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${we==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Ee("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},q?React.createElement("div",null,[...Array(8)].map((s,d)=>React.createElement("div",{key:d,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):ae.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',F,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{ye(""),bt("")}},"Xem t\u1EA5t c\u1EA3")):we==="grid"?React.createElement("div",{className:"product-grid-mobile"},ae.map((s,d)=>Ot(s,d))):React.createElement("div",null,ae.map((s,d)=>Ot(s,d)))),Z&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>fe(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Ge==="all"?"active":""}`,onClick:()=>{yt("all"),fe(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Ge==="product"?"active":""}`,onClick:()=>{yt("product"),fe(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Ge==="album"?"active":""}`,onClick:()=>{yt("album"),fe(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Ge==="video"?"active":""}`,onClick:()=>{yt("video"),fe(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:gt,onChange:s=>Pt(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:Re,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:F,onChange:s=>bt(s.target.value)}),React.createElement("button",{className:`filter-btn ${Z||Ge!=="all"?"active":""}`,onClick:()=>fe(!Z)},React.createElement("i",{className:"fas fa-filter"})))),x&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>H(!1)},React.createElement("div",{className:"search-palette",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:B,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:Te,onChange:s=>bt(s.target.value),onKeyDown:s=>{s.key==="Enter"&&ae.length>0?(Ze(Te),H(!1)):s.key==="Escape"&&H(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>H(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((s,d)=>React.createElement("span",{key:s,className:`filter-chip ${Ge===["all","product","album","video"][d]?"active":""}`,onClick:()=>{yt(["all","product","album","video"][d])}},s)))),ce.length>0&&!Te.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},ce.map((s,d)=>React.createElement("div",{key:d,className:"palette-item",onClick:()=>{bt(s),Ze(s)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,s),React.createElement("button",{className:"unsave-btn",onClick:c=>{c.stopPropagation(),Bt(s)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),ge.length>0&&!Te.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},ge.map((s,d)=>React.createElement("div",{key:d,className:"palette-item",onClick:()=>{bt(s)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,s),React.createElement("button",{className:"save-btn",onClick:c=>{c.stopPropagation(),Bt(s)}},React.createElement("i",{className:`fas fa-star${ce.includes(s)?"":"-o"}`})))))),Te.trim()&&ae.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",ae.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},ae.slice(0,8).map((s,d)=>React.createElement("div",{key:s.id||d,className:"palette-result-item",onClick:()=>{Ze(Te),H(!1)}},s.image&&React.createElement("img",{src:s.image,alt:s.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},s.name),s.price&&React.createElement("div",{className:"result-meta"},s.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:c=>{c.stopPropagation(),Bt(Te)}},React.createElement("i",{className:`fas fa-star${ce.includes(Te)?"":"-o"}`})))))),Te.trim()&&ae.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',Te,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:l?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>kt(!0),onTouchStart:()=>kt(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Ue&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>kt(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},Kt.map((s,d)=>React.createElement("div",{key:d,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:Be===`chat-${d}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:Be===`chat-${d}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),ze(`chat-${d}`),setTimeout(()=>ze(null),1500)}},React.createElement("i",{className:`fas ${Be===`chat-${d}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((c,v)=>React.createElement("div",{key:v,style:{width:70},className:"text-center"},c.image&&React.createElement("img",{src:c.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>un({url:c.image,name:c.name,price:c.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},c.name),c.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},c.price.replace(/[đ\s]/g,""),"\u0111"))))))),Tt&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Ft})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>qe(s),disabled:Tt,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),qe(it)},className:"chat-input-wrap"},React.createElement("input",{ref:hn,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:it,onChange:s=>en(s.target.value),disabled:Tt}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Tt||!it.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),st&&React.createElement("div",{className:"preview-modal",onClick:()=>un(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>un(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:st.url,alt:st.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},st.name),st.price&&React.createElement("div",{className:"price"},st.price.replace(/[đ\s]/g,""),"\u0111"),st.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},st.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:Be==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:Be==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>D(st.url,"preview")},React.createElement("i",{className:`fas ${Be==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),st.price&&React.createElement("button",{className:Be==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Le(st.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${Be==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(ht,{show:g,product:V,categories:Fe,onClose:()=>{M(!1),L(null)},onSave:me}),React.createElement("div",{className:`fab-container mobile-only ${l?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{k(!1),M(!0),L(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{k(!1),E&&E("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${l?"open":""}`,onClick:()=>k(!l)},React.createElement("i",{className:"fas fa-plus"}))),_n&&dt&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>vn(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:h.name,onChange:s=>C({...h,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:h.code,onChange:s=>C({...h,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:h.price,onChange:s=>C({...h,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:h.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>C({...h,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:h.category,onChange:s=>C({...h,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),_.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:h.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>C({...h,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>vn(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:ie},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:I,showToast:E}){const[F,ye]=useState([]),[ae,J]=useState([]),[X,Oe]=useState(!0),[Fe,Se]=useState(null),[Ge,at]=useState(!1),[Be,ze]=useState(null),[we,Ee]=useState(!1),[q,ut]=useState(null),[wt,xt]=useState(!1),[Xe,nt]=useState(null),[Re,gt]=useState(!1),[Pt,sn]=useState(!1),[Qe,Lt]=useState(null),[Xt,A]=useState(!1),[x,H]=useState(null),[ge,ve]=useState([]);useEffect(()=>{ce()},[]);const ce=async(R=null)=>{Oe(!0);try{const se=R?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${R}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Ze=await window.KTM.api.getJSON(se,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");ye(Array.isArray(Ze)?Ze:[])}catch(se){console.error(se),E("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}Oe(!1)},ue=async R=>{try{const se=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${R}`,"L\u1ED7i t\u1EA3i video");J(Array.isArray(se)?se:[])}catch(se){console.error(se)}},Te=async R=>{if(R===0)return;const se=[...F];[se[R-1],se[R]]=[se[R],se[R-1]],ye(se),await B(se)},S=async R=>{if(R===F.length-1)return;const se=[...F];[se[R],se[R+1]]=[se[R+1],se[R]],ye(se),await B(se)},B=async R=>{try{await Promise.all(R.map((se,Ze)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${se.id}`,{sortOrder:Ze},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),E("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(se){E("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ce(x==null?void 0:x.id)}},Q=async R=>{if(R===0)return;const se=[...ae];[se[R-1],se[R]]=[se[R],se[R-1]],J(se),await Ie(se)},re=async R=>{if(R===ae.length-1)return;const se=[...ae];[se[R],se[R+1]]=[se[R+1],se[R]],J(se),await Ie(se)},Ie=async R=>{try{await Promise.all(R.map((se,Ze)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${se.id}`,{sort_order:Ze},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),E("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(se){E("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ue(Fe.id)}},Ae=()=>{ze(null),at(!0)},Ye=R=>{Lt(R),sn(!0),A(!0)},Ue=async(R,se="modal")=>{try{!Be&&x&&(R.parent_id=x.id);const Ze=Be?`${API_BASE}/api/video-folders/${Be.id}`:`${API_BASE}/api/video-folders`;Be?await window.KTM.api.putJSON(Ze,R,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Ze,R,"L\u1ED7i l\u01B0u folder"),E(Be?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),se==="drawer"?(A(!1),ze(null),ce(x==null?void 0:x.id),Be&&Qe&&Lt({...Qe,...R})):(at(!1),ze(null),ce(x==null?void 0:x.id))}catch(Ze){E(Ze.message,"danger")}},kt=async R=>{const se=R.subfolderCount>0?`X\xF3a folder "${R.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${R.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(se))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${R.id}`,"L\u1ED7i x\xF3a folder"),E("\u0110\xE3 x\xF3a folder","success"),Se(null),ce(x==null?void 0:x.id)}catch(Ze){E("L\u1ED7i x\xF3a folder","danger")}},Kt=R=>{R.subfolderCount>0?(ve(se=>[...se,R]),H(R),ce(R.id)):(Se(R),J(R.videos||[]))},Me=R=>{if(R==="root")ve([]),H(null),ce(null);else if(R){const se=ge.findIndex(Ze=>Ze.id===R.id);se>=0&&(ve(ge.slice(0,se+1)),H(R),ce(R.id))}else{const se=[...ge];se.pop();const Ze=se[se.length-1]||null;ve(se),H(Ze),ce(Ze==null?void 0:Ze.id)}},it=()=>{sn(!1),A(!1),Lt(null)},en=()=>{xt(!1),gt(!1),nt(null)},Tt=()=>{ut(null),Ee(!0)},dn=R=>{nt(R),xt(!0),gt(!0)},Ft=async(R,se="modal")=>{try{R.folder_id=Fe==null?void 0:Fe.id;const Ze=q?`${API_BASE}/api/videos/${q.id}`:`${API_BASE}/api/videos`;q?await window.KTM.api.putJSON(Ze,R,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Ze,R,"L\u1ED7i l\u01B0u video"),E(q?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),se==="drawer"?(gt(!1),ut(null),ce(),Fe&&ue(Fe.id),q&&Xe&&nt({...Xe,...R})):(Ee(!1),ut(null),ce(),Fe&&ue(Fe.id))}catch(Ze){E(Ze.message,"danger")}},hn=async R=>{if(confirm(`X\xF3a video "${R.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${R.id}`,"L\u1ED7i x\xF3a video"),E("\u0110\xE3 x\xF3a video","success"),ce(),Fe&&ue(Fe.id)}catch(se){E("L\u1ED7i x\xF3a video","danger")}},gn=R=>{const se=`https://www.youtube.com/watch?v=${R.youtubeId}`;window.KTM.clipboard.writeText(se).then(()=>{E("\u0110\xE3 copy link!","success")}).catch(()=>{E("Kh\xF4ng th\u1EC3 copy link","danger")})};return Fe?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Se(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${Fe.slug==="shorts"?"text-danger":"text-warning"}`}),Fe.name)),React.createElement("button",{className:"btn btn-warning",onClick:Tt},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),ae.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},ae.map((R,se)=>React.createElement("div",{key:R.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Q(se),disabled:se===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},se+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>re(se),disabled:se===ae.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:R.thumb,className:"card-img-top",alt:R.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${R.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:R.title},R.title),React.createElement("small",{className:"text-muted"},R.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>gn(R),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>dn(R),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>hn(R),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:we,video:q,onClose:()=>Ee(!1),onSave:Ft}),React.createElement(AdminDrawer,{open:Pt,title:Qe?Qe.name:"Folder",subtitle:Qe?`${Qe.subfolderCount||0} subfolder \u2022 ${Qe.videoCount||0} videos`:"",onClose:it,footer:Xt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:it},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Qe&&Ue({name:Qe.name||"",description:Qe.description||"",sortOrder:Qe.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Qe?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Qe.name),E("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{A(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Qe.name}"?`)&&(kt(Qe),it())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Xt&&Qe?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Qe.name||"",onChange:R=>Lt({...Qe,name:R.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Qe.description||"",onChange:R=>Lt({...Qe,description:R.target.value})}))):Qe?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Qe.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Qe.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Qe.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Qe.videoCount||0))),Qe.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Qe.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:wt,title:Xe?Xe.title:"Video",subtitle:Xe?`${Xe.youtubeId}`:"",onClose:en,footer:Re?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:en},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Xe&&Ft({youtube_url:`https://www.youtube.com/watch?v=${Xe.youtubeId}`,title:Xe.title||"",thumbnail_url:Xe.thumb||"",sort_order:Xe.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Xe?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const R=`https://www.youtube.com/watch?v=${Xe.youtubeId}`;window.KTM.clipboard.writeText(R).then(()=>{E("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{gt(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${Xe.title}"?`)&&(hn(Xe),en())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Re&&Xe?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:Xe.title||"",onChange:R=>nt({...Xe,title:R.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:Xe.youtubeId||"",onChange:R=>nt({...Xe,youtubeId:R.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Xe.sortOrder||0,onChange:R=>nt({...Xe,sortOrder:parseInt(R.target.value)||0})}))):Xe?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},Xe.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},Xe.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},Xe.sortOrder||0))),Xe.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:Xe.thumb,alt:Xe.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},x&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Me()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),x?x.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:Ae},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),ge.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:R=>{R.preventDefault(),Me("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ge.map((R,se)=>React.createElement("li",{key:R.id,className:`breadcrumb-item ${se===ge.length-1?"active":""}`},se===ge.length-1?R.name:React.createElement("a",{href:"#",onClick:Ze=>{Ze.preventDefault(),Me(R)},className:"text-warning"},R.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),X?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):F.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},x?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Ae},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",x?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},F.map((R,se)=>{var Ze,Bt,fn,Vt;return React.createElement("div",{key:R.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Yt=>{Yt.stopPropagation(),Te(se)},disabled:se===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},se+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Yt=>{Yt.stopPropagation(),S(se)},disabled:se===F.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>Kt(R),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${R.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},R.name),React.createElement("p",{className:"text-muted mb-0"},R.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),R.subfolderCount," folder"),R.subfolderCount>0&&(R.videoCount>0||((Ze=R.videos)==null?void 0:Ze.length)>0)&&" \u2022 ",(R.videoCount>0||((Bt=R.videos)==null?void 0:Bt.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),R.videoCount||((fn=R.videos)==null?void 0:fn.length)||0," videos"),R.subfolderCount===0&&!R.videoCount&&!((Vt=R.videos)!=null&&Vt.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Yt=>{Yt.stopPropagation(),Ye(R)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Yt=>{Yt.stopPropagation(),kt(R)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Ge,folder:Be,onClose:()=>at(!1),onSave:Ue}))}function VideoFolderModal({show:I,folder:E,onClose:F,onSave:ye}){const[ae,J]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[X,Oe]=useState(!1),[Fe,Se]=useState(!1);useEffect(()=>{J(E?{name:E.name||"",description:E.description||"",sortOrder:E.sortOrder||0,coverImage:E.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[E,I]);const Ge=async Be=>{const ze=Be.target.files[0];if(ze){Se(!0);try{const we=await window.KTM.cloudinary.uploadImage({file:ze,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});we.secure_url&&J(Ee=>({...Ee,coverImage:we.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(we){console.error("Cloudinary upload error:",we),alert("L\u1ED7i upload \u1EA3nh: "+(we.message||we))}finally{Se(!1)}}},at=async Be=>{Be.preventDefault(),Oe(!0);const ze={...ae,variants:normalizeVariants(ae.variants,ae.price),attributes:normalizeAttributes(ae.attributes)};await ye(ze),Oe(!1)};return I?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},E?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:F})),React.createElement("form",{onSubmit:at},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:ae.name,onChange:Be=>J({...ae,name:Be.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:ae.description,onChange:Be=>J({...ae,description:Be.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ae.sortOrder,onChange:Be=>J({...ae,sortOrder:parseInt(Be.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},ae.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:ae.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>J({...ae,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Ge,disabled:Fe}),Fe&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:ae.coverImage,onChange:Be=>J({...ae,coverImage:Be.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:F},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:I,settings:E}){const[F,ye]=useState([]),[ae,J]=useState(!0),[X,Oe]=useState(!1),[Fe,Se]=useState(null),[Ge,at]=useState(""),[Be,ze]=useState(""),[we,Ee]=useState(!1),[q,ut]=useState(null),wt=normalizeShipPercent(E==null?void 0:E.ship_percent),{parseMoney:xt,formatVND:Xe}=window.KTM.money,nt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Re()},[]);const Re=async()=>{J(!0);try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");ye(Array.isArray(S)?S:[])}catch(S){console.error(S),I("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}J(!1)},gt=()=>{Se(null),Oe(!0)},Pt=S=>{Se(S),Oe(!0)},sn=S=>{S&&(ut(S),Ee(!0))},Qe=()=>{Ee(!1)},Lt=async S=>{if(!(!S||!S.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:S},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),I(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Re()}catch(B){I("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},Xt=async S=>{try{const B=Fe?`${API_BASE}/api/products?id=${Fe.id}`:`${API_BASE}/api/products`;Fe?await window.KTM.api.putJSON(B,S,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(B,S,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),I(Fe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Oe(!1),Re()}catch(B){I(B.message,"danger")}},A=async S=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${S.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${S.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),I("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Re()}catch(B){I(B.message,"danger")}},x=F.filter(S=>{const B=!Ge||S.name.toLowerCase().includes(Ge.toLowerCase())||S.code&&S.code.toLowerCase().includes(Ge.toLowerCase()),Q=!Be||S.category===Be;return B&&Q}),H=S=>{var re;const B=(re=S==null?void 0:S.commission_percent)!=null?re:S==null?void 0:S.commissionPercent,Q=B===""||B==null?NaN:Number(B);return Number.isFinite(Q)?Math.max(0,Math.min(100,Q)):5},ge=S=>{const B=H(S),Q=Number.isInteger(B)?String(B):String(Math.round(B*100)/100),re=xt(S==null?void 0:S.price);if(!Number.isFinite(re)||re<=0)return`${Q}%`;const Ie=(Number(B)||0)/100,Ye=window.KTM.money.parseShipFeeFromNote(S==null?void 0:S.note)!=null?0:wt>0?re*wt/100:0,Ue=re*Ie-Ye*Ie,kt=Math.max(0,Math.round(Ue));return`${Q}% - ${Xe(kt)}`},ve=S=>{if(S==null||S==="")return[];let B=S;if(typeof B=="string"){const Q=B.trim();if(!Q)return[];try{B=JSON.parse(Q)}catch(re){return[]}}return Array.isArray(B)?B:[]},ce=S=>{if(S==null||S==="")return[];let B=S;if(typeof B=="string"){const Q=B.trim();if(!Q)return[];try{B=JSON.parse(Q)}catch(re){return[]}}return B&&typeof B=="object"&&!Array.isArray(B)&&(B=Object.entries(B).map(([Q,re])=>({key:Q,value:re}))),Array.isArray(B)?B:[]},ue=S=>{const B=ce(S).map(Q=>{var re,Ie,Ae,Ye,Ue;return{key:String((Ae=(Ie=(re=Q==null?void 0:Q.key)!=null?re:Q==null?void 0:Q.name)!=null?Ie:Q==null?void 0:Q.label)!=null?Ae:"").trim(),value:String((Ye=Q==null?void 0:Q.value)!=null?Ye:"").trim(),unit:String((Ue=Q==null?void 0:Q.unit)!=null?Ue:"").trim()}}).filter(Q=>!!Q.key);return B.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},B.map((Q,re)=>{const Ie=Q.key,Ae=`${Q.value||""}${Q.unit?(Q.value?" ":"")+Q.unit:""}`.trim();return React.createElement("div",{key:`${Ie}-${re}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Ie),Ae?React.createElement("span",{className:"ktm-chip ktm-chip-option"},Ae):null)}))):null},Te=(S,B={})=>{const Q=ve(S).map(Ye=>{var Ue;return{name:String((Ue=Ye==null?void 0:Ye.name)!=null?Ue:"").trim(),options:Array.isArray(Ye==null?void 0:Ye.options)?Ye.options:[]}}).map(Ye=>({...Ye,options:Ye.options.map(Ue=>{var kt;return{label:String((kt=Ue==null?void 0:Ue.label)!=null?kt:"").trim(),price:Number(Ue==null?void 0:Ue.price)}}).filter(Ue=>!!Ue.label)})).filter(Ye=>Ye.options.length>0);if(!Q.length)return null;const re=Number.isFinite(B.maxGroups)?Math.max(1,Math.trunc(B.maxGroups)):Q.length,Ie=Number.isFinite(B.maxOptionsPerGroup)?Math.max(1,Math.trunc(B.maxOptionsPerGroup)):4,Ae=Q.slice(0,re);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Ae.map((Ye,Ue)=>{const kt=Ye.name||"Bi\u1EBFn th\u1EC3",Kt=Ye.options.slice(0,Ie),Me=Ye.options.length-Kt.length;return React.createElement("div",{key:`${kt}-${Ue}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},kt),Kt.map((it,en)=>{const Tt=it.price,dn=Number.isFinite(Tt)&&Tt>=0?Xe(Math.trunc(Tt)):"",Ft=dn?`${it.label} \xB7 ${dn}`:it.label;return React.createElement("span",{key:`${kt}-${Ue}-${en}`,className:"ktm-chip ktm-chip-option"},Ft)}),Me>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",Me))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:gt},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:Ge,onChange:S=>at(S.target.value)})),React.createElement("span",{className:"product-count"},x.length)),React.createElement("select",{className:"form-select",value:Be,onChange:S=>ze(S.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),nt.map(S=>React.createElement("option",{key:S,value:S},S)))),ae?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):x.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:gt},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},x.map(S=>React.createElement("div",{key:S.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>sn(S),onKeyDown:B=>{(B.key==="Enter"||B.key===" ")&&(B.preventDefault(),sn(S))},title:"Xem chi ti\u1EBFt"},S.image?React.createElement("img",{src:S.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},S.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},S.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},S.category),S.code&&React.createElement("span",{className:"product-badge bg-secondary"},S.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),ge(S))),React.createElement("div",{className:"product-price"},S.price?S.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),S.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},S.note),ue(S.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},ue(S.attributes)),Te(S.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},Te(S.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:B=>{B.stopPropagation(),Pt(S)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:B=>{B.stopPropagation(),A(S)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:we,title:String((q==null?void 0:q.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((q==null?void 0:q.code)||"").trim()||null,String((q==null?void 0:q.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Qe,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const S=String((q==null?void 0:q.code)||"").trim();S&&window.KTM.clipboard.writeText(S).then(()=>I("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((q==null?void 0:q.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const S=String((q==null?void 0:q.price)||"").trim();S&&window.KTM.clipboard.writeText(S).then(()=>I("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((q==null?void 0:q.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>q&&Pt(q),disabled:!q},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>q&&A(q),disabled:!q},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},q?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const S=String((q==null?void 0:q.price)||"").trim(),B=xt(S);return Number.isFinite(B)&&B>0?Xe(Math.trunc(B)):S||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},ge(q)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},q.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},q.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),q.image?React.createElement("img",{src:q.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(q.note||"").trim()||q.attributes||q.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(q.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(q.note||"").trim()),ue(q.attributes)?React.createElement("div",{className:"mt-2"},ue(q.attributes)):null,Te(q.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},Te(q.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:X,product:Fe,categories:nt,onClose:()=>Oe(!1),onSave:Xt}))}function ProductModal({show:I,product:E,categories:F,onClose:ye,onSave:ae}){const[J,X]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Oe,Fe]=useState(!1),[Se,Ge]=useState(!1),at=A=>{const x=window.KTM.money.getDigits(String(A!=null?A:"")),H=Number(x);return x&&Number.isFinite(H)?Math.trunc(H):0},Be=A=>{if(A==null||A==="")return[];let x=A;if(typeof x=="string"){const H=x.trim();if(!H)return[];try{x=JSON.parse(H)}catch(ge){return[]}}return x&&typeof x=="object"&&!Array.isArray(x)&&(x=Object.entries(x).map(([H,ge])=>({key:H,value:ge}))),Array.isArray(x)?x.map(H=>{var ue,Te,S,B,Q;if(!H||typeof H!="object")return null;const ge=String((S=(Te=(ue=H.key)!=null?ue:H.name)!=null?Te:H.label)!=null?S:"").trim(),ve=String((B=H.value)!=null?B:"").trim(),ce=String((Q=H.unit)!=null?Q:"").trim();return ge?{key:ge,value:ve,unit:ce}:null}).filter(Boolean):[]},ze=(A,x)=>{if(A==null||A==="")return[];let H=A;if(typeof H=="string"){const ve=H.trim();if(!ve)return[];try{H=JSON.parse(ve)}catch(ce){return[]}}if(!Array.isArray(H))return[];const ge=at(x);return H.map(ve=>{var Te;if(!ve||typeof ve!="object")return null;const ce=String((Te=ve.name)!=null?Te:"").trim(),ue=(Array.isArray(ve.options)?ve.options:[]).map(S=>{var Ye,Ue,kt,Kt,Me,it,en;if(!S||typeof S!="object")return null;const B=String((Ye=S.label)!=null?Ye:"").trim();if(!B)return null;const Q=(Me=(Kt=(kt=(Ue=S.price)!=null?Ue:S.priceValue)!=null?kt:S.unit_price)!=null?Kt:S.unitPrice)!=null?Me:null,re=Number(Q);let Ie=Number.isFinite(re)?Math.trunc(re):null;if(Ie==null){const Tt=(en=(it=S.price_delta)!=null?it:S.priceDelta)!=null?en:null,dn=Number(Tt);Number.isFinite(dn)&&(Ie=ge+Math.trunc(dn))}Ie==null&&(Ie=ge);const Ae=String(Math.max(0,Math.trunc(Number(Ie)||0)));return{label:B,price:Math.max(0,Math.trunc(Number(Ie)||0)),priceDigits:Ae}}).filter(Boolean);return{name:ce||"Bi\u1EBFn th\u1EC3",options:ue}}).filter(Boolean)};useEffect(()=>{var A,x;X(E?{name:E.name||"",code:E.code||"",price:E.price||"",image:E.image||"",category:E.category||"",note:E.note||"",sort_order:E.sort_order||0,commission_percent:(x=(A=E.commission_percent)!=null?A:E.commissionPercent)!=null?x:5,variants:ze(E.variants,E.price),attributes:Be(E.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[E,I]);const we=A=>{X(x=>{var ue;const H=at(x.price),ge=String(H),ve=Array.isArray(x.variants)?[...x.variants]:[],ce={...ve[A]||{},options:Array.isArray((ue=ve[A])==null?void 0:ue.options)?[...ve[A].options]:[]};return ce.options=ce.options.map(Te=>({label:String((Te==null?void 0:Te.label)||""),price:H,priceDigits:ge})),ve[A]=ce,{...x,variants:ve}})},Ee=()=>{X(A=>{const x=at(A.price),H=String(x),ve=(Array.isArray(A.variants)?[...A.variants]:[]).map(ce=>{const ue=(Array.isArray(ce==null?void 0:ce.options)?ce.options:[]).map(Te=>({label:String((Te==null?void 0:Te.label)||""),price:x,priceDigits:H}));return{name:String((ce==null?void 0:ce.name)||"Bi\u1EBFn th\u1EC3"),options:ue}});return{...A,variants:ve}})},[q,ut]=React.useState(""),wt=A=>window.KTM.money.formatVNDInputDigits(A),[xt,Xe]=React.useState(""),nt=A=>{const x=window.KTM.money.nextPriceInputState(A.target.value,xt);Xe(x.digits),X({...J,price:x.price})},[Re,gt]=React.useState("");React.useEffect(()=>{E!=null&&E.image&&gt(E.image)},[E]);const Pt=async A=>{if(!(!A||!A.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:A},"L\u1ED7i x\xF3a \u1EA3nh")}catch(x){console.error("Delete cloudinary image error:",x)}},sn=async(A,x=2,H)=>{const ge=x*1024*1024,ve=A.type==="image/heic"||A.type==="image/heif"||/\.heic$/i.test(A.name);if(A.size<=ge&&!ve)return A;H==null||H("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const ce=await createImageBitmap(A);H==null||H("\u0110ang n\xE9n \u1EA3nh...");const ue=document.createElement("canvas");let Te=ce.width,S=ce.height;const B=1200;return(Te>B||S>B)&&(Te>S?(S=Math.round(S/Te*B),Te=B):(Te=Math.round(Te/S*B),S=B)),ue.width=Te,ue.height=S,ue.getContext("2d").drawImage(ce,0,0,Te,S),ce.close(),new Promise((re,Ie)=>{ue.toBlob(Ae=>{Ae?(H==null||H("Ho\xE0n t\u1EA5t!"),re(new File([Ae],A.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):Ie(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ce){throw console.error("createImageBitmap error:",ce),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Qe=async A=>{var ge,ve;const x=(ge=A.target.files)==null?void 0:ge[0];if(!x)return;if(!(x.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(x.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ge(!0),ut("\u0110ang chu\u1EA9n b\u1ECB...");try{const ce=(x.size/1024/1024).toFixed(1);ut(`File ${ce}MB - \u0110ang n\xE9n...`);const ue=await sn(x,2,B=>{ut(B)}),Te=(ue.size/1024/1024).toFixed(1);ut(`\u0110\xE3 n\xE9n: ${Te}MB - \u0110ang upload...`);const S=await window.KTM.cloudinary.uploadImage({file:ue,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});S.secure_url?(J.image&&J.image!==Re&&Pt(J.image),X(B=>({...B,image:S.secure_url})),ut("")):(console.error("Cloudinary error:",S),alert("Upload th\u1EA5t b\u1EA1i: "+(((ve=S.error)==null?void 0:ve.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),ut(""))}catch(ce){console.error("Upload error:",ce),alert("L\u1ED7i: "+ce.message),ut("")}Ge(!1),A.target.value=""},Lt=()=>{J.image&&(J.image!==Re&&Pt(J.image),X(A=>({...A,image:""})))},Xt=async A=>{A.preventDefault(),Fe(!0),Re&&J.image&&Re!==J.image&&await Pt(Re),Re&&!J.image&&await Pt(Re),await ae(J),Fe(!1)};return I?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${E?"fa-edit":"fa-plus-circle"} me-2`}),E?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:ye})),React.createElement("form",{onSubmit:Xt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},J.image?React.createElement(React.Fragment,null,React.createElement("img",{src:J.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Lt,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Se?"fa-spinner fa-spin":"fa-camera"} me-1`}),Se?q||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Qe,disabled:Se,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Se&&q&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},q))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:J.name,onChange:A=>X({...J,name:A.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:J.code,onChange:A=>X({...J,code:A.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:J.price,onChange:nt,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:J.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:A=>X({...J,commission_percent:A.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:J.category,onChange:A=>X({...J,category:A.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),F.map(A=>React.createElement("option",{key:A,value:A},A)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:J.note,onChange:A=>X({...J,note:A.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(J.attributes)?J.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(J.attributes)?J.attributes:[]).map((A,x)=>React.createElement("div",{key:x,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(A==null?void 0:A.key)||"",onChange:H=>{const ge=H.target.value;X(ve=>{const ce=Array.isArray(ve.attributes)?[...ve.attributes]:[];return ce[x]={...ce[x]||{},key:ge},{...ve,attributes:ce}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(A==null?void 0:A.value)||"",onChange:H=>{const ge=H.target.value;X(ve=>{const ce=Array.isArray(ve.attributes)?[...ve.attributes]:[];return ce[x]={...ce[x]||{},value:ge},{...ve,attributes:ce}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(A==null?void 0:A.unit)||"",onChange:H=>{const ge=H.target.value;X(ve=>{const ce=Array.isArray(ve.attributes)?[...ve.attributes]:[];return ce[x]={...ce[x]||{},unit:ge},{...ve,attributes:ce}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(H=>{const ge=Array.isArray(H.attributes)?[...H.attributes]:[];return ge.splice(x,1),{...H,attributes:ge}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{X(A=>{const x=Array.isArray(A.attributes)?[...A.attributes]:[];return x.push({key:"",value:"",unit:""}),{...A,attributes:x}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(J.variants)?J.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(J.variants)?J.variants:[]).map((A,x)=>React.createElement("div",{key:x,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(A==null?void 0:A.name)||"",onChange:H=>{const ge=H.target.value;X(ve=>{var ue;const ce=Array.isArray(ve.variants)?[...ve.variants]:[];return ce[x]={...ce[x]||{},name:ge,options:Array.isArray((ue=ce[x])==null?void 0:ue.options)?ce[x].options:[]},{...ve,variants:ce}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>we(x),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(A==null?void 0:A.options)||A.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{X(H=>{const ge=Array.isArray(H.variants)?[...H.variants]:[];return ge.splice(x,1),{...H,variants:ge}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(A==null?void 0:A.options)?A.options:[]).map((H,ge)=>{var ve,ce;return React.createElement("div",{key:ge,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(H==null?void 0:H.label)||"",onChange:ue=>{const Te=ue.target.value;X(S=>{var Ae,Ye,Ue,kt,Kt;const B=Array.isArray(S.variants)?[...S.variants]:[],Q={...B[x]||{},options:Array.isArray((Ae=B[x])==null?void 0:Ae.options)?[...B[x].options]:[]},re=Number((Ue=(Ye=Q.options[ge])==null?void 0:Ye.price)!=null?Ue:0)||0,Ie=String((Kt=(kt=Q.options[ge])==null?void 0:kt.priceDigits)!=null?Kt:Math.max(0,Math.trunc(re)));return Q.options[ge]={...Q.options[ge]||{},label:Te,price:Math.max(0,Math.trunc(re)),priceDigits:Ie},B[x]=Q,{...S,variants:B}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:wt(String((ce=H==null?void 0:H.priceDigits)!=null?ce:window.KTM.money.getDigits(String((ve=H==null?void 0:H.price)!=null?ve:"")))),onChange:ue=>{X(Te=>{var Ue,kt,Kt,Me,it;const S=String((kt=H==null?void 0:H.priceDigits)!=null?kt:window.KTM.money.getDigits(String((Ue=H==null?void 0:H.price)!=null?Ue:""))),B=window.KTM.money.nextPriceInputState(ue.target.value,S),Q=String((Kt=B.digits)!=null?Kt:""),re=Number(Q),Ie=Number.isFinite(re)?Math.max(0,Math.trunc(re)):0,Ae=Array.isArray(Te.variants)?[...Te.variants]:[],Ye={...Ae[x]||{},options:Array.isArray((Me=Ae[x])==null?void 0:Me.options)?[...Ae[x].options]:[]};return Ye.options[ge]={...Ye.options[ge]||{},label:String(((it=Ye.options[ge])==null?void 0:it.label)||""),price:Ie,priceDigits:Q},Ae[x]=Ye,{...Te,variants:Ae}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(ue=>{var B;const Te=Array.isArray(ue.variants)?[...ue.variants]:[],S={...Te[x]||{},options:Array.isArray((B=Te[x])==null?void 0:B.options)?[...Te[x].options]:[]};return S.options.splice(ge,1),Te[x]=S,{...ue,variants:Te}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{X(H=>{var ue;const ge=Array.isArray(H.variants)?[...H.variants]:[],ve={...ge[x]||{},options:Array.isArray((ue=ge[x])==null?void 0:ue.options)?[...ge[x].options]:[]},ce=at(H.price);return ve.options.push({label:"",price:ce,priceDigits:String(ce)}),ge[x]=ve,{...H,variants:ge}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{X(A=>{const x=at(A.price),H=Array.isArray(A.variants)?[...A.variants]:[],ge=String(x);return H.push({name:"Size",options:[{label:"S",price:x,priceDigits:ge},{label:"M",price:x,priceDigits:ge},{label:"L",price:x,priceDigits:ge}]}),{...A,variants:H}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Ee,disabled:!Array.isArray(J.variants)||J.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:J.image,onChange:A=>X({...J,image:A.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:ye,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Oe,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Oe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:I,video:E,onClose:F,onSave:ye}){const[ae,J]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[X,Oe]=useState(!1),[Fe,Se]=useState("");useEffect(()=>{E?(J({title:E.title||"",youtube_url:`https://www.youtube.com/watch?v=${E.youtubeId}`,thumbnail_url:E.thumb||"",sort_order:E.sortOrder||0}),Se(E.thumb)):(J({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Se(""))},[E,I]);const Ge=ze=>{const we=ze.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return we?we[1]:null},at=ze=>{J({...ae,youtube_url:ze});const we=Ge(ze);we&&Se(`https://img.youtube.com/vi/${we}/hqdefault.jpg`)},Be=async ze=>{ze.preventDefault(),Oe(!0),await ye(ae),Oe(!1)};return I?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},E?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:F})),React.createElement("form",{onSubmit:Be},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:ae.youtube_url,onChange:ze=>at(ze.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),Fe&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:Fe,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:ae.title,onChange:ze=>J({...ae,title:ze.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ae.sort_order,onChange:ze=>J({...ae,sort_order:parseInt(ze.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:ae.thumbnail_url,onChange:ze=>J({...ae,thumbnail_url:ze.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:F},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function getCurrentMonth(){const I=new Date,E=I.getFullYear(),F=String(I.getMonth()+1).padStart(2,"0");return`${E}-${F}`}function ReconExcelManager({showToast:I}){var dt;const E=typeof I=="function"?I:()=>{},[F,ye]=useState(getCurrentMonth()),ae=F,J=ye,[X,Oe]=useState(!1),[Fe,Se]=useState(""),[Ge,at]=useState(""),[Be,ze]=useState(""),[we,Ee]=useState(null),[q,ut]=useState("all"),[wt,xt]=useState(""),[Xe,nt]=useState(!0),[Re,gt]=useState(!0),[Pt,sn]=useState(!1),[Qe,Lt]=useState("created_at"),[Xt,A]=useState(!1),[x,H]=useState(0),[ge,ve]=useState(!1),[ce,ue]=useState(""),[Te,S]=useState(()=>new Set),[B,Q]=useState(!1),[re,Ie]=useState(null),Ae=useRef(new Map),Ye=useRef(new Map),Ue=useRef(null),[kt,Kt]=useState(()=>{var i;return(i=window==null?void 0:window.XLSX)!=null&&i.read?"ready":"loading"}),Me=i=>new Promise((l,k)=>{var g;try{if(!i)return l();const M=String(i),V=document.querySelector(`script[data-ktm-src="${M}"]`)||document.querySelector(`script[src="${M}"]`);if(V){if(V.getAttribute("data-ktm-loaded")==="1"||(g=window==null?void 0:window.XLSX)!=null&&g.read)return l();V.addEventListener("load",()=>l(),{once:!0}),V.addEventListener("error",()=>k(new Error(`Failed to load ${M}`)),{once:!0});return}const L=document.createElement("script");L.src=M,L.async=!0,L.defer=!0,L.setAttribute("data-ktm-src",M),L.addEventListener("load",()=>{L.setAttribute("data-ktm-loaded","1"),l()},{once:!0}),L.addEventListener("error",()=>k(new Error(`Failed to load ${M}`)),{once:!0}),document.head.appendChild(L)}catch(M){k(M)}}),it=()=>!!(window!=null&&window.XLSX&&typeof window.XLSX.read=="function"),en=async()=>{if(it())return Kt("ready"),!0;if(Ue.current)return Ue.current;const i=["https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js","https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js","https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"],l=async k=>{const g=Date.now();for(;Date.now()-g<k;){if(it())return!0;await new Promise(M=>setTimeout(M,50))}return it()};return Kt("loading"),Ue.current=(async()=>{try{for(const k of i)try{if(await Me(k),await l(1500))return Kt("ready"),!0}catch(g){}return Kt("failed"),!1}finally{Ue.current=null}})(),Ue.current};useEffect(()=>{if(it()){Kt("ready");return}en()},[]);const Tt=i=>{const l=[],k=String(i!=null?i:"").split(/\s+/g);for(const g of k){const M=String(g||"").trim();M&&l.push(M)}return l.join(" ").replace(/\s+/g," ").trim()},dn=i=>{try{return String(i!=null?i:"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,l=>l==="\u0111"?"d":"D")}catch(l){return String(i!=null?i:"").replace(/[đĐ]/g,k=>k==="\u0111"?"d":"D")}},Ft=i=>{const l=Tt(String(i!=null?i:""));return l?dn(l).toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim():""},hn=i=>{const l=Ft(i);return l?l.replace(/\b(combo|set|sp|san\s*pham|sanpham|hang|ship|freeship|free\s*ship)\b/g," ").replace(/\s+/g," ").trim():""},gn=i=>{var V,L;if(i==null||i==="")return"";if(typeof i=="number"&&Number.isFinite(i)&&((L=(V=window==null?void 0:window.XLSX)==null?void 0:V.SSF)!=null&&L.parse_date_code))try{const h=window.XLSX.SSF.parse_date_code(i);return!h||!h.y||!h.m?"":`${String(h.y).padStart(4,"0")}-${String(h.m).padStart(2,"0")}`}catch(h){}const l=String(i).trim(),k=l.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(k){const h=String(Number(k[2])||0).padStart(2,"0");return`${k[3]}-${h}`}const g=l.match(/^(\d{4})-(\d{2})-(\d{2})/);if(g)return`${g[1]}-${g[2]}`;const M=new Date(l);return Number.isNaN(M.getTime())?"":`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}`},R=i=>{var V,L;if(i==null||i==="")return"";if(typeof i=="number"&&Number.isFinite(i)&&((L=(V=window==null?void 0:window.XLSX)==null?void 0:V.SSF)!=null&&L.parse_date_code))try{const h=window.XLSX.SSF.parse_date_code(i);return!h||!h.y||!h.m||!h.d?"":`${String(h.y).padStart(4,"0")}-${String(h.m).padStart(2,"0")}-${String(h.d).padStart(2,"0")}`}catch(h){}const l=String(i).trim(),k=l.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(k){const h=String(Number(k[1])||0).padStart(2,"0"),C=String(Number(k[2])||0).padStart(2,"0");return`${k[3]}-${C}-${h}`}const g=l.match(/^(\d{4})-(\d{2})-(\d{2})/);if(g)return`${g[1]}-${g[2]}-${g[3]}`;const M=new Date(l);return Number.isNaN(M.getTime())?"":`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}-${String(M.getDate()).padStart(2,"0")}`},se=i=>{if(i==null||i==="")return 0;if(typeof i=="number"&&Number.isFinite(i))return Math.trunc(i);const l=String(i!=null?i:"").trim();if(!l)return 0;try{const V=window.KTM.money.parseMoney(l);if(Number.isFinite(V)&&V>0)return Math.trunc(V)}catch(V){}const g=l.toLowerCase().replace(/vnd|đ|d/g," ").replace(/\s+/g," ").trim().replace(/[^0-9]/g,"");if(!g)return 0;const M=Number(g);return Number.isFinite(M)?Math.trunc(M):0},Ze=i=>{var k,g;let l="";try{(g=(k=window==null?void 0:window.KTM)==null?void 0:k.phone)!=null&&g.normalize&&(l=window.KTM.phone.normalize(i))}catch(M){}return l||(l=String(i!=null?i:"").replace(/[^0-9]/g,"")),l=String(l||"").replace(/[^0-9]/g,""),l?(l.startsWith("840")?l=`0${l.slice(3)}`:l.startsWith("84")&&(l.length===11?l=`0${l.slice(2)}`:l.length===12&&l[2]!=="0"&&(l=`0${l.slice(2)}`)),l.length===9&&(l=`0${l}`),l):""},Bt=(i,l)=>{try{const k=Array.isArray(l)?l:[],g=C=>{const _=String(C!=null?C:"");return/[\n\r",]/.test(_)?`"${_.replace(/"/g,'""')}"`:_},M=k.map(C=>Array.isArray(C)?C.map(g).join(","):"").join(`
`),V=new Blob([`\uFEFF${M}`],{type:"text/csv;charset=utf-8"}),L=URL.createObjectURL(V),h=document.createElement("a");h.href=L,h.download=i,document.body.appendChild(h),h.click(),setTimeout(()=>{try{URL.revokeObjectURL(L)}catch(C){}try{h.remove()}catch(C){}},0)}catch(k){}},fn=i=>{const l=String(i!=null?i:"");if(!l.trim())return{phone:"",phoneNorm:"",cleanedText:String(i!=null?i:"").trim()};const k=/(?:\+?84|0)\s*[0-9\s\-.()]{8,16}/g;let g=null,M;for(;(M=k.exec(l))!=null;){const C=M[0],_=Ze(C);_&&(_.length<9||_.length>12||(g={raw:C,digits:_}))}if(!g){const C=Ze(l);if(C.length>=9){const _=C.slice(-12);_.length>=9&&(g={raw:_,digits:_})}}if(!g)return{phone:"",phoneNorm:"",cleanedText:l.trim()};const V=g.digits,L=V;let h=l;return g.raw&&l.includes(g.raw)?h=h.replace(g.raw," "):h=h.replace(new RegExp(`${g.digits}$`)," "),h=h.replace(/[\-–—•|]+\s*$/g," ").replace(/\s+[\-–—•|]+\s*/g," ").replace(/\s+/g," ").trim(),{phone:L,phoneNorm:V,cleanedText:h}},Vt=async()=>{var l;const i=Ae.current;if(i&&i.size>0)return i;try{const k=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m"),g=Array.isArray(k==null?void 0:k.products)?k.products:Array.isArray(k)?k:[],M=new Map;for(const V of g){const L=String((l=V==null?void 0:V.id)!=null?l:"").trim();L&&M.set(L,V)}return Ae.current=M,M}catch(k){return Ae.current=new Map,Ae.current}},Yt=i=>{var k;const l=String(i!=null?i:"").trim();return l&&((k=Ae.current)==null?void 0:k.get(l))||null},j=async i=>{var C,_,U;if(!i)throw new Error("Ch\u01B0a ch\u1ECDn file");const l=await i.arrayBuffer(),k=Number(i.size||0)||0;if(!!!(window!=null&&window.Worker&&typeof Blob!="undefined"&&typeof URL!="undefined")||k<450*1024){if(!((C=window==null?void 0:window.XLSX)!=null&&C.read))try{await en()}catch(De){}if(!((_=window==null?void 0:window.XLSX)!=null&&_.read))throw new Error("Thi\u1EBFu th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). Vui l\xF2ng t\u1EA3i l\u1EA1i trang admin.");const ie=window.XLSX.read(l,{type:"array"}),Ce=(U=ie==null?void 0:ie.SheetNames)==null?void 0:U[0],me=Ce?ie.Sheets[Ce]:null;if(!me)throw new Error("Kh\xF4ng \u0111\u1ECDc \u0111\u01B0\u1EE3c sheet trong file");return window.XLSX.utils.sheet_to_json(me,{header:1,raw:!0,defval:""})}const M=`
					const sources = [
						'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js',
						'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js',
						'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js',
					];

					const hasXlsx = () => Boolean(self.XLSX && typeof self.XLSX.read === 'function');
					const ensureXlsx = async () => {
						if (hasXlsx()) return true;
						for (const src of sources) {
							try {
								self.importScripts(src);
								if (hasXlsx()) return true;
							} catch (e) {
								// try next
							}
						}
						return hasXlsx();
					};

					self.onmessage = async (ev) => {
						try {
							const data = ev && ev.data;
							const buf = data && data.buf;
							const ok = await ensureXlsx();
							if (!ok) throw new Error('XLSX not available');
							const wb = self.XLSX.read(buf, { type: 'array' });
							const sheetName = wb && wb.SheetNames && wb.SheetNames[0];
							const ws = sheetName ? wb.Sheets[sheetName] : null;
							if (!ws) throw new Error('No sheet');
							const grid = self.XLSX.utils.sheet_to_json(ws, { header: 1, raw: true, defval: '' });
							self.postMessage({ ok: true, grid });
						} catch (e) {
							self.postMessage({ ok: false, error: String((e && e.message) || e || 'worker error') });
						}
					};
				`,V=new Blob([M],{type:"application/javascript"}),L=URL.createObjectURL(V),h=new Worker(L);try{return await new Promise((Ce,me)=>{const De=setTimeout(()=>{try{h.terminate()}catch(_e){}me(new Error("Worker timeout"))},12e3);h.onmessage=_e=>{const Ve=_e&&_e.data;Ve&&Ve.ok?(clearTimeout(De),Ce(Ve.grid)):Ve&&Ve.ok===!1&&(clearTimeout(De),me(new Error(Ve.error||"Worker failed")))},h.onerror=()=>{clearTimeout(De),me(new Error("Worker error"))};try{h.postMessage({buf:l},[l])}catch(_e){h.postMessage({buf:l})}})}finally{try{h.terminate()}catch(ie){}try{URL.revokeObjectURL(L)}catch(ie){}}},u=async i=>{var _,U;if(!i)throw new Error("Ch\u01B0a ch\u1ECDn file");const l=await j(i),k=Array.isArray(l)?l:[];if(!k.length)throw new Error("File r\u1ED7ng");const g={product:["ten san pham","tensanpham","san pham","t\xEAn s\u1EA3n ph\u1EA9m"],cod:["tong tien thu ho","t\u1ED5ng ti\u1EC1n thu h\u1ED9","thu ho","thu h\u1ED9","tong thu ho","t\u1ED5ng thu h\u1ED9"],date:["ngay","ng\xE0y","date"],phone:["sdt","s\u0111t","so dien thoai","s\u1ED1 \u0111i\u1EC7n tho\u1EA1i","dien thoai","\u0111i\u1EC7n tho\u1EA1i","phone"],qty:["sl","so luong","s\u1ED1 l\u01B0\u1EE3ng","qty","quantity"]},V=(()=>{const ie=Math.min(30,k.length);for(let Ce=0;Ce<ie;Ce++){const De=(Array.isArray(k[Ce])?k[Ce]:[]).map(ot=>Ft(ot)),_e=ot=>{for(let le=0;le<De.length;le++){const He=De[le];if(He&&ot.some(Mt=>He.includes(Ft(Mt))))return le}return-1},Ve=_e(g.product),xe=_e(g.cod);if(xe>=0){const ot=_e(g.date),le=_e(g.phone),He=_e(g.qty);return{headerRow:Ce,productCol:Ve,codCol:xe,dateCol:ot,phoneCol:le,qtyCol:He}}}return null})();if(!V)throw new Error('Kh\xF4ng t\xECm th\u1EA5y header c\u1ED9t "T\u1ED5ng ti\u1EC1n thu h\u1ED9"');const L=[],h=new Set,C=ie=>{const Ce=String(ie!=null?ie:"").trim();if(!Ce)return{text:"",qty:null};let me=Ce.match(/^\s*x\s*(\d{1,3})\s+(.+)$/i);return me?{text:String(me[2]||"").trim(),qty:Number(me[1])}:(me=Ce.match(/^\s*(\d{1,3})\s*(?:x|\*|×)?\s+(.+)$/i),me?{text:String(me[2]||"").trim(),qty:Number(me[1])}:{text:Ce,qty:null})};for(let ie=V.headerRow+1;ie<k.length;ie++){const Ce=Array.isArray(k[ie])?k[ie]:[],me=V.productCol>=0?String((_=Ce[V.productCol])!=null?_:"").trim():"",De=C(me),_e=De.text,Ve=se(Ce[V.codCol]),xe=V.qtyCol>=0?Ce[V.qtyCol]:"",ot=(()=>{if(xe!=null&&xe!==""){if(typeof xe=="number"&&Number.isFinite(xe))return{qty:Math.max(1,Math.trunc(xe)),source:"cell"};const nn=String(xe).trim(),Ot=Number(nn.replace(/[^0-9]/g,""));if(Number.isFinite(Ot)&&Ot>0)return{qty:Math.max(1,Math.trunc(Ot)),source:"cell"}}const Rt=Number(De.qty);return Number.isFinite(Rt)&&Rt>1?{qty:Math.max(1,Math.trunc(Rt)),source:"text"}:{qty:1,source:"default"}})(),le=ot.qty,He=ot.source,Mt=He==="cell"&&le>1&&Ve>0&&le<=50?Ve*le:0,bt=Array.from(new Set([Ve,Mt].filter(Rt=>Number(Rt||0)>0))),yt=Ve;if(!_e&&!yt)continue;const Le=V.phoneCol>=0?String((U=Ce[V.phoneCol])!=null?U:"").trim():"",D=Ze(Le);let oe=fn(_e);if(D&&(oe={...oe,phone:D,phoneNorm:D}),!oe.phoneNorm){const Rt=Ce.map(Ot=>String(Ot!=null?Ot:"")).join(" | "),nn=fn(Rt);nn.phoneNorm&&(oe={...oe,phone:nn.phone,phoneNorm:nn.phoneNorm})}const qe=oe.cleanedText||_e||"",ht=Ft(qe);if(ht&&(ht.includes("tong tien")||ht.includes("tong")||ht.includes("thanh toan")||ht.includes("thanh to\xE1n")))continue;const _t=V.dateCol>=0?Ce[V.dateCol]:"",Gt=_t?gn(_t):"";Gt&&h.add(Gt);const vt=_t?R(_t):"";L.push({rowIndex:ie+1,dateRaw:_t,monthKey:Gt,dayKey:vt,product:qe,productNorm:hn(qe),productCompact:hn(qe).replace(/\s+/g,""),phone:oe.phone,phoneNorm:oe.phoneNorm,cod:yt,codRaw:Ve,qty:le,qtySource:He,codAlt:Mt,codCandidates:bt})}return{rows:L,monthKeys:Array.from(h.values()).sort()}},G=i=>{const l=new Map,k=(h,C)=>{const _=l.get(h)||{key:h,rows:[],phoneNorm:"",phone:"",monthKey:"",dayKey:""};_.rows.push(C),!_.phoneNorm&&C.phoneNorm&&(_.phoneNorm=C.phoneNorm,_.phone=C.phone||C.phoneNorm),!_.monthKey&&C.monthKey&&(_.monthKey=C.monthKey),!_.dayKey&&C.dayKey&&(_.dayKey=C.dayKey),l.set(h,_)};for(const h of Array.isArray(i)?i:[]){const C=String((h==null?void 0:h.phoneNorm)||"").trim(),_=String((h==null?void 0:h.dayKey)||"").trim(),U=String((h==null?void 0:h.monthKey)||"").trim();if(C){const ie=_?`p:${C}:d:${_}`:U?`p:${C}:m:${U}`:`p:${C}`;k(ie,h)}else k(`r:${h==null?void 0:h.rowIndex}`,h)}const g=h=>{const C=Number((h==null?void 0:h.cod)||0)||0;if(C>0)return C;const _=Number((h==null?void 0:h.codAlt)||0)||0;return _>0?_:0},M=h=>{var ie;const C=((h==null?void 0:h.rows)||[]).slice().filter(Boolean);if(C.length<=1)return[{key:h.key,rows:C,phoneNorm:h.phoneNorm,phone:h.phone,monthKey:h.monthKey}];const _=C.map(g).filter(Ce=>Ce>0),U=Array.from(new Set(_));if(h.phoneNorm&&h.dayKey&&U.length>1&&U.length<=8){const Ce=new Map;for(const De of U)Ce.set(String(De),{key:`${h.key}:t:${De}`,rows:[],phoneNorm:h.phoneNorm,phone:h.phone,monthKey:h.monthKey});const me=[];for(const De of C){const _e=g(De);_e>0?Ce.get(String(_e)).rows.push(De):me.push(De)}if(me.length){const De=Array.from(Ce.values()).map(_e=>{const Ve=_e.rows.find(xe=>String((xe==null?void 0:xe.productNorm)||"").trim())||null;return{group:_e,seedNorm:String((Ve==null?void 0:Ve.productNorm)||"")}});for(const _e of me){const Ve=String((_e==null?void 0:_e.productNorm)||"");let xe=null,ot=-1;for(const le of De){const He=Pe(Ve,le.seedNorm);He>ot&&(ot=He,xe=le.group)}(xe||((ie=De[0])==null?void 0:ie.group)).rows.push(_e)}}return Array.from(Ce.values()).filter(De=>De.rows.length>0)}return[{key:h.key,rows:C,phoneNorm:h.phoneNorm,phone:h.phone,monthKey:h.monthKey}]},V=[];for(const h of l.values())V.push(...M(h));const L=h=>{var Mt,bt,yt;const C=h.rows.slice().filter(Boolean),_=C.map(Le=>Le.rowIndex).filter(Boolean),U=[],ie=new Set;for(const Le of C){const D=String((Le==null?void 0:Le.productNorm)||"").trim();D&&(ie.has(D)||(ie.add(D),U.push(String((Le==null?void 0:Le.product)||"").trim())))}const Ce=U.filter(Boolean).join(" + "),me=Ft(Ce),De=[];for(const Le of C){const D=Array.isArray(Le==null?void 0:Le.codCandidates)?Le.codCandidates:[];for(const oe of D){const qe=Number(oe||0)||0;qe>0&&De.push(qe)}}const _e=Array.from(new Set(De)).sort((Le,D)=>Le-D),Ve=C.map(Le=>g(Le)).filter(Le=>Le>0);let xe=0;if(!Ve.length)xe=0;else{const Le=new Map;for(const oe of Ve)Le.set(oe,(Le.get(oe)||0)+1);const D=Array.from(Le.keys());if(D.length===1)xe=D[0];else{let oe=null,qe=0;for(const[ht,_t]of Le.entries())_t>qe&&(qe=_t,oe=ht);oe!=null&&qe>=2?xe=oe:xe=Ve.reduce((ht,_t)=>ht+_t,0)}}const ot=h.monthKey||((Mt=C.find(Le=>Le==null?void 0:Le.monthKey))==null?void 0:Mt.monthKey)||"",le=((bt=C.find(Le=>Le==null?void 0:Le.dayKey))==null?void 0:bt.dayKey)||"",He=((yt=C.find(Le=>Le==null?void 0:Le.dateRaw))==null?void 0:yt.dateRaw)||"";return{key:h.key,phoneNorm:h.phoneNorm||"",phone:h.phone||h.phoneNorm||"",monthKey:ot,dayKey:le,dateRaw:He,rowIndices:_,rowIndexFirst:_.length?Math.min(..._):null,rowCount:C.length,productDisplay:Ce,productNorm:me,productCompact:String(me||"").replace(/\s+/g,""),cod:xe,codCandidates:_e,rows:C}};return V.map(L)},te=async i=>{const l=`${API_BASE}/api/orders?month=${encodeURIComponent(i)}&includeItems=1`,k=await window.KTM.api.getJSON(l,"L\u1ED7i t\u1EA3i danh s\xE1ch \u0111\u01A1n");return Array.isArray(k==null?void 0:k.orders)?k.orders:Array.isArray(k)?k:[]},Ke=async i=>{var C,_;const l=Array.isArray(i)&&i.length?i:[F],k=[],g=5*60*1e3;for(let U=0;U<l.length;U++){const ie=l[U],Ce=(C=Ye.current)==null?void 0:C.get(ie);if(Ce&&Date.now()-Number(Ce.at||0)<g&&Array.isArray(Ce.records)){k.push(...Ce.records);continue}at(`\u0110ang t\u1EA3i \u0111\u01A1n h\u1EC7 th\u1ED1ng th\xE1ng ${ie} (${U+1}/${l.length})...`);const me=await te(ie);(_=Ye.current)==null||_.set(ie,{at:Date.now(),records:me}),k.push(...me)}const M=U=>String(U||"").trim().toLowerCase(),V=k.filter(U=>{const ie=M(U==null?void 0:U.status);return!(Xe&&ie==="draft"||Re&&ie==="canceled"||Pt&&ie==="paid")}),L=U=>{var Ce,me,De;return String(Qe||"created_at")==="updated_at"?(me=(Ce=U==null?void 0:U.updated_at)!=null?Ce:U==null?void 0:U.created_at)!=null?me:null:(De=U==null?void 0:U.created_at)!=null?De:null};return V.map(U=>{var xe,ot,le,He,Mt,bt;const ie=window.KTM.orders.getOrderProductSummary(U,Yt),Ce=window.KTM.orders.getOrderTotalMoney(U,Yt),me=hn(ie),De=Ze((xe=U==null?void 0:U.phone)!=null?xe:""),_e=L(U),Ve=(()=>{if(!_e)return"";const yt=new Date(_e);return Number.isNaN(yt.getTime())?"":`${yt.getFullYear()}-${String(yt.getMonth()+1).padStart(2,"0")}-${String(yt.getDate()).padStart(2,"0")}`})();return{id:String((ot=U==null?void 0:U.id)!=null?ot:""),created_at:(le=U==null?void 0:U.created_at)!=null?le:null,updated_at:(He=U==null?void 0:U.updated_at)!=null?He:null,dayKey:Ve,status:String((Mt=U==null?void 0:U.status)!=null?Mt:""),phone:String((bt=U==null?void 0:U.phone)!=null?bt:""),phoneNorm:De,productSummary:ie,productNorm:me,productCompact:me.replace(/\s+/g,""),cod:Number(Ce||0)||0,raw:U}}).filter(U=>U.id&&U.cod>0)},Pe=(i,l)=>{const k=String(i||"").trim(),g=String(l||"").trim();if(!k||!g)return 0;if(k===g)return 1;const M=k.replace(/\s+/g,""),V=g.replace(/\s+/g,"");if(M&&V&&M===V)return 1;if(M&&V&&(V.includes(M)||M.includes(V)))return .92;const L=xe=>String(xe||"").replace(/[\+]/g," ").replace(/[()\[\]{},.;:!?]/g," ").replace(/\s+/g," ").trim().split(" ").map(He=>He.trim()).filter(Boolean).map(He=>He.replace(/[^a-z0-9]/g,"")).filter(Boolean).filter(He=>He.length>1),h=L(k),C=L(g);if(!h.length||!C.length)return 0;const _=new Set(C),U=(xe,ot)=>{if(xe===ot)return 0;const le=xe.length,He=ot.length;if(Math.abs(le-He)>1)return 2;let Mt=0,bt=0,yt=0;for(;Mt<le&&bt<He;){if(xe[Mt]===ot[bt]){Mt+=1,bt+=1;continue}if(yt+=1,yt>1)return yt;le>He?Mt+=1:(He>le||(Mt+=1),bt+=1)}return(Mt<le||bt<He)&&(yt+=1),yt},ie=xe=>/[0-9]/.test(xe)?2:1;let Ce=0,me=0;for(const xe of h){const ot=ie(xe);if(me+=ot,_.has(xe)||V&&V.includes(xe)){Ce+=ot;continue}if(xe.length>=4){let le=!1;for(const He of C){if(He===xe){le=!0;break}if(He.includes(xe)||xe.includes(He)){le=!0;break}if(V&&V.includes(xe)){le=!0;break}if(U(xe,He)<=1){le=!0;break}}le&&(Ce+=ot*.8)}}const De=Ce/Math.max(1,me),_e=Math.min(.12,Math.abs(k.length-g.length)/Math.max(1,Math.max(k.length,g.length))),Ve=(()=>{const xe=h.filter(le=>/[0-9]/.test(le)&&le.length>=3);if(!xe.length)return 0;let ot=0;for(const le of xe)(_.has(le)||V&&V.includes(le))&&(ot+=1);return Math.min(.08,.04*ot)})();return Math.max(0,Math.min(1,De-_e+Ve))},Je=i=>{const k=String(i||"").trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!k)return null;const g=new Date(Number(k[1]),Number(k[2])-1,Number(k[3]));return Number.isNaN(g.getTime())?null:g.getTime()},Nt=(i,l)=>{const k=Array.isArray(i==null?void 0:i.codCandidates)&&i.codCandidates.length?i.codCandidates:[Number((i==null?void 0:i.cod)||0)||0],g=Number((l==null?void 0:l.cod)||0)||0;let M=1/0,V=0;for(const L of k){const h=Number(L||0)||0;if(h<=0)continue;const C=Math.abs(g-h);C<M&&(M=C,V=h)}return Number.isFinite(M)||(M=1/0),{bestDiff:M,bestCand:V,oCod:g}},et=(i,l,k)=>{const g=String((i==null?void 0:i.phoneNorm)||"").trim(),M=!!(g&&String((l==null?void 0:l.phoneNorm)||"")===g),V=Math.max(0,Number((k==null?void 0:k.codTolerance)||0)||0),{bestDiff:L,bestCand:h}=Nt(i,l),C=L===0,_=Number.isFinite(L)&&V>0&&L>0&&L<=V,U=String((i==null?void 0:i.dayKey)||"").trim(),ie=String((l==null?void 0:l.dayKey)||"").trim(),Ce=!!(U&&ie&&U===ie),me=(()=>{if(!U||!ie)return!1;const Mt=Je(U),bt=Je(ie);if(Mt==null||bt==null)return!1;const yt=Math.abs(Mt-bt)/(24*60*60*1e3);return yt>0&&yt<=1.01})(),_e=!!g?{phone:.65,cod:.27,day:.08}:{phone:0,cod:.85,day:.15},Ve=M?_e.phone:0,xe=C?_e.cod:_?_e.cod*(1-L/Math.max(1,V)):0,ot=Ce?_e.day:me?_e.day*.6:0,le=Ve+xe+ot,He=[];return M&&He.push("S\u0110T tr\xF9ng"),C?He.push("COD tr\xF9ng"):_?He.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(L)} (<= ${window.KTM.money.formatNumber(V)})`):h>0&&Number.isFinite(L)&&L!==1/0&&He.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(L)}`),Ce?He.push("C\xF9ng ng\xE0y"):me&&He.push("Ng\xE0y g\u1EA7n \u0111\xFAng (\xB11)"),{score:le,reasons:He,nameSim:null,phoneMatch:M,codExact:C,codWithin:_,codDiff:L,bestCand:h}},mn=i=>{let l=String(i!=null?i:"");return l=l.replace(/^\s*(?:x\s*)?(\d{1,3})\s*(?:x|\*|×)?\s*/i," "),l=l.replace(/\s+/g," ").trim(),hn(l)},Wt=i=>{var V;const l=new Map,k=new Map,g=Array.isArray(i==null?void 0:i.rows)?i.rows:[],M=g.length>1||g.some(L=>String((L==null?void 0:L.qtySource)||"default")!=="default");for(const L of g){const h=String((L==null?void 0:L.product)||"").trim(),C=mn(h);if(!C)continue;const _=Math.max(1,Number((V=L==null?void 0:L.qty)!=null?V:1)||1),U=M?_:1;l.set(C,(l.get(C)||0)+U),k.has(C)||k.set(C,h)}return{qtyByKey:l,labelByKey:k,qtyReliable:M}},rn=i=>{var h;const l=new Map,k=new Map,g=(i==null?void 0:i.raw)||null,M=Array.isArray(g==null?void 0:g.items)?g.items:[];if(M.length){for(const C of M){const _=C==null?void 0:C.product_id,U=_?Yt(_):null,ie=String((U==null?void 0:U.name)||(C==null?void 0:C.product_name)||"").trim(),Ce=String((C==null?void 0:C.variant)||"").trim(),me=(ie||(i==null?void 0:i.productSummary)||"").trim()+(Ce?` (${Ce})`:""),De=mn(me);if(!De)continue;const _e=Math.max(1,Number((h=C==null?void 0:C.quantity)!=null?h:1)||1);l.set(De,(l.get(De)||0)+_e),k.has(De)||k.set(De,ie||me)}return{qtyByKey:l,labelByKey:k}}const V=String((i==null?void 0:i.productSummary)||"").trim();if(!V)return{qtyByKey:l,labelByKey:k};const L=V.split("+").map(C=>String(C||"").trim()).filter(Boolean);for(const C of L){const _=C.match(/\bx\s*(\d{1,3})\b/i),U=_?Math.max(1,Number(_[1])||1):1,ie=C.replace(/\bx\s*\d{1,3}\b/ig," ").replace(/\s+/g," ").trim(),Ce=mn(ie);Ce&&(l.set(Ce,(l.get(Ce)||0)+U),k.has(Ce)||k.set(Ce,ie))}return{qtyByKey:l,labelByKey:k}},bn=(i,l)=>{const k=Wt(i),g=rn(l),M=Array.from(k.qtyByKey.keys()),V=Array.from(g.qtyByKey.keys()),L=[];for(const me of M)for(const De of V){const _e=Pe(me,De);_e>=.9&&L.push({ek:me,sk:De,sc:_e})}L.sort((me,De)=>De.sc-me.sc);const h=new Map,C=new Set,_=new Set;for(const me of L)C.has(me.ek)||_.has(me.sk)||(h.set(me.ek,me.sk),C.add(me.ek),_.add(me.sk));const U=[],ie=[];for(const[me,De]of k.qtyByKey.entries()){const _e=h.get(me)||me,Ve=g.qtyByKey.get(_e)||0;Ve<De&&U.push({name:k.labelByKey.get(me)||me,qty:De-Ve})}for(const[me,De]of g.qtyByKey.entries()){let _e=k.qtyByKey.get(me)||0;if(!_e){for(const[Ve,xe]of h.entries())if(xe===me){_e=k.qtyByKey.get(Ve)||0;break}}_e<De&&ie.push({name:g.labelByKey.get(me)||me,qty:De-_e})}return{hasDiff:U.length>0||ie.length>0,missingInSystem:U,missingInExcel:ie}},st=i=>{if(!(i!=null&&i.hasDiff))return"";const l=g=>g.slice(0,4).map(M=>`${M.name} x${M.qty}`).join(", ")+(g.length>4?` (+${g.length-4})`:""),k=[];return Array.isArray(i.missingInExcel)&&i.missingInExcel.length&&k.push(`Thi\u1EBFu trong Excel: ${l(i.missingInExcel)}`),Array.isArray(i.missingInSystem)&&i.missingInSystem.length&&k.push(`Thi\u1EBFu trong h\u1EC7 th\u1ED1ng: ${l(i.missingInSystem)}`),k.join(" \xB7 ")},un=async i=>{Se(""),Ee(null),ze((i==null?void 0:i.name)||""),Oe(!0),at("\u0110ang \u0111\u1ECDc file Excel...");try{await Vt();const l=await u(i),k=Array.isArray(l.rows)?l.rows:[],g=String(F||"").trim()||getCurrentMonth(),M=Z=>{const fe=String(Z||"").match(/^(\d{4})-(\d{2})$/);if(!fe)return NaN;const tt=Number(fe[1]),s=Number(fe[2]);return!Number.isFinite(tt)||!Number.isFinite(s)||s<1||s>12?NaN:tt*12+(s-1)},V=Z=>{if(!Number.isFinite(Z))return"";const fe=Math.floor(Z/12),tt=Z%12+1;return!Number.isFinite(fe)||!Number.isFinite(tt)||tt<1||tt>12?"":`${String(fe).padStart(4,"0")}-${String(tt).padStart(2,"0")}`},L=M(g),h=Number.isFinite(L)?L-2:NaN,C=Z=>{const fe=M(Z);return!Number.isFinite(fe)||!Number.isFinite(L)||!Number.isFinite(h)?!1:fe>=h&&fe<=L},_=(()=>{if(!Number.isFinite(L)||!Number.isFinite(h))return[g];const Z=[];for(let fe=h;fe<=L;fe++){const tt=V(fe);tt&&Z.push(tt)}return Z.length?Z:[g]})(),U=k.filter(Z=>{const fe=String((Z==null?void 0:Z.monthKey)||"").trim();return fe?C(fe):!0}),ie=k.filter(Z=>{const fe=String((Z==null?void 0:Z.monthKey)||"").trim();return fe?!C(fe):!1});if(!U.length)throw new Error(`File kh\xF4ng c\xF3 d\u1EEF li\u1EC7u trong 3 th\xE1ng g\u1EA7n nh\u1EA5t quanh ${g}.`);const Ce=_,me=await Ke(Ce),De=(()=>{const Z=new Map;for(const fe of Array.isArray(me)?me:[]){const tt=String((fe==null?void 0:fe.phoneNorm)||"").trim(),s=String((fe==null?void 0:fe.dayKey)||"").trim();if(!tt||!s)continue;const d=`${tt}|${s}`;Z.set(d,(Z.get(d)||0)+1)}return Z})(),_e=Z=>{const fe=Number(Z);return Number.isFinite(fe)?Math.trunc(fe):0},Ve=(Z,fe)=>{const tt=String(Z||"").trim(),s=_e(fe);return!tt||!s?"":`${tt}|${s}`},xe=new Set(me.map(Z=>Ve(Z==null?void 0:Z.phoneNorm,Z==null?void 0:Z.cod)).filter(Boolean)),ot=(()=>{var fe,tt,s,d,c;const Z=new Map;for(const v of ie){const P=Ve(v==null?void 0:v.phoneNorm,v==null?void 0:v.cod);if(!P||!xe.has(P))continue;const T=Z.get(P)||[];T.push({rowIndex:(fe=v==null?void 0:v.rowIndex)!=null?fe:null,dateRaw:(tt=v==null?void 0:v.dateRaw)!=null?tt:"",monthKey:(s=v==null?void 0:v.monthKey)!=null?s:"",dayKey:(d=v==null?void 0:v.dayKey)!=null?d:"",product:(c=v==null?void 0:v.product)!=null?c:""}),Z.set(P,T)}return Z})(),le=U,He=Z=>{const fe=Number((Z==null?void 0:Z.cod)||0)||0;if(fe>0)return fe;const tt=Number((Z==null?void 0:Z.codAlt)||0)||0;return tt>0?tt:0},Mt=Z=>{var s;const fe=new Map;for(const d of Array.isArray(Z)?Z:[]){const c=String((d==null?void 0:d.phoneNorm)||"").trim(),v=String((d==null?void 0:d.dayKey)||"").trim();if(!c||!v)continue;const P=`${c}|${v}`,T=fe.get(P)||[];T.push(d),fe.set(P,T)}const tt=[];for(const[d,c]of fe.entries()){if(!Array.isArray(c)||c.length<2)continue;const[v,P]=String(d).split("|"),T=P&&P.length>=7?P.slice(0,7):"",N=c.map(He).filter(W=>W>0).reduce((W,de)=>W+de,0);if(!N)continue;const $=c.map(W=>W==null?void 0:W.rowIndex).filter(Boolean),ne=[],z=new Set;for(const W of c){const de=String((W==null?void 0:W.product)||"").trim();de&&(z.has(de)||(z.add(de),ne.push(de)))}tt.push({key:`merge:p:${v}:d:${P}`,isMerged:!0,phoneNorm:v,phone:v,monthKey:T,dayKey:P,dateRaw:((s=c.find(W=>W==null?void 0:W.dateRaw))==null?void 0:s.dateRaw)||"",rowIndices:$,rowIndexFirst:$.length?Math.min(...$):null,rowCount:c.length,productDisplay:ne.join(" + "),productNorm:"",productCompact:"",cod:N,codCandidates:[],rows:c})}return tt},bt=G(le),yt=Mt(le),Le=yt.length?bt.concat(yt):bt;at(`\u0110\u1ECDc \u0111\u01B0\u1EE3c ${le.length} d\xF2ng (${bt.length} c\u1EE5m; +${yt.length} c\u1EE5m g\u1ED9p) trong 3 th\xE1ng g\u1EA7n nh\u1EA5t. \u0110ang chu\u1EA9n b\u1ECB \u0111\u1ED1i so\xE1t...`),at(`\u0110ang \u0111\u1ED1i so\xE1t (${Le.length} c\u1EE5m Excel vs ${me.length} \u0111\u01A1n h\u1EC7 th\u1ED1ng)...`);const D=new Map,oe=new Map;for(const Z of Le){const fe=String(Z.phoneNorm||"").trim();if(!fe)continue;const tt=D.get(fe)||[];tt.push(Z),D.set(fe,tt);const s=Ve(fe,Z.cod);if(s){const d=oe.get(s)||[];d.push(Z),oe.set(s,d)}}const qe=new Set,ht=(()=>{const Z=new Map;for(const fe of Le){const tt=String((fe==null?void 0:fe.key)||"").trim();if(!tt)continue;const s=Array.isArray(fe==null?void 0:fe.rowIndices)?fe.rowIndices:[];for(const d of s){const c=Number(d);if(!Number.isFinite(c))continue;const v=Z.get(c)||[];v.push(tt),Z.set(c,v)}}return Z})(),_t=Z=>{const fe=Array.isArray(Z==null?void 0:Z.rowIndices)?Z.rowIndices:[];for(const s of fe){const d=Number(s);if(!Number.isFinite(d))continue;const c=ht.get(d)||[];for(const v of c)qe.add(String(v))}const tt=String((Z==null?void 0:Z.key)||"").trim();tt&&qe.add(tt)},Gt=[],vt=[],Rt=[],nn=Z=>{const fe=Array.isArray(Z)?Z.filter(Boolean):[];return fe.length?`C\xF3 d\xF2ng Excel ngo\xE0i 3 th\xE1ng tr\xF9ng S\u0110T+COD: ${fe.slice(0,2).map(s=>{const d=String((s==null?void 0:s.dateRaw)||(s==null?void 0:s.dayKey)||(s==null?void 0:s.monthKey)||"").trim(),c=s!=null&&s.rowIndex?`d\xF2ng ${s.rowIndex}`:"";return[d,c].filter(Boolean).join(" \xB7 ")}).join(" | ")}`:""};for(const Z of me){const fe=String(Z.phoneNorm||"").trim(),tt=_e(Z.cod);if(!fe||!tt){Rt.push(Z);continue}const s=Ve(fe,tt);let d=s?oe.get(s)||[]:[];if(d.length){const $=String(Z.dayKey||"").trim(),ne=d.filter(W=>!qe.has(String(W==null?void 0:W.key)));let z=null;if(ne.length){const W=de=>{if(!(de!=null&&de.isMerged))return!0;const We=String((de==null?void 0:de.dayKey)||"").trim();return!$||!We||We!==$?!1:(De.get(`${fe}|${$}`)||0)===1};$&&(z=ne.find(de=>!(de!=null&&de.isMerged)&&String(de.dayKey||"").trim()===$)||null,z||(z=ne.find(de=>String(de.dayKey||"").trim()===$&&W(de))||null)),z||(z=ne.find(de=>W(de))||null)}if(z){_t(z),Gt.push({group:z,order:Z,score:1,reasons:["S\u0110T tr\xF9ng","COD tr\xF9ng",...z.dayKey&&$&&z.dayKey===$?["C\xF9ng ng\xE0y"]:[]]});continue}}const c=D.get(fe)||[];if(!c.length){const $=ot.get(s)||[];Rt.push($.length?{...Z,excelOutsideHints:$,excelOutsideHintText:nn($)}:Z);continue}const v=String(Z.dayKey||"").trim();let P=c.filter($=>!qe.has(String($==null?void 0:$.key)));if(P.length||(P=c),v){const $=P.filter(ne=>String(ne.dayKey||"").trim()===v);$.length&&(P=$)}let T=null,N=Number.POSITIVE_INFINITY;for(const $ of P){const ne=_e($.cod);if(!ne)continue;const z=Math.abs(ne-tt);z<N&&(N=z,T=$)}if(!T){const $=ot.get(s)||[];Rt.push($.length?{...Z,excelOutsideHints:$,excelOutsideHintText:nn($)}:Z);continue}vt.push({group:T,order:Z,score:0,diff:_e(T.cod)-tt,reason:v&&String(T.dayKey||"").trim()===v?"S\u0110T tr\xF9ng \xB7 C\xF9ng ng\xE0y":"S\u0110T tr\xF9ng",suggestions:P.slice(0,3).map($=>({key:$.key,cod:_e($.cod),productSummary:String($.product||"").trim(),score:0,reasons:["Excel c\xF9ng S\u0110T"]}))})}const Ot=Rt.length===0&&vt.length===0;Ee({ok:Ot,monthKeys:Ce,excelCount:le.length,excelGroupCount:Le.length,systemCount:me.length,matches:Gt,systemOnly:Rt,moneyMismatch:vt}),S(new Set),at(Ot?"OK \u2705":"\u0110\xE3 \u0111\u1ED1i so\xE1t xong")}catch(l){Se(String((l==null?void 0:l.message)||l||"L\u1ED7i \u0111\u1ED1i so\xE1t")),at("")}finally{Oe(!1)}},_n=(i,l)=>{var _,U,ie,Ce,me,De,_e,Ve,xe,ot;const k=le=>String(le||"").replace(/[^0-9]/g,""),g=(i==null?void 0:i.raw)||{},M=String((U=(_=i==null?void 0:i.id)!=null?_:g==null?void 0:g.id)!=null?U:"").trim(),V=k((Ce=(ie=g==null?void 0:g.phone)!=null?ie:i==null?void 0:i.phone)!=null?Ce:"");if(!M||!V)return null;let h=(Array.isArray(g==null?void 0:g.items)?g.items:[]).map(le=>{var He,Mt;return{product_id:(le==null?void 0:le.product_id)||"",quantity:Number((He=le==null?void 0:le.quantity)!=null?He:1),variant:String((le==null?void 0:le.variant)||"").trim()||null,variant_json:(Mt=le==null?void 0:le.variant_json)!=null?Mt:null,unit_price:(()=>{var Le;const bt=(Le=le==null?void 0:le.unit_price)!=null?Le:le==null?void 0:le.unitPrice,yt=bt==null||bt===""?NaN:Number(bt);return Number.isFinite(yt)?Math.max(0,Math.trunc(yt)):null})()}}).filter(le=>le.product_id&&Number.isFinite(le.quantity)&&le.quantity>0);if(!h.length&&(g!=null&&g.product_id)){const le=Number((me=g==null?void 0:g.quantity)!=null?me:1);h=[{product_id:g.product_id,quantity:Number.isFinite(le)&&le>0?le:1,variant:null,variant_json:null,unit_price:null}]}if(!h.length)return null;const C=h[0];return{id:M,customer_name:String((De=g==null?void 0:g.customer_name)!=null?De:"").trim(),phone:V,address:String((_e=g==null?void 0:g.address)!=null?_e:"").trim(),note:String((Ve=g==null?void 0:g.note)!=null?Ve:"").trim(),adjustment_amount:Number((xe=g==null?void 0:g.adjustment_amount)!=null?xe:0)||0,adjustment_note:String((ot=g==null?void 0:g.adjustment_note)!=null?ot:"").trim(),product_id:C.product_id,quantity:C.quantity,status:l,items:h}},vn=async()=>{if(!we||ge)return;const i=Array.from(Te.values()).map(g=>String(g||"").trim()).filter(Boolean);if(!i.length||!confirm(`\u0110\xE1nh d\u1EA5u \u0111\xE3 nh\u1EADn ti\u1EC1n cho ${i.length} \u0111\u01A1n?`))return;ve(!0),ue("\u0110ang c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i...");let l=0;const k=[];try{for(let g=0;g<i.length;g++){const M=i[g];ue(`\u0110ang c\u1EADp nh\u1EADt (${g+1}/${i.length})...`);const V=(Array.isArray(we==null?void 0:we.matches)?we.matches:[]).find(h=>{var C;return String(((C=h==null?void 0:h.order)==null?void 0:C.id)||"")===M}),L=_n(V==null?void 0:V.order,"paid");if(!L){k.push({id:M,error:"Thi\u1EBFu d\u1EEF li\u1EC7u (phone/items)"});continue}try{await window.KTM.api.putJSON(`${API_BASE}/api/orders/${encodeURIComponent(M)}`,L,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),l+=1}catch(h){k.push({id:M,error:String((h==null?void 0:h.message)||h||"L\u1ED7i")})}}}finally{ve(!1),ue("")}if(l>0){E(`\u0110\xE3 c\u1EADp nh\u1EADt ${l} \u0111\u01A1n sang \u0110\xE3 nh\u1EADn ti\u1EC1n`,"success");const g=new Set(i);Ee(M=>{if(!M)return M;const V=L=>{if(!L||!g.has(String(L.id)))return L;const h=L.raw?{...L.raw,status:"paid"}:L.raw;return{...L,status:"paid",raw:h}};return{...M,matches:Array.isArray(M.matches)?M.matches.map(L=>({...L,order:V(L==null?void 0:L.order)})):M.matches,systemOnly:Array.isArray(M.systemOnly)?M.systemOnly.map(V):M.systemOnly,moneyMismatch:Array.isArray(M.moneyMismatch)?M.moneyMismatch.map(L=>({...L,order:V(L==null?void 0:L.order)})):M.moneyMismatch}}),S(new Set)}k.length&&(E(`C\xF3 ${k.length} \u0111\u01A1n c\u1EADp nh\u1EADt l\u1ED7i (xem console)`,"warning"),console.warn("Recon paid update failures:",k))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t Excel")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Th\xE1ng m\u1EB7c \u0111\u1ECBnh (n\u1EBFu Excel kh\xF4ng c\xF3 c\u1ED9t ng\xE0y)"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:ae,onChange:i=>J(i.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:X}))))),React.createElement("div",{className:"card border-0 shadow-sm mb-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{className:"fw-semibold"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 (Excel)"),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("span",{className:"text-muted small"},"\u0110\u1ED1i so\xE1t theo: ",React.createElement("span",{className:"fw-semibold"},"S\u0110T")," + ",React.createElement("span",{className:"fw-semibold"},"T\u1ED5ng ti\u1EC1n thu h\u1ED9")))),kt==="loading"&&React.createElement("div",{className:"alert alert-info mt-3 mb-0"},"\u0110ang t\u1EA3i th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX)..."),kt==="failed"&&React.createElement("div",{className:"alert alert-warning mt-3 mb-0"},"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). H\xE3y ki\u1EC3m tra m\u1EA1ng / ch\u1EB7n CDN (AdBlock) ho\u1EB7c refresh l\u1EA1i trang."),React.createElement("div",{className:"row g-2 align-items-end mt-2"},React.createElement("div",{className:"col-12 col-md-7"},React.createElement("label",{className:"form-label mb-1"},"Upload file Excel"),React.createElement("input",{type:"file",className:"form-control",accept:".xlsx,.xls,.csv",disabled:X,onChange:async i=>{const l=i.target.files&&i.target.files[0];l&&await un(l)}}),React.createElement("div",{className:"form-text"},Be?`File: ${Be}`:'Header c\u1EA7n c\xF3: "T\u1ED5ng Ti\u1EC1n Thu H\u1ED9". "T\xEAn s\u1EA3n ph\u1EA9m" (n\u1EBFu c\xF3) s\u1EBD gi\xFAp g\u1EE3i \xFD kh\u1EDBp t\u1ED1t h\u01A1n. C\xF3 c\u1ED9t "Ng\xE0y" th\xEC s\u1EBD t\u1EF1 t\u1EA3i \u0111\xFAng th\xE1ng trong file.')),React.createElement("div",{className:"col-12 col-md-5"},React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("label",{className:"form-label mb-0 small text-muted"},"Ng\xE0y theo"),React.createElement("select",{className:"form-select form-select-sm",style:{width:150},value:Qe,disabled:X,onChange:i=>Lt(i.target.value)},React.createElement("option",{value:"created_at"},"created_at"),React.createElement("option",{value:"updated_at"},"updated_at"))),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-draft",checked:Xe,disabled:X,onChange:i=>nt(!!i.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-draft"},"B\u1ECF nh\xE1p")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-canceled",checked:Re,disabled:X,onChange:i=>gt(!!i.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-canceled"},"B\u1ECF h\u1EE7y")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-paid",checked:Pt,disabled:X,onChange:i=>sn(!!i.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-paid"},"B\u1ECF \u0111\xE3 nh\u1EADn ti\u1EC1n")),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("div",{className:"form-check mb-0"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-cod-tol",checked:Xt,disabled:X,onChange:i=>A(!!i.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-cod-tol"},"Cho l\u1EC7ch COD")),React.createElement("input",{type:"number",className:"form-control form-control-sm",style:{width:110},value:x,min:"0",step:"1000",disabled:X||!Xt,onChange:i=>H(i.target.value)})))),React.createElement("div",{className:"col-12 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",disabled:X,onClick:()=>{Se(""),at(""),Ee(null),ze(""),ut("all"),xt(""),E("\u0110\xE3 reset \u0111\u1ED1i so\xE1t","info")}},React.createElement("i",{className:"fas fa-rotate-left me-2"}),"Reset"))),Ge&&React.createElement("div",{className:"mt-2 small text-muted"},Ge),Fe&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0"},Fe),we&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:`alert ${we.ok?"alert-success":"alert-warning"} mb-3`},we.ok?React.createElement("div",{className:"fw-semibold"},"OK \u2014 Kh\xF4ng th\u1EA5y \u0111\u01A1n h\u1EC7 th\u1ED1ng b\u1ECB thi\u1EBFu trong Excel ho\u1EB7c l\u1EC7ch ti\u1EC1n."):React.createElement("div",{className:"fw-semibold"},"CH\u01AFA KH\u1EDAP \u2014 C\xF3 \u0111\u01A1n h\u1EC7 th\u1ED1ng thi\u1EBFu trong Excel ho\u1EB7c l\u1EC7ch ti\u1EC1n."),React.createElement("div",{className:"small mt-1"},"Th\xE1ng \u0111\u1ED1i so\xE1t: ",Array.isArray(we.monthKeys)?we.monthKeys.join(", "):""," \xB7 Excel: ",we.excelCount," d\xF2ng",Number(we.excelGroupCount||0)?` (${we.excelGroupCount} c\u1EE5m)`:""," \xB7 H\u1EC7 th\u1ED1ng: ",we.systemCount," \u0111\u01A1n")),!we.ok&&React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center justify-content-between mb-2"},React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Recon view"},React.createElement("button",{type:"button",className:`btn ${q==="all"?"btn-dark":"btn-outline-dark"}`,onClick:()=>ut("all")},"T\u1EA5t c\u1EA3"),React.createElement("button",{type:"button",className:`btn ${q==="systemOnly"?"btn-warning":"btn-outline-warning"}`,onClick:()=>ut("systemOnly")},"H\u1EC7 th\u1ED1ng thi\u1EBFu Excel"),React.createElement("button",{type:"button",className:`btn ${q==="moneyMismatch"?"btn-danger":"btn-outline-danger"}`,onClick:()=>ut("moneyMismatch")},"Sai l\u1EC7ch ti\u1EC1n")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("input",{type:"text",className:"form-control form-control-sm",style:{width:220},placeholder:"L\u1ECDc theo S\u0110T...",value:wt,onChange:i=>xt(i.target.value)}),React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Export CSV"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{var k,g,M,V,L,h,C;const i=Ze(wt),l=[["type","order_id","date","phone","product","cod_excel","cod_system","diff","reason"]];for(const _ of Array.isArray(we.moneyMismatch)?we.moneyMismatch:[])i&&String(((k=_==null?void 0:_.group)==null?void 0:k.phoneNorm)||"").indexOf(i)<0||l.push(["moneyMismatch",((g=_==null?void 0:_.order)==null?void 0:g.id)||"",String(((M=_==null?void 0:_.group)==null?void 0:M.dateRaw)||""),((V=_==null?void 0:_.group)==null?void 0:V.phone)||"",((L=_==null?void 0:_.group)==null?void 0:L.productDisplay)||"",Number(((h=_==null?void 0:_.group)==null?void 0:h.cod)||0),Number(((C=_==null?void 0:_.order)==null?void 0:C.cod)||0),Number((_==null?void 0:_.diff)||0),String((_==null?void 0:_.reason)||"")]);for(const _ of Array.isArray(we.systemOnly)?we.systemOnly:[])i&&String((_==null?void 0:_.phoneNorm)||"").indexOf(i)<0||l.push(["systemOnly",(_==null?void 0:_.id)||"",window.KTM.date.formatDateTime(_==null?void 0:_.created_at),(_==null?void 0:_.phone)||"",(_==null?void 0:_.productSummary)||"","",Number((_==null?void 0:_.cod)||0),"",String((_==null?void 0:_.excelOutsideHintText)||"")]);Bt(`recon_${String(F||"").replace(/[^0-9\-]/g,"")}.csv`,l)}},"Export CSV")))),Array.isArray(we.moneyMismatch)&&we.moneyMismatch.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:q==="all"||q==="moneyMismatch"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-danger"},"Sai l\u1EC7ch s\u1ED1 ti\u1EC1n"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m (Excel)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (Excel)"),React.createElement("th",null,"Order ID"),React.createElement("th",null,"T\xEAn SP (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"L\u1EC7ch"),React.createElement("th",null,"L\xFD do"))),React.createElement("tbody",null,we.moneyMismatch.filter(i=>{var k;const l=Ze(wt);return l?String(((k=i==null?void 0:i.group)==null?void 0:k.phoneNorm)||"").includes(l):!0}).slice(0,30).map(i=>{var l,k,g,M,V,L,h,C,_,U;return React.createElement("tr",{key:`mm-${String(((l=i==null?void 0:i.group)==null?void 0:l.key)||((k=i==null?void 0:i.order)==null?void 0:k.id)||Math.random())}`,className:"table-danger"},React.createElement("td",null,((g=i==null?void 0:i.group)==null?void 0:g.rowIndexFirst)||"\u2014",Number(((M=i==null?void 0:i.group)==null?void 0:M.rowCount)||0)>1?` (+${Number(i.group.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},((V=i==null?void 0:i.group)==null?void 0:V.phone)||"\u2014"),React.createElement("td",{style:{minWidth:260}},((L=i==null?void 0:i.group)==null?void 0:L.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number(((h=i==null?void 0:i.group)==null?void 0:h.cod)||0))),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Ie((i==null?void 0:i.order)||null),Q(!0)}},(C=i==null?void 0:i.order)==null?void 0:C.id)),React.createElement("td",{style:{minWidth:240}},(_=i==null?void 0:i.order)==null?void 0:_.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber((U=i==null?void 0:i.order)==null?void 0:U.cod)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(i==null?void 0:i.diff)),React.createElement("td",{className:"text-muted",style:{minWidth:220}},(i==null?void 0:i.reason)||""))})))),we.moneyMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",we.moneyMismatch.length," d\xF2ng."))),Array.isArray(we.systemOnly)&&we.systemOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:q==="all"||q==="systemOnly"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong h\u1EC7 th\u1ED1ng nh\u01B0ng thi\u1EBFu trong Excel"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y t\u1EA1o"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,we.systemOnly.filter(i=>{const l=Ze(wt);return l?String((i==null?void 0:i.phoneNorm)||"").includes(l):!0}).slice(0,30).map(i=>React.createElement("tr",{key:`so-${i.id}`,className:"table-warning"},React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Ie(i||null),Q(!0)}},i.id)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(i.created_at)),React.createElement("td",{className:"text-muted"},i.phone||"\u2014"),React.createElement("td",{style:{minWidth:280}},i.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(i.cod)),React.createElement("td",{className:"text-muted"},i.status),i!=null&&i.excelOutsideHintText?React.createElement("div",{className:"small text-muted mt-1"},i.excelOutsideHintText):null))))),we.systemOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",we.systemOnly.length," \u0111\u01A1n."))))),Array.isArray(we.matches)&&we.matches.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mt-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2"},React.createElement("div",{className:"fw-semibold"},"\u0110\u01A1n \u0111\xE3 kh\u1EDBp"),React.createElement("div",{className:"d-flex flex-wrap align-items-center gap-2"},ce?React.createElement("span",{className:"text-muted small"},ce):null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",disabled:ge||!(Te&&Te.size),onClick:vn},"\u0110\xE1nh d\u1EA5u \u0111\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:34}},React.createElement("input",{type:"checkbox",checked:(()=>{var k;const i=Ze(wt),l=(we.matches||[]).filter(g=>{var L;const M=g==null?void 0:g.order;if(!(M!=null&&M.id))return!1;const V=String((M==null?void 0:M.status)||((L=M==null?void 0:M.raw)==null?void 0:L.status)||"").toLowerCase();return!(Pt&&V==="paid"||i&&!String((M==null?void 0:M.phoneNorm)||"").includes(i))});if(!l.length)return!1;for(const g of l)if(!Te.has(String(((k=g==null?void 0:g.order)==null?void 0:k.id)||"")))return!1;return!0})(),onChange:i=>{const l=!!i.target.checked;S(k=>{var L;const g=new Set(k),M=Ze(wt),V=(we.matches||[]).filter(h=>{var U;const C=h==null?void 0:h.order;if(!(C!=null&&C.id))return!1;const _=String((C==null?void 0:C.status)||((U=C==null?void 0:C.raw)==null?void 0:U.status)||"").toLowerCase();return!(Pt&&_==="paid"||M&&!String((C==null?void 0:C.phoneNorm)||"").includes(M))});for(const h of V){const C=String(((L=h==null?void 0:h.order)==null?void 0:L.id)||"").trim();C&&(l?g.add(C):g.delete(C))}return g})}})),React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"Excel"),React.createElement("th",null,"H\u1EC7 th\u1ED1ng"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,(we.matches||[]).filter(i=>{var M;const l=i==null?void 0:i.order;if(!(l!=null&&l.id))return!1;const k=String((l==null?void 0:l.status)||((M=l==null?void 0:l.raw)==null?void 0:M.status)||"").toLowerCase();if(Pt&&k==="paid")return!1;const g=Ze(wt);return!(g&&!String((l==null?void 0:l.phoneNorm)||"").includes(g))}).slice(0,50).map(i=>{var g,M,V,L;const l=i.order,k=String(l.id);return React.createElement("tr",{key:`match-${k}`},React.createElement("td",null,React.createElement("input",{type:"checkbox",checked:Te.has(k),onChange:h=>{const C=!!h.target.checked;S(_=>{const U=new Set(_);return C?U.add(k):U.delete(k),U})}})),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Ie(l||null),Q(!0)}},k)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(l.created_at)),React.createElement("td",{className:"text-muted"},l.phone||"\u2014"),React.createElement("td",{style:{minWidth:240}},((g=i==null?void 0:i.group)==null?void 0:g.productDisplay)||"\u2014"),React.createElement("td",{style:{minWidth:240}},l.productSummary||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(l.cod)),React.createElement("td",null,React.createElement("span",{className:`badge ${String((l==null?void 0:l.status)||((M=l==null?void 0:l.raw)==null?void 0:M.status)||"").toLowerCase()==="paid"?"bg-primary":"bg-secondary"}`},String((l==null?void 0:l.status)||((V=l==null?void 0:l.raw)==null?void 0:V.status)||"").toLowerCase()==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":(l==null?void 0:l.status)||((L=l==null?void 0:l.raw)==null?void 0:L.status)||"\u2014")))})))),React.createElement("div",{className:"text-muted small mt-2"},"Hi\u1EC3n th\u1ECB t\u1ED1i \u0111a 50 \u0111\u01A1n. D\xF9ng l\u1ECDc S\u0110T \u0111\u1EC3 thu h\u1EB9p.")))))),React.createElement(AdminDrawer,{open:B,title:re?`Order #${re.id}`:"Order",subtitle:re?`${re.phone||""} \u2022 ${window.KTM.money.formatNumber(Number(re.cod||0))}`:"",onClose:()=>{Q(!1),Ie(null)}},re?React.createElement("div",{className:"small"},React.createElement("div",{className:"mb-2"},React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Tr\u1EA1ng th\xE1i:")," ",re.status||"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"created_at:")," ",window.KTM.date.formatDateTime(re.created_at)),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"updated_at:")," ",re.updated_at?window.KTM.date.formatDateTime(re.updated_at):"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:")," ",re.productSummary||"\u2014")),React.createElement("div",{className:"fw-semibold mb-1"},"Line items"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"#"),React.createElement("th",null,"product_id"),React.createElement("th",{className:"text-end"},"qty"),React.createElement("th",{className:"text-end"},"price"),React.createElement("th",{className:"text-end"},"total"))),React.createElement("tbody",null,(Array.isArray((dt=re==null?void 0:re.raw)==null?void 0:dt.items)?re.raw.items:[]).map((i,l)=>{var L,h,C,_,U,ie;const k=String((h=(L=i==null?void 0:i.product_id)!=null?L:i==null?void 0:i.id)!=null?h:"").trim(),g=Number((_=(C=i==null?void 0:i.qty)!=null?C:i==null?void 0:i.quantity)!=null?_:0)||0,M=Number((ie=(U=i==null?void 0:i.price)!=null?U:i==null?void 0:i.unit_price)!=null?ie:0)||0,V=g*M;return React.createElement("tr",{key:`li-${l}-${k}`},React.createElement("td",{className:"text-muted"},l+1),React.createElement("td",{className:"text-muted"},k||"\u2014"),React.createElement("td",{className:"text-end"},g),React.createElement("td",{className:"text-end"},window.KTM.money.formatNumber(M)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(V)))}))))):null))}function AdminApp(){const[I,E]=useState(!1),[F,ye]=useState(""),[ae,J]=useState(null),[X,Oe]=useState("search"),[Fe,Se]=useState(()=>loadAdminPins()),[Ge,at]=useState(()=>loadAdminRecent()),[Be,ze]=useState(null),[we,Ee]=useState(""),[q,ut]=useState([]),[wt,xt]=useState(null),[Xe,nt]=useState(!1),[Re,gt]=useState(null),[Pt,sn]=useState(!0),[Qe,Lt]=useState([]),[Xt,A]=useState(!1),[x,H]=useState(null),[ge,ve]=useState(!1),[ce,ue]=useState(!1),[Te,S]=useState(""),[B,Q]=useState(()=>loadAdminSettings()),[re,Ie]=useState(null),[Ae,Ye]=useState([]);useEffect(()=>{const u=localStorage.getItem("ktm_admin_session");if(u)try{const G=JSON.parse(u);G.expiry>Date.now()?(E(!0),J(G.user)):localStorage.removeItem("ktm_admin_session")}catch(G){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{I&&Tt()},[I]),useEffect(()=>{const u=()=>{try{const te=document.querySelector(".admin-topbar");if(!te)return;const Ke=te.getBoundingClientRect(),Pe=Math.max(0,Math.round(Ke.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${Pe+10}px`)}catch(te){}};u(),window.addEventListener("resize",u);const G=setTimeout(u,0);return()=>{clearTimeout(G),window.removeEventListener("resize",u)}},[I,X]),useEffect(()=>{var te,Ke;const u=window.visualViewport,G=()=>{try{const Pe=Number(window.innerHeight)||0,Je=Number(u==null?void 0:u.height)||Pe,Nt=Number(u==null?void 0:u.offsetTop)||0,et=Math.max(0,Math.round(Pe-Je-Nt));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${et}px`)}catch(Pe){}};G(),window.addEventListener("resize",G);try{(te=u==null?void 0:u.addEventListener)==null||te.call(u,"resize",G),(Ke=u==null?void 0:u.addEventListener)==null||Ke.call(u,"scroll",G)}catch(Pe){}return()=>{var Pe,Je;window.removeEventListener("resize",G);try{(Pe=u==null?void 0:u.removeEventListener)==null||Pe.call(u,"resize",G),(Je=u==null?void 0:u.removeEventListener)==null||Je.call(u,"scroll",G)}catch(Nt){}}},[]),useEffect(()=>{if(!I)return;const u=te=>{if(!te)return!1;const Ke=String(te.tagName||"").toLowerCase();return!!(Ke==="input"||Ke==="textarea"||Ke==="select"||te.isContentEditable)},G=te=>{if(!te||te.ctrlKey||te.metaKey||te.altKey||u(te.target))return;const Ke=te.key;(Ke==="/"||Ke==="N"||Ke==="n"||Ke==="Escape"||Ke==="j"||Ke==="J"||Ke==="k"||Ke==="K")&&(Ke==="/"&&te.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:Ke}})))};return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[I]),useEffect(()=>{I&&at(u=>{const G=Array.isArray(u)?u:[],te=[X,...G.filter(Ke=>Ke!==X)].slice(0,8);return saveAdminRecent(te),te})},[I]);const Ue=u=>{const G=String(u||"").trim();G&&at(te=>{const Ke=Array.isArray(te)?te:[],Pe=[G,...Ke.filter(Je=>Je!==G)].slice(0,8);return saveAdminRecent(Pe),Pe})},kt=u=>{const G=String(u||"").trim();G&&Se(te=>{const Ke=Array.isArray(te)?te:[],Je=Ke.includes(G)?Ke.filter(Nt=>Nt!==G):[G,...Ke].slice(0,10);return saveAdminPins(Je),Je})};useEffect(()=>{if(!I)return;let u=!1;return(async()=>{try{const G=await fetchAdminSettingsFromServer();if(u)return;Q(G),saveAdminSettings(G)}catch(G){}})(),()=>{u=!0}},[I]);const Kt=async(u,G)=>{ye("");try{const te=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:u,password:G},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),Ke={user:te.user,token:te.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(Ke)),J(te.user),E(!0)}catch(te){ye(te.message)}},Me=()=>{localStorage.removeItem("ktm_admin_session"),E(!1),J(null),ut([]),xt(null)},it=(u,G="success",te=null)=>{const Ke=Date.now()+Math.floor(Math.random()*1e3);if(u&&typeof u=="object"){const Je=u;Lt(Nt=>[...Nt,{id:Ke,message:String(Je.message||""),type:String(Je.type||G||"success"),actionLabel:Je.actionLabel||null,onAction:typeof Je.onAction=="function"?Je.onAction:null,durationMs:Je.durationMs||null}]);return}const Pe=te&&typeof te=="object"?te:null;Lt(Je=>[...Je,{id:Ke,message:String(u||""),type:String(G||"success"),actionLabel:(Pe==null?void 0:Pe.actionLabel)||null,onAction:typeof(Pe==null?void 0:Pe.onAction)=="function"?Pe.onAction:null,durationMs:(Pe==null?void 0:Pe.durationMs)||null}])},en=u=>{Lt(G=>G.filter(te=>te.id!==u))},Tt=async(u=null)=>{sn(!0);try{const G=u?`${API_BASE}/api/albums?parent_id=${u}`:`${API_BASE}/api/albums?parent_id=root`,te=await window.KTM.api.getJSON(G,"L\u1ED7i t\u1EA3i danh s\xE1ch album");ut(Array.isArray(te)?te:[])}catch(G){console.error(G),it("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}sn(!1)},dn=()=>{gt(null),nt(!0)},Ft=u=>{Ze(u),ve(!0)},hn=async(u,G="modal")=>{try{const te=Re&&Re.uuid;!te&&re&&(u.parent_id=re.uuid);const Ke=te?`${API_BASE}/api/albums/${Re.uuid||Re.id}`:`${API_BASE}/api/albums`;te?await window.KTM.api.putJSON(Ke,u,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(Ke,u,"L\u1ED7i t\u1EA1o"),it(te?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),G==="drawer"?(ve(!1),gt(null),Tt(re==null?void 0:re.uuid),te&&x&&H({...x,...u})):(nt(!1),gt(null),Tt(re==null?void 0:re.uuid))}catch(te){it(te.message,"danger")}},gn=u=>{xt(u)},R=u=>{if(u==="root")Ye([]),Ie(null),Tt(null);else if(u){const G=Ae.findIndex(te=>te.uuid===u.uuid);G>=0&&(Ye(Ae.slice(0,G+1)),Ie(u),Tt(u.uuid))}else{const G=[...Ae];G.pop();const te=G[G.length-1]||null;Ye(G),Ie(te),Tt(te==null?void 0:te.uuid)}},se=async u=>{const G=`X\xF3a folder "${u.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(G))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${u.uuid||u.id}`,"L\u1ED7i x\xF3a album"),it("\u0110\xE3 x\xF3a","success"),Tt(re==null?void 0:re.uuid)}catch(te){it("L\u1ED7i x\xF3a album","danger")}},Ze=async u=>{u&&(A(!0),S(""),ue(!1),ve(!1),H(u))},Bt=()=>{A(!1),ue(!1),S(""),ve(!1),H(null)},fn=u=>{ve(!0)};if(!I)return React.createElement(LoginPage,{onLogin:Kt,error:F});const Vt=()=>{const u=new Date,G=u.getFullYear(),te=String(u.getMonth()+1).padStart(2,"0");return`${G}-${te}`};function Yt(){const[u,G]=useState(()=>{var Je;return String((Je=B==null?void 0:B.ship_percent)!=null?Je:DEFAULT_SHIP_PERCENT)}),[te,Ke]=useState(!1);return useEffect(()=>{var Je;G(String((Je=B==null?void 0:B.ship_percent)!=null?Je:DEFAULT_SHIP_PERCENT))},[B==null?void 0:B.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Je=>{Je.preventDefault(),Ke(!0);const Nt=saveAdminSettings({ship_percent:u});try{const et=await saveAdminSettingsToServer(Nt);Q(et),saveAdminSettings(et),it("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(et){Q(Nt),it("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{Ke(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:u,min:"0",max:"100",step:"0.01",onChange:Je=>G(Je.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:te},te?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function j(){const[u,G]=useState(Vt()),[te,Ke]=useState(!0),Pe=useRef(null),Je=useRef(null),[Nt,et]=useState(0),[mn,Wt]=useState(!1),rn=useRef(0),bn=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[st,un]=useState(bn),_n=useRef(new Map),vn=normalizeShipPercent(B==null?void 0:B.ship_percent),{formatNumber:dt,formatVND:i}=window.KTM.money,l=async(D,oe=!1)=>{var Ot,Z;const qe=String(D||"").trim();if(!qe)return bn();const ht=`${qe}|${vn}`,_t=(Ot=_n.current)==null?void 0:Ot.get(ht);if(!oe&&_t)return _t;const Gt=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(qe)}&ship_percent=${encodeURIComponent(vn)}`,vt=await window.KTM.api.getJSON(Gt,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Rt=vt!=null&&vt.stats&&(vt!=null&&vt.meta)?vt.stats:vt,nn=Rt&&typeof Rt=="object"?Rt:bn();return(Z=_n.current)==null||Z.set(ht,nn),nn},k=async(D=!1)=>{Ke(!0);try{const oe=await l(u,D);un(oe)}catch(oe){console.error("Load stats error:",oe),un(bn())}finally{Ke(!1)}};useEffect(()=>{k()},[u,vn]);const g=(D,oe)=>{const qe=String(D||"").trim(),ht=qe.match(/^(\d{4})-(\d{2})$/);if(!ht)return qe;const _t=Number(ht[1]),Gt=Number(ht[2])-1,vt=new Date(_t,Gt,1);vt.setMonth(vt.getMonth()+Number(oe||0));const Rt=vt.getFullYear(),nn=String(vt.getMonth()+1).padStart(2,"0");return`${Rt}-${nn}`},M=Vt(),V=g(M,-5),L=D=>{const oe=String(D||"").trim();return oe?oe>=V&&oe<=M:!1},h=D=>{const oe=String(D||"").trim();return oe&&(oe<V?V:oe>M?M:oe)},C=D=>{const oe=Date.now();oe-Number(rn.current||0)<1200||(rn.current=oe,it(D==="future"?"Kh\xF4ng xem \u0111\u01B0\u1EE3c th\xE1ng t\u01B0\u01A1ng lai":"Ch\u1EC9 xem t\u1ED1i \u0111a 5 th\xE1ng g\u1EA7n nh\u1EA5t","warning"))},_=(D,oe,qe)=>Math.max(oe,Math.min(qe,D)),U=()=>{var D;return Math.max(320,Number((D=Je.current)==null?void 0:D.clientWidth)||360)},ie=()=>{const D=U();return _(Math.floor(D*.35),110,180)},Ce=()=>{const D=U();return _(Math.floor(D*.22),70,140)},me=D=>{try{if(!(D!=null&&D.touches)||D.touches.length!==1||mn)return;const oe=D.target;if(oe&&typeof oe.closest=="function"&&oe.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Pe.current=null;return}const qe=D.touches[0];Pe.current={x:qe.clientX,y:qe.clientY,at:Date.now(),swiping:!1}}catch(oe){Pe.current=null}},De=D=>{const oe=Pe.current;if(!oe||mn)return;const qe=(D==null?void 0:D.touches)&&D.touches[0];if(!qe)return;const ht=qe.clientX-oe.x,_t=qe.clientY-oe.y,Gt=Math.abs(ht),vt=Math.abs(_t);if(!oe.swiping)if(Gt>12&&Gt>vt*1.2)oe.swiping=!0,Wt(!1);else return;const Rt=ie();et(_(ht,-Rt,Rt))},_e=D=>{const oe=Pe.current;if(Pe.current=null,!oe||mn||!oe.swiping){et(0);return}const qe=(D==null?void 0:D.changedTouches)&&D.changedTouches[0];if(!qe)return;const ht=qe.clientX-oe.x,_t=qe.clientY-oe.y,Gt=Date.now()-oe.at,vt=Math.abs(ht),Rt=Math.abs(_t);if(Gt>1e3)return;if(vt<30){et(0);return}if(vt<Rt*1.5)return;const nn=Ce(),Ot=vt>=nn,Z=ht>0?1:-1;if(!Ot){Wt(!0),et(0),setTimeout(()=>Wt(!1),220);return}const fe=Z>0?-1:1,tt=g(u,fe);if(!L(tt)){Wt(!0),et(Z*Math.floor(ie()*.55)),setTimeout(()=>{et(0),setTimeout(()=>Wt(!1),200)},140),C(tt>M?"future":"past");return}Wt(!0),et(Z*ie()),setTimeout(()=>{G(s=>g(s,fe)),et(-Z*ie()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{et(0),setTimeout(()=>Wt(!1),220)})})},140)},Ve=()=>{Pe.current=null,et(0)},xe=D=>{var oe,qe;try{if(!D||D.pointerType==="touch"||typeof D.button=="number"&&D.button!==0||mn)return;const ht=D.target;if(ht&&typeof ht.closest=="function"&&ht.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Pe.current=null;return}Pe.current={x:D.clientX,y:D.clientY,at:Date.now(),swiping:!1};try{(qe=(oe=D.currentTarget)==null?void 0:oe.setPointerCapture)==null||qe.call(oe,D.pointerId)}catch(_t){}}catch(ht){Pe.current=null}},ot=D=>{try{if(!D||D.pointerType==="touch")return;const oe=Pe.current;if(!oe||mn)return;const qe=D.clientX-oe.x,ht=D.clientY-oe.y,_t=Math.abs(qe),Gt=Math.abs(ht);if(!oe.swiping)if(_t>12&&_t>Gt*1.2)oe.swiping=!0,Wt(!1);else return;const vt=ie();et(_(qe,-vt,vt))}catch(oe){}},le=D=>{try{if(!D||D.pointerType==="touch")return;const oe=Pe.current;if(Pe.current=null,!oe||mn||!oe.swiping){et(0);return}const qe=D.clientX-oe.x,ht=D.clientY-oe.y,_t=Date.now()-oe.at,Gt=Math.abs(qe),vt=Math.abs(ht);if(_t>1e3)return;if(Gt<30){et(0);return}if(Gt<vt*1.5)return;const Rt=Ce(),nn=Gt>=Rt,Ot=qe>0?1:-1;if(!nn){Wt(!0),et(0),setTimeout(()=>Wt(!1),220);return}const Z=Ot>0?-1:1,fe=g(u,Z);if(!L(fe)){Wt(!0),et(Ot*Math.floor(ie()*.55)),setTimeout(()=>{et(0),setTimeout(()=>Wt(!1),200)},140),C(fe>M?"future":"past");return}Wt(!0),et(Ot*ie()),setTimeout(()=>{G(tt=>g(tt,Z)),et(-Ot*ie()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{et(0),setTimeout(()=>Wt(!1),220)})})},140)}catch(oe){Pe.current=null}},He=()=>{Pe.current=null,et(0)},Mt=Nt>0?"Th\xE1ng tr\u01B0\u1EDBc":Nt<0?"Th\xE1ng sau":"",bt=Nt>0?g(u,-1):Nt<0?g(u,1):"",yt=bt&&L(bt)?bt:"",Le=Math.min(1,Math.abs(Nt)/Math.max(1,Ce()));return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager",ref:Je,style:{touchAction:"pan-y",transform:`translateX(${Nt}px)`,transition:mn?"transform 220ms ease":"none",willChange:"transform"},onTouchStartCapture:me,onTouchMoveCapture:De,onTouchEndCapture:_e,onTouchCancelCapture:Ve,onPointerDown:xe,onPointerMove:ot,onPointerUp:le,onPointerCancel:He},!!Mt&&React.createElement("div",{"aria-hidden":"true",style:{position:"fixed",left:0,right:0,top:84,zIndex:1060,pointerEvents:"none",opacity:.15+.55*Le,transform:"translateZ(0)"}},React.createElement("div",{className:"d-flex justify-content-center"},React.createElement("div",{className:"px-3 py-2 rounded-pill bg-dark text-white shadow-sm",style:{fontSize:13}},Nt>0?"\u2190":"\u2192"," ",Mt," \xB7 ",yt))),React.createElement(Loading,{show:te}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>k(!0),disabled:te},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:u,onChange:D=>G(D.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",vn,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),dt(st.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),dt(st.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),dt(st.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",dt(st.statusCounts.paid),"/",dt(st.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},dt(st.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},i(st.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},i(st.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},i(st.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},i(st.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",st.avgQtyPerOrder?st.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},dt(st.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},dt(st.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},dt(st.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},dt(st.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},dt(st.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},dt(st.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},dt(st.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,dt(st.statusCounts.draft)),React.createElement("td",null,dt(st.statusCounts.pending)),React.createElement("td",null,dt(st.statusCounts.processing)),React.createElement("td",null,dt(st.statusCounts.canceled)),React.createElement("td",null,dt(st.statusCounts.done)),React.createElement("td",null,dt(st.statusCounts.paid)),React.createElement("td",null,dt(st.statusCounts.other)),React.createElement("td",null,dt(st.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},st.products.slice(0,10).map(D=>React.createElement("div",{key:D.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},D.product_name),React.createElement("div",{className:"text-muted small text-truncate"},D.product_code?`#${D.product_code} \u2022 `:"",dt(D.orders)," \u0111\u01A1n \u2022 ",dt(D.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},i(D.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,st.products.slice(0,10).map(D=>React.createElement("tr",{key:D.product_id},React.createElement("td",null,D.product_name),React.createElement("td",null,D.product_code||"\u2014"),React.createElement("td",null,dt(D.orders)),React.createElement("td",null,dt(D.quantity)),React.createElement("td",{className:"fw-semibold"},i(D.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},st.customers.slice(0,10).map(D=>React.createElement("div",{key:D.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},D.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},D.phone||"\u2014"," \u2022 ",dt(D.orders)," \u0111\u01A1n \u2022 ",dt(D.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},i(D.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,st.customers.slice(0,10).map(D=>React.createElement("tr",{key:D.key},React.createElement("td",null,D.customer_name||"\u2014"),React.createElement("td",null,D.phone||"\u2014"),React.createElement("td",null,dt(D.orders)),React.createElement("td",null,dt(D.quantity)),React.createElement("td",{className:"fw-semibold"},i(D.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},st.days.map(D=>React.createElement("div",{key:D.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},D.day),React.createElement("div",{className:"text-muted small"},dt(D.orders)," \u0111\u01A1n \u2022 ",dt(D.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",dt(D.doneOrders)," \u2022 ",i(D.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},i(D.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,st.days.map(D=>React.createElement("tr",{key:D.day},React.createElement("td",null,D.day),React.createElement("td",null,dt(D.orders)),React.createElement("td",null,dt(D.quantity)),React.createElement("td",{className:"fw-semibold"},i(D.revenue)),React.createElement("td",null,dt(D.doneOrders)),React.createElement("td",{className:"fw-semibold"},i(D.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:X,onMenuChange:u=>{Ue(u),Oe(u),u==="albums"&&(Ie(null),Ye([]),Tt(null))},onLogout:Me,currentUser:ae,pinnedMenus:Fe,recentMenus:Ge,onTogglePin:kt}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const G={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},recon:{title:"\u0110\u1ED1i so\xE1t Excel",icon:"fa-file-excel",sub:"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 t\u1EEB Excel"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[X]||{title:"KTM Admin",icon:"fa-tractor",sub:""},te=(ae==null?void 0:ae.username)||(ae==null?void 0:ae.name)||(ae==null?void 0:ae.email)||"Admin",Ke=(()=>{if(X!=="albums")return"";const Pe=[];return Pe.push("Root"),Array.isArray(Ae)&&Ae.length>0&&Pe.push(...Ae.map(Je=>Je==null?void 0:Je.title).filter(Boolean)),wt!=null&&wt.title&&Pe.push(wt.title),Pe.length>0?Pe.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${G.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},G.title),React.createElement("div",{className:"admin-page-subtitle"},Ke||G.sub))),React.createElement("div",{className:"admin-topbar-right"},X==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:dn,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:te},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},te)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:Me,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},X==="albums"&&!wt&&React.createElement(AlbumList,{albums:q,loading:Pt,currentFolder:re,breadcrumb:Ae,onSelect:gn,onCreate:dn,onEdit:Ft,onDelete:se,onBack:R}),X==="search"&&React.createElement(SearchCenter,{showToast:it,onNavigate:(u,G,te)=>{Oe(u),u==="orders"&&G==="create"&&(ze(Date.now()),Ee((te==null?void 0:te.productId)||""))}}),X==="albums"&&wt&&React.createElement(AlbumDetail,{album:wt,parentAlbum:Ae.length>0?Ae[Ae.length-1]:null,onBack:()=>{if(wt.parentId){const u=Ae.findIndex(G=>G.uuid===wt.parentId);u>=0?xt(Ae[u]):xt(null)}else xt(null)},onRefresh:()=>Tt(re==null?void 0:re.uuid),showToast:it,onNavigateToFolder:u=>{Ye(G=>[...G,wt]),xt(u)},onEditSubfolder:u=>{gt(u),nt(!0)}}),X==="videos"&&React.createElement(VideoList,{showToast:it}),X==="products"&&React.createElement(ProductManager,{showToast:it,settings:B}),X==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:Be,autoOpenCreateProductId:we,showToast:it}),X==="recon"&&React.createElement(ReconExcelManager,{showToast:it}),X==="stats"&&React.createElement(j,null),X==="settings"&&React.createElement(Yt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${X==="search"?"active":""}`,onClick:u=>{u.preventDefault(),Oe("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${X==="albums"?"active":""}`,onClick:u=>{u.preventDefault(),Oe("albums"),xt(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${X==="videos"?"active":""}`,onClick:u=>{u.preventDefault(),Oe("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${X==="products"?"active":""}`,onClick:u=>{u.preventDefault(),Oe("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${X==="orders"?"active":""}`,onClick:u=>{u.preventDefault(),Oe("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${X==="recon"?"active":""}`,onClick:u=>{u.preventDefault(),Oe("recon")}},React.createElement("i",{className:"fas fa-file-excel"}),React.createElement("span",null,"\u0110\u1ED1i so\xE1t")),React.createElement("a",{href:"#",className:`nav-item ${X==="stats"?"active":""}`,onClick:u=>{u.preventDefault(),Oe("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:Xe,album:Re,parentId:re==null?void 0:re.uuid,onClose:()=>nt(!1),onSave:hn}),React.createElement(AdminDrawer,{open:Xt,title:x?x.title:"Album",subtitle:x?`${x.subfolderCount||0} subfolder \u2022 ${x.count||0} \u1EA3nh`:"",onClose:Bt,footer:ge?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{ve(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{x&&(gt(x),hn({slug:x.id||"",title:x.title||"",description:x.description||"",cover_url:x.cover||"",parent_id:x.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):x?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(x.title),it("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>fn(x)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{x&&confirm(`X\xF3a folder "${x.title}"?`)&&(se(x),Bt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ge&&x?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:x.title,onChange:u=>H({...x,title:u.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:x.description,onChange:u=>H({...x,description:u.target.value})}))):x?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},x.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},x.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},x.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},x.count||0))),x.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,x.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Qe.map(u=>React.createElement(Toast,{key:u.id,message:u.message,type:u.type,actionLabel:u.actionLabel,onAction:u.onAction,durationMs:u.durationMs,onClose:()=>en(u.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:I,autoOpenCreateProductId:E,showToast:F}){const[ye,ae]=useState([]),[J,X]=useState(0),[Oe,Fe]=useState(!1),[Se,Ge]=useState(!1),[at,Be]=useState([]),[ze,we]=useState(!0),[Ee,q]=useState(!1),[ut,wt]=useState([]),[xt,Xe]=useState(!1),[nt,Re]=useState(""),[gt,Pt]=useState([]),[sn,Qe]=useState(!1),[Lt,Xt]=useState(""),[A,x]=useState(!1),[H,ge]=useState(null),[ve,ce]=useState(null),[ue,Te]=useState(!1),[S,B]=useState(()=>{const e=new Date,n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${n}-${t}`}),[Q,re]=useState(""),[Ie,Ae]=useState(!1),[Ye,Ue]=useState(!1),[kt,Kt]=useState(!1),[Me,it]=useState(null),[en,Tt]=useState(!1),[dn,Ft]=useState(""),[hn,gn]=useState(!1),R=useRef(0),[se,Ze]=useState(!1),[Bt,fn]=useState(null),[Vt,Yt]=useState(!1),[j,u]=useState(null),[G,te]=useState(()=>({left:12,top:12,placement:"bottom"})),Ke=useRef(null),Pe=useRef(!1),Je=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1}),[Nt,et]=useState(()=>({id:null,dir:null})),mn=useRef(!1),Wt=useRef(new Map),rn=useRef(null),bn=useRef(null),st="ktm_orders_status_sync_queue_v1",un=useRef([]),_n=useRef(!1),[vn,dt]=useState(()=>({})),[i,l]=useState(!1),[k,g]=useState(!1),[M,V]=useState(!1),[L,h]=useState(()=>new Set),[C,_]=useState(()=>({})),U="ktm_orders_pinned_v1",[ie,Ce]=useState(()=>new Set),[me,De]=useState(!1),[_e,Ve]=useState(!1),[xe,ot]=useState(!1),[le,He]=useState(""),[Mt,bt]=useState(()=>[]),yt=useRef(null),Le=useRef(null),D=useRef(!1),oe=useRef({active:!1,startY:0,startX:0,fired:!1}),[qe,ht]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),_t=24,Gt=20,[vt,Rt]=useState(_t),nn=useRef(null),Ot=useRef(null),Z=useRef(!1),fe=useRef(new Map),tt=useRef({timer:null,events:[]}),s=useRef(null),d="ktm_orders_phone_tip_v1",c="ktm_orders_search_history_v1",[v,P]=useState(null),[T,N]=useState(!1),[$,ne]=useState([]),[z,W]=useState(!1),[de,We]=useState([]),[f,Ne]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Ct,$t]=useState([""]),[Et,qt]=useState(null),Qt=useRef({}),[Ht,Jt]=useState([]),[ft,on]=useState(null),pn=useRef(null),cn=useRef(null),Y=useRef(0),ee=useRef(null),be=useRef(0),je=useRef(new Map),$e=useRef(null),ke=useRef(0),mt=useRef(new Map),ct=useRef(new Map),St=useRef(""),Zt=useRef(null),ln=useRef(null),Nn=useRef(0),xn=useRef(null),Sn=9,kn=150,$n=250,In=3*60*1e3,Rn=24*60*60*1e3,qn=5*60*1e3,Ln="ktm_customer_lookup_cache_v1",fa=200,Dn=3,Hn=3,Ea=1,Rs=24*60*60*1e3,Ds=120,Ks=5*60*1e3,Ya=80,Qa=2,Za=4,es=60,rt=React.useMemo(()=>String(nt||"").trim().length>0,[nt]),ia=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),ts=e=>{fn(e),Ze(!0)},ns=(e,n)=>{var t,a,r,o;try{const b=(t=n==null?void 0:n.getBoundingClientRect)==null?void 0:t.call(n),p=window.innerWidth||360,K=window.innerHeight||640,y=230,m=280,w=Math.min(Math.max(10,Math.round((a=b==null?void 0:b.left)!=null?a:10)),Math.max(10,p-y-10));let O=Math.round(((r=b==null?void 0:b.bottom)!=null?r:10)+8),pe="bottom";O+m>K-10&&(O=Math.max(10,Math.round(((o=b==null?void 0:b.top)!=null?o:10)-8-m)),pe="top"),te({left:w,top:O,placement:pe})}catch(b){te({left:12,top:12,placement:"bottom"})}u(e),Yt(!0)},zn=()=>{Yt(!1),setTimeout(()=>u(null),120)};useEffect(()=>{if(!Vt)return;const e=n=>{n.key==="Escape"&&zn()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Vt]);const Xn=()=>{Ze(!1),setTimeout(()=>fn(null),180)},Os=()=>{l(!0)},ba=()=>{l(!1)},as=e=>{const n=String(e||"").trim();n&&h(t=>{const a=new Set(t);return a.has(n)?a.delete(n):a.add(n),a})};useEffect(()=>{try{const e=localStorage.getItem(U);if(!e)return;const n=JSON.parse(e);if(!Array.isArray(n))return;Ce(new Set(n.map(t=>String(t||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from(ie||[]).map(n=>String(n||"").trim()).filter(Boolean);localStorage.setItem(U,JSON.stringify(e))}catch(e){}},[ie]);const Es=e=>{const n=String(e||"").trim();n&&Ce(t=>{const a=new Set(t);return a.has(n)?a.delete(n):a.add(n),a})};useEffect(()=>{try{const e=localStorage.getItem(c);if(!e)return;const n=JSON.parse(e);if(!Array.isArray(n))return;bt(n.map(t=>String(t||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Ps=e=>{try{localStorage.setItem(c,JSON.stringify(e))}catch(n){}},oa=e=>{const n=String(e||"").trim();n&&bt(t=>{const a=Array.isArray(t)?t:[],r=[n,...a.filter(o=>String(o||"").trim().toLowerCase()!==n.toLowerCase())].slice(0,10);return Ps(r),r})},ss=e=>{var t;const n=String((t=e!=null?e:nt)!=null?t:"").trim();He(n),ot(!0),setTimeout(()=>{var a,r;try{(r=(a=yt.current)==null?void 0:a.focus)==null||r.call(a)}catch(o){}},0)},Tn=()=>{ot(!1)};useEffect(()=>{if(!xe)return;const e=n=>{n.key==="Escape"&&Tn()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[xe]),useEffect(()=>{if(!qe)return;const e=a=>{if(xe||(window.scrollY||0)>6)return;const r=a.touches&&a.touches[0];r&&(oe.current={active:!0,startY:r.clientY,startX:r.clientX,fired:!1})},n=a=>{const r=oe.current;if(!(r!=null&&r.active)||r.fired||(window.scrollY||0)>6)return;const o=a.touches&&a.touches[0];if(!o)return;const b=o.clientY-r.startY,p=o.clientX-r.startX;Math.abs(p)>24||b>92&&(r.fired=!0,ss(nt))},t=()=>{oe.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",n,{passive:!0}),window.addEventListener("touchend",t,{passive:!0}),window.addEventListener("touchcancel",t,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",n),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)}},[qe,xe,nt]);const rs=e=>{try{const n=yn(e==null?void 0:e.status);if(!(n==="pending"||n==="processing"))return!1;const t=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(t.getTime()))return!1;const a=new Date;return t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()}catch(n){return!1}};useEffect(()=>{var t;let e;const n=()=>{try{ht(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(a){ht(!1)}};try{e=(t=window.matchMedia)==null?void 0:t.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",n):e!=null&&e.addListener&&e.addListener(n)}catch(a){e=null}return window.addEventListener("resize",n),n(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",n):e!=null&&e.removeListener&&e.removeListener(n)}catch(a){}window.removeEventListener("resize",n)}},[]),useEffect(()=>{const e="admin-sheet-open";return se||i||Vt?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[se,i,Vt]),useEffect(()=>{if(!se&&!i&&!Vt)return;const e=n=>{n.key==="Escape"&&(se&&Xn(),i&&ba(),Vt&&zn())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[se,i,Vt]);const Ls=()=>{try{if(localStorage.getItem(d))return;localStorage.setItem(d,"1"),typeof F=="function"&&F("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},is=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),os=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),cs=e=>{const n=Ut(String(e||"")).replace(/[^0-9+]/g,"");if(n)try{window.location.href=`tel:${n}`}catch(t){}},js=async e=>{var t,a,r;const n=Ut(String(e||"")).replace(/[^0-9+]/g,"");if(n)try{await((r=(a=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:a.call(t,n))!=null?r:Promise.reject(new Error("Clipboard not available"))),typeof F=="function"&&F("\u0110\xE3 copy S\u0110T","success")}catch(o){typeof F=="function"&&F("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Fs=()=>{try{const e=localStorage.getItem(st),n=e?JSON.parse(e):[];return Array.isArray(n)?n:[]}catch(e){return[]}},ls=e=>{try{localStorage.setItem(st,JSON.stringify(Array.isArray(e)?e:[]))}catch(n){}},ga=(e,n)=>{const t=String(e||"").trim();t&&dt(a=>{const r={...a||{}};return n?r[t]=!0:delete r[t],r})},Bs=(e,n,t)=>{const a=String(e||"").trim(),r=yn(n),o=yn(t);if(!a||!r)return;const b=Array.isArray(un.current)?un.current:[],p=new Map(b.map(y=>[String((y==null?void 0:y.orderId)||""),y]));p.set(a,{orderId:a,nextStatus:r,prevStatus:o,ts:Date.now()});const K=Array.from(p.values()).sort((y,m)=>(Number(y.ts)||0)-(Number(m.ts)||0));un.current=K,ls(K),ga(a,!0)},Pa=async()=>{if(_n.current||!navigator.onLine)return;const e=Array.isArray(un.current)?un.current.slice():[];if(e.length){_n.current=!0;try{for(const n of e){const t=String((n==null?void 0:n.orderId)||"").trim(),a=yn(n==null?void 0:n.nextStatus);if(!(!t||!a)){ga(t,!0);try{await Jn({id:t,status:(n==null?void 0:n.prevStatus)||""},a,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const r=(Array.isArray(un.current)?un.current:[]).filter(o=>String((o==null?void 0:o.orderId)||"")!==t);un.current=r,ls(r),ga(t,!1)}catch(r){if(!navigator.onLine)break}}}}finally{_n.current=!1}}};useEffect(()=>{const e=Fs();un.current=e;try{const n={};for(const t of e){const a=String((t==null?void 0:t.orderId)||"").trim();a&&(n[a]=!0)}dt(n)}catch(n){}setTimeout(()=>Pa(),600)},[]),useEffect(()=>{const e=()=>Pa();window.addEventListener("online",e);const n=setInterval(()=>Pa(),8e3);return()=>{clearInterval(n),window.removeEventListener("online",e)}},[]);const qs=(e,n)=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e),Z.current=!1,Ls();try{Ot.current&&clearTimeout(Ot.current)}catch(a){}Ot.current=setTimeout(()=>{Z.current=!0,js(n)},520)},ya=e=>{var n;(n=e==null?void 0:e.stopPropagation)==null||n.call(e);try{Ot.current&&clearTimeout(Ot.current)}catch(t){}Ot.current=null},Hs=e=>{const n=String(e||"").trim();if(!n)return;_(r=>({...r,[n]:Date.now()}));const t=fe.current;try{const r=t.get(n);r&&clearTimeout(r)}catch(r){}const a=setTimeout(()=>{_(r=>{const o={...r||{}};return delete o[n],o});try{t.delete(n)}catch(r){}},9e3);t.set(n,a)},ds=e=>String(e||"").replace(/\s+/g," ").trim(),zs=e=>String(e||"").replace(/[^0-9]+/g,""),ca=e=>{try{const n=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(n))return 0;const t=Date.now()-n;return!Number.isFinite(t)||t<=0?0:Math.floor(t/Rs)}catch(n){return 0}},va=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:ca(e)>=Dn,yn=e=>{const n=String(e!=null?e:"").trim().toLowerCase();return n==="cancelled"?"canceled":n},La=React.useMemo(()=>["draft","pending","processing","done","paid"],[]),Yn=(e,n)=>{const t=yn(e);if(!t||t==="canceled")return null;const a=La.indexOf(t);return a<0?null:n==="left"?La[a+1]||null:n==="right"&&La[a-1]||null},ms=e=>{var r;const n=yn(e);if(!n)return{label:"",icon:"fa-circle"};const t=((r=ia.find(o=>yn(o==null?void 0:o.value)===n))==null?void 0:r.label)||"",a=(()=>{switch(n){case"draft":return"fa-file-lines";case"pending":return"fa-hourglass-half";case"processing":return"fa-truck";case"done":return"fa-check";case"paid":return"fa-money-bill-wave";case"canceled":return"fa-ban";default:return"fa-circle"}})();return{label:t,icon:a}},Na=e=>{if(yn(e==null?void 0:e.status)!=="draft")return null;const t=Hn-ca(e);return Number.isFinite(t)?t:null},wa=e=>{const n=Na(e);return Number.isFinite(n)?n>0&&n<=Ea:!1},Vn=e=>{Ne({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),$t([""]),P(null),qt(null)};useEffect(()=>{const e=n=>{var a;if(Et==null)return;const t=(a=Qt.current)==null?void 0:a[Et];t&&!t.contains(n.target)&&qt(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Et]);const us=e=>window.KTM.money.parseMoney(e),ps=e=>window.KTM.money.parseSignedMoney(e),jt=e=>window.KTM.money.formatVND(e),Kn=e=>{const t=(Array.isArray(e)?e:[]).map(a=>{var r,o;return{amount:String((r=a==null?void 0:a.amount)!=null?r:""),note:String((o=a==null?void 0:a.note)!=null?o:"")}});return t.length?t:[{amount:"",note:""}]},Xs=e=>{try{const n=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(n)?n:[]).map(a=>{var r,o;return{amount:(a==null?void 0:a.amount)===0?"":String((r=a==null?void 0:a.amount)!=null?r:""),note:String((o=a==null?void 0:a.note)!=null?o:"").trim()}}).filter(a=>String(a.amount||"").trim()||String(a.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(n){return[{amount:"",note:""}]}},Qn=e=>(Array.isArray(e)?e:[]).map(t=>({amount:ps(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),ja=e=>{const n=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Qn(n),a=Zn(t),r=(()=>{if(!t.length)return"";const o=t.map(b=>String((b==null?void 0:b.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:a,summaryText:r}},Zn=e=>(Array.isArray(e)?e:[]).reduce((t,a)=>t+(Number(a==null?void 0:a.amount)||0),0),Fa=e=>{const n=Array.isArray(e)?e:[];return n.length?JSON.stringify(n):""},hr=e=>window.KTM.money.parseShipFeeFromNote(e),ea=e=>window.KTM.phone.isValid(e),Ut=e=>window.KTM.phone.normalize(e),Ba=async e=>{if(!e)return null;const n=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return n&&typeof n=="object"&&n.order&&typeof n.order=="object"?n.order:n},Vs=(e,n)=>{var o;const t=Array.isArray(e)?e:[],a=Array.isArray(n)?n:[];if(!t.length)return a;if(!a.length)return t;const r=new Map(t.map(b=>{var p;return[String((p=b==null?void 0:b.id)!=null?p:""),b]}));for(const b of a){const p=String((o=b==null?void 0:b.id)!=null?o:"");p&&r.set(p,b)}return Array.from(r.values())},Sa=async e=>{var n,t,a,r;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const o=(t=(n=Wt.current)==null?void 0:n.get)==null?void 0:t.call(n,String(e.id));if(o&&typeof o=="object"&&Array.isArray(o.items)&&o.items.length)return o}catch(o){}try{const o=await Ba(e.id);if(o&&typeof o=="object"){try{(r=(a=Wt.current)==null?void 0:a.set)==null||r.call(a,String(e.id),o)}catch(b){}return ae(b=>Array.isArray(b)?b.map(p=>String(p==null?void 0:p.id)===String(e.id)?o:p):b),o}}catch(o){console.error("Fetch order by id error:",o)}return e},Ws=()=>{var e;try{const n=localStorage.getItem(Ln);if(!n)return;const t=JSON.parse(n);if(!t||typeof t!="object")return;const a=Object.entries(t);for(const[r,o]of a)!r||!o||typeof o!="object"||(e=ct.current)==null||e.set(String(r),o)}catch(n){}},qa=()=>{try{const e=ct.current;if(!e||typeof e.entries!="function")return;const n=Array.from(e.entries()).filter(([a,r])=>a&&r&&typeof r=="object"&&Number.isFinite(r.ts)).sort((a,r)=>(Number(r[1].ts)||0)-(Number(a[1].ts)||0)).slice(0,fa),t={};for(const[a,r]of n)t[a]=r;localStorage.setItem(Ln,JSON.stringify(t))}catch(e){}};useEffect(()=>{Ws()},[]);const hs=e=>{const n=Ut(e);if(!n)return null;const t=Array.isArray(ye)?ye:[];let a=null,r=-1;for(const o of t){if(!o||Ut(o.phone||"")!==n)continue;const b=new Date(o.created_at).getTime(),p=Number.isFinite(b)?b:0;p>=r&&(r=p,a=o)}return a?{name:String(a.customer_name||"").trim(),address:String(a.address||"").trim()}:null},fs=(e,n)=>{e&&Ne(t=>n&&Ut(t.phone)!==n?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Gs=e=>{const n=hs(e);if(!n)return;const t=Ut(e);Ne(a=>{if(t&&Ut(a.phone)!==t)return a;const r={...a};return!String(a.customer_name||"").trim()&&n.name&&(r.customer_name=n.name),!String(a.address||"").trim()&&n.address&&(r.address=n.address),r})},Js=(e,n,t)=>{var a;try{const r=Ut(e);if(!r)return;const o=String(n||"").trim(),b=String(t||"").trim();if(!o&&!b)return;(a=ct.current)==null||a.set(r,{ts:Date.now(),status:"found",customer:{phone:r,name:o||null,address:b||null}}),qa()}catch(r){}},xa=async e=>{var r,o,b;const n=Ut(e);if(!n)return;Gs(n);const t=(r=ct.current)==null?void 0:r.get(n);if(t&&Number.isFinite(t.ts)){const p=Date.now()-t.ts,K=t.status==="found"?Rn:qn;if(p>=0&&p<=K){P({status:t.status,phone:n,customer:t.customer}),t.status==="found"&&t.customer&&fs(t.customer,n);return}}const a=++Y.current;P({status:"loading",phone:n});try{const p=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(n)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Y.current!==a)return;if(p&&p.exists&&p.customer){(o=ct.current)==null||o.set(n,{ts:Date.now(),status:"found",customer:p.customer}),qa(),P({status:"found",phone:n,customer:p.customer}),fs(p.customer,n);return}(b=ct.current)==null||b.set(n,{ts:Date.now(),status:"not-found",customer:null}),qa(),P({status:"not-found",phone:n})}catch(p){if(Y.current!==a)return;console.error("Customer lookup error:",p),P({status:"error",phone:n})}},bs=e=>{const n=Ut(e),t=hs(n);Ne(r=>{const o={...r,phone:n};return t&&(!String(r.customer_name||"").trim()&&t.name&&(o.customer_name=t.name),!String(r.address||"").trim()&&t.address&&(o.address=t.address)),o}),N(!1),cn.current&&(clearTimeout(cn.current),cn.current=null);const a=n;if(a.length<Sn){P(null);return}if(ea(a)&&a!==St.current){St.current=a,xa(a);return}cn.current=setTimeout(()=>{const r=Ut(n);ea(r)&&r!==St.current&&(St.current=r,xa(r))},kn)},gs=()=>{const e=Ut(f.phone);e.length<Sn||ea(e)&&e!==St.current&&(St.current=e,xa(e))};useEffect(()=>(Ye?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Ye]);const ka=Array.isArray(f.items)?f.items.length:0;useEffect(()=>{if(!Ye){Nn.current=ka;return}ka>Nn.current&&setTimeout(()=>{const e=Zt.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Nn.current=ka},[Ye,ka]),useEffect(()=>()=>{cn.current&&(clearTimeout(cn.current),cn.current=null),ee.current&&(clearTimeout(ee.current),ee.current=null)},[]),useEffect(()=>{if(!Ye)return;ee.current&&(clearTimeout(ee.current),ee.current=null);const e=Ut((f==null?void 0:f.phone)||"");if(!ea(e)){ne([]),W(!1);return}return ee.current=setTimeout(async()=>{var r;const n=String(e),t=(r=je.current)==null?void 0:r.get(n);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=In){ne(Array.isArray(t.orders)?t.orders:[]),W(!1);return}const a=++be.current;W(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,b=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(be.current!==a)return;const p=Array.isArray(b)?b:Array.isArray(b==null?void 0:b.orders)?b.orders:[];ne(p);try{const K=je.current;if(K&&typeof K.set=="function"&&(K.set(n,{ts:Date.now(),orders:p}),K.size>100)){const y=Array.from(K.entries()).sort((w,O)=>{var pe,he;return(Number((pe=w==null?void 0:w[1])==null?void 0:pe.ts)||0)-(Number((he=O==null?void 0:O[1])==null?void 0:he.ts)||0)}),m=Math.max(0,y.length-100);for(let w=0;w<m;w++)K.delete(y[w][0])}}catch(K){}}catch(o){if(be.current!==a)return;console.error("Phone history fetch error:",o),ne([])}finally{if(be.current!==a)return;W(!1)}},$n),()=>{ee.current&&(clearTimeout(ee.current),ee.current=null)}},[Ye,f==null?void 0:f.phone]),useEffect(()=>{Qs()},[]),useEffect(()=>{rt||Wn()},[S,rt]),useEffect(()=>{Ta()},[]),useEffect(()=>{I&&pn.current!==I&&(pn.current=I,Ma(E))},[I]);const Mn=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",ta=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",jn=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(ye),n=ie;if(!n||!(n instanceof Set)||n.size===0)return e;const t=Array.isArray(e)?e.slice():[];return t.sort((a,r)=>{var p,K;const o=n.has(String((p=a==null?void 0:a.id)!=null?p:""))?1:0;return(n.has(String((K=r==null?void 0:r.id)!=null?K:""))?1:0)-o}),t},[ye,ie]),Ha=React.useMemo(()=>window.KTM.orders.sortOrders(at),[at]),Ca=React.useMemo(()=>{const n=(Array.isArray(Ha)?Ha:[]).filter(t=>va(t));return n.sort((t,a)=>{const r=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(a==null?void 0:a.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(o)?o:0)}),n},[Ha]),ys=React.useMemo(()=>{const n=(Array.isArray(ut)?ut:[]).filter(t=>wa(t));return n.sort((t,a)=>{const r=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(a==null?void 0:a.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(o)?o:0)}),n},[ut]),la=React.useMemo(()=>{if(Ie)return Ca;let e=jn;if(me){const n=ie;e=(Array.isArray(e)?e:[]).filter(t=>{var a,r;return(r=n==null?void 0:n.has)==null?void 0:r.call(n,String((a=t==null?void 0:t.id)!=null?a:""))})}return _e&&(e=(Array.isArray(e)?e:[]).filter(n=>rs(n))),e},[Ie,Ca,jn,me,ie,_e]),Aa=React.useMemo(()=>{if(Ie)return la;const e=String(Q||"").trim();return e?(Array.isArray(la)?la:[]).filter(n=>String((n==null?void 0:n.status)||"").trim()===e):la},[la,Q,Ie]),vs=React.useMemo(()=>window.KTM.orders.sortOrders(gt),[gt]),an=React.useMemo(()=>rt?vs:Aa,[Aa,rt,vs]),Ns=React.useMemo(()=>{const e=Array.isArray(an)?an:[];return qe?e.slice(0,Math.max(0,Number(vt)||0)):e},[qe,vt,an]);useEffect(()=>{qe&&Rt(_t)},[qe,Q,Ie,S,nt]),useEffect(()=>{if(!qe)return;const e=Array.isArray(an)?an.length:0;if(vt>=e)return;const n=nn.current;if(!n)return;const t=new IntersectionObserver(a=>{Array.isArray(a)&&a.some(o=>o==null?void 0:o.isIntersecting)&&Rt(o=>Math.min((Number(o)||0)+Gt,e))},{root:null,rootMargin:"520px 0px",threshold:0});return t.observe(n),()=>t.disconnect()},[qe,vt,an]),useEffect(()=>{if(!qe){g(!1),V(!1);return}const e=()=>{s.current||(s.current=window.requestAnimationFrame(()=>{s.current=null;const n=window.scrollY||document.documentElement.scrollTop||0;g(n>140),V(n>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),s.current&&(window.cancelAnimationFrame(s.current),s.current=null)}},[qe]),useEffect(()=>{if(!qe){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(n){}return}const e=()=>{try{const n=document.querySelector(".mobile-bottom-nav"),t=n&&n.offsetHeight?n.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${t}px`)}catch(n){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[qe]);const Fn=React.useMemo(()=>{const e=Array.isArray(an)?an:[],n={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const a=yn(t==null?void 0:t.status);a==="draft"?n.draft+=1:a==="pending"?n.pending+=1:a==="processing"?n.processing+=1:a==="done"?n.done+=1:a==="paid"?n.paid+=1:a==="canceled"?n.canceled+=1:n.other+=1}return n},[an]),Us=React.useMemo(()=>{const e=ie;return!e||e.size===0?0:(Array.isArray(jn)?jn:[]).reduce((n,t)=>{var a;return n+(e.has(String((a=t==null?void 0:t.id)!=null?a:""))?1:0)},0)},[ie,jn]),Ys=React.useMemo(()=>(Array.isArray(jn)?jn:[]).filter(e=>rs(e)).length,[jn]),ws=React.useMemo(()=>{const e=new Date,n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${n}-${t}`},[]),Pn=e=>{if(rt&&Re(""),e==="thisMonth"){Ae(!1),re(""),B(ws);return}if(e==="overduePending"){B(""),Ae(!0),re("pending");return}if(e==="draftExpiring"){Ae(!1),re("draft"),B(""),Ta();return}if(e==="all"){Ae(!1),re(""),B(ws);return}},na=e=>window.KTM.date.formatDateTime(e),Qs=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Jt(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Jt([])}},Wn=async()=>{we(!0),Ge(!1);try{const n=new URLSearchParams;S&&n.set("month",String(S)),n.set("includeItems","0"),n.set("meta","1"),n.set("limit",String(es)),n.set("offset","0");const t=`${API_BASE}/api/orders?${n.toString()}`,a=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),r=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.orders)?a.orders:[],o=!Array.isArray(a)&&a&&typeof a=="object"&&a.meta||null;ae(Array.isArray(r)?r:[]),X(Array.isArray(r)?r.length:0),Fe(!!(o!=null&&o.hasMore)),Ta()}catch(n){console.error("Load orders error:",n),ae([]),X(0),Fe(!1)}finally{we(!1),Ge(!1)}},Zs=async()=>{if(!(ze||Se||rt)&&Oe){Ge(!0);try{const e=new URLSearchParams;S&&e.set("month",String(S)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(es)),e.set("offset",String(J));const n=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(n,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),a=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],r=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;ae(o=>Vs(o,Array.isArray(a)?a:[])),X(o=>o+(Array.isArray(a)?a.length:0)),Fe(!!(r!=null&&r.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{Ge(!1)}}},Ss=async e=>{var r;const n=ds(e);if(!n){Pt([]),Xt(""),Qe(!1);return}const t=zs(n);if(n.length<Qa&&t.length<Za){Pt([]),Xt(`Nh\u1EADp \xEDt nh\u1EA5t ${Qa} k\xFD t\u1EF1 (ho\u1EB7c ${Za} s\u1ED1) \u0111\u1EC3 search nhanh`),Qe(!1);return}try{const o=(r=mt.current)==null?void 0:r.get(n);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=Ks){Pt(Array.isArray(o.results)?o.results:[]),Xt(""),Qe(!1);return}}catch(o){}const a=++ke.current;Qe(!0),Xt("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(n)}`,b=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(ke.current!==a)return;const p=Array.isArray(b)?b:[];Pt(p);try{const K=mt.current;if(K&&typeof K.set=="function"&&(K.set(n,{ts:Date.now(),results:p}),K.size>Ya)){const y=Array.from(K.entries()).sort((w,O)=>{var pe,he;return(Number((pe=w==null?void 0:w[1])==null?void 0:pe.ts)||0)-(Number((he=O==null?void 0:O[1])==null?void 0:he.ts)||0)}),m=Math.max(0,y.length-Ya);for(let w=0;w<m;w++)K.delete(y[w][0])}}catch(K){}}catch(o){if(ke.current!==a)return;console.error("Order search error:",o),Pt([]),Xt((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if(ke.current!==a)return;Qe(!1)}};useEffect(()=>{$e.current&&(clearTimeout($e.current),$e.current=null);const e=ds(nt);if(!e){Pt([]),Xt(""),Qe(!1);return}return Ie&&Ae(!1),$e.current=setTimeout(()=>{Ss(e)},Ds),()=>{$e.current&&(clearTimeout($e.current),$e.current=null)}},[nt]);const Ta=async()=>{q(!0),Xe(!0);try{const[e,n]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Dn)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Ea)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);Be(Array.isArray(e)?e:[]),wt(Array.isArray(n)?n:[])}catch(e){console.error("Load all orders error:",e),Be([]),wt([])}finally{q(!1),Xe(!1)}},za=async e=>{const n=await Sa(e);if(!n)return;on(n.id);const t=Array.isArray(n.items)&&n.items.length?n.items.map(p=>{var K,y,m,w;return{product_id:(p==null?void 0:p.product_id)||"",quantity:Number((K=p==null?void 0:p.quantity)!=null?K:1)||1,unit_price:(()=>{var he;const O=(he=p==null?void 0:p.unit_price)!=null?he:p==null?void 0:p.unitPrice,pe=O==null||O===""?NaN:Number(O);return Number.isFinite(pe)?Math.trunc(pe):null})(),variant:String((y=p==null?void 0:p.variant)!=null?y:"").trim(),variant_json:(w=(m=p==null?void 0:p.variant_json)!=null?m:p==null?void 0:p.variantJson)!=null?w:null}}).filter(p=>p.product_id):[{product_id:n.product_id||"",quantity:Number(n.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],a=Xs(n),r=Qn(a),o=Zn(r),b=Fa(r);Ne({customer_name:n.customer_name||"",phone:Ut(n.phone||""),address:n.address||"",note:(n==null?void 0:n.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:a,adjustment_amount:o,adjustment_note:b||(n==null?void 0:n.adjustment_note)||"",status:n.status||"pending"}),$t(new Array(t.length?t.length:1).fill("")),We(new Array(t.length?t.length:1).fill(!0)),P(null),Ue(!1),it(n),Kt(!0),Ft(""),Tt(!1),gn(!0),n.phone&&xa(Ut(n.phone))},da=async e=>{if(!e)return;Kt(!0),Ft(""),Tt(!0),gn(!1),it(e);const n=++R.current;try{const t=await Sa(e);if(R.current!==n)return;it(t||e)}catch(t){if(R.current!==n)return;Ft((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(R.current!==n)return;Tt(!1)}},er=()=>{A||ue||(Kt(!1),Tt(!1),Ft(""),gn(!1),on(null),Vn(""),N(!1),We([]))};function Ma(e){Kt(!1),gn(!1),Tt(!1),Ft(""),on(null),Vn(e||""),N(!1),We([]),Ue(!0)}const Xa=()=>{A||ue||(Ue(!1),on(null),Vn(""),N(!1),We([]))},xs=async()=>{var p,K,y;if(!ft||ue||A)return;const e=(Array.isArray(ye)?ye:[]).find(m=>String(m==null?void 0:m.id)===String(ft))||null,n=String((e==null?void 0:e.status)||(f==null?void 0:f.status)||"").trim();if(n==="done"||n==="paid"||n==="canceled"){const m="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof F=="function"?F(m,"warning"):alert(m);return}const t=Ut(f.phone),r=(Array.isArray(f.items)?f.items:[]).map((m,w)=>{var O,pe;return{idx:w,product_id:String((m==null?void 0:m.product_id)||"").trim(),quantity:Number((O=m==null?void 0:m.quantity)!=null?O:0),variant:String((m==null?void 0:m.variant)||"").trim()||null,variant_json:(pe=m==null?void 0:m.variant_json)!=null?pe:null,unit_price:(()=>{const he=m==null?void 0:m.unit_price,pt=he===""||he==null?NaN:Number(he);if(Number.isFinite(pt))return Math.max(0,Math.trunc(pt));const lt=Cn(m==null?void 0:m.product_id),tn=m!=null&&m.variant_json&&typeof m.variant_json=="object"?m.variant_json:null;return aa(lt,tn)})()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0);if(r.length<2){const m="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof F=="function"?F(m,"warning"):alert(m);return}const o=[],b=[];for(const m of r){const w=!!de[m.idx],O={product_id:m.product_id,quantity:m.quantity,unit_price:m.unit_price,variant:m.variant,variant_json:m.variant_json};w?o.push(O):b.push(O)}if(!o.length||!b.length){const m="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof F=="function"?F(m,"warning"):alert(m);return}Te(!0);try{const m=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],w=Qn(m),O=Zn(w),pe=Fa(w),he={customer_name:f.customer_name,phone:t,address:f.address,note:(f.note||"").trim(),adjustment_amount:O,adjustment_note:pe,adjustment_items:w,status:"processing",items:o,product_id:o[0].product_id,quantity:o[0].quantity,split_seq:1},pt=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,he,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),lt=(y=(K=pt==null?void 0:pt.id)!=null?K:(p=pt==null?void 0:pt.order)==null?void 0:p.id)!=null?y:null;if(!lt)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const tn={id:ft,customer_name:f.customer_name,phone:t,address:f.address,note:(f.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:b,product_id:b[0].product_id,quantity:b[0].quantity,parent_order_id:String(lt),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${ft}`,tn,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Xa(),Wn();const At=lt?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${lt}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof F=="function"?F(At,"success"):alert(At)}catch(m){console.error(m);const w=(m==null?void 0:m.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof F=="function"?F(w,"danger"):alert(w)}finally{Te(!1)}},ks=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const n=String(e),t=Ht.find(a=>String(a==null?void 0:a.id)===n);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},On=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(n){return String(e!=null?e:"").toLowerCase()}},tr=e=>{const t=On(e).trim().split(/\s+/).filter(Boolean),a=t.join(" ");return{contentTokens:t,cleanedQuery:a}},Cs=React.useMemo(()=>(Array.isArray(Ht)?Ht:[]).map((e,n)=>{var y,m,w,O,pe,he;const t=On((y=e==null?void 0:e.name)!=null?y:""),a=On((m=e==null?void 0:e.code)!=null?m:""),r=On((w=e==null?void 0:e.category)!=null?w:""),o=On((O=e==null?void 0:e.note)!=null?O:""),b=On((pe=e==null?void 0:e.id)!=null?pe:""),p=On((he=e==null?void 0:e.stt)!=null?he:""),K=`${t} ${a} ${r} ${o} ${b} ${p}`.trim();return{p:e,originalIndex:n,name:t,code:a,category:r,note:o,haystackAll:K}}),[Ht]),nr=(e,n,t)=>{var w,O,pe,he,pt;const a=Array.isArray(n)?n:[],r=On(t).trim();if(!a.length&&!r)return 0;const o=(w=e==null?void 0:e.name)!=null?w:"",b=(O=e==null?void 0:e.code)!=null?O:"",p=(pe=e==null?void 0:e.category)!=null?pe:"",K=(he=e==null?void 0:e.note)!=null?he:"";if(!((pt=e==null?void 0:e.haystackAll)!=null?pt:""))return 0;let m=0;r&&(o===r&&(m+=220),o.includes(r)&&(m+=140),o.startsWith(r)&&(m+=160),b&&b===r&&(m+=180),b&&b.includes(r)&&(m+=90));for(const lt of a){if(!lt)continue;const tn=new RegExp(`(?:^|\\s)${lt.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(lt)&&(m+=35),tn.test(o)&&(m+=25),b&&b.includes(lt)&&(m+=20),b&&tn.test(b)&&(m+=10),p&&p.includes(lt)&&(m+=12),K&&K.includes(lt)&&(m+=6)}return m>0&&o&&(m+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),m},Va=(e,n)=>{const t=String(e||""),a=String(n||"");if(t===a)return 0;if(!t)return a.length;if(!a)return t.length;const r=t.length,o=a.length;if(o>r)return Va(a,t);let b=new Array(o+1),p=new Array(o+1);for(let K=0;K<=o;K++)b[K]=K;for(let K=1;K<=r;K++){p[0]=K;const y=t.charCodeAt(K-1);for(let w=1;w<=o;w++){const O=y===a.charCodeAt(w-1)?0:1;p[w]=Math.min(b[w]+1,p[w-1]+1,b[w-1]+O)}const m=b;b=p,p=m}return b[o]},ar=(e,n)=>{const t=String(e||"").trim(),a=String(n||"");if(!t||!a)return!1;if(a.includes(t))return!0;const r=a.split(/\s+/).filter(Boolean);if(!r.length)return!1;const o=t.length<=4?1:2;for(const b of r)if(!(Math.abs(b.length-t.length)>o)&&Va(t,b)<=o)return!0;return!1},_a=e=>{const n=On(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return n?n.split(" ").filter(Boolean):[]},sr=(e,n)=>{const t=Array.isArray(n)?n:[];if(!t.length)return 0;const a=_a((e==null?void 0:e.name)||""),r=_a((e==null?void 0:e.code)||""),o=_a((e==null?void 0:e.category)||""),b=_a((e==null?void 0:e.note)||""),p=(y,m,w)=>{const O=String(y||"").trim();if(!O||!m.length)return 0;const pe=O.length<=4?1:2;let he=1/0,pt=-1;for(let At=0;At<m.length;At++){const An=m[At];if(!An||Math.abs(An.length-O.length)>pe)continue;const zt=Va(O,An);if(zt<he&&(he=zt,pt=At,zt===0))break}if(he===1/0||he>pe)return 0;let tn=Math.round(w*(he===0?1:he===1?.65:.45));return pt===0?tn+=Math.round(w*.25):pt===1&&(tn+=Math.round(w*.12)),tn};let K=0;for(const y of t){if(!y)continue;const m=p(y,a,180),w=p(y,r,120),O=p(y,o,60),pe=p(y,b,30);K+=Math.max(m,w,O,pe)}if(K>0){const y=((e==null?void 0:e.name)||"").length;K+=Math.max(0,60-Math.min(60,Math.floor(y/2)))}return K},Wa=React.useRef(new Map);React.useEffect(()=>{Wa.current=new Map},[Ht]);const As=e=>{var y,m;const n=String(Ct[e]||"").trim();if(!n)return Ht;const{contentTokens:t,cleanedQuery:a}=tr(n);if(t.length===0)return Ht;const r=On(n).trim(),o=Wa.current.get(r);if(o)return o;const b=[];for(const w of Cs){const O=w.haystackAll;O&&t.some(pe=>O.includes(pe))&&b.push(w)}let p=b;if(p.length<8&&t.length>0){const w=[],O=new Set(p.map(pe=>{var he,pt;return String((pt=(he=pe.p)==null?void 0:he.id)!=null?pt:"")+":"+String(pe.originalIndex)}));for(const pe of Cs){const he=String((m=(y=pe.p)==null?void 0:y.id)!=null?m:"")+":"+String(pe.originalIndex);if(O.has(he))continue;const pt=pe.haystackAll;pt&&t.some(lt=>ar(lt,pt))&&(w.push(pe),O.add(he))}w.length&&(p=p.concat(w))}const K=p.map(w=>({entry:w,score:nr(w,t,a)})).map(w=>{if(w.score>0)return w;const O=sr(w.entry,t);return O>0?{...w,score:O}:w}).filter(w=>w.score>0).sort((w,O)=>O.score!==w.score?O.score-w.score:w.entry.originalIndex-O.entry.originalIndex).slice(0,40).map(w=>w.entry.p);return Wa.current.set(r,K),K},Cn=e=>{if(!e)return null;const n=String(e);return Ht.find(t=>String(t==null?void 0:t.id)===n)||null},Bn=e=>{if(e==null||e==="")return[];let n=e;if(typeof n=="string"){const t=n.trim();if(!t)return[];try{n=JSON.parse(t)}catch(a){return[]}}return Array.isArray(n)?n.map((t,a)=>{var b;if(!t||typeof t!="object")return null;const r=String((b=t.name)!=null?b:"").trim()||`Bi\u1EBFn th\u1EC3 ${a+1}`,o=(Array.isArray(t.options)?t.options:[]).map(p=>{var pt,lt,tn,At,An,zt,En;if(!p||typeof p!="object")return null;const K=String((pt=p.label)!=null?pt:"").trim();if(!K)return null;const y=(An=(At=(tn=(lt=p.price)!=null?lt:p.priceValue)!=null?tn:p.unit_price)!=null?At:p.unitPrice)!=null?An:null,m=y==null||y===""?NaN:typeof y=="number"?y:typeof y=="string"?us(y):Number(y),w=Number.isFinite(m)?Math.trunc(m):null,O=(En=(zt=p.price_delta)!=null?zt:p.priceDelta)!=null?En:null,pe=Number(O),he=Number.isFinite(pe)?Math.trunc(pe):0;return{label:K,price:w,price_delta:he}}).filter(Boolean);return{name:r,options:o}}).filter(Boolean):[]},fr=e=>{const n=Cn(e);return Bn(n==null?void 0:n.variants)},$a=e=>{if(!e||typeof e!="object")return"";const n=[];for(const[t,a]of Object.entries(e)){const r=String(t||"").trim(),o=String(a||"").trim();!r||!o||n.push(`${r}: ${o}`)}return n.join(", ")},aa=(e,n)=>{const t=us(e==null?void 0:e.price),a=Bn(e==null?void 0:e.variants);if(!a.length||!n||typeof n!="object")return t;let r=t,o=!1;for(const b of a){const p=String((b==null?void 0:b.name)||"").trim(),K=String((n==null?void 0:n[p])||"").trim();if(!p||!K)continue;const y=(Array.isArray(b.options)?b.options:[]).find(he=>String((he==null?void 0:he.label)||"").trim()===K);if(!y)continue;const m=y==null?void 0:y.price,w=m==null||m===""?NaN:Number(m);if(Number.isFinite(w)){r=Math.max(0,Math.trunc(w)),o=!0;continue}const O=y==null?void 0:y.price_delta,pe=O==null||O===""?NaN:Number(O);Number.isFinite(pe)&&(r+=Math.trunc(pe))}return r},Ga=e=>window.KTM.orders.getOrderItems(e),Ts=e=>window.KTM.orders.getOrderTotalQty(e),sa=e=>window.KTM.orders.getOrderProductSummary(e,Cn),Ia=e=>window.KTM.orders.getOrderItemRows(e,Cn),ma=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Gn=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),rr=e=>{const n=Ga(e),t=Ia(e),a=pa(n),r=ua(n),o=r.fee,b=ma(e),p=a+o+b,K=m=>{const w=Number(m)||0;return w>0?`+${jt(w)}`:jt(w)},y=[];if(e!=null&&e.customer_name&&y.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&y.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&y.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&y.push(`GHI CH\xDA: ${(e.note||"").trim()}`),y.push(""),y.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const m of t)y.push(`- ${m.name} (SL: ${m.qty})`);else{const m=sa(e);m&&m!=="\u2014"&&y.push(`- ${m}`)}y.push(""),y.push(`T\u1EA0M T\xCDNH: ${jt(a)}`),r.found&&o!==0&&y.push(`SHIP: ${jt(o)}`);{const m=window.KTM.orders.getOrderAdjustmentItems(e),w=(Array.isArray(m)?m:[]).map(he=>{var pt;return{amount:Number((pt=he==null?void 0:he.amount)!=null?pt:0)||0,note:String((he==null?void 0:he.note)||"").trim()}}).filter(he=>he.amount!==0||!!he.note),O=Gn(e);if(b!==0||w.length>0||!!O)if(w.length===1){const he=w[0];y.push(`\u0110I\u1EC0U CH\u1EC8NH: ${K(b)}${he.note?` \u2014 ${he.note}`:""}`)}else{y.push(`\u0110I\u1EC0U CH\u1EC8NH: ${K(b)}${!w.length&&O?` \u2014 ${O}`:""}`);for(const he of w)y.push(`- ${K(he.amount)}${he.note?`: ${he.note}`:""}`)}}return y.push(`T\u1ED4NG: ${jt(p)}`),y.filter(Boolean).join(`
`)},Ra=async e=>{try{const n=await Sa(e),t=rr(n);await window.KTM.clipboard.writeText(t),typeof F=="function"?F("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(n){console.error(n),typeof F=="function"?F("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},ua=e=>window.KTM.orders.getOrderShipInfo(e,Cn),pa=e=>window.KTM.orders.getItemsSubtotal(e,Cn),Ja=e=>{try{const n=e instanceof Date?e:new Date(e);if(!n||Number.isNaN(n.getTime()))return"";const t=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0");return`${t}-${a}`}catch(n){return""}},Ua=()=>S?String(S):Ja(new Date),Ms=e=>{const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Ut((e==null?void 0:e.phone)||""),a=String((e==null?void 0:e.address)||"").trim().toLowerCase(),r=ja(e).amount,b=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(p=>{var K;return{product_id:String((p==null?void 0:p.product_id)||"").trim(),quantity:Number((K=p==null?void 0:p.quantity)!=null?K:0),variant:String((p==null?void 0:p.variant)||"").trim()}}).filter(p=>p.product_id&&Number.isFinite(p.quantity)&&p.quantity>0).sort((p,K)=>p.product_id<K.product_id?-1:p.product_id>K.product_id?1:p.variant<K.variant?-1:p.variant>K.variant?1:p.quantity-K.quantity);return JSON.stringify({name:n,phone:t,address:a,items:b,adj:r})},wn=React.useMemo(()=>{const e=Ut((f==null?void 0:f.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ua()};const n=Ua(),a=(Array.isArray($)?$:[]).filter(r=>{if(!r||ft&&String(r.id)===String(ft)||Ut(r.phone||"")!==e)return!1;const o=Ja(r.created_at);return o&&o===n}).sort((r,o)=>{const b=new Date(r.created_at).getTime(),p=new Date(o.created_at).getTime();return(Number.isFinite(p)?p:0)-(Number.isFinite(b)?b:0)});return{count:a.length,orders:a,monthKey:n}},[$,f==null?void 0:f.phone,S,ft]),ir=e=>{var p;const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Ut((e==null?void 0:e.phone)||""),a=String((e==null?void 0:e.address)||"").trim().toLowerCase(),r=ps((p=e==null?void 0:e.adjustment_amount)!=null?p:0),o=Ga(e),b=(Array.isArray(o)?o:[]).map(K=>{var y;return{product_id:String((K==null?void 0:K.product_id)||"").trim(),quantity:Number((y=K==null?void 0:K.quantity)!=null?y:0),variant:String((K==null?void 0:K.variant)||"").trim()}}).filter(K=>K.product_id&&Number.isFinite(K.quantity)&&K.quantity>0).sort((K,y)=>K.product_id<y.product_id?-1:K.product_id>y.product_id?1:K.variant<y.variant?-1:K.variant>y.variant?1:K.quantity-y.quantity);return JSON.stringify({name:n,phone:t,address:a,items:b,adj:r})},_s=React.useMemo(()=>{if(ft)return"";const e=Ut((f==null?void 0:f.phone)||"");if(!e)return"";const n=Ua(),t=Ms(f),a=Array.isArray($)?$:[];for(const r of a){if(!r||ft&&String(r.id)===String(ft)||Ut(r.phone||"")!==e)continue;const o=Ja(r.created_at);if(!o||o!==n)continue;const b=ir(r);if(b&&b===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${n}${r!=null&&r.id?` (#${r.id})`:""}`}return""},[$,f,S,ft]),$s=e=>{var An;const n=[],t=[],a=String((e==null?void 0:e.customer_name)||"").trim(),r=Ut((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim();a||n.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),r||n.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),r&&!ea(r)&&n.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const p=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(zt=>zt&&zt.product_id);p.length===0&&n.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),p.some(zt=>{var Un;const En=Number((Un=zt==null?void 0:zt.quantity)!=null?Un:0);return!Number.isFinite(En)||En<=0})&&n.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const y=new Set;let m=!1;for(const zt of p){const En=String(zt.product_id||"").trim(),Un=String((zt==null?void 0:zt.variant)||"").trim();if(!En)continue;const Dt=`${En}||${Un}`;if(y.has(Dt)){m=!0;break}y.add(Dt)}m&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const w=pa(p),O=ua(p),pe=O!=null&&O.found?Number((An=O==null?void 0:O.fee)!=null?An:0):0,he=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],pt=Qn(he),lt=Zn(pt),tn=pt.some(zt=>(Number(zt==null?void 0:zt.amount)||0)!==0&&!String((zt==null?void 0:zt.note)||"").trim());O!=null&&O.found&&(pe>=2e5||w>0&&pe>w*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${jt(pe)}`),tn&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const At=Math.abs(lt);return(At>=5e5||w>0&&At>w*.5)&&lt!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${jt(lt)}`),{errors:n,warnings:t,canSubmit:n.length===0}},br=React.useMemo(()=>$s(f),[f,Ht]),It=React.useMemo(()=>{var Un;const e=String((f==null?void 0:f.customer_name)||"").trim(),n=Ut((f==null?void 0:f.phone)||""),t=String((f==null?void 0:f.address)||"").trim(),a=Array.isArray(f==null?void 0:f.items)?f.items:[],r=new Map;for(const Dt of a){const ra=String((Dt==null?void 0:Dt.product_id)||"").trim(),Ka=String((Dt==null?void 0:Dt.variant)||"").trim();if(!ra)continue;const Oa=`${ra}||${Ka}`;r.set(Oa,(r.get(Oa)||0)+1)}const o=a.map(Dt=>{var Is;const ra=String((Dt==null?void 0:Dt.product_id)||"").trim(),Ka=Number((Is=Dt==null?void 0:Dt.quantity)!=null?Is:0),Oa=ra?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",dr=Number.isFinite(Ka)&&Ka>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",mr=String((Dt==null?void 0:Dt.variant)||"").trim(),ur=`${ra}||${mr}`,pr=ra&&(r.get(ur)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Oa,qtyError:dr,dupWarn:pr}}),b=a.filter(Dt=>Dt&&Dt.product_id),p=pa(b),K=ua(b),y=K!=null&&K.found?Number((Un=K==null?void 0:K.fee)!=null?Un:0):0,m=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],w=Qn(m),O=Zn(w),pe=w.some(Dt=>(Number(Dt==null?void 0:Dt.amount)||0)!==0&&!String((Dt==null?void 0:Dt.note)||"").trim()),he=Math.abs(O),pt=pe?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",lt=O!==0&&(he>=5e5||p>0&&he>p*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${jt(O)}`:"",tn=K!=null&&K.found&&(y>=2e5||p>0&&y>p*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${jt(y)}`:"",At=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",An=n?ea(n)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",zt=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",En=!At&&!An&&o.every(Dt=>!Dt.productError&&!Dt.qtyError);return{nameError:At,phoneError:An,addressWarn:zt,items:o,shipAbnormalWarn:tn,adjustmentNoteWarn:pt,adjustmentAbnormalWarn:lt,canSubmit:En}},[f,Ht]),Da=async e=>{var p,K,y;const n=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",a=$s(f);if(!a.canSubmit){const m=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof F=="function"?F(m,"danger"):alert(m);return}if(!ft&&_s){const m=`${_s}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(m)){(wn==null?void 0:wn.count)>0&&N(!0),setTimeout(()=>{var pe;const O=document.getElementById("order-phone-input");O&&typeof O.scrollIntoView=="function"&&(O.scrollIntoView({block:"center",behavior:"smooth"}),(pe=O.focus)==null||pe.call(O))},0);return}}const r=Ut(f.phone),b=(Array.isArray(f.items)?f.items:[]).map(m=>{var w,O;return{product_id:(m==null?void 0:m.product_id)||"",quantity:Number((w=m==null?void 0:m.quantity)!=null?w:1),variant:String((m==null?void 0:m.variant)||"").trim()||null,variant_json:(O=m==null?void 0:m.variant_json)!=null?O:null,unit_price:(()=>{const pe=m==null?void 0:m.unit_price,he=pe===""||pe==null?NaN:Number(pe);if(Number.isFinite(he))return Math.max(0,Math.trunc(he));const pt=Cn(m==null?void 0:m.product_id),lt=m!=null&&m.variant_json&&typeof m.variant_json=="object"?m.variant_json:null;return aa(pt,lt)})()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0);x(!0);try{const m=ft,w=ft?`${API_BASE}/api/orders/${ft}`:`${API_BASE}/api/orders`,O=b[0],pe=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],he=Qn(pe),pt=Zn(he),lt=Fa(he),tn={customer_name:f.customer_name,phone:r,address:f.address,note:(f.note||"").trim(),adjustment_amount:pt,adjustment_note:lt,adjustment_items:he,product_id:O.product_id,quantity:O.quantity,status:f.status,items:b,...ft?{id:ft}:{}};if(ft)await window.KTM.api.putJSON(w,tn,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const At=await window.KTM.api.postJSON(w,tn,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");xn.current={id:(y=(K=At==null?void 0:At.id)!=null?K:(p=At==null?void 0:At.order)==null?void 0:p.id)!=null?y:null,fingerprint:Ms(f),ts:Date.now()}}if(Js(r,f.customer_name,f.address),t==="drawer"){if(Vn(""),on(null),Ue(!1),gn(!1),N(!1),We([]),Wn(),m){Tt(!0),Ft("");try{const At=await Ba(m);At&&typeof At=="object"&&it(At)}catch(At){Ft((At==null?void 0:At.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Tt(!1)}}}else n==="new"&&!ft?(Vn(""),on(null),Ue(!0)):(Vn(""),on(null),Ue(!1)),Wn()}catch(m){console.error(m),typeof F=="function"?F(m.message,"danger"):alert(m.message);return}finally{x(!1)}},ha=e=>window.KTM.orders.getOrderTotalMoney(e,Cn),gr=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){ge(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Wn(),Ta()}catch(n){console.error(n),typeof F=="function"?F(n.message,"danger"):alert(n.message)}finally{ge(null)}}},or=()=>{const e=tt.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(o){}e.timer=null}const n=Array.isArray(e.events)?e.events.splice(0):[];if(!n.length||typeof F!="function")return;const t=new Map;for(const o of n){const b=String((o==null?void 0:o.orderId)||"").trim();b&&t.set(b,o)}const a=Array.from(t.values());if(!a.length)return;const r=o=>async()=>{try{for(const b of o)!(b!=null&&b.prevStatus)||!(b!=null&&b.orderId)||await Jn({id:b.orderId,status:b.nextStatus},b.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});F(o.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${o.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(b){F("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(a.length===1){const o=a[0],b=`${Mn(o.prevStatus)} \u2192 ${Mn(o.nextStatus)}`.trim();F(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${b}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:r([o])});return}F(`\u0110\xE3 c\u1EADp nh\u1EADt ${a.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:r(a)})},cr=e=>{const n=tt.current;n&&(Array.isArray(n.events)||(n.events=[]),n.events.push(e),!n.timer&&(n.timer=setTimeout(()=>or(),320)))};useEffect(()=>()=>{try{const e=tt.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Jn=async(e,n,t={})=>{var b;const a=await Sa(e),r=a==null?void 0:a.id;if(!r||!n)return;const o=yn(a==null?void 0:a.status);ce(r);try{const p=Ga(a),K=(Array.isArray(p)?p:[]).map(w=>{var O,pe;return{product_id:(w==null?void 0:w.product_id)||"",quantity:Number((O=w==null?void 0:w.quantity)!=null?O:1),variant:String((w==null?void 0:w.variant)||"").trim()||null,variant_json:(pe=w==null?void 0:w.variant_json)!=null?pe:null,unit_price:(()=>{var lt;const he=(lt=w==null?void 0:w.unit_price)!=null?lt:w==null?void 0:w.unitPrice,pt=Number(he);return Number.isFinite(pt)?Math.max(0,Math.trunc(pt)):null})()}}).filter(w=>w.product_id&&Number.isFinite(w.quantity)&&w.quantity>0);if(!K.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const y=K[0],m={id:r,customer_name:(a==null?void 0:a.customer_name)||"",phone:Ut((a==null?void 0:a.phone)||""),address:(a==null?void 0:a.address)||"",note:((a==null?void 0:a.note)||"").trim(),adjustment_amount:Number((b=a==null?void 0:a.adjustment_amount)!=null?b:0)||0,adjustment_note:(a==null?void 0:a.adjustment_note)||"",product_id:y.product_id,quantity:y.quantity,status:n,items:K};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${r}`,m,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),ae(w=>Array.isArray(w)?w.map(O=>(O==null?void 0:O.id)===r?{...O,status:n}:O):w),Be(w=>Array.isArray(w)?w.map(O=>(O==null?void 0:O.id)===r?{...O,status:n}:O):w),ga(r,!1),Hs(r),t!=null&&t.silentToast)return;if(t!=null&&t.skipToastBatch){typeof F=="function"&&F("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}cr({orderId:r,prevStatus:o,nextStatus:yn(n)})}catch(p){if(console.error(p),(!navigator.onLine||(p==null?void 0:p.name)==="TypeError"||String((p==null?void 0:p.message)||"").toLowerCase().includes("failed to fetch"))&&!(t!=null&&t.fromSync)){ae(y=>Array.isArray(y)?y.map(m=>(m==null?void 0:m.id)===r?{...m,status:n}:m):y),Be(y=>Array.isArray(y)?y.map(m=>(m==null?void 0:m.id)===r?{...m,status:n}:m):y),Bs(r,n,o),typeof F=="function"&&F("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof F=="function"?F(p.message,"danger"):alert(p.message)}finally{ce(null)}};useEffect(()=>{const e=n=>{var a;const t=(a=n==null?void 0:n.detail)==null?void 0:a.key;if(t){if(t==="/"){setTimeout(()=>{var r,o;(o=(r=ln.current)==null?void 0:r.focus)==null||o.call(r)},0);return}if(t==="N"||t==="n"){Ma();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&kt&&(Me!=null&&Me.id)){const r=Array.isArray(an)?an:[],o=r.findIndex(K=>String(K==null?void 0:K.id)===String(Me==null?void 0:Me.id));if(o<0)return;const p=r[o+(t==="j"||t==="J"?-1:1)];p&&da(p)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[an,kt,Me]);const lr=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:f.customer_name,onChange:e=>Ne({...f,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!It.nameError&&React.createElement("div",{className:"form-text text-danger"},It.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:f.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!It.phoneError&&React.createElement("div",{className:"form-text text-danger"},It.phoneError),!It.phoneError&&wn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",wn.count," \u0111\u01A1n trong th\xE1ng ",wn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>N(e=>!e)},T?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),T&&wn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>N(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},wn.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ta(e.status)}`},Mn(e.status))),React.createElement("div",{className:"text-muted small"},na(e.created_at)," \u2022 ",jt(ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&za(e)}},"M\u1EDF")))),wn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(v==null?void 0:v.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(v==null?void 0:v.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(v==null?void 0:v.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(v==null?void 0:v.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:f.status,onChange:e=>Ne({...f,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:f.address,onChange:e=>Ne({...f,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!It.addressWarn&&React.createElement("div",{className:"form-text text-warning"},It.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:f.note,onChange:e=>Ne({...f,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Ne(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Kn(f.adjustment_items).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const a=t.target.value;Ne(r=>{const o=Kn(r.adjustment_items);return o[n]={...o[n],amount:a},{...r,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const a=t.target.value;Ne(r=>{const o=Kn(r.adjustment_items);return o[n]={...o[n],note:a},{...r,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{Ne(t=>{const a=Kn(t.adjustment_items);return a.splice(n,1),{...t,adjustment_items:a.length?a:[{amount:"",note:""}]}})},disabled:A||Kn(f.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!It.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},It.adjustmentAbnormalWarn),!!It.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},It.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Ne(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),$t(e=>[...Array.isArray(e)?e:[],""]),ft&&We(e=>[...Array.isArray(e)?e:[],!0])},disabled:A},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(f.items)?f.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Qt.current[n]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{qt(t=>t===n?null:n),setTimeout(()=>{const t=document.getElementById(`order-product-search-${n}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Et===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:Ct[n]||"",onChange:t=>{const a=t.target.value;$t(r=>{const o=Array.isArray(r)?[...r]:[];return o[n]=a,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(n);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(a.id),o=Bn(a==null?void 0:a.variants),b={};for(const y of o){const m=String((y==null?void 0:y.name)||"").trim(),w=Array.isArray(y==null?void 0:y.options)?y.options[0]:null,O=String((w==null?void 0:w.label)||"").trim();m&&O&&(b[m]=O)}const p=$a(b),K=aa(a,b);Ne(y=>{const m=Array.isArray(y.items)?[...y.items]:[];return m[n]={...m[n]||{quantity:1},product_id:r,variant_json:Object.keys(b).length?b:null,variant:p,unit_price:o.length?K:null},{...y,items:m}}),qt(null)}},a.name,a.code?` (${a.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Ht.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var a;const t=(a=It.items)==null?void 0:a[n];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Cn(e.product_id),a=Bn(t==null?void 0:t.variants);if(!a.length)return null;const r=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},a.map((o,b)=>{const p=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${b+1}`).trim(),K=String((r==null?void 0:r[p])||"").trim();return React.createElement("div",{key:p},React.createElement("label",{className:"form-label small text-muted mb-1"},p),React.createElement("select",{className:"form-select",value:K,onChange:y=>{const m=String(y.target.value||"").trim();Ne(w=>{const O=Array.isArray(w.items)?[...w.items]:[],pe={...O[n]||{}},he=Cn(pe.product_id),pt=Bn(he==null?void 0:he.variants),lt=pe!=null&&pe.variant_json&&typeof pe.variant_json=="object"?{...pe.variant_json}:{};m?lt[p]=m:delete lt[p];const tn=$a(lt),At=aa(he,lt);return O[n]={...pe,variant_json:Object.keys(lt).length?lt:null,variant:tn,unit_price:At},{...w,items:O}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",p," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(y=>React.createElement("option",{key:y.label,value:y.label},y.label,Number.isFinite(Number(y==null?void 0:y.price))?` (${jt(Number(y.price))})`:Number(y==null?void 0:y.price_delta)?` (${y.price_delta>0?"+":""}${y.price_delta})`:""))))}))})(),ft&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!de[n],onChange:t=>{const a=!!t.target.checked;We(r=>{const o=Array.isArray(r)?[...r]:[],b=Array.isArray(f.items)?f.items.length:0;for(;o.length<b;)o.push(!0);return o[n]=a,o})},disabled:A||ue}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const a=t.target.value;Ne(r=>{const o=Array.isArray(r.items)?[...r.items]:[];return o[n]={...o[n]||{product_id:""},quantity:a},{...r,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var a;const t=(a=It.items)==null?void 0:a[n];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{Ne(t=>{const a=Array.isArray(t.items)?[...t.items]:[];return a.splice(n,1),{...t,items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),$t(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a.length?a:[""]}),We(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a}),qt(t=>t==null?t:t===n?null:t>n?t-1:t)},disabled:A||ue||(Array.isArray(f.items)?f.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(f.items)?f.items:[]).filter(p=>p==null?void 0:p.product_id),t=pa(n),a=ua(n),r=ja(f),o=r.amount,b=t+(a.found?a.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},jt(t))),a.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},jt(a.fee))),!!It.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},It.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},jt(o))),(f.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(f.note||"").trim()),!!r.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",r.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},jt(b)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:A||!!H||!!ve}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.all," \u0111\u01A1n"),rt&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>rt?Ss(nt):Wn(),disabled:sn,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>Ma(),disabled:A||!!H},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${me&&!Ie&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),Ve(!1),De(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Us)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${_e&&!Ie&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),De(!1),Ve(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ys)),React.createElement("button",{type:"button",className:`orders-chip ${!Q&&!Ie&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.all)),React.createElement("button",{type:"button",className:`orders-chip ${Q==="draft"&&!Ie&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("draft"),B("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.draft)),React.createElement("button",{type:"button",className:`orders-chip ${Q==="pending"&&!Ie&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.pending)),React.createElement("button",{type:"button",className:`orders-chip ${Q==="processing"&&!Ie&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.processing)),React.createElement("button",{type:"button",className:`orders-chip ${Q==="done"&&!Ie&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.done)),React.createElement("button",{type:"button",className:`orders-chip ${Q==="paid"&&!Ie&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.paid)),React.createElement("button",{type:"button",className:`orders-chip ${Q==="canceled"&&!Ie&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Pn("thisMonth"),disabled:rt},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Pn("overduePending"),disabled:rt},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",Dn," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Pn("draftExpiring"),disabled:rt},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y"),(Q||Ie||!S&&!rt)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Pn("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:ln,type:"text",className:"form-control",value:nt,onChange:e=>Re(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(nt||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Re(""),disabled:sn},React.createElement("i",{className:"fas fa-times"})),sn&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:S,onChange:e=>B(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:Ie||rt})),React.createElement("div",{className:"text-muted small ms-auto"},rt?"Search b\u1ECF qua filter":Ie?"\u0110ang xem \u0111\u01A1n ch\u1EADm":Q?`L\u1ECDc: ${Mn(Q)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${M?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if(rt){const e=String(nt||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${an.length} k\u1EBFt qu\u1EA3`}return Ie?`\u0110\u01A1n ch\u1EADm \u2022 ${an.length} \u0111\u01A1n`:me?`\u01AFu ti\xEAn \u2022 ${an.length} \u0111\u01A1n`:_e?`H\xF4m nay \u2022 ${an.length} \u0111\u01A1n`:Q?`L\u1ECDc: ${Mn(Q)} \u2022 ${an.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${an.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Re(""),De(!1),Ve(!1),Pn("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},rt?`${an.length} k\u1EBFt qu\u1EA3`:Q?`${Aa.length}/${ye.length} \u0111\u01A1n`:`${ye.length}${Oe?"+":""} \u0111\u01A1n`)),rt&&Lt&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Lt),Ca.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Ca.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Dn," ng\xE0y.",Ee&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Ae(!0),re("pending")}},"Xem ngay")),ys.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,ys.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 h\u1EE7y (c\xF2n \u2264 ",Ea," ng\xE0y).",xt&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Ae(!1),re("draft"),B(""),Wn()}},"Xem ngay")),(rt?sn:ze)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,n)=>React.createElement("div",{key:n,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,n)=>React.createElement("tr",{key:n},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(rt?an.length===0:ye.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},rt?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!rt&&Aa.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Ns.map(e=>{var n;return React.createElement("div",{key:e.id,className:`orders-mobile-swipe-shell mb-2 ${(Nt==null?void 0:Nt.id)===String(e.id)?`swipe-preview swipe-${(Nt==null?void 0:Nt.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>{if(mn.current){mn.current=!1;return}da(e)},onPointerDown:t=>{if(se||i||Vt||t.button!=null&&t.button!==0)return;const a=String(e.id);mn.current=!1,Je.current={active:!0,id:a,startX:t.clientX,startY:t.clientY,dx:0,dy:0,lock:null,pointerId:t.pointerId,captured:!1},et(r=>(r==null?void 0:r.id)===a?r:{id:a,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(r){}try{rn.current&&clearTimeout(rn.current)}catch(r){}bn.current=a,rn.current=setTimeout(async()=>{var o,b,p,K;const r=bn.current;if(r)try{if((b=(o=Wt.current)==null?void 0:o.has)!=null&&b.call(o,r))return;const y=await Ba(r);y&&typeof y=="object"&&((K=(p=Wt.current)==null?void 0:p.set)==null||K.call(p,r,y))}catch(y){}},150)},onPointerMove:t=>{const a=Je.current;if(!(a!=null&&a.active)||String(a.id)!==String(e.id))return;const r=t.clientX-a.startX,o=t.clientY-a.startY;if(a.dx=r,a.dy=o,Math.abs(r)>14||Math.abs(o)>14){try{rn.current&&clearTimeout(rn.current)}catch(O){}rn.current=null,bn.current=null}if(!a.lock){const O=Math.abs(r),pe=Math.abs(o);if((O>10||pe>10)&&(a.lock=O>pe*1.2?"x":"y",a.lock==="x"&&!a.captured))try{t.currentTarget.setPointerCapture(t.pointerId),a.captured=!0}catch(he){}}if(a.lock!=="x"){try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(O){}Math.abs(o)>24&&et(O=>(O==null?void 0:O.id)===a.id?{id:a.id,dir:null}:O);return}const b=!!Yn(e==null?void 0:e.status,"right"),p=!!Yn(e==null?void 0:e.status,"left"),K=(O,pe,he)=>Math.max(pe,Math.min(he,O)),y=K(r,-140,140),m=y>0&&!b||y<0&&!p?y*.35:y,w=K(Math.abs(m)/88,0,1);try{t.currentTarget.classList.add("swiping"),t.currentTarget.style.setProperty("--swipe-x",`${m}px`),t.currentTarget.style.setProperty("--swipe-p",String(w)),t.currentTarget.style.setProperty("--swipe-l",m>0&&b?String(w):"0"),t.currentTarget.style.setProperty("--swipe-r",m<0&&p?String(w):"0")}catch(O){}Math.abs(m)>12&&(mn.current=!0),r>72&&b?et({id:a.id,dir:"right"}):r<-72&&p?et({id:a.id,dir:"left"}):et({id:a.id,dir:null})},onPointerCancel:t=>{try{rn.current&&clearTimeout(rn.current)}catch(r){}rn.current=null,bn.current=null;const a=Je.current;try{a!=null&&a.captured&&(a==null?void 0:a.pointerId)!=null&&t.currentTarget.releasePointerCapture(a.pointerId)}catch(r){}Je.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1},et({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(r){}},onPointerUp:t=>{try{rn.current&&clearTimeout(rn.current)}catch(m){}rn.current=null,bn.current=null;const a=Je.current;if(!(a!=null&&a.active)||String(a.id)!==String(e.id)){et({id:null,dir:null});return}try{a!=null&&a.captured&&(a==null?void 0:a.pointerId)!=null&&t.currentTarget.releasePointerCapture(a.pointerId)}catch(m){}Je.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1};const r=Number(a.dx)||0,o=Math.abs(r),b=a.lock==="x",p=yn(e==null?void 0:e.status);et({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(m){}if(b&&o>12&&(mn.current=!0),!b||o<88)return;t.preventDefault(),t.stopPropagation();const K=r>0?Yn(e==null?void 0:e.status,"right"):Yn(e==null?void 0:e.status,"left"),y=yn(K);!y||y===p||Jn(e,y)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),da(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"orders-mobile-swipe-bg","aria-hidden":"true"},React.createElement("div",{className:"orders-mobile-swipe-bg-left"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Yn(e==null?void 0:e.status,"right"),a=ms(t),r=(a==null?void 0:a.label)||String(t||"").trim();return r?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${a.icon||"fa-circle"}`}),r):null})())),React.createElement("div",{className:"orders-mobile-swipe-bg-right"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Yn(e==null?void 0:e.status,"left"),a=ms(t),r=(a==null?void 0:a.label)||String(t||"").trim();return r?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${a.icon||"fa-circle"}`}),r):null})()))),React.createElement("div",{className:`card orders-mobile-card ${C!=null&&C[String(e.id)]?"order-recent-updated":""}`},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:t=>qs(t,e.phone),onPointerMove:ya,onPointerUp:ya,onPointerCancel:ya,onPointerLeave:ya,onClick:t=>{if(t.stopPropagation(),Z.current){Z.current=!1;return}cs(e.phone)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),cs(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((n=e==null?void 0:e.split_seq)!=null?n:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=is(e);if(!t)return null;const a=L.has(String(e.id)),r=t.length>84||os(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${a?"":"order-text-collapsed"}`},t),r&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:o=>{o.stopPropagation(),as(e.id)}},a?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const t=os(e);if(!t)return null;const a=L.has(String(e.id)),r=is(e).length,o=r>84||t.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${a?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t),o&&r<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:b=>{b.stopPropagation(),as(e.id)}},a?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${ie.has(String(e.id))?"active":""}`,onClick:t=>{t.stopPropagation(),Es(e.id)},title:ie.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":ie.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:ie.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(vn!=null&&vn[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${ta(e.status)} order-status-badge-btn`,onPointerDown:t=>{t.stopPropagation(),Pe.current=!1;try{Ke.current&&clearTimeout(Ke.current)}catch(a){}Ke.current=setTimeout(()=>{Pe.current=!0,ns(e,t.currentTarget)},420)},onPointerUp:t=>{t.stopPropagation();try{Ke.current&&clearTimeout(Ke.current)}catch(a){}Ke.current=null},onPointerCancel:t=>{t.stopPropagation();try{Ke.current&&clearTimeout(Ke.current)}catch(a){}Ke.current=null},onClick:t=>{if(t.stopPropagation(),Pe.current){Pe.current=!1;return}Vt&&String(j==null?void 0:j.id)===String(e.id)?zn():ns(e,t.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},Mn(e.status)),va(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Dn} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(e),"d"),wa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Hn} ng\xE0y`},"\u23F3 C\xF2n ",Na(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=Ia(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((a,r)=>React.createElement("div",{key:r,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},r+1,"."),a.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${jt(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sa(e))})()),(ma(e)!==0||Gn(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},jt(ma(e))),Gn(e)?React.createElement("span",{className:"text-muted"}," ","(",Gn(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},jt(ha(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",na(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),Ra(e)},disabled:A||!!H||ve===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),ts(e)},disabled:A||!!H||ve===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c")))))}),React.createElement("div",{ref:nn,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(an)&&Ns.length<an.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),Vt&&j&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>zn()},React.createElement("div",{className:`orders-status-popover ${(G==null?void 0:G.placement)||""}`,style:{left:G.left,top:G.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},j.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>zn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},ia.map(e=>{const n=yn(j.status)===yn(e.value),t=A||!!H||ve===j.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${n?"active":""}`,onClick:()=>{n||(Jn(j,e.value),zn())},disabled:t},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{ts(j),zn()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),se&&Bt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Xn()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},Bt.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},Bt.phone||""),React.createElement("span",{className:`badge ${ta(Bt.status)}`},Mn(Bt.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Xn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Ra(Bt),Xn()},disabled:A||!!H||ve===Bt.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(Bt.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(Bt.phone||"").trim()}`,onClick:()=>Xn()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{da(Bt),Xn()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},ia.map(e=>{const n=yn(Bt.status)===yn(e.value),t=A||!!H||ve===Bt.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${n?"active":""}`,onClick:()=>{n||(Jn(Bt,e.value),Xn())},disabled:t},e.label)})))),i&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>ba()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ba(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Pn("thisMonth"),disabled:rt},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Pn("overduePending"),disabled:rt},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Pn("draftExpiring"),disabled:rt},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!Q&&!Ie?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("")}},"T\u1EA5t c\u1EA3"),ia.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${Q===e.value&&!Ie?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re(e.value),e.value==="draft"&&B("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:S,onChange:e=>B(e.target.value),disabled:Ie||rt}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:Ie,onChange:e=>{rt&&Re("");const n=!!e.target.checked;Ae(n),n&&(B(""),re("pending"))},disabled:rt}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",Dn," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Pn("all"),disabled:rt},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>ba()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${k?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){D.current=!1;try{Le.current&&clearTimeout(Le.current)}catch(n){}Le.current=setTimeout(()=>{D.current=!0,ss(nt)},460)}},onPointerUp:()=>{try{Le.current&&clearTimeout(Le.current)}catch(e){}Le.current=null},onPointerCancel:()=>{try{Le.current&&clearTimeout(Le.current)}catch(e){}Le.current=null},onClick:()=>{if(D.current){D.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,n;return(n=(e=ln.current)==null?void 0:e.focus)==null?void 0:n.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>Ma(),disabled:A||!!H,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Os(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),xe&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{oa(le),Tn()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const n=e.touches&&e.touches[0];n&&(oe.current={active:!0,startY:n.clientY,startX:n.clientX,fired:!1})},onTouchMove:e=>{const n=oe.current;if(!(n!=null&&n.active)||n.fired)return;const t=e.touches&&e.touches[0];if(!t)return;const a=t.clientY-n.startY,r=t.clientX-n.startX;Math.abs(r)>24||a>90&&(n.fired=!0,oa(le),Tn())},onTouchEnd:()=>{oe.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{oa(le),Tn()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:yt,type:"text",className:"form-control",value:le,onChange:e=>{const n=e.target.value;He(n),Re(n)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(oa(le),Tn())}}),!!String(le||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{He(""),Re("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(Mt)&&Mt.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},Mt.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{He(e),Re(e),oa(e),Tn()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${me?"active":""}`,onClick:()=>{Re(""),He(""),Ae(!1),Ve(!1),De(e=>!e),Tn()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${_e?"active":""}`,onClick:()=>{Re(""),He(""),Ae(!1),De(!1),Ve(e=>!e),Tn()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${Ie?"active":""}`,onClick:()=>{Re(""),He(""),Ae(e=>!e),Ie||(B(""),re("pending")),Tn()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!Q&&!Ie&&!me&&!_e?"active":""}`,onClick:()=>{Re(""),He(""),Ae(!1),De(!1),Ve(!1),re(""),Tn()}},"T\u1EA5t c\u1EA3"),ia.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${Q===e.value&&!Ie?"active":""}`,onClick:()=>{Re(""),He(""),Ae(!1),De(!1),Ve(!1),re(e.value),e.value==="draft"&&B(""),Tn()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,an.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>da(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const n=Ia(e);return n.length?React.createElement("div",{className:"d-grid gap-1"},n.map((t,a)=>React.createElement("div",{key:a,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},a+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",jt(t.unitPrice))))):sa(e)})()),React.createElement("td",null,Ts(e)),React.createElement("td",{className:"fw-semibold"},jt(ha(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${ta(e.status)}`},Mn(e.status)),va(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Dn} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(e),"d"),wa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Hn} ng\xE0y`},"\u23F3 C\xF2n ",Na(e),"d"))),React.createElement("td",null,na(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:n=>{n.stopPropagation(),Ra(e)},disabled:A||!!H||ve===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:n=>n.stopPropagation(),onChange:n=>{n.stopPropagation();const t=String(n.target.value||"").trim();n.target.value="",t&&Jn(e,t)},disabled:A||!!H||ve===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!rt&&Oe&&!Ie&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Zs,disabled:ze||Se},Se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:kt,title:(()=>{const e=Me,n=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Mn(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${n} ${t}`.trim()})(),subtitle:(()=>{const e=Me,n=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),a=e!=null&&e.created_at?na(e.created_at):"";return[n||t||null,a||null].filter(Boolean).join(" \u2022 ")})(),onClose:er,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},hn?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{gn(!1),on(null),Vn(""),N(!1),We([])},disabled:A||ue},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!ft&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:xs,disabled:A||ue,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},ue?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>Da({mode:"close",origin:"drawer"}),disabled:A||ue||!It.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},A?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Me&&Ra(Me),disabled:!Me||en||A||!!H},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>Me&&za(Me),disabled:!Me||en||A||!!H},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const n=String(e.target.value||"").trim();e.target.value="",n&&Me&&Jn(Me,n)},disabled:!Me||en||A||!!H||ve===(Me==null?void 0:Me.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},hn?React.createElement("form",{onSubmit:e=>{e.preventDefault(),Da({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),lr())):en?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):dn?React.createElement("div",{className:"alert alert-danger",role:"alert"},dn):Me?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${ta(Me.status)}`},Mn(Me.status)),va(Me)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Dn} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(Me),"d"),wa(Me)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Hn} ng\xE0y`},"\u23F3 C\xF2n ",Na(Me),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},jt(ha(Me))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},Ts(Me)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},na(Me.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Me.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},Me.phone||"\u2014"),!!String(Me.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(Me.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},Me.address||"\u2014")),((Me==null?void 0:Me.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(Me.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=Ia(Me);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((n,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),n.name),n.variant?React.createElement("div",{className:"text-muted small"},n.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${jt(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sa(Me)||"\u2014")})(),(ma(Me)!==0||Gn(Me))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},jt(ma(Me))),Gn(Me)?React.createElement("span",{className:"text-muted"}," ","(",Gn(Me),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Ye&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),ft?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Xa})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Da({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Zt},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:f.customer_name,onChange:e=>Ne({...f,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!It.nameError&&React.createElement("div",{className:"form-text text-danger"},It.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:f.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!It.phoneError&&React.createElement("div",{className:"form-text text-danger"},It.phoneError),!It.phoneError&&wn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",wn.count," \u0111\u01A1n trong th\xE1ng ",wn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>N(e=>!e)},T?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),T&&wn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>N(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},wn.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ta(e.status)}`},Mn(e.status))),React.createElement("div",{className:"text-muted small"},na(e.created_at)," \u2022 ",jt(ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&za(e)}},"M\u1EDF")))),wn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(v==null?void 0:v.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(v==null?void 0:v.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(v==null?void 0:v.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(v==null?void 0:v.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:f.status,onChange:e=>Ne({...f,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:f.address,onChange:e=>Ne({...f,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!It.addressWarn&&React.createElement("div",{className:"form-text text-warning"},It.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:f.note,onChange:e=>Ne({...f,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Ne(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Kn(f.adjustment_items).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const a=t.target.value;Ne(r=>{const o=Kn(r.adjustment_items);return o[n]={...o[n],amount:a},{...r,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const a=t.target.value;Ne(r=>{const o=Kn(r.adjustment_items);return o[n]={...o[n],note:a},{...r,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{Ne(t=>{const a=Kn(t.adjustment_items);return a.splice(n,1),{...t,adjustment_items:a.length?a:[{amount:"",note:""}]}})},disabled:A||Kn(f.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!It.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},It.adjustmentAbnormalWarn),!!It.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},It.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{Ne(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),$t(e=>[...Array.isArray(e)?e:[],""]),ft&&We(e=>[...Array.isArray(e)?e:[],!0])},disabled:A},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(f.items)?f.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Qt.current[n]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{qt(t=>t===n?null:n),setTimeout(()=>{const t=document.getElementById(`order-product-search-${n}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Et===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:Ct[n]||"",onChange:t=>{const a=t.target.value;$t(r=>{const o=Array.isArray(r)?[...r]:[];return o[n]=a,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(n);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(a.id),o=Bn(a==null?void 0:a.variants),b={};for(const y of o){const m=String((y==null?void 0:y.name)||"").trim(),w=Array.isArray(y==null?void 0:y.options)?y.options[0]:null,O=String((w==null?void 0:w.label)||"").trim();m&&O&&(b[m]=O)}const p=$a(b),K=aa(a,b);Ne(y=>{const m=Array.isArray(y.items)?[...y.items]:[];return m[n]={...m[n]||{quantity:1},product_id:r,variant_json:Object.keys(b).length?b:null,variant:p,unit_price:o.length?K:null},{...y,items:m}}),qt(null)}},a.name,a.code?` (${a.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Ht.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var a;const t=(a=It.items)==null?void 0:a[n];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Cn(e.product_id),a=Bn(t==null?void 0:t.variants);if(!a.length)return null;const r=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},a.map((o,b)=>{const p=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${b+1}`).trim(),K=String((r==null?void 0:r[p])||"").trim();return React.createElement("div",{key:p},React.createElement("label",{className:"form-label small text-muted mb-1"},p),React.createElement("select",{className:"form-select",value:K,onChange:y=>{const m=String(y.target.value||"").trim();Ne(w=>{const O=Array.isArray(w.items)?[...w.items]:[],pe={...O[n]||{}},he=Cn(pe.product_id),pt=Bn(he==null?void 0:he.variants),lt=pe!=null&&pe.variant_json&&typeof pe.variant_json=="object"?{...pe.variant_json}:{};m?lt[p]=m:delete lt[p];const tn=$a(lt),At=aa(he,lt);return O[n]={...pe,variant_json:Object.keys(lt).length?lt:null,variant:tn,unit_price:At},{...w,items:O}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",p," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(y=>React.createElement("option",{key:y.label,value:y.label},y.label,Number.isFinite(Number(y==null?void 0:y.price))?` (${jt(Number(y.price))})`:Number(y==null?void 0:y.price_delta)?` (${y.price_delta>0?"+":""}${y.price_delta})`:""))))}))})(),ft&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!de[n],onChange:t=>{const a=!!t.target.checked;We(r=>{const o=Array.isArray(r)?[...r]:[],b=Array.isArray(f.items)?f.items.length:0;for(;o.length<b;)o.push(!0);return o[n]=a,o})},disabled:A||ue}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const a=t.target.value;Ne(r=>{const o=Array.isArray(r.items)?[...r.items]:[];return o[n]={...o[n]||{product_id:""},quantity:a},{...r,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var a;const t=(a=It.items)==null?void 0:a[n];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{Ne(t=>{const a=Array.isArray(t.items)?[...t.items]:[];return a.splice(n,1),{...t,items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),$t(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a.length?a:[""]}),We(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a}),qt(t=>t==null?t:t===n?null:t>n?t-1:t)},disabled:A||ue||(Array.isArray(f.items)?f.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(f.items)?f.items:[]).filter(p=>p==null?void 0:p.product_id),t=pa(n),a=ua(n),r=ja(f),o=r.amount,b=t+(a.found?a.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},jt(t))),a.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},jt(a.fee))),!!It.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},It.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},jt(o))),(f.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(f.note||"").trim()),!!r.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",r.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},jt(b)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Xa,disabled:A||ue,style:{borderRadius:10}},"H\u1EE7y"),!!ft&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:xs,disabled:A||ue,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},ue?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!ft&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Da({mode:"new",origin:"modal"}),disabled:A||!It.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:A||ue||!It.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},A?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

