const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:N,error:d}){const[$,O]=useState(""),[M,l]=useState(""),[v,w]=useState(!1),[E,b]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),d&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),d),React.createElement("form",{onSubmit:async H=>{H.preventDefault(),w(!0),await N($,M),w(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:$,onChange:H=>O(H.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:E?"text":"password",className:"form-control",value:M,onChange:H=>l(H.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>b(!E)},React.createElement("i",{className:`fas fa-eye${E?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:N,type:d,onClose:$}){return useEffect(()=>{const O=setTimeout($,3e3);return()=>clearTimeout(O)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${d} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},N),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:$})))}function Loading({show:N}){return N?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:N,onMenuChange:d,onLogout:$,currentUser:O}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(l=>React.createElement("a",{key:l.id,href:"#",className:`nav-link ${N===l.id?"active":""} ${l.disabled?"opacity-50":""} ${l.highlight?"text-warning":""}`,onClick:v=>{v.preventDefault(),l.disabled||d(l.id)}},React.createElement("i",{className:`fas ${l.icon}`})," ",l.label,l.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),l.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),$&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:$,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:N,onSelect:d,onCreate:$,onEdit:O,onDelete:M,loading:l,currentFolder:v,onBack:w,breadcrumb:E}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},v&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:w},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),v?v.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:$},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),E&&E.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),w("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),E.map((b,J)=>React.createElement("li",{key:b.id,className:`breadcrumb-item ${J===E.length-1?"active":""}`},J===E.length-1?b.title:React.createElement("a",{href:"#",onClick:H=>{H.preventDefault(),w(b)},className:"text-warning"},b.title))))),l?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):N.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},v?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},N.map(b=>React.createElement("div",{key:b.uuid||b.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>d(b)},b.cover?React.createElement("img",{src:b.cover,className:"album-cover",alt:b.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},b.title),React.createElement("small",{className:"text-muted"},b.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),b.subfolderCount),b.subfolderCount>0&&b.count>0&&" \u2022 ",b.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),b.count),b.subfolderCount===0&&b.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:J=>{J.stopPropagation(),O(b)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:J=>{J.stopPropagation(),M(b)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:N,album:d,onClose:$,onSave:O,parentId:M}){const[l,v]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[w,E]=useState(!1),[b,J]=useState(!1),H=useRef(null);useEffect(()=>{v(d?{slug:d.id||"",title:d.title||"",description:d.description||"",cover_url:d.cover||"",parent_id:d.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:M||null})},[d,N,M]);const I=async j=>{j.preventDefault(),E(!0),await O(l),E(!1)},D=j=>j.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),z=async j=>{const Q=j.type==="image/heic"||j.type==="image/heif"||/\.heic$/i.test(j.name);if(j.size<=2097152&&!Q)return j;try{const c=await createImageBitmap(j),B=document.createElement("canvas");let f=c.width,U=c.height;const ie=800;return(f>ie||U>ie)&&(f>U?(U=Math.round(U/f*ie),f=ie):(f=Math.round(f/U*ie),U=ie)),B.width=f,B.height=U,B.getContext("2d").drawImage(c,0,0,f,U),c.close(),new Promise((he,G)=>{B.toBlob(ue=>{ue?he(new File([ue],j.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):G(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(c){throw console.error("Compress cover error:",c),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Y=async j=>{var c;const ae=j.target.files[0];if(!ae)return;if(!(ae.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ae.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}J(!0);try{const B=await z(ae),f=await window.KTM.cloudinary.uploadImage({file:B,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!f.secure_url)throw console.error("Cloudinary error:",f),new Error(((c=f.error)==null?void 0:c.message)||"Upload failed");v(U=>({...U,cover_url:f.secure_url}))}catch(B){console.error("Cover upload error:",B),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+B.message)}J(!1),j.target.value=""};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},d?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:I},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:l.title,onChange:j=>v({...l,title:j.target.value,slug:l.slug||D(j.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:l.slug,onChange:j=>v({...l,slug:j.target.value}),required:!0,disabled:!!d}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:l.description,onChange:j=>v({...l,description:j.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},l.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:l.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>v(j=>({...j,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:H,type:"file",accept:"image/*",className:"d-none",onChange:Y}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var j;return(j=H.current)==null?void 0:j.click()},disabled:b},b?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:l.cover_url,onChange:j=>v({...l,cover_url:j.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:w||b},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:N,allAlbums:d,currentAlbumId:$,targetAlbum:O,onSelect:M,level:l=0}){const[v,w]=useState(!0),E=N.uuid||N.id,b=E===$,J=O===E,H=d.filter(D=>D.parentId===E),I=H.length>0;return React.createElement("div",{style:{marginLeft:l*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${J?"bg-info text-white":b?"bg-light text-muted":"hover-bg"}`,style:{cursor:b?"not-allowed":"pointer",opacity:b?.5:1,transition:"background 0.2s"},onClick:()=>!b&&M(E)},I&&React.createElement("i",{className:`fas fa-chevron-${v?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:D=>{D.stopPropagation(),w(!v)}}),!I&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${J?"-open":""} me-2 ${J?"":"text-warning"}`}),React.createElement("span",{className:"small"},N.title),b&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),N.count>0&&!b&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},N.count)),v&&I&&React.createElement("div",null,H.map(D=>React.createElement(FolderTreeItem,{key:D.uuid||D.id,folder:D,allAlbums:d,currentAlbumId:$,targetAlbum:O,onSelect:M,level:l+1}))))}function AlbumDetail({album:N,onBack:d,onRefresh:$,showToast:O,onNavigateToFolder:M,onEditSubfolder:l,parentAlbum:v}){const[w,E]=useState([]),[b,J]=useState([]),[H,I]=useState(!0),[D,z]=useState(!1),[Y,j]=useState(""),[ae,Q]=useState([]),[c,B]=useState([]),[f,U]=useState({}),[ie,x]=useState(null),[he,G]=useState(!1),[ue,oe]=useState(""),[de,re]=useState(!1),me=useRef(null),te=useRef(null),[ge,Se]=useState(!1),[le,xe]=useState([]),[Oe,Ne]=useState([]),[$e,We]=useState(""),[t,i]=useState(!1),k=async(o,_=2)=>{const ee=_*1024*1024,ke=o.type==="image/heic"||o.type==="image/heif"||/\.heic$/i.test(o.name);if(o.size<=ee&&!ke)return o;try{const ye=await createImageBitmap(o),ve=document.createElement("canvas");let Me=ye.width,Ie=ye.height;const Ee=1200;return(Me>Ee||Ie>Ee)&&(Me>Ie?(Ie=Math.round(Ie/Me*Ee),Me=Ee):(Me=Math.round(Me/Ie*Ee),Ie=Ee)),ve.width=Me,ve.height=Ie,ve.getContext("2d").drawImage(ye,0,0,Me,Ie),ye.close(),new Promise((Be,Pe)=>{ve.toBlob(F=>{F?Be(new File([F],o.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Pe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ye){throw console.error("Compress error:",ye),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{Z(),Ce()},[N.id,N.uuid]);const Z=async()=>{I(!0);try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");E(o.images||[]);const _=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${N.uuid||N.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");J(Array.isArray(_)?_:[])}catch(o){console.error(o),O("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}I(!1)},Ce=async()=>{try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");Ne(Array.isArray(o)?o:[])}catch(o){console.error("Error loading albums:",o)}},Ke=o=>{xe(_=>_.includes(o)?_.filter(ee=>ee!==o):[..._,o])},ce=async()=>{if(!$e||le.length===0){O("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}i(!0);let o=0;for(const _ of le)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${_}`,{album_id:$e},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),o++}catch(ee){console.error("Move error:",ee)}i(!1),Se(!1),xe([]),We(""),o>0?(O("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),Z(),$()):O("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Ve,Re]=useState(!1),q=async()=>{if(le.length===0||!confirm(`X\xF3a ${le.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Re(!0);let o=0;for(const _ of le)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${_}`,"L\u1ED7i x\xF3a \u1EA3nh"),o++}catch(ee){console.error("Delete error:",ee)}Re(!1),xe([]),o>0?(O(`\u0110\xE3 x\xF3a ${o} \u1EA3nh!`,"success"),Z(),$()):O("X\xF3a th\u1EA5t b\u1EA1i","danger")},fe=()=>{le.length===w.length?xe([]):xe(w.map(o=>o.id))},qe=async()=>{if(ue.trim()){re(!0);try{const o=ue.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:o+"-"+Date.now(),title:ue,parent_id:N.uuid||N.id},"L\u1ED7i t\u1EA1o folder"),O("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),oe(""),G(!1),Z(),$()}catch(o){O(o.message,"danger")}re(!1)}},ne=async o=>{if(confirm(`X\xF3a folder "${o.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${o.uuid||o.id}`,"L\u1ED7i x\xF3a folder"),O("\u0110\xE3 x\xF3a folder","success"),Z(),$()}catch(_){O("L\u1ED7i x\xF3a folder","danger")}},y=o=>{const _=Array.from(o).filter(ee=>ee.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ee.name));Q(ee=>[...ee,..._]),_.forEach(ee=>{const ke=new FileReader;ke.onload=ye=>{B(ve=>[...ve,{file:ee,preview:ye.target.result}])},ke.readAsDataURL(ee)})},Qe=o=>{Q(_=>_.filter((ee,ke)=>ke!==o)),B(_=>_.filter((ee,ke)=>ke!==o))},He=async o=>{var ee;const _=await window.KTM.cloudinary.uploadImage({file:o,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${N.id}`});if(!_.secure_url)throw console.error("Cloudinary error:",_),new Error(((ee=_.error)==null?void 0:ee.message)||"Upload failed");return _},Xe=async()=>{if(ae.length===0)return;z(!0);let o=0;for(let _=0;_<ae.length;_++)try{j(`\u0110ang x\u1EED l\xFD ${_+1}/${ae.length}...`);const ee=await k(ae[_],2);j(`\u0110ang upload ${_+1}/${ae.length}...`);const ke=await He(ee);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${N.id}`,{url:ke.secure_url,caption:f[_]||ae[_].name.replace(/\.[^/.]+$/,""),sort_order:w.length+_},"L\u1ED7i l\u01B0u \u1EA3nh"),o++}catch(ee){console.error("Upload error:",ee)}z(!1),j(""),Q([]),B([]),U({}),o>0?(O(`\u0110\xE3 upload ${o} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),Z(),$()):O("Upload th\u1EA5t b\u1EA1i","danger")},Je=async(o,_)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${o}`,"L\u1ED7i x\xF3a \u1EA3nh"),O("\u0110\xE3 x\xF3a \u1EA3nh","success"),Z(),$()}catch(ee){O("L\u1ED7i x\xF3a \u1EA3nh","danger")}},De=o=>{var _;o.preventDefault(),(_=te.current)==null||_.classList.add("dragover")},Te=()=>{var o;(o=te.current)==null||o.classList.remove("dragover")},ze=o=>{var _;o.preventDefault(),(_=te.current)==null||_.classList.remove("dragover"),y(o.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:d},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},N.title),React.createElement("small",{className:"text-muted"},b.length>0&&React.createElement("span",null,b.length," folder \u2022 "),w.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>G(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),he&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:ue,onChange:o=>oe(o.target.value),onKeyPress:o=>o.key==="Enter"&&qe(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:qe,disabled:de||!ue.trim()},de?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{G(!1),oe("")}},"H\u1EE7y")))),b.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},b.map(o=>React.createElement("div",{key:o.uuid||o.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>M&&M(o)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},o.title),React.createElement("small",{className:"text-muted"},o.subfolderCount>0&&React.createElement("span",null,o.subfolderCount," folder"),o.subfolderCount>0&&o.count>0&&" \u2022 ",o.count>0&&React.createElement("span",null,o.count," \u1EA3nh"),o.subfolderCount===0&&o.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:_=>{_.stopPropagation(),l&&l(o)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:_=>{_.stopPropagation(),ne(o)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:te,className:"upload-zone",onClick:()=>{var o;return(o=me.current)==null?void 0:o.click()},onDragOver:De,onDragLeave:Te,onDrop:ze},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:me,type:"file",multiple:!0,accept:"image/*",onChange:o=>y(o.target.files)})),c.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},c.map((o,_)=>React.createElement("div",{key:_,className:"upload-preview-item"},React.createElement("img",{src:o.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Qe(_)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Xe,disabled:D},D?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Y||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",ae.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",w.length,")"),w.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:fe},le.length===w.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),le.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},le.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>Se(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:q,disabled:Ve},Ve?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>xe([])},React.createElement("i",{className:"fas fa-times"})))),H?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):w.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},w.map((o,_)=>React.createElement("div",{key:_,className:`image-item ${le.includes(o.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Ke(o.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:le.includes(o.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:le.includes(o.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},le.includes(o.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:o.src,alt:o.caption,style:{opacity:le.includes(o.id)?.7:1,border:le.includes(o.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:ee=>{ee.stopPropagation(),Je(o.id,_)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),o.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},o.caption)))))),ge&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",le.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>Se(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},Oe.filter(o=>!o.parentId).map(o=>React.createElement(FolderTreeItem,{key:o.uuid||o.id,folder:o,allAlbums:Oe,currentAlbumId:N.uuid||N.id,targetAlbum:$e,onSelect:We})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>Se(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ce,disabled:!$e||t},t?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),ie&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>x(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>x(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:ie.src,alt:ie.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:o=>o.stopPropagation()}),ie.caption&&React.createElement("div",{className:"text-white text-center mt-2"},ie.caption)))))}function SearchCenter({showToast:N,onNavigate:d}){const[$,O]=useState(""),[M,l]=useState([]),[v,w]=useState([]),[E,b]=useState([]),[J,H]=useState("all"),[I,D]=useState(null),[z,Y]=useState("list"),[j,ae]=useState(!0),[Q,c]=useState([]),[B,f]=useState([]),U=useRef(null),[ie,x]=useState(!0),[he,G]=useState(!1),ue=useRef(null),[oe,de]=useState(!1),[re,me]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[te,ge]=useState(""),[Se,le]=useState(!1),xe=useRef(null),Oe=useRef(null),[Ne,$e]=useState(null),[We,t]=useState(!1),[i,k]=useState(null),[Z,Ce]=useState(!1),[Ke,ce]=useState(!1),[Ve,Re]=useState(null),[q,fe]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),qe=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ne=a=>{a._type==="product"&&(k(a),fe({name:a.name||"",code:a.code||"",price:a.price||"",image:a.image||"",category:a.category||"",note:a.note||""}),t(!0))},y=async()=>{if(i)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${i.id}`,q,"L\u1ED7i c\u1EADp nh\u1EADt"),N("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),t(!1),k(null),De()}catch(a){N(a.message,"danger")}},Qe=async a=>{const p=a._type==="product"?"s\u1EA3n ph\u1EA9m":a._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${p} "${a.name}"?`))try{let m="";a._type==="product"?m=`${API_BASE}/api/products?id=${a.id}`:a._type==="album"?m=`${API_BASE}/api/images/${a.id}`:a._type==="video"&&(m=`${API_BASE}/api/videos/${a.id}`),await window.KTM.api.deleteJSON(m,"L\u1ED7i x\xF3a"),N(`\u0110\xE3 x\xF3a ${p}`,"success"),De()}catch(m){N(m.message,"danger")}},He=async a=>{try{const p=Ve?`${API_BASE}/api/products?id=${Ve.id}`:`${API_BASE}/api/products`;Ve?await window.KTM.api.putJSON(p,a,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(p,a,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(Ve?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ce(!1),Re(null),De()}catch(p){N(p.message,"danger")}},Xe="ktm_admin_data_cache_v1",Je=1e3*60*10,De=async()=>{let a=null,p=!1;const m=window.KTM.cache.read(Xe,{ttlMs:Je,validate:Array.isArray});m.hit?(a=m.value,console.log("[CACHE] Using cache, items:",a.length),w(a),l(a),ae(!1),p=!0):m.status==="miss"?console.log("[CACHE] No cache found"):m.status==="expired"||m.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):m.status==="error"&&console.error("[CACHE] Error parsing cache"),p||ae(!0);try{const S=async(n,s)=>{try{const r=await window.KTM.api.getJSON(n,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return r!=null?r:s}catch(r){return s}},[T,h,u]=await Promise.all([S(`${API_BASE}/api/products`,[]),S(`${API_BASE}/api/albums`,[]),S(`${API_BASE}/api/video-folders?withVideos=true`,[])]),g=Array.isArray(T)?T.map(n=>({...n,_type:"product",_source:"database"})):[];c(h);let P=[];Array.isArray(h)&&h.length>0&&(await Promise.all(h.map(s=>S(`${API_BASE}/api/albums/${s.id}`,{})))).forEach((s,r)=>{const C=h[r];s.images&&s.images.length>0&&s.images.forEach(K=>{P.push({id:K.id,name:K.caption||"\u1EA2nh t\u1EEB "+C.title,image:K.src,folder:C.title,_type:"album",_source:"database"})})}),f(u);let W=[];Array.isArray(u)&&u.forEach(n=>{n.videos&&n.videos.forEach(s=>{W.push({id:s.id,name:s.title,folder:n.name,image:s.thumb,youtubeId:s.youtubeId,url:s.url,_type:"video",_source:"database"})})});const R=[...g,...P,...W];(!a||JSON.stringify(R)!==JSON.stringify(a))&&(w(R),l(R),window.KTM.cache.write(Xe,R))}catch(S){console.error("Song song fetch error:",S)}ae(!1)};useEffect(()=>{De(),setTimeout(()=>{var a;return(a=U.current)==null?void 0:a.focus()},100)},[]);const Te=a=>{try{return String(a!=null?a:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(p){return String(a!=null?a:"").toLowerCase()}},ze=a=>{const m=Te(a).trim().split(/\s+/).filter(Boolean),S=m.includes("anh"),T=m.includes("video"),h=m.filter(P=>P!=="anh"&&P!=="video"),u=h.join(" "),g=new Set(["product"]);return S&&g.add("album"),T&&g.add("video"),{allowedTypes:g,includeAlbum:S,includeVideo:T,contentTokens:h,cleanedQuery:u}},o=(a,p,m)=>{var n,s,r,C,K;const S=Array.isArray(p)?p:[],T=Te(m).trim();if(!S.length&&!T)return 0;const h=Te((n=a==null?void 0:a.name)!=null?n:""),u=Te((s=a==null?void 0:a.code)!=null?s:""),g=Te((r=a==null?void 0:a.category)!=null?r:""),P=Te((C=a==null?void 0:a.note)!=null?C:""),W=Te((K=a==null?void 0:a.folder)!=null?K:"");if(!`${h} ${u} ${g} ${P} ${W}`.trim())return 0;let e=0;T&&(h===T&&(e+=220),h.includes(T)&&(e+=140),h.startsWith(T)&&(e+=160),u&&u===T&&(e+=180),u&&u.includes(T)&&(e+=90));for(const se of S){if(!se)continue;const V=new RegExp(`(?:^|\\s)${se.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);h.includes(se)&&(e+=35),V.test(h)&&(e+=25),u&&u.includes(se)&&(e+=20),u&&V.test(u)&&(e+=10),g&&g.includes(se)&&(e+=12),W&&W.includes(se)&&(e+=12),P&&P.includes(se)&&(e+=6)}return e>0&&h&&(e+=Math.max(0,10-Math.min(10,Math.floor(h.length/10)))),e},_=(a,p,m)=>{const S=Array.isArray(a)?a:[];return S.length?S.map((h,u)=>({it:h,idx:u,score:o(h,p,m)})).sort((h,u)=>u.score!==h.score?u.score-h.score:h.idx-u.idx).map(h=>h.it):[]},ee=async(a,p)=>{if(!(!ie||p.length===0)){G(!0);try{const m=p.map(T=>({id:T.id,name:T.name,price:T.price,category:T.category,note:T.note,folder:T.folder,_type:T._type})),S=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:a,products:m},"AI Search error");if(S&&S.matchedIds&&S.matchedIds.length>0){const{contentTokens:T,cleanedQuery:h}=ze(a),u=new Set(S.matchedIds),g=p.filter(P=>u.has(P.id)).sort((P,W)=>o(W,T,h)-o(P,T,h));g.length>0&&l(g)}else S&&S.matchedIds&&S.matchedIds.length===0&&l([])}catch(m){console.error("AI Search error:",m)}G(!1)}},ke=a=>{if(O(a),ue.current&&clearTimeout(ue.current),!a.trim()){ye(J);return}const{allowedTypes:p,contentTokens:m,cleanedQuery:S}=ze(a),T=v.filter(u=>{if(!p.has(u==null?void 0:u._type))return!1;if(m.length===0)return!0;const g=Te(Object.entries(u).filter(([P])=>!P.startsWith("_")).map(([,P])=>String(P||"")).join(" "));return m.some(P=>g.includes(P))});let h=T;J!=="all"&&(h=T.filter(u=>(u.category||u._type)===J)),l(_(h,m,S)),ie&&S.length>=3&&(ue.current=setTimeout(()=>{ee(S,h)},500))},ye=a=>{H(a);const{allowedTypes:p,contentTokens:m}=ze($),{cleanedQuery:S}=ze($);let T=v.filter(h=>p.has(h==null?void 0:h._type));a!=="all"&&(T=T.filter(h=>(h.category||h._type)===a)),$.trim()&&m.length>0&&(T=T.filter(h=>{const u=Te(Object.entries(h).filter(([g])=>!g.startsWith("_")).map(([,g])=>String(g||"")).join(" "));return m.every(g=>u.includes(g))})),l(_(T,m,S))},ve=(a,p)=>{window.KTM.clipboard.writeText(a).then(()=>{D(p),N("\u0110\xE3 copy!","success"),setTimeout(()=>D(null),1500)})},Me=async(a,p)=>{try{await window.KTM.clipboard.writeImageFromUrl(a),D(p+"-img"),N("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>D(null),1500)}catch(m){ve(a,p+"-img")}},Ie=a=>{let p=a.toLowerCase();const m=[],S=v.filter(u=>u._type==="product");if(p.includes("ty")||p.includes("xy lanh")){if(p.includes("gi\u1EEFa")||p.includes("giua")){const u=S.find(g=>{var P;return(P=g.name)==null?void 0:P.toLowerCase().includes("xy lanh gi\u1EEFa")});u&&!m.find(g=>g.id===u.id)&&m.push(u)}if(p.includes("nghi\xEAng")||p.includes("nghieng")){const u=S.find(g=>{var P;return(P=g.name)==null?void 0:P.toLowerCase().includes("xy lanh nghi\xEAng")});u&&!m.find(g=>g.id===u.id)&&m.push(u)}if(p.includes("\u1EE7i")||p.includes("ui")){const u=S.find(g=>{var P;return(P=g.name)==null?void 0:P.toLowerCase().includes("xy lanh \u1EE7i")});u&&!m.find(g=>g.id===u.id)&&m.push(u)}}const T=p.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(T){const u=T[1],g=T[2],P=S.find(W=>{var e;const R=((e=W.name)==null?void 0:e.toLowerCase())||"";return R.includes("combo")&&R.includes(`${u} tay`)&&(R.includes(`${g} xy`)||R.includes(`${g} xylanh`))});if(P&&!m.find(W=>W.id===P.id))m.push(P);else{const W=S.find(R=>{var n;const e=((n=R.name)==null?void 0:n.toLowerCase())||"";return e.includes("combo")&&e.includes(`${u} tay`)});W&&!m.find(R=>R.id===W.id)&&m.push(W)}}if(p.includes("combo")&&!T){const u=p.match(/combo.*?(\d+)\s*tay/);if(u){const g=u[1];S.filter(W=>{var e;const R=((e=W.name)==null?void 0:e.toLowerCase())||"";return R.includes("combo")&&R.includes(`${g} tay`)}).forEach(W=>{m.find(R=>R.id===W.id)||m.push(W)})}}const h=p.match(/van\s*(\d+)\s*tay/);if(h&&!p.includes("ty")&&!p.includes("combo")){const u=h[1],g=S.find(P=>{var R;const W=((R=P.name)==null?void 0:R.toLowerCase())||"";return W.includes(`van ${u} tay`)&&!W.includes("combo")});g&&!m.find(P=>P.id===g.id)&&m.push(g)}return m.slice(0,4)},Ee=async a=>{if(!a.trim())return;const p={role:"user",content:a,attachments:[]};me(S=>[...S,p]),ge(""),le(!0);const m=Ie(a);setTimeout(()=>{var S;return(S=xe.current)==null?void 0:S.scrollIntoView({behavior:"smooth"})},100);try{const T=v.filter(R=>R._type==="product").map(R=>{let e=`- ${R.name}`;return R.code&&(e+=` (M\xE3: ${R.code})`),R.price&&(e+=` - Gi\xE1: ${R.price.replace(/[đ\s]/g,"")}\u0111`),R.category&&(e+=` [${R.category}]`),R.note&&(e+=` (${R.note})`),e}).join(`
`),u=re.slice(-6).map(R=>`${R.role==="user"?"Kh\xE1ch":"AI"}: ${R.content}`).join(`
`),g=u?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${u}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${T}`:T,W=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:a,context:g,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";me(R=>[...R,{role:"assistant",content:W,attachments:m}])}catch(S){console.error("AI Error:",S);const T=a.toLowerCase(),h=v.filter(g=>{const P=Object.values(g).join(" ").toLowerCase();return T.split(" ").some(W=>P.includes(W))});let u="";h.length>0?(u=`T\xECm th\u1EA5y ${h.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,h.slice(0,5).forEach(g=>{u+=`\u2022 ${g.name}`,g.price&&(u+=` - ${g.price.replace(/[đ\s]/g,"")}\u0111`),g.note&&(u+=` (${g.note})`),u+=`
`}),h.length>5&&(u+=`
...v\xE0 ${h.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):u='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',me(g=>[...g,{role:"assistant",content:u,attachments:h.slice(0,4)}])}le(!1),setTimeout(()=>{var S,T;(S=xe.current)==null||S.scrollIntoView({behavior:"smooth"}),(T=Oe.current)==null||T.focus()},100)};function Ye({show:a,product:p,categories:m,onClose:S,onSave:T}){const[h,u]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[g,P]=useState(!1),[W,R]=useState(!1),e=useRef(null),n=A=>window.KTM.money.formatVNDInputDigits(A);useEffect(()=>{if(p)if(u({name:p.name||"",code:p.code||"",price:p.price||"",image:p.image||"",category:p.category||"",note:p.note||"",sort_order:p.sort_order||0}),p.price){const A=window.KTM.money.getDigits(p.price);K(A),u(pe=>({...pe,price:n(A)}))}else K("");else u({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),K("")},[p,a]);const[s,r]=React.useState(""),[C,K]=React.useState(""),se=A=>{const pe=window.KTM.money.nextPriceInputState(A.target.value,C);K(pe.digits),u({...h,price:pe.price})},V=async(A,pe=2)=>{const be=pe*1024*1024;if(A.size<=be)return A;try{const je=await createImageBitmap(A),Ae=document.createElement("canvas");let _e=je.width,Le=je.height;const Ue=1200;return(_e>Ue||Le>Ue)&&(_e>Le?(Le=Math.round(Le/_e*Ue),_e=Ue):(_e=Math.round(_e/Le*Ue),Le=Ue)),Ae.width=_e,Ae.height=Le,Ae.getContext("2d").drawImage(je,0,0,_e,Le),je.close(),new Promise((Ge,Ze)=>{Ae.toBlob(we=>{we?Ge(new File([we],A.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ze(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(je){throw console.error("Compress error:",je),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},L=async A=>{var je;const pe=A.target.files[0];if(!pe)return;if(!(pe.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(pe.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}R(!0);try{const Ae=await V(pe),_e=await window.KTM.cloudinary.uploadImage({file:Ae,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!_e.secure_url)throw console.error("Cloudinary error:",_e),new Error(((je=_e.error)==null?void 0:je.message)||"Upload failed");u(Le=>({...Le,image:_e.secure_url}))}catch(Ae){console.error("Upload error:",Ae),alert("L\u1ED7i upload \u1EA3nh: "+Ae.message)}R(!1),A.target.value=""},X=async A=>{A.preventDefault(),P(!0),await T(h),P(!1)};return a?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),p?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:S})),React.createElement("form",{onSubmit:X},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:h.name,onChange:A=>u({...h,name:A.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:h.code,onChange:A=>u({...h,code:A.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:h.price,onChange:se,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:h.category,onChange:A=>u({...h,category:A.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),m.map(A=>React.createElement("option",{key:A,value:A},A)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:h.note,onChange:A=>u({...h,note:A.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},h.image?React.createElement(React.Fragment,null,React.createElement("img",{src:h.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>u({...h,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var A;return(A=e.current)==null?void 0:A.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:e,type:"file",accept:"image/*",className:"d-none",onChange:L}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var A;return(A=e.current)==null?void 0:A.click()},disabled:W,style:{borderRadius:"10px"}},W?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:h.image,onChange:A=>u({...h,image:A.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:S,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:g,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},g?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Be=(a,p)=>{const m=a._type==="product",S=a._type==="album",T=a._type==="video",h=a.note&&(a.note.toLowerCase().includes("free")||a.note.toLowerCase().includes("gi\u1EA3m")||a.note.toLowerCase().includes("sale"));return z==="grid"?React.createElement("div",{key:a.id||p,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>$e({url:a.image,name:a.name,price:a.price,note:a.note,item:a})},a.image?React.createElement("img",{src:a.image,alt:a.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${T?"fa-video":"fa-image"} fa-2x text-muted`})),a.price&&React.createElement("div",{className:"price-overlay"},a.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${m?"product":S?"album":"video"}`},m?"SP":S?"\u1EA2nh":"Video"),h&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},a.name),a.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},a.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:I===a.id+"-img"?"copied":"",onClick:()=>Me(a.image,a.id)},React.createElement("i",{className:"fas fa-image"})),a.price&&React.createElement("button",{className:I===a.id+"-price"?"copied":"",onClick:()=>ve(a.price.replace(/[đ\s]/g,""),a.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:a.id||p,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${m?"product":S?"album":"video"}`},m?"S\u1EA3n ph\u1EA9m":S?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},a.image?React.createElement("img",{src:a.image,alt:a.name,className:"thumb",loading:"lazy",onClick:()=>$e({url:a.image,name:a.name,price:a.price,note:a.note,item:a})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${T?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},a.name),React.createElement("div",{className:"price-row"},a.price&&React.createElement("span",{className:"price"},a.price.replace(/[đ\s]/g,""),"\u0111"),h&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},a.code&&React.createElement("span",{className:"meta-tag"},"#",a.code),a.category&&React.createElement("span",{className:"meta-tag"},a.category),a.note&&React.createElement("span",{className:"meta-tag highlight"},a.note),a.folder&&React.createElement("span",{className:"meta-tag"},a.folder),T&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},m&&React.createElement("button",{onClick:()=>d&&d("orders","create",{productId:a.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),a.price&&React.createElement("button",{className:I===a.id+"-price"?"copied":"",onClick:()=>ve(a.price.replace(/[đ\s]/g,""),a.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:I===a.id+"-name"?"copied":"",onClick:()=>ve(a.name,a.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),T&&a.youtubeId&&React.createElement("button",{className:I===a.id+"-yt"?"copied":"",onClick:()=>ve(`https://www.youtube.com/watch?v=${a.youtubeId}`,a.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),m&&React.createElement("button",{className:"action-edit",onClick:()=>ne(a)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Qe(a)},React.createElement("i",{className:"fas fa-trash"}))))},[Pe,F]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,M.length)," k\u1EBFt qu\u1EA3",ie&&$.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),J!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},J==="product"?"S\u1EA3n ph\u1EA9m":J==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${z==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Y("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${z==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Y("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},j?React.createElement("div",null,[...Array(8)].map((a,p)=>React.createElement("div",{key:p,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):M.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',$,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{O(""),ke("")}},"Xem t\u1EA5t c\u1EA3")):z==="grid"?React.createElement("div",{className:"product-grid-mobile"},M.map((a,p)=>Be(a,p))):React.createElement("div",null,M.map((a,p)=>Be(a,p)))),Pe&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>F(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${J==="all"?"active":""}`,onClick:()=>{ye("all"),F(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${J==="product"?"active":""}`,onClick:()=>{ye("product"),F(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${J==="album"?"active":""}`,onClick:()=>{ye("album"),F(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${J==="video"?"active":""}`,onClick:()=>{ye("video"),F(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:ie,onChange:a=>x(a.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:U,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:$,onChange:a=>ke(a.target.value)}),React.createElement("button",{className:`filter-btn ${Pe||J!=="all"?"active":""}`,onClick:()=>F(!Pe)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:Z?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>de(!0),onTouchStart:()=>de(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),oe&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>de(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},re.map((a,p)=>React.createElement("div",{key:p,className:`mb-3 ${a.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${a.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:a.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},a.content,a.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:I===`chat-${p}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:I===`chat-${p}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(a.content),D(`chat-${p}`),setTimeout(()=>D(null),1500)}},React.createElement("i",{className:`fas ${I===`chat-${p}`?"fa-check":"fa-copy"}`})),a.attachments&&a.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},a.attachments.map((m,S)=>React.createElement("div",{key:S,style:{width:70},className:"text-center"},m.image&&React.createElement("img",{src:m.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>$e({url:m.image,name:m.name,price:m.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},m.name),m.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},m.price.replace(/[đ\s]/g,""),"\u0111"))))))),Se&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:xe})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(a=>React.createElement("button",{key:a,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Ee(a),disabled:Se,style:{whiteSpace:"nowrap"}},a))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:a=>{a.preventDefault(),Ee(te)},className:"chat-input-wrap"},React.createElement("input",{ref:Oe,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:te,onChange:a=>ge(a.target.value),disabled:Se}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Se||!te.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),Ne&&React.createElement("div",{className:"preview-modal",onClick:()=>$e(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>$e(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:a=>a.stopPropagation()},React.createElement("img",{src:Ne.url,alt:Ne.name})),React.createElement("div",{className:"preview-footer",onClick:a=>a.stopPropagation()},React.createElement("div",{className:"name"},Ne.name),Ne.price&&React.createElement("div",{className:"price"},Ne.price.replace(/[đ\s]/g,""),"\u0111"),Ne.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},Ne.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:I==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:I==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Me(Ne.url,"preview")},React.createElement("i",{className:`fas ${I==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),Ne.price&&React.createElement("button",{className:I==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>ve(Ne.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${I==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Ye,{show:Ke,product:Ve,categories:E,onClose:()=>{ce(!1),Re(null)},onSave:He}),React.createElement("div",{className:`fab-container mobile-only ${Z?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{Ce(!1),ce(!0),Re(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{Ce(!1),d&&d("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${Z?"open":""}`,onClick:()=>Ce(!Z)},React.createElement("i",{className:"fas fa-plus"}))),We&&i&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>t(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:q.name,onChange:a=>fe({...q,name:a.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:q.code,onChange:a=>fe({...q,code:a.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:q.price,onChange:a=>fe({...q,price:a.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:q.category,onChange:a=>fe({...q,category:a.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),qe.map(a=>React.createElement("option",{key:a,value:a},a)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:q.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:a=>fe({...q,note:a.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>t(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:y},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:N,showToast:d}){const[$,O]=useState([]),[M,l]=useState([]),[v,w]=useState(!0),[E,b]=useState(null),[J,H]=useState(!1),[I,D]=useState(null),[z,Y]=useState(!1),[j,ae]=useState(null),[Q,c]=useState(null),[B,f]=useState([]);useEffect(()=>{U()},[]);const U=async(t=null)=>{w(!0);try{const i=t?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${t}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,k=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");O(Array.isArray(k)?k:[])}catch(i){console.error(i),d("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}w(!1)},ie=async t=>{try{const i=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${t}`,"L\u1ED7i t\u1EA3i video");l(Array.isArray(i)?i:[])}catch(i){console.error(i)}},x=async t=>{if(t===0)return;const i=[...$];[i[t-1],i[t]]=[i[t],i[t-1]],O(i),await G(i)},he=async t=>{if(t===$.length-1)return;const i=[...$];[i[t],i[t+1]]=[i[t+1],i[t]],O(i),await G(i)},G=async t=>{try{await Promise.all(t.map((i,k)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${i.id}`,{sortOrder:k},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),d("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(i){d("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),U(Q==null?void 0:Q.id)}},ue=async t=>{if(t===0)return;const i=[...M];[i[t-1],i[t]]=[i[t],i[t-1]],l(i),await de(i)},oe=async t=>{if(t===M.length-1)return;const i=[...M];[i[t],i[t+1]]=[i[t+1],i[t]],l(i),await de(i)},de=async t=>{try{await Promise.all(t.map((i,k)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${i.id}`,{sort_order:k},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),d("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(i){d("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),ie(E.id)}},re=()=>{D(null),H(!0)},me=t=>{D(t),H(!0)},te=async t=>{try{!I&&Q&&(t.parent_id=Q.id);const i=I?`${API_BASE}/api/video-folders/${I.id}`:`${API_BASE}/api/video-folders`;I?await window.KTM.api.putJSON(i,t,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(i,t,"L\u1ED7i l\u01B0u folder"),d(I?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),H(!1),U(Q==null?void 0:Q.id)}catch(i){d(i.message,"danger")}},ge=async t=>{const i=t.subfolderCount>0?`X\xF3a folder "${t.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${t.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(i))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${t.id}`,"L\u1ED7i x\xF3a folder"),d("\u0110\xE3 x\xF3a folder","success"),b(null),U(Q==null?void 0:Q.id)}catch(k){d("L\u1ED7i x\xF3a folder","danger")}},Se=t=>{t.subfolderCount>0?(f(i=>[...i,t]),c(t),U(t.id)):(b(t),l(t.videos||[]))},le=t=>{if(t==="root")f([]),c(null),U(null);else if(t){const i=B.findIndex(k=>k.id===t.id);i>=0&&(f(B.slice(0,i+1)),c(t),U(t.id))}else{const i=[...B];i.pop();const k=i[i.length-1]||null;f(i),c(k),U(k==null?void 0:k.id)}},xe=()=>{ae(null),Y(!0)},Oe=t=>{ae(t),Y(!0)},Ne=async t=>{try{t.folder_id=E==null?void 0:E.id;const i=j?`${API_BASE}/api/videos/${j.id}`:`${API_BASE}/api/videos`;j?await window.KTM.api.putJSON(i,t,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(i,t,"L\u1ED7i l\u01B0u video"),d(j?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),Y(!1),U(),E&&ie(E.id)}catch(i){d(i.message,"danger")}},$e=async t=>{if(confirm(`X\xF3a video "${t.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${t.id}`,"L\u1ED7i x\xF3a video"),d("\u0110\xE3 x\xF3a video","success"),U(),E&&ie(E.id)}catch(i){d("L\u1ED7i x\xF3a video","danger")}},We=t=>{const i=`https://www.youtube.com/watch?v=${t.youtubeId}`;window.KTM.clipboard.writeText(i).then(()=>{d("\u0110\xE3 copy link!","success")}).catch(()=>{d("Kh\xF4ng th\u1EC3 copy link","danger")})};return E?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>b(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${E.slug==="shorts"?"text-danger":"text-warning"}`}),E.name)),React.createElement("button",{className:"btn btn-warning",onClick:xe},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),M.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},M.map((t,i)=>React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>ue(i),disabled:i===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},i+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>oe(i),disabled:i===M.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:t.thumb,className:"card-img-top",alt:t.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${t.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:t.title},t.title),React.createElement("small",{className:"text-muted"},t.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>We(t),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Oe(t),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>$e(t),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:z,video:j,onClose:()=>Y(!1),onSave:Ne})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},Q&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>le()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),Q?Q.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:re},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),B.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:t=>{t.preventDefault(),le("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),B.map((t,i)=>React.createElement("li",{key:t.id,className:`breadcrumb-item ${i===B.length-1?"active":""}`},i===B.length-1?t.name:React.createElement("a",{href:"#",onClick:k=>{k.preventDefault(),le(t)},className:"text-warning"},t.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),v?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):$.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},Q?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:re},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",Q?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},$.map((t,i)=>{var k,Z,Ce,Ke;return React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ce=>{ce.stopPropagation(),x(i)},disabled:i===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},i+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ce=>{ce.stopPropagation(),he(i)},disabled:i===$.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>Se(t),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${t.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},t.name),React.createElement("p",{className:"text-muted mb-0"},t.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),t.subfolderCount," folder"),t.subfolderCount>0&&(t.videoCount>0||((k=t.videos)==null?void 0:k.length)>0)&&" \u2022 ",(t.videoCount>0||((Z=t.videos)==null?void 0:Z.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),t.videoCount||((Ce=t.videos)==null?void 0:Ce.length)||0," videos"),t.subfolderCount===0&&!t.videoCount&&!((Ke=t.videos)!=null&&Ke.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ce=>{ce.stopPropagation(),me(t)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ce=>{ce.stopPropagation(),ge(t)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:J,folder:I,onClose:()=>H(!1),onSave:te}))}function VideoFolderModal({show:N,folder:d,onClose:$,onSave:O}){const[M,l]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[v,w]=useState(!1),[E,b]=useState(!1);useEffect(()=>{l(d?{name:d.name||"",description:d.description||"",sortOrder:d.sortOrder||0,coverImage:d.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[d,N]);const J=async I=>{const D=I.target.files[0];if(D){b(!0);try{const z=await window.KTM.cloudinary.uploadImage({file:D,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});z.secure_url&&l(Y=>({...Y,coverImage:z.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(z){console.error("Cloudinary upload error:",z),alert("L\u1ED7i upload \u1EA3nh: "+(z.message||z))}finally{b(!1)}}},H=async I=>{I.preventDefault(),w(!0),await O(M),w(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},d?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:H},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:M.name,onChange:I=>l({...M,name:I.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:M.description,onChange:I=>l({...M,description:I.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:M.sortOrder,onChange:I=>l({...M,sortOrder:parseInt(I.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},M.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:M.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>l({...M,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:J,disabled:E}),E&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:M.coverImage,onChange:I=>l({...M,coverImage:I.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:N}){const[d,$]=useState([]),[O,M]=useState(!0),[l,v]=useState(!1),[w,E]=useState(null),[b,J]=useState(""),[H,I]=useState(""),D=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{z()},[]);const z=async()=>{M(!0);try{const f=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");$(Array.isArray(f)?f:[])}catch(f){console.error(f),N("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}M(!1)},Y=()=>{E(null),v(!0)},j=f=>{E(f),v(!0)},ae=async f=>{if(!(!f||!f.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:f},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),N(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),z()}catch(U){N("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},Q=async f=>{try{const U=w?`${API_BASE}/api/products?id=${w.id}`:`${API_BASE}/api/products`;w?await window.KTM.api.putJSON(U,f,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(U,f,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),N(w?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),v(!1),z()}catch(U){N(U.message,"danger")}},c=async f=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${f.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${f.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),N("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),z()}catch(U){N(U.message,"danger")}},B=d.filter(f=>{const U=!b||f.name.toLowerCase().includes(b.toLowerCase())||f.code&&f.code.toLowerCase().includes(b.toLowerCase()),ie=!H||f.category===H;return U&&ie});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Y},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:b,onChange:f=>J(f.target.value)})),React.createElement("span",{className:"product-count"},B.length)),React.createElement("select",{className:"form-select",value:H,onChange:f=>I(f.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),D.map(f=>React.createElement("option",{key:f,value:f},f)))),O?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):B.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Y},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},B.map(f=>React.createElement("div",{key:f.id,className:"product-item d-flex align-items-center gap-3"},f.image?React.createElement("img",{src:f.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},f.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},f.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},f.category),f.code&&React.createElement("span",{className:"product-badge bg-secondary"},f.code)),React.createElement("div",{className:"product-price"},f.price?f.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),f.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},f.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>j(f),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>c(f),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:l,product:w,categories:D,onClose:()=>v(!1),onSave:Q}))}function ProductModal({show:N,product:d,categories:$,onClose:O,onSave:M}){const[l,v]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[w,E]=useState(!1),[b,J]=useState(!1);useEffect(()=>{v(d?{name:d.name||"",code:d.code||"",price:d.price||"",image:d.image||"",category:d.category||"",note:d.note||"",sort_order:d.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[d,N]);const[H,I]=React.useState(""),D=x=>window.KTM.money.formatVNDInputDigits(x),[z,Y]=React.useState(""),j=x=>{const he=window.KTM.money.nextPriceInputState(x.target.value,z);Y(he.digits),v({...l,price:he.price})},[ae,Q]=React.useState("");React.useEffect(()=>{d!=null&&d.image&&Q(d.image)},[d]);const c=async x=>{if(!(!x||!x.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:x},"L\u1ED7i x\xF3a \u1EA3nh")}catch(he){console.error("Delete cloudinary image error:",he)}},B=async(x,he=2,G)=>{const ue=he*1024*1024,oe=x.type==="image/heic"||x.type==="image/heif"||/\.heic$/i.test(x.name);if(x.size<=ue&&!oe)return x;G==null||G("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const de=await createImageBitmap(x);G==null||G("\u0110ang n\xE9n \u1EA3nh...");const re=document.createElement("canvas");let me=de.width,te=de.height;const ge=1200;return(me>ge||te>ge)&&(me>te?(te=Math.round(te/me*ge),me=ge):(me=Math.round(me/te*ge),te=ge)),re.width=me,re.height=te,re.getContext("2d").drawImage(de,0,0,me,te),de.close(),new Promise((le,xe)=>{re.toBlob(Oe=>{Oe?(G==null||G("Ho\xE0n t\u1EA5t!"),le(new File([Oe],x.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):xe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(de){throw console.error("createImageBitmap error:",de),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},f=async x=>{var ue,oe;const he=(ue=x.target.files)==null?void 0:ue[0];if(!he)return;if(!(he.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(he.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}J(!0),I("\u0110ang chu\u1EA9n b\u1ECB...");try{const de=(he.size/1024/1024).toFixed(1);I(`File ${de}MB - \u0110ang n\xE9n...`);const re=await B(he,2,ge=>{I(ge)}),me=(re.size/1024/1024).toFixed(1);I(`\u0110\xE3 n\xE9n: ${me}MB - \u0110ang upload...`);const te=await window.KTM.cloudinary.uploadImage({file:re,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});te.secure_url?(l.image&&l.image!==ae&&c(l.image),v(ge=>({...ge,image:te.secure_url})),I("")):(console.error("Cloudinary error:",te),alert("Upload th\u1EA5t b\u1EA1i: "+(((oe=te.error)==null?void 0:oe.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),I(""))}catch(de){console.error("Upload error:",de),alert("L\u1ED7i: "+de.message),I("")}J(!1),x.target.value=""},U=()=>{l.image&&(l.image!==ae&&c(l.image),v(x=>({...x,image:""})))},ie=async x=>{x.preventDefault(),E(!0),ae&&l.image&&ae!==l.image&&await c(ae),ae&&!l.image&&await c(ae),await M(l),E(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${d?"fa-edit":"fa-plus-circle"} me-2`}),d?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:O})),React.createElement("form",{onSubmit:ie},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},l.image?React.createElement(React.Fragment,null,React.createElement("img",{src:l.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:U,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${b?"fa-spinner fa-spin":"fa-camera"} me-1`}),b?H||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:f,disabled:b,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),b&&H&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},H))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:l.name,onChange:x=>v({...l,name:x.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:l.code,onChange:x=>v({...l,code:x.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:l.price,onChange:j,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:l.category,onChange:x=>v({...l,category:x.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),$.map(x=>React.createElement("option",{key:x,value:x},x)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:l.note,onChange:x=>v({...l,note:x.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:l.image,onChange:x=>v({...l,image:x.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:O,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:w,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:N,video:d,onClose:$,onSave:O}){const[M,l]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[v,w]=useState(!1),[E,b]=useState("");useEffect(()=>{d?(l({title:d.title||"",youtube_url:`https://www.youtube.com/watch?v=${d.youtubeId}`,thumbnail_url:d.thumb||"",sort_order:d.sortOrder||0}),b(d.thumb)):(l({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),b(""))},[d,N]);const J=D=>{const z=D.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return z?z[1]:null},H=D=>{l({...M,youtube_url:D});const z=J(D);z&&b(`https://img.youtube.com/vi/${z}/hqdefault.jpg`)},I=async D=>{D.preventDefault(),w(!0),await O(M),w(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},d?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:I},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:M.youtube_url,onChange:D=>H(D.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),E&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:E,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:M.title,onChange:D=>l({...M,title:D.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:M.sort_order,onChange:D=>l({...M,sort_order:parseInt(D.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:M.thumbnail_url,onChange:D=>l({...M,thumbnail_url:D.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[N,d]=useState(!1),[$,O]=useState(""),[M,l]=useState(null),[v,w]=useState("search"),[E,b]=useState(null),[J,H]=useState(""),[I,D]=useState([]),[z,Y]=useState(null),[j,ae]=useState(!1),[Q,c]=useState(null),[B,f]=useState(!0),[U,ie]=useState([]),[x,he]=useState(null),[G,ue]=useState([]);useEffect(()=>{const t=localStorage.getItem("ktm_admin_session");if(t)try{const i=JSON.parse(t);i.expiry>Date.now()?(d(!0),l(i.user)):localStorage.removeItem("ktm_admin_session")}catch(i){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{N&&te()},[N]);const oe=async(t,i)=>{O("");try{const k=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:t,password:i},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),Z={user:k.user,token:k.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(Z)),l(k.user),d(!0)}catch(k){O(k.message)}},de=()=>{localStorage.removeItem("ktm_admin_session"),d(!1),l(null),D([]),Y(null)},re=(t,i="success")=>{const k=Date.now();ie(Z=>[...Z,{id:k,message:t,type:i}])},me=t=>{ie(i=>i.filter(k=>k.id!==t))},te=async(t=null)=>{f(!0);try{const i=t?`${API_BASE}/api/albums?parent_id=${t}`:`${API_BASE}/api/albums?parent_id=root`,k=await window.KTM.api.getJSON(i,"L\u1ED7i t\u1EA3i danh s\xE1ch album");D(Array.isArray(k)?k:[])}catch(i){console.error(i),re("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}f(!1)},ge=()=>{c(null),ae(!0)},Se=t=>{c(t),ae(!0)},le=async t=>{try{const i=Q&&Q.uuid;!i&&x&&(t.parent_id=x.uuid);const k=i?`${API_BASE}/api/albums/${Q.uuid||Q.id}`:`${API_BASE}/api/albums`;i?await window.KTM.api.putJSON(k,t,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(k,t,"L\u1ED7i t\u1EA1o"),re(i?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),ae(!1),te(x==null?void 0:x.uuid)}catch(i){re(i.message,"danger")}},xe=t=>{Y(t)},Oe=t=>{if(t==="root")ue([]),he(null),te(null);else if(t){const i=G.findIndex(k=>k.uuid===t.uuid);i>=0&&(ue(G.slice(0,i+1)),he(t),te(t.uuid))}else{const i=[...G];i.pop();const k=i[i.length-1]||null;ue(i),he(k),te(k==null?void 0:k.uuid)}},Ne=async t=>{const i=`X\xF3a folder "${t.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(i))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${t.uuid||t.id}`,"L\u1ED7i x\xF3a album"),re("\u0110\xE3 x\xF3a","success"),te(x==null?void 0:x.uuid)}catch(k){re("L\u1ED7i x\xF3a album","danger")}};if(!N)return React.createElement(LoginPage,{onLogin:oe,error:$});const $e=()=>{const t=new Date,i=t.getFullYear(),k=String(t.getMonth()+1).padStart(2,"0");return`${i}-${k}`};function We(){const[t,i]=useState($e()),[k,Z]=useState(!0),[Ce,Ke]=useState([]),{parseMoney:ce,parseShipFeeFromNote:Ve,getShipFeeForItems:Re,formatNumber:q,formatVND:fe}=window.KTM.money,qe=async()=>{Z(!0);try{const y=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(t)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA");Ke(Array.isArray(y)?y:[])}catch(y){console.error("Load stats error:",y),Ke([])}finally{Z(!1)}};useEffect(()=>{qe()},[t]);const ne=React.useMemo(()=>{var Pe;const y={pending:0,processing:0,done:0,paid:0,other:0};let Qe=0,He=0,Xe=0,Je=0,De=0;const Te=F=>F.customer_id||F.phone||"unknown",ze=F=>window.KTM.orders.getOrderItems(F),o=new Map,_=new Map,ee=new Map;for(const F of Ce){const a=ze(F);let p=0,m=0;for(const e of a){const n=Number((e==null?void 0:e.quantity)||0)||0,s=ce(e==null?void 0:e.product_price),r=n*s;p+=n,m+=r;const C=(e==null?void 0:e.product_id)||"unknown",K=o.get(C)||{product_id:C,product_name:(e==null?void 0:e.product_name)||"\u2014",product_code:(e==null?void 0:e.product_code)||"",orders:0,quantity:0,revenue:0};K.orders+=1,K.quantity+=n,K.revenue+=r,o.set(C,K)}const S=Re(a),T=Number((Pe=F==null?void 0:F.adjustment_amount)!=null?Pe:0)||0,h=m+(S.found?S.fee:0)+T,u=m+T;Qe+=p,He+=h,Je+=u;const g=F.status==="done"||F.status==="paid";F.status==="pending"?y.pending+=1:F.status==="processing"?y.processing+=1:F.status==="paid"?(y.paid+=1,y.done+=1,Xe+=h,De+=u):F.status==="done"?(y.done+=1,Xe+=h,De+=u):y.other+=1;const P=Te(F),W=_.get(P)||{key:P,customer_name:F.customer_name||"",phone:F.phone||"",orders:0,quantity:0,revenue:0};W.orders+=1,W.quantity+=p,W.revenue+=h,!W.customer_name&&F.customer_name&&(W.customer_name=F.customer_name),!W.phone&&F.phone&&(W.phone=F.phone),_.set(P,W);const R=F.created_at?new Date(F.created_at):null;if(R&&!Number.isNaN(R.getTime())){const e=`${R.getFullYear()}-${String(R.getMonth()+1).padStart(2,"0")}-${String(R.getDate()).padStart(2,"0")}`,n=ee.get(e)||{day:e,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};n.orders+=1,n.quantity+=p,n.revenue+=h,g&&(n.doneOrders+=1,n.doneRevenue+=h),ee.set(e,n)}}const ke=Array.from(o.values()).sort((F,a)=>a.revenue-F.revenue),ye=Array.from(_.values()).sort((F,a)=>a.revenue-F.revenue),ve=Array.from(ee.values()).sort((F,a)=>F.day.localeCompare(a.day)),Me=_.size,Ie=Ce.length?Math.round(He/Ce.length):0,Ee=Ce.length?Qe/Ce.length:0,Ye=Math.round(De*.05),Be=Math.round(Je*.05);return{statusCounts:y,totalQty:Qe,totalRevenue:He,doneRevenue:Xe,tempCommission:Ye,tempCommissionAll:Be,products:ke,customers:ye,days:ve,uniqueCustomers:Me,avgOrderValue:Ie,avgQtyPerOrder:Ee}},[Ce,t]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:k}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:qe,disabled:k},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:t,onChange:y=>i(y.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),q(Ce.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),q(ne.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),q(ne.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",q(ne.statusCounts.paid),"/",q(ne.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},q(Ce.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},fe(ne.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},fe(ne.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},fe(ne.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},fe(ne.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",ne.avgQtyPerOrder?ne.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},q(ne.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},q(ne.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},q(ne.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},q(ne.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},q(ne.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,q(ne.statusCounts.pending)),React.createElement("td",null,q(ne.statusCounts.processing)),React.createElement("td",null,q(ne.statusCounts.done)),React.createElement("td",null,q(ne.statusCounts.paid)),React.createElement("td",null,q(ne.statusCounts.other)),React.createElement("td",null,q(ne.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},ne.products.slice(0,10).map(y=>React.createElement("div",{key:y.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},y.product_name),React.createElement("div",{className:"text-muted small text-truncate"},y.product_code?`#${y.product_code} \u2022 `:"",q(y.orders)," \u0111\u01A1n \u2022 ",q(y.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},fe(y.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,ne.products.slice(0,10).map(y=>React.createElement("tr",{key:y.product_id},React.createElement("td",null,y.product_name),React.createElement("td",null,y.product_code||"\u2014"),React.createElement("td",null,q(y.orders)),React.createElement("td",null,q(y.quantity)),React.createElement("td",{className:"fw-semibold"},fe(y.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},ne.customers.slice(0,10).map(y=>React.createElement("div",{key:y.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},y.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},y.phone||"\u2014"," \u2022 ",q(y.orders)," \u0111\u01A1n \u2022 ",q(y.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},fe(y.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,ne.customers.slice(0,10).map(y=>React.createElement("tr",{key:y.key},React.createElement("td",null,y.customer_name||"\u2014"),React.createElement("td",null,y.phone||"\u2014"),React.createElement("td",null,q(y.orders)),React.createElement("td",null,q(y.quantity)),React.createElement("td",{className:"fw-semibold"},fe(y.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},ne.days.map(y=>React.createElement("div",{key:y.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},y.day),React.createElement("div",{className:"text-muted small"},q(y.orders)," \u0111\u01A1n \u2022 ",q(y.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",q(y.doneOrders)," \u2022 ",fe(y.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},fe(y.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,ne.days.map(y=>React.createElement("tr",{key:y.day},React.createElement("td",null,y.day),React.createElement("td",null,q(y.orders)),React.createElement("td",null,q(y.quantity)),React.createElement("td",{className:"fw-semibold"},fe(y.revenue)),React.createElement("td",null,q(y.doneOrders)),React.createElement("td",{className:"fw-semibold"},fe(y.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:v,onMenuChange:t=>{w(t),t==="albums"&&(he(null),ue([]),te(null))},onLogout:de,currentUser:M}),React.createElement("div",{className:"main-content"},v==="albums"&&!z&&React.createElement(AlbumList,{albums:I,loading:B,currentFolder:x,breadcrumb:G,onSelect:xe,onCreate:ge,onEdit:Se,onDelete:Ne,onBack:Oe}),v==="search"&&React.createElement(SearchCenter,{showToast:re,onNavigate:(t,i,k)=>{w(t),t==="orders"&&i==="create"&&(b(Date.now()),H((k==null?void 0:k.productId)||""))}}),v==="albums"&&z&&React.createElement(AlbumDetail,{album:z,parentAlbum:G.length>0?G[G.length-1]:null,onBack:()=>{if(z.parentId){const t=G.findIndex(i=>i.uuid===z.parentId);t>=0?Y(G[t]):Y(null)}else Y(null)},onRefresh:()=>te(x==null?void 0:x.uuid),showToast:re,onNavigateToFolder:t=>{ue(i=>[...i,z]),Y(t)},onEditSubfolder:t=>{c(t),ae(!0)}}),v==="videos"&&React.createElement(VideoList,{showToast:re}),v==="products"&&React.createElement(ProductManager,{showToast:re}),v==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:E,autoOpenCreateProductId:J,showToast:re}),v==="stats"&&React.createElement(We,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${v==="search"?"active":""}`,onClick:t=>{t.preventDefault(),w("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${v==="albums"?"active":""}`,onClick:t=>{t.preventDefault(),w("albums"),Y(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${v==="videos"?"active":""}`,onClick:t=>{t.preventDefault(),w("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${v==="products"?"active":""}`,onClick:t=>{t.preventDefault(),w("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${v==="orders"?"active":""}`,onClick:t=>{t.preventDefault(),w("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${v==="stats"?"active":""}`,onClick:t=>{t.preventDefault(),w("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:j,album:Q,parentId:x==null?void 0:x.uuid,onClose:()=>ae(!1),onSave:le}),React.createElement("div",{className:"toast-container"},U.map(t=>React.createElement(Toast,{key:t.id,message:t.message,type:t.type,onClose:()=>me(t.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:N,autoOpenCreateProductId:d,showToast:$}){const[O,M]=useState([]),[l,v]=useState(!0),[w,E]=useState(!1),[b,J]=useState(null),[H,I]=useState(""),[D,z]=useState(!1),[Y,j]=useState(null),[ae,Q]=useState(!1),[c,B]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[f,U]=useState([""]),[ie,x]=useState(null),he=useRef({}),[G,ue]=useState([]),[oe,de]=useState(null),re=useRef(null),me=useRef(null),te=useRef(0),ge=useRef(new Map),Se=useRef(null),le=useRef(0),xe=useRef(null),Oe=9,Ne=150,$e=24*60*60*1e3,We=5*60*1e3,t=e=>{B({customer_name:"",phone:"",address:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),U([""]),j(null),x(null)};useEffect(()=>{const e=n=>{var r;if(ie==null)return;const s=(r=he.current)==null?void 0:r[ie];s&&!s.contains(n.target)&&x(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ie]);const i=e=>window.KTM.money.parseMoney(e),k=e=>window.KTM.money.parseSignedMoney(e),Z=e=>window.KTM.money.formatVND(e),Ce=e=>window.KTM.money.parseShipFeeFromNote(e),Ke=e=>window.KTM.phone.isValid(e),ce=e=>window.KTM.phone.normalize(e),Ve=(e,n)=>{e&&B(s=>n&&ce(s.phone)!==n?s:{...s,customer_name:e.name||s.customer_name,address:e.address||s.address})},Re=async e=>{var C,K,se;const n=ce(e);if(!n)return;const s=(C=ge.current)==null?void 0:C.get(n);if(s&&Number.isFinite(s.ts)){const V=Date.now()-s.ts,L=s.status==="found"?$e:We;if(V>=0&&V<=L){j({status:s.status,phone:n,customer:s.customer}),s.status==="found"&&s.customer&&Ve(s.customer,n);return}}const r=++te.current;j({status:"loading",phone:n});try{const V=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(n)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(te.current!==r)return;if(V&&V.exists&&V.customer){(K=ge.current)==null||K.set(n,{ts:Date.now(),status:"found",customer:V.customer}),j({status:"found",phone:n,customer:V.customer}),Ve(V.customer,n);return}(se=ge.current)==null||se.set(n,{ts:Date.now(),status:"not-found",customer:null}),j({status:"not-found",phone:n})}catch(V){if(te.current!==r)return;console.error("Customer lookup error:",V),j({status:"error",phone:n})}},q=e=>{const n=ce(e);B(r=>({...r,phone:n})),Q(!1),me.current&&(clearTimeout(me.current),me.current=null);const s=n;if(s.length<Oe){j(null);return}if(Ke(s)){Re(s);return}me.current=setTimeout(()=>{Re(n)},Ne)},fe=()=>{const e=ce(c.phone);e.length<Oe||Re(e)};useEffect(()=>(D?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[D]);const qe=Array.isArray(c.items)?c.items.length:0;useEffect(()=>{if(!D){le.current=qe;return}qe>le.current&&setTimeout(()=>{const e=Se.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),le.current=qe},[D,qe]),useEffect(()=>()=>{me.current&&(clearTimeout(me.current),me.current=null)},[]),useEffect(()=>{Xe()},[]),useEffect(()=>{Je()},[H]),useEffect(()=>{N&&re.current!==N&&(re.current=N,Te(d))},[N]);const ne=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e||"",y=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":"bg-light text-dark",Qe=React.useMemo(()=>window.KTM.orders.sortOrders(O),[O]),He=e=>window.KTM.date.formatDateTime(e),Xe=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");ue(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),ue([])}},Je=async()=>{v(!0);try{let e=`${API_BASE}/api/orders`;H&&(e+=`?month=${H}`);const n=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");M(Array.isArray(n)?n:[])}catch(e){console.error("Load orders error:",e),M([])}finally{v(!1)}},De=e=>{var s;de(e.id);const n=Array.isArray(e.items)&&e.items.length?e.items.map(r=>{var C;return{product_id:(r==null?void 0:r.product_id)||"",quantity:Number((C=r==null?void 0:r.quantity)!=null?C:1)||1}}).filter(r=>r.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];B({customer_name:e.customer_name||"",phone:ce(e.phone||""),address:e.address||"",items:n.length?n:[{product_id:"",quantity:1}],adjustment_amount:Number((s=e==null?void 0:e.adjustment_amount)!=null?s:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),U(new Array(n.length?n.length:1).fill("")),j(null),z(!0),e.phone&&Re(ce(e.phone))};function Te(e){de(null),t(e||""),Q(!1),z(!0)}const ze=()=>{w||(z(!1),de(null),t(""),Q(!1))},o=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const n=String(e),s=G.find(r=>String(r==null?void 0:r.id)===n);return s?`${s.name}${s.code?` (${s.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},_=e=>{const n=String(f[e]||"").trim().toLowerCase();return n?G.filter(s=>{const r=String((s==null?void 0:s.name)||"").toLowerCase(),C=String((s==null?void 0:s.code)||"").toLowerCase();return r.includes(n)||C.includes(n)}):G},ee=e=>{if(!e)return null;const n=String(e);return G.find(s=>String(s==null?void 0:s.id)===n)||null},ke=e=>window.KTM.orders.getOrderItems(e),ye=e=>window.KTM.orders.getOrderTotalQty(e),ve=e=>window.KTM.orders.getOrderProductSummary(e,ee),Me=e=>window.KTM.orders.getOrderItemRows(e,ee),Ie=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Ee=e=>{var X;const n=ke(e),s=Me(e),r=Pe(n),C=Be(n),K=C.fee,se=Ie(e),V=r+K+se,L=[];if(L.push(`\u0110\u01A0N H\xC0NG #${(X=e==null?void 0:e.id)!=null?X:""}`.trim()),e!=null&&e.customer_name&&L.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&L.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&L.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),e!=null&&e.status&&L.push(`Tr\u1EA1ng th\xE1i: ${ne(e.status)}`),e!=null&&e.created_at&&L.push(`Th\u1EDDi gian: ${He(e.created_at)}`),L.push(""),L.push("S\u1EA3n ph\u1EA9m:"),s.length)for(const A of s)L.push(`- ${A.name} x${A.qty}`);else{const A=ve(e);A&&A!=="\u2014"&&L.push(`- ${A}`)}return L.push(""),L.push(`T\u1EA1m t\xEDnh: ${Z(r)}`),L.push(`Ship: ${Z(C.found?K:0)}`),se!==0&&L.push(`\u0110i\u1EC1u ch\u1EC9nh: ${Z(se)}`),e!=null&&e.adjustment_note&&L.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),L.push(`T\u1ED5ng: ${Z(V)}`),L.filter(Boolean).join(`
`)},Ye=async e=>{try{const n=Ee(e);await window.KTM.clipboard.writeText(n),typeof $=="function"?$("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(n){console.error(n),typeof $=="function"?$("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Be=e=>window.KTM.orders.getOrderShipInfo(e,ee),Pe=e=>window.KTM.orders.getItemsSubtotal(e,ee),F=e=>{try{const n=e instanceof Date?e:new Date(e);if(!n||Number.isNaN(n.getTime()))return"";const s=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0");return`${s}-${r}`}catch(n){return""}},a=()=>H?String(H):F(new Date),p=e=>{const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),s=ce((e==null?void 0:e.phone)||""),r=String((e==null?void 0:e.address)||"").trim().toLowerCase(),C=k(e==null?void 0:e.adjustment_amount),se=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(V=>{var L;return{product_id:String((V==null?void 0:V.product_id)||"").trim(),quantity:Number((L=V==null?void 0:V.quantity)!=null?L:0)}}).filter(V=>V.product_id&&Number.isFinite(V.quantity)&&V.quantity>0).sort((V,L)=>V.product_id<L.product_id?-1:V.product_id>L.product_id?1:V.quantity-L.quantity);return JSON.stringify({name:n,phone:s,address:r,items:se,adj:C})},m=React.useMemo(()=>{const e=ce((c==null?void 0:c.phone)||"");if(!e)return{count:0,orders:[],monthKey:a()};const n=a(),s=(Array.isArray(O)?O:[]).filter(r=>{if(!r||oe&&String(r.id)===String(oe)||ce(r.phone||"")!==e)return!1;const C=F(r.created_at);return C&&C===n}).sort((r,C)=>{const K=new Date(r.created_at).getTime(),se=new Date(C.created_at).getTime();return(Number.isFinite(se)?se:0)-(Number.isFinite(K)?K:0)});return{count:s.length,orders:s,monthKey:n}},[O,c==null?void 0:c.phone,H,oe]),S=e=>{var V;const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),s=ce((e==null?void 0:e.phone)||""),r=String((e==null?void 0:e.address)||"").trim().toLowerCase(),C=k((V=e==null?void 0:e.adjustment_amount)!=null?V:0),K=ke(e),se=(Array.isArray(K)?K:[]).map(L=>{var X;return{product_id:String((L==null?void 0:L.product_id)||"").trim(),quantity:Number((X=L==null?void 0:L.quantity)!=null?X:0)}}).filter(L=>L.product_id&&Number.isFinite(L.quantity)&&L.quantity>0).sort((L,X)=>L.product_id<X.product_id?-1:L.product_id>X.product_id?1:L.quantity-X.quantity);return JSON.stringify({name:n,phone:s,address:r,items:se,adj:C})},T=React.useMemo(()=>{if(oe)return"";const e=ce((c==null?void 0:c.phone)||"");if(!e)return"";const n=a(),s=p(c),r=Array.isArray(O)?O:[];for(const C of r){if(!C||oe&&String(C.id)===String(oe)||ce(C.phone||"")!==e)continue;const K=F(C.created_at);if(!K||K!==n)continue;const se=S(C);if(se&&se===s)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${n}${C!=null&&C.id?` (#${C.id})`:""}`}return""},[O,c,H,oe]),h=e=>{var Ue;const n=[],s=[],r=String((e==null?void 0:e.customer_name)||"").trim(),C=ce((e==null?void 0:e.phone)||""),K=String((e==null?void 0:e.address)||"").trim();r||n.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),C||n.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),C&&!Ke(C)&&n.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),K||s.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const V=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Fe=>Fe&&Fe.product_id);V.length===0&&n.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),V.some(Fe=>{var Ze;const Ge=Number((Ze=Fe==null?void 0:Fe.quantity)!=null?Ze:0);return!Number.isFinite(Ge)||Ge<=0})&&n.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const X=new Set;let A=!1;for(const Fe of V){const Ge=String(Fe.product_id||"").trim();if(Ge){if(X.has(Ge)){A=!0;break}X.add(Ge)}}A&&s.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const pe=Pe(V),be=Be(V),je=be!=null&&be.found?Number((Ue=be==null?void 0:be.fee)!=null?Ue:0):0,Ae=k(e==null?void 0:e.adjustment_amount),_e=String((e==null?void 0:e.adjustment_note)||"").trim();be!=null&&be.found&&(je>=2e5||pe>0&&je>pe*.6)&&s.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Z(je)}`),Ae!==0&&!_e&&s.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Le=Math.abs(Ae);return(Le>=5e5||pe>0&&Le>pe*.5)&&Ae!==0&&s.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Z(Ae)}`),{errors:n,warnings:s,canSubmit:n.length===0}},u=React.useMemo(()=>h(c),[c,G]),g=React.useMemo(()=>{var Ze;const e=String((c==null?void 0:c.customer_name)||"").trim(),n=ce((c==null?void 0:c.phone)||""),s=String((c==null?void 0:c.address)||"").trim(),r=Array.isArray(c==null?void 0:c.items)?c.items:[],C=new Map;for(const we of r){const ea=String((we==null?void 0:we.product_id)||"").trim();ea&&C.set(ea,(C.get(ea)||0)+1)}const K=r.map(we=>{var ta;const ea=String((we==null?void 0:we.product_id)||"").trim(),aa=Number((ta=we==null?void 0:we.quantity)!=null?ta:0),sa=ea?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",na=Number.isFinite(aa)&&aa>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",ia=ea&&(C.get(ea)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:sa,qtyError:na,dupWarn:ia}}),se=r.filter(we=>we&&we.product_id),V=Pe(se),L=Be(se),X=L!=null&&L.found?Number((Ze=L==null?void 0:L.fee)!=null?Ze:0):0,A=k(c==null?void 0:c.adjustment_amount),pe=String((c==null?void 0:c.adjustment_note)||"").trim(),be=Math.abs(A),je=A!==0&&!pe?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Ae=A!==0&&(be>=5e5||V>0&&be>V*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Z(A)}`:"",_e=L!=null&&L.found&&(X>=2e5||V>0&&X>V*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Z(X)}`:"",Le=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Ue=n?Ke(n)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Fe=s?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Ge=!Le&&!Ue&&K.every(we=>!we.productError&&!we.qtyError);return{nameError:Le,phoneError:Ue,addressWarn:Fe,items:K,shipAbnormalWarn:_e,adjustmentNoteWarn:je,adjustmentAbnormalWarn:Ae,canSubmit:Ge}},[c,G]),P=async e=>{var se,V,L;const n=(e==null?void 0:e.mode)||"close",s=h(c);if(!s.canSubmit){const X=s.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof $=="function"?$(X,"danger"):alert(X);return}if(!oe&&T){const X=`${T}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(X)){(m==null?void 0:m.count)>0&&Q(!0),setTimeout(()=>{var be;const pe=document.getElementById("order-phone-input");pe&&typeof pe.scrollIntoView=="function"&&(pe.scrollIntoView({block:"center",behavior:"smooth"}),(be=pe.focus)==null||be.call(pe))},0);return}}const r=ce(c.phone),K=(Array.isArray(c.items)?c.items:[]).map(X=>{var A;return{product_id:(X==null?void 0:X.product_id)||"",quantity:Number((A=X==null?void 0:X.quantity)!=null?A:1)}}).filter(X=>X.product_id&&Number.isFinite(X.quantity)&&X.quantity>0);E(!0);try{const X=oe?`${API_BASE}/api/orders/${oe}`:`${API_BASE}/api/orders`,A=K[0],pe={customer_name:c.customer_name,phone:r,address:c.address,adjustment_amount:k(c.adjustment_amount),adjustment_note:(c.adjustment_note||"").trim(),product_id:A.product_id,quantity:A.quantity,status:c.status,items:K,...oe?{id:oe}:{}};if(oe)await window.KTM.api.putJSON(X,pe,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const be=await window.KTM.api.postJSON(X,pe,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");xe.current={id:(L=(V=be==null?void 0:be.id)!=null?V:(se=be==null?void 0:be.order)==null?void 0:se.id)!=null?L:null,fingerprint:p(c),ts:Date.now()}}n==="new"&&!oe?(t(""),de(null),z(!0)):(t(""),de(null),z(!1)),Je()}catch(X){console.error(X),typeof $=="function"?$(X.message,"danger"):alert(X.message);return}finally{E(!1)}},W=e=>window.KTM.orders.getOrderTotalMoney(e,ee),R=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){J(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Je()}catch(n){console.error(n),typeof $=="function"?$(n.message,"danger"):alert(n.message)}finally{J(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:l&&!D||w||!!b}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Te,disabled:w||!!b},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:H,onChange:e=>I(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),H&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{I("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:l},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Je,disabled:l},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},O.length," \u0111\u01A1n")),l?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):O.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Qe.map(e=>React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"text-muted small"},e.phone),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address)),React.createElement("span",{className:`badge ${y(e.status)}`},ne(e.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const n=Me(e);return n.length?React.createElement("div",{className:"mt-1"},n.map((s,r)=>React.createElement("div",{key:r,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},s.name),React.createElement("div",{className:"text-muted",style:{flexShrink:0}},"x",s.qty)))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},ve(e))})()),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},ye(e))),(Ie(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Z(Ie(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},Z(W(e)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",He(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>De(e),disabled:w||!!b},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>Ye(e),disabled:w||!!b},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>R(e.id),disabled:w||b===e.id},b===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,Qe.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,ve(e)),React.createElement("td",null,ye(e)),React.createElement("td",{className:"fw-semibold"},Z(W(e))),React.createElement("td",null,React.createElement("span",{className:`badge ${y(e.status)}`},ne(e.status))),React.createElement("td",null,He(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>De(e),disabled:w||!!b},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>Ye(e),disabled:w||!!b},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>R(e.id),disabled:w||b===e.id},b===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),D&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),oe?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:ze})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),P({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:Se},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:c.customer_name,onChange:e=>B({...c,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!g.nameError&&React.createElement("div",{className:"form-text text-danger"},g.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:c.phone,onChange:e=>q(e.target.value),onBlur:fe,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!g.phoneError&&React.createElement("div",{className:"form-text text-danger"},g.phoneError),!g.phoneError&&m.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",m.count," \u0111\u01A1n trong th\xE1ng ",m.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Q(e=>!e)},ae?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),ae&&m.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Q(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},m.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${y(e.status)}`},ne(e.status))),React.createElement("div",{className:"text-muted small"},He(e.created_at)," \u2022 ",Z(W(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ve(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&De(e)}},"M\u1EDF")))),m.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(Y==null?void 0:Y.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(Y==null?void 0:Y.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(Y==null?void 0:Y.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(Y==null?void 0:Y.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:c.status,onChange:e=>B({...c,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:c.address,onChange:e=>B({...c,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!g.addressWarn&&React.createElement("div",{className:"form-text text-warning"},g.addressWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:c.adjustment_amount,onChange:e=>B({...c,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!g.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},g.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:c.adjustment_note,onChange:e=>B({...c,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!g.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},g.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{B(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),U(e=>[...Array.isArray(e)?e:[],""])},disabled:w},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(c.items)?c.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:s=>{he.current[n]=s}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{x(s=>s===n?null:n),setTimeout(()=>{const s=document.getElementById(`order-product-search-${n}`);s&&s.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},o(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ie===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:f[n]||"",onChange:s=>{const r=s.target.value;U(C=>{const K=Array.isArray(C)?[...C]:[];return K[n]=r,K})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),_(n).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):_(n).map(s=>React.createElement("button",{key:s.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(s.id);B(C=>{const K=Array.isArray(C.items)?[...C.items]:[];return K[n]={...K[n]||{quantity:1},product_id:r},{...C,items:K}}),x(null)}},s.name,s.code?` (${s.code})`:""))),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),G.map(s=>React.createElement("option",{key:s.id,value:s.id},s.name)))),(()=>{var r;const s=(r=g.items)==null?void 0:r[n];return s?React.createElement(React.Fragment,null,!!s.productError&&React.createElement("div",{className:"form-text text-danger"},s.productError),!!s.dupWarn&&React.createElement("div",{className:"form-text text-warning"},s.dupWarn)):null})()),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:s=>{const r=s.target.value;B(C=>{const K=Array.isArray(C.items)?[...C.items]:[];return K[n]={...K[n]||{product_id:""},quantity:r},{...C,items:K}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var r;const s=(r=g.items)==null?void 0:r[n];return s&&s.qtyError?React.createElement("div",{className:"form-text text-danger"},s.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{B(s=>{const r=Array.isArray(s.items)?[...s.items]:[];return r.splice(n,1),{...s,items:r.length?r:[{product_id:"",quantity:1}]}}),U(s=>{const r=Array.isArray(s)?[...s]:[];return r.splice(n,1),r.length?r:[""]}),x(s=>s==null?s:s===n?null:s>n?s-1:s)},disabled:w||(Array.isArray(c.items)?c.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(c.items)?c.items:[]).filter(se=>se==null?void 0:se.product_id),s=Pe(n),r=Be(n),C=k(c.adjustment_amount),K=s+(r.found?r.fee:0)+C;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Z(s))),r.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Z(r.fee))),!!g.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},g.shipAbnormalWarn),C!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Z(C))),(c.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(c.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Z(K)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:ze,disabled:w,style:{borderRadius:10}},"H\u1EE7y"),!oe&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>P({mode:"new"}),disabled:w||!g.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:w||!g.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

