const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:S,error:C}){const[$,X]=useState(""),[F,D]=useState(""),[L,de]=useState(!1),[ue,te]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),C&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),C),React.createElement("form",{onSubmit:async Re=>{Re.preventDefault(),de(!0),await S($,F),de(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:$,onChange:Re=>X(Re.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:ue?"text":"password",className:"form-control",value:F,onChange:Re=>D(Re.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>te(!ue)},React.createElement("i",{className:`fas fa-eye${ue?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:L},L?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:S,type:C,onClose:$,actionLabel:X,onAction:F,durationMs:D}){return useEffect(()=>{const L=Number(D),de=Number.isFinite(L)&&L>0?L:3e3,ue=setTimeout($,de);return()=>clearTimeout(ue)},[$,D]),React.createElement("div",{className:`toast show align-items-center text-white bg-${C} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},S),X&&typeof F=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{F()}finally{$()}}},X),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:$})))}function Loading({show:S}){return S?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:S,title:C,subtitle:$,onClose:X,footer:F,children:D}){return useEffect(()=>{if(!S)return;const L=de=>{de.key==="Escape"&&(de.preventDefault(),typeof X=="function"&&X())};return document.addEventListener("keydown",L),()=>document.removeEventListener("keydown",L)},[S,X]),S?React.createElement("div",{className:`admin-drawer-root ${S?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:X,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},C),$?React.createElement("div",{className:"admin-drawer-subtitle"},$):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:X,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},D),F?React.createElement("div",{className:"admin-drawer-footer"},F):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(S){try{const C=localStorage.getItem(S);if(!C)return[];const $=JSON.parse(C);return Array.isArray($)?$.map(X=>String(X||"").trim()).filter(Boolean):[]}catch(C){return[]}}function saveAdminMenuIdsToStorage(S,C){try{localStorage.setItem(S,JSON.stringify(Array.isArray(C)?C:[]))}catch($){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(S){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,S),S}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(S){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,S),S}function Sidebar({activeMenu:S,onMenuChange:C,onLogout:$,currentUser:X,pinnedMenus:F,recentMenus:D,onTogglePin:L}){const de=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],ue=(X==null?void 0:X.username)||(X==null?void 0:X.name)||(X==null?void 0:X.email)||"Admin",te=useMemo(()=>{const fe=new Map;for(const O of de)fe.set(O.id,O);return fe},[]),Ne=Array.isArray(F)?F:[],Re=Array.isArray(D)?D:[],pe=Ne.map(fe=>te.get(fe)).filter(Boolean),ve=Re.filter(fe=>fe!==S).map(fe=>te.get(fe)).filter(Boolean).slice(0,5),Le=fe=>Ne.includes(fe);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},ue),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},pe.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},pe.map(fe=>React.createElement("a",{key:`pin-${fe.id}`,href:"#",className:`nav-link ${S===fe.id?"active":""} sidebar-quicklink`,onClick:O=>{O.preventDefault(),C(fe.id)}},React.createElement("i",{className:`fas ${fe.icon}`})," ",fe.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:O=>{O.preventDefault(),O.stopPropagation(),L&&L(fe.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),ve.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},ve.map(fe=>React.createElement("a",{key:`recent-${fe.id}`,href:"#",className:`nav-link ${S===fe.id?"active":""} sidebar-quicklink`,onClick:O=>{O.preventDefault(),C(fe.id)}},React.createElement("i",{className:`fas ${fe.icon}`})," ",fe.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),de.map(fe=>React.createElement("a",{key:fe.id,href:"#",className:`nav-link ${S===fe.id?"active":""} ${fe.disabled?"opacity-50":""} ${fe.highlight?"text-warning":""}`,onClick:O=>{O.preventDefault(),fe.disabled||C(fe.id)}},React.createElement("i",{className:`fas ${fe.icon}`})," ",fe.label,fe.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),fe.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${Le(fe.id)?"pinned":""}`,onClick:O=>{O.preventDefault(),O.stopPropagation(),L&&L(fe.id)},title:Le(fe.id)?"B\u1ECF ghim":"Ghim","aria-label":Le(fe.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),$&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:$,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(S){const C=typeof S=="number"?S:parseFloat(String(S!=null?S:"").trim());return Number.isFinite(C)?Math.max(0,Math.min(100,C)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var S;try{const C=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!C)return{ship_percent:DEFAULT_SHIP_PERCENT};const $=JSON.parse(C);return{ship_percent:normalizeShipPercent((S=$==null?void 0:$.ship_percent)!=null?S:$==null?void 0:$.shipPercent)}}catch(C){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(S){var C;try{const $={ship_percent:normalizeShipPercent((C=S==null?void 0:S.ship_percent)!=null?C:S==null?void 0:S.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify($)),$}catch($){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var C;const S=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((C=S==null?void 0:S.ship_percent)!=null?C:S==null?void 0:S.shipPercent)}}async function saveAdminSettingsToServer(S){var X,F,D;const C={ship_percent:normalizeShipPercent((X=S==null?void 0:S.ship_percent)!=null?X:S==null?void 0:S.shipPercent)},$=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,C,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((D=(F=$==null?void 0:$.ship_percent)!=null?F:$==null?void 0:$.shipPercent)!=null?D:C.ship_percent)}}function AlbumList({albums:S,onSelect:C,onCreate:$,onEdit:X,onDelete:F,loading:D,currentFolder:L,onBack:de,breadcrumb:ue}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},L&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:de},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),L?L.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:$},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),ue&&ue.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:te=>{te.preventDefault(),de("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ue.map((te,Ne)=>React.createElement("li",{key:te.id,className:`breadcrumb-item ${Ne===ue.length-1?"active":""}`},Ne===ue.length-1?te.title:React.createElement("a",{href:"#",onClick:Re=>{Re.preventDefault(),de(te)},className:"text-warning"},te.title))))),D?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):S.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},L?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},S.map(te=>React.createElement("div",{key:te.uuid||te.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>C(te)},te.cover?React.createElement("img",{src:te.cover,className:"album-cover",alt:te.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},te.title),React.createElement("small",{className:"text-muted"},te.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),te.subfolderCount),te.subfolderCount>0&&te.count>0&&" \u2022 ",te.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),te.count),te.subfolderCount===0&&te.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Ne=>{Ne.stopPropagation(),X(te)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Ne=>{Ne.stopPropagation(),F(te)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:S,album:C,onClose:$,onSave:X,parentId:F}){const[D,L]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[de,ue]=useState(!1),[te,Ne]=useState(!1),Re=useRef(null);useEffect(()=>{L(C?{slug:C.id||"",title:C.title||"",description:C.description||"",cover_url:C.cover||"",parent_id:C.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:F||null})},[C,S,F]);const pe=async O=>{O.preventDefault(),ue(!0),await X(D),ue(!1)},ve=O=>O.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Le=async O=>{const tt=O.type==="image/heic"||O.type==="image/heif"||/\.heic$/i.test(O.name);if(O.size<=2097152&&!tt)return O;try{const Ge=await createImageBitmap(O),ye=document.createElement("canvas");let Te=Ge.width,ie=Ge.height;const Ve=800;return(Te>Ve||ie>Ve)&&(Te>ie?(ie=Math.round(ie/Te*Ve),Te=Ve):(Te=Math.round(Te/ie*Ve),ie=Ve)),ye.width=Te,ye.height=ie,ye.getContext("2d").drawImage(Ge,0,0,Te,ie),Ge.close(),new Promise((wt,Ae)=>{ye.toBlob(at=>{at?wt(new File([at],O.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ae(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Ge){throw console.error("Compress cover error:",Ge),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},fe=async O=>{var Ge;const Fe=O.target.files[0];if(!Fe)return;if(!(Fe.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Fe.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ne(!0);try{const ye=await Le(Fe),Te=await window.KTM.cloudinary.uploadImage({file:ye,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Te.secure_url)throw console.error("Cloudinary error:",Te),new Error(((Ge=Te.error)==null?void 0:Ge.message)||"Upload failed");L(ie=>({...ie,cover_url:Te.secure_url}))}catch(ye){console.error("Cover upload error:",ye),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+ye.message)}Ne(!1),O.target.value=""};return S?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},C?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:pe},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:D.title,onChange:O=>L({...D,title:O.target.value,slug:D.slug||ve(O.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:D.slug,onChange:O=>L({...D,slug:O.target.value}),required:!0,disabled:!!C}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:D.description,onChange:O=>L({...D,description:O.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},D.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:D.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>L(O=>({...O,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:Re,type:"file",accept:"image/*",className:"d-none",onChange:fe}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var O;return(O=Re.current)==null?void 0:O.click()},disabled:te},te?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:D.cover_url,onChange:O=>L({...D,cover_url:O.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:de||te},de?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:S,allAlbums:C,currentAlbumId:$,targetAlbum:X,onSelect:F,level:D=0}){const[L,de]=useState(!0),ue=S.uuid||S.id,te=ue===$,Ne=X===ue,Re=C.filter(ve=>ve.parentId===ue),pe=Re.length>0;return React.createElement("div",{style:{marginLeft:D*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Ne?"bg-info text-white":te?"bg-light text-muted":"hover-bg"}`,style:{cursor:te?"not-allowed":"pointer",opacity:te?.5:1,transition:"background 0.2s"},onClick:()=>!te&&F(ue)},pe&&React.createElement("i",{className:`fas fa-chevron-${L?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:ve=>{ve.stopPropagation(),de(!L)}}),!pe&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Ne?"-open":""} me-2 ${Ne?"":"text-warning"}`}),React.createElement("span",{className:"small"},S.title),te&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),S.count>0&&!te&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},S.count)),L&&pe&&React.createElement("div",null,Re.map(ve=>React.createElement(FolderTreeItem,{key:ve.uuid||ve.id,folder:ve,allAlbums:C,currentAlbumId:$,targetAlbum:X,onSelect:F,level:D+1}))))}function AlbumDetail({album:S,onBack:C,onRefresh:$,showToast:X,onNavigateToFolder:F,onEditSubfolder:D,parentAlbum:L}){const[de,ue]=useState([]),[te,Ne]=useState([]),[Re,pe]=useState(!0),[ve,Le]=useState(!1),[fe,O]=useState(""),[Fe,tt]=useState([]),[Ge,ye]=useState([]),[Te,ie]=useState({}),[Ve,lt]=useState(null),[wt,Ae]=useState(!1),[at,ut]=useState(""),[y,v]=useState(!1),M=useRef(null),Y=useRef(null),[Q,V]=useState(!1),[J,re]=useState([]),[b,T]=useState([]),[P,Z]=useState(""),[le,ne]=useState(!1),ke=async(A,c=2)=>{const j=c*1024*1024,E=A.type==="image/heic"||A.type==="image/heif"||/\.heic$/i.test(A.name);if(A.size<=j&&!E)return A;try{const oe=await createImageBitmap(A),me=document.createElement("canvas");let we=oe.width,Be=oe.height;const Ce=1200;return(we>Ce||Be>Ce)&&(we>Be?(Be=Math.round(Be/we*Ce),we=Ce):(we=Math.round(we/Be*Ce),Be=Ce)),me.width=we,me.height=Be,me.getContext("2d").drawImage(oe,0,0,we,Be),oe.close(),new Promise((dt,xt)=>{me.toBlob(jt=>{jt?dt(new File([jt],A.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):xt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(oe){throw console.error("Compress error:",oe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{Se(),We()},[S.id,S.uuid]);const Se=async()=>{pe(!0);try{const A=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${S.uuid||S.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");ue(A.images||[]);const c=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${S.uuid||S.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Ne(Array.isArray(c)?c:[])}catch(A){console.error(A),X("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}pe(!1)},We=async()=>{try{const A=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");T(Array.isArray(A)?A:[])}catch(A){console.error("Error loading albums:",A)}},rt=A=>{re(c=>c.includes(A)?c.filter(j=>j!==A):[...c,A])},ae=async()=>{if(!P||J.length===0){X("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}ne(!0);let A=0;for(const c of J)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${c}`,{album_id:P},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),A++}catch(j){console.error("Move error:",j)}ne(!1),V(!1),re([]),Z(""),A>0?(X("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),Se(),$()):X("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Pe,bt]=useState(!1),Ue=async()=>{if(J.length===0||!confirm(`X\xF3a ${J.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;bt(!0);let A=0;for(const c of J)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${c}`,"L\u1ED7i x\xF3a \u1EA3nh"),A++}catch(j){console.error("Delete error:",j)}bt(!1),re([]),A>0?(X(`\u0110\xE3 x\xF3a ${A} \u1EA3nh!`,"success"),Se(),$()):X("X\xF3a th\u1EA5t b\u1EA1i","danger")},Tt=()=>{J.length===de.length?re([]):re(de.map(A=>A.id))},gt=async()=>{if(at.trim()){v(!0);try{const A=at.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:A+"-"+Date.now(),title:at,parent_id:S.uuid||S.id},"L\u1ED7i t\u1EA1o folder"),X("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),ut(""),Ae(!1),Se(),$()}catch(A){X(A.message,"danger")}v(!1)}},Wt=async A=>{if(confirm(`X\xF3a folder "${A.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${A.uuid||A.id}`,"L\u1ED7i x\xF3a folder"),X("\u0110\xE3 x\xF3a folder","success"),Se(),$()}catch(c){X("L\u1ED7i x\xF3a folder","danger")}},Kt=A=>{const c=Array.from(A).filter(j=>j.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(j.name));tt(j=>[...j,...c]),c.forEach(j=>{const E=new FileReader;E.onload=oe=>{ye(me=>[...me,{file:j,preview:oe.target.result}])},E.readAsDataURL(j)})},w=A=>{tt(c=>c.filter((j,E)=>E!==A)),ye(c=>c.filter((j,E)=>E!==A))},H=async A=>{var j;const c=await window.KTM.cloudinary.uploadImage({file:A,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${S.id}`});if(!c.secure_url)throw console.error("Cloudinary error:",c),new Error(((j=c.error)==null?void 0:j.message)||"Upload failed");return c},Ee=async()=>{if(Fe.length===0)return;Le(!0);let A=0;for(let c=0;c<Fe.length;c++)try{O(`\u0110ang x\u1EED l\xFD ${c+1}/${Fe.length}...`);const j=await ke(Fe[c],2);O(`\u0110ang upload ${c+1}/${Fe.length}...`);const E=await H(j);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${S.id}`,{url:E.secure_url,caption:Te[c]||Fe[c].name.replace(/\.[^/.]+$/,""),sort_order:de.length+c},"L\u1ED7i l\u01B0u \u1EA3nh"),A++}catch(j){console.error("Upload error:",j)}Le(!1),O(""),tt([]),ye([]),ie({}),A>0?(X(`\u0110\xE3 upload ${A} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),Se(),$()):X("Upload th\u1EA5t b\u1EA1i","danger")},ot=async(A,c)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${A}`,"L\u1ED7i x\xF3a \u1EA3nh"),X("\u0110\xE3 x\xF3a \u1EA3nh","success"),Se(),$()}catch(j){X("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Ft=A=>{var c;A.preventDefault(),(c=Y.current)==null||c.classList.add("dragover")},ct=()=>{var A;(A=Y.current)==null||A.classList.remove("dragover")},vt=A=>{var c;A.preventDefault(),(c=Y.current)==null||c.classList.remove("dragover"),Kt(A.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:C},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},S.title),React.createElement("small",{className:"text-muted"},te.length>0&&React.createElement("span",null,te.length," folder \u2022 "),de.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Ae(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),wt&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:at,onChange:A=>ut(A.target.value),onKeyPress:A=>A.key==="Enter"&&gt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:gt,disabled:y||!at.trim()},y?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Ae(!1),ut("")}},"H\u1EE7y")))),te.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},te.map(A=>React.createElement("div",{key:A.uuid||A.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>F&&F(A)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},A.title),React.createElement("small",{className:"text-muted"},A.subfolderCount>0&&React.createElement("span",null,A.subfolderCount," folder"),A.subfolderCount>0&&A.count>0&&" \u2022 ",A.count>0&&React.createElement("span",null,A.count," \u1EA3nh"),A.subfolderCount===0&&A.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:c=>{c.stopPropagation(),D&&D(A)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:c=>{c.stopPropagation(),Wt(A)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:Y,className:"upload-zone",onClick:()=>{var A;return(A=M.current)==null?void 0:A.click()},onDragOver:Ft,onDragLeave:ct,onDrop:vt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:M,type:"file",multiple:!0,accept:"image/*",onChange:A=>Kt(A.target.files)})),Ge.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Ge.map((A,c)=>React.createElement("div",{key:c,className:"upload-preview-item"},React.createElement("img",{src:A.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>w(c)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Ee,disabled:ve},ve?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),fe||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Fe.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",de.length,")"),de.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Tt},J.length===de.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),J.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},J.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>V(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Ue,disabled:Pe},Pe?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>re([])},React.createElement("i",{className:"fas fa-times"})))),Re?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):de.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},de.map((A,c)=>React.createElement("div",{key:c,className:`image-item ${J.includes(A.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>rt(A.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:J.includes(A.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:J.includes(A.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},J.includes(A.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:A.src,alt:A.caption,style:{opacity:J.includes(A.id)?.7:1,border:J.includes(A.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:j=>{j.stopPropagation(),ot(A.id,c)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),A.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},A.caption)))))),Q&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",J.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>V(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},b.filter(A=>!A.parentId).map(A=>React.createElement(FolderTreeItem,{key:A.uuid||A.id,folder:A,allAlbums:b,currentAlbumId:S.uuid||S.id,targetAlbum:P,onSelect:Z})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>V(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:ae,disabled:!P||le},le?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Ve&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>lt(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>lt(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Ve.src,alt:Ve.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:A=>A.stopPropagation()}),Ve.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Ve.caption)))))}function SearchCenter({showToast:S,onNavigate:C}){const[$,X]=useState(""),[F,D]=useState([]),[L,de]=useState([]),[ue,te]=useState([]),[Ne,Re]=useState("all"),[pe,ve]=useState(null),[Le,fe]=useState("list"),[O,Fe]=useState(!0),[tt,Ge]=useState([]),[ye,Te]=useState([]),ie=useRef(null),[Ve,lt]=useState(!0),[wt,Ae]=useState(!1),at=useRef(null),ut=useRef(null),y=useRef(null),[v,M]=useState(!1),[Y,Q]=useState([]),[V,J]=useState([]),[re,b]=useState(""),T=useRef(null),P=useRef(new Map),[Z,le]=useState("auto"),[ne,ke]=useState({start:0,end:20}),[Se,We]=useState(!1),[rt,ae]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[Pe,bt]=useState(""),[Ue,Tt]=useState(!1),gt=useRef(null),Wt=useRef(null),Kt=s=>s?String(s).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",w=s=>s?String(s).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",H=(s,m)=>{if(!s||!m)return s;const d=new RegExp(`(${m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return s.replace(d,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const s=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),m=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");Q(Array.isArray(s)?s.slice(0,10):[]),J(Array.isArray(m)?m:[])}catch(s){}},[]);const Ee=s=>{if(!s.trim())return;const m=[s,...Y.filter(d=>d!==s)].slice(0,10);Q(m);try{localStorage.setItem("ktm_search_history",JSON.stringify(m))}catch(d){}},ot=s=>{if(!s.trim())return;const m=V.includes(s)?V.filter(d=>d!==s):[s,...V].slice(0,5);J(m);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(m))}catch(d){}},Ft="ktm_search_query_stats_v1",ct="ktm_search_product_stats_v1",vt=(s,m)=>{try{const d=localStorage.getItem(s);if(!d)return m;const _=JSON.parse(d);return _!=null?_:m}catch(d){return m}},A=(s,m)=>{try{localStorage.setItem(s,JSON.stringify(m))}catch(d){}},[c,j]=useState(()=>vt(Ft,{})),[E,oe]=useState(()=>vt(ct,{})),me=useRef(!1),we=useRef(new Map);useEffect(()=>{const s=m=>{m&&(m.key===Ft&&j(vt(Ft,{})),m.key===ct&&oe(vt(ct,{})))};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const Be=s=>{const m=String(s||"").trim();if(!m)return;const d=St(m).trim();if(d.length<3||d==="sdt:"||d==="#"||d.endsWith(":"))return;const _=Date.now(),R=vt(Ft,c&&typeof c=="object"?c:{}),k={...R&&typeof R=="object"?R:{}},g=k[d]&&typeof k[d]=="object"?k[d]:{};k[d]={q:m,count:(Number(g.count)||0)+1,lastAt:_},j(k),A(Ft,k)},Ce=(s,m)=>{if(!s||s._type!=="product")return;const d=String(s.id||"").trim();if(!d)return;const _=Date.now(),R=vt(ct,E&&typeof E=="object"?E:{}),k={...R&&typeof R=="object"?R:{}},g=k[d]&&typeof k[d]=="object"?k[d]:{};k[d]={id:d,name:String(s.name||g.name||"").trim(),code:String(s.code||g.code||"").trim(),count:(Number(g.count)||0)+1,lastAt:_,action:String(m||g.action||"").trim()},oe(k),A(ct,k)},Pt=(s,m)=>{const d=String(s||"").trim();if(!d)return;const _=St(d).trim();if(_.length<3||_==="sdt:"||_==="#"||_.endsWith(":"))return;const R=Date.now(),k=Number(we.current.get(_)||0);if(R-k<3e4)return;const G=(Array.isArray(m)?m:[]).find(ce=>ce&&ce._type==="product");G&&(we.current.set(_,R),Ce(G,"search"))},dt=useMemo(()=>Object.values(c&&typeof c=="object"?c:{}).map(d=>({q:String((d==null?void 0:d.q)||"").trim(),count:Number(d==null?void 0:d.count)||0,lastAt:Number(d==null?void 0:d.lastAt)||0})).filter(d=>d.q&&d.count>0).sort((d,_)=>_.count-d.count||_.lastAt-d.lastAt).slice(0,6),[c]),xt=useMemo(()=>Object.values(E&&typeof E=="object"?E:{}).map(d=>({id:String((d==null?void 0:d.id)||"").trim(),name:String((d==null?void 0:d.name)||"").trim(),code:String((d==null?void 0:d.code)||"").trim(),count:Number(d==null?void 0:d.count)||0,lastAt:Number(d==null?void 0:d.lastAt)||0})).filter(d=>d.id&&d.count>0).sort((d,_)=>_.count-d.count||_.lastAt-d.lastAt).slice(0,8).map(d=>{const _=L.find(R=>R&&R._type==="product"&&String(R.id)===d.id);return _?{...d,item:_}:{...d,item:null}}),[E,L]),jt=(s,m={})=>{const d=String(s||"");Xt(d),m.addToHistory!==!1&&Ee(d),M(!1),Ht(!1),Aa(!1),m.focus!==!1?(me.current=!0,setTimeout(()=>{var k;const R=ie.current;(k=R==null?void 0:R.focus)==null||k.call(R);try{if(m.caret==="end"&&R&&typeof R.setSelectionRange=="function"){const g=String(R.value||"").length;R.setSelectionRange(g,g)}}catch(g){}},0)):(me.current=!1,setTimeout(()=>{var R,k,g,G;try{(k=(R=ie.current)==null?void 0:R.blur)==null||k.call(R),(G=(g=document.activeElement)==null?void 0:g.blur)==null||G.call(g)}catch(ce){}},0))},[Me,Mt]=useState(null),[Oa,Ut]=useState(!1),[je,pt]=useState(null),[Ca,Aa]=useState(!1),[ta,aa]=useState(!1),[na,fa]=useState(null),[Et,Bt]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),_a=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Ka=s=>{var m,d;s._type==="product"&&(pt(s),Bt({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(d=(m=s.commission_percent)!=null?m:s.commissionPercent)!=null?d:""}),Ut(!0))},ft=async()=>{if(je)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${je.id}`,Et,"L\u1ED7i c\u1EADp nh\u1EADt"),S("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),Ut(!1),pt(null),zt()}catch(s){S(s.message,"danger")}},ja=async s=>{const m=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${m} "${s.name}"?`))try{let d="";s._type==="product"?d=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?d=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(d=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(d,"L\u1ED7i x\xF3a"),S(`\u0110\xE3 x\xF3a ${m}`,"success"),zt()}catch(d){S(d.message,"danger")}},ha=async s=>{try{const m=na?`${API_BASE}/api/products?id=${na.id}`:`${API_BASE}/api/products`;na?await window.KTM.api.putJSON(m,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(m,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),S(na?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),aa(!1),fa(null),zt()}catch(m){S(m.message,"danger")}},sa="ktm_admin_data_cache_v1",ba=1e3*60*10,zt=async()=>{let s=null,m=!1;const d=window.KTM.cache.read(sa,{ttlMs:ba,validate:Array.isArray});d.hit?(s=d.value,console.log("[CACHE] Using cache, items:",s.length),de(s),D(s),Fe(!1),m=!0):d.status==="miss"?console.log("[CACHE] No cache found"):d.status==="expired"||d.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):d.status==="error"&&console.error("[CACHE] Error parsing cache"),m||Fe(!0);try{const _=async(He,f)=>{try{const xe=await window.KTM.api.getJSON(He,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return xe!=null?xe:f}catch(xe){return f}},[R,k,g]=await Promise.all([_(`${API_BASE}/api/products?fields=search`,[]),_(`${API_BASE}/api/albums`,[]),_(`${API_BASE}/api/video-folders?withVideos=true`,[])]),G=Array.isArray(R)?R.map(He=>({...He,_type:"product",_source:"database"})):[];Ge(k);let ce=[];Array.isArray(k)&&k.length>0&&(await Promise.all(k.map(f=>_(`${API_BASE}/api/albums/${f.id}`,{})))).forEach((f,xe)=>{const Ot=k[xe];f.images&&f.images.length>0&&f.images.forEach(yt=>{ce.push({id:yt.id,name:yt.caption||"\u1EA2nh t\u1EEB "+Ot.title,image:yt.src,folder:Ot.title,_type:"album",_source:"database"})})}),Te(g);let W=[];Array.isArray(g)&&g.forEach(He=>{He.videos&&He.videos.forEach(f=>{W.push({id:f.id,name:f.title,folder:He.name,image:f.thumb,youtubeId:f.youtubeId,url:f.url,_type:"video",_source:"database"})})});const ee=[...G,...ce,...W];(!s||JSON.stringify(ee)!==JSON.stringify(s))&&(de(ee),D(ee),window.KTM.cache.write(sa,ee))}catch(_){console.error("Song song fetch error:",_)}Fe(!1)};useEffect(()=>{zt(),setTimeout(()=>{var m;return(m=ie.current)==null?void 0:m.focus()},100);const s=m=>{var d,_;(m.ctrlKey||m.metaKey)&&m.key==="k"&&(m.preventDefault(),M(!0),setTimeout(()=>{var R;return(R=T.current)==null?void 0:R.focus()},0)),m.key==="/"&&!v&&((d=document.activeElement)==null?void 0:d.tagName)!=="INPUT"&&(m.preventDefault(),(_=ie.current)==null||_.focus()),m.key==="Escape"&&v&&M(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[v]);const St=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(m){return String(s!=null?s:"").toLowerCase()}},Ta=s=>{const d=St(s).trim().split(/\s+/).filter(Boolean).map(ce=>{const W=String(ce||"").trim();return W?W.startsWith("#")?W.slice(1):W.startsWith("sdt:")?W.slice(4):W.startsWith("phone:")?W.slice(6):W:""}).filter(Boolean),_=d.includes("anh"),R=d.includes("video"),k=d.filter(ce=>ce!=="anh"&&ce!=="video"),g=k.join(" "),G=new Set(["product"]);return _&&G.add("album"),R&&G.add("video"),{allowedTypes:G,includeAlbum:_,includeVideo:R,contentTokens:k,cleanedQuery:g}},ia=(s,m,d)=>{var xe,Ot,yt,Qt,Gt;const _=Array.isArray(m)?m:[],R=St(d).trim();if(!_.length&&!R)return 0;const k=St((xe=s==null?void 0:s.name)!=null?xe:""),g=St((Ot=s==null?void 0:s.code)!=null?Ot:""),G=St((yt=s==null?void 0:s.category)!=null?yt:""),ce=St((Qt=s==null?void 0:s.note)!=null?Qt:""),W=St((Gt=s==null?void 0:s.folder)!=null?Gt:"");if(!`${k} ${g} ${G} ${ce} ${W}`.trim())return 0;const $e=k.replace(/\s+/g,""),He=R.replace(/\s+/g,"");let f=0;R&&(k===R&&(f+=220),k.includes(R)&&(f+=140),k.startsWith(R)&&(f+=160),He&&($e===He?f+=280:$e.startsWith(He)?f+=180:$e.includes(He)&&(f+=110)),g&&g===R&&(f+=180),g&&g.includes(R)&&(f+=90));for(const Zt of _){if(!Zt)continue;const Rt=new RegExp(`(?:^|\\s)${Zt.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`),ra=String(Zt).replace(/\s+/g,"");k.includes(Zt)&&(f+=35),Rt.test(k)&&(f+=25),ra&&($e===ra?f+=90:$e.startsWith(ra)?f+=50:$e.includes(ra)&&(f+=28)),g&&g.includes(Zt)&&(f+=20),g&&Rt.test(g)&&(f+=10),G&&G.includes(Zt)&&(f+=12),W&&W.includes(Zt)&&(f+=12),ce&&ce.includes(Zt)&&(f+=6)}return f>0&&k&&(f+=Math.max(0,10-Math.min(10,Math.floor(k.length/10)))),f},Jt=(s,m,d)=>{const _=Array.isArray(s)?s:[];return _.length?_.map((k,g)=>({it:k,idx:g,score:ia(k,m,d)})).sort((k,g)=>g.score!==k.score?g.score-k.score:k.idx-g.idx).map(k=>k.it):[]},Da=async(s,m)=>{if(!(!Ve||m.length===0)){Ae(!0);try{const d=m.map(R=>({id:R.id,name:R.name,price:R.price,category:R.category,note:R.note,folder:R.folder,_type:R._type})),_=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:d},"AI Search error");if(_&&_.matchedIds&&_.matchedIds.length>0){const{contentTokens:R,cleanedQuery:k}=Ta(s),g=new Set(_.matchedIds),G=m.filter(ce=>g.has(ce.id)).sort((ce,W)=>ia(W,R,k)-ia(ce,R,k));G.length>0&&D(G)}else _&&_.matchedIds&&_.matchedIds.length===0&&D([])}catch(d){console.error("AI Search error:",d)}Ae(!1)}},Xt=s=>{if(X(s),b(s),ut.current&&clearTimeout(ut.current),at.current&&clearTimeout(at.current),y.current&&y.current.abort(),!s.trim()){ma(Ne);return}const d=`v2|${St(s).trim().replace(/\s+/g,"")}|${Ne}`;if(P.current.has(d)){D(P.current.get(d));return}const{allowedTypes:_,contentTokens:R,cleanedQuery:k}=Ta(s);ut.current=setTimeout(()=>{const g=L.filter(W=>{if(!_.has(W==null?void 0:W._type))return!1;if(R.length===0)return!0;const ee=Kt(Object.entries(W).filter(([xe])=>!xe.startsWith("_")).map(([,xe])=>String(xe||"")).join(" ")),$e=W.phone?w(W.phone):"",He=`${ee} ${$e}`.trim(),f=He.replace(/\s+/g,"");return R.every(xe=>{const Ot=String(xe||"").trim();return Ot?He.includes(Ot)||f.includes(Ot.replace(/\s+/g,"")):!0})});let G=g;Ne!=="all"&&(G=g.filter(W=>(W==null?void 0:W._type)===Ne));const ce=Jt(G,R,k);if(Be(s),Pt(s,ce),P.current.size>20){const W=P.current.keys().next().value;P.current.delete(W)}P.current.set(d,ce),D(ce),Ve&&k.length>=3&&(at.current=setTimeout(()=>{Da(k,G)},500))},200)},ma=s=>{Re(s);const{allowedTypes:m,contentTokens:d}=Ta($),{cleanedQuery:_}=Ta($);let R=L.filter(k=>m.has(k==null?void 0:k._type));s!=="all"&&(R=R.filter(k=>(k==null?void 0:k._type)===s)),$.trim()&&d.length>0&&(R=R.filter(k=>{const g=St(Object.entries(k).filter(([ee])=>!ee.startsWith("_")).map(([,ee])=>String(ee||"")).join(" ")),G=k.phone?w(k.phone):"",ce=`${g} ${G}`.trim(),W=ce.replace(/\s+/g,"");return d.every(ee=>{const $e=String(ee||"").trim();return $e?ce.includes($e)||W.includes($e.replace(/\s+/g,"")):!0})})),D(Jt(R,d,_))},$t=(s,m,d)=>{d&&d.item&&Ce(d.item,d.action||"copy"),window.KTM.clipboard.writeText(s).then(()=>{ve(m),S("\u0110\xE3 copy!","success"),setTimeout(()=>ve(null),1500)})},I=async(s,m,d)=>{try{d&&d.item&&Ce(d.item,d.action||"copy_image"),await window.KTM.clipboard.writeImageFromUrl(s),ve(m+"-img"),S("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>ve(null),1500)}catch(_){$t(s,m+"-img",d)}},se=s=>{let m=s.toLowerCase();const d=[],_=L.filter(g=>g._type==="product");if(m.includes("ty")||m.includes("xy lanh")){if(m.includes("gi\u1EEFa")||m.includes("giua")){const g=_.find(G=>{var ce;return(ce=G.name)==null?void 0:ce.toLowerCase().includes("xy lanh gi\u1EEFa")});g&&!d.find(G=>G.id===g.id)&&d.push(g)}if(m.includes("nghi\xEAng")||m.includes("nghieng")){const g=_.find(G=>{var ce;return(ce=G.name)==null?void 0:ce.toLowerCase().includes("xy lanh nghi\xEAng")});g&&!d.find(G=>G.id===g.id)&&d.push(g)}if(m.includes("\u1EE7i")||m.includes("ui")){const g=_.find(G=>{var ce;return(ce=G.name)==null?void 0:ce.toLowerCase().includes("xy lanh \u1EE7i")});g&&!d.find(G=>G.id===g.id)&&d.push(g)}}const R=m.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(R){const g=R[1],G=R[2],ce=_.find(W=>{var $e;const ee=(($e=W.name)==null?void 0:$e.toLowerCase())||"";return ee.includes("combo")&&ee.includes(`${g} tay`)&&(ee.includes(`${G} xy`)||ee.includes(`${G} xylanh`))});if(ce&&!d.find(W=>W.id===ce.id))d.push(ce);else{const W=_.find(ee=>{var He;const $e=((He=ee.name)==null?void 0:He.toLowerCase())||"";return $e.includes("combo")&&$e.includes(`${g} tay`)});W&&!d.find(ee=>ee.id===W.id)&&d.push(W)}}if(m.includes("combo")&&!R){const g=m.match(/combo.*?(\d+)\s*tay/);if(g){const G=g[1];_.filter(W=>{var $e;const ee=(($e=W.name)==null?void 0:$e.toLowerCase())||"";return ee.includes("combo")&&ee.includes(`${G} tay`)}).forEach(W=>{d.find(ee=>ee.id===W.id)||d.push(W)})}}const k=m.match(/van\s*(\d+)\s*tay/);if(k&&!m.includes("ty")&&!m.includes("combo")){const g=k[1],G=_.find(ce=>{var ee;const W=((ee=ce.name)==null?void 0:ee.toLowerCase())||"";return W.includes(`van ${g} tay`)&&!W.includes("combo")});G&&!d.find(ce=>ce.id===G.id)&&d.push(G)}return d.slice(0,4)},Oe=async s=>{if(!s.trim())return;const m={role:"user",content:s,attachments:[]};ae(_=>[..._,m]),bt(""),Tt(!0);const d=se(s);setTimeout(()=>{var _;return(_=gt.current)==null?void 0:_.scrollIntoView({behavior:"smooth"})},100);try{const R=L.filter(ee=>ee._type==="product").map(ee=>{let $e=`- ${ee.name}`;return ee.code&&($e+=` (M\xE3: ${ee.code})`),ee.price&&($e+=` - Gi\xE1: ${ee.price.replace(/[đ\s]/g,"")}\u0111`),ee.category&&($e+=` [${ee.category}]`),ee.note&&($e+=` (${ee.note})`),$e}).join(`
`),g=rt.slice(-6).map(ee=>`${ee.role==="user"?"Kh\xE1ch":"AI"}: ${ee.content}`).join(`
`),G=g?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${g}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${R}`:R,W=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:G,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";ae(ee=>[...ee,{role:"assistant",content:W,attachments:d}])}catch(_){console.error("AI Error:",_);const R=s.toLowerCase(),k=L.filter(G=>{const ce=Object.values(G).join(" ").toLowerCase();return R.split(" ").some(W=>ce.includes(W))});let g="";k.length>0?(g=`T\xECm th\u1EA5y ${k.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,k.slice(0,5).forEach(G=>{g+=`\u2022 ${G.name}`,G.price&&(g+=` - ${G.price.replace(/[đ\s]/g,"")}\u0111`),G.note&&(g+=` (${G.note})`),g+=`
`}),k.length>5&&(g+=`
...v\xE0 ${k.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):g='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',ae(G=>[...G,{role:"assistant",content:g,attachments:k.slice(0,4)}])}Tt(!1),setTimeout(()=>{var _,R;(_=gt.current)==null||_.scrollIntoView({behavior:"smooth"}),(R=Wt.current)==null||R.focus()},100)};function nt({show:s,product:m,categories:d,onClose:_,onSave:R}){const[k,g]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[G,ce]=useState(!1),[W,ee]=useState(!1),$e=useRef(null),He=K=>window.KTM.money.formatVNDInputDigits(K),f=K=>{const q=window.KTM.money.getDigits(String(K!=null?K:"")),U=Number(q);return q&&Number.isFinite(U)?Math.trunc(U):0},xe=(K,q)=>{if(K==null||K==="")return[];let U=K;if(typeof U=="string"){const ge=U.trim();if(!ge)return[];try{U=JSON.parse(ge)}catch(be){return[]}}if(!Array.isArray(U))return[];const he=f(q);return U.map(ge=>{var Ke;if(!ge||typeof ge!="object")return null;const be=String((Ke=ge.name)!=null?Ke:"").trim(),qe=(Array.isArray(ge.options)?ge.options:[]).map(Ze=>{var la,va,ya,Na,Fa,Ra,hn;if(!Ze||typeof Ze!="object")return null;const Nt=String((la=Ze.label)!=null?la:"").trim();if(!Nt)return null;const _t=(Fa=(Na=(ya=(va=Ze.price)!=null?va:Ze.priceValue)!=null?ya:Ze.unit_price)!=null?Na:Ze.unitPrice)!=null?Fa:null,qt=Number(_t);let oa=Number.isFinite(qt)?Math.trunc(qt):null;if(oa==null){const wa=(hn=(Ra=Ze.price_delta)!=null?Ra:Ze.priceDelta)!=null?hn:null,Ha=Number(wa);Number.isFinite(Ha)&&(oa=he+Math.trunc(Ha))}oa==null&&(oa=he);const ea=String(Math.max(0,Math.trunc(Number(oa)||0)));return{label:Nt,price:Math.max(0,Math.trunc(Number(oa)||0)),priceDigits:ea}}).filter(Boolean);return{name:be||"Bi\u1EBFn th\u1EC3",options:qe}}).filter(Boolean)},Ot=K=>{if(K==null||K==="")return[];let q=K;if(typeof q=="string"){const U=q.trim();if(!U)return[];try{q=JSON.parse(U)}catch(he){return[]}}return q&&typeof q=="object"&&!Array.isArray(q)&&(q=Object.entries(q).map(([U,he])=>({key:U,value:he}))),Array.isArray(q)?q.map(U=>{var qe,Ke,Ze,Nt,_t;if(!U||typeof U!="object")return null;const he=String((Ze=(Ke=(qe=U.key)!=null?qe:U.name)!=null?Ke:U.label)!=null?Ze:"").trim(),ge=String((Nt=U.value)!=null?Nt:"").trim(),be=String((_t=U.unit)!=null?_t:"").trim();return he?{key:he,value:ge,unit:be}:null}).filter(Boolean):[]};useEffect(()=>{var K,q;if(m)if(g({name:m.name||"",code:m.code||"",price:m.price||"",image:m.image||"",category:m.category||"",note:m.note||"",sort_order:m.sort_order||0,commission_percent:(q=(K=m.commission_percent)!=null?K:m.commissionPercent)!=null?q:5,variants:xe(m.variants,m.price),attributes:Ot(m.attributes)}),m.price){const U=window.KTM.money.getDigits(m.price);ra(U),g(he=>({...he,price:He(U)}))}else ra("");else g({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),ra("")},[m,s]);const yt=K=>{g(q=>{var qe;const U=f(q.price),he=String(U),ge=Array.isArray(q.variants)?[...q.variants]:[],be={...ge[K]||{},options:Array.isArray((qe=ge[K])==null?void 0:qe.options)?[...ge[K].options]:[]};return be.options=be.options.map(Ke=>({label:String((Ke==null?void 0:Ke.label)||""),price:U,priceDigits:he})),ge[K]=be,{...q,variants:ge}})},Qt=()=>{g(K=>{const q=f(K.price),U=String(q),ge=(Array.isArray(K.variants)?[...K.variants]:[]).map(be=>{const qe=(Array.isArray(be==null?void 0:be.options)?be.options:[]).map(Ke=>({label:String((Ke==null?void 0:Ke.label)||""),price:q,priceDigits:U}));return{name:String((be==null?void 0:be.name)||"Bi\u1EBFn th\u1EC3"),options:qe}});return{...K,variants:ge}})},[Gt,Zt]=React.useState(""),[Rt,ra]=React.useState(""),Qe=K=>{const q=window.KTM.money.nextPriceInputState(K.target.value,Rt);ra(q.digits),g({...k,price:q.price})},ga=async(K,q=2)=>{const U=q*1024*1024;if(K.size<=U)return K;try{const he=await createImageBitmap(K),ge=document.createElement("canvas");let be=he.width,qe=he.height;const Ke=1200;return(be>Ke||qe>Ke)&&(be>qe?(qe=Math.round(qe/be*Ke),be=Ke):(be=Math.round(be/qe*Ke),qe=Ke)),ge.width=be,ge.height=qe,ge.getContext("2d").drawImage(he,0,0,be,qe),he.close(),new Promise((Nt,_t)=>{ge.toBlob(qt=>{qt?Nt(new File([qt],K.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):_t(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(he){throw console.error("Compress error:",he),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},fn=async K=>{var he;const q=K.target.files[0];if(!q)return;if(!(q.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(q.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ee(!0);try{const ge=await ga(q),be=await window.KTM.cloudinary.uploadImage({file:ge,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!be.secure_url)throw console.error("Cloudinary error:",be),new Error(((he=be.error)==null?void 0:he.message)||"Upload failed");g(qe=>({...qe,image:be.secure_url}))}catch(ge){console.error("Upload error:",ge),alert("L\u1ED7i upload \u1EA3nh: "+ge.message)}ee(!1),K.target.value=""},$a=async K=>{K.preventDefault(),ce(!0);const q={...k,variants:xe(k.variants,k.price),attributes:Ot(k.attributes)};await R(q),ce(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),m?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:_})),React.createElement("form",{onSubmit:$a},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:k.name,onChange:K=>g({...k,name:K.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:k.code,onChange:K=>g({...k,code:K.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:k.price,onChange:Qe,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:k.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:K=>g({...k,commission_percent:K.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:k.category,onChange:K=>g({...k,category:K.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),d.map(K=>React.createElement("option",{key:K,value:K},K)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:k.note,onChange:K=>g({...k,note:K.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(k.attributes)?k.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(k.attributes)?k.attributes:[]).map((K,q)=>React.createElement("div",{key:q,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(K==null?void 0:K.key)||"",onChange:U=>{const he=U.target.value;g(ge=>{const be=Array.isArray(ge.attributes)?[...ge.attributes]:[];return be[q]={...be[q]||{},key:he},{...ge,attributes:be}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(K==null?void 0:K.value)||"",onChange:U=>{const he=U.target.value;g(ge=>{const be=Array.isArray(ge.attributes)?[...ge.attributes]:[];return be[q]={...be[q]||{},value:he},{...ge,attributes:be}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(K==null?void 0:K.unit)||"",onChange:U=>{const he=U.target.value;g(ge=>{const be=Array.isArray(ge.attributes)?[...ge.attributes]:[];return be[q]={...be[q]||{},unit:he},{...ge,attributes:be}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{g(U=>{const he=Array.isArray(U.attributes)?[...U.attributes]:[];return he.splice(q,1),{...U,attributes:he}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{g(K=>{const q=Array.isArray(K.attributes)?[...K.attributes]:[];return q.push({key:"",value:"",unit:""}),{...K,attributes:q}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(k.variants)?k.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(k.variants)?k.variants:[]).map((K,q)=>React.createElement("div",{key:q,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(K==null?void 0:K.name)||"",onChange:U=>{const he=U.target.value;g(ge=>{var qe;const be=Array.isArray(ge.variants)?[...ge.variants]:[];return be[q]={...be[q]||{},name:he,options:Array.isArray((qe=be[q])==null?void 0:qe.options)?be[q].options:[]},{...ge,variants:be}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>yt(q),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(K==null?void 0:K.options)||K.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{g(U=>{const he=Array.isArray(U.variants)?[...U.variants]:[];return he.splice(q,1),{...U,variants:he}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(K==null?void 0:K.options)?K.options:[]).map((U,he)=>{var ge,be;return React.createElement("div",{key:he,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(U==null?void 0:U.label)||"",onChange:qe=>{const Ke=qe.target.value;g(Ze=>{var ea,la,va,ya,Na;const Nt=Array.isArray(Ze.variants)?[...Ze.variants]:[],_t={...Nt[q]||{},options:Array.isArray((ea=Nt[q])==null?void 0:ea.options)?[...Nt[q].options]:[]},qt=Number((va=(la=_t.options[he])==null?void 0:la.price)!=null?va:0)||0,oa=String((Na=(ya=_t.options[he])==null?void 0:ya.priceDigits)!=null?Na:Math.max(0,Math.trunc(qt)));return _t.options[he]={..._t.options[he]||{},label:Ke,price:Math.max(0,Math.trunc(qt)),priceDigits:oa},Nt[q]=_t,{...Ze,variants:Nt}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:He(String((be=U==null?void 0:U.priceDigits)!=null?be:window.KTM.money.getDigits(String((ge=U==null?void 0:U.price)!=null?ge:"")))),onChange:qe=>{g(Ke=>{var va,ya,Na,Fa,Ra;const Ze=String((ya=U==null?void 0:U.priceDigits)!=null?ya:window.KTM.money.getDigits(String((va=U==null?void 0:U.price)!=null?va:""))),Nt=window.KTM.money.nextPriceInputState(qe.target.value,Ze),_t=String((Na=Nt.digits)!=null?Na:""),qt=Number(_t),oa=Number.isFinite(qt)?Math.max(0,Math.trunc(qt)):0,ea=Array.isArray(Ke.variants)?[...Ke.variants]:[],la={...ea[q]||{},options:Array.isArray((Fa=ea[q])==null?void 0:Fa.options)?[...ea[q].options]:[]};return la.options[he]={...la.options[he]||{},label:String(((Ra=la.options[he])==null?void 0:Ra.label)||""),price:oa,priceDigits:_t},ea[q]=la,{...Ke,variants:ea}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{g(qe=>{var Nt;const Ke=Array.isArray(qe.variants)?[...qe.variants]:[],Ze={...Ke[q]||{},options:Array.isArray((Nt=Ke[q])==null?void 0:Nt.options)?[...Ke[q].options]:[]};return Ze.options.splice(he,1),Ke[q]=Ze,{...qe,variants:Ke}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{g(U=>{var qe;const he=Array.isArray(U.variants)?[...U.variants]:[],ge={...he[q]||{},options:Array.isArray((qe=he[q])==null?void 0:qe.options)?[...he[q].options]:[]},be=f(U.price);return ge.options.push({label:"",price:be,priceDigits:String(be)}),he[q]=ge,{...U,variants:he}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{g(K=>{const q=f(K.price),U=Array.isArray(K.variants)?[...K.variants]:[],he=String(q);return U.push({name:"Size",options:[{label:"S",price:q,priceDigits:he},{label:"M",price:q,priceDigits:he},{label:"L",price:q,priceDigits:he}]}),{...K,variants:U}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Qt,disabled:!Array.isArray(k.variants)||k.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},k.image?React.createElement(React.Fragment,null,React.createElement("img",{src:k.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>g({...k,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var K;return(K=$e.current)==null?void 0:K.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:$e,type:"file",accept:"image/*",className:"d-none",onChange:fn}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var K;return(K=$e.current)==null?void 0:K.click()},disabled:W,style:{borderRadius:"10px"}},W?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:k.image,onChange:K=>g({...k,image:K.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:_,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:G,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},G?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const kt=s=>window.KTM.money.formatVND(s),It=s=>{if(s==null||s==="")return[];let m=s;if(typeof m=="string"){const d=m.trim();if(!d)return[];try{m=JSON.parse(d)}catch(_){return[]}}return Array.isArray(m)?m:[]},Ye=s=>{if(s==null||s==="")return[];let m=s;if(typeof m=="string"){const d=m.trim();if(!d)return[];try{m=JSON.parse(d)}catch(_){return[]}}return m&&typeof m=="object"&&!Array.isArray(m)&&(m=Object.entries(m).map(([d,_])=>({key:d,value:_}))),Array.isArray(m)?m:[]},Dt=(s,m={})=>{var k;const d=Ye(s).map(g=>{var G,ce,W,ee,$e;return{key:String((W=(ce=(G=g==null?void 0:g.key)!=null?G:g==null?void 0:g.name)!=null?ce:g==null?void 0:g.label)!=null?W:"").trim(),value:String((ee=g==null?void 0:g.value)!=null?ee:"").trim(),unit:String(($e=g==null?void 0:g.unit)!=null?$e:"").trim()}}).filter(g=>!!g.key);if(!d.length)return null;const _=!!m.compact,R=String((k=m.className)!=null?k:"").trim();return React.createElement("div",{className:`ktm-variants-preview${_?" compact":""}${R?" "+R:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},d.map((g,G)=>{const ce=g.key,W=`${g.value||""}${g.unit?(g.value?" ":"")+g.unit:""}`.trim();return React.createElement("div",{key:`${ce}-${G}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ce),W?React.createElement("span",{className:"ktm-chip ktm-chip-option"},W):null)})))},Yt=(s,m={})=>{var ce;const d=It(s).map(W=>{var ee;return{name:String((ee=W==null?void 0:W.name)!=null?ee:"").trim(),options:Array.isArray(W==null?void 0:W.options)?W.options:[]}}).map(W=>({...W,options:W.options.map(ee=>{var $e;return{label:String(($e=ee==null?void 0:ee.label)!=null?$e:"").trim(),price:Number(ee==null?void 0:ee.price)}}).filter(ee=>!!ee.label)})).filter(W=>W.options.length>0);if(!d.length)return null;const _=Number.isFinite(m.maxGroups)?Math.max(1,Math.trunc(m.maxGroups)):d.length,R=Number.isFinite(m.maxOptionsPerGroup)?Math.max(1,Math.trunc(m.maxOptionsPerGroup)):3,k=!!m.compact,g=String((ce=m.className)!=null?ce:"").trim(),G=d.slice(0,_);return React.createElement("div",{className:`ktm-variants-preview${k?" compact":""}${g?" "+g:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},G.map((W,ee)=>{const $e=W.name||"Bi\u1EBFn th\u1EC3",He=W.options.slice(0,R),f=W.options.length-He.length;return React.createElement("div",{key:`${$e}-${ee}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},$e),He.map((xe,Ot)=>{const yt=xe.price,Qt=Number.isFinite(yt)&&yt>=0?kt(Math.trunc(yt)):"",Gt=Qt?`${xe.label} \xB7 ${Qt}`:xe.label;return React.createElement("span",{key:`${$e}-${ee}-${Ot}`,className:"ktm-chip ktm-chip-option"},Gt)}),f>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",f))})))},Ct=(s,m)=>{const d=s._type==="product",_=s._type==="album",R=s._type==="video",k=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),g=d?Dt(s.attributes,{compact:Le==="grid",className:Le==="grid"?"meta text-muted":"text-muted"}):null,G=d?Yt(s.variants,{compact:Le==="grid",maxOptionsPerGroup:999,className:Le==="grid"?"meta text-muted":"text-muted"}):null;return Le==="grid"?React.createElement("div",{key:s.id||m,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>{Ce(s,"preview"),Mt({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${R?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${d?"product":_?"album":"video"}`},d?"SP":_?"\u1EA2nh":"Video"),k&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),g&&React.createElement("div",{style:{marginTop:2}},g),G&&React.createElement("div",{style:{marginTop:2}},G),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:pe===s.id+"-img"?"copied":"",onClick:()=>I(s.image,s.id,{item:s,action:"copy_image"})},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:pe===s.id+"-price"?"copied":"",onClick:()=>$t(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||m,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${d?"product":_?"album":"video"}`},d?"S\u1EA3n ph\u1EA9m":_?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>{Ce(s,"preview"),Mt({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${R?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),k&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),g&&React.createElement("div",{style:{marginTop:4}},g),G&&React.createElement("div",{style:{marginTop:4}},G)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),R&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},d&&React.createElement("button",{onClick:()=>{Ce(s,"create_order"),C&&C("orders","create",{productId:s.id})}},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:pe===s.id+"-price"?"copied":"",onClick:()=>$t(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:pe===s.id+"-name"?"copied":"",onClick:()=>$t(s.name,s.id+"-name",{item:s,action:"copy_name"})},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),R&&s.youtubeId&&React.createElement("button",{className:pe===s.id+"-yt"?"copied":"",onClick:()=>$t(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),d&&React.createElement("button",{className:"action-edit",onClick:()=>Ka(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>ja(s)},React.createElement("i",{className:"fas fa-trash"}))))},[At,Ht]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"search-suggestions mobile-only"},React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"G\u1EE3i \xFD nhanh"),React.createElement("div",{className:"search-suggestions-row"},[{label:"van 2 tay",query:"van 2 tay"},{label:"combo r\u1EBB",query:"combo r\u1EBB"},{label:"xylanh",query:"xylanh"},{label:"sdt:\u2026",query:"sdt:",caret:"end",addToHistory:!1},{label:"#m\xE3\u2026",query:"#",caret:"end",addToHistory:!1}].map(s=>React.createElement("button",{key:s.label,type:"button",className:"suggestion-chip",onClick:()=>jt(s.query,{caret:s.caret,addToHistory:s.addToHistory,focus:!1})},s.label)))),xt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"S\u1EA3n ph\u1EA9m hay t\xECm"),React.createElement("div",{className:"search-suggestions-row"},xt.map(s=>{var R,k;const m=(((R=s.item)==null?void 0:R.name)||s.name||"").trim();if(!m)return null;const d=String(((k=s.item)==null?void 0:k.code)||s.code||"").trim(),_=d?`#${d}`:m;return React.createElement("button",{key:s.id,type:"button",className:"suggestion-chip suggestion-chip-popular",onClick:()=>{s.item&&Ce(s.item,"suggestion"),jt(_,{caret:"end",focus:!1})},title:d?`#${d}`:m},m)}))),dt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"T\xECm g\u1EA7n \u0111\xE2y / hay d\xF9ng"),React.createElement("div",{className:"search-suggestions-row"},dt.map(s=>React.createElement("button",{key:s.q,type:"button",className:"suggestion-chip suggestion-chip-query",onClick:()=>jt(s.q,{caret:"end",focus:!1}),title:`${s.q} (${s.count})`},s.q))))),React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,F.length)," k\u1EBFt qu\u1EA3",Ve&&$.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Ne!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Ne==="product"?"S\u1EA3n ph\u1EA9m":Ne==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Le==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>fe("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Le==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>fe("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},O?React.createElement("div",null,[...Array(8)].map((s,m)=>React.createElement("div",{key:m,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):F.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',$,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{X(""),Xt("")}},"Xem t\u1EA5t c\u1EA3")):Le==="grid"?React.createElement("div",{className:"product-grid-mobile"},F.map((s,m)=>Ct(s,m))):React.createElement("div",null,F.map((s,m)=>Ct(s,m)))),At&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Ht(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Ne==="all"?"active":""}`,onClick:()=>{ma("all"),Ht(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Ne==="product"?"active":""}`,onClick:()=>{ma("product"),Ht(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Ne==="album"?"active":""}`,onClick:()=>{ma("album"),Ht(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Ne==="video"?"active":""}`,onClick:()=>{ma("video"),Ht(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Ve,onChange:s=>lt(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:ie,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:$,onChange:s=>Xt(s.target.value)}),React.createElement("button",{className:`filter-btn ${At||Ne!=="all"?"active":""}`,onClick:()=>Ht(!At)},React.createElement("i",{className:"fas fa-filter"})))),v&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>M(!1)},React.createElement("div",{className:"search-palette",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:T,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:re,onChange:s=>Xt(s.target.value),onKeyDown:s=>{s.key==="Enter"&&F.length>0?(Ee(re),M(!1)):s.key==="Escape"&&M(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>M(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((s,m)=>React.createElement("span",{key:s,className:`filter-chip ${Ne===["all","product","album","video"][m]?"active":""}`,onClick:()=>{ma(["all","product","album","video"][m])}},s)))),V.length>0&&!re.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},V.map((s,m)=>React.createElement("div",{key:m,className:"palette-item",onClick:()=>{Xt(s),Ee(s)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,s),React.createElement("button",{className:"unsave-btn",onClick:d=>{d.stopPropagation(),ot(s)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),Y.length>0&&!re.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},Y.map((s,m)=>React.createElement("div",{key:m,className:"palette-item",onClick:()=>{Xt(s)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,s),React.createElement("button",{className:"save-btn",onClick:d=>{d.stopPropagation(),ot(s)}},React.createElement("i",{className:`fas fa-star${V.includes(s)?"":"-o"}`})))))),re.trim()&&F.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",F.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},F.slice(0,8).map((s,m)=>React.createElement("div",{key:s.id||m,className:"palette-result-item",onClick:()=>{Ee(re),M(!1)}},s.image&&React.createElement("img",{src:s.image,alt:s.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},s.name),s.price&&React.createElement("div",{className:"result-meta"},s.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:d=>{d.stopPropagation(),ot(re)}},React.createElement("i",{className:`fas fa-star${V.includes(re)?"":"-o"}`})))))),re.trim()&&F.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',re,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:Ca?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>We(!0),onTouchStart:()=>We(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Se&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>We(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},rt.map((s,m)=>React.createElement("div",{key:m,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:pe===`chat-${m}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:pe===`chat-${m}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),ve(`chat-${m}`),setTimeout(()=>ve(null),1500)}},React.createElement("i",{className:`fas ${pe===`chat-${m}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((d,_)=>React.createElement("div",{key:_,style:{width:70},className:"text-center"},d.image&&React.createElement("img",{src:d.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>Mt({url:d.image,name:d.name,price:d.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},d.name),d.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},d.price.replace(/[đ\s]/g,""),"\u0111"))))))),Ue&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:gt})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>Oe(s),disabled:Ue,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),Oe(Pe)},className:"chat-input-wrap"},React.createElement("input",{ref:Wt,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:Pe,onChange:s=>bt(s.target.value),disabled:Ue}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Ue||!Pe.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),Me&&React.createElement("div",{className:"preview-modal",onClick:()=>Mt(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>Mt(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:Me.url,alt:Me.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},Me.name),Me.price&&React.createElement("div",{className:"price"},Me.price.replace(/[đ\s]/g,""),"\u0111"),Me.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},Me.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:pe==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:pe==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>I(Me.url,"preview")},React.createElement("i",{className:`fas ${pe==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),Me.price&&React.createElement("button",{className:pe==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>$t(Me.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${pe==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(nt,{show:ta,product:na,categories:ue,onClose:()=>{aa(!1),fa(null)},onSave:ha}),React.createElement("div",{className:`fab-container mobile-only ${Ca?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{Aa(!1),aa(!0),fa(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{Aa(!1),C&&C("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${Ca?"open":""}`,onClick:()=>Aa(!Ca)},React.createElement("i",{className:"fas fa-plus"}))),Oa&&je&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>Ut(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Et.name,onChange:s=>Bt({...Et,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Et.code,onChange:s=>Bt({...Et,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Et.price,onChange:s=>Bt({...Et,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Et.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>Bt({...Et,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Et.category,onChange:s=>Bt({...Et,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),_a.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Et.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>Bt({...Et,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>Ut(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:ft},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:S,showToast:C}){const[$,X]=useState([]),[F,D]=useState([]),[L,de]=useState(!0),[ue,te]=useState(null),[Ne,Re]=useState(!1),[pe,ve]=useState(null),[Le,fe]=useState(!1),[O,Fe]=useState(null),[tt,Ge]=useState(!1),[ye,Te]=useState(null),[ie,Ve]=useState(!1),[lt,wt]=useState(!1),[Ae,at]=useState(null),[ut,y]=useState(!1),[v,M]=useState(null),[Y,Q]=useState([]);useEffect(()=>{V()},[]);const V=async(w=null)=>{de(!0);try{const H=w?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${w}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Ee=await window.KTM.api.getJSON(H,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");X(Array.isArray(Ee)?Ee:[])}catch(H){console.error(H),C("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}de(!1)},J=async w=>{try{const H=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${w}`,"L\u1ED7i t\u1EA3i video");D(Array.isArray(H)?H:[])}catch(H){console.error(H)}},re=async w=>{if(w===0)return;const H=[...$];[H[w-1],H[w]]=[H[w],H[w-1]],X(H),await T(H)},b=async w=>{if(w===$.length-1)return;const H=[...$];[H[w],H[w+1]]=[H[w+1],H[w]],X(H),await T(H)},T=async w=>{try{await Promise.all(w.map((H,Ee)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${H.id}`,{sortOrder:Ee},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),C("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(H){C("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),V(v==null?void 0:v.id)}},P=async w=>{if(w===0)return;const H=[...F];[H[w-1],H[w]]=[H[w],H[w-1]],D(H),await le(H)},Z=async w=>{if(w===F.length-1)return;const H=[...F];[H[w],H[w+1]]=[H[w+1],H[w]],D(H),await le(H)},le=async w=>{try{await Promise.all(w.map((H,Ee)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${H.id}`,{sort_order:Ee},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),C("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(H){C("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),J(ue.id)}},ne=()=>{ve(null),Re(!0)},ke=w=>{at(w),wt(!0),y(!0)},Se=async(w,H="modal")=>{try{!pe&&v&&(w.parent_id=v.id);const Ee=pe?`${API_BASE}/api/video-folders/${pe.id}`:`${API_BASE}/api/video-folders`;pe?await window.KTM.api.putJSON(Ee,w,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Ee,w,"L\u1ED7i l\u01B0u folder"),C(pe?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),H==="drawer"?(y(!1),ve(null),V(v==null?void 0:v.id),pe&&Ae&&at({...Ae,...w})):(Re(!1),ve(null),V(v==null?void 0:v.id))}catch(Ee){C(Ee.message,"danger")}},We=async w=>{const H=w.subfolderCount>0?`X\xF3a folder "${w.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${w.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(H))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${w.id}`,"L\u1ED7i x\xF3a folder"),C("\u0110\xE3 x\xF3a folder","success"),te(null),V(v==null?void 0:v.id)}catch(Ee){C("L\u1ED7i x\xF3a folder","danger")}},rt=w=>{w.subfolderCount>0?(Q(H=>[...H,w]),M(w),V(w.id)):(te(w),D(w.videos||[]))},ae=w=>{if(w==="root")Q([]),M(null),V(null);else if(w){const H=Y.findIndex(Ee=>Ee.id===w.id);H>=0&&(Q(Y.slice(0,H+1)),M(w),V(w.id))}else{const H=[...Y];H.pop();const Ee=H[H.length-1]||null;Q(H),M(Ee),V(Ee==null?void 0:Ee.id)}},Pe=()=>{wt(!1),y(!1),at(null)},bt=()=>{Ge(!1),Ve(!1),Te(null)},Ue=()=>{Fe(null),fe(!0)},Tt=w=>{Te(w),Ge(!0),Ve(!0)},gt=async(w,H="modal")=>{try{w.folder_id=ue==null?void 0:ue.id;const Ee=O?`${API_BASE}/api/videos/${O.id}`:`${API_BASE}/api/videos`;O?await window.KTM.api.putJSON(Ee,w,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Ee,w,"L\u1ED7i l\u01B0u video"),C(O?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),H==="drawer"?(Ve(!1),Fe(null),V(),ue&&J(ue.id),O&&ye&&Te({...ye,...w})):(fe(!1),Fe(null),V(),ue&&J(ue.id))}catch(Ee){C(Ee.message,"danger")}},Wt=async w=>{if(confirm(`X\xF3a video "${w.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${w.id}`,"L\u1ED7i x\xF3a video"),C("\u0110\xE3 x\xF3a video","success"),V(),ue&&J(ue.id)}catch(H){C("L\u1ED7i x\xF3a video","danger")}},Kt=w=>{const H=`https://www.youtube.com/watch?v=${w.youtubeId}`;window.KTM.clipboard.writeText(H).then(()=>{C("\u0110\xE3 copy link!","success")}).catch(()=>{C("Kh\xF4ng th\u1EC3 copy link","danger")})};return ue?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>te(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${ue.slug==="shorts"?"text-danger":"text-warning"}`}),ue.name)),React.createElement("button",{className:"btn btn-warning",onClick:Ue},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),F.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},F.map((w,H)=>React.createElement("div",{key:w.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>P(H),disabled:H===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},H+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Z(H),disabled:H===F.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:w.thumb,className:"card-img-top",alt:w.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${w.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:w.title},w.title),React.createElement("small",{className:"text-muted"},w.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Kt(w),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Tt(w),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Wt(w),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Le,video:O,onClose:()=>fe(!1),onSave:gt}),React.createElement(AdminDrawer,{open:lt,title:Ae?Ae.name:"Folder",subtitle:Ae?`${Ae.subfolderCount||0} subfolder \u2022 ${Ae.videoCount||0} videos`:"",onClose:Pe,footer:ut?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:Pe},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Ae&&Se({name:Ae.name||"",description:Ae.description||"",sortOrder:Ae.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Ae?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Ae.name),C("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{y(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Ae.name}"?`)&&(We(Ae),Pe())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ut&&Ae?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Ae.name||"",onChange:w=>at({...Ae,name:w.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Ae.description||"",onChange:w=>at({...Ae,description:w.target.value})}))):Ae?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Ae.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Ae.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Ae.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Ae.videoCount||0))),Ae.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Ae.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:tt,title:ye?ye.title:"Video",subtitle:ye?`${ye.youtubeId}`:"",onClose:bt,footer:ie?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:bt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{ye&&gt({youtube_url:`https://www.youtube.com/watch?v=${ye.youtubeId}`,title:ye.title||"",thumbnail_url:ye.thumb||"",sort_order:ye.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):ye?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const w=`https://www.youtube.com/watch?v=${ye.youtubeId}`;window.KTM.clipboard.writeText(w).then(()=>{C("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Ve(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${ye.title}"?`)&&(Wt(ye),bt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ie&&ye?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:ye.title||"",onChange:w=>Te({...ye,title:w.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:ye.youtubeId||"",onChange:w=>Te({...ye,youtubeId:w.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ye.sortOrder||0,onChange:w=>Te({...ye,sortOrder:parseInt(w.target.value)||0})}))):ye?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},ye.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},ye.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},ye.sortOrder||0))),ye.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:ye.thumb,alt:ye.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},v&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ae()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),v?v.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:ne},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Y.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:w=>{w.preventDefault(),ae("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Y.map((w,H)=>React.createElement("li",{key:w.id,className:`breadcrumb-item ${H===Y.length-1?"active":""}`},H===Y.length-1?w.name:React.createElement("a",{href:"#",onClick:Ee=>{Ee.preventDefault(),ae(w)},className:"text-warning"},w.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),L?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):$.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},v?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ne},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",v?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},$.map((w,H)=>{var Ee,ot,Ft,ct;return React.createElement("div",{key:w.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:vt=>{vt.stopPropagation(),re(H)},disabled:H===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},H+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:vt=>{vt.stopPropagation(),b(H)},disabled:H===$.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>rt(w),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${w.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},w.name),React.createElement("p",{className:"text-muted mb-0"},w.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),w.subfolderCount," folder"),w.subfolderCount>0&&(w.videoCount>0||((Ee=w.videos)==null?void 0:Ee.length)>0)&&" \u2022 ",(w.videoCount>0||((ot=w.videos)==null?void 0:ot.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),w.videoCount||((Ft=w.videos)==null?void 0:Ft.length)||0," videos"),w.subfolderCount===0&&!w.videoCount&&!((ct=w.videos)!=null&&ct.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:vt=>{vt.stopPropagation(),ke(w)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:vt=>{vt.stopPropagation(),We(w)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Ne,folder:pe,onClose:()=>Re(!1),onSave:Se}))}function VideoFolderModal({show:S,folder:C,onClose:$,onSave:X}){const[F,D]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[L,de]=useState(!1),[ue,te]=useState(!1);useEffect(()=>{D(C?{name:C.name||"",description:C.description||"",sortOrder:C.sortOrder||0,coverImage:C.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[C,S]);const Ne=async pe=>{const ve=pe.target.files[0];if(ve){te(!0);try{const Le=await window.KTM.cloudinary.uploadImage({file:ve,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Le.secure_url&&D(fe=>({...fe,coverImage:Le.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Le){console.error("Cloudinary upload error:",Le),alert("L\u1ED7i upload \u1EA3nh: "+(Le.message||Le))}finally{te(!1)}}},Re=async pe=>{pe.preventDefault(),de(!0);const ve={...F,variants:normalizeVariants(F.variants,F.price),attributes:normalizeAttributes(F.attributes)};await X(ve),de(!1)};return S?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},C?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:Re},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:F.name,onChange:pe=>D({...F,name:pe.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:F.description,onChange:pe=>D({...F,description:pe.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:F.sortOrder,onChange:pe=>D({...F,sortOrder:parseInt(pe.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},F.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:F.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>D({...F,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Ne,disabled:ue}),ue&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:F.coverImage,onChange:pe=>D({...F,coverImage:pe.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:L},L?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:S,settings:C}){const[$,X]=useState([]),[F,D]=useState(!0),[L,de]=useState(!1),[ue,te]=useState(null),[Ne,Re]=useState(""),[pe,ve]=useState(""),[Le,fe]=useState(!1),[O,Fe]=useState(null),tt=normalizeShipPercent(C==null?void 0:C.ship_percent),{parseMoney:Ge,formatVND:ye}=window.KTM.money,Te=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{ie()},[]);const ie=async()=>{D(!0);try{const b=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");X(Array.isArray(b)?b:[])}catch(b){console.error(b),S("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}D(!1)},Ve=()=>{te(null),de(!0)},lt=b=>{te(b),de(!0)},wt=b=>{b&&(Fe(b),fe(!0))},Ae=()=>{fe(!1)},at=async b=>{if(!(!b||!b.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:b},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),S(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),ie()}catch(T){S("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},ut=async b=>{try{const T=ue?`${API_BASE}/api/products?id=${ue.id}`:`${API_BASE}/api/products`;ue?await window.KTM.api.putJSON(T,b,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(T,b,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),S(ue?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),de(!1),ie()}catch(T){S(T.message,"danger")}},y=async b=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${b.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${b.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),S("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ie()}catch(T){S(T.message,"danger")}},v=$.filter(b=>{const T=!Ne||b.name.toLowerCase().includes(Ne.toLowerCase())||b.code&&b.code.toLowerCase().includes(Ne.toLowerCase()),P=!pe||b.category===pe;return T&&P}),M=b=>{var Z;const T=(Z=b==null?void 0:b.commission_percent)!=null?Z:b==null?void 0:b.commissionPercent,P=T===""||T==null?NaN:Number(T);return Number.isFinite(P)?Math.max(0,Math.min(100,P)):5},Y=b=>{const T=M(b),P=Number.isInteger(T)?String(T):String(Math.round(T*100)/100),Z=Ge(b==null?void 0:b.price);if(!Number.isFinite(Z)||Z<=0)return`${P}%`;const le=(Number(T)||0)/100,ke=window.KTM.money.parseShipFeeFromNote(b==null?void 0:b.note)!=null?0:tt>0?Z*tt/100:0,Se=Z*le-ke*le,We=Math.max(0,Math.round(Se));return`${P}% - ${ye(We)}`},Q=b=>{if(b==null||b==="")return[];let T=b;if(typeof T=="string"){const P=T.trim();if(!P)return[];try{T=JSON.parse(P)}catch(Z){return[]}}return Array.isArray(T)?T:[]},V=b=>{if(b==null||b==="")return[];let T=b;if(typeof T=="string"){const P=T.trim();if(!P)return[];try{T=JSON.parse(P)}catch(Z){return[]}}return T&&typeof T=="object"&&!Array.isArray(T)&&(T=Object.entries(T).map(([P,Z])=>({key:P,value:Z}))),Array.isArray(T)?T:[]},J=b=>{const T=V(b).map(P=>{var Z,le,ne,ke,Se;return{key:String((ne=(le=(Z=P==null?void 0:P.key)!=null?Z:P==null?void 0:P.name)!=null?le:P==null?void 0:P.label)!=null?ne:"").trim(),value:String((ke=P==null?void 0:P.value)!=null?ke:"").trim(),unit:String((Se=P==null?void 0:P.unit)!=null?Se:"").trim()}}).filter(P=>!!P.key);return T.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},T.map((P,Z)=>{const le=P.key,ne=`${P.value||""}${P.unit?(P.value?" ":"")+P.unit:""}`.trim();return React.createElement("div",{key:`${le}-${Z}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},le),ne?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ne):null)}))):null},re=(b,T={})=>{const P=Q(b).map(ke=>{var Se;return{name:String((Se=ke==null?void 0:ke.name)!=null?Se:"").trim(),options:Array.isArray(ke==null?void 0:ke.options)?ke.options:[]}}).map(ke=>({...ke,options:ke.options.map(Se=>{var We;return{label:String((We=Se==null?void 0:Se.label)!=null?We:"").trim(),price:Number(Se==null?void 0:Se.price)}}).filter(Se=>!!Se.label)})).filter(ke=>ke.options.length>0);if(!P.length)return null;const Z=Number.isFinite(T.maxGroups)?Math.max(1,Math.trunc(T.maxGroups)):P.length,le=Number.isFinite(T.maxOptionsPerGroup)?Math.max(1,Math.trunc(T.maxOptionsPerGroup)):4,ne=P.slice(0,Z);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},ne.map((ke,Se)=>{const We=ke.name||"Bi\u1EBFn th\u1EC3",rt=ke.options.slice(0,le),ae=ke.options.length-rt.length;return React.createElement("div",{key:`${We}-${Se}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},We),rt.map((Pe,bt)=>{const Ue=Pe.price,Tt=Number.isFinite(Ue)&&Ue>=0?ye(Math.trunc(Ue)):"",gt=Tt?`${Pe.label} \xB7 ${Tt}`:Pe.label;return React.createElement("span",{key:`${We}-${Se}-${bt}`,className:"ktm-chip ktm-chip-option"},gt)}),ae>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",ae))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Ve},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:Ne,onChange:b=>Re(b.target.value)})),React.createElement("span",{className:"product-count"},v.length)),React.createElement("select",{className:"form-select",value:pe,onChange:b=>ve(b.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),Te.map(b=>React.createElement("option",{key:b,value:b},b)))),F?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):v.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Ve},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},v.map(b=>React.createElement("div",{key:b.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>wt(b),onKeyDown:T=>{(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),wt(b))},title:"Xem chi ti\u1EBFt"},b.image?React.createElement("img",{src:b.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},b.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},b.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},b.category),b.code&&React.createElement("span",{className:"product-badge bg-secondary"},b.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),Y(b))),React.createElement("div",{className:"product-price"},b.price?b.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),b.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},b.note),J(b.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},J(b.attributes)),re(b.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},re(b.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:T=>{T.stopPropagation(),lt(b)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:T=>{T.stopPropagation(),y(b)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:Le,title:String((O==null?void 0:O.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((O==null?void 0:O.code)||"").trim()||null,String((O==null?void 0:O.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Ae,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const b=String((O==null?void 0:O.code)||"").trim();b&&window.KTM.clipboard.writeText(b).then(()=>S("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((O==null?void 0:O.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const b=String((O==null?void 0:O.price)||"").trim();b&&window.KTM.clipboard.writeText(b).then(()=>S("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((O==null?void 0:O.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>O&&lt(O),disabled:!O},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>O&&y(O),disabled:!O},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},O?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const b=String((O==null?void 0:O.price)||"").trim(),T=Ge(b);return Number.isFinite(T)&&T>0?ye(Math.trunc(T)):b||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},Y(O)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},O.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},O.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),O.image?React.createElement("img",{src:O.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(O.note||"").trim()||O.attributes||O.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(O.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(O.note||"").trim()),J(O.attributes)?React.createElement("div",{className:"mt-2"},J(O.attributes)):null,re(O.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},re(O.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:L,product:ue,categories:Te,onClose:()=>de(!1),onSave:ut}))}function ProductModal({show:S,product:C,categories:$,onClose:X,onSave:F}){const[D,L]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[de,ue]=useState(!1),[te,Ne]=useState(!1),Re=y=>{const v=window.KTM.money.getDigits(String(y!=null?y:"")),M=Number(v);return v&&Number.isFinite(M)?Math.trunc(M):0},pe=y=>{if(y==null||y==="")return[];let v=y;if(typeof v=="string"){const M=v.trim();if(!M)return[];try{v=JSON.parse(M)}catch(Y){return[]}}return v&&typeof v=="object"&&!Array.isArray(v)&&(v=Object.entries(v).map(([M,Y])=>({key:M,value:Y}))),Array.isArray(v)?v.map(M=>{var J,re,b,T,P;if(!M||typeof M!="object")return null;const Y=String((b=(re=(J=M.key)!=null?J:M.name)!=null?re:M.label)!=null?b:"").trim(),Q=String((T=M.value)!=null?T:"").trim(),V=String((P=M.unit)!=null?P:"").trim();return Y?{key:Y,value:Q,unit:V}:null}).filter(Boolean):[]},ve=(y,v)=>{if(y==null||y==="")return[];let M=y;if(typeof M=="string"){const Q=M.trim();if(!Q)return[];try{M=JSON.parse(Q)}catch(V){return[]}}if(!Array.isArray(M))return[];const Y=Re(v);return M.map(Q=>{var re;if(!Q||typeof Q!="object")return null;const V=String((re=Q.name)!=null?re:"").trim(),J=(Array.isArray(Q.options)?Q.options:[]).map(b=>{var ke,Se,We,rt,ae,Pe,bt;if(!b||typeof b!="object")return null;const T=String((ke=b.label)!=null?ke:"").trim();if(!T)return null;const P=(ae=(rt=(We=(Se=b.price)!=null?Se:b.priceValue)!=null?We:b.unit_price)!=null?rt:b.unitPrice)!=null?ae:null,Z=Number(P);let le=Number.isFinite(Z)?Math.trunc(Z):null;if(le==null){const Ue=(bt=(Pe=b.price_delta)!=null?Pe:b.priceDelta)!=null?bt:null,Tt=Number(Ue);Number.isFinite(Tt)&&(le=Y+Math.trunc(Tt))}le==null&&(le=Y);const ne=String(Math.max(0,Math.trunc(Number(le)||0)));return{label:T,price:Math.max(0,Math.trunc(Number(le)||0)),priceDigits:ne}}).filter(Boolean);return{name:V||"Bi\u1EBFn th\u1EC3",options:J}}).filter(Boolean)};useEffect(()=>{var y,v;L(C?{name:C.name||"",code:C.code||"",price:C.price||"",image:C.image||"",category:C.category||"",note:C.note||"",sort_order:C.sort_order||0,commission_percent:(v=(y=C.commission_percent)!=null?y:C.commissionPercent)!=null?v:5,variants:ve(C.variants,C.price),attributes:pe(C.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[C,S]);const Le=y=>{L(v=>{var J;const M=Re(v.price),Y=String(M),Q=Array.isArray(v.variants)?[...v.variants]:[],V={...Q[y]||{},options:Array.isArray((J=Q[y])==null?void 0:J.options)?[...Q[y].options]:[]};return V.options=V.options.map(re=>({label:String((re==null?void 0:re.label)||""),price:M,priceDigits:Y})),Q[y]=V,{...v,variants:Q}})},fe=()=>{L(y=>{const v=Re(y.price),M=String(v),Q=(Array.isArray(y.variants)?[...y.variants]:[]).map(V=>{const J=(Array.isArray(V==null?void 0:V.options)?V.options:[]).map(re=>({label:String((re==null?void 0:re.label)||""),price:v,priceDigits:M}));return{name:String((V==null?void 0:V.name)||"Bi\u1EBFn th\u1EC3"),options:J}});return{...y,variants:Q}})},[O,Fe]=React.useState(""),tt=y=>window.KTM.money.formatVNDInputDigits(y),[Ge,ye]=React.useState(""),Te=y=>{const v=window.KTM.money.nextPriceInputState(y.target.value,Ge);ye(v.digits),L({...D,price:v.price})},[ie,Ve]=React.useState("");React.useEffect(()=>{C!=null&&C.image&&Ve(C.image)},[C]);const lt=async y=>{if(!(!y||!y.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:y},"L\u1ED7i x\xF3a \u1EA3nh")}catch(v){console.error("Delete cloudinary image error:",v)}},wt=async(y,v=2,M)=>{const Y=v*1024*1024,Q=y.type==="image/heic"||y.type==="image/heif"||/\.heic$/i.test(y.name);if(y.size<=Y&&!Q)return y;M==null||M("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const V=await createImageBitmap(y);M==null||M("\u0110ang n\xE9n \u1EA3nh...");const J=document.createElement("canvas");let re=V.width,b=V.height;const T=1200;return(re>T||b>T)&&(re>b?(b=Math.round(b/re*T),re=T):(re=Math.round(re/b*T),b=T)),J.width=re,J.height=b,J.getContext("2d").drawImage(V,0,0,re,b),V.close(),new Promise((Z,le)=>{J.toBlob(ne=>{ne?(M==null||M("Ho\xE0n t\u1EA5t!"),Z(new File([ne],y.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):le(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(V){throw console.error("createImageBitmap error:",V),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ae=async y=>{var Y,Q;const v=(Y=y.target.files)==null?void 0:Y[0];if(!v)return;if(!(v.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(v.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ne(!0),Fe("\u0110ang chu\u1EA9n b\u1ECB...");try{const V=(v.size/1024/1024).toFixed(1);Fe(`File ${V}MB - \u0110ang n\xE9n...`);const J=await wt(v,2,T=>{Fe(T)}),re=(J.size/1024/1024).toFixed(1);Fe(`\u0110\xE3 n\xE9n: ${re}MB - \u0110ang upload...`);const b=await window.KTM.cloudinary.uploadImage({file:J,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});b.secure_url?(D.image&&D.image!==ie&&lt(D.image),L(T=>({...T,image:b.secure_url})),Fe("")):(console.error("Cloudinary error:",b),alert("Upload th\u1EA5t b\u1EA1i: "+(((Q=b.error)==null?void 0:Q.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Fe(""))}catch(V){console.error("Upload error:",V),alert("L\u1ED7i: "+V.message),Fe("")}Ne(!1),y.target.value=""},at=()=>{D.image&&(D.image!==ie&&lt(D.image),L(y=>({...y,image:""})))},ut=async y=>{y.preventDefault(),ue(!0),ie&&D.image&&ie!==D.image&&await lt(ie),ie&&!D.image&&await lt(ie),await F(D),ue(!1)};return S?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${C?"fa-edit":"fa-plus-circle"} me-2`}),C?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:X})),React.createElement("form",{onSubmit:ut},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},D.image?React.createElement(React.Fragment,null,React.createElement("img",{src:D.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:at,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${te?"fa-spinner fa-spin":"fa-camera"} me-1`}),te?O||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Ae,disabled:te,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),te&&O&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},O))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:D.name,onChange:y=>L({...D,name:y.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:D.code,onChange:y=>L({...D,code:y.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:D.price,onChange:Te,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:D.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:y=>L({...D,commission_percent:y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:D.category,onChange:y=>L({...D,category:y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),$.map(y=>React.createElement("option",{key:y,value:y},y)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:D.note,onChange:y=>L({...D,note:y.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(D.attributes)?D.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(D.attributes)?D.attributes:[]).map((y,v)=>React.createElement("div",{key:v,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(y==null?void 0:y.key)||"",onChange:M=>{const Y=M.target.value;L(Q=>{const V=Array.isArray(Q.attributes)?[...Q.attributes]:[];return V[v]={...V[v]||{},key:Y},{...Q,attributes:V}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(y==null?void 0:y.value)||"",onChange:M=>{const Y=M.target.value;L(Q=>{const V=Array.isArray(Q.attributes)?[...Q.attributes]:[];return V[v]={...V[v]||{},value:Y},{...Q,attributes:V}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(y==null?void 0:y.unit)||"",onChange:M=>{const Y=M.target.value;L(Q=>{const V=Array.isArray(Q.attributes)?[...Q.attributes]:[];return V[v]={...V[v]||{},unit:Y},{...Q,attributes:V}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{L(M=>{const Y=Array.isArray(M.attributes)?[...M.attributes]:[];return Y.splice(v,1),{...M,attributes:Y}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{L(y=>{const v=Array.isArray(y.attributes)?[...y.attributes]:[];return v.push({key:"",value:"",unit:""}),{...y,attributes:v}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(D.variants)?D.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(D.variants)?D.variants:[]).map((y,v)=>React.createElement("div",{key:v,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(y==null?void 0:y.name)||"",onChange:M=>{const Y=M.target.value;L(Q=>{var J;const V=Array.isArray(Q.variants)?[...Q.variants]:[];return V[v]={...V[v]||{},name:Y,options:Array.isArray((J=V[v])==null?void 0:J.options)?V[v].options:[]},{...Q,variants:V}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Le(v),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(y==null?void 0:y.options)||y.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{L(M=>{const Y=Array.isArray(M.variants)?[...M.variants]:[];return Y.splice(v,1),{...M,variants:Y}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(y==null?void 0:y.options)?y.options:[]).map((M,Y)=>{var Q,V;return React.createElement("div",{key:Y,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.label)||"",onChange:J=>{const re=J.target.value;L(b=>{var ne,ke,Se,We,rt;const T=Array.isArray(b.variants)?[...b.variants]:[],P={...T[v]||{},options:Array.isArray((ne=T[v])==null?void 0:ne.options)?[...T[v].options]:[]},Z=Number((Se=(ke=P.options[Y])==null?void 0:ke.price)!=null?Se:0)||0,le=String((rt=(We=P.options[Y])==null?void 0:We.priceDigits)!=null?rt:Math.max(0,Math.trunc(Z)));return P.options[Y]={...P.options[Y]||{},label:re,price:Math.max(0,Math.trunc(Z)),priceDigits:le},T[v]=P,{...b,variants:T}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:tt(String((V=M==null?void 0:M.priceDigits)!=null?V:window.KTM.money.getDigits(String((Q=M==null?void 0:M.price)!=null?Q:"")))),onChange:J=>{L(re=>{var Se,We,rt,ae,Pe;const b=String((We=M==null?void 0:M.priceDigits)!=null?We:window.KTM.money.getDigits(String((Se=M==null?void 0:M.price)!=null?Se:""))),T=window.KTM.money.nextPriceInputState(J.target.value,b),P=String((rt=T.digits)!=null?rt:""),Z=Number(P),le=Number.isFinite(Z)?Math.max(0,Math.trunc(Z)):0,ne=Array.isArray(re.variants)?[...re.variants]:[],ke={...ne[v]||{},options:Array.isArray((ae=ne[v])==null?void 0:ae.options)?[...ne[v].options]:[]};return ke.options[Y]={...ke.options[Y]||{},label:String(((Pe=ke.options[Y])==null?void 0:Pe.label)||""),price:le,priceDigits:P},ne[v]=ke,{...re,variants:ne}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{L(J=>{var T;const re=Array.isArray(J.variants)?[...J.variants]:[],b={...re[v]||{},options:Array.isArray((T=re[v])==null?void 0:T.options)?[...re[v].options]:[]};return b.options.splice(Y,1),re[v]=b,{...J,variants:re}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{L(M=>{var J;const Y=Array.isArray(M.variants)?[...M.variants]:[],Q={...Y[v]||{},options:Array.isArray((J=Y[v])==null?void 0:J.options)?[...Y[v].options]:[]},V=Re(M.price);return Q.options.push({label:"",price:V,priceDigits:String(V)}),Y[v]=Q,{...M,variants:Y}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{L(y=>{const v=Re(y.price),M=Array.isArray(y.variants)?[...y.variants]:[],Y=String(v);return M.push({name:"Size",options:[{label:"S",price:v,priceDigits:Y},{label:"M",price:v,priceDigits:Y},{label:"L",price:v,priceDigits:Y}]}),{...y,variants:M}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:fe,disabled:!Array.isArray(D.variants)||D.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:D.image,onChange:y=>L({...D,image:y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:X,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:de,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},de?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:S,video:C,onClose:$,onSave:X}){const[F,D]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[L,de]=useState(!1),[ue,te]=useState("");useEffect(()=>{C?(D({title:C.title||"",youtube_url:`https://www.youtube.com/watch?v=${C.youtubeId}`,thumbnail_url:C.thumb||"",sort_order:C.sortOrder||0}),te(C.thumb)):(D({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),te(""))},[C,S]);const Ne=ve=>{const Le=ve.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Le?Le[1]:null},Re=ve=>{D({...F,youtube_url:ve});const Le=Ne(ve);Le&&te(`https://img.youtube.com/vi/${Le}/hqdefault.jpg`)},pe=async ve=>{ve.preventDefault(),de(!0),await X(F),de(!1)};return S?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},C?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:$})),React.createElement("form",{onSubmit:pe},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:F.youtube_url,onChange:ve=>Re(ve.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),ue&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:ue,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:F.title,onChange:ve=>D({...F,title:ve.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:F.sort_order,onChange:ve=>D({...F,sort_order:parseInt(ve.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:F.thumbnail_url,onChange:ve=>D({...F,thumbnail_url:ve.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:$},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:L},L?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[S,C]=useState(!1),[$,X]=useState(""),[F,D]=useState(null),[L,de]=useState("search"),[ue,te]=useState(()=>loadAdminPins()),[Ne,Re]=useState(()=>loadAdminRecent()),[pe,ve]=useState(null),[Le,fe]=useState(""),[O,Fe]=useState([]),[tt,Ge]=useState(null),[ye,Te]=useState(!1),[ie,Ve]=useState(null),[lt,wt]=useState(!0),[Ae,at]=useState([]),[ut,y]=useState(!1),[v,M]=useState(null),[Y,Q]=useState(!1),[V,J]=useState(!1),[re,b]=useState(""),[T,P]=useState(()=>loadAdminSettings()),[Z,le]=useState(null),[ne,ke]=useState([]);useEffect(()=>{const c=localStorage.getItem("ktm_admin_session");if(c)try{const j=JSON.parse(c);j.expiry>Date.now()?(C(!0),D(j.user)):localStorage.removeItem("ktm_admin_session")}catch(j){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{S&&Ue()},[S]),useEffect(()=>{const c=()=>{try{const E=document.querySelector(".admin-topbar");if(!E)return;const oe=E.getBoundingClientRect(),me=Math.max(0,Math.round(oe.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${me+10}px`)}catch(E){}};c(),window.addEventListener("resize",c);const j=setTimeout(c,0);return()=>{clearTimeout(j),window.removeEventListener("resize",c)}},[S,L]),useEffect(()=>{var E,oe;const c=window.visualViewport,j=()=>{try{const me=Number(window.innerHeight)||0,we=Number(c==null?void 0:c.height)||me,Be=Number(c==null?void 0:c.offsetTop)||0,Ce=Math.max(0,Math.round(me-we-Be));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${Ce}px`)}catch(me){}};j(),window.addEventListener("resize",j);try{(E=c==null?void 0:c.addEventListener)==null||E.call(c,"resize",j),(oe=c==null?void 0:c.addEventListener)==null||oe.call(c,"scroll",j)}catch(me){}return()=>{var me,we;window.removeEventListener("resize",j);try{(me=c==null?void 0:c.removeEventListener)==null||me.call(c,"resize",j),(we=c==null?void 0:c.removeEventListener)==null||we.call(c,"scroll",j)}catch(Be){}}},[]),useEffect(()=>{if(!S)return;const c=E=>{if(!E)return!1;const oe=String(E.tagName||"").toLowerCase();return!!(oe==="input"||oe==="textarea"||oe==="select"||E.isContentEditable)},j=E=>{if(!E||E.ctrlKey||E.metaKey||E.altKey||c(E.target))return;const oe=E.key;(oe==="/"||oe==="N"||oe==="n"||oe==="Escape"||oe==="j"||oe==="J"||oe==="k"||oe==="K")&&(oe==="/"&&E.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:oe}})))};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[S]),useEffect(()=>{S&&Re(c=>{const j=Array.isArray(c)?c:[],E=[L,...j.filter(oe=>oe!==L)].slice(0,8);return saveAdminRecent(E),E})},[S]);const Se=c=>{const j=String(c||"").trim();j&&Re(E=>{const oe=Array.isArray(E)?E:[],me=[j,...oe.filter(we=>we!==j)].slice(0,8);return saveAdminRecent(me),me})},We=c=>{const j=String(c||"").trim();j&&te(E=>{const oe=Array.isArray(E)?E:[],we=oe.includes(j)?oe.filter(Be=>Be!==j):[j,...oe].slice(0,10);return saveAdminPins(we),we})};useEffect(()=>{if(!S)return;let c=!1;return(async()=>{try{const j=await fetchAdminSettingsFromServer();if(c)return;P(j),saveAdminSettings(j)}catch(j){}})(),()=>{c=!0}},[S]);const rt=async(c,j)=>{X("");try{const E=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:c,password:j},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),oe={user:E.user,token:E.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(oe)),D(E.user),C(!0)}catch(E){X(E.message)}},ae=()=>{localStorage.removeItem("ktm_admin_session"),C(!1),D(null),Fe([]),Ge(null)},Pe=(c,j="success",E=null)=>{const oe=Date.now()+Math.floor(Math.random()*1e3);if(c&&typeof c=="object"){const we=c;at(Be=>[...Be,{id:oe,message:String(we.message||""),type:String(we.type||j||"success"),actionLabel:we.actionLabel||null,onAction:typeof we.onAction=="function"?we.onAction:null,durationMs:we.durationMs||null}]);return}const me=E&&typeof E=="object"?E:null;at(we=>[...we,{id:oe,message:String(c||""),type:String(j||"success"),actionLabel:(me==null?void 0:me.actionLabel)||null,onAction:typeof(me==null?void 0:me.onAction)=="function"?me.onAction:null,durationMs:(me==null?void 0:me.durationMs)||null}])},bt=c=>{at(j=>j.filter(E=>E.id!==c))},Ue=async(c=null)=>{wt(!0);try{const j=c?`${API_BASE}/api/albums?parent_id=${c}`:`${API_BASE}/api/albums?parent_id=root`,E=await window.KTM.api.getJSON(j,"L\u1ED7i t\u1EA3i danh s\xE1ch album");Fe(Array.isArray(E)?E:[])}catch(j){console.error(j),Pe("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}wt(!1)},Tt=()=>{Ve(null),Te(!0)},gt=c=>{Ee(c),Q(!0)},Wt=async(c,j="modal")=>{try{const E=ie&&ie.uuid;!E&&Z&&(c.parent_id=Z.uuid);const oe=E?`${API_BASE}/api/albums/${ie.uuid||ie.id}`:`${API_BASE}/api/albums`;E?await window.KTM.api.putJSON(oe,c,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(oe,c,"L\u1ED7i t\u1EA1o"),Pe(E?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),j==="drawer"?(Q(!1),Ve(null),Ue(Z==null?void 0:Z.uuid),E&&v&&M({...v,...c})):(Te(!1),Ve(null),Ue(Z==null?void 0:Z.uuid))}catch(E){Pe(E.message,"danger")}},Kt=c=>{Ge(c)},w=c=>{if(c==="root")ke([]),le(null),Ue(null);else if(c){const j=ne.findIndex(E=>E.uuid===c.uuid);j>=0&&(ke(ne.slice(0,j+1)),le(c),Ue(c.uuid))}else{const j=[...ne];j.pop();const E=j[j.length-1]||null;ke(j),le(E),Ue(E==null?void 0:E.uuid)}},H=async c=>{const j=`X\xF3a folder "${c.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(j))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${c.uuid||c.id}`,"L\u1ED7i x\xF3a album"),Pe("\u0110\xE3 x\xF3a","success"),Ue(Z==null?void 0:Z.uuid)}catch(E){Pe("L\u1ED7i x\xF3a album","danger")}},Ee=async c=>{c&&(y(!0),b(""),J(!1),Q(!1),M(c))},ot=()=>{y(!1),J(!1),b(""),Q(!1),M(null)},Ft=c=>{Q(!0)};if(!S)return React.createElement(LoginPage,{onLogin:rt,error:$});const ct=()=>{const c=new Date,j=c.getFullYear(),E=String(c.getMonth()+1).padStart(2,"0");return`${j}-${E}`};function vt(){const[c,j]=useState(()=>{var we;return String((we=T==null?void 0:T.ship_percent)!=null?we:DEFAULT_SHIP_PERCENT)}),[E,oe]=useState(!1);return useEffect(()=>{var we;j(String((we=T==null?void 0:T.ship_percent)!=null?we:DEFAULT_SHIP_PERCENT))},[T==null?void 0:T.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async we=>{we.preventDefault(),oe(!0);const Be=saveAdminSettings({ship_percent:c});try{const Ce=await saveAdminSettingsToServer(Be);P(Ce),saveAdminSettings(Ce),Pe("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Ce){P(Be),Pe("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{oe(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:c,min:"0",max:"100",step:"0.01",onChange:we=>j(we.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:E},E?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function A(){const[c,j]=useState(ct()),[E,oe]=useState(!0),me=useRef(null),we=useRef(null),[Be,Ce]=useState(0),[Pt,dt]=useState(!1),xt=useRef(0),jt=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[Me,Mt]=useState(jt),Oa=useRef(new Map),Ut=normalizeShipPercent(T==null?void 0:T.ship_percent),{formatNumber:je,formatVND:pt}=window.KTM.money,Ca=async(I,se=!1)=>{var Ct,At;const Oe=String(I||"").trim();if(!Oe)return jt();const nt=`${Oe}|${Ut}`,kt=(Ct=Oa.current)==null?void 0:Ct.get(nt);if(!se&&kt)return kt;const It=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(Oe)}&ship_percent=${encodeURIComponent(Ut)}`,Ye=await window.KTM.api.getJSON(It,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Dt=Ye!=null&&Ye.stats&&(Ye!=null&&Ye.meta)?Ye.stats:Ye,Yt=Dt&&typeof Dt=="object"?Dt:jt();return(At=Oa.current)==null||At.set(nt,Yt),Yt},Aa=async(I=!1)=>{oe(!0);try{const se=await Ca(c,I);Mt(se)}catch(se){console.error("Load stats error:",se),Mt(jt())}finally{oe(!1)}};useEffect(()=>{Aa()},[c,Ut]);const ta=(I,se)=>{const Oe=String(I||"").trim(),nt=Oe.match(/^(\d{4})-(\d{2})$/);if(!nt)return Oe;const kt=Number(nt[1]),It=Number(nt[2])-1,Ye=new Date(kt,It,1);Ye.setMonth(Ye.getMonth()+Number(se||0));const Dt=Ye.getFullYear(),Yt=String(Ye.getMonth()+1).padStart(2,"0");return`${Dt}-${Yt}`},aa=ct(),na=ta(aa,-5),fa=I=>{const se=String(I||"").trim();return se?se>=na&&se<=aa:!1},Et=I=>{const se=String(I||"").trim();return se&&(se<na?na:se>aa?aa:se)},Bt=I=>{const se=Date.now();se-Number(xt.current||0)<1200||(xt.current=se,Pe(I==="future"?"Kh\xF4ng xem \u0111\u01B0\u1EE3c th\xE1ng t\u01B0\u01A1ng lai":"Ch\u1EC9 xem t\u1ED1i \u0111a 5 th\xE1ng g\u1EA7n nh\u1EA5t","warning"))},_a=(I,se,Oe)=>Math.max(se,Math.min(Oe,I)),Ka=()=>{var I;return Math.max(320,Number((I=we.current)==null?void 0:I.clientWidth)||360)},ft=()=>{const I=Ka();return _a(Math.floor(I*.35),110,180)},ja=()=>{const I=Ka();return _a(Math.floor(I*.22),70,140)},ha=I=>{try{if(!(I!=null&&I.touches)||I.touches.length!==1||Pt)return;const se=I.target;if(se&&typeof se.closest=="function"&&se.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){me.current=null;return}const Oe=I.touches[0];me.current={x:Oe.clientX,y:Oe.clientY,at:Date.now(),swiping:!1}}catch(se){me.current=null}},sa=I=>{const se=me.current;if(!se||Pt)return;const Oe=(I==null?void 0:I.touches)&&I.touches[0];if(!Oe)return;const nt=Oe.clientX-se.x,kt=Oe.clientY-se.y,It=Math.abs(nt),Ye=Math.abs(kt);if(!se.swiping)if(It>12&&It>Ye*1.2)se.swiping=!0,dt(!1);else return;const Dt=ft();Ce(_a(nt,-Dt,Dt))},ba=I=>{const se=me.current;if(me.current=null,!se||Pt||!se.swiping){Ce(0);return}const Oe=(I==null?void 0:I.changedTouches)&&I.changedTouches[0];if(!Oe)return;const nt=Oe.clientX-se.x,kt=Oe.clientY-se.y,It=Date.now()-se.at,Ye=Math.abs(nt),Dt=Math.abs(kt);if(It>1e3)return;if(Ye<30){Ce(0);return}if(Ye<Dt*1.5)return;const Yt=ja(),Ct=Ye>=Yt,At=nt>0?1:-1;if(!Ct){dt(!0),Ce(0),setTimeout(()=>dt(!1),220);return}const Ht=At>0?-1:1,Ma=ta(c,Ht);if(!fa(Ma)){dt(!0),Ce(At*Math.floor(ft()*.55)),setTimeout(()=>{Ce(0),setTimeout(()=>dt(!1),200)},140),Bt(Ma>aa?"future":"past");return}dt(!0),Ce(At*ft()),setTimeout(()=>{j(s=>ta(s,Ht)),Ce(-At*ft()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ce(0),setTimeout(()=>dt(!1),220)})})},140)},zt=()=>{me.current=null,Ce(0)},St=I=>{var se,Oe;try{if(!I||I.pointerType==="touch"||typeof I.button=="number"&&I.button!==0||Pt)return;const nt=I.target;if(nt&&typeof nt.closest=="function"&&nt.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){me.current=null;return}me.current={x:I.clientX,y:I.clientY,at:Date.now(),swiping:!1};try{(Oe=(se=I.currentTarget)==null?void 0:se.setPointerCapture)==null||Oe.call(se,I.pointerId)}catch(kt){}}catch(nt){me.current=null}},Ta=I=>{try{if(!I||I.pointerType==="touch")return;const se=me.current;if(!se||Pt)return;const Oe=I.clientX-se.x,nt=I.clientY-se.y,kt=Math.abs(Oe),It=Math.abs(nt);if(!se.swiping)if(kt>12&&kt>It*1.2)se.swiping=!0,dt(!1);else return;const Ye=ft();Ce(_a(Oe,-Ye,Ye))}catch(se){}},ia=I=>{try{if(!I||I.pointerType==="touch")return;const se=me.current;if(me.current=null,!se||Pt||!se.swiping){Ce(0);return}const Oe=I.clientX-se.x,nt=I.clientY-se.y,kt=Date.now()-se.at,It=Math.abs(Oe),Ye=Math.abs(nt);if(kt>1e3)return;if(It<30){Ce(0);return}if(It<Ye*1.5)return;const Dt=ja(),Yt=It>=Dt,Ct=Oe>0?1:-1;if(!Yt){dt(!0),Ce(0),setTimeout(()=>dt(!1),220);return}const At=Ct>0?-1:1,Ht=ta(c,At);if(!fa(Ht)){dt(!0),Ce(Ct*Math.floor(ft()*.55)),setTimeout(()=>{Ce(0),setTimeout(()=>dt(!1),200)},140),Bt(Ht>aa?"future":"past");return}dt(!0),Ce(Ct*ft()),setTimeout(()=>{j(Ma=>ta(Ma,At)),Ce(-Ct*ft()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ce(0),setTimeout(()=>dt(!1),220)})})},140)}catch(se){me.current=null}},Jt=()=>{me.current=null,Ce(0)},Da=Be>0?"Th\xE1ng tr\u01B0\u1EDBc":Be<0?"Th\xE1ng sau":"",Xt=Be>0?ta(c,-1):Be<0?ta(c,1):"",ma=Xt&&fa(Xt)?Xt:"",$t=Math.min(1,Math.abs(Be)/Math.max(1,ja()));return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager",ref:we,style:{touchAction:"pan-y",transform:`translateX(${Be}px)`,transition:Pt?"transform 220ms ease":"none",willChange:"transform"},onTouchStartCapture:ha,onTouchMoveCapture:sa,onTouchEndCapture:ba,onTouchCancelCapture:zt,onPointerDown:St,onPointerMove:Ta,onPointerUp:ia,onPointerCancel:Jt},!!Da&&React.createElement("div",{"aria-hidden":"true",style:{position:"fixed",left:0,right:0,top:84,zIndex:1060,pointerEvents:"none",opacity:.15+.55*$t,transform:"translateZ(0)"}},React.createElement("div",{className:"d-flex justify-content-center"},React.createElement("div",{className:"px-3 py-2 rounded-pill bg-dark text-white shadow-sm",style:{fontSize:13}},Be>0?"\u2190":"\u2192"," ",Da," \xB7 ",ma))),React.createElement(Loading,{show:E}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>Aa(!0),disabled:E},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:c,onChange:I=>j(I.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",Ut,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),je(Me.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),je(Me.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),je(Me.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",je(Me.statusCounts.paid),"/",je(Me.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},je(Me.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},pt(Me.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},pt(Me.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},pt(Me.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},pt(Me.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",Me.avgQtyPerOrder?Me.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},je(Me.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},je(Me.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},je(Me.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},je(Me.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},je(Me.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},je(Me.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},je(Me.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,je(Me.statusCounts.draft)),React.createElement("td",null,je(Me.statusCounts.pending)),React.createElement("td",null,je(Me.statusCounts.processing)),React.createElement("td",null,je(Me.statusCounts.canceled)),React.createElement("td",null,je(Me.statusCounts.done)),React.createElement("td",null,je(Me.statusCounts.paid)),React.createElement("td",null,je(Me.statusCounts.other)),React.createElement("td",null,je(Me.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Me.products.slice(0,10).map(I=>React.createElement("div",{key:I.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},I.product_name),React.createElement("div",{className:"text-muted small text-truncate"},I.product_code?`#${I.product_code} \u2022 `:"",je(I.orders)," \u0111\u01A1n \u2022 ",je(I.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},pt(I.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Me.products.slice(0,10).map(I=>React.createElement("tr",{key:I.product_id},React.createElement("td",null,I.product_name),React.createElement("td",null,I.product_code||"\u2014"),React.createElement("td",null,je(I.orders)),React.createElement("td",null,je(I.quantity)),React.createElement("td",{className:"fw-semibold"},pt(I.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},Me.customers.slice(0,10).map(I=>React.createElement("div",{key:I.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},I.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},I.phone||"\u2014"," \u2022 ",je(I.orders)," \u0111\u01A1n \u2022 ",je(I.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},pt(I.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,Me.customers.slice(0,10).map(I=>React.createElement("tr",{key:I.key},React.createElement("td",null,I.customer_name||"\u2014"),React.createElement("td",null,I.phone||"\u2014"),React.createElement("td",null,je(I.orders)),React.createElement("td",null,je(I.quantity)),React.createElement("td",{className:"fw-semibold"},pt(I.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},Me.days.map(I=>React.createElement("div",{key:I.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},I.day),React.createElement("div",{className:"text-muted small"},je(I.orders)," \u0111\u01A1n \u2022 ",je(I.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",je(I.doneOrders)," \u2022 ",pt(I.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},pt(I.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,Me.days.map(I=>React.createElement("tr",{key:I.day},React.createElement("td",null,I.day),React.createElement("td",null,je(I.orders)),React.createElement("td",null,je(I.quantity)),React.createElement("td",{className:"fw-semibold"},pt(I.revenue)),React.createElement("td",null,je(I.doneOrders)),React.createElement("td",{className:"fw-semibold"},pt(I.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:L,onMenuChange:c=>{Se(c),de(c),c==="albums"&&(le(null),ke([]),Ue(null))},onLogout:ae,currentUser:F,pinnedMenus:ue,recentMenus:Ne,onTogglePin:We}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const j={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[L]||{title:"KTM Admin",icon:"fa-tractor",sub:""},E=(F==null?void 0:F.username)||(F==null?void 0:F.name)||(F==null?void 0:F.email)||"Admin",oe=(()=>{if(L!=="albums")return"";const me=[];return me.push("Root"),Array.isArray(ne)&&ne.length>0&&me.push(...ne.map(we=>we==null?void 0:we.title).filter(Boolean)),tt!=null&&tt.title&&me.push(tt.title),me.length>0?me.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${j.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},j.title),React.createElement("div",{className:"admin-page-subtitle"},oe||j.sub))),React.createElement("div",{className:"admin-topbar-right"},L==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:Tt,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:E},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},E)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:ae,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},L==="albums"&&!tt&&React.createElement(AlbumList,{albums:O,loading:lt,currentFolder:Z,breadcrumb:ne,onSelect:Kt,onCreate:Tt,onEdit:gt,onDelete:H,onBack:w}),L==="search"&&React.createElement(SearchCenter,{showToast:Pe,onNavigate:(c,j,E)=>{de(c),c==="orders"&&j==="create"&&(ve(Date.now()),fe((E==null?void 0:E.productId)||""))}}),L==="albums"&&tt&&React.createElement(AlbumDetail,{album:tt,parentAlbum:ne.length>0?ne[ne.length-1]:null,onBack:()=>{if(tt.parentId){const c=ne.findIndex(j=>j.uuid===tt.parentId);c>=0?Ge(ne[c]):Ge(null)}else Ge(null)},onRefresh:()=>Ue(Z==null?void 0:Z.uuid),showToast:Pe,onNavigateToFolder:c=>{ke(j=>[...j,tt]),Ge(c)},onEditSubfolder:c=>{Ve(c),Te(!0)}}),L==="videos"&&React.createElement(VideoList,{showToast:Pe}),L==="products"&&React.createElement(ProductManager,{showToast:Pe,settings:T}),L==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:pe,autoOpenCreateProductId:Le,showToast:Pe}),L==="stats"&&React.createElement(A,null),L==="settings"&&React.createElement(vt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${L==="search"?"active":""}`,onClick:c=>{c.preventDefault(),de("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${L==="albums"?"active":""}`,onClick:c=>{c.preventDefault(),de("albums"),Ge(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${L==="videos"?"active":""}`,onClick:c=>{c.preventDefault(),de("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${L==="products"?"active":""}`,onClick:c=>{c.preventDefault(),de("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${L==="orders"?"active":""}`,onClick:c=>{c.preventDefault(),de("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${L==="stats"?"active":""}`,onClick:c=>{c.preventDefault(),de("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:ye,album:ie,parentId:Z==null?void 0:Z.uuid,onClose:()=>Te(!1),onSave:Wt}),React.createElement(AdminDrawer,{open:ut,title:v?v.title:"Album",subtitle:v?`${v.subfolderCount||0} subfolder \u2022 ${v.count||0} \u1EA3nh`:"",onClose:ot,footer:Y?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Q(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{v&&(Ve(v),Wt({slug:v.id||"",title:v.title||"",description:v.description||"",cover_url:v.cover||"",parent_id:v.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):v?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(v.title),Pe("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>Ft(v)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{v&&confirm(`X\xF3a folder "${v.title}"?`)&&(H(v),ot())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Y&&v?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:v.title,onChange:c=>M({...v,title:c.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:v.description,onChange:c=>M({...v,description:c.target.value})}))):v?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},v.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},v.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},v.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},v.count||0))),v.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,v.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Ae.map(c=>React.createElement(Toast,{key:c.id,message:c.message,type:c.type,actionLabel:c.actionLabel,onAction:c.onAction,durationMs:c.durationMs,onClose:()=>bt(c.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:S,autoOpenCreateProductId:C,showToast:$}){const[X,F]=useState([]),[D,L]=useState(0),[de,ue]=useState(!1),[te,Ne]=useState(!1),[Re,pe]=useState([]),[ve,Le]=useState(!0),[fe,O]=useState(!1),[Fe,tt]=useState([]),[Ge,ye]=useState(!1),[Te,ie]=useState(""),[Ve,lt]=useState([]),[wt,Ae]=useState(!1),[at,ut]=useState(""),[y,v]=useState(!1),[M,Y]=useState(null),[Q,V]=useState(null),[J,re]=useState(!1),[b,T]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[P,Z]=useState(""),[le,ne]=useState(!1),[ke,Se]=useState(!1),[We,rt]=useState(!1),[ae,Pe]=useState(null),[bt,Ue]=useState(!1),[Tt,gt]=useState(""),[Wt,Kt]=useState(!1),w=useRef(0),[H,Ee]=useState(!1),[ot,Ft]=useState(null),[ct,vt]=useState(!1),[A,c]=useState(null),[j,E]=useState(()=>({left:12,top:12,placement:"bottom"})),oe=useRef(null),me=useRef(!1),we=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1}),[Be,Ce]=useState(()=>({id:null,dir:null})),Pt=useRef(!1),dt=useRef(new Map),xt=useRef(null),jt=useRef(null),Me="ktm_orders_status_sync_queue_v1",Mt=useRef([]),Oa=useRef(!1),[Ut,je]=useState(()=>({})),[pt,Ca]=useState(!1),[Aa,ta]=useState(!1),[aa,na]=useState(!1),[fa,Et]=useState(()=>new Set),[Bt,_a]=useState(()=>({})),Ka="ktm_orders_pinned_v1",[ft,ja]=useState(()=>new Set),[ha,sa]=useState(!1),[ba,zt]=useState(!1),[St,Ta]=useState(!1),[ia,Jt]=useState(""),[Da,Xt]=useState(()=>[]),ma=useRef(null),$t=useRef(null),I=useRef(!1),se=useRef({active:!1,startY:0,startX:0,fired:!1}),[Oe,nt]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),kt=24,It=20,[Ye,Dt]=useState(kt),Yt=useRef(null),Ct=useRef(null),At=useRef(!1),Ht=useRef(new Map),Ma=useRef({timer:null,events:[]}),s=useRef(null),m="ktm_orders_phone_tip_v1",d="ktm_orders_search_history_v1",[_,R]=useState(null),[k,g]=useState(!1),[G,ce]=useState([]),[W,ee]=useState(!1),[$e,He]=useState([]),[f,xe]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Ot,yt]=useState([""]),[Qt,Gt]=useState(null),Zt=useRef({}),[Rt,ra]=useState([]),[Qe,ga]=useState(null),fn=useRef(null),$a=useRef(null),K=useRef(0),q=useRef(null),U=useRef(0),he=useRef(new Map),ge=useRef(null),be=useRef(0),qe=useRef(new Map),Ke=useRef(new Map),Ze=useRef(""),Nt=useRef(null),_t=useRef(null),qt=useRef(0),oa=useRef(null),ea=9,la=150,va=250,ya=3*60*1e3,Na=24*60*60*1e3,Fa=5*60*1e3,Ra="ktm_customer_lookup_cache_v1",hn=200,wa=3,Ha=3,Ln=1,Os=24*60*60*1e3,js=120,Ds=5*60*1e3,Yn=80,Qn=2,Zn=4,es=60,_e=React.useMemo(()=>String(Te||"").trim().length>0,[Te]),sn=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),ts=e=>{Ft(e),Ee(!0)},as=(e,a)=>{var t,n,i,r;try{const u=(t=a==null?void 0:a.getBoundingClientRect)==null?void 0:t.call(a),l=window.innerWidth||360,N=window.innerHeight||640,p=230,o=280,h=Math.min(Math.max(10,Math.round((n=u==null?void 0:u.left)!=null?n:10)),Math.max(10,l-p-10));let x=Math.round(((i=u==null?void 0:u.bottom)!=null?i:10)+8),B="bottom";x+o>N-10&&(x=Math.max(10,Math.round(((r=u==null?void 0:u.top)!=null?r:10)-8-o)),B="top"),E({left:h,top:x,placement:B})}catch(u){E({left:12,top:12,placement:"bottom"})}c(e),vt(!0)},qa=()=>{vt(!1),setTimeout(()=>c(null),120)};useEffect(()=>{if(!ct)return;const e=a=>{a.key==="Escape"&&qa()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ct]);const Va=()=>{Ee(!1),setTimeout(()=>Ft(null),180)},Rs=()=>{Ca(!0)},bn=()=>{Ca(!1)},ns=e=>{const a=String(e||"").trim();a&&Et(t=>{const n=new Set(t);return n.has(a)?n.delete(a):n.add(a),n})};useEffect(()=>{try{const e=localStorage.getItem(Ka);if(!e)return;const a=JSON.parse(e);if(!Array.isArray(a))return;ja(new Set(a.map(t=>String(t||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from(ft||[]).map(a=>String(a||"").trim()).filter(Boolean);localStorage.setItem(Ka,JSON.stringify(e))}catch(e){}},[ft]);const Ls=e=>{const a=String(e||"").trim();a&&ja(t=>{const n=new Set(t);return n.has(a)?n.delete(a):n.add(a),n})};useEffect(()=>{try{const e=localStorage.getItem(d);if(!e)return;const a=JSON.parse(e);if(!Array.isArray(a))return;Xt(a.map(t=>String(t||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Ps=e=>{try{localStorage.setItem(d,JSON.stringify(e))}catch(a){}},rn=e=>{const a=String(e||"").trim();a&&Xt(t=>{const n=Array.isArray(t)?t:[],i=[a,...n.filter(r=>String(r||"").trim().toLowerCase()!==a.toLowerCase())].slice(0,10);return Ps(i),i})},ss=e=>{var t;const a=String((t=e!=null?e:Te)!=null?t:"").trim();Jt(a),Ta(!0),setTimeout(()=>{var n,i;try{(i=(n=ma.current)==null?void 0:n.focus)==null||i.call(n)}catch(r){}},0)},ua=()=>{Ta(!1)};useEffect(()=>{if(!St)return;const e=a=>{a.key==="Escape"&&ua()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[St]),useEffect(()=>{if(!Oe)return;const e=n=>{if(St||(window.scrollY||0)>6)return;const i=n.touches&&n.touches[0];i&&(se.current={active:!0,startY:i.clientY,startX:i.clientX,fired:!1})},a=n=>{const i=se.current;if(!(i!=null&&i.active)||i.fired||(window.scrollY||0)>6)return;const r=n.touches&&n.touches[0];if(!r)return;const u=r.clientY-i.startY,l=r.clientX-i.startX;Math.abs(l)>24||u>92&&(i.fired=!0,ss(Te))},t=()=>{se.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",a,{passive:!0}),window.addEventListener("touchend",t,{passive:!0}),window.addEventListener("touchcancel",t,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)}},[Oe,St,Te]);const is=e=>{try{const a=Lt(e==null?void 0:e.status);if(!(a==="pending"||a==="processing"))return!1;const t=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(t.getTime()))return!1;const n=new Date;return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate()}catch(a){return!1}};useEffect(()=>{var t;let e;const a=()=>{try{nt(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(n){nt(!1)}};try{e=(t=window.matchMedia)==null?void 0:t.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",a):e!=null&&e.addListener&&e.addListener(a)}catch(n){e=null}return window.addEventListener("resize",a),a(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",a):e!=null&&e.removeListener&&e.removeListener(a)}catch(n){}window.removeEventListener("resize",a)}},[]),useEffect(()=>{const e="admin-sheet-open";return H||pt||ct?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[H,pt,ct]),useEffect(()=>{if(!H&&!pt&&!ct)return;const e=a=>{a.key==="Escape"&&(H&&Va(),pt&&bn(),ct&&qa())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[H,pt,ct]);const Es=()=>{try{if(localStorage.getItem(m))return;localStorage.setItem(m,"1"),typeof $=="function"&&$("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},rs=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),os=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),ls=e=>{const a=it(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{window.location.href=`tel:${a}`}catch(t){}},Ks=async e=>{var t,n,i;const a=it(String(e||"")).replace(/[^0-9+]/g,"");if(a)try{await((i=(n=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:n.call(t,a))!=null?i:Promise.reject(new Error("Clipboard not available"))),typeof $=="function"&&$("\u0110\xE3 copy S\u0110T","success")}catch(r){typeof $=="function"&&$("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Fs=()=>{try{const e=localStorage.getItem(Me),a=e?JSON.parse(e):[];return Array.isArray(a)?a:[]}catch(e){return[]}},cs=e=>{try{localStorage.setItem(Me,JSON.stringify(Array.isArray(e)?e:[]))}catch(a){}},gn=(e,a)=>{const t=String(e||"").trim();t&&je(n=>{const i={...n||{}};return a?i[t]=!0:delete i[t],i})},Hs=(e,a,t)=>{const n=String(e||"").trim(),i=Lt(a),r=Lt(t);if(!n||!i)return;const u=Array.isArray(Mt.current)?Mt.current:[],l=new Map(u.map(p=>[String((p==null?void 0:p.orderId)||""),p]));l.set(n,{orderId:n,nextStatus:i,prevStatus:r,ts:Date.now()});const N=Array.from(l.values()).sort((p,o)=>(Number(p.ts)||0)-(Number(o.ts)||0));Mt.current=N,cs(N),gn(n,!0)},Pn=async()=>{if(Oa.current||!navigator.onLine)return;const e=Array.isArray(Mt.current)?Mt.current.slice():[];if(e.length){Oa.current=!0;try{for(const a of e){const t=String((a==null?void 0:a.orderId)||"").trim(),n=Lt(a==null?void 0:a.nextStatus);if(!(!t||!n)){gn(t,!0);try{await Ga({id:t,status:(a==null?void 0:a.prevStatus)||""},n,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const i=(Array.isArray(Mt.current)?Mt.current:[]).filter(r=>String((r==null?void 0:r.orderId)||"")!==t);Mt.current=i,cs(i),gn(t,!1)}catch(i){if(!navigator.onLine)break}}}}finally{Oa.current=!1}}};useEffect(()=>{const e=Fs();Mt.current=e;try{const a={};for(const t of e){const n=String((t==null?void 0:t.orderId)||"").trim();n&&(a[n]=!0)}je(a)}catch(a){}setTimeout(()=>Pn(),600)},[]),useEffect(()=>{const e=()=>Pn();window.addEventListener("online",e);const a=setInterval(()=>Pn(),8e3);return()=>{clearInterval(a),window.removeEventListener("online",e)}},[]);const qs=(e,a)=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e),At.current=!1,Es();try{Ct.current&&clearTimeout(Ct.current)}catch(n){}Ct.current=setTimeout(()=>{At.current=!0,Ks(a)},520)},vn=e=>{var a;(a=e==null?void 0:e.stopPropagation)==null||a.call(e);try{Ct.current&&clearTimeout(Ct.current)}catch(t){}Ct.current=null},Vs=e=>{const a=String(e||"").trim();if(!a)return;_a(i=>({...i,[a]:Date.now()}));const t=Ht.current;try{const i=t.get(a);i&&clearTimeout(i)}catch(i){}const n=setTimeout(()=>{_a(i=>{const r={...i||{}};return delete r[a],r});try{t.delete(a)}catch(i){}},9e3);t.set(a,n)},ds=e=>String(e||"").replace(/\s+/g," ").trim(),Bs=e=>String(e||"").replace(/[^0-9]+/g,""),on=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/Os)}catch(a){return 0}},yn=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:on(e)>=wa,Lt=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},En=React.useMemo(()=>["draft","pending","processing","done","paid"],[]),Ua=(e,a)=>{const t=Lt(e);if(!t||t==="canceled")return null;const n=En.indexOf(t);return n<0?null:a==="left"?En[n+1]||null:a==="right"&&En[n-1]||null},ms=e=>{var i;const a=Lt(e);if(!a)return{label:"",icon:"fa-circle"};const t=((i=sn.find(r=>Lt(r==null?void 0:r.value)===a))==null?void 0:i.label)||"",n=(()=>{switch(a){case"draft":return"fa-file-lines";case"pending":return"fa-hourglass-half";case"processing":return"fa-truck";case"done":return"fa-check";case"paid":return"fa-money-bill-wave";case"canceled":return"fa-ban";default:return"fa-circle"}})();return{label:t,icon:n}},Nn=e=>{if(Lt(e==null?void 0:e.status)!=="draft")return null;const t=Ha-on(e);return Number.isFinite(t)?t:null},wn=e=>{const a=Nn(e);return Number.isFinite(a)?a>0&&a<=Ln:!1},Ba=e=>{xe({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),yt([""]),R(null),Gt(null)};useEffect(()=>{const e=a=>{var n;if(Qt==null)return;const t=(n=Zt.current)==null?void 0:n[Qt];t&&!t.contains(a.target)&&Gt(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Qt]);const us=e=>window.KTM.money.parseMoney(e),ps=e=>window.KTM.money.parseSignedMoney(e),et=e=>window.KTM.money.formatVND(e),xa=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var i,r;return{amount:String((i=n==null?void 0:n.amount)!=null?i:""),note:String((r=n==null?void 0:n.note)!=null?r:"")}});return t.length?t:[{amount:"",note:""}]},zs=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var i,r;return{amount:(n==null?void 0:n.amount)===0?"":String((i=n==null?void 0:n.amount)!=null?i:""),note:String((r=n==null?void 0:n.note)!=null?r:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},Xa=e=>(Array.isArray(e)?e:[]).map(t=>({amount:ps(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),Kn=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Xa(a),n=Ya(t),i=(()=>{if(!t.length)return"";const r=t.map(u=>String((u==null?void 0:u.note)||"").trim()).filter(Boolean);return r.length?r.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:i}},Ya=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),Fn=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},fi=e=>window.KTM.money.parseShipFeeFromNote(e),Qa=e=>window.KTM.phone.isValid(e),it=e=>window.KTM.phone.normalize(e),Hn=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},Js=(e,a)=>{var r;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const i=new Map(t.map(u=>{var l;return[String((l=u==null?void 0:u.id)!=null?l:""),u]}));for(const u of n){const l=String((r=u==null?void 0:u.id)!=null?r:"");l&&i.set(l,u)}return Array.from(i.values())},xn=async e=>{var a,t,n,i;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const r=(t=(a=dt.current)==null?void 0:a.get)==null?void 0:t.call(a,String(e.id));if(r&&typeof r=="object"&&Array.isArray(r.items)&&r.items.length)return r}catch(r){}try{const r=await Hn(e.id);if(r&&typeof r=="object"){try{(i=(n=dt.current)==null?void 0:n.set)==null||i.call(n,String(e.id),r)}catch(u){}return F(u=>Array.isArray(u)?u.map(l=>String(l==null?void 0:l.id)===String(e.id)?r:l):u),r}}catch(r){console.error("Fetch order by id error:",r)}return e},Gs=()=>{var e;try{const a=localStorage.getItem(Ra);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[i,r]of n)!i||!r||typeof r!="object"||(e=Ke.current)==null||e.set(String(i),r)}catch(a){}},qn=()=>{try{const e=Ke.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,i])=>n&&i&&typeof i=="object"&&Number.isFinite(i.ts)).sort((n,i)=>(Number(i[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,hn),t={};for(const[n,i]of a)t[n]=i;localStorage.setItem(Ra,JSON.stringify(t))}catch(e){}};useEffect(()=>{Gs()},[]);const fs=e=>{const a=it(e);if(!a)return null;const t=Array.isArray(X)?X:[];let n=null,i=-1;for(const r of t){if(!r||it(r.phone||"")!==a)continue;const u=new Date(r.created_at).getTime(),l=Number.isFinite(u)?u:0;l>=i&&(i=l,n=r)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},hs=(e,a)=>{e&&xe(t=>a&&it(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Ws=e=>{const a=fs(e);if(!a)return;const t=it(e);xe(n=>{if(t&&it(n.phone)!==t)return n;const i={...n};return!String(n.customer_name||"").trim()&&a.name&&(i.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(i.address=a.address),i})},Us=(e,a,t)=>{var n;try{const i=it(e);if(!i)return;const r=String(a||"").trim(),u=String(t||"").trim();if(!r&&!u)return;(n=Ke.current)==null||n.set(i,{ts:Date.now(),status:"found",customer:{phone:i,name:r||null,address:u||null}}),qn()}catch(i){}},kn=async e=>{var i,r,u;const a=it(e);if(!a)return;Ws(a);const t=(i=Ke.current)==null?void 0:i.get(a);if(t&&Number.isFinite(t.ts)){const l=Date.now()-t.ts,N=t.status==="found"?Na:Fa;if(l>=0&&l<=N){R({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&hs(t.customer,a);return}}const n=++K.current;R({status:"loading",phone:a});try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(K.current!==n)return;if(l&&l.exists&&l.customer){(r=Ke.current)==null||r.set(a,{ts:Date.now(),status:"found",customer:l.customer}),qn(),R({status:"found",phone:a,customer:l.customer}),hs(l.customer,a);return}(u=Ke.current)==null||u.set(a,{ts:Date.now(),status:"not-found",customer:null}),qn(),R({status:"not-found",phone:a})}catch(l){if(K.current!==n)return;console.error("Customer lookup error:",l),R({status:"error",phone:a})}},bs=e=>{const a=it(e),t=fs(a);xe(i=>{const r={...i,phone:a};return t&&(!String(i.customer_name||"").trim()&&t.name&&(r.customer_name=t.name),!String(i.address||"").trim()&&t.address&&(r.address=t.address)),r}),g(!1),$a.current&&(clearTimeout($a.current),$a.current=null);const n=a;if(n.length<ea){R(null);return}if(Qa(n)&&n!==Ze.current){Ze.current=n,kn(n);return}$a.current=setTimeout(()=>{const i=it(a);Qa(i)&&i!==Ze.current&&(Ze.current=i,kn(i))},la)},gs=()=>{const e=it(f.phone);e.length<ea||Qa(e)&&e!==Ze.current&&(Ze.current=e,kn(e))};useEffect(()=>(ke?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[ke]);const Sn=Array.isArray(f.items)?f.items.length:0;useEffect(()=>{if(!ke){qt.current=Sn;return}Sn>qt.current&&setTimeout(()=>{const e=Nt.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),qt.current=Sn},[ke,Sn]),useEffect(()=>()=>{$a.current&&(clearTimeout($a.current),$a.current=null),q.current&&(clearTimeout(q.current),q.current=null)},[]),useEffect(()=>{if(!ke)return;q.current&&(clearTimeout(q.current),q.current=null);const e=it((f==null?void 0:f.phone)||"");if(!Qa(e)){ce([]),ee(!1);return}return q.current=setTimeout(async()=>{var i;const a=String(e),t=(i=he.current)==null?void 0:i.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=ya){ce(Array.isArray(t.orders)?t.orders:[]),ee(!1);return}const n=++U.current;ee(!0);try{const r=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,u=await window.KTM.api.getJSON(r,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(U.current!==n)return;const l=Array.isArray(u)?u:Array.isArray(u==null?void 0:u.orders)?u.orders:[];ce(l);try{const N=he.current;if(N&&typeof N.set=="function"&&(N.set(a,{ts:Date.now(),orders:l}),N.size>100)){const p=Array.from(N.entries()).sort((h,x)=>{var B,z;return(Number((B=h==null?void 0:h[1])==null?void 0:B.ts)||0)-(Number((z=x==null?void 0:x[1])==null?void 0:z.ts)||0)}),o=Math.max(0,p.length-100);for(let h=0;h<o;h++)N.delete(p[h][0])}}catch(N){}}catch(r){if(U.current!==n)return;console.error("Phone history fetch error:",r),ce([])}finally{if(U.current!==n)return;ee(!1)}},va),()=>{q.current&&(clearTimeout(q.current),q.current=null)}},[ke,f==null?void 0:f.phone]),useEffect(()=>{Qs()},[]),useEffect(()=>{_e||za()},[b,_e]),useEffect(()=>{_n()},[]),useEffect(()=>{S&&fn.current!==S&&(fn.current=S,Tn(C))},[S]);const pa=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",Za=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",La=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(X),a=ft;if(!a||!(a instanceof Set)||a.size===0)return e;const t=Array.isArray(e)?e.slice():[];return t.sort((n,i)=>{var l,N;const r=a.has(String((l=n==null?void 0:n.id)!=null?l:""))?1:0;return(a.has(String((N=i==null?void 0:i.id)!=null?N:""))?1:0)-r}),t},[X,ft]),Vn=React.useMemo(()=>window.KTM.orders.sortOrders(Re),[Re]),Cn=React.useMemo(()=>{const a=(Array.isArray(Vn)?Vn:[]).filter(t=>yn(t));return a.sort((t,n)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),r=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(r)?r:0)}),a},[Vn]),vs=React.useMemo(()=>{const a=(Array.isArray(Fe)?Fe:[]).filter(t=>wn(t));return a.sort((t,n)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),r=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(r)?r:0)}),a},[Fe]),ln=React.useMemo(()=>{if(le)return Cn;let e=La;if(ha){const a=ft;e=(Array.isArray(e)?e:[]).filter(t=>{var n,i;return(i=a==null?void 0:a.has)==null?void 0:i.call(a,String((n=t==null?void 0:t.id)!=null?n:""))})}return ba&&(e=(Array.isArray(e)?e:[]).filter(a=>is(a))),e},[le,Cn,La,ha,ft,ba]),An=React.useMemo(()=>{if(le)return ln;const e=String(P||"").trim();return e?(Array.isArray(ln)?ln:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):ln},[ln,P,le]),ys=React.useMemo(()=>window.KTM.orders.sortOrders(Ve),[Ve]),ht=React.useMemo(()=>_e?ys:An,[An,_e,ys]),Ns=React.useMemo(()=>{const e=Array.isArray(ht)?ht:[];return Oe?e.slice(0,Math.max(0,Number(Ye)||0)):e},[Oe,Ye,ht]);useEffect(()=>{Oe&&Dt(kt)},[Oe,P,le,b,Te]),useEffect(()=>{if(!Oe)return;const e=Array.isArray(ht)?ht.length:0;if(Ye>=e)return;const a=Yt.current;if(!a)return;const t=new IntersectionObserver(n=>{Array.isArray(n)&&n.some(r=>r==null?void 0:r.isIntersecting)&&Dt(r=>Math.min((Number(r)||0)+It,e))},{root:null,rootMargin:"520px 0px",threshold:0});return t.observe(a),()=>t.disconnect()},[Oe,Ye,ht]),useEffect(()=>{if(!Oe){ta(!1),na(!1);return}const e=()=>{s.current||(s.current=window.requestAnimationFrame(()=>{s.current=null;const a=window.scrollY||document.documentElement.scrollTop||0;ta(a>140),na(a>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),s.current&&(window.cancelAnimationFrame(s.current),s.current=null)}},[Oe]),useEffect(()=>{if(!Oe){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(a){}return}const e=()=>{try{const a=document.querySelector(".mobile-bottom-nav"),t=a&&a.offsetHeight?a.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${t}px`)}catch(a){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[Oe]);const Pa=React.useMemo(()=>{const e=Array.isArray(ht)?ht:[],a={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const n=Lt(t==null?void 0:t.status);n==="draft"?a.draft+=1:n==="pending"?a.pending+=1:n==="processing"?a.processing+=1:n==="done"?a.done+=1:n==="paid"?a.paid+=1:n==="canceled"?a.canceled+=1:a.other+=1}return a},[ht]),Xs=React.useMemo(()=>{const e=ft;return!e||e.size===0?0:(Array.isArray(La)?La:[]).reduce((a,t)=>{var n;return a+(e.has(String((n=t==null?void 0:t.id)!=null?n:""))?1:0)},0)},[ft,La]),Ys=React.useMemo(()=>(Array.isArray(La)?La:[]).filter(e=>is(e)).length,[La]),ws=React.useMemo(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`},[]),Ia=e=>{if(_e&&ie(""),e==="thisMonth"){ne(!1),Z(""),T(ws);return}if(e==="overduePending"){T(""),ne(!0),Z("pending");return}if(e==="draftExpiring"){ne(!1),Z("draft"),T(""),_n();return}if(e==="all"){ne(!1),Z(""),T(ws);return}},en=e=>window.KTM.date.formatDateTime(e),Qs=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");ra(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),ra([])}},za=async()=>{Le(!0),Ne(!1);try{const a=new URLSearchParams;b&&a.set("month",String(b)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(es)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),i=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],r=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;F(Array.isArray(i)?i:[]),L(Array.isArray(i)?i.length:0),ue(!!(r!=null&&r.hasMore)),_n()}catch(a){console.error("Load orders error:",a),F([]),L(0),ue(!1)}finally{Le(!1),Ne(!1)}},Zs=async()=>{if(!(ve||te||_e)&&de){Ne(!0);try{const e=new URLSearchParams;b&&e.set("month",String(b)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(es)),e.set("offset",String(D));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],i=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;F(r=>Js(r,Array.isArray(n)?n:[])),L(r=>r+(Array.isArray(n)?n.length:0)),ue(!!(i!=null&&i.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{Ne(!1)}}},xs=async e=>{var i;const a=ds(e);if(!a){lt([]),ut(""),Ae(!1);return}const t=Bs(a);if(a.length<Qn&&t.length<Zn){lt([]),ut(`Nh\u1EADp \xEDt nh\u1EA5t ${Qn} k\xFD t\u1EF1 (ho\u1EB7c ${Zn} s\u1ED1) \u0111\u1EC3 search nhanh`),Ae(!1);return}try{const r=(i=qe.current)==null?void 0:i.get(a);if(r&&Number.isFinite(r.ts)&&Date.now()-r.ts<=Ds){lt(Array.isArray(r.results)?r.results:[]),ut(""),Ae(!1);return}}catch(r){}const n=++be.current;Ae(!0),ut("");try{const r=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,u=await window.KTM.api.getJSON(r,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(be.current!==n)return;const l=Array.isArray(u)?u:[];lt(l);try{const N=qe.current;if(N&&typeof N.set=="function"&&(N.set(a,{ts:Date.now(),results:l}),N.size>Yn)){const p=Array.from(N.entries()).sort((h,x)=>{var B,z;return(Number((B=h==null?void 0:h[1])==null?void 0:B.ts)||0)-(Number((z=x==null?void 0:x[1])==null?void 0:z.ts)||0)}),o=Math.max(0,p.length-Yn);for(let h=0;h<o;h++)N.delete(p[h][0])}}catch(N){}}catch(r){if(be.current!==n)return;console.error("Order search error:",r),lt([]),ut((r==null?void 0:r.message)||"Search l\u1ED7i")}finally{if(be.current!==n)return;Ae(!1)}};useEffect(()=>{ge.current&&(clearTimeout(ge.current),ge.current=null);const e=ds(Te);if(!e){lt([]),ut(""),Ae(!1);return}return le&&ne(!1),ge.current=setTimeout(()=>{xs(e)},js),()=>{ge.current&&(clearTimeout(ge.current),ge.current=null)}},[Te]);const _n=async()=>{O(!0),ye(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(wa)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Ln)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);pe(Array.isArray(e)?e:[]),tt(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),pe([]),tt([])}finally{O(!1),ye(!1)}},Bn=async e=>{const a=await xn(e);if(!a)return;ga(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(l=>{var N,p,o,h;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((N=l==null?void 0:l.quantity)!=null?N:1)||1,unit_price:(()=>{var z;const x=(z=l==null?void 0:l.unit_price)!=null?z:l==null?void 0:l.unitPrice,B=x==null||x===""?NaN:Number(x);return Number.isFinite(B)?Math.trunc(B):null})(),variant:String((p=l==null?void 0:l.variant)!=null?p:"").trim(),variant_json:(h=(o=l==null?void 0:l.variant_json)!=null?o:l==null?void 0:l.variantJson)!=null?h:null}}).filter(l=>l.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=zs(a),i=Xa(n),r=Ya(i),u=Fn(i);xe({customer_name:a.customer_name||"",phone:it(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:r,adjustment_note:u||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),yt(new Array(t.length?t.length:1).fill("")),He(new Array(t.length?t.length:1).fill(!0)),R(null),Se(!1),Pe(a),rt(!0),gt(""),Ue(!1),Kt(!0),a.phone&&kn(it(a.phone))},cn=async e=>{if(!e)return;rt(!0),gt(""),Ue(!0),Kt(!1),Pe(e);const a=++w.current;try{const t=await xn(e);if(w.current!==a)return;Pe(t||e)}catch(t){if(w.current!==a)return;gt((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(w.current!==a)return;Ue(!1)}},ei=()=>{y||J||(rt(!1),Ue(!1),gt(""),Kt(!1),ga(null),Ba(""),g(!1),He([]))};function Tn(e){rt(!1),Kt(!1),Ue(!1),gt(""),ga(null),Ba(e||""),g(!1),He([]),Se(!0)}const zn=()=>{y||J||(Se(!1),ga(null),Ba(""),g(!1),He([]))},ks=async()=>{var l,N,p;if(!Qe||J||y)return;const e=(Array.isArray(X)?X:[]).find(o=>String(o==null?void 0:o.id)===String(Qe))||null,a=String((e==null?void 0:e.status)||(f==null?void 0:f.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const o="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof $=="function"?$(o,"warning"):alert(o);return}const t=it(f.phone),i=(Array.isArray(f.items)?f.items:[]).map((o,h)=>{var x,B;return{idx:h,product_id:String((o==null?void 0:o.product_id)||"").trim(),quantity:Number((x=o==null?void 0:o.quantity)!=null?x:0),variant:String((o==null?void 0:o.variant)||"").trim()||null,variant_json:(B=o==null?void 0:o.variant_json)!=null?B:null,unit_price:(()=>{const z=o==null?void 0:o.unit_price,De=z===""||z==null?NaN:Number(z);if(Number.isFinite(De))return Math.max(0,Math.trunc(De));const Ie=ca(o==null?void 0:o.product_id),mt=o!=null&&o.variant_json&&typeof o.variant_json=="object"?o.variant_json:null;return tn(Ie,mt)})()}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0);if(i.length<2){const o="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof $=="function"?$(o,"warning"):alert(o);return}const r=[],u=[];for(const o of i){const h=!!$e[o.idx],x={product_id:o.product_id,quantity:o.quantity,unit_price:o.unit_price,variant:o.variant,variant_json:o.variant_json};h?r.push(x):u.push(x)}if(!r.length||!u.length){const o="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof $=="function"?$(o,"warning"):alert(o);return}re(!0);try{const o=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],h=Xa(o),x=Ya(h),B=Fn(h),z={customer_name:f.customer_name,phone:t,address:f.address,note:(f.note||"").trim(),adjustment_amount:x,adjustment_note:B,adjustment_items:h,status:"processing",items:r,product_id:r[0].product_id,quantity:r[0].quantity,split_seq:1},De=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,z,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),Ie=(p=(N=De==null?void 0:De.id)!=null?N:(l=De==null?void 0:De.order)==null?void 0:l.id)!=null?p:null;if(!Ie)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const mt={id:Qe,customer_name:f.customer_name,phone:t,address:f.address,note:(f.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:u,product_id:u[0].product_id,quantity:u[0].quantity,parent_order_id:String(Ie),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${Qe}`,mt,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),zn(),za();const ze=Ie?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${Ie}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof $=="function"?$(ze,"success"):alert(ze)}catch(o){console.error(o);const h=(o==null?void 0:o.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof $=="function"?$(h,"danger"):alert(h)}finally{re(!1)}},Ss=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=Rt.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},ka=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},ti=e=>{const t=ka(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},Cs=React.useMemo(()=>(Array.isArray(Rt)?Rt:[]).map((e,a)=>{var p,o,h,x,B,z;const t=ka((p=e==null?void 0:e.name)!=null?p:""),n=ka((o=e==null?void 0:e.code)!=null?o:""),i=ka((h=e==null?void 0:e.category)!=null?h:""),r=ka((x=e==null?void 0:e.note)!=null?x:""),u=ka((B=e==null?void 0:e.id)!=null?B:""),l=ka((z=e==null?void 0:e.stt)!=null?z:""),N=`${t} ${n} ${i} ${r} ${u} ${l}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:i,note:r,haystackAll:N}}),[Rt]),ai=(e,a,t)=>{var h,x,B,z,De;const n=Array.isArray(a)?a:[],i=ka(t).trim();if(!n.length&&!i)return 0;const r=(h=e==null?void 0:e.name)!=null?h:"",u=(x=e==null?void 0:e.code)!=null?x:"",l=(B=e==null?void 0:e.category)!=null?B:"",N=(z=e==null?void 0:e.note)!=null?z:"";if(!((De=e==null?void 0:e.haystackAll)!=null?De:""))return 0;let o=0;i&&(r===i&&(o+=220),r.includes(i)&&(o+=140),r.startsWith(i)&&(o+=160),u&&u===i&&(o+=180),u&&u.includes(i)&&(o+=90));for(const Ie of n){if(!Ie)continue;const mt=new RegExp(`(?:^|\\s)${Ie.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);r.includes(Ie)&&(o+=35),mt.test(r)&&(o+=25),u&&u.includes(Ie)&&(o+=20),u&&mt.test(u)&&(o+=10),l&&l.includes(Ie)&&(o+=12),N&&N.includes(Ie)&&(o+=6)}return o>0&&r&&(o+=Math.max(0,10-Math.min(10,Math.floor(r.length/10)))),o},Jn=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const i=t.length,r=n.length;if(r>i)return Jn(n,t);let u=new Array(r+1),l=new Array(r+1);for(let N=0;N<=r;N++)u[N]=N;for(let N=1;N<=i;N++){l[0]=N;const p=t.charCodeAt(N-1);for(let h=1;h<=r;h++){const x=p===n.charCodeAt(h-1)?0:1;l[h]=Math.min(u[h]+1,l[h-1]+1,u[h-1]+x)}const o=u;u=l,l=o}return u[r]},ni=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const i=n.split(/\s+/).filter(Boolean);if(!i.length)return!1;const r=t.length<=4?1:2;for(const u of i)if(!(Math.abs(u.length-t.length)>r)&&Jn(t,u)<=r)return!0;return!1},Mn=e=>{const a=ka(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},si=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=Mn((e==null?void 0:e.name)||""),i=Mn((e==null?void 0:e.code)||""),r=Mn((e==null?void 0:e.category)||""),u=Mn((e==null?void 0:e.note)||""),l=(p,o,h)=>{const x=String(p||"").trim();if(!x||!o.length)return 0;const B=x.length<=4?1:2;let z=1/0,De=-1;for(let ze=0;ze<o.length;ze++){const da=o[ze];if(!da||Math.abs(da.length-x.length)>B)continue;const st=Jn(x,da);if(st<z&&(z=st,De=ze,st===0))break}if(z===1/0||z>B)return 0;let mt=Math.round(h*(z===0?1:z===1?.65:.45));return De===0?mt+=Math.round(h*.25):De===1&&(mt+=Math.round(h*.12)),mt};let N=0;for(const p of t){if(!p)continue;const o=l(p,n,180),h=l(p,i,120),x=l(p,r,60),B=l(p,u,30);N+=Math.max(o,h,x,B)}if(N>0){const p=((e==null?void 0:e.name)||"").length;N+=Math.max(0,60-Math.min(60,Math.floor(p/2)))}return N},Gn=React.useRef(new Map);React.useEffect(()=>{Gn.current=new Map},[Rt]);const As=e=>{var p,o;const a=String(Ot[e]||"").trim();if(!a)return Rt;const{contentTokens:t,cleanedQuery:n}=ti(a);if(t.length===0)return Rt;const i=ka(a).trim(),r=Gn.current.get(i);if(r)return r;const u=[];for(const h of Cs){const x=h.haystackAll;x&&t.some(B=>x.includes(B))&&u.push(h)}let l=u;if(l.length<8&&t.length>0){const h=[],x=new Set(l.map(B=>{var z,De;return String((De=(z=B.p)==null?void 0:z.id)!=null?De:"")+":"+String(B.originalIndex)}));for(const B of Cs){const z=String((o=(p=B.p)==null?void 0:p.id)!=null?o:"")+":"+String(B.originalIndex);if(x.has(z))continue;const De=B.haystackAll;De&&t.some(Ie=>ni(Ie,De))&&(h.push(B),x.add(z))}h.length&&(l=l.concat(h))}const N=l.map(h=>({entry:h,score:ai(h,t,n)})).map(h=>{if(h.score>0)return h;const x=si(h.entry,t);return x>0?{...h,score:x}:h}).filter(h=>h.score>0).sort((h,x)=>x.score!==h.score?x.score-h.score:h.entry.originalIndex-x.entry.originalIndex).slice(0,40).map(h=>h.entry.p);return Gn.current.set(i,N),N},ca=e=>{if(!e)return null;const a=String(e);return Rt.find(t=>String(t==null?void 0:t.id)===a)||null},Ea=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var u;if(!t||typeof t!="object")return null;const i=String((u=t.name)!=null?u:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,r=(Array.isArray(t.options)?t.options:[]).map(l=>{var De,Ie,mt,ze,da,st,Sa;if(!l||typeof l!="object")return null;const N=String((De=l.label)!=null?De:"").trim();if(!N)return null;const p=(da=(ze=(mt=(Ie=l.price)!=null?Ie:l.priceValue)!=null?mt:l.unit_price)!=null?ze:l.unitPrice)!=null?da:null,o=p==null||p===""?NaN:typeof p=="number"?p:typeof p=="string"?us(p):Number(p),h=Number.isFinite(o)?Math.trunc(o):null,x=(Sa=(st=l.price_delta)!=null?st:l.priceDelta)!=null?Sa:null,B=Number(x),z=Number.isFinite(B)?Math.trunc(B):0;return{label:N,price:h,price_delta:z}}).filter(Boolean);return{name:i,options:r}}).filter(Boolean):[]},hi=e=>{const a=ca(e);return Ea(a==null?void 0:a.variants)},$n=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const i=String(t||"").trim(),r=String(n||"").trim();!i||!r||a.push(`${i}: ${r}`)}return a.join(", ")},tn=(e,a)=>{const t=us(e==null?void 0:e.price),n=Ea(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let i=t,r=!1;for(const u of n){const l=String((u==null?void 0:u.name)||"").trim(),N=String((a==null?void 0:a[l])||"").trim();if(!l||!N)continue;const p=(Array.isArray(u.options)?u.options:[]).find(z=>String((z==null?void 0:z.label)||"").trim()===N);if(!p)continue;const o=p==null?void 0:p.price,h=o==null||o===""?NaN:Number(o);if(Number.isFinite(h)){i=Math.max(0,Math.trunc(h)),r=!0;continue}const x=p==null?void 0:p.price_delta,B=x==null||x===""?NaN:Number(x);Number.isFinite(B)&&(i+=Math.trunc(B))}return i},Wn=e=>window.KTM.orders.getOrderItems(e),_s=e=>window.KTM.orders.getOrderTotalQty(e),an=e=>window.KTM.orders.getOrderProductSummary(e,ca),In=e=>window.KTM.orders.getOrderItemRows(e,ca),dn=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Ja=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),ii=e=>{const a=Wn(e),t=In(e),n=un(a),i=mn(a),r=i.fee,u=dn(e),l=n+r+u,N=o=>{const h=Number(o)||0;return h>0?`+${et(h)}`:et(h)},p=[];if(e!=null&&e.customer_name&&p.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&p.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&p.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&p.push(`GHI CH\xDA: ${(e.note||"").trim()}`),p.push(""),p.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const o of t)p.push(`- ${o.name} (SL: ${o.qty})`);else{const o=an(e);o&&o!=="\u2014"&&p.push(`- ${o}`)}p.push(""),p.push(`T\u1EA0M T\xCDNH: ${et(n)}`),i.found&&r!==0&&p.push(`SHIP: ${et(r)}`);{const o=window.KTM.orders.getOrderAdjustmentItems(e),h=(Array.isArray(o)?o:[]).map(z=>{var De;return{amount:Number((De=z==null?void 0:z.amount)!=null?De:0)||0,note:String((z==null?void 0:z.note)||"").trim()}}).filter(z=>z.amount!==0||!!z.note),x=Ja(e);if(u!==0||h.length>0||!!x)if(h.length===1){const z=h[0];p.push(`\u0110I\u1EC0U CH\u1EC8NH: ${N(u)}${z.note?` \u2014 ${z.note}`:""}`)}else{p.push(`\u0110I\u1EC0U CH\u1EC8NH: ${N(u)}${!h.length&&x?` \u2014 ${x}`:""}`);for(const z of h)p.push(`- ${N(z.amount)}${z.note?`: ${z.note}`:""}`)}}return p.push(`T\u1ED4NG: ${et(l)}`),p.filter(Boolean).join(`
`)},On=async e=>{try{const a=await xn(e),t=ii(a);await window.KTM.clipboard.writeText(t),typeof $=="function"?$("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof $=="function"?$("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},mn=e=>window.KTM.orders.getOrderShipInfo(e,ca),un=e=>window.KTM.orders.getItemsSubtotal(e,ca),Un=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},Xn=()=>b?String(b):Un(new Date),Ts=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=it((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=Kn(e).amount,u=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(l=>{var N;return{product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((N=l==null?void 0:l.quantity)!=null?N:0),variant:String((l==null?void 0:l.variant)||"").trim()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0).sort((l,N)=>l.product_id<N.product_id?-1:l.product_id>N.product_id?1:l.variant<N.variant?-1:l.variant>N.variant?1:l.quantity-N.quantity);return JSON.stringify({name:a,phone:t,address:n,items:u,adj:i})},Vt=React.useMemo(()=>{const e=it((f==null?void 0:f.phone)||"");if(!e)return{count:0,orders:[],monthKey:Xn()};const a=Xn(),n=(Array.isArray(G)?G:[]).filter(i=>{if(!i||Qe&&String(i.id)===String(Qe)||it(i.phone||"")!==e)return!1;const r=Un(i.created_at);return r&&r===a}).sort((i,r)=>{const u=new Date(i.created_at).getTime(),l=new Date(r.created_at).getTime();return(Number.isFinite(l)?l:0)-(Number.isFinite(u)?u:0)});return{count:n.length,orders:n,monthKey:a}},[G,f==null?void 0:f.phone,b,Qe]),ri=e=>{var l;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=it((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ps((l=e==null?void 0:e.adjustment_amount)!=null?l:0),r=Wn(e),u=(Array.isArray(r)?r:[]).map(N=>{var p;return{product_id:String((N==null?void 0:N.product_id)||"").trim(),quantity:Number((p=N==null?void 0:N.quantity)!=null?p:0),variant:String((N==null?void 0:N.variant)||"").trim()}}).filter(N=>N.product_id&&Number.isFinite(N.quantity)&&N.quantity>0).sort((N,p)=>N.product_id<p.product_id?-1:N.product_id>p.product_id?1:N.variant<p.variant?-1:N.variant>p.variant?1:N.quantity-p.quantity);return JSON.stringify({name:a,phone:t,address:n,items:u,adj:i})},Ms=React.useMemo(()=>{if(Qe)return"";const e=it((f==null?void 0:f.phone)||"");if(!e)return"";const a=Xn(),t=Ts(f),n=Array.isArray(G)?G:[];for(const i of n){if(!i||Qe&&String(i.id)===String(Qe)||it(i.phone||"")!==e)continue;const r=Un(i.created_at);if(!r||r!==a)continue;const u=ri(i);if(u&&u===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${i!=null&&i.id?` (#${i.id})`:""}`}return""},[G,f,b,Qe]),$s=e=>{var da;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),i=it((e==null?void 0:e.phone)||""),r=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),i||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),i&&!Qa(i)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),r||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const l=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(st=>st&&st.product_id);l.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),l.some(st=>{var Wa;const Sa=Number((Wa=st==null?void 0:st.quantity)!=null?Wa:0);return!Number.isFinite(Sa)||Sa<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const p=new Set;let o=!1;for(const st of l){const Sa=String(st.product_id||"").trim(),Wa=String((st==null?void 0:st.variant)||"").trim();if(!Sa)continue;const Xe=`${Sa}||${Wa}`;if(p.has(Xe)){o=!0;break}p.add(Xe)}o&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const h=un(l),x=mn(l),B=x!=null&&x.found?Number((da=x==null?void 0:x.fee)!=null?da:0):0,z=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],De=Xa(z),Ie=Ya(De),mt=De.some(st=>(Number(st==null?void 0:st.amount)||0)!==0&&!String((st==null?void 0:st.note)||"").trim());x!=null&&x.found&&(B>=2e5||h>0&&B>h*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${et(B)}`),mt&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const ze=Math.abs(Ie);return(ze>=5e5||h>0&&ze>h*.5)&&Ie!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${et(Ie)}`),{errors:a,warnings:t,canSubmit:a.length===0}},bi=React.useMemo(()=>$s(f),[f,Rt]),Je=React.useMemo(()=>{var Wa;const e=String((f==null?void 0:f.customer_name)||"").trim(),a=it((f==null?void 0:f.phone)||""),t=String((f==null?void 0:f.address)||"").trim(),n=Array.isArray(f==null?void 0:f.items)?f.items:[],i=new Map;for(const Xe of n){const nn=String((Xe==null?void 0:Xe.product_id)||"").trim(),Dn=String((Xe==null?void 0:Xe.variant)||"").trim();if(!nn)continue;const Rn=`${nn}||${Dn}`;i.set(Rn,(i.get(Rn)||0)+1)}const r=n.map(Xe=>{var Is;const nn=String((Xe==null?void 0:Xe.product_id)||"").trim(),Dn=Number((Is=Xe==null?void 0:Xe.quantity)!=null?Is:0),Rn=nn?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",di=Number.isFinite(Dn)&&Dn>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",mi=String((Xe==null?void 0:Xe.variant)||"").trim(),ui=`${nn}||${mi}`,pi=nn&&(i.get(ui)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Rn,qtyError:di,dupWarn:pi}}),u=n.filter(Xe=>Xe&&Xe.product_id),l=un(u),N=mn(u),p=N!=null&&N.found?Number((Wa=N==null?void 0:N.fee)!=null?Wa:0):0,o=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],h=Xa(o),x=Ya(h),B=h.some(Xe=>(Number(Xe==null?void 0:Xe.amount)||0)!==0&&!String((Xe==null?void 0:Xe.note)||"").trim()),z=Math.abs(x),De=B?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Ie=x!==0&&(z>=5e5||l>0&&z>l*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${et(x)}`:"",mt=N!=null&&N.found&&(p>=2e5||l>0&&p>l*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${et(p)}`:"",ze=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",da=a?Qa(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",st=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Sa=!ze&&!da&&r.every(Xe=>!Xe.productError&&!Xe.qtyError);return{nameError:ze,phoneError:da,addressWarn:st,items:r,shipAbnormalWarn:mt,adjustmentNoteWarn:De,adjustmentAbnormalWarn:Ie,canSubmit:Sa}},[f,Rt]),jn=async e=>{var l,N,p;const a=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",n=$s(f);if(!n.canSubmit){const o=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof $=="function"?$(o,"danger"):alert(o);return}if(!Qe&&Ms){const o=`${Ms}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(o)){(Vt==null?void 0:Vt.count)>0&&g(!0),setTimeout(()=>{var B;const x=document.getElementById("order-phone-input");x&&typeof x.scrollIntoView=="function"&&(x.scrollIntoView({block:"center",behavior:"smooth"}),(B=x.focus)==null||B.call(x))},0);return}}const i=it(f.phone),u=(Array.isArray(f.items)?f.items:[]).map(o=>{var h,x;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((h=o==null?void 0:o.quantity)!=null?h:1),variant:String((o==null?void 0:o.variant)||"").trim()||null,variant_json:(x=o==null?void 0:o.variant_json)!=null?x:null,unit_price:(()=>{const B=o==null?void 0:o.unit_price,z=B===""||B==null?NaN:Number(B);if(Number.isFinite(z))return Math.max(0,Math.trunc(z));const De=ca(o==null?void 0:o.product_id),Ie=o!=null&&o.variant_json&&typeof o.variant_json=="object"?o.variant_json:null;return tn(De,Ie)})()}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0);v(!0);try{const o=Qe,h=Qe?`${API_BASE}/api/orders/${Qe}`:`${API_BASE}/api/orders`,x=u[0],B=Array.isArray(f==null?void 0:f.adjustment_items)?f.adjustment_items:[],z=Xa(B),De=Ya(z),Ie=Fn(z),mt={customer_name:f.customer_name,phone:i,address:f.address,note:(f.note||"").trim(),adjustment_amount:De,adjustment_note:Ie,adjustment_items:z,product_id:x.product_id,quantity:x.quantity,status:f.status,items:u,...Qe?{id:Qe}:{}};if(Qe)await window.KTM.api.putJSON(h,mt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const ze=await window.KTM.api.postJSON(h,mt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");oa.current={id:(p=(N=ze==null?void 0:ze.id)!=null?N:(l=ze==null?void 0:ze.order)==null?void 0:l.id)!=null?p:null,fingerprint:Ts(f),ts:Date.now()}}if(Us(i,f.customer_name,f.address),t==="drawer"){if(Ba(""),ga(null),Se(!1),Kt(!1),g(!1),He([]),za(),o){Ue(!0),gt("");try{const ze=await Hn(o);ze&&typeof ze=="object"&&Pe(ze)}catch(ze){gt((ze==null?void 0:ze.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Ue(!1)}}}else a==="new"&&!Qe?(Ba(""),ga(null),Se(!0)):(Ba(""),ga(null),Se(!1)),za()}catch(o){console.error(o),typeof $=="function"?$(o.message,"danger"):alert(o.message);return}finally{v(!1)}},pn=e=>window.KTM.orders.getOrderTotalMoney(e,ca),gi=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){Y(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),za(),_n()}catch(a){console.error(a),typeof $=="function"?$(a.message,"danger"):alert(a.message)}finally{Y(null)}}},oi=()=>{const e=Ma.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(r){}e.timer=null}const a=Array.isArray(e.events)?e.events.splice(0):[];if(!a.length||typeof $!="function")return;const t=new Map;for(const r of a){const u=String((r==null?void 0:r.orderId)||"").trim();u&&t.set(u,r)}const n=Array.from(t.values());if(!n.length)return;const i=r=>async()=>{try{for(const u of r)!(u!=null&&u.prevStatus)||!(u!=null&&u.orderId)||await Ga({id:u.orderId,status:u.nextStatus},u.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});$(r.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${r.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(u){$("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(n.length===1){const r=n[0],u=`${pa(r.prevStatus)} \u2192 ${pa(r.nextStatus)}`.trim();$(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${u}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:i([r])});return}$(`\u0110\xE3 c\u1EADp nh\u1EADt ${n.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:i(n)})},li=e=>{const a=Ma.current;a&&(Array.isArray(a.events)||(a.events=[]),a.events.push(e),!a.timer&&(a.timer=setTimeout(()=>oi(),320)))};useEffect(()=>()=>{try{const e=Ma.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Ga=async(e,a,t={})=>{var u;const n=await xn(e),i=n==null?void 0:n.id;if(!i||!a)return;const r=Lt(n==null?void 0:n.status);V(i);try{const l=Wn(n),N=(Array.isArray(l)?l:[]).map(h=>{var x,B;return{product_id:(h==null?void 0:h.product_id)||"",quantity:Number((x=h==null?void 0:h.quantity)!=null?x:1),variant:String((h==null?void 0:h.variant)||"").trim()||null,variant_json:(B=h==null?void 0:h.variant_json)!=null?B:null,unit_price:(()=>{var Ie;const z=(Ie=h==null?void 0:h.unit_price)!=null?Ie:h==null?void 0:h.unitPrice,De=Number(z);return Number.isFinite(De)?Math.max(0,Math.trunc(De)):null})()}}).filter(h=>h.product_id&&Number.isFinite(h.quantity)&&h.quantity>0);if(!N.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const p=N[0],o={id:i,customer_name:(n==null?void 0:n.customer_name)||"",phone:it((n==null?void 0:n.phone)||""),address:(n==null?void 0:n.address)||"",note:((n==null?void 0:n.note)||"").trim(),adjustment_amount:Number((u=n==null?void 0:n.adjustment_amount)!=null?u:0)||0,adjustment_note:(n==null?void 0:n.adjustment_note)||"",product_id:p.product_id,quantity:p.quantity,status:a,items:N};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${i}`,o,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),F(h=>Array.isArray(h)?h.map(x=>(x==null?void 0:x.id)===i?{...x,status:a}:x):h),pe(h=>Array.isArray(h)?h.map(x=>(x==null?void 0:x.id)===i?{...x,status:a}:x):h),gn(i,!1),Vs(i),t!=null&&t.silentToast)return;if(t!=null&&t.skipToastBatch){typeof $=="function"&&$("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}li({orderId:i,prevStatus:r,nextStatus:Lt(a)})}catch(l){if(console.error(l),(!navigator.onLine||(l==null?void 0:l.name)==="TypeError"||String((l==null?void 0:l.message)||"").toLowerCase().includes("failed to fetch"))&&!(t!=null&&t.fromSync)){F(p=>Array.isArray(p)?p.map(o=>(o==null?void 0:o.id)===i?{...o,status:a}:o):p),pe(p=>Array.isArray(p)?p.map(o=>(o==null?void 0:o.id)===i?{...o,status:a}:o):p),Hs(i,a,r),typeof $=="function"&&$("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof $=="function"?$(l.message,"danger"):alert(l.message)}finally{V(null)}};useEffect(()=>{const e=a=>{var n;const t=(n=a==null?void 0:a.detail)==null?void 0:n.key;if(t){if(t==="/"){setTimeout(()=>{var i,r;(r=(i=_t.current)==null?void 0:i.focus)==null||r.call(i)},0);return}if(t==="N"||t==="n"){Tn();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&We&&(ae!=null&&ae.id)){const i=Array.isArray(ht)?ht:[],r=i.findIndex(N=>String(N==null?void 0:N.id)===String(ae==null?void 0:ae.id));if(r<0)return;const l=i[r+(t==="j"||t==="J"?-1:1)];l&&cn(l)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[ht,We,ae]);const ci=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:f.customer_name,onChange:e=>xe({...f,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Je.nameError&&React.createElement("div",{className:"form-text text-danger"},Je.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:f.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Je.phoneError&&React.createElement("div",{className:"form-text text-danger"},Je.phoneError),!Je.phoneError&&Vt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Vt.count," \u0111\u01A1n trong th\xE1ng ",Vt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>g(e=>!e)},k?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),k&&Vt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>g(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Vt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Za(e.status)}`},pa(e.status))),React.createElement("div",{className:"text-muted small"},en(e.created_at)," \u2022 ",et(pn(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},an(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Bn(e)}},"M\u1EDF")))),Vt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(_==null?void 0:_.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(_==null?void 0:_.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(_==null?void 0:_.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(_==null?void 0:_.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:f.status,onChange:e=>xe({...f,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:f.address,onChange:e=>xe({...f,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Je.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Je.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:f.note,onChange:e=>xe({...f,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{xe(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},xa(f.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;xe(i=>{const r=xa(i.adjustment_items);return r[a]={...r[a],amount:n},{...i,adjustment_items:r}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;xe(i=>{const r=xa(i.adjustment_items);return r[a]={...r[a],note:n},{...i,adjustment_items:r}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{xe(t=>{const n=xa(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:y||xa(f.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Je.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Je.adjustmentAbnormalWarn),!!Je.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Je.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{xe(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),yt(e=>[...Array.isArray(e)?e:[],""]),Qe&&He(e=>[...Array.isArray(e)?e:[],!0])},disabled:y},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(f.items)?f.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Zt.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Gt(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Ss(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Qt===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:Ot[a]||"",onChange:t=>{const n=t.target.value;yt(i=>{const r=Array.isArray(i)?[...i]:[];return r[a]=n,r})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(n.id),r=Ea(n==null?void 0:n.variants),u={};for(const p of r){const o=String((p==null?void 0:p.name)||"").trim(),h=Array.isArray(p==null?void 0:p.options)?p.options[0]:null,x=String((h==null?void 0:h.label)||"").trim();o&&x&&(u[o]=x)}const l=$n(u),N=tn(n,u);xe(p=>{const o=Array.isArray(p.items)?[...p.items]:[];return o[a]={...o[a]||{quantity:1},product_id:i,variant_json:Object.keys(u).length?u:null,variant:l,unit_price:r.length?N:null},{...p,items:o}}),Gt(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Rt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Je.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=ca(e.product_id),n=Ea(t==null?void 0:t.variants);if(!n.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((r,u)=>{const l=String((r==null?void 0:r.name)||`Bi\u1EBFn th\u1EC3 ${u+1}`).trim(),N=String((i==null?void 0:i[l])||"").trim();return React.createElement("div",{key:l},React.createElement("label",{className:"form-label small text-muted mb-1"},l),React.createElement("select",{className:"form-select",value:N,onChange:p=>{const o=String(p.target.value||"").trim();xe(h=>{const x=Array.isArray(h.items)?[...h.items]:[],B={...x[a]||{}},z=ca(B.product_id),De=Ea(z==null?void 0:z.variants),Ie=B!=null&&B.variant_json&&typeof B.variant_json=="object"?{...B.variant_json}:{};o?Ie[l]=o:delete Ie[l];const mt=$n(Ie),ze=tn(z,Ie);return x[a]={...B,variant_json:Object.keys(Ie).length?Ie:null,variant:mt,unit_price:ze},{...h,items:x}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",l," --"),(Array.isArray(r==null?void 0:r.options)?r.options:[]).map(p=>React.createElement("option",{key:p.label,value:p.label},p.label,Number.isFinite(Number(p==null?void 0:p.price))?` (${et(Number(p.price))})`:Number(p==null?void 0:p.price_delta)?` (${p.price_delta>0?"+":""}${p.price_delta})`:""))))}))})(),Qe&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!$e[a],onChange:t=>{const n=!!t.target.checked;He(i=>{const r=Array.isArray(i)?[...i]:[],u=Array.isArray(f.items)?f.items.length:0;for(;r.length<u;)r.push(!0);return r[a]=n,r})},disabled:y||J}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;xe(i=>{const r=Array.isArray(i.items)?[...i.items]:[];return r[a]={...r[a]||{product_id:""},quantity:n},{...i,items:r}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Je.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{xe(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),yt(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),He(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),Gt(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:y||J||(Array.isArray(f.items)?f.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(f.items)?f.items:[]).filter(l=>l==null?void 0:l.product_id),t=un(a),n=mn(a),i=Kn(f),r=i.amount,u=t+(n.found?n.fee:0)+r;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},et(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},et(n.fee))),!!Je.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Je.shipAbnormalWarn),r!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},et(r))),(f.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(f.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},et(u)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:y||!!M||!!Q}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Pa.all," \u0111\u01A1n"),_e&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>_e?xs(Te):za(),disabled:wt,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>Tn(),disabled:y||!!M},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${ha&&!le&&!_e?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),zt(!1),sa(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Xs)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${ba&&!le&&!_e?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),sa(!1),zt(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ys)),React.createElement("button",{type:"button",className:`orders-chip ${!P&&!le&&!_e?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),Z("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Pa.all)),React.createElement("button",{type:"button",className:`orders-chip ${P==="draft"&&!le&&!_e?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),Z("draft"),T("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Pa.draft)),React.createElement("button",{type:"button",className:`orders-chip ${P==="pending"&&!le&&!_e?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),Z("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Pa.pending)),React.createElement("button",{type:"button",className:`orders-chip ${P==="processing"&&!le&&!_e?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),Z("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Pa.processing)),React.createElement("button",{type:"button",className:`orders-chip ${P==="done"&&!le&&!_e?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),Z("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Pa.done)),React.createElement("button",{type:"button",className:`orders-chip ${P==="paid"&&!le&&!_e?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),Z("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Pa.paid)),React.createElement("button",{type:"button",className:`orders-chip ${P==="canceled"&&!le&&!_e?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),Z("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Pa.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Ia("thisMonth"),disabled:_e},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ia("overduePending"),disabled:_e},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",wa," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Ia("draftExpiring"),disabled:_e},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y"),(P||le||!b&&!_e)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ia("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:_t,type:"text",className:"form-control",value:Te,onChange:e=>ie(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(Te||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ie(""),disabled:wt},React.createElement("i",{className:"fas fa-times"})),wt&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:b,onChange:e=>T(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:le||_e})),React.createElement("div",{className:"text-muted small ms-auto"},_e?"Search b\u1ECF qua filter":le?"\u0110ang xem \u0111\u01A1n ch\u1EADm":P?`L\u1ECDc: ${pa(P)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${aa?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if(_e){const e=String(Te||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${ht.length} k\u1EBFt qu\u1EA3`}return le?`\u0110\u01A1n ch\u1EADm \u2022 ${ht.length} \u0111\u01A1n`:ha?`\u01AFu ti\xEAn \u2022 ${ht.length} \u0111\u01A1n`:ba?`H\xF4m nay \u2022 ${ht.length} \u0111\u01A1n`:P?`L\u1ECDc: ${pa(P)} \u2022 ${ht.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${ht.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{ie(""),sa(!1),zt(!1),Ia("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},_e?`${ht.length} k\u1EBFt qu\u1EA3`:P?`${An.length}/${X.length} \u0111\u01A1n`:`${X.length}${de?"+":""} \u0111\u01A1n`)),_e&&at&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},at),Cn.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Cn.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",wa," ng\xE0y.",fe&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ne(!0),Z("pending")}},"Xem ngay")),vs.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,vs.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 h\u1EE7y (c\xF2n \u2264 ",Ln," ng\xE0y).",Ge&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{ne(!1),Z("draft"),T(""),za()}},"Xem ngay")),(_e?wt:ve)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,a)=>React.createElement("div",{key:a,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,a)=>React.createElement("tr",{key:a},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(_e?ht.length===0:X.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},_e?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!_e&&An.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Ns.map(e=>{var a;return React.createElement("div",{key:e.id,className:`orders-mobile-swipe-shell mb-2 ${(Be==null?void 0:Be.id)===String(e.id)?`swipe-preview swipe-${(Be==null?void 0:Be.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>{if(Pt.current){Pt.current=!1;return}cn(e)},onPointerDown:t=>{if(H||pt||ct||t.button!=null&&t.button!==0)return;const n=String(e.id);Pt.current=!1,we.current={active:!0,id:n,startX:t.clientX,startY:t.clientY,dx:0,dy:0,lock:null,pointerId:t.pointerId,captured:!1},Ce(i=>(i==null?void 0:i.id)===n?i:{id:n,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}try{xt.current&&clearTimeout(xt.current)}catch(i){}jt.current=n,xt.current=setTimeout(async()=>{var r,u,l,N;const i=jt.current;if(i)try{if((u=(r=dt.current)==null?void 0:r.has)!=null&&u.call(r,i))return;const p=await Hn(i);p&&typeof p=="object"&&((N=(l=dt.current)==null?void 0:l.set)==null||N.call(l,i,p))}catch(p){}},150)},onPointerMove:t=>{const n=we.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id))return;const i=t.clientX-n.startX,r=t.clientY-n.startY;if(n.dx=i,n.dy=r,Math.abs(i)>14||Math.abs(r)>14){try{xt.current&&clearTimeout(xt.current)}catch(x){}xt.current=null,jt.current=null}if(!n.lock){const x=Math.abs(i),B=Math.abs(r);if((x>10||B>10)&&(n.lock=x>B*1.2?"x":"y",n.lock==="x"&&!n.captured))try{t.currentTarget.setPointerCapture(t.pointerId),n.captured=!0}catch(z){}}if(n.lock!=="x"){try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(x){}Math.abs(r)>24&&Ce(x=>(x==null?void 0:x.id)===n.id?{id:n.id,dir:null}:x);return}const u=!!Ua(e==null?void 0:e.status,"right"),l=!!Ua(e==null?void 0:e.status,"left"),N=(x,B,z)=>Math.max(B,Math.min(z,x)),p=N(i,-140,140),o=p>0&&!u||p<0&&!l?p*.35:p,h=N(Math.abs(o)/88,0,1);try{t.currentTarget.classList.add("swiping"),t.currentTarget.style.setProperty("--swipe-x",`${o}px`),t.currentTarget.style.setProperty("--swipe-p",String(h)),t.currentTarget.style.setProperty("--swipe-l",o>0&&u?String(h):"0"),t.currentTarget.style.setProperty("--swipe-r",o<0&&l?String(h):"0")}catch(x){}Math.abs(o)>12&&(Pt.current=!0),i>72&&u?Ce({id:n.id,dir:"right"}):i<-72&&l?Ce({id:n.id,dir:"left"}):Ce({id:n.id,dir:null})},onPointerCancel:t=>{try{xt.current&&clearTimeout(xt.current)}catch(i){}xt.current=null,jt.current=null;const n=we.current;try{n!=null&&n.captured&&(n==null?void 0:n.pointerId)!=null&&t.currentTarget.releasePointerCapture(n.pointerId)}catch(i){}we.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1},Ce({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}},onPointerUp:t=>{try{xt.current&&clearTimeout(xt.current)}catch(o){}xt.current=null,jt.current=null;const n=we.current;if(!(n!=null&&n.active)||String(n.id)!==String(e.id)){Ce({id:null,dir:null});return}try{n!=null&&n.captured&&(n==null?void 0:n.pointerId)!=null&&t.currentTarget.releasePointerCapture(n.pointerId)}catch(o){}we.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1};const i=Number(n.dx)||0,r=Math.abs(i),u=n.lock==="x",l=Lt(e==null?void 0:e.status);Ce({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(o){}if(u&&r>12&&(Pt.current=!0),!u||r<88)return;t.preventDefault(),t.stopPropagation();const N=i>0?Ua(e==null?void 0:e.status,"right"):Ua(e==null?void 0:e.status,"left"),p=Lt(N);!p||p===l||Ga(e,p)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),cn(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"orders-mobile-swipe-bg","aria-hidden":"true"},React.createElement("div",{className:"orders-mobile-swipe-bg-left"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Ua(e==null?void 0:e.status,"right"),n=ms(t),i=(n==null?void 0:n.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${n.icon||"fa-circle"}`}),i):null})())),React.createElement("div",{className:"orders-mobile-swipe-bg-right"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Ua(e==null?void 0:e.status,"left"),n=ms(t),i=(n==null?void 0:n.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${n.icon||"fa-circle"}`}),i):null})()))),React.createElement("div",{className:`card orders-mobile-card ${Bt!=null&&Bt[String(e.id)]?"order-recent-updated":""}`},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:t=>qs(t,e.phone),onPointerMove:vn,onPointerUp:vn,onPointerCancel:vn,onPointerLeave:vn,onClick:t=>{if(t.stopPropagation(),At.current){At.current=!1;return}ls(e.phone)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),ls(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=rs(e);if(!t)return null;const n=fa.has(String(e.id)),i=t.length>84||os(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${n?"":"order-text-collapsed"}`},t),i&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:r=>{r.stopPropagation(),ns(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const t=os(e);if(!t)return null;const n=fa.has(String(e.id)),i=rs(e).length,r=i>84||t.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${n?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t),r&&i<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:u=>{u.stopPropagation(),ns(e.id)}},n?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${ft.has(String(e.id))?"active":""}`,onClick:t=>{t.stopPropagation(),Ls(e.id)},title:ft.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":ft.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:ft.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(Ut!=null&&Ut[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${Za(e.status)} order-status-badge-btn`,onPointerDown:t=>{t.stopPropagation(),me.current=!1;try{oe.current&&clearTimeout(oe.current)}catch(n){}oe.current=setTimeout(()=>{me.current=!0,as(e,t.currentTarget)},420)},onPointerUp:t=>{t.stopPropagation();try{oe.current&&clearTimeout(oe.current)}catch(n){}oe.current=null},onPointerCancel:t=>{t.stopPropagation();try{oe.current&&clearTimeout(oe.current)}catch(n){}oe.current=null},onClick:t=>{if(t.stopPropagation(),me.current){me.current=!1;return}ct&&String(A==null?void 0:A.id)===String(e.id)?qa():as(e,t.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},pa(e.status)),yn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${wa} ng\xE0y`},"\u26A0 Ch\u1EADm ",on(e),"d"),wn(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Ha} ng\xE0y`},"\u23F3 C\xF2n ",Nn(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=In(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,i)=>React.createElement("div",{key:i,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${et(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},an(e))})()),(dn(e)!==0||Ja(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},et(dn(e))),Ja(e)?React.createElement("span",{className:"text-muted"}," ","(",Ja(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},et(pn(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",en(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),On(e)},disabled:y||!!M||Q===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),ts(e)},disabled:y||!!M||Q===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c")))))}),React.createElement("div",{ref:Yt,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(ht)&&Ns.length<ht.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),ct&&A&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>qa()},React.createElement("div",{className:`orders-status-popover ${(j==null?void 0:j.placement)||""}`,style:{left:j.left,top:j.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},A.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>qa(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},sn.map(e=>{const a=Lt(A.status)===Lt(e.value),t=y||!!M||Q===A.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Ga(A,e.value),qa())},disabled:t},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{ts(A),qa()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),H&&ot&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Va()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},ot.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},ot.phone||""),React.createElement("span",{className:`badge ${Za(ot.status)}`},pa(ot.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Va(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{On(ot),Va()},disabled:y||!!M||Q===ot.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(ot.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(ot.phone||"").trim()}`,onClick:()=>Va()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{cn(ot),Va()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},sn.map(e=>{const a=Lt(ot.status)===Lt(e.value),t=y||!!M||Q===ot.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${a?"active":""}`,onClick:()=>{a||(Ga(ot,e.value),Va())},disabled:t},e.label)})))),pt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>bn()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>bn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Ia("thisMonth"),disabled:_e},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ia("overduePending"),disabled:_e},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Ia("draftExpiring"),disabled:_e},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!P&&!le?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),Z("")}},"T\u1EA5t c\u1EA3"),sn.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${P===e.value&&!le?"active":""}`,onClick:()=>{_e&&ie(""),ne(!1),Z(e.value),e.value==="draft"&&T("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:b,onChange:e=>T(e.target.value),disabled:le||_e}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:le,onChange:e=>{_e&&ie("");const a=!!e.target.checked;ne(a),a&&(T(""),Z("pending"))},disabled:_e}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",wa," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Ia("all"),disabled:_e},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>bn()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${Aa?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){I.current=!1;try{$t.current&&clearTimeout($t.current)}catch(a){}$t.current=setTimeout(()=>{I.current=!0,ss(Te)},460)}},onPointerUp:()=>{try{$t.current&&clearTimeout($t.current)}catch(e){}$t.current=null},onPointerCancel:()=>{try{$t.current&&clearTimeout($t.current)}catch(e){}$t.current=null},onClick:()=>{if(I.current){I.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,a;return(a=(e=_t.current)==null?void 0:e.focus)==null?void 0:a.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>Tn(),disabled:y||!!M,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Rs(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),St&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{rn(ia),ua()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const a=e.touches&&e.touches[0];a&&(se.current={active:!0,startY:a.clientY,startX:a.clientX,fired:!1})},onTouchMove:e=>{const a=se.current;if(!(a!=null&&a.active)||a.fired)return;const t=e.touches&&e.touches[0];if(!t)return;const n=t.clientY-a.startY,i=t.clientX-a.startX;Math.abs(i)>24||n>90&&(a.fired=!0,rn(ia),ua())},onTouchEnd:()=>{se.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{rn(ia),ua()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:ma,type:"text",className:"form-control",value:ia,onChange:e=>{const a=e.target.value;Jt(a),ie(a)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(rn(ia),ua())}}),!!String(ia||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Jt(""),ie("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(Da)&&Da.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},Da.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{Jt(e),ie(e),rn(e),ua()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${ha?"active":""}`,onClick:()=>{ie(""),Jt(""),ne(!1),zt(!1),sa(e=>!e),ua()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${ba?"active":""}`,onClick:()=>{ie(""),Jt(""),ne(!1),sa(!1),zt(e=>!e),ua()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${le?"active":""}`,onClick:()=>{ie(""),Jt(""),ne(e=>!e),le||(T(""),Z("pending")),ua()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!P&&!le&&!ha&&!ba?"active":""}`,onClick:()=>{ie(""),Jt(""),ne(!1),sa(!1),zt(!1),Z(""),ua()}},"T\u1EA5t c\u1EA3"),sn.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${P===e.value&&!le?"active":""}`,onClick:()=>{ie(""),Jt(""),ne(!1),sa(!1),zt(!1),Z(e.value),e.value==="draft"&&T(""),ua()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,ht.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>cn(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=In(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",et(t.unitPrice))))):an(e)})()),React.createElement("td",null,_s(e)),React.createElement("td",{className:"fw-semibold"},et(pn(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${Za(e.status)}`},pa(e.status)),yn(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${wa} ng\xE0y`},"\u26A0 Ch\u1EADm ",on(e),"d"),wn(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Ha} ng\xE0y`},"\u23F3 C\xF2n ",Nn(e),"d"))),React.createElement("td",null,en(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),On(e)},disabled:y||!!M||Q===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation();const t=String(a.target.value||"").trim();a.target.value="",t&&Ga(e,t)},disabled:y||!!M||Q===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!_e&&de&&!le&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Zs,disabled:ve||te},te?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:We,title:(()=>{const e=ae,a=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${pa(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${a} ${t}`.trim()})(),subtitle:(()=>{const e=ae,a=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?en(e.created_at):"";return[a||t||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:ei,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},Wt?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Kt(!1),ga(null),Ba(""),g(!1),He([])},disabled:y||J},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!Qe&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:ks,disabled:y||J,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},J?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>jn({mode:"close",origin:"drawer"}),disabled:y||J||!Je.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ae&&On(ae),disabled:!ae||bt||y||!!M},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>ae&&Bn(ae),disabled:!ae||bt||y||!!M},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const a=String(e.target.value||"").trim();e.target.value="",a&&ae&&Ga(ae,a)},disabled:!ae||bt||y||!!M||Q===(ae==null?void 0:ae.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},Wt?React.createElement("form",{onSubmit:e=>{e.preventDefault(),jn({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),ci())):bt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):Tt?React.createElement("div",{className:"alert alert-danger",role:"alert"},Tt):ae?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${Za(ae.status)}`},pa(ae.status)),yn(ae)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${wa} ng\xE0y`},"\u26A0 Ch\u1EADm ",on(ae),"d"),wn(ae)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Ha} ng\xE0y`},"\u23F3 C\xF2n ",Nn(ae),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},et(pn(ae))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},_s(ae)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},en(ae.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},ae.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},ae.phone||"\u2014"),!!String(ae.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(ae.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},ae.address||"\u2014")),((ae==null?void 0:ae.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(ae.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=In(ae);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((a,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),a.name),a.variant?React.createElement("div",{className:"text-muted small"},a.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${et(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},an(ae)||"\u2014")})(),(dn(ae)!==0||Ja(ae))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},et(dn(ae))),Ja(ae)?React.createElement("span",{className:"text-muted"}," ","(",Ja(ae),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),ke&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),Qe?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:zn})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),jn({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Nt},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:f.customer_name,onChange:e=>xe({...f,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Je.nameError&&React.createElement("div",{className:"form-text text-danger"},Je.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:f.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Je.phoneError&&React.createElement("div",{className:"form-text text-danger"},Je.phoneError),!Je.phoneError&&Vt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Vt.count," \u0111\u01A1n trong th\xE1ng ",Vt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>g(e=>!e)},k?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),k&&Vt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>g(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Vt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${Za(e.status)}`},pa(e.status))),React.createElement("div",{className:"text-muted small"},en(e.created_at)," \u2022 ",et(pn(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},an(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Bn(e)}},"M\u1EDF")))),Vt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(_==null?void 0:_.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(_==null?void 0:_.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(_==null?void 0:_.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(_==null?void 0:_.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:f.status,onChange:e=>xe({...f,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:f.address,onChange:e=>xe({...f,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Je.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Je.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:f.note,onChange:e=>xe({...f,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{xe(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},xa(f.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;xe(i=>{const r=xa(i.adjustment_items);return r[a]={...r[a],amount:n},{...i,adjustment_items:r}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;xe(i=>{const r=xa(i.adjustment_items);return r[a]={...r[a],note:n},{...i,adjustment_items:r}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{xe(t=>{const n=xa(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:y||xa(f.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Je.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Je.adjustmentAbnormalWarn),!!Je.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Je.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{xe(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),yt(e=>[...Array.isArray(e)?e:[],""]),Qe&&He(e=>[...Array.isArray(e)?e:[],!0])},disabled:y},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(f.items)?f.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Zt.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Gt(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Ss(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Qt===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:Ot[a]||"",onChange:t=>{const n=t.target.value;yt(i=>{const r=Array.isArray(i)?[...i]:[];return r[a]=n,r})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(n.id),r=Ea(n==null?void 0:n.variants),u={};for(const p of r){const o=String((p==null?void 0:p.name)||"").trim(),h=Array.isArray(p==null?void 0:p.options)?p.options[0]:null,x=String((h==null?void 0:h.label)||"").trim();o&&x&&(u[o]=x)}const l=$n(u),N=tn(n,u);xe(p=>{const o=Array.isArray(p.items)?[...p.items]:[];return o[a]={...o[a]||{quantity:1},product_id:i,variant_json:Object.keys(u).length?u:null,variant:l,unit_price:r.length?N:null},{...p,items:o}}),Gt(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Rt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Je.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=ca(e.product_id),n=Ea(t==null?void 0:t.variants);if(!n.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((r,u)=>{const l=String((r==null?void 0:r.name)||`Bi\u1EBFn th\u1EC3 ${u+1}`).trim(),N=String((i==null?void 0:i[l])||"").trim();return React.createElement("div",{key:l},React.createElement("label",{className:"form-label small text-muted mb-1"},l),React.createElement("select",{className:"form-select",value:N,onChange:p=>{const o=String(p.target.value||"").trim();xe(h=>{const x=Array.isArray(h.items)?[...h.items]:[],B={...x[a]||{}},z=ca(B.product_id),De=Ea(z==null?void 0:z.variants),Ie=B!=null&&B.variant_json&&typeof B.variant_json=="object"?{...B.variant_json}:{};o?Ie[l]=o:delete Ie[l];const mt=$n(Ie),ze=tn(z,Ie);return x[a]={...B,variant_json:Object.keys(Ie).length?Ie:null,variant:mt,unit_price:ze},{...h,items:x}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",l," --"),(Array.isArray(r==null?void 0:r.options)?r.options:[]).map(p=>React.createElement("option",{key:p.label,value:p.label},p.label,Number.isFinite(Number(p==null?void 0:p.price))?` (${et(Number(p.price))})`:Number(p==null?void 0:p.price_delta)?` (${p.price_delta>0?"+":""}${p.price_delta})`:""))))}))})(),Qe&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!$e[a],onChange:t=>{const n=!!t.target.checked;He(i=>{const r=Array.isArray(i)?[...i]:[],u=Array.isArray(f.items)?f.items.length:0;for(;r.length<u;)r.push(!0);return r[a]=n,r})},disabled:y||J}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;xe(i=>{const r=Array.isArray(i.items)?[...i.items]:[];return r[a]={...r[a]||{product_id:""},quantity:n},{...i,items:r}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Je.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{xe(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),yt(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),He(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),Gt(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:y||J||(Array.isArray(f.items)?f.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(f.items)?f.items:[]).filter(l=>l==null?void 0:l.product_id),t=un(a),n=mn(a),i=Kn(f),r=i.amount,u=t+(n.found?n.fee:0)+r;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},et(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},et(n.fee))),!!Je.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Je.shipAbnormalWarn),r!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},et(r))),(f.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(f.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},et(u)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:zn,disabled:y||J,style:{borderRadius:10}},"H\u1EE7y"),!!Qe&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:ks,disabled:y||J,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},J?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!Qe&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>jn({mode:"new",origin:"modal"}),disabled:y||!Je.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:y||J||!Je.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

