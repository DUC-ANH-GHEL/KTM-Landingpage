const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:N,error:c}){const[L,j]=useState(""),[k,o]=useState(""),[h,y]=useState(!1),[E,m]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),c&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),c),React.createElement("form",{onSubmit:async U=>{U.preventDefault(),y(!0),await N(L,k),y(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:L,onChange:U=>j(U.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:E?"text":"password",className:"form-control",value:k,onChange:U=>o(U.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>m(!E)},React.createElement("i",{className:`fas fa-eye${E?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:h},h?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:N,type:c,onClose:L}){return useEffect(()=>{const j=setTimeout(L,3e3);return()=>clearTimeout(j)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${c} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},N),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:L})))}function Loading({show:N}){return N?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:N,onMenuChange:c,onLogout:L,currentUser:j}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(o=>React.createElement("a",{key:o.id,href:"#",className:`nav-link ${N===o.id?"active":""} ${o.disabled?"opacity-50":""} ${o.highlight?"text-warning":""}`,onClick:h=>{h.preventDefault(),o.disabled||c(o.id)}},React.createElement("i",{className:`fas ${o.icon}`})," ",o.label,o.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),o.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),L&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:L,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:N,onSelect:c,onCreate:L,onEdit:j,onDelete:k,loading:o,currentFolder:h,onBack:y,breadcrumb:E}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},h&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:y},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),h?h.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:L},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),E&&E.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:m=>{m.preventDefault(),y("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),E.map((m,q)=>React.createElement("li",{key:m.id,className:`breadcrumb-item ${q===E.length-1?"active":""}`},q===E.length-1?m.title:React.createElement("a",{href:"#",onClick:U=>{U.preventDefault(),y(m)},className:"text-warning"},m.title))))),o?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):N.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},h?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},N.map(m=>React.createElement("div",{key:m.uuid||m.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>c(m)},m.cover?React.createElement("img",{src:m.cover,className:"album-cover",alt:m.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},m.title),React.createElement("small",{className:"text-muted"},m.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),m.subfolderCount),m.subfolderCount>0&&m.count>0&&" \u2022 ",m.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),m.count),m.subfolderCount===0&&m.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:q=>{q.stopPropagation(),j(m)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:q=>{q.stopPropagation(),k(m)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:N,album:c,onClose:L,onSave:j,parentId:k}){const[o,h]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[y,E]=useState(!1),[m,q]=useState(!1),U=useRef(null);useEffect(()=>{h(c?{slug:c.id||"",title:c.title||"",description:c.description||"",cover_url:c.cover||"",parent_id:c.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:k||null})},[c,N,k]);const S=async _=>{_.preventDefault(),E(!0),await j(o),E(!1)},A=_=>_.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),z=async _=>{const P=_.type==="image/heic"||_.type==="image/heif"||/\.heic$/i.test(_.name);if(_.size<=2097152&&!P)return _;try{const J=await createImageBitmap(_),Z=document.createElement("canvas");let p=J.width,O=J.height;const X=800;return(p>X||O>X)&&(p>O?(O=Math.round(O/p*X),p=X):(p=Math.round(p/O*X),O=X)),Z.width=p,Z.height=O,Z.getContext("2d").drawImage(J,0,0,p,O),J.close(),new Promise((se,H)=>{Z.toBlob(ee=>{ee?se(new File([ee],_.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):H(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(J){throw console.error("Compress cover error:",J),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},V=async _=>{var J;const C=_.target.files[0];if(!C)return;if(!(C.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(C.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}q(!0);try{const Z=await z(C),p=new FormData;p.append("file",Z),p.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),p.append("folder","ktm-albums/covers");const O=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:p}),X=await O.json();if(!O.ok)throw console.error("Cloudinary error:",X),new Error(((J=X.error)==null?void 0:J.message)||"Upload failed");h(f=>({...f,cover_url:X.secure_url}))}catch(Z){console.error("Cover upload error:",Z),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Z.message)}q(!1),_.target.value=""};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:S},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:o.title,onChange:_=>h({...o,title:_.target.value,slug:o.slug||A(_.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:o.slug,onChange:_=>h({...o,slug:_.target.value}),required:!0,disabled:!!c}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:o.description,onChange:_=>h({...o,description:_.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},o.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:o.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>h(_=>({..._,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:U,type:"file",accept:"image/*",className:"d-none",onChange:V}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var _;return(_=U.current)==null?void 0:_.click()},disabled:m},m?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:o.cover_url,onChange:_=>h({...o,cover_url:_.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:y||m},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:N,allAlbums:c,currentAlbumId:L,targetAlbum:j,onSelect:k,level:o=0}){const[h,y]=useState(!0),E=N.uuid||N.id,m=E===L,q=j===E,U=c.filter(A=>A.parentId===E),S=U.length>0;return React.createElement("div",{style:{marginLeft:o*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${q?"bg-info text-white":m?"bg-light text-muted":"hover-bg"}`,style:{cursor:m?"not-allowed":"pointer",opacity:m?.5:1,transition:"background 0.2s"},onClick:()=>!m&&k(E)},S&&React.createElement("i",{className:`fas fa-chevron-${h?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:A=>{A.stopPropagation(),y(!h)}}),!S&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${q?"-open":""} me-2 ${q?"":"text-warning"}`}),React.createElement("span",{className:"small"},N.title),m&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),N.count>0&&!m&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},N.count)),h&&S&&React.createElement("div",null,U.map(A=>React.createElement(FolderTreeItem,{key:A.uuid||A.id,folder:A,allAlbums:c,currentAlbumId:L,targetAlbum:j,onSelect:k,level:o+1}))))}function AlbumDetail({album:N,onBack:c,onRefresh:L,showToast:j,onNavigateToFolder:k,onEditSubfolder:o,parentAlbum:h}){const[y,E]=useState([]),[m,q]=useState([]),[U,S]=useState(!0),[A,z]=useState(!1),[V,_]=useState(""),[C,P]=useState([]),[J,Z]=useState([]),[p,O]=useState({}),[X,f]=useState(null),[se,H]=useState(!1),[ee,xe]=useState(""),[ce,W]=useState(!1),ue=useRef(null),Y=useRef(null),[de,pe]=useState(!1),[ae,ve]=useState([]),[Ce,fe]=useState([]),[ke,De]=useState(""),[t,n]=useState(!1),x=async(a,i=2)=>{const d=i*1024*1024,D=a.type==="image/heic"||a.type==="image/heif"||/\.heic$/i.test(a.name);if(a.size<=d&&!D)return a;try{const R=await createImageBitmap(a),le=document.createElement("canvas");let te=R.width,$=R.height;const re=1200;return(te>re||$>re)&&(te>$?($=Math.round($/te*re),te=re):(te=Math.round(te/$*re),$=re)),le.width=te,le.height=$,le.getContext("2d").drawImage(R,0,0,te,$),R.close(),new Promise((b,g)=>{le.toBlob(T=>{T?b(new File([T],a.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):g(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(R){throw console.error("Compress error:",R),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{B(),me()},[N.id,N.uuid]);const B=async()=>{S(!0);try{const i=await(await fetch(`${API_BASE}/api/albums/${N.uuid||N.id}`)).json();E(i.images||[]);const D=await(await fetch(`${API_BASE}/api/albums?parent_id=${N.uuid||N.id}`)).json();q(Array.isArray(D)?D:[])}catch(a){console.error(a),j("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}S(!1)},me=async()=>{try{const i=await(await fetch(`${API_BASE}/api/albums`)).json();fe(Array.isArray(i)?i:[])}catch(a){console.error("Error loading albums:",a)}},Ae=a=>{ve(i=>i.includes(a)?i.filter(d=>d!==a):[...i,a])},Ne=async()=>{if(!ke||ae.length===0){j("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}n(!0);let a=0;for(const i of ae)try{(await fetch(`${API_BASE}/api/images/${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({album_id:ke})})).ok&&a++}catch(d){console.error("Move error:",d)}n(!1),pe(!1),ve([]),De(""),a>0?(j("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),B(),L()):j("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Se,je]=useState(!1),M=async()=>{if(ae.length===0||!confirm(`X\xF3a ${ae.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;je(!0);let a=0;for(const i of ae)try{(await fetch(`${API_BASE}/api/images/${i}`,{method:"DELETE"})).ok&&a++}catch(d){console.error("Delete error:",d)}je(!1),ve([]),a>0?(j(`\u0110\xE3 x\xF3a ${a} \u1EA3nh!`,"success"),B(),L()):j("X\xF3a th\u1EA5t b\u1EA1i","danger")},he=()=>{ae.length===y.length?ve([]):ve(y.map(a=>a.id))},Re=async()=>{if(ee.trim()){W(!0);try{const a=ee.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(!(await fetch(`${API_BASE}/api/albums`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:a+"-"+Date.now(),title:ee,parent_id:N.uuid||N.id})})).ok)throw new Error("L\u1ED7i t\u1EA1o folder");j("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),xe(""),H(!1),B(),L()}catch(a){j(a.message,"danger")}W(!1)}},ne=async a=>{if(confirm(`X\xF3a folder "${a.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await fetch(`${API_BASE}/api/albums/${a.uuid||a.id}`,{method:"DELETE"}),j("\u0110\xE3 x\xF3a folder","success"),B(),L()}catch(i){j("L\u1ED7i x\xF3a folder","danger")}},u=a=>{const i=Array.from(a).filter(d=>d.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(d.name));P(d=>[...d,...i]),i.forEach(d=>{const D=new FileReader;D.onload=R=>{Z(le=>[...le,{file:d,preview:R.target.result}])},D.readAsDataURL(d)})},be=a=>{P(i=>i.filter((d,D)=>D!==a)),Z(i=>i.filter((d,D)=>D!==a))},ge=async a=>{var D;const i=new FormData;i.append("file",a),i.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),i.append("folder",`ktm-albums/${N.id}`);const d=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:i});if(!d.ok){const R=await d.json();throw console.error("Cloudinary error:",R),new Error(((D=R.error)==null?void 0:D.message)||"Upload failed")}return await d.json()},ye=async()=>{if(C.length===0)return;z(!0);let a=0;for(let i=0;i<C.length;i++)try{_(`\u0110ang x\u1EED l\xFD ${i+1}/${C.length}...`);const d=await x(C[i],2);_(`\u0110ang upload ${i+1}/${C.length}...`);const D=await ge(d);await fetch(`${API_BASE}/api/albums/${N.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:D.secure_url,caption:p[i]||C[i].name.replace(/\.[^/.]+$/,""),sort_order:y.length+i})}),a++}catch(d){console.error("Upload error:",d)}z(!1),_(""),P([]),Z([]),O({}),a>0?(j(`\u0110\xE3 upload ${a} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),B(),L()):j("Upload th\u1EA5t b\u1EA1i","danger")},$e=async(a,i)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await fetch(`${API_BASE}/api/images/${a}`,{method:"DELETE"}),j("\u0110\xE3 x\xF3a \u1EA3nh","success"),B(),L()}catch(d){j("L\u1ED7i x\xF3a \u1EA3nh","danger")}},e=a=>{var i;a.preventDefault(),(i=Y.current)==null||i.classList.add("dragover")},l=()=>{var a;(a=Y.current)==null||a.classList.remove("dragover")},r=a=>{var i;a.preventDefault(),(i=Y.current)==null||i.classList.remove("dragover"),u(a.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:c},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},N.title),React.createElement("small",{className:"text-muted"},m.length>0&&React.createElement("span",null,m.length," folder \u2022 "),y.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>H(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),se&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:ee,onChange:a=>xe(a.target.value),onKeyPress:a=>a.key==="Enter"&&Re(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Re,disabled:ce||!ee.trim()},ce?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{H(!1),xe("")}},"H\u1EE7y")))),m.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},m.map(a=>React.createElement("div",{key:a.uuid||a.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>k&&k(a)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},a.title),React.createElement("small",{className:"text-muted"},a.subfolderCount>0&&React.createElement("span",null,a.subfolderCount," folder"),a.subfolderCount>0&&a.count>0&&" \u2022 ",a.count>0&&React.createElement("span",null,a.count," \u1EA3nh"),a.subfolderCount===0&&a.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:i=>{i.stopPropagation(),o&&o(a)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:i=>{i.stopPropagation(),ne(a)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:Y,className:"upload-zone",onClick:()=>{var a;return(a=ue.current)==null?void 0:a.click()},onDragOver:e,onDragLeave:l,onDrop:r},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:ue,type:"file",multiple:!0,accept:"image/*",onChange:a=>u(a.target.files)})),J.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},J.map((a,i)=>React.createElement("div",{key:i,className:"upload-preview-item"},React.createElement("img",{src:a.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>be(i)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:ye,disabled:A},A?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),V||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",C.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",y.length,")"),y.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:he},ae.length===y.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ae.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ae.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>pe(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:M,disabled:Se},Se?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ve([])},React.createElement("i",{className:"fas fa-times"})))),U?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):y.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},y.map((a,i)=>React.createElement("div",{key:i,className:`image-item ${ae.includes(a.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Ae(a.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ae.includes(a.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ae.includes(a.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ae.includes(a.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:a.src,alt:a.caption,style:{opacity:ae.includes(a.id)?.7:1,border:ae.includes(a.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:d=>{d.stopPropagation(),$e(a.id,i)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),a.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},a.caption)))))),de&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ae.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>pe(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},Ce.filter(a=>!a.parentId).map(a=>React.createElement(FolderTreeItem,{key:a.uuid||a.id,folder:a,allAlbums:Ce,currentAlbumId:N.uuid||N.id,targetAlbum:ke,onSelect:De})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>pe(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:Ne,disabled:!ke||t},t?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),X&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>f(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>f(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:X.src,alt:X.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:a=>a.stopPropagation()}),X.caption&&React.createElement("div",{className:"text-white text-center mt-2"},X.caption)))))}function SearchCenter({showToast:N,onNavigate:c}){const[L,j]=useState(""),[k,o]=useState([]),[h,y]=useState([]),[E,m]=useState([]),[q,U]=useState("all"),[S,A]=useState(null),[z,V]=useState("list"),[_,C]=useState(!0),[P,J]=useState([]),[Z,p]=useState([]),O=useRef(null),[X,f]=useState(!0),[se,H]=useState(!1),ee=useRef(null),[xe,ce]=useState(!1),[W,ue]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[Y,de]=useState(""),[pe,ae]=useState(!1),ve=useRef(null),Ce=useRef(null),[fe,ke]=useState(null),[De,t]=useState(!1),[n,x]=useState(null),[B,me]=useState(!1),[Ae,Ne]=useState(!1),[Se,je]=useState(null),[M,he]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),Re=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],ne=s=>{s._type==="product"&&(x(s),he({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||""}),t(!0))},u=async()=>{if(n)try{if(!(await fetch(`${API_BASE}/api/products?id=${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)})).ok)throw new Error("L\u1ED7i c\u1EADp nh\u1EADt");N("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),t(!1),x(null),e()}catch(s){N(s.message,"danger")}},be=async s=>{const b=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${b} "${s.name}"?`))try{let g="";if(s._type==="product"?g=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?g=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(g=`${API_BASE}/api/videos/${s.id}`),!(await fetch(g,{method:"DELETE"})).ok)throw new Error("L\u1ED7i x\xF3a");N(`\u0110\xE3 x\xF3a ${b}`,"success"),e()}catch(g){N(g.message,"danger")}},ge=async s=>{try{const b=Se?`${API_BASE}/api/products?id=${Se.id}`:`${API_BASE}/api/products`;if(!(await fetch(b,{method:Se?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m");N(Se?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Ne(!1),je(null),e()}catch(b){N(b.message,"danger")}},ye="ktm_admin_data_cache_v1",$e=1e3*60*10,e=async()=>{let s=null,b=!1;try{const g=localStorage.getItem(ye);if(g){const T=JSON.parse(g);T&&T.timestamp&&Date.now()-T.timestamp<$e&&Array.isArray(T.data)?(s=T.data,console.log("[CACHE] Using cache, items:",s.length),y(s),o(s),C(!1),b=!0):console.log("[CACHE] Cache expired or invalid")}else console.log("[CACHE] No cache found")}catch(g){console.error("[CACHE] Error parsing cache:",g)}b||C(!0);try{const[g,T,F]=await Promise.all([fetch(`${API_BASE}/api/products`),fetch(`${API_BASE}/api/albums`),fetch(`${API_BASE}/api/video-folders?withVideos=true`)]),[I,v,w]=await Promise.all([g.ok?g.json():[],T.ok?T.json():[],F.ok?F.json():[]]),K=Array.isArray(I)?I.map(Pe=>({...Pe,_type:"product",_source:"database"})):[];J(v);let ie=[];if(Array.isArray(v)&&v.length>0){const Pe=v.map(_e=>fetch(`${API_BASE}/api/albums/${_e.id}`)),Ve=await Promise.all(Pe);(await Promise.all(Ve.map(_e=>_e.ok?_e.json():{}))).forEach((_e,He)=>{const Ue=v[He];_e.images&&_e.images.length>0&&_e.images.forEach(qe=>{ie.push({id:qe.id,name:qe.caption||"\u1EA2nh t\u1EEB "+Ue.title,image:qe.src,folder:Ue.title,_type:"album",_source:"database"})})})}p(w);let oe=[];Array.isArray(w)&&w.forEach(Pe=>{Pe.videos&&Pe.videos.forEach(Ve=>{oe.push({id:Ve.id,name:Ve.title,folder:Pe.name,image:Ve.thumb,youtubeId:Ve.youtubeId,url:Ve.url,_type:"video",_source:"database"})})});const Q=[...K,...ie,...oe];if(!s||JSON.stringify(Q)!==JSON.stringify(s)){y(Q),o(Q);try{localStorage.setItem(ye,JSON.stringify({data:Q,timestamp:Date.now()}))}catch(Pe){}}}catch(g){console.error("Song song fetch error:",g)}C(!1)};useEffect(()=>{e(),setTimeout(()=>{var s;return(s=O.current)==null?void 0:s.focus()},100)},[]);const l=async(s,b)=>{if(!(!X||b.length===0)){H(!0);try{const g=b.map(F=>({id:F.id,name:F.name,price:F.price,category:F.category,note:F.note,folder:F.folder,_type:F._type})),T=await fetch(`${API_BASE}/api/ai-search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:s,products:g})});if(T.ok){const F=await T.json();if(F.matchedIds&&F.matchedIds.length>0){const I=b.filter(v=>F.matchedIds.includes(v.id));I.length>0&&o(I)}else F.matchedIds&&F.matchedIds.length===0&&o([])}}catch(g){console.error("AI Search error:",g)}H(!1)}},r=s=>{if(j(s),ee.current&&clearTimeout(ee.current),!s.trim()){a(q);return}const g=s.toLowerCase().split(/\s+/).filter(I=>I.length>0),T=h.filter(I=>{const v=Object.entries(I).filter(([w])=>!w.startsWith("_")).map(([,w])=>String(w||"").toLowerCase()).join(" ");return g.some(w=>v.includes(w))});let F=T;q!=="all"&&(F=T.filter(I=>(I.category||I._type)===q)),o(F),X&&s.length>=3&&(ee.current=setTimeout(()=>{l(s,F)},500))},a=s=>{U(s);let b=h;if(s!=="all"&&(b=h.filter(g=>(g.category||g._type)===s)),L.trim()){const T=L.toLowerCase().split(/\s+/).filter(F=>F.length>0);b=b.filter(F=>{const I=Object.entries(F).filter(([v])=>!v.startsWith("_")).map(([,v])=>String(v||"").toLowerCase()).join(" ");return T.every(v=>I.includes(v))})}o(b)},i=(s,b)=>{navigator.clipboard.writeText(s).then(()=>{A(b),N("\u0110\xE3 copy!","success"),setTimeout(()=>A(null),1500)})},d=async(s,b)=>{try{const T=await(await fetch(s)).blob();await navigator.clipboard.write([new ClipboardItem({[T.type]:T})]),A(b+"-img"),N("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>A(null),1500)}catch(g){i(s,b+"-img")}},D=s=>{let b=s.toLowerCase();const g=[],T=h.filter(v=>v._type==="product");if(b.includes("ty")||b.includes("xy lanh")){if(b.includes("gi\u1EEFa")||b.includes("giua")){const v=T.find(w=>{var K;return(K=w.name)==null?void 0:K.toLowerCase().includes("xy lanh gi\u1EEFa")});v&&!g.find(w=>w.id===v.id)&&g.push(v)}if(b.includes("nghi\xEAng")||b.includes("nghieng")){const v=T.find(w=>{var K;return(K=w.name)==null?void 0:K.toLowerCase().includes("xy lanh nghi\xEAng")});v&&!g.find(w=>w.id===v.id)&&g.push(v)}if(b.includes("\u1EE7i")||b.includes("ui")){const v=T.find(w=>{var K;return(K=w.name)==null?void 0:K.toLowerCase().includes("xy lanh \u1EE7i")});v&&!g.find(w=>w.id===v.id)&&g.push(v)}}const F=b.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(F){const v=F[1],w=F[2],K=T.find(ie=>{var Q;const oe=((Q=ie.name)==null?void 0:Q.toLowerCase())||"";return oe.includes("combo")&&oe.includes(`${v} tay`)&&(oe.includes(`${w} xy`)||oe.includes(`${w} xylanh`))});if(K&&!g.find(ie=>ie.id===K.id))g.push(K);else{const ie=T.find(oe=>{var we;const Q=((we=oe.name)==null?void 0:we.toLowerCase())||"";return Q.includes("combo")&&Q.includes(`${v} tay`)});ie&&!g.find(oe=>oe.id===ie.id)&&g.push(ie)}}if(b.includes("combo")&&!F){const v=b.match(/combo.*?(\d+)\s*tay/);if(v){const w=v[1];T.filter(ie=>{var Q;const oe=((Q=ie.name)==null?void 0:Q.toLowerCase())||"";return oe.includes("combo")&&oe.includes(`${w} tay`)}).forEach(ie=>{g.find(oe=>oe.id===ie.id)||g.push(ie)})}}const I=b.match(/van\s*(\d+)\s*tay/);if(I&&!b.includes("ty")&&!b.includes("combo")){const v=I[1],w=T.find(K=>{var oe;const ie=((oe=K.name)==null?void 0:oe.toLowerCase())||"";return ie.includes(`van ${v} tay`)&&!ie.includes("combo")});w&&!g.find(K=>K.id===w.id)&&g.push(w)}return g.slice(0,4)},R=async s=>{if(!s.trim())return;const b={role:"user",content:s,attachments:[]};ue(T=>[...T,b]),de(""),ae(!0);const g=D(s);setTimeout(()=>{var T;return(T=ve.current)==null?void 0:T.scrollIntoView({behavior:"smooth"})},100);try{const F=h.filter(Q=>Q._type==="product").map(Q=>{let we=`- ${Q.name}`;return Q.code&&(we+=` (M\xE3: ${Q.code})`),Q.price&&(we+=` - Gi\xE1: ${Q.price.replace(/[đ\s]/g,"")}\u0111`),Q.category&&(we+=` [${Q.category}]`),Q.note&&(we+=` (${Q.note})`),we}).join(`
`),v=W.slice(-6).map(Q=>`${Q.role==="user"?"Kh\xE1ch":"AI"}: ${Q.content}`).join(`
`),w=v?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${v}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${F}`:F,K=await fetch(`${API_BASE}/api/ai-chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,context:w,audience:"admin"})}),ie=await K.json();if(!K.ok)throw new Error(ie.error||"API error");const oe=ie.response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";ue(Q=>[...Q,{role:"assistant",content:oe,attachments:g}])}catch(T){console.error("AI Error:",T);const F=s.toLowerCase(),I=h.filter(w=>{const K=Object.values(w).join(" ").toLowerCase();return F.split(" ").some(ie=>K.includes(ie))});let v="";I.length>0?(v=`T\xECm th\u1EA5y ${I.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,I.slice(0,5).forEach(w=>{v+=`\u2022 ${w.name}`,w.price&&(v+=` - ${w.price.replace(/[đ\s]/g,"")}\u0111`),w.note&&(v+=` (${w.note})`),v+=`
`}),I.length>5&&(v+=`
...v\xE0 ${I.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):v='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',ue(w=>[...w,{role:"assistant",content:v,attachments:I.slice(0,4)}])}ae(!1),setTimeout(()=>{var T,F;(T=ve.current)==null||T.scrollIntoView({behavior:"smooth"}),(F=Ce.current)==null||F.focus()},100)};function le({show:s,product:b,categories:g,onClose:T,onSave:F}){const[I,v]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[w,K]=useState(!1),[ie,oe]=useState(!1),Q=useRef(null),we=G=>{const Le=G.replace(/[^\d]/g,"");return Le?Le.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""};useEffect(()=>{if(b)if(v({name:b.name||"",code:b.code||"",price:b.price||"",image:b.image||"",category:b.category||"",note:b.note||"",sort_order:b.sort_order||0}),b.price){const G=b.price.replace(/[^\d]/g,"");_e(G),v(Le=>({...Le,price:we(G)}))}else _e("");else v({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),_e("")},[b,s]);const[Pe,Ve]=React.useState(""),[ze,_e]=React.useState(""),He=G=>{const Fe=G.target.value.replace(/[^\d]/g,"");if(!Fe){v({...I,price:""}),_e("");return}if(Fe===ze&&Fe.length>0){const Te=Fe.slice(0,-1);Te?(v({...I,price:we(Te)}),_e(Te)):(v({...I,price:""}),_e(""));return}_e(Fe),v({...I,price:we(Fe)})},Ue=async(G,Le=2)=>{const Fe=Le*1024*1024;if(G.size<=Fe)return G;try{const Te=await createImageBitmap(G),Me=document.createElement("canvas");let Ie=Te.width,Ee=Te.height;const Oe=1200;return(Ie>Oe||Ee>Oe)&&(Ie>Ee?(Ee=Math.round(Ee/Ie*Oe),Ie=Oe):(Ie=Math.round(Ie/Ee*Oe),Ee=Oe)),Me.width=Ie,Me.height=Ee,Me.getContext("2d").drawImage(Te,0,0,Ie,Ee),Te.close(),new Promise((Je,Xe)=>{Me.toBlob(Ke=>{Ke?Je(new File([Ke],G.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Xe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Te){throw console.error("Compress error:",Te),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},qe=async G=>{var Te;const Le=G.target.files[0];if(!Le)return;if(!(Le.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(Le.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}oe(!0);try{const Me=await Ue(Le),Ie=new FormData;Ie.append("file",Me),Ie.append("upload_preset",CLOUDINARY_UPLOAD_PRESET),Ie.append("folder","ktm-products");const Ee=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:Ie}),Oe=await Ee.json();if(!Ee.ok)throw console.error("Cloudinary error:",Oe),new Error(((Te=Oe.error)==null?void 0:Te.message)||"Upload failed");v(Be=>({...Be,image:Oe.secure_url}))}catch(Me){console.error("Upload error:",Me),alert("L\u1ED7i upload \u1EA3nh: "+Me.message)}oe(!1),G.target.value=""},Qe=async G=>{G.preventDefault(),K(!0),await F(I),K(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),b?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:Qe},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:I.name,onChange:G=>v({...I,name:G.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:I.code,onChange:G=>v({...I,code:G.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:I.price,onChange:He,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:I.category,onChange:G=>v({...I,category:G.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),g.map(G=>React.createElement("option",{key:G,value:G},G)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:I.note,onChange:G=>v({...I,note:G.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},I.image?React.createElement(React.Fragment,null,React.createElement("img",{src:I.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>v({...I,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var G;return(G=Q.current)==null?void 0:G.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:Q,type:"file",accept:"image/*",className:"d-none",onChange:qe}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var G;return(G=Q.current)==null?void 0:G.click()},disabled:ie,style:{borderRadius:"10px"}},ie?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:I.image,onChange:G=>v({...I,image:G.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:T,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:w,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},w?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const te=(s,b)=>{const g=s._type==="product",T=s._type==="album",F=s._type==="video",I=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale"));return z==="grid"?React.createElement("div",{key:s.id||b,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>ke({url:s.image,name:s.name,price:s.price,note:s.note,item:s})},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${F?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${g?"product":T?"album":"video"}`},g?"SP":T?"\u1EA2nh":"Video"),I&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:S===s.id+"-img"?"copied":"",onClick:()=>d(s.image,s.id)},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:S===s.id+"-price"?"copied":"",onClick:()=>i(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||b,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${g?"product":T?"album":"video"}`},g?"S\u1EA3n ph\u1EA9m":T?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>ke({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${F?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),I&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),F&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},g&&React.createElement("button",{onClick:()=>c&&c("orders","create",{productId:s.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),React.createElement("button",{className:S===s.id+"-img"?"copied":"",onClick:()=>d(s.image,s.id)},React.createElement("i",{className:"fas fa-image"})," \u1EA2nh"),s.price&&React.createElement("button",{className:S===s.id+"-price"?"copied":"",onClick:()=>i(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:S===s.id+"-name"?"copied":"",onClick:()=>i(s.name,s.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),F&&s.youtubeId&&React.createElement("button",{className:S===s.id+"-yt"?"copied":"",onClick:()=>i(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),g&&React.createElement("button",{className:"action-edit",onClick:()=>ne(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>be(s)},React.createElement("i",{className:"fas fa-trash"}))))},[$,re]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,k.length)," k\u1EBFt qu\u1EA3",X&&L.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),q!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},q==="product"?"S\u1EA3n ph\u1EA9m":q==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${z==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>V("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${z==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>V("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},_?React.createElement("div",null,[...Array(8)].map((s,b)=>React.createElement("div",{key:b,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):k.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',L,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{j(""),r("")}},"Xem t\u1EA5t c\u1EA3")):z==="grid"?React.createElement("div",{className:"product-grid-mobile"},k.map((s,b)=>te(s,b))):React.createElement("div",null,k.map((s,b)=>te(s,b)))),$&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>re(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${q==="all"?"active":""}`,onClick:()=>{a("all"),re(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${q==="product"?"active":""}`,onClick:()=>{a("product"),re(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${q==="album"?"active":""}`,onClick:()=>{a("album"),re(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${q==="video"?"active":""}`,onClick:()=>{a("video"),re(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:X,onChange:s=>f(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:O,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:L,onChange:s=>r(s.target.value)}),React.createElement("button",{className:`filter-btn ${$||q!=="all"?"active":""}`,onClick:()=>re(!$)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:B?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>ce(!0),onTouchStart:()=>ce(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),xe&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>ce(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},W.map((s,b)=>React.createElement("div",{key:b,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:S===`chat-${b}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:S===`chat-${b}`?"#fff":"#666"},onClick:()=>{navigator.clipboard.writeText(s.content),A(`chat-${b}`),setTimeout(()=>A(null),1500)}},React.createElement("i",{className:`fas ${S===`chat-${b}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((g,T)=>React.createElement("div",{key:T,style:{width:70},className:"text-center"},g.image&&React.createElement("img",{src:g.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>ke({url:g.image,name:g.name,price:g.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},g.name),g.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},g.price.replace(/[đ\s]/g,""),"\u0111"))))))),pe&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:ve})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>R(s),disabled:pe,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),R(Y)},className:"chat-input-wrap"},React.createElement("input",{ref:Ce,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:Y,onChange:s=>de(s.target.value),disabled:pe}),React.createElement("button",{type:"submit",className:"send-btn",disabled:pe||!Y.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),fe&&React.createElement("div",{className:"preview-modal",onClick:()=>ke(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>ke(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:fe.url,alt:fe.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},fe.name),fe.price&&React.createElement("div",{className:"price"},fe.price.replace(/[đ\s]/g,""),"\u0111"),fe.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},fe.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:S==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:S==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>d(fe.url,"preview")},React.createElement("i",{className:`fas ${S==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),fe.price&&React.createElement("button",{className:S==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>i(fe.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${S==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(le,{show:Ae,product:Se,categories:E,onClose:()=>{Ne(!1),je(null)},onSave:ge}),React.createElement("div",{className:`fab-container mobile-only ${B?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{me(!1),Ne(!0),je(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{me(!1),c&&c("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${B?"open":""}`,onClick:()=>me(!B)},React.createElement("i",{className:"fas fa-plus"}))),De&&n&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>t(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:M.name,onChange:s=>he({...M,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:M.code,onChange:s=>he({...M,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:M.price,onChange:s=>he({...M,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:M.category,onChange:s=>he({...M,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),Re.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:M.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>he({...M,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>t(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:u},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:N,showToast:c}){const[L,j]=useState([]),[k,o]=useState([]),[h,y]=useState(!0),[E,m]=useState(null),[q,U]=useState(!1),[S,A]=useState(null),[z,V]=useState(!1),[_,C]=useState(null),[P,J]=useState(null),[Z,p]=useState([]);useEffect(()=>{O()},[]);const O=async(t=null)=>{y(!0);try{const n=t?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${t}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,B=await(await fetch(n)).json();j(Array.isArray(B)?B:[])}catch(n){console.error(n),c("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}y(!1)},X=async t=>{try{const x=await(await fetch(`${API_BASE}/api/videos?folderId=${t}`)).json();o(Array.isArray(x)?x:[])}catch(n){console.error(n)}},f=async t=>{if(t===0)return;const n=[...L];[n[t-1],n[t]]=[n[t],n[t-1]],j(n),await H(n)},se=async t=>{if(t===L.length-1)return;const n=[...L];[n[t],n[t+1]]=[n[t+1],n[t]],j(n),await H(n)},H=async t=>{try{await Promise.all(t.map((n,x)=>fetch(`${API_BASE}/api/video-folders/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:x})}))),c("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(n){c("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),O(P==null?void 0:P.id)}},ee=async t=>{if(t===0)return;const n=[...k];[n[t-1],n[t]]=[n[t],n[t-1]],o(n),await ce(n)},xe=async t=>{if(t===k.length-1)return;const n=[...k];[n[t],n[t+1]]=[n[t+1],n[t]],o(n),await ce(n)},ce=async t=>{try{await Promise.all(t.map((n,x)=>fetch(`${API_BASE}/api/videos/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sort_order:x})}))),c("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(n){c("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),X(E.id)}},W=()=>{A(null),U(!0)},ue=t=>{A(t),U(!0)},Y=async t=>{try{!S&&P&&(t.parent_id=P.id);const n=S?`${API_BASE}/api/video-folders/${S.id}`:`${API_BASE}/api/video-folders`;if(!(await fetch(n,{method:S?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("L\u1ED7i l\u01B0u folder");c(S?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),U(!1),O(P==null?void 0:P.id)}catch(n){c(n.message,"danger")}},de=async t=>{const n=t.subfolderCount>0?`X\xF3a folder "${t.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${t.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(n))try{await fetch(`${API_BASE}/api/video-folders/${t.id}`,{method:"DELETE"}),c("\u0110\xE3 x\xF3a folder","success"),m(null),O(P==null?void 0:P.id)}catch(x){c("L\u1ED7i x\xF3a folder","danger")}},pe=t=>{t.subfolderCount>0?(p(n=>[...n,t]),J(t),O(t.id)):(m(t),o(t.videos||[]))},ae=t=>{if(t==="root")p([]),J(null),O(null);else if(t){const n=Z.findIndex(x=>x.id===t.id);n>=0&&(p(Z.slice(0,n+1)),J(t),O(t.id))}else{const n=[...Z];n.pop();const x=n[n.length-1]||null;p(n),J(x),O(x==null?void 0:x.id)}},ve=()=>{C(null),V(!0)},Ce=t=>{C(t),V(!0)},fe=async t=>{try{t.folder_id=E==null?void 0:E.id;const n=_?`${API_BASE}/api/videos/${_.id}`:`${API_BASE}/api/videos`,x=await fetch(n,{method:_?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!x.ok){const B=await x.json();throw new Error(B.error||"L\u1ED7i l\u01B0u video")}c(_?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),V(!1),O(),E&&X(E.id)}catch(n){c(n.message,"danger")}},ke=async t=>{if(confirm(`X\xF3a video "${t.title}"?`))try{await fetch(`${API_BASE}/api/videos/${t.id}`,{method:"DELETE"}),c("\u0110\xE3 x\xF3a video","success"),O(),E&&X(E.id)}catch(n){c("L\u1ED7i x\xF3a video","danger")}},De=t=>{const n=`https://www.youtube.com/watch?v=${t.youtubeId}`;navigator.clipboard.writeText(n).then(()=>{c("\u0110\xE3 copy link!","success")}).catch(()=>{c("Kh\xF4ng th\u1EC3 copy link","danger")})};return E?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>m(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${E.slug==="shorts"?"text-danger":"text-warning"}`}),E.name)),React.createElement("button",{className:"btn btn-warning",onClick:ve},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),k.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},k.map((t,n)=>React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>ee(n),disabled:n===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},n+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>xe(n),disabled:n===k.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:t.thumb,className:"card-img-top",alt:t.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${t.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:t.title},t.title),React.createElement("small",{className:"text-muted"},t.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>De(t),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Ce(t),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>ke(t),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:z,video:_,onClose:()=>V(!1),onSave:fe})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},P&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ae()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),P?P.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:W},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Z.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:t=>{t.preventDefault(),ae("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Z.map((t,n)=>React.createElement("li",{key:t.id,className:`breadcrumb-item ${n===Z.length-1?"active":""}`},n===Z.length-1?t.name:React.createElement("a",{href:"#",onClick:x=>{x.preventDefault(),ae(t)},className:"text-warning"},t.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),h?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):L.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},P?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:W},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",P?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},L.map((t,n)=>{var x,B,me,Ae;return React.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Ne=>{Ne.stopPropagation(),f(n)},disabled:n===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},n+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Ne=>{Ne.stopPropagation(),se(n)},disabled:n===L.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>pe(t),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${t.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},t.name),React.createElement("p",{className:"text-muted mb-0"},t.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),t.subfolderCount," folder"),t.subfolderCount>0&&(t.videoCount>0||((x=t.videos)==null?void 0:x.length)>0)&&" \u2022 ",(t.videoCount>0||((B=t.videos)==null?void 0:B.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),t.videoCount||((me=t.videos)==null?void 0:me.length)||0," videos"),t.subfolderCount===0&&!t.videoCount&&!((Ae=t.videos)!=null&&Ae.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Ne=>{Ne.stopPropagation(),ue(t)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Ne=>{Ne.stopPropagation(),de(t)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:q,folder:S,onClose:()=>U(!1),onSave:Y}))}function VideoFolderModal({show:N,folder:c,onClose:L,onSave:j}){const[k,o]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[h,y]=useState(!1),[E,m]=useState(!1);useEffect(()=>{o(c?{name:c.name||"",description:c.description||"",sortOrder:c.sortOrder||0,coverImage:c.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[c,N]);const q=async S=>{const A=S.target.files[0];if(!A)return;m(!0);const z=new FormData;z.append("file",A),z.append("upload_preset","ktm_unsigned");try{const _=await(await fetch("https://api.cloudinary.com/v1_1/diwxfpt92/image/upload",{method:"POST",body:z})).json();_.secure_url&&o(C=>({...C,coverImage:_.secure_url})),localStorage.removeItem(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(V){console.error("Cloudinary upload error:",V),alert("L\u1ED7i upload \u1EA3nh: "+(V.message||V))}finally{m(!1)}},U=async S=>{S.preventDefault(),y(!0),await j(k),y(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:U},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:k.name,onChange:S=>o({...k,name:S.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:k.description,onChange:S=>o({...k,description:S.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:k.sortOrder,onChange:S=>o({...k,sortOrder:parseInt(S.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},k.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:k.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>o({...k,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:q,disabled:E}),E&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:k.coverImage,onChange:S=>o({...k,coverImage:S.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:h},h?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:N}){const[c,L]=useState([]),[j,k]=useState(!0),[o,h]=useState(!1),[y,E]=useState(null),[m,q]=useState(""),[U,S]=useState(""),A=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{z()},[]);const z=async()=>{k(!0);try{const O=await(await fetch(`${API_BASE}/api/products`)).json();L(Array.isArray(O)?O:[])}catch(p){console.error(p),N("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}k(!1)},V=()=>{E(null),h(!0)},_=p=>{E(p),h(!0)},C=async p=>{if(!(!p||!p.includes("cloudinary.com")))try{await fetch(`${API_BASE}/api/products?action=delete-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:p})}),localStorage.removeItem(CACHE_KEY),N(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),z()}catch(O){N("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},P=async p=>{try{const O=y?`${API_BASE}/api/products?id=${y.id}`:`${API_BASE}/api/products`;if(!(await fetch(O,{method:y?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})).ok)throw new Error("L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m");N(y?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),h(!1),z()}catch(O){N(O.message,"danger")}},J=async p=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${p.name}"?`))try{if(!(await fetch(`${API_BASE}/api/products?id=${p.id}`,{method:"DELETE"})).ok)throw new Error("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m");N("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),z()}catch(O){N(O.message,"danger")}},Z=c.filter(p=>{const O=!m||p.name.toLowerCase().includes(m.toLowerCase())||p.code&&p.code.toLowerCase().includes(m.toLowerCase()),X=!U||p.category===U;return O&&X});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:V},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:m,onChange:p=>q(p.target.value)})),React.createElement("span",{className:"product-count"},Z.length)),React.createElement("select",{className:"form-select",value:U,onChange:p=>S(p.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),A.map(p=>React.createElement("option",{key:p,value:p},p)))),j?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):Z.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:V},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},Z.map(p=>React.createElement("div",{key:p.id,className:"product-item d-flex align-items-center gap-3"},p.image?React.createElement("img",{src:p.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},p.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},p.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},p.category),p.code&&React.createElement("span",{className:"product-badge bg-secondary"},p.code)),React.createElement("div",{className:"product-price"},p.price?p.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),p.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},p.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>_(p),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>J(p),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:o,product:y,categories:A,onClose:()=>h(!1),onSave:P}))}function ProductModal({show:N,product:c,categories:L,onClose:j,onSave:k}){const[o,h]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[y,E]=useState(!1),[m,q]=useState(!1);useEffect(()=>{h(c?{name:c.name||"",code:c.code||"",price:c.price||"",image:c.image||"",category:c.category||"",note:c.note||"",sort_order:c.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[c,N]);const[U,S]=React.useState(""),A=f=>{const se=f.replace(/[^\d]/g,"");return se?se.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""},[z,V]=React.useState(""),_=f=>{const H=f.target.value.replace(/[^\d]/g,"");if(!H){h({...o,price:""}),V("");return}if(H===z&&H.length>0){const ee=H.slice(0,-1);ee?(h({...o,price:A(ee)}),V(ee)):(h({...o,price:""}),V(""));return}V(H),h({...o,price:A(H)})},[C,P]=React.useState("");React.useEffect(()=>{c!=null&&c.image&&P(c.image)},[c]);const J=async f=>{if(!(!f||!f.includes("cloudinary.com")))try{await fetch(`${API_BASE}/api/products?action=delete-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:f})})}catch(se){console.error("Delete cloudinary image error:",se)}},Z=async(f,se=2,H)=>{const ee=se*1024*1024,xe=f.type==="image/heic"||f.type==="image/heif"||/\.heic$/i.test(f.name);if(f.size<=ee&&!xe)return f;H==null||H("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const ce=await createImageBitmap(f);H==null||H("\u0110ang n\xE9n \u1EA3nh...");const W=document.createElement("canvas");let ue=ce.width,Y=ce.height;const de=1200;return(ue>de||Y>de)&&(ue>Y?(Y=Math.round(Y/ue*de),ue=de):(ue=Math.round(ue/Y*de),Y=de)),W.width=ue,W.height=Y,W.getContext("2d").drawImage(ce,0,0,ue,Y),ce.close(),new Promise((ae,ve)=>{W.toBlob(Ce=>{Ce?(H==null||H("Ho\xE0n t\u1EA5t!"),ae(new File([Ce],f.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):ve(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ce){throw console.error("createImageBitmap error:",ce),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},p=async f=>{var ee,xe;const se=(ee=f.target.files)==null?void 0:ee[0];if(!se)return;if(!(se.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(se.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}q(!0),S("\u0110ang chu\u1EA9n b\u1ECB...");try{const ce=(se.size/1024/1024).toFixed(1);S(`File ${ce}MB - \u0110ang n\xE9n...`);const W=await Z(se,2,ae=>{S(ae)}),ue=(W.size/1024/1024).toFixed(1);S(`\u0110\xE3 n\xE9n: ${ue}MB - \u0110ang upload...`);const Y=new FormData;Y.append("file",W),Y.append("upload_preset","ktm_unsigned");const pe=await(await fetch("https://api.cloudinary.com/v1_1/diwxfpt92/image/upload",{method:"POST",body:Y})).json();pe.secure_url?(o.image&&o.image!==C&&J(o.image),h(ae=>({...ae,image:pe.secure_url})),S("")):(console.error("Cloudinary error:",pe),alert("Upload th\u1EA5t b\u1EA1i: "+(((xe=pe.error)==null?void 0:xe.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),S(""))}catch(ce){console.error("Upload error:",ce),alert("L\u1ED7i: "+ce.message),S("")}q(!1),f.target.value=""},O=()=>{o.image&&(o.image!==C&&J(o.image),h(f=>({...f,image:""})))},X=async f=>{f.preventDefault(),E(!0),C&&o.image&&C!==o.image&&await J(C),C&&!o.image&&await J(C),await k(o),E(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${c?"fa-edit":"fa-plus-circle"} me-2`}),c?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:X},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},o.image?React.createElement(React.Fragment,null,React.createElement("img",{src:o.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:O,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${m?"fa-spinner fa-spin":"fa-camera"} me-1`}),m?U||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:p,disabled:m,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),m&&U&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},U))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:o.name,onChange:f=>h({...o,name:f.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:o.code,onChange:f=>h({...o,code:f.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:o.price,onChange:_,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:o.category,onChange:f=>h({...o,category:f.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),L.map(f=>React.createElement("option",{key:f,value:f},f)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:o.note,onChange:f=>h({...o,note:f.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:o.image,onChange:f=>h({...o,image:f.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:j,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:y,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:N,video:c,onClose:L,onSave:j}){const[k,o]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[h,y]=useState(!1),[E,m]=useState("");useEffect(()=>{c?(o({title:c.title||"",youtube_url:`https://www.youtube.com/watch?v=${c.youtubeId}`,thumbnail_url:c.thumb||"",sort_order:c.sortOrder||0}),m(c.thumb)):(o({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),m(""))},[c,N]);const q=A=>{const z=A.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return z?z[1]:null},U=A=>{o({...k,youtube_url:A});const z=q(A);z&&m(`https://img.youtube.com/vi/${z}/hqdefault.jpg`)},S=async A=>{A.preventDefault(),y(!0),await j(k),y(!1)};return N?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:S},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:k.youtube_url,onChange:A=>U(A.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),E&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:E,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:k.title,onChange:A=>o({...k,title:A.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:k.sort_order,onChange:A=>o({...k,sort_order:parseInt(A.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:k.thumbnail_url,onChange:A=>o({...k,thumbnail_url:A.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:h},h?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[N,c]=useState(!1),[L,j]=useState(""),[k,o]=useState(null),[h,y]=useState("search"),[E,m]=useState(null),[q,U]=useState(""),[S,A]=useState([]),[z,V]=useState(null),[_,C]=useState(!1),[P,J]=useState(null),[Z,p]=useState(!0),[O,X]=useState([]),[f,se]=useState(null),[H,ee]=useState([]);useEffect(()=>{const t=localStorage.getItem("ktm_admin_session");if(t)try{const n=JSON.parse(t);n.expiry>Date.now()?(c(!0),o(n.user)):localStorage.removeItem("ktm_admin_session")}catch(n){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{N&&Y()},[N]);const xe=async(t,n)=>{j("");try{const x=await fetch(`${API_BASE}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})}),B=await x.json();if(!x.ok)throw new Error(B.error||"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i");const me={user:B.user,token:B.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(me)),o(B.user),c(!0)}catch(x){j(x.message)}},ce=()=>{localStorage.removeItem("ktm_admin_session"),c(!1),o(null),A([]),V(null)},W=(t,n="success")=>{const x=Date.now();X(B=>[...B,{id:x,message:t,type:n}])},ue=t=>{X(n=>n.filter(x=>x.id!==t))},Y=async(t=null)=>{p(!0);try{const n=t?`${API_BASE}/api/albums?parent_id=${t}`:`${API_BASE}/api/albums?parent_id=root`,B=await(await fetch(n)).json();A(Array.isArray(B)?B:[])}catch(n){console.error(n),W("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}p(!1)},de=()=>{J(null),C(!0)},pe=t=>{J(t),C(!0)},ae=async t=>{try{const n=P&&P.uuid;!n&&f&&(t.parent_id=f.uuid);const x=n?`${API_BASE}/api/albums/${P.uuid||P.id}`:`${API_BASE}/api/albums`,B=await fetch(x,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!B.ok){const me=await B.json();throw new Error(me.error||(n?"L\u1ED7i c\u1EADp nh\u1EADt":"L\u1ED7i t\u1EA1o"))}W(n?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),C(!1),Y(f==null?void 0:f.uuid)}catch(n){W(n.message,"danger")}},ve=t=>{V(t)},Ce=t=>{if(t==="root")ee([]),se(null),Y(null);else if(t){const n=H.findIndex(x=>x.uuid===t.uuid);n>=0&&(ee(H.slice(0,n+1)),se(t),Y(t.uuid))}else{const n=[...H];n.pop();const x=n[n.length-1]||null;ee(n),se(x),Y(x==null?void 0:x.uuid)}},fe=async t=>{const n=`X\xF3a folder "${t.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(n))try{await fetch(`${API_BASE}/api/albums/${t.uuid||t.id}`,{method:"DELETE"}),W("\u0110\xE3 x\xF3a","success"),Y(f==null?void 0:f.uuid)}catch(x){W("L\u1ED7i x\xF3a album","danger")}};if(!N)return React.createElement(LoginPage,{onLogin:xe,error:L});const ke=()=>{const t=new Date,n=t.getFullYear(),x=String(t.getMonth()+1).padStart(2,"0");return`${n}-${x}`};function De(){const[t,n]=useState(ke()),[x,B]=useState(!0),[me,Ae]=useState([]),Ne=u=>{if(!u)return 0;const be=String(u).replace(/[^0-9]/g,"");return be?Number(be):0},Se=u=>{if(!u)return null;const be=String(u),ge=be.toLowerCase();if(ge.includes("freeship")||ge.includes("free ship")||ge.includes("mi\u1EC5n ph\xED ship")||ge.includes("mien phi ship")||ge.includes("mi\u1EC5n ph\xED v\u1EADn chuy\u1EC3n")||ge.includes("mien phi van chuyen"))return 0;const ye=be.match(/(?:ship|vận\s*chuyển|van\s*chuyen|\bvc\b)\s*[:=\-]?\s*([0-9][0-9\.,\s]*)(?:\s*(k|nghìn|nghin|tr|triệu|trieu|m))?/i);if(!ye)return null;const $e=String(ye[1]||"").replace(/[^0-9]/g,"");if(!$e)return null;let e=Number($e);const l=String(ye[2]||"").toLowerCase();return l==="k"||l.startsWith("ngh")?e*=1e3:(l==="tr"||l.startsWith("tri")||l==="m")&&(e*=1e6),Number.isFinite(e)?e:null},je=u=>{const be=Array.isArray(u)?u:[];let ge=!1,ye=0;for(const $e of be){const e=Se($e==null?void 0:$e.product_note);e!=null&&(ge=!0,e>ye&&(ye=e))}return{found:ge,fee:ye}},M=u=>{try{return Number(u||0).toLocaleString("vi-VN")}catch(be){return String(u||0)}},he=u=>`${M(u)}\u0111`,Re=async()=>{B(!0);try{const be=await(await fetch(`${API_BASE}/api/orders?month=${encodeURIComponent(t)}`)).json();Ae(Array.isArray(be)?be:[])}catch(u){console.error("Load stats error:",u),Ae([])}finally{B(!1)}};useEffect(()=>{Re()},[t]);const ne=React.useMemo(()=>{const u={pending:0,processing:0,done:0,other:0};let be=0,ge=0,ye=0;const $e=$=>$.customer_id||$.phone||"unknown",e=$=>Array.isArray($==null?void 0:$.items)&&$.items.length?$.items:$!=null&&$.product_id?[{product_id:$.product_id,quantity:$.quantity,product_price:$.product_price,product_name:$.product_name,product_code:$.product_code,product_note:$.product_note}]:[],l=new Map,r=new Map,a=new Map;for(const $ of me){const re=e($);let s=0,b=0;for(const w of re){const K=Number((w==null?void 0:w.quantity)||0)||0,ie=Ne(w==null?void 0:w.product_price),oe=K*ie;s+=K,b+=oe;const Q=(w==null?void 0:w.product_id)||"unknown",we=l.get(Q)||{product_id:Q,product_name:(w==null?void 0:w.product_name)||"\u2014",product_code:(w==null?void 0:w.product_code)||"",orders:0,quantity:0,revenue:0};we.orders+=1,we.quantity+=K,we.revenue+=oe,l.set(Q,we)}const g=je(re),T=b+(g.found?g.fee:0);be+=s,ge+=T,$.status==="pending"?u.pending+=1:$.status==="processing"?u.processing+=1:$.status==="done"?(u.done+=1,ye+=T):u.other+=1;const F=$e($),I=r.get(F)||{key:F,customer_name:$.customer_name||"",phone:$.phone||"",orders:0,quantity:0,revenue:0};I.orders+=1,I.quantity+=s,I.revenue+=T,!I.customer_name&&$.customer_name&&(I.customer_name=$.customer_name),!I.phone&&$.phone&&(I.phone=$.phone),r.set(F,I);const v=$.created_at?new Date($.created_at):null;if(v&&!Number.isNaN(v.getTime())){const w=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}`,K=a.get(w)||{day:w,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};K.orders+=1,K.quantity+=s,K.revenue+=T,$.status==="done"&&(K.doneOrders+=1,K.doneRevenue+=T),a.set(w,K)}}const i=Array.from(l.values()).sort(($,re)=>re.revenue-$.revenue),d=Array.from(r.values()).sort(($,re)=>re.revenue-$.revenue),D=Array.from(a.values()).sort(($,re)=>$.day.localeCompare(re.day)),R=r.size,le=me.length?Math.round(ge/me.length):0,te=me.length?be/me.length:0;return{statusCounts:u,totalQty:be,totalRevenue:ge,doneRevenue:ye,products:i,customers:d,days:D,uniqueCustomers:R,avgOrderValue:le,avgQtyPerOrder:te}},[me,t]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:x}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:Re,disabled:x},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:t,onChange:u=>n(u.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),M(me.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),M(ne.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),M(ne.totalQty)," SL"))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},M(me.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},he(ne.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},he(ne.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Gi\xE1 tr\u1ECB TB/\u0111\u01A1n"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},he(ne.avgOrderValue))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",ne.avgQtyPerOrder?ne.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},M(ne.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},M(ne.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},M(ne.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},M(ne.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,M(ne.statusCounts.pending)),React.createElement("td",null,M(ne.statusCounts.processing)),React.createElement("td",null,M(ne.statusCounts.done)),React.createElement("td",null,M(ne.statusCounts.other)),React.createElement("td",null,M(ne.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},ne.products.slice(0,10).map(u=>React.createElement("div",{key:u.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},u.product_name),React.createElement("div",{className:"text-muted small text-truncate"},u.product_code?`#${u.product_code} \u2022 `:"",M(u.orders)," \u0111\u01A1n \u2022 ",M(u.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},he(u.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,ne.products.slice(0,10).map(u=>React.createElement("tr",{key:u.product_id},React.createElement("td",null,u.product_name),React.createElement("td",null,u.product_code||"\u2014"),React.createElement("td",null,M(u.orders)),React.createElement("td",null,M(u.quantity)),React.createElement("td",{className:"fw-semibold"},he(u.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},ne.customers.slice(0,10).map(u=>React.createElement("div",{key:u.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},u.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},u.phone||"\u2014"," \u2022 ",M(u.orders)," \u0111\u01A1n \u2022 ",M(u.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},he(u.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,ne.customers.slice(0,10).map(u=>React.createElement("tr",{key:u.key},React.createElement("td",null,u.customer_name||"\u2014"),React.createElement("td",null,u.phone||"\u2014"),React.createElement("td",null,M(u.orders)),React.createElement("td",null,M(u.quantity)),React.createElement("td",{className:"fw-semibold"},he(u.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},ne.days.map(u=>React.createElement("div",{key:u.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},u.day),React.createElement("div",{className:"text-muted small"},M(u.orders)," \u0111\u01A1n \u2022 ",M(u.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",M(u.doneOrders)," \u2022 ",he(u.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},he(u.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,ne.days.map(u=>React.createElement("tr",{key:u.day},React.createElement("td",null,u.day),React.createElement("td",null,M(u.orders)),React.createElement("td",null,M(u.quantity)),React.createElement("td",{className:"fw-semibold"},he(u.revenue)),React.createElement("td",null,M(u.doneOrders)),React.createElement("td",{className:"fw-semibold"},he(u.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:h,onMenuChange:t=>{y(t),t==="albums"&&(se(null),ee([]),Y(null))},onLogout:ce,currentUser:k}),React.createElement("div",{className:"main-content"},h==="albums"&&!z&&React.createElement(AlbumList,{albums:S,loading:Z,currentFolder:f,breadcrumb:H,onSelect:ve,onCreate:de,onEdit:pe,onDelete:fe,onBack:Ce}),h==="search"&&React.createElement(SearchCenter,{showToast:W,onNavigate:(t,n,x)=>{y(t),t==="orders"&&n==="create"&&(m(Date.now()),U((x==null?void 0:x.productId)||""))}}),h==="albums"&&z&&React.createElement(AlbumDetail,{album:z,parentAlbum:H.length>0?H[H.length-1]:null,onBack:()=>{if(z.parentId){const t=H.findIndex(n=>n.uuid===z.parentId);t>=0?V(H[t]):V(null)}else V(null)},onRefresh:()=>Y(f==null?void 0:f.uuid),showToast:W,onNavigateToFolder:t=>{ee(n=>[...n,z]),V(t)},onEditSubfolder:t=>{J(t),C(!0)}}),h==="videos"&&React.createElement(VideoList,{showToast:W}),h==="products"&&React.createElement(ProductManager,{showToast:W}),h==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:E,autoOpenCreateProductId:q,showToast:W}),h==="stats"&&React.createElement(De,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${h==="search"?"active":""}`,onClick:t=>{t.preventDefault(),y("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${h==="albums"?"active":""}`,onClick:t=>{t.preventDefault(),y("albums"),V(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${h==="videos"?"active":""}`,onClick:t=>{t.preventDefault(),y("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${h==="products"?"active":""}`,onClick:t=>{t.preventDefault(),y("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${h==="orders"?"active":""}`,onClick:t=>{t.preventDefault(),y("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${h==="stats"?"active":""}`,onClick:t=>{t.preventDefault(),y("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:_,album:P,parentId:f==null?void 0:f.uuid,onClose:()=>C(!1),onSave:ae}),React.createElement("div",{className:"toast-container"},O.map(t=>React.createElement(Toast,{key:t.id,message:t.message,type:t.type,onClose:()=>ue(t.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:N,autoOpenCreateProductId:c,showToast:L}){const[j,k]=useState([]),[o,h]=useState(!0),[y,E]=useState(!1),[m,q]=useState(null),[U,S]=useState(""),[A,z]=useState(!1),[V,_]=useState(null),[C,P]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],status:"pending"}),[J,Z]=useState([]),[p,O]=useState(null),X=useRef(null),f=useRef(null),se=useRef(0),H=useRef(null),ee=useRef(0),xe=3,ce=e=>{if(e==null)return 0;const l=String(e).replace(/[^0-9]/g,"");return l?Number(l):0},W=e=>{try{return`${Number(e||0).toLocaleString("vi-VN")}\u0111`}catch(l){return`${e||0}\u0111`}},ue=e=>{if(!e)return null;const l=String(e),r=l.toLowerCase();if(r.includes("freeship")||r.includes("free ship")||r.includes("mi\u1EC5n ph\xED ship")||r.includes("mien phi ship")||r.includes("mi\u1EC5n ph\xED v\u1EADn chuy\u1EC3n")||r.includes("mien phi van chuyen"))return 0;const a=l.match(/(?:ship|vận\s*chuyển|van\s*chuyen|\bvc\b)\s*[:=\-]?\s*([0-9][0-9\.,\s]*)(?:\s*(k|nghìn|nghin|tr|triệu|trieu|m))?/i);if(!a)return null;const i=String(a[1]||"").replace(/[^0-9]/g,"");if(!i)return null;let d=Number(i);const D=String(a[2]||"").toLowerCase();return D==="k"||D.startsWith("ngh")?d*=1e3:(D==="tr"||D.startsWith("tri")||D==="m")&&(d*=1e6),Number.isFinite(d)?d:null},Y=e=>{const l=de(e);return l.length>=9&&l.length<=12},de=e=>e?String(e).replace(/[^0-9]/g,""):"",pe=async e=>{const l=de(e);if(!l)return;const r=++se.current;_({status:"loading",phone:l});try{const i=await(await fetch(`${API_BASE}/api/customers?phone=${encodeURIComponent(l)}`)).json();if(se.current!==r)return;if(i&&i.exists&&i.customer){_({status:"found",phone:l,customer:i.customer}),P(d=>de(d.phone)!==l?d:{...d,customer_name:i.customer.name||d.customer_name,address:i.customer.address||d.address});return}_({status:"not-found",phone:l})}catch(a){if(se.current!==r)return;console.error("Customer lookup error:",a),_({status:"error",phone:l})}},ae=e=>{const l=de(e);if(P(a=>({...a,phone:l})),f.current&&(clearTimeout(f.current),f.current=null),l.length<xe){_(null);return}f.current=setTimeout(()=>{pe(l)},350)},ve=()=>{const e=de(C.phone);e.length<xe||pe(e)};useEffect(()=>(A?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[A]);const Ce=Array.isArray(C.items)?C.items.length:0;useEffect(()=>{if(!A){ee.current=Ce;return}Ce>ee.current&&setTimeout(()=>{const e=H.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),ee.current=Ce},[A,Ce]),useEffect(()=>()=>{f.current&&(clearTimeout(f.current),f.current=null)},[]),useEffect(()=>{n()},[]),useEffect(()=>{x()},[U]),useEffect(()=>{N&&X.current!==N&&(X.current=N,Ae(c))},[N]);const fe=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e||"",ke=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":"bg-light text-dark",De=React.useMemo(()=>{const e={pending:0,processing:1,done:2},l=a=>a in e?e[a]:99,r=a=>{if(!a)return Number.POSITIVE_INFINITY;const i=new Date(a).getTime();return Number.isFinite(i)?i:Number.POSITIVE_INFINITY};return[...j||[]].sort((a,i)=>{const d=l(a==null?void 0:a.status),D=l(i==null?void 0:i.status);if(d!==D)return d-D;const R=r(a==null?void 0:a.created_at),le=r(i==null?void 0:i.created_at);if(R!==le)return R-le;const te=Number(a==null?void 0:a.id),$=Number(i==null?void 0:i.id);return Number.isFinite(te)&&Number.isFinite($)?te-$:String((a==null?void 0:a.id)||"").localeCompare(String((i==null?void 0:i.id)||""))})},[j]),t=e=>{if(!e)return"";const l=new Date(e);if(Number.isNaN(l.getTime()))return String(e);try{return l.toLocaleString("vi-VN")}catch(r){return l.toISOString()}},n=async()=>{try{const l=await(await fetch(`${API_BASE}/api/products`)).json();Z(Array.isArray(l)?l:[])}catch(e){console.error("Load products error:",e),Z([])}},x=async()=>{h(!0);try{let e=`${API_BASE}/api/orders`;U&&(e+=`?month=${U}`);const r=await(await fetch(e)).json();k(Array.isArray(r)?r:[])}catch(e){console.error("Load orders error:",e),k([])}finally{h(!1)}},B=async()=>{const e=de(C.phone),r=(Array.isArray(C.items)?C.items:[]).map(a=>{var i;return{product_id:(a==null?void 0:a.product_id)||"",quantity:Number((i=a==null?void 0:a.quantity)!=null?i:1)}}).filter(a=>a.product_id&&Number.isFinite(a.quantity)&&a.quantity>0);if(!C.customer_name||!e||r.length===0){alert("Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c");return}if(!Y(e)){alert("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)");return}E(!0);try{const a=p?"PUT":"POST",i=p?`${API_BASE}/api/orders/${p}`:`${API_BASE}/api/orders`,d=r[0];await fetch(i,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_name:C.customer_name,phone:e,address:C.address,product_id:d.product_id,quantity:d.quantity,status:C.status,items:r,...p?{id:p}:{}})}),P({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],status:"pending"}),O(null),z(!1),x()}finally{E(!1)}},me=e=>{O(e.id);const l=Array.isArray(e.items)&&e.items.length?e.items.map(r=>{var a;return{product_id:(r==null?void 0:r.product_id)||"",quantity:Number((a=r==null?void 0:r.quantity)!=null?a:1)||1}}).filter(r=>r.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];P({customer_name:e.customer_name||"",phone:de(e.phone||""),address:e.address||"",items:l.length?l:[{product_id:"",quantity:1}],status:e.status||"pending"}),_(null),z(!0),e.phone&&pe(de(e.phone))};function Ae(e){O(null),P({customer_name:"",phone:"",address:"",items:[{product_id:e||"",quantity:1}],status:"pending"}),_(null),z(!0)}const Ne=()=>{y||(z(!1),O(null),P({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],status:"pending"}),_(null))},Se=e=>Array.isArray(e==null?void 0:e.items)&&e.items.length?e.items:e!=null&&e.product_id?[{product_id:e.product_id,quantity:Number(e.quantity||1)||1,product_name:e.product_name}]:[],je=e=>{var i,d;const r=Se(e).reduce((D,R)=>D+(Number((R==null?void 0:R.quantity)||0)||0),0);if(r>0)return r;const a=Number((d=(i=e==null?void 0:e.total_quantity)!=null?i:e==null?void 0:e.quantity)!=null?d:0);return Number.isFinite(a)?a:0},M=e=>{const l=Se(e);if(!l.length)return"\u2014";const r=l.map(a=>{const i=a==null?void 0:a.product_name;if(i)return String(i);const d=String((a==null?void 0:a.product_id)||""),D=J.find(R=>String(R==null?void 0:R.id)===d);return D!=null&&D.name?String(D.name):""}).filter(Boolean);return r.length?r.join(" + "):(e==null?void 0:e.product_name)||"\u2014"},he=e=>{const l=Se(e);return l.length?l.map(r=>{var le;const a=r==null?void 0:r.product_name,i=String((r==null?void 0:r.product_id)||""),d=J.find(te=>String(te==null?void 0:te.id)===i),D=(a||(d==null?void 0:d.name)||"").toString().trim(),R=Number((le=r==null?void 0:r.quantity)!=null?le:1)||1;return{name:D,qty:R}}).filter(r=>r.name):[]},Re=e=>{var le;const l=Se(e),r=he(e),a=ge(l),i=be(l),d=i.fee,D=a+d,R=[];if(R.push(`\u0110\u01A0N H\xC0NG #${(le=e==null?void 0:e.id)!=null?le:""}`.trim()),e!=null&&e.customer_name&&R.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&R.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&R.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),e!=null&&e.status&&R.push(`Tr\u1EA1ng th\xE1i: ${fe(e.status)}`),e!=null&&e.created_at&&R.push(`Th\u1EDDi gian: ${t(e.created_at)}`),R.push(""),R.push("S\u1EA3n ph\u1EA9m:"),r.length)for(const te of r)R.push(`- ${te.name} x${te.qty}`);else{const te=M(e);te&&te!=="\u2014"&&R.push(`- ${te}`)}return R.push(""),R.push(`T\u1EA1m t\xEDnh: ${W(a)}`),R.push(`Ship: ${W(i.found?d:0)}`),R.push(`T\u1ED5ng: ${W(D)}`),R.filter(Boolean).join(`
`)},ne=async e=>{var a;if((a=navigator==null?void 0:navigator.clipboard)!=null&&a.writeText){await navigator.clipboard.writeText(e);return}const l=document.createElement("textarea");l.value=e,l.setAttribute("readonly",""),l.style.position="fixed",l.style.left="-9999px",document.body.appendChild(l),l.select();const r=document.execCommand("copy");if(document.body.removeChild(l),!r)throw new Error("copy_failed")},u=async e=>{try{const l=Re(e);await ne(l),typeof L=="function"?L("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(l){console.error(l),typeof L=="function"?L("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},be=e=>{var i,d;const l=Array.isArray(e)?e:[];let r=!1,a=0;for(const D of l){const R=String((D==null?void 0:D.product_id)||""),le=J.find(re=>String(re==null?void 0:re.id)===R),te=(d=(i=D==null?void 0:D.product_note)!=null?i:le==null?void 0:le.note)!=null?d:null,$=ue(te);$!=null&&(r=!0,$>a&&(a=$))}return{found:r,fee:a}},ge=e=>(Array.isArray(e)?e:[]).reduce((r,a)=>{var le;const i=Number((a==null?void 0:a.quantity)||0)||0,d=String((a==null?void 0:a.product_id)||""),D=J.find(te=>String(te==null?void 0:te.id)===d),R=ce((le=a==null?void 0:a.product_price)!=null?le:D==null?void 0:D.price);return r+i*R},0),ye=e=>{const l=Se(e),r=ge(l),a=be(l).fee;return r+a},$e=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){q(e);try{await fetch(`${API_BASE}/api/orders/${e}`,{method:"DELETE"}),x()}finally{q(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:o&&!A||y||!!m}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Ae,disabled:y||!!m},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:U,onChange:e=>S(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),U&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{S("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:o},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:x,disabled:o},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},j.length," \u0111\u01A1n")),o?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):j.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},De.map(e=>React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"text-muted small"},e.phone),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address)),React.createElement("span",{className:`badge ${ke(e.status)}`},fe(e.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const l=he(e);return l.length?React.createElement("div",{className:"mt-1"},l.map((r,a)=>React.createElement("div",{key:a,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},r.name),React.createElement("div",{className:"text-muted",style:{flexShrink:0}},"x",r.qty)))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},M(e))})()),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},je(e))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},W(ye(e)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",t(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>me(e),disabled:y||!!m},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>u(e),disabled:y||!!m},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>$e(e.id),disabled:y||m===e.id},m===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,De.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,M(e)),React.createElement("td",null,je(e)),React.createElement("td",{className:"fw-semibold"},W(ye(e))),React.createElement("td",null,React.createElement("span",{className:`badge ${ke(e.status)}`},fe(e.status))),React.createElement("td",null,t(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>me(e),disabled:y||!!m},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>u(e),disabled:y||!!m},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>$e(e.id),disabled:y||m===e.id},m===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),A&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),p?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Ne})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),B()}},React.createElement("div",{className:"modal-body",ref:H},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:C.customer_name,onChange:e=>P({...C,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",value:C.phone,onChange:e=>ae(e.target.value),onBlur:ve,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),(V==null?void 0:V.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(V==null?void 0:V.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(V==null?void 0:V.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(V==null?void 0:V.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:C.status,onChange:e=>P({...C,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:C.address,onChange:e=>P({...C,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>P(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),disabled:y},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(C.items)?C.items:[{product_id:"",quantity:1}]).map((e,l)=>React.createElement("div",{key:l,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("select",{className:"form-select",value:e.product_id,onChange:r=>{const a=r.target.value;P(i=>{const d=Array.isArray(i.items)?[...i.items]:[];return d[l]={...d[l]||{quantity:1},product_id:a},{...i,items:d}})},required:!0,style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),J.map(r=>React.createElement("option",{key:r.id,value:r.id},r.name)))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:r=>{const a=r.target.value;P(i=>{const d=Array.isArray(i.items)?[...i.items]:[];return d[l]={...d[l]||{product_id:""},quantity:a},{...i,items:d}})},min:"1",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>P(r=>{const a=Array.isArray(r.items)?[...r.items]:[];return a.splice(l,1),{...r,items:a.length?a:[{product_id:"",quantity:1}]}}),disabled:y||(Array.isArray(C.items)?C.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const l=(Array.isArray(C.items)?C.items:[]).filter(d=>d==null?void 0:d.product_id),r=ge(l),a=be(l),i=r+(a.found?a.fee:0);return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},W(r))),a.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},W(a.fee))),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},W(i)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Ne,disabled:y,style:{borderRadius:10}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:y,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

