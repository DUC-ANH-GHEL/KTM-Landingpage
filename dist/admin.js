const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:_,error:w}){const[j,Z]=useState(""),[Y,N]=useState(""),[K,ne]=useState(!1),[oe,X]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),w&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),w),React.createElement("form",{onSubmit:async ye=>{ye.preventDefault(),ne(!0),await _(j,Y),ne(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:j,onChange:ye=>Z(ye.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:oe?"text":"password",className:"form-control",value:Y,onChange:ye=>N(ye.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>X(!oe)},React.createElement("i",{className:`fas fa-eye${oe?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:K},K?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:_,type:w,onClose:j}){return useEffect(()=>{const Z=setTimeout(j,3e3);return()=>clearTimeout(Z)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${w} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},_),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:j})))}function Loading({show:_}){return _?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:_,onMenuChange:w,onLogout:j,currentUser:Z}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(N=>React.createElement("a",{key:N.id,href:"#",className:`nav-link ${_===N.id?"active":""} ${N.disabled?"opacity-50":""} ${N.highlight?"text-warning":""}`,onClick:K=>{K.preventDefault(),N.disabled||w(N.id)}},React.createElement("i",{className:`fas ${N.icon}`})," ",N.label,N.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),N.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),j&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:j,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(_){const w=typeof _=="number"?_:parseFloat(String(_!=null?_:"").trim());return Number.isFinite(w)?Math.max(0,Math.min(100,w)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var _;try{const w=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!w)return{ship_percent:DEFAULT_SHIP_PERCENT};const j=JSON.parse(w);return{ship_percent:normalizeShipPercent((_=j==null?void 0:j.ship_percent)!=null?_:j==null?void 0:j.shipPercent)}}catch(w){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(_){var w;try{const j={ship_percent:normalizeShipPercent((w=_==null?void 0:_.ship_percent)!=null?w:_==null?void 0:_.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(j)),j}catch(j){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var w;const _=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((w=_==null?void 0:_.ship_percent)!=null?w:_==null?void 0:_.shipPercent)}}async function saveAdminSettingsToServer(_){var Z,Y,N;const w={ship_percent:normalizeShipPercent((Z=_==null?void 0:_.ship_percent)!=null?Z:_==null?void 0:_.shipPercent)},j=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,w,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((N=(Y=j==null?void 0:j.ship_percent)!=null?Y:j==null?void 0:j.shipPercent)!=null?N:w.ship_percent)}}function AlbumList({albums:_,onSelect:w,onCreate:j,onEdit:Z,onDelete:Y,loading:N,currentFolder:K,onBack:ne,breadcrumb:oe}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},K&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:ne},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),K?K.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:j},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),oe&&oe.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:X=>{X.preventDefault(),ne("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),oe.map((X,me)=>React.createElement("li",{key:X.id,className:`breadcrumb-item ${me===oe.length-1?"active":""}`},me===oe.length-1?X.title:React.createElement("a",{href:"#",onClick:ye=>{ye.preventDefault(),ne(X)},className:"text-warning"},X.title))))),N?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):_.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},K?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},_.map(X=>React.createElement("div",{key:X.uuid||X.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>w(X)},X.cover?React.createElement("img",{src:X.cover,className:"album-cover",alt:X.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},X.title),React.createElement("small",{className:"text-muted"},X.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),X.subfolderCount),X.subfolderCount>0&&X.count>0&&" \u2022 ",X.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),X.count),X.subfolderCount===0&&X.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:me=>{me.stopPropagation(),Z(X)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:me=>{me.stopPropagation(),Y(X)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:_,album:w,onClose:j,onSave:Z,parentId:Y}){const[N,K]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[ne,oe]=useState(!1),[X,me]=useState(!1),ye=useRef(null);useEffect(()=>{K(w?{slug:w.id||"",title:w.title||"",description:w.description||"",cover_url:w.cover||"",parent_id:w.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:Y||null})},[w,_,Y]);const re=async ce=>{ce.preventDefault(),oe(!0),await Z(N),oe(!1)},de=ce=>ce.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),pe=async ce=>{const Ne=ce.type==="image/heic"||ce.type==="image/heif"||/\.heic$/i.test(ce.name);if(ce.size<=2097152&&!Ne)return ce;try{const be=await createImageBitmap(ce),Te=document.createElement("canvas");let Se=be.width,fe=be.height;const we=800;return(Se>we||fe>we)&&(Se>fe?(fe=Math.round(fe/Se*we),Se=we):(Se=Math.round(Se/fe*we),fe=we)),Te.width=Se,Te.height=fe,Te.getContext("2d").drawImage(be,0,0,Se,fe),be.close(),new Promise((et,Ce)=>{Te.toBlob(De=>{De?et(new File([De],ce.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ce(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(be){throw console.error("Compress cover error:",be),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},le=async ce=>{var be;const se=ce.target.files[0];if(!se)return;if(!(se.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(se.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}me(!0);try{const Te=await pe(se),Se=await window.KTM.cloudinary.uploadImage({file:Te,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!Se.secure_url)throw console.error("Cloudinary error:",Se),new Error(((be=Se.error)==null?void 0:be.message)||"Upload failed");K(fe=>({...fe,cover_url:Se.secure_url}))}catch(Te){console.error("Cover upload error:",Te),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Te.message)}me(!1),ce.target.value=""};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:re},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:N.title,onChange:ce=>K({...N,title:ce.target.value,slug:N.slug||de(ce.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:N.slug,onChange:ce=>K({...N,slug:ce.target.value}),required:!0,disabled:!!w}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:N.description,onChange:ce=>K({...N,description:ce.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},N.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:N.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>K(ce=>({...ce,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:ye,type:"file",accept:"image/*",className:"d-none",onChange:le}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var ce;return(ce=ye.current)==null?void 0:ce.click()},disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:N.cover_url,onChange:ce=>K({...N,cover_url:ce.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:ne||X},ne?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:_,allAlbums:w,currentAlbumId:j,targetAlbum:Z,onSelect:Y,level:N=0}){const[K,ne]=useState(!0),oe=_.uuid||_.id,X=oe===j,me=Z===oe,ye=w.filter(de=>de.parentId===oe),re=ye.length>0;return React.createElement("div",{style:{marginLeft:N*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${me?"bg-info text-white":X?"bg-light text-muted":"hover-bg"}`,style:{cursor:X?"not-allowed":"pointer",opacity:X?.5:1,transition:"background 0.2s"},onClick:()=>!X&&Y(oe)},re&&React.createElement("i",{className:`fas fa-chevron-${K?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:de=>{de.stopPropagation(),ne(!K)}}),!re&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${me?"-open":""} me-2 ${me?"":"text-warning"}`}),React.createElement("span",{className:"small"},_.title),X&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),_.count>0&&!X&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},_.count)),K&&re&&React.createElement("div",null,ye.map(de=>React.createElement(FolderTreeItem,{key:de.uuid||de.id,folder:de,allAlbums:w,currentAlbumId:j,targetAlbum:Z,onSelect:Y,level:N+1}))))}function AlbumDetail({album:_,onBack:w,onRefresh:j,showToast:Z,onNavigateToFolder:Y,onEditSubfolder:N,parentAlbum:K}){const[ne,oe]=useState([]),[X,me]=useState([]),[ye,re]=useState(!0),[de,pe]=useState(!1),[le,ce]=useState(""),[se,Ne]=useState([]),[be,Te]=useState([]),[Se,fe]=useState({}),[we,Ae]=useState(null),[et,Ce]=useState(!1),[De,Je]=useState(""),[b,M]=useState(!1),i=useRef(null),u=useRef(null),[A,$]=useState(!1),[H,W]=useState([]),[r,E]=useState([]),[ge,Re]=useState(""),[c,g]=useState(!1),he=async(h,I=2)=>{const C=I*1024*1024,Fe=h.type==="image/heic"||h.type==="image/heif"||/\.heic$/i.test(h.name);if(h.size<=C&&!Fe)return h;try{const Ve=await createImageBitmap(h),Ue=document.createElement("canvas");let tt=Ve.width,at=Ve.height;const nt=1200;return(tt>nt||at>nt)&&(tt>at?(at=Math.round(at/tt*nt),tt=nt):(tt=Math.round(tt/at*nt),at=nt)),Ue.width=tt,Ue.height=at,Ue.getContext("2d").drawImage(Ve,0,0,tt,at),Ve.close(),new Promise((_t,ft)=>{Ue.toBlob(ze=>{ze?_t(new File([ze],h.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ft(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Ve){throw console.error("Compress error:",Ve),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{y(),B()},[_.id,_.uuid]);const y=async()=>{re(!0);try{const h=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${_.uuid||_.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");oe(h.images||[]);const I=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${_.uuid||_.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");me(Array.isArray(I)?I:[])}catch(h){console.error(h),Z("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}re(!1)},B=async()=>{try{const h=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");E(Array.isArray(h)?h:[])}catch(h){console.error("Error loading albums:",h)}},V=h=>{W(I=>I.includes(h)?I.filter(C=>C!==h):[...I,h])},_e=async()=>{if(!ge||H.length===0){Z("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}g(!0);let h=0;for(const I of H)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${I}`,{album_id:ge},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),h++}catch(C){console.error("Move error:",C)}g(!1),$(!1),W([]),Re(""),h>0?(Z("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),y(),j()):Z("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Xe,Oe]=useState(!1),Pe=async()=>{if(H.length===0||!confirm(`X\xF3a ${H.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Oe(!0);let h=0;for(const I of H)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${I}`,"L\u1ED7i x\xF3a \u1EA3nh"),h++}catch(C){console.error("Delete error:",C)}Oe(!1),W([]),h>0?(Z(`\u0110\xE3 x\xF3a ${h} \u1EA3nh!`,"success"),y(),j()):Z("X\xF3a th\u1EA5t b\u1EA1i","danger")},Be=()=>{H.length===ne.length?W([]):W(ne.map(h=>h.id))},dt=async()=>{if(De.trim()){M(!0);try{const h=De.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:h+"-"+Date.now(),title:De,parent_id:_.uuid||_.id},"L\u1ED7i t\u1EA1o folder"),Z("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),Je(""),Ce(!1),y(),j()}catch(h){Z(h.message,"danger")}M(!1)}},Mt=async h=>{if(confirm(`X\xF3a folder "${h.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${h.uuid||h.id}`,"L\u1ED7i x\xF3a folder"),Z("\u0110\xE3 x\xF3a folder","success"),y(),j()}catch(I){Z("L\u1ED7i x\xF3a folder","danger")}},Nt=h=>{const I=Array.from(h).filter(C=>C.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(C.name));Ne(C=>[...C,...I]),I.forEach(C=>{const Fe=new FileReader;Fe.onload=Ve=>{Te(Ue=>[...Ue,{file:C,preview:Ve.target.result}])},Fe.readAsDataURL(C)})},Pt=h=>{Ne(I=>I.filter((C,Fe)=>Fe!==h)),Te(I=>I.filter((C,Fe)=>Fe!==h))},Kt=async h=>{var C;const I=await window.KTM.cloudinary.uploadImage({file:h,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${_.id}`});if(!I.secure_url)throw console.error("Cloudinary error:",I),new Error(((C=I.error)==null?void 0:C.message)||"Upload failed");return I},It=async()=>{if(se.length===0)return;pe(!0);let h=0;for(let I=0;I<se.length;I++)try{ce(`\u0110ang x\u1EED l\xFD ${I+1}/${se.length}...`);const C=await he(se[I],2);ce(`\u0110ang upload ${I+1}/${se.length}...`);const Fe=await Kt(C);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${_.id}`,{url:Fe.secure_url,caption:Se[I]||se[I].name.replace(/\.[^/.]+$/,""),sort_order:ne.length+I},"L\u1ED7i l\u01B0u \u1EA3nh"),h++}catch(C){console.error("Upload error:",C)}pe(!1),ce(""),Ne([]),Te([]),fe({}),h>0?(Z(`\u0110\xE3 upload ${h} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),y(),j()):Z("Upload th\u1EA5t b\u1EA1i","danger")},ve=async(h,I)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${h}`,"L\u1ED7i x\xF3a \u1EA3nh"),Z("\u0110\xE3 x\xF3a \u1EA3nh","success"),y(),j()}catch(C){Z("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Qe=h=>{var I;h.preventDefault(),(I=u.current)==null||I.classList.add("dragover")},ot=()=>{var h;(h=u.current)==null||h.classList.remove("dragover")},St=h=>{var I;h.preventDefault(),(I=u.current)==null||I.classList.remove("dragover"),Nt(h.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:w},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},_.title),React.createElement("small",{className:"text-muted"},X.length>0&&React.createElement("span",null,X.length," folder \u2022 "),ne.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Ce(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),et&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:De,onChange:h=>Je(h.target.value),onKeyPress:h=>h.key==="Enter"&&dt(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:dt,disabled:b||!De.trim()},b?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Ce(!1),Je("")}},"H\u1EE7y")))),X.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},X.map(h=>React.createElement("div",{key:h.uuid||h.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>Y&&Y(h)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},h.title),React.createElement("small",{className:"text-muted"},h.subfolderCount>0&&React.createElement("span",null,h.subfolderCount," folder"),h.subfolderCount>0&&h.count>0&&" \u2022 ",h.count>0&&React.createElement("span",null,h.count," \u1EA3nh"),h.subfolderCount===0&&h.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:I=>{I.stopPropagation(),N&&N(h)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:I=>{I.stopPropagation(),Mt(h)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:u,className:"upload-zone",onClick:()=>{var h;return(h=i.current)==null?void 0:h.click()},onDragOver:Qe,onDragLeave:ot,onDrop:St},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:i,type:"file",multiple:!0,accept:"image/*",onChange:h=>Nt(h.target.files)})),be.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},be.map((h,I)=>React.createElement("div",{key:I,className:"upload-preview-item"},React.createElement("img",{src:h.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>Pt(I)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:It,disabled:de},de?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),le||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",se.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",ne.length,")"),ne.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Be},H.length===ne.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),H.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},H.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>$(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Pe,disabled:Xe},Xe?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>W([])},React.createElement("i",{className:"fas fa-times"})))),ye?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):ne.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},ne.map((h,I)=>React.createElement("div",{key:I,className:`image-item ${H.includes(h.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>V(h.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:H.includes(h.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:H.includes(h.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},H.includes(h.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:h.src,alt:h.caption,style:{opacity:H.includes(h.id)?.7:1,border:H.includes(h.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:C=>{C.stopPropagation(),ve(h.id,I)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),h.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},h.caption)))))),A&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",H.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>$(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},r.filter(h=>!h.parentId).map(h=>React.createElement(FolderTreeItem,{key:h.uuid||h.id,folder:h,allAlbums:r,currentAlbumId:_.uuid||_.id,targetAlbum:ge,onSelect:Re})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>$(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:_e,disabled:!ge||c},c?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),we&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Ae(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Ae(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:we.src,alt:we.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:h=>h.stopPropagation()}),we.caption&&React.createElement("div",{className:"text-white text-center mt-2"},we.caption)))))}function SearchCenter({showToast:_,onNavigate:w}){const[j,Z]=useState(""),[Y,N]=useState([]),[K,ne]=useState([]),[oe,X]=useState([]),[me,ye]=useState("all"),[re,de]=useState(null),[pe,le]=useState("list"),[ce,se]=useState(!0),[Ne,be]=useState([]),[Te,Se]=useState([]),fe=useRef(null),[we,Ae]=useState(!0),[et,Ce]=useState(!1),De=useRef(null),[Je,b]=useState(!1),[M,i]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[u,A]=useState(""),[$,H]=useState(!1),W=useRef(null),r=useRef(null),[E,ge]=useState(null),[Re,c]=useState(!1),[g,he]=useState(null),[y,B]=useState(!1),[V,_e]=useState(!1),[Xe,Oe]=useState(null),[Pe,Be]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),dt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],Mt=t=>{var v,O;t._type==="product"&&(he(t),Be({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||"",commission_percent:(O=(v=t.commission_percent)!=null?v:t.commissionPercent)!=null?O:""}),c(!0))},Nt=async()=>{if(g)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${g.id}`,Pe,"L\u1ED7i c\u1EADp nh\u1EADt"),_("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),c(!1),he(null),Qe()}catch(t){_(t.message,"danger")}},Pt=async t=>{const v=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${v} "${t.name}"?`))try{let O="";t._type==="product"?O=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?O=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(O=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(O,"L\u1ED7i x\xF3a"),_(`\u0110\xE3 x\xF3a ${v}`,"success"),Qe()}catch(O){_(O.message,"danger")}},Kt=async t=>{try{const v=Xe?`${API_BASE}/api/products?id=${Xe.id}`:`${API_BASE}/api/products`;Xe?await window.KTM.api.putJSON(v,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(v,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),_(Xe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),_e(!1),Oe(null),Qe()}catch(v){_(v.message,"danger")}},It="ktm_admin_data_cache_v1",ve=1e3*60*10,Qe=async()=>{let t=null,v=!1;const O=window.KTM.cache.read(It,{ttlMs:ve,validate:Array.isArray});O.hit?(t=O.value,console.log("[CACHE] Using cache, items:",t.length),ne(t),N(t),se(!1),v=!0):O.status==="miss"?console.log("[CACHE] No cache found"):O.status==="expired"||O.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):O.status==="error"&&console.error("[CACHE] Error parsing cache"),v||se(!0);try{const J=async(Le,$e)=>{try{const Ke=await window.KTM.api.getJSON(Le,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Ke!=null?Ke:$e}catch(Ke){return $e}},[Q,T,d]=await Promise.all([J(`${API_BASE}/api/products`,[]),J(`${API_BASE}/api/albums`,[]),J(`${API_BASE}/api/video-folders?withVideos=true`,[])]),q=Array.isArray(Q)?Q.map(Le=>({...Le,_type:"product",_source:"database"})):[];be(T);let ae=[];Array.isArray(T)&&T.length>0&&(await Promise.all(T.map($e=>J(`${API_BASE}/api/albums/${$e.id}`,{})))).forEach(($e,Ke)=>{const it=T[Ke];$e.images&&$e.images.length>0&&$e.images.forEach(Ye=>{ae.push({id:Ye.id,name:Ye.caption||"\u1EA2nh t\u1EEB "+it.title,image:Ye.src,folder:it.title,_type:"album",_source:"database"})})}),Se(d);let ee=[];Array.isArray(d)&&d.forEach(Le=>{Le.videos&&Le.videos.forEach($e=>{ee.push({id:$e.id,name:$e.title,folder:Le.name,image:$e.thumb,youtubeId:$e.youtubeId,url:$e.url,_type:"video",_source:"database"})})});const x=[...q,...ae,...ee];(!t||JSON.stringify(x)!==JSON.stringify(t))&&(ne(x),N(x),window.KTM.cache.write(It,x))}catch(J){console.error("Song song fetch error:",J)}se(!1)};useEffect(()=>{Qe(),setTimeout(()=>{var t;return(t=fe.current)==null?void 0:t.focus()},100)},[]);const ot=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(v){return String(t!=null?t:"").toLowerCase()}},St=t=>{const O=ot(t).trim().split(/\s+/).filter(Boolean),J=O.includes("anh"),Q=O.includes("video"),T=O.filter(ae=>ae!=="anh"&&ae!=="video"),d=T.join(" "),q=new Set(["product"]);return J&&q.add("album"),Q&&q.add("video"),{allowedTypes:q,includeAlbum:J,includeVideo:Q,contentTokens:T,cleanedQuery:d}},h=(t,v,O)=>{var Le,$e,Ke,it,Ye;const J=Array.isArray(v)?v:[],Q=ot(O).trim();if(!J.length&&!Q)return 0;const T=ot((Le=t==null?void 0:t.name)!=null?Le:""),d=ot(($e=t==null?void 0:t.code)!=null?$e:""),q=ot((Ke=t==null?void 0:t.category)!=null?Ke:""),ae=ot((it=t==null?void 0:t.note)!=null?it:""),ee=ot((Ye=t==null?void 0:t.folder)!=null?Ye:"");if(!`${T} ${d} ${q} ${ae} ${ee}`.trim())return 0;let z=0;Q&&(T===Q&&(z+=220),T.includes(Q)&&(z+=140),T.startsWith(Q)&&(z+=160),d&&d===Q&&(z+=180),d&&d.includes(Q)&&(z+=90));for(const We of J){if(!We)continue;const lt=new RegExp(`(?:^|\\s)${We.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);T.includes(We)&&(z+=35),lt.test(T)&&(z+=25),d&&d.includes(We)&&(z+=20),d&&lt.test(d)&&(z+=10),q&&q.includes(We)&&(z+=12),ee&&ee.includes(We)&&(z+=12),ae&&ae.includes(We)&&(z+=6)}return z>0&&T&&(z+=Math.max(0,10-Math.min(10,Math.floor(T.length/10)))),z},I=(t,v,O)=>{const J=Array.isArray(t)?t:[];return J.length?J.map((T,d)=>({it:T,idx:d,score:h(T,v,O)})).sort((T,d)=>d.score!==T.score?d.score-T.score:T.idx-d.idx).map(T=>T.it):[]},C=async(t,v)=>{if(!(!we||v.length===0)){Ce(!0);try{const O=v.map(Q=>({id:Q.id,name:Q.name,price:Q.price,category:Q.category,note:Q.note,folder:Q.folder,_type:Q._type})),J=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:O},"AI Search error");if(J&&J.matchedIds&&J.matchedIds.length>0){const{contentTokens:Q,cleanedQuery:T}=St(t),d=new Set(J.matchedIds),q=v.filter(ae=>d.has(ae.id)).sort((ae,ee)=>h(ee,Q,T)-h(ae,Q,T));q.length>0&&N(q)}else J&&J.matchedIds&&J.matchedIds.length===0&&N([])}catch(O){console.error("AI Search error:",O)}Ce(!1)}},Fe=t=>{if(Z(t),De.current&&clearTimeout(De.current),!t.trim()){Ve(me);return}const{allowedTypes:v,contentTokens:O,cleanedQuery:J}=St(t),Q=K.filter(d=>{if(!v.has(d==null?void 0:d._type))return!1;if(O.length===0)return!0;const q=ot(Object.entries(d).filter(([ae])=>!ae.startsWith("_")).map(([,ae])=>String(ae||"")).join(" "));return O.some(ae=>q.includes(ae))});let T=Q;me!=="all"&&(T=Q.filter(d=>(d.category||d._type)===me)),N(I(T,O,J)),we&&J.length>=3&&(De.current=setTimeout(()=>{C(J,T)},500))},Ve=t=>{ye(t);const{allowedTypes:v,contentTokens:O}=St(j),{cleanedQuery:J}=St(j);let Q=K.filter(T=>v.has(T==null?void 0:T._type));t!=="all"&&(Q=Q.filter(T=>(T.category||T._type)===t)),j.trim()&&O.length>0&&(Q=Q.filter(T=>{const d=ot(Object.entries(T).filter(([q])=>!q.startsWith("_")).map(([,q])=>String(q||"")).join(" "));return O.every(q=>d.includes(q))})),N(I(Q,O,J))},Ue=(t,v)=>{window.KTM.clipboard.writeText(t).then(()=>{de(v),_("\u0110\xE3 copy!","success"),setTimeout(()=>de(null),1500)})},tt=async(t,v)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),de(v+"-img"),_("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>de(null),1500)}catch(O){Ue(t,v+"-img")}},at=t=>{let v=t.toLowerCase();const O=[],J=K.filter(d=>d._type==="product");if(v.includes("ty")||v.includes("xy lanh")){if(v.includes("gi\u1EEFa")||v.includes("giua")){const d=J.find(q=>{var ae;return(ae=q.name)==null?void 0:ae.toLowerCase().includes("xy lanh gi\u1EEFa")});d&&!O.find(q=>q.id===d.id)&&O.push(d)}if(v.includes("nghi\xEAng")||v.includes("nghieng")){const d=J.find(q=>{var ae;return(ae=q.name)==null?void 0:ae.toLowerCase().includes("xy lanh nghi\xEAng")});d&&!O.find(q=>q.id===d.id)&&O.push(d)}if(v.includes("\u1EE7i")||v.includes("ui")){const d=J.find(q=>{var ae;return(ae=q.name)==null?void 0:ae.toLowerCase().includes("xy lanh \u1EE7i")});d&&!O.find(q=>q.id===d.id)&&O.push(d)}}const Q=v.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(Q){const d=Q[1],q=Q[2],ae=J.find(ee=>{var z;const x=((z=ee.name)==null?void 0:z.toLowerCase())||"";return x.includes("combo")&&x.includes(`${d} tay`)&&(x.includes(`${q} xy`)||x.includes(`${q} xylanh`))});if(ae&&!O.find(ee=>ee.id===ae.id))O.push(ae);else{const ee=J.find(x=>{var Le;const z=((Le=x.name)==null?void 0:Le.toLowerCase())||"";return z.includes("combo")&&z.includes(`${d} tay`)});ee&&!O.find(x=>x.id===ee.id)&&O.push(ee)}}if(v.includes("combo")&&!Q){const d=v.match(/combo.*?(\d+)\s*tay/);if(d){const q=d[1];J.filter(ee=>{var z;const x=((z=ee.name)==null?void 0:z.toLowerCase())||"";return x.includes("combo")&&x.includes(`${q} tay`)}).forEach(ee=>{O.find(x=>x.id===ee.id)||O.push(ee)})}}const T=v.match(/van\s*(\d+)\s*tay/);if(T&&!v.includes("ty")&&!v.includes("combo")){const d=T[1],q=J.find(ae=>{var x;const ee=((x=ae.name)==null?void 0:x.toLowerCase())||"";return ee.includes(`van ${d} tay`)&&!ee.includes("combo")});q&&!O.find(ae=>ae.id===q.id)&&O.push(q)}return O.slice(0,4)},nt=async t=>{if(!t.trim())return;const v={role:"user",content:t,attachments:[]};i(J=>[...J,v]),A(""),H(!0);const O=at(t);setTimeout(()=>{var J;return(J=W.current)==null?void 0:J.scrollIntoView({behavior:"smooth"})},100);try{const Q=K.filter(x=>x._type==="product").map(x=>{let z=`- ${x.name}`;return x.code&&(z+=` (M\xE3: ${x.code})`),x.price&&(z+=` - Gi\xE1: ${x.price.replace(/[đ\s]/g,"")}\u0111`),x.category&&(z+=` [${x.category}]`),x.note&&(z+=` (${x.note})`),z}).join(`
`),d=M.slice(-6).map(x=>`${x.role==="user"?"Kh\xE1ch":"AI"}: ${x.content}`).join(`
`),q=d?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${d}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${Q}`:Q,ee=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:q,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";i(x=>[...x,{role:"assistant",content:ee,attachments:O}])}catch(J){console.error("AI Error:",J);const Q=t.toLowerCase(),T=K.filter(q=>{const ae=Object.values(q).join(" ").toLowerCase();return Q.split(" ").some(ee=>ae.includes(ee))});let d="";T.length>0?(d=`T\xECm th\u1EA5y ${T.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,T.slice(0,5).forEach(q=>{d+=`\u2022 ${q.name}`,q.price&&(d+=` - ${q.price.replace(/[đ\s]/g,"")}\u0111`),q.note&&(d+=` (${q.note})`),d+=`
`}),T.length>5&&(d+=`
...v\xE0 ${T.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):d='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',i(q=>[...q,{role:"assistant",content:d,attachments:T.slice(0,4)}])}H(!1),setTimeout(()=>{var J,Q;(J=W.current)==null||J.scrollIntoView({behavior:"smooth"}),(Q=r.current)==null||Q.focus()},100)};function Ct({show:t,product:v,categories:O,onClose:J,onSave:Q}){const[T,d]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[q,ae]=useState(!1),[ee,x]=useState(!1),z=useRef(null),Le=D=>window.KTM.money.formatVNDInputDigits(D),$e=D=>{const k=window.KTM.money.getDigits(String(D!=null?D:"")),R=Number(k);return k&&Number.isFinite(R)?Math.trunc(R):0},Ke=(D,k)=>{if(D==null||D==="")return[];let R=D;if(typeof R=="string"){const te=R.trim();if(!te)return[];try{R=JSON.parse(te)}catch(U){return[]}}if(!Array.isArray(R))return[];const G=$e(k);return R.map(te=>{var ke;if(!te||typeof te!="object")return null;const U=String((ke=te.name)!=null?ke:"").trim(),xe=(Array.isArray(te.options)?te.options:[]).map(qe=>{var pt,At,yt,kt,Ot,Et,Jt;if(!qe||typeof qe!="object")return null;const Me=String((pt=qe.label)!=null?pt:"").trim();if(!Me)return null;const Ze=(Ot=(kt=(yt=(At=qe.price)!=null?At:qe.priceValue)!=null?yt:qe.unit_price)!=null?kt:qe.unitPrice)!=null?Ot:null,xt=Number(Ze);let vt=Number.isFinite(xt)?Math.trunc(xt):null;if(vt==null){const Ht=(Jt=(Et=qe.price_delta)!=null?Et:qe.priceDelta)!=null?Jt:null,Ft=Number(Ht);Number.isFinite(Ft)&&(vt=G+Math.trunc(Ft))}vt==null&&(vt=G);const mt=String(Math.max(0,Math.trunc(Number(vt)||0)));return{label:Me,price:Math.max(0,Math.trunc(Number(vt)||0)),priceDigits:mt}}).filter(Boolean);return{name:U||"Bi\u1EBFn th\u1EC3",options:xe}}).filter(Boolean)},it=D=>{if(D==null||D==="")return[];let k=D;if(typeof k=="string"){const R=k.trim();if(!R)return[];try{k=JSON.parse(R)}catch(G){return[]}}return k&&typeof k=="object"&&!Array.isArray(k)&&(k=Object.entries(k).map(([R,G])=>({key:R,value:G}))),Array.isArray(k)?k.map(R=>{var xe,ke,qe,Me,Ze;if(!R||typeof R!="object")return null;const G=String((qe=(ke=(xe=R.key)!=null?xe:R.name)!=null?ke:R.label)!=null?qe:"").trim(),te=String((Me=R.value)!=null?Me:"").trim(),U=String((Ze=R.unit)!=null?Ze:"").trim();return G?{key:G,value:te,unit:U}:null}).filter(Boolean):[]};useEffect(()=>{var D,k;if(v)if(d({name:v.name||"",code:v.code||"",price:v.price||"",image:v.image||"",category:v.category||"",note:v.note||"",sort_order:v.sort_order||0,commission_percent:(k=(D=v.commission_percent)!=null?D:v.commissionPercent)!=null?k:5,variants:Ke(v.variants,v.price),attributes:it(v.attributes)}),v.price){const R=window.KTM.money.getDigits(v.price);ut(R),d(G=>({...G,price:Le(R)}))}else ut("");else d({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),ut("")},[v,t]);const Ye=D=>{d(k=>{var xe;const R=$e(k.price),G=String(R),te=Array.isArray(k.variants)?[...k.variants]:[],U={...te[D]||{},options:Array.isArray((xe=te[D])==null?void 0:xe.options)?[...te[D].options]:[]};return U.options=U.options.map(ke=>({label:String((ke==null?void 0:ke.label)||""),price:R,priceDigits:G})),te[D]=U,{...k,variants:te}})},We=()=>{d(D=>{const k=$e(D.price),R=String(k),te=(Array.isArray(D.variants)?[...D.variants]:[]).map(U=>{const xe=(Array.isArray(U==null?void 0:U.options)?U.options:[]).map(ke=>({label:String((ke==null?void 0:ke.label)||""),price:k,priceDigits:R}));return{name:String((U==null?void 0:U.name)||"Bi\u1EBFn th\u1EC3"),options:xe}});return{...D,variants:te}})},[lt,Lt]=React.useState(""),[Tt,ut]=React.useState(""),Dt=D=>{const k=window.KTM.money.nextPriceInputState(D.target.value,Tt);ut(k.digits),d({...T,price:k.price})},zt=async(D,k=2)=>{const R=k*1024*1024;if(D.size<=R)return D;try{const G=await createImageBitmap(D),te=document.createElement("canvas");let U=G.width,xe=G.height;const ke=1200;return(U>ke||xe>ke)&&(U>xe?(xe=Math.round(xe/U*ke),U=ke):(U=Math.round(U/xe*ke),xe=ke)),te.width=U,te.height=xe,te.getContext("2d").drawImage(G,0,0,U,xe),G.close(),new Promise((Me,Ze)=>{te.toBlob(xt=>{xt?Me(new File([xt],D.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ze(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(G){throw console.error("Compress error:",G),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},qt=async D=>{var G;const k=D.target.files[0];if(!k)return;if(!(k.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(k.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}x(!0);try{const te=await zt(k),U=await window.KTM.cloudinary.uploadImage({file:te,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!U.secure_url)throw console.error("Cloudinary error:",U),new Error(((G=U.error)==null?void 0:G.message)||"Upload failed");d(xe=>({...xe,image:U.secure_url}))}catch(te){console.error("Upload error:",te),alert("L\u1ED7i upload \u1EA3nh: "+te.message)}x(!1),D.target.value=""},ct=async D=>{D.preventDefault(),ae(!0);const k={...T,variants:Ke(T.variants,T.price),attributes:it(T.attributes)};await Q(k),ae(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),v?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:J})),React.createElement("form",{onSubmit:ct},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:T.name,onChange:D=>d({...T,name:D.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:T.code,onChange:D=>d({...T,code:D.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:T.price,onChange:Dt,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:T.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:D=>d({...T,commission_percent:D.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:T.category,onChange:D=>d({...T,category:D.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),O.map(D=>React.createElement("option",{key:D,value:D},D)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:T.note,onChange:D=>d({...T,note:D.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.attributes)?T.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(T.attributes)?T.attributes:[]).map((D,k)=>React.createElement("div",{key:k,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.key)||"",onChange:R=>{const G=R.target.value;d(te=>{const U=Array.isArray(te.attributes)?[...te.attributes]:[];return U[k]={...U[k]||{},key:G},{...te,attributes:U}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.value)||"",onChange:R=>{const G=R.target.value;d(te=>{const U=Array.isArray(te.attributes)?[...te.attributes]:[];return U[k]={...U[k]||{},value:G},{...te,attributes:U}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.unit)||"",onChange:R=>{const G=R.target.value;d(te=>{const U=Array.isArray(te.attributes)?[...te.attributes]:[];return U[k]={...U[k]||{},unit:G},{...te,attributes:U}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{d(R=>{const G=Array.isArray(R.attributes)?[...R.attributes]:[];return G.splice(k,1),{...R,attributes:G}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{d(D=>{const k=Array.isArray(D.attributes)?[...D.attributes]:[];return k.push({key:"",value:"",unit:""}),{...D,attributes:k}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(T.variants)?T.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(T.variants)?T.variants:[]).map((D,k)=>React.createElement("div",{key:k,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(D==null?void 0:D.name)||"",onChange:R=>{const G=R.target.value;d(te=>{var xe;const U=Array.isArray(te.variants)?[...te.variants]:[];return U[k]={...U[k]||{},name:G,options:Array.isArray((xe=U[k])==null?void 0:xe.options)?U[k].options:[]},{...te,variants:U}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Ye(k),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(D==null?void 0:D.options)||D.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{d(R=>{const G=Array.isArray(R.variants)?[...R.variants]:[];return G.splice(k,1),{...R,variants:G}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(D==null?void 0:D.options)?D.options:[]).map((R,G)=>{var te,U;return React.createElement("div",{key:G,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(R==null?void 0:R.label)||"",onChange:xe=>{const ke=xe.target.value;d(qe=>{var mt,pt,At,yt,kt;const Me=Array.isArray(qe.variants)?[...qe.variants]:[],Ze={...Me[k]||{},options:Array.isArray((mt=Me[k])==null?void 0:mt.options)?[...Me[k].options]:[]},xt=Number((At=(pt=Ze.options[G])==null?void 0:pt.price)!=null?At:0)||0,vt=String((kt=(yt=Ze.options[G])==null?void 0:yt.priceDigits)!=null?kt:Math.max(0,Math.trunc(xt)));return Ze.options[G]={...Ze.options[G]||{},label:ke,price:Math.max(0,Math.trunc(xt)),priceDigits:vt},Me[k]=Ze,{...qe,variants:Me}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Le(String((U=R==null?void 0:R.priceDigits)!=null?U:window.KTM.money.getDigits(String((te=R==null?void 0:R.price)!=null?te:"")))),onChange:xe=>{d(ke=>{var At,yt,kt,Ot,Et;const qe=String((yt=R==null?void 0:R.priceDigits)!=null?yt:window.KTM.money.getDigits(String((At=R==null?void 0:R.price)!=null?At:""))),Me=window.KTM.money.nextPriceInputState(xe.target.value,qe),Ze=String((kt=Me.digits)!=null?kt:""),xt=Number(Ze),vt=Number.isFinite(xt)?Math.max(0,Math.trunc(xt)):0,mt=Array.isArray(ke.variants)?[...ke.variants]:[],pt={...mt[k]||{},options:Array.isArray((Ot=mt[k])==null?void 0:Ot.options)?[...mt[k].options]:[]};return pt.options[G]={...pt.options[G]||{},label:String(((Et=pt.options[G])==null?void 0:Et.label)||""),price:vt,priceDigits:Ze},mt[k]=pt,{...ke,variants:mt}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{d(xe=>{var Me;const ke=Array.isArray(xe.variants)?[...xe.variants]:[],qe={...ke[k]||{},options:Array.isArray((Me=ke[k])==null?void 0:Me.options)?[...ke[k].options]:[]};return qe.options.splice(G,1),ke[k]=qe,{...xe,variants:ke}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{d(R=>{var xe;const G=Array.isArray(R.variants)?[...R.variants]:[],te={...G[k]||{},options:Array.isArray((xe=G[k])==null?void 0:xe.options)?[...G[k].options]:[]},U=$e(R.price);return te.options.push({label:"",price:U,priceDigits:String(U)}),G[k]=te,{...R,variants:G}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{d(D=>{const k=$e(D.price),R=Array.isArray(D.variants)?[...D.variants]:[],G=String(k);return R.push({name:"Size",options:[{label:"S",price:k,priceDigits:G},{label:"M",price:k,priceDigits:G},{label:"L",price:k,priceDigits:G}]}),{...D,variants:R}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:We,disabled:!Array.isArray(T.variants)||T.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},T.image?React.createElement(React.Fragment,null,React.createElement("img",{src:T.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>d({...T,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var D;return(D=z.current)==null?void 0:D.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:z,type:"file",accept:"image/*",className:"d-none",onChange:qt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var D;return(D=z.current)==null?void 0:D.click()},disabled:ee,style:{borderRadius:"10px"}},ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:T.image,onChange:D=>d({...T,image:D.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:J,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:q,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const _t=t=>window.KTM.money.formatVND(t),ft=t=>{if(t==null||t==="")return[];let v=t;if(typeof v=="string"){const O=v.trim();if(!O)return[];try{v=JSON.parse(O)}catch(J){return[]}}return Array.isArray(v)?v:[]},ze=t=>{if(t==null||t==="")return[];let v=t;if(typeof v=="string"){const O=v.trim();if(!O)return[];try{v=JSON.parse(O)}catch(J){return[]}}return v&&typeof v=="object"&&!Array.isArray(v)&&(v=Object.entries(v).map(([O,J])=>({key:O,value:J}))),Array.isArray(v)?v:[]},Vt=(t,v={})=>{var T;const O=ze(t).map(d=>{var q,ae,ee,x,z;return{key:String((ee=(ae=(q=d==null?void 0:d.key)!=null?q:d==null?void 0:d.name)!=null?ae:d==null?void 0:d.label)!=null?ee:"").trim(),value:String((x=d==null?void 0:d.value)!=null?x:"").trim(),unit:String((z=d==null?void 0:d.unit)!=null?z:"").trim()}}).filter(d=>!!d.key);if(!O.length)return null;const J=!!v.compact,Q=String((T=v.className)!=null?T:"").trim();return React.createElement("div",{className:`ktm-variants-preview${J?" compact":""}${Q?" "+Q:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},O.map((d,q)=>{const ae=d.key,ee=`${d.value||""}${d.unit?(d.value?" ":"")+d.unit:""}`.trim();return React.createElement("div",{key:`${ae}-${q}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ae),ee?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ee):null)})))},wt=(t,v={})=>{var ae;const O=ft(t).map(ee=>{var x;return{name:String((x=ee==null?void 0:ee.name)!=null?x:"").trim(),options:Array.isArray(ee==null?void 0:ee.options)?ee.options:[]}}).map(ee=>({...ee,options:ee.options.map(x=>{var z;return{label:String((z=x==null?void 0:x.label)!=null?z:"").trim(),price:Number(x==null?void 0:x.price)}}).filter(x=>!!x.label)})).filter(ee=>ee.options.length>0);if(!O.length)return null;const J=Number.isFinite(v.maxGroups)?Math.max(1,Math.trunc(v.maxGroups)):O.length,Q=Number.isFinite(v.maxOptionsPerGroup)?Math.max(1,Math.trunc(v.maxOptionsPerGroup)):3,T=!!v.compact,d=String((ae=v.className)!=null?ae:"").trim(),q=O.slice(0,J);return React.createElement("div",{className:`ktm-variants-preview${T?" compact":""}${d?" "+d:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},q.map((ee,x)=>{const z=ee.name||"Bi\u1EBFn th\u1EC3",Le=ee.options.slice(0,Q),$e=ee.options.length-Le.length;return React.createElement("div",{key:`${z}-${x}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},z),Le.map((Ke,it)=>{const Ye=Ke.price,We=Number.isFinite(Ye)&&Ye>=0?_t(Math.trunc(Ye)):"",lt=We?`${Ke.label} \xB7 ${We}`:Ke.label;return React.createElement("span",{key:`${z}-${x}-${it}`,className:"ktm-chip ktm-chip-option"},lt)}),$e>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",$e))})))},je=(t,v)=>{const O=t._type==="product",J=t._type==="album",Q=t._type==="video",T=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale")),d=O?Vt(t.attributes,{compact:pe==="grid",className:pe==="grid"?"meta text-muted":"text-muted"}):null,q=O?wt(t.variants,{compact:pe==="grid",maxOptionsPerGroup:999,className:pe==="grid"?"meta text-muted":"text-muted"}):null;return pe==="grid"?React.createElement("div",{key:t.id||v,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>ge({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Q?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${O?"product":J?"album":"video"}`},O?"SP":J?"\u1EA2nh":"Video"),T&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),d&&React.createElement("div",{style:{marginTop:2}},d),q&&React.createElement("div",{style:{marginTop:2}},q),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:re===t.id+"-img"?"copied":"",onClick:()=>tt(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:re===t.id+"-price"?"copied":"",onClick:()=>Ue(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||v,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${O?"product":J?"album":"video"}`},O?"S\u1EA3n ph\u1EA9m":J?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>ge({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${Q?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),T&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),d&&React.createElement("div",{style:{marginTop:4}},d),q&&React.createElement("div",{style:{marginTop:4}},q)),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),Q&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},O&&React.createElement("button",{onClick:()=>w&&w("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:re===t.id+"-price"?"copied":"",onClick:()=>Ue(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:re===t.id+"-name"?"copied":"",onClick:()=>Ue(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),Q&&t.youtubeId&&React.createElement("button",{className:re===t.id+"-yt"?"copied":"",onClick:()=>Ue(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),O&&React.createElement("button",{className:"action-edit",onClick:()=>Mt(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>Pt(t)},React.createElement("i",{className:"fas fa-trash"}))))},[$t,gt]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,Y.length)," k\u1EBFt qu\u1EA3",we&&j.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),me!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},me==="product"?"S\u1EA3n ph\u1EA9m":me==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${pe==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>le("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${pe==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>le("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},ce?React.createElement("div",null,[...Array(8)].map((t,v)=>React.createElement("div",{key:v,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):Y.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',j,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{Z(""),Fe("")}},"Xem t\u1EA5t c\u1EA3")):pe==="grid"?React.createElement("div",{className:"product-grid-mobile"},Y.map((t,v)=>je(t,v))):React.createElement("div",null,Y.map((t,v)=>je(t,v)))),$t&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>gt(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${me==="all"?"active":""}`,onClick:()=>{Ve("all"),gt(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${me==="product"?"active":""}`,onClick:()=>{Ve("product"),gt(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${me==="album"?"active":""}`,onClick:()=>{Ve("album"),gt(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${me==="video"?"active":""}`,onClick:()=>{Ve("video"),gt(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:we,onChange:t=>Ae(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:fe,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:j,onChange:t=>Fe(t.target.value)}),React.createElement("button",{className:`filter-btn ${$t||me!=="all"?"active":""}`,onClick:()=>gt(!$t)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:y?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>b(!0),onTouchStart:()=>b(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Je&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>b(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},M.map((t,v)=>React.createElement("div",{key:v,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:re===`chat-${v}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:re===`chat-${v}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),de(`chat-${v}`),setTimeout(()=>de(null),1500)}},React.createElement("i",{className:`fas ${re===`chat-${v}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((O,J)=>React.createElement("div",{key:J,style:{width:70},className:"text-center"},O.image&&React.createElement("img",{src:O.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>ge({url:O.image,name:O.name,price:O.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},O.name),O.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},O.price.replace(/[đ\s]/g,""),"\u0111"))))))),$&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:W})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>nt(t),disabled:$,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),nt(u)},className:"chat-input-wrap"},React.createElement("input",{ref:r,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:u,onChange:t=>A(t.target.value),disabled:$}),React.createElement("button",{type:"submit",className:"send-btn",disabled:$||!u.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),E&&React.createElement("div",{className:"preview-modal",onClick:()=>ge(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>ge(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:E.url,alt:E.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},E.name),E.price&&React.createElement("div",{className:"price"},E.price.replace(/[đ\s]/g,""),"\u0111"),E.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},E.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:re==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:re==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>tt(E.url,"preview")},React.createElement("i",{className:`fas ${re==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),E.price&&React.createElement("button",{className:re==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Ue(E.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${re==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(Ct,{show:V,product:Xe,categories:oe,onClose:()=>{_e(!1),Oe(null)},onSave:Kt}),React.createElement("div",{className:`fab-container mobile-only ${y?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{B(!1),_e(!0),Oe(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{B(!1),w&&w("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${y?"open":""}`,onClick:()=>B(!y)},React.createElement("i",{className:"fas fa-plus"}))),Re&&g&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>c(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Pe.name,onChange:t=>Be({...Pe,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Pe.code,onChange:t=>Be({...Pe,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Pe.price,onChange:t=>Be({...Pe,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Pe.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:t=>Be({...Pe,commission_percent:t.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Pe.category,onChange:t=>Be({...Pe,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),dt.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Pe.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>Be({...Pe,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>c(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:Nt},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:_,showToast:w}){const[j,Z]=useState([]),[Y,N]=useState([]),[K,ne]=useState(!0),[oe,X]=useState(null),[me,ye]=useState(!1),[re,de]=useState(null),[pe,le]=useState(!1),[ce,se]=useState(null),[Ne,be]=useState(null),[Te,Se]=useState([]);useEffect(()=>{fe()},[]);const fe=async(c=null)=>{ne(!0);try{const g=c?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${c}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,he=await window.KTM.api.getJSON(g,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");Z(Array.isArray(he)?he:[])}catch(g){console.error(g),w("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}ne(!1)},we=async c=>{try{const g=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${c}`,"L\u1ED7i t\u1EA3i video");N(Array.isArray(g)?g:[])}catch(g){console.error(g)}},Ae=async c=>{if(c===0)return;const g=[...j];[g[c-1],g[c]]=[g[c],g[c-1]],Z(g),await Ce(g)},et=async c=>{if(c===j.length-1)return;const g=[...j];[g[c],g[c+1]]=[g[c+1],g[c]],Z(g),await Ce(g)},Ce=async c=>{try{await Promise.all(c.map((g,he)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${g.id}`,{sortOrder:he},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),w("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(g){w("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),fe(Ne==null?void 0:Ne.id)}},De=async c=>{if(c===0)return;const g=[...Y];[g[c-1],g[c]]=[g[c],g[c-1]],N(g),await b(g)},Je=async c=>{if(c===Y.length-1)return;const g=[...Y];[g[c],g[c+1]]=[g[c+1],g[c]],N(g),await b(g)},b=async c=>{try{await Promise.all(c.map((g,he)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${g.id}`,{sort_order:he},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),w("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(g){w("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),we(oe.id)}},M=()=>{de(null),ye(!0)},i=c=>{de(c),ye(!0)},u=async c=>{try{!re&&Ne&&(c.parent_id=Ne.id);const g=re?`${API_BASE}/api/video-folders/${re.id}`:`${API_BASE}/api/video-folders`;re?await window.KTM.api.putJSON(g,c,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(g,c,"L\u1ED7i l\u01B0u folder"),w(re?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),ye(!1),fe(Ne==null?void 0:Ne.id)}catch(g){w(g.message,"danger")}},A=async c=>{const g=c.subfolderCount>0?`X\xF3a folder "${c.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${c.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(g))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${c.id}`,"L\u1ED7i x\xF3a folder"),w("\u0110\xE3 x\xF3a folder","success"),X(null),fe(Ne==null?void 0:Ne.id)}catch(he){w("L\u1ED7i x\xF3a folder","danger")}},$=c=>{c.subfolderCount>0?(Se(g=>[...g,c]),be(c),fe(c.id)):(X(c),N(c.videos||[]))},H=c=>{if(c==="root")Se([]),be(null),fe(null);else if(c){const g=Te.findIndex(he=>he.id===c.id);g>=0&&(Se(Te.slice(0,g+1)),be(c),fe(c.id))}else{const g=[...Te];g.pop();const he=g[g.length-1]||null;Se(g),be(he),fe(he==null?void 0:he.id)}},W=()=>{se(null),le(!0)},r=c=>{se(c),le(!0)},E=async c=>{try{c.folder_id=oe==null?void 0:oe.id;const g=ce?`${API_BASE}/api/videos/${ce.id}`:`${API_BASE}/api/videos`;ce?await window.KTM.api.putJSON(g,c,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(g,c,"L\u1ED7i l\u01B0u video"),w(ce?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),le(!1),fe(),oe&&we(oe.id)}catch(g){w(g.message,"danger")}},ge=async c=>{if(confirm(`X\xF3a video "${c.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${c.id}`,"L\u1ED7i x\xF3a video"),w("\u0110\xE3 x\xF3a video","success"),fe(),oe&&we(oe.id)}catch(g){w("L\u1ED7i x\xF3a video","danger")}},Re=c=>{const g=`https://www.youtube.com/watch?v=${c.youtubeId}`;window.KTM.clipboard.writeText(g).then(()=>{w("\u0110\xE3 copy link!","success")}).catch(()=>{w("Kh\xF4ng th\u1EC3 copy link","danger")})};return oe?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>X(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${oe.slug==="shorts"?"text-danger":"text-warning"}`}),oe.name)),React.createElement("button",{className:"btn btn-warning",onClick:W},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),Y.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},Y.map((c,g)=>React.createElement("div",{key:c.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>De(g),disabled:g===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},g+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Je(g),disabled:g===Y.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:c.thumb,className:"card-img-top",alt:c.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${c.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:c.title},c.title),React.createElement("small",{className:"text-muted"},c.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Re(c),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>r(c),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>ge(c),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:pe,video:ce,onClose:()=>le(!1),onSave:E})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},Ne&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>H()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),Ne?Ne.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:M},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Te.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:c=>{c.preventDefault(),H("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Te.map((c,g)=>React.createElement("li",{key:c.id,className:`breadcrumb-item ${g===Te.length-1?"active":""}`},g===Te.length-1?c.name:React.createElement("a",{href:"#",onClick:he=>{he.preventDefault(),H(c)},className:"text-warning"},c.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),K?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):j.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},Ne?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:M},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",Ne?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},j.map((c,g)=>{var he,y,B,V;return React.createElement("div",{key:c.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:_e=>{_e.stopPropagation(),Ae(g)},disabled:g===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},g+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:_e=>{_e.stopPropagation(),et(g)},disabled:g===j.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>$(c),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${c.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},c.name),React.createElement("p",{className:"text-muted mb-0"},c.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),c.subfolderCount," folder"),c.subfolderCount>0&&(c.videoCount>0||((he=c.videos)==null?void 0:he.length)>0)&&" \u2022 ",(c.videoCount>0||((y=c.videos)==null?void 0:y.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),c.videoCount||((B=c.videos)==null?void 0:B.length)||0," videos"),c.subfolderCount===0&&!c.videoCount&&!((V=c.videos)!=null&&V.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:_e=>{_e.stopPropagation(),i(c)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:_e=>{_e.stopPropagation(),A(c)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:me,folder:re,onClose:()=>ye(!1),onSave:u}))}function VideoFolderModal({show:_,folder:w,onClose:j,onSave:Z}){const[Y,N]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[K,ne]=useState(!1),[oe,X]=useState(!1);useEffect(()=>{N(w?{name:w.name||"",description:w.description||"",sortOrder:w.sortOrder||0,coverImage:w.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[w,_]);const me=async re=>{const de=re.target.files[0];if(de){X(!0);try{const pe=await window.KTM.cloudinary.uploadImage({file:de,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});pe.secure_url&&N(le=>({...le,coverImage:pe.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(pe){console.error("Cloudinary upload error:",pe),alert("L\u1ED7i upload \u1EA3nh: "+(pe.message||pe))}finally{X(!1)}}},ye=async re=>{re.preventDefault(),ne(!0);const de={...Y,variants:normalizeVariants(Y.variants,Y.price),attributes:normalizeAttributes(Y.attributes)};await Z(de),ne(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:ye},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:Y.name,onChange:re=>N({...Y,name:re.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:Y.description,onChange:re=>N({...Y,description:re.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Y.sortOrder,onChange:re=>N({...Y,sortOrder:parseInt(re.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},Y.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:Y.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>N({...Y,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:me,disabled:oe}),oe&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:Y.coverImage,onChange:re=>N({...Y,coverImage:re.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:K},K?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:_,settings:w}){const[j,Z]=useState([]),[Y,N]=useState(!0),[K,ne]=useState(!1),[oe,X]=useState(null),[me,ye]=useState(""),[re,de]=useState(""),pe=normalizeShipPercent(w==null?void 0:w.ship_percent),{parseMoney:le,formatVND:ce}=window.KTM.money,se=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Ne()},[]);const Ne=async()=>{N(!0);try{const i=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Z(Array.isArray(i)?i:[])}catch(i){console.error(i),_("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}N(!1)},be=()=>{X(null),ne(!0)},Te=i=>{X(i),ne(!0)},Se=async i=>{if(!(!i||!i.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:i},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),_(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Ne()}catch(u){_("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},fe=async i=>{try{const u=oe?`${API_BASE}/api/products?id=${oe.id}`:`${API_BASE}/api/products`;oe?await window.KTM.api.putJSON(u,i,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(u,i,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),_(oe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),ne(!1),Ne()}catch(u){_(u.message,"danger")}},we=async i=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${i.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${i.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),_("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Ne()}catch(u){_(u.message,"danger")}},Ae=j.filter(i=>{const u=!me||i.name.toLowerCase().includes(me.toLowerCase())||i.code&&i.code.toLowerCase().includes(me.toLowerCase()),A=!re||i.category===re;return u&&A}),et=i=>{var $;const u=($=i==null?void 0:i.commission_percent)!=null?$:i==null?void 0:i.commissionPercent,A=u===""||u==null?NaN:Number(u);return Number.isFinite(A)?Math.max(0,Math.min(100,A)):5},Ce=i=>{const u=et(i),A=Number.isInteger(u)?String(u):String(Math.round(u*100)/100),$=le(i==null?void 0:i.price);if(!Number.isFinite($)||$<=0)return`${A}%`;const H=(Number(u)||0)/100,r=window.KTM.money.parseShipFeeFromNote(i==null?void 0:i.note)!=null?0:pe>0?$*pe/100:0,E=$*H-r*H,ge=Math.max(0,Math.round(E));return`${A}% - ${ce(ge)}`},De=i=>{if(i==null||i==="")return[];let u=i;if(typeof u=="string"){const A=u.trim();if(!A)return[];try{u=JSON.parse(A)}catch($){return[]}}return Array.isArray(u)?u:[]},Je=i=>{if(i==null||i==="")return[];let u=i;if(typeof u=="string"){const A=u.trim();if(!A)return[];try{u=JSON.parse(A)}catch($){return[]}}return u&&typeof u=="object"&&!Array.isArray(u)&&(u=Object.entries(u).map(([A,$])=>({key:A,value:$}))),Array.isArray(u)?u:[]},b=i=>{const u=Je(i).map(A=>{var $,H,W,r,E;return{key:String((W=(H=($=A==null?void 0:A.key)!=null?$:A==null?void 0:A.name)!=null?H:A==null?void 0:A.label)!=null?W:"").trim(),value:String((r=A==null?void 0:A.value)!=null?r:"").trim(),unit:String((E=A==null?void 0:A.unit)!=null?E:"").trim()}}).filter(A=>!!A.key);return u.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},u.map((A,$)=>{const H=A.key,W=`${A.value||""}${A.unit?(A.value?" ":"")+A.unit:""}`.trim();return React.createElement("div",{key:`${H}-${$}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},H),W?React.createElement("span",{className:"ktm-chip ktm-chip-option"},W):null)}))):null},M=(i,u={})=>{const A=De(i).map(r=>{var E;return{name:String((E=r==null?void 0:r.name)!=null?E:"").trim(),options:Array.isArray(r==null?void 0:r.options)?r.options:[]}}).map(r=>({...r,options:r.options.map(E=>{var ge;return{label:String((ge=E==null?void 0:E.label)!=null?ge:"").trim(),price:Number(E==null?void 0:E.price)}}).filter(E=>!!E.label)})).filter(r=>r.options.length>0);if(!A.length)return null;const $=Number.isFinite(u.maxGroups)?Math.max(1,Math.trunc(u.maxGroups)):A.length,H=Number.isFinite(u.maxOptionsPerGroup)?Math.max(1,Math.trunc(u.maxOptionsPerGroup)):4,W=A.slice(0,$);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},W.map((r,E)=>{const ge=r.name||"Bi\u1EBFn th\u1EC3",Re=r.options.slice(0,H),c=r.options.length-Re.length;return React.createElement("div",{key:`${ge}-${E}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ge),Re.map((g,he)=>{const y=g.price,B=Number.isFinite(y)&&y>=0?ce(Math.trunc(y)):"",V=B?`${g.label} \xB7 ${B}`:g.label;return React.createElement("span",{key:`${ge}-${E}-${he}`,className:"ktm-chip ktm-chip-option"},V)}),c>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",c))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:be},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:me,onChange:i=>ye(i.target.value)})),React.createElement("span",{className:"product-count"},Ae.length)),React.createElement("select",{className:"form-select",value:re,onChange:i=>de(i.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),se.map(i=>React.createElement("option",{key:i,value:i},i)))),Y?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):Ae.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:be},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},Ae.map(i=>React.createElement("div",{key:i.id,className:"product-item d-flex align-items-center gap-3"},i.image?React.createElement("img",{src:i.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},i.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},i.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},i.category),i.code&&React.createElement("span",{className:"product-badge bg-secondary"},i.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),Ce(i))),React.createElement("div",{className:"product-price"},i.price?i.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),i.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},i.note),b(i.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},b(i.attributes)),M(i.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},M(i.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>Te(i),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>we(i),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:K,product:oe,categories:se,onClose:()=>ne(!1),onSave:fe}))}function ProductModal({show:_,product:w,categories:j,onClose:Z,onSave:Y}){const[N,K]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[ne,oe]=useState(!1),[X,me]=useState(!1),ye=b=>{const M=window.KTM.money.getDigits(String(b!=null?b:"")),i=Number(M);return M&&Number.isFinite(i)?Math.trunc(i):0},re=b=>{if(b==null||b==="")return[];let M=b;if(typeof M=="string"){const i=M.trim();if(!i)return[];try{M=JSON.parse(i)}catch(u){return[]}}return M&&typeof M=="object"&&!Array.isArray(M)&&(M=Object.entries(M).map(([i,u])=>({key:i,value:u}))),Array.isArray(M)?M.map(i=>{var H,W,r,E,ge;if(!i||typeof i!="object")return null;const u=String((r=(W=(H=i.key)!=null?H:i.name)!=null?W:i.label)!=null?r:"").trim(),A=String((E=i.value)!=null?E:"").trim(),$=String((ge=i.unit)!=null?ge:"").trim();return u?{key:u,value:A,unit:$}:null}).filter(Boolean):[]},de=(b,M)=>{if(b==null||b==="")return[];let i=b;if(typeof i=="string"){const A=i.trim();if(!A)return[];try{i=JSON.parse(A)}catch($){return[]}}if(!Array.isArray(i))return[];const u=ye(M);return i.map(A=>{var W;if(!A||typeof A!="object")return null;const $=String((W=A.name)!=null?W:"").trim(),H=(Array.isArray(A.options)?A.options:[]).map(r=>{var he,y,B,V,_e,Xe,Oe;if(!r||typeof r!="object")return null;const E=String((he=r.label)!=null?he:"").trim();if(!E)return null;const ge=(_e=(V=(B=(y=r.price)!=null?y:r.priceValue)!=null?B:r.unit_price)!=null?V:r.unitPrice)!=null?_e:null,Re=Number(ge);let c=Number.isFinite(Re)?Math.trunc(Re):null;if(c==null){const Pe=(Oe=(Xe=r.price_delta)!=null?Xe:r.priceDelta)!=null?Oe:null,Be=Number(Pe);Number.isFinite(Be)&&(c=u+Math.trunc(Be))}c==null&&(c=u);const g=String(Math.max(0,Math.trunc(Number(c)||0)));return{label:E,price:Math.max(0,Math.trunc(Number(c)||0)),priceDigits:g}}).filter(Boolean);return{name:$||"Bi\u1EBFn th\u1EC3",options:H}}).filter(Boolean)};useEffect(()=>{var b,M;K(w?{name:w.name||"",code:w.code||"",price:w.price||"",image:w.image||"",category:w.category||"",note:w.note||"",sort_order:w.sort_order||0,commission_percent:(M=(b=w.commission_percent)!=null?b:w.commissionPercent)!=null?M:5,variants:de(w.variants,w.price),attributes:re(w.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[w,_]);const pe=b=>{K(M=>{var H;const i=ye(M.price),u=String(i),A=Array.isArray(M.variants)?[...M.variants]:[],$={...A[b]||{},options:Array.isArray((H=A[b])==null?void 0:H.options)?[...A[b].options]:[]};return $.options=$.options.map(W=>({label:String((W==null?void 0:W.label)||""),price:i,priceDigits:u})),A[b]=$,{...M,variants:A}})},le=()=>{K(b=>{const M=ye(b.price),i=String(M),A=(Array.isArray(b.variants)?[...b.variants]:[]).map($=>{const H=(Array.isArray($==null?void 0:$.options)?$.options:[]).map(W=>({label:String((W==null?void 0:W.label)||""),price:M,priceDigits:i}));return{name:String(($==null?void 0:$.name)||"Bi\u1EBFn th\u1EC3"),options:H}});return{...b,variants:A}})},[ce,se]=React.useState(""),Ne=b=>window.KTM.money.formatVNDInputDigits(b),[be,Te]=React.useState(""),Se=b=>{const M=window.KTM.money.nextPriceInputState(b.target.value,be);Te(M.digits),K({...N,price:M.price})},[fe,we]=React.useState("");React.useEffect(()=>{w!=null&&w.image&&we(w.image)},[w]);const Ae=async b=>{if(!(!b||!b.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:b},"L\u1ED7i x\xF3a \u1EA3nh")}catch(M){console.error("Delete cloudinary image error:",M)}},et=async(b,M=2,i)=>{const u=M*1024*1024,A=b.type==="image/heic"||b.type==="image/heif"||/\.heic$/i.test(b.name);if(b.size<=u&&!A)return b;i==null||i("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const $=await createImageBitmap(b);i==null||i("\u0110ang n\xE9n \u1EA3nh...");const H=document.createElement("canvas");let W=$.width,r=$.height;const E=1200;return(W>E||r>E)&&(W>r?(r=Math.round(r/W*E),W=E):(W=Math.round(W/r*E),r=E)),H.width=W,H.height=r,H.getContext("2d").drawImage($,0,0,W,r),$.close(),new Promise((Re,c)=>{H.toBlob(g=>{g?(i==null||i("Ho\xE0n t\u1EA5t!"),Re(new File([g],b.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):c(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch($){throw console.error("createImageBitmap error:",$),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ce=async b=>{var u,A;const M=(u=b.target.files)==null?void 0:u[0];if(!M)return;if(!(M.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(M.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}me(!0),se("\u0110ang chu\u1EA9n b\u1ECB...");try{const $=(M.size/1024/1024).toFixed(1);se(`File ${$}MB - \u0110ang n\xE9n...`);const H=await et(M,2,E=>{se(E)}),W=(H.size/1024/1024).toFixed(1);se(`\u0110\xE3 n\xE9n: ${W}MB - \u0110ang upload...`);const r=await window.KTM.cloudinary.uploadImage({file:H,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});r.secure_url?(N.image&&N.image!==fe&&Ae(N.image),K(E=>({...E,image:r.secure_url})),se("")):(console.error("Cloudinary error:",r),alert("Upload th\u1EA5t b\u1EA1i: "+(((A=r.error)==null?void 0:A.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),se(""))}catch($){console.error("Upload error:",$),alert("L\u1ED7i: "+$.message),se("")}me(!1),b.target.value=""},De=()=>{N.image&&(N.image!==fe&&Ae(N.image),K(b=>({...b,image:""})))},Je=async b=>{b.preventDefault(),oe(!0),fe&&N.image&&fe!==N.image&&await Ae(fe),fe&&!N.image&&await Ae(fe),await Y(N),oe(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${w?"fa-edit":"fa-plus-circle"} me-2`}),w?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:Z})),React.createElement("form",{onSubmit:Je},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},N.image?React.createElement(React.Fragment,null,React.createElement("img",{src:N.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:De,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${X?"fa-spinner fa-spin":"fa-camera"} me-1`}),X?ce||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Ce,disabled:X,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),X&&ce&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},ce))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:N.name,onChange:b=>K({...N,name:b.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:N.code,onChange:b=>K({...N,code:b.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:N.price,onChange:Se,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:N.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:b=>K({...N,commission_percent:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:N.category,onChange:b=>K({...N,category:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),j.map(b=>React.createElement("option",{key:b,value:b},b)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:N.note,onChange:b=>K({...N,note:b.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(N.attributes)?N.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(N.attributes)?N.attributes:[]).map((b,M)=>React.createElement("div",{key:M,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.key)||"",onChange:i=>{const u=i.target.value;K(A=>{const $=Array.isArray(A.attributes)?[...A.attributes]:[];return $[M]={...$[M]||{},key:u},{...A,attributes:$}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.value)||"",onChange:i=>{const u=i.target.value;K(A=>{const $=Array.isArray(A.attributes)?[...A.attributes]:[];return $[M]={...$[M]||{},value:u},{...A,attributes:$}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.unit)||"",onChange:i=>{const u=i.target.value;K(A=>{const $=Array.isArray(A.attributes)?[...A.attributes]:[];return $[M]={...$[M]||{},unit:u},{...A,attributes:$}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{K(i=>{const u=Array.isArray(i.attributes)?[...i.attributes]:[];return u.splice(M,1),{...i,attributes:u}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{K(b=>{const M=Array.isArray(b.attributes)?[...b.attributes]:[];return M.push({key:"",value:"",unit:""}),{...b,attributes:M}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(N.variants)?N.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(N.variants)?N.variants:[]).map((b,M)=>React.createElement("div",{key:M,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(b==null?void 0:b.name)||"",onChange:i=>{const u=i.target.value;K(A=>{var H;const $=Array.isArray(A.variants)?[...A.variants]:[];return $[M]={...$[M]||{},name:u,options:Array.isArray((H=$[M])==null?void 0:H.options)?$[M].options:[]},{...A,variants:$}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>pe(M),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(b==null?void 0:b.options)||b.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{K(i=>{const u=Array.isArray(i.variants)?[...i.variants]:[];return u.splice(M,1),{...i,variants:u}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(b==null?void 0:b.options)?b.options:[]).map((i,u)=>{var A,$;return React.createElement("div",{key:u,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(i==null?void 0:i.label)||"",onChange:H=>{const W=H.target.value;K(r=>{var g,he,y,B,V;const E=Array.isArray(r.variants)?[...r.variants]:[],ge={...E[M]||{},options:Array.isArray((g=E[M])==null?void 0:g.options)?[...E[M].options]:[]},Re=Number((y=(he=ge.options[u])==null?void 0:he.price)!=null?y:0)||0,c=String((V=(B=ge.options[u])==null?void 0:B.priceDigits)!=null?V:Math.max(0,Math.trunc(Re)));return ge.options[u]={...ge.options[u]||{},label:W,price:Math.max(0,Math.trunc(Re)),priceDigits:c},E[M]=ge,{...r,variants:E}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Ne(String(($=i==null?void 0:i.priceDigits)!=null?$:window.KTM.money.getDigits(String((A=i==null?void 0:i.price)!=null?A:"")))),onChange:H=>{K(W=>{var y,B,V,_e,Xe;const r=String((B=i==null?void 0:i.priceDigits)!=null?B:window.KTM.money.getDigits(String((y=i==null?void 0:i.price)!=null?y:""))),E=window.KTM.money.nextPriceInputState(H.target.value,r),ge=String((V=E.digits)!=null?V:""),Re=Number(ge),c=Number.isFinite(Re)?Math.max(0,Math.trunc(Re)):0,g=Array.isArray(W.variants)?[...W.variants]:[],he={...g[M]||{},options:Array.isArray((_e=g[M])==null?void 0:_e.options)?[...g[M].options]:[]};return he.options[u]={...he.options[u]||{},label:String(((Xe=he.options[u])==null?void 0:Xe.label)||""),price:c,priceDigits:ge},g[M]=he,{...W,variants:g}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{K(H=>{var E;const W=Array.isArray(H.variants)?[...H.variants]:[],r={...W[M]||{},options:Array.isArray((E=W[M])==null?void 0:E.options)?[...W[M].options]:[]};return r.options.splice(u,1),W[M]=r,{...H,variants:W}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{K(i=>{var H;const u=Array.isArray(i.variants)?[...i.variants]:[],A={...u[M]||{},options:Array.isArray((H=u[M])==null?void 0:H.options)?[...u[M].options]:[]},$=ye(i.price);return A.options.push({label:"",price:$,priceDigits:String($)}),u[M]=A,{...i,variants:u}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{K(b=>{const M=ye(b.price),i=Array.isArray(b.variants)?[...b.variants]:[],u=String(M);return i.push({name:"Size",options:[{label:"S",price:M,priceDigits:u},{label:"M",price:M,priceDigits:u},{label:"L",price:M,priceDigits:u}]}),{...b,variants:i}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:le,disabled:!Array.isArray(N.variants)||N.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:N.image,onChange:b=>K({...N,image:b.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:Z,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:ne,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},ne?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:_,video:w,onClose:j,onSave:Z}){const[Y,N]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[K,ne]=useState(!1),[oe,X]=useState("");useEffect(()=>{w?(N({title:w.title||"",youtube_url:`https://www.youtube.com/watch?v=${w.youtubeId}`,thumbnail_url:w.thumb||"",sort_order:w.sortOrder||0}),X(w.thumb)):(N({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),X(""))},[w,_]);const me=de=>{const pe=de.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return pe?pe[1]:null},ye=de=>{N({...Y,youtube_url:de});const pe=me(de);pe&&X(`https://img.youtube.com/vi/${pe}/hqdefault.jpg`)},re=async de=>{de.preventDefault(),ne(!0),await Z(Y),ne(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},w?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:re},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:Y.youtube_url,onChange:de=>ye(de.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),oe&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:oe,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:Y.title,onChange:de=>N({...Y,title:de.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:Y.sort_order,onChange:de=>N({...Y,sort_order:parseInt(de.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:Y.thumbnail_url,onChange:de=>N({...Y,thumbnail_url:de.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:K},K?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[_,w]=useState(!1),[j,Z]=useState(""),[Y,N]=useState(null),[K,ne]=useState("search"),[oe,X]=useState(null),[me,ye]=useState(""),[re,de]=useState([]),[pe,le]=useState(null),[ce,se]=useState(!1),[Ne,be]=useState(null),[Te,Se]=useState(!0),[fe,we]=useState([]),[Ae,et]=useState(()=>loadAdminSettings()),[Ce,De]=useState(null),[Je,b]=useState([]);useEffect(()=>{const y=localStorage.getItem("ktm_admin_session");if(y)try{const B=JSON.parse(y);B.expiry>Date.now()?(w(!0),N(B.user)):localStorage.removeItem("ktm_admin_session")}catch(B){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{_&&$()},[_]),useEffect(()=>{if(!_)return;let y=!1;return(async()=>{try{const B=await fetchAdminSettingsFromServer();if(y)return;et(B),saveAdminSettings(B)}catch(B){}})(),()=>{y=!0}},[_]);const M=async(y,B)=>{Z("");try{const V=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:y,password:B},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),_e={user:V.user,token:V.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(_e)),N(V.user),w(!0)}catch(V){Z(V.message)}},i=()=>{localStorage.removeItem("ktm_admin_session"),w(!1),N(null),de([]),le(null)},u=(y,B="success")=>{const V=Date.now();we(_e=>[..._e,{id:V,message:y,type:B}])},A=y=>{we(B=>B.filter(V=>V.id!==y))},$=async(y=null)=>{Se(!0);try{const B=y?`${API_BASE}/api/albums?parent_id=${y}`:`${API_BASE}/api/albums?parent_id=root`,V=await window.KTM.api.getJSON(B,"L\u1ED7i t\u1EA3i danh s\xE1ch album");de(Array.isArray(V)?V:[])}catch(B){console.error(B),u("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}Se(!1)},H=()=>{be(null),se(!0)},W=y=>{be(y),se(!0)},r=async y=>{try{const B=Ne&&Ne.uuid;!B&&Ce&&(y.parent_id=Ce.uuid);const V=B?`${API_BASE}/api/albums/${Ne.uuid||Ne.id}`:`${API_BASE}/api/albums`;B?await window.KTM.api.putJSON(V,y,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(V,y,"L\u1ED7i t\u1EA1o"),u(B?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),se(!1),$(Ce==null?void 0:Ce.uuid)}catch(B){u(B.message,"danger")}},E=y=>{le(y)},ge=y=>{if(y==="root")b([]),De(null),$(null);else if(y){const B=Je.findIndex(V=>V.uuid===y.uuid);B>=0&&(b(Je.slice(0,B+1)),De(y),$(y.uuid))}else{const B=[...Je];B.pop();const V=B[B.length-1]||null;b(B),De(V),$(V==null?void 0:V.uuid)}},Re=async y=>{const B=`X\xF3a folder "${y.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(B))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${y.uuid||y.id}`,"L\u1ED7i x\xF3a album"),u("\u0110\xE3 x\xF3a","success"),$(Ce==null?void 0:Ce.uuid)}catch(V){u("L\u1ED7i x\xF3a album","danger")}};if(!_)return React.createElement(LoginPage,{onLogin:M,error:j});const c=()=>{const y=new Date,B=y.getFullYear(),V=String(y.getMonth()+1).padStart(2,"0");return`${B}-${V}`};function g(){const[y,B]=useState(()=>{var Oe;return String((Oe=Ae==null?void 0:Ae.ship_percent)!=null?Oe:DEFAULT_SHIP_PERCENT)}),[V,_e]=useState(!1);return useEffect(()=>{var Oe;B(String((Oe=Ae==null?void 0:Ae.ship_percent)!=null?Oe:DEFAULT_SHIP_PERCENT))},[Ae==null?void 0:Ae.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Oe=>{Oe.preventDefault(),_e(!0);const Pe=saveAdminSettings({ship_percent:y});try{const Be=await saveAdminSettingsToServer(Pe);et(Be),saveAdminSettings(Be),u("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Be){et(Pe),u("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{_e(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:y,min:"0",max:"100",step:"0.01",onChange:Oe=>B(Oe.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:V},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function he(){const[y,B]=useState(c()),[V,_e]=useState(!0),[Xe,Oe]=useState([]),[Pe,Be]=useState([]),dt=useRef(!1),Mt=useRef(new Map),Nt=normalizeShipPercent(Ae==null?void 0:Ae.ship_percent),{parseMoney:Pt,parseShipFeeFromNote:Kt,getShipFeeForItems:It,formatNumber:ve,formatVND:Qe}=window.KTM.money,ot=async()=>{if(!dt.current)try{const C=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m");Be(Array.isArray(C)?C:[]),dt.current=!0}catch(C){console.error("Load products for stats error:",C),Be([]),dt.current=!0}},St=async C=>{var at,nt;const Fe=String(C||"").trim();if(!Fe)return[];const Ve=(at=Mt.current)==null?void 0:at.get(Fe);if(Ve&&Array.isArray(Ve))return Ve;const Ue=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(Fe)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),tt=Array.isArray(Ue)?Ue:[];return(nt=Mt.current)==null||nt.set(Fe,tt),tt},h=async()=>{_e(!0);try{await ot();const C=await St(y);Oe(Array.isArray(C)?C:[])}catch(C){console.error("Load stats error:",C),Oe([])}finally{_e(!1)}};useEffect(()=>{h()},[y]);const I=React.useMemo(()=>{var ee;const C={draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};let Fe=0,Ve=0,Ue=0,tt=0,at=0,nt=0,Ct=0,_t=0;const ft=x=>x.customer_id||x.phone||"unknown",ze=x=>window.KTM.orders.getOrderItems(x),Vt=new Map,wt=new Map,je=new Map,$t=5,gt=new Map((Array.isArray(Pe)?Pe:[]).map(x=>{var Ke;const z=(Ke=x==null?void 0:x.commission_percent)!=null?Ke:x==null?void 0:x.commissionPercent,Le=Number(z),$e=Number.isFinite(Le)?Math.max(0,Math.min(100,Le)):$t;return[String(x==null?void 0:x.id),$e]})),t=x=>{const z=String(x!=null?x:"").trim().toLowerCase();return z==="cancelled"?"canceled":z};for(const x of Xe){const z=t(x==null?void 0:x.status),Ke=z==="canceled"||z==="draft",it=ze(x);let Ye=0,We=0,lt=0;for(const k of it){const R=Number((k==null?void 0:k.quantity)||0)||0,G=Pt(k==null?void 0:k.product_price),te=R*G,U=String((k==null?void 0:k.product_id)||""),xe=gt.has(U)?gt.get(U):$t,ke=(Number(xe)||0)/100;if(Ye+=R,We+=te,lt+=te*ke,!Ke){const qe=(k==null?void 0:k.product_id)||"unknown",Me=Vt.get(U)||{product_id:qe,product_name:(k==null?void 0:k.product_name)||"\u2014",product_code:(k==null?void 0:k.product_code)||"",orders:0,quantity:0,revenue:0};Me.orders+=1,Me.quantity+=R,Me.revenue+=te,Vt.set(qe,Me)}}const Lt=It(it),Tt=Number((ee=x==null?void 0:x.adjustment_amount)!=null?ee:0)||0,ut=We+(Lt.found?Lt.fee:0)+Tt,Dt=We+Tt,zt=!Lt.found&&Nt>0&&We>0?We*Nt/100:0,qt=We>0?lt/We:$t/100,ct=lt+Tt*qt-zt*qt,D=z==="done"||z==="paid";if(z==="draft"?C.draft+=1:z==="pending"?C.pending+=1:z==="processing"?C.processing+=1:z==="canceled"?C.canceled+=1:z==="paid"?(C.paid+=1,C.done+=1,tt+=ut,nt+=Dt,_t+=ct):z==="done"?(C.done+=1,tt+=ut,nt+=Dt,_t+=ct):C.other+=1,!Ke){Fe+=1,Ve+=Ye,Ue+=ut,at+=Dt,Ct+=ct;const k=ft(x),R=wt.get(k)||{key:k,customer_name:x.customer_name||"",phone:x.phone||"",orders:0,quantity:0,revenue:0};R.orders+=1,R.quantity+=Ye,R.revenue+=ut,!R.customer_name&&x.customer_name&&(R.customer_name=x.customer_name),!R.phone&&x.phone&&(R.phone=x.phone),wt.set(k,R);const G=x.created_at?new Date(x.created_at):null;if(G&&!Number.isNaN(G.getTime())){const te=`${G.getFullYear()}-${String(G.getMonth()+1).padStart(2,"0")}-${String(G.getDate()).padStart(2,"0")}`,U=je.get(te)||{day:te,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};U.orders+=1,U.quantity+=Ye,U.revenue+=ut,D&&(U.doneOrders+=1,U.doneRevenue+=ut),je.set(te,U)}}}const v=Array.from(Vt.values()).sort((x,z)=>z.revenue-x.revenue),O=Array.from(wt.values()).sort((x,z)=>z.revenue-x.revenue),J=Array.from(je.values()).sort((x,z)=>x.day.localeCompare(z.day)),Q=wt.size,T=Fe?Math.round(Ue/Fe):0,d=Fe?Ve/Fe:0,q=Math.round(_t),ae=Math.round(Ct);return{statusCounts:C,activeOrders:Fe,totalQty:Ve,totalRevenue:Ue,doneRevenue:tt,tempCommission:q,tempCommissionAll:ae,products:v,customers:O,days:J,uniqueCustomers:Q,avgOrderValue:T,avgQtyPerOrder:d}},[Xe,Pe,y]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:V}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:h,disabled:V},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:y,onChange:C=>B(C.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",Nt,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),ve(I.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),ve(I.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),ve(I.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",ve(I.statusCounts.paid),"/",ve(I.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ve(I.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Qe(I.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Qe(I.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Qe(I.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Qe(I.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",I.avgQtyPerOrder?I.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},ve(I.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},ve(I.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,ve(I.statusCounts.draft)),React.createElement("td",null,ve(I.statusCounts.pending)),React.createElement("td",null,ve(I.statusCounts.processing)),React.createElement("td",null,ve(I.statusCounts.canceled)),React.createElement("td",null,ve(I.statusCounts.done)),React.createElement("td",null,ve(I.statusCounts.paid)),React.createElement("td",null,ve(I.statusCounts.other)),React.createElement("td",null,ve(I.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},I.products.slice(0,10).map(C=>React.createElement("div",{key:C.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.product_name),React.createElement("div",{className:"text-muted small text-truncate"},C.product_code?`#${C.product_code} \u2022 `:"",ve(C.orders)," \u0111\u01A1n \u2022 ",ve(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Qe(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,I.products.slice(0,10).map(C=>React.createElement("tr",{key:C.product_id},React.createElement("td",null,C.product_name),React.createElement("td",null,C.product_code||"\u2014"),React.createElement("td",null,ve(C.orders)),React.createElement("td",null,ve(C.quantity)),React.createElement("td",{className:"fw-semibold"},Qe(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},I.customers.slice(0,10).map(C=>React.createElement("div",{key:C.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},C.phone||"\u2014"," \u2022 ",ve(C.orders)," \u0111\u01A1n \u2022 ",ve(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},Qe(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,I.customers.slice(0,10).map(C=>React.createElement("tr",{key:C.key},React.createElement("td",null,C.customer_name||"\u2014"),React.createElement("td",null,C.phone||"\u2014"),React.createElement("td",null,ve(C.orders)),React.createElement("td",null,ve(C.quantity)),React.createElement("td",{className:"fw-semibold"},Qe(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},I.days.map(C=>React.createElement("div",{key:C.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},C.day),React.createElement("div",{className:"text-muted small"},ve(C.orders)," \u0111\u01A1n \u2022 ",ve(C.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",ve(C.doneOrders)," \u2022 ",Qe(C.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},Qe(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,I.days.map(C=>React.createElement("tr",{key:C.day},React.createElement("td",null,C.day),React.createElement("td",null,ve(C.orders)),React.createElement("td",null,ve(C.quantity)),React.createElement("td",{className:"fw-semibold"},Qe(C.revenue)),React.createElement("td",null,ve(C.doneOrders)),React.createElement("td",{className:"fw-semibold"},Qe(C.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:K,onMenuChange:y=>{ne(y),y==="albums"&&(De(null),b([]),$(null))},onLogout:i,currentUser:Y}),React.createElement("div",{className:"main-content"},K==="albums"&&!pe&&React.createElement(AlbumList,{albums:re,loading:Te,currentFolder:Ce,breadcrumb:Je,onSelect:E,onCreate:H,onEdit:W,onDelete:Re,onBack:ge}),K==="search"&&React.createElement(SearchCenter,{showToast:u,onNavigate:(y,B,V)=>{ne(y),y==="orders"&&B==="create"&&(X(Date.now()),ye((V==null?void 0:V.productId)||""))}}),K==="albums"&&pe&&React.createElement(AlbumDetail,{album:pe,parentAlbum:Je.length>0?Je[Je.length-1]:null,onBack:()=>{if(pe.parentId){const y=Je.findIndex(B=>B.uuid===pe.parentId);y>=0?le(Je[y]):le(null)}else le(null)},onRefresh:()=>$(Ce==null?void 0:Ce.uuid),showToast:u,onNavigateToFolder:y=>{b(B=>[...B,pe]),le(y)},onEditSubfolder:y=>{be(y),se(!0)}}),K==="videos"&&React.createElement(VideoList,{showToast:u}),K==="products"&&React.createElement(ProductManager,{showToast:u,settings:Ae}),K==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:oe,autoOpenCreateProductId:me,showToast:u}),K==="stats"&&React.createElement(he,null),K==="settings"&&React.createElement(g,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${K==="search"?"active":""}`,onClick:y=>{y.preventDefault(),ne("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${K==="albums"?"active":""}`,onClick:y=>{y.preventDefault(),ne("albums"),le(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${K==="videos"?"active":""}`,onClick:y=>{y.preventDefault(),ne("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${K==="products"?"active":""}`,onClick:y=>{y.preventDefault(),ne("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${K==="orders"?"active":""}`,onClick:y=>{y.preventDefault(),ne("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${K==="stats"?"active":""}`,onClick:y=>{y.preventDefault(),ne("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:ce,album:Ne,parentId:Ce==null?void 0:Ce.uuid,onClose:()=>se(!1),onSave:r}),React.createElement("div",{className:"toast-container"},fe.map(y=>React.createElement(Toast,{key:y.id,message:y.message,type:y.type,onClose:()=>A(y.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:_,autoOpenCreateProductId:w,showToast:j}){const[Z,Y]=useState([]),[N,K]=useState([]),[ne,oe]=useState(!0),[X,me]=useState(!1),[ye,re]=useState([]),[de,pe]=useState(!1),[le,ce]=useState(!1),[se,Ne]=useState(null),[be,Te]=useState(null),[Se,fe]=useState(!1),[we,Ae]=useState(()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${n}-${a}`}),[et,Ce]=useState(""),[De,Je]=useState(!1),[b,M]=useState(!1),[i,u]=useState(null),[A,$]=useState(!1),[H,W]=useState([]),[r,E]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[ge,Re]=useState([""]),[c,g]=useState(null),he=useRef({}),[y,B]=useState([]),[V,_e]=useState(null),Xe=useRef(null),Oe=useRef(null),Pe=useRef(0),Be=useRef(new Map),dt=useRef(""),Mt=useRef(null),Nt=useRef(0),Pt=useRef(null),Kt=9,It=150,ve=24*60*60*1e3,Qe=5*60*1e3,ot="ktm_customer_lookup_cache_v1",St=200,h=3,I=3,C=1,Fe=24*60*60*1e3,Ve=e=>{try{const n=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(n))return 0;const a=Date.now()-n;return!Number.isFinite(a)||a<=0?0:Math.floor(a/Fe)}catch(n){return 0}},Ue=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:Ve(e)>=h,tt=e=>{const n=String(e!=null?e:"").trim().toLowerCase();return n==="cancelled"?"canceled":n},at=e=>{if(tt(e==null?void 0:e.status)!=="draft")return null;const a=I-Ve(e);return Number.isFinite(a)?a:null},nt=e=>{const n=at(e);return Number.isFinite(n)?n>0&&n<=C:!1},Ct=e=>{E({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Re([""]),u(null),g(null)};useEffect(()=>{const e=n=>{var s;if(c==null)return;const a=(s=he.current)==null?void 0:s[c];a&&!a.contains(n.target)&&g(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[c]);const _t=e=>window.KTM.money.parseMoney(e),ft=e=>window.KTM.money.parseSignedMoney(e),ze=e=>window.KTM.money.formatVND(e),Vt=e=>window.KTM.money.parseShipFeeFromNote(e),wt=e=>window.KTM.phone.isValid(e),je=e=>window.KTM.phone.normalize(e),$t=()=>{var e;try{const n=localStorage.getItem(ot);if(!n)return;const a=JSON.parse(n);if(!a||typeof a!="object")return;const s=Object.entries(a);for(const[l,f]of s)!l||!f||typeof f!="object"||(e=Be.current)==null||e.set(String(l),f)}catch(n){}},gt=()=>{try{const e=Be.current;if(!e||typeof e.entries!="function")return;const n=Array.from(e.entries()).filter(([s,l])=>s&&l&&typeof l=="object"&&Number.isFinite(l.ts)).sort((s,l)=>(Number(l[1].ts)||0)-(Number(s[1].ts)||0)).slice(0,St),a={};for(const[s,l]of n)a[s]=l;localStorage.setItem(ot,JSON.stringify(a))}catch(e){}};useEffect(()=>{$t()},[]);const t=e=>{const n=je(e);if(!n)return null;const a=Array.isArray(Z)?Z:[];let s=null,l=-1;for(const f of a){if(!f||je(f.phone||"")!==n)continue;const L=new Date(f.created_at).getTime(),S=Number.isFinite(L)?L:0;S>=l&&(l=S,s=f)}return s?{name:String(s.customer_name||"").trim(),address:String(s.address||"").trim()}:null},v=(e,n)=>{e&&E(a=>n&&je(a.phone)!==n?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},O=e=>{const n=t(e);if(!n)return;const a=je(e);E(s=>{if(a&&je(s.phone)!==a)return s;const l={...s};return!String(s.customer_name||"").trim()&&n.name&&(l.customer_name=n.name),!String(s.address||"").trim()&&n.address&&(l.address=n.address),l})},J=(e,n,a)=>{var s;try{const l=je(e);if(!l)return;const f=String(n||"").trim(),L=String(a||"").trim();if(!f&&!L)return;(s=Be.current)==null||s.set(l,{ts:Date.now(),status:"found",customer:{phone:l,name:f||null,address:L||null}}),gt()}catch(l){}},Q=async e=>{var l,f,L;const n=je(e);if(!n)return;O(n);const a=(l=Be.current)==null?void 0:l.get(n);if(a&&Number.isFinite(a.ts)){const S=Date.now()-a.ts,m=a.status==="found"?ve:Qe;if(S>=0&&S<=m){u({status:a.status,phone:n,customer:a.customer}),a.status==="found"&&a.customer&&v(a.customer,n);return}}const s=++Pe.current;u({status:"loading",phone:n});try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(n)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Pe.current!==s)return;if(S&&S.exists&&S.customer){(f=Be.current)==null||f.set(n,{ts:Date.now(),status:"found",customer:S.customer}),gt(),u({status:"found",phone:n,customer:S.customer}),v(S.customer,n);return}(L=Be.current)==null||L.set(n,{ts:Date.now(),status:"not-found",customer:null}),gt(),u({status:"not-found",phone:n})}catch(S){if(Pe.current!==s)return;console.error("Customer lookup error:",S),u({status:"error",phone:n})}},T=e=>{const n=je(e),a=t(n);E(l=>{const f={...l,phone:n};return a&&(!String(l.customer_name||"").trim()&&a.name&&(f.customer_name=a.name),!String(l.address||"").trim()&&a.address&&(f.address=a.address)),f}),$(!1),Oe.current&&(clearTimeout(Oe.current),Oe.current=null);const s=n;if(s.length<Kt){u(null);return}if(wt(s)&&s!==dt.current){dt.current=s,Q(s);return}Oe.current=setTimeout(()=>{const l=je(n);wt(l)&&l!==dt.current&&(dt.current=l,Q(l))},It)},d=()=>{const e=je(r.phone);e.length<Kt||wt(e)&&e!==dt.current&&(dt.current=e,Q(e))};useEffect(()=>(b?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[b]);const q=Array.isArray(r.items)?r.items.length:0;useEffect(()=>{if(!b){Nt.current=q;return}q>Nt.current&&setTimeout(()=>{const e=Mt.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Nt.current=q},[b,q]),useEffect(()=>()=>{Oe.current&&(clearTimeout(Oe.current),Oe.current=null)},[]),useEffect(()=>{We()},[]),useEffect(()=>{lt()},[we]),useEffect(()=>{Lt()},[]),useEffect(()=>{_&&Xe.current!==_&&(Xe.current=_,ut(w))},[_]);const ae=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",ee=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",x=React.useMemo(()=>window.KTM.orders.sortOrders(Z),[Z]),z=React.useMemo(()=>window.KTM.orders.sortOrders(N),[N]),Le=React.useMemo(()=>{const n=(Array.isArray(z)?z:[]).filter(a=>Ue(a));return n.sort((a,s)=>{const l=new Date(a==null?void 0:a.created_at).getTime(),f=new Date(s==null?void 0:s.created_at).getTime();return(Number.isFinite(l)?l:0)-(Number.isFinite(f)?f:0)}),n},[z]),$e=React.useMemo(()=>{const n=(Array.isArray(ye)?ye:[]).filter(a=>nt(a));return n.sort((a,s)=>{const l=new Date(a==null?void 0:a.created_at).getTime(),f=new Date(s==null?void 0:s.created_at).getTime();return(Number.isFinite(l)?l:0)-(Number.isFinite(f)?f:0)}),n},[ye]),Ke=React.useMemo(()=>De?Le:x,[De,Le,x]),it=React.useMemo(()=>{if(De)return Ke;const e=String(et||"").trim();return e?(Array.isArray(Ke)?Ke:[]).filter(n=>String((n==null?void 0:n.status)||"").trim()===e):Ke},[Ke,et,De]),Ye=e=>window.KTM.date.formatDateTime(e),We=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");B(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),B([])}},lt=async()=>{oe(!0);try{let e=`${API_BASE}/api/orders`;we&&(e+=`?month=${we}`);const n=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");Y(Array.isArray(n)?n:[]),Lt()}catch(e){console.error("Load orders error:",e),Y([])}finally{oe(!1)}},Lt=async()=>{me(!0),pe(!0);try{const[e,n]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(h)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(C)}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);K(Array.isArray(e)?e:[]),re(Array.isArray(n)?n:[])}catch(e){console.error("Load all orders error:",e),K([]),re([])}finally{me(!1),pe(!1)}},Tt=e=>{var a;_e(e.id);const n=Array.isArray(e.items)&&e.items.length?e.items.map(s=>{var l,f,L,S;return{product_id:(s==null?void 0:s.product_id)||"",quantity:Number((l=s==null?void 0:s.quantity)!=null?l:1)||1,unit_price:(()=>{var p;const m=(p=s==null?void 0:s.unit_price)!=null?p:s==null?void 0:s.unitPrice,o=m==null||m===""?NaN:Number(m);return Number.isFinite(o)?Math.trunc(o):null})(),variant:String((f=s==null?void 0:s.variant)!=null?f:"").trim(),variant_json:(S=(L=s==null?void 0:s.variant_json)!=null?L:s==null?void 0:s.variantJson)!=null?S:null}}).filter(s=>s.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1,unit_price:null,variant:"",variant_json:null}];E({customer_name:e.customer_name||"",phone:je(e.phone||""),address:e.address||"",note:(e==null?void 0:e.note)||"",items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_amount:Number((a=e==null?void 0:e.adjustment_amount)!=null?a:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),Re(new Array(n.length?n.length:1).fill("")),W(new Array(n.length?n.length:1).fill(!0)),u(null),M(!0),e.phone&&Q(je(e.phone))};function ut(e){_e(null),Ct(e||""),$(!1),W([]),M(!0)}const Dt=()=>{le||Se||(M(!1),_e(null),Ct(""),$(!1),W([]))},zt=async()=>{var S,m,o;if(!V||Se||le)return;const e=(Array.isArray(Z)?Z:[]).find(p=>String(p==null?void 0:p.id)===String(V))||null,n=String((e==null?void 0:e.status)||(r==null?void 0:r.status)||"").trim();if(n==="done"||n==="paid"||n==="canceled"){const p="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof j=="function"?j(p,"warning"):alert(p);return}const a=je(r.phone),l=(Array.isArray(r.items)?r.items:[]).map((p,P)=>{var F,ie;return{idx:P,product_id:String((p==null?void 0:p.product_id)||"").trim(),quantity:Number((F=p==null?void 0:p.quantity)!=null?F:0),variant:String((p==null?void 0:p.variant)||"").trim()||null,variant_json:(ie=p==null?void 0:p.variant_json)!=null?ie:null,unit_price:(()=>{const ue=p==null?void 0:p.unit_price,He=ue===""||ue==null?NaN:Number(ue);if(Number.isFinite(He))return Math.max(0,Math.trunc(He));const Ie=Me(p==null?void 0:p.product_id),st=p!=null&&p.variant_json&&typeof p.variant_json=="object"?p.variant_json:null;return mt(Ie,st)})()}}).filter(p=>p.product_id&&Number.isFinite(p.quantity)&&p.quantity>0);if(l.length<2){const p="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof j=="function"?j(p,"warning"):alert(p);return}const f=[],L=[];for(const p of l){const P=!!H[p.idx],F={product_id:p.product_id,quantity:p.quantity,unit_price:p.unit_price,variant:p.variant,variant_json:p.variant_json};P?f.push(F):L.push(F)}if(!f.length||!L.length){const p="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof j=="function"?j(p,"warning"):alert(p);return}fe(!0);try{const p=ft(r.adjustment_amount),P=(r.adjustment_note||"").trim(),F={customer_name:r.customer_name,phone:a,address:r.address,note:(r.note||"").trim(),adjustment_amount:p,adjustment_note:P,status:"processing",items:f,product_id:f[0].product_id,quantity:f[0].quantity,split_seq:1},ie=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,F,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),ue=(o=(m=ie==null?void 0:ie.id)!=null?m:(S=ie==null?void 0:ie.order)==null?void 0:S.id)!=null?o:null;if(!ue)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const He={id:V,customer_name:r.customer_name,phone:a,address:r.address,note:(r.note||"").trim(),adjustment_amount:0,adjustment_note:"",status:"pending",items:L,product_id:L[0].product_id,quantity:L[0].quantity,parent_order_id:String(ue),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${V}`,He,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Dt(),lt();const Ie=ue?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${ue}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof j=="function"?j(Ie,"success"):alert(Ie)}catch(p){console.error(p);const P=(p==null?void 0:p.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof j=="function"?j(P,"danger"):alert(P)}finally{fe(!1)}},qt=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const n=String(e),a=y.find(s=>String(s==null?void 0:s.id)===n);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},ct=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(n){return String(e!=null?e:"").toLowerCase()}},D=e=>{const a=ct(e).trim().split(/\s+/).filter(Boolean),s=a.join(" ");return{contentTokens:a,cleanedQuery:s}},k=React.useMemo(()=>(Array.isArray(y)?y:[]).map((e,n)=>{var o,p,P,F,ie,ue;const a=ct((o=e==null?void 0:e.name)!=null?o:""),s=ct((p=e==null?void 0:e.code)!=null?p:""),l=ct((P=e==null?void 0:e.category)!=null?P:""),f=ct((F=e==null?void 0:e.note)!=null?F:""),L=ct((ie=e==null?void 0:e.id)!=null?ie:""),S=ct((ue=e==null?void 0:e.stt)!=null?ue:""),m=`${a} ${s} ${l} ${f} ${L} ${S}`.trim();return{p:e,originalIndex:n,name:a,code:s,category:l,note:f,haystackAll:m}}),[y]),R=(e,n,a)=>{var P,F,ie,ue,He;const s=Array.isArray(n)?n:[],l=ct(a).trim();if(!s.length&&!l)return 0;const f=(P=e==null?void 0:e.name)!=null?P:"",L=(F=e==null?void 0:e.code)!=null?F:"",S=(ie=e==null?void 0:e.category)!=null?ie:"",m=(ue=e==null?void 0:e.note)!=null?ue:"";if(!((He=e==null?void 0:e.haystackAll)!=null?He:""))return 0;let p=0;l&&(f===l&&(p+=220),f.includes(l)&&(p+=140),f.startsWith(l)&&(p+=160),L&&L===l&&(p+=180),L&&L.includes(l)&&(p+=90));for(const Ie of s){if(!Ie)continue;const st=new RegExp(`(?:^|\\s)${Ie.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);f.includes(Ie)&&(p+=35),st.test(f)&&(p+=25),L&&L.includes(Ie)&&(p+=20),L&&st.test(L)&&(p+=10),S&&S.includes(Ie)&&(p+=12),m&&m.includes(Ie)&&(p+=6)}return p>0&&f&&(p+=Math.max(0,10-Math.min(10,Math.floor(f.length/10)))),p},G=(e,n)=>{const a=String(e||""),s=String(n||"");if(a===s)return 0;if(!a)return s.length;if(!s)return a.length;const l=a.length,f=s.length;if(f>l)return G(s,a);let L=new Array(f+1),S=new Array(f+1);for(let m=0;m<=f;m++)L[m]=m;for(let m=1;m<=l;m++){S[0]=m;const o=a.charCodeAt(m-1);for(let P=1;P<=f;P++){const F=o===s.charCodeAt(P-1)?0:1;S[P]=Math.min(L[P]+1,S[P-1]+1,L[P-1]+F)}const p=L;L=S,S=p}return L[f]},te=(e,n)=>{const a=String(e||"").trim(),s=String(n||"");if(!a||!s)return!1;if(s.includes(a))return!0;const l=s.split(/\s+/).filter(Boolean);if(!l.length)return!1;const f=a.length<=4?1:2;for(const L of l)if(!(Math.abs(L.length-a.length)>f)&&G(a,L)<=f)return!0;return!1},U=e=>{const n=ct(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return n?n.split(" ").filter(Boolean):[]},xe=(e,n)=>{const a=Array.isArray(n)?n:[];if(!a.length)return 0;const s=U((e==null?void 0:e.name)||""),l=U((e==null?void 0:e.code)||""),f=U((e==null?void 0:e.category)||""),L=U((e==null?void 0:e.note)||""),S=(o,p,P)=>{const F=String(o||"").trim();if(!F||!p.length)return 0;const ie=F.length<=4?1:2;let ue=1/0,He=-1;for(let Ge=0;Ge<p.length;Ge++){const bt=p[Ge];if(!bt||Math.abs(bt.length-F.length)>ie)continue;const ht=G(F,bt);if(ht<ue&&(ue=ht,He=Ge,ht===0))break}if(ue===1/0||ue>ie)return 0;let st=Math.round(P*(ue===0?1:ue===1?.65:.45));return He===0?st+=Math.round(P*.25):He===1&&(st+=Math.round(P*.12)),st};let m=0;for(const o of a){if(!o)continue;const p=S(o,s,180),P=S(o,l,120),F=S(o,f,60),ie=S(o,L,30);m+=Math.max(p,P,F,ie)}if(m>0){const o=((e==null?void 0:e.name)||"").length;m+=Math.max(0,60-Math.min(60,Math.floor(o/2)))}return m},ke=React.useRef(new Map);React.useEffect(()=>{ke.current=new Map},[y]);const qe=e=>{var o,p;const n=String(ge[e]||"").trim();if(!n)return y;const{contentTokens:a,cleanedQuery:s}=D(n);if(a.length===0)return y;const l=ct(n).trim(),f=ke.current.get(l);if(f)return f;const L=[];for(const P of k){const F=P.haystackAll;F&&a.some(ie=>F.includes(ie))&&L.push(P)}let S=L;if(S.length<8&&a.length>0){const P=[],F=new Set(S.map(ie=>{var ue,He;return String((He=(ue=ie.p)==null?void 0:ue.id)!=null?He:"")+":"+String(ie.originalIndex)}));for(const ie of k){const ue=String((p=(o=ie.p)==null?void 0:o.id)!=null?p:"")+":"+String(ie.originalIndex);if(F.has(ue))continue;const He=ie.haystackAll;He&&a.some(Ie=>te(Ie,He))&&(P.push(ie),F.add(ue))}P.length&&(S=S.concat(P))}const m=S.map(P=>({entry:P,score:R(P,a,s)})).map(P=>{if(P.score>0)return P;const F=xe(P.entry,a);return F>0?{...P,score:F}:P}).filter(P=>P.score>0).sort((P,F)=>F.score!==P.score?F.score-P.score:P.entry.originalIndex-F.entry.originalIndex).slice(0,40).map(P=>P.entry.p);return ke.current.set(l,m),m},Me=e=>{if(!e)return null;const n=String(e);return y.find(a=>String(a==null?void 0:a.id)===n)||null},Ze=e=>{if(e==null||e==="")return[];let n=e;if(typeof n=="string"){const a=n.trim();if(!a)return[];try{n=JSON.parse(a)}catch(s){return[]}}return Array.isArray(n)?n.map((a,s)=>{var L;if(!a||typeof a!="object")return null;const l=String((L=a.name)!=null?L:"").trim()||`Bi\u1EBFn th\u1EC3 ${s+1}`,f=(Array.isArray(a.options)?a.options:[]).map(S=>{var He,Ie,st,Ge,bt,ht,Ee;if(!S||typeof S!="object")return null;const m=String((He=S.label)!=null?He:"").trim();if(!m)return null;const o=(bt=(Ge=(st=(Ie=S.price)!=null?Ie:S.priceValue)!=null?st:S.unit_price)!=null?Ge:S.unitPrice)!=null?bt:null,p=o==null||o===""?NaN:typeof o=="number"?o:typeof o=="string"?_t(o):Number(o),P=Number.isFinite(p)?Math.trunc(p):null,F=(Ee=(ht=S.price_delta)!=null?ht:S.priceDelta)!=null?Ee:null,ie=Number(F),ue=Number.isFinite(ie)?Math.trunc(ie):0;return{label:m,price:P,price_delta:ue}}).filter(Boolean);return{name:l,options:f}}).filter(Boolean):[]},xt=e=>{const n=Me(e);return Ze(n==null?void 0:n.variants)},vt=e=>{if(!e||typeof e!="object")return"";const n=[];for(const[a,s]of Object.entries(e)){const l=String(a||"").trim(),f=String(s||"").trim();!l||!f||n.push(`${l}: ${f}`)}return n.join(", ")},mt=(e,n)=>{const a=_t(e==null?void 0:e.price),s=Ze(e==null?void 0:e.variants);if(!s.length||!n||typeof n!="object")return a;let l=a,f=!1;for(const L of s){const S=String((L==null?void 0:L.name)||"").trim(),m=String((n==null?void 0:n[S])||"").trim();if(!S||!m)continue;const o=(Array.isArray(L.options)?L.options:[]).find(ue=>String((ue==null?void 0:ue.label)||"").trim()===m);if(!o)continue;const p=o==null?void 0:o.price,P=p==null||p===""?NaN:Number(p);if(Number.isFinite(P)){l=Math.max(0,Math.trunc(P)),f=!0;continue}const F=o==null?void 0:o.price_delta,ie=F==null||F===""?NaN:Number(F);Number.isFinite(ie)&&(l+=Math.trunc(ie))}return l},pt=e=>window.KTM.orders.getOrderItems(e),At=e=>window.KTM.orders.getOrderTotalQty(e),yt=e=>window.KTM.orders.getOrderProductSummary(e,Me),kt=e=>window.KTM.orders.getOrderItemRows(e,Me),Ot=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Et=e=>{const n=pt(e),a=kt(e),s=Ft(n),l=Ht(n),f=l.fee,L=Ot(e),S=s+f+L,m=[];if(e!=null&&e.customer_name&&m.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&m.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&m.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&m.push(`GHI CH\xDA: ${(e.note||"").trim()}`),m.push(""),m.push("S\u1EA2N PH\u1EA8M:"),a.length)for(const o of a)m.push(`- ${o.name} (SL: ${o.qty})`);else{const o=yt(e);o&&o!=="\u2014"&&m.push(`- ${o}`)}m.push(""),m.push(`T\u1EA0M T\xCDNH: ${ze(s)}`),l.found&&f!==0&&m.push(`SHIP: ${ze(f)}`);{const o=String((e==null?void 0:e.adjustment_note)||"").trim();(L!==0||o)&&m.push(`\u0110I\u1EC0U CH\u1EC8NH: ${ze(L)}${o?` (${o})`:""}`)}return m.push(`T\u1ED4NG: ${ze(S)}`),m.filter(Boolean).join(`
`)},Jt=async e=>{try{const n=Et(e);await window.KTM.clipboard.writeText(n),typeof j=="function"?j("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(n){console.error(n),typeof j=="function"?j("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Ht=e=>window.KTM.orders.getOrderShipInfo(e,Me),Ft=e=>window.KTM.orders.getItemsSubtotal(e,Me),Wt=e=>{try{const n=e instanceof Date?e:new Date(e);if(!n||Number.isNaN(n.getTime()))return"";const a=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0");return`${a}-${s}`}catch(n){return""}},Xt=()=>we?String(we):Wt(new Date),Yt=e=>{const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=je((e==null?void 0:e.phone)||""),s=String((e==null?void 0:e.address)||"").trim().toLowerCase(),l=ft(e==null?void 0:e.adjustment_amount),L=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(S=>{var m;return{product_id:String((S==null?void 0:S.product_id)||"").trim(),quantity:Number((m=S==null?void 0:S.quantity)!=null?m:0),variant:String((S==null?void 0:S.variant)||"").trim()}}).filter(S=>S.product_id&&Number.isFinite(S.quantity)&&S.quantity>0).sort((S,m)=>S.product_id<m.product_id?-1:S.product_id>m.product_id?1:S.variant<m.variant?-1:S.variant>m.variant?1:S.quantity-m.quantity);return JSON.stringify({name:n,phone:a,address:s,items:L,adj:l})},jt=React.useMemo(()=>{const e=je((r==null?void 0:r.phone)||"");if(!e)return{count:0,orders:[],monthKey:Xt()};const n=Xt(),a=(Array.isArray(Z)?Z:[]).filter(s=>{if(!s||V&&String(s.id)===String(V)||je(s.phone||"")!==e)return!1;const l=Wt(s.created_at);return l&&l===n}).sort((s,l)=>{const f=new Date(s.created_at).getTime(),L=new Date(l.created_at).getTime();return(Number.isFinite(L)?L:0)-(Number.isFinite(f)?f:0)});return{count:a.length,orders:a,monthKey:n}},[Z,r==null?void 0:r.phone,we,V]),sa=e=>{var S;const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=je((e==null?void 0:e.phone)||""),s=String((e==null?void 0:e.address)||"").trim().toLowerCase(),l=ft((S=e==null?void 0:e.adjustment_amount)!=null?S:0),f=pt(e),L=(Array.isArray(f)?f:[]).map(m=>{var o;return{product_id:String((m==null?void 0:m.product_id)||"").trim(),quantity:Number((o=m==null?void 0:m.quantity)!=null?o:0),variant:String((m==null?void 0:m.variant)||"").trim()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0).sort((m,o)=>m.product_id<o.product_id?-1:m.product_id>o.product_id?1:m.variant<o.variant?-1:m.variant>o.variant?1:m.quantity-o.quantity);return JSON.stringify({name:n,phone:a,address:s,items:L,adj:l})},Zt=React.useMemo(()=>{if(V)return"";const e=je((r==null?void 0:r.phone)||"");if(!e)return"";const n=Xt(),a=Yt(r),s=Array.isArray(Z)?Z:[];for(const l of s){if(!l||V&&String(l.id)===String(V)||je(l.phone||"")!==e)continue;const f=Wt(l.created_at);if(!f||f!==n)continue;const L=sa(l);if(L&&L===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${n}${l!=null&&l.id?` (#${l.id})`:""}`}return""},[Z,r,we,V]),ea=e=>{var st;const n=[],a=[],s=String((e==null?void 0:e.customer_name)||"").trim(),l=je((e==null?void 0:e.phone)||""),f=String((e==null?void 0:e.address)||"").trim();s||n.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),l||n.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),l&&!wt(l)&&n.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),f||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const S=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ge=>Ge&&Ge.product_id);S.length===0&&n.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),S.some(Ge=>{var ht;const bt=Number((ht=Ge==null?void 0:Ge.quantity)!=null?ht:0);return!Number.isFinite(bt)||bt<=0})&&n.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const o=new Set;let p=!1;for(const Ge of S){const bt=String(Ge.product_id||"").trim(),ht=String((Ge==null?void 0:Ge.variant)||"").trim();if(!bt)continue;const Ee=`${bt}||${ht}`;if(o.has(Ee)){p=!0;break}o.add(Ee)}p&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const P=Ft(S),F=Ht(S),ie=F!=null&&F.found?Number((st=F==null?void 0:F.fee)!=null?st:0):0,ue=ft(e==null?void 0:e.adjustment_amount),He=String((e==null?void 0:e.adjustment_note)||"").trim();F!=null&&F.found&&(ie>=2e5||P>0&&ie>P*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ze(ie)}`),ue!==0&&!He&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Ie=Math.abs(ue);return(Ie>=5e5||P>0&&Ie>P*.5)&&ue!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ze(ue)}`),{errors:n,warnings:a,canSubmit:n.length===0}},ca=React.useMemo(()=>ea(r),[r,y]),rt=React.useMemo(()=>{var ht;const e=String((r==null?void 0:r.customer_name)||"").trim(),n=je((r==null?void 0:r.phone)||""),a=String((r==null?void 0:r.address)||"").trim(),s=Array.isArray(r==null?void 0:r.items)?r.items:[],l=new Map;for(const Ee of s){const Bt=String((Ee==null?void 0:Ee.product_id)||"").trim(),Ut=String((Ee==null?void 0:Ee.variant)||"").trim();if(!Bt)continue;const Gt=`${Bt}||${Ut}`;l.set(Gt,(l.get(Gt)||0)+1)}const f=s.map(Ee=>{var na;const Bt=String((Ee==null?void 0:Ee.product_id)||"").trim(),Ut=Number((na=Ee==null?void 0:Ee.quantity)!=null?na:0),Gt=Bt?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",ia=Number.isFinite(Ut)&&Ut>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",ra=String((Ee==null?void 0:Ee.variant)||"").trim(),oa=`${Bt}||${ra}`,la=Bt&&(l.get(oa)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Gt,qtyError:ia,dupWarn:la}}),L=s.filter(Ee=>Ee&&Ee.product_id),S=Ft(L),m=Ht(L),o=m!=null&&m.found?Number((ht=m==null?void 0:m.fee)!=null?ht:0):0,p=ft(r==null?void 0:r.adjustment_amount),P=String((r==null?void 0:r.adjustment_note)||"").trim(),F=Math.abs(p),ie=p!==0&&!P?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ue=p!==0&&(F>=5e5||S>0&&F>S*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ze(p)}`:"",He=m!=null&&m.found&&(o>=2e5||S>0&&o>S*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${ze(o)}`:"",Ie=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",st=n?wt(n)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ge=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",bt=!Ie&&!st&&f.every(Ee=>!Ee.productError&&!Ee.qtyError);return{nameError:Ie,phoneError:st,addressWarn:Ge,items:f,shipAbnormalWarn:He,adjustmentNoteWarn:ie,adjustmentAbnormalWarn:ue,canSubmit:bt}},[r,y]),ta=async e=>{var L,S,m;const n=(e==null?void 0:e.mode)||"close",a=ea(r);if(!a.canSubmit){const o=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof j=="function"?j(o,"danger"):alert(o);return}if(!V&&Zt){const o=`${Zt}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(o)){(jt==null?void 0:jt.count)>0&&$(!0),setTimeout(()=>{var F;const P=document.getElementById("order-phone-input");P&&typeof P.scrollIntoView=="function"&&(P.scrollIntoView({block:"center",behavior:"smooth"}),(F=P.focus)==null||F.call(P))},0);return}}const s=je(r.phone),f=(Array.isArray(r.items)?r.items:[]).map(o=>{var p,P;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((p=o==null?void 0:o.quantity)!=null?p:1),variant:String((o==null?void 0:o.variant)||"").trim()||null,variant_json:(P=o==null?void 0:o.variant_json)!=null?P:null,unit_price:(()=>{const F=o==null?void 0:o.unit_price,ie=F===""||F==null?NaN:Number(F);if(Number.isFinite(ie))return Math.max(0,Math.trunc(ie));const ue=Me(o==null?void 0:o.product_id),He=o!=null&&o.variant_json&&typeof o.variant_json=="object"?o.variant_json:null;return mt(ue,He)})()}}).filter(o=>o.product_id&&Number.isFinite(o.quantity)&&o.quantity>0);ce(!0);try{const o=V?`${API_BASE}/api/orders/${V}`:`${API_BASE}/api/orders`,p=f[0],P={customer_name:r.customer_name,phone:s,address:r.address,note:(r.note||"").trim(),adjustment_amount:ft(r.adjustment_amount),adjustment_note:(r.adjustment_note||"").trim(),product_id:p.product_id,quantity:p.quantity,status:r.status,items:f,...V?{id:V}:{}};if(V)await window.KTM.api.putJSON(o,P,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const F=await window.KTM.api.postJSON(o,P,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Pt.current={id:(m=(S=F==null?void 0:F.id)!=null?S:(L=F==null?void 0:F.order)==null?void 0:L.id)!=null?m:null,fingerprint:Yt(r),ts:Date.now()}}J(s,r.customer_name,r.address),n==="new"&&!V?(Ct(""),_e(null),M(!0)):(Ct(""),_e(null),M(!1)),lt()}catch(o){console.error(o),typeof j=="function"?j(o.message,"danger"):alert(o.message);return}finally{ce(!1)}},Qt=e=>window.KTM.orders.getOrderTotalMoney(e,Me),aa=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){Ne(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),lt(),Lt()}catch(n){console.error(n),typeof j=="function"?j(n.message,"danger"):alert(n.message)}finally{Ne(null)}}},Rt=async(e,n)=>{var s;const a=e==null?void 0:e.id;if(!(!a||!n)){Te(a);try{const l=pt(e),f=(Array.isArray(l)?l:[]).map(m=>{var o,p;return{product_id:(m==null?void 0:m.product_id)||"",quantity:Number((o=m==null?void 0:m.quantity)!=null?o:1),variant:String((m==null?void 0:m.variant)||"").trim()||null,variant_json:(p=m==null?void 0:m.variant_json)!=null?p:null,unit_price:(()=>{var ie;const P=(ie=m==null?void 0:m.unit_price)!=null?ie:m==null?void 0:m.unitPrice,F=Number(P);return Number.isFinite(F)?Math.max(0,Math.trunc(F)):null})()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0);if(!f.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const L=f[0],S={id:a,customer_name:(e==null?void 0:e.customer_name)||"",phone:je((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",note:((e==null?void 0:e.note)||"").trim(),adjustment_amount:Number((s=e==null?void 0:e.adjustment_amount)!=null?s:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:L.product_id,quantity:L.quantity,status:n,items:f};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${a}`,S,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),Y(m=>Array.isArray(m)?m.map(o=>(o==null?void 0:o.id)===a?{...o,status:n}:o):m),K(m=>Array.isArray(m)?m.map(o=>(o==null?void 0:o.id)===a?{...o,status:n}:o):m),typeof j=="function"&&j("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(l){console.error(l),typeof j=="function"?j(l.message,"danger"):alert(l.message)}finally{Te(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:ne&&!b||le||!!se||!!be}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:ut,disabled:le||!!se},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:we,onChange:e=>Ae(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:De}),we&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Ae("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:ne},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:et,onChange:e=>Ce(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:De},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),et&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Ce(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:ne},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:De,onChange:e=>{const n=!!e.target.checked;Je(n),n&&Ce("pending")}}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",h," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:lt,disabled:ne},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},et?`${it.length}/${Z.length} \u0111\u01A1n`:`${Z.length} \u0111\u01A1n`)),Le.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Le.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",h," ng\xE0y.",X&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Je(!0),Ce("pending")}},"Xem ngay")),$e.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,$e.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",C," ng\xE0y).",de&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Je(!1),Ce("draft"),Ae(""),lt()}},"Xem ngay")),ne?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):Z.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):it.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},it.map(e=>{var n;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((n=e==null?void 0:e.split_seq)!=null?n:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${ee(e.status)}`},ae(e.status)),Ue(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${h} ng\xE0y`},"\u26A0 Ch\u1EADm ",Ve(e),"d"),nt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${I} ng\xE0y`},"\u23F3 C\xF2n ",at(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=kt(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((s,l)=>React.createElement("div",{key:l,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},l+1,"."),s.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",s.qty,Number(s.unitPrice)>0?` \u2022 ${ze(s.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},yt(e))})()),(Ot(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},ze(Ot(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},ze(Qt(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",Ye(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary flex-fill",onClick:()=>Tt(e),disabled:le||!!se||be===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>Jt(e),disabled:le||!!se||be===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger flex-fill",onClick:()=>aa(e.id),disabled:le||se===e.id||be===e.id},se===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>Rt(e,"processing"),disabled:le||!!se||be===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>Rt(e,"done"),disabled:le||!!se||be===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>Rt(e,"paid"),disabled:le||!!se||be===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:()=>Rt(e,"canceled"),disabled:le||!!se||be===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,it.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const n=kt(e);return n.length?React.createElement("div",{className:"d-grid gap-1"},n.map((a,s)=>React.createElement("div",{key:s,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},s+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",ze(a.unitPrice))))):yt(e)})()),React.createElement("td",null,At(e)),React.createElement("td",{className:"fw-semibold"},ze(Qt(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${ee(e.status)}`},ae(e.status)),Ue(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${h} ng\xE0y`},"\u26A0 Ch\u1EADm ",Ve(e),"d"),nt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${I} ng\xE0y`},"\u23F3 C\xF2n ",at(e),"d"))),React.createElement("td",null,Ye(e.created_at)),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary me-1",onClick:()=>Tt(e),disabled:le||!!se||be===e.id},"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>Jt(e),disabled:le||!!se||be===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>Rt(e,"processing"),disabled:le||!!se||be===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>Rt(e,"done"),disabled:le||!!se||be===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>Rt(e,"paid"),disabled:le||!!se||be===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:()=>Rt(e,"canceled"),disabled:le||!!se||be===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>aa(e.id),disabled:le||se===e.id},se===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")))))))))),b&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),V?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Dt})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),ta({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:Mt},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:r.customer_name,onChange:e=>E({...r,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!rt.nameError&&React.createElement("div",{className:"form-text text-danger"},rt.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:r.phone,onChange:e=>T(e.target.value),onBlur:d,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!rt.phoneError&&React.createElement("div",{className:"form-text text-danger"},rt.phoneError),!rt.phoneError&&jt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",jt.count," \u0111\u01A1n trong th\xE1ng ",jt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>$(e=>!e)},A?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),A&&jt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>$(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},jt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ee(e.status)}`},ae(e.status))),React.createElement("div",{className:"text-muted small"},Ye(e.created_at)," \u2022 ",ze(Qt(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},yt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Tt(e)}},"M\u1EDF")))),jt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(i==null?void 0:i.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(i==null?void 0:i.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(i==null?void 0:i.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(i==null?void 0:i.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:r.status,onChange:e=>E({...r,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:r.address,onChange:e=>E({...r,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!rt.addressWarn&&React.createElement("div",{className:"form-text text-warning"},rt.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:r.note,onChange:e=>E({...r,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:r.adjustment_amount,onChange:e=>E({...r,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!rt.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},rt.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:r.adjustment_note,onChange:e=>E({...r,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!rt.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},rt.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{E(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Re(e=>[...Array.isArray(e)?e:[],""]),V&&W(e=>[...Array.isArray(e)?e:[],!0])},disabled:le},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(r.items)?r.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{he.current[n]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{g(a=>a===n?null:n),setTimeout(()=>{const a=document.getElementById(`order-product-search-${n}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},qt(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),c===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:ge[n]||"",onChange:a=>{const s=a.target.value;Re(l=>{const f=Array.isArray(l)?[...l]:[];return f[n]=s,f})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const a=qe(n);return a.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):a.map(s=>React.createElement("button",{key:s.id,type:"button",className:"dropdown-item",onClick:()=>{const l=String(s.id),f=Ze(s==null?void 0:s.variants),L={};for(const o of f){const p=String((o==null?void 0:o.name)||"").trim(),P=Array.isArray(o==null?void 0:o.options)?o.options[0]:null,F=String((P==null?void 0:P.label)||"").trim();p&&F&&(L[p]=F)}const S=vt(L),m=mt(s,L);E(o=>{const p=Array.isArray(o.items)?[...o.items]:[];return p[n]={...p[n]||{quantity:1},product_id:l,variant_json:Object.keys(L).length?L:null,variant:S,unit_price:f.length?m:null},{...o,items:p}}),g(null)}},s.name,s.code?` (${s.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),y.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var s;const a=(s=rt.items)==null?void 0:s[n];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const a=Me(e.product_id),s=Ze(a==null?void 0:a.variants);if(!s.length)return null;const l=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},s.map((f,L)=>{const S=String((f==null?void 0:f.name)||`Bi\u1EBFn th\u1EC3 ${L+1}`).trim(),m=String((l==null?void 0:l[S])||"").trim();return React.createElement("div",{key:S},React.createElement("label",{className:"form-label small text-muted mb-1"},S),React.createElement("select",{className:"form-select",value:m,onChange:o=>{const p=String(o.target.value||"").trim();E(P=>{const F=Array.isArray(P.items)?[...P.items]:[],ie={...F[n]||{}},ue=Me(ie.product_id),He=Ze(ue==null?void 0:ue.variants),Ie=ie!=null&&ie.variant_json&&typeof ie.variant_json=="object"?{...ie.variant_json}:{};p?Ie[S]=p:delete Ie[S];const st=vt(Ie),Ge=mt(ue,Ie);return F[n]={...ie,variant_json:Object.keys(Ie).length?Ie:null,variant:st,unit_price:Ge},{...P,items:F}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",S," --"),(Array.isArray(f==null?void 0:f.options)?f.options:[]).map(o=>React.createElement("option",{key:o.label,value:o.label},o.label,Number.isFinite(Number(o==null?void 0:o.price))?` (${ze(Number(o.price))})`:Number(o==null?void 0:o.price_delta)?` (${o.price_delta>0?"+":""}${o.price_delta})`:""))))}))})(),V&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!H[n],onChange:a=>{const s=!!a.target.checked;W(l=>{const f=Array.isArray(l)?[...l]:[],L=Array.isArray(r.items)?r.items.length:0;for(;f.length<L;)f.push(!0);return f[n]=s,f})},disabled:le||Se}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const s=a.target.value;E(l=>{const f=Array.isArray(l.items)?[...l.items]:[];return f[n]={...f[n]||{product_id:""},quantity:s},{...l,items:f}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var s;const a=(s=rt.items)==null?void 0:s[n];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{E(a=>{const s=Array.isArray(a.items)?[...a.items]:[];return s.splice(n,1),{...a,items:s.length?s:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Re(a=>{const s=Array.isArray(a)?[...a]:[];return s.splice(n,1),s.length?s:[""]}),W(a=>{const s=Array.isArray(a)?[...a]:[];return s.splice(n,1),s}),g(a=>a==null?a:a===n?null:a>n?a-1:a)},disabled:le||Se||(Array.isArray(r.items)?r.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(r.items)?r.items:[]).filter(L=>L==null?void 0:L.product_id),a=Ft(n),s=Ht(n),l=ft(r.adjustment_amount),f=a+(s.found?s.fee:0)+l;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},ze(a))),s.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},ze(s.fee))),!!rt.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},rt.shipAbnormalWarn),l!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},ze(l))),(r.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(r.note||"").trim()),(r.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",(r.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},ze(f)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Dt,disabled:le||Se,style:{borderRadius:10}},"H\u1EE7y"),!!V&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:zt,disabled:le||Se,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},Se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!V&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>ta({mode:"new"}),disabled:le||!rt.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:le||Se||!rt.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},le?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

