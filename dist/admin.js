const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:D,error:L}){const[j,ve]=useState(""),[ae,W]=useState(""),[X,Ee]=useState(!1),[Be,Se]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),L&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),L),React.createElement("form",{onSubmit:async nt=>{nt.preventDefault(),Ee(!0),await D(j,ae),Ee(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:j,onChange:nt=>ve(nt.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:Be?"text":"password",className:"form-control",value:ae,onChange:nt=>W(nt.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Se(!Be)},React.createElement("i",{className:`fas fa-eye${Be?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:D,type:L,onClose:j,actionLabel:ve,onAction:ae,durationMs:W}){return useEffect(()=>{const X=Number(W),Ee=Number.isFinite(X)&&X>0?X:3e3,Be=setTimeout(j,Ee);return()=>clearTimeout(Be)},[j,W]),React.createElement("div",{className:`toast show align-items-center text-white bg-${L} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},D),ve&&typeof ae=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{ae()}finally{j()}}},ve),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:j})))}function Loading({show:D}){return D?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:D,title:L,subtitle:j,onClose:ve,footer:ae,children:W}){return useEffect(()=>{if(!D)return;const X=Ee=>{Ee.key==="Escape"&&(Ee.preventDefault(),typeof ve=="function"&&ve())};return document.addEventListener("keydown",X),()=>document.removeEventListener("keydown",X)},[D,ve]),D?React.createElement("div",{className:`admin-drawer-root ${D?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:ve,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},L),j?React.createElement("div",{className:"admin-drawer-subtitle"},j):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:ve,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},W),ae?React.createElement("div",{className:"admin-drawer-footer"},ae):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(D){try{const L=localStorage.getItem(D);if(!L)return[];const j=JSON.parse(L);return Array.isArray(j)?j.map(ve=>String(ve||"").trim()).filter(Boolean):[]}catch(L){return[]}}function saveAdminMenuIdsToStorage(D,L){try{localStorage.setItem(D,JSON.stringify(Array.isArray(L)?L:[]))}catch(j){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(D){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,D),D}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(D){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,D),D}function Sidebar({activeMenu:D,onMenuChange:L,onLogout:j,currentUser:ve,pinnedMenus:ae,recentMenus:W,onTogglePin:X}){const Ee=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"recon",icon:"fa-file-excel",label:"\u0110\u1ED1i so\xE1t Excel"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],Be=(ve==null?void 0:ve.username)||(ve==null?void 0:ve.name)||(ve==null?void 0:ve.email)||"Admin",Se=useMemo(()=>{const Le=new Map;for(const B of Ee)Le.set(B.id,B);return Le},[]),Ge=Array.isArray(ae)?ae:[],nt=Array.isArray(W)?W:[],qe=Ge.map(Le=>Se.get(Le)).filter(Boolean),Xe=nt.filter(Le=>Le!==D).map(Le=>Se.get(Le)).filter(Boolean).slice(0,5),ue=Le=>Ge.includes(Le);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},Be),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},qe.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},qe.map(Le=>React.createElement("a",{key:`pin-${Le.id}`,href:"#",className:`nav-link ${D===Le.id?"active":""} sidebar-quicklink`,onClick:B=>{B.preventDefault(),L(Le.id)}},React.createElement("i",{className:`fas ${Le.icon}`})," ",Le.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:B=>{B.preventDefault(),B.stopPropagation(),X&&X(Le.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),Xe.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},Xe.map(Le=>React.createElement("a",{key:`recent-${Le.id}`,href:"#",className:`nav-link ${D===Le.id?"active":""} sidebar-quicklink`,onClick:B=>{B.preventDefault(),L(Le.id)}},React.createElement("i",{className:`fas ${Le.icon}`})," ",Le.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),Ee.map(Le=>React.createElement("a",{key:Le.id,href:"#",className:`nav-link ${D===Le.id?"active":""} ${Le.disabled?"opacity-50":""} ${Le.highlight?"text-warning":""}`,onClick:B=>{B.preventDefault(),Le.disabled||L(Le.id)}},React.createElement("i",{className:`fas ${Le.icon}`})," ",Le.label,Le.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),Le.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${ue(Le.id)?"pinned":""}`,onClick:B=>{B.preventDefault(),B.stopPropagation(),X&&X(Le.id)},title:ue(Le.id)?"B\u1ECF ghim":"Ghim","aria-label":ue(Le.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),j&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:j,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(D){const L=typeof D=="number"?D:parseFloat(String(D!=null?D:"").trim());return Number.isFinite(L)?Math.max(0,Math.min(100,L)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var D;try{const L=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!L)return{ship_percent:DEFAULT_SHIP_PERCENT};const j=JSON.parse(L);return{ship_percent:normalizeShipPercent((D=j==null?void 0:j.ship_percent)!=null?D:j==null?void 0:j.shipPercent)}}catch(L){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(D){var L;try{const j={ship_percent:normalizeShipPercent((L=D==null?void 0:D.ship_percent)!=null?L:D==null?void 0:D.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(j)),j}catch(j){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var L;const D=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((L=D==null?void 0:D.ship_percent)!=null?L:D==null?void 0:D.shipPercent)}}async function saveAdminSettingsToServer(D){var ve,ae,W;const L={ship_percent:normalizeShipPercent((ve=D==null?void 0:D.ship_percent)!=null?ve:D==null?void 0:D.shipPercent)},j=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,L,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((W=(ae=j==null?void 0:j.ship_percent)!=null?ae:j==null?void 0:j.shipPercent)!=null?W:L.ship_percent)}}function AlbumList({albums:D,onSelect:L,onCreate:j,onEdit:ve,onDelete:ae,loading:W,currentFolder:X,onBack:Ee,breadcrumb:Be}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},X&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:Ee},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),X?X.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:j},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),Be&&Be.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Se=>{Se.preventDefault(),Ee("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Be.map((Se,Ge)=>React.createElement("li",{key:Se.id,className:`breadcrumb-item ${Ge===Be.length-1?"active":""}`},Ge===Be.length-1?Se.title:React.createElement("a",{href:"#",onClick:nt=>{nt.preventDefault(),Ee(Se)},className:"text-warning"},Se.title))))),W?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):D.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},X?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},D.map(Se=>React.createElement("div",{key:Se.uuid||Se.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>L(Se)},Se.cover?React.createElement("img",{src:Se.cover,className:"album-cover",alt:Se.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Se.title),React.createElement("small",{className:"text-muted"},Se.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Se.subfolderCount),Se.subfolderCount>0&&Se.count>0&&" \u2022 ",Se.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Se.count),Se.subfolderCount===0&&Se.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Ge=>{Ge.stopPropagation(),ve(Se)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Ge=>{Ge.stopPropagation(),ae(Se)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:D,album:L,onClose:j,onSave:ve,parentId:ae}){const[W,X]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[Ee,Be]=useState(!1),[Se,Ge]=useState(!1),nt=useRef(null);useEffect(()=>{X(L?{slug:L.id||"",title:L.title||"",description:L.description||"",cover_url:L.cover||"",parent_id:L.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:ae||null})},[L,D,ae]);const qe=async B=>{B.preventDefault(),Be(!0),await ve(W),Be(!1)},Xe=B=>B.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),ue=async B=>{const gt=B.type==="image/heic"||B.type==="image/heif"||/\.heic$/i.test(B.name);if(B.size<=2097152&&!gt)return B;try{const At=await createImageBitmap(B),We=document.createElement("canvas");let tt=At.width,Re=At.height;const yt=800;return(tt>yt||Re>yt)&&(tt>Re?(Re=Math.round(Re/tt*yt),tt=yt):(tt=Math.round(tt/Re*yt),Re=yt)),We.width=tt,We.height=Re,We.getContext("2d").drawImage(At,0,0,tt,Re),At.close(),new Promise((an,Ze)=>{We.toBlob(Lt=>{Lt?an(new File([Lt],B.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ze(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(At){throw console.error("Compress cover error:",At),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Le=async B=>{var At;const pt=B.target.files[0];if(!pt)return;if(!(pt.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(pt.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ge(!0);try{const We=await ue(pt),tt=await window.KTM.cloudinary.uploadImage({file:We,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!tt.secure_url)throw console.error("Cloudinary error:",tt),new Error(((At=tt.error)==null?void 0:At.message)||"Upload failed");X(Re=>({...Re,cover_url:tt.secure_url}))}catch(We){console.error("Cover upload error:",We),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+We.message)}Ge(!1),B.target.value=""};return D?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},L?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:qe},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:W.title,onChange:B=>X({...W,title:B.target.value,slug:W.slug||Xe(B.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:W.slug,onChange:B=>X({...W,slug:B.target.value}),required:!0,disabled:!!L}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:W.description,onChange:B=>X({...W,description:B.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},W.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:W.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>X(B=>({...B,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:nt,type:"file",accept:"image/*",className:"d-none",onChange:Le}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var B;return(B=nt.current)==null?void 0:B.click()},disabled:Se},Se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:W.cover_url,onChange:B=>X({...W,cover_url:B.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:Ee||Se},Ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:D,allAlbums:L,currentAlbumId:j,targetAlbum:ve,onSelect:ae,level:W=0}){const[X,Ee]=useState(!0),Be=D.uuid||D.id,Se=Be===j,Ge=ve===Be,nt=L.filter(Xe=>Xe.parentId===Be),qe=nt.length>0;return React.createElement("div",{style:{marginLeft:W*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Ge?"bg-info text-white":Se?"bg-light text-muted":"hover-bg"}`,style:{cursor:Se?"not-allowed":"pointer",opacity:Se?.5:1,transition:"background 0.2s"},onClick:()=>!Se&&ae(Be)},qe&&React.createElement("i",{className:`fas fa-chevron-${X?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:Xe=>{Xe.stopPropagation(),Ee(!X)}}),!qe&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Ge?"-open":""} me-2 ${Ge?"":"text-warning"}`}),React.createElement("span",{className:"small"},D.title),Se&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),D.count>0&&!Se&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},D.count)),X&&qe&&React.createElement("div",null,nt.map(Xe=>React.createElement(FolderTreeItem,{key:Xe.uuid||Xe.id,folder:Xe,allAlbums:L,currentAlbumId:j,targetAlbum:ve,onSelect:ae,level:W+1}))))}function AlbumDetail({album:D,onBack:L,onRefresh:j,showToast:ve,onNavigateToFolder:ae,onEditSubfolder:W,parentAlbum:X}){const[Ee,Be]=useState([]),[Se,Ge]=useState([]),[nt,qe]=useState(!0),[Xe,ue]=useState(!1),[Le,B]=useState(""),[pt,gt]=useState([]),[At,We]=useState([]),[tt,Re]=useState({}),[yt,Kt]=useState(null),[an,Ze]=useState(!1),[Lt,jt]=useState(""),[T,A]=useState(!1),H=useRef(null),ye=useRef(null),[Ne,le]=useState(!1),[me,Te]=useState([]),[x,F]=useState([]),[Y,re]=useState(""),[Me,Ae]=useState(!1),Qe=async(P,u=2)=>{const V=u*1024*1024,te=P.type==="image/heic"||P.type==="image/heif"||/\.heic$/i.test(P.name);if(P.size<=V&&!te)return P;try{const Oe=await createImageBitmap(P),Pe=document.createElement("canvas");let Je=Oe.width,wt=Oe.height;const et=1200;return(Je>et||wt>et)&&(Je>wt?(wt=Math.round(wt/Je*et),Je=et):(Je=Math.round(Je/wt*et),wt=et)),Pe.width=Je,Pe.height=wt,Pe.getContext("2d").drawImage(Oe,0,0,Je,wt),Oe.close(),new Promise((Xt,sn)=>{Pe.toBlob(bn=>{bn?Xt(new File([bn],P.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):sn(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Oe){throw console.error("Compress error:",Oe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{Ue(),Tt()},[D.id,D.uuid]);const Ue=async()=>{qe(!0);try{const P=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${D.uuid||D.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Be(P.images||[]);const u=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${D.uuid||D.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Ge(Array.isArray(u)?u:[])}catch(P){console.error(P),ve("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}qe(!1)},Tt=async()=>{try{const P=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");F(Array.isArray(P)?P:[])}catch(P){console.error("Error loading albums:",P)}},Ot=P=>{Te(u=>u.includes(P)?u.filter(V=>V!==P):[...u,P])},_e=async()=>{if(!Y||me.length===0){ve("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}Ae(!0);let P=0;for(const u of me)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${u}`,{album_id:Y},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),P++}catch(V){console.error("Move error:",V)}Ae(!1),le(!1),Te([]),re(""),P>0?(ve("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),Ue(),j()):ve("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[it,Qt]=useState(!1),$t=async()=>{if(me.length===0||!confirm(`X\xF3a ${me.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Qt(!0);let P=0;for(const u of me)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${u}`,"L\u1ED7i x\xF3a \u1EA3nh"),P++}catch(V){console.error("Delete error:",V)}Qt(!1),Te([]),P>0?(ve(`\u0110\xE3 x\xF3a ${P} \u1EA3nh!`,"success"),Ue(),j()):ve("X\xF3a th\u1EA5t b\u1EA1i","danger")},ln=()=>{me.length===Ee.length?Te([]):Te(Ee.map(P=>P.id))},Ft=async()=>{if(Lt.trim()){A(!0);try{const P=Lt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:P+"-"+Date.now(),title:Lt,parent_id:D.uuid||D.id},"L\u1ED7i t\u1EA1o folder"),ve("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),jt(""),Ze(!1),Ue(),j()}catch(P){ve(P.message,"danger")}A(!1)}},hn=async P=>{if(confirm(`X\xF3a folder "${P.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${P.uuid||P.id}`,"L\u1ED7i x\xF3a folder"),ve("\u0110\xE3 x\xF3a folder","success"),Ue(),j()}catch(u){ve("L\u1ED7i x\xF3a folder","danger")}},gn=P=>{const u=Array.from(P).filter(V=>V.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(V.name));gt(V=>[...V,...u]),u.forEach(V=>{const te=new FileReader;te.onload=Oe=>{We(Pe=>[...Pe,{file:V,preview:Oe.target.result}])},te.readAsDataURL(V)})},R=P=>{gt(u=>u.filter((V,te)=>te!==P)),We(u=>u.filter((V,te)=>te!==P))},se=async P=>{var V;const u=await window.KTM.cloudinary.uploadImage({file:P,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${D.id}`});if(!u.secure_url)throw console.error("Cloudinary error:",u),new Error(((V=u.error)==null?void 0:V.message)||"Upload failed");return u},Ye=async()=>{if(pt.length===0)return;ue(!0);let P=0;for(let u=0;u<pt.length;u++)try{B(`\u0110ang x\u1EED l\xFD ${u+1}/${pt.length}...`);const V=await Qe(pt[u],2);B(`\u0110ang upload ${u+1}/${pt.length}...`);const te=await se(V);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${D.id}`,{url:te.secure_url,caption:tt[u]||pt[u].name.replace(/\.[^/.]+$/,""),sort_order:Ee.length+u},"L\u1ED7i l\u01B0u \u1EA3nh"),P++}catch(V){console.error("Upload error:",V)}ue(!1),B(""),gt([]),We([]),Re({}),P>0?(ve(`\u0110\xE3 upload ${P} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),Ue(),j()):ve("Upload th\u1EA5t b\u1EA1i","danger")},Bt=async(P,u)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${P}`,"L\u1ED7i x\xF3a \u1EA3nh"),ve("\u0110\xE3 x\xF3a \u1EA3nh","success"),Ue(),j()}catch(V){ve("L\u1ED7i x\xF3a \u1EA3nh","danger")}},fn=P=>{var u;P.preventDefault(),(u=ye.current)==null||u.classList.add("dragover")},zt=()=>{var P;(P=ye.current)==null||P.classList.remove("dragover")},Gt=P=>{var u;P.preventDefault(),(u=ye.current)==null||u.classList.remove("dragover"),gn(P.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:L},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},D.title),React.createElement("small",{className:"text-muted"},Se.length>0&&React.createElement("span",null,Se.length," folder \u2022 "),Ee.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Ze(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),an&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Lt,onChange:P=>jt(P.target.value),onKeyPress:P=>P.key==="Enter"&&Ft(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Ft,disabled:T||!Lt.trim()},T?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Ze(!1),jt("")}},"H\u1EE7y")))),Se.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Se.map(P=>React.createElement("div",{key:P.uuid||P.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>ae&&ae(P)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},P.title),React.createElement("small",{className:"text-muted"},P.subfolderCount>0&&React.createElement("span",null,P.subfolderCount," folder"),P.subfolderCount>0&&P.count>0&&" \u2022 ",P.count>0&&React.createElement("span",null,P.count," \u1EA3nh"),P.subfolderCount===0&&P.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:u=>{u.stopPropagation(),W&&W(P)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:u=>{u.stopPropagation(),hn(P)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:ye,className:"upload-zone",onClick:()=>{var P;return(P=H.current)==null?void 0:P.click()},onDragOver:fn,onDragLeave:zt,onDrop:Gt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:H,type:"file",multiple:!0,accept:"image/*",onChange:P=>gn(P.target.files)})),At.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},At.map((P,u)=>React.createElement("div",{key:u,className:"upload-preview-item"},React.createElement("img",{src:P.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>R(u)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Ye,disabled:Xe},Xe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Le||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",pt.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",Ee.length,")"),Ee.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:ln},me.length===Ee.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),me.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},me.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>le(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:$t,disabled:it},it?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Te([])},React.createElement("i",{className:"fas fa-times"})))),nt?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):Ee.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},Ee.map((P,u)=>React.createElement("div",{key:u,className:`image-item ${me.includes(P.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Ot(P.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:me.includes(P.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:me.includes(P.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},me.includes(P.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:P.src,alt:P.caption,style:{opacity:me.includes(P.id)?.7:1,border:me.includes(P.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:V=>{V.stopPropagation(),Bt(P.id,u)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),P.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},P.caption)))))),Ne&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",me.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>le(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},x.filter(P=>!P.parentId).map(P=>React.createElement(FolderTreeItem,{key:P.uuid||P.id,folder:P,allAlbums:x,currentAlbumId:D.uuid||D.id,targetAlbum:Y,onSelect:re})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>le(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:_e,disabled:!Y||Me},Me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),yt&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Kt(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Kt(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:yt.src,alt:yt.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:P=>P.stopPropagation()}),yt.caption&&React.createElement("div",{className:"text-white text-center mt-2"},yt.caption)))))}function SearchCenter({showToast:D,onNavigate:L}){const[j,ve]=useState(""),[ae,W]=useState([]),[X,Ee]=useState([]),[Be,Se]=useState([]),[Ge,nt]=useState("all"),[qe,Xe]=useState(null),[ue,Le]=useState("list"),[B,pt]=useState(!0),[gt,At]=useState([]),[We,tt]=useState([]),Re=useRef(null),[yt,Kt]=useState(!0),[an,Ze]=useState(!1),Lt=useRef(null),jt=useRef(null),T=useRef(null),[A,H]=useState(!1),[ye,Ne]=useState([]),[le,me]=useState([]),[Te,x]=useState(""),F=useRef(null),Y=useRef(new Map),[re,Me]=useState("auto"),[Ae,Qe]=useState({start:0,end:20}),[Ue,Tt]=useState(!1),[Ot,_e]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[it,Qt]=useState(""),[$t,ln]=useState(!1),Ft=useRef(null),hn=useRef(null),gn=s=>s?String(s).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",R=s=>s?String(s).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",se=(s,d)=>{if(!s||!d)return s;const l=new RegExp(`(${d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return s.replace(l,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const s=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),d=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");Ne(Array.isArray(s)?s.slice(0,10):[]),me(Array.isArray(d)?d:[])}catch(s){}},[]);const Ye=s=>{if(!s.trim())return;const d=[s,...ye.filter(l=>l!==s)].slice(0,10);Ne(d);try{localStorage.setItem("ktm_search_history",JSON.stringify(d))}catch(l){}},Bt=s=>{if(!s.trim())return;const d=le.includes(s)?le.filter(l=>l!==s):[s,...le].slice(0,5);me(d);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(d))}catch(l){}},fn="ktm_search_query_stats_v1",zt="ktm_search_product_stats_v1",Gt=(s,d)=>{try{const l=localStorage.getItem(s);if(!l)return d;const S=JSON.parse(l);return S!=null?S:d}catch(l){return d}},P=(s,d)=>{try{localStorage.setItem(s,JSON.stringify(d))}catch(l){}},[u,V]=useState(()=>Gt(fn,{})),[te,Oe]=useState(()=>Gt(zt,{})),Pe=useRef(!1),Je=useRef(new Map);useEffect(()=>{const s=d=>{d&&(d.key===fn&&V(Gt(fn,{})),d.key===zt&&Oe(Gt(zt,{})))};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const wt=s=>{const d=String(s||"").trim();if(!d)return;const l=xe(d).trim();if(l.length<3||l==="sdt:"||l==="#"||l.endsWith(":"))return;const S=Date.now(),$=Gt(fn,u&&typeof u=="object"?u:{}),N={...$&&typeof $=="object"?$:{}},y=N[l]&&typeof N[l]=="object"?N[l]:{};N[l]={q:d,count:(Number(y.count)||0)+1,lastAt:S},V(N),P(fn,N)},et=(s,d)=>{if(!s||s._type!=="product")return;const l=String(s.id||"").trim();if(!l)return;const S=Date.now(),$=Gt(zt,te&&typeof te=="object"?te:{}),N={...$&&typeof $=="object"?$:{}},y=N[l]&&typeof N[l]=="object"?N[l]:{};N[l]={id:l,name:String(s.name||y.name||"").trim(),code:String(s.code||y.code||"").trim(),count:(Number(y.count)||0)+1,lastAt:S,action:String(d||y.action||"").trim()},Oe(N),P(zt,N)},dn=(s,d)=>{const l=String(s||"").trim();if(!l)return;const S=xe(l).trim();if(S.length<3||S==="sdt:"||S==="#"||S.endsWith(":"))return;const $=Date.now(),N=Number(Je.current.get(S)||0);if($-N<3e4)return;const G=(Array.isArray(d)?d:[]).find(ce=>ce&&ce._type==="product");G&&(Je.current.set(S,$),et(G,"search"))},Xt=useMemo(()=>Object.values(u&&typeof u=="object"?u:{}).map(l=>({q:String((l==null?void 0:l.q)||"").trim(),count:Number(l==null?void 0:l.count)||0,lastAt:Number(l==null?void 0:l.lastAt)||0})).filter(l=>l.q&&l.count>0).sort((l,S)=>S.count-l.count||S.lastAt-l.lastAt).slice(0,6),[u]),sn=useMemo(()=>Object.values(te&&typeof te=="object"?te:{}).map(l=>({id:String((l==null?void 0:l.id)||"").trim(),name:String((l==null?void 0:l.name)||"").trim(),code:String((l==null?void 0:l.code)||"").trim(),count:Number(l==null?void 0:l.count)||0,lastAt:Number(l==null?void 0:l.lastAt)||0})).filter(l=>l.id&&l.count>0).sort((l,S)=>S.count-l.count||S.lastAt-l.lastAt).slice(0,8).map(l=>{const S=X.find($=>$&&$._type==="product"&&String($.id)===l.id);return S?{...l,item:S}:{...l,item:null}}),[te,X]),bn=(s,d={})=>{const l=String(s||"");St(l),d.addToHistory!==!1&&Ye(l),H(!1),pn(!1),w(!1),d.focus!==!1?(Pe.current=!0,setTimeout(()=>{var N;const $=Re.current;(N=$==null?void 0:$.focus)==null||N.call($);try{if(d.caret==="end"&&$&&typeof $.setSelectionRange=="function"){const y=String($.value||"").length;$.setSelectionRange(y,y)}}catch(y){}},0)):(Pe.current=!1,setTimeout(()=>{var $,N,y,G;try{(N=($=Re.current)==null?void 0:$.blur)==null||N.call($),(G=(y=document.activeElement)==null?void 0:y.blur)==null||G.call(y)}catch(ce){}},0))},[at,mn]=useState(null),[_n,vn]=useState(!1),[dt,r]=useState(null),[c,w]=useState(!1),[f,M]=useState(!1),[q,E]=useState(null),[b,C]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),_=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],z=s=>{var d,l;s._type==="product"&&(r(s),C({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(l=(d=s.commission_percent)!=null?d:s.commissionPercent)!=null?l:""}),vn(!0))},ne=async()=>{if(dt)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${dt.id}`,b,"L\u1ED7i c\u1EADp nh\u1EADt"),D("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),vn(!1),r(null),Ve()}catch(s){D(s.message,"danger")}},we=async s=>{const d=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${d} "${s.name}"?`))try{let l="";s._type==="product"?l=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?l=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(l=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(l,"L\u1ED7i x\xF3a"),D(`\u0110\xE3 x\xF3a ${d}`,"success"),Ve()}catch(l){D(l.message,"danger")}},ie=async s=>{try{const d=q?`${API_BASE}/api/products?id=${q.id}`:`${API_BASE}/api/products`;q?await window.KTM.api.putJSON(d,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(d,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),D(q?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),M(!1),E(null),Ve()}catch(d){D(d.message,"danger")}},$e="ktm_admin_data_cache_v1",Ie=1e3*60*10,Ve=async()=>{let s=null,d=!1;const l=window.KTM.cache.read($e,{ttlMs:Ie,validate:Array.isArray});l.hit?(s=l.value,console.log("[CACHE] Using cache, items:",s.length),Ee(s),W(s),pt(!1),d=!0):l.status==="miss"?console.log("[CACHE] No cache found"):l.status==="expired"||l.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):l.status==="error"&&console.error("[CACHE] Error parsing cache"),d||pt(!0);try{const S=async(Ce,h)=>{try{const be=await window.KTM.api.getJSON(Ce,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return be!=null?be:h}catch(be){return h}},[$,N,y]=await Promise.all([S(`${API_BASE}/api/products?fields=search`,[]),S(`${API_BASE}/api/albums`,[]),S(`${API_BASE}/api/video-folders?withVideos=true`,[])]),G=Array.isArray($)?$.map(Ce=>({...Ce,_type:"product",_source:"database"})):[];At(N);let ce=[];Array.isArray(N)&&N.length>0&&(await Promise.all(N.map(h=>S(`${API_BASE}/api/albums/${h.id}`,{})))).forEach((h,be)=>{const pe=N[be];h.images&&h.images.length>0&&h.images.forEach(st=>{ce.push({id:st.id,name:st.caption||"\u1EA2nh t\u1EEB "+pe.title,image:st.src,folder:pe.title,_type:"album",_source:"database"})})}),tt(y);let J=[];Array.isArray(y)&&y.forEach(Ce=>{Ce.videos&&Ce.videos.forEach(h=>{J.push({id:h.id,name:h.title,folder:Ce.name,image:h.thumb,youtubeId:h.youtubeId,url:h.url,_type:"video",_source:"database"})})});const Z=[...G,...ce,...J];(!s||JSON.stringify(Z)!==JSON.stringify(s))&&(Ee(Z),W(Z),window.KTM.cache.write($e,Z))}catch(S){console.error("Song song fetch error:",S)}pt(!1)};useEffect(()=>{Ve(),setTimeout(()=>{var d;return(d=Re.current)==null?void 0:d.focus()},100);const s=d=>{var l,S;(d.ctrlKey||d.metaKey)&&d.key==="k"&&(d.preventDefault(),H(!0),setTimeout(()=>{var $;return($=F.current)==null?void 0:$.focus()},0)),d.key==="/"&&!A&&((l=document.activeElement)==null?void 0:l.tagName)!=="INPUT"&&(d.preventDefault(),(S=Re.current)==null||S.focus()),d.key==="Escape"&&A&&H(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[A]);const xe=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(d){return String(s!=null?s:"").toLowerCase()}},mt=s=>{const l=xe(s).trim().split(/\s+/).filter(Boolean).map(ce=>{const J=String(ce||"").trim();return J?J.startsWith("#")?J.slice(1):J.startsWith("sdt:")?J.slice(4):J.startsWith("phone:")?J.slice(6):J:""}).filter(Boolean),S=l.includes("anh"),$=l.includes("video"),N=l.filter(ce=>ce!=="anh"&&ce!=="video"),y=N.join(" "),G=new Set(["product"]);return S&&G.add("album"),$&&G.add("video"),{allowedTypes:G,includeAlbum:S,includeVideo:$,contentTokens:N,cleanedQuery:y}},de=(s,d,l)=>{var be,pe,st,ot,kt;const S=Array.isArray(d)?d:[],$=xe(l).trim();if(!S.length&&!$)return 0;const N=xe((be=s==null?void 0:s.name)!=null?be:""),y=xe((pe=s==null?void 0:s.code)!=null?pe:""),G=xe((st=s==null?void 0:s.category)!=null?st:""),ce=xe((ot=s==null?void 0:s.note)!=null?ot:""),J=xe((kt=s==null?void 0:s.folder)!=null?kt:"");if(!`${N} ${y} ${G} ${ce} ${J}`.trim())return 0;const Ke=N.replace(/\s+/g,""),Ce=$.replace(/\s+/g,"");let h=0;$&&(N===$&&(h+=220),N.includes($)&&(h+=140),N.startsWith($)&&(h+=160),Ce&&(Ke===Ce?h+=280:Ke.startsWith(Ce)?h+=180:Ke.includes(Ce)&&(h+=110)),y&&y===$&&(h+=180),y&&y.includes($)&&(h+=90));for(const Ut of S){if(!Ut)continue;const qt=new RegExp(`(?:^|\\s)${Ut.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`),Vt=String(Ut).replace(/\s+/g,"");N.includes(Ut)&&(h+=35),qt.test(N)&&(h+=25),Vt&&(Ke===Vt?h+=90:Ke.startsWith(Vt)?h+=50:Ke.includes(Vt)&&(h+=28)),y&&y.includes(Ut)&&(h+=20),y&&qt.test(y)&&(h+=10),G&&G.includes(Ut)&&(h+=12),J&&J.includes(Ut)&&(h+=12),ce&&ce.includes(Ut)&&(h+=6)}return h>0&&N&&(h+=Math.max(0,10-Math.min(10,Math.floor(N.length/10)))),h},He=(s,d,l)=>{const S=Array.isArray(s)?s:[];return S.length?S.map((N,y)=>({it:N,idx:y,score:de(N,d,l)})).sort((N,y)=>y.score!==N.score?y.score-N.score:N.idx-y.idx).map(N=>N.it):[]},It=async(s,d)=>{if(!(!yt||d.length===0)){Ze(!0);try{const l=d.map($=>({id:$.id,name:$.name,price:$.price,category:$.category,note:$.note,folder:$.folder,_type:$._type})),S=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:l},"AI Search error");if(S&&S.matchedIds&&S.matchedIds.length>0){const{contentTokens:$,cleanedQuery:N}=mt(s),y=new Set(S.matchedIds),G=d.filter(ce=>y.has(ce.id)).sort((ce,J)=>de(J,$,N)-de(ce,$,N));G.length>0&&W(G)}else S&&S.matchedIds&&S.matchedIds.length===0&&W([])}catch(l){console.error("AI Search error:",l)}Ze(!1)}},St=s=>{if(ve(s),x(s),jt.current&&clearTimeout(jt.current),Lt.current&&clearTimeout(Lt.current),T.current&&T.current.abort(),!s.trim()){vt(Ge);return}const l=`v2|${xe(s).trim().replace(/\s+/g,"")}|${Ge}`;if(Y.current.has(l)){W(Y.current.get(l));return}const{allowedTypes:S,contentTokens:$,cleanedQuery:N}=mt(s);jt.current=setTimeout(()=>{const y=X.filter(J=>{if(!S.has(J==null?void 0:J._type))return!1;if($.length===0)return!0;const Z=gn(Object.entries(J).filter(([be])=>!be.startsWith("_")).map(([,be])=>String(be||"")).join(" ")),Ke=J.phone?R(J.phone):"",Ce=`${Z} ${Ke}`.trim(),h=Ce.replace(/\s+/g,"");return $.every(be=>{const pe=String(be||"").trim();return pe?Ce.includes(pe)||h.includes(pe.replace(/\s+/g,"")):!0})});let G=y;Ge!=="all"&&(G=y.filter(J=>(J==null?void 0:J._type)===Ge));const ce=He(G,$,N);if(wt(s),dn(s,ce),Y.current.size>20){const J=Y.current.keys().next().value;Y.current.delete(J)}Y.current.set(l,ce),W(ce),yt&&N.length>=3&&(Lt.current=setTimeout(()=>{It(N,G)},500))},200)},vt=s=>{nt(s);const{allowedTypes:d,contentTokens:l}=mt(j),{cleanedQuery:S}=mt(j);let $=X.filter(N=>d.has(N==null?void 0:N._type));s!=="all"&&($=$.filter(N=>(N==null?void 0:N._type)===s)),j.trim()&&l.length>0&&($=$.filter(N=>{const y=xe(Object.entries(N).filter(([Z])=>!Z.startsWith("_")).map(([,Z])=>String(Z||"")).join(" ")),G=N.phone?R(N.phone):"",ce=`${y} ${G}`.trim(),J=ce.replace(/\s+/g,"");return l.every(Z=>{const Ke=String(Z||"").trim();return Ke?ce.includes(Ke)||J.includes(Ke.replace(/\s+/g,"")):!0})})),W(He($,l,S))},je=(s,d,l)=>{l&&l.item&&et(l.item,l.action||"copy"),window.KTM.clipboard.writeText(s).then(()=>{Xe(d),D("\u0110\xE3 copy!","success"),setTimeout(()=>Xe(null),1500)})},I=async(s,d,l)=>{try{l&&l.item&&et(l.item,l.action||"copy_image"),await window.KTM.clipboard.writeImageFromUrl(s),Xe(d+"-img"),D("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>Xe(null),1500)}catch(S){je(s,d+"-img",l)}},oe=s=>{let d=s.toLowerCase();const l=[],S=X.filter(y=>y._type==="product");if(d.includes("ty")||d.includes("xy lanh")){if(d.includes("gi\u1EEFa")||d.includes("giua")){const y=S.find(G=>{var ce;return(ce=G.name)==null?void 0:ce.toLowerCase().includes("xy lanh gi\u1EEFa")});y&&!l.find(G=>G.id===y.id)&&l.push(y)}if(d.includes("nghi\xEAng")||d.includes("nghieng")){const y=S.find(G=>{var ce;return(ce=G.name)==null?void 0:ce.toLowerCase().includes("xy lanh nghi\xEAng")});y&&!l.find(G=>G.id===y.id)&&l.push(y)}if(d.includes("\u1EE7i")||d.includes("ui")){const y=S.find(G=>{var ce;return(ce=G.name)==null?void 0:ce.toLowerCase().includes("xy lanh \u1EE7i")});y&&!l.find(G=>G.id===y.id)&&l.push(y)}}const $=d.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if($){const y=$[1],G=$[2],ce=S.find(J=>{var Ke;const Z=((Ke=J.name)==null?void 0:Ke.toLowerCase())||"";return Z.includes("combo")&&Z.includes(`${y} tay`)&&(Z.includes(`${G} xy`)||Z.includes(`${G} xylanh`))});if(ce&&!l.find(J=>J.id===ce.id))l.push(ce);else{const J=S.find(Z=>{var Ce;const Ke=((Ce=Z.name)==null?void 0:Ce.toLowerCase())||"";return Ke.includes("combo")&&Ke.includes(`${y} tay`)});J&&!l.find(Z=>Z.id===J.id)&&l.push(J)}}if(d.includes("combo")&&!$){const y=d.match(/combo.*?(\d+)\s*tay/);if(y){const G=y[1];S.filter(J=>{var Ke;const Z=((Ke=J.name)==null?void 0:Ke.toLowerCase())||"";return Z.includes("combo")&&Z.includes(`${G} tay`)}).forEach(J=>{l.find(Z=>Z.id===J.id)||l.push(J)})}}const N=d.match(/van\s*(\d+)\s*tay/);if(N&&!d.includes("ty")&&!d.includes("combo")){const y=N[1],G=S.find(ce=>{var Z;const J=((Z=ce.name)==null?void 0:Z.toLowerCase())||"";return J.includes(`van ${y} tay`)&&!J.includes("combo")});G&&!l.find(ce=>ce.id===G.id)&&l.push(G)}return l.slice(0,4)},ze=async s=>{if(!s.trim())return;const d={role:"user",content:s,attachments:[]};_e(S=>[...S,d]),Qt(""),ln(!0);const l=oe(s);setTimeout(()=>{var S;return(S=Ft.current)==null?void 0:S.scrollIntoView({behavior:"smooth"})},100);try{const $=X.filter(Z=>Z._type==="product").map(Z=>{let Ke=`- ${Z.name}`;return Z.code&&(Ke+=` (M\xE3: ${Z.code})`),Z.price&&(Ke+=` - Gi\xE1: ${Z.price.replace(/[đ\s]/g,"")}\u0111`),Z.category&&(Ke+=` [${Z.category}]`),Z.note&&(Ke+=` (${Z.note})`),Ke}).join(`
`),y=Ot.slice(-6).map(Z=>`${Z.role==="user"?"Kh\xE1ch":"AI"}: ${Z.content}`).join(`
`),G=y?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${y}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${$}`:$,J=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:G,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";_e(Z=>[...Z,{role:"assistant",content:J,attachments:l}])}catch(S){console.error("AI Error:",S);const $=s.toLowerCase(),N=X.filter(G=>{const ce=Object.values(G).join(" ").toLowerCase();return $.split(" ").some(J=>ce.includes(J))});let y="";N.length>0?(y=`T\xECm th\u1EA5y ${N.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,N.slice(0,5).forEach(G=>{y+=`\u2022 ${G.name}`,G.price&&(y+=` - ${G.price.replace(/[đ\s]/g,"")}\u0111`),G.note&&(y+=` (${G.note})`),y+=`
`}),N.length>5&&(y+=`
...v\xE0 ${N.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):y='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',_e(G=>[...G,{role:"assistant",content:y,attachments:N.slice(0,4)}])}ln(!1),setTimeout(()=>{var S,$;(S=Ft.current)==null||S.scrollIntoView({behavior:"smooth"}),($=hn.current)==null||$.focus()},100)};function ht({show:s,product:d,categories:l,onClose:S,onSave:$}){const[N,y]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[G,ce]=useState(!1),[J,Z]=useState(!1),Ke=useRef(null),Ce=U=>window.KTM.money.formatVNDInputDigits(U),h=U=>{const ee=window.KTM.money.getDigits(String(U!=null?U:"")),ge=Number(ee);return ee&&Number.isFinite(ge)?Math.trunc(ge):0},be=(U,ee)=>{if(U==null||U==="")return[];let ge=U;if(typeof ge=="string"){const De=ge.trim();if(!De)return[];try{ge=JSON.parse(De)}catch(ke){return[]}}if(!Array.isArray(ge))return[];const Fe=h(ee);return ge.map(De=>{var ct;if(!De||typeof De!="object")return null;const ke=String((ct=De.name)!=null?ct:"").trim(),ut=(Array.isArray(De.options)?De.options:[]).map(Ct=>{var kn,$n,In,Dn,qn,Pn,fa;if(!Ct||typeof Ct!="object")return null;const Yt=String((kn=Ct.label)!=null?kn:"").trim();if(!Yt)return null;const cn=(qn=(Dn=(In=($n=Ct.price)!=null?$n:Ct.priceValue)!=null?In:Ct.unit_price)!=null?Dn:Ct.unitPrice)!=null?qn:null,Nn=Number(cn);let xn=Number.isFinite(Nn)?Math.trunc(Nn):null;if(xn==null){const Rn=(fa=(Pn=Ct.price_delta)!=null?Pn:Ct.priceDelta)!=null?fa:null,Hn=Number(Rn);Number.isFinite(Hn)&&(xn=Fe+Math.trunc(Hn))}xn==null&&(xn=Fe);const Sn=String(Math.max(0,Math.trunc(Number(xn)||0)));return{label:Yt,price:Math.max(0,Math.trunc(Number(xn)||0)),priceDigits:Sn}}).filter(Boolean);return{name:ke||"Bi\u1EBFn th\u1EC3",options:ut}}).filter(Boolean)},pe=U=>{if(U==null||U==="")return[];let ee=U;if(typeof ee=="string"){const ge=ee.trim();if(!ge)return[];try{ee=JSON.parse(ge)}catch(Fe){return[]}}return ee&&typeof ee=="object"&&!Array.isArray(ee)&&(ee=Object.entries(ee).map(([ge,Fe])=>({key:ge,value:Fe}))),Array.isArray(ee)?ee.map(ge=>{var ut,ct,Ct,Yt,cn;if(!ge||typeof ge!="object")return null;const Fe=String((Ct=(ct=(ut=ge.key)!=null?ut:ge.name)!=null?ct:ge.label)!=null?Ct:"").trim(),De=String((Yt=ge.value)!=null?Yt:"").trim(),ke=String((cn=ge.unit)!=null?cn:"").trim();return Fe?{key:Fe,value:De,unit:ke}:null}).filter(Boolean):[]};useEffect(()=>{var U,ee;if(d)if(y({name:d.name||"",code:d.code||"",price:d.price||"",image:d.image||"",category:d.category||"",note:d.note||"",sort_order:d.sort_order||0,commission_percent:(ee=(U=d.commission_percent)!=null?U:d.commissionPercent)!=null?ee:5,variants:be(d.variants,d.price),attributes:pe(d.attributes)}),d.price){const ge=window.KTM.money.getDigits(d.price);Vt(ge),y(Fe=>({...Fe,price:Ce(ge)}))}else Vt("");else y({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Vt("")},[d,s]);const st=U=>{y(ee=>{var ut;const ge=h(ee.price),Fe=String(ge),De=Array.isArray(ee.variants)?[...ee.variants]:[],ke={...De[U]||{},options:Array.isArray((ut=De[U])==null?void 0:ut.options)?[...De[U].options]:[]};return ke.options=ke.options.map(ct=>({label:String((ct==null?void 0:ct.label)||""),price:ge,priceDigits:Fe})),De[U]=ke,{...ee,variants:De}})},ot=()=>{y(U=>{const ee=h(U.price),ge=String(ee),De=(Array.isArray(U.variants)?[...U.variants]:[]).map(ke=>{const ut=(Array.isArray(ke==null?void 0:ke.options)?ke.options:[]).map(ct=>({label:String((ct==null?void 0:ct.label)||""),price:ee,priceDigits:ge}));return{name:String((ke==null?void 0:ke.name)||"Bi\u1EBFn th\u1EC3"),options:ut}});return{...U,variants:De}})},[kt,Ut]=React.useState(""),[qt,Vt]=React.useState(""),bt=U=>{const ee=window.KTM.money.nextPriceInputState(U.target.value,qt);Vt(ee.digits),y({...N,price:ee.price})},rn=async(U,ee=2)=>{const ge=ee*1024*1024;if(U.size<=ge)return U;try{const Fe=await createImageBitmap(U),De=document.createElement("canvas");let ke=Fe.width,ut=Fe.height;const ct=1200;return(ke>ct||ut>ct)&&(ke>ut?(ut=Math.round(ut/ke*ct),ke=ct):(ke=Math.round(ke/ut*ct),ut=ct)),De.width=ke,De.height=ut,De.getContext("2d").drawImage(Fe,0,0,ke,ut),Fe.close(),new Promise((Yt,cn)=>{De.toBlob(Nn=>{Nn?Yt(new File([Nn],U.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):cn(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Fe){throw console.error("Compress error:",Fe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},un=async U=>{var Fe;const ee=U.target.files[0];if(!ee)return;if(!(ee.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(ee.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Z(!0);try{const De=await rn(ee),ke=await window.KTM.cloudinary.uploadImage({file:De,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!ke.secure_url)throw console.error("Cloudinary error:",ke),new Error(((Fe=ke.error)==null?void 0:Fe.message)||"Upload failed");y(ut=>({...ut,image:ke.secure_url}))}catch(De){console.error("Upload error:",De),alert("L\u1ED7i upload \u1EA3nh: "+De.message)}Z(!1),U.target.value=""},on=async U=>{U.preventDefault(),ce(!0);const ee={...N,variants:be(N.variants,N.price),attributes:pe(N.attributes)};await $(ee),ce(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),d?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:S})),React.createElement("form",{onSubmit:on},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:N.name,onChange:U=>y({...N,name:U.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:N.code,onChange:U=>y({...N,code:U.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:N.price,onChange:bt,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:N.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:U=>y({...N,commission_percent:U.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:N.category,onChange:U=>y({...N,category:U.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),l.map(U=>React.createElement("option",{key:U,value:U},U)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:N.note,onChange:U=>y({...N,note:U.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(N.attributes)?N.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(N.attributes)?N.attributes:[]).map((U,ee)=>React.createElement("div",{key:ee,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(U==null?void 0:U.key)||"",onChange:ge=>{const Fe=ge.target.value;y(De=>{const ke=Array.isArray(De.attributes)?[...De.attributes]:[];return ke[ee]={...ke[ee]||{},key:Fe},{...De,attributes:ke}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(U==null?void 0:U.value)||"",onChange:ge=>{const Fe=ge.target.value;y(De=>{const ke=Array.isArray(De.attributes)?[...De.attributes]:[];return ke[ee]={...ke[ee]||{},value:Fe},{...De,attributes:ke}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(U==null?void 0:U.unit)||"",onChange:ge=>{const Fe=ge.target.value;y(De=>{const ke=Array.isArray(De.attributes)?[...De.attributes]:[];return ke[ee]={...ke[ee]||{},unit:Fe},{...De,attributes:ke}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{y(ge=>{const Fe=Array.isArray(ge.attributes)?[...ge.attributes]:[];return Fe.splice(ee,1),{...ge,attributes:Fe}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{y(U=>{const ee=Array.isArray(U.attributes)?[...U.attributes]:[];return ee.push({key:"",value:"",unit:""}),{...U,attributes:ee}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(N.variants)?N.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(N.variants)?N.variants:[]).map((U,ee)=>React.createElement("div",{key:ee,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(U==null?void 0:U.name)||"",onChange:ge=>{const Fe=ge.target.value;y(De=>{var ut;const ke=Array.isArray(De.variants)?[...De.variants]:[];return ke[ee]={...ke[ee]||{},name:Fe,options:Array.isArray((ut=ke[ee])==null?void 0:ut.options)?ke[ee].options:[]},{...De,variants:ke}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>st(ee),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(U==null?void 0:U.options)||U.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{y(ge=>{const Fe=Array.isArray(ge.variants)?[...ge.variants]:[];return Fe.splice(ee,1),{...ge,variants:Fe}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(U==null?void 0:U.options)?U.options:[]).map((ge,Fe)=>{var De,ke;return React.createElement("div",{key:Fe,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(ge==null?void 0:ge.label)||"",onChange:ut=>{const ct=ut.target.value;y(Ct=>{var Sn,kn,$n,In,Dn;const Yt=Array.isArray(Ct.variants)?[...Ct.variants]:[],cn={...Yt[ee]||{},options:Array.isArray((Sn=Yt[ee])==null?void 0:Sn.options)?[...Yt[ee].options]:[]},Nn=Number(($n=(kn=cn.options[Fe])==null?void 0:kn.price)!=null?$n:0)||0,xn=String((Dn=(In=cn.options[Fe])==null?void 0:In.priceDigits)!=null?Dn:Math.max(0,Math.trunc(Nn)));return cn.options[Fe]={...cn.options[Fe]||{},label:ct,price:Math.max(0,Math.trunc(Nn)),priceDigits:xn},Yt[ee]=cn,{...Ct,variants:Yt}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Ce(String((ke=ge==null?void 0:ge.priceDigits)!=null?ke:window.KTM.money.getDigits(String((De=ge==null?void 0:ge.price)!=null?De:"")))),onChange:ut=>{y(ct=>{var $n,In,Dn,qn,Pn;const Ct=String((In=ge==null?void 0:ge.priceDigits)!=null?In:window.KTM.money.getDigits(String(($n=ge==null?void 0:ge.price)!=null?$n:""))),Yt=window.KTM.money.nextPriceInputState(ut.target.value,Ct),cn=String((Dn=Yt.digits)!=null?Dn:""),Nn=Number(cn),xn=Number.isFinite(Nn)?Math.max(0,Math.trunc(Nn)):0,Sn=Array.isArray(ct.variants)?[...ct.variants]:[],kn={...Sn[ee]||{},options:Array.isArray((qn=Sn[ee])==null?void 0:qn.options)?[...Sn[ee].options]:[]};return kn.options[Fe]={...kn.options[Fe]||{},label:String(((Pn=kn.options[Fe])==null?void 0:Pn.label)||""),price:xn,priceDigits:cn},Sn[ee]=kn,{...ct,variants:Sn}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{y(ut=>{var Yt;const ct=Array.isArray(ut.variants)?[...ut.variants]:[],Ct={...ct[ee]||{},options:Array.isArray((Yt=ct[ee])==null?void 0:Yt.options)?[...ct[ee].options]:[]};return Ct.options.splice(Fe,1),ct[ee]=Ct,{...ut,variants:ct}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{y(ge=>{var ut;const Fe=Array.isArray(ge.variants)?[...ge.variants]:[],De={...Fe[ee]||{},options:Array.isArray((ut=Fe[ee])==null?void 0:ut.options)?[...Fe[ee].options]:[]},ke=h(ge.price);return De.options.push({label:"",price:ke,priceDigits:String(ke)}),Fe[ee]=De,{...ge,variants:Fe}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{y(U=>{const ee=h(U.price),ge=Array.isArray(U.variants)?[...U.variants]:[],Fe=String(ee);return ge.push({name:"Size",options:[{label:"S",price:ee,priceDigits:Fe},{label:"M",price:ee,priceDigits:Fe},{label:"L",price:ee,priceDigits:Fe}]}),{...U,variants:ge}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ot,disabled:!Array.isArray(N.variants)||N.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},N.image?React.createElement(React.Fragment,null,React.createElement("img",{src:N.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>y({...N,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var U;return(U=Ke.current)==null?void 0:U.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:Ke,type:"file",accept:"image/*",className:"d-none",onChange:un}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var U;return(U=Ke.current)==null?void 0:U.click()},disabled:J,style:{borderRadius:"10px"}},J?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:N.image,onChange:U=>y({...N,image:U.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:S,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:G,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},G?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const xt=s=>window.KTM.money.formatVND(s),Jt=s=>{if(s==null||s==="")return[];let d=s;if(typeof d=="string"){const l=d.trim();if(!l)return[];try{d=JSON.parse(l)}catch(S){return[]}}return Array.isArray(d)?d:[]},Nt=s=>{if(s==null||s==="")return[];let d=s;if(typeof d=="string"){const l=d.trim();if(!l)return[];try{d=JSON.parse(l)}catch(S){return[]}}return d&&typeof d=="object"&&!Array.isArray(d)&&(d=Object.entries(d).map(([l,S])=>({key:l,value:S}))),Array.isArray(d)?d:[]},Et=(s,d={})=>{var N;const l=Nt(s).map(y=>{var G,ce,J,Z,Ke;return{key:String((J=(ce=(G=y==null?void 0:y.key)!=null?G:y==null?void 0:y.name)!=null?ce:y==null?void 0:y.label)!=null?J:"").trim(),value:String((Z=y==null?void 0:y.value)!=null?Z:"").trim(),unit:String((Ke=y==null?void 0:y.unit)!=null?Ke:"").trim()}}).filter(y=>!!y.key);if(!l.length)return null;const S=!!d.compact,$=String((N=d.className)!=null?N:"").trim();return React.createElement("div",{className:`ktm-variants-preview${S?" compact":""}${$?" "+$:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},l.map((y,G)=>{const ce=y.key,J=`${y.value||""}${y.unit?(y.value?" ":"")+y.unit:""}`.trim();return React.createElement("div",{key:`${ce}-${G}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ce),J?React.createElement("span",{className:"ktm-chip ktm-chip-option"},J):null)})))},Zt=(s,d={})=>{var ce;const l=Jt(s).map(J=>{var Z;return{name:String((Z=J==null?void 0:J.name)!=null?Z:"").trim(),options:Array.isArray(J==null?void 0:J.options)?J.options:[]}}).map(J=>({...J,options:J.options.map(Z=>{var Ke;return{label:String((Ke=Z==null?void 0:Z.label)!=null?Ke:"").trim(),price:Number(Z==null?void 0:Z.price)}}).filter(Z=>!!Z.label)})).filter(J=>J.options.length>0);if(!l.length)return null;const S=Number.isFinite(d.maxGroups)?Math.max(1,Math.trunc(d.maxGroups)):l.length,$=Number.isFinite(d.maxOptionsPerGroup)?Math.max(1,Math.trunc(d.maxOptionsPerGroup)):3,N=!!d.compact,y=String((ce=d.className)!=null?ce:"").trim(),G=l.slice(0,S);return React.createElement("div",{className:`ktm-variants-preview${N?" compact":""}${y?" "+y:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},G.map((J,Z)=>{const Ke=J.name||"Bi\u1EBFn th\u1EC3",Ce=J.options.slice(0,$),h=J.options.length-Ce.length;return React.createElement("div",{key:`${Ke}-${Z}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Ke),Ce.map((be,pe)=>{const st=be.price,ot=Number.isFinite(st)&&st>=0?xt(Math.trunc(st)):"",kt=ot?`${be.label} \xB7 ${ot}`:be.label;return React.createElement("span",{key:`${Ke}-${Z}-${pe}`,className:"ktm-chip ktm-chip-option"},kt)}),h>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",h))})))},Mt=(s,d)=>{const l=s._type==="product",S=s._type==="album",$=s._type==="video",N=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),y=l?Et(s.attributes,{compact:ue==="grid",className:ue==="grid"?"meta text-muted":"text-muted"}):null,G=l?Zt(s.variants,{compact:ue==="grid",maxOptionsPerGroup:999,className:ue==="grid"?"meta text-muted":"text-muted"}):null;return ue==="grid"?React.createElement("div",{key:s.id||d,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>{et(s,"preview"),mn({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${$?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${l?"product":S?"album":"video"}`},l?"SP":S?"\u1EA2nh":"Video"),N&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),y&&React.createElement("div",{style:{marginTop:2}},y),G&&React.createElement("div",{style:{marginTop:2}},G),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:qe===s.id+"-img"?"copied":"",onClick:()=>I(s.image,s.id,{item:s,action:"copy_image"})},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:qe===s.id+"-price"?"copied":"",onClick:()=>je(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||d,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${l?"product":S?"album":"video"}`},l?"S\u1EA3n ph\u1EA9m":S?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>{et(s,"preview"),mn({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${$?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),N&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),y&&React.createElement("div",{style:{marginTop:4}},y),G&&React.createElement("div",{style:{marginTop:4}},G)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),$&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},l&&React.createElement("button",{onClick:()=>{et(s,"create_order"),L&&L("orders","create",{productId:s.id})}},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:qe===s.id+"-price"?"copied":"",onClick:()=>je(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:qe===s.id+"-name"?"copied":"",onClick:()=>je(s.name,s.id+"-name",{item:s,action:"copy_name"})},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),$&&s.youtubeId&&React.createElement("button",{className:qe===s.id+"-yt"?"copied":"",onClick:()=>je(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),l&&React.createElement("button",{className:"action-edit",onClick:()=>z(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>we(s)},React.createElement("i",{className:"fas fa-trash"}))))},[en,pn]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"search-suggestions mobile-only"},React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"G\u1EE3i \xFD nhanh"),React.createElement("div",{className:"search-suggestions-row"},[{label:"van 2 tay",query:"van 2 tay"},{label:"combo r\u1EBB",query:"combo r\u1EBB"},{label:"xylanh",query:"xylanh"},{label:"sdt:\u2026",query:"sdt:",caret:"end",addToHistory:!1},{label:"#m\xE3\u2026",query:"#",caret:"end",addToHistory:!1}].map(s=>React.createElement("button",{key:s.label,type:"button",className:"suggestion-chip",onClick:()=>bn(s.query,{caret:s.caret,addToHistory:s.addToHistory,focus:!1})},s.label)))),sn.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"S\u1EA3n ph\u1EA9m hay t\xECm"),React.createElement("div",{className:"search-suggestions-row"},sn.map(s=>{var $,N;const d=((($=s.item)==null?void 0:$.name)||s.name||"").trim();if(!d)return null;const l=String(((N=s.item)==null?void 0:N.code)||s.code||"").trim(),S=l?`#${l}`:d;return React.createElement("button",{key:s.id,type:"button",className:"suggestion-chip suggestion-chip-popular",onClick:()=>{s.item&&et(s.item,"suggestion"),bn(S,{caret:"end",focus:!1})},title:l?`#${l}`:d},d)}))),Xt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"T\xECm g\u1EA7n \u0111\xE2y / hay d\xF9ng"),React.createElement("div",{className:"search-suggestions-row"},Xt.map(s=>React.createElement("button",{key:s.q,type:"button",className:"suggestion-chip suggestion-chip-query",onClick:()=>bn(s.q,{caret:"end",focus:!1}),title:`${s.q} (${s.count})`},s.q))))),React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,ae.length)," k\u1EBFt qu\u1EA3",yt&&j.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Ge!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Ge==="product"?"S\u1EA3n ph\u1EA9m":Ge==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${ue==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Le("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${ue==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Le("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},B?React.createElement("div",null,[...Array(8)].map((s,d)=>React.createElement("div",{key:d,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):ae.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',j,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{ve(""),St("")}},"Xem t\u1EA5t c\u1EA3")):ue==="grid"?React.createElement("div",{className:"product-grid-mobile"},ae.map((s,d)=>Mt(s,d))):React.createElement("div",null,ae.map((s,d)=>Mt(s,d)))),en&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>pn(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Ge==="all"?"active":""}`,onClick:()=>{vt("all"),pn(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Ge==="product"?"active":""}`,onClick:()=>{vt("product"),pn(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Ge==="album"?"active":""}`,onClick:()=>{vt("album"),pn(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Ge==="video"?"active":""}`,onClick:()=>{vt("video"),pn(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:yt,onChange:s=>Kt(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:Re,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:j,onChange:s=>St(s.target.value)}),React.createElement("button",{className:`filter-btn ${en||Ge!=="all"?"active":""}`,onClick:()=>pn(!en)},React.createElement("i",{className:"fas fa-filter"})))),A&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>H(!1)},React.createElement("div",{className:"search-palette",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:F,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:Te,onChange:s=>St(s.target.value),onKeyDown:s=>{s.key==="Enter"&&ae.length>0?(Ye(Te),H(!1)):s.key==="Escape"&&H(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>H(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((s,d)=>React.createElement("span",{key:s,className:`filter-chip ${Ge===["all","product","album","video"][d]?"active":""}`,onClick:()=>{vt(["all","product","album","video"][d])}},s)))),le.length>0&&!Te.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},le.map((s,d)=>React.createElement("div",{key:d,className:"palette-item",onClick:()=>{St(s),Ye(s)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,s),React.createElement("button",{className:"unsave-btn",onClick:l=>{l.stopPropagation(),Bt(s)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),ye.length>0&&!Te.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},ye.map((s,d)=>React.createElement("div",{key:d,className:"palette-item",onClick:()=>{St(s)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,s),React.createElement("button",{className:"save-btn",onClick:l=>{l.stopPropagation(),Bt(s)}},React.createElement("i",{className:`fas fa-star${le.includes(s)?"":"-o"}`})))))),Te.trim()&&ae.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",ae.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},ae.slice(0,8).map((s,d)=>React.createElement("div",{key:s.id||d,className:"palette-result-item",onClick:()=>{Ye(Te),H(!1)}},s.image&&React.createElement("img",{src:s.image,alt:s.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},s.name),s.price&&React.createElement("div",{className:"result-meta"},s.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:l=>{l.stopPropagation(),Bt(Te)}},React.createElement("i",{className:`fas fa-star${le.includes(Te)?"":"-o"}`})))))),Te.trim()&&ae.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',Te,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:c?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>Tt(!0),onTouchStart:()=>Tt(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),Ue&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>Tt(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},Ot.map((s,d)=>React.createElement("div",{key:d,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:qe===`chat-${d}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:qe===`chat-${d}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),Xe(`chat-${d}`),setTimeout(()=>Xe(null),1500)}},React.createElement("i",{className:`fas ${qe===`chat-${d}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((l,S)=>React.createElement("div",{key:S,style:{width:70},className:"text-center"},l.image&&React.createElement("img",{src:l.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>mn({url:l.image,name:l.name,price:l.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},l.name),l.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},l.price.replace(/[đ\s]/g,""),"\u0111"))))))),$t&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Ft})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>ze(s),disabled:$t,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),ze(it)},className:"chat-input-wrap"},React.createElement("input",{ref:hn,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:it,onChange:s=>Qt(s.target.value),disabled:$t}),React.createElement("button",{type:"submit",className:"send-btn",disabled:$t||!it.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),at&&React.createElement("div",{className:"preview-modal",onClick:()=>mn(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>mn(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:at.url,alt:at.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},at.name),at.price&&React.createElement("div",{className:"price"},at.price.replace(/[đ\s]/g,""),"\u0111"),at.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},at.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:qe==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:qe==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>I(at.url,"preview")},React.createElement("i",{className:`fas ${qe==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),at.price&&React.createElement("button",{className:qe==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>je(at.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${qe==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(ht,{show:f,product:q,categories:Be,onClose:()=>{M(!1),E(null)},onSave:ie}),React.createElement("div",{className:`fab-container mobile-only ${c?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{w(!1),M(!0),E(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{w(!1),L&&L("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${c?"open":""}`,onClick:()=>w(!c)},React.createElement("i",{className:"fas fa-plus"}))),_n&&dt&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>vn(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:b.name,onChange:s=>C({...b,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:b.code,onChange:s=>C({...b,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:b.price,onChange:s=>C({...b,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:b.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>C({...b,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:b.category,onChange:s=>C({...b,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),_.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:b.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>C({...b,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>vn(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:ne},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:D,showToast:L}){const[j,ve]=useState([]),[ae,W]=useState([]),[X,Ee]=useState(!0),[Be,Se]=useState(null),[Ge,nt]=useState(!1),[qe,Xe]=useState(null),[ue,Le]=useState(!1),[B,pt]=useState(null),[gt,At]=useState(!1),[We,tt]=useState(null),[Re,yt]=useState(!1),[Kt,an]=useState(!1),[Ze,Lt]=useState(null),[jt,T]=useState(!1),[A,H]=useState(null),[ye,Ne]=useState([]);useEffect(()=>{le()},[]);const le=async(R=null)=>{Ee(!0);try{const se=R?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${R}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Ye=await window.KTM.api.getJSON(se,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");ve(Array.isArray(Ye)?Ye:[])}catch(se){console.error(se),L("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}Ee(!1)},me=async R=>{try{const se=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${R}`,"L\u1ED7i t\u1EA3i video");W(Array.isArray(se)?se:[])}catch(se){console.error(se)}},Te=async R=>{if(R===0)return;const se=[...j];[se[R-1],se[R]]=[se[R],se[R-1]],ve(se),await F(se)},x=async R=>{if(R===j.length-1)return;const se=[...j];[se[R],se[R+1]]=[se[R+1],se[R]],ve(se),await F(se)},F=async R=>{try{await Promise.all(R.map((se,Ye)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${se.id}`,{sortOrder:Ye},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),L("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(se){L("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),le(A==null?void 0:A.id)}},Y=async R=>{if(R===0)return;const se=[...ae];[se[R-1],se[R]]=[se[R],se[R-1]],W(se),await Me(se)},re=async R=>{if(R===ae.length-1)return;const se=[...ae];[se[R],se[R+1]]=[se[R+1],se[R]],W(se),await Me(se)},Me=async R=>{try{await Promise.all(R.map((se,Ye)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${se.id}`,{sort_order:Ye},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),L("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(se){L("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),me(Be.id)}},Ae=()=>{Xe(null),nt(!0)},Qe=R=>{Lt(R),an(!0),T(!0)},Ue=async(R,se="modal")=>{try{!qe&&A&&(R.parent_id=A.id);const Ye=qe?`${API_BASE}/api/video-folders/${qe.id}`:`${API_BASE}/api/video-folders`;qe?await window.KTM.api.putJSON(Ye,R,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Ye,R,"L\u1ED7i l\u01B0u folder"),L(qe?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),se==="drawer"?(T(!1),Xe(null),le(A==null?void 0:A.id),qe&&Ze&&Lt({...Ze,...R})):(nt(!1),Xe(null),le(A==null?void 0:A.id))}catch(Ye){L(Ye.message,"danger")}},Tt=async R=>{const se=R.subfolderCount>0?`X\xF3a folder "${R.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${R.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(se))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${R.id}`,"L\u1ED7i x\xF3a folder"),L("\u0110\xE3 x\xF3a folder","success"),Se(null),le(A==null?void 0:A.id)}catch(Ye){L("L\u1ED7i x\xF3a folder","danger")}},Ot=R=>{R.subfolderCount>0?(Ne(se=>[...se,R]),H(R),le(R.id)):(Se(R),W(R.videos||[]))},_e=R=>{if(R==="root")Ne([]),H(null),le(null);else if(R){const se=ye.findIndex(Ye=>Ye.id===R.id);se>=0&&(Ne(ye.slice(0,se+1)),H(R),le(R.id))}else{const se=[...ye];se.pop();const Ye=se[se.length-1]||null;Ne(se),H(Ye),le(Ye==null?void 0:Ye.id)}},it=()=>{an(!1),T(!1),Lt(null)},Qt=()=>{At(!1),yt(!1),tt(null)},$t=()=>{pt(null),Le(!0)},ln=R=>{tt(R),At(!0),yt(!0)},Ft=async(R,se="modal")=>{try{R.folder_id=Be==null?void 0:Be.id;const Ye=B?`${API_BASE}/api/videos/${B.id}`:`${API_BASE}/api/videos`;B?await window.KTM.api.putJSON(Ye,R,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Ye,R,"L\u1ED7i l\u01B0u video"),L(B?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),se==="drawer"?(yt(!1),pt(null),le(),Be&&me(Be.id),B&&We&&tt({...We,...R})):(Le(!1),pt(null),le(),Be&&me(Be.id))}catch(Ye){L(Ye.message,"danger")}},hn=async R=>{if(confirm(`X\xF3a video "${R.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${R.id}`,"L\u1ED7i x\xF3a video"),L("\u0110\xE3 x\xF3a video","success"),le(),Be&&me(Be.id)}catch(se){L("L\u1ED7i x\xF3a video","danger")}},gn=R=>{const se=`https://www.youtube.com/watch?v=${R.youtubeId}`;window.KTM.clipboard.writeText(se).then(()=>{L("\u0110\xE3 copy link!","success")}).catch(()=>{L("Kh\xF4ng th\u1EC3 copy link","danger")})};return Be?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Se(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${Be.slug==="shorts"?"text-danger":"text-warning"}`}),Be.name)),React.createElement("button",{className:"btn btn-warning",onClick:$t},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),ae.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},ae.map((R,se)=>React.createElement("div",{key:R.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>Y(se),disabled:se===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},se+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>re(se),disabled:se===ae.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:R.thumb,className:"card-img-top",alt:R.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${R.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:R.title},R.title),React.createElement("small",{className:"text-muted"},R.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>gn(R),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>ln(R),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>hn(R),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:ue,video:B,onClose:()=>Le(!1),onSave:Ft}),React.createElement(AdminDrawer,{open:Kt,title:Ze?Ze.name:"Folder",subtitle:Ze?`${Ze.subfolderCount||0} subfolder \u2022 ${Ze.videoCount||0} videos`:"",onClose:it,footer:jt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:it},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Ze&&Ue({name:Ze.name||"",description:Ze.description||"",sortOrder:Ze.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Ze?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Ze.name),L("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{T(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Ze.name}"?`)&&(Tt(Ze),it())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},jt&&Ze?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Ze.name||"",onChange:R=>Lt({...Ze,name:R.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Ze.description||"",onChange:R=>Lt({...Ze,description:R.target.value})}))):Ze?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Ze.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Ze.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Ze.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Ze.videoCount||0))),Ze.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Ze.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:gt,title:We?We.title:"Video",subtitle:We?`${We.youtubeId}`:"",onClose:Qt,footer:Re?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:Qt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{We&&Ft({youtube_url:`https://www.youtube.com/watch?v=${We.youtubeId}`,title:We.title||"",thumbnail_url:We.thumb||"",sort_order:We.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):We?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const R=`https://www.youtube.com/watch?v=${We.youtubeId}`;window.KTM.clipboard.writeText(R).then(()=>{L("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{yt(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${We.title}"?`)&&(hn(We),Qt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},Re&&We?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:We.title||"",onChange:R=>tt({...We,title:R.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:We.youtubeId||"",onChange:R=>tt({...We,youtubeId:R.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:We.sortOrder||0,onChange:R=>tt({...We,sortOrder:parseInt(R.target.value)||0})}))):We?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},We.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},We.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},We.sortOrder||0))),We.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:We.thumb,alt:We.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},A&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>_e()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),A?A.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:Ae},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),ye.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:R=>{R.preventDefault(),_e("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ye.map((R,se)=>React.createElement("li",{key:R.id,className:`breadcrumb-item ${se===ye.length-1?"active":""}`},se===ye.length-1?R.name:React.createElement("a",{href:"#",onClick:Ye=>{Ye.preventDefault(),_e(R)},className:"text-warning"},R.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),X?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):j.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},A?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Ae},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",A?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},j.map((R,se)=>{var Ye,Bt,fn,zt;return React.createElement("div",{key:R.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Gt=>{Gt.stopPropagation(),Te(se)},disabled:se===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},se+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Gt=>{Gt.stopPropagation(),x(se)},disabled:se===j.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>Ot(R),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${R.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},R.name),React.createElement("p",{className:"text-muted mb-0"},R.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),R.subfolderCount," folder"),R.subfolderCount>0&&(R.videoCount>0||((Ye=R.videos)==null?void 0:Ye.length)>0)&&" \u2022 ",(R.videoCount>0||((Bt=R.videos)==null?void 0:Bt.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),R.videoCount||((fn=R.videos)==null?void 0:fn.length)||0," videos"),R.subfolderCount===0&&!R.videoCount&&!((zt=R.videos)!=null&&zt.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Gt=>{Gt.stopPropagation(),Qe(R)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Gt=>{Gt.stopPropagation(),Tt(R)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Ge,folder:qe,onClose:()=>nt(!1),onSave:Ue}))}function VideoFolderModal({show:D,folder:L,onClose:j,onSave:ve}){const[ae,W]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[X,Ee]=useState(!1),[Be,Se]=useState(!1);useEffect(()=>{W(L?{name:L.name||"",description:L.description||"",sortOrder:L.sortOrder||0,coverImage:L.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[L,D]);const Ge=async qe=>{const Xe=qe.target.files[0];if(Xe){Se(!0);try{const ue=await window.KTM.cloudinary.uploadImage({file:Xe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});ue.secure_url&&W(Le=>({...Le,coverImage:ue.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(ue){console.error("Cloudinary upload error:",ue),alert("L\u1ED7i upload \u1EA3nh: "+(ue.message||ue))}finally{Se(!1)}}},nt=async qe=>{qe.preventDefault(),Ee(!0);const Xe={...ae,variants:normalizeVariants(ae.variants,ae.price),attributes:normalizeAttributes(ae.attributes)};await ve(Xe),Ee(!1)};return D?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},L?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:nt},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:ae.name,onChange:qe=>W({...ae,name:qe.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:ae.description,onChange:qe=>W({...ae,description:qe.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ae.sortOrder,onChange:qe=>W({...ae,sortOrder:parseInt(qe.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},ae.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:ae.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>W({...ae,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Ge,disabled:Be}),Be&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:ae.coverImage,onChange:qe=>W({...ae,coverImage:qe.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:D,settings:L}){const[j,ve]=useState([]),[ae,W]=useState(!0),[X,Ee]=useState(!1),[Be,Se]=useState(null),[Ge,nt]=useState(""),[qe,Xe]=useState(""),[ue,Le]=useState(!1),[B,pt]=useState(null),gt=normalizeShipPercent(L==null?void 0:L.ship_percent),{parseMoney:At,formatVND:We}=window.KTM.money,tt=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Re()},[]);const Re=async()=>{W(!0);try{const x=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");ve(Array.isArray(x)?x:[])}catch(x){console.error(x),D("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}W(!1)},yt=()=>{Se(null),Ee(!0)},Kt=x=>{Se(x),Ee(!0)},an=x=>{x&&(pt(x),Le(!0))},Ze=()=>{Le(!1)},Lt=async x=>{if(!(!x||!x.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:x},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),D(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Re()}catch(F){D("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},jt=async x=>{try{const F=Be?`${API_BASE}/api/products?id=${Be.id}`:`${API_BASE}/api/products`;Be?await window.KTM.api.putJSON(F,x,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(F,x,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),D(Be?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Ee(!1),Re()}catch(F){D(F.message,"danger")}},T=async x=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${x.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${x.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),D("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Re()}catch(F){D(F.message,"danger")}},A=j.filter(x=>{const F=!Ge||x.name.toLowerCase().includes(Ge.toLowerCase())||x.code&&x.code.toLowerCase().includes(Ge.toLowerCase()),Y=!qe||x.category===qe;return F&&Y}),H=x=>{var re;const F=(re=x==null?void 0:x.commission_percent)!=null?re:x==null?void 0:x.commissionPercent,Y=F===""||F==null?NaN:Number(F);return Number.isFinite(Y)?Math.max(0,Math.min(100,Y)):5},ye=x=>{const F=H(x),Y=Number.isInteger(F)?String(F):String(Math.round(F*100)/100),re=At(x==null?void 0:x.price);if(!Number.isFinite(re)||re<=0)return`${Y}%`;const Me=(Number(F)||0)/100,Qe=window.KTM.money.parseShipFeeFromNote(x==null?void 0:x.note)!=null?0:gt>0?re*gt/100:0,Ue=re*Me-Qe*Me,Tt=Math.max(0,Math.round(Ue));return`${Y}% - ${We(Tt)}`},Ne=x=>{if(x==null||x==="")return[];let F=x;if(typeof F=="string"){const Y=F.trim();if(!Y)return[];try{F=JSON.parse(Y)}catch(re){return[]}}return Array.isArray(F)?F:[]},le=x=>{if(x==null||x==="")return[];let F=x;if(typeof F=="string"){const Y=F.trim();if(!Y)return[];try{F=JSON.parse(Y)}catch(re){return[]}}return F&&typeof F=="object"&&!Array.isArray(F)&&(F=Object.entries(F).map(([Y,re])=>({key:Y,value:re}))),Array.isArray(F)?F:[]},me=x=>{const F=le(x).map(Y=>{var re,Me,Ae,Qe,Ue;return{key:String((Ae=(Me=(re=Y==null?void 0:Y.key)!=null?re:Y==null?void 0:Y.name)!=null?Me:Y==null?void 0:Y.label)!=null?Ae:"").trim(),value:String((Qe=Y==null?void 0:Y.value)!=null?Qe:"").trim(),unit:String((Ue=Y==null?void 0:Y.unit)!=null?Ue:"").trim()}}).filter(Y=>!!Y.key);return F.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},F.map((Y,re)=>{const Me=Y.key,Ae=`${Y.value||""}${Y.unit?(Y.value?" ":"")+Y.unit:""}`.trim();return React.createElement("div",{key:`${Me}-${re}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Me),Ae?React.createElement("span",{className:"ktm-chip ktm-chip-option"},Ae):null)}))):null},Te=(x,F={})=>{const Y=Ne(x).map(Qe=>{var Ue;return{name:String((Ue=Qe==null?void 0:Qe.name)!=null?Ue:"").trim(),options:Array.isArray(Qe==null?void 0:Qe.options)?Qe.options:[]}}).map(Qe=>({...Qe,options:Qe.options.map(Ue=>{var Tt;return{label:String((Tt=Ue==null?void 0:Ue.label)!=null?Tt:"").trim(),price:Number(Ue==null?void 0:Ue.price)}}).filter(Ue=>!!Ue.label)})).filter(Qe=>Qe.options.length>0);if(!Y.length)return null;const re=Number.isFinite(F.maxGroups)?Math.max(1,Math.trunc(F.maxGroups)):Y.length,Me=Number.isFinite(F.maxOptionsPerGroup)?Math.max(1,Math.trunc(F.maxOptionsPerGroup)):4,Ae=Y.slice(0,re);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Ae.map((Qe,Ue)=>{const Tt=Qe.name||"Bi\u1EBFn th\u1EC3",Ot=Qe.options.slice(0,Me),_e=Qe.options.length-Ot.length;return React.createElement("div",{key:`${Tt}-${Ue}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Tt),Ot.map((it,Qt)=>{const $t=it.price,ln=Number.isFinite($t)&&$t>=0?We(Math.trunc($t)):"",Ft=ln?`${it.label} \xB7 ${ln}`:it.label;return React.createElement("span",{key:`${Tt}-${Ue}-${Qt}`,className:"ktm-chip ktm-chip-option"},Ft)}),_e>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",_e))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:yt},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:Ge,onChange:x=>nt(x.target.value)})),React.createElement("span",{className:"product-count"},A.length)),React.createElement("select",{className:"form-select",value:qe,onChange:x=>Xe(x.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),tt.map(x=>React.createElement("option",{key:x,value:x},x)))),ae?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):A.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:yt},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},A.map(x=>React.createElement("div",{key:x.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>an(x),onKeyDown:F=>{(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),an(x))},title:"Xem chi ti\u1EBFt"},x.image?React.createElement("img",{src:x.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},x.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},x.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},x.category),x.code&&React.createElement("span",{className:"product-badge bg-secondary"},x.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),ye(x))),React.createElement("div",{className:"product-price"},x.price?x.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),x.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},x.note),me(x.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},me(x.attributes)),Te(x.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},Te(x.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:F=>{F.stopPropagation(),Kt(x)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:F=>{F.stopPropagation(),T(x)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:ue,title:String((B==null?void 0:B.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((B==null?void 0:B.code)||"").trim()||null,String((B==null?void 0:B.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Ze,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const x=String((B==null?void 0:B.code)||"").trim();x&&window.KTM.clipboard.writeText(x).then(()=>D("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((B==null?void 0:B.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const x=String((B==null?void 0:B.price)||"").trim();x&&window.KTM.clipboard.writeText(x).then(()=>D("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((B==null?void 0:B.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>B&&Kt(B),disabled:!B},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>B&&T(B),disabled:!B},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},B?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const x=String((B==null?void 0:B.price)||"").trim(),F=At(x);return Number.isFinite(F)&&F>0?We(Math.trunc(F)):x||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},ye(B)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},B.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},B.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),B.image?React.createElement("img",{src:B.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(B.note||"").trim()||B.attributes||B.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(B.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(B.note||"").trim()),me(B.attributes)?React.createElement("div",{className:"mt-2"},me(B.attributes)):null,Te(B.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},Te(B.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:X,product:Be,categories:tt,onClose:()=>Ee(!1),onSave:jt}))}function ProductModal({show:D,product:L,categories:j,onClose:ve,onSave:ae}){const[W,X]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Ee,Be]=useState(!1),[Se,Ge]=useState(!1),nt=T=>{const A=window.KTM.money.getDigits(String(T!=null?T:"")),H=Number(A);return A&&Number.isFinite(H)?Math.trunc(H):0},qe=T=>{if(T==null||T==="")return[];let A=T;if(typeof A=="string"){const H=A.trim();if(!H)return[];try{A=JSON.parse(H)}catch(ye){return[]}}return A&&typeof A=="object"&&!Array.isArray(A)&&(A=Object.entries(A).map(([H,ye])=>({key:H,value:ye}))),Array.isArray(A)?A.map(H=>{var me,Te,x,F,Y;if(!H||typeof H!="object")return null;const ye=String((x=(Te=(me=H.key)!=null?me:H.name)!=null?Te:H.label)!=null?x:"").trim(),Ne=String((F=H.value)!=null?F:"").trim(),le=String((Y=H.unit)!=null?Y:"").trim();return ye?{key:ye,value:Ne,unit:le}:null}).filter(Boolean):[]},Xe=(T,A)=>{if(T==null||T==="")return[];let H=T;if(typeof H=="string"){const Ne=H.trim();if(!Ne)return[];try{H=JSON.parse(Ne)}catch(le){return[]}}if(!Array.isArray(H))return[];const ye=nt(A);return H.map(Ne=>{var Te;if(!Ne||typeof Ne!="object")return null;const le=String((Te=Ne.name)!=null?Te:"").trim(),me=(Array.isArray(Ne.options)?Ne.options:[]).map(x=>{var Qe,Ue,Tt,Ot,_e,it,Qt;if(!x||typeof x!="object")return null;const F=String((Qe=x.label)!=null?Qe:"").trim();if(!F)return null;const Y=(_e=(Ot=(Tt=(Ue=x.price)!=null?Ue:x.priceValue)!=null?Tt:x.unit_price)!=null?Ot:x.unitPrice)!=null?_e:null,re=Number(Y);let Me=Number.isFinite(re)?Math.trunc(re):null;if(Me==null){const $t=(Qt=(it=x.price_delta)!=null?it:x.priceDelta)!=null?Qt:null,ln=Number($t);Number.isFinite(ln)&&(Me=ye+Math.trunc(ln))}Me==null&&(Me=ye);const Ae=String(Math.max(0,Math.trunc(Number(Me)||0)));return{label:F,price:Math.max(0,Math.trunc(Number(Me)||0)),priceDigits:Ae}}).filter(Boolean);return{name:le||"Bi\u1EBFn th\u1EC3",options:me}}).filter(Boolean)};useEffect(()=>{var T,A;X(L?{name:L.name||"",code:L.code||"",price:L.price||"",image:L.image||"",category:L.category||"",note:L.note||"",sort_order:L.sort_order||0,commission_percent:(A=(T=L.commission_percent)!=null?T:L.commissionPercent)!=null?A:5,variants:Xe(L.variants,L.price),attributes:qe(L.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[L,D]);const ue=T=>{X(A=>{var me;const H=nt(A.price),ye=String(H),Ne=Array.isArray(A.variants)?[...A.variants]:[],le={...Ne[T]||{},options:Array.isArray((me=Ne[T])==null?void 0:me.options)?[...Ne[T].options]:[]};return le.options=le.options.map(Te=>({label:String((Te==null?void 0:Te.label)||""),price:H,priceDigits:ye})),Ne[T]=le,{...A,variants:Ne}})},Le=()=>{X(T=>{const A=nt(T.price),H=String(A),Ne=(Array.isArray(T.variants)?[...T.variants]:[]).map(le=>{const me=(Array.isArray(le==null?void 0:le.options)?le.options:[]).map(Te=>({label:String((Te==null?void 0:Te.label)||""),price:A,priceDigits:H}));return{name:String((le==null?void 0:le.name)||"Bi\u1EBFn th\u1EC3"),options:me}});return{...T,variants:Ne}})},[B,pt]=React.useState(""),gt=T=>window.KTM.money.formatVNDInputDigits(T),[At,We]=React.useState(""),tt=T=>{const A=window.KTM.money.nextPriceInputState(T.target.value,At);We(A.digits),X({...W,price:A.price})},[Re,yt]=React.useState("");React.useEffect(()=>{L!=null&&L.image&&yt(L.image)},[L]);const Kt=async T=>{if(!(!T||!T.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:T},"L\u1ED7i x\xF3a \u1EA3nh")}catch(A){console.error("Delete cloudinary image error:",A)}},an=async(T,A=2,H)=>{const ye=A*1024*1024,Ne=T.type==="image/heic"||T.type==="image/heif"||/\.heic$/i.test(T.name);if(T.size<=ye&&!Ne)return T;H==null||H("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const le=await createImageBitmap(T);H==null||H("\u0110ang n\xE9n \u1EA3nh...");const me=document.createElement("canvas");let Te=le.width,x=le.height;const F=1200;return(Te>F||x>F)&&(Te>x?(x=Math.round(x/Te*F),Te=F):(Te=Math.round(Te/x*F),x=F)),me.width=Te,me.height=x,me.getContext("2d").drawImage(le,0,0,Te,x),le.close(),new Promise((re,Me)=>{me.toBlob(Ae=>{Ae?(H==null||H("Ho\xE0n t\u1EA5t!"),re(new File([Ae],T.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):Me(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(le){throw console.error("createImageBitmap error:",le),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ze=async T=>{var ye,Ne;const A=(ye=T.target.files)==null?void 0:ye[0];if(!A)return;if(!(A.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(A.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ge(!0),pt("\u0110ang chu\u1EA9n b\u1ECB...");try{const le=(A.size/1024/1024).toFixed(1);pt(`File ${le}MB - \u0110ang n\xE9n...`);const me=await an(A,2,F=>{pt(F)}),Te=(me.size/1024/1024).toFixed(1);pt(`\u0110\xE3 n\xE9n: ${Te}MB - \u0110ang upload...`);const x=await window.KTM.cloudinary.uploadImage({file:me,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});x.secure_url?(W.image&&W.image!==Re&&Kt(W.image),X(F=>({...F,image:x.secure_url})),pt("")):(console.error("Cloudinary error:",x),alert("Upload th\u1EA5t b\u1EA1i: "+(((Ne=x.error)==null?void 0:Ne.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),pt(""))}catch(le){console.error("Upload error:",le),alert("L\u1ED7i: "+le.message),pt("")}Ge(!1),T.target.value=""},Lt=()=>{W.image&&(W.image!==Re&&Kt(W.image),X(T=>({...T,image:""})))},jt=async T=>{T.preventDefault(),Be(!0),Re&&W.image&&Re!==W.image&&await Kt(Re),Re&&!W.image&&await Kt(Re),await ae(W),Be(!1)};return D?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${L?"fa-edit":"fa-plus-circle"} me-2`}),L?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:ve})),React.createElement("form",{onSubmit:jt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},W.image?React.createElement(React.Fragment,null,React.createElement("img",{src:W.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Lt,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Se?"fa-spinner fa-spin":"fa-camera"} me-1`}),Se?B||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Ze,disabled:Se,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Se&&B&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},B))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:W.name,onChange:T=>X({...W,name:T.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:W.code,onChange:T=>X({...W,code:T.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:W.price,onChange:tt,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:W.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:T=>X({...W,commission_percent:T.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:W.category,onChange:T=>X({...W,category:T.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),j.map(T=>React.createElement("option",{key:T,value:T},T)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:W.note,onChange:T=>X({...W,note:T.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(W.attributes)?W.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(W.attributes)?W.attributes:[]).map((T,A)=>React.createElement("div",{key:A,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(T==null?void 0:T.key)||"",onChange:H=>{const ye=H.target.value;X(Ne=>{const le=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return le[A]={...le[A]||{},key:ye},{...Ne,attributes:le}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(T==null?void 0:T.value)||"",onChange:H=>{const ye=H.target.value;X(Ne=>{const le=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return le[A]={...le[A]||{},value:ye},{...Ne,attributes:le}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(T==null?void 0:T.unit)||"",onChange:H=>{const ye=H.target.value;X(Ne=>{const le=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return le[A]={...le[A]||{},unit:ye},{...Ne,attributes:le}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(H=>{const ye=Array.isArray(H.attributes)?[...H.attributes]:[];return ye.splice(A,1),{...H,attributes:ye}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{X(T=>{const A=Array.isArray(T.attributes)?[...T.attributes]:[];return A.push({key:"",value:"",unit:""}),{...T,attributes:A}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(W.variants)?W.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(W.variants)?W.variants:[]).map((T,A)=>React.createElement("div",{key:A,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(T==null?void 0:T.name)||"",onChange:H=>{const ye=H.target.value;X(Ne=>{var me;const le=Array.isArray(Ne.variants)?[...Ne.variants]:[];return le[A]={...le[A]||{},name:ye,options:Array.isArray((me=le[A])==null?void 0:me.options)?le[A].options:[]},{...Ne,variants:le}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ue(A),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(T==null?void 0:T.options)||T.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{X(H=>{const ye=Array.isArray(H.variants)?[...H.variants]:[];return ye.splice(A,1),{...H,variants:ye}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(T==null?void 0:T.options)?T.options:[]).map((H,ye)=>{var Ne,le;return React.createElement("div",{key:ye,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(H==null?void 0:H.label)||"",onChange:me=>{const Te=me.target.value;X(x=>{var Ae,Qe,Ue,Tt,Ot;const F=Array.isArray(x.variants)?[...x.variants]:[],Y={...F[A]||{},options:Array.isArray((Ae=F[A])==null?void 0:Ae.options)?[...F[A].options]:[]},re=Number((Ue=(Qe=Y.options[ye])==null?void 0:Qe.price)!=null?Ue:0)||0,Me=String((Ot=(Tt=Y.options[ye])==null?void 0:Tt.priceDigits)!=null?Ot:Math.max(0,Math.trunc(re)));return Y.options[ye]={...Y.options[ye]||{},label:Te,price:Math.max(0,Math.trunc(re)),priceDigits:Me},F[A]=Y,{...x,variants:F}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:gt(String((le=H==null?void 0:H.priceDigits)!=null?le:window.KTM.money.getDigits(String((Ne=H==null?void 0:H.price)!=null?Ne:"")))),onChange:me=>{X(Te=>{var Ue,Tt,Ot,_e,it;const x=String((Tt=H==null?void 0:H.priceDigits)!=null?Tt:window.KTM.money.getDigits(String((Ue=H==null?void 0:H.price)!=null?Ue:""))),F=window.KTM.money.nextPriceInputState(me.target.value,x),Y=String((Ot=F.digits)!=null?Ot:""),re=Number(Y),Me=Number.isFinite(re)?Math.max(0,Math.trunc(re)):0,Ae=Array.isArray(Te.variants)?[...Te.variants]:[],Qe={...Ae[A]||{},options:Array.isArray((_e=Ae[A])==null?void 0:_e.options)?[...Ae[A].options]:[]};return Qe.options[ye]={...Qe.options[ye]||{},label:String(((it=Qe.options[ye])==null?void 0:it.label)||""),price:Me,priceDigits:Y},Ae[A]=Qe,{...Te,variants:Ae}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(me=>{var F;const Te=Array.isArray(me.variants)?[...me.variants]:[],x={...Te[A]||{},options:Array.isArray((F=Te[A])==null?void 0:F.options)?[...Te[A].options]:[]};return x.options.splice(ye,1),Te[A]=x,{...me,variants:Te}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{X(H=>{var me;const ye=Array.isArray(H.variants)?[...H.variants]:[],Ne={...ye[A]||{},options:Array.isArray((me=ye[A])==null?void 0:me.options)?[...ye[A].options]:[]},le=nt(H.price);return Ne.options.push({label:"",price:le,priceDigits:String(le)}),ye[A]=Ne,{...H,variants:ye}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{X(T=>{const A=nt(T.price),H=Array.isArray(T.variants)?[...T.variants]:[],ye=String(A);return H.push({name:"Size",options:[{label:"S",price:A,priceDigits:ye},{label:"M",price:A,priceDigits:ye},{label:"L",price:A,priceDigits:ye}]}),{...T,variants:H}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Le,disabled:!Array.isArray(W.variants)||W.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:W.image,onChange:T=>X({...W,image:T.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:ve,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Ee,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Ee?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:D,video:L,onClose:j,onSave:ve}){const[ae,W]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[X,Ee]=useState(!1),[Be,Se]=useState("");useEffect(()=>{L?(W({title:L.title||"",youtube_url:`https://www.youtube.com/watch?v=${L.youtubeId}`,thumbnail_url:L.thumb||"",sort_order:L.sortOrder||0}),Se(L.thumb)):(W({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Se(""))},[L,D]);const Ge=Xe=>{const ue=Xe.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return ue?ue[1]:null},nt=Xe=>{W({...ae,youtube_url:Xe});const ue=Ge(Xe);ue&&Se(`https://img.youtube.com/vi/${ue}/hqdefault.jpg`)},qe=async Xe=>{Xe.preventDefault(),Ee(!0),await ve(ae),Ee(!1)};return D?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},L?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:qe},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:ae.youtube_url,onChange:Xe=>nt(Xe.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),Be&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:Be,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:ae.title,onChange:Xe=>W({...ae,title:Xe.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ae.sort_order,onChange:Xe=>W({...ae,sort_order:parseInt(Xe.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:ae.thumbnail_url,onChange:Xe=>W({...ae,thumbnail_url:Xe.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:j},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:X},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function getCurrentMonth(){const D=new Date,L=D.getFullYear(),j=String(D.getMonth()+1).padStart(2,"0");return`${L}-${j}`}function ReconExcelManager({showToast:D}){var dt;const L=typeof D=="function"?D:()=>{},[j,ve]=useState(getCurrentMonth()),ae=j,W=ve,[X,Ee]=useState(!1),[Be,Se]=useState(""),[Ge,nt]=useState(""),[qe,Xe]=useState(""),[ue,Le]=useState(null),[B,pt]=useState("all"),[gt,At]=useState(""),[We,tt]=useState(!0),[Re,yt]=useState(!0),[Kt,an]=useState(!1),[Ze,Lt]=useState("created_at"),[jt,T]=useState(!1),[A,H]=useState(0),[ye,Ne]=useState(!1),[le,me]=useState(""),[Te,x]=useState(()=>new Set),[F,Y]=useState(!1),[re,Me]=useState(null),Ae=useRef(new Map),Qe=useRef(new Map),Ue=useRef(null),[Tt,Ot]=useState(()=>{var r;return(r=window==null?void 0:window.XLSX)!=null&&r.read?"ready":"loading"}),_e=r=>new Promise((c,w)=>{var f;try{if(!r)return c();const M=String(r),q=document.querySelector(`script[data-ktm-src="${M}"]`)||document.querySelector(`script[src="${M}"]`);if(q){if(q.getAttribute("data-ktm-loaded")==="1"||(f=window==null?void 0:window.XLSX)!=null&&f.read)return c();q.addEventListener("load",()=>c(),{once:!0}),q.addEventListener("error",()=>w(new Error(`Failed to load ${M}`)),{once:!0});return}const E=document.createElement("script");E.src=M,E.async=!0,E.defer=!0,E.setAttribute("data-ktm-src",M),E.addEventListener("load",()=>{E.setAttribute("data-ktm-loaded","1"),c()},{once:!0}),E.addEventListener("error",()=>w(new Error(`Failed to load ${M}`)),{once:!0}),document.head.appendChild(E)}catch(M){w(M)}}),it=()=>!!(window!=null&&window.XLSX&&typeof window.XLSX.read=="function"),Qt=async()=>{if(it())return Ot("ready"),!0;if(Ue.current)return Ue.current;const r=["https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js","https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js","https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"],c=async w=>{const f=Date.now();for(;Date.now()-f<w;){if(it())return!0;await new Promise(M=>setTimeout(M,50))}return it()};return Ot("loading"),Ue.current=(async()=>{try{for(const w of r)try{if(await _e(w),await c(1500))return Ot("ready"),!0}catch(f){}return Ot("failed"),!1}finally{Ue.current=null}})(),Ue.current};useEffect(()=>{if(it()){Ot("ready");return}Qt()},[]);const $t=r=>{const c=[],w=String(r!=null?r:"").split(/\s+/g);for(const f of w){const M=String(f||"").trim();M&&c.push(M)}return c.join(" ").replace(/\s+/g," ").trim()},ln=r=>{try{return String(r!=null?r:"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,c=>c==="\u0111"?"d":"D")}catch(c){return String(r!=null?r:"").replace(/[đĐ]/g,w=>w==="\u0111"?"d":"D")}},Ft=r=>{const c=$t(String(r!=null?r:""));return c?ln(c).toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim():""},hn=r=>{const c=Ft(r);return c?c.replace(/\b(combo|set|sp|san\s*pham|sanpham|hang|ship|freeship|free\s*ship)\b/g," ").replace(/\s+/g," ").trim():""},gn=r=>{var q,E;if(r==null||r==="")return"";if(typeof r=="number"&&Number.isFinite(r)&&((E=(q=window==null?void 0:window.XLSX)==null?void 0:q.SSF)!=null&&E.parse_date_code))try{const b=window.XLSX.SSF.parse_date_code(r);return!b||!b.y||!b.m?"":`${String(b.y).padStart(4,"0")}-${String(b.m).padStart(2,"0")}`}catch(b){}const c=String(r).trim(),w=c.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(w){const b=String(Number(w[2])||0).padStart(2,"0");return`${w[3]}-${b}`}const f=c.match(/^(\d{4})-(\d{2})-(\d{2})/);if(f)return`${f[1]}-${f[2]}`;const M=new Date(c);return Number.isNaN(M.getTime())?"":`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}`},R=r=>{var q,E;if(r==null||r==="")return"";if(typeof r=="number"&&Number.isFinite(r)&&((E=(q=window==null?void 0:window.XLSX)==null?void 0:q.SSF)!=null&&E.parse_date_code))try{const b=window.XLSX.SSF.parse_date_code(r);return!b||!b.y||!b.m||!b.d?"":`${String(b.y).padStart(4,"0")}-${String(b.m).padStart(2,"0")}-${String(b.d).padStart(2,"0")}`}catch(b){}const c=String(r).trim(),w=c.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(w){const b=String(Number(w[1])||0).padStart(2,"0"),C=String(Number(w[2])||0).padStart(2,"0");return`${w[3]}-${C}-${b}`}const f=c.match(/^(\d{4})-(\d{2})-(\d{2})/);if(f)return`${f[1]}-${f[2]}-${f[3]}`;const M=new Date(c);return Number.isNaN(M.getTime())?"":`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}-${String(M.getDate()).padStart(2,"0")}`},se=r=>{if(r==null||r==="")return 0;if(typeof r=="number"&&Number.isFinite(r))return Math.trunc(r);const c=String(r!=null?r:"").trim();if(!c)return 0;try{const q=window.KTM.money.parseMoney(c);if(Number.isFinite(q)&&q>0)return Math.trunc(q)}catch(q){}const f=c.toLowerCase().replace(/vnd|đ|d/g," ").replace(/\s+/g," ").trim().replace(/[^0-9]/g,"");if(!f)return 0;const M=Number(f);return Number.isFinite(M)?Math.trunc(M):0},Ye=r=>{var w,f;let c="";try{(f=(w=window==null?void 0:window.KTM)==null?void 0:w.phone)!=null&&f.normalize&&(c=window.KTM.phone.normalize(r))}catch(M){}return c||(c=String(r!=null?r:"").replace(/[^0-9]/g,"")),c=String(c||"").replace(/[^0-9]/g,""),c?(c.startsWith("840")?c=`0${c.slice(3)}`:c.startsWith("84")&&(c.length===11?c=`0${c.slice(2)}`:c.length===12&&c[2]!=="0"&&(c=`0${c.slice(2)}`)),c.length===9&&(c=`0${c}`),c):""},Bt=(r,c)=>{try{const w=Array.isArray(c)?c:[],f=C=>{const _=String(C!=null?C:"");return/[\n\r",]/.test(_)?`"${_.replace(/"/g,'""')}"`:_},M=w.map(C=>Array.isArray(C)?C.map(f).join(","):"").join(`
`),q=new Blob([`\uFEFF${M}`],{type:"text/csv;charset=utf-8"}),E=URL.createObjectURL(q),b=document.createElement("a");b.href=E,b.download=r,document.body.appendChild(b),b.click(),setTimeout(()=>{try{URL.revokeObjectURL(E)}catch(C){}try{b.remove()}catch(C){}},0)}catch(w){}},fn=r=>{const c=String(r!=null?r:"");if(!c.trim())return{phone:"",phoneNorm:"",cleanedText:String(r!=null?r:"").trim()};const w=/(?:\+?84|0)\s*[0-9\s\-.()]{8,16}/g;let f=null,M;for(;(M=w.exec(c))!=null;){const C=M[0],_=Ye(C);_&&(_.length<9||_.length>12||(f={raw:C,digits:_}))}if(!f){const C=Ye(c);if(C.length>=9){const _=C.slice(-12);_.length>=9&&(f={raw:_,digits:_})}}if(!f)return{phone:"",phoneNorm:"",cleanedText:c.trim()};const q=f.digits,E=q;let b=c;return f.raw&&c.includes(f.raw)?b=b.replace(f.raw," "):b=b.replace(new RegExp(`${f.digits}$`)," "),b=b.replace(/[\-–—•|]+\s*$/g," ").replace(/\s+[\-–—•|]+\s*/g," ").replace(/\s+/g," ").trim(),{phone:E,phoneNorm:q,cleanedText:b}},zt=async()=>{var c;const r=Ae.current;if(r&&r.size>0)return r;try{const w=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m"),f=Array.isArray(w==null?void 0:w.products)?w.products:Array.isArray(w)?w:[],M=new Map;for(const q of f){const E=String((c=q==null?void 0:q.id)!=null?c:"").trim();E&&M.set(E,q)}return Ae.current=M,M}catch(w){return Ae.current=new Map,Ae.current}},Gt=r=>{var w;const c=String(r!=null?r:"").trim();return c&&((w=Ae.current)==null?void 0:w.get(c))||null},P=async r=>{var C,_,z;if(!r)throw new Error("Ch\u01B0a ch\u1ECDn file");const c=await r.arrayBuffer(),w=Number(r.size||0)||0;if(!!!(window!=null&&window.Worker&&typeof Blob!="undefined"&&typeof URL!="undefined")||w<450*1024){if(!((C=window==null?void 0:window.XLSX)!=null&&C.read))try{await Qt()}catch($e){}if(!((_=window==null?void 0:window.XLSX)!=null&&_.read))throw new Error("Thi\u1EBFu th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). Vui l\xF2ng t\u1EA3i l\u1EA1i trang admin.");const ne=window.XLSX.read(c,{type:"array"}),we=(z=ne==null?void 0:ne.SheetNames)==null?void 0:z[0],ie=we?ne.Sheets[we]:null;if(!ie)throw new Error("Kh\xF4ng \u0111\u1ECDc \u0111\u01B0\u1EE3c sheet trong file");return window.XLSX.utils.sheet_to_json(ie,{header:1,raw:!0,defval:""})}const M=`
					const sources = [
						'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js',
						'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js',
						'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js',
					];

					const hasXlsx = () => Boolean(self.XLSX && typeof self.XLSX.read === 'function');
					const ensureXlsx = async () => {
						if (hasXlsx()) return true;
						for (const src of sources) {
							try {
								self.importScripts(src);
								if (hasXlsx()) return true;
							} catch (e) {
								// try next
							}
						}
						return hasXlsx();
					};

					self.onmessage = async (ev) => {
						try {
							const data = ev && ev.data;
							const buf = data && data.buf;
							const ok = await ensureXlsx();
							if (!ok) throw new Error('XLSX not available');
							const wb = self.XLSX.read(buf, { type: 'array' });
							const sheetName = wb && wb.SheetNames && wb.SheetNames[0];
							const ws = sheetName ? wb.Sheets[sheetName] : null;
							if (!ws) throw new Error('No sheet');
							const grid = self.XLSX.utils.sheet_to_json(ws, { header: 1, raw: true, defval: '' });
							self.postMessage({ ok: true, grid });
						} catch (e) {
							self.postMessage({ ok: false, error: String((e && e.message) || e || 'worker error') });
						}
					};
				`,q=new Blob([M],{type:"application/javascript"}),E=URL.createObjectURL(q),b=new Worker(E);try{return await new Promise((we,ie)=>{const $e=setTimeout(()=>{try{b.terminate()}catch(Ie){}ie(new Error("Worker timeout"))},12e3);b.onmessage=Ie=>{const Ve=Ie&&Ie.data;Ve&&Ve.ok?(clearTimeout($e),we(Ve.grid)):Ve&&Ve.ok===!1&&(clearTimeout($e),ie(new Error(Ve.error||"Worker failed")))},b.onerror=()=>{clearTimeout($e),ie(new Error("Worker error"))};try{b.postMessage({buf:c},[c])}catch(Ie){b.postMessage({buf:c})}})}finally{try{b.terminate()}catch(ne){}try{URL.revokeObjectURL(E)}catch(ne){}}},u=async r=>{var _,z;if(!r)throw new Error("Ch\u01B0a ch\u1ECDn file");const c=await P(r),w=Array.isArray(c)?c:[];if(!w.length)throw new Error("File r\u1ED7ng");const f={product:["ten san pham","tensanpham","san pham","t\xEAn s\u1EA3n ph\u1EA9m"],cod:["tong tien thu ho","t\u1ED5ng ti\u1EC1n thu h\u1ED9","thu ho","thu h\u1ED9","tong thu ho","t\u1ED5ng thu h\u1ED9"],date:["ngay","ng\xE0y","date"],phone:["sdt","s\u0111t","so dien thoai","s\u1ED1 \u0111i\u1EC7n tho\u1EA1i","dien thoai","\u0111i\u1EC7n tho\u1EA1i","phone"],qty:["sl","so luong","s\u1ED1 l\u01B0\u1EE3ng","qty","quantity"]},q=(()=>{const ne=Math.min(30,w.length);for(let we=0;we<ne;we++){const $e=(Array.isArray(w[we])?w[we]:[]).map(mt=>Ft(mt)),Ie=mt=>{for(let de=0;de<$e.length;de++){const He=$e[de];if(He&&mt.some(It=>He.includes(Ft(It))))return de}return-1},Ve=Ie(f.product),xe=Ie(f.cod);if(xe>=0){const mt=Ie(f.date),de=Ie(f.phone),He=Ie(f.qty);return{headerRow:we,productCol:Ve,codCol:xe,dateCol:mt,phoneCol:de,qtyCol:He}}}return null})();if(!q)throw new Error('Kh\xF4ng t\xECm th\u1EA5y header c\u1ED9t "T\u1ED5ng ti\u1EC1n thu h\u1ED9"');const E=[],b=new Set,C=ne=>{const we=String(ne!=null?ne:"").trim();if(!we)return{text:"",qty:null};let ie=we.match(/^\s*x\s*(\d{1,3})\s+(.+)$/i);return ie?{text:String(ie[2]||"").trim(),qty:Number(ie[1])}:(ie=we.match(/^\s*(\d{1,3})\s*(?:x|\*|×)?\s+(.+)$/i),ie?{text:String(ie[2]||"").trim(),qty:Number(ie[1])}:{text:we,qty:null})};for(let ne=q.headerRow+1;ne<w.length;ne++){const we=Array.isArray(w[ne])?w[ne]:[],ie=q.productCol>=0?String((_=we[q.productCol])!=null?_:"").trim():"",$e=C(ie),Ie=$e.text,Ve=se(we[q.codCol]),xe=q.qtyCol>=0?we[q.qtyCol]:"",mt=(()=>{if(xe!=null&&xe!==""){if(typeof xe=="number"&&Number.isFinite(xe))return{qty:Math.max(1,Math.trunc(xe)),source:"cell"};const Zt=String(xe).trim(),Mt=Number(Zt.replace(/[^0-9]/g,""));if(Number.isFinite(Mt)&&Mt>0)return{qty:Math.max(1,Math.trunc(Mt)),source:"cell"}}const Et=Number($e.qty);return Number.isFinite(Et)&&Et>1?{qty:Math.max(1,Math.trunc(Et)),source:"text"}:{qty:1,source:"default"}})(),de=mt.qty,He=mt.source,It=He==="cell"&&de>1&&Ve>0&&de<=50?Ve*de:0,St=Array.from(new Set([Ve,It].filter(Et=>Number(Et||0)>0))),vt=Ve;if(!Ie&&!vt)continue;const je=q.phoneCol>=0?String((z=we[q.phoneCol])!=null?z:"").trim():"",I=Ye(je);let oe=fn(Ie);if(I&&(oe={...oe,phone:I,phoneNorm:I}),!oe.phoneNorm){const Et=we.map(Mt=>String(Mt!=null?Mt:"")).join(" | "),Zt=fn(Et);Zt.phoneNorm&&(oe={...oe,phone:Zt.phone,phoneNorm:Zt.phoneNorm})}const ze=oe.cleanedText||Ie||"",ht=Ft(ze);if(ht&&(ht.includes("tong tien")||ht.includes("tong")||ht.includes("thanh toan")||ht.includes("thanh to\xE1n")))continue;const xt=q.dateCol>=0?we[q.dateCol]:"",Jt=xt?gn(xt):"";Jt&&b.add(Jt);const Nt=xt?R(xt):"";E.push({rowIndex:ne+1,dateRaw:xt,monthKey:Jt,dayKey:Nt,product:ze,productNorm:hn(ze),productCompact:hn(ze).replace(/\s+/g,""),phone:oe.phone,phoneNorm:oe.phoneNorm,cod:vt,codRaw:Ve,qty:de,qtySource:He,codAlt:It,codCandidates:St})}return{rows:E,monthKeys:Array.from(b.values()).sort()}},V=r=>{const c=new Map,w=(b,C)=>{const _=c.get(b)||{key:b,rows:[],phoneNorm:"",phone:"",monthKey:"",dayKey:""};_.rows.push(C),!_.phoneNorm&&C.phoneNorm&&(_.phoneNorm=C.phoneNorm,_.phone=C.phone||C.phoneNorm),!_.monthKey&&C.monthKey&&(_.monthKey=C.monthKey),!_.dayKey&&C.dayKey&&(_.dayKey=C.dayKey),c.set(b,_)};for(const b of Array.isArray(r)?r:[]){const C=String((b==null?void 0:b.phoneNorm)||"").trim(),_=String((b==null?void 0:b.dayKey)||"").trim(),z=String((b==null?void 0:b.monthKey)||"").trim();if(C){const ne=_?`p:${C}:d:${_}`:z?`p:${C}:m:${z}`:`p:${C}`;w(ne,b)}else w(`r:${b==null?void 0:b.rowIndex}`,b)}const f=b=>{const C=Number((b==null?void 0:b.cod)||0)||0;if(C>0)return C;const _=Number((b==null?void 0:b.codAlt)||0)||0;return _>0?_:0},M=b=>{var ne;const C=((b==null?void 0:b.rows)||[]).slice().filter(Boolean);if(C.length<=1)return[{key:b.key,rows:C,phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey}];const _=C.map(f).filter(we=>we>0),z=Array.from(new Set(_));if(b.phoneNorm&&b.dayKey&&z.length>1&&z.length<=8){const we=new Map;for(const $e of z)we.set(String($e),{key:`${b.key}:t:${$e}`,rows:[],phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey});const ie=[];for(const $e of C){const Ie=f($e);Ie>0?we.get(String(Ie)).rows.push($e):ie.push($e)}if(ie.length){const $e=Array.from(we.values()).map(Ie=>{const Ve=Ie.rows.find(xe=>String((xe==null?void 0:xe.productNorm)||"").trim())||null;return{group:Ie,seedNorm:String((Ve==null?void 0:Ve.productNorm)||"")}});for(const Ie of ie){const Ve=String((Ie==null?void 0:Ie.productNorm)||"");let xe=null,mt=-1;for(const de of $e){const He=Pe(Ve,de.seedNorm);He>mt&&(mt=He,xe=de.group)}(xe||((ne=$e[0])==null?void 0:ne.group)).rows.push(Ie)}}return Array.from(we.values()).filter($e=>$e.rows.length>0)}return[{key:b.key,rows:C,phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey}]},q=[];for(const b of c.values())q.push(...M(b));const E=b=>{var It,St,vt;const C=b.rows.slice().filter(Boolean),_=C.map(je=>je.rowIndex).filter(Boolean),z=[],ne=new Set;for(const je of C){const I=String((je==null?void 0:je.productNorm)||"").trim();I&&(ne.has(I)||(ne.add(I),z.push(String((je==null?void 0:je.product)||"").trim())))}const we=z.filter(Boolean).join(" + "),ie=Ft(we),$e=[];for(const je of C){const I=Array.isArray(je==null?void 0:je.codCandidates)?je.codCandidates:[];for(const oe of I){const ze=Number(oe||0)||0;ze>0&&$e.push(ze)}}const Ie=Array.from(new Set($e)).sort((je,I)=>je-I),Ve=C.map(je=>f(je)).filter(je=>je>0);let xe=0;if(!Ve.length)xe=0;else{const je=new Map;for(const oe of Ve)je.set(oe,(je.get(oe)||0)+1);const I=Array.from(je.keys());if(I.length===1)xe=I[0];else{let oe=null,ze=0;for(const[ht,xt]of je.entries())xt>ze&&(ze=xt,oe=ht);oe!=null&&ze>=2?xe=oe:xe=Ve.reduce((ht,xt)=>ht+xt,0)}}const mt=b.monthKey||((It=C.find(je=>je==null?void 0:je.monthKey))==null?void 0:It.monthKey)||"",de=((St=C.find(je=>je==null?void 0:je.dayKey))==null?void 0:St.dayKey)||"",He=((vt=C.find(je=>je==null?void 0:je.dateRaw))==null?void 0:vt.dateRaw)||"";return{key:b.key,phoneNorm:b.phoneNorm||"",phone:b.phone||b.phoneNorm||"",monthKey:mt,dayKey:de,dateRaw:He,rowIndices:_,rowIndexFirst:_.length?Math.min(..._):null,rowCount:C.length,productDisplay:we,productNorm:ie,productCompact:String(ie||"").replace(/\s+/g,""),cod:xe,codCandidates:Ie,rows:C}};return q.map(E)},te=async r=>{const c=`${API_BASE}/api/orders?month=${encodeURIComponent(r)}&includeItems=1`,w=await window.KTM.api.getJSON(c,"L\u1ED7i t\u1EA3i danh s\xE1ch \u0111\u01A1n");return Array.isArray(w==null?void 0:w.orders)?w.orders:Array.isArray(w)?w:[]},Oe=async r=>{var C,_;const c=Array.isArray(r)&&r.length?r:[j],w=[],f=5*60*1e3;for(let z=0;z<c.length;z++){const ne=c[z],we=(C=Qe.current)==null?void 0:C.get(ne);if(we&&Date.now()-Number(we.at||0)<f&&Array.isArray(we.records)){w.push(...we.records);continue}nt(`\u0110ang t\u1EA3i \u0111\u01A1n h\u1EC7 th\u1ED1ng th\xE1ng ${ne} (${z+1}/${c.length})...`);const ie=await te(ne);(_=Qe.current)==null||_.set(ne,{at:Date.now(),records:ie}),w.push(...ie)}const M=z=>String(z||"").trim().toLowerCase(),q=w.filter(z=>{const ne=M(z==null?void 0:z.status);return!(We&&ne==="draft"||Re&&ne==="canceled"||Kt&&ne==="paid")}),E=z=>{var we,ie,$e;return String(Ze||"created_at")==="updated_at"?(ie=(we=z==null?void 0:z.updated_at)!=null?we:z==null?void 0:z.created_at)!=null?ie:null:($e=z==null?void 0:z.created_at)!=null?$e:null};return q.map(z=>{var xe,mt,de,He,It,St;const ne=window.KTM.orders.getOrderProductSummary(z,Gt),we=window.KTM.orders.getOrderTotalMoney(z,Gt),ie=hn(ne),$e=Ye((xe=z==null?void 0:z.phone)!=null?xe:""),Ie=E(z),Ve=(()=>{if(!Ie)return"";const vt=new Date(Ie);return Number.isNaN(vt.getTime())?"":`${vt.getFullYear()}-${String(vt.getMonth()+1).padStart(2,"0")}-${String(vt.getDate()).padStart(2,"0")}`})();return{id:String((mt=z==null?void 0:z.id)!=null?mt:""),created_at:(de=z==null?void 0:z.created_at)!=null?de:null,updated_at:(He=z==null?void 0:z.updated_at)!=null?He:null,dayKey:Ve,status:String((It=z==null?void 0:z.status)!=null?It:""),phone:String((St=z==null?void 0:z.phone)!=null?St:""),phoneNorm:$e,productSummary:ne,productNorm:ie,productCompact:ie.replace(/\s+/g,""),cod:Number(we||0)||0,raw:z}}).filter(z=>z.id&&z.cod>0)},Pe=(r,c)=>{const w=String(r||"").trim(),f=String(c||"").trim();if(!w||!f)return 0;if(w===f)return 1;const M=w.replace(/\s+/g,""),q=f.replace(/\s+/g,"");if(M&&q&&M===q)return 1;if(M&&q&&(q.includes(M)||M.includes(q)))return .92;const E=xe=>String(xe||"").replace(/[\+]/g," ").replace(/[()\[\]{},.;:!?]/g," ").replace(/\s+/g," ").trim().split(" ").map(He=>He.trim()).filter(Boolean).map(He=>He.replace(/[^a-z0-9]/g,"")).filter(Boolean).filter(He=>He.length>1),b=E(w),C=E(f);if(!b.length||!C.length)return 0;const _=new Set(C),z=(xe,mt)=>{if(xe===mt)return 0;const de=xe.length,He=mt.length;if(Math.abs(de-He)>1)return 2;let It=0,St=0,vt=0;for(;It<de&&St<He;){if(xe[It]===mt[St]){It+=1,St+=1;continue}if(vt+=1,vt>1)return vt;de>He?It+=1:(He>de||(It+=1),St+=1)}return(It<de||St<He)&&(vt+=1),vt},ne=xe=>/[0-9]/.test(xe)?2:1;let we=0,ie=0;for(const xe of b){const mt=ne(xe);if(ie+=mt,_.has(xe)||q&&q.includes(xe)){we+=mt;continue}if(xe.length>=4){let de=!1;for(const He of C){if(He===xe){de=!0;break}if(He.includes(xe)||xe.includes(He)){de=!0;break}if(q&&q.includes(xe)){de=!0;break}if(z(xe,He)<=1){de=!0;break}}de&&(we+=mt*.8)}}const $e=we/Math.max(1,ie),Ie=Math.min(.12,Math.abs(w.length-f.length)/Math.max(1,Math.max(w.length,f.length))),Ve=(()=>{const xe=b.filter(de=>/[0-9]/.test(de)&&de.length>=3);if(!xe.length)return 0;let mt=0;for(const de of xe)(_.has(de)||q&&q.includes(de))&&(mt+=1);return Math.min(.08,.04*mt)})();return Math.max(0,Math.min(1,$e-Ie+Ve))},Je=r=>{const w=String(r||"").trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!w)return null;const f=new Date(Number(w[1]),Number(w[2])-1,Number(w[3]));return Number.isNaN(f.getTime())?null:f.getTime()},wt=(r,c)=>{const w=Array.isArray(r==null?void 0:r.codCandidates)&&r.codCandidates.length?r.codCandidates:[Number((r==null?void 0:r.cod)||0)||0],f=Number((c==null?void 0:c.cod)||0)||0;let M=1/0,q=0;for(const E of w){const b=Number(E||0)||0;if(b<=0)continue;const C=Math.abs(f-b);C<M&&(M=C,q=b)}return Number.isFinite(M)||(M=1/0),{bestDiff:M,bestCand:q,oCod:f}},et=(r,c,w)=>{const f=String((r==null?void 0:r.phoneNorm)||"").trim(),M=!!(f&&String((c==null?void 0:c.phoneNorm)||"")===f),q=Math.max(0,Number((w==null?void 0:w.codTolerance)||0)||0),{bestDiff:E,bestCand:b}=wt(r,c),C=E===0,_=Number.isFinite(E)&&q>0&&E>0&&E<=q,z=String((r==null?void 0:r.dayKey)||"").trim(),ne=String((c==null?void 0:c.dayKey)||"").trim(),we=!!(z&&ne&&z===ne),ie=(()=>{if(!z||!ne)return!1;const It=Je(z),St=Je(ne);if(It==null||St==null)return!1;const vt=Math.abs(It-St)/(24*60*60*1e3);return vt>0&&vt<=1.01})(),Ie=!!f?{phone:.65,cod:.27,day:.08}:{phone:0,cod:.85,day:.15},Ve=M?Ie.phone:0,xe=C?Ie.cod:_?Ie.cod*(1-E/Math.max(1,q)):0,mt=we?Ie.day:ie?Ie.day*.6:0,de=Ve+xe+mt,He=[];return M&&He.push("S\u0110T tr\xF9ng"),C?He.push("COD tr\xF9ng"):_?He.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(E)} (<= ${window.KTM.money.formatNumber(q)})`):b>0&&Number.isFinite(E)&&E!==1/0&&He.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(E)}`),we?He.push("C\xF9ng ng\xE0y"):ie&&He.push("Ng\xE0y g\u1EA7n \u0111\xFAng (\xB11)"),{score:de,reasons:He,nameSim:null,phoneMatch:M,codExact:C,codWithin:_,codDiff:E,bestCand:b}},dn=r=>{let c=String(r!=null?r:"");return c=c.replace(/^\s*(?:x\s*)?(\d{1,3})\s*(?:x|\*|×)?\s*/i," "),c=c.replace(/\s+/g," ").trim(),hn(c)},Xt=r=>{var q;const c=new Map,w=new Map,f=Array.isArray(r==null?void 0:r.rows)?r.rows:[],M=f.length>1||f.some(E=>String((E==null?void 0:E.qtySource)||"default")!=="default");for(const E of f){const b=String((E==null?void 0:E.product)||"").trim(),C=dn(b);if(!C)continue;const _=Math.max(1,Number((q=E==null?void 0:E.qty)!=null?q:1)||1),z=M?_:1;c.set(C,(c.get(C)||0)+z),w.has(C)||w.set(C,b)}return{qtyByKey:c,labelByKey:w,qtyReliable:M}},sn=r=>{var b;const c=new Map,w=new Map,f=(r==null?void 0:r.raw)||null,M=Array.isArray(f==null?void 0:f.items)?f.items:[];if(M.length){for(const C of M){const _=C==null?void 0:C.product_id,z=_?Gt(_):null,ne=String((z==null?void 0:z.name)||(C==null?void 0:C.product_name)||"").trim(),we=String((C==null?void 0:C.variant)||"").trim(),ie=(ne||(r==null?void 0:r.productSummary)||"").trim()+(we?` (${we})`:""),$e=dn(ie);if(!$e)continue;const Ie=Math.max(1,Number((b=C==null?void 0:C.quantity)!=null?b:1)||1);c.set($e,(c.get($e)||0)+Ie),w.has($e)||w.set($e,ne||ie)}return{qtyByKey:c,labelByKey:w}}const q=String((r==null?void 0:r.productSummary)||"").trim();if(!q)return{qtyByKey:c,labelByKey:w};const E=q.split("+").map(C=>String(C||"").trim()).filter(Boolean);for(const C of E){const _=C.match(/\bx\s*(\d{1,3})\b/i),z=_?Math.max(1,Number(_[1])||1):1,ne=C.replace(/\bx\s*\d{1,3}\b/ig," ").replace(/\s+/g," ").trim(),we=dn(ne);we&&(c.set(we,(c.get(we)||0)+z),w.has(we)||w.set(we,ne))}return{qtyByKey:c,labelByKey:w}},bn=(r,c)=>{const w=Xt(r),f=sn(c),M=Array.from(w.qtyByKey.keys()),q=Array.from(f.qtyByKey.keys()),E=[];for(const ie of M)for(const $e of q){const Ie=Pe(ie,$e);Ie>=.9&&E.push({ek:ie,sk:$e,sc:Ie})}E.sort((ie,$e)=>$e.sc-ie.sc);const b=new Map,C=new Set,_=new Set;for(const ie of E)C.has(ie.ek)||_.has(ie.sk)||(b.set(ie.ek,ie.sk),C.add(ie.ek),_.add(ie.sk));const z=[],ne=[];for(const[ie,$e]of w.qtyByKey.entries()){const Ie=b.get(ie)||ie,Ve=f.qtyByKey.get(Ie)||0;Ve<$e&&z.push({name:w.labelByKey.get(ie)||ie,qty:$e-Ve})}for(const[ie,$e]of f.qtyByKey.entries()){let Ie=w.qtyByKey.get(ie)||0;if(!Ie){for(const[Ve,xe]of b.entries())if(xe===ie){Ie=w.qtyByKey.get(Ve)||0;break}}Ie<$e&&ne.push({name:f.labelByKey.get(ie)||ie,qty:$e-Ie})}return{hasDiff:z.length>0||ne.length>0,missingInSystem:z,missingInExcel:ne}},at=r=>{if(!(r!=null&&r.hasDiff))return"";const c=f=>f.slice(0,4).map(M=>`${M.name} x${M.qty}`).join(", ")+(f.length>4?` (+${f.length-4})`:""),w=[];return Array.isArray(r.missingInExcel)&&r.missingInExcel.length&&w.push(`Thi\u1EBFu trong Excel: ${c(r.missingInExcel)}`),Array.isArray(r.missingInSystem)&&r.missingInSystem.length&&w.push(`Thi\u1EBFu trong h\u1EC7 th\u1ED1ng: ${c(r.missingInSystem)}`),w.join(" \xB7 ")},mn=async r=>{Se(""),Le(null),Xe((r==null?void 0:r.name)||""),Ee(!0),nt("\u0110ang \u0111\u1ECDc file Excel...");try{await zt();const c=await u(r),w=Array.isArray(c.rows)?c.rows:[],f=String(j||"").trim()||getCurrentMonth(),M=Q=>{const s=String(Q||"").match(/^(\d{4})-(\d{2})$/);if(!s)return NaN;const d=Number(s[1]),l=Number(s[2]);return!Number.isFinite(d)||!Number.isFinite(l)||l<1||l>12?NaN:d*12+(l-1)},q=Q=>{if(!Number.isFinite(Q))return"";const s=Math.floor(Q/12),d=Q%12+1;return!Number.isFinite(s)||!Number.isFinite(d)||d<1||d>12?"":`${String(s).padStart(4,"0")}-${String(d).padStart(2,"0")}`},E=M(f),b=Number.isFinite(E)?E-2:NaN,C=Q=>{const s=M(Q);return!Number.isFinite(s)||!Number.isFinite(E)||!Number.isFinite(b)?!1:s>=b&&s<=E},_=(()=>{if(!Number.isFinite(E)||!Number.isFinite(b))return[f];const Q=[];for(let s=b;s<=E;s++){const d=q(s);d&&Q.push(d)}return Q.length?Q:[f]})(),z=w.filter(Q=>{const s=String((Q==null?void 0:Q.monthKey)||"").trim();return s?C(s):!0}),ne=w.filter(Q=>{const s=String((Q==null?void 0:Q.monthKey)||"").trim();return s?!C(s):!1});if(!z.length)throw new Error(`File kh\xF4ng c\xF3 d\u1EEF li\u1EC7u trong 3 th\xE1ng g\u1EA7n nh\u1EA5t quanh ${f}.`);const we=_,ie=await Oe(we),$e=(()=>{const Q=new Map;for(const s of Array.isArray(ie)?ie:[]){const d=String((s==null?void 0:s.phoneNorm)||"").trim(),l=String((s==null?void 0:s.dayKey)||"").trim();if(!d||!l)continue;const S=`${d}|${l}`;Q.set(S,(Q.get(S)||0)+1)}return Q})(),Ie=Q=>{const s=Number(Q);return Number.isFinite(s)?Math.trunc(s):0},Ve=(Q,s)=>{const d=String(Q||"").trim(),l=Ie(s);return!d||!l?"":`${d}|${l}`},xe=(()=>{const Q=new Map;for(const s of Array.isArray(ie)?ie:[]){const d=Ve(s==null?void 0:s.phoneNorm,s==null?void 0:s.cod);d&&Q.set(d,(Q.get(d)||0)+1)}return Q})(),mt=new Set(ie.map(Q=>Ve(Q==null?void 0:Q.phoneNorm,Q==null?void 0:Q.cod)).filter(Boolean)),de=(()=>{var s,d,l,S,$;const Q=new Map;for(const N of ne){const y=Ve(N==null?void 0:N.phoneNorm,N==null?void 0:N.cod);if(!y||!mt.has(y))continue;const G=Q.get(y)||[];G.push({rowIndex:(s=N==null?void 0:N.rowIndex)!=null?s:null,dateRaw:(d=N==null?void 0:N.dateRaw)!=null?d:"",monthKey:(l=N==null?void 0:N.monthKey)!=null?l:"",dayKey:(S=N==null?void 0:N.dayKey)!=null?S:"",product:($=N==null?void 0:N.product)!=null?$:""}),Q.set(y,G)}return Q})(),He=z,It=Q=>{const s=Number((Q==null?void 0:Q.cod)||0)||0;if(s>0)return s;const d=Number((Q==null?void 0:Q.codAlt)||0)||0;return d>0?d:0},St=Q=>{var l;const s=new Map;for(const S of Array.isArray(Q)?Q:[]){const $=String((S==null?void 0:S.phoneNorm)||"").trim(),N=String((S==null?void 0:S.dayKey)||"").trim();if(!$||!N)continue;const y=`${$}|${N}`,G=s.get(y)||[];G.push(S),s.set(y,G)}const d=[];for(const[S,$]of s.entries()){if(!Array.isArray($)||$.length<2)continue;const[N,y]=String(S).split("|"),G=y&&y.length>=7?y.slice(0,7):"",ce=$.map(It).filter(Ce=>Ce>0).reduce((Ce,h)=>Ce+h,0);if(!ce)continue;const J=$.map(Ce=>Ce==null?void 0:Ce.rowIndex).filter(Boolean),Z=[],Ke=new Set;for(const Ce of $){const h=String((Ce==null?void 0:Ce.product)||"").trim();h&&(Ke.has(h)||(Ke.add(h),Z.push(h)))}d.push({key:`merge:p:${N}:d:${y}`,isMerged:!0,phoneNorm:N,phone:N,monthKey:G,dayKey:y,dateRaw:((l=$.find(Ce=>Ce==null?void 0:Ce.dateRaw))==null?void 0:l.dateRaw)||"",rowIndices:J,rowIndexFirst:J.length?Math.min(...J):null,rowCount:$.length,productDisplay:Z.join(" + "),productNorm:"",productCompact:"",cod:ce,codCandidates:[],rows:$})}return d},vt=V(He),je=St(He),I=je.length?vt.concat(je):vt;nt(`\u0110\u1ECDc \u0111\u01B0\u1EE3c ${He.length} d\xF2ng (${vt.length} c\u1EE5m; +${je.length} c\u1EE5m g\u1ED9p) trong 3 th\xE1ng g\u1EA7n nh\u1EA5t. \u0110ang chu\u1EA9n b\u1ECB \u0111\u1ED1i so\xE1t...`),nt(`\u0110ang \u0111\u1ED1i so\xE1t (${I.length} c\u1EE5m Excel vs ${ie.length} \u0111\u01A1n h\u1EC7 th\u1ED1ng)...`);const oe=new Map,ze=new Map,ht=new Map;for(const Q of I){const s=String(Q.phoneNorm||"").trim();if(!s)continue;const d=oe.get(s)||[];d.push(Q),oe.set(s,d);const l=Ve(s,Q.cod);if(l){const S=ze.get(l)||[];S.push(Q),ze.set(l,S);const $=String((Q==null?void 0:Q.dayKey)||"").trim();if($){const N=`${l}|${$}`,y=ht.get(N)||[];y.push(Q),ht.set(N,y)}}}const xt=new Set,Jt=(()=>{const Q=new Map;for(const s of I){const d=String((s==null?void 0:s.key)||"").trim();if(!d)continue;const l=Array.isArray(s==null?void 0:s.rowIndices)?s.rowIndices:[];for(const S of l){const $=Number(S);if(!Number.isFinite($))continue;const N=Q.get($)||[];N.push(d),Q.set($,N)}}return Q})(),Nt=Q=>{const s=Array.isArray(Q==null?void 0:Q.rowIndices)?Q.rowIndices:[];for(const l of s){const S=Number(l);if(!Number.isFinite(S))continue;const $=Jt.get(S)||[];for(const N of $)xt.add(String(N))}const d=String((Q==null?void 0:Q.key)||"").trim();d&&xt.add(d)},Et=[],Zt=[],Mt=[],en=Q=>{const s=Array.isArray(Q)?Q.filter(Boolean):[];return s.length?`C\xF3 d\xF2ng Excel ngo\xE0i 3 th\xE1ng tr\xF9ng S\u0110T+COD: ${s.slice(0,2).map(l=>{const S=String((l==null?void 0:l.dateRaw)||(l==null?void 0:l.dayKey)||(l==null?void 0:l.monthKey)||"").trim(),$=l!=null&&l.rowIndex?`d\xF2ng ${l.rowIndex}`:"";return[S,$].filter(Boolean).join(" \xB7 ")}).join(" | ")}`:""};for(const Q of ie){const s=String(Q.phoneNorm||"").trim(),d=Ie(Q.cod);if(!s||!d){Mt.push(Q);continue}const l=Ve(s,d),S=String(Q.dayKey||"").trim();let $=l?ze.get(l)||[]:[],N=[];if(l&&S&&(N=ht.get(`${l}|${S}`)||[]),S&&$.length){const pe=(xe.get(l)||0)>1;$=$.filter(st=>{const ot=String((st==null?void 0:st.dayKey)||"").trim();return ot?ot===S:!pe})}const y=pe=>{if(!(pe!=null&&pe.isMerged))return!0;const st=String((pe==null?void 0:pe.dayKey)||"").trim();return!S||!st||st!==S?!1:($e.get(`${s}|${S}`)||0)===1},G=pe=>{const st=(Array.isArray(pe)?pe:[]).filter(kt=>!xt.has(String(kt==null?void 0:kt.key)));if(!st.length)return null;let ot=st.find(kt=>!(kt!=null&&kt.isMerged))||null;return ot||(ot=st.find(kt=>y(kt))||null),ot&&(ot!=null&&ot.isMerged)&&!y(ot)?null:ot};if(N.length){const pe=G(N);if(pe){Nt(pe),Et.push({group:pe,order:Q,score:1,reasons:["S\u0110T tr\xF9ng","COD tr\xF9ng","C\xF9ng ng\xE0y"]});continue}}if($.length){const pe=G($);if(pe){Nt(pe),Et.push({group:pe,order:Q,score:1,reasons:["S\u0110T tr\xF9ng","COD tr\xF9ng",...pe.dayKey&&S&&pe.dayKey===S?["C\xF9ng ng\xE0y"]:[]]});continue}}const ce=oe.get(s)||[];if(!ce.length){const pe=de.get(l)||[];Mt.push(pe.length?{...Q,excelOutsideHints:pe,excelOutsideHintText:en(pe)}:Q);continue}let J=ce.filter(pe=>!xt.has(String(pe==null?void 0:pe.key)));if(S){const pe=J.filter(st=>String(st.dayKey||"").trim()===S);pe.length&&(J=pe)}if(!J.length){const pe=de.get(l)||[];Mt.push(pe.length?{...Q,excelOutsideHints:pe,excelOutsideHintText:en(pe)}:Q);continue}let Z=null,Ke=Number.POSITIVE_INFINITY;for(const pe of J){const st=Ie(pe.cod);if(!st)continue;const ot=Math.abs(st-d);ot<Ke&&(Ke=ot,Z=pe)}if(!Z){const pe=de.get(l)||[];Mt.push(pe.length?{...Q,excelOutsideHints:pe,excelOutsideHintText:en(pe)}:Q);continue}const Ce=Ie(Z.cod)-d,h=Math.abs(Ce),be=jt?Math.max(0,Ie(A)):0;if(h===0||be>0&&h<=be){Nt(Z),Et.push({group:Z,order:Q,score:1,reasons:["S\u0110T tr\xF9ng","COD tr\xF9ng",...be>0&&h>0?[`Trong ng\u01B0\u1EE1ng \xB1${be}`]:[],...S&&String(Z.dayKey||"").trim()===S?["C\xF9ng ng\xE0y"]:[]]});continue}Zt.push({group:Z,order:Q,score:0,diff:Ce,reason:S&&String(Z.dayKey||"").trim()===S?"S\u0110T tr\xF9ng \xB7 C\xF9ng ng\xE0y":"S\u0110T tr\xF9ng",suggestions:J.slice(0,3).map(pe=>({key:pe.key,cod:Ie(pe.cod),productSummary:String(pe.product||"").trim(),score:0,reasons:["Excel c\xF9ng S\u0110T"]}))})}const pn=Mt.length===0&&Zt.length===0;Le({ok:pn,monthKeys:we,excelCount:He.length,excelGroupCount:I.length,systemCount:ie.length,matches:Et,systemOnly:Mt,moneyMismatch:Zt}),x(new Set),nt(pn?"OK \u2705":"\u0110\xE3 \u0111\u1ED1i so\xE1t xong")}catch(c){Se(String((c==null?void 0:c.message)||c||"L\u1ED7i \u0111\u1ED1i so\xE1t")),nt("")}finally{Ee(!1)}},_n=(r,c)=>{var _,z,ne,we,ie,$e,Ie,Ve,xe,mt;const w=de=>String(de||"").replace(/[^0-9]/g,""),f=(r==null?void 0:r.raw)||{},M=String((z=(_=r==null?void 0:r.id)!=null?_:f==null?void 0:f.id)!=null?z:"").trim(),q=w((we=(ne=f==null?void 0:f.phone)!=null?ne:r==null?void 0:r.phone)!=null?we:"");if(!M||!q)return null;let b=(Array.isArray(f==null?void 0:f.items)?f.items:[]).map(de=>{var He,It;return{product_id:(de==null?void 0:de.product_id)||"",quantity:Number((He=de==null?void 0:de.quantity)!=null?He:1),variant:String((de==null?void 0:de.variant)||"").trim()||null,variant_json:(It=de==null?void 0:de.variant_json)!=null?It:null,unit_price:(()=>{var je;const St=(je=de==null?void 0:de.unit_price)!=null?je:de==null?void 0:de.unitPrice,vt=St==null||St===""?NaN:Number(St);return Number.isFinite(vt)?Math.max(0,Math.trunc(vt)):null})()}}).filter(de=>de.product_id&&Number.isFinite(de.quantity)&&de.quantity>0);if(!b.length&&(f!=null&&f.product_id)){const de=Number((ie=f==null?void 0:f.quantity)!=null?ie:1);b=[{product_id:f.product_id,quantity:Number.isFinite(de)&&de>0?de:1,variant:null,variant_json:null,unit_price:null}]}if(!b.length)return null;const C=b[0];return{id:M,customer_name:String(($e=f==null?void 0:f.customer_name)!=null?$e:"").trim(),phone:q,address:String((Ie=f==null?void 0:f.address)!=null?Ie:"").trim(),note:String((Ve=f==null?void 0:f.note)!=null?Ve:"").trim(),adjustment_amount:Number((xe=f==null?void 0:f.adjustment_amount)!=null?xe:0)||0,adjustment_note:String((mt=f==null?void 0:f.adjustment_note)!=null?mt:"").trim(),product_id:C.product_id,quantity:C.quantity,status:c,items:b}},vn=async()=>{if(!ue||ye)return;const r=Array.from(Te.values()).map(f=>String(f||"").trim()).filter(Boolean);if(!r.length||!confirm(`\u0110\xE1nh d\u1EA5u \u0111\xE3 nh\u1EADn ti\u1EC1n cho ${r.length} \u0111\u01A1n?`))return;Ne(!0),me("\u0110ang c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i...");let c=0;const w=[];try{for(let f=0;f<r.length;f++){const M=r[f];me(`\u0110ang c\u1EADp nh\u1EADt (${f+1}/${r.length})...`);const q=(Array.isArray(ue==null?void 0:ue.matches)?ue.matches:[]).find(b=>{var C;return String(((C=b==null?void 0:b.order)==null?void 0:C.id)||"")===M}),E=_n(q==null?void 0:q.order,"paid");if(!E){w.push({id:M,error:"Thi\u1EBFu d\u1EEF li\u1EC7u (phone/items)"});continue}try{await window.KTM.api.putJSON(`${API_BASE}/api/orders/${encodeURIComponent(M)}`,E,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),c+=1}catch(b){w.push({id:M,error:String((b==null?void 0:b.message)||b||"L\u1ED7i")})}}}finally{Ne(!1),me("")}if(c>0){L(`\u0110\xE3 c\u1EADp nh\u1EADt ${c} \u0111\u01A1n sang \u0110\xE3 nh\u1EADn ti\u1EC1n`,"success");const f=new Set(r);Le(M=>{if(!M)return M;const q=E=>{if(!E||!f.has(String(E.id)))return E;const b=E.raw?{...E.raw,status:"paid"}:E.raw;return{...E,status:"paid",raw:b}};return{...M,matches:Array.isArray(M.matches)?M.matches.map(E=>({...E,order:q(E==null?void 0:E.order)})):M.matches,systemOnly:Array.isArray(M.systemOnly)?M.systemOnly.map(q):M.systemOnly,moneyMismatch:Array.isArray(M.moneyMismatch)?M.moneyMismatch.map(E=>({...E,order:q(E==null?void 0:E.order)})):M.moneyMismatch}}),x(new Set)}w.length&&(L(`C\xF3 ${w.length} \u0111\u01A1n c\u1EADp nh\u1EADt l\u1ED7i (xem console)`,"warning"),console.warn("Recon paid update failures:",w))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t Excel")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Th\xE1ng m\u1EB7c \u0111\u1ECBnh (n\u1EBFu Excel kh\xF4ng c\xF3 c\u1ED9t ng\xE0y)"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:ae,onChange:r=>W(r.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:X}))))),React.createElement("div",{className:"card border-0 shadow-sm mb-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{className:"fw-semibold"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 (Excel)"),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("span",{className:"text-muted small"},"\u0110\u1ED1i so\xE1t theo: ",React.createElement("span",{className:"fw-semibold"},"S\u0110T")," + ",React.createElement("span",{className:"fw-semibold"},"T\u1ED5ng ti\u1EC1n thu h\u1ED9")))),Tt==="loading"&&React.createElement("div",{className:"alert alert-info mt-3 mb-0"},"\u0110ang t\u1EA3i th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX)..."),Tt==="failed"&&React.createElement("div",{className:"alert alert-warning mt-3 mb-0"},"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). H\xE3y ki\u1EC3m tra m\u1EA1ng / ch\u1EB7n CDN (AdBlock) ho\u1EB7c refresh l\u1EA1i trang."),React.createElement("div",{className:"row g-2 align-items-end mt-2"},React.createElement("div",{className:"col-12 col-md-7"},React.createElement("label",{className:"form-label mb-1"},"Upload file Excel"),React.createElement("input",{type:"file",className:"form-control",accept:".xlsx,.xls,.csv",disabled:X,onChange:async r=>{const c=r.target.files&&r.target.files[0];c&&await mn(c)}}),React.createElement("div",{className:"form-text"},qe?`File: ${qe}`:'Header c\u1EA7n c\xF3: "T\u1ED5ng Ti\u1EC1n Thu H\u1ED9". "T\xEAn s\u1EA3n ph\u1EA9m" (n\u1EBFu c\xF3) s\u1EBD gi\xFAp g\u1EE3i \xFD kh\u1EDBp t\u1ED1t h\u01A1n. C\xF3 c\u1ED9t "Ng\xE0y" th\xEC s\u1EBD t\u1EF1 t\u1EA3i \u0111\xFAng th\xE1ng trong file.')),React.createElement("div",{className:"col-12 col-md-5"},React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("label",{className:"form-label mb-0 small text-muted"},"Ng\xE0y theo"),React.createElement("select",{className:"form-select form-select-sm",style:{width:150},value:Ze,disabled:X,onChange:r=>Lt(r.target.value)},React.createElement("option",{value:"created_at"},"created_at"),React.createElement("option",{value:"updated_at"},"updated_at"))),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-draft",checked:We,disabled:X,onChange:r=>tt(!!r.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-draft"},"B\u1ECF nh\xE1p")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-canceled",checked:Re,disabled:X,onChange:r=>yt(!!r.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-canceled"},"B\u1ECF h\u1EE7y")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-paid",checked:Kt,disabled:X,onChange:r=>an(!!r.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-paid"},"B\u1ECF \u0111\xE3 nh\u1EADn ti\u1EC1n")),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("div",{className:"form-check mb-0"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-cod-tol",checked:jt,disabled:X,onChange:r=>T(!!r.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-cod-tol"},"Cho l\u1EC7ch COD")),React.createElement("input",{type:"number",className:"form-control form-control-sm",style:{width:110},value:A,min:"0",step:"1000",disabled:X||!jt,onChange:r=>H(r.target.value)})))),React.createElement("div",{className:"col-12 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",disabled:X,onClick:()=>{Se(""),nt(""),Le(null),Xe(""),pt("all"),At(""),L("\u0110\xE3 reset \u0111\u1ED1i so\xE1t","info")}},React.createElement("i",{className:"fas fa-rotate-left me-2"}),"Reset"))),Ge&&React.createElement("div",{className:"mt-2 small text-muted"},Ge),Be&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0"},Be),ue&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:`alert ${ue.ok?"alert-success":"alert-warning"} mb-3`},ue.ok?React.createElement("div",{className:"fw-semibold"},"OK \u2014 Kh\xF4ng th\u1EA5y \u0111\u01A1n h\u1EC7 th\u1ED1ng b\u1ECB thi\u1EBFu trong Excel ho\u1EB7c l\u1EC7ch ti\u1EC1n."):React.createElement("div",{className:"fw-semibold"},"CH\u01AFA KH\u1EDAP \u2014 C\xF3 \u0111\u01A1n h\u1EC7 th\u1ED1ng thi\u1EBFu trong Excel ho\u1EB7c l\u1EC7ch ti\u1EC1n."),React.createElement("div",{className:"small mt-1"},"Th\xE1ng \u0111\u1ED1i so\xE1t: ",Array.isArray(ue.monthKeys)?ue.monthKeys.join(", "):""," \xB7 Excel: ",ue.excelCount," d\xF2ng",Number(ue.excelGroupCount||0)?` (${ue.excelGroupCount} c\u1EE5m)`:""," \xB7 H\u1EC7 th\u1ED1ng: ",ue.systemCount," \u0111\u01A1n")),!ue.ok&&React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center justify-content-between mb-2"},React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Recon view"},React.createElement("button",{type:"button",className:`btn ${B==="all"?"btn-dark":"btn-outline-dark"}`,onClick:()=>pt("all")},"T\u1EA5t c\u1EA3"),React.createElement("button",{type:"button",className:`btn ${B==="systemOnly"?"btn-warning":"btn-outline-warning"}`,onClick:()=>pt("systemOnly")},"H\u1EC7 th\u1ED1ng thi\u1EBFu Excel"),React.createElement("button",{type:"button",className:`btn ${B==="moneyMismatch"?"btn-danger":"btn-outline-danger"}`,onClick:()=>pt("moneyMismatch")},"Sai l\u1EC7ch ti\u1EC1n")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("input",{type:"text",className:"form-control form-control-sm recon-phone-input",placeholder:"L\u1ECDc theo S\u0110T...",value:gt,onChange:r=>At(r.target.value)}),React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Export CSV"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{var w,f,M,q,E,b,C;const r=Ye(gt),c=[["type","order_id","date","phone","product","cod_excel","cod_system","diff","reason"]];for(const _ of Array.isArray(ue.moneyMismatch)?ue.moneyMismatch:[])r&&String(((w=_==null?void 0:_.group)==null?void 0:w.phoneNorm)||"").indexOf(r)<0||c.push(["moneyMismatch",((f=_==null?void 0:_.order)==null?void 0:f.id)||"",String(((M=_==null?void 0:_.group)==null?void 0:M.dateRaw)||""),((q=_==null?void 0:_.group)==null?void 0:q.phone)||"",((E=_==null?void 0:_.group)==null?void 0:E.productDisplay)||"",Number(((b=_==null?void 0:_.group)==null?void 0:b.cod)||0),Number(((C=_==null?void 0:_.order)==null?void 0:C.cod)||0),Number((_==null?void 0:_.diff)||0),String((_==null?void 0:_.reason)||"")]);for(const _ of Array.isArray(ue.systemOnly)?ue.systemOnly:[])r&&String((_==null?void 0:_.phoneNorm)||"").indexOf(r)<0||c.push(["systemOnly",(_==null?void 0:_.id)||"",window.KTM.date.formatDateTime(_==null?void 0:_.created_at),(_==null?void 0:_.phone)||"",(_==null?void 0:_.productSummary)||"","",Number((_==null?void 0:_.cod)||0),"",String((_==null?void 0:_.excelOutsideHintText)||"")]);Bt(`recon_${String(j||"").replace(/[^0-9\-]/g,"")}.csv`,c)}},"Export CSV")))),Array.isArray(ue.moneyMismatch)&&ue.moneyMismatch.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:B==="all"||B==="moneyMismatch"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-danger"},"Sai l\u1EC7ch s\u1ED1 ti\u1EC1n"),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m (Excel)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (Excel)"),React.createElement("th",null,"Order ID"),React.createElement("th",null,"T\xEAn SP (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"L\u1EC7ch"),React.createElement("th",null,"L\xFD do"))),React.createElement("tbody",null,ue.moneyMismatch.filter(r=>{var w;const c=Ye(gt);return c?String(((w=r==null?void 0:r.group)==null?void 0:w.phoneNorm)||"").includes(c):!0}).slice(0,30).map(r=>{var c,w,f,M,q,E,b,C,_,z;return React.createElement("tr",{key:`mm-${String(((c=r==null?void 0:r.group)==null?void 0:c.key)||((w=r==null?void 0:r.order)==null?void 0:w.id)||Math.random())}`,className:"table-danger"},React.createElement("td",null,((f=r==null?void 0:r.group)==null?void 0:f.rowIndexFirst)||"\u2014",Number(((M=r==null?void 0:r.group)==null?void 0:M.rowCount)||0)>1?` (+${Number(r.group.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},((q=r==null?void 0:r.group)==null?void 0:q.phone)||"\u2014"),React.createElement("td",{style:{minWidth:260}},((E=r==null?void 0:r.group)==null?void 0:E.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number(((b=r==null?void 0:r.group)==null?void 0:b.cod)||0))),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me((r==null?void 0:r.order)||null),Y(!0)}},(C=r==null?void 0:r.order)==null?void 0:C.id)),React.createElement("td",{style:{minWidth:240}},(_=r==null?void 0:r.order)==null?void 0:_.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber((z=r==null?void 0:r.order)==null?void 0:z.cod)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(r==null?void 0:r.diff)),React.createElement("td",{className:"text-muted",style:{minWidth:220}},(r==null?void 0:r.reason)||""))})))),ue.moneyMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ue.moneyMismatch.length," d\xF2ng.")),React.createElement("div",{className:"d-md-none"},ue.moneyMismatch.filter(r=>{var w;const c=Ye(gt);return c?String(((w=r==null?void 0:r.group)==null?void 0:w.phoneNorm)||"").includes(c):!0}).slice(0,30).map(r=>{var f,M,q,E,b,C,_,z,ne,we,ie,$e;const c=`${((f=r==null?void 0:r.group)==null?void 0:f.rowIndexFirst)||"\u2014"}${Number(((M=r==null?void 0:r.group)==null?void 0:M.rowCount)||0)>1?` (+${Number(r.group.rowCount)-1})`:""}`,w=String(((q=r==null?void 0:r.group)==null?void 0:q.dateRaw)||((E=r==null?void 0:r.group)==null?void 0:E.dayKey)||"").trim();return React.createElement("div",{key:`mm-m-${String(((b=r==null?void 0:r.group)==null?void 0:b.key)||((C=r==null?void 0:r.order)==null?void 0:C.id)||Math.random())}`,className:"recon-mobile-card recon-mobile-card-danger"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold text-truncate",style:{maxWidth:"70%"}},((_=r==null?void 0:r.group)==null?void 0:_.phone)||"\u2014"),React.createElement("div",{className:"fw-semibold text-danger"},window.KTM.money.formatNumber(r==null?void 0:r.diff))),React.createElement("div",{className:"small text-muted mt-1"},"Excel d\xF2ng ",c,w?` \u2022 ${w}`:""),React.createElement("div",{className:"mt-2"},React.createElement("div",{className:"recon-mobile-kv"},React.createElement("span",{className:"text-muted"},"Thu h\u1ED9 (Excel)"),React.createElement("span",{className:"fw-semibold"},window.KTM.money.formatNumber(Number(((z=r==null?void 0:r.group)==null?void 0:z.cod)||0)))),React.createElement("div",{className:"recon-mobile-value mt-1"},((ne=r==null?void 0:r.group)==null?void 0:ne.productDisplay)||"\u2014")),React.createElement("div",{className:"mt-2 pt-2 border-top"},React.createElement("div",{className:"recon-mobile-kv"},React.createElement("span",{className:"text-muted"},"Order"),React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me((r==null?void 0:r.order)||null),Y(!0)}},((we=r==null?void 0:r.order)==null?void 0:we.id)||"\u2014")),React.createElement("div",{className:"recon-mobile-value mt-1"},((ie=r==null?void 0:r.order)==null?void 0:ie.productSummary)||"\u2014"),React.createElement("div",{className:"recon-mobile-kv mt-1"},React.createElement("span",{className:"text-muted"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("span",{className:"fw-semibold"},window.KTM.money.formatNumber(Number((($e=r==null?void 0:r.order)==null?void 0:$e.cod)||0))))),r!=null&&r.reason?React.createElement("div",{className:"small text-muted mt-2"},"L\xFD do: ",r.reason):null)}),ue.moneyMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ue.moneyMismatch.length," d\xF2ng.")))),Array.isArray(ue.systemOnly)&&ue.systemOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:B==="all"||B==="systemOnly"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong h\u1EC7 th\u1ED1ng nh\u01B0ng thi\u1EBFu trong Excel"),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y t\u1EA1o"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,ue.systemOnly.filter(r=>{const c=Ye(gt);return c?String((r==null?void 0:r.phoneNorm)||"").includes(c):!0}).slice(0,30).map(r=>React.createElement("tr",{key:`so-${r.id}`,className:"table-warning"},React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me(r||null),Y(!0)}},r.id)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(r.created_at)),React.createElement("td",{className:"text-muted"},r.phone||"\u2014"),React.createElement("td",{style:{minWidth:280}},r.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(r.cod)),React.createElement("td",{className:"text-muted"},r.status,r!=null&&r.excelOutsideHintText?React.createElement("div",{className:"small text-muted mt-1"},r.excelOutsideHintText):null)))))),ue.systemOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ue.systemOnly.length," \u0111\u01A1n.")),React.createElement("div",{className:"d-md-none"},ue.systemOnly.filter(r=>{const c=Ye(gt);return c?String((r==null?void 0:r.phoneNorm)||"").includes(c):!0}).slice(0,30).map(r=>React.createElement("div",{key:`so-m-${r.id}`,className:"recon-mobile-card recon-mobile-card-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me(r||null),Y(!0)}},r.id),React.createElement("span",{className:"badge bg-secondary"},r.status||"\u2014")),React.createElement("div",{className:"small text-muted mt-1"},window.KTM.date.formatDateTime(r.created_at),r.phone?` \u2022 ${r.phone}`:""),React.createElement("div",{className:"recon-mobile-value mt-2"},r.productSummary||"\u2014"),React.createElement("div",{className:"recon-mobile-kv mt-2"},React.createElement("span",{className:"text-muted"},"Thu h\u1ED9"),React.createElement("span",{className:"fw-semibold"},window.KTM.money.formatNumber(r.cod))),r!=null&&r.excelOutsideHintText?React.createElement("div",{className:"small text-muted mt-2"},r.excelOutsideHintText):null)),ue.systemOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",ue.systemOnly.length," \u0111\u01A1n.")))))),Array.isArray(ue.matches)&&ue.matches.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mt-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2"},React.createElement("div",{className:"fw-semibold"},"\u0110\u01A1n \u0111\xE3 kh\u1EDBp"),React.createElement("div",{className:"d-flex flex-wrap align-items-center gap-2"},le?React.createElement("span",{className:"text-muted small"},le):null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",disabled:ye||!(Te&&Te.size),onClick:vn},"\u0110\xE1nh d\u1EA5u \u0111\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:34}},React.createElement("input",{type:"checkbox",checked:(()=>{var w;const r=Ye(gt),c=(ue.matches||[]).filter(f=>{var E;const M=f==null?void 0:f.order;if(!(M!=null&&M.id))return!1;const q=String((M==null?void 0:M.status)||((E=M==null?void 0:M.raw)==null?void 0:E.status)||"").toLowerCase();return!(Kt&&q==="paid"||r&&!String((M==null?void 0:M.phoneNorm)||"").includes(r))});if(!c.length)return!1;for(const f of c)if(!Te.has(String(((w=f==null?void 0:f.order)==null?void 0:w.id)||"")))return!1;return!0})(),onChange:r=>{const c=!!r.target.checked;x(w=>{var E;const f=new Set(w),M=Ye(gt),q=(ue.matches||[]).filter(b=>{var z;const C=b==null?void 0:b.order;if(!(C!=null&&C.id))return!1;const _=String((C==null?void 0:C.status)||((z=C==null?void 0:C.raw)==null?void 0:z.status)||"").toLowerCase();return!(Kt&&_==="paid"||M&&!String((C==null?void 0:C.phoneNorm)||"").includes(M))});for(const b of q){const C=String(((E=b==null?void 0:b.order)==null?void 0:E.id)||"").trim();C&&(c?f.add(C):f.delete(C))}return f})}})),React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"Excel"),React.createElement("th",null,"H\u1EC7 th\u1ED1ng"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,(ue.matches||[]).filter(r=>{var M;const c=r==null?void 0:r.order;if(!(c!=null&&c.id))return!1;const w=String((c==null?void 0:c.status)||((M=c==null?void 0:c.raw)==null?void 0:M.status)||"").toLowerCase();if(Kt&&w==="paid")return!1;const f=Ye(gt);return!(f&&!String((c==null?void 0:c.phoneNorm)||"").includes(f))}).slice(0,50).map(r=>{var f,M,q,E;const c=r.order,w=String(c.id);return React.createElement("tr",{key:`match-${w}`},React.createElement("td",null,React.createElement("input",{type:"checkbox",checked:Te.has(w),onChange:b=>{const C=!!b.target.checked;x(_=>{const z=new Set(_);return C?z.add(w):z.delete(w),z})}})),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Me(c||null),Y(!0)}},w)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(c.created_at)),React.createElement("td",{className:"text-muted"},c.phone||"\u2014"),React.createElement("td",{style:{minWidth:240}},((f=r==null?void 0:r.group)==null?void 0:f.productDisplay)||"\u2014"),React.createElement("td",{style:{minWidth:240}},c.productSummary||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(c.cod)),React.createElement("td",null,React.createElement("span",{className:`badge ${String((c==null?void 0:c.status)||((M=c==null?void 0:c.raw)==null?void 0:M.status)||"").toLowerCase()==="paid"?"bg-primary":"bg-secondary"}`},String((c==null?void 0:c.status)||((q=c==null?void 0:c.raw)==null?void 0:q.status)||"").toLowerCase()==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":(c==null?void 0:c.status)||((E=c==null?void 0:c.raw)==null?void 0:E.status)||"\u2014")))})))),React.createElement("div",{className:"text-muted small mt-2"},"Hi\u1EC3n th\u1ECB t\u1ED1i \u0111a 50 \u0111\u01A1n. D\xF9ng l\u1ECDc S\u0110T \u0111\u1EC3 thu h\u1EB9p.")),React.createElement("div",{className:"d-md-none"},(ue.matches||[]).filter(r=>{var M;const c=r==null?void 0:r.order;if(!(c!=null&&c.id))return!1;const w=String((c==null?void 0:c.status)||((M=c==null?void 0:c.raw)==null?void 0:M.status)||"").toLowerCase();if(Kt&&w==="paid")return!1;const f=Ye(gt);return!(f&&!String((c==null?void 0:c.phoneNorm)||"").includes(f))}).slice(0,50).map(r=>{var M,q,E;const c=r==null?void 0:r.order,w=String((c==null?void 0:c.id)||"").trim(),f=String((c==null?void 0:c.status)||((M=c==null?void 0:c.raw)==null?void 0:M.status)||"").toLowerCase();return React.createElement("div",{key:`match-m-${w||String((c==null?void 0:c.created_at)||"")}`,className:"recon-mobile-card recon-mobile-card-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2",style:{minWidth:0}},React.createElement("input",{type:"checkbox",checked:!!w&&Te.has(w),onChange:b=>{const C=!!b.target.checked;x(_=>{const z=new Set(_);return w&&(C?z.add(w):z.delete(w)),z})}}),React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none text-truncate",onClick:()=>{Me(c||null),Y(!0)}},w||"\u2014")),React.createElement("span",{className:`badge ${f==="paid"?"bg-primary":"bg-secondary"}`},f==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":(c==null?void 0:c.status)||((q=c==null?void 0:c.raw)==null?void 0:q.status)||"\u2014")),React.createElement("div",{className:"small text-muted mt-1"},window.KTM.date.formatDateTime(c==null?void 0:c.created_at),c!=null&&c.phone?` \u2022 ${c.phone}`:""),React.createElement("div",{className:"recon-mobile-kv mt-2"},React.createElement("span",{className:"text-muted"},"Thu h\u1ED9"),React.createElement("span",{className:"fw-semibold"},window.KTM.money.formatNumber(c==null?void 0:c.cod))),React.createElement("div",{className:"recon-mobile-value mt-2"},React.createElement("span",{className:"text-muted"},"Excel:")," ",((E=r==null?void 0:r.group)==null?void 0:E.productDisplay)||"\u2014"),React.createElement("div",{className:"recon-mobile-value mt-1"},React.createElement("span",{className:"text-muted"},"H\u1EC7 th\u1ED1ng:")," ",(c==null?void 0:c.productSummary)||"\u2014"))}),React.createElement("div",{className:"text-muted small mt-2"},"Hi\u1EC3n th\u1ECB t\u1ED1i \u0111a 50 \u0111\u01A1n. D\xF9ng l\u1ECDc S\u0110T \u0111\u1EC3 thu h\u1EB9p."))))))),React.createElement(AdminDrawer,{open:F,title:re?`Order #${re.id}`:"Order",subtitle:re?`${re.phone||""} \u2022 ${window.KTM.money.formatNumber(Number(re.cod||0))}`:"",onClose:()=>{Y(!1),Me(null)}},re?React.createElement("div",{className:"small"},React.createElement("div",{className:"mb-2"},React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Tr\u1EA1ng th\xE1i:")," ",re.status||"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"created_at:")," ",window.KTM.date.formatDateTime(re.created_at)),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"updated_at:")," ",re.updated_at?window.KTM.date.formatDateTime(re.updated_at):"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:")," ",re.productSummary||"\u2014")),React.createElement("div",{className:"fw-semibold mb-1"},"Line items"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"#"),React.createElement("th",null,"product_id"),React.createElement("th",{className:"text-end"},"qty"),React.createElement("th",{className:"text-end"},"price"),React.createElement("th",{className:"text-end"},"total"))),React.createElement("tbody",null,(Array.isArray((dt=re==null?void 0:re.raw)==null?void 0:dt.items)?re.raw.items:[]).map((r,c)=>{var E,b,C,_,z,ne;const w=String((b=(E=r==null?void 0:r.product_id)!=null?E:r==null?void 0:r.id)!=null?b:"").trim(),f=Number((_=(C=r==null?void 0:r.qty)!=null?C:r==null?void 0:r.quantity)!=null?_:0)||0,M=Number((ne=(z=r==null?void 0:r.price)!=null?z:r==null?void 0:r.unit_price)!=null?ne:0)||0,q=f*M;return React.createElement("tr",{key:`li-${c}-${w}`},React.createElement("td",{className:"text-muted"},c+1),React.createElement("td",{className:"text-muted"},w||"\u2014"),React.createElement("td",{className:"text-end"},f),React.createElement("td",{className:"text-end"},window.KTM.money.formatNumber(M)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(q)))}))))):null))}function AdminApp(){const[D,L]=useState(!1),[j,ve]=useState(""),[ae,W]=useState(null),[X,Ee]=useState("search"),[Be,Se]=useState(()=>loadAdminPins()),[Ge,nt]=useState(()=>loadAdminRecent()),[qe,Xe]=useState(null),[ue,Le]=useState(""),[B,pt]=useState([]),[gt,At]=useState(null),[We,tt]=useState(!1),[Re,yt]=useState(null),[Kt,an]=useState(!0),[Ze,Lt]=useState([]),[jt,T]=useState(!1),[A,H]=useState(null),[ye,Ne]=useState(!1),[le,me]=useState(!1),[Te,x]=useState(""),[F,Y]=useState(()=>loadAdminSettings()),[re,Me]=useState(null),[Ae,Qe]=useState([]);useEffect(()=>{const u=localStorage.getItem("ktm_admin_session");if(u)try{const V=JSON.parse(u);V.expiry>Date.now()?(L(!0),W(V.user)):localStorage.removeItem("ktm_admin_session")}catch(V){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{D&&$t()},[D]),useEffect(()=>{const u=()=>{try{const te=document.querySelector(".admin-topbar");if(!te)return;const Oe=te.getBoundingClientRect(),Pe=Math.max(0,Math.round(Oe.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${Pe+10}px`)}catch(te){}};u(),window.addEventListener("resize",u);const V=setTimeout(u,0);return()=>{clearTimeout(V),window.removeEventListener("resize",u)}},[D,X]),useEffect(()=>{var te,Oe;const u=window.visualViewport,V=()=>{try{const Pe=Number(window.innerHeight)||0,Je=Number(u==null?void 0:u.height)||Pe,wt=Number(u==null?void 0:u.offsetTop)||0,et=Math.max(0,Math.round(Pe-Je-wt));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${et}px`)}catch(Pe){}};V(),window.addEventListener("resize",V);try{(te=u==null?void 0:u.addEventListener)==null||te.call(u,"resize",V),(Oe=u==null?void 0:u.addEventListener)==null||Oe.call(u,"scroll",V)}catch(Pe){}return()=>{var Pe,Je;window.removeEventListener("resize",V);try{(Pe=u==null?void 0:u.removeEventListener)==null||Pe.call(u,"resize",V),(Je=u==null?void 0:u.removeEventListener)==null||Je.call(u,"scroll",V)}catch(wt){}}},[]),useEffect(()=>{if(!D)return;const u=te=>{if(!te)return!1;const Oe=String(te.tagName||"").toLowerCase();return!!(Oe==="input"||Oe==="textarea"||Oe==="select"||te.isContentEditable)},V=te=>{if(!te||te.ctrlKey||te.metaKey||te.altKey||u(te.target))return;const Oe=te.key;(Oe==="/"||Oe==="N"||Oe==="n"||Oe==="Escape"||Oe==="j"||Oe==="J"||Oe==="k"||Oe==="K")&&(Oe==="/"&&te.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:Oe}})))};return document.addEventListener("keydown",V),()=>document.removeEventListener("keydown",V)},[D]),useEffect(()=>{D&&nt(u=>{const V=Array.isArray(u)?u:[],te=[X,...V.filter(Oe=>Oe!==X)].slice(0,8);return saveAdminRecent(te),te})},[D]);const Ue=u=>{const V=String(u||"").trim();V&&nt(te=>{const Oe=Array.isArray(te)?te:[],Pe=[V,...Oe.filter(Je=>Je!==V)].slice(0,8);return saveAdminRecent(Pe),Pe})},Tt=u=>{const V=String(u||"").trim();V&&Se(te=>{const Oe=Array.isArray(te)?te:[],Je=Oe.includes(V)?Oe.filter(wt=>wt!==V):[V,...Oe].slice(0,10);return saveAdminPins(Je),Je})};useEffect(()=>{if(!D)return;let u=!1;return(async()=>{try{const V=await fetchAdminSettingsFromServer();if(u)return;Y(V),saveAdminSettings(V)}catch(V){}})(),()=>{u=!0}},[D]);const Ot=async(u,V)=>{ve("");try{const te=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:u,password:V},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),Oe={user:te.user,token:te.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(Oe)),W(te.user),L(!0)}catch(te){ve(te.message)}},_e=()=>{localStorage.removeItem("ktm_admin_session"),L(!1),W(null),pt([]),At(null)},it=(u,V="success",te=null)=>{const Oe=Date.now()+Math.floor(Math.random()*1e3);if(u&&typeof u=="object"){const Je=u;Lt(wt=>[...wt,{id:Oe,message:String(Je.message||""),type:String(Je.type||V||"success"),actionLabel:Je.actionLabel||null,onAction:typeof Je.onAction=="function"?Je.onAction:null,durationMs:Je.durationMs||null}]);return}const Pe=te&&typeof te=="object"?te:null;Lt(Je=>[...Je,{id:Oe,message:String(u||""),type:String(V||"success"),actionLabel:(Pe==null?void 0:Pe.actionLabel)||null,onAction:typeof(Pe==null?void 0:Pe.onAction)=="function"?Pe.onAction:null,durationMs:(Pe==null?void 0:Pe.durationMs)||null}])},Qt=u=>{Lt(V=>V.filter(te=>te.id!==u))},$t=async(u=null)=>{an(!0);try{const V=u?`${API_BASE}/api/albums?parent_id=${u}`:`${API_BASE}/api/albums?parent_id=root`,te=await window.KTM.api.getJSON(V,"L\u1ED7i t\u1EA3i danh s\xE1ch album");pt(Array.isArray(te)?te:[])}catch(V){console.error(V),it("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}an(!1)},ln=()=>{yt(null),tt(!0)},Ft=u=>{Ye(u),Ne(!0)},hn=async(u,V="modal")=>{try{const te=Re&&Re.uuid;!te&&re&&(u.parent_id=re.uuid);const Oe=te?`${API_BASE}/api/albums/${Re.uuid||Re.id}`:`${API_BASE}/api/albums`;te?await window.KTM.api.putJSON(Oe,u,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(Oe,u,"L\u1ED7i t\u1EA1o"),it(te?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),V==="drawer"?(Ne(!1),yt(null),$t(re==null?void 0:re.uuid),te&&A&&H({...A,...u})):(tt(!1),yt(null),$t(re==null?void 0:re.uuid))}catch(te){it(te.message,"danger")}},gn=u=>{At(u)},R=u=>{if(u==="root")Qe([]),Me(null),$t(null);else if(u){const V=Ae.findIndex(te=>te.uuid===u.uuid);V>=0&&(Qe(Ae.slice(0,V+1)),Me(u),$t(u.uuid))}else{const V=[...Ae];V.pop();const te=V[V.length-1]||null;Qe(V),Me(te),$t(te==null?void 0:te.uuid)}},se=async u=>{const V=`X\xF3a folder "${u.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(V))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${u.uuid||u.id}`,"L\u1ED7i x\xF3a album"),it("\u0110\xE3 x\xF3a","success"),$t(re==null?void 0:re.uuid)}catch(te){it("L\u1ED7i x\xF3a album","danger")}},Ye=async u=>{u&&(T(!0),x(""),me(!1),Ne(!1),H(u))},Bt=()=>{T(!1),me(!1),x(""),Ne(!1),H(null)},fn=u=>{Ne(!0)};if(!D)return React.createElement(LoginPage,{onLogin:Ot,error:j});const zt=()=>{const u=new Date,V=u.getFullYear(),te=String(u.getMonth()+1).padStart(2,"0");return`${V}-${te}`};function Gt(){const[u,V]=useState(()=>{var Je;return String((Je=F==null?void 0:F.ship_percent)!=null?Je:DEFAULT_SHIP_PERCENT)}),[te,Oe]=useState(!1);return useEffect(()=>{var Je;V(String((Je=F==null?void 0:F.ship_percent)!=null?Je:DEFAULT_SHIP_PERCENT))},[F==null?void 0:F.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Je=>{Je.preventDefault(),Oe(!0);const wt=saveAdminSettings({ship_percent:u});try{const et=await saveAdminSettingsToServer(wt);Y(et),saveAdminSettings(et),it("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(et){Y(wt),it("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{Oe(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:u,min:"0",max:"100",step:"0.01",onChange:Je=>V(Je.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:te},te?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function P(){const[u,V]=useState(zt()),[te,Oe]=useState(!0),Pe=useRef(null),Je=useRef(null),[wt,et]=useState(0),[dn,Xt]=useState(!1),sn=useRef(0),bn=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[at,mn]=useState(bn),_n=useRef(new Map),vn=normalizeShipPercent(F==null?void 0:F.ship_percent),{formatNumber:dt,formatVND:r}=window.KTM.money,c=async(I,oe=!1)=>{var Mt,en;const ze=String(I||"").trim();if(!ze)return bn();const ht=`${ze}|${vn}`,xt=(Mt=_n.current)==null?void 0:Mt.get(ht);if(!oe&&xt)return xt;const Jt=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(ze)}&ship_percent=${encodeURIComponent(vn)}`,Nt=await window.KTM.api.getJSON(Jt,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),Et=Nt!=null&&Nt.stats&&(Nt!=null&&Nt.meta)?Nt.stats:Nt,Zt=Et&&typeof Et=="object"?Et:bn();return(en=_n.current)==null||en.set(ht,Zt),Zt},w=async(I=!1)=>{Oe(!0);try{const oe=await c(u,I);mn(oe)}catch(oe){console.error("Load stats error:",oe),mn(bn())}finally{Oe(!1)}};useEffect(()=>{w()},[u,vn]);const f=(I,oe)=>{const ze=String(I||"").trim(),ht=ze.match(/^(\d{4})-(\d{2})$/);if(!ht)return ze;const xt=Number(ht[1]),Jt=Number(ht[2])-1,Nt=new Date(xt,Jt,1);Nt.setMonth(Nt.getMonth()+Number(oe||0));const Et=Nt.getFullYear(),Zt=String(Nt.getMonth()+1).padStart(2,"0");return`${Et}-${Zt}`},M=zt(),q=f(M,-5),E=I=>{const oe=String(I||"").trim();return oe?oe>=q&&oe<=M:!1},b=I=>{const oe=String(I||"").trim();return oe&&(oe<q?q:oe>M?M:oe)},C=I=>{const oe=Date.now();oe-Number(sn.current||0)<1200||(sn.current=oe,it(I==="future"?"Kh\xF4ng xem \u0111\u01B0\u1EE3c th\xE1ng t\u01B0\u01A1ng lai":"Ch\u1EC9 xem t\u1ED1i \u0111a 5 th\xE1ng g\u1EA7n nh\u1EA5t","warning"))},_=(I,oe,ze)=>Math.max(oe,Math.min(ze,I)),z=()=>{var I;return Math.max(320,Number((I=Je.current)==null?void 0:I.clientWidth)||360)},ne=()=>{const I=z();return _(Math.floor(I*.35),110,180)},we=()=>{const I=z();return _(Math.floor(I*.22),70,140)},ie=I=>{try{if(!(I!=null&&I.touches)||I.touches.length!==1||dn)return;const oe=I.target;if(oe&&typeof oe.closest=="function"&&oe.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Pe.current=null;return}const ze=I.touches[0];Pe.current={x:ze.clientX,y:ze.clientY,at:Date.now(),swiping:!1}}catch(oe){Pe.current=null}},$e=I=>{const oe=Pe.current;if(!oe||dn)return;const ze=(I==null?void 0:I.touches)&&I.touches[0];if(!ze)return;const ht=ze.clientX-oe.x,xt=ze.clientY-oe.y,Jt=Math.abs(ht),Nt=Math.abs(xt);if(!oe.swiping)if(Jt>12&&Jt>Nt*1.2)oe.swiping=!0,Xt(!1);else return;const Et=ne();et(_(ht,-Et,Et))},Ie=I=>{const oe=Pe.current;if(Pe.current=null,!oe||dn||!oe.swiping){et(0);return}const ze=(I==null?void 0:I.changedTouches)&&I.changedTouches[0];if(!ze)return;const ht=ze.clientX-oe.x,xt=ze.clientY-oe.y,Jt=Date.now()-oe.at,Nt=Math.abs(ht),Et=Math.abs(xt);if(Jt>1e3)return;if(Nt<30){et(0);return}if(Nt<Et*1.5)return;const Zt=we(),Mt=Nt>=Zt,en=ht>0?1:-1;if(!Mt){Xt(!0),et(0),setTimeout(()=>Xt(!1),220);return}const pn=en>0?-1:1,Q=f(u,pn);if(!E(Q)){Xt(!0),et(en*Math.floor(ne()*.55)),setTimeout(()=>{et(0),setTimeout(()=>Xt(!1),200)},140),C(Q>M?"future":"past");return}Xt(!0),et(en*ne()),setTimeout(()=>{V(s=>f(s,pn)),et(-en*ne()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{et(0),setTimeout(()=>Xt(!1),220)})})},140)},Ve=()=>{Pe.current=null,et(0)},xe=I=>{var oe,ze;try{if(!I||I.pointerType==="touch"||typeof I.button=="number"&&I.button!==0||dn)return;const ht=I.target;if(ht&&typeof ht.closest=="function"&&ht.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Pe.current=null;return}Pe.current={x:I.clientX,y:I.clientY,at:Date.now(),swiping:!1};try{(ze=(oe=I.currentTarget)==null?void 0:oe.setPointerCapture)==null||ze.call(oe,I.pointerId)}catch(xt){}}catch(ht){Pe.current=null}},mt=I=>{try{if(!I||I.pointerType==="touch")return;const oe=Pe.current;if(!oe||dn)return;const ze=I.clientX-oe.x,ht=I.clientY-oe.y,xt=Math.abs(ze),Jt=Math.abs(ht);if(!oe.swiping)if(xt>12&&xt>Jt*1.2)oe.swiping=!0,Xt(!1);else return;const Nt=ne();et(_(ze,-Nt,Nt))}catch(oe){}},de=I=>{try{if(!I||I.pointerType==="touch")return;const oe=Pe.current;if(Pe.current=null,!oe||dn||!oe.swiping){et(0);return}const ze=I.clientX-oe.x,ht=I.clientY-oe.y,xt=Date.now()-oe.at,Jt=Math.abs(ze),Nt=Math.abs(ht);if(xt>1e3)return;if(Jt<30){et(0);return}if(Jt<Nt*1.5)return;const Et=we(),Zt=Jt>=Et,Mt=ze>0?1:-1;if(!Zt){Xt(!0),et(0),setTimeout(()=>Xt(!1),220);return}const en=Mt>0?-1:1,pn=f(u,en);if(!E(pn)){Xt(!0),et(Mt*Math.floor(ne()*.55)),setTimeout(()=>{et(0),setTimeout(()=>Xt(!1),200)},140),C(pn>M?"future":"past");return}Xt(!0),et(Mt*ne()),setTimeout(()=>{V(Q=>f(Q,en)),et(-Mt*ne()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{et(0),setTimeout(()=>Xt(!1),220)})})},140)}catch(oe){Pe.current=null}},He=()=>{Pe.current=null,et(0)},It=wt>0?"Th\xE1ng tr\u01B0\u1EDBc":wt<0?"Th\xE1ng sau":"",St=wt>0?f(u,-1):wt<0?f(u,1):"",vt=St&&E(St)?St:"",je=Math.min(1,Math.abs(wt)/Math.max(1,we()));return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager",ref:Je,style:{touchAction:"pan-y",transform:`translateX(${wt}px)`,transition:dn?"transform 220ms ease":"none",willChange:"transform"},onTouchStartCapture:ie,onTouchMoveCapture:$e,onTouchEndCapture:Ie,onTouchCancelCapture:Ve,onPointerDown:xe,onPointerMove:mt,onPointerUp:de,onPointerCancel:He},!!It&&React.createElement("div",{"aria-hidden":"true",style:{position:"fixed",left:0,right:0,top:84,zIndex:1060,pointerEvents:"none",opacity:.15+.55*je,transform:"translateZ(0)"}},React.createElement("div",{className:"d-flex justify-content-center"},React.createElement("div",{className:"px-3 py-2 rounded-pill bg-dark text-white shadow-sm",style:{fontSize:13}},wt>0?"\u2190":"\u2192"," ",It," \xB7 ",vt))),React.createElement(Loading,{show:te}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>w(!0),disabled:te},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:u,onChange:I=>V(I.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",vn,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),dt(at.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),dt(at.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),dt(at.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",dt(at.statusCounts.paid),"/",dt(at.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},dt(at.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},r(at.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},r(at.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},r(at.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},r(at.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",at.avgQtyPerOrder?at.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},dt(at.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},dt(at.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},dt(at.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},dt(at.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},dt(at.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},dt(at.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},dt(at.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,dt(at.statusCounts.draft)),React.createElement("td",null,dt(at.statusCounts.pending)),React.createElement("td",null,dt(at.statusCounts.processing)),React.createElement("td",null,dt(at.statusCounts.canceled)),React.createElement("td",null,dt(at.statusCounts.done)),React.createElement("td",null,dt(at.statusCounts.paid)),React.createElement("td",null,dt(at.statusCounts.other)),React.createElement("td",null,dt(at.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},at.products.slice(0,10).map(I=>React.createElement("div",{key:I.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},I.product_name),React.createElement("div",{className:"text-muted small text-truncate"},I.product_code?`#${I.product_code} \u2022 `:"",dt(I.orders)," \u0111\u01A1n \u2022 ",dt(I.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},r(I.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,at.products.slice(0,10).map(I=>React.createElement("tr",{key:I.product_id},React.createElement("td",null,I.product_name),React.createElement("td",null,I.product_code||"\u2014"),React.createElement("td",null,dt(I.orders)),React.createElement("td",null,dt(I.quantity)),React.createElement("td",{className:"fw-semibold"},r(I.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},at.customers.slice(0,10).map(I=>React.createElement("div",{key:I.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},I.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},I.phone||"\u2014"," \u2022 ",dt(I.orders)," \u0111\u01A1n \u2022 ",dt(I.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},r(I.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,at.customers.slice(0,10).map(I=>React.createElement("tr",{key:I.key},React.createElement("td",null,I.customer_name||"\u2014"),React.createElement("td",null,I.phone||"\u2014"),React.createElement("td",null,dt(I.orders)),React.createElement("td",null,dt(I.quantity)),React.createElement("td",{className:"fw-semibold"},r(I.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},at.days.map(I=>React.createElement("div",{key:I.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},I.day),React.createElement("div",{className:"text-muted small"},dt(I.orders)," \u0111\u01A1n \u2022 ",dt(I.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",dt(I.doneOrders)," \u2022 ",r(I.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},r(I.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,at.days.map(I=>React.createElement("tr",{key:I.day},React.createElement("td",null,I.day),React.createElement("td",null,dt(I.orders)),React.createElement("td",null,dt(I.quantity)),React.createElement("td",{className:"fw-semibold"},r(I.revenue)),React.createElement("td",null,dt(I.doneOrders)),React.createElement("td",{className:"fw-semibold"},r(I.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:X,onMenuChange:u=>{Ue(u),Ee(u),u==="albums"&&(Me(null),Qe([]),$t(null))},onLogout:_e,currentUser:ae,pinnedMenus:Be,recentMenus:Ge,onTogglePin:Tt}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const V={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},recon:{title:"\u0110\u1ED1i so\xE1t Excel",icon:"fa-file-excel",sub:"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 t\u1EEB Excel"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[X]||{title:"KTM Admin",icon:"fa-tractor",sub:""},te=(ae==null?void 0:ae.username)||(ae==null?void 0:ae.name)||(ae==null?void 0:ae.email)||"Admin",Oe=(()=>{if(X!=="albums")return"";const Pe=[];return Pe.push("Root"),Array.isArray(Ae)&&Ae.length>0&&Pe.push(...Ae.map(Je=>Je==null?void 0:Je.title).filter(Boolean)),gt!=null&&gt.title&&Pe.push(gt.title),Pe.length>0?Pe.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${V.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},V.title),React.createElement("div",{className:"admin-page-subtitle"},Oe||V.sub))),React.createElement("div",{className:"admin-topbar-right"},X==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:ln,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:te},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},te)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:_e,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},X==="albums"&&!gt&&React.createElement(AlbumList,{albums:B,loading:Kt,currentFolder:re,breadcrumb:Ae,onSelect:gn,onCreate:ln,onEdit:Ft,onDelete:se,onBack:R}),X==="search"&&React.createElement(SearchCenter,{showToast:it,onNavigate:(u,V,te)=>{Ee(u),u==="orders"&&V==="create"&&(Xe(Date.now()),Le((te==null?void 0:te.productId)||""))}}),X==="albums"&&gt&&React.createElement(AlbumDetail,{album:gt,parentAlbum:Ae.length>0?Ae[Ae.length-1]:null,onBack:()=>{if(gt.parentId){const u=Ae.findIndex(V=>V.uuid===gt.parentId);u>=0?At(Ae[u]):At(null)}else At(null)},onRefresh:()=>$t(re==null?void 0:re.uuid),showToast:it,onNavigateToFolder:u=>{Qe(V=>[...V,gt]),At(u)},onEditSubfolder:u=>{yt(u),tt(!0)}}),X==="videos"&&React.createElement(VideoList,{showToast:it}),X==="products"&&React.createElement(ProductManager,{showToast:it,settings:F}),X==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:qe,autoOpenCreateProductId:ue,showToast:it}),X==="recon"&&React.createElement(ReconExcelManager,{showToast:it}),X==="stats"&&React.createElement(P,null),X==="settings"&&React.createElement(Gt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${X==="search"?"active":""}`,onClick:u=>{u.preventDefault(),Ee("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${X==="albums"?"active":""}`,onClick:u=>{u.preventDefault(),Ee("albums"),At(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${X==="videos"?"active":""}`,onClick:u=>{u.preventDefault(),Ee("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${X==="products"?"active":""}`,onClick:u=>{u.preventDefault(),Ee("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${X==="orders"?"active":""}`,onClick:u=>{u.preventDefault(),Ee("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${X==="recon"?"active":""}`,onClick:u=>{u.preventDefault(),Ee("recon")}},React.createElement("i",{className:"fas fa-file-excel"}),React.createElement("span",null,"\u0110\u1ED1i so\xE1t")),React.createElement("a",{href:"#",className:`nav-item ${X==="stats"?"active":""}`,onClick:u=>{u.preventDefault(),Ee("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:We,album:Re,parentId:re==null?void 0:re.uuid,onClose:()=>tt(!1),onSave:hn}),React.createElement(AdminDrawer,{open:jt,title:A?A.title:"Album",subtitle:A?`${A.subfolderCount||0} subfolder \u2022 ${A.count||0} \u1EA3nh`:"",onClose:Bt,footer:ye?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Ne(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{A&&(yt(A),hn({slug:A.id||"",title:A.title||"",description:A.description||"",cover_url:A.cover||"",parent_id:A.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):A?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(A.title),it("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>fn(A)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{A&&confirm(`X\xF3a folder "${A.title}"?`)&&(se(A),Bt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ye&&A?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:A.title,onChange:u=>H({...A,title:u.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:A.description,onChange:u=>H({...A,description:u.target.value})}))):A?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},A.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},A.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},A.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},A.count||0))),A.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,A.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Ze.map(u=>React.createElement(Toast,{key:u.id,message:u.message,type:u.type,actionLabel:u.actionLabel,onAction:u.onAction,durationMs:u.durationMs,onClose:()=>Qt(u.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:D,autoOpenCreateProductId:L,showToast:j}){const[ve,ae]=useState([]),[W,X]=useState(0),[Ee,Be]=useState(!1),[Se,Ge]=useState(!1),[nt,qe]=useState([]),[Xe,ue]=useState(!0),[Le,B]=useState(!1),[pt,gt]=useState([]),[At,We]=useState(!1),[tt,Re]=useState(""),[yt,Kt]=useState([]),[an,Ze]=useState(!1),[Lt,jt]=useState(""),[T,A]=useState(!1),[H,ye]=useState(null),[Ne,le]=useState(null),[me,Te]=useState(!1),[x,F]=useState(()=>{const e=new Date,n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${n}-${t}`}),[Y,re]=useState(""),[Me,Ae]=useState(!1),[Qe,Ue]=useState(!1),[Tt,Ot]=useState(!1),[_e,it]=useState(null),[Qt,$t]=useState(!1),[ln,Ft]=useState(""),[hn,gn]=useState(!1),R=useRef(0),[se,Ye]=useState(!1),[Bt,fn]=useState(null),[zt,Gt]=useState(!1),[P,u]=useState(null),[V,te]=useState(()=>({left:12,top:12,placement:"bottom"})),Oe=useRef(null),Pe=useRef(!1),Je=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1}),[wt,et]=useState(()=>({id:null,dir:null})),dn=useRef(!1),Xt=useRef(new Map),sn=useRef(null),bn=useRef(null),at="ktm_orders_status_sync_queue_v1",mn=useRef([]),_n=useRef(!1),[vn,dt]=useState(()=>({})),[r,c]=useState(!1),[w,f]=useState(!1),[M,q]=useState(!1),[E,b]=useState(()=>new Set),[C,_]=useState(()=>({})),z="ktm_orders_pinned_v1",[ne,we]=useState(()=>new Set),[ie,$e]=useState(!1),[Ie,Ve]=useState(!1),[xe,mt]=useState(!1),[de,He]=useState(""),[It,St]=useState(()=>[]),vt=useRef(null),je=useRef(null),I=useRef(!1),oe=useRef({active:!1,startY:0,startX:0,fired:!1}),[ze,ht]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),xt=24,Jt=20,[Nt,Et]=useState(xt),Zt=useRef(null),Mt=useRef(null),en=useRef(!1),pn=useRef(new Map),Q=useRef({timer:null,events:[]}),s=useRef(null),d="ktm_orders_phone_tip_v1",l="ktm_orders_search_history_v1",[S,$]=useState(null),[N,y]=useState(!1),[G,ce]=useState([]),[J,Z]=useState(!1),[Ke,Ce]=useState([]),[h,be]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[pe,st]=useState([""]),[ot,kt]=useState(null),Ut=useRef({}),[qt,Vt]=useState([]),[bt,rn]=useState(null),un=useRef(null),on=useRef(null),U=useRef(0),ee=useRef(null),ge=useRef(0),Fe=useRef(new Map),De=useRef(null),ke=useRef(0),ut=useRef(new Map),ct=useRef(new Map),Ct=useRef(""),Yt=useRef(null),cn=useRef(null),Nn=useRef(0),xn=useRef(null),Sn=9,kn=150,$n=250,In=3*60*1e3,Dn=24*60*60*1e3,qn=5*60*1e3,Pn="ktm_customer_lookup_cache_v1",fa=200,Rn=3,Hn=3,Ea=1,Ds=24*60*60*1e3,Rs=120,Ks=5*60*1e3,Ya=80,Qa=2,Za=4,es=60,rt=React.useMemo(()=>String(tt||"").trim().length>0,[tt]),ia=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),ts=e=>{fn(e),Ye(!0)},ns=(e,n)=>{var t,a,i,o;try{const g=(t=n==null?void 0:n.getBoundingClientRect)==null?void 0:t.call(n),p=window.innerWidth||360,K=window.innerHeight||640,v=230,m=280,k=Math.min(Math.max(10,Math.round((a=g==null?void 0:g.left)!=null?a:10)),Math.max(10,p-v-10));let O=Math.round(((i=g==null?void 0:g.bottom)!=null?i:10)+8),he="bottom";O+m>K-10&&(O=Math.max(10,Math.round(((o=g==null?void 0:g.top)!=null?o:10)-8-m)),he="top"),te({left:k,top:O,placement:he})}catch(g){te({left:12,top:12,placement:"bottom"})}u(e),Gt(!0)},zn=()=>{Gt(!1),setTimeout(()=>u(null),120)};useEffect(()=>{if(!zt)return;const e=n=>{n.key==="Escape"&&zn()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[zt]);const Xn=()=>{Ye(!1),setTimeout(()=>fn(null),180)},Os=()=>{c(!0)},ba=()=>{c(!1)},as=e=>{const n=String(e||"").trim();n&&b(t=>{const a=new Set(t);return a.has(n)?a.delete(n):a.add(n),a})};useEffect(()=>{try{const e=localStorage.getItem(z);if(!e)return;const n=JSON.parse(e);if(!Array.isArray(n))return;we(new Set(n.map(t=>String(t||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from(ne||[]).map(n=>String(n||"").trim()).filter(Boolean);localStorage.setItem(z,JSON.stringify(e))}catch(e){}},[ne]);const Es=e=>{const n=String(e||"").trim();n&&we(t=>{const a=new Set(t);return a.has(n)?a.delete(n):a.add(n),a})};useEffect(()=>{try{const e=localStorage.getItem(l);if(!e)return;const n=JSON.parse(e);if(!Array.isArray(n))return;St(n.map(t=>String(t||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Ls=e=>{try{localStorage.setItem(l,JSON.stringify(e))}catch(n){}},oa=e=>{const n=String(e||"").trim();n&&St(t=>{const a=Array.isArray(t)?t:[],i=[n,...a.filter(o=>String(o||"").trim().toLowerCase()!==n.toLowerCase())].slice(0,10);return Ls(i),i})},ss=e=>{var t;const n=String((t=e!=null?e:tt)!=null?t:"").trim();He(n),mt(!0),setTimeout(()=>{var a,i;try{(i=(a=vt.current)==null?void 0:a.focus)==null||i.call(a)}catch(o){}},0)},Tn=()=>{mt(!1)};useEffect(()=>{if(!xe)return;const e=n=>{n.key==="Escape"&&Tn()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[xe]),useEffect(()=>{if(!ze)return;const e=a=>{if(xe||(window.scrollY||0)>6)return;const i=a.touches&&a.touches[0];i&&(oe.current={active:!0,startY:i.clientY,startX:i.clientX,fired:!1})},n=a=>{const i=oe.current;if(!(i!=null&&i.active)||i.fired||(window.scrollY||0)>6)return;const o=a.touches&&a.touches[0];if(!o)return;const g=o.clientY-i.startY,p=o.clientX-i.startX;Math.abs(p)>24||g>92&&(i.fired=!0,ss(tt))},t=()=>{oe.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",n,{passive:!0}),window.addEventListener("touchend",t,{passive:!0}),window.addEventListener("touchcancel",t,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",n),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)}},[ze,xe,tt]);const rs=e=>{try{const n=yn(e==null?void 0:e.status);if(!(n==="pending"||n==="processing"))return!1;const t=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(t.getTime()))return!1;const a=new Date;return t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()}catch(n){return!1}};useEffect(()=>{var t;let e;const n=()=>{try{ht(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(a){ht(!1)}};try{e=(t=window.matchMedia)==null?void 0:t.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",n):e!=null&&e.addListener&&e.addListener(n)}catch(a){e=null}return window.addEventListener("resize",n),n(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",n):e!=null&&e.removeListener&&e.removeListener(n)}catch(a){}window.removeEventListener("resize",n)}},[]),useEffect(()=>{const e="admin-sheet-open";return se||r||zt?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[se,r,zt]),useEffect(()=>{if(!se&&!r&&!zt)return;const e=n=>{n.key==="Escape"&&(se&&Xn(),r&&ba(),zt&&zn())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[se,r,zt]);const Ps=()=>{try{if(localStorage.getItem(d))return;localStorage.setItem(d,"1"),typeof j=="function"&&j("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},is=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),os=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),cs=e=>{const n=Wt(String(e||"")).replace(/[^0-9+]/g,"");if(n)try{window.location.href=`tel:${n}`}catch(t){}},js=async e=>{var t,a,i;const n=Wt(String(e||"")).replace(/[^0-9+]/g,"");if(n)try{await((i=(a=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:a.call(t,n))!=null?i:Promise.reject(new Error("Clipboard not available"))),typeof j=="function"&&j("\u0110\xE3 copy S\u0110T","success")}catch(o){typeof j=="function"&&j("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Fs=()=>{try{const e=localStorage.getItem(at),n=e?JSON.parse(e):[];return Array.isArray(n)?n:[]}catch(e){return[]}},ls=e=>{try{localStorage.setItem(at,JSON.stringify(Array.isArray(e)?e:[]))}catch(n){}},ga=(e,n)=>{const t=String(e||"").trim();t&&dt(a=>{const i={...a||{}};return n?i[t]=!0:delete i[t],i})},Bs=(e,n,t)=>{const a=String(e||"").trim(),i=yn(n),o=yn(t);if(!a||!i)return;const g=Array.isArray(mn.current)?mn.current:[],p=new Map(g.map(v=>[String((v==null?void 0:v.orderId)||""),v]));p.set(a,{orderId:a,nextStatus:i,prevStatus:o,ts:Date.now()});const K=Array.from(p.values()).sort((v,m)=>(Number(v.ts)||0)-(Number(m.ts)||0));mn.current=K,ls(K),ga(a,!0)},La=async()=>{if(_n.current||!navigator.onLine)return;const e=Array.isArray(mn.current)?mn.current.slice():[];if(e.length){_n.current=!0;try{for(const n of e){const t=String((n==null?void 0:n.orderId)||"").trim(),a=yn(n==null?void 0:n.nextStatus);if(!(!t||!a)){ga(t,!0);try{await Jn({id:t,status:(n==null?void 0:n.prevStatus)||""},a,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const i=(Array.isArray(mn.current)?mn.current:[]).filter(o=>String((o==null?void 0:o.orderId)||"")!==t);mn.current=i,ls(i),ga(t,!1)}catch(i){if(!navigator.onLine)break}}}}finally{_n.current=!1}}};useEffect(()=>{const e=Fs();mn.current=e;try{const n={};for(const t of e){const a=String((t==null?void 0:t.orderId)||"").trim();a&&(n[a]=!0)}dt(n)}catch(n){}setTimeout(()=>La(),600)},[]),useEffect(()=>{const e=()=>La();window.addEventListener("online",e);const n=setInterval(()=>La(),8e3);return()=>{clearInterval(n),window.removeEventListener("online",e)}},[]);const qs=(e,n)=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e),en.current=!1,Ps();try{Mt.current&&clearTimeout(Mt.current)}catch(a){}Mt.current=setTimeout(()=>{en.current=!0,js(n)},520)},ya=e=>{var n;(n=e==null?void 0:e.stopPropagation)==null||n.call(e);try{Mt.current&&clearTimeout(Mt.current)}catch(t){}Mt.current=null},Hs=e=>{const n=String(e||"").trim();if(!n)return;_(i=>({...i,[n]:Date.now()}));const t=pn.current;try{const i=t.get(n);i&&clearTimeout(i)}catch(i){}const a=setTimeout(()=>{_(i=>{const o={...i||{}};return delete o[n],o});try{t.delete(n)}catch(i){}},9e3);t.set(n,a)},ds=e=>String(e||"").replace(/\s+/g," ").trim(),zs=e=>String(e||"").replace(/[^0-9]+/g,""),ca=e=>{try{const n=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(n))return 0;const t=Date.now()-n;return!Number.isFinite(t)||t<=0?0:Math.floor(t/Ds)}catch(n){return 0}},va=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:ca(e)>=Rn,yn=e=>{const n=String(e!=null?e:"").trim().toLowerCase();return n==="cancelled"?"canceled":n},Pa=React.useMemo(()=>["draft","pending","processing","done","paid"],[]),Yn=(e,n)=>{const t=yn(e);if(!t||t==="canceled")return null;const a=Pa.indexOf(t);return a<0?null:n==="left"?Pa[a+1]||null:n==="right"&&Pa[a-1]||null},ms=e=>{var i;const n=yn(e);if(!n)return{label:"",icon:"fa-circle"};const t=((i=ia.find(o=>yn(o==null?void 0:o.value)===n))==null?void 0:i.label)||"",a=(()=>{switch(n){case"draft":return"fa-file-lines";case"pending":return"fa-hourglass-half";case"processing":return"fa-truck";case"done":return"fa-check";case"paid":return"fa-money-bill-wave";case"canceled":return"fa-ban";default:return"fa-circle"}})();return{label:t,icon:a}},Na=e=>{if(yn(e==null?void 0:e.status)!=="draft")return null;const t=Hn-ca(e);return Number.isFinite(t)?t:null},wa=e=>{const n=Na(e);return Number.isFinite(n)?n>0&&n<=Ea:!1},Vn=e=>{be({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),st([""]),$(null),kt(null)};useEffect(()=>{const e=n=>{var a;if(ot==null)return;const t=(a=Ut.current)==null?void 0:a[ot];t&&!t.contains(n.target)&&kt(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ot]);const us=e=>window.KTM.money.parseMoney(e),ps=e=>window.KTM.money.parseSignedMoney(e),Pt=e=>window.KTM.money.formatVND(e),Kn=e=>{const t=(Array.isArray(e)?e:[]).map(a=>{var i,o;return{amount:String((i=a==null?void 0:a.amount)!=null?i:""),note:String((o=a==null?void 0:a.note)!=null?o:"")}});return t.length?t:[{amount:"",note:""}]},Xs=e=>{try{const n=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(n)?n:[]).map(a=>{var i,o;return{amount:(a==null?void 0:a.amount)===0?"":String((i=a==null?void 0:a.amount)!=null?i:""),note:String((o=a==null?void 0:a.note)!=null?o:"").trim()}}).filter(a=>String(a.amount||"").trim()||String(a.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(n){return[{amount:"",note:""}]}},Qn=e=>(Array.isArray(e)?e:[]).map(t=>({amount:ps(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),ja=e=>{const n=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Qn(n),a=Zn(t),i=(()=>{if(!t.length)return"";const o=t.map(g=>String((g==null?void 0:g.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:a,summaryText:i}},Zn=e=>(Array.isArray(e)?e:[]).reduce((t,a)=>t+(Number(a==null?void 0:a.amount)||0),0),Fa=e=>{const n=Array.isArray(e)?e:[];return n.length?JSON.stringify(n):""},hr=e=>window.KTM.money.parseShipFeeFromNote(e),ea=e=>window.KTM.phone.isValid(e),Wt=e=>window.KTM.phone.normalize(e),Ba=async e=>{if(!e)return null;const n=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return n&&typeof n=="object"&&n.order&&typeof n.order=="object"?n.order:n},Vs=(e,n)=>{var o;const t=Array.isArray(e)?e:[],a=Array.isArray(n)?n:[];if(!t.length)return a;if(!a.length)return t;const i=new Map(t.map(g=>{var p;return[String((p=g==null?void 0:g.id)!=null?p:""),g]}));for(const g of a){const p=String((o=g==null?void 0:g.id)!=null?o:"");p&&i.set(p,g)}return Array.from(i.values())},Sa=async e=>{var n,t,a,i;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const o=(t=(n=Xt.current)==null?void 0:n.get)==null?void 0:t.call(n,String(e.id));if(o&&typeof o=="object"&&Array.isArray(o.items)&&o.items.length)return o}catch(o){}try{const o=await Ba(e.id);if(o&&typeof o=="object"){try{(i=(a=Xt.current)==null?void 0:a.set)==null||i.call(a,String(e.id),o)}catch(g){}return ae(g=>Array.isArray(g)?g.map(p=>String(p==null?void 0:p.id)===String(e.id)?o:p):g),o}}catch(o){console.error("Fetch order by id error:",o)}return e},Ws=()=>{var e;try{const n=localStorage.getItem(Pn);if(!n)return;const t=JSON.parse(n);if(!t||typeof t!="object")return;const a=Object.entries(t);for(const[i,o]of a)!i||!o||typeof o!="object"||(e=ct.current)==null||e.set(String(i),o)}catch(n){}},qa=()=>{try{const e=ct.current;if(!e||typeof e.entries!="function")return;const n=Array.from(e.entries()).filter(([a,i])=>a&&i&&typeof i=="object"&&Number.isFinite(i.ts)).sort((a,i)=>(Number(i[1].ts)||0)-(Number(a[1].ts)||0)).slice(0,fa),t={};for(const[a,i]of n)t[a]=i;localStorage.setItem(Pn,JSON.stringify(t))}catch(e){}};useEffect(()=>{Ws()},[]);const hs=e=>{const n=Wt(e);if(!n)return null;const t=Array.isArray(ve)?ve:[];let a=null,i=-1;for(const o of t){if(!o||Wt(o.phone||"")!==n)continue;const g=new Date(o.created_at).getTime(),p=Number.isFinite(g)?g:0;p>=i&&(i=p,a=o)}return a?{name:String(a.customer_name||"").trim(),address:String(a.address||"").trim()}:null},fs=(e,n)=>{e&&be(t=>n&&Wt(t.phone)!==n?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Gs=e=>{const n=hs(e);if(!n)return;const t=Wt(e);be(a=>{if(t&&Wt(a.phone)!==t)return a;const i={...a};return!String(a.customer_name||"").trim()&&n.name&&(i.customer_name=n.name),!String(a.address||"").trim()&&n.address&&(i.address=n.address),i})},Js=(e,n,t)=>{var a;try{const i=Wt(e);if(!i)return;const o=String(n||"").trim(),g=String(t||"").trim();if(!o&&!g)return;(a=ct.current)==null||a.set(i,{ts:Date.now(),status:"found",customer:{phone:i,name:o||null,address:g||null}}),qa()}catch(i){}},xa=async e=>{var i,o,g;const n=Wt(e);if(!n)return;Gs(n);const t=(i=ct.current)==null?void 0:i.get(n);if(t&&Number.isFinite(t.ts)){const p=Date.now()-t.ts,K=t.status==="found"?Dn:qn;if(p>=0&&p<=K){$({status:t.status,phone:n,customer:t.customer}),t.status==="found"&&t.customer&&fs(t.customer,n);return}}const a=++U.current;$({status:"loading",phone:n});try{const p=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(n)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(U.current!==a)return;if(p&&p.exists&&p.customer){(o=ct.current)==null||o.set(n,{ts:Date.now(),status:"found",customer:p.customer}),qa(),$({status:"found",phone:n,customer:p.customer}),fs(p.customer,n);return}(g=ct.current)==null||g.set(n,{ts:Date.now(),status:"not-found",customer:null}),qa(),$({status:"not-found",phone:n})}catch(p){if(U.current!==a)return;console.error("Customer lookup error:",p),$({status:"error",phone:n})}},bs=e=>{const n=Wt(e),t=hs(n);be(i=>{const o={...i,phone:n};return t&&(!String(i.customer_name||"").trim()&&t.name&&(o.customer_name=t.name),!String(i.address||"").trim()&&t.address&&(o.address=t.address)),o}),y(!1),on.current&&(clearTimeout(on.current),on.current=null);const a=n;if(a.length<Sn){$(null);return}if(ea(a)&&a!==Ct.current){Ct.current=a,xa(a);return}on.current=setTimeout(()=>{const i=Wt(n);ea(i)&&i!==Ct.current&&(Ct.current=i,xa(i))},kn)},gs=()=>{const e=Wt(h.phone);e.length<Sn||ea(e)&&e!==Ct.current&&(Ct.current=e,xa(e))};useEffect(()=>(Qe?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Qe]);const ka=Array.isArray(h.items)?h.items.length:0;useEffect(()=>{if(!Qe){Nn.current=ka;return}ka>Nn.current&&setTimeout(()=>{const e=Yt.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Nn.current=ka},[Qe,ka]),useEffect(()=>()=>{on.current&&(clearTimeout(on.current),on.current=null),ee.current&&(clearTimeout(ee.current),ee.current=null)},[]),useEffect(()=>{if(!Qe)return;ee.current&&(clearTimeout(ee.current),ee.current=null);const e=Wt((h==null?void 0:h.phone)||"");if(!ea(e)){ce([]),Z(!1);return}return ee.current=setTimeout(async()=>{var i;const n=String(e),t=(i=Fe.current)==null?void 0:i.get(n);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=In){ce(Array.isArray(t.orders)?t.orders:[]),Z(!1);return}const a=++ge.current;Z(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,g=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(ge.current!==a)return;const p=Array.isArray(g)?g:Array.isArray(g==null?void 0:g.orders)?g.orders:[];ce(p);try{const K=Fe.current;if(K&&typeof K.set=="function"&&(K.set(n,{ts:Date.now(),orders:p}),K.size>100)){const v=Array.from(K.entries()).sort((k,O)=>{var he,fe;return(Number((he=k==null?void 0:k[1])==null?void 0:he.ts)||0)-(Number((fe=O==null?void 0:O[1])==null?void 0:fe.ts)||0)}),m=Math.max(0,v.length-100);for(let k=0;k<m;k++)K.delete(v[k][0])}}catch(K){}}catch(o){if(ge.current!==a)return;console.error("Phone history fetch error:",o),ce([])}finally{if(ge.current!==a)return;Z(!1)}},$n),()=>{ee.current&&(clearTimeout(ee.current),ee.current=null)}},[Qe,h==null?void 0:h.phone]),useEffect(()=>{Qs()},[]),useEffect(()=>{rt||Wn()},[x,rt]),useEffect(()=>{Ta()},[]),useEffect(()=>{D&&un.current!==D&&(un.current=D,Ma(L))},[D]);const Mn=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",ta=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",jn=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(ve),n=ne;if(!n||!(n instanceof Set)||n.size===0)return e;const t=Array.isArray(e)?e.slice():[];return t.sort((a,i)=>{var p,K;const o=n.has(String((p=a==null?void 0:a.id)!=null?p:""))?1:0;return(n.has(String((K=i==null?void 0:i.id)!=null?K:""))?1:0)-o}),t},[ve,ne]),Ha=React.useMemo(()=>window.KTM.orders.sortOrders(nt),[nt]),Ca=React.useMemo(()=>{const n=(Array.isArray(Ha)?Ha:[]).filter(t=>va(t));return n.sort((t,a)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(a==null?void 0:a.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),n},[Ha]),ys=React.useMemo(()=>{const n=(Array.isArray(pt)?pt:[]).filter(t=>wa(t));return n.sort((t,a)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(a==null?void 0:a.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),n},[pt]),la=React.useMemo(()=>{if(Me)return Ca;let e=jn;if(ie){const n=ne;e=(Array.isArray(e)?e:[]).filter(t=>{var a,i;return(i=n==null?void 0:n.has)==null?void 0:i.call(n,String((a=t==null?void 0:t.id)!=null?a:""))})}return Ie&&(e=(Array.isArray(e)?e:[]).filter(n=>rs(n))),e},[Me,Ca,jn,ie,ne,Ie]),Aa=React.useMemo(()=>{if(Me)return la;const e=String(Y||"").trim();return e?(Array.isArray(la)?la:[]).filter(n=>String((n==null?void 0:n.status)||"").trim()===e):la},[la,Y,Me]),vs=React.useMemo(()=>window.KTM.orders.sortOrders(yt),[yt]),nn=React.useMemo(()=>rt?vs:Aa,[Aa,rt,vs]),Ns=React.useMemo(()=>{const e=Array.isArray(nn)?nn:[];return ze?e.slice(0,Math.max(0,Number(Nt)||0)):e},[ze,Nt,nn]);useEffect(()=>{ze&&Et(xt)},[ze,Y,Me,x,tt]),useEffect(()=>{if(!ze)return;const e=Array.isArray(nn)?nn.length:0;if(Nt>=e)return;const n=Zt.current;if(!n)return;const t=new IntersectionObserver(a=>{Array.isArray(a)&&a.some(o=>o==null?void 0:o.isIntersecting)&&Et(o=>Math.min((Number(o)||0)+Jt,e))},{root:null,rootMargin:"520px 0px",threshold:0});return t.observe(n),()=>t.disconnect()},[ze,Nt,nn]),useEffect(()=>{if(!ze){f(!1),q(!1);return}const e=()=>{s.current||(s.current=window.requestAnimationFrame(()=>{s.current=null;const n=window.scrollY||document.documentElement.scrollTop||0;f(n>140),q(n>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),s.current&&(window.cancelAnimationFrame(s.current),s.current=null)}},[ze]),useEffect(()=>{if(!ze){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(n){}return}const e=()=>{try{const n=document.querySelector(".mobile-bottom-nav"),t=n&&n.offsetHeight?n.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${t}px`)}catch(n){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[ze]);const Fn=React.useMemo(()=>{const e=Array.isArray(nn)?nn:[],n={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const a=yn(t==null?void 0:t.status);a==="draft"?n.draft+=1:a==="pending"?n.pending+=1:a==="processing"?n.processing+=1:a==="done"?n.done+=1:a==="paid"?n.paid+=1:a==="canceled"?n.canceled+=1:n.other+=1}return n},[nn]),Us=React.useMemo(()=>{const e=ne;return!e||e.size===0?0:(Array.isArray(jn)?jn:[]).reduce((n,t)=>{var a;return n+(e.has(String((a=t==null?void 0:t.id)!=null?a:""))?1:0)},0)},[ne,jn]),Ys=React.useMemo(()=>(Array.isArray(jn)?jn:[]).filter(e=>rs(e)).length,[jn]),ws=React.useMemo(()=>{const e=new Date,n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${n}-${t}`},[]),Ln=e=>{if(rt&&Re(""),e==="thisMonth"){Ae(!1),re(""),F(ws);return}if(e==="overduePending"){F(""),Ae(!0),re("pending");return}if(e==="draftExpiring"){Ae(!1),re("draft"),F(""),Ta();return}if(e==="all"){Ae(!1),re(""),F(ws);return}},na=e=>window.KTM.date.formatDateTime(e),Qs=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Vt(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Vt([])}},Wn=async()=>{ue(!0),Ge(!1);try{const n=new URLSearchParams;x&&n.set("month",String(x)),n.set("includeItems","0"),n.set("meta","1"),n.set("limit",String(es)),n.set("offset","0");const t=`${API_BASE}/api/orders?${n.toString()}`,a=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),i=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.orders)?a.orders:[],o=!Array.isArray(a)&&a&&typeof a=="object"&&a.meta||null;ae(Array.isArray(i)?i:[]),X(Array.isArray(i)?i.length:0),Be(!!(o!=null&&o.hasMore)),Ta()}catch(n){console.error("Load orders error:",n),ae([]),X(0),Be(!1)}finally{ue(!1),Ge(!1)}},Zs=async()=>{if(!(Xe||Se||rt)&&Ee){Ge(!0);try{const e=new URLSearchParams;x&&e.set("month",String(x)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(es)),e.set("offset",String(W));const n=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(n,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),a=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],i=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;ae(o=>Vs(o,Array.isArray(a)?a:[])),X(o=>o+(Array.isArray(a)?a.length:0)),Be(!!(i!=null&&i.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{Ge(!1)}}},Ss=async e=>{var i;const n=ds(e);if(!n){Kt([]),jt(""),Ze(!1);return}const t=zs(n);if(n.length<Qa&&t.length<Za){Kt([]),jt(`Nh\u1EADp \xEDt nh\u1EA5t ${Qa} k\xFD t\u1EF1 (ho\u1EB7c ${Za} s\u1ED1) \u0111\u1EC3 search nhanh`),Ze(!1);return}try{const o=(i=ut.current)==null?void 0:i.get(n);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=Ks){Kt(Array.isArray(o.results)?o.results:[]),jt(""),Ze(!1);return}}catch(o){}const a=++ke.current;Ze(!0),jt("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(n)}`,g=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(ke.current!==a)return;const p=Array.isArray(g)?g:[];Kt(p);try{const K=ut.current;if(K&&typeof K.set=="function"&&(K.set(n,{ts:Date.now(),results:p}),K.size>Ya)){const v=Array.from(K.entries()).sort((k,O)=>{var he,fe;return(Number((he=k==null?void 0:k[1])==null?void 0:he.ts)||0)-(Number((fe=O==null?void 0:O[1])==null?void 0:fe.ts)||0)}),m=Math.max(0,v.length-Ya);for(let k=0;k<m;k++)K.delete(v[k][0])}}catch(K){}}catch(o){if(ke.current!==a)return;console.error("Order search error:",o),Kt([]),jt((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if(ke.current!==a)return;Ze(!1)}};useEffect(()=>{De.current&&(clearTimeout(De.current),De.current=null);const e=ds(tt);if(!e){Kt([]),jt(""),Ze(!1);return}return Me&&Ae(!1),De.current=setTimeout(()=>{Ss(e)},Rs),()=>{De.current&&(clearTimeout(De.current),De.current=null)}},[tt]);const Ta=async()=>{B(!0),We(!0);try{const[e,n]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Rn)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Ea)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);qe(Array.isArray(e)?e:[]),gt(Array.isArray(n)?n:[])}catch(e){console.error("Load all orders error:",e),qe([]),gt([])}finally{B(!1),We(!1)}},za=async e=>{const n=await Sa(e);if(!n)return;rn(n.id);const t=Array.isArray(n.items)&&n.items.length?n.items.map(p=>{var K,v,m,k;return{product_id:(p==null?void 0:p.product_id)||"",quantity:Number((K=p==null?void 0:p.quantity)!=null?K:1)||1,unit_price:(()=>{var fe;const O=(fe=p==null?void 0:p.unit_price)!=null?fe:p==null?void 0:p.unitPrice,he=O==null||O===""?NaN:Number(O);return Number.isFinite(he)?Math.trunc(he):null})(),variant:String((v=p==null?void 0:p.variant)!=null?v:"").trim(),variant_json:(k=(m=p==null?void 0:p.variant_json)!=null?m:p==null?void 0:p.variantJson)!=null?k:null}}).filter(p=>p.product_id):[{product_id:n.product_id||"",quantity:Number(n.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],a=Xs(n),i=Qn(a),o=Zn(i),g=Fa(i);be({customer_name:n.customer_name||"",phone:Wt(n.phone||""),address:n.address||"",note:(n==null?void 0:n.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:a,adjustment_amount:o,adjustment_note:g||(n==null?void 0:n.adjustment_note)||"",status:n.status||"pending"}),st(new Array(t.length?t.length:1).fill("")),Ce(new Array(t.length?t.length:1).fill(!0)),$(null),Ue(!1),it(n),Ot(!0),Ft(""),$t(!1),gn(!0),n.phone&&xa(Wt(n.phone))},da=async e=>{if(!e)return;Ot(!0),Ft(""),$t(!0),gn(!1),it(e);const n=++R.current;try{const t=await Sa(e);if(R.current!==n)return;it(t||e)}catch(t){if(R.current!==n)return;Ft((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(R.current!==n)return;$t(!1)}},er=()=>{T||me||(Ot(!1),$t(!1),Ft(""),gn(!1),rn(null),Vn(""),y(!1),Ce([]))};function Ma(e){Ot(!1),gn(!1),$t(!1),Ft(""),rn(null),Vn(e||""),y(!1),Ce([]),Ue(!0)}const Xa=()=>{T||me||(Ue(!1),rn(null),Vn(""),y(!1),Ce([]))},xs=async()=>{var p,K,v;if(!bt||me||T)return;const e=(Array.isArray(ve)?ve:[]).find(m=>String(m==null?void 0:m.id)===String(bt))||null,n=String((e==null?void 0:e.status)||(h==null?void 0:h.status)||"").trim();if(n==="done"||n==="paid"||n==="canceled"){const m="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof j=="function"?j(m,"warning"):alert(m);return}const t=Wt(h.phone),i=(Array.isArray(h.items)?h.items:[]).map((m,k)=>{var O,he;return{idx:k,product_id:String((m==null?void 0:m.product_id)||"").trim(),quantity:Number((O=m==null?void 0:m.quantity)!=null?O:0),variant:String((m==null?void 0:m.variant)||"").trim()||null,variant_json:(he=m==null?void 0:m.variant_json)!=null?he:null,unit_price:(()=>{const fe=m==null?void 0:m.unit_price,ft=fe===""||fe==null?NaN:Number(fe);if(Number.isFinite(ft))return Math.max(0,Math.trunc(ft));const lt=Cn(m==null?void 0:m.product_id),tn=m!=null&&m.variant_json&&typeof m.variant_json=="object"?m.variant_json:null;return aa(lt,tn)})()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0);if(i.length<2){const m="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof j=="function"?j(m,"warning"):alert(m);return}const o=[],g=[];for(const m of i){const k=!!Ke[m.idx],O={product_id:m.product_id,quantity:m.quantity,unit_price:m.unit_price,variant:m.variant,variant_json:m.variant_json};k?o.push(O):g.push(O)}if(!o.length||!g.length){const m="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof j=="function"?j(m,"warning"):alert(m);return}Te(!0);try{const m=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],k=Qn(m),O=Zn(k),he=Fa(k),fe={customer_name:h.customer_name,phone:t,address:h.address,note:(h.note||"").trim(),adjustment_amount:O,adjustment_note:he,adjustment_items:k,status:"processing",items:o,product_id:o[0].product_id,quantity:o[0].quantity,split_seq:1},ft=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,fe,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),lt=(v=(K=ft==null?void 0:ft.id)!=null?K:(p=ft==null?void 0:ft.order)==null?void 0:p.id)!=null?v:null;if(!lt)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const tn={id:bt,customer_name:h.customer_name,phone:t,address:h.address,note:(h.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:g,product_id:g[0].product_id,quantity:g[0].quantity,parent_order_id:String(lt),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${bt}`,tn,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Xa(),Wn();const _t=lt?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${lt}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof j=="function"?j(_t,"success"):alert(_t)}catch(m){console.error(m);const k=(m==null?void 0:m.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof j=="function"?j(k,"danger"):alert(k)}finally{Te(!1)}},ks=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const n=String(e),t=qt.find(a=>String(a==null?void 0:a.id)===n);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},On=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(n){return String(e!=null?e:"").toLowerCase()}},tr=e=>{const t=On(e).trim().split(/\s+/).filter(Boolean),a=t.join(" ");return{contentTokens:t,cleanedQuery:a}},Cs=React.useMemo(()=>(Array.isArray(qt)?qt:[]).map((e,n)=>{var v,m,k,O,he,fe;const t=On((v=e==null?void 0:e.name)!=null?v:""),a=On((m=e==null?void 0:e.code)!=null?m:""),i=On((k=e==null?void 0:e.category)!=null?k:""),o=On((O=e==null?void 0:e.note)!=null?O:""),g=On((he=e==null?void 0:e.id)!=null?he:""),p=On((fe=e==null?void 0:e.stt)!=null?fe:""),K=`${t} ${a} ${i} ${o} ${g} ${p}`.trim();return{p:e,originalIndex:n,name:t,code:a,category:i,note:o,haystackAll:K}}),[qt]),nr=(e,n,t)=>{var k,O,he,fe,ft;const a=Array.isArray(n)?n:[],i=On(t).trim();if(!a.length&&!i)return 0;const o=(k=e==null?void 0:e.name)!=null?k:"",g=(O=e==null?void 0:e.code)!=null?O:"",p=(he=e==null?void 0:e.category)!=null?he:"",K=(fe=e==null?void 0:e.note)!=null?fe:"";if(!((ft=e==null?void 0:e.haystackAll)!=null?ft:""))return 0;let m=0;i&&(o===i&&(m+=220),o.includes(i)&&(m+=140),o.startsWith(i)&&(m+=160),g&&g===i&&(m+=180),g&&g.includes(i)&&(m+=90));for(const lt of a){if(!lt)continue;const tn=new RegExp(`(?:^|\\s)${lt.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(lt)&&(m+=35),tn.test(o)&&(m+=25),g&&g.includes(lt)&&(m+=20),g&&tn.test(g)&&(m+=10),p&&p.includes(lt)&&(m+=12),K&&K.includes(lt)&&(m+=6)}return m>0&&o&&(m+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),m},Va=(e,n)=>{const t=String(e||""),a=String(n||"");if(t===a)return 0;if(!t)return a.length;if(!a)return t.length;const i=t.length,o=a.length;if(o>i)return Va(a,t);let g=new Array(o+1),p=new Array(o+1);for(let K=0;K<=o;K++)g[K]=K;for(let K=1;K<=i;K++){p[0]=K;const v=t.charCodeAt(K-1);for(let k=1;k<=o;k++){const O=v===a.charCodeAt(k-1)?0:1;p[k]=Math.min(g[k]+1,p[k-1]+1,g[k-1]+O)}const m=g;g=p,p=m}return g[o]},ar=(e,n)=>{const t=String(e||"").trim(),a=String(n||"");if(!t||!a)return!1;if(a.includes(t))return!0;const i=a.split(/\s+/).filter(Boolean);if(!i.length)return!1;const o=t.length<=4?1:2;for(const g of i)if(!(Math.abs(g.length-t.length)>o)&&Va(t,g)<=o)return!0;return!1},_a=e=>{const n=On(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return n?n.split(" ").filter(Boolean):[]},sr=(e,n)=>{const t=Array.isArray(n)?n:[];if(!t.length)return 0;const a=_a((e==null?void 0:e.name)||""),i=_a((e==null?void 0:e.code)||""),o=_a((e==null?void 0:e.category)||""),g=_a((e==null?void 0:e.note)||""),p=(v,m,k)=>{const O=String(v||"").trim();if(!O||!m.length)return 0;const he=O.length<=4?1:2;let fe=1/0,ft=-1;for(let _t=0;_t<m.length;_t++){const An=m[_t];if(!An||Math.abs(An.length-O.length)>he)continue;const Ht=Va(O,An);if(Ht<fe&&(fe=Ht,ft=_t,Ht===0))break}if(fe===1/0||fe>he)return 0;let tn=Math.round(k*(fe===0?1:fe===1?.65:.45));return ft===0?tn+=Math.round(k*.25):ft===1&&(tn+=Math.round(k*.12)),tn};let K=0;for(const v of t){if(!v)continue;const m=p(v,a,180),k=p(v,i,120),O=p(v,o,60),he=p(v,g,30);K+=Math.max(m,k,O,he)}if(K>0){const v=((e==null?void 0:e.name)||"").length;K+=Math.max(0,60-Math.min(60,Math.floor(v/2)))}return K},Wa=React.useRef(new Map);React.useEffect(()=>{Wa.current=new Map},[qt]);const As=e=>{var v,m;const n=String(pe[e]||"").trim();if(!n)return qt;const{contentTokens:t,cleanedQuery:a}=tr(n);if(t.length===0)return qt;const i=On(n).trim(),o=Wa.current.get(i);if(o)return o;const g=[];for(const k of Cs){const O=k.haystackAll;O&&t.some(he=>O.includes(he))&&g.push(k)}let p=g;if(p.length<8&&t.length>0){const k=[],O=new Set(p.map(he=>{var fe,ft;return String((ft=(fe=he.p)==null?void 0:fe.id)!=null?ft:"")+":"+String(he.originalIndex)}));for(const he of Cs){const fe=String((m=(v=he.p)==null?void 0:v.id)!=null?m:"")+":"+String(he.originalIndex);if(O.has(fe))continue;const ft=he.haystackAll;ft&&t.some(lt=>ar(lt,ft))&&(k.push(he),O.add(fe))}k.length&&(p=p.concat(k))}const K=p.map(k=>({entry:k,score:nr(k,t,a)})).map(k=>{if(k.score>0)return k;const O=sr(k.entry,t);return O>0?{...k,score:O}:k}).filter(k=>k.score>0).sort((k,O)=>O.score!==k.score?O.score-k.score:k.entry.originalIndex-O.entry.originalIndex).slice(0,40).map(k=>k.entry.p);return Wa.current.set(i,K),K},Cn=e=>{if(!e)return null;const n=String(e);return qt.find(t=>String(t==null?void 0:t.id)===n)||null},Bn=e=>{if(e==null||e==="")return[];let n=e;if(typeof n=="string"){const t=n.trim();if(!t)return[];try{n=JSON.parse(t)}catch(a){return[]}}return Array.isArray(n)?n.map((t,a)=>{var g;if(!t||typeof t!="object")return null;const i=String((g=t.name)!=null?g:"").trim()||`Bi\u1EBFn th\u1EC3 ${a+1}`,o=(Array.isArray(t.options)?t.options:[]).map(p=>{var ft,lt,tn,_t,An,Ht,En;if(!p||typeof p!="object")return null;const K=String((ft=p.label)!=null?ft:"").trim();if(!K)return null;const v=(An=(_t=(tn=(lt=p.price)!=null?lt:p.priceValue)!=null?tn:p.unit_price)!=null?_t:p.unitPrice)!=null?An:null,m=v==null||v===""?NaN:typeof v=="number"?v:typeof v=="string"?us(v):Number(v),k=Number.isFinite(m)?Math.trunc(m):null,O=(En=(Ht=p.price_delta)!=null?Ht:p.priceDelta)!=null?En:null,he=Number(O),fe=Number.isFinite(he)?Math.trunc(he):0;return{label:K,price:k,price_delta:fe}}).filter(Boolean);return{name:i,options:o}}).filter(Boolean):[]},fr=e=>{const n=Cn(e);return Bn(n==null?void 0:n.variants)},$a=e=>{if(!e||typeof e!="object")return"";const n=[];for(const[t,a]of Object.entries(e)){const i=String(t||"").trim(),o=String(a||"").trim();!i||!o||n.push(`${i}: ${o}`)}return n.join(", ")},aa=(e,n)=>{const t=us(e==null?void 0:e.price),a=Bn(e==null?void 0:e.variants);if(!a.length||!n||typeof n!="object")return t;let i=t,o=!1;for(const g of a){const p=String((g==null?void 0:g.name)||"").trim(),K=String((n==null?void 0:n[p])||"").trim();if(!p||!K)continue;const v=(Array.isArray(g.options)?g.options:[]).find(fe=>String((fe==null?void 0:fe.label)||"").trim()===K);if(!v)continue;const m=v==null?void 0:v.price,k=m==null||m===""?NaN:Number(m);if(Number.isFinite(k)){i=Math.max(0,Math.trunc(k)),o=!0;continue}const O=v==null?void 0:v.price_delta,he=O==null||O===""?NaN:Number(O);Number.isFinite(he)&&(i+=Math.trunc(he))}return i},Ga=e=>window.KTM.orders.getOrderItems(e),Ts=e=>window.KTM.orders.getOrderTotalQty(e),sa=e=>window.KTM.orders.getOrderProductSummary(e,Cn),Ia=e=>window.KTM.orders.getOrderItemRows(e,Cn),ma=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Gn=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),rr=e=>{const n=Ga(e),t=Ia(e),a=pa(n),i=ua(n),o=i.fee,g=ma(e),p=a+o+g,K=m=>{const k=Number(m)||0;return k>0?`+${Pt(k)}`:Pt(k)},v=[];if(e!=null&&e.customer_name&&v.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&v.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&v.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&v.push(`GHI CH\xDA: ${(e.note||"").trim()}`),v.push(""),v.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const m of t)v.push(`- ${m.name} (SL: ${m.qty})`);else{const m=sa(e);m&&m!=="\u2014"&&v.push(`- ${m}`)}v.push(""),v.push(`T\u1EA0M T\xCDNH: ${Pt(a)}`),i.found&&o!==0&&v.push(`SHIP: ${Pt(o)}`);{const m=window.KTM.orders.getOrderAdjustmentItems(e),k=(Array.isArray(m)?m:[]).map(fe=>{var ft;return{amount:Number((ft=fe==null?void 0:fe.amount)!=null?ft:0)||0,note:String((fe==null?void 0:fe.note)||"").trim()}}).filter(fe=>fe.amount!==0||!!fe.note),O=Gn(e);if(g!==0||k.length>0||!!O)if(k.length===1){const fe=k[0];v.push(`\u0110I\u1EC0U CH\u1EC8NH: ${K(g)}${fe.note?` \u2014 ${fe.note}`:""}`)}else{v.push(`\u0110I\u1EC0U CH\u1EC8NH: ${K(g)}${!k.length&&O?` \u2014 ${O}`:""}`);for(const fe of k)v.push(`- ${K(fe.amount)}${fe.note?`: ${fe.note}`:""}`)}}return v.push(`T\u1ED4NG: ${Pt(p)}`),v.filter(Boolean).join(`
`)},Da=async e=>{try{const n=await Sa(e),t=rr(n);await window.KTM.clipboard.writeText(t),typeof j=="function"?j("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(n){console.error(n),typeof j=="function"?j("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},ua=e=>window.KTM.orders.getOrderShipInfo(e,Cn),pa=e=>window.KTM.orders.getItemsSubtotal(e,Cn),Ja=e=>{try{const n=e instanceof Date?e:new Date(e);if(!n||Number.isNaN(n.getTime()))return"";const t=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0");return`${t}-${a}`}catch(n){return""}},Ua=()=>x?String(x):Ja(new Date),Ms=e=>{const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Wt((e==null?void 0:e.phone)||""),a=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ja(e).amount,g=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(p=>{var K;return{product_id:String((p==null?void 0:p.product_id)||"").trim(),quantity:Number((K=p==null?void 0:p.quantity)!=null?K:0),variant:String((p==null?void 0:p.variant)||"").trim()}}).filter(p=>p.product_id&&Number.isFinite(p.quantity)&&p.quantity>0).sort((p,K)=>p.product_id<K.product_id?-1:p.product_id>K.product_id?1:p.variant<K.variant?-1:p.variant>K.variant?1:p.quantity-K.quantity);return JSON.stringify({name:n,phone:t,address:a,items:g,adj:i})},wn=React.useMemo(()=>{const e=Wt((h==null?void 0:h.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ua()};const n=Ua(),a=(Array.isArray(G)?G:[]).filter(i=>{if(!i||bt&&String(i.id)===String(bt)||Wt(i.phone||"")!==e)return!1;const o=Ja(i.created_at);return o&&o===n}).sort((i,o)=>{const g=new Date(i.created_at).getTime(),p=new Date(o.created_at).getTime();return(Number.isFinite(p)?p:0)-(Number.isFinite(g)?g:0)});return{count:a.length,orders:a,monthKey:n}},[G,h==null?void 0:h.phone,x,bt]),ir=e=>{var p;const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Wt((e==null?void 0:e.phone)||""),a=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ps((p=e==null?void 0:e.adjustment_amount)!=null?p:0),o=Ga(e),g=(Array.isArray(o)?o:[]).map(K=>{var v;return{product_id:String((K==null?void 0:K.product_id)||"").trim(),quantity:Number((v=K==null?void 0:K.quantity)!=null?v:0),variant:String((K==null?void 0:K.variant)||"").trim()}}).filter(K=>K.product_id&&Number.isFinite(K.quantity)&&K.quantity>0).sort((K,v)=>K.product_id<v.product_id?-1:K.product_id>v.product_id?1:K.variant<v.variant?-1:K.variant>v.variant?1:K.quantity-v.quantity);return JSON.stringify({name:n,phone:t,address:a,items:g,adj:i})},_s=React.useMemo(()=>{if(bt)return"";const e=Wt((h==null?void 0:h.phone)||"");if(!e)return"";const n=Ua(),t=Ms(h),a=Array.isArray(G)?G:[];for(const i of a){if(!i||bt&&String(i.id)===String(bt)||Wt(i.phone||"")!==e)continue;const o=Ja(i.created_at);if(!o||o!==n)continue;const g=ir(i);if(g&&g===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${n}${i!=null&&i.id?` (#${i.id})`:""}`}return""},[G,h,x,bt]),$s=e=>{var An;const n=[],t=[],a=String((e==null?void 0:e.customer_name)||"").trim(),i=Wt((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim();a||n.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),i||n.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),i&&!ea(i)&&n.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const p=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ht=>Ht&&Ht.product_id);p.length===0&&n.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),p.some(Ht=>{var Un;const En=Number((Un=Ht==null?void 0:Ht.quantity)!=null?Un:0);return!Number.isFinite(En)||En<=0})&&n.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const v=new Set;let m=!1;for(const Ht of p){const En=String(Ht.product_id||"").trim(),Un=String((Ht==null?void 0:Ht.variant)||"").trim();if(!En)continue;const Rt=`${En}||${Un}`;if(v.has(Rt)){m=!0;break}v.add(Rt)}m&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const k=pa(p),O=ua(p),he=O!=null&&O.found?Number((An=O==null?void 0:O.fee)!=null?An:0):0,fe=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],ft=Qn(fe),lt=Zn(ft),tn=ft.some(Ht=>(Number(Ht==null?void 0:Ht.amount)||0)!==0&&!String((Ht==null?void 0:Ht.note)||"").trim());O!=null&&O.found&&(he>=2e5||k>0&&he>k*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Pt(he)}`),tn&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const _t=Math.abs(lt);return(_t>=5e5||k>0&&_t>k*.5)&&lt!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Pt(lt)}`),{errors:n,warnings:t,canSubmit:n.length===0}},br=React.useMemo(()=>$s(h),[h,qt]),Dt=React.useMemo(()=>{var Un;const e=String((h==null?void 0:h.customer_name)||"").trim(),n=Wt((h==null?void 0:h.phone)||""),t=String((h==null?void 0:h.address)||"").trim(),a=Array.isArray(h==null?void 0:h.items)?h.items:[],i=new Map;for(const Rt of a){const ra=String((Rt==null?void 0:Rt.product_id)||"").trim(),Ka=String((Rt==null?void 0:Rt.variant)||"").trim();if(!ra)continue;const Oa=`${ra}||${Ka}`;i.set(Oa,(i.get(Oa)||0)+1)}const o=a.map(Rt=>{var Is;const ra=String((Rt==null?void 0:Rt.product_id)||"").trim(),Ka=Number((Is=Rt==null?void 0:Rt.quantity)!=null?Is:0),Oa=ra?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",dr=Number.isFinite(Ka)&&Ka>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",mr=String((Rt==null?void 0:Rt.variant)||"").trim(),ur=`${ra}||${mr}`,pr=ra&&(i.get(ur)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Oa,qtyError:dr,dupWarn:pr}}),g=a.filter(Rt=>Rt&&Rt.product_id),p=pa(g),K=ua(g),v=K!=null&&K.found?Number((Un=K==null?void 0:K.fee)!=null?Un:0):0,m=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],k=Qn(m),O=Zn(k),he=k.some(Rt=>(Number(Rt==null?void 0:Rt.amount)||0)!==0&&!String((Rt==null?void 0:Rt.note)||"").trim()),fe=Math.abs(O),ft=he?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",lt=O!==0&&(fe>=5e5||p>0&&fe>p*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Pt(O)}`:"",tn=K!=null&&K.found&&(v>=2e5||p>0&&v>p*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Pt(v)}`:"",_t=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",An=n?ea(n)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ht=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",En=!_t&&!An&&o.every(Rt=>!Rt.productError&&!Rt.qtyError);return{nameError:_t,phoneError:An,addressWarn:Ht,items:o,shipAbnormalWarn:tn,adjustmentNoteWarn:ft,adjustmentAbnormalWarn:lt,canSubmit:En}},[h,qt]),Ra=async e=>{var p,K,v;const n=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",a=$s(h);if(!a.canSubmit){const m=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof j=="function"?j(m,"danger"):alert(m);return}if(!bt&&_s){const m=`${_s}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(m)){(wn==null?void 0:wn.count)>0&&y(!0),setTimeout(()=>{var he;const O=document.getElementById("order-phone-input");O&&typeof O.scrollIntoView=="function"&&(O.scrollIntoView({block:"center",behavior:"smooth"}),(he=O.focus)==null||he.call(O))},0);return}}const i=Wt(h.phone),g=(Array.isArray(h.items)?h.items:[]).map(m=>{var k,O;return{product_id:(m==null?void 0:m.product_id)||"",quantity:Number((k=m==null?void 0:m.quantity)!=null?k:1),variant:String((m==null?void 0:m.variant)||"").trim()||null,variant_json:(O=m==null?void 0:m.variant_json)!=null?O:null,unit_price:(()=>{const he=m==null?void 0:m.unit_price,fe=he===""||he==null?NaN:Number(he);if(Number.isFinite(fe))return Math.max(0,Math.trunc(fe));const ft=Cn(m==null?void 0:m.product_id),lt=m!=null&&m.variant_json&&typeof m.variant_json=="object"?m.variant_json:null;return aa(ft,lt)})()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0);A(!0);try{const m=bt,k=bt?`${API_BASE}/api/orders/${bt}`:`${API_BASE}/api/orders`,O=g[0],he=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],fe=Qn(he),ft=Zn(fe),lt=Fa(fe),tn={customer_name:h.customer_name,phone:i,address:h.address,note:(h.note||"").trim(),adjustment_amount:ft,adjustment_note:lt,adjustment_items:fe,product_id:O.product_id,quantity:O.quantity,status:h.status,items:g,...bt?{id:bt}:{}};if(bt)await window.KTM.api.putJSON(k,tn,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const _t=await window.KTM.api.postJSON(k,tn,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");xn.current={id:(v=(K=_t==null?void 0:_t.id)!=null?K:(p=_t==null?void 0:_t.order)==null?void 0:p.id)!=null?v:null,fingerprint:Ms(h),ts:Date.now()}}if(Js(i,h.customer_name,h.address),t==="drawer"){if(Vn(""),rn(null),Ue(!1),gn(!1),y(!1),Ce([]),Wn(),m){$t(!0),Ft("");try{const _t=await Ba(m);_t&&typeof _t=="object"&&it(_t)}catch(_t){Ft((_t==null?void 0:_t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{$t(!1)}}}else n==="new"&&!bt?(Vn(""),rn(null),Ue(!0)):(Vn(""),rn(null),Ue(!1)),Wn()}catch(m){console.error(m),typeof j=="function"?j(m.message,"danger"):alert(m.message);return}finally{A(!1)}},ha=e=>window.KTM.orders.getOrderTotalMoney(e,Cn),gr=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){ye(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Wn(),Ta()}catch(n){console.error(n),typeof j=="function"?j(n.message,"danger"):alert(n.message)}finally{ye(null)}}},or=()=>{const e=Q.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(o){}e.timer=null}const n=Array.isArray(e.events)?e.events.splice(0):[];if(!n.length||typeof j!="function")return;const t=new Map;for(const o of n){const g=String((o==null?void 0:o.orderId)||"").trim();g&&t.set(g,o)}const a=Array.from(t.values());if(!a.length)return;const i=o=>async()=>{try{for(const g of o)!(g!=null&&g.prevStatus)||!(g!=null&&g.orderId)||await Jn({id:g.orderId,status:g.nextStatus},g.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});j(o.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${o.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(g){j("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(a.length===1){const o=a[0],g=`${Mn(o.prevStatus)} \u2192 ${Mn(o.nextStatus)}`.trim();j(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${g}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:i([o])});return}j(`\u0110\xE3 c\u1EADp nh\u1EADt ${a.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:i(a)})},cr=e=>{const n=Q.current;n&&(Array.isArray(n.events)||(n.events=[]),n.events.push(e),!n.timer&&(n.timer=setTimeout(()=>or(),320)))};useEffect(()=>()=>{try{const e=Q.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Jn=async(e,n,t={})=>{var g;const a=await Sa(e),i=a==null?void 0:a.id;if(!i||!n)return;const o=yn(a==null?void 0:a.status);le(i);try{const p=Ga(a),K=(Array.isArray(p)?p:[]).map(k=>{var O,he;return{product_id:(k==null?void 0:k.product_id)||"",quantity:Number((O=k==null?void 0:k.quantity)!=null?O:1),variant:String((k==null?void 0:k.variant)||"").trim()||null,variant_json:(he=k==null?void 0:k.variant_json)!=null?he:null,unit_price:(()=>{var lt;const fe=(lt=k==null?void 0:k.unit_price)!=null?lt:k==null?void 0:k.unitPrice,ft=Number(fe);return Number.isFinite(ft)?Math.max(0,Math.trunc(ft)):null})()}}).filter(k=>k.product_id&&Number.isFinite(k.quantity)&&k.quantity>0);if(!K.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const v=K[0],m={id:i,customer_name:(a==null?void 0:a.customer_name)||"",phone:Wt((a==null?void 0:a.phone)||""),address:(a==null?void 0:a.address)||"",note:((a==null?void 0:a.note)||"").trim(),adjustment_amount:Number((g=a==null?void 0:a.adjustment_amount)!=null?g:0)||0,adjustment_note:(a==null?void 0:a.adjustment_note)||"",product_id:v.product_id,quantity:v.quantity,status:n,items:K};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${i}`,m,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),ae(k=>Array.isArray(k)?k.map(O=>(O==null?void 0:O.id)===i?{...O,status:n}:O):k),qe(k=>Array.isArray(k)?k.map(O=>(O==null?void 0:O.id)===i?{...O,status:n}:O):k),ga(i,!1),Hs(i),t!=null&&t.silentToast)return;if(t!=null&&t.skipToastBatch){typeof j=="function"&&j("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}cr({orderId:i,prevStatus:o,nextStatus:yn(n)})}catch(p){if(console.error(p),(!navigator.onLine||(p==null?void 0:p.name)==="TypeError"||String((p==null?void 0:p.message)||"").toLowerCase().includes("failed to fetch"))&&!(t!=null&&t.fromSync)){ae(v=>Array.isArray(v)?v.map(m=>(m==null?void 0:m.id)===i?{...m,status:n}:m):v),qe(v=>Array.isArray(v)?v.map(m=>(m==null?void 0:m.id)===i?{...m,status:n}:m):v),Bs(i,n,o),typeof j=="function"&&j("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof j=="function"?j(p.message,"danger"):alert(p.message)}finally{le(null)}};useEffect(()=>{const e=n=>{var a;const t=(a=n==null?void 0:n.detail)==null?void 0:a.key;if(t){if(t==="/"){setTimeout(()=>{var i,o;(o=(i=cn.current)==null?void 0:i.focus)==null||o.call(i)},0);return}if(t==="N"||t==="n"){Ma();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&Tt&&(_e!=null&&_e.id)){const i=Array.isArray(nn)?nn:[],o=i.findIndex(K=>String(K==null?void 0:K.id)===String(_e==null?void 0:_e.id));if(o<0)return;const p=i[o+(t==="j"||t==="J"?-1:1)];p&&da(p)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[nn,Tt,_e]);const lr=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:h.customer_name,onChange:e=>be({...h,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Dt.nameError&&React.createElement("div",{className:"form-text text-danger"},Dt.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:h.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Dt.phoneError&&React.createElement("div",{className:"form-text text-danger"},Dt.phoneError),!Dt.phoneError&&wn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",wn.count," \u0111\u01A1n trong th\xE1ng ",wn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>y(e=>!e)},N?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),N&&wn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>y(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},wn.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ta(e.status)}`},Mn(e.status))),React.createElement("div",{className:"text-muted small"},na(e.created_at)," \u2022 ",Pt(ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&za(e)}},"M\u1EDF")))),wn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(S==null?void 0:S.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(S==null?void 0:S.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(S==null?void 0:S.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(S==null?void 0:S.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:h.status,onChange:e=>be({...h,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:h.address,onChange:e=>be({...h,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Dt.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Dt.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:h.note,onChange:e=>be({...h,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{be(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Kn(h.adjustment_items).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const a=t.target.value;be(i=>{const o=Kn(i.adjustment_items);return o[n]={...o[n],amount:a},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const a=t.target.value;be(i=>{const o=Kn(i.adjustment_items);return o[n]={...o[n],note:a},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{be(t=>{const a=Kn(t.adjustment_items);return a.splice(n,1),{...t,adjustment_items:a.length?a:[{amount:"",note:""}]}})},disabled:T||Kn(h.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Dt.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Dt.adjustmentAbnormalWarn),!!Dt.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Dt.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{be(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),st(e=>[...Array.isArray(e)?e:[],""]),bt&&Ce(e=>[...Array.isArray(e)?e:[],!0])},disabled:T},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(h.items)?h.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Ut.current[n]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{kt(t=>t===n?null:n),setTimeout(()=>{const t=document.getElementById(`order-product-search-${n}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ot===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:pe[n]||"",onChange:t=>{const a=t.target.value;st(i=>{const o=Array.isArray(i)?[...i]:[];return o[n]=a,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(n);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(a.id),o=Bn(a==null?void 0:a.variants),g={};for(const v of o){const m=String((v==null?void 0:v.name)||"").trim(),k=Array.isArray(v==null?void 0:v.options)?v.options[0]:null,O=String((k==null?void 0:k.label)||"").trim();m&&O&&(g[m]=O)}const p=$a(g),K=aa(a,g);be(v=>{const m=Array.isArray(v.items)?[...v.items]:[];return m[n]={...m[n]||{quantity:1},product_id:i,variant_json:Object.keys(g).length?g:null,variant:p,unit_price:o.length?K:null},{...v,items:m}}),kt(null)}},a.name,a.code?` (${a.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),qt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var a;const t=(a=Dt.items)==null?void 0:a[n];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Cn(e.product_id),a=Bn(t==null?void 0:t.variants);if(!a.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},a.map((o,g)=>{const p=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${g+1}`).trim(),K=String((i==null?void 0:i[p])||"").trim();return React.createElement("div",{key:p},React.createElement("label",{className:"form-label small text-muted mb-1"},p),React.createElement("select",{className:"form-select",value:K,onChange:v=>{const m=String(v.target.value||"").trim();be(k=>{const O=Array.isArray(k.items)?[...k.items]:[],he={...O[n]||{}},fe=Cn(he.product_id),ft=Bn(fe==null?void 0:fe.variants),lt=he!=null&&he.variant_json&&typeof he.variant_json=="object"?{...he.variant_json}:{};m?lt[p]=m:delete lt[p];const tn=$a(lt),_t=aa(fe,lt);return O[n]={...he,variant_json:Object.keys(lt).length?lt:null,variant:tn,unit_price:_t},{...k,items:O}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",p," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(v=>React.createElement("option",{key:v.label,value:v.label},v.label,Number.isFinite(Number(v==null?void 0:v.price))?` (${Pt(Number(v.price))})`:Number(v==null?void 0:v.price_delta)?` (${v.price_delta>0?"+":""}${v.price_delta})`:""))))}))})(),bt&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!Ke[n],onChange:t=>{const a=!!t.target.checked;Ce(i=>{const o=Array.isArray(i)?[...i]:[],g=Array.isArray(h.items)?h.items.length:0;for(;o.length<g;)o.push(!0);return o[n]=a,o})},disabled:T||me}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const a=t.target.value;be(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[n]={...o[n]||{product_id:""},quantity:a},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var a;const t=(a=Dt.items)==null?void 0:a[n];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{be(t=>{const a=Array.isArray(t.items)?[...t.items]:[];return a.splice(n,1),{...t,items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),st(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a.length?a:[""]}),Ce(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a}),kt(t=>t==null?t:t===n?null:t>n?t-1:t)},disabled:T||me||(Array.isArray(h.items)?h.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(h.items)?h.items:[]).filter(p=>p==null?void 0:p.product_id),t=pa(n),a=ua(n),i=ja(h),o=i.amount,g=t+(a.found?a.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Pt(t))),a.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Pt(a.fee))),!!Dt.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Dt.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Pt(o))),(h.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(h.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Pt(g)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:T||!!H||!!Ne}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.all," \u0111\u01A1n"),rt&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>rt?Ss(tt):Wn(),disabled:an,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>Ma(),disabled:T||!!H},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${ie&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),Ve(!1),$e(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Us)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${Ie&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),$e(!1),Ve(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ys)),React.createElement("button",{type:"button",className:`orders-chip ${!Y&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.all)),React.createElement("button",{type:"button",className:`orders-chip ${Y==="draft"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("draft"),F("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.draft)),React.createElement("button",{type:"button",className:`orders-chip ${Y==="pending"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.pending)),React.createElement("button",{type:"button",className:`orders-chip ${Y==="processing"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.processing)),React.createElement("button",{type:"button",className:`orders-chip ${Y==="done"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.done)),React.createElement("button",{type:"button",className:`orders-chip ${Y==="paid"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.paid)),React.createElement("button",{type:"button",className:`orders-chip ${Y==="canceled"&&!Me&&!rt?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Ln("thisMonth"),disabled:rt},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ln("overduePending"),disabled:rt},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",Rn," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Ln("draftExpiring"),disabled:rt},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y"),(Y||Me||!x&&!rt)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Ln("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:cn,type:"text",className:"form-control",value:tt,onChange:e=>Re(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(tt||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Re(""),disabled:an},React.createElement("i",{className:"fas fa-times"})),an&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:x,onChange:e=>F(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:Me||rt})),React.createElement("div",{className:"text-muted small ms-auto"},rt?"Search b\u1ECF qua filter":Me?"\u0110ang xem \u0111\u01A1n ch\u1EADm":Y?`L\u1ECDc: ${Mn(Y)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${M?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if(rt){const e=String(tt||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${nn.length} k\u1EBFt qu\u1EA3`}return Me?`\u0110\u01A1n ch\u1EADm \u2022 ${nn.length} \u0111\u01A1n`:ie?`\u01AFu ti\xEAn \u2022 ${nn.length} \u0111\u01A1n`:Ie?`H\xF4m nay \u2022 ${nn.length} \u0111\u01A1n`:Y?`L\u1ECDc: ${Mn(Y)} \u2022 ${nn.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${nn.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Re(""),$e(!1),Ve(!1),Ln("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},rt?`${nn.length} k\u1EBFt qu\u1EA3`:Y?`${Aa.length}/${ve.length} \u0111\u01A1n`:`${ve.length}${Ee?"+":""} \u0111\u01A1n`)),rt&&Lt&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Lt),Ca.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Ca.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Rn," ng\xE0y.",Le&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Ae(!0),re("pending")}},"Xem ngay")),ys.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,ys.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 h\u1EE7y (c\xF2n \u2264 ",Ea," ng\xE0y).",At&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Ae(!1),re("draft"),F(""),Wn()}},"Xem ngay")),(rt?an:Xe)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,n)=>React.createElement("div",{key:n,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,n)=>React.createElement("tr",{key:n},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(rt?nn.length===0:ve.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},rt?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!rt&&Aa.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Ns.map(e=>{var n;return React.createElement("div",{key:e.id,className:`orders-mobile-swipe-shell mb-2 ${(wt==null?void 0:wt.id)===String(e.id)?`swipe-preview swipe-${(wt==null?void 0:wt.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>{if(dn.current){dn.current=!1;return}da(e)},onPointerDown:t=>{if(se||r||zt||t.button!=null&&t.button!==0)return;const a=String(e.id);dn.current=!1,Je.current={active:!0,id:a,startX:t.clientX,startY:t.clientY,dx:0,dy:0,lock:null,pointerId:t.pointerId,captured:!1},et(i=>(i==null?void 0:i.id)===a?i:{id:a,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}try{sn.current&&clearTimeout(sn.current)}catch(i){}bn.current=a,sn.current=setTimeout(async()=>{var o,g,p,K;const i=bn.current;if(i)try{if((g=(o=Xt.current)==null?void 0:o.has)!=null&&g.call(o,i))return;const v=await Ba(i);v&&typeof v=="object"&&((K=(p=Xt.current)==null?void 0:p.set)==null||K.call(p,i,v))}catch(v){}},150)},onPointerMove:t=>{const a=Je.current;if(!(a!=null&&a.active)||String(a.id)!==String(e.id))return;const i=t.clientX-a.startX,o=t.clientY-a.startY;if(a.dx=i,a.dy=o,Math.abs(i)>14||Math.abs(o)>14){try{sn.current&&clearTimeout(sn.current)}catch(O){}sn.current=null,bn.current=null}if(!a.lock){const O=Math.abs(i),he=Math.abs(o);if((O>10||he>10)&&(a.lock=O>he*1.2?"x":"y",a.lock==="x"&&!a.captured))try{t.currentTarget.setPointerCapture(t.pointerId),a.captured=!0}catch(fe){}}if(a.lock!=="x"){try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(O){}Math.abs(o)>24&&et(O=>(O==null?void 0:O.id)===a.id?{id:a.id,dir:null}:O);return}const g=!!Yn(e==null?void 0:e.status,"right"),p=!!Yn(e==null?void 0:e.status,"left"),K=(O,he,fe)=>Math.max(he,Math.min(fe,O)),v=K(i,-140,140),m=v>0&&!g||v<0&&!p?v*.35:v,k=K(Math.abs(m)/88,0,1);try{t.currentTarget.classList.add("swiping"),t.currentTarget.style.setProperty("--swipe-x",`${m}px`),t.currentTarget.style.setProperty("--swipe-p",String(k)),t.currentTarget.style.setProperty("--swipe-l",m>0&&g?String(k):"0"),t.currentTarget.style.setProperty("--swipe-r",m<0&&p?String(k):"0")}catch(O){}Math.abs(m)>12&&(dn.current=!0),i>72&&g?et({id:a.id,dir:"right"}):i<-72&&p?et({id:a.id,dir:"left"}):et({id:a.id,dir:null})},onPointerCancel:t=>{try{sn.current&&clearTimeout(sn.current)}catch(i){}sn.current=null,bn.current=null;const a=Je.current;try{a!=null&&a.captured&&(a==null?void 0:a.pointerId)!=null&&t.currentTarget.releasePointerCapture(a.pointerId)}catch(i){}Je.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1},et({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}},onPointerUp:t=>{try{sn.current&&clearTimeout(sn.current)}catch(m){}sn.current=null,bn.current=null;const a=Je.current;if(!(a!=null&&a.active)||String(a.id)!==String(e.id)){et({id:null,dir:null});return}try{a!=null&&a.captured&&(a==null?void 0:a.pointerId)!=null&&t.currentTarget.releasePointerCapture(a.pointerId)}catch(m){}Je.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1};const i=Number(a.dx)||0,o=Math.abs(i),g=a.lock==="x",p=yn(e==null?void 0:e.status);et({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(m){}if(g&&o>12&&(dn.current=!0),!g||o<88)return;t.preventDefault(),t.stopPropagation();const K=i>0?Yn(e==null?void 0:e.status,"right"):Yn(e==null?void 0:e.status,"left"),v=yn(K);!v||v===p||Jn(e,v)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),da(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"orders-mobile-swipe-bg","aria-hidden":"true"},React.createElement("div",{className:"orders-mobile-swipe-bg-left"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Yn(e==null?void 0:e.status,"right"),a=ms(t),i=(a==null?void 0:a.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${a.icon||"fa-circle"}`}),i):null})())),React.createElement("div",{className:"orders-mobile-swipe-bg-right"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Yn(e==null?void 0:e.status,"left"),a=ms(t),i=(a==null?void 0:a.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${a.icon||"fa-circle"}`}),i):null})()))),React.createElement("div",{className:`card orders-mobile-card ${C!=null&&C[String(e.id)]?"order-recent-updated":""}`},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:t=>qs(t,e.phone),onPointerMove:ya,onPointerUp:ya,onPointerCancel:ya,onPointerLeave:ya,onClick:t=>{if(t.stopPropagation(),en.current){en.current=!1;return}cs(e.phone)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),cs(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((n=e==null?void 0:e.split_seq)!=null?n:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=is(e);if(!t)return null;const a=E.has(String(e.id)),i=t.length>84||os(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${a?"":"order-text-collapsed"}`},t),i&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:o=>{o.stopPropagation(),as(e.id)}},a?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const t=os(e);if(!t)return null;const a=E.has(String(e.id)),i=is(e).length,o=i>84||t.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${a?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t),o&&i<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:g=>{g.stopPropagation(),as(e.id)}},a?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${ne.has(String(e.id))?"active":""}`,onClick:t=>{t.stopPropagation(),Es(e.id)},title:ne.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":ne.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:ne.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(vn!=null&&vn[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${ta(e.status)} order-status-badge-btn`,onPointerDown:t=>{t.stopPropagation(),Pe.current=!1;try{Oe.current&&clearTimeout(Oe.current)}catch(a){}Oe.current=setTimeout(()=>{Pe.current=!0,ns(e,t.currentTarget)},420)},onPointerUp:t=>{t.stopPropagation();try{Oe.current&&clearTimeout(Oe.current)}catch(a){}Oe.current=null},onPointerCancel:t=>{t.stopPropagation();try{Oe.current&&clearTimeout(Oe.current)}catch(a){}Oe.current=null},onClick:t=>{if(t.stopPropagation(),Pe.current){Pe.current=!1;return}zt&&String(P==null?void 0:P.id)===String(e.id)?zn():ns(e,t.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},Mn(e.status)),va(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Rn} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(e),"d"),wa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Hn} ng\xE0y`},"\u23F3 C\xF2n ",Na(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=Ia(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((a,i)=>React.createElement("div",{key:i,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),a.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${Pt(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sa(e))})()),(ma(e)!==0||Gn(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Pt(ma(e))),Gn(e)?React.createElement("span",{className:"text-muted"}," ","(",Gn(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Pt(ha(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",na(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),Da(e)},disabled:T||!!H||Ne===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),ts(e)},disabled:T||!!H||Ne===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c")))))}),React.createElement("div",{ref:Zt,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(nn)&&Ns.length<nn.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),zt&&P&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>zn()},React.createElement("div",{className:`orders-status-popover ${(V==null?void 0:V.placement)||""}`,style:{left:V.left,top:V.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},P.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>zn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},ia.map(e=>{const n=yn(P.status)===yn(e.value),t=T||!!H||Ne===P.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${n?"active":""}`,onClick:()=>{n||(Jn(P,e.value),zn())},disabled:t},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{ts(P),zn()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),se&&Bt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Xn()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},Bt.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},Bt.phone||""),React.createElement("span",{className:`badge ${ta(Bt.status)}`},Mn(Bt.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Xn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Da(Bt),Xn()},disabled:T||!!H||Ne===Bt.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(Bt.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(Bt.phone||"").trim()}`,onClick:()=>Xn()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{da(Bt),Xn()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},ia.map(e=>{const n=yn(Bt.status)===yn(e.value),t=T||!!H||Ne===Bt.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${n?"active":""}`,onClick:()=>{n||(Jn(Bt,e.value),Xn())},disabled:t},e.label)})))),r&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>ba()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ba(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Ln("thisMonth"),disabled:rt},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ln("overduePending"),disabled:rt},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Ln("draftExpiring"),disabled:rt},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!Y&&!Me?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re("")}},"T\u1EA5t c\u1EA3"),ia.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${Y===e.value&&!Me?"active":""}`,onClick:()=>{rt&&Re(""),Ae(!1),re(e.value),e.value==="draft"&&F("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:x,onChange:e=>F(e.target.value),disabled:Me||rt}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:Me,onChange:e=>{rt&&Re("");const n=!!e.target.checked;Ae(n),n&&(F(""),re("pending"))},disabled:rt}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",Rn," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Ln("all"),disabled:rt},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>ba()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${w?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){I.current=!1;try{je.current&&clearTimeout(je.current)}catch(n){}je.current=setTimeout(()=>{I.current=!0,ss(tt)},460)}},onPointerUp:()=>{try{je.current&&clearTimeout(je.current)}catch(e){}je.current=null},onPointerCancel:()=>{try{je.current&&clearTimeout(je.current)}catch(e){}je.current=null},onClick:()=>{if(I.current){I.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,n;return(n=(e=cn.current)==null?void 0:e.focus)==null?void 0:n.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>Ma(),disabled:T||!!H,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Os(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),xe&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{oa(de),Tn()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const n=e.touches&&e.touches[0];n&&(oe.current={active:!0,startY:n.clientY,startX:n.clientX,fired:!1})},onTouchMove:e=>{const n=oe.current;if(!(n!=null&&n.active)||n.fired)return;const t=e.touches&&e.touches[0];if(!t)return;const a=t.clientY-n.startY,i=t.clientX-n.startX;Math.abs(i)>24||a>90&&(n.fired=!0,oa(de),Tn())},onTouchEnd:()=>{oe.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{oa(de),Tn()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:vt,type:"text",className:"form-control",value:de,onChange:e=>{const n=e.target.value;He(n),Re(n)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(oa(de),Tn())}}),!!String(de||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{He(""),Re("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(It)&&It.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},It.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{He(e),Re(e),oa(e),Tn()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${ie?"active":""}`,onClick:()=>{Re(""),He(""),Ae(!1),Ve(!1),$e(e=>!e),Tn()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${Ie?"active":""}`,onClick:()=>{Re(""),He(""),Ae(!1),$e(!1),Ve(e=>!e),Tn()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${Me?"active":""}`,onClick:()=>{Re(""),He(""),Ae(e=>!e),Me||(F(""),re("pending")),Tn()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!Y&&!Me&&!ie&&!Ie?"active":""}`,onClick:()=>{Re(""),He(""),Ae(!1),$e(!1),Ve(!1),re(""),Tn()}},"T\u1EA5t c\u1EA3"),ia.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${Y===e.value&&!Me?"active":""}`,onClick:()=>{Re(""),He(""),Ae(!1),$e(!1),Ve(!1),re(e.value),e.value==="draft"&&F(""),Tn()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,nn.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>da(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const n=Ia(e);return n.length?React.createElement("div",{className:"d-grid gap-1"},n.map((t,a)=>React.createElement("div",{key:a,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},a+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Pt(t.unitPrice))))):sa(e)})()),React.createElement("td",null,Ts(e)),React.createElement("td",{className:"fw-semibold"},Pt(ha(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${ta(e.status)}`},Mn(e.status)),va(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Rn} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(e),"d"),wa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Hn} ng\xE0y`},"\u23F3 C\xF2n ",Na(e),"d"))),React.createElement("td",null,na(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:n=>{n.stopPropagation(),Da(e)},disabled:T||!!H||Ne===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:n=>n.stopPropagation(),onChange:n=>{n.stopPropagation();const t=String(n.target.value||"").trim();n.target.value="",t&&Jn(e,t)},disabled:T||!!H||Ne===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!rt&&Ee&&!Me&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Zs,disabled:Xe||Se},Se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:Tt,title:(()=>{const e=_e,n=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Mn(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${n} ${t}`.trim()})(),subtitle:(()=>{const e=_e,n=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),a=e!=null&&e.created_at?na(e.created_at):"";return[n||t||null,a||null].filter(Boolean).join(" \u2022 ")})(),onClose:er,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},hn?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{gn(!1),rn(null),Vn(""),y(!1),Ce([])},disabled:T||me},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!bt&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:xs,disabled:T||me,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>Ra({mode:"close",origin:"drawer"}),disabled:T||me||!Dt.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},T?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>_e&&Da(_e),disabled:!_e||Qt||T||!!H},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>_e&&za(_e),disabled:!_e||Qt||T||!!H},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const n=String(e.target.value||"").trim();e.target.value="",n&&_e&&Jn(_e,n)},disabled:!_e||Qt||T||!!H||Ne===(_e==null?void 0:_e.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},hn?React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ra({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),lr())):Qt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):ln?React.createElement("div",{className:"alert alert-danger",role:"alert"},ln):_e?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${ta(_e.status)}`},Mn(_e.status)),va(_e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Rn} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(_e),"d"),wa(_e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${Hn} ng\xE0y`},"\u23F3 C\xF2n ",Na(_e),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},Pt(ha(_e))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},Ts(_e)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},na(_e.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},_e.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},_e.phone||"\u2014"),!!String(_e.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(_e.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},_e.address||"\u2014")),((_e==null?void 0:_e.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(_e.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=Ia(_e);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((n,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),n.name),n.variant?React.createElement("div",{className:"text-muted small"},n.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${Pt(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sa(_e)||"\u2014")})(),(ma(_e)!==0||Gn(_e))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Pt(ma(_e))),Gn(_e)?React.createElement("span",{className:"text-muted"}," ","(",Gn(_e),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Qe&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),bt?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Xa})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ra({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Yt},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:h.customer_name,onChange:e=>be({...h,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Dt.nameError&&React.createElement("div",{className:"form-text text-danger"},Dt.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:h.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Dt.phoneError&&React.createElement("div",{className:"form-text text-danger"},Dt.phoneError),!Dt.phoneError&&wn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",wn.count," \u0111\u01A1n trong th\xE1ng ",wn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>y(e=>!e)},N?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),N&&wn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>y(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},wn.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ta(e.status)}`},Mn(e.status))),React.createElement("div",{className:"text-muted small"},na(e.created_at)," \u2022 ",Pt(ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&za(e)}},"M\u1EDF")))),wn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(S==null?void 0:S.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(S==null?void 0:S.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(S==null?void 0:S.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(S==null?void 0:S.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:h.status,onChange:e=>be({...h,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:h.address,onChange:e=>be({...h,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Dt.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Dt.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:h.note,onChange:e=>be({...h,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{be(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},Kn(h.adjustment_items).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const a=t.target.value;be(i=>{const o=Kn(i.adjustment_items);return o[n]={...o[n],amount:a},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const a=t.target.value;be(i=>{const o=Kn(i.adjustment_items);return o[n]={...o[n],note:a},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{be(t=>{const a=Kn(t.adjustment_items);return a.splice(n,1),{...t,adjustment_items:a.length?a:[{amount:"",note:""}]}})},disabled:T||Kn(h.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Dt.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Dt.adjustmentAbnormalWarn),!!Dt.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Dt.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{be(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),st(e=>[...Array.isArray(e)?e:[],""]),bt&&Ce(e=>[...Array.isArray(e)?e:[],!0])},disabled:T},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(h.items)?h.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Ut.current[n]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{kt(t=>t===n?null:n),setTimeout(()=>{const t=document.getElementById(`order-product-search-${n}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ot===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:pe[n]||"",onChange:t=>{const a=t.target.value;st(i=>{const o=Array.isArray(i)?[...i]:[];return o[n]=a,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(n);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(a.id),o=Bn(a==null?void 0:a.variants),g={};for(const v of o){const m=String((v==null?void 0:v.name)||"").trim(),k=Array.isArray(v==null?void 0:v.options)?v.options[0]:null,O=String((k==null?void 0:k.label)||"").trim();m&&O&&(g[m]=O)}const p=$a(g),K=aa(a,g);be(v=>{const m=Array.isArray(v.items)?[...v.items]:[];return m[n]={...m[n]||{quantity:1},product_id:i,variant_json:Object.keys(g).length?g:null,variant:p,unit_price:o.length?K:null},{...v,items:m}}),kt(null)}},a.name,a.code?` (${a.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),qt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var a;const t=(a=Dt.items)==null?void 0:a[n];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Cn(e.product_id),a=Bn(t==null?void 0:t.variants);if(!a.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},a.map((o,g)=>{const p=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${g+1}`).trim(),K=String((i==null?void 0:i[p])||"").trim();return React.createElement("div",{key:p},React.createElement("label",{className:"form-label small text-muted mb-1"},p),React.createElement("select",{className:"form-select",value:K,onChange:v=>{const m=String(v.target.value||"").trim();be(k=>{const O=Array.isArray(k.items)?[...k.items]:[],he={...O[n]||{}},fe=Cn(he.product_id),ft=Bn(fe==null?void 0:fe.variants),lt=he!=null&&he.variant_json&&typeof he.variant_json=="object"?{...he.variant_json}:{};m?lt[p]=m:delete lt[p];const tn=$a(lt),_t=aa(fe,lt);return O[n]={...he,variant_json:Object.keys(lt).length?lt:null,variant:tn,unit_price:_t},{...k,items:O}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",p," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(v=>React.createElement("option",{key:v.label,value:v.label},v.label,Number.isFinite(Number(v==null?void 0:v.price))?` (${Pt(Number(v.price))})`:Number(v==null?void 0:v.price_delta)?` (${v.price_delta>0?"+":""}${v.price_delta})`:""))))}))})(),bt&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!Ke[n],onChange:t=>{const a=!!t.target.checked;Ce(i=>{const o=Array.isArray(i)?[...i]:[],g=Array.isArray(h.items)?h.items.length:0;for(;o.length<g;)o.push(!0);return o[n]=a,o})},disabled:T||me}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const a=t.target.value;be(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[n]={...o[n]||{product_id:""},quantity:a},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var a;const t=(a=Dt.items)==null?void 0:a[n];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{be(t=>{const a=Array.isArray(t.items)?[...t.items]:[];return a.splice(n,1),{...t,items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),st(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a.length?a:[""]}),Ce(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a}),kt(t=>t==null?t:t===n?null:t>n?t-1:t)},disabled:T||me||(Array.isArray(h.items)?h.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(h.items)?h.items:[]).filter(p=>p==null?void 0:p.product_id),t=pa(n),a=ua(n),i=ja(h),o=i.amount,g=t+(a.found?a.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Pt(t))),a.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Pt(a.fee))),!!Dt.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Dt.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Pt(o))),(h.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(h.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Pt(g)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Xa,disabled:T||me,style:{borderRadius:10}},"H\u1EE7y"),!!bt&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:xs,disabled:T||me,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!bt&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Ra({mode:"new",origin:"modal"}),disabled:T||!Dt.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:T||me||!Dt.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},T?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

