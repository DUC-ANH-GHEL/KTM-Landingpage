const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:y,error:N}){const[T,J]=useState(""),[P,_]=useState(""),[j,se]=useState(!1),[re,Y]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),N&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),N),React.createElement("form",{onSubmit:async $e=>{$e.preventDefault(),se(!0),await y(T,P),se(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:T,onChange:$e=>J($e.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:re?"text":"password",className:"form-control",value:P,onChange:$e=>_($e.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Y(!re)},React.createElement("i",{className:`fas fa-eye${re?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:j},j?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:y,type:N,onClose:T,actionLabel:J,onAction:P,durationMs:_}){return useEffect(()=>{const j=Number(_),se=Number.isFinite(j)&&j>0?j:3e3,re=setTimeout(T,se);return()=>clearTimeout(re)},[T,_]),React.createElement("div",{className:`toast show align-items-center text-white bg-${N} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},y),J&&typeof P=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{P()}finally{T()}}},J),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:T})))}function Loading({show:y}){return y?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:y,title:N,subtitle:T,onClose:J,footer:P,children:_}){return useEffect(()=>{if(!y)return;const j=se=>{se.key==="Escape"&&(se.preventDefault(),typeof J=="function"&&J())};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[y,J]),y?React.createElement("div",{className:`admin-drawer-root ${y?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:J,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},N),T?React.createElement("div",{className:"admin-drawer-subtitle"},T):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:J,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},_),P?React.createElement("div",{className:"admin-drawer-footer"},P):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(y){try{const N=localStorage.getItem(y);if(!N)return[];const T=JSON.parse(N);return Array.isArray(T)?T.map(J=>String(J||"").trim()).filter(Boolean):[]}catch(N){return[]}}function saveAdminMenuIdsToStorage(y,N){try{localStorage.setItem(y,JSON.stringify(Array.isArray(N)?N:[]))}catch(T){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(y){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,y),y}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(y){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,y),y}function Sidebar({activeMenu:y,onMenuChange:N,onLogout:T,currentUser:J,pinnedMenus:P,recentMenus:_,onTogglePin:j}){const se=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],re=(J==null?void 0:J.username)||(J==null?void 0:J.name)||(J==null?void 0:J.email)||"Admin",Y=useMemo(()=>{const oe=new Map;for(const C of se)oe.set(C.id,C);return oe},[]),Ne=Array.isArray(P)?P:[],$e=Array.isArray(_)?_:[],de=Ne.map(oe=>Y.get(oe)).filter(Boolean),be=$e.filter(oe=>oe!==y).map(oe=>Y.get(oe)).filter(Boolean).slice(0,5),Te=oe=>Ne.includes(oe);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},re),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},de.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},de.map(oe=>React.createElement("a",{key:`pin-${oe.id}`,href:"#",className:`nav-link ${y===oe.id?"active":""} sidebar-quicklink`,onClick:C=>{C.preventDefault(),N(oe.id)}},React.createElement("i",{className:`fas ${oe.icon}`})," ",oe.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:C=>{C.preventDefault(),C.stopPropagation(),j&&j(oe.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),be.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},be.map(oe=>React.createElement("a",{key:`recent-${oe.id}`,href:"#",className:`nav-link ${y===oe.id?"active":""} sidebar-quicklink`,onClick:C=>{C.preventDefault(),N(oe.id)}},React.createElement("i",{className:`fas ${oe.icon}`})," ",oe.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),se.map(oe=>React.createElement("a",{key:oe.id,href:"#",className:`nav-link ${y===oe.id?"active":""} ${oe.disabled?"opacity-50":""} ${oe.highlight?"text-warning":""}`,onClick:C=>{C.preventDefault(),oe.disabled||N(oe.id)}},React.createElement("i",{className:`fas ${oe.icon}`})," ",oe.label,oe.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),oe.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${Te(oe.id)?"pinned":""}`,onClick:C=>{C.preventDefault(),C.stopPropagation(),j&&j(oe.id)},title:Te(oe.id)?"B\u1ECF ghim":"Ghim","aria-label":Te(oe.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),T&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:T,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(y){const N=typeof y=="number"?y:parseFloat(String(y!=null?y:"").trim());return Number.isFinite(N)?Math.max(0,Math.min(100,N)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var y;try{const N=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!N)return{ship_percent:DEFAULT_SHIP_PERCENT};const T=JSON.parse(N);return{ship_percent:normalizeShipPercent((y=T==null?void 0:T.ship_percent)!=null?y:T==null?void 0:T.shipPercent)}}catch(N){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(y){var N;try{const T={ship_percent:normalizeShipPercent((N=y==null?void 0:y.ship_percent)!=null?N:y==null?void 0:y.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(T)),T}catch(T){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var N;const y=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((N=y==null?void 0:y.ship_percent)!=null?N:y==null?void 0:y.shipPercent)}}async function saveAdminSettingsToServer(y){var J,P,_;const N={ship_percent:normalizeShipPercent((J=y==null?void 0:y.ship_percent)!=null?J:y==null?void 0:y.shipPercent)},T=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,N,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((_=(P=T==null?void 0:T.ship_percent)!=null?P:T==null?void 0:T.shipPercent)!=null?_:N.ship_percent)}}function AlbumList({albums:y,onSelect:N,onCreate:T,onEdit:J,onDelete:P,loading:_,currentFolder:j,onBack:se,breadcrumb:re}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},j&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:se},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),j?j.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:T},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),re&&re.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Y=>{Y.preventDefault(),se("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),re.map((Y,Ne)=>React.createElement("li",{key:Y.id,className:`breadcrumb-item ${Ne===re.length-1?"active":""}`},Ne===re.length-1?Y.title:React.createElement("a",{href:"#",onClick:$e=>{$e.preventDefault(),se(Y)},className:"text-warning"},Y.title))))),_?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):y.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},j?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},y.map(Y=>React.createElement("div",{key:Y.uuid||Y.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>N(Y)},Y.cover?React.createElement("img",{src:Y.cover,className:"album-cover",alt:Y.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Y.title),React.createElement("small",{className:"text-muted"},Y.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Y.subfolderCount),Y.subfolderCount>0&&Y.count>0&&" \u2022 ",Y.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Y.count),Y.subfolderCount===0&&Y.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Ne=>{Ne.stopPropagation(),J(Y)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Ne=>{Ne.stopPropagation(),P(Y)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:y,album:N,onClose:T,onSave:J,parentId:P}){const[_,j]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[se,re]=useState(!1),[Y,Ne]=useState(!1),$e=useRef(null);useEffect(()=>{j(N?{slug:N.id||"",title:N.title||"",description:N.description||"",cover_url:N.cover||"",parent_id:N.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:P||null})},[N,y,P]);const de=async C=>{C.preventDefault(),re(!0),await J(_),re(!1)},be=C=>C.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Te=async C=>{const Je=C.type==="image/heic"||C.type==="image/heif"||/\.heic$/i.test(C.name);if(C.size<=2097152&&!Je)return C;try{const Fe=await createImageBitmap(C),fe=document.createElement("canvas");let _e=Fe.width,xe=Fe.height;const Le=800;return(_e>Le||xe>Le)&&(_e>xe?(xe=Math.round(xe/_e*Le),_e=Le):(_e=Math.round(_e/xe*Le),xe=Le)),fe.width=_e,fe.height=xe,fe.getContext("2d").drawImage(Fe,0,0,_e,xe),Fe.close(),new Promise((dt,we)=>{fe.toBlob(Ge=>{Ge?dt(new File([Ge],C.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):we(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Fe){throw console.error("Compress cover error:",Fe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},oe=async C=>{var Fe;const Oe=C.target.files[0];if(!Oe)return;if(!(Oe.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(Oe.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ne(!0);try{const fe=await Te(Oe),_e=await window.KTM.cloudinary.uploadImage({file:fe,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!_e.secure_url)throw console.error("Cloudinary error:",_e),new Error(((Fe=_e.error)==null?void 0:Fe.message)||"Upload failed");j(xe=>({...xe,cover_url:_e.secure_url}))}catch(fe){console.error("Cover upload error:",fe),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+fe.message)}Ne(!1),C.target.value=""};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},N?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:de},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:_.title,onChange:C=>j({..._,title:C.target.value,slug:_.slug||be(C.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:_.slug,onChange:C=>j({..._,slug:C.target.value}),required:!0,disabled:!!N}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:_.description,onChange:C=>j({..._,description:C.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},_.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:_.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>j(C=>({...C,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:$e,type:"file",accept:"image/*",className:"d-none",onChange:oe}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var C;return(C=$e.current)==null?void 0:C.click()},disabled:Y},Y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:_.cover_url,onChange:C=>j({..._,cover_url:C.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:T},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:se||Y},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:y,allAlbums:N,currentAlbumId:T,targetAlbum:J,onSelect:P,level:_=0}){const[j,se]=useState(!0),re=y.uuid||y.id,Y=re===T,Ne=J===re,$e=N.filter(be=>be.parentId===re),de=$e.length>0;return React.createElement("div",{style:{marginLeft:_*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Ne?"bg-info text-white":Y?"bg-light text-muted":"hover-bg"}`,style:{cursor:Y?"not-allowed":"pointer",opacity:Y?.5:1,transition:"background 0.2s"},onClick:()=>!Y&&P(re)},de&&React.createElement("i",{className:`fas fa-chevron-${j?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:be=>{be.stopPropagation(),se(!j)}}),!de&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Ne?"-open":""} me-2 ${Ne?"":"text-warning"}`}),React.createElement("span",{className:"small"},y.title),Y&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),y.count>0&&!Y&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},y.count)),j&&de&&React.createElement("div",null,$e.map(be=>React.createElement(FolderTreeItem,{key:be.uuid||be.id,folder:be,allAlbums:N,currentAlbumId:T,targetAlbum:J,onSelect:P,level:_+1}))))}function AlbumDetail({album:y,onBack:N,onRefresh:T,showToast:J,onNavigateToFolder:P,onEditSubfolder:_,parentAlbum:j}){const[se,re]=useState([]),[Y,Ne]=useState([]),[$e,de]=useState(!0),[be,Te]=useState(!1),[oe,C]=useState(""),[Oe,Je]=useState([]),[Fe,fe]=useState([]),[_e,xe]=useState({}),[Le,Qe]=useState(null),[dt,we]=useState(!1),[Ge,lt]=useState(""),[p,u]=useState(!1),M=useRef(null),G=useRef(null),[Z,q]=useState(!1),[V,me]=useState([]),[m,w]=useState([]),[E,ee]=useState(""),[he,le]=useState(!1),ve=async(S,c=2)=>{const D=c*1024*1024,R=S.type==="image/heic"||S.type==="image/heif"||/\.heic$/i.test(S.name);if(S.size<=D&&!R)return S;try{const l=await createImageBitmap(S),X=document.createElement("canvas");let z=l.width,Be=l.height;const ot=1200;return(z>ot||Be>ot)&&(z>Be?(Be=Math.round(Be/z*ot),z=ot):(z=Math.round(z/Be*ot),Be=ot)),X.width=z,X.height=Be,X.getContext("2d").drawImage(l,0,0,z,Be),l.close(),new Promise((Ce,ze)=>{X.toBlob(Et=>{Et?Ce(new File([Et],S.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ze(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(l){throw console.error("Compress error:",l),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{ye(),qe()},[y.id,y.uuid]);const ye=async()=>{de(!0);try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");re(S.images||[]);const c=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Ne(Array.isArray(c)?c:[])}catch(S){console.error(S),J("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}de(!1)},qe=async()=>{try{const S=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");w(Array.isArray(S)?S:[])}catch(S){console.error("Error loading albums:",S)}},Ye=S=>{me(c=>c.includes(S)?c.filter(D=>D!==S):[...c,S])},te=async()=>{if(!E||V.length===0){J("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}le(!0);let S=0;for(const c of V)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${c}`,{album_id:E},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),S++}catch(D){console.error("Move error:",D)}le(!1),q(!1),me([]),ee(""),S>0?(J("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),ye(),T()):J("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[je,rt]=useState(!1),Ie=async()=>{if(V.length===0||!confirm(`X\xF3a ${V.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;rt(!0);let S=0;for(const c of V)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${c}`,"L\u1ED7i x\xF3a \u1EA3nh"),S++}catch(D){console.error("Delete error:",D)}rt(!1),me([]),S>0?(J(`\u0110\xE3 x\xF3a ${S} \u1EA3nh!`,"success"),ye(),T()):J("X\xF3a th\u1EA5t b\u1EA1i","danger")},tt=()=>{V.length===se.length?me([]):me(se.map(S=>S.id))},ut=async()=>{if(Ge.trim()){u(!0);try{const S=Ge.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:S+"-"+Date.now(),title:Ge,parent_id:y.uuid||y.id},"L\u1ED7i t\u1EA1o folder"),J("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),lt(""),we(!1),ye(),T()}catch(S){J(S.message,"danger")}u(!1)}},_t=async S=>{if(confirm(`X\xF3a folder "${S.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${S.uuid||S.id}`,"L\u1ED7i x\xF3a folder"),J("\u0110\xE3 x\xF3a folder","success"),ye(),T()}catch(c){J("L\u1ED7i x\xF3a folder","danger")}},vt=S=>{const c=Array.from(S).filter(D=>D.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(D.name));Je(D=>[...D,...c]),c.forEach(D=>{const R=new FileReader;R.onload=l=>{fe(X=>[...X,{file:D,preview:l.target.result}])},R.readAsDataURL(D)})},g=S=>{Je(c=>c.filter((D,R)=>R!==S)),fe(c=>c.filter((D,R)=>R!==S))},A=async S=>{var D;const c=await window.KTM.cloudinary.uploadImage({file:S,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${y.id}`});if(!c.secure_url)throw console.error("Cloudinary error:",c),new Error(((D=c.error)==null?void 0:D.message)||"Upload failed");return c},Se=async()=>{if(Oe.length===0)return;Te(!0);let S=0;for(let c=0;c<Oe.length;c++)try{C(`\u0110ang x\u1EED l\xFD ${c+1}/${Oe.length}...`);const D=await ve(Oe[c],2);C(`\u0110ang upload ${c+1}/${Oe.length}...`);const R=await A(D);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${y.id}`,{url:R.secure_url,caption:_e[c]||Oe[c].name.replace(/\.[^/.]+$/,""),sort_order:se.length+c},"L\u1ED7i l\u01B0u \u1EA3nh"),S++}catch(D){console.error("Upload error:",D)}Te(!1),C(""),Je([]),fe([]),xe({}),S>0?(J(`\u0110\xE3 upload ${S} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),ye(),T()):J("Upload th\u1EA5t b\u1EA1i","danger")},wt=async(S,c)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${S}`,"L\u1ED7i x\xF3a \u1EA3nh"),J("\u0110\xE3 x\xF3a \u1EA3nh","success"),ye(),T()}catch(D){J("L\u1ED7i x\xF3a \u1EA3nh","danger")}},at=S=>{var c;S.preventDefault(),(c=G.current)==null||c.classList.add("dragover")},nt=()=>{var S;(S=G.current)==null||S.classList.remove("dragover")},ct=S=>{var c;S.preventDefault(),(c=G.current)==null||c.classList.remove("dragover"),vt(S.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:N},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},y.title),React.createElement("small",{className:"text-muted"},Y.length>0&&React.createElement("span",null,Y.length," folder \u2022 "),se.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>we(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),dt&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Ge,onChange:S=>lt(S.target.value),onKeyPress:S=>S.key==="Enter"&&ut(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:ut,disabled:p||!Ge.trim()},p?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{we(!1),lt("")}},"H\u1EE7y")))),Y.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Y.map(S=>React.createElement("div",{key:S.uuid||S.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>P&&P(S)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},S.title),React.createElement("small",{className:"text-muted"},S.subfolderCount>0&&React.createElement("span",null,S.subfolderCount," folder"),S.subfolderCount>0&&S.count>0&&" \u2022 ",S.count>0&&React.createElement("span",null,S.count," \u1EA3nh"),S.subfolderCount===0&&S.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:c=>{c.stopPropagation(),_&&_(S)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:c=>{c.stopPropagation(),_t(S)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:G,className:"upload-zone",onClick:()=>{var S;return(S=M.current)==null?void 0:S.click()},onDragOver:at,onDragLeave:nt,onDrop:ct},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:M,type:"file",multiple:!0,accept:"image/*",onChange:S=>vt(S.target.files)})),Fe.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},Fe.map((S,c)=>React.createElement("div",{key:c,className:"upload-preview-item"},React.createElement("img",{src:S.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>g(c)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Se,disabled:be},be?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),oe||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",Oe.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",se.length,")"),se.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:tt},V.length===se.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),V.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},V.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>q(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Ie,disabled:je},je?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>me([])},React.createElement("i",{className:"fas fa-times"})))),$e?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):se.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},se.map((S,c)=>React.createElement("div",{key:c,className:`image-item ${V.includes(S.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Ye(S.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:V.includes(S.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:V.includes(S.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},V.includes(S.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:S.src,alt:S.caption,style:{opacity:V.includes(S.id)?.7:1,border:V.includes(S.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:D=>{D.stopPropagation(),wt(S.id,c)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),S.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},S.caption)))))),Z&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",V.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>q(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},m.filter(S=>!S.parentId).map(S=>React.createElement(FolderTreeItem,{key:S.uuid||S.id,folder:S,allAlbums:m,currentAlbumId:y.uuid||y.id,targetAlbum:E,onSelect:ee})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>q(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:te,disabled:!E||he},he?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),Le&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Qe(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Qe(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:Le.src,alt:Le.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:S=>S.stopPropagation()}),Le.caption&&React.createElement("div",{className:"text-white text-center mt-2"},Le.caption)))))}function SearchCenter({showToast:y,onNavigate:N}){const[T,J]=useState(""),[P,_]=useState([]),[j,se]=useState([]),[re,Y]=useState([]),[Ne,$e]=useState("all"),[de,be]=useState(null),[Te,oe]=useState("list"),[C,Oe]=useState(!0),[Je,Fe]=useState([]),[fe,_e]=useState([]),xe=useRef(null),[Le,Qe]=useState(!0),[dt,we]=useState(!1),Ge=useRef(null),[lt,p]=useState(!1),[u,M]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[G,Z]=useState(""),[q,V]=useState(!1),me=useRef(null),m=useRef(null),[w,E]=useState(null),[ee,he]=useState(!1),[le,ve]=useState(null),[ye,qe]=useState(!1),[Ye,te]=useState(!1),[je,rt]=useState(null),[Ie,tt]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),ut=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],_t=s=>{var x,$;s._type==="product"&&(ve(s),tt({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:($=(x=s.commission_percent)!=null?x:s.commissionPercent)!=null?$:""}),he(!0))},vt=async()=>{if(le)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${le.id}`,Ie,"L\u1ED7i c\u1EADp nh\u1EADt"),y("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),he(!1),ve(null),at()}catch(s){y(s.message,"danger")}},g=async s=>{const x=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${x} "${s.name}"?`))try{let $="";s._type==="product"?$=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?$=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&($=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON($,"L\u1ED7i x\xF3a"),y(`\u0110\xE3 x\xF3a ${x}`,"success"),at()}catch($){y($.message,"danger")}},A=async s=>{try{const x=je?`${API_BASE}/api/products?id=${je.id}`:`${API_BASE}/api/products`;je?await window.KTM.api.putJSON(x,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(x,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(je?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),te(!1),rt(null),at()}catch(x){y(x.message,"danger")}},Se="ktm_admin_data_cache_v1",wt=1e3*60*10,at=async()=>{let s=null,x=!1;const $=window.KTM.cache.read(Se,{ttlMs:wt,validate:Array.isArray});$.hit?(s=$.value,console.log("[CACHE] Using cache, items:",s.length),se(s),_(s),Oe(!1),x=!0):$.status==="miss"?console.log("[CACHE] No cache found"):$.status==="expired"||$.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):$.status==="error"&&console.error("[CACHE] Error parsing cache"),x||Oe(!0);try{const B=async(st,We)=>{try{const bt=await window.KTM.api.getJSON(st,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return bt!=null?bt:We}catch(bt){return We}},[ae,O,h]=await Promise.all([B(`${API_BASE}/api/products?fields=search`,[]),B(`${API_BASE}/api/albums`,[]),B(`${API_BASE}/api/video-folders?withVideos=true`,[])]),W=Array.isArray(ae)?ae.map(st=>({...st,_type:"product",_source:"database"})):[];Fe(O);let ge=[];Array.isArray(O)&&O.length>0&&(await Promise.all(O.map(We=>B(`${API_BASE}/api/albums/${We.id}`,{})))).forEach((We,bt)=>{const Mt=O[bt];We.images&&We.images.length>0&&We.images.forEach(xt=>{ge.push({id:xt.id,name:xt.caption||"\u1EA2nh t\u1EEB "+Mt.title,image:xt.src,folder:Mt.title,_type:"album",_source:"database"})})}),_e(h);let ue=[];Array.isArray(h)&&h.forEach(st=>{st.videos&&st.videos.forEach(We=>{ue.push({id:We.id,name:We.title,folder:st.name,image:We.thumb,youtubeId:We.youtubeId,url:We.url,_type:"video",_source:"database"})})});const ne=[...W,...ge,...ue];(!s||JSON.stringify(ne)!==JSON.stringify(s))&&(se(ne),_(ne),window.KTM.cache.write(Se,ne))}catch(B){console.error("Song song fetch error:",B)}Oe(!1)};useEffect(()=>{at(),setTimeout(()=>{var s;return(s=xe.current)==null?void 0:s.focus()},100)},[]);const nt=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(x){return String(s!=null?s:"").toLowerCase()}},ct=s=>{const $=nt(s).trim().split(/\s+/).filter(Boolean),B=$.includes("anh"),ae=$.includes("video"),O=$.filter(ge=>ge!=="anh"&&ge!=="video"),h=O.join(" "),W=new Set(["product"]);return B&&W.add("album"),ae&&W.add("video"),{allowedTypes:W,includeAlbum:B,includeVideo:ae,contentTokens:O,cleanedQuery:h}},S=(s,x,$)=>{var st,We,bt,Mt,xt;const B=Array.isArray(x)?x:[],ae=nt($).trim();if(!B.length&&!ae)return 0;const O=nt((st=s==null?void 0:s.name)!=null?st:""),h=nt((We=s==null?void 0:s.code)!=null?We:""),W=nt((bt=s==null?void 0:s.category)!=null?bt:""),ge=nt((Mt=s==null?void 0:s.note)!=null?Mt:""),ue=nt((xt=s==null?void 0:s.folder)!=null?xt:"");if(!`${O} ${h} ${W} ${ge} ${ue}`.trim())return 0;let ke=0;ae&&(O===ae&&(ke+=220),O.includes(ae)&&(ke+=140),O.startsWith(ae)&&(ke+=160),h&&h===ae&&(ke+=180),h&&h.includes(ae)&&(ke+=90));for(const kt of B){if(!kt)continue;const Vt=new RegExp(`(?:^|\\s)${kt.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);O.includes(kt)&&(ke+=35),Vt.test(O)&&(ke+=25),h&&h.includes(kt)&&(ke+=20),h&&Vt.test(h)&&(ke+=10),W&&W.includes(kt)&&(ke+=12),ue&&ue.includes(kt)&&(ke+=12),ge&&ge.includes(kt)&&(ke+=6)}return ke>0&&O&&(ke+=Math.max(0,10-Math.min(10,Math.floor(O.length/10)))),ke},c=(s,x,$)=>{const B=Array.isArray(s)?s:[];return B.length?B.map((O,h)=>({it:O,idx:h,score:S(O,x,$)})).sort((O,h)=>h.score!==O.score?h.score-O.score:O.idx-h.idx).map(O=>O.it):[]},D=async(s,x)=>{if(!(!Le||x.length===0)){we(!0);try{const $=x.map(ae=>({id:ae.id,name:ae.name,price:ae.price,category:ae.category,note:ae.note,folder:ae.folder,_type:ae._type})),B=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:$},"AI Search error");if(B&&B.matchedIds&&B.matchedIds.length>0){const{contentTokens:ae,cleanedQuery:O}=ct(s),h=new Set(B.matchedIds),W=x.filter(ge=>h.has(ge.id)).sort((ge,ue)=>S(ue,ae,O)-S(ge,ae,O));W.length>0&&_(W)}else B&&B.matchedIds&&B.matchedIds.length===0&&_([])}catch($){console.error("AI Search error:",$)}we(!1)}},R=s=>{if(J(s),Ge.current&&clearTimeout(Ge.current),!s.trim()){l(Ne);return}const{allowedTypes:x,contentTokens:$,cleanedQuery:B}=ct(s),ae=j.filter(h=>{if(!x.has(h==null?void 0:h._type))return!1;if($.length===0)return!0;const W=nt(Object.entries(h).filter(([ge])=>!ge.startsWith("_")).map(([,ge])=>String(ge||"")).join(" "));return $.some(ge=>W.includes(ge))});let O=ae;Ne!=="all"&&(O=ae.filter(h=>(h.category||h._type)===Ne)),_(c(O,$,B)),Le&&B.length>=3&&(Ge.current=setTimeout(()=>{D(B,O)},500))},l=s=>{$e(s);const{allowedTypes:x,contentTokens:$}=ct(T),{cleanedQuery:B}=ct(T);let ae=j.filter(O=>x.has(O==null?void 0:O._type));s!=="all"&&(ae=ae.filter(O=>(O.category||O._type)===s)),T.trim()&&$.length>0&&(ae=ae.filter(O=>{const h=nt(Object.entries(O).filter(([W])=>!W.startsWith("_")).map(([,W])=>String(W||"")).join(" "));return $.every(W=>h.includes(W))})),_(c(ae,$,B))},X=(s,x)=>{window.KTM.clipboard.writeText(s).then(()=>{be(x),y("\u0110\xE3 copy!","success"),setTimeout(()=>be(null),1500)})},z=async(s,x)=>{try{await window.KTM.clipboard.writeImageFromUrl(s),be(x+"-img"),y("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>be(null),1500)}catch($){X(s,x+"-img")}},Be=s=>{let x=s.toLowerCase();const $=[],B=j.filter(h=>h._type==="product");if(x.includes("ty")||x.includes("xy lanh")){if(x.includes("gi\u1EEFa")||x.includes("giua")){const h=B.find(W=>{var ge;return(ge=W.name)==null?void 0:ge.toLowerCase().includes("xy lanh gi\u1EEFa")});h&&!$.find(W=>W.id===h.id)&&$.push(h)}if(x.includes("nghi\xEAng")||x.includes("nghieng")){const h=B.find(W=>{var ge;return(ge=W.name)==null?void 0:ge.toLowerCase().includes("xy lanh nghi\xEAng")});h&&!$.find(W=>W.id===h.id)&&$.push(h)}if(x.includes("\u1EE7i")||x.includes("ui")){const h=B.find(W=>{var ge;return(ge=W.name)==null?void 0:ge.toLowerCase().includes("xy lanh \u1EE7i")});h&&!$.find(W=>W.id===h.id)&&$.push(h)}}const ae=x.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(ae){const h=ae[1],W=ae[2],ge=B.find(ue=>{var ke;const ne=((ke=ue.name)==null?void 0:ke.toLowerCase())||"";return ne.includes("combo")&&ne.includes(`${h} tay`)&&(ne.includes(`${W} xy`)||ne.includes(`${W} xylanh`))});if(ge&&!$.find(ue=>ue.id===ge.id))$.push(ge);else{const ue=B.find(ne=>{var st;const ke=((st=ne.name)==null?void 0:st.toLowerCase())||"";return ke.includes("combo")&&ke.includes(`${h} tay`)});ue&&!$.find(ne=>ne.id===ue.id)&&$.push(ue)}}if(x.includes("combo")&&!ae){const h=x.match(/combo.*?(\d+)\s*tay/);if(h){const W=h[1];B.filter(ue=>{var ke;const ne=((ke=ue.name)==null?void 0:ke.toLowerCase())||"";return ne.includes("combo")&&ne.includes(`${W} tay`)}).forEach(ue=>{$.find(ne=>ne.id===ue.id)||$.push(ue)})}}const O=x.match(/van\s*(\d+)\s*tay/);if(O&&!x.includes("ty")&&!x.includes("combo")){const h=O[1],W=B.find(ge=>{var ne;const ue=((ne=ge.name)==null?void 0:ne.toLowerCase())||"";return ue.includes(`van ${h} tay`)&&!ue.includes("combo")});W&&!$.find(ge=>ge.id===W.id)&&$.push(W)}return $.slice(0,4)},ot=async s=>{if(!s.trim())return;const x={role:"user",content:s,attachments:[]};M(B=>[...B,x]),Z(""),V(!0);const $=Be(s);setTimeout(()=>{var B;return(B=me.current)==null?void 0:B.scrollIntoView({behavior:"smooth"})},100);try{const ae=j.filter(ne=>ne._type==="product").map(ne=>{let ke=`- ${ne.name}`;return ne.code&&(ke+=` (M\xE3: ${ne.code})`),ne.price&&(ke+=` - Gi\xE1: ${ne.price.replace(/[đ\s]/g,"")}\u0111`),ne.category&&(ke+=` [${ne.category}]`),ne.note&&(ke+=` (${ne.note})`),ke}).join(`
`),h=u.slice(-6).map(ne=>`${ne.role==="user"?"Kh\xE1ch":"AI"}: ${ne.content}`).join(`
`),W=h?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${h}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${ae}`:ae,ue=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:W,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";M(ne=>[...ne,{role:"assistant",content:ue,attachments:$}])}catch(B){console.error("AI Error:",B);const ae=s.toLowerCase(),O=j.filter(W=>{const ge=Object.values(W).join(" ").toLowerCase();return ae.split(" ").some(ue=>ge.includes(ue))});let h="";O.length>0?(h=`T\xECm th\u1EA5y ${O.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,O.slice(0,5).forEach(W=>{h+=`\u2022 ${W.name}`,W.price&&(h+=` - ${W.price.replace(/[đ\s]/g,"")}\u0111`),W.note&&(h+=` (${W.note})`),h+=`
`}),O.length>5&&(h+=`
...v\xE0 ${O.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):h='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',M(W=>[...W,{role:"assistant",content:h,attachments:O.slice(0,4)}])}V(!1),setTimeout(()=>{var B,ae;(B=me.current)==null||B.scrollIntoView({behavior:"smooth"}),(ae=m.current)==null||ae.focus()},100)};function ft({show:s,product:x,categories:$,onClose:B,onSave:ae}){const[O,h]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[W,ge]=useState(!1),[ue,ne]=useState(!1),ke=useRef(null),st=L=>window.KTM.money.formatVNDInputDigits(L),We=L=>{const F=window.KTM.money.getDigits(String(L!=null?L:"")),U=Number(F);return F&&Number.isFinite(U)?Math.trunc(U):0},bt=(L,F)=>{if(L==null||L==="")return[];let U=L;if(typeof U=="string"){const K=U.trim();if(!K)return[];try{U=JSON.parse(K)}catch(pe){return[]}}if(!Array.isArray(U))return[];const ce=We(F);return U.map(K=>{var De;if(!K||typeof K!="object")return null;const pe=String((De=K.name)!=null?De:"").trim(),Ee=(Array.isArray(K.options)?K.options:[]).map(Ue=>{var At,Re,pt,Ot,$t,Ft,qt;if(!Ue||typeof Ue!="object")return null;const it=String((At=Ue.label)!=null?At:"").trim();if(!it)return null;const mt=($t=(Ot=(pt=(Re=Ue.price)!=null?Re:Ue.priceValue)!=null?pt:Ue.unit_price)!=null?Ot:Ue.unitPrice)!=null?$t:null,gt=Number(mt);let ht=Number.isFinite(gt)?Math.trunc(gt):null;if(ht==null){const ta=(qt=(Ft=Ue.price_delta)!=null?Ft:Ue.priceDelta)!=null?qt:null,Aa=Number(ta);Number.isFinite(Aa)&&(ht=ce+Math.trunc(Aa))}ht==null&&(ht=ce);const Ct=String(Math.max(0,Math.trunc(Number(ht)||0)));return{label:it,price:Math.max(0,Math.trunc(Number(ht)||0)),priceDigits:Ct}}).filter(Boolean);return{name:pe||"Bi\u1EBFn th\u1EC3",options:Ee}}).filter(Boolean)},Mt=L=>{if(L==null||L==="")return[];let F=L;if(typeof F=="string"){const U=F.trim();if(!U)return[];try{F=JSON.parse(U)}catch(ce){return[]}}return F&&typeof F=="object"&&!Array.isArray(F)&&(F=Object.entries(F).map(([U,ce])=>({key:U,value:ce}))),Array.isArray(F)?F.map(U=>{var Ee,De,Ue,it,mt;if(!U||typeof U!="object")return null;const ce=String((Ue=(De=(Ee=U.key)!=null?Ee:U.name)!=null?De:U.label)!=null?Ue:"").trim(),K=String((it=U.value)!=null?it:"").trim(),pe=String((mt=U.unit)!=null?mt:"").trim();return ce?{key:ce,value:K,unit:pe}:null}).filter(Boolean):[]};useEffect(()=>{var L,F;if(x)if(h({name:x.name||"",code:x.code||"",price:x.price||"",image:x.image||"",category:x.category||"",note:x.note||"",sort_order:x.sort_order||0,commission_percent:(F=(L=x.commission_percent)!=null?L:x.commissionPercent)!=null?F:5,variants:bt(x.variants,x.price),attributes:Mt(x.attributes)}),x.price){const U=window.KTM.money.getDigits(x.price);Pt(U),h(ce=>({...ce,price:st(U)}))}else Pt("");else h({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Pt("")},[x,s]);const xt=L=>{h(F=>{var Ee;const U=We(F.price),ce=String(U),K=Array.isArray(F.variants)?[...F.variants]:[],pe={...K[L]||{},options:Array.isArray((Ee=K[L])==null?void 0:Ee.options)?[...K[L].options]:[]};return pe.options=pe.options.map(De=>({label:String((De==null?void 0:De.label)||""),price:U,priceDigits:ce})),K[L]=pe,{...F,variants:K}})},kt=()=>{h(L=>{const F=We(L.price),U=String(F),K=(Array.isArray(L.variants)?[...L.variants]:[]).map(pe=>{const Ee=(Array.isArray(pe==null?void 0:pe.options)?pe.options:[]).map(De=>({label:String((De==null?void 0:De.label)||""),price:F,priceDigits:U}));return{name:String((pe==null?void 0:pe.name)||"Bi\u1EBFn th\u1EC3"),options:Ee}});return{...L,variants:K}})},[Vt,Ka]=React.useState(""),[Kt,Pt]=React.useState(""),ea=L=>{const F=window.KTM.money.nextPriceInputState(L.target.value,Kt);Pt(F.digits),h({...O,price:F.price})},ka=async(L,F=2)=>{const U=F*1024*1024;if(L.size<=U)return L;try{const ce=await createImageBitmap(L),K=document.createElement("canvas");let pe=ce.width,Ee=ce.height;const De=1200;return(pe>De||Ee>De)&&(pe>Ee?(Ee=Math.round(Ee/pe*De),pe=De):(pe=Math.round(pe/Ee*De),Ee=De)),K.width=pe,K.height=Ee,K.getContext("2d").drawImage(ce,0,0,pe,Ee),ce.close(),new Promise((it,mt)=>{K.toBlob(gt=>{gt?it(new File([gt],L.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):mt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ce){throw console.error("Compress error:",ce),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Sa=async L=>{var ce;const F=L.target.files[0];if(!F)return;if(!(F.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(F.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ne(!0);try{const K=await ka(F),pe=await window.KTM.cloudinary.uploadImage({file:K,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!pe.secure_url)throw console.error("Cloudinary error:",pe),new Error(((ce=pe.error)==null?void 0:ce.message)||"Upload failed");h(Ee=>({...Ee,image:pe.secure_url}))}catch(K){console.error("Upload error:",K),alert("L\u1ED7i upload \u1EA3nh: "+K.message)}ne(!1),L.target.value=""},Ca=async L=>{L.preventDefault(),ge(!0);const F={...O,variants:bt(O.variants,O.price),attributes:Mt(O.attributes)};await ae(F),ge(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),x?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:B})),React.createElement("form",{onSubmit:Ca},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:O.name,onChange:L=>h({...O,name:L.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:O.code,onChange:L=>h({...O,code:L.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:O.price,onChange:ea,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:O.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:L=>h({...O,commission_percent:L.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:O.category,onChange:L=>h({...O,category:L.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),$.map(L=>React.createElement("option",{key:L,value:L},L)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:O.note,onChange:L=>h({...O,note:L.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(O.attributes)?O.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(O.attributes)?O.attributes:[]).map((L,F)=>React.createElement("div",{key:F,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(L==null?void 0:L.key)||"",onChange:U=>{const ce=U.target.value;h(K=>{const pe=Array.isArray(K.attributes)?[...K.attributes]:[];return pe[F]={...pe[F]||{},key:ce},{...K,attributes:pe}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(L==null?void 0:L.value)||"",onChange:U=>{const ce=U.target.value;h(K=>{const pe=Array.isArray(K.attributes)?[...K.attributes]:[];return pe[F]={...pe[F]||{},value:ce},{...K,attributes:pe}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(L==null?void 0:L.unit)||"",onChange:U=>{const ce=U.target.value;h(K=>{const pe=Array.isArray(K.attributes)?[...K.attributes]:[];return pe[F]={...pe[F]||{},unit:ce},{...K,attributes:pe}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{h(U=>{const ce=Array.isArray(U.attributes)?[...U.attributes]:[];return ce.splice(F,1),{...U,attributes:ce}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{h(L=>{const F=Array.isArray(L.attributes)?[...L.attributes]:[];return F.push({key:"",value:"",unit:""}),{...L,attributes:F}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(O.variants)?O.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(O.variants)?O.variants:[]).map((L,F)=>React.createElement("div",{key:F,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(L==null?void 0:L.name)||"",onChange:U=>{const ce=U.target.value;h(K=>{var Ee;const pe=Array.isArray(K.variants)?[...K.variants]:[];return pe[F]={...pe[F]||{},name:ce,options:Array.isArray((Ee=pe[F])==null?void 0:Ee.options)?pe[F].options:[]},{...K,variants:pe}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>xt(F),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(L==null?void 0:L.options)||L.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{h(U=>{const ce=Array.isArray(U.variants)?[...U.variants]:[];return ce.splice(F,1),{...U,variants:ce}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(L==null?void 0:L.options)?L.options:[]).map((U,ce)=>{var K,pe;return React.createElement("div",{key:ce,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(U==null?void 0:U.label)||"",onChange:Ee=>{const De=Ee.target.value;h(Ue=>{var Ct,At,Re,pt,Ot;const it=Array.isArray(Ue.variants)?[...Ue.variants]:[],mt={...it[F]||{},options:Array.isArray((Ct=it[F])==null?void 0:Ct.options)?[...it[F].options]:[]},gt=Number((Re=(At=mt.options[ce])==null?void 0:At.price)!=null?Re:0)||0,ht=String((Ot=(pt=mt.options[ce])==null?void 0:pt.priceDigits)!=null?Ot:Math.max(0,Math.trunc(gt)));return mt.options[ce]={...mt.options[ce]||{},label:De,price:Math.max(0,Math.trunc(gt)),priceDigits:ht},it[F]=mt,{...Ue,variants:it}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:st(String((pe=U==null?void 0:U.priceDigits)!=null?pe:window.KTM.money.getDigits(String((K=U==null?void 0:U.price)!=null?K:"")))),onChange:Ee=>{h(De=>{var Re,pt,Ot,$t,Ft;const Ue=String((pt=U==null?void 0:U.priceDigits)!=null?pt:window.KTM.money.getDigits(String((Re=U==null?void 0:U.price)!=null?Re:""))),it=window.KTM.money.nextPriceInputState(Ee.target.value,Ue),mt=String((Ot=it.digits)!=null?Ot:""),gt=Number(mt),ht=Number.isFinite(gt)?Math.max(0,Math.trunc(gt)):0,Ct=Array.isArray(De.variants)?[...De.variants]:[],At={...Ct[F]||{},options:Array.isArray(($t=Ct[F])==null?void 0:$t.options)?[...Ct[F].options]:[]};return At.options[ce]={...At.options[ce]||{},label:String(((Ft=At.options[ce])==null?void 0:Ft.label)||""),price:ht,priceDigits:mt},Ct[F]=At,{...De,variants:Ct}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{h(Ee=>{var it;const De=Array.isArray(Ee.variants)?[...Ee.variants]:[],Ue={...De[F]||{},options:Array.isArray((it=De[F])==null?void 0:it.options)?[...De[F].options]:[]};return Ue.options.splice(ce,1),De[F]=Ue,{...Ee,variants:De}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{h(U=>{var Ee;const ce=Array.isArray(U.variants)?[...U.variants]:[],K={...ce[F]||{},options:Array.isArray((Ee=ce[F])==null?void 0:Ee.options)?[...ce[F].options]:[]},pe=We(U.price);return K.options.push({label:"",price:pe,priceDigits:String(pe)}),ce[F]=K,{...U,variants:ce}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{h(L=>{const F=We(L.price),U=Array.isArray(L.variants)?[...L.variants]:[],ce=String(F);return U.push({name:"Size",options:[{label:"S",price:F,priceDigits:ce},{label:"M",price:F,priceDigits:ce},{label:"L",price:F,priceDigits:ce}]}),{...L,variants:U}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:kt,disabled:!Array.isArray(O.variants)||O.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},O.image?React.createElement(React.Fragment,null,React.createElement("img",{src:O.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>h({...O,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var L;return(L=ke.current)==null?void 0:L.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:ke,type:"file",accept:"image/*",className:"d-none",onChange:Sa}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var L;return(L=ke.current)==null?void 0:L.click()},disabled:ue,style:{borderRadius:"10px"}},ue?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:O.image,onChange:L=>h({...O,image:L.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:B,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:W,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},W?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Ce=s=>window.KTM.money.formatVND(s),ze=s=>{if(s==null||s==="")return[];let x=s;if(typeof x=="string"){const $=x.trim();if(!$)return[];try{x=JSON.parse($)}catch(B){return[]}}return Array.isArray(x)?x:[]},Et=s=>{if(s==null||s==="")return[];let x=s;if(typeof x=="string"){const $=x.trim();if(!$)return[];try{x=JSON.parse($)}catch(B){return[]}}return x&&typeof x=="object"&&!Array.isArray(x)&&(x=Object.entries(x).map(([$,B])=>({key:$,value:B}))),Array.isArray(x)?x:[]},He=(s,x={})=>{var O;const $=Et(s).map(h=>{var W,ge,ue,ne,ke;return{key:String((ue=(ge=(W=h==null?void 0:h.key)!=null?W:h==null?void 0:h.name)!=null?ge:h==null?void 0:h.label)!=null?ue:"").trim(),value:String((ne=h==null?void 0:h.value)!=null?ne:"").trim(),unit:String((ke=h==null?void 0:h.unit)!=null?ke:"").trim()}}).filter(h=>!!h.key);if(!$.length)return null;const B=!!x.compact,ae=String((O=x.className)!=null?O:"").trim();return React.createElement("div",{className:`ktm-variants-preview${B?" compact":""}${ae?" "+ae:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},$.map((h,W)=>{const ge=h.key,ue=`${h.value||""}${h.unit?(h.value?" ":"")+h.unit:""}`.trim();return React.createElement("div",{key:`${ge}-${W}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ge),ue?React.createElement("span",{className:"ktm-chip ktm-chip-option"},ue):null)})))},ie=(s,x={})=>{var ge;const $=ze(s).map(ue=>{var ne;return{name:String((ne=ue==null?void 0:ue.name)!=null?ne:"").trim(),options:Array.isArray(ue==null?void 0:ue.options)?ue.options:[]}}).map(ue=>({...ue,options:ue.options.map(ne=>{var ke;return{label:String((ke=ne==null?void 0:ne.label)!=null?ke:"").trim(),price:Number(ne==null?void 0:ne.price)}}).filter(ne=>!!ne.label)})).filter(ue=>ue.options.length>0);if(!$.length)return null;const B=Number.isFinite(x.maxGroups)?Math.max(1,Math.trunc(x.maxGroups)):$.length,ae=Number.isFinite(x.maxOptionsPerGroup)?Math.max(1,Math.trunc(x.maxOptionsPerGroup)):3,O=!!x.compact,h=String((ge=x.className)!=null?ge:"").trim(),W=$.slice(0,B);return React.createElement("div",{className:`ktm-variants-preview${O?" compact":""}${h?" "+h:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},W.map((ue,ne)=>{const ke=ue.name||"Bi\u1EBFn th\u1EC3",st=ue.options.slice(0,ae),We=ue.options.length-st.length;return React.createElement("div",{key:`${ke}-${ne}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ke),st.map((bt,Mt)=>{const xt=bt.price,kt=Number.isFinite(xt)&&xt>=0?Ce(Math.trunc(xt)):"",Vt=kt?`${bt.label} \xB7 ${kt}`:bt.label;return React.createElement("span",{key:`${ke}-${ne}-${Mt}`,className:"ktm-chip ktm-chip-option"},Vt)}),We>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",We))})))},It=(s,x)=>{const $=s._type==="product",B=s._type==="album",ae=s._type==="video",O=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),h=$?He(s.attributes,{compact:Te==="grid",className:Te==="grid"?"meta text-muted":"text-muted"}):null,W=$?ie(s.variants,{compact:Te==="grid",maxOptionsPerGroup:999,className:Te==="grid"?"meta text-muted":"text-muted"}):null;return Te==="grid"?React.createElement("div",{key:s.id||x,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>E({url:s.image,name:s.name,price:s.price,note:s.note,item:s})},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${ae?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${$?"product":B?"album":"video"}`},$?"SP":B?"\u1EA2nh":"Video"),O&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),h&&React.createElement("div",{style:{marginTop:2}},h),W&&React.createElement("div",{style:{marginTop:2}},W),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:de===s.id+"-img"?"copied":"",onClick:()=>z(s.image,s.id)},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:de===s.id+"-price"?"copied":"",onClick:()=>X(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||x,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${$?"product":B?"album":"video"}`},$?"S\u1EA3n ph\u1EA9m":B?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>E({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${ae?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),O&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),h&&React.createElement("div",{style:{marginTop:4}},h),W&&React.createElement("div",{style:{marginTop:4}},W)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),ae&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},$&&React.createElement("button",{onClick:()=>N&&N("orders","create",{productId:s.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:de===s.id+"-price"?"copied":"",onClick:()=>X(s.price.replace(/[đ\s]/g,""),s.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:de===s.id+"-name"?"copied":"",onClick:()=>X(s.name,s.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),ae&&s.youtubeId&&React.createElement("button",{className:de===s.id+"-yt"?"copied":"",onClick:()=>X(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),$&&React.createElement("button",{className:"action-edit",onClick:()=>_t(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>g(s)},React.createElement("i",{className:"fas fa-trash"}))))},[yt,St]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,P.length)," k\u1EBFt qu\u1EA3",Le&&T.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Ne!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Ne==="product"?"S\u1EA3n ph\u1EA9m":Ne==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Te==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>oe("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Te==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>oe("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},C?React.createElement("div",null,[...Array(8)].map((s,x)=>React.createElement("div",{key:x,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):P.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',T,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{J(""),R("")}},"Xem t\u1EA5t c\u1EA3")):Te==="grid"?React.createElement("div",{className:"product-grid-mobile"},P.map((s,x)=>It(s,x))):React.createElement("div",null,P.map((s,x)=>It(s,x)))),yt&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>St(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Ne==="all"?"active":""}`,onClick:()=>{l("all"),St(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Ne==="product"?"active":""}`,onClick:()=>{l("product"),St(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Ne==="album"?"active":""}`,onClick:()=>{l("album"),St(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Ne==="video"?"active":""}`,onClick:()=>{l("video"),St(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:Le,onChange:s=>Qe(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:xe,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:T,onChange:s=>R(s.target.value)}),React.createElement("button",{className:`filter-btn ${yt||Ne!=="all"?"active":""}`,onClick:()=>St(!yt)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:ye?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>p(!0),onTouchStart:()=>p(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),lt&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>p(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},u.map((s,x)=>React.createElement("div",{key:x,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:de===`chat-${x}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:de===`chat-${x}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),be(`chat-${x}`),setTimeout(()=>be(null),1500)}},React.createElement("i",{className:`fas ${de===`chat-${x}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map(($,B)=>React.createElement("div",{key:B,style:{width:70},className:"text-center"},$.image&&React.createElement("img",{src:$.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>E({url:$.image,name:$.name,price:$.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},$.name),$.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},$.price.replace(/[đ\s]/g,""),"\u0111"))))))),q&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:me})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>ot(s),disabled:q,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),ot(G)},className:"chat-input-wrap"},React.createElement("input",{ref:m,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:G,onChange:s=>Z(s.target.value),disabled:q}),React.createElement("button",{type:"submit",className:"send-btn",disabled:q||!G.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),w&&React.createElement("div",{className:"preview-modal",onClick:()=>E(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>E(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:w.url,alt:w.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},w.name),w.price&&React.createElement("div",{className:"price"},w.price.replace(/[đ\s]/g,""),"\u0111"),w.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},w.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:de==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:de==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>z(w.url,"preview")},React.createElement("i",{className:`fas ${de==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),w.price&&React.createElement("button",{className:de==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>X(w.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${de==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(ft,{show:Ye,product:je,categories:re,onClose:()=>{te(!1),rt(null)},onSave:A}),React.createElement("div",{className:`fab-container mobile-only ${ye?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{qe(!1),te(!0),rt(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{qe(!1),N&&N("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${ye?"open":""}`,onClick:()=>qe(!ye)},React.createElement("i",{className:"fas fa-plus"}))),ee&&le&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>he(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Ie.name,onChange:s=>tt({...Ie,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Ie.code,onChange:s=>tt({...Ie,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Ie.price,onChange:s=>tt({...Ie,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Ie.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>tt({...Ie,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Ie.category,onChange:s=>tt({...Ie,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),ut.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Ie.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>tt({...Ie,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>he(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:vt},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:y,showToast:N}){const[T,J]=useState([]),[P,_]=useState([]),[j,se]=useState(!0),[re,Y]=useState(null),[Ne,$e]=useState(!1),[de,be]=useState(null),[Te,oe]=useState(!1),[C,Oe]=useState(null),[Je,Fe]=useState(!1),[fe,_e]=useState(null),[xe,Le]=useState(!1),[Qe,dt]=useState(!1),[we,Ge]=useState(null),[lt,p]=useState(!1),[u,M]=useState(null),[G,Z]=useState([]);useEffect(()=>{q()},[]);const q=async(g=null)=>{se(!0);try{const A=g?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${g}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Se=await window.KTM.api.getJSON(A,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");J(Array.isArray(Se)?Se:[])}catch(A){console.error(A),N("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}se(!1)},V=async g=>{try{const A=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${g}`,"L\u1ED7i t\u1EA3i video");_(Array.isArray(A)?A:[])}catch(A){console.error(A)}},me=async g=>{if(g===0)return;const A=[...T];[A[g-1],A[g]]=[A[g],A[g-1]],J(A),await w(A)},m=async g=>{if(g===T.length-1)return;const A=[...T];[A[g],A[g+1]]=[A[g+1],A[g]],J(A),await w(A)},w=async g=>{try{await Promise.all(g.map((A,Se)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${A.id}`,{sortOrder:Se},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),N("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(A){N("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),q(u==null?void 0:u.id)}},E=async g=>{if(g===0)return;const A=[...P];[A[g-1],A[g]]=[A[g],A[g-1]],_(A),await he(A)},ee=async g=>{if(g===P.length-1)return;const A=[...P];[A[g],A[g+1]]=[A[g+1],A[g]],_(A),await he(A)},he=async g=>{try{await Promise.all(g.map((A,Se)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${A.id}`,{sort_order:Se},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),N("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(A){N("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),V(re.id)}},le=()=>{be(null),$e(!0)},ve=g=>{Ge(g),dt(!0),p(!0)},ye=async(g,A="modal")=>{try{!de&&u&&(g.parent_id=u.id);const Se=de?`${API_BASE}/api/video-folders/${de.id}`:`${API_BASE}/api/video-folders`;de?await window.KTM.api.putJSON(Se,g,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Se,g,"L\u1ED7i l\u01B0u folder"),N(de?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),A==="drawer"?(p(!1),be(null),q(u==null?void 0:u.id),de&&we&&Ge({...we,...g})):($e(!1),be(null),q(u==null?void 0:u.id))}catch(Se){N(Se.message,"danger")}},qe=async g=>{const A=g.subfolderCount>0?`X\xF3a folder "${g.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${g.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(A))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${g.id}`,"L\u1ED7i x\xF3a folder"),N("\u0110\xE3 x\xF3a folder","success"),Y(null),q(u==null?void 0:u.id)}catch(Se){N("L\u1ED7i x\xF3a folder","danger")}},Ye=g=>{g.subfolderCount>0?(Z(A=>[...A,g]),M(g),q(g.id)):(Y(g),_(g.videos||[]))},te=g=>{if(g==="root")Z([]),M(null),q(null);else if(g){const A=G.findIndex(Se=>Se.id===g.id);A>=0&&(Z(G.slice(0,A+1)),M(g),q(g.id))}else{const A=[...G];A.pop();const Se=A[A.length-1]||null;Z(A),M(Se),q(Se==null?void 0:Se.id)}},je=()=>{dt(!1),p(!1),Ge(null)},rt=()=>{Fe(!1),Le(!1),_e(null)},Ie=()=>{Oe(null),oe(!0)},tt=g=>{_e(g),Fe(!0),Le(!0)},ut=async(g,A="modal")=>{try{g.folder_id=re==null?void 0:re.id;const Se=C?`${API_BASE}/api/videos/${C.id}`:`${API_BASE}/api/videos`;C?await window.KTM.api.putJSON(Se,g,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Se,g,"L\u1ED7i l\u01B0u video"),N(C?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),A==="drawer"?(Le(!1),Oe(null),q(),re&&V(re.id),C&&fe&&_e({...fe,...g})):(oe(!1),Oe(null),q(),re&&V(re.id))}catch(Se){N(Se.message,"danger")}},_t=async g=>{if(confirm(`X\xF3a video "${g.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${g.id}`,"L\u1ED7i x\xF3a video"),N("\u0110\xE3 x\xF3a video","success"),q(),re&&V(re.id)}catch(A){N("L\u1ED7i x\xF3a video","danger")}},vt=g=>{const A=`https://www.youtube.com/watch?v=${g.youtubeId}`;window.KTM.clipboard.writeText(A).then(()=>{N("\u0110\xE3 copy link!","success")}).catch(()=>{N("Kh\xF4ng th\u1EC3 copy link","danger")})};return re?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Y(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${re.slug==="shorts"?"text-danger":"text-warning"}`}),re.name)),React.createElement("button",{className:"btn btn-warning",onClick:Ie},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),P.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},P.map((g,A)=>React.createElement("div",{key:g.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>E(A),disabled:A===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},A+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>ee(A),disabled:A===P.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:g.thumb,className:"card-img-top",alt:g.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${g.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:g.title},g.title),React.createElement("small",{className:"text-muted"},g.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>vt(g),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>tt(g),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>_t(g),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Te,video:C,onClose:()=>oe(!1),onSave:ut}),React.createElement(AdminDrawer,{open:Qe,title:we?we.name:"Folder",subtitle:we?`${we.subfolderCount||0} subfolder \u2022 ${we.videoCount||0} videos`:"",onClose:je,footer:lt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:je},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{we&&ye({name:we.name||"",description:we.description||"",sortOrder:we.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):we?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(we.name),N("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{p(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${we.name}"?`)&&(qe(we),je())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},lt&&we?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:we.name||"",onChange:g=>Ge({...we,name:g.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:we.description||"",onChange:g=>Ge({...we,description:g.target.value})}))):we?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},we.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},we.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},we.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},we.videoCount||0))),we.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,we.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:Je,title:fe?fe.title:"Video",subtitle:fe?`${fe.youtubeId}`:"",onClose:rt,footer:xe?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:rt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{fe&&ut({youtube_url:`https://www.youtube.com/watch?v=${fe.youtubeId}`,title:fe.title||"",thumbnail_url:fe.thumb||"",sort_order:fe.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):fe?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const g=`https://www.youtube.com/watch?v=${fe.youtubeId}`;window.KTM.clipboard.writeText(g).then(()=>{N("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{Le(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${fe.title}"?`)&&(_t(fe),rt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},xe&&fe?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:fe.title||"",onChange:g=>_e({...fe,title:g.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:fe.youtubeId||"",onChange:g=>_e({...fe,youtubeId:g.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:fe.sortOrder||0,onChange:g=>_e({...fe,sortOrder:parseInt(g.target.value)||0})}))):fe?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},fe.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},fe.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},fe.sortOrder||0))),fe.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:fe.thumb,alt:fe.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},u&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>te()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),u?u.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:le},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),G.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:g=>{g.preventDefault(),te("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),G.map((g,A)=>React.createElement("li",{key:g.id,className:`breadcrumb-item ${A===G.length-1?"active":""}`},A===G.length-1?g.name:React.createElement("a",{href:"#",onClick:Se=>{Se.preventDefault(),te(g)},className:"text-warning"},g.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),j?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):T.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},u?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:le},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",u?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},T.map((g,A)=>{var Se,wt,at,nt;return React.createElement("div",{key:g.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ct=>{ct.stopPropagation(),me(A)},disabled:A===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},A+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:ct=>{ct.stopPropagation(),m(A)},disabled:A===T.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>Ye(g),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${g.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},g.name),React.createElement("p",{className:"text-muted mb-0"},g.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),g.subfolderCount," folder"),g.subfolderCount>0&&(g.videoCount>0||((Se=g.videos)==null?void 0:Se.length)>0)&&" \u2022 ",(g.videoCount>0||((wt=g.videos)==null?void 0:wt.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),g.videoCount||((at=g.videos)==null?void 0:at.length)||0," videos"),g.subfolderCount===0&&!g.videoCount&&!((nt=g.videos)!=null&&nt.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ct=>{ct.stopPropagation(),ve(g)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:ct=>{ct.stopPropagation(),qe(g)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Ne,folder:de,onClose:()=>$e(!1),onSave:ye}))}function VideoFolderModal({show:y,folder:N,onClose:T,onSave:J}){const[P,_]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[j,se]=useState(!1),[re,Y]=useState(!1);useEffect(()=>{_(N?{name:N.name||"",description:N.description||"",sortOrder:N.sortOrder||0,coverImage:N.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[N,y]);const Ne=async de=>{const be=de.target.files[0];if(be){Y(!0);try{const Te=await window.KTM.cloudinary.uploadImage({file:be,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Te.secure_url&&_(oe=>({...oe,coverImage:Te.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Te){console.error("Cloudinary upload error:",Te),alert("L\u1ED7i upload \u1EA3nh: "+(Te.message||Te))}finally{Y(!1)}}},$e=async de=>{de.preventDefault(),se(!0);const be={...P,variants:normalizeVariants(P.variants,P.price),attributes:normalizeAttributes(P.attributes)};await J(be),se(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},N?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:$e},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:P.name,onChange:de=>_({...P,name:de.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:P.description,onChange:de=>_({...P,description:de.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sortOrder,onChange:de=>_({...P,sortOrder:parseInt(de.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},P.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:P.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>_({...P,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Ne,disabled:re}),re&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:P.coverImage,onChange:de=>_({...P,coverImage:de.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:T},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:j},j?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:y,settings:N}){const[T,J]=useState([]),[P,_]=useState(!0),[j,se]=useState(!1),[re,Y]=useState(null),[Ne,$e]=useState(""),[de,be]=useState(""),[Te,oe]=useState(!1),[C,Oe]=useState(null),Je=normalizeShipPercent(N==null?void 0:N.ship_percent),{parseMoney:Fe,formatVND:fe}=window.KTM.money,_e=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{xe()},[]);const xe=async()=>{_(!0);try{const m=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");J(Array.isArray(m)?m:[])}catch(m){console.error(m),y("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}_(!1)},Le=()=>{Y(null),se(!0)},Qe=m=>{Y(m),se(!0)},dt=m=>{m&&(Oe(m),oe(!0))},we=()=>{oe(!1)},Ge=async m=>{if(!(!m||!m.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:m},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),y(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),xe()}catch(w){y("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},lt=async m=>{try{const w=re?`${API_BASE}/api/products?id=${re.id}`:`${API_BASE}/api/products`;re?await window.KTM.api.putJSON(w,m,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(w,m,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(re?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),se(!1),xe()}catch(w){y(w.message,"danger")}},p=async m=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${m.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${m.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),y("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),xe()}catch(w){y(w.message,"danger")}},u=T.filter(m=>{const w=!Ne||m.name.toLowerCase().includes(Ne.toLowerCase())||m.code&&m.code.toLowerCase().includes(Ne.toLowerCase()),E=!de||m.category===de;return w&&E}),M=m=>{var ee;const w=(ee=m==null?void 0:m.commission_percent)!=null?ee:m==null?void 0:m.commissionPercent,E=w===""||w==null?NaN:Number(w);return Number.isFinite(E)?Math.max(0,Math.min(100,E)):5},G=m=>{const w=M(m),E=Number.isInteger(w)?String(w):String(Math.round(w*100)/100),ee=Fe(m==null?void 0:m.price);if(!Number.isFinite(ee)||ee<=0)return`${E}%`;const he=(Number(w)||0)/100,ve=window.KTM.money.parseShipFeeFromNote(m==null?void 0:m.note)!=null?0:Je>0?ee*Je/100:0,ye=ee*he-ve*he,qe=Math.max(0,Math.round(ye));return`${E}% - ${fe(qe)}`},Z=m=>{if(m==null||m==="")return[];let w=m;if(typeof w=="string"){const E=w.trim();if(!E)return[];try{w=JSON.parse(E)}catch(ee){return[]}}return Array.isArray(w)?w:[]},q=m=>{if(m==null||m==="")return[];let w=m;if(typeof w=="string"){const E=w.trim();if(!E)return[];try{w=JSON.parse(E)}catch(ee){return[]}}return w&&typeof w=="object"&&!Array.isArray(w)&&(w=Object.entries(w).map(([E,ee])=>({key:E,value:ee}))),Array.isArray(w)?w:[]},V=m=>{const w=q(m).map(E=>{var ee,he,le,ve,ye;return{key:String((le=(he=(ee=E==null?void 0:E.key)!=null?ee:E==null?void 0:E.name)!=null?he:E==null?void 0:E.label)!=null?le:"").trim(),value:String((ve=E==null?void 0:E.value)!=null?ve:"").trim(),unit:String((ye=E==null?void 0:E.unit)!=null?ye:"").trim()}}).filter(E=>!!E.key);return w.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},w.map((E,ee)=>{const he=E.key,le=`${E.value||""}${E.unit?(E.value?" ":"")+E.unit:""}`.trim();return React.createElement("div",{key:`${he}-${ee}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},he),le?React.createElement("span",{className:"ktm-chip ktm-chip-option"},le):null)}))):null},me=(m,w={})=>{const E=Z(m).map(ve=>{var ye;return{name:String((ye=ve==null?void 0:ve.name)!=null?ye:"").trim(),options:Array.isArray(ve==null?void 0:ve.options)?ve.options:[]}}).map(ve=>({...ve,options:ve.options.map(ye=>{var qe;return{label:String((qe=ye==null?void 0:ye.label)!=null?qe:"").trim(),price:Number(ye==null?void 0:ye.price)}}).filter(ye=>!!ye.label)})).filter(ve=>ve.options.length>0);if(!E.length)return null;const ee=Number.isFinite(w.maxGroups)?Math.max(1,Math.trunc(w.maxGroups)):E.length,he=Number.isFinite(w.maxOptionsPerGroup)?Math.max(1,Math.trunc(w.maxOptionsPerGroup)):4,le=E.slice(0,ee);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},le.map((ve,ye)=>{const qe=ve.name||"Bi\u1EBFn th\u1EC3",Ye=ve.options.slice(0,he),te=ve.options.length-Ye.length;return React.createElement("div",{key:`${qe}-${ye}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},qe),Ye.map((je,rt)=>{const Ie=je.price,tt=Number.isFinite(Ie)&&Ie>=0?fe(Math.trunc(Ie)):"",ut=tt?`${je.label} \xB7 ${tt}`:je.label;return React.createElement("span",{key:`${qe}-${ye}-${rt}`,className:"ktm-chip ktm-chip-option"},ut)}),te>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",te))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:Le},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:Ne,onChange:m=>$e(m.target.value)})),React.createElement("span",{className:"product-count"},u.length)),React.createElement("select",{className:"form-select",value:de,onChange:m=>be(m.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),_e.map(m=>React.createElement("option",{key:m,value:m},m)))),P?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):u.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Le},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},u.map(m=>React.createElement("div",{key:m.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>dt(m),onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),dt(m))},title:"Xem chi ti\u1EBFt"},m.image?React.createElement("img",{src:m.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},m.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},m.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},m.category),m.code&&React.createElement("span",{className:"product-badge bg-secondary"},m.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),G(m))),React.createElement("div",{className:"product-price"},m.price?m.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),m.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},m.note),V(m.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},V(m.attributes)),me(m.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},me(m.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:w=>{w.stopPropagation(),Qe(m)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:w=>{w.stopPropagation(),p(m)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:Te,title:String((C==null?void 0:C.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((C==null?void 0:C.code)||"").trim()||null,String((C==null?void 0:C.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:we,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const m=String((C==null?void 0:C.code)||"").trim();m&&window.KTM.clipboard.writeText(m).then(()=>y("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((C==null?void 0:C.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const m=String((C==null?void 0:C.price)||"").trim();m&&window.KTM.clipboard.writeText(m).then(()=>y("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((C==null?void 0:C.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>C&&Qe(C),disabled:!C},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>C&&p(C),disabled:!C},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},C?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const m=String((C==null?void 0:C.price)||"").trim(),w=Fe(m);return Number.isFinite(w)&&w>0?fe(Math.trunc(w)):m||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},G(C)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},C.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},C.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),C.image?React.createElement("img",{src:C.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(C.note||"").trim()||C.attributes||C.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(C.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(C.note||"").trim()),V(C.attributes)?React.createElement("div",{className:"mt-2"},V(C.attributes)):null,me(C.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},me(C.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:j,product:re,categories:_e,onClose:()=>se(!1),onSave:lt}))}function ProductModal({show:y,product:N,categories:T,onClose:J,onSave:P}){const[_,j]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[se,re]=useState(!1),[Y,Ne]=useState(!1),$e=p=>{const u=window.KTM.money.getDigits(String(p!=null?p:"")),M=Number(u);return u&&Number.isFinite(M)?Math.trunc(M):0},de=p=>{if(p==null||p==="")return[];let u=p;if(typeof u=="string"){const M=u.trim();if(!M)return[];try{u=JSON.parse(M)}catch(G){return[]}}return u&&typeof u=="object"&&!Array.isArray(u)&&(u=Object.entries(u).map(([M,G])=>({key:M,value:G}))),Array.isArray(u)?u.map(M=>{var V,me,m,w,E;if(!M||typeof M!="object")return null;const G=String((m=(me=(V=M.key)!=null?V:M.name)!=null?me:M.label)!=null?m:"").trim(),Z=String((w=M.value)!=null?w:"").trim(),q=String((E=M.unit)!=null?E:"").trim();return G?{key:G,value:Z,unit:q}:null}).filter(Boolean):[]},be=(p,u)=>{if(p==null||p==="")return[];let M=p;if(typeof M=="string"){const Z=M.trim();if(!Z)return[];try{M=JSON.parse(Z)}catch(q){return[]}}if(!Array.isArray(M))return[];const G=$e(u);return M.map(Z=>{var me;if(!Z||typeof Z!="object")return null;const q=String((me=Z.name)!=null?me:"").trim(),V=(Array.isArray(Z.options)?Z.options:[]).map(m=>{var ve,ye,qe,Ye,te,je,rt;if(!m||typeof m!="object")return null;const w=String((ve=m.label)!=null?ve:"").trim();if(!w)return null;const E=(te=(Ye=(qe=(ye=m.price)!=null?ye:m.priceValue)!=null?qe:m.unit_price)!=null?Ye:m.unitPrice)!=null?te:null,ee=Number(E);let he=Number.isFinite(ee)?Math.trunc(ee):null;if(he==null){const Ie=(rt=(je=m.price_delta)!=null?je:m.priceDelta)!=null?rt:null,tt=Number(Ie);Number.isFinite(tt)&&(he=G+Math.trunc(tt))}he==null&&(he=G);const le=String(Math.max(0,Math.trunc(Number(he)||0)));return{label:w,price:Math.max(0,Math.trunc(Number(he)||0)),priceDigits:le}}).filter(Boolean);return{name:q||"Bi\u1EBFn th\u1EC3",options:V}}).filter(Boolean)};useEffect(()=>{var p,u;j(N?{name:N.name||"",code:N.code||"",price:N.price||"",image:N.image||"",category:N.category||"",note:N.note||"",sort_order:N.sort_order||0,commission_percent:(u=(p=N.commission_percent)!=null?p:N.commissionPercent)!=null?u:5,variants:be(N.variants,N.price),attributes:de(N.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[N,y]);const Te=p=>{j(u=>{var V;const M=$e(u.price),G=String(M),Z=Array.isArray(u.variants)?[...u.variants]:[],q={...Z[p]||{},options:Array.isArray((V=Z[p])==null?void 0:V.options)?[...Z[p].options]:[]};return q.options=q.options.map(me=>({label:String((me==null?void 0:me.label)||""),price:M,priceDigits:G})),Z[p]=q,{...u,variants:Z}})},oe=()=>{j(p=>{const u=$e(p.price),M=String(u),Z=(Array.isArray(p.variants)?[...p.variants]:[]).map(q=>{const V=(Array.isArray(q==null?void 0:q.options)?q.options:[]).map(me=>({label:String((me==null?void 0:me.label)||""),price:u,priceDigits:M}));return{name:String((q==null?void 0:q.name)||"Bi\u1EBFn th\u1EC3"),options:V}});return{...p,variants:Z}})},[C,Oe]=React.useState(""),Je=p=>window.KTM.money.formatVNDInputDigits(p),[Fe,fe]=React.useState(""),_e=p=>{const u=window.KTM.money.nextPriceInputState(p.target.value,Fe);fe(u.digits),j({..._,price:u.price})},[xe,Le]=React.useState("");React.useEffect(()=>{N!=null&&N.image&&Le(N.image)},[N]);const Qe=async p=>{if(!(!p||!p.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:p},"L\u1ED7i x\xF3a \u1EA3nh")}catch(u){console.error("Delete cloudinary image error:",u)}},dt=async(p,u=2,M)=>{const G=u*1024*1024,Z=p.type==="image/heic"||p.type==="image/heif"||/\.heic$/i.test(p.name);if(p.size<=G&&!Z)return p;M==null||M("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const q=await createImageBitmap(p);M==null||M("\u0110ang n\xE9n \u1EA3nh...");const V=document.createElement("canvas");let me=q.width,m=q.height;const w=1200;return(me>w||m>w)&&(me>m?(m=Math.round(m/me*w),me=w):(me=Math.round(me/m*w),m=w)),V.width=me,V.height=m,V.getContext("2d").drawImage(q,0,0,me,m),q.close(),new Promise((ee,he)=>{V.toBlob(le=>{le?(M==null||M("Ho\xE0n t\u1EA5t!"),ee(new File([le],p.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):he(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(q){throw console.error("createImageBitmap error:",q),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},we=async p=>{var G,Z;const u=(G=p.target.files)==null?void 0:G[0];if(!u)return;if(!(u.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(u.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Ne(!0),Oe("\u0110ang chu\u1EA9n b\u1ECB...");try{const q=(u.size/1024/1024).toFixed(1);Oe(`File ${q}MB - \u0110ang n\xE9n...`);const V=await dt(u,2,w=>{Oe(w)}),me=(V.size/1024/1024).toFixed(1);Oe(`\u0110\xE3 n\xE9n: ${me}MB - \u0110ang upload...`);const m=await window.KTM.cloudinary.uploadImage({file:V,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});m.secure_url?(_.image&&_.image!==xe&&Qe(_.image),j(w=>({...w,image:m.secure_url})),Oe("")):(console.error("Cloudinary error:",m),alert("Upload th\u1EA5t b\u1EA1i: "+(((Z=m.error)==null?void 0:Z.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),Oe(""))}catch(q){console.error("Upload error:",q),alert("L\u1ED7i: "+q.message),Oe("")}Ne(!1),p.target.value=""},Ge=()=>{_.image&&(_.image!==xe&&Qe(_.image),j(p=>({...p,image:""})))},lt=async p=>{p.preventDefault(),re(!0),xe&&_.image&&xe!==_.image&&await Qe(xe),xe&&!_.image&&await Qe(xe),await P(_),re(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${N?"fa-edit":"fa-plus-circle"} me-2`}),N?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:J})),React.createElement("form",{onSubmit:lt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},_.image?React.createElement(React.Fragment,null,React.createElement("img",{src:_.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Ge,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Y?"fa-spinner fa-spin":"fa-camera"} me-1`}),Y?C||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:we,disabled:Y,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Y&&C&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},C))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:_.name,onChange:p=>j({..._,name:p.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:_.code,onChange:p=>j({..._,code:p.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:_.price,onChange:_e,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:_.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:p=>j({..._,commission_percent:p.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:_.category,onChange:p=>j({..._,category:p.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),T.map(p=>React.createElement("option",{key:p,value:p},p)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:_.note,onChange:p=>j({..._,note:p.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(_.attributes)?_.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(_.attributes)?_.attributes:[]).map((p,u)=>React.createElement("div",{key:u,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(p==null?void 0:p.key)||"",onChange:M=>{const G=M.target.value;j(Z=>{const q=Array.isArray(Z.attributes)?[...Z.attributes]:[];return q[u]={...q[u]||{},key:G},{...Z,attributes:q}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(p==null?void 0:p.value)||"",onChange:M=>{const G=M.target.value;j(Z=>{const q=Array.isArray(Z.attributes)?[...Z.attributes]:[];return q[u]={...q[u]||{},value:G},{...Z,attributes:q}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(p==null?void 0:p.unit)||"",onChange:M=>{const G=M.target.value;j(Z=>{const q=Array.isArray(Z.attributes)?[...Z.attributes]:[];return q[u]={...q[u]||{},unit:G},{...Z,attributes:q}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{j(M=>{const G=Array.isArray(M.attributes)?[...M.attributes]:[];return G.splice(u,1),{...M,attributes:G}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{j(p=>{const u=Array.isArray(p.attributes)?[...p.attributes]:[];return u.push({key:"",value:"",unit:""}),{...p,attributes:u}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(_.variants)?_.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(_.variants)?_.variants:[]).map((p,u)=>React.createElement("div",{key:u,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(p==null?void 0:p.name)||"",onChange:M=>{const G=M.target.value;j(Z=>{var V;const q=Array.isArray(Z.variants)?[...Z.variants]:[];return q[u]={...q[u]||{},name:G,options:Array.isArray((V=q[u])==null?void 0:V.options)?q[u].options:[]},{...Z,variants:q}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Te(u),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(p==null?void 0:p.options)||p.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{j(M=>{const G=Array.isArray(M.variants)?[...M.variants]:[];return G.splice(u,1),{...M,variants:G}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(p==null?void 0:p.options)?p.options:[]).map((M,G)=>{var Z,q;return React.createElement("div",{key:G,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(M==null?void 0:M.label)||"",onChange:V=>{const me=V.target.value;j(m=>{var le,ve,ye,qe,Ye;const w=Array.isArray(m.variants)?[...m.variants]:[],E={...w[u]||{},options:Array.isArray((le=w[u])==null?void 0:le.options)?[...w[u].options]:[]},ee=Number((ye=(ve=E.options[G])==null?void 0:ve.price)!=null?ye:0)||0,he=String((Ye=(qe=E.options[G])==null?void 0:qe.priceDigits)!=null?Ye:Math.max(0,Math.trunc(ee)));return E.options[G]={...E.options[G]||{},label:me,price:Math.max(0,Math.trunc(ee)),priceDigits:he},w[u]=E,{...m,variants:w}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Je(String((q=M==null?void 0:M.priceDigits)!=null?q:window.KTM.money.getDigits(String((Z=M==null?void 0:M.price)!=null?Z:"")))),onChange:V=>{j(me=>{var ye,qe,Ye,te,je;const m=String((qe=M==null?void 0:M.priceDigits)!=null?qe:window.KTM.money.getDigits(String((ye=M==null?void 0:M.price)!=null?ye:""))),w=window.KTM.money.nextPriceInputState(V.target.value,m),E=String((Ye=w.digits)!=null?Ye:""),ee=Number(E),he=Number.isFinite(ee)?Math.max(0,Math.trunc(ee)):0,le=Array.isArray(me.variants)?[...me.variants]:[],ve={...le[u]||{},options:Array.isArray((te=le[u])==null?void 0:te.options)?[...le[u].options]:[]};return ve.options[G]={...ve.options[G]||{},label:String(((je=ve.options[G])==null?void 0:je.label)||""),price:he,priceDigits:E},le[u]=ve,{...me,variants:le}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{j(V=>{var w;const me=Array.isArray(V.variants)?[...V.variants]:[],m={...me[u]||{},options:Array.isArray((w=me[u])==null?void 0:w.options)?[...me[u].options]:[]};return m.options.splice(G,1),me[u]=m,{...V,variants:me}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{j(M=>{var V;const G=Array.isArray(M.variants)?[...M.variants]:[],Z={...G[u]||{},options:Array.isArray((V=G[u])==null?void 0:V.options)?[...G[u].options]:[]},q=$e(M.price);return Z.options.push({label:"",price:q,priceDigits:String(q)}),G[u]=Z,{...M,variants:G}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{j(p=>{const u=$e(p.price),M=Array.isArray(p.variants)?[...p.variants]:[],G=String(u);return M.push({name:"Size",options:[{label:"S",price:u,priceDigits:G},{label:"M",price:u,priceDigits:G},{label:"L",price:u,priceDigits:G}]}),{...p,variants:M}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:oe,disabled:!Array.isArray(_.variants)||_.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:_.image,onChange:p=>j({..._,image:p.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:J,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:se,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},se?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:y,video:N,onClose:T,onSave:J}){const[P,_]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[j,se]=useState(!1),[re,Y]=useState("");useEffect(()=>{N?(_({title:N.title||"",youtube_url:`https://www.youtube.com/watch?v=${N.youtubeId}`,thumbnail_url:N.thumb||"",sort_order:N.sortOrder||0}),Y(N.thumb)):(_({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Y(""))},[N,y]);const Ne=be=>{const Te=be.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Te?Te[1]:null},$e=be=>{_({...P,youtube_url:be});const Te=Ne(be);Te&&Y(`https://img.youtube.com/vi/${Te}/hqdefault.jpg`)},de=async be=>{be.preventDefault(),se(!0),await J(P),se(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},N?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:de},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:P.youtube_url,onChange:be=>$e(be.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),re&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:re,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:P.title,onChange:be=>_({...P,title:be.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:P.sort_order,onChange:be=>_({...P,sort_order:parseInt(be.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:P.thumbnail_url,onChange:be=>_({...P,thumbnail_url:be.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:T},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:j},j?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[y,N]=useState(!1),[T,J]=useState(""),[P,_]=useState(null),[j,se]=useState("search"),[re,Y]=useState(()=>loadAdminPins()),[Ne,$e]=useState(()=>loadAdminRecent()),[de,be]=useState(null),[Te,oe]=useState(""),[C,Oe]=useState([]),[Je,Fe]=useState(null),[fe,_e]=useState(!1),[xe,Le]=useState(null),[Qe,dt]=useState(!0),[we,Ge]=useState([]),[lt,p]=useState(!1),[u,M]=useState(null),[G,Z]=useState(!1),[q,V]=useState(!1),[me,m]=useState(""),[w,E]=useState(()=>loadAdminSettings()),[ee,he]=useState(null),[le,ve]=useState([]);useEffect(()=>{const c=localStorage.getItem("ktm_admin_session");if(c)try{const D=JSON.parse(c);D.expiry>Date.now()?(N(!0),_(D.user)):localStorage.removeItem("ktm_admin_session")}catch(D){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{y&&Ie()},[y]),useEffect(()=>{const c=()=>{try{const R=document.querySelector(".admin-topbar");if(!R)return;const l=R.getBoundingClientRect(),X=Math.max(0,Math.round(l.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${X+10}px`)}catch(R){}};c(),window.addEventListener("resize",c);const D=setTimeout(c,0);return()=>{clearTimeout(D),window.removeEventListener("resize",c)}},[y,j]),useEffect(()=>{if(!y)return;const c=R=>{if(!R)return!1;const l=String(R.tagName||"").toLowerCase();return!!(l==="input"||l==="textarea"||l==="select"||R.isContentEditable)},D=R=>{if(!R||R.ctrlKey||R.metaKey||R.altKey||c(R.target))return;const l=R.key;(l==="/"||l==="N"||l==="n"||l==="Escape"||l==="j"||l==="J"||l==="k"||l==="K")&&(l==="/"&&R.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:l}})))};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[y]),useEffect(()=>{y&&$e(c=>{const D=Array.isArray(c)?c:[],R=[j,...D.filter(l=>l!==j)].slice(0,8);return saveAdminRecent(R),R})},[y]);const ye=c=>{const D=String(c||"").trim();D&&$e(R=>{const l=Array.isArray(R)?R:[],X=[D,...l.filter(z=>z!==D)].slice(0,8);return saveAdminRecent(X),X})},qe=c=>{const D=String(c||"").trim();D&&Y(R=>{const l=Array.isArray(R)?R:[],z=l.includes(D)?l.filter(Be=>Be!==D):[D,...l].slice(0,10);return saveAdminPins(z),z})};useEffect(()=>{if(!y)return;let c=!1;return(async()=>{try{const D=await fetchAdminSettingsFromServer();if(c)return;E(D),saveAdminSettings(D)}catch(D){}})(),()=>{c=!0}},[y]);const Ye=async(c,D)=>{J("");try{const R=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:c,password:D},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),l={user:R.user,token:R.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(l)),_(R.user),N(!0)}catch(R){J(R.message)}},te=()=>{localStorage.removeItem("ktm_admin_session"),N(!1),_(null),Oe([]),Fe(null)},je=(c,D="success",R=null)=>{const l=Date.now()+Math.floor(Math.random()*1e3);if(c&&typeof c=="object"){const z=c;Ge(Be=>[...Be,{id:l,message:String(z.message||""),type:String(z.type||D||"success"),actionLabel:z.actionLabel||null,onAction:typeof z.onAction=="function"?z.onAction:null,durationMs:z.durationMs||null}]);return}const X=R&&typeof R=="object"?R:null;Ge(z=>[...z,{id:l,message:String(c||""),type:String(D||"success"),actionLabel:(X==null?void 0:X.actionLabel)||null,onAction:typeof(X==null?void 0:X.onAction)=="function"?X.onAction:null,durationMs:(X==null?void 0:X.durationMs)||null}])},rt=c=>{Ge(D=>D.filter(R=>R.id!==c))},Ie=async(c=null)=>{dt(!0);try{const D=c?`${API_BASE}/api/albums?parent_id=${c}`:`${API_BASE}/api/albums?parent_id=root`,R=await window.KTM.api.getJSON(D,"L\u1ED7i t\u1EA3i danh s\xE1ch album");Oe(Array.isArray(R)?R:[])}catch(D){console.error(D),je("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}dt(!1)},tt=()=>{Le(null),_e(!0)},ut=c=>{Se(c),Z(!0)},_t=async(c,D="modal")=>{try{const R=xe&&xe.uuid;!R&&ee&&(c.parent_id=ee.uuid);const l=R?`${API_BASE}/api/albums/${xe.uuid||xe.id}`:`${API_BASE}/api/albums`;R?await window.KTM.api.putJSON(l,c,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(l,c,"L\u1ED7i t\u1EA1o"),je(R?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),D==="drawer"?(Z(!1),Le(null),Ie(ee==null?void 0:ee.uuid),R&&u&&M({...u,...c})):(_e(!1),Le(null),Ie(ee==null?void 0:ee.uuid))}catch(R){je(R.message,"danger")}},vt=c=>{Fe(c)},g=c=>{if(c==="root")ve([]),he(null),Ie(null);else if(c){const D=le.findIndex(R=>R.uuid===c.uuid);D>=0&&(ve(le.slice(0,D+1)),he(c),Ie(c.uuid))}else{const D=[...le];D.pop();const R=D[D.length-1]||null;ve(D),he(R),Ie(R==null?void 0:R.uuid)}},A=async c=>{const D=`X\xF3a folder "${c.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(D))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${c.uuid||c.id}`,"L\u1ED7i x\xF3a album"),je("\u0110\xE3 x\xF3a","success"),Ie(ee==null?void 0:ee.uuid)}catch(R){je("L\u1ED7i x\xF3a album","danger")}},Se=async c=>{c&&(p(!0),m(""),V(!1),Z(!1),M(c))},wt=()=>{p(!1),V(!1),m(""),Z(!1),M(null)},at=c=>{Z(!0)};if(!y)return React.createElement(LoginPage,{onLogin:Ye,error:T});const nt=()=>{const c=new Date,D=c.getFullYear(),R=String(c.getMonth()+1).padStart(2,"0");return`${D}-${R}`};function ct(){const[c,D]=useState(()=>{var z;return String((z=w==null?void 0:w.ship_percent)!=null?z:DEFAULT_SHIP_PERCENT)}),[R,l]=useState(!1);return useEffect(()=>{var z;D(String((z=w==null?void 0:w.ship_percent)!=null?z:DEFAULT_SHIP_PERCENT))},[w==null?void 0:w.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async z=>{z.preventDefault(),l(!0);const Be=saveAdminSettings({ship_percent:c});try{const ot=await saveAdminSettingsToServer(Be);E(ot),saveAdminSettings(ot),je("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(ot){E(Be),je("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{l(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:c,min:"0",max:"100",step:"0.01",onChange:z=>D(z.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:R},R?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function S(){const[c,D]=useState(nt()),[R,l]=useState(!0),X=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[z,Be]=useState(X),ot=useRef(new Map),ft=normalizeShipPercent(w==null?void 0:w.ship_percent),{formatNumber:Ce,formatVND:ze}=window.KTM.money,Et=async(ie,It=!1)=>{var O,h;const yt=String(ie||"").trim();if(!yt)return X();const St=`${yt}|${ft}`,s=(O=ot.current)==null?void 0:O.get(St);if(!It&&s)return s;const x=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(yt)}&ship_percent=${encodeURIComponent(ft)}`,$=await window.KTM.api.getJSON(x,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),B=$!=null&&$.stats&&($!=null&&$.meta)?$.stats:$,ae=B&&typeof B=="object"?B:X();return(h=ot.current)==null||h.set(St,ae),ae},He=async(ie=!1)=>{l(!0);try{const It=await Et(c,ie);Be(It)}catch(It){console.error("Load stats error:",It),Be(X())}finally{l(!1)}};return useEffect(()=>{He()},[c,ft]),React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:R}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>He(!0),disabled:R},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:c,onChange:ie=>D(ie.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",ft,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),Ce(z.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),Ce(z.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),Ce(z.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",Ce(z.statusCounts.paid),"/",Ce(z.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},Ce(z.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ze(z.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ze(z.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ze(z.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ze(z.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",z.avgQtyPerOrder?z.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},Ce(z.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},Ce(z.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},Ce(z.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},Ce(z.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},Ce(z.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},Ce(z.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},Ce(z.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,Ce(z.statusCounts.draft)),React.createElement("td",null,Ce(z.statusCounts.pending)),React.createElement("td",null,Ce(z.statusCounts.processing)),React.createElement("td",null,Ce(z.statusCounts.canceled)),React.createElement("td",null,Ce(z.statusCounts.done)),React.createElement("td",null,Ce(z.statusCounts.paid)),React.createElement("td",null,Ce(z.statusCounts.other)),React.createElement("td",null,Ce(z.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},z.products.slice(0,10).map(ie=>React.createElement("div",{key:ie.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},ie.product_name),React.createElement("div",{className:"text-muted small text-truncate"},ie.product_code?`#${ie.product_code} \u2022 `:"",Ce(ie.orders)," \u0111\u01A1n \u2022 ",Ce(ie.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},ze(ie.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,z.products.slice(0,10).map(ie=>React.createElement("tr",{key:ie.product_id},React.createElement("td",null,ie.product_name),React.createElement("td",null,ie.product_code||"\u2014"),React.createElement("td",null,Ce(ie.orders)),React.createElement("td",null,Ce(ie.quantity)),React.createElement("td",{className:"fw-semibold"},ze(ie.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},z.customers.slice(0,10).map(ie=>React.createElement("div",{key:ie.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},ie.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},ie.phone||"\u2014"," \u2022 ",Ce(ie.orders)," \u0111\u01A1n \u2022 ",Ce(ie.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},ze(ie.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,z.customers.slice(0,10).map(ie=>React.createElement("tr",{key:ie.key},React.createElement("td",null,ie.customer_name||"\u2014"),React.createElement("td",null,ie.phone||"\u2014"),React.createElement("td",null,Ce(ie.orders)),React.createElement("td",null,Ce(ie.quantity)),React.createElement("td",{className:"fw-semibold"},ze(ie.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},z.days.map(ie=>React.createElement("div",{key:ie.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},ie.day),React.createElement("div",{className:"text-muted small"},Ce(ie.orders)," \u0111\u01A1n \u2022 ",Ce(ie.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",Ce(ie.doneOrders)," \u2022 ",ze(ie.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},ze(ie.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,z.days.map(ie=>React.createElement("tr",{key:ie.day},React.createElement("td",null,ie.day),React.createElement("td",null,Ce(ie.orders)),React.createElement("td",null,Ce(ie.quantity)),React.createElement("td",{className:"fw-semibold"},ze(ie.revenue)),React.createElement("td",null,Ce(ie.doneOrders)),React.createElement("td",{className:"fw-semibold"},ze(ie.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:j,onMenuChange:c=>{ye(c),se(c),c==="albums"&&(he(null),ve([]),Ie(null))},onLogout:te,currentUser:P,pinnedMenus:re,recentMenus:Ne,onTogglePin:qe}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const D={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[j]||{title:"KTM Admin",icon:"fa-tractor",sub:""},R=(P==null?void 0:P.username)||(P==null?void 0:P.name)||(P==null?void 0:P.email)||"Admin",l=(()=>{if(j!=="albums")return"";const X=[];return X.push("Root"),Array.isArray(le)&&le.length>0&&X.push(...le.map(z=>z==null?void 0:z.title).filter(Boolean)),Je!=null&&Je.title&&X.push(Je.title),X.length>0?X.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${D.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},D.title),React.createElement("div",{className:"admin-page-subtitle"},l||D.sub))),React.createElement("div",{className:"admin-topbar-right"},j==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:tt,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:R},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},R)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:te,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},j==="albums"&&!Je&&React.createElement(AlbumList,{albums:C,loading:Qe,currentFolder:ee,breadcrumb:le,onSelect:vt,onCreate:tt,onEdit:ut,onDelete:A,onBack:g}),j==="search"&&React.createElement(SearchCenter,{showToast:je,onNavigate:(c,D,R)=>{se(c),c==="orders"&&D==="create"&&(be(Date.now()),oe((R==null?void 0:R.productId)||""))}}),j==="albums"&&Je&&React.createElement(AlbumDetail,{album:Je,parentAlbum:le.length>0?le[le.length-1]:null,onBack:()=>{if(Je.parentId){const c=le.findIndex(D=>D.uuid===Je.parentId);c>=0?Fe(le[c]):Fe(null)}else Fe(null)},onRefresh:()=>Ie(ee==null?void 0:ee.uuid),showToast:je,onNavigateToFolder:c=>{ve(D=>[...D,Je]),Fe(c)},onEditSubfolder:c=>{Le(c),_e(!0)}}),j==="videos"&&React.createElement(VideoList,{showToast:je}),j==="products"&&React.createElement(ProductManager,{showToast:je,settings:w}),j==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:de,autoOpenCreateProductId:Te,showToast:je}),j==="stats"&&React.createElement(S,null),j==="settings"&&React.createElement(ct,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${j==="search"?"active":""}`,onClick:c=>{c.preventDefault(),se("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${j==="albums"?"active":""}`,onClick:c=>{c.preventDefault(),se("albums"),Fe(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${j==="videos"?"active":""}`,onClick:c=>{c.preventDefault(),se("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${j==="products"?"active":""}`,onClick:c=>{c.preventDefault(),se("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${j==="orders"?"active":""}`,onClick:c=>{c.preventDefault(),se("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${j==="stats"?"active":""}`,onClick:c=>{c.preventDefault(),se("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:fe,album:xe,parentId:ee==null?void 0:ee.uuid,onClose:()=>_e(!1),onSave:_t}),React.createElement(AdminDrawer,{open:lt,title:u?u.title:"Album",subtitle:u?`${u.subfolderCount||0} subfolder \u2022 ${u.count||0} \u1EA3nh`:"",onClose:wt,footer:G?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Z(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{u&&(Le(u),_t({slug:u.id||"",title:u.title||"",description:u.description||"",cover_url:u.cover||"",parent_id:u.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):u?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(u.title),je("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>at(u)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{u&&confirm(`X\xF3a folder "${u.title}"?`)&&(A(u),wt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},G&&u?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:u.title,onChange:c=>M({...u,title:c.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:u.description,onChange:c=>M({...u,description:c.target.value})}))):u?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},u.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},u.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},u.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},u.count||0))),u.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,u.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},we.map(c=>React.createElement(Toast,{key:c.id,message:c.message,type:c.type,actionLabel:c.actionLabel,onAction:c.onAction,durationMs:c.durationMs,onClose:()=>rt(c.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:y,autoOpenCreateProductId:N,showToast:T}){const[J,P]=useState([]),[_,j]=useState(0),[se,re]=useState(!1),[Y,Ne]=useState(!1),[$e,de]=useState([]),[be,Te]=useState(!0),[oe,C]=useState(!1),[Oe,Je]=useState([]),[Fe,fe]=useState(!1),[_e,xe]=useState(""),[Le,Qe]=useState([]),[dt,we]=useState(!1),[Ge,lt]=useState(""),[p,u]=useState(!1),[M,G]=useState(null),[Z,q]=useState(null),[V,me]=useState(!1),[m,w]=useState(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`}),[E,ee]=useState(""),[he,le]=useState(!1),[ve,ye]=useState(!1),[qe,Ye]=useState(!1),[te,je]=useState(null),[rt,Ie]=useState(!1),[tt,ut]=useState(""),[_t,vt]=useState(!1),g=useRef(0),[A,Se]=useState(null),[wt,at]=useState(!1),[nt,ct]=useState([]),[S,c]=useState(!1),[D,R]=useState([]),[l,X]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[z,Be]=useState([""]),[ot,ft]=useState(null),Ce=useRef({}),[ze,Et]=useState([]),[He,ie]=useState(null),It=useRef(null),yt=useRef(null),St=useRef(0),s=useRef(null),x=useRef(0),$=useRef(new Map),B=useRef(null),ae=useRef(0),O=useRef(new Map),h=useRef(new Map),W=useRef(""),ge=useRef(null),ue=useRef(null),ne=useRef(0),ke=useRef(null),st=9,We=150,bt=250,Mt=3*60*1e3,xt=24*60*60*1e3,kt=5*60*1e3,Vt="ktm_customer_lookup_cache_v1",Ka=200,Kt=3,Pt=3,ea=1,ka=24*60*60*1e3,Sa=120,Ca=5*60*1e3,L=80,F=2,U=4,ce=60,K=React.useMemo(()=>String(_e||"").trim().length>0,[_e]),pe=e=>String(e||"").replace(/\s+/g," ").trim(),Ee=e=>String(e||"").replace(/[^0-9]+/g,""),De=e=>{try{const a=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(a))return 0;const t=Date.now()-a;return!Number.isFinite(t)||t<=0?0:Math.floor(t/ka)}catch(a){return 0}},Ue=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:De(e)>=Kt,it=e=>{const a=String(e!=null?e:"").trim().toLowerCase();return a==="cancelled"?"canceled":a},mt=e=>{if(it(e==null?void 0:e.status)!=="draft")return null;const t=Pt-De(e);return Number.isFinite(t)?t:null},gt=e=>{const a=mt(e);return Number.isFinite(a)?a>0&&a<=ea:!1},ht=e=>{X({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Be([""]),Se(null),ft(null)};useEffect(()=>{const e=a=>{var n;if(ot==null)return;const t=(n=Ce.current)==null?void 0:n[ot];t&&!t.contains(a.target)&&ft(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ot]);const Ct=e=>window.KTM.money.parseMoney(e),At=e=>window.KTM.money.parseSignedMoney(e),Re=e=>window.KTM.money.formatVND(e),pt=e=>{const t=(Array.isArray(e)?e:[]).map(n=>{var r,o;return{amount:String((r=n==null?void 0:n.amount)!=null?r:""),note:String((o=n==null?void 0:n.note)!=null?o:"")}});return t.length?t:[{amount:"",note:""}]},Ot=e=>{try{const a=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(a)?a:[]).map(n=>{var r,o;return{amount:(n==null?void 0:n.amount)===0?"":String((r=n==null?void 0:n.amount)!=null?r:""),note:String((o=n==null?void 0:n.note)!=null?o:"").trim()}}).filter(n=>String(n.amount||"").trim()||String(n.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(a){return[{amount:"",note:""}]}},$t=e=>(Array.isArray(e)?e:[]).map(t=>({amount:At(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),Ft=e=>{const a=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=$t(a),n=qt(t),r=(()=>{if(!t.length)return"";const o=t.map(v=>String((v==null?void 0:v.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:n,summaryText:r}},qt=e=>(Array.isArray(e)?e:[]).reduce((t,n)=>t+(Number(n==null?void 0:n.amount)||0),0),ta=e=>{const a=Array.isArray(e)?e:[];return a.length?JSON.stringify(a):""},Aa=e=>window.KTM.money.parseShipFeeFromNote(e),Ut=e=>window.KTM.phone.isValid(e),Ze=e=>window.KTM.phone.normalize(e),Pa=async e=>{if(!e)return null;const a=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return a&&typeof a=="object"&&a.order&&typeof a.order=="object"?a.order:a},sn=(e,a)=>{var o;const t=Array.isArray(e)?e:[],n=Array.isArray(a)?a:[];if(!t.length)return n;if(!n.length)return t;const r=new Map(t.map(v=>{var d;return[String((d=v==null?void 0:v.id)!=null?d:""),v]}));for(const v of n){const d=String((o=v==null?void 0:v.id)!=null?o:"");d&&r.set(d,v)}return Array.from(r.values())},la=async e=>{if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const a=await Pa(e.id);if(a&&typeof a=="object")return P(t=>Array.isArray(t)?t.map(n=>String(n==null?void 0:n.id)===String(e.id)?a:n):t),a}catch(a){console.error("Fetch order by id error:",a)}return e},rn=()=>{var e;try{const a=localStorage.getItem(Vt);if(!a)return;const t=JSON.parse(a);if(!t||typeof t!="object")return;const n=Object.entries(t);for(const[r,o]of n)!r||!o||typeof o!="object"||(e=h.current)==null||e.set(String(r),o)}catch(a){}},_a=()=>{try{const e=h.current;if(!e||typeof e.entries!="function")return;const a=Array.from(e.entries()).filter(([n,r])=>n&&r&&typeof r=="object"&&Number.isFinite(r.ts)).sort((n,r)=>(Number(r[1].ts)||0)-(Number(n[1].ts)||0)).slice(0,Ka),t={};for(const[n,r]of a)t[n]=r;localStorage.setItem(Vt,JSON.stringify(t))}catch(e){}};useEffect(()=>{rn()},[]);const Fa=e=>{const a=Ze(e);if(!a)return null;const t=Array.isArray(J)?J:[];let n=null,r=-1;for(const o of t){if(!o||Ze(o.phone||"")!==a)continue;const v=new Date(o.created_at).getTime(),d=Number.isFinite(v)?v:0;d>=r&&(r=d,n=o)}return n?{name:String(n.customer_name||"").trim(),address:String(n.address||"").trim()}:null},qa=(e,a)=>{e&&X(t=>a&&Ze(t.phone)!==a?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},on=e=>{const a=Fa(e);if(!a)return;const t=Ze(e);X(n=>{if(t&&Ze(n.phone)!==t)return n;const r={...n};return!String(n.customer_name||"").trim()&&a.name&&(r.customer_name=a.name),!String(n.address||"").trim()&&a.address&&(r.address=a.address),r})},ln=(e,a,t)=>{var n;try{const r=Ze(e);if(!r)return;const o=String(a||"").trim(),v=String(t||"").trim();if(!o&&!v)return;(n=h.current)==null||n.set(r,{ts:Date.now(),status:"found",customer:{phone:r,name:o||null,address:v||null}}),_a()}catch(r){}},ca=async e=>{var r,o,v;const a=Ze(e);if(!a)return;on(a);const t=(r=h.current)==null?void 0:r.get(a);if(t&&Number.isFinite(t.ts)){const d=Date.now()-t.ts,k=t.status==="found"?xt:kt;if(d>=0&&d<=k){Se({status:t.status,phone:a,customer:t.customer}),t.status==="found"&&t.customer&&qa(t.customer,a);return}}const n=++St.current;Se({status:"loading",phone:a});try{const d=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(a)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(St.current!==n)return;if(d&&d.exists&&d.customer){(o=h.current)==null||o.set(a,{ts:Date.now(),status:"found",customer:d.customer}),_a(),Se({status:"found",phone:a,customer:d.customer}),qa(d.customer,a);return}(v=h.current)==null||v.set(a,{ts:Date.now(),status:"not-found",customer:null}),_a(),Se({status:"not-found",phone:a})}catch(d){if(St.current!==n)return;console.error("Customer lookup error:",d),Se({status:"error",phone:a})}},Ha=e=>{const a=Ze(e),t=Fa(a);X(r=>{const o={...r,phone:a};return t&&(!String(r.customer_name||"").trim()&&t.name&&(o.customer_name=t.name),!String(r.address||"").trim()&&t.address&&(o.address=t.address)),o}),at(!1),yt.current&&(clearTimeout(yt.current),yt.current=null);const n=a;if(n.length<st){Se(null);return}if(Ut(n)&&n!==W.current){W.current=n,ca(n);return}yt.current=setTimeout(()=>{const r=Ze(a);Ut(r)&&r!==W.current&&(W.current=r,ca(r))},We)},Va=()=>{const e=Ze(l.phone);e.length<st||Ut(e)&&e!==W.current&&(W.current=e,ca(e))};useEffect(()=>(ve?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[ve]);const da=Array.isArray(l.items)?l.items.length:0;useEffect(()=>{if(!ve){ne.current=da;return}da>ne.current&&setTimeout(()=>{const e=ge.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),ne.current=da},[ve,da]),useEffect(()=>()=>{yt.current&&(clearTimeout(yt.current),yt.current=null),s.current&&(clearTimeout(s.current),s.current=null)},[]),useEffect(()=>{if(!ve)return;s.current&&(clearTimeout(s.current),s.current=null);const e=Ze((l==null?void 0:l.phone)||"");if(!Ut(e)){ct([]),c(!1);return}return s.current=setTimeout(async()=>{var r;const a=String(e),t=(r=$.current)==null?void 0:r.get(a);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=Mt){ct(Array.isArray(t.orders)?t.orders:[]),c(!1);return}const n=++x.current;c(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,v=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(x.current!==n)return;const d=Array.isArray(v)?v:Array.isArray(v==null?void 0:v.orders)?v.orders:[];ct(d);try{const k=$.current;if(k&&typeof k.set=="function"&&(k.set(a,{ts:Date.now(),orders:d}),k.size>100)){const b=Array.from(k.entries()).sort((f,I)=>{var Q,H;return(Number((Q=f==null?void 0:f[1])==null?void 0:Q.ts)||0)-(Number((H=I==null?void 0:I[1])==null?void 0:H.ts)||0)}),i=Math.max(0,b.length-100);for(let f=0;f<i;f++)k.delete(b[f][0])}}catch(k){}}catch(o){if(x.current!==n)return;console.error("Phone history fetch error:",o),ct([])}finally{if(x.current!==n)return;c(!1)}},bt),()=>{s.current&&(clearTimeout(s.current),s.current=null)}},[ve,l==null?void 0:l.phone]),useEffect(()=>{cn()},[]),useEffect(()=>{K||Jt()},[m,K]),useEffect(()=>{ba()},[]),useEffect(()=>{y&&It.current!==y&&(It.current=y,Ta(N))},[y]);const Ht=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",aa=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",Ba=React.useMemo(()=>window.KTM.orders.sortOrders(J),[J]),Ma=React.useMemo(()=>window.KTM.orders.sortOrders($e),[$e]),ma=React.useMemo(()=>{const a=(Array.isArray(Ma)?Ma:[]).filter(t=>Ue(t));return a.sort((t,n)=>{const r=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(o)?o:0)}),a},[Ma]),za=React.useMemo(()=>{const a=(Array.isArray(Oe)?Oe:[]).filter(t=>gt(t));return a.sort((t,n)=>{const r=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(n==null?void 0:n.created_at).getTime();return(Number.isFinite(r)?r:0)-(Number.isFinite(o)?o:0)}),a},[Oe]),na=React.useMemo(()=>he?ma:Ba,[he,ma,Ba]),ua=React.useMemo(()=>{if(he)return na;const e=String(E||"").trim();return e?(Array.isArray(na)?na:[]).filter(a=>String((a==null?void 0:a.status)||"").trim()===e):na},[na,E,he]),Ja=React.useMemo(()=>window.KTM.orders.sortOrders(Le),[Le]),Dt=React.useMemo(()=>K?Ja:ua,[ua,K,Ja]),Bt=React.useMemo(()=>{const e=Array.isArray(Dt)?Dt:[],a={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const n=it(t==null?void 0:t.status);n==="draft"?a.draft+=1:n==="pending"?a.pending+=1:n==="processing"?a.processing+=1:n==="done"?a.done+=1:n==="paid"?a.paid+=1:n==="canceled"?a.canceled+=1:a.other+=1}return a},[Dt]),Ga=React.useMemo(()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${a}-${t}`},[]),pa=e=>{if(K&&xe(""),e==="thisMonth"){le(!1),ee(""),w(Ga);return}if(e==="overduePending"){w(""),le(!0),ee("pending");return}if(e==="draftExpiring"){le(!1),ee("draft"),w(""),ba();return}if(e==="all"){le(!1),ee(""),w(Ga);return}},Xt=e=>window.KTM.date.formatDateTime(e),cn=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Et(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Et([])}},Jt=async()=>{Te(!0),Ne(!1);try{const a=new URLSearchParams;m&&a.set("month",String(m)),a.set("includeItems","0"),a.set("meta","1"),a.set("limit",String(ce)),a.set("offset","0");const t=`${API_BASE}/api/orders?${a.toString()}`,n=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),r=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.orders)?n.orders:[],o=!Array.isArray(n)&&n&&typeof n=="object"&&n.meta||null;P(Array.isArray(r)?r:[]),j(Array.isArray(r)?r.length:0),re(!!(o!=null&&o.hasMore)),ba()}catch(a){console.error("Load orders error:",a),P([]),j(0),re(!1)}finally{Te(!1),Ne(!1)}},dn=async()=>{if(!(be||Y||K)&&se){Ne(!0);try{const e=new URLSearchParams;m&&e.set("month",String(m)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(ce)),e.set("offset",String(_));const a=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(a,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),n=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],r=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;P(o=>sn(o,Array.isArray(n)?n:[])),j(o=>o+(Array.isArray(n)?n.length:0)),re(!!(r!=null&&r.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{Ne(!1)}}},Wa=async e=>{var r;const a=pe(e);if(!a){Qe([]),lt(""),we(!1);return}const t=Ee(a);if(a.length<F&&t.length<U){Qe([]),lt(`Nh\u1EADp \xEDt nh\u1EA5t ${F} k\xFD t\u1EF1 (ho\u1EB7c ${U} s\u1ED1) \u0111\u1EC3 search nhanh`),we(!1);return}try{const o=(r=O.current)==null?void 0:r.get(a);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=Ca){Qe(Array.isArray(o.results)?o.results:[]),lt(""),we(!1);return}}catch(o){}const n=++ae.current;we(!0),lt("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(a)}`,v=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(ae.current!==n)return;const d=Array.isArray(v)?v:[];Qe(d);try{const k=O.current;if(k&&typeof k.set=="function"&&(k.set(a,{ts:Date.now(),results:d}),k.size>L)){const b=Array.from(k.entries()).sort((f,I)=>{var Q,H;return(Number((Q=f==null?void 0:f[1])==null?void 0:Q.ts)||0)-(Number((H=I==null?void 0:I[1])==null?void 0:H.ts)||0)}),i=Math.max(0,b.length-L);for(let f=0;f<i;f++)k.delete(b[f][0])}}catch(k){}}catch(o){if(ae.current!==n)return;console.error("Order search error:",o),Qe([]),lt((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if(ae.current!==n)return;we(!1)}};useEffect(()=>{B.current&&(clearTimeout(B.current),B.current=null);const e=pe(_e);if(!e){Qe([]),lt(""),we(!1);return}return he&&le(!1),B.current=setTimeout(()=>{Wa(e)},Sa),()=>{B.current&&(clearTimeout(B.current),B.current=null)}},[_e]);const ba=async()=>{C(!0),fe(!0);try{const[e,a]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Kt)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(ea)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);de(Array.isArray(e)?e:[]),Je(Array.isArray(a)?a:[])}catch(e){console.error("Load all orders error:",e),de([]),Je([])}finally{C(!1),fe(!1)}},$a=async e=>{const a=await la(e);if(!a)return;ie(a.id);const t=Array.isArray(a.items)&&a.items.length?a.items.map(d=>{var k,b,i,f;return{product_id:(d==null?void 0:d.product_id)||"",quantity:Number((k=d==null?void 0:d.quantity)!=null?k:1)||1,unit_price:(()=>{var H;const I=(H=d==null?void 0:d.unit_price)!=null?H:d==null?void 0:d.unitPrice,Q=I==null||I===""?NaN:Number(I);return Number.isFinite(Q)?Math.trunc(Q):null})(),variant:String((b=d==null?void 0:d.variant)!=null?b:"").trim(),variant_json:(f=(i=d==null?void 0:d.variant_json)!=null?i:d==null?void 0:d.variantJson)!=null?f:null}}).filter(d=>d.product_id):[{product_id:a.product_id||"",quantity:Number(a.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],n=Ot(a),r=$t(n),o=qt(r),v=ta(r);X({customer_name:a.customer_name||"",phone:Ze(a.phone||""),address:a.address||"",note:(a==null?void 0:a.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:n,adjustment_amount:o,adjustment_note:v||(a==null?void 0:a.adjustment_note)||"",status:a.status||"pending"}),Be(new Array(t.length?t.length:1).fill("")),R(new Array(t.length?t.length:1).fill(!0)),Se(null),ye(!1),je(a),Ye(!0),ut(""),Ie(!1),vt(!0),a.phone&&ca(Ze(a.phone))},ha=async e=>{if(!e)return;Ye(!0),ut(""),Ie(!0),vt(!1),je(e);const a=++g.current;try{const t=await la(e);if(g.current!==a)return;je(t||e)}catch(t){if(g.current!==a)return;ut((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if(g.current!==a)return;Ie(!1)}},mn=()=>{p||V||(Ye(!1),Ie(!1),ut(""),vt(!1),ie(null),ht(""),at(!1),R([]))};function Ta(e){Ye(!1),vt(!1),Ie(!1),ut(""),ie(null),ht(e||""),at(!1),R([]),ye(!0)}const ja=()=>{p||V||(ye(!1),ie(null),ht(""),at(!1),R([]))},Ua=async()=>{var d,k,b;if(!He||V||p)return;const e=(Array.isArray(J)?J:[]).find(i=>String(i==null?void 0:i.id)===String(He))||null,a=String((e==null?void 0:e.status)||(l==null?void 0:l.status)||"").trim();if(a==="done"||a==="paid"||a==="canceled"){const i="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof T=="function"?T(i,"warning"):alert(i);return}const t=Ze(l.phone),r=(Array.isArray(l.items)?l.items:[]).map((i,f)=>{var I,Q;return{idx:f,product_id:String((i==null?void 0:i.product_id)||"").trim(),quantity:Number((I=i==null?void 0:i.quantity)!=null?I:0),variant:String((i==null?void 0:i.variant)||"").trim()||null,variant_json:(Q=i==null?void 0:i.variant_json)!=null?Q:null,unit_price:(()=>{const H=i==null?void 0:i.unit_price,Me=H===""||H==null?NaN:Number(H);if(Number.isFinite(Me))return Math.max(0,Math.trunc(Me));const Ae=Tt(i==null?void 0:i.product_id),et=i!=null&&i.variant_json&&typeof i.variant_json=="object"?i.variant_json:null;return Qt(Ae,et)})()}}).filter(i=>i.product_id&&Number.isFinite(i.quantity)&&i.quantity>0);if(r.length<2){const i="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof T=="function"?T(i,"warning"):alert(i);return}const o=[],v=[];for(const i of r){const f=!!D[i.idx],I={product_id:i.product_id,quantity:i.quantity,unit_price:i.unit_price,variant:i.variant,variant_json:i.variant_json};f?o.push(I):v.push(I)}if(!o.length||!v.length){const i="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof T=="function"?T(i,"warning"):alert(i);return}me(!0);try{const i=Array.isArray(l==null?void 0:l.adjustment_items)?l.adjustment_items:[],f=$t(i),I=qt(f),Q=ta(f),H={customer_name:l.customer_name,phone:t,address:l.address,note:(l.note||"").trim(),adjustment_amount:I,adjustment_note:Q,adjustment_items:f,status:"processing",items:o,product_id:o[0].product_id,quantity:o[0].quantity,split_seq:1},Me=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,H,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),Ae=(b=(k=Me==null?void 0:Me.id)!=null?k:(d=Me==null?void 0:Me.order)==null?void 0:d.id)!=null?b:null;if(!Ae)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const et={id:He,customer_name:l.customer_name,phone:t,address:l.address,note:(l.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:v,product_id:v[0].product_id,quantity:v[0].quantity,parent_order_id:String(Ae),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${He}`,et,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),ja(),Jt();const Ke=Ae?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${Ae}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof T=="function"?T(Ke,"success"):alert(Ke)}catch(i){console.error(i);const f=(i==null?void 0:i.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof T=="function"?T(f,"danger"):alert(f)}finally{me(!1)}},Xa=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const a=String(e),t=ze.find(n=>String(n==null?void 0:n.id)===a);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Rt=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(a){return String(e!=null?e:"").toLowerCase()}},un=e=>{const t=Rt(e).trim().split(/\s+/).filter(Boolean),n=t.join(" ");return{contentTokens:t,cleanedQuery:n}},Qa=React.useMemo(()=>(Array.isArray(ze)?ze:[]).map((e,a)=>{var b,i,f,I,Q,H;const t=Rt((b=e==null?void 0:e.name)!=null?b:""),n=Rt((i=e==null?void 0:e.code)!=null?i:""),r=Rt((f=e==null?void 0:e.category)!=null?f:""),o=Rt((I=e==null?void 0:e.note)!=null?I:""),v=Rt((Q=e==null?void 0:e.id)!=null?Q:""),d=Rt((H=e==null?void 0:e.stt)!=null?H:""),k=`${t} ${n} ${r} ${o} ${v} ${d}`.trim();return{p:e,originalIndex:a,name:t,code:n,category:r,note:o,haystackAll:k}}),[ze]),pn=(e,a,t)=>{var f,I,Q,H,Me;const n=Array.isArray(a)?a:[],r=Rt(t).trim();if(!n.length&&!r)return 0;const o=(f=e==null?void 0:e.name)!=null?f:"",v=(I=e==null?void 0:e.code)!=null?I:"",d=(Q=e==null?void 0:e.category)!=null?Q:"",k=(H=e==null?void 0:e.note)!=null?H:"";if(!((Me=e==null?void 0:e.haystackAll)!=null?Me:""))return 0;let i=0;r&&(o===r&&(i+=220),o.includes(r)&&(i+=140),o.startsWith(r)&&(i+=160),v&&v===r&&(i+=180),v&&v.includes(r)&&(i+=90));for(const Ae of n){if(!Ae)continue;const et=new RegExp(`(?:^|\\s)${Ae.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(Ae)&&(i+=35),et.test(o)&&(i+=25),v&&v.includes(Ae)&&(i+=20),v&&et.test(v)&&(i+=10),d&&d.includes(Ae)&&(i+=12),k&&k.includes(Ae)&&(i+=6)}return i>0&&o&&(i+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),i},Ia=(e,a)=>{const t=String(e||""),n=String(a||"");if(t===n)return 0;if(!t)return n.length;if(!n)return t.length;const r=t.length,o=n.length;if(o>r)return Ia(n,t);let v=new Array(o+1),d=new Array(o+1);for(let k=0;k<=o;k++)v[k]=k;for(let k=1;k<=r;k++){d[0]=k;const b=t.charCodeAt(k-1);for(let f=1;f<=o;f++){const I=b===n.charCodeAt(f-1)?0:1;d[f]=Math.min(v[f]+1,d[f-1]+1,v[f-1]+I)}const i=v;v=d,d=i}return v[o]},bn=(e,a)=>{const t=String(e||"").trim(),n=String(a||"");if(!t||!n)return!1;if(n.includes(t))return!0;const r=n.split(/\s+/).filter(Boolean);if(!r.length)return!1;const o=t.length<=4?1:2;for(const v of r)if(!(Math.abs(v.length-t.length)>o)&&Ia(t,v)<=o)return!0;return!1},fa=e=>{const a=Rt(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return a?a.split(" ").filter(Boolean):[]},hn=(e,a)=>{const t=Array.isArray(a)?a:[];if(!t.length)return 0;const n=fa((e==null?void 0:e.name)||""),r=fa((e==null?void 0:e.code)||""),o=fa((e==null?void 0:e.category)||""),v=fa((e==null?void 0:e.note)||""),d=(b,i,f)=>{const I=String(b||"").trim();if(!I||!i.length)return 0;const Q=I.length<=4?1:2;let H=1/0,Me=-1;for(let Ke=0;Ke<i.length;Ke++){const jt=i[Ke];if(!jt||Math.abs(jt.length-I.length)>Q)continue;const Xe=Ia(I,jt);if(Xe<H&&(H=Xe,Me=Ke,Xe===0))break}if(H===1/0||H>Q)return 0;let et=Math.round(f*(H===0?1:H===1?.65:.45));return Me===0?et+=Math.round(f*.25):Me===1&&(et+=Math.round(f*.12)),et};let k=0;for(const b of t){if(!b)continue;const i=d(b,n,180),f=d(b,r,120),I=d(b,o,60),Q=d(b,v,30);k+=Math.max(i,f,I,Q)}if(k>0){const b=((e==null?void 0:e.name)||"").length;k+=Math.max(0,60-Math.min(60,Math.floor(b/2)))}return k},Oa=React.useRef(new Map);React.useEffect(()=>{Oa.current=new Map},[ze]);const Ya=e=>{var b,i;const a=String(z[e]||"").trim();if(!a)return ze;const{contentTokens:t,cleanedQuery:n}=un(a);if(t.length===0)return ze;const r=Rt(a).trim(),o=Oa.current.get(r);if(o)return o;const v=[];for(const f of Qa){const I=f.haystackAll;I&&t.some(Q=>I.includes(Q))&&v.push(f)}let d=v;if(d.length<8&&t.length>0){const f=[],I=new Set(d.map(Q=>{var H,Me;return String((Me=(H=Q.p)==null?void 0:H.id)!=null?Me:"")+":"+String(Q.originalIndex)}));for(const Q of Qa){const H=String((i=(b=Q.p)==null?void 0:b.id)!=null?i:"")+":"+String(Q.originalIndex);if(I.has(H))continue;const Me=Q.haystackAll;Me&&t.some(Ae=>bn(Ae,Me))&&(f.push(Q),I.add(H))}f.length&&(d=d.concat(f))}const k=d.map(f=>({entry:f,score:pn(f,t,n)})).map(f=>{if(f.score>0)return f;const I=hn(f.entry,t);return I>0?{...f,score:I}:f}).filter(f=>f.score>0).sort((f,I)=>I.score!==f.score?I.score-f.score:f.entry.originalIndex-I.entry.originalIndex).slice(0,40).map(f=>f.entry.p);return Oa.current.set(r,k),k},Tt=e=>{if(!e)return null;const a=String(e);return ze.find(t=>String(t==null?void 0:t.id)===a)||null},zt=e=>{if(e==null||e==="")return[];let a=e;if(typeof a=="string"){const t=a.trim();if(!t)return[];try{a=JSON.parse(t)}catch(n){return[]}}return Array.isArray(a)?a.map((t,n)=>{var v;if(!t||typeof t!="object")return null;const r=String((v=t.name)!=null?v:"").trim()||`Bi\u1EBFn th\u1EC3 ${n+1}`,o=(Array.isArray(t.options)?t.options:[]).map(d=>{var Me,Ae,et,Ke,jt,Xe,Lt;if(!d||typeof d!="object")return null;const k=String((Me=d.label)!=null?Me:"").trim();if(!k)return null;const b=(jt=(Ke=(et=(Ae=d.price)!=null?Ae:d.priceValue)!=null?et:d.unit_price)!=null?Ke:d.unitPrice)!=null?jt:null,i=b==null||b===""?NaN:typeof b=="number"?b:typeof b=="string"?Ct(b):Number(b),f=Number.isFinite(i)?Math.trunc(i):null,I=(Lt=(Xe=d.price_delta)!=null?Xe:d.priceDelta)!=null?Lt:null,Q=Number(I),H=Number.isFinite(Q)?Math.trunc(Q):0;return{label:k,price:f,price_delta:H}}).filter(Boolean);return{name:r,options:o}}).filter(Boolean):[]},kn=e=>{const a=Tt(e);return zt(a==null?void 0:a.variants)},ga=e=>{if(!e||typeof e!="object")return"";const a=[];for(const[t,n]of Object.entries(e)){const r=String(t||"").trim(),o=String(n||"").trim();!r||!o||a.push(`${r}: ${o}`)}return a.join(", ")},Qt=(e,a)=>{const t=Ct(e==null?void 0:e.price),n=zt(e==null?void 0:e.variants);if(!n.length||!a||typeof a!="object")return t;let r=t,o=!1;for(const v of n){const d=String((v==null?void 0:v.name)||"").trim(),k=String((a==null?void 0:a[d])||"").trim();if(!d||!k)continue;const b=(Array.isArray(v.options)?v.options:[]).find(H=>String((H==null?void 0:H.label)||"").trim()===k);if(!b)continue;const i=b==null?void 0:b.price,f=i==null||i===""?NaN:Number(i);if(Number.isFinite(f)){r=Math.max(0,Math.trunc(f)),o=!0;continue}const I=b==null?void 0:b.price_delta,Q=I==null||I===""?NaN:Number(I);Number.isFinite(Q)&&(r+=Math.trunc(Q))}return r},Da=e=>window.KTM.orders.getOrderItems(e),Za=e=>window.KTM.orders.getOrderTotalQty(e),Yt=e=>window.KTM.orders.getOrderProductSummary(e,Tt),va=e=>window.KTM.orders.getOrderItemRows(e,Tt),sa=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Gt=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),fn=e=>{const a=Da(e),t=va(e),n=ra(a),r=ia(a),o=r.fee,v=sa(e),d=n+o+v,k=i=>{const f=Number(i)||0;return f>0?`+${Re(f)}`:Re(f)},b=[];if(e!=null&&e.customer_name&&b.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&b.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&b.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&b.push(`GHI CH\xDA: ${(e.note||"").trim()}`),b.push(""),b.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const i of t)b.push(`- ${i.name} (SL: ${i.qty})`);else{const i=Yt(e);i&&i!=="\u2014"&&b.push(`- ${i}`)}b.push(""),b.push(`T\u1EA0M T\xCDNH: ${Re(n)}`),r.found&&o!==0&&b.push(`SHIP: ${Re(o)}`);{const i=window.KTM.orders.getOrderAdjustmentItems(e),f=(Array.isArray(i)?i:[]).map(H=>{var Me;return{amount:Number((Me=H==null?void 0:H.amount)!=null?Me:0)||0,note:String((H==null?void 0:H.note)||"").trim()}}).filter(H=>H.amount!==0||!!H.note),I=Gt(e);if(v!==0||f.length>0||!!I)if(f.length===1){const H=f[0];b.push(`\u0110I\u1EC0U CH\u1EC8NH: ${k(v)}${H.note?` \u2014 ${H.note}`:""}`)}else{b.push(`\u0110I\u1EC0U CH\u1EC8NH: ${k(v)}${!f.length&&I?` \u2014 ${I}`:""}`);for(const H of f)b.push(`- ${k(H.amount)}${H.note?`: ${H.note}`:""}`)}}return b.push(`T\u1ED4NG: ${Re(d)}`),b.filter(Boolean).join(`
`)},Ra=async e=>{try{const a=await la(e),t=fn(a);await window.KTM.clipboard.writeText(t),typeof T=="function"?T("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(a){console.error(a),typeof T=="function"?T("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},ia=e=>window.KTM.orders.getOrderShipInfo(e,Tt),ra=e=>window.KTM.orders.getItemsSubtotal(e,Tt),La=e=>{try{const a=e instanceof Date?e:new Date(e);if(!a||Number.isNaN(a.getTime()))return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}catch(a){return""}},Ea=()=>m?String(m):La(new Date),en=e=>{const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Ze((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),r=Ft(e).amount,v=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(d=>{var k;return{product_id:String((d==null?void 0:d.product_id)||"").trim(),quantity:Number((k=d==null?void 0:d.quantity)!=null?k:0),variant:String((d==null?void 0:d.variant)||"").trim()}}).filter(d=>d.product_id&&Number.isFinite(d.quantity)&&d.quantity>0).sort((d,k)=>d.product_id<k.product_id?-1:d.product_id>k.product_id?1:d.variant<k.variant?-1:d.variant>k.variant?1:d.quantity-k.quantity);return JSON.stringify({name:a,phone:t,address:n,items:v,adj:r})},Nt=React.useMemo(()=>{const e=Ze((l==null?void 0:l.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ea()};const a=Ea(),n=(Array.isArray(nt)?nt:[]).filter(r=>{if(!r||He&&String(r.id)===String(He)||Ze(r.phone||"")!==e)return!1;const o=La(r.created_at);return o&&o===a}).sort((r,o)=>{const v=new Date(r.created_at).getTime(),d=new Date(o.created_at).getTime();return(Number.isFinite(d)?d:0)-(Number.isFinite(v)?v:0)});return{count:n.length,orders:n,monthKey:a}},[nt,l==null?void 0:l.phone,m,He]),gn=e=>{var d;const a=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Ze((e==null?void 0:e.phone)||""),n=String((e==null?void 0:e.address)||"").trim().toLowerCase(),r=At((d=e==null?void 0:e.adjustment_amount)!=null?d:0),o=Da(e),v=(Array.isArray(o)?o:[]).map(k=>{var b;return{product_id:String((k==null?void 0:k.product_id)||"").trim(),quantity:Number((b=k==null?void 0:k.quantity)!=null?b:0),variant:String((k==null?void 0:k.variant)||"").trim()}}).filter(k=>k.product_id&&Number.isFinite(k.quantity)&&k.quantity>0).sort((k,b)=>k.product_id<b.product_id?-1:k.product_id>b.product_id?1:k.variant<b.variant?-1:k.variant>b.variant?1:k.quantity-b.quantity);return JSON.stringify({name:a,phone:t,address:n,items:v,adj:r})},tn=React.useMemo(()=>{if(He)return"";const e=Ze((l==null?void 0:l.phone)||"");if(!e)return"";const a=Ea(),t=en(l),n=Array.isArray(nt)?nt:[];for(const r of n){if(!r||He&&String(r.id)===String(He)||Ze(r.phone||"")!==e)continue;const o=La(r.created_at);if(!o||o!==a)continue;const v=gn(r);if(v&&v===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${a}${r!=null&&r.id?` (#${r.id})`:""}`}return""},[nt,l,m,He]),an=e=>{var jt;const a=[],t=[],n=String((e==null?void 0:e.customer_name)||"").trim(),r=Ze((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim();n||a.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),r||a.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),r&&!Ut(r)&&a.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const d=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Xe=>Xe&&Xe.product_id);d.length===0&&a.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),d.some(Xe=>{var Wt;const Lt=Number((Wt=Xe==null?void 0:Xe.quantity)!=null?Wt:0);return!Number.isFinite(Lt)||Lt<=0})&&a.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const b=new Set;let i=!1;for(const Xe of d){const Lt=String(Xe.product_id||"").trim(),Wt=String((Xe==null?void 0:Xe.variant)||"").trim();if(!Lt)continue;const Ve=`${Lt}||${Wt}`;if(b.has(Ve)){i=!0;break}b.add(Ve)}i&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const f=ra(d),I=ia(d),Q=I!=null&&I.found?Number((jt=I==null?void 0:I.fee)!=null?jt:0):0,H=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],Me=$t(H),Ae=qt(Me),et=Me.some(Xe=>(Number(Xe==null?void 0:Xe.amount)||0)!==0&&!String((Xe==null?void 0:Xe.note)||"").trim());I!=null&&I.found&&(Q>=2e5||f>0&&Q>f*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Re(Q)}`),et&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const Ke=Math.abs(Ae);return(Ke>=5e5||f>0&&Ke>f*.5)&&Ae!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Re(Ae)}`),{errors:a,warnings:t,canSubmit:a.length===0}},Sn=React.useMemo(()=>an(l),[l,ze]),Pe=React.useMemo(()=>{var Wt;const e=String((l==null?void 0:l.customer_name)||"").trim(),a=Ze((l==null?void 0:l.phone)||""),t=String((l==null?void 0:l.address)||"").trim(),n=Array.isArray(l==null?void 0:l.items)?l.items:[],r=new Map;for(const Ve of n){const Zt=String((Ve==null?void 0:Ve.product_id)||"").trim(),wa=String((Ve==null?void 0:Ve.variant)||"").trim();if(!Zt)continue;const xa=`${Zt}||${wa}`;r.set(xa,(r.get(xa)||0)+1)}const o=n.map(Ve=>{var nn;const Zt=String((Ve==null?void 0:Ve.product_id)||"").trim(),wa=Number((nn=Ve==null?void 0:Ve.quantity)!=null?nn:0),xa=Zt?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",yn=Number.isFinite(wa)&&wa>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",Nn=String((Ve==null?void 0:Ve.variant)||"").trim(),wn=`${Zt}||${Nn}`,xn=Zt&&(r.get(wn)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:xa,qtyError:yn,dupWarn:xn}}),v=n.filter(Ve=>Ve&&Ve.product_id),d=ra(v),k=ia(v),b=k!=null&&k.found?Number((Wt=k==null?void 0:k.fee)!=null?Wt:0):0,i=Array.isArray(l==null?void 0:l.adjustment_items)?l.adjustment_items:[],f=$t(i),I=qt(f),Q=f.some(Ve=>(Number(Ve==null?void 0:Ve.amount)||0)!==0&&!String((Ve==null?void 0:Ve.note)||"").trim()),H=Math.abs(I),Me=Q?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",Ae=I!==0&&(H>=5e5||d>0&&H>d*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Re(I)}`:"",et=k!=null&&k.found&&(b>=2e5||d>0&&b>d*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Re(b)}`:"",Ke=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",jt=a?Ut(a)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Xe=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Lt=!Ke&&!jt&&o.every(Ve=>!Ve.productError&&!Ve.qtyError);return{nameError:Ke,phoneError:jt,addressWarn:Xe,items:o,shipAbnormalWarn:et,adjustmentNoteWarn:Me,adjustmentAbnormalWarn:Ae,canSubmit:Lt}},[l,ze]),ya=async e=>{var d,k,b;const a=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",n=an(l);if(!n.canSubmit){const i=n.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof T=="function"?T(i,"danger"):alert(i);return}if(!He&&tn){const i=`${tn}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(i)){(Nt==null?void 0:Nt.count)>0&&at(!0),setTimeout(()=>{var Q;const I=document.getElementById("order-phone-input");I&&typeof I.scrollIntoView=="function"&&(I.scrollIntoView({block:"center",behavior:"smooth"}),(Q=I.focus)==null||Q.call(I))},0);return}}const r=Ze(l.phone),v=(Array.isArray(l.items)?l.items:[]).map(i=>{var f,I;return{product_id:(i==null?void 0:i.product_id)||"",quantity:Number((f=i==null?void 0:i.quantity)!=null?f:1),variant:String((i==null?void 0:i.variant)||"").trim()||null,variant_json:(I=i==null?void 0:i.variant_json)!=null?I:null,unit_price:(()=>{const Q=i==null?void 0:i.unit_price,H=Q===""||Q==null?NaN:Number(Q);if(Number.isFinite(H))return Math.max(0,Math.trunc(H));const Me=Tt(i==null?void 0:i.product_id),Ae=i!=null&&i.variant_json&&typeof i.variant_json=="object"?i.variant_json:null;return Qt(Me,Ae)})()}}).filter(i=>i.product_id&&Number.isFinite(i.quantity)&&i.quantity>0);u(!0);try{const i=He,f=He?`${API_BASE}/api/orders/${He}`:`${API_BASE}/api/orders`,I=v[0],Q=Array.isArray(l==null?void 0:l.adjustment_items)?l.adjustment_items:[],H=$t(Q),Me=qt(H),Ae=ta(H),et={customer_name:l.customer_name,phone:r,address:l.address,note:(l.note||"").trim(),adjustment_amount:Me,adjustment_note:Ae,adjustment_items:H,product_id:I.product_id,quantity:I.quantity,status:l.status,items:v,...He?{id:He}:{}};if(He)await window.KTM.api.putJSON(f,et,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const Ke=await window.KTM.api.postJSON(f,et,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");ke.current={id:(b=(k=Ke==null?void 0:Ke.id)!=null?k:(d=Ke==null?void 0:Ke.order)==null?void 0:d.id)!=null?b:null,fingerprint:en(l),ts:Date.now()}}if(ln(r,l.customer_name,l.address),t==="drawer"){if(ht(""),ie(null),ye(!1),vt(!1),at(!1),R([]),Jt(),i){Ie(!0),ut("");try{const Ke=await Pa(i);Ke&&typeof Ke=="object"&&je(Ke)}catch(Ke){ut((Ke==null?void 0:Ke.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Ie(!1)}}}else a==="new"&&!He?(ht(""),ie(null),ye(!0)):(ht(""),ie(null),ye(!1)),Jt()}catch(i){console.error(i),typeof T=="function"?T(i.message,"danger"):alert(i.message);return}finally{u(!1)}},oa=e=>window.KTM.orders.getOrderTotalMoney(e,Tt),Cn=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){G(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Jt(),ba()}catch(a){console.error(a),typeof T=="function"?T(a.message,"danger"):alert(a.message)}finally{G(null)}}},Na=async(e,a)=>{var o;const t=await la(e),n=t==null?void 0:t.id;if(!n||!a)return;const r=it(t==null?void 0:t.status);q(n);try{const v=Da(t),d=(Array.isArray(v)?v:[]).map(i=>{var f,I;return{product_id:(i==null?void 0:i.product_id)||"",quantity:Number((f=i==null?void 0:i.quantity)!=null?f:1),variant:String((i==null?void 0:i.variant)||"").trim()||null,variant_json:(I=i==null?void 0:i.variant_json)!=null?I:null,unit_price:(()=>{var Me;const Q=(Me=i==null?void 0:i.unit_price)!=null?Me:i==null?void 0:i.unitPrice,H=Number(Q);return Number.isFinite(H)?Math.max(0,Math.trunc(H)):null})()}}).filter(i=>i.product_id&&Number.isFinite(i.quantity)&&i.quantity>0);if(!d.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const k=d[0],b={id:n,customer_name:(t==null?void 0:t.customer_name)||"",phone:Ze((t==null?void 0:t.phone)||""),address:(t==null?void 0:t.address)||"",note:((t==null?void 0:t.note)||"").trim(),adjustment_amount:Number((o=t==null?void 0:t.adjustment_amount)!=null?o:0)||0,adjustment_note:(t==null?void 0:t.adjustment_note)||"",product_id:k.product_id,quantity:k.quantity,status:a,items:d};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${n}`,b,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),P(i=>Array.isArray(i)?i.map(f=>(f==null?void 0:f.id)===n?{...f,status:a}:f):i),de(i=>Array.isArray(i)?i.map(f=>(f==null?void 0:f.id)===n?{...f,status:a}:f):i),typeof T=="function"){const i=`${Ht(r)} \u2192 ${Ht(a)}`.trim();T(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${i}`,"success",{actionLabel:"Undo",durationMs:6500,onAction:()=>{!r||r===it(a)||Na({...t,status:a},r)}})}}catch(v){console.error(v),typeof T=="function"?T(v.message,"danger"):alert(v.message)}finally{q(null)}};useEffect(()=>{const e=a=>{var n;const t=(n=a==null?void 0:a.detail)==null?void 0:n.key;if(t){if(t==="/"){setTimeout(()=>{var r,o;(o=(r=ue.current)==null?void 0:r.focus)==null||o.call(r)},0);return}if(t==="N"||t==="n"){Ta();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&qe&&(te!=null&&te.id)){const r=Array.isArray(Dt)?Dt:[],o=r.findIndex(k=>String(k==null?void 0:k.id)===String(te==null?void 0:te.id));if(o<0)return;const d=r[o+(t==="j"||t==="J"?-1:1)];d&&ha(d)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[Dt,qe,te]);const vn=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:l.customer_name,onChange:e=>X({...l,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Pe.nameError&&React.createElement("div",{className:"form-text text-danger"},Pe.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:l.phone,onChange:e=>Ha(e.target.value),onBlur:Va,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Pe.phoneError&&React.createElement("div",{className:"form-text text-danger"},Pe.phoneError),!Pe.phoneError&&Nt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Nt.count," \u0111\u01A1n trong th\xE1ng ",Nt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>at(e=>!e)},wt?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),wt&&Nt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>at(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Nt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${aa(e.status)}`},Ht(e.status))),React.createElement("div",{className:"text-muted small"},Xt(e.created_at)," \u2022 ",Re(oa(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Yt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&$a(e)}},"M\u1EDF")))),Nt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(A==null?void 0:A.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(A==null?void 0:A.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(A==null?void 0:A.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(A==null?void 0:A.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:l.status,onChange:e=>X({...l,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:l.address,onChange:e=>X({...l,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Pe.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Pe.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:l.note,onChange:e=>X({...l,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},pt(l.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;X(r=>{const o=pt(r.adjustment_items);return o[a]={...o[a],amount:n},{...r,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;X(r=>{const o=pt(r.adjustment_items);return o[a]={...o[a],note:n},{...r,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{X(t=>{const n=pt(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:p||pt(l.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Pe.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Pe.adjustmentAbnormalWarn),!!Pe.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Pe.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Be(e=>[...Array.isArray(e)?e:[],""]),He&&R(e=>[...Array.isArray(e)?e:[],!0])},disabled:p},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(l.items)?l.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Ce.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{ft(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Xa(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ot===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:z[a]||"",onChange:t=>{const n=t.target.value;Be(r=>{const o=Array.isArray(r)?[...r]:[];return o[a]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=Ya(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(n.id),o=zt(n==null?void 0:n.variants),v={};for(const b of o){const i=String((b==null?void 0:b.name)||"").trim(),f=Array.isArray(b==null?void 0:b.options)?b.options[0]:null,I=String((f==null?void 0:f.label)||"").trim();i&&I&&(v[i]=I)}const d=ga(v),k=Qt(n,v);X(b=>{const i=Array.isArray(b.items)?[...b.items]:[];return i[a]={...i[a]||{quantity:1},product_id:r,variant_json:Object.keys(v).length?v:null,variant:d,unit_price:o.length?k:null},{...b,items:i}}),ft(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),ze.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Pe.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Tt(e.product_id),n=zt(t==null?void 0:t.variants);if(!n.length)return null;const r=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,v)=>{const d=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${v+1}`).trim(),k=String((r==null?void 0:r[d])||"").trim();return React.createElement("div",{key:d},React.createElement("label",{className:"form-label small text-muted mb-1"},d),React.createElement("select",{className:"form-select",value:k,onChange:b=>{const i=String(b.target.value||"").trim();X(f=>{const I=Array.isArray(f.items)?[...f.items]:[],Q={...I[a]||{}},H=Tt(Q.product_id),Me=zt(H==null?void 0:H.variants),Ae=Q!=null&&Q.variant_json&&typeof Q.variant_json=="object"?{...Q.variant_json}:{};i?Ae[d]=i:delete Ae[d];const et=ga(Ae),Ke=Qt(H,Ae);return I[a]={...Q,variant_json:Object.keys(Ae).length?Ae:null,variant:et,unit_price:Ke},{...f,items:I}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",d," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(b=>React.createElement("option",{key:b.label,value:b.label},b.label,Number.isFinite(Number(b==null?void 0:b.price))?` (${Re(Number(b.price))})`:Number(b==null?void 0:b.price_delta)?` (${b.price_delta>0?"+":""}${b.price_delta})`:""))))}))})(),He&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!D[a],onChange:t=>{const n=!!t.target.checked;R(r=>{const o=Array.isArray(r)?[...r]:[],v=Array.isArray(l.items)?l.items.length:0;for(;o.length<v;)o.push(!0);return o[a]=n,o})},disabled:p||V}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;X(r=>{const o=Array.isArray(r.items)?[...r.items]:[];return o[a]={...o[a]||{product_id:""},quantity:n},{...r,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Pe.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{X(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Be(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),R(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),ft(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:p||V||(Array.isArray(l.items)?l.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(l.items)?l.items:[]).filter(d=>d==null?void 0:d.product_id),t=ra(a),n=ia(a),r=Ft(l),o=r.amount,v=t+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Re(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Re(n.fee))),!!Pe.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Pe.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Re(o))),(l.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(l.note||"").trim()),!!r.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",r.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Re(v)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:p||!!M||!!Z}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Bt.all," \u0111\u01A1n"),K&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>K?Wa(_e):Jt(),disabled:dt,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>Ta(),disabled:p||!!M},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip ${!E&&!he&&!K?"active":""}`,onClick:()=>{K&&xe(""),le(!1),ee("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Bt.all)),React.createElement("button",{type:"button",className:`orders-chip ${E==="draft"&&!he&&!K?"active":""}`,onClick:()=>{K&&xe(""),le(!1),ee("draft"),w("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Bt.draft)),React.createElement("button",{type:"button",className:`orders-chip ${E==="pending"&&!he&&!K?"active":""}`,onClick:()=>{K&&xe(""),le(!1),ee("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Bt.pending)),React.createElement("button",{type:"button",className:`orders-chip ${E==="processing"&&!he&&!K?"active":""}`,onClick:()=>{K&&xe(""),le(!1),ee("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Bt.processing)),React.createElement("button",{type:"button",className:`orders-chip ${E==="done"&&!he&&!K?"active":""}`,onClick:()=>{K&&xe(""),le(!1),ee("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Bt.done)),React.createElement("button",{type:"button",className:`orders-chip ${E==="paid"&&!he&&!K?"active":""}`,onClick:()=>{K&&xe(""),le(!1),ee("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Bt.paid)),React.createElement("button",{type:"button",className:`orders-chip ${E==="canceled"&&!he&&!K?"active":""}`,onClick:()=>{K&&xe(""),le(!1),ee("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Bt.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>pa("thisMonth"),disabled:K},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>pa("overduePending"),disabled:K},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",Kt," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>pa("draftExpiring"),disabled:K},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp x\xF3a"),(E||he||!m&&!K)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>pa("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:ue,type:"text",className:"form-control",value:_e,onChange:e=>xe(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(_e||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>xe(""),disabled:dt},React.createElement("i",{className:"fas fa-times"})),dt&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:m,onChange:e=>w(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:he||K})),React.createElement("div",{className:"text-muted small ms-auto"},K?"Search b\u1ECF qua filter":he?"\u0110ang xem \u0111\u01A1n ch\u1EADm":E?`L\u1ECDc: ${Ht(E)}`:""))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},K?`${Dt.length} k\u1EBFt qu\u1EA3`:E?`${ua.length}/${J.length} \u0111\u01A1n`:`${J.length}${se?"+":""} \u0111\u01A1n`)),K&&Ge&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Ge),ma.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,ma.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Kt," ng\xE0y.",oe&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{le(!0),ee("pending")}},"Xem ngay")),za.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,za.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 x\xF3a (c\xF2n \u2264 ",ea," ng\xE0y).",Fe&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{le(!1),ee("draft"),w(""),Jt()}},"Xem ngay")),(K?dt:be)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,a)=>React.createElement("div",{key:a,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,a)=>React.createElement("tr",{key:a},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(K?Dt.length===0:J.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},K?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!K&&ua.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Dt.map(e=>{var a;return React.createElement("div",{key:e.id,className:"card mb-2",role:"button",tabIndex:0,onClick:()=>ha(e),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),ha(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((a=e==null?void 0:e.split_seq)!=null?a:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${aa(e.status)}`},Ht(e.status)),Ue(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Kt} ng\xE0y`},"\u26A0 Ch\u1EADm ",De(e),"d"),gt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Pt} ng\xE0y`},"\u23F3 C\xF2n ",mt(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=va(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((n,r)=>React.createElement("div",{key:r,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},r+1,"."),n.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${Re(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Yt(e))})()),(sa(e)!==0||Gt(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Re(sa(e))),Gt(e)?React.createElement("span",{className:"text-muted"}," ","(",Gt(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Re(oa(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",Xt(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),Ra(e)},disabled:p||!!M||Z===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:t=>t.stopPropagation(),onChange:t=>{t.stopPropagation();const n=String(t.target.value||"").trim();t.target.value="",n&&Na(e,n)},disabled:p||!!M||Z===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"\u0110\u1ED5i tr\u1EA1ng th\xE1i\u2026"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,Dt.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>ha(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const a=va(e);return a.length?React.createElement("div",{className:"d-grid gap-1"},a.map((t,n)=>React.createElement("div",{key:n,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},n+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Re(t.unitPrice))))):Yt(e)})()),React.createElement("td",null,Za(e)),React.createElement("td",{className:"fw-semibold"},Re(oa(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${aa(e.status)}`},Ht(e.status)),Ue(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Kt} ng\xE0y`},"\u26A0 Ch\u1EADm ",De(e),"d"),gt(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Pt} ng\xE0y`},"\u23F3 C\xF2n ",mt(e),"d"))),React.createElement("td",null,Xt(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:a=>{a.stopPropagation(),Ra(e)},disabled:p||!!M||Z===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation();const t=String(a.target.value||"").trim();a.target.value="",t&&Na(e,t)},disabled:p||!!M||Z===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!K&&se&&!he&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:dn,disabled:be||Y},Y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:qe,title:(()=>{const e=te,a=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Ht(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${a} ${t}`.trim()})(),subtitle:(()=>{const e=te,a=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),n=e!=null&&e.created_at?Xt(e.created_at):"";return[a||t||null,n||null].filter(Boolean).join(" \u2022 ")})(),onClose:mn,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},_t?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{vt(!1),ie(null),ht(""),at(!1),R([])},disabled:p||V},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!He&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:Ua,disabled:p||V,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>ya({mode:"close",origin:"drawer"}),disabled:p||V||!Pe.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},p?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>te&&Ra(te),disabled:!te||rt||p||!!M},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>te&&$a(te),disabled:!te||rt||p||!!M},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const a=String(e.target.value||"").trim();e.target.value="",a&&te&&Na(te,a)},disabled:!te||rt||p||!!M||Z===(te==null?void 0:te.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},_t?React.createElement("form",{onSubmit:e=>{e.preventDefault(),ya({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),vn())):rt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):tt?React.createElement("div",{className:"alert alert-danger",role:"alert"},tt):te?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${aa(te.status)}`},Ht(te.status)),Ue(te)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Kt} ng\xE0y`},"\u26A0 Ch\u1EADm ",De(te),"d"),gt(te)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 x\xF3a sau ${Pt} ng\xE0y`},"\u23F3 C\xF2n ",mt(te),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},Re(oa(te))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},Za(te)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},Xt(te.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},te.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},te.phone||"\u2014"),!!String(te.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(te.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},te.address||"\u2014")),((te==null?void 0:te.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(te.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=va(te);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((a,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),a.name),a.variant?React.createElement("div",{className:"text-muted small"},a.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${Re(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Yt(te)||"\u2014")})(),(sa(te)!==0||Gt(te))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Re(sa(te))),Gt(te)?React.createElement("span",{className:"text-muted"}," ","(",Gt(te),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),ve&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),He?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:ja})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),ya({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:ge},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:l.customer_name,onChange:e=>X({...l,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Pe.nameError&&React.createElement("div",{className:"form-text text-danger"},Pe.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:l.phone,onChange:e=>Ha(e.target.value),onBlur:Va,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Pe.phoneError&&React.createElement("div",{className:"form-text text-danger"},Pe.phoneError),!Pe.phoneError&&Nt.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Nt.count," \u0111\u01A1n trong th\xE1ng ",Nt.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>at(e=>!e)},wt?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),wt&&Nt.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>at(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Nt.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${aa(e.status)}`},Ht(e.status))),React.createElement("div",{className:"text-muted small"},Xt(e.created_at)," \u2022 ",Re(oa(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Yt(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&$a(e)}},"M\u1EDF")))),Nt.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(A==null?void 0:A.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(A==null?void 0:A.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(A==null?void 0:A.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(A==null?void 0:A.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:l.status,onChange:e=>X({...l,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:l.address,onChange:e=>X({...l,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Pe.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Pe.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:l.note,onChange:e=>X({...l,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},pt(l.adjustment_items).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const n=t.target.value;X(r=>{const o=pt(r.adjustment_items);return o[a]={...o[a],amount:n},{...r,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const n=t.target.value;X(r=>{const o=pt(r.adjustment_items);return o[a]={...o[a],note:n},{...r,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{X(t=>{const n=pt(t.adjustment_items);return n.splice(a,1),{...t,adjustment_items:n.length?n:[{amount:"",note:""}]}})},disabled:p||pt(l.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Pe.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Pe.adjustmentAbnormalWarn),!!Pe.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Pe.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{X(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Be(e=>[...Array.isArray(e)?e:[],""]),He&&R(e=>[...Array.isArray(e)?e:[],!0])},disabled:p},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(l.items)?l.items:[{product_id:"",quantity:1}]).map((e,a)=>React.createElement("div",{key:a,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Ce.current[a]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{ft(t=>t===a?null:a),setTimeout(()=>{const t=document.getElementById(`order-product-search-${a}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Xa(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ot===a&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${a}`,className:"form-control",value:z[a]||"",onChange:t=>{const n=t.target.value;Be(r=>{const o=Array.isArray(r)?[...r]:[];return o[a]=n,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=Ya(a);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(n=>React.createElement("button",{key:n.id,type:"button",className:"dropdown-item",onClick:()=>{const r=String(n.id),o=zt(n==null?void 0:n.variants),v={};for(const b of o){const i=String((b==null?void 0:b.name)||"").trim(),f=Array.isArray(b==null?void 0:b.options)?b.options[0]:null,I=String((f==null?void 0:f.label)||"").trim();i&&I&&(v[i]=I)}const d=ga(v),k=Qt(n,v);X(b=>{const i=Array.isArray(b.items)?[...b.items]:[];return i[a]={...i[a]||{quantity:1},product_id:r,variant_json:Object.keys(v).length?v:null,variant:d,unit_price:o.length?k:null},{...b,items:i}}),ft(null)}},n.name,n.code?` (${n.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),ze.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var n;const t=(n=Pe.items)==null?void 0:n[a];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=Tt(e.product_id),n=zt(t==null?void 0:t.variants);if(!n.length)return null;const r=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},n.map((o,v)=>{const d=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${v+1}`).trim(),k=String((r==null?void 0:r[d])||"").trim();return React.createElement("div",{key:d},React.createElement("label",{className:"form-label small text-muted mb-1"},d),React.createElement("select",{className:"form-select",value:k,onChange:b=>{const i=String(b.target.value||"").trim();X(f=>{const I=Array.isArray(f.items)?[...f.items]:[],Q={...I[a]||{}},H=Tt(Q.product_id),Me=zt(H==null?void 0:H.variants),Ae=Q!=null&&Q.variant_json&&typeof Q.variant_json=="object"?{...Q.variant_json}:{};i?Ae[d]=i:delete Ae[d];const et=ga(Ae),Ke=Qt(H,Ae);return I[a]={...Q,variant_json:Object.keys(Ae).length?Ae:null,variant:et,unit_price:Ke},{...f,items:I}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",d," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(b=>React.createElement("option",{key:b.label,value:b.label},b.label,Number.isFinite(Number(b==null?void 0:b.price))?` (${Re(Number(b.price))})`:Number(b==null?void 0:b.price_delta)?` (${b.price_delta>0?"+":""}${b.price_delta})`:""))))}))})(),He&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${a}`,checked:!!D[a],onChange:t=>{const n=!!t.target.checked;R(r=>{const o=Array.isArray(r)?[...r]:[],v=Array.isArray(l.items)?l.items.length:0;for(;o.length<v;)o.push(!0);return o[a]=n,o})},disabled:p||V}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${a}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const n=t.target.value;X(r=>{const o=Array.isArray(r.items)?[...r.items]:[];return o[a]={...o[a]||{product_id:""},quantity:n},{...r,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var n;const t=(n=Pe.items)==null?void 0:n[a];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{X(t=>{const n=Array.isArray(t.items)?[...t.items]:[];return n.splice(a,1),{...t,items:n.length?n:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Be(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n.length?n:[""]}),R(t=>{const n=Array.isArray(t)?[...t]:[];return n.splice(a,1),n}),ft(t=>t==null?t:t===a?null:t>a?t-1:t)},disabled:p||V||(Array.isArray(l.items)?l.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const a=(Array.isArray(l.items)?l.items:[]).filter(d=>d==null?void 0:d.product_id),t=ra(a),n=ia(a),r=Ft(l),o=r.amount,v=t+(n.found?n.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Re(t))),n.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Re(n.fee))),!!Pe.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Pe.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Re(o))),(l.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(l.note||"").trim()),!!r.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",r.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Re(v)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:ja,disabled:p||V,style:{borderRadius:10}},"H\u1EE7y"),!!He&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:Ua,disabled:p||V,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},V?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!He&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>ya({mode:"new",origin:"modal"}),disabled:p||!Pe.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:p||V||!Pe.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},p?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

