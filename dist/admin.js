const{useState,useEffect,useRef,useMemo}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:_,error:R}){const[L,ye]=useState(""),[ne,V]=useState(""),[H,Oe]=useState(!1),[Le,Ce]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),R&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),R),React.createElement("form",{onSubmit:async tt=>{tt.preventDefault(),Oe(!0),await _(L,ne),Oe(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:L,onChange:tt=>ye(tt.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:Le?"text":"password",className:"form-control",value:ne,onChange:tt=>V(tt.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Ce(!Le)},React.createElement("i",{className:`fas fa-eye${Le?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:H},H?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:_,type:R,onClose:L,actionLabel:ye,onAction:ne,durationMs:V}){return useEffect(()=>{const H=Number(V),Oe=Number.isFinite(H)&&H>0?H:3e3,Le=setTimeout(L,Oe);return()=>clearTimeout(Le)},[L,V]),React.createElement("div",{className:`toast show align-items-center text-white bg-${R} border-0`,role:"alert"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("div",{className:"toast-body"},_),ye&&typeof ne=="function"&&React.createElement("button",{type:"button",className:"btn btn-sm btn-light toast-action",onClick:()=>{try{ne()}finally{L()}}},ye),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:L})))}function Loading({show:_}){return _?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function AdminDrawer({open:_,title:R,subtitle:L,onClose:ye,footer:ne,children:V}){return useEffect(()=>{if(!_)return;const H=Oe=>{Oe.key==="Escape"&&(Oe.preventDefault(),typeof ye=="function"&&ye())};return document.addEventListener("keydown",H),()=>document.removeEventListener("keydown",H)},[_,ye]),_?React.createElement("div",{className:`admin-drawer-root ${_?"open":""}`,role:"dialog","aria-modal":"true"},React.createElement("div",{className:"admin-drawer-backdrop",onClick:ye,"aria-hidden":"true"}),React.createElement("aside",{className:"admin-drawer-panel"},React.createElement("div",{className:"admin-drawer-header"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"admin-drawer-title"},R),L?React.createElement("div",{className:"admin-drawer-subtitle"},L):null),React.createElement("button",{type:"button",className:"btn btn-sm btn-light",onClick:ye,title:"\u0110\xF3ng","aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-drawer-body"},V),ne?React.createElement("div",{className:"admin-drawer-footer"},ne):null)):null}const ADMIN_PINS_STORAGE_KEY="ktm_admin_pins_v1",ADMIN_RECENT_STORAGE_KEY="ktm_admin_recent_v1";function loadAdminMenuIdsFromStorage(_){try{const R=localStorage.getItem(_);if(!R)return[];const L=JSON.parse(R);return Array.isArray(L)?L.map(ye=>String(ye||"").trim()).filter(Boolean):[]}catch(R){return[]}}function saveAdminMenuIdsToStorage(_,R){try{localStorage.setItem(_,JSON.stringify(Array.isArray(R)?R:[]))}catch(L){}}function loadAdminPins(){return loadAdminMenuIdsFromStorage(ADMIN_PINS_STORAGE_KEY)}function saveAdminPins(_){return saveAdminMenuIdsToStorage(ADMIN_PINS_STORAGE_KEY,_),_}function loadAdminRecent(){return loadAdminMenuIdsFromStorage(ADMIN_RECENT_STORAGE_KEY)}function saveAdminRecent(_){return saveAdminMenuIdsToStorage(ADMIN_RECENT_STORAGE_KEY,_),_}function Sidebar({activeMenu:_,onMenuChange:R,onLogout:L,currentUser:ye,pinnedMenus:ne,recentMenus:V,onTogglePin:H}){const Oe=[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"recon",icon:"fa-file-excel",label:"\u0110\u1ED1i so\xE1t Excel"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}],Le=(ye==null?void 0:ye.username)||(ye==null?void 0:ye.name)||(ye==null?void 0:ye.email)||"Admin",Ce=useMemo(()=>{const Ke=new Map;for(const K of Oe)Ke.set(K.id,K);return Ke},[]),Xe=Array.isArray(ne)?ne:[],tt=Array.isArray(V)?V:[],je=Xe.map(Ke=>Ce.get(Ke)).filter(Boolean),ze=tt.filter(Ke=>Ke!==_).map(Ke=>Ce.get(Ke)).filter(Boolean).slice(0,5),pe=Ke=>Xe.includes(Ke);return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("div",{className:"sidebar-user","aria-label":"T\xE0i kho\u1EA3n"},React.createElement("div",{className:"sidebar-user-avatar","aria-hidden":"true"},React.createElement("i",{className:"fas fa-user"})),React.createElement("div",{className:"sidebar-user-meta"},React.createElement("div",{className:"sidebar-user-name"},Le),React.createElement("div",{className:"sidebar-user-sub"},"Qu\u1EA3n tr\u1ECB"))),React.createElement("nav",{className:"nav flex-column mt-3"},je.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Pinned"),React.createElement("div",{className:"sidebar-quicklist"},je.map(Ke=>React.createElement("a",{key:`pin-${Ke.id}`,href:"#",className:`nav-link ${_===Ke.id?"active":""} sidebar-quicklink`,onClick:K=>{K.preventDefault(),R(Ke.id)}},React.createElement("i",{className:`fas ${Ke.icon}`})," ",Ke.label,React.createElement("button",{type:"button",className:"sidebar-pin-btn pinned",onClick:K=>{K.preventDefault(),K.stopPropagation(),H&&H(Ke.id)},title:"B\u1ECF ghim","aria-label":"B\u1ECF ghim"},React.createElement("i",{className:"fas fa-thumbtack"})))))),ze.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sidebar-section-title"},"Recent"),React.createElement("div",{className:"sidebar-quicklist"},ze.map(Ke=>React.createElement("a",{key:`recent-${Ke.id}`,href:"#",className:`nav-link ${_===Ke.id?"active":""} sidebar-quicklink`,onClick:K=>{K.preventDefault(),R(Ke.id)}},React.createElement("i",{className:`fas ${Ke.icon}`})," ",Ke.label)))),React.createElement("div",{className:"sidebar-section-title"},"Menu"),Oe.map(Ke=>React.createElement("a",{key:Ke.id,href:"#",className:`nav-link ${_===Ke.id?"active":""} ${Ke.disabled?"opacity-50":""} ${Ke.highlight?"text-warning":""}`,onClick:K=>{K.preventDefault(),Ke.disabled||R(Ke.id)}},React.createElement("i",{className:`fas ${Ke.icon}`})," ",Ke.label,Ke.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),Ke.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT"),React.createElement("button",{type:"button",className:`sidebar-pin-btn ${pe(Ke.id)?"pinned":""}`,onClick:K=>{K.preventDefault(),K.stopPropagation(),H&&H(Ke.id)},title:pe(Ke.id)?"B\u1ECF ghim":"Ghim","aria-label":pe(Ke.id)?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:"fas fa-thumbtack"}))))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),L&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:L,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(_){const R=typeof _=="number"?_:parseFloat(String(_!=null?_:"").trim());return Number.isFinite(R)?Math.max(0,Math.min(100,R)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var _;try{const R=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!R)return{ship_percent:DEFAULT_SHIP_PERCENT};const L=JSON.parse(R);return{ship_percent:normalizeShipPercent((_=L==null?void 0:L.ship_percent)!=null?_:L==null?void 0:L.shipPercent)}}catch(R){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(_){var R;try{const L={ship_percent:normalizeShipPercent((R=_==null?void 0:_.ship_percent)!=null?R:_==null?void 0:_.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(L)),L}catch(L){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var R;const _=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((R=_==null?void 0:_.ship_percent)!=null?R:_==null?void 0:_.shipPercent)}}async function saveAdminSettingsToServer(_){var ye,ne,V;const R={ship_percent:normalizeShipPercent((ye=_==null?void 0:_.ship_percent)!=null?ye:_==null?void 0:_.shipPercent)},L=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,R,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((V=(ne=L==null?void 0:L.ship_percent)!=null?ne:L==null?void 0:L.shipPercent)!=null?V:R.ship_percent)}}function AlbumList({albums:_,onSelect:R,onCreate:L,onEdit:ye,onDelete:ne,loading:V,currentFolder:H,onBack:Oe,breadcrumb:Le}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},H&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:Oe},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),H?H.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:L},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),Le&&Le.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:Ce=>{Ce.preventDefault(),Oe("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Le.map((Ce,Xe)=>React.createElement("li",{key:Ce.id,className:`breadcrumb-item ${Xe===Le.length-1?"active":""}`},Xe===Le.length-1?Ce.title:React.createElement("a",{href:"#",onClick:tt=>{tt.preventDefault(),Oe(Ce)},className:"text-warning"},Ce.title))))),V?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):_.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},H?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},_.map(Ce=>React.createElement("div",{key:Ce.uuid||Ce.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>R(Ce)},Ce.cover?React.createElement("img",{src:Ce.cover,className:"album-cover",alt:Ce.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},Ce.title),React.createElement("small",{className:"text-muted"},Ce.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),Ce.subfolderCount),Ce.subfolderCount>0&&Ce.count>0&&" \u2022 ",Ce.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),Ce.count),Ce.subfolderCount===0&&Ce.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Xe=>{Xe.stopPropagation(),ye(Ce)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Xe=>{Xe.stopPropagation(),ne(Ce)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:_,album:R,onClose:L,onSave:ye,parentId:ne}){const[V,H]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[Oe,Le]=useState(!1),[Ce,Xe]=useState(!1),tt=useRef(null);useEffect(()=>{H(R?{slug:R.id||"",title:R.title||"",description:R.description||"",cover_url:R.cover||"",parent_id:R.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:ne||null})},[R,_,ne]);const je=async K=>{K.preventDefault(),Le(!0),await ye(V),Le(!1)},ze=K=>K.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),pe=async K=>{const yt=K.type==="image/heic"||K.type==="image/heif"||/\.heic$/i.test(K.name);if(K.size<=2097152&&!yt)return K;try{const wt=await createImageBitmap(K),He=document.createElement("canvas");let et=wt.width,De=wt.height;const gt=800;return(et>gt||De>gt)&&(et>De?(De=Math.round(De/et*gt),et=gt):(et=Math.round(et/De*gt),De=gt)),He.width=et,He.height=De,He.getContext("2d").drawImage(wt,0,0,et,De),wt.close(),new Promise((tn,Qe)=>{He.toBlob(Kt=>{Kt?tn(new File([Kt],K.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Qe(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(wt){throw console.error("Compress cover error:",wt),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Ke=async K=>{var wt;const mt=K.target.files[0];if(!mt)return;if(!(mt.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(mt.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Xe(!0);try{const He=await pe(mt),et=await window.KTM.cloudinary.uploadImage({file:He,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!et.secure_url)throw console.error("Cloudinary error:",et),new Error(((wt=et.error)==null?void 0:wt.message)||"Upload failed");H(De=>({...De,cover_url:et.secure_url}))}catch(He){console.error("Cover upload error:",He),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+He.message)}Xe(!1),K.target.value=""};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},R?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:je},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:V.title,onChange:K=>H({...V,title:K.target.value,slug:V.slug||ze(K.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:V.slug,onChange:K=>H({...V,slug:K.target.value}),required:!0,disabled:!!R}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:V.description,onChange:K=>H({...V,description:K.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},V.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:V.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>H(K=>({...K,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:tt,type:"file",accept:"image/*",className:"d-none",onChange:Ke}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var K;return(K=tt.current)==null?void 0:K.click()},disabled:Ce},Ce?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:V.cover_url,onChange:K=>H({...V,cover_url:K.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:Oe||Ce},Oe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:_,allAlbums:R,currentAlbumId:L,targetAlbum:ye,onSelect:ne,level:V=0}){const[H,Oe]=useState(!0),Le=_.uuid||_.id,Ce=Le===L,Xe=ye===Le,tt=R.filter(ze=>ze.parentId===Le),je=tt.length>0;return React.createElement("div",{style:{marginLeft:V*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Xe?"bg-info text-white":Ce?"bg-light text-muted":"hover-bg"}`,style:{cursor:Ce?"not-allowed":"pointer",opacity:Ce?.5:1,transition:"background 0.2s"},onClick:()=>!Ce&&ne(Le)},je&&React.createElement("i",{className:`fas fa-chevron-${H?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:ze=>{ze.stopPropagation(),Oe(!H)}}),!je&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Xe?"-open":""} me-2 ${Xe?"":"text-warning"}`}),React.createElement("span",{className:"small"},_.title),Ce&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),_.count>0&&!Ce&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},_.count)),H&&je&&React.createElement("div",null,tt.map(ze=>React.createElement(FolderTreeItem,{key:ze.uuid||ze.id,folder:ze,allAlbums:R,currentAlbumId:L,targetAlbum:ye,onSelect:ne,level:V+1}))))}function AlbumDetail({album:_,onBack:R,onRefresh:L,showToast:ye,onNavigateToFolder:ne,onEditSubfolder:V,parentAlbum:H}){const[Oe,Le]=useState([]),[Ce,Xe]=useState([]),[tt,je]=useState(!0),[ze,pe]=useState(!1),[Ke,K]=useState(""),[mt,yt]=useState([]),[wt,He]=useState([]),[et,De]=useState({}),[gt,Et]=useState(null),[tn,Qe]=useState(!1),[Kt,jt]=useState(""),[A,S]=useState(!1),B=useRef(null),ge=useRef(null),[Ne,oe]=useState(!1),[me,Me]=useState([]),[N,F]=useState([]),[J,re]=useState(""),[Ie,Te]=useState(!1),Ue=async(P,d=2)=>{const X=d*1024*1024,Z=P.type==="image/heic"||P.type==="image/heif"||/\.heic$/i.test(P.name);if(P.size<=X&&!Z)return P;try{const Re=await createImageBitmap(P),Ee=document.createElement("canvas");let Ve=Re.width,vt=Re.height;const Ze=1200;return(Ve>Ze||vt>Ze)&&(Ve>vt?(vt=Math.round(vt/Ve*Ze),Ve=Ze):(Ve=Math.round(Ve/vt*Ze),vt=Ze)),Ee.width=Ve,Ee.height=vt,Ee.getContext("2d").drawImage(Re,0,0,Ve,vt),Re.close(),new Promise((Vt,nn)=>{Ee.toBlob(hn=>{hn?Vt(new File([hn],P.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):nn(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Re){throw console.error("Compress error:",Re),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{We(),St()},[_.id,_.uuid]);const We=async()=>{je(!0);try{const P=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${_.uuid||_.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Le(P.images||[]);const d=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${_.uuid||_.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Xe(Array.isArray(d)?d:[])}catch(P){console.error(P),ye("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}je(!1)},St=async()=>{try{const P=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");F(Array.isArray(P)?P:[])}catch(P){console.error("Error loading albums:",P)}},Rt=P=>{Me(d=>d.includes(P)?d.filter(X=>X!==P):[...d,P])},_e=async()=>{if(!J||me.length===0){ye("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}Te(!0);let P=0;for(const d of me)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${d}`,{album_id:J},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),P++}catch(X){console.error("Move error:",X)}Te(!1),oe(!1),Me([]),re(""),P>0?(ye("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),We(),L()):ye("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[rt,Qt]=useState(!1),Ct=async()=>{if(me.length===0||!confirm(`X\xF3a ${me.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Qt(!0);let P=0;for(const d of me)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${d}`,"L\u1ED7i x\xF3a \u1EA3nh"),P++}catch(X){console.error("Delete error:",X)}Qt(!1),Me([]),P>0?(ye(`\u0110\xE3 x\xF3a ${P} \u1EA3nh!`,"success"),We(),L()):ye("X\xF3a th\u1EA5t b\u1EA1i","danger")},on=()=>{me.length===Oe.length?Me([]):Me(Oe.map(P=>P.id))},Ft=async()=>{if(Kt.trim()){S(!0);try{const P=Kt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:P+"-"+Date.now(),title:Kt,parent_id:_.uuid||_.id},"L\u1ED7i t\u1EA1o folder"),ye("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),jt(""),Qe(!1),We(),L()}catch(P){ye(P.message,"danger")}S(!1)}},un=async P=>{if(confirm(`X\xF3a folder "${P.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${P.uuid||P.id}`,"L\u1ED7i x\xF3a folder"),ye("\u0110\xE3 x\xF3a folder","success"),We(),L()}catch(d){ye("L\u1ED7i x\xF3a folder","danger")}},fn=P=>{const d=Array.from(P).filter(X=>X.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(X.name));yt(X=>[...X,...d]),d.forEach(X=>{const Z=new FileReader;Z.onload=Re=>{He(Ee=>[...Ee,{file:X,preview:Re.target.result}])},Z.readAsDataURL(X)})},$=P=>{yt(d=>d.filter((X,Z)=>Z!==P)),He(d=>d.filter((X,Z)=>Z!==P))},ae=async P=>{var X;const d=await window.KTM.cloudinary.uploadImage({file:P,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${_.id}`});if(!d.secure_url)throw console.error("Cloudinary error:",d),new Error(((X=d.error)==null?void 0:X.message)||"Upload failed");return d},Ye=async()=>{if(mt.length===0)return;pe(!0);let P=0;for(let d=0;d<mt.length;d++)try{K(`\u0110ang x\u1EED l\xFD ${d+1}/${mt.length}...`);const X=await Ue(mt[d],2);K(`\u0110ang upload ${d+1}/${mt.length}...`);const Z=await ae(X);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${_.id}`,{url:Z.secure_url,caption:et[d]||mt[d].name.replace(/\.[^/.]+$/,""),sort_order:Oe.length+d},"L\u1ED7i l\u01B0u \u1EA3nh"),P++}catch(X){console.error("Upload error:",X)}pe(!1),K(""),yt([]),He([]),De({}),P>0?(ye(`\u0110\xE3 upload ${P} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),We(),L()):ye("Upload th\u1EA5t b\u1EA1i","danger")},qt=async(P,d)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${P}`,"L\u1ED7i x\xF3a \u1EA3nh"),ye("\u0110\xE3 x\xF3a \u1EA3nh","success"),We(),L()}catch(X){ye("L\u1ED7i x\xF3a \u1EA3nh","danger")}},pn=P=>{var d;P.preventDefault(),(d=ge.current)==null||d.classList.add("dragover")},Xt=()=>{var P;(P=ge.current)==null||P.classList.remove("dragover")},Jt=P=>{var d;P.preventDefault(),(d=ge.current)==null||d.classList.remove("dragover"),fn(P.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:R},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},_.title),React.createElement("small",{className:"text-muted"},Ce.length>0&&React.createElement("span",null,Ce.length," folder \u2022 "),Oe.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Qe(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),tn&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:Kt,onChange:P=>jt(P.target.value),onKeyPress:P=>P.key==="Enter"&&Ft(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:Ft,disabled:A||!Kt.trim()},A?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Qe(!1),jt("")}},"H\u1EE7y")))),Ce.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},Ce.map(P=>React.createElement("div",{key:P.uuid||P.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>ne&&ne(P)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},P.title),React.createElement("small",{className:"text-muted"},P.subfolderCount>0&&React.createElement("span",null,P.subfolderCount," folder"),P.subfolderCount>0&&P.count>0&&" \u2022 ",P.count>0&&React.createElement("span",null,P.count," \u1EA3nh"),P.subfolderCount===0&&P.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:d=>{d.stopPropagation(),V&&V(P)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:d=>{d.stopPropagation(),un(P)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:ge,className:"upload-zone",onClick:()=>{var P;return(P=B.current)==null?void 0:P.click()},onDragOver:pn,onDragLeave:Xt,onDrop:Jt},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:B,type:"file",multiple:!0,accept:"image/*",onChange:P=>fn(P.target.files)})),wt.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},wt.map((P,d)=>React.createElement("div",{key:d,className:"upload-preview-item"},React.createElement("img",{src:P.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>$(d)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Ye,disabled:ze},ze?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),Ke||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",mt.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",Oe.length,")"),Oe.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:on},me.length===Oe.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),me.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},me.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>oe(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Ct,disabled:rt},rt?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Me([])},React.createElement("i",{className:"fas fa-times"})))),tt?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):Oe.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},Oe.map((P,d)=>React.createElement("div",{key:d,className:`image-item ${me.includes(P.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Rt(P.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:me.includes(P.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:me.includes(P.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},me.includes(P.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:P.src,alt:P.caption,style:{opacity:me.includes(P.id)?.7:1,border:me.includes(P.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:X=>{X.stopPropagation(),qt(P.id,d)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),P.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},P.caption)))))),Ne&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",me.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>oe(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},N.filter(P=>!P.parentId).map(P=>React.createElement(FolderTreeItem,{key:P.uuid||P.id,folder:P,allAlbums:N,currentAlbumId:_.uuid||_.id,targetAlbum:J,onSelect:re})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>oe(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:_e,disabled:!J||Ie},Ie?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),gt&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>Et(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>Et(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:gt.src,alt:gt.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:P=>P.stopPropagation()}),gt.caption&&React.createElement("div",{className:"text-white text-center mt-2"},gt.caption)))))}function SearchCenter({showToast:_,onNavigate:R}){const[L,ye]=useState(""),[ne,V]=useState([]),[H,Oe]=useState([]),[Le,Ce]=useState([]),[Xe,tt]=useState("all"),[je,ze]=useState(null),[pe,Ke]=useState("list"),[K,mt]=useState(!0),[yt,wt]=useState([]),[He,et]=useState([]),De=useRef(null),[gt,Et]=useState(!0),[tn,Qe]=useState(!1),Kt=useRef(null),jt=useRef(null),A=useRef(null),[S,B]=useState(!1),[ge,Ne]=useState([]),[oe,me]=useState([]),[Me,N]=useState(""),F=useRef(null),J=useRef(new Map),[re,Ie]=useState("auto"),[Te,Ue]=useState({start:0,end:20}),[We,St]=useState(!1),[Rt,_e]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[rt,Qt]=useState(""),[Ct,on]=useState(!1),Ft=useRef(null),un=useRef(null),fn=s=>s?String(s).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").trim():"",$=s=>s?String(s).replace(/\s+/g,"").replace(/[-()]/g,"").replace(/^\+84/,"0").trim():"",ae=(s,f)=>{if(!s||!f)return s;const u=new RegExp(`(${f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return s.replace(u,'<mark style="background:#ffeb3b">$1</mark>')};useEffect(()=>{try{const s=JSON.parse(localStorage.getItem("ktm_search_history")||"[]"),f=JSON.parse(localStorage.getItem("ktm_saved_searches")||"[]");Ne(Array.isArray(s)?s.slice(0,10):[]),me(Array.isArray(f)?f:[])}catch(s){}},[]);const Ye=s=>{if(!s.trim())return;const f=[s,...ge.filter(u=>u!==s)].slice(0,10);Ne(f);try{localStorage.setItem("ktm_search_history",JSON.stringify(f))}catch(u){}},qt=s=>{if(!s.trim())return;const f=oe.includes(s)?oe.filter(u=>u!==s):[s,...oe].slice(0,5);me(f);try{localStorage.setItem("ktm_saved_searches",JSON.stringify(f))}catch(u){}},pn="ktm_search_query_stats_v1",Xt="ktm_search_product_stats_v1",Jt=(s,f)=>{try{const u=localStorage.getItem(s);if(!u)return f;const j=JSON.parse(u);return j!=null?j:f}catch(u){return f}},P=(s,f)=>{try{localStorage.setItem(s,JSON.stringify(f))}catch(u){}},[d,X]=useState(()=>Jt(pn,{})),[Z,Re]=useState(()=>Jt(Xt,{})),Ee=useRef(!1),Ve=useRef(new Map);useEffect(()=>{const s=f=>{f&&(f.key===pn&&X(Jt(pn,{})),f.key===Xt&&Re(Jt(Xt,{})))};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const vt=s=>{const f=String(s||"").trim();if(!f)return;const u=Se(f).trim();if(u.length<3||u==="sdt:"||u==="#"||u.endsWith(":"))return;const j=Date.now(),W=Jt(pn,d&&typeof d=="object"?d:{}),O={...W&&typeof W=="object"?W:{}},k=O[u]&&typeof O[u]=="object"?O[u]:{};O[u]={q:f,count:(Number(k.count)||0)+1,lastAt:j},X(O),P(pn,O)},Ze=(s,f)=>{if(!s||s._type!=="product")return;const u=String(s.id||"").trim();if(!u)return;const j=Date.now(),W=Jt(Xt,Z&&typeof Z=="object"?Z:{}),O={...W&&typeof W=="object"?W:{}},k=O[u]&&typeof O[u]=="object"?O[u]:{};O[u]={id:u,name:String(s.name||k.name||"").trim(),code:String(s.code||k.code||"").trim(),count:(Number(k.count)||0)+1,lastAt:j,action:String(f||k.action||"").trim()},Re(O),P(Xt,O)},cn=(s,f)=>{const u=String(s||"").trim();if(!u)return;const j=Se(u).trim();if(j.length<3||j==="sdt:"||j==="#"||j.endsWith(":"))return;const W=Date.now(),O=Number(Ve.current.get(j)||0);if(W-O<3e4)return;const Y=(Array.isArray(f)?f:[]).find(ue=>ue&&ue._type==="product");Y&&(Ve.current.set(j,W),Ze(Y,"search"))},Vt=useMemo(()=>Object.values(d&&typeof d=="object"?d:{}).map(u=>({q:String((u==null?void 0:u.q)||"").trim(),count:Number(u==null?void 0:u.count)||0,lastAt:Number(u==null?void 0:u.lastAt)||0})).filter(u=>u.q&&u.count>0).sort((u,j)=>j.count-u.count||j.lastAt-u.lastAt).slice(0,6),[d]),nn=useMemo(()=>Object.values(Z&&typeof Z=="object"?Z:{}).map(u=>({id:String((u==null?void 0:u.id)||"").trim(),name:String((u==null?void 0:u.name)||"").trim(),code:String((u==null?void 0:u.code)||"").trim(),count:Number(u==null?void 0:u.count)||0,lastAt:Number(u==null?void 0:u.lastAt)||0})).filter(u=>u.id&&u.count>0).sort((u,j)=>j.count-u.count||j.lastAt-u.lastAt).slice(0,8).map(u=>{const j=H.find(W=>W&&W._type==="product"&&String(W.id)===u.id);return j?{...u,item:j}:{...u,item:null}}),[Z,H]),hn=(s,f={})=>{const u=String(s||"");dt(u),f.addToHistory!==!1&&Ye(u),B(!1),gn(!1),w(!1),f.focus!==!1?(Ee.current=!0,setTimeout(()=>{var O;const W=De.current;(O=W==null?void 0:W.focus)==null||O.call(W);try{if(f.caret==="end"&&W&&typeof W.setSelectionRange=="function"){const k=String(W.value||"").length;W.setSelectionRange(k,k)}}catch(k){}},0)):(Ee.current=!1,setTimeout(()=>{var W,O,k,Y;try{(O=(W=De.current)==null?void 0:W.blur)==null||O.call(W),(Y=(k=document.activeElement)==null?void 0:k.blur)==null||Y.call(k)}catch(ue){}},0))},[nt,ln]=useState(null),[Mn,yn]=useState(!1),[lt,r]=useState(null),[c,w]=useState(!1),[p,M]=useState(!1),[z,q]=useState(null),[b,x]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),T=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],E=s=>{var f,u;s._type==="product"&&(r(s),x({name:s.name||"",code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",commission_percent:(u=(f=s.commission_percent)!=null?f:s.commissionPercent)!=null?u:""}),yn(!0))},ee=async()=>{if(lt)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${lt.id}`,b,"L\u1ED7i c\u1EADp nh\u1EADt"),_("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),yn(!1),r(null),qe()}catch(s){_(s.message,"danger")}},we=async s=>{const f=s._type==="product"?"s\u1EA3n ph\u1EA9m":s._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${f} "${s.name}"?`))try{let u="";s._type==="product"?u=`${API_BASE}/api/products?id=${s.id}`:s._type==="album"?u=`${API_BASE}/api/images/${s.id}`:s._type==="video"&&(u=`${API_BASE}/api/videos/${s.id}`),await window.KTM.api.deleteJSON(u,"L\u1ED7i x\xF3a"),_(`\u0110\xE3 x\xF3a ${f}`,"success"),qe()}catch(u){_(u.message,"danger")}},le=async s=>{try{const f=z?`${API_BASE}/api/products?id=${z.id}`:`${API_BASE}/api/products`;z?await window.KTM.api.putJSON(f,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(f,s,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),_(z?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),M(!1),q(null),qe()}catch(f){_(f.message,"danger")}},ve="ktm_admin_data_cache_v1",Fe=1e3*60*10,qe=async()=>{let s=null,f=!1;const u=window.KTM.cache.read(ve,{ttlMs:Fe,validate:Array.isArray});u.hit?(s=u.value,console.log("[CACHE] Using cache, items:",s.length),Oe(s),V(s),mt(!1),f=!0):u.status==="miss"?console.log("[CACHE] No cache found"):u.status==="expired"||u.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):u.status==="error"&&console.error("[CACHE] Error parsing cache"),f||mt(!0);try{const j=async(Je,h)=>{try{const ke=await window.KTM.api.getJSON(Je,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return ke!=null?ke:h}catch(ke){return h}},[W,O,k]=await Promise.all([j(`${API_BASE}/api/products?fields=search`,[]),j(`${API_BASE}/api/albums`,[]),j(`${API_BASE}/api/video-folders?withVideos=true`,[])]),Y=Array.isArray(W)?W.map(Je=>({...Je,_type:"product",_source:"database"})):[];wt(O);let ue=[];Array.isArray(O)&&O.length>0&&(await Promise.all(O.map(h=>j(`${API_BASE}/api/albums/${h.id}`,{})))).forEach((h,ke)=>{const xt=O[ke];h.images&&h.images.length>0&&h.images.forEach(Mt=>{ue.push({id:Mt.id,name:Mt.caption||"\u1EA2nh t\u1EEB "+xt.title,image:Mt.src,folder:xt.title,_type:"album",_source:"database"})})}),et(k);let Q=[];Array.isArray(k)&&k.forEach(Je=>{Je.videos&&Je.videos.forEach(h=>{Q.push({id:h.id,name:h.title,folder:Je.name,image:h.thumb,youtubeId:h.youtubeId,url:h.url,_type:"video",_source:"database"})})});const ie=[...Y,...ue,...Q];(!s||JSON.stringify(ie)!==JSON.stringify(s))&&(Oe(ie),V(ie),window.KTM.cache.write(ve,ie))}catch(j){console.error("Song song fetch error:",j)}mt(!1)};useEffect(()=>{qe(),setTimeout(()=>{var f;return(f=De.current)==null?void 0:f.focus()},100);const s=f=>{var u,j;(f.ctrlKey||f.metaKey)&&f.key==="k"&&(f.preventDefault(),B(!0),setTimeout(()=>{var W;return(W=F.current)==null?void 0:W.focus()},0)),f.key==="/"&&!S&&((u=document.activeElement)==null?void 0:u.tagName)!=="INPUT"&&(f.preventDefault(),(j=De.current)==null||j.focus()),f.key==="Escape"&&S&&B(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[S]);const Se=s=>{try{return String(s!=null?s:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(f){return String(s!=null?s:"").toLowerCase()}},it=s=>{const u=Se(s).trim().split(/\s+/).filter(Boolean).map(ue=>{const Q=String(ue||"").trim();return Q?Q.startsWith("#")?Q.slice(1):Q.startsWith("sdt:")?Q.slice(4):Q.startsWith("phone:")?Q.slice(6):Q:""}).filter(Boolean),j=u.includes("anh"),W=u.includes("video"),O=u.filter(ue=>ue!=="anh"&&ue!=="video"),k=O.join(" "),Y=new Set(["product"]);return j&&Y.add("album"),W&&Y.add("video"),{allowedTypes:Y,includeAlbum:j,includeVideo:W,contentTokens:O,cleanedQuery:k}},de=(s,f,u)=>{var ke,xt,Mt,Ot,Bt;const j=Array.isArray(f)?f:[],W=Se(u).trim();if(!j.length&&!W)return 0;const O=Se((ke=s==null?void 0:s.name)!=null?ke:""),k=Se((xt=s==null?void 0:s.code)!=null?xt:""),Y=Se((Mt=s==null?void 0:s.category)!=null?Mt:""),ue=Se((Ot=s==null?void 0:s.note)!=null?Ot:""),Q=Se((Bt=s==null?void 0:s.folder)!=null?Bt:"");if(!`${O} ${k} ${Y} ${ue} ${Q}`.trim())return 0;const Be=O.replace(/\s+/g,""),Je=W.replace(/\s+/g,"");let h=0;W&&(O===W&&(h+=220),O.includes(W)&&(h+=140),O.startsWith(W)&&(h+=160),Je&&(Be===Je?h+=280:Be.startsWith(Je)?h+=180:Be.includes(Je)&&(h+=110)),k&&k===W&&(h+=180),k&&k.includes(W)&&(h+=90));for(const Ut of j){if(!Ut)continue;const zt=new RegExp(`(?:^|\\s)${Ut.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`),Wt=String(Ut).replace(/\s+/g,"");O.includes(Ut)&&(h+=35),zt.test(O)&&(h+=25),Wt&&(Be===Wt?h+=90:Be.startsWith(Wt)?h+=50:Be.includes(Wt)&&(h+=28)),k&&k.includes(Ut)&&(h+=20),k&&zt.test(k)&&(h+=10),Y&&Y.includes(Ut)&&(h+=12),Q&&Q.includes(Ut)&&(h+=12),ue&&ue.includes(Ut)&&(h+=6)}return h>0&&O&&(h+=Math.max(0,10-Math.min(10,Math.floor(O.length/10)))),h},Ge=(s,f,u)=>{const j=Array.isArray(s)?s:[];return j.length?j.map((O,k)=>({it:O,idx:k,score:de(O,f,u)})).sort((O,k)=>k.score!==O.score?k.score-O.score:O.idx-k.idx).map(O=>O.it):[]},At=async(s,f)=>{if(!(!gt||f.length===0)){Qe(!0);try{const u=f.map(W=>({id:W.id,name:W.name,price:W.price,category:W.category,note:W.note,folder:W.folder,_type:W._type})),j=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:s,products:u},"AI Search error");if(j&&j.matchedIds&&j.matchedIds.length>0){const{contentTokens:W,cleanedQuery:O}=it(s),k=new Set(j.matchedIds),Y=f.filter(ue=>k.has(ue.id)).sort((ue,Q)=>de(Q,W,O)-de(ue,W,O));Y.length>0&&V(Y)}else j&&j.matchedIds&&j.matchedIds.length===0&&V([])}catch(u){console.error("AI Search error:",u)}Qe(!1)}},dt=s=>{if(ye(s),N(s),jt.current&&clearTimeout(jt.current),Kt.current&&clearTimeout(Kt.current),A.current&&A.current.abort(),!s.trim()){xe(Xe);return}const u=`v2|${Se(s).trim().replace(/\s+/g,"")}|${Xe}`;if(J.current.has(u)){V(J.current.get(u));return}const{allowedTypes:j,contentTokens:W,cleanedQuery:O}=it(s);jt.current=setTimeout(()=>{const k=H.filter(Q=>{if(!j.has(Q==null?void 0:Q._type))return!1;if(W.length===0)return!0;const ie=fn(Object.entries(Q).filter(([ke])=>!ke.startsWith("_")).map(([,ke])=>String(ke||"")).join(" ")),Be=Q.phone?$(Q.phone):"",Je=`${ie} ${Be}`.trim(),h=Je.replace(/\s+/g,"");return W.every(ke=>{const xt=String(ke||"").trim();return xt?Je.includes(xt)||h.includes(xt.replace(/\s+/g,"")):!0})});let Y=k;Xe!=="all"&&(Y=k.filter(Q=>(Q==null?void 0:Q._type)===Xe));const ue=Ge(Y,W,O);if(vt(s),cn(s,ue),J.current.size>20){const Q=J.current.keys().next().value;J.current.delete(Q)}J.current.set(u,ue),V(ue),gt&&O.length>=3&&(Kt.current=setTimeout(()=>{At(O,Y)},500))},200)},xe=s=>{tt(s);const{allowedTypes:f,contentTokens:u}=it(L),{cleanedQuery:j}=it(L);let W=H.filter(O=>f.has(O==null?void 0:O._type));s!=="all"&&(W=W.filter(O=>(O==null?void 0:O._type)===s)),L.trim()&&u.length>0&&(W=W.filter(O=>{const k=Se(Object.entries(O).filter(([ie])=>!ie.startsWith("_")).map(([,ie])=>String(ie||"")).join(" ")),Y=O.phone?$(O.phone):"",ue=`${k} ${Y}`.trim(),Q=ue.replace(/\s+/g,"");return u.every(ie=>{const Be=String(ie||"").trim();return Be?ue.includes(Be)||Q.includes(Be.replace(/\s+/g,"")):!0})})),V(Ge(W,u,j))},se=(s,f,u)=>{u&&u.item&&Ze(u.item,u.action||"copy"),window.KTM.clipboard.writeText(s).then(()=>{ze(f),_("\u0110\xE3 copy!","success"),setTimeout(()=>ze(null),1500)})},C=async(s,f,u)=>{try{u&&u.item&&Ze(u.item,u.action||"copy_image"),await window.KTM.clipboard.writeImageFromUrl(s),ze(f+"-img"),_("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>ze(null),1500)}catch(j){se(s,f+"-img",u)}},te=s=>{let f=s.toLowerCase();const u=[],j=H.filter(k=>k._type==="product");if(f.includes("ty")||f.includes("xy lanh")){if(f.includes("gi\u1EEFa")||f.includes("giua")){const k=j.find(Y=>{var ue;return(ue=Y.name)==null?void 0:ue.toLowerCase().includes("xy lanh gi\u1EEFa")});k&&!u.find(Y=>Y.id===k.id)&&u.push(k)}if(f.includes("nghi\xEAng")||f.includes("nghieng")){const k=j.find(Y=>{var ue;return(ue=Y.name)==null?void 0:ue.toLowerCase().includes("xy lanh nghi\xEAng")});k&&!u.find(Y=>Y.id===k.id)&&u.push(k)}if(f.includes("\u1EE7i")||f.includes("ui")){const k=j.find(Y=>{var ue;return(ue=Y.name)==null?void 0:ue.toLowerCase().includes("xy lanh \u1EE7i")});k&&!u.find(Y=>Y.id===k.id)&&u.push(k)}}const W=f.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(W){const k=W[1],Y=W[2],ue=j.find(Q=>{var Be;const ie=((Be=Q.name)==null?void 0:Be.toLowerCase())||"";return ie.includes("combo")&&ie.includes(`${k} tay`)&&(ie.includes(`${Y} xy`)||ie.includes(`${Y} xylanh`))});if(ue&&!u.find(Q=>Q.id===ue.id))u.push(ue);else{const Q=j.find(ie=>{var Je;const Be=((Je=ie.name)==null?void 0:Je.toLowerCase())||"";return Be.includes("combo")&&Be.includes(`${k} tay`)});Q&&!u.find(ie=>ie.id===Q.id)&&u.push(Q)}}if(f.includes("combo")&&!W){const k=f.match(/combo.*?(\d+)\s*tay/);if(k){const Y=k[1];j.filter(Q=>{var Be;const ie=((Be=Q.name)==null?void 0:Be.toLowerCase())||"";return ie.includes("combo")&&ie.includes(`${Y} tay`)}).forEach(Q=>{u.find(ie=>ie.id===Q.id)||u.push(Q)})}}const O=f.match(/van\s*(\d+)\s*tay/);if(O&&!f.includes("ty")&&!f.includes("combo")){const k=O[1],Y=j.find(ue=>{var ie;const Q=((ie=ue.name)==null?void 0:ie.toLowerCase())||"";return Q.includes(`van ${k} tay`)&&!Q.includes("combo")});Y&&!u.find(ue=>ue.id===Y.id)&&u.push(Y)}return u.slice(0,4)},ce=async s=>{if(!s.trim())return;const f={role:"user",content:s,attachments:[]};_e(j=>[...j,f]),Qt(""),on(!0);const u=te(s);setTimeout(()=>{var j;return(j=Ft.current)==null?void 0:j.scrollIntoView({behavior:"smooth"})},100);try{const W=H.filter(ie=>ie._type==="product").map(ie=>{let Be=`- ${ie.name}`;return ie.code&&(Be+=` (M\xE3: ${ie.code})`),ie.price&&(Be+=` - Gi\xE1: ${ie.price.replace(/[đ\s]/g,"")}\u0111`),ie.category&&(Be+=` [${ie.category}]`),ie.note&&(Be+=` (${ie.note})`),Be}).join(`
`),k=Rt.slice(-6).map(ie=>`${ie.role==="user"?"Kh\xE1ch":"AI"}: ${ie.content}`).join(`
`),Y=k?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${k}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${W}`:W,Q=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:s,context:Y,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";_e(ie=>[...ie,{role:"assistant",content:Q,attachments:u}])}catch(j){console.error("AI Error:",j);const W=s.toLowerCase(),O=H.filter(Y=>{const ue=Object.values(Y).join(" ").toLowerCase();return W.split(" ").some(Q=>ue.includes(Q))});let k="";O.length>0?(k=`T\xECm th\u1EA5y ${O.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,O.slice(0,5).forEach(Y=>{k+=`\u2022 ${Y.name}`,Y.price&&(k+=` - ${Y.price.replace(/[đ\s]/g,"")}\u0111`),Y.note&&(k+=` (${Y.note})`),k+=`
`}),O.length>5&&(k+=`
...v\xE0 ${O.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):k='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',_e(Y=>[...Y,{role:"assistant",content:k,attachments:O.slice(0,4)}])}on(!1),setTimeout(()=>{var j,W;(j=Ft.current)==null||j.scrollIntoView({behavior:"smooth"}),(W=un.current)==null||W.focus()},100)};function pt({show:s,product:f,categories:u,onClose:j,onSave:W}){const[O,k]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Y,ue]=useState(!1),[Q,ie]=useState(!1),Be=useRef(null),Je=G=>window.KTM.money.formatVNDInputDigits(G),h=G=>{const U=window.KTM.money.getDigits(String(G!=null?G:"")),be=Number(U);return U&&Number.isFinite(be)?Math.trunc(be):0},ke=(G,U)=>{if(G==null||G==="")return[];let be=G;if(typeof be=="string"){const $e=be.trim();if(!$e)return[];try{be=JSON.parse($e)}catch(Ae){return[]}}if(!Array.isArray(be))return[];const Pe=h(U);return be.map($e=>{var ot;if(!$e||typeof $e!="object")return null;const Ae=String((ot=$e.name)!=null?ot:"").trim(),ut=(Array.isArray($e.options)?$e.options:[]).map(Nt=>{var xn,$n,In,Dn,Bn,Ln,fa;if(!Nt||typeof Nt!="object")return null;const Yt=String((xn=Nt.label)!=null?xn:"").trim();if(!Yt)return null;const rn=(Bn=(Dn=(In=($n=Nt.price)!=null?$n:Nt.priceValue)!=null?In:Nt.unit_price)!=null?Dn:Nt.unitPrice)!=null?Bn:null,vn=Number(rn);let Sn=Number.isFinite(vn)?Math.trunc(vn):null;if(Sn==null){const Rn=(fa=(Ln=Nt.price_delta)!=null?Ln:Nt.priceDelta)!=null?fa:null,zn=Number(Rn);Number.isFinite(zn)&&(Sn=Pe+Math.trunc(zn))}Sn==null&&(Sn=Pe);const wn=String(Math.max(0,Math.trunc(Number(Sn)||0)));return{label:Yt,price:Math.max(0,Math.trunc(Number(Sn)||0)),priceDigits:wn}}).filter(Boolean);return{name:Ae||"Bi\u1EBFn th\u1EC3",options:ut}}).filter(Boolean)},xt=G=>{if(G==null||G==="")return[];let U=G;if(typeof U=="string"){const be=U.trim();if(!be)return[];try{U=JSON.parse(be)}catch(Pe){return[]}}return U&&typeof U=="object"&&!Array.isArray(U)&&(U=Object.entries(U).map(([be,Pe])=>({key:be,value:Pe}))),Array.isArray(U)?U.map(be=>{var ut,ot,Nt,Yt,rn;if(!be||typeof be!="object")return null;const Pe=String((Nt=(ot=(ut=be.key)!=null?ut:be.name)!=null?ot:be.label)!=null?Nt:"").trim(),$e=String((Yt=be.value)!=null?Yt:"").trim(),Ae=String((rn=be.unit)!=null?rn:"").trim();return Pe?{key:Pe,value:$e,unit:Ae}:null}).filter(Boolean):[]};useEffect(()=>{var G,U;if(f)if(k({name:f.name||"",code:f.code||"",price:f.price||"",image:f.image||"",category:f.category||"",note:f.note||"",sort_order:f.sort_order||0,commission_percent:(U=(G=f.commission_percent)!=null?G:f.commissionPercent)!=null?U:5,variants:ke(f.variants,f.price),attributes:xt(f.attributes)}),f.price){const be=window.KTM.money.getDigits(f.price);Wt(be),k(Pe=>({...Pe,price:Je(be)}))}else Wt("");else k({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),Wt("")},[f,s]);const Mt=G=>{k(U=>{var ut;const be=h(U.price),Pe=String(be),$e=Array.isArray(U.variants)?[...U.variants]:[],Ae={...$e[G]||{},options:Array.isArray((ut=$e[G])==null?void 0:ut.options)?[...$e[G].options]:[]};return Ae.options=Ae.options.map(ot=>({label:String((ot==null?void 0:ot.label)||""),price:be,priceDigits:Pe})),$e[G]=Ae,{...U,variants:$e}})},Ot=()=>{k(G=>{const U=h(G.price),be=String(U),$e=(Array.isArray(G.variants)?[...G.variants]:[]).map(Ae=>{const ut=(Array.isArray(Ae==null?void 0:Ae.options)?Ae.options:[]).map(ot=>({label:String((ot==null?void 0:ot.label)||""),price:U,priceDigits:be}));return{name:String((Ae==null?void 0:Ae.name)||"Bi\u1EBFn th\u1EC3"),options:ut}});return{...G,variants:$e}})},[Bt,Ut]=React.useState(""),[zt,Wt]=React.useState(""),bt=G=>{const U=window.KTM.money.nextPriceInputState(G.target.value,zt);Wt(U.digits),k({...O,price:U.price})},an=async(G,U=2)=>{const be=U*1024*1024;if(G.size<=be)return G;try{const Pe=await createImageBitmap(G),$e=document.createElement("canvas");let Ae=Pe.width,ut=Pe.height;const ot=1200;return(Ae>ot||ut>ot)&&(Ae>ut?(ut=Math.round(ut/Ae*ot),Ae=ot):(Ae=Math.round(Ae/ut*ot),ut=ot)),$e.width=Ae,$e.height=ut,$e.getContext("2d").drawImage(Pe,0,0,Ae,ut),Pe.close(),new Promise((Yt,rn)=>{$e.toBlob(vn=>{vn?Yt(new File([vn],G.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):rn(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(Pe){throw console.error("Compress error:",Pe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},mn=async G=>{var Pe;const U=G.target.files[0];if(!U)return;if(!(U.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(U.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}ie(!0);try{const $e=await an(U),Ae=await window.KTM.cloudinary.uploadImage({file:$e,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!Ae.secure_url)throw console.error("Cloudinary error:",Ae),new Error(((Pe=Ae.error)==null?void 0:Pe.message)||"Upload failed");k(ut=>({...ut,image:Ae.secure_url}))}catch($e){console.error("Upload error:",$e),alert("L\u1ED7i upload \u1EA3nh: "+$e.message)}ie(!1),G.target.value=""},sn=async G=>{G.preventDefault(),ue(!0);const U={...O,variants:ke(O.variants,O.price),attributes:xt(O.attributes)};await W(U),ue(!1)};return s?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),f?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:j})),React.createElement("form",{onSubmit:sn},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:O.name,onChange:G=>k({...O,name:G.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:O.code,onChange:G=>k({...O,code:G.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:O.price,onChange:bt,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:O.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:G=>k({...O,commission_percent:G.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:O.category,onChange:G=>k({...O,category:G.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),u.map(G=>React.createElement("option",{key:G,value:G},G)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:O.note,onChange:G=>k({...O,note:G.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(O.attributes)?O.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(O.attributes)?O.attributes:[]).map((G,U)=>React.createElement("div",{key:U,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(G==null?void 0:G.key)||"",onChange:be=>{const Pe=be.target.value;k($e=>{const Ae=Array.isArray($e.attributes)?[...$e.attributes]:[];return Ae[U]={...Ae[U]||{},key:Pe},{...$e,attributes:Ae}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(G==null?void 0:G.value)||"",onChange:be=>{const Pe=be.target.value;k($e=>{const Ae=Array.isArray($e.attributes)?[...$e.attributes]:[];return Ae[U]={...Ae[U]||{},value:Pe},{...$e,attributes:Ae}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(G==null?void 0:G.unit)||"",onChange:be=>{const Pe=be.target.value;k($e=>{const Ae=Array.isArray($e.attributes)?[...$e.attributes]:[];return Ae[U]={...Ae[U]||{},unit:Pe},{...$e,attributes:Ae}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{k(be=>{const Pe=Array.isArray(be.attributes)?[...be.attributes]:[];return Pe.splice(U,1),{...be,attributes:Pe}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{k(G=>{const U=Array.isArray(G.attributes)?[...G.attributes]:[];return U.push({key:"",value:"",unit:""}),{...G,attributes:U}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(O.variants)?O.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3. C\xF3 th\u1EC3 th\xEAm (v\xED d\u1EE5 Size: S/M/L)."):null,(Array.isArray(O.variants)?O.variants:[]).map((G,U)=>React.createElement("div",{key:U,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(G==null?void 0:G.name)||"",onChange:be=>{const Pe=be.target.value;k($e=>{var ut;const Ae=Array.isArray($e.variants)?[...$e.variants]:[];return Ae[U]={...Ae[U]||{},name:Pe,options:Array.isArray((ut=Ae[U])==null?void 0:ut.options)?Ae[U].options:[]},{...$e,variants:Ae}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Mt(U),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(G==null?void 0:G.options)||G.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{k(be=>{const Pe=Array.isArray(be.variants)?[...be.variants]:[];return Pe.splice(U,1),{...be,variants:Pe}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(G==null?void 0:G.options)?G.options:[]).map((be,Pe)=>{var $e,Ae;return React.createElement("div",{key:Pe,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(be==null?void 0:be.label)||"",onChange:ut=>{const ot=ut.target.value;k(Nt=>{var wn,xn,$n,In,Dn;const Yt=Array.isArray(Nt.variants)?[...Nt.variants]:[],rn={...Yt[U]||{},options:Array.isArray((wn=Yt[U])==null?void 0:wn.options)?[...Yt[U].options]:[]},vn=Number(($n=(xn=rn.options[Pe])==null?void 0:xn.price)!=null?$n:0)||0,Sn=String((Dn=(In=rn.options[Pe])==null?void 0:In.priceDigits)!=null?Dn:Math.max(0,Math.trunc(vn)));return rn.options[Pe]={...rn.options[Pe]||{},label:ot,price:Math.max(0,Math.trunc(vn)),priceDigits:Sn},Yt[U]=rn,{...Nt,variants:Yt}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:Je(String((Ae=be==null?void 0:be.priceDigits)!=null?Ae:window.KTM.money.getDigits(String(($e=be==null?void 0:be.price)!=null?$e:"")))),onChange:ut=>{k(ot=>{var $n,In,Dn,Bn,Ln;const Nt=String((In=be==null?void 0:be.priceDigits)!=null?In:window.KTM.money.getDigits(String(($n=be==null?void 0:be.price)!=null?$n:""))),Yt=window.KTM.money.nextPriceInputState(ut.target.value,Nt),rn=String((Dn=Yt.digits)!=null?Dn:""),vn=Number(rn),Sn=Number.isFinite(vn)?Math.max(0,Math.trunc(vn)):0,wn=Array.isArray(ot.variants)?[...ot.variants]:[],xn={...wn[U]||{},options:Array.isArray((Bn=wn[U])==null?void 0:Bn.options)?[...wn[U].options]:[]};return xn.options[Pe]={...xn.options[Pe]||{},label:String(((Ln=xn.options[Pe])==null?void 0:Ln.label)||""),price:Sn,priceDigits:rn},wn[U]=xn,{...ot,variants:wn}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{k(ut=>{var Yt;const ot=Array.isArray(ut.variants)?[...ut.variants]:[],Nt={...ot[U]||{},options:Array.isArray((Yt=ot[U])==null?void 0:Yt.options)?[...ot[U].options]:[]};return Nt.options.splice(Pe,1),ot[U]=Nt,{...ut,variants:ot}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{k(be=>{var ut;const Pe=Array.isArray(be.variants)?[...be.variants]:[],$e={...Pe[U]||{},options:Array.isArray((ut=Pe[U])==null?void 0:ut.options)?[...Pe[U].options]:[]},Ae=h(be.price);return $e.options.push({label:"",price:Ae,priceDigits:String(Ae)}),Pe[U]=$e,{...be,variants:Pe}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{k(G=>{const U=h(G.price),be=Array.isArray(G.variants)?[...G.variants]:[],Pe=String(U);return be.push({name:"Size",options:[{label:"S",price:U,priceDigits:Pe},{label:"M",price:U,priceDigits:Pe},{label:"L",price:U,priceDigits:Pe}]}),{...G,variants:be}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Ot,disabled:!Array.isArray(O.variants)||O.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111.")))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},O.image?React.createElement(React.Fragment,null,React.createElement("img",{src:O.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>k({...O,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var G;return(G=Be.current)==null?void 0:G.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:Be,type:"file",accept:"image/*",className:"d-none",onChange:mn}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var G;return(G=Be.current)==null?void 0:G.click()},disabled:Q,style:{borderRadius:"10px"}},Q?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:O.image,onChange:G=>k({...O,image:G.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:j,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Y,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Tt=s=>window.KTM.money.formatVND(s),at=s=>{if(s==null||s==="")return[];let f=s;if(typeof f=="string"){const u=f.trim();if(!u)return[];try{f=JSON.parse(u)}catch(j){return[]}}return Array.isArray(f)?f:[]},ft=s=>{if(s==null||s==="")return[];let f=s;if(typeof f=="string"){const u=f.trim();if(!u)return[];try{f=JSON.parse(u)}catch(j){return[]}}return f&&typeof f=="object"&&!Array.isArray(f)&&(f=Object.entries(f).map(([u,j])=>({key:u,value:j}))),Array.isArray(f)?f:[]},$t=(s,f={})=>{var O;const u=ft(s).map(k=>{var Y,ue,Q,ie,Be;return{key:String((Q=(ue=(Y=k==null?void 0:k.key)!=null?Y:k==null?void 0:k.name)!=null?ue:k==null?void 0:k.label)!=null?Q:"").trim(),value:String((ie=k==null?void 0:k.value)!=null?ie:"").trim(),unit:String((Be=k==null?void 0:k.unit)!=null?Be:"").trim()}}).filter(k=>!!k.key);if(!u.length)return null;const j=!!f.compact,W=String((O=f.className)!=null?O:"").trim();return React.createElement("div",{className:`ktm-variants-preview${j?" compact":""}${W?" "+W:""}`},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},u.map((k,Y)=>{const ue=k.key,Q=`${k.value||""}${k.unit?(k.value?" ":"")+k.unit:""}`.trim();return React.createElement("div",{key:`${ue}-${Y}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},ue),Q?React.createElement("span",{className:"ktm-chip ktm-chip-option"},Q):null)})))},Lt=(s,f={})=>{var ue;const u=at(s).map(Q=>{var ie;return{name:String((ie=Q==null?void 0:Q.name)!=null?ie:"").trim(),options:Array.isArray(Q==null?void 0:Q.options)?Q.options:[]}}).map(Q=>({...Q,options:Q.options.map(ie=>{var Be;return{label:String((Be=ie==null?void 0:ie.label)!=null?Be:"").trim(),price:Number(ie==null?void 0:ie.price)}}).filter(ie=>!!ie.label)})).filter(Q=>Q.options.length>0);if(!u.length)return null;const j=Number.isFinite(f.maxGroups)?Math.max(1,Math.trunc(f.maxGroups)):u.length,W=Number.isFinite(f.maxOptionsPerGroup)?Math.max(1,Math.trunc(f.maxOptionsPerGroup)):3,O=!!f.compact,k=String((ue=f.className)!=null?ue:"").trim(),Y=u.slice(0,j);return React.createElement("div",{className:`ktm-variants-preview${O?" compact":""}${k?" "+k:""}`},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Y.map((Q,ie)=>{const Be=Q.name||"Bi\u1EBFn th\u1EC3",Je=Q.options.slice(0,W),h=Q.options.length-Je.length;return React.createElement("div",{key:`${Be}-${ie}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Be),Je.map((ke,xt)=>{const Mt=ke.price,Ot=Number.isFinite(Mt)&&Mt>=0?Tt(Math.trunc(Mt)):"",Bt=Ot?`${ke.label} \xB7 ${Ot}`:ke.label;return React.createElement("span",{key:`${Be}-${ie}-${xt}`,className:"ktm-chip ktm-chip-option"},Bt)}),h>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",h))})))},It=(s,f)=>{const u=s._type==="product",j=s._type==="album",W=s._type==="video",O=s.note&&(s.note.toLowerCase().includes("free")||s.note.toLowerCase().includes("gi\u1EA3m")||s.note.toLowerCase().includes("sale")),k=u?$t(s.attributes,{compact:pe==="grid",className:pe==="grid"?"meta text-muted":"text-muted"}):null,Y=u?Lt(s.variants,{compact:pe==="grid",maxOptionsPerGroup:999,className:pe==="grid"?"meta text-muted":"text-muted"}):null;return pe==="grid"?React.createElement("div",{key:s.id||f,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>{Ze(s,"preview"),ln({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${W?"fa-video":"fa-image"} fa-2x text-muted`})),s.price&&React.createElement("div",{className:"price-overlay"},s.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${u?"product":j?"album":"video"}`},u?"SP":j?"\u1EA2nh":"Video"),O&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},s.name),s.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},s.note),k&&React.createElement("div",{style:{marginTop:2}},k),Y&&React.createElement("div",{style:{marginTop:2}},Y),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:je===s.id+"-img"?"copied":"",onClick:()=>C(s.image,s.id,{item:s,action:"copy_image"})},React.createElement("i",{className:"fas fa-image"})),s.price&&React.createElement("button",{className:je===s.id+"-price"?"copied":"",onClick:()=>se(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:s.id||f,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${u?"product":j?"album":"video"}`},u?"S\u1EA3n ph\u1EA9m":j?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},s.image?React.createElement("img",{src:s.image,alt:s.name,className:"thumb",loading:"lazy",onClick:()=>{Ze(s,"preview"),ln({url:s.image,name:s.name,price:s.price,note:s.note,item:s})}}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${W?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},s.name),React.createElement("div",{className:"price-row"},s.price&&React.createElement("span",{className:"price"},s.price.replace(/[đ\s]/g,""),"\u0111"),O&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I")),k&&React.createElement("div",{style:{marginTop:4}},k),Y&&React.createElement("div",{style:{marginTop:4}},Y)),React.createElement("div",{className:"meta"},s.code&&React.createElement("span",{className:"meta-tag"},"#",s.code),s.category&&React.createElement("span",{className:"meta-tag"},s.category),s.note&&React.createElement("span",{className:"meta-tag highlight"},s.note),s.folder&&React.createElement("span",{className:"meta-tag"},s.folder),W&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},u&&React.createElement("button",{onClick:()=>{Ze(s,"create_order"),R&&R("orders","create",{productId:s.id})}},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),s.price&&React.createElement("button",{className:je===s.id+"-price"?"copied":"",onClick:()=>se(s.price.replace(/[đ\s]/g,""),s.id+"-price",{item:s,action:"copy_price"})},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:je===s.id+"-name"?"copied":"",onClick:()=>se(s.name,s.id+"-name",{item:s,action:"copy_name"})},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),W&&s.youtubeId&&React.createElement("button",{className:je===s.id+"-yt"?"copied":"",onClick:()=>se(`https://www.youtube.com/watch?v=${s.youtubeId}`,s.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),u&&React.createElement("button",{className:"action-edit",onClick:()=>E(s)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>we(s)},React.createElement("i",{className:"fas fa-trash"}))))},[dn,gn]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"search-suggestions mobile-only"},React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"G\u1EE3i \xFD nhanh"),React.createElement("div",{className:"search-suggestions-row"},[{label:"van 2 tay",query:"van 2 tay"},{label:"combo r\u1EBB",query:"combo r\u1EBB"},{label:"xylanh",query:"xylanh"},{label:"sdt:\u2026",query:"sdt:",caret:"end",addToHistory:!1},{label:"#m\xE3\u2026",query:"#",caret:"end",addToHistory:!1}].map(s=>React.createElement("button",{key:s.label,type:"button",className:"suggestion-chip",onClick:()=>hn(s.query,{caret:s.caret,addToHistory:s.addToHistory,focus:!1})},s.label)))),nn.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"S\u1EA3n ph\u1EA9m hay t\xECm"),React.createElement("div",{className:"search-suggestions-row"},nn.map(s=>{var W,O;const f=(((W=s.item)==null?void 0:W.name)||s.name||"").trim();if(!f)return null;const u=String(((O=s.item)==null?void 0:O.code)||s.code||"").trim(),j=u?`#${u}`:f;return React.createElement("button",{key:s.id,type:"button",className:"suggestion-chip suggestion-chip-popular",onClick:()=>{s.item&&Ze(s.item,"suggestion"),hn(j,{caret:"end",focus:!1})},title:u?`#${u}`:f},f)}))),Vt.length>0&&React.createElement("div",{className:"search-suggestions-section"},React.createElement("div",{className:"search-suggestions-label"},"T\xECm g\u1EA7n \u0111\xE2y / hay d\xF9ng"),React.createElement("div",{className:"search-suggestions-row"},Vt.map(s=>React.createElement("button",{key:s.q,type:"button",className:"suggestion-chip suggestion-chip-query",onClick:()=>hn(s.q,{caret:"end",focus:!1}),title:`${s.q} (${s.count})`},s.q))))),React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,ne.length)," k\u1EBFt qu\u1EA3",gt&&L.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Xe!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Xe==="product"?"S\u1EA3n ph\u1EA9m":Xe==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${pe==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Ke("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${pe==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>Ke("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},K?React.createElement("div",null,[...Array(8)].map((s,f)=>React.createElement("div",{key:f,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):ne.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',L,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{ye(""),dt("")}},"Xem t\u1EA5t c\u1EA3")):pe==="grid"?React.createElement("div",{className:"product-grid-mobile"},ne.map((s,f)=>It(s,f))):React.createElement("div",null,ne.map((s,f)=>It(s,f)))),dn&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>gn(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Xe==="all"?"active":""}`,onClick:()=>{xe("all"),gn(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Xe==="product"?"active":""}`,onClick:()=>{xe("product"),gn(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Xe==="album"?"active":""}`,onClick:()=>{xe("album"),gn(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Xe==="video"?"active":""}`,onClick:()=>{xe("video"),gn(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:gt,onChange:s=>Et(s.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:De,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh... (/ \u0111\u1EC3 focus, Ctrl+K palette)",value:L,onChange:s=>dt(s.target.value)}),React.createElement("button",{className:`filter-btn ${dn||Xe!=="all"?"active":""}`,onClick:()=>gn(!dn)},React.createElement("i",{className:"fas fa-filter"})))),S&&React.createElement("div",{className:"search-palette-overlay",onClick:()=>B(!1)},React.createElement("div",{className:"search-palette",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"palette-header"},React.createElement("input",{ref:F,type:"text",className:"palette-input",placeholder:"\u{1F50D} T\xECm ki\u1EBFm n\xE2ng cao... (filter: \u1EA3nh, video; t\u1EEB kh\xF3a...)",value:Me,onChange:s=>dt(s.target.value),onKeyDown:s=>{s.key==="Enter"&&ne.length>0?(Ye(Me),B(!1)):s.key==="Escape"&&B(!1)}}),React.createElement("button",{className:"palette-close",onClick:()=>B(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"palette-body"},React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"Lo\u1EA1i"),React.createElement("div",{className:"filter-chips-row"},["T\u1EA5t c\u1EA3","S\u1EA3n ph\u1EA9m","\u1EA2nh","Video"].map((s,f)=>React.createElement("span",{key:s,className:`filter-chip ${Xe===["all","product","album","video"][f]?"active":""}`,onClick:()=>{xe(["all","product","album","video"][f])}},s)))),oe.length>0&&!Me.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-star me-1"}),"T\xECm ki\u1EBFm \u0111\xE3 l\u01B0u"),React.createElement("div",{className:"palette-items"},oe.map((s,f)=>React.createElement("div",{key:f,className:"palette-item",onClick:()=>{dt(s),Ye(s)}},React.createElement("i",{className:"fas fa-star"}),React.createElement("span",null,s),React.createElement("button",{className:"unsave-btn",onClick:u=>{u.stopPropagation(),qt(s)}},React.createElement("i",{className:"fas fa-trash-alt"})))))),ge.length>0&&!Me.trim()&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},React.createElement("i",{className:"fas fa-clock me-1"}),"L\u1ECBch s\u1EED t\xECm ki\u1EBFm"),React.createElement("div",{className:"palette-items"},ge.map((s,f)=>React.createElement("div",{key:f,className:"palette-item",onClick:()=>{dt(s)}},React.createElement("i",{className:"fas fa-history"}),React.createElement("span",null,s),React.createElement("button",{className:"save-btn",onClick:u=>{u.stopPropagation(),qt(s)}},React.createElement("i",{className:`fas fa-star${oe.includes(s)?"":"-o"}`})))))),Me.trim()&&ne.length>0&&React.createElement("div",{className:"palette-section"},React.createElement("div",{className:"section-label"},"K\u1EBFt qu\u1EA3 (",ne.length,")"),React.createElement("div",{className:"palette-items",style:{maxHeight:300,overflowY:"auto"}},ne.slice(0,8).map((s,f)=>React.createElement("div",{key:s.id||f,className:"palette-result-item",onClick:()=>{Ye(Me),B(!1)}},s.image&&React.createElement("img",{src:s.image,alt:s.name,className:"result-thumb"}),React.createElement("div",{className:"result-text"},React.createElement("div",{className:"result-name"},s.name),s.price&&React.createElement("div",{className:"result-meta"},s.price.replace(/[đ\s]/g,""),"\u0111")),React.createElement("button",{className:"save-btn",onClick:u=>{u.stopPropagation(),qt(Me)}},React.createElement("i",{className:`fas fa-star${oe.includes(Me)?"":"-o"}`})))))),Me.trim()&&ne.length===0&&React.createElement("div",{className:"palette-empty"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3 cho "',Me,'"'))),React.createElement("div",{className:"palette-footer"},React.createElement("span",null,React.createElement("kbd",null,"Esc")," \u0111\u1EC3 \u0111\xF3ng"),React.createElement("span",null,React.createElement("kbd",null,"Enter")," \u0111\u1EC3 l\u01B0u v\xE0o l\u1ECBch s\u1EED")))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:c?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>St(!0),onTouchStart:()=>St(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),We&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>St(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},Rt.map((s,f)=>React.createElement("div",{key:f,className:`mb-3 ${s.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${s.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:s.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},s.content,s.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:je===`chat-${f}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:je===`chat-${f}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(s.content),ze(`chat-${f}`),setTimeout(()=>ze(null),1500)}},React.createElement("i",{className:`fas ${je===`chat-${f}`?"fa-check":"fa-copy"}`})),s.attachments&&s.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},s.attachments.map((u,j)=>React.createElement("div",{key:j,style:{width:70},className:"text-center"},u.image&&React.createElement("img",{src:u.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>ln({url:u.image,name:u.name,price:u.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},u.name),u.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},u.price.replace(/[đ\s]/g,""),"\u0111"))))))),Ct&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Ft})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(s=>React.createElement("button",{key:s,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>ce(s),disabled:Ct,style:{whiteSpace:"nowrap"}},s))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:s=>{s.preventDefault(),ce(rt)},className:"chat-input-wrap"},React.createElement("input",{ref:un,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:rt,onChange:s=>Qt(s.target.value),disabled:Ct}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Ct||!rt.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),nt&&React.createElement("div",{className:"preview-modal",onClick:()=>ln(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>ln(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:s=>s.stopPropagation()},React.createElement("img",{src:nt.url,alt:nt.name})),React.createElement("div",{className:"preview-footer",onClick:s=>s.stopPropagation()},React.createElement("div",{className:"name"},nt.name),nt.price&&React.createElement("div",{className:"price"},nt.price.replace(/[đ\s]/g,""),"\u0111"),nt.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},nt.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:je==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:je==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>C(nt.url,"preview")},React.createElement("i",{className:`fas ${je==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),nt.price&&React.createElement("button",{className:je==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>se(nt.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${je==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(pt,{show:p,product:z,categories:Le,onClose:()=>{M(!1),q(null)},onSave:le}),React.createElement("div",{className:`fab-container mobile-only ${c?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{w(!1),M(!0),q(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{w(!1),R&&R("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${c?"open":""}`,onClick:()=>w(!c)},React.createElement("i",{className:"fas fa-plus"}))),Mn&&lt&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>yn(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:b.name,onChange:s=>x({...b,name:s.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:b.code,onChange:s=>x({...b,code:s.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:b.price,onChange:s=>x({...b,price:s.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:b.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:s=>x({...b,commission_percent:s.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:b.category,onChange:s=>x({...b,category:s.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),T.map(s=>React.createElement("option",{key:s,value:s},s)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:b.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:s=>x({...b,note:s.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>yn(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:ee},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:_,showToast:R}){const[L,ye]=useState([]),[ne,V]=useState([]),[H,Oe]=useState(!0),[Le,Ce]=useState(null),[Xe,tt]=useState(!1),[je,ze]=useState(null),[pe,Ke]=useState(!1),[K,mt]=useState(null),[yt,wt]=useState(!1),[He,et]=useState(null),[De,gt]=useState(!1),[Et,tn]=useState(!1),[Qe,Kt]=useState(null),[jt,A]=useState(!1),[S,B]=useState(null),[ge,Ne]=useState([]);useEffect(()=>{oe()},[]);const oe=async($=null)=>{Oe(!0);try{const ae=$?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${$}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,Ye=await window.KTM.api.getJSON(ae,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");ye(Array.isArray(Ye)?Ye:[])}catch(ae){console.error(ae),R("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}Oe(!1)},me=async $=>{try{const ae=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${$}`,"L\u1ED7i t\u1EA3i video");V(Array.isArray(ae)?ae:[])}catch(ae){console.error(ae)}},Me=async $=>{if($===0)return;const ae=[...L];[ae[$-1],ae[$]]=[ae[$],ae[$-1]],ye(ae),await F(ae)},N=async $=>{if($===L.length-1)return;const ae=[...L];[ae[$],ae[$+1]]=[ae[$+1],ae[$]],ye(ae),await F(ae)},F=async $=>{try{await Promise.all($.map((ae,Ye)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${ae.id}`,{sortOrder:Ye},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),R("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(ae){R("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),oe(S==null?void 0:S.id)}},J=async $=>{if($===0)return;const ae=[...ne];[ae[$-1],ae[$]]=[ae[$],ae[$-1]],V(ae),await Ie(ae)},re=async $=>{if($===ne.length-1)return;const ae=[...ne];[ae[$],ae[$+1]]=[ae[$+1],ae[$]],V(ae),await Ie(ae)},Ie=async $=>{try{await Promise.all($.map((ae,Ye)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${ae.id}`,{sort_order:Ye},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),R("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(ae){R("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),me(Le.id)}},Te=()=>{ze(null),tt(!0)},Ue=$=>{Kt($),tn(!0),A(!0)},We=async($,ae="modal")=>{try{!je&&S&&($.parent_id=S.id);const Ye=je?`${API_BASE}/api/video-folders/${je.id}`:`${API_BASE}/api/video-folders`;je?await window.KTM.api.putJSON(Ye,$,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(Ye,$,"L\u1ED7i l\u01B0u folder"),R(je?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),ae==="drawer"?(A(!1),ze(null),oe(S==null?void 0:S.id),je&&Qe&&Kt({...Qe,...$})):(tt(!1),ze(null),oe(S==null?void 0:S.id))}catch(Ye){R(Ye.message,"danger")}},St=async $=>{const ae=$.subfolderCount>0?`X\xF3a folder "${$.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${$.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(ae))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${$.id}`,"L\u1ED7i x\xF3a folder"),R("\u0110\xE3 x\xF3a folder","success"),Ce(null),oe(S==null?void 0:S.id)}catch(Ye){R("L\u1ED7i x\xF3a folder","danger")}},Rt=$=>{$.subfolderCount>0?(Ne(ae=>[...ae,$]),B($),oe($.id)):(Ce($),V($.videos||[]))},_e=$=>{if($==="root")Ne([]),B(null),oe(null);else if($){const ae=ge.findIndex(Ye=>Ye.id===$.id);ae>=0&&(Ne(ge.slice(0,ae+1)),B($),oe($.id))}else{const ae=[...ge];ae.pop();const Ye=ae[ae.length-1]||null;Ne(ae),B(Ye),oe(Ye==null?void 0:Ye.id)}},rt=()=>{tn(!1),A(!1),Kt(null)},Qt=()=>{wt(!1),gt(!1),et(null)},Ct=()=>{mt(null),Ke(!0)},on=$=>{et($),wt(!0),gt(!0)},Ft=async($,ae="modal")=>{try{$.folder_id=Le==null?void 0:Le.id;const Ye=K?`${API_BASE}/api/videos/${K.id}`:`${API_BASE}/api/videos`;K?await window.KTM.api.putJSON(Ye,$,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(Ye,$,"L\u1ED7i l\u01B0u video"),R(K?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),ae==="drawer"?(gt(!1),mt(null),oe(),Le&&me(Le.id),K&&He&&et({...He,...$})):(Ke(!1),mt(null),oe(),Le&&me(Le.id))}catch(Ye){R(Ye.message,"danger")}},un=async $=>{if(confirm(`X\xF3a video "${$.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${$.id}`,"L\u1ED7i x\xF3a video"),R("\u0110\xE3 x\xF3a video","success"),oe(),Le&&me(Le.id)}catch(ae){R("L\u1ED7i x\xF3a video","danger")}},fn=$=>{const ae=`https://www.youtube.com/watch?v=${$.youtubeId}`;window.KTM.clipboard.writeText(ae).then(()=>{R("\u0110\xE3 copy link!","success")}).catch(()=>{R("Kh\xF4ng th\u1EC3 copy link","danger")})};return Le?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Ce(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${Le.slug==="shorts"?"text-danger":"text-warning"}`}),Le.name)),React.createElement("button",{className:"btn btn-warning",onClick:Ct},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),ne.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},ne.map(($,ae)=>React.createElement("div",{key:$.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>J(ae),disabled:ae===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},ae+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>re(ae),disabled:ae===ne.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:$.thumb,className:"card-img-top",alt:$.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${$.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:$.title},$.title),React.createElement("small",{className:"text-muted"},$.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>fn($),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>on($),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>un($),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:pe,video:K,onClose:()=>Ke(!1),onSave:Ft}),React.createElement(AdminDrawer,{open:Et,title:Qe?Qe.name:"Folder",subtitle:Qe?`${Qe.subfolderCount||0} subfolder \u2022 ${Qe.videoCount||0} videos`:"",onClose:rt,footer:jt?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:rt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{Qe&&We({name:Qe.name||"",description:Qe.description||"",sortOrder:Qe.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):Qe?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(Qe.name),R("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{A(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a folder "${Qe.name}"?`)&&(St(Qe),rt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},jt&&Qe?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:Qe.name||"",onChange:$=>Kt({...Qe,name:$.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:Qe.description||"",onChange:$=>Kt({...Qe,description:$.target.value})}))):Qe?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},Qe.name),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},Qe.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},Qe.subfolderCount||0),React.createElement("div",{className:"k"},"Video"),React.createElement("div",{className:"v"},Qe.videoCount||0))),Qe.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,Qe.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement(AdminDrawer,{open:yt,title:He?He.title:"Video",subtitle:He?`${He.youtubeId}`:"",onClose:Qt,footer:De?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:Qt},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{He&&Ft({youtube_url:`https://www.youtube.com/watch?v=${He.youtubeId}`,title:He.title||"",thumbnail_url:He.thumb||"",sort_order:He.sortOrder||0},"drawer")}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):He?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const $=`https://www.youtube.com/watch?v=${He.youtubeId}`;window.KTM.clipboard.writeText($).then(()=>{R("\u0110\xE3 copy link!","success")})}},React.createElement("i",{className:"fas fa-link me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{gt(!0)}},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{confirm(`X\xF3a video "${He.title}"?`)&&(un(He),Qt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},De&&He?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:He.title||"",onChange:$=>et({...He,title:$.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"YouTube ID"),React.createElement("input",{type:"text",className:"form-control",value:He.youtubeId||"",onChange:$=>et({...He,youtubeId:$.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:He.sortOrder||0,onChange:$=>et({...He,sortOrder:parseInt($.target.value)||0})}))):He?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Ti\xEAu \u0111\u1EC1"),React.createElement("div",{className:"v"},He.title),React.createElement("div",{className:"k"},"YouTube ID"),React.createElement("div",{className:"v font-monospace"},He.youtubeId),React.createElement("div",{className:"k"},"Th\u1EE9 t\u1EF1"),React.createElement("div",{className:"v"},He.sortOrder||0))),He.thumb&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"Thumbnail"),React.createElement("img",{src:He.thumb,alt:He.title,className:"rounded w-100",style:{maxHeight:200,objectFit:"cover"}}))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"))):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},S&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>_e()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),S?S.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:Te},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),ge.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:$=>{$.preventDefault(),_e("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),ge.map(($,ae)=>React.createElement("li",{key:$.id,className:`breadcrumb-item ${ae===ge.length-1?"active":""}`},ae===ge.length-1?$.name:React.createElement("a",{href:"#",onClick:Ye=>{Ye.preventDefault(),_e($)},className:"text-warning"},$.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),H?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):L.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},S?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Te},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",S?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},L.map(($,ae)=>{var Ye,qt,pn,Xt;return React.createElement("div",{key:$.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Jt=>{Jt.stopPropagation(),Me(ae)},disabled:ae===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},ae+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Jt=>{Jt.stopPropagation(),N(ae)},disabled:ae===L.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>Rt($),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${$.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},$.name),React.createElement("p",{className:"text-muted mb-0"},$.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),$.subfolderCount," folder"),$.subfolderCount>0&&($.videoCount>0||((Ye=$.videos)==null?void 0:Ye.length)>0)&&" \u2022 ",($.videoCount>0||((qt=$.videos)==null?void 0:qt.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),$.videoCount||((pn=$.videos)==null?void 0:pn.length)||0," videos"),$.subfolderCount===0&&!$.videoCount&&!((Xt=$.videos)!=null&&Xt.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Jt=>{Jt.stopPropagation(),Ue($)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Jt=>{Jt.stopPropagation(),St($)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Xe,folder:je,onClose:()=>tt(!1),onSave:We}))}function VideoFolderModal({show:_,folder:R,onClose:L,onSave:ye}){const[ne,V]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[H,Oe]=useState(!1),[Le,Ce]=useState(!1);useEffect(()=>{V(R?{name:R.name||"",description:R.description||"",sortOrder:R.sortOrder||0,coverImage:R.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[R,_]);const Xe=async je=>{const ze=je.target.files[0];if(ze){Ce(!0);try{const pe=await window.KTM.cloudinary.uploadImage({file:ze,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});pe.secure_url&&V(Ke=>({...Ke,coverImage:pe.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(pe){console.error("Cloudinary upload error:",pe),alert("L\u1ED7i upload \u1EA3nh: "+(pe.message||pe))}finally{Ce(!1)}}},tt=async je=>{je.preventDefault(),Oe(!0);const ze={...ne,variants:normalizeVariants(ne.variants,ne.price),attributes:normalizeAttributes(ne.attributes)};await ye(ze),Oe(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},R?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:tt},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:ne.name,onChange:je=>V({...ne,name:je.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:ne.description,onChange:je=>V({...ne,description:je.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ne.sortOrder,onChange:je=>V({...ne,sortOrder:parseInt(je.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},ne.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:ne.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>V({...ne,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Xe,disabled:Le}),Le&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:ne.coverImage,onChange:je=>V({...ne,coverImage:je.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:H},H?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:_,settings:R}){const[L,ye]=useState([]),[ne,V]=useState(!0),[H,Oe]=useState(!1),[Le,Ce]=useState(null),[Xe,tt]=useState(""),[je,ze]=useState(""),[pe,Ke]=useState(!1),[K,mt]=useState(null),yt=normalizeShipPercent(R==null?void 0:R.ship_percent),{parseMoney:wt,formatVND:He}=window.KTM.money,et=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{De()},[]);const De=async()=>{V(!0);try{const N=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");ye(Array.isArray(N)?N:[])}catch(N){console.error(N),_("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}V(!1)},gt=()=>{Ce(null),Oe(!0)},Et=N=>{Ce(N),Oe(!0)},tn=N=>{N&&(mt(N),Ke(!0))},Qe=()=>{Ke(!1)},Kt=async N=>{if(!(!N||!N.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:N},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),_(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),De()}catch(F){_("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},jt=async N=>{try{const F=Le?`${API_BASE}/api/products?id=${Le.id}`:`${API_BASE}/api/products`;Le?await window.KTM.api.putJSON(F,N,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(F,N,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),_(Le?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Oe(!1),De()}catch(F){_(F.message,"danger")}},A=async N=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${N.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${N.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),_("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),De()}catch(F){_(F.message,"danger")}},S=L.filter(N=>{const F=!Xe||N.name.toLowerCase().includes(Xe.toLowerCase())||N.code&&N.code.toLowerCase().includes(Xe.toLowerCase()),J=!je||N.category===je;return F&&J}),B=N=>{var re;const F=(re=N==null?void 0:N.commission_percent)!=null?re:N==null?void 0:N.commissionPercent,J=F===""||F==null?NaN:Number(F);return Number.isFinite(J)?Math.max(0,Math.min(100,J)):5},ge=N=>{const F=B(N),J=Number.isInteger(F)?String(F):String(Math.round(F*100)/100),re=wt(N==null?void 0:N.price);if(!Number.isFinite(re)||re<=0)return`${J}%`;const Ie=(Number(F)||0)/100,Ue=window.KTM.money.parseShipFeeFromNote(N==null?void 0:N.note)!=null?0:yt>0?re*yt/100:0,We=re*Ie-Ue*Ie,St=Math.max(0,Math.round(We));return`${J}% - ${He(St)}`},Ne=N=>{if(N==null||N==="")return[];let F=N;if(typeof F=="string"){const J=F.trim();if(!J)return[];try{F=JSON.parse(J)}catch(re){return[]}}return Array.isArray(F)?F:[]},oe=N=>{if(N==null||N==="")return[];let F=N;if(typeof F=="string"){const J=F.trim();if(!J)return[];try{F=JSON.parse(J)}catch(re){return[]}}return F&&typeof F=="object"&&!Array.isArray(F)&&(F=Object.entries(F).map(([J,re])=>({key:J,value:re}))),Array.isArray(F)?F:[]},me=N=>{const F=oe(N).map(J=>{var re,Ie,Te,Ue,We;return{key:String((Te=(Ie=(re=J==null?void 0:J.key)!=null?re:J==null?void 0:J.name)!=null?Ie:J==null?void 0:J.label)!=null?Te:"").trim(),value:String((Ue=J==null?void 0:J.value)!=null?Ue:"").trim(),unit:String((We=J==null?void 0:J.unit)!=null?We:"").trim()}}).filter(J=>!!J.key);return F.length?React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-sliders-h"}),React.createElement("div",{className:"ktm-variants-chips"},F.map((J,re)=>{const Ie=J.key,Te=`${J.value||""}${J.unit?(J.value?" ":"")+J.unit:""}`.trim();return React.createElement("div",{key:`${Ie}-${re}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},Ie),Te?React.createElement("span",{className:"ktm-chip ktm-chip-option"},Te):null)}))):null},Me=(N,F={})=>{const J=Ne(N).map(Ue=>{var We;return{name:String((We=Ue==null?void 0:Ue.name)!=null?We:"").trim(),options:Array.isArray(Ue==null?void 0:Ue.options)?Ue.options:[]}}).map(Ue=>({...Ue,options:Ue.options.map(We=>{var St;return{label:String((St=We==null?void 0:We.label)!=null?St:"").trim(),price:Number(We==null?void 0:We.price)}}).filter(We=>!!We.label)})).filter(Ue=>Ue.options.length>0);if(!J.length)return null;const re=Number.isFinite(F.maxGroups)?Math.max(1,Math.trunc(F.maxGroups)):J.length,Ie=Number.isFinite(F.maxOptionsPerGroup)?Math.max(1,Math.trunc(F.maxOptionsPerGroup)):4,Te=J.slice(0,re);return React.createElement("div",{className:"ktm-variants-preview"},React.createElement("i",{className:"fas fa-layer-group"}),React.createElement("div",{className:"ktm-variants-chips"},Te.map((Ue,We)=>{const St=Ue.name||"Bi\u1EBFn th\u1EC3",Rt=Ue.options.slice(0,Ie),_e=Ue.options.length-Rt.length;return React.createElement("div",{key:`${St}-${We}`,className:"ktm-variants-group"},React.createElement("span",{className:"ktm-chip ktm-chip-group"},St),Rt.map((rt,Qt)=>{const Ct=rt.price,on=Number.isFinite(Ct)&&Ct>=0?He(Math.trunc(Ct)):"",Ft=on?`${rt.label} \xB7 ${on}`:rt.label;return React.createElement("span",{key:`${St}-${We}-${Qt}`,className:"ktm-chip ktm-chip-option"},Ft)}),_e>0&&React.createElement("span",{className:"ktm-chip ktm-chip-more"},"+",_e))})))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:gt},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:Xe,onChange:N=>tt(N.target.value)})),React.createElement("span",{className:"product-count"},S.length)),React.createElement("select",{className:"form-select",value:je,onChange:N=>ze(N.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),et.map(N=>React.createElement("option",{key:N,value:N},N)))),ne?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):S.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:gt},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},S.map(N=>React.createElement("div",{key:N.id,className:"product-item d-flex align-items-center gap-3",role:"button",tabIndex:0,onClick:()=>tn(N),onKeyDown:F=>{(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),tn(N))},title:"Xem chi ti\u1EBFt"},N.image?React.createElement("img",{src:N.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},N.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},N.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},N.category),N.code&&React.createElement("span",{className:"product-badge bg-secondary"},N.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),ge(N))),React.createElement("div",{className:"product-price"},N.price?N.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),N.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},N.note),me(N.attributes)&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},me(N.attributes)),Me(N.variants,{maxOptionsPerGroup:4})&&React.createElement("div",{className:"mt-1",style:{fontSize:"0.75rem"}},Me(N.variants,{maxOptionsPerGroup:4}))),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:F=>{F.stopPropagation(),Et(N)},title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:F=>{F.stopPropagation(),A(N)},title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(AdminDrawer,{open:pe,title:String((K==null?void 0:K.name)||"S\u1EA3n ph\u1EA9m"),subtitle:[String((K==null?void 0:K.code)||"").trim()||null,String((K==null?void 0:K.category)||"").trim()||null].filter(Boolean).join(" \u2022 "),onClose:Qe,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const N=String((K==null?void 0:K.code)||"").trim();N&&window.KTM.clipboard.writeText(N).then(()=>_("\u0110\xE3 copy m\xE3 s\u1EA3n ph\u1EA9m","success"))},disabled:!String((K==null?void 0:K.code)||"").trim(),title:"Copy m\xE3"},React.createElement("i",{className:"fas fa-barcode me-2"}),"Copy m\xE3"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const N=String((K==null?void 0:K.price)||"").trim();N&&window.KTM.clipboard.writeText(N).then(()=>_("\u0110\xE3 copy gi\xE1","success"))},disabled:!String((K==null?void 0:K.price)||"").trim(),title:"Copy gi\xE1"},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy gi\xE1")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>K&&Et(K),disabled:!K},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>K&&A(K),disabled:!K},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a")))},K?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"Gi\xE1"),React.createElement("div",{className:"v"},(()=>{const N=String((K==null?void 0:K.price)||"").trim(),F=wt(N);return Number.isFinite(F)&&F>0?He(Math.trunc(F)):N||"Li\xEAn h\u1EC7"})()),React.createElement("div",{className:"k"},"Hoa h\u1ED3ng"),React.createElement("div",{className:"v"},ge(K)),React.createElement("div",{className:"k"},"Danh m\u1EE5c"),React.createElement("div",{className:"v"},K.category||"\u2014"),React.createElement("div",{className:"k"},"M\xE3"),React.createElement("div",{className:"v"},React.createElement("span",{className:"font-monospace"},K.code||"\u2014")))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-image me-2 text-info"}),"H\xECnh \u1EA3nh"),K.image?React.createElement("img",{src:K.image,alt:"",className:"rounded",style:{width:"100%",maxHeight:260,objectFit:"cover"}}):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 \u1EA3nh")),(String(K.note||"").trim()||K.attributes||K.variants)&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-sliders-h me-2 text-primary"}),"Chi ti\u1EBFt"),String(K.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",String(K.note||"").trim()),me(K.attributes)?React.createElement("div",{className:"mt-2"},me(K.attributes)):null,Me(K.variants,{maxGroups:99,maxOptionsPerGroup:8})?React.createElement("div",{className:"mt-2"},Me(K.variants,{maxGroups:99,maxOptionsPerGroup:8})):null)):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),React.createElement(ProductModal,{show:H,product:Le,categories:et,onClose:()=>Oe(!1),onSave:jt}))}function ProductModal({show:_,product:R,categories:L,onClose:ye,onSave:ne}){const[V,H]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]}),[Oe,Le]=useState(!1),[Ce,Xe]=useState(!1),tt=A=>{const S=window.KTM.money.getDigits(String(A!=null?A:"")),B=Number(S);return S&&Number.isFinite(B)?Math.trunc(B):0},je=A=>{if(A==null||A==="")return[];let S=A;if(typeof S=="string"){const B=S.trim();if(!B)return[];try{S=JSON.parse(B)}catch(ge){return[]}}return S&&typeof S=="object"&&!Array.isArray(S)&&(S=Object.entries(S).map(([B,ge])=>({key:B,value:ge}))),Array.isArray(S)?S.map(B=>{var me,Me,N,F,J;if(!B||typeof B!="object")return null;const ge=String((N=(Me=(me=B.key)!=null?me:B.name)!=null?Me:B.label)!=null?N:"").trim(),Ne=String((F=B.value)!=null?F:"").trim(),oe=String((J=B.unit)!=null?J:"").trim();return ge?{key:ge,value:Ne,unit:oe}:null}).filter(Boolean):[]},ze=(A,S)=>{if(A==null||A==="")return[];let B=A;if(typeof B=="string"){const Ne=B.trim();if(!Ne)return[];try{B=JSON.parse(Ne)}catch(oe){return[]}}if(!Array.isArray(B))return[];const ge=tt(S);return B.map(Ne=>{var Me;if(!Ne||typeof Ne!="object")return null;const oe=String((Me=Ne.name)!=null?Me:"").trim(),me=(Array.isArray(Ne.options)?Ne.options:[]).map(N=>{var Ue,We,St,Rt,_e,rt,Qt;if(!N||typeof N!="object")return null;const F=String((Ue=N.label)!=null?Ue:"").trim();if(!F)return null;const J=(_e=(Rt=(St=(We=N.price)!=null?We:N.priceValue)!=null?St:N.unit_price)!=null?Rt:N.unitPrice)!=null?_e:null,re=Number(J);let Ie=Number.isFinite(re)?Math.trunc(re):null;if(Ie==null){const Ct=(Qt=(rt=N.price_delta)!=null?rt:N.priceDelta)!=null?Qt:null,on=Number(Ct);Number.isFinite(on)&&(Ie=ge+Math.trunc(on))}Ie==null&&(Ie=ge);const Te=String(Math.max(0,Math.trunc(Number(Ie)||0)));return{label:F,price:Math.max(0,Math.trunc(Number(Ie)||0)),priceDigits:Te}}).filter(Boolean);return{name:oe||"Bi\u1EBFn th\u1EC3",options:me}}).filter(Boolean)};useEffect(()=>{var A,S;H(R?{name:R.name||"",code:R.code||"",price:R.price||"",image:R.image||"",category:R.category||"",note:R.note||"",sort_order:R.sort_order||0,commission_percent:(S=(A=R.commission_percent)!=null?A:R.commissionPercent)!=null?S:5,variants:ze(R.variants,R.price),attributes:je(R.attributes)}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5,variants:[],attributes:[]})},[R,_]);const pe=A=>{H(S=>{var me;const B=tt(S.price),ge=String(B),Ne=Array.isArray(S.variants)?[...S.variants]:[],oe={...Ne[A]||{},options:Array.isArray((me=Ne[A])==null?void 0:me.options)?[...Ne[A].options]:[]};return oe.options=oe.options.map(Me=>({label:String((Me==null?void 0:Me.label)||""),price:B,priceDigits:ge})),Ne[A]=oe,{...S,variants:Ne}})},Ke=()=>{H(A=>{const S=tt(A.price),B=String(S),Ne=(Array.isArray(A.variants)?[...A.variants]:[]).map(oe=>{const me=(Array.isArray(oe==null?void 0:oe.options)?oe.options:[]).map(Me=>({label:String((Me==null?void 0:Me.label)||""),price:S,priceDigits:B}));return{name:String((oe==null?void 0:oe.name)||"Bi\u1EBFn th\u1EC3"),options:me}});return{...A,variants:Ne}})},[K,mt]=React.useState(""),yt=A=>window.KTM.money.formatVNDInputDigits(A),[wt,He]=React.useState(""),et=A=>{const S=window.KTM.money.nextPriceInputState(A.target.value,wt);He(S.digits),H({...V,price:S.price})},[De,gt]=React.useState("");React.useEffect(()=>{R!=null&&R.image&&gt(R.image)},[R]);const Et=async A=>{if(!(!A||!A.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:A},"L\u1ED7i x\xF3a \u1EA3nh")}catch(S){console.error("Delete cloudinary image error:",S)}},tn=async(A,S=2,B)=>{const ge=S*1024*1024,Ne=A.type==="image/heic"||A.type==="image/heif"||/\.heic$/i.test(A.name);if(A.size<=ge&&!Ne)return A;B==null||B("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const oe=await createImageBitmap(A);B==null||B("\u0110ang n\xE9n \u1EA3nh...");const me=document.createElement("canvas");let Me=oe.width,N=oe.height;const F=1200;return(Me>F||N>F)&&(Me>N?(N=Math.round(N/Me*F),Me=F):(Me=Math.round(Me/N*F),N=F)),me.width=Me,me.height=N,me.getContext("2d").drawImage(oe,0,0,Me,N),oe.close(),new Promise((re,Ie)=>{me.toBlob(Te=>{Te?(B==null||B("Ho\xE0n t\u1EA5t!"),re(new File([Te],A.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):Ie(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(oe){throw console.error("createImageBitmap error:",oe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Qe=async A=>{var ge,Ne;const S=(ge=A.target.files)==null?void 0:ge[0];if(!S)return;if(!(S.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(S.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Xe(!0),mt("\u0110ang chu\u1EA9n b\u1ECB...");try{const oe=(S.size/1024/1024).toFixed(1);mt(`File ${oe}MB - \u0110ang n\xE9n...`);const me=await tn(S,2,F=>{mt(F)}),Me=(me.size/1024/1024).toFixed(1);mt(`\u0110\xE3 n\xE9n: ${Me}MB - \u0110ang upload...`);const N=await window.KTM.cloudinary.uploadImage({file:me,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});N.secure_url?(V.image&&V.image!==De&&Et(V.image),H(F=>({...F,image:N.secure_url})),mt("")):(console.error("Cloudinary error:",N),alert("Upload th\u1EA5t b\u1EA1i: "+(((Ne=N.error)==null?void 0:Ne.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),mt(""))}catch(oe){console.error("Upload error:",oe),alert("L\u1ED7i: "+oe.message),mt("")}Xe(!1),A.target.value=""},Kt=()=>{V.image&&(V.image!==De&&Et(V.image),H(A=>({...A,image:""})))},jt=async A=>{A.preventDefault(),Le(!0),De&&V.image&&De!==V.image&&await Et(De),De&&!V.image&&await Et(De),await ne(V),Le(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${R?"fa-edit":"fa-plus-circle"} me-2`}),R?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:ye})),React.createElement("form",{onSubmit:jt},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},V.image?React.createElement(React.Fragment,null,React.createElement("img",{src:V.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:Kt,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${Ce?"fa-spinner fa-spin":"fa-camera"} me-1`}),Ce?K||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:Qe,disabled:Ce,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),Ce&&K&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},K))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:V.name,onChange:A=>H({...V,name:A.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:V.code,onChange:A=>H({...V,code:A.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:V.price,onChange:et,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:V.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:A=>H({...V,commission_percent:A.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:V.category,onChange:A=>H({...V,category:A.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),L.map(A=>React.createElement("option",{key:A,value:A},A)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:V.note,onChange:A=>H({...V,note:A.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sliders-h me-1 text-secondary"}),"Thu\u1ED9c t\xEDnh (c\xE2n n\u1EB7ng, chi\u1EC1u d\xE0i, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(V.attributes)?V.attributes:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 thu\u1ED9c t\xEDnh. V\xED d\u1EE5: C\xE2n n\u1EB7ng, Chi\u1EC1u d\xE0i, V\u1EADt li\u1EC7u..."):null,(Array.isArray(V.attributes)?V.attributes:[]).map((A,S)=>React.createElement("div",{key:S,className:"row g-2 align-items-center mb-2"},React.createElement("div",{className:"col-5"},React.createElement("input",{type:"text",className:"form-control",value:(A==null?void 0:A.key)||"",onChange:B=>{const ge=B.target.value;H(Ne=>{const oe=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return oe[S]={...oe[S]||{},key:ge},{...Ne,attributes:oe}})},placeholder:"T\xEAn (vd: C\xE2n n\u1EB7ng)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:(A==null?void 0:A.value)||"",onChange:B=>{const ge=B.target.value;H(Ne=>{const oe=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return oe[S]={...oe[S]||{},value:ge},{...Ne,attributes:oe}})},placeholder:"Gi\xE1 tr\u1ECB (vd: 10)",style:{borderRadius:10}})),React.createElement("div",{className:"col-2"},React.createElement("input",{type:"text",className:"form-control",value:(A==null?void 0:A.unit)||"",onChange:B=>{const ge=B.target.value;H(Ne=>{const oe=Array.isArray(Ne.attributes)?[...Ne.attributes]:[];return oe[S]={...oe[S]||{},unit:ge},{...Ne,attributes:oe}})},placeholder:"\u0110\u01A1n v\u1ECB",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{H(B=>{const ge=Array.isArray(B.attributes)?[...B.attributes]:[];return ge.splice(S,1),{...B,attributes:ge}})},title:"X\xF3a thu\u1ED9c t\xEDnh"},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-1",onClick:()=>{H(A=>{const S=Array.isArray(A.attributes)?[...A.attributes]:[];return S.push({key:"",value:"",unit:""}),{...A,attributes:S}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm thu\u1ED9c t\xEDnh"))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-layer-group me-1 text-secondary"}),"Bi\u1EBFn th\u1EC3 (size, ...)"),React.createElement("div",{className:"border rounded-3 p-2",style:{background:"#fff"}},(Array.isArray(V.variants)?V.variants:[]).length===0?React.createElement("div",{className:"text-muted small"},"Ch\u01B0a c\xF3 bi\u1EBFn th\u1EC3."):null,(Array.isArray(V.variants)?V.variants:[]).map((A,S)=>React.createElement("div",{key:S,className:"mb-3"},React.createElement("div",{className:"d-flex gap-2 align-items-center mb-2"},React.createElement("input",{type:"text",className:"form-control",value:(A==null?void 0:A.name)||"",onChange:B=>{const ge=B.target.value;H(Ne=>{var me;const oe=Array.isArray(Ne.variants)?[...Ne.variants]:[];return oe[S]={...oe[S]||{},name:ge,options:Array.isArray((me=oe[S])==null?void 0:me.options)?oe[S].options:[]},{...Ne,variants:oe}})},placeholder:"T\xEAn nh\xF3m (v\xED d\u1EE5: Size)",style:{borderRadius:10}}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>pe(S),title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn trong nh\xF3m",disabled:!Array.isArray(A==null?void 0:A.options)||A.options.length===0},"\u0110\u1ED3ng gi\xE1"),React.createElement("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>{H(B=>{const ge=Array.isArray(B.variants)?[...B.variants]:[];return ge.splice(S,1),{...B,variants:ge}})},title:"X\xF3a nh\xF3m"},React.createElement("i",{className:"fas fa-trash"}))),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(A==null?void 0:A.options)?A.options:[]).map((B,ge)=>{var Ne,oe;return React.createElement("div",{key:ge,className:"row g-2 align-items-center"},React.createElement("div",{className:"col-7"},React.createElement("input",{type:"text",className:"form-control",value:(B==null?void 0:B.label)||"",onChange:me=>{const Me=me.target.value;H(N=>{var Te,Ue,We,St,Rt;const F=Array.isArray(N.variants)?[...N.variants]:[],J={...F[S]||{},options:Array.isArray((Te=F[S])==null?void 0:Te.options)?[...F[S].options]:[]},re=Number((We=(Ue=J.options[ge])==null?void 0:Ue.price)!=null?We:0)||0,Ie=String((Rt=(St=J.options[ge])==null?void 0:St.priceDigits)!=null?Rt:Math.max(0,Math.trunc(re)));return J.options[ge]={...J.options[ge]||{},label:Me,price:Math.max(0,Math.trunc(re)),priceDigits:Ie},F[S]=J,{...N,variants:F}})},placeholder:"Gi\xE1 tr\u1ECB (v\xED d\u1EE5: M)",style:{borderRadius:10}})),React.createElement("div",{className:"col-4"},React.createElement("input",{type:"text",className:"form-control",value:yt(String((oe=B==null?void 0:B.priceDigits)!=null?oe:window.KTM.money.getDigits(String((Ne=B==null?void 0:B.price)!=null?Ne:"")))),onChange:me=>{H(Me=>{var We,St,Rt,_e,rt;const N=String((St=B==null?void 0:B.priceDigits)!=null?St:window.KTM.money.getDigits(String((We=B==null?void 0:B.price)!=null?We:""))),F=window.KTM.money.nextPriceInputState(me.target.value,N),J=String((Rt=F.digits)!=null?Rt:""),re=Number(J),Ie=Number.isFinite(re)?Math.max(0,Math.trunc(re)):0,Te=Array.isArray(Me.variants)?[...Me.variants]:[],Ue={...Te[S]||{},options:Array.isArray((_e=Te[S])==null?void 0:_e.options)?[...Te[S].options]:[]};return Ue.options[ge]={...Ue.options[ge]||{},label:String(((rt=Ue.options[ge])==null?void 0:rt.label)||""),price:Ie,priceDigits:J},Te[S]=Ue,{...Me,variants:Te}})},placeholder:"Gi\xE1 (\u0111)",style:{borderRadius:10}})),React.createElement("div",{className:"col-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{H(me=>{var F;const Me=Array.isArray(me.variants)?[...me.variants]:[],N={...Me[S]||{},options:Array.isArray((F=Me[S])==null?void 0:F.options)?[...Me[S].options]:[]};return N.options.splice(ge,1),Me[S]=N,{...me,variants:Me}})},title:"X\xF3a l\u1EF1a ch\u1ECDn"},React.createElement("i",{className:"fas fa-times"}))))})),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm mt-2",onClick:()=>{H(B=>{var me;const ge=Array.isArray(B.variants)?[...B.variants]:[],Ne={...ge[S]||{},options:Array.isArray((me=ge[S])==null?void 0:me.options)?[...ge[S].options]:[]},oe=tt(B.price);return Ne.options.push({label:"",price:oe,priceDigits:String(oe)}),ge[S]=Ne,{...B,variants:ge}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm l\u1EF1a ch\u1ECDn"))),React.createElement("button",{type:"button",className:"btn btn-outline-warning btn-sm",onClick:()=>{H(A=>{const S=tt(A.price),B=Array.isArray(A.variants)?[...A.variants]:[],ge=String(S);return B.push({name:"Size",options:[{label:"S",price:S,priceDigits:ge},{label:"M",price:S,priceDigits:ge},{label:"L",price:S,priceDigits:ge}]}),{...A,variants:B}})},style:{borderRadius:10}},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm nh\xF3m bi\u1EBFn th\u1EC3"),React.createElement("div",{className:"d-flex gap-2 align-items-center mt-2"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:Ke,disabled:!Array.isArray(V.variants)||V.variants.length===0,style:{borderRadius:10},title:"\u0110\u1EB7t gi\xE1 gi\u1ED1ng gi\xE1 g\u1ED1c s\u1EA3n ph\u1EA9m cho t\u1EA5t c\u1EA3 l\u1EF1a ch\u1ECDn \u1EDF m\u1ECDi nh\xF3m"},"\u0110\u1ED3ng gi\xE1 (t\u1EA5t c\u1EA3)")),React.createElement("div",{className:"text-muted small mt-2"},"Gi\xE1 bi\u1EBFn th\u1EC3 l\xE0 gi\xE1 c\u1EE5 th\u1EC3 (\u0111). V\xED d\u1EE5 Size S: 15.000\u0111, Size M: 25.000\u0111."))),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:V.image,onChange:A=>H({...V,image:A.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:ye,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:Oe,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},Oe?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:_,video:R,onClose:L,onSave:ye}){const[ne,V]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[H,Oe]=useState(!1),[Le,Ce]=useState("");useEffect(()=>{R?(V({title:R.title||"",youtube_url:`https://www.youtube.com/watch?v=${R.youtubeId}`,thumbnail_url:R.thumb||"",sort_order:R.sortOrder||0}),Ce(R.thumb)):(V({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),Ce(""))},[R,_]);const Xe=ze=>{const pe=ze.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return pe?pe[1]:null},tt=ze=>{V({...ne,youtube_url:ze});const pe=Xe(ze);pe&&Ce(`https://img.youtube.com/vi/${pe}/hqdefault.jpg`)},je=async ze=>{ze.preventDefault(),Oe(!0),await ye(ne),Oe(!1)};return _?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},R?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:je},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:ne.youtube_url,onChange:ze=>tt(ze.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),Le&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:Le,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:ne.title,onChange:ze=>V({...ne,title:ze.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:ne.sort_order,onChange:ze=>V({...ne,sort_order:parseInt(ze.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:ne.thumbnail_url,onChange:ze=>V({...ne,thumbnail_url:ze.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:L},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:H},H?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function getCurrentMonth(){const _=new Date,R=_.getFullYear(),L=String(_.getMonth()+1).padStart(2,"0");return`${R}-${L}`}function ReconExcelManager({showToast:_}){var lt;const R=typeof _=="function"?_:()=>{},[L,ye]=useState(getCurrentMonth()),ne=L,V=ye,[H,Oe]=useState(!1),[Le,Ce]=useState(""),[Xe,tt]=useState(""),[je,ze]=useState(""),[pe,Ke]=useState(null),[K,mt]=useState("all"),[yt,wt]=useState(""),[He,et]=useState(!0),[De,gt]=useState(!0),[Et,tn]=useState(!1),[Qe,Kt]=useState("created_at"),[jt,A]=useState(!1),[S,B]=useState(0),[ge,Ne]=useState(!1),[oe,me]=useState(""),[Me,N]=useState(()=>new Set),[F,J]=useState(!1),[re,Ie]=useState(null),Te=useRef(new Map),Ue=useRef(new Map),We=useRef(null),[St,Rt]=useState(()=>{var r;return(r=window==null?void 0:window.XLSX)!=null&&r.read?"ready":"loading"}),_e=r=>new Promise((c,w)=>{var p;try{if(!r)return c();const M=String(r),z=document.querySelector(`script[data-ktm-src="${M}"]`)||document.querySelector(`script[src="${M}"]`);if(z){if(z.getAttribute("data-ktm-loaded")==="1"||(p=window==null?void 0:window.XLSX)!=null&&p.read)return c();z.addEventListener("load",()=>c(),{once:!0}),z.addEventListener("error",()=>w(new Error(`Failed to load ${M}`)),{once:!0});return}const q=document.createElement("script");q.src=M,q.async=!0,q.defer=!0,q.setAttribute("data-ktm-src",M),q.addEventListener("load",()=>{q.setAttribute("data-ktm-loaded","1"),c()},{once:!0}),q.addEventListener("error",()=>w(new Error(`Failed to load ${M}`)),{once:!0}),document.head.appendChild(q)}catch(M){w(M)}}),rt=()=>!!(window!=null&&window.XLSX&&typeof window.XLSX.read=="function"),Qt=async()=>{if(rt())return Rt("ready"),!0;if(We.current)return We.current;const r=["https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js","https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js","https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"],c=async w=>{const p=Date.now();for(;Date.now()-p<w;){if(rt())return!0;await new Promise(M=>setTimeout(M,50))}return rt()};return Rt("loading"),We.current=(async()=>{try{for(const w of r)try{if(await _e(w),await c(1500))return Rt("ready"),!0}catch(p){}return Rt("failed"),!1}finally{We.current=null}})(),We.current};useEffect(()=>{if(rt()){Rt("ready");return}Qt()},[]);const Ct=r=>{const c=[],w=String(r!=null?r:"").split(/\s+/g);for(const p of w){const M=String(p||"").trim();M&&c.push(M)}return c.join(" ").replace(/\s+/g," ").trim()},on=r=>{try{return String(r!=null?r:"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,c=>c==="\u0111"?"d":"D")}catch(c){return String(r!=null?r:"").replace(/[đĐ]/g,w=>w==="\u0111"?"d":"D")}},Ft=r=>{const c=Ct(String(r!=null?r:""));return c?on(c).toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim():""},un=r=>{const c=Ft(r);return c?c.replace(/\b(combo|set|sp|san\s*pham|sanpham|hang|ship|freeship|free\s*ship)\b/g," ").replace(/\s+/g," ").trim():""},fn=r=>{var z,q;if(r==null||r==="")return"";if(typeof r=="number"&&Number.isFinite(r)&&((q=(z=window==null?void 0:window.XLSX)==null?void 0:z.SSF)!=null&&q.parse_date_code))try{const b=window.XLSX.SSF.parse_date_code(r);return!b||!b.y||!b.m?"":`${String(b.y).padStart(4,"0")}-${String(b.m).padStart(2,"0")}`}catch(b){}const c=String(r).trim(),w=c.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(w){const b=String(Number(w[2])||0).padStart(2,"0");return`${w[3]}-${b}`}const p=c.match(/^(\d{4})-(\d{2})-(\d{2})/);if(p)return`${p[1]}-${p[2]}`;const M=new Date(c);return Number.isNaN(M.getTime())?"":`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}`},$=r=>{var z,q;if(r==null||r==="")return"";if(typeof r=="number"&&Number.isFinite(r)&&((q=(z=window==null?void 0:window.XLSX)==null?void 0:z.SSF)!=null&&q.parse_date_code))try{const b=window.XLSX.SSF.parse_date_code(r);return!b||!b.y||!b.m||!b.d?"":`${String(b.y).padStart(4,"0")}-${String(b.m).padStart(2,"0")}-${String(b.d).padStart(2,"0")}`}catch(b){}const c=String(r).trim(),w=c.match(/^(\d{1,2})[\.\/\-](\d{1,2})[\.\/\-](\d{4})$/);if(w){const b=String(Number(w[1])||0).padStart(2,"0"),x=String(Number(w[2])||0).padStart(2,"0");return`${w[3]}-${x}-${b}`}const p=c.match(/^(\d{4})-(\d{2})-(\d{2})/);if(p)return`${p[1]}-${p[2]}-${p[3]}`;const M=new Date(c);return Number.isNaN(M.getTime())?"":`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}-${String(M.getDate()).padStart(2,"0")}`},ae=r=>{if(r==null||r==="")return 0;if(typeof r=="number"&&Number.isFinite(r))return Math.trunc(r);const c=String(r!=null?r:"").trim();if(!c)return 0;try{const z=window.KTM.money.parseMoney(c);if(Number.isFinite(z)&&z>0)return Math.trunc(z)}catch(z){}const p=c.toLowerCase().replace(/vnd|đ|d/g," ").replace(/\s+/g," ").trim().replace(/[^0-9]/g,"");if(!p)return 0;const M=Number(p);return Number.isFinite(M)?Math.trunc(M):0},Ye=r=>{var w,p;let c="";try{(p=(w=window==null?void 0:window.KTM)==null?void 0:w.phone)!=null&&p.normalize&&(c=window.KTM.phone.normalize(r))}catch(M){}return c||(c=String(r!=null?r:"").replace(/[^0-9]/g,"")),c=String(c||"").replace(/[^0-9]/g,""),c?(c.startsWith("840")?c=`0${c.slice(3)}`:c.startsWith("84")&&(c.length===11?c=`0${c.slice(2)}`:c.length===12&&c[2]!=="0"&&(c=`0${c.slice(2)}`)),c.length===9&&(c=`0${c}`),c):""},qt=(r,c)=>{try{const w=Array.isArray(c)?c:[],p=x=>{const T=String(x!=null?x:"");return/[\n\r",]/.test(T)?`"${T.replace(/"/g,'""')}"`:T},M=w.map(x=>Array.isArray(x)?x.map(p).join(","):"").join(`
`),z=new Blob([`\uFEFF${M}`],{type:"text/csv;charset=utf-8"}),q=URL.createObjectURL(z),b=document.createElement("a");b.href=q,b.download=r,document.body.appendChild(b),b.click(),setTimeout(()=>{try{URL.revokeObjectURL(q)}catch(x){}try{b.remove()}catch(x){}},0)}catch(w){}},pn=r=>{const c=String(r!=null?r:"");if(!c.trim())return{phone:"",phoneNorm:"",cleanedText:String(r!=null?r:"").trim()};const w=/(?:\+?84|0)\s*[0-9\s\-.()]{8,16}/g;let p=null,M;for(;(M=w.exec(c))!=null;){const x=M[0],T=Ye(x);T&&(T.length<9||T.length>12||(p={raw:x,digits:T}))}if(!p){const x=Ye(c);if(x.length>=9){const T=x.slice(-12);T.length>=9&&(p={raw:T,digits:T})}}if(!p)return{phone:"",phoneNorm:"",cleanedText:c.trim()};const z=p.digits,q=z;let b=c;return p.raw&&c.includes(p.raw)?b=b.replace(p.raw," "):b=b.replace(new RegExp(`${p.digits}$`)," "),b=b.replace(/[\-–—•|]+\s*$/g," ").replace(/\s+[\-–—•|]+\s*/g," ").replace(/\s+/g," ").trim(),{phone:q,phoneNorm:z,cleanedText:b}},Xt=async()=>{var c;const r=Te.current;if(r&&r.size>0)return r;try{const w=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m"),p=Array.isArray(w==null?void 0:w.products)?w.products:Array.isArray(w)?w:[],M=new Map;for(const z of p){const q=String((c=z==null?void 0:z.id)!=null?c:"").trim();q&&M.set(q,z)}return Te.current=M,M}catch(w){return Te.current=new Map,Te.current}},Jt=r=>{var w;const c=String(r!=null?r:"").trim();return c&&((w=Te.current)==null?void 0:w.get(c))||null},P=async r=>{var x,T,E;if(!r)throw new Error("Ch\u01B0a ch\u1ECDn file");const c=await r.arrayBuffer(),w=Number(r.size||0)||0;if(!!!(window!=null&&window.Worker&&typeof Blob!="undefined"&&typeof URL!="undefined")||w<450*1024){if(!((x=window==null?void 0:window.XLSX)!=null&&x.read))try{await Qt()}catch(ve){}if(!((T=window==null?void 0:window.XLSX)!=null&&T.read))throw new Error("Thi\u1EBFu th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). Vui l\xF2ng t\u1EA3i l\u1EA1i trang admin.");const ee=window.XLSX.read(c,{type:"array"}),we=(E=ee==null?void 0:ee.SheetNames)==null?void 0:E[0],le=we?ee.Sheets[we]:null;if(!le)throw new Error("Kh\xF4ng \u0111\u1ECDc \u0111\u01B0\u1EE3c sheet trong file");return window.XLSX.utils.sheet_to_json(le,{header:1,raw:!0,defval:""})}const M=`
					const sources = [
						'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js',
						'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js',
						'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js',
					];

					const hasXlsx = () => Boolean(self.XLSX && typeof self.XLSX.read === 'function');
					const ensureXlsx = async () => {
						if (hasXlsx()) return true;
						for (const src of sources) {
							try {
								self.importScripts(src);
								if (hasXlsx()) return true;
							} catch (e) {
								// try next
							}
						}
						return hasXlsx();
					};

					self.onmessage = async (ev) => {
						try {
							const data = ev && ev.data;
							const buf = data && data.buf;
							const ok = await ensureXlsx();
							if (!ok) throw new Error('XLSX not available');
							const wb = self.XLSX.read(buf, { type: 'array' });
							const sheetName = wb && wb.SheetNames && wb.SheetNames[0];
							const ws = sheetName ? wb.Sheets[sheetName] : null;
							if (!ws) throw new Error('No sheet');
							const grid = self.XLSX.utils.sheet_to_json(ws, { header: 1, raw: true, defval: '' });
							self.postMessage({ ok: true, grid });
						} catch (e) {
							self.postMessage({ ok: false, error: String((e && e.message) || e || 'worker error') });
						}
					};
				`,z=new Blob([M],{type:"application/javascript"}),q=URL.createObjectURL(z),b=new Worker(q);try{return await new Promise((we,le)=>{const ve=setTimeout(()=>{try{b.terminate()}catch(Fe){}le(new Error("Worker timeout"))},12e3);b.onmessage=Fe=>{const qe=Fe&&Fe.data;qe&&qe.ok?(clearTimeout(ve),we(qe.grid)):qe&&qe.ok===!1&&(clearTimeout(ve),le(new Error(qe.error||"Worker failed")))},b.onerror=()=>{clearTimeout(ve),le(new Error("Worker error"))};try{b.postMessage({buf:c},[c])}catch(Fe){b.postMessage({buf:c})}})}finally{try{b.terminate()}catch(ee){}try{URL.revokeObjectURL(q)}catch(ee){}}},d=async r=>{var T,E;if(!r)throw new Error("Ch\u01B0a ch\u1ECDn file");const c=await P(r),w=Array.isArray(c)?c:[];if(!w.length)throw new Error("File r\u1ED7ng");const p={product:["ten san pham","tensanpham","san pham","t\xEAn s\u1EA3n ph\u1EA9m"],cod:["tong tien thu ho","t\u1ED5ng ti\u1EC1n thu h\u1ED9","thu ho","thu h\u1ED9","tong thu ho","t\u1ED5ng thu h\u1ED9"],date:["ngay","ng\xE0y","date"],phone:["sdt","s\u0111t","so dien thoai","s\u1ED1 \u0111i\u1EC7n tho\u1EA1i","dien thoai","\u0111i\u1EC7n tho\u1EA1i","phone"],qty:["sl","so luong","s\u1ED1 l\u01B0\u1EE3ng","qty","quantity"]},z=(()=>{const ee=Math.min(30,w.length);for(let we=0;we<ee;we++){const ve=(Array.isArray(w[we])?w[we]:[]).map(it=>Ft(it)),Fe=it=>{for(let de=0;de<ve.length;de++){const Ge=ve[de];if(Ge&&it.some(At=>Ge.includes(Ft(At))))return de}return-1},qe=Fe(p.product),Se=Fe(p.cod);if(Se>=0){const it=Fe(p.date),de=Fe(p.phone),Ge=Fe(p.qty);return{headerRow:we,productCol:qe,codCol:Se,dateCol:it,phoneCol:de,qtyCol:Ge}}}return null})();if(!z)throw new Error('Kh\xF4ng t\xECm th\u1EA5y header c\u1ED9t "T\u1ED5ng ti\u1EC1n thu h\u1ED9"');const q=[],b=new Set,x=ee=>{const we=String(ee!=null?ee:"").trim();if(!we)return{text:"",qty:null};let le=we.match(/^\s*x\s*(\d{1,3})\s+(.+)$/i);return le?{text:String(le[2]||"").trim(),qty:Number(le[1])}:(le=we.match(/^\s*(\d{1,3})\s*(?:x|\*|×)?\s+(.+)$/i),le?{text:String(le[2]||"").trim(),qty:Number(le[1])}:{text:we,qty:null})};for(let ee=z.headerRow+1;ee<w.length;ee++){const we=Array.isArray(w[ee])?w[ee]:[],le=z.productCol>=0?String((T=we[z.productCol])!=null?T:"").trim():"",ve=x(le),Fe=ve.text,qe=ae(we[z.codCol]),Se=z.qtyCol>=0?we[z.qtyCol]:"",it=(()=>{if(Se!=null&&Se!==""){if(typeof Se=="number"&&Number.isFinite(Se))return{qty:Math.max(1,Math.trunc(Se)),source:"cell"};const Lt=String(Se).trim(),It=Number(Lt.replace(/[^0-9]/g,""));if(Number.isFinite(It)&&It>0)return{qty:Math.max(1,Math.trunc(It)),source:"cell"}}const $t=Number(ve.qty);return Number.isFinite($t)&&$t>1?{qty:Math.max(1,Math.trunc($t)),source:"text"}:{qty:1,source:"default"}})(),de=it.qty,Ge=it.source,At=Ge==="cell"&&de>1&&qe>0&&de<=50?qe*de:0,dt=Array.from(new Set([qe,At].filter($t=>Number($t||0)>0))),xe=qe;if(!Fe&&!xe)continue;const se=z.phoneCol>=0?String((E=we[z.phoneCol])!=null?E:"").trim():"",C=Ye(se);let te=pn(Fe);if(C&&(te={...te,phone:C,phoneNorm:C}),!te.phoneNorm){const $t=we.map(It=>String(It!=null?It:"")).join(" | "),Lt=pn($t);Lt.phoneNorm&&(te={...te,phone:Lt.phone,phoneNorm:Lt.phoneNorm})}const ce=te.cleanedText||Fe||"",pt=Ft(ce);if(pt&&(pt.includes("tong tien")||pt.includes("tong")||pt.includes("thanh toan")||pt.includes("thanh to\xE1n")))continue;const Tt=z.dateCol>=0?we[z.dateCol]:"",at=Tt?fn(Tt):"";at&&b.add(at);const ft=Tt?$(Tt):"";q.push({rowIndex:ee+1,dateRaw:Tt,monthKey:at,dayKey:ft,product:ce,productNorm:un(ce),productCompact:un(ce).replace(/\s+/g,""),phone:te.phone,phoneNorm:te.phoneNorm,cod:xe,codRaw:qe,qty:de,qtySource:Ge,codAlt:At,codCandidates:dt})}return{rows:q,monthKeys:Array.from(b.values()).sort()}},X=r=>{const c=new Map,w=(b,x)=>{const T=c.get(b)||{key:b,rows:[],phoneNorm:"",phone:"",monthKey:"",dayKey:""};T.rows.push(x),!T.phoneNorm&&x.phoneNorm&&(T.phoneNorm=x.phoneNorm,T.phone=x.phone||x.phoneNorm),!T.monthKey&&x.monthKey&&(T.monthKey=x.monthKey),!T.dayKey&&x.dayKey&&(T.dayKey=x.dayKey),c.set(b,T)};for(const b of Array.isArray(r)?r:[]){const x=String((b==null?void 0:b.phoneNorm)||"").trim(),T=String((b==null?void 0:b.dayKey)||"").trim(),E=String((b==null?void 0:b.monthKey)||"").trim();if(x){const ee=T?`p:${x}:d:${T}`:E?`p:${x}:m:${E}`:`p:${x}`;w(ee,b)}else w(`r:${b==null?void 0:b.rowIndex}`,b)}const p=b=>{const x=Number((b==null?void 0:b.cod)||0)||0;if(x>0)return x;const T=Number((b==null?void 0:b.codAlt)||0)||0;return T>0?T:0},M=b=>{var ee;const x=((b==null?void 0:b.rows)||[]).slice().filter(Boolean);if(x.length<=1)return[{key:b.key,rows:x,phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey}];const T=x.map(p).filter(we=>we>0),E=Array.from(new Set(T));if(b.phoneNorm&&b.dayKey&&E.length>1&&E.length<=8){const we=new Map;for(const ve of E)we.set(String(ve),{key:`${b.key}:t:${ve}`,rows:[],phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey});const le=[];for(const ve of x){const Fe=p(ve);Fe>0?we.get(String(Fe)).rows.push(ve):le.push(ve)}if(le.length){const ve=Array.from(we.values()).map(Fe=>{const qe=Fe.rows.find(Se=>String((Se==null?void 0:Se.productNorm)||"").trim())||null;return{group:Fe,seedNorm:String((qe==null?void 0:qe.productNorm)||"")}});for(const Fe of le){const qe=String((Fe==null?void 0:Fe.productNorm)||"");let Se=null,it=-1;for(const de of ve){const Ge=Ee(qe,de.seedNorm);Ge>it&&(it=Ge,Se=de.group)}(Se||((ee=ve[0])==null?void 0:ee.group)).rows.push(Fe)}}return Array.from(we.values()).filter(ve=>ve.rows.length>0)}return[{key:b.key,rows:x,phoneNorm:b.phoneNorm,phone:b.phone,monthKey:b.monthKey}]},z=[];for(const b of c.values())z.push(...M(b));const q=b=>{var At,dt,xe;const x=b.rows.slice().filter(Boolean),T=x.map(se=>se.rowIndex).filter(Boolean),E=[],ee=new Set;for(const se of x){const C=String((se==null?void 0:se.productNorm)||"").trim();C&&(ee.has(C)||(ee.add(C),E.push(String((se==null?void 0:se.product)||"").trim())))}const we=E.filter(Boolean).join(" + "),le=Ft(we),ve=[];for(const se of x){const C=Array.isArray(se==null?void 0:se.codCandidates)?se.codCandidates:[];for(const te of C){const ce=Number(te||0)||0;ce>0&&ve.push(ce)}}const Fe=Array.from(new Set(ve)).sort((se,C)=>se-C),qe=x.map(se=>p(se)).filter(se=>se>0);let Se=0;if(!qe.length)Se=0;else{const se=new Map;for(const te of qe)se.set(te,(se.get(te)||0)+1);const C=Array.from(se.keys());if(C.length===1)Se=C[0];else{let te=null,ce=0;for(const[pt,Tt]of se.entries())Tt>ce&&(ce=Tt,te=pt);te!=null&&ce>=2?Se=te:Se=qe.reduce((pt,Tt)=>pt+Tt,0)}}const it=b.monthKey||((At=x.find(se=>se==null?void 0:se.monthKey))==null?void 0:At.monthKey)||"",de=((dt=x.find(se=>se==null?void 0:se.dayKey))==null?void 0:dt.dayKey)||"",Ge=((xe=x.find(se=>se==null?void 0:se.dateRaw))==null?void 0:xe.dateRaw)||"";return{key:b.key,phoneNorm:b.phoneNorm||"",phone:b.phone||b.phoneNorm||"",monthKey:it,dayKey:de,dateRaw:Ge,rowIndices:T,rowIndexFirst:T.length?Math.min(...T):null,rowCount:x.length,productDisplay:we,productNorm:le,productCompact:String(le||"").replace(/\s+/g,""),cod:Se,codCandidates:Fe,rows:x}};return z.map(q)},Z=async r=>{const c=`${API_BASE}/api/orders?month=${encodeURIComponent(r)}&includeItems=1`,w=await window.KTM.api.getJSON(c,"L\u1ED7i t\u1EA3i danh s\xE1ch \u0111\u01A1n");return Array.isArray(w==null?void 0:w.orders)?w.orders:Array.isArray(w)?w:[]},Re=async r=>{var x,T;const c=Array.isArray(r)&&r.length?r:[L],w=[],p=5*60*1e3;for(let E=0;E<c.length;E++){const ee=c[E],we=(x=Ue.current)==null?void 0:x.get(ee);if(we&&Date.now()-Number(we.at||0)<p&&Array.isArray(we.records)){w.push(...we.records);continue}tt(`\u0110ang t\u1EA3i \u0111\u01A1n h\u1EC7 th\u1ED1ng th\xE1ng ${ee} (${E+1}/${c.length})...`);const le=await Z(ee);(T=Ue.current)==null||T.set(ee,{at:Date.now(),records:le}),w.push(...le)}const M=E=>String(E||"").trim().toLowerCase(),z=w.filter(E=>{const ee=M(E==null?void 0:E.status);return!(He&&ee==="draft"||De&&ee==="canceled"||Et&&ee==="paid")}),q=E=>{var we,le,ve;return String(Qe||"created_at")==="updated_at"?(le=(we=E==null?void 0:E.updated_at)!=null?we:E==null?void 0:E.created_at)!=null?le:null:(ve=E==null?void 0:E.created_at)!=null?ve:null};return z.map(E=>{var Se,it,de,Ge,At,dt;const ee=window.KTM.orders.getOrderProductSummary(E,Jt),we=window.KTM.orders.getOrderTotalMoney(E,Jt),le=un(ee),ve=Ye((Se=E==null?void 0:E.phone)!=null?Se:""),Fe=q(E),qe=(()=>{if(!Fe)return"";const xe=new Date(Fe);return Number.isNaN(xe.getTime())?"":`${xe.getFullYear()}-${String(xe.getMonth()+1).padStart(2,"0")}-${String(xe.getDate()).padStart(2,"0")}`})();return{id:String((it=E==null?void 0:E.id)!=null?it:""),created_at:(de=E==null?void 0:E.created_at)!=null?de:null,updated_at:(Ge=E==null?void 0:E.updated_at)!=null?Ge:null,dayKey:qe,status:String((At=E==null?void 0:E.status)!=null?At:""),phone:String((dt=E==null?void 0:E.phone)!=null?dt:""),phoneNorm:ve,productSummary:ee,productNorm:le,productCompact:le.replace(/\s+/g,""),cod:Number(we||0)||0,raw:E}}).filter(E=>E.id&&E.cod>0)},Ee=(r,c)=>{const w=String(r||"").trim(),p=String(c||"").trim();if(!w||!p)return 0;if(w===p)return 1;const M=w.replace(/\s+/g,""),z=p.replace(/\s+/g,"");if(M&&z&&M===z)return 1;if(M&&z&&(z.includes(M)||M.includes(z)))return .92;const q=Se=>String(Se||"").replace(/[\+]/g," ").replace(/[()\[\]{},.;:!?]/g," ").replace(/\s+/g," ").trim().split(" ").map(Ge=>Ge.trim()).filter(Boolean).map(Ge=>Ge.replace(/[^a-z0-9]/g,"")).filter(Boolean).filter(Ge=>Ge.length>1),b=q(w),x=q(p);if(!b.length||!x.length)return 0;const T=new Set(x),E=(Se,it)=>{if(Se===it)return 0;const de=Se.length,Ge=it.length;if(Math.abs(de-Ge)>1)return 2;let At=0,dt=0,xe=0;for(;At<de&&dt<Ge;){if(Se[At]===it[dt]){At+=1,dt+=1;continue}if(xe+=1,xe>1)return xe;de>Ge?At+=1:(Ge>de||(At+=1),dt+=1)}return(At<de||dt<Ge)&&(xe+=1),xe},ee=Se=>/[0-9]/.test(Se)?2:1;let we=0,le=0;for(const Se of b){const it=ee(Se);if(le+=it,T.has(Se)||z&&z.includes(Se)){we+=it;continue}if(Se.length>=4){let de=!1;for(const Ge of x){if(Ge===Se){de=!0;break}if(Ge.includes(Se)||Se.includes(Ge)){de=!0;break}if(z&&z.includes(Se)){de=!0;break}if(E(Se,Ge)<=1){de=!0;break}}de&&(we+=it*.8)}}const ve=we/Math.max(1,le),Fe=Math.min(.12,Math.abs(w.length-p.length)/Math.max(1,Math.max(w.length,p.length))),qe=(()=>{const Se=b.filter(de=>/[0-9]/.test(de)&&de.length>=3);if(!Se.length)return 0;let it=0;for(const de of Se)(T.has(de)||z&&z.includes(de))&&(it+=1);return Math.min(.08,.04*it)})();return Math.max(0,Math.min(1,ve-Fe+qe))},Ve=r=>{const w=String(r||"").trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!w)return null;const p=new Date(Number(w[1]),Number(w[2])-1,Number(w[3]));return Number.isNaN(p.getTime())?null:p.getTime()},vt=(r,c)=>{const w=Array.isArray(r==null?void 0:r.codCandidates)&&r.codCandidates.length?r.codCandidates:[Number((r==null?void 0:r.cod)||0)||0],p=Number((c==null?void 0:c.cod)||0)||0;let M=1/0,z=0;for(const q of w){const b=Number(q||0)||0;if(b<=0)continue;const x=Math.abs(p-b);x<M&&(M=x,z=b)}return Number.isFinite(M)||(M=1/0),{bestDiff:M,bestCand:z,oCod:p}},Ze=(r,c,w)=>{const p=String((r==null?void 0:r.phoneNorm)||"").trim(),M=!!(p&&String((c==null?void 0:c.phoneNorm)||"")===p),z=Math.max(0,Number((w==null?void 0:w.codTolerance)||0)||0),{bestDiff:q,bestCand:b}=vt(r,c),x=q===0,T=Number.isFinite(q)&&z>0&&q>0&&q<=z,E=String((r==null?void 0:r.dayKey)||"").trim(),ee=String((c==null?void 0:c.dayKey)||"").trim(),we=!!(E&&ee&&E===ee),le=(()=>{if(!E||!ee)return!1;const xe=Ve(E),se=Ve(ee);if(xe==null||se==null)return!1;const C=Math.abs(xe-se)/(24*60*60*1e3);return C>0&&C<=1.01})(),ve=Ee(String((r==null?void 0:r.productNorm)||""),String((c==null?void 0:c.productNorm)||"")),qe=!!p?{phone:.5,cod:.3,day:.08,name:.12}:{phone:0,cod:.45,day:.1,name:.45},Se=M?qe.phone:0,it=x?qe.cod:T?qe.cod*(1-q/Math.max(1,z)):0,de=we?qe.day:le?qe.day*.6:0,Ge=Math.max(0,Math.min(1,ve))*qe.name,At=Se+it+de+Ge,dt=[];return M&&dt.push("S\u0110T tr\xF9ng"),x?dt.push("COD tr\xF9ng"):T?dt.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(q)} (<= ${window.KTM.money.formatNumber(z)})`):b>0&&Number.isFinite(q)&&q!==1/0&&dt.push(`COD l\u1EC7ch ${window.KTM.money.formatNumber(q)}`),we?dt.push("C\xF9ng ng\xE0y"):le&&dt.push("Ng\xE0y g\u1EA7n \u0111\xFAng (\xB11)"),ve>=.8?dt.push(`T\xEAn t\u01B0\u01A1ng \u0111\u01B0\u01A1ng ${Math.round(ve*100)}%`):ve>=.6&&dt.push(`T\xEAn t\u01B0\u01A1ng \u0111\u01B0\u01A1ng ${Math.round(ve*100)}%`),{score:At,reasons:dt,nameSim:ve,phoneMatch:M,codExact:x,codWithin:T,codDiff:q,bestCand:b}},cn=r=>{let c=String(r!=null?r:"");return c=c.replace(/^\s*(?:x\s*)?(\d{1,3})\s*(?:x|\*|×)?\s*/i," "),c=c.replace(/\s+/g," ").trim(),un(c)},Vt=r=>{var z;const c=new Map,w=new Map,p=Array.isArray(r==null?void 0:r.rows)?r.rows:[],M=p.length>1||p.some(q=>String((q==null?void 0:q.qtySource)||"default")!=="default");for(const q of p){const b=String((q==null?void 0:q.product)||"").trim(),x=cn(b);if(!x)continue;const T=Math.max(1,Number((z=q==null?void 0:q.qty)!=null?z:1)||1),E=M?T:1;c.set(x,(c.get(x)||0)+E),w.has(x)||w.set(x,b)}return{qtyByKey:c,labelByKey:w,qtyReliable:M}},nn=r=>{var b;const c=new Map,w=new Map,p=(r==null?void 0:r.raw)||null,M=Array.isArray(p==null?void 0:p.items)?p.items:[];if(M.length){for(const x of M){const T=x==null?void 0:x.product_id,E=T?Jt(T):null,ee=String((E==null?void 0:E.name)||(x==null?void 0:x.product_name)||"").trim(),we=String((x==null?void 0:x.variant)||"").trim(),le=(ee||(r==null?void 0:r.productSummary)||"").trim()+(we?` (${we})`:""),ve=cn(le);if(!ve)continue;const Fe=Math.max(1,Number((b=x==null?void 0:x.quantity)!=null?b:1)||1);c.set(ve,(c.get(ve)||0)+Fe),w.has(ve)||w.set(ve,ee||le)}return{qtyByKey:c,labelByKey:w}}const z=String((r==null?void 0:r.productSummary)||"").trim();if(!z)return{qtyByKey:c,labelByKey:w};const q=z.split("+").map(x=>String(x||"").trim()).filter(Boolean);for(const x of q){const T=x.match(/\bx\s*(\d{1,3})\b/i),E=T?Math.max(1,Number(T[1])||1):1,ee=x.replace(/\bx\s*\d{1,3}\b/ig," ").replace(/\s+/g," ").trim(),we=cn(ee);we&&(c.set(we,(c.get(we)||0)+E),w.has(we)||w.set(we,ee))}return{qtyByKey:c,labelByKey:w}},hn=(r,c)=>{const w=Vt(r),p=nn(c),M=Array.from(w.qtyByKey.keys()),z=Array.from(p.qtyByKey.keys()),q=[];for(const le of M)for(const ve of z){const Fe=Ee(le,ve);Fe>=.9&&q.push({ek:le,sk:ve,sc:Fe})}q.sort((le,ve)=>ve.sc-le.sc);const b=new Map,x=new Set,T=new Set;for(const le of q)x.has(le.ek)||T.has(le.sk)||(b.set(le.ek,le.sk),x.add(le.ek),T.add(le.sk));const E=[],ee=[];for(const[le,ve]of w.qtyByKey.entries()){const Fe=b.get(le)||le,qe=p.qtyByKey.get(Fe)||0;qe<ve&&E.push({name:w.labelByKey.get(le)||le,qty:ve-qe})}for(const[le,ve]of p.qtyByKey.entries()){let Fe=w.qtyByKey.get(le)||0;if(!Fe){for(const[qe,Se]of b.entries())if(Se===le){Fe=w.qtyByKey.get(qe)||0;break}}Fe<ve&&ee.push({name:p.labelByKey.get(le)||le,qty:ve-Fe})}return{hasDiff:E.length>0||ee.length>0,missingInSystem:E,missingInExcel:ee}},nt=r=>{if(!(r!=null&&r.hasDiff))return"";const c=p=>p.slice(0,4).map(M=>`${M.name} x${M.qty}`).join(", ")+(p.length>4?` (+${p.length-4})`:""),w=[];return Array.isArray(r.missingInExcel)&&r.missingInExcel.length&&w.push(`Thi\u1EBFu trong Excel: ${c(r.missingInExcel)}`),Array.isArray(r.missingInSystem)&&r.missingInSystem.length&&w.push(`Thi\u1EBFu trong h\u1EC7 th\u1ED1ng: ${c(r.missingInSystem)}`),w.join(" \xB7 ")},ln=async r=>{Ce(""),Ke(null),ze((r==null?void 0:r.name)||""),Oe(!0),tt("\u0110ang \u0111\u1ECDc file Excel...");try{await Xt();const c=await d(r),w=Array.isArray(c.rows)?c.rows:[],p=String(L||"").trim()||getCurrentMonth(),M=xe=>{const se=String(xe||"").match(/^(\d{4})-(\d{2})$/);if(!se)return NaN;const C=Number(se[1]),te=Number(se[2]);return!Number.isFinite(C)||!Number.isFinite(te)||te<1||te>12?NaN:C*12+(te-1)},z=M(p),q=Number.isFinite(z)?z-2:NaN,b=xe=>{const se=M(xe);return!Number.isFinite(se)||!Number.isFinite(z)||!Number.isFinite(q)?!1:se>=q&&se<=z},x=w.filter(xe=>{const se=String((xe==null?void 0:xe.monthKey)||"").trim();return se?b(se):!0});if(!x.length)throw new Error(`File kh\xF4ng c\xF3 d\u1EEF li\u1EC7u trong 3 th\xE1ng g\u1EA7n nh\u1EA5t quanh ${p}.`);const T=new Set;for(const xe of x){const se=String((xe==null?void 0:xe.monthKey)||"").trim();se&&b(se)&&T.add(se)}T.size||T.add(p);const E=Array.from(T.values()).sort(),ee=X(x);tt(`\u0110\u1ECDc \u0111\u01B0\u1EE3c ${x.length} d\xF2ng (${ee.length} c\u1EE5m) trong 3 th\xE1ng g\u1EA7n nh\u1EA5t. \u0110ang chu\u1EA9n b\u1ECB \u0111\u1ED1i so\xE1t...`);const we=await Re(E);tt(`\u0110ang \u0111\u1ED1i so\xE1t (${ee.length} c\u1EE5m Excel vs ${we.length} \u0111\u01A1n h\u1EC7 th\u1ED1ng)...`);const le=new Set,ve=[],Fe=[],qe=[],Se=jt?Math.max(0,Number(S||0)||0):0,it=new Map;for(const xe of we){const se=String(xe.phoneNorm||"").trim();if(!se)continue;const C=it.get(se)||[];C.push(xe),it.set(se,C)}const de=new Map;for(const xe of we){const se=String(xe.cod),C=de.get(se)||[];C.push(xe),de.set(se,C)}for(const xe of ee){const se=String(xe.phoneNorm||"").trim();let C=[];if(se?C=(it.get(se)||[]).filter(at=>!le.has(at.id)):C=(de.get(String(xe.cod))||[]).filter(at=>!le.has(at.id)),xe.dayKey&&C.length){const at=C.filter(ft=>String(ft.dayKey||"")===String(xe.dayKey||""));at.length&&(C=at)}if(!C.length){Fe.push({group:xe,suggestions:[]});continue}if(se){const at=Array.isArray(xe.codCandidates)&&xe.codCandidates.length?xe.codCandidates:[Number(xe.cod||0)||0];let $t=C.filter(Lt=>at.some(It=>Number(It||0)===Number(Lt.cod||0)));if(xe.dayKey&&$t.length){const Lt=$t.filter(It=>String(It.dayKey||"")===String(xe.dayKey||""));Lt.length&&($t=Lt)}if($t.length===1){const Lt=$t[0];le.add(Lt.id),ve.push({group:xe,order:Lt,score:1,reasons:["S\u0110T tr\xF9ng","COD tr\xF9ng",...xe.dayKey?["C\xF9ng ng\xE0y"]:[]]});continue}}const te=C.map(at=>{const ft=Ze(xe,at,{codTolerance:Se});return{order:at,...ft}}).sort((at,ft)=>ft.score-at.score),ce=te[0],pt=te.slice(0,3).map(at=>({id:at.order.id,cod:at.order.cod,productSummary:at.order.productSummary,score:at.score,reasons:at.reasons})),Tt=se?.7:.8;if(ce&&ce.score>=Tt&&ce.codExact)le.add(ce.order.id),ve.push({group:xe,order:ce.order,score:ce.score,reasons:ce.reasons});else if(ce&&se){le.add(ce.order.id);const at=Number(xe.cod||0)-Number(ce.order.cod||0);at===0?ve.push({group:xe,order:ce.order,score:ce.score,reasons:(ce.reasons||[]).slice()}):qe.push({group:xe,order:ce.order,score:ce.score,diff:at,reason:[...ce.reasons||[]].filter(Boolean).join(" \xB7 "),suggestions:pt})}else if(ce&&(ce.codWithin||Se>0&&Number.isFinite(ce.codDiff)&&ce.codDiff<=Se)&&ce.nameSim>=.55){le.add(ce.order.id);const at=Number(xe.cod||0)-Number(ce.order.cod||0);at===0?ve.push({group:xe,order:ce.order,score:ce.score,reasons:ce.reasons}):qe.push({group:xe,order:ce.order,score:ce.score,diff:at,reason:ce.reasons.join(" \xB7 "),suggestions:pt})}else Fe.push({group:xe,suggestions:pt})}const Ge=Fe,At=we.filter(xe=>!le.has(xe.id)),dt=Ge.length===0&&At.length===0&&qe.length===0;Ke({ok:dt,monthKeys:E,excelCount:x.length,excelGroupCount:ee.length,systemCount:we.length,matches:ve,excelOnly:Ge,systemOnly:At,moneyMismatch:qe}),N(new Set),tt(dt?"OK \u2705":"\u0110\xE3 \u0111\u1ED1i so\xE1t xong")}catch(c){Ce(String((c==null?void 0:c.message)||c||"L\u1ED7i \u0111\u1ED1i so\xE1t")),tt("")}finally{Oe(!1)}},Mn=(r,c)=>{var T,E,ee,we,le,ve,Fe,qe,Se,it;const w=de=>String(de||"").replace(/[^0-9]/g,""),p=(r==null?void 0:r.raw)||{},M=String((E=(T=r==null?void 0:r.id)!=null?T:p==null?void 0:p.id)!=null?E:"").trim(),z=w((we=(ee=p==null?void 0:p.phone)!=null?ee:r==null?void 0:r.phone)!=null?we:"");if(!M||!z)return null;let b=(Array.isArray(p==null?void 0:p.items)?p.items:[]).map(de=>{var Ge,At;return{product_id:(de==null?void 0:de.product_id)||"",quantity:Number((Ge=de==null?void 0:de.quantity)!=null?Ge:1),variant:String((de==null?void 0:de.variant)||"").trim()||null,variant_json:(At=de==null?void 0:de.variant_json)!=null?At:null,unit_price:(()=>{var se;const dt=(se=de==null?void 0:de.unit_price)!=null?se:de==null?void 0:de.unitPrice,xe=dt==null||dt===""?NaN:Number(dt);return Number.isFinite(xe)?Math.max(0,Math.trunc(xe)):null})()}}).filter(de=>de.product_id&&Number.isFinite(de.quantity)&&de.quantity>0);if(!b.length&&(p!=null&&p.product_id)){const de=Number((le=p==null?void 0:p.quantity)!=null?le:1);b=[{product_id:p.product_id,quantity:Number.isFinite(de)&&de>0?de:1,variant:null,variant_json:null,unit_price:null}]}if(!b.length)return null;const x=b[0];return{id:M,customer_name:String((ve=p==null?void 0:p.customer_name)!=null?ve:"").trim(),phone:z,address:String((Fe=p==null?void 0:p.address)!=null?Fe:"").trim(),note:String((qe=p==null?void 0:p.note)!=null?qe:"").trim(),adjustment_amount:Number((Se=p==null?void 0:p.adjustment_amount)!=null?Se:0)||0,adjustment_note:String((it=p==null?void 0:p.adjustment_note)!=null?it:"").trim(),product_id:x.product_id,quantity:x.quantity,status:c,items:b}},yn=async()=>{if(!pe||ge)return;const r=Array.from(Me.values()).map(p=>String(p||"").trim()).filter(Boolean);if(!r.length||!confirm(`\u0110\xE1nh d\u1EA5u \u0111\xE3 nh\u1EADn ti\u1EC1n cho ${r.length} \u0111\u01A1n?`))return;Ne(!0),me("\u0110ang c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i...");let c=0;const w=[];try{for(let p=0;p<r.length;p++){const M=r[p];me(`\u0110ang c\u1EADp nh\u1EADt (${p+1}/${r.length})...`);const z=(Array.isArray(pe==null?void 0:pe.matches)?pe.matches:[]).find(b=>{var x;return String(((x=b==null?void 0:b.order)==null?void 0:x.id)||"")===M}),q=Mn(z==null?void 0:z.order,"paid");if(!q){w.push({id:M,error:"Thi\u1EBFu d\u1EEF li\u1EC7u (phone/items)"});continue}try{await window.KTM.api.putJSON(`${API_BASE}/api/orders/${encodeURIComponent(M)}`,q,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),c+=1}catch(b){w.push({id:M,error:String((b==null?void 0:b.message)||b||"L\u1ED7i")})}}}finally{Ne(!1),me("")}if(c>0){R(`\u0110\xE3 c\u1EADp nh\u1EADt ${c} \u0111\u01A1n sang \u0110\xE3 nh\u1EADn ti\u1EC1n`,"success");const p=new Set(r);Ke(M=>{if(!M)return M;const z=q=>{if(!q||!p.has(String(q.id)))return q;const b=q.raw?{...q.raw,status:"paid"}:q.raw;return{...q,status:"paid",raw:b}};return{...M,matches:Array.isArray(M.matches)?M.matches.map(q=>({...q,order:z(q==null?void 0:q.order)})):M.matches,systemOnly:Array.isArray(M.systemOnly)?M.systemOnly.map(z):M.systemOnly,moneyMismatch:Array.isArray(M.moneyMismatch)?M.moneyMismatch.map(q=>({...q,order:z(q==null?void 0:q.order)})):M.moneyMismatch}}),N(new Set)}w.length&&(R(`C\xF3 ${w.length} \u0111\u01A1n c\u1EADp nh\u1EADt l\u1ED7i (xem console)`,"warning"),console.warn("Recon paid update failures:",w))};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t Excel")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Th\xE1ng m\u1EB7c \u0111\u1ECBnh (n\u1EBFu Excel kh\xF4ng c\xF3 c\u1ED9t ng\xE0y)"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:ne,onChange:r=>V(r.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:H}))))),React.createElement("div",{className:"card border-0 shadow-sm mb-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{className:"fw-semibold"},React.createElement("i",{className:"fas fa-file-excel me-2 text-success"}),"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 (Excel)"),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("span",{className:"text-muted small"},"\u0110\u1ED1i so\xE1t theo: ",React.createElement("span",{className:"fw-semibold"},"S\u0110T")," + ",React.createElement("span",{className:"fw-semibold"},"T\u1ED5ng ti\u1EC1n thu h\u1ED9")))),St==="loading"&&React.createElement("div",{className:"alert alert-info mt-3 mb-0"},"\u0110ang t\u1EA3i th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX)..."),St==="failed"&&React.createElement("div",{className:"alert alert-warning mt-3 mb-0"},"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c th\u01B0 vi\u1EC7n \u0111\u1ECDc Excel (XLSX). H\xE3y ki\u1EC3m tra m\u1EA1ng / ch\u1EB7n CDN (AdBlock) ho\u1EB7c refresh l\u1EA1i trang."),React.createElement("div",{className:"row g-2 align-items-end mt-2"},React.createElement("div",{className:"col-12 col-md-7"},React.createElement("label",{className:"form-label mb-1"},"Upload file Excel"),React.createElement("input",{type:"file",className:"form-control",accept:".xlsx,.xls,.csv",disabled:H,onChange:async r=>{const c=r.target.files&&r.target.files[0];c&&await ln(c)}}),React.createElement("div",{className:"form-text"},je?`File: ${je}`:'Header c\u1EA7n c\xF3: "T\u1ED5ng Ti\u1EC1n Thu H\u1ED9". "T\xEAn s\u1EA3n ph\u1EA9m" (n\u1EBFu c\xF3) s\u1EBD gi\xFAp g\u1EE3i \xFD kh\u1EDBp t\u1ED1t h\u01A1n. C\xF3 c\u1ED9t "Ng\xE0y" th\xEC s\u1EBD t\u1EF1 t\u1EA3i \u0111\xFAng th\xE1ng trong file.')),React.createElement("div",{className:"col-12 col-md-5"},React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("label",{className:"form-label mb-0 small text-muted"},"Ng\xE0y theo"),React.createElement("select",{className:"form-select form-select-sm",style:{width:150},value:Qe,disabled:H,onChange:r=>Kt(r.target.value)},React.createElement("option",{value:"created_at"},"created_at"),React.createElement("option",{value:"updated_at"},"updated_at"))),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-draft",checked:He,disabled:H,onChange:r=>et(!!r.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-draft"},"B\u1ECF nh\xE1p")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-canceled",checked:De,disabled:H,onChange:r=>gt(!!r.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-canceled"},"B\u1ECF h\u1EE7y")),React.createElement("div",{className:"form-check"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-exc-paid",checked:Et,disabled:H,onChange:r=>tn(!!r.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-exc-paid"},"B\u1ECF \u0111\xE3 nh\u1EADn ti\u1EC1n")),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("div",{className:"form-check mb-0"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"recon-cod-tol",checked:jt,disabled:H,onChange:r=>A(!!r.target.checked)}),React.createElement("label",{className:"form-check-label small",htmlFor:"recon-cod-tol"},"Cho l\u1EC7ch COD")),React.createElement("input",{type:"number",className:"form-control form-control-sm",style:{width:110},value:S,min:"0",step:"1000",disabled:H||!jt,onChange:r=>B(r.target.value)})))),React.createElement("div",{className:"col-12 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",disabled:H,onClick:()=>{Ce(""),tt(""),Ke(null),ze(""),mt("all"),wt(""),R("\u0110\xE3 reset \u0111\u1ED1i so\xE1t","info")}},React.createElement("i",{className:"fas fa-rotate-left me-2"}),"Reset"))),Xe&&React.createElement("div",{className:"mt-2 small text-muted"},Xe),Le&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0"},Le),pe&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:`alert ${pe.ok?"alert-success":"alert-warning"} mb-3`},pe.ok?React.createElement("div",{className:"fw-semibold"},"OK \u2014 File Excel \u0111\xE3 kh\u1EDBp \u0111\u1EA7y \u0111\u1EE7 v\u1EDBi h\u1EC7 th\u1ED1ng."):React.createElement("div",{className:"fw-semibold"},"CH\u01AFA KH\u1EDAP \u2014 C\xF3 thi\u1EBFu/sai l\u1EC7ch so v\u1EDBi h\u1EC7 th\u1ED1ng."),React.createElement("div",{className:"small mt-1"},"Th\xE1ng \u0111\u1ED1i so\xE1t: ",Array.isArray(pe.monthKeys)?pe.monthKeys.join(", "):""," \xB7 Excel: ",pe.excelCount," d\xF2ng",Number(pe.excelGroupCount||0)?` (${pe.excelGroupCount} c\u1EE5m)`:""," \xB7 H\u1EC7 th\u1ED1ng: ",pe.systemCount," \u0111\u01A1n")),!pe.ok&&React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center justify-content-between mb-2"},React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Recon view"},React.createElement("button",{type:"button",className:`btn ${K==="all"?"btn-dark":"btn-outline-dark"}`,onClick:()=>mt("all")},"T\u1EA5t c\u1EA3"),React.createElement("button",{type:"button",className:`btn ${K==="systemOnly"?"btn-warning":"btn-outline-warning"}`,onClick:()=>mt("systemOnly")},"H\u1EC7 th\u1ED1ng thi\u1EBFu Excel"),React.createElement("button",{type:"button",className:`btn ${K==="excelOnly"?"btn-warning":"btn-outline-warning"}`,onClick:()=>mt("excelOnly")},"Excel thi\u1EBFu h\u1EC7 th\u1ED1ng"),React.createElement("button",{type:"button",className:`btn ${K==="moneyMismatch"?"btn-danger":"btn-outline-danger"}`,onClick:()=>mt("moneyMismatch")},"Sai l\u1EC7ch ti\u1EC1n")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("input",{type:"text",className:"form-control form-control-sm",style:{width:220},placeholder:"L\u1ECDc theo S\u0110T...",value:yt,onChange:r=>wt(r.target.value)}),React.createElement("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Export CSV"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{var w,p,M,z,q,b,x;const r=Ye(yt),c=[["type","order_id","date","phone","product","cod_excel","cod_system","diff","reason"]];for(const T of Array.isArray(pe.moneyMismatch)?pe.moneyMismatch:[])r&&String(((w=T==null?void 0:T.group)==null?void 0:w.phoneNorm)||"").indexOf(r)<0||c.push(["moneyMismatch",((p=T==null?void 0:T.order)==null?void 0:p.id)||"",String(((M=T==null?void 0:T.group)==null?void 0:M.dateRaw)||""),((z=T==null?void 0:T.group)==null?void 0:z.phone)||"",((q=T==null?void 0:T.group)==null?void 0:q.productDisplay)||"",Number(((b=T==null?void 0:T.group)==null?void 0:b.cod)||0),Number(((x=T==null?void 0:T.order)==null?void 0:x.cod)||0),Number((T==null?void 0:T.diff)||0),String((T==null?void 0:T.reason)||"")]);for(const T of Array.isArray(pe.systemOnly)?pe.systemOnly:[])r&&String((T==null?void 0:T.phoneNorm)||"").indexOf(r)<0||c.push(["systemOnly",(T==null?void 0:T.id)||"",window.KTM.date.formatDateTime(T==null?void 0:T.created_at),(T==null?void 0:T.phone)||"",(T==null?void 0:T.productSummary)||"","",Number((T==null?void 0:T.cod)||0),"",""]);for(const T of Array.isArray(pe.excelOnly)?pe.excelOnly:[]){const E=T==null?void 0:T.group;r&&String((E==null?void 0:E.phoneNorm)||"").indexOf(r)<0||c.push(["excelOnly","",String((E==null?void 0:E.dateRaw)||""),(E==null?void 0:E.phone)||"",(E==null?void 0:E.productDisplay)||"",Number((E==null?void 0:E.cod)||0),"","",Array.isArray(T==null?void 0:T.suggestions)&&T.suggestions.length?T.suggestions.map(ee=>`#${ee.id}(${window.KTM.money.formatNumber(ee.cod)}|${Math.round((ee.score||0)*100)}%)`).join(" | "):""])}qt(`recon_${String(L||"").replace(/[^0-9\-]/g,"")}.csv`,c)}},"Export CSV")))),Array.isArray(pe.moneyMismatch)&&pe.moneyMismatch.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:K==="all"||K==="moneyMismatch"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-danger"},"Sai l\u1EC7ch s\u1ED1 ti\u1EC1n"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m (Excel)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (Excel)"),React.createElement("th",null,"Order ID"),React.createElement("th",null,"T\xEAn SP (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9 (H\u1EC7 th\u1ED1ng)"),React.createElement("th",{className:"text-end"},"L\u1EC7ch"),React.createElement("th",null,"L\xFD do"))),React.createElement("tbody",null,pe.moneyMismatch.filter(r=>{var w;const c=Ye(yt);return c?String(((w=r==null?void 0:r.group)==null?void 0:w.phoneNorm)||"").includes(c):!0}).slice(0,30).map(r=>{var c,w,p,M,z,q,b,x,T,E;return React.createElement("tr",{key:`mm-${String(((c=r==null?void 0:r.group)==null?void 0:c.key)||((w=r==null?void 0:r.order)==null?void 0:w.id)||Math.random())}`,className:"table-danger"},React.createElement("td",null,((p=r==null?void 0:r.group)==null?void 0:p.rowIndexFirst)||"\u2014",Number(((M=r==null?void 0:r.group)==null?void 0:M.rowCount)||0)>1?` (+${Number(r.group.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},((z=r==null?void 0:r.group)==null?void 0:z.phone)||"\u2014"),React.createElement("td",{style:{minWidth:260}},((q=r==null?void 0:r.group)==null?void 0:q.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number(((b=r==null?void 0:r.group)==null?void 0:b.cod)||0))),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Ie((r==null?void 0:r.order)||null),J(!0)}},(x=r==null?void 0:r.order)==null?void 0:x.id)),React.createElement("td",{style:{minWidth:240}},(T=r==null?void 0:r.order)==null?void 0:T.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber((E=r==null?void 0:r.order)==null?void 0:E.cod)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(r==null?void 0:r.diff)),React.createElement("td",{className:"text-muted",style:{minWidth:220}},(r==null?void 0:r.reason)||""))})))),pe.moneyMismatch.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",pe.moneyMismatch.length," d\xF2ng."))),Array.isArray(pe.systemOnly)&&pe.systemOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mb-2",style:{display:K==="all"||K==="systemOnly"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong h\u1EC7 th\u1ED1ng nh\u01B0ng thi\u1EBFu trong Excel"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y t\u1EA1o"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,pe.systemOnly.filter(r=>{const c=Ye(yt);return c?String((r==null?void 0:r.phoneNorm)||"").includes(c):!0}).slice(0,30).map(r=>React.createElement("tr",{key:`so-${r.id}`,className:"table-warning"},React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Ie(r||null),J(!0)}},r.id)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(r.created_at)),React.createElement("td",{className:"text-muted"},r.phone||"\u2014"),React.createElement("td",{style:{minWidth:280}},r.productSummary),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(r.cod)),React.createElement("td",{className:"text-muted"},r.status)))))),pe.systemOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",pe.systemOnly.length," \u0111\u01A1n."))),Array.isArray(pe.excelOnly)&&pe.excelOnly.length>0&&React.createElement("div",{className:"card border-0 shadow-sm",style:{display:K==="all"||K==="excelOnly"?"block":"none"}},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"fw-semibold mb-2 text-warning"},"C\xF3 trong Excel nh\u01B0ng kh\xF4ng th\u1EA5y \u0111\u01A1n kh\u1EDBp trong h\u1EC7 th\u1ED1ng"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Excel (d\xF2ng)"),React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"G\u1EE3i \xFD (top 3)"))),React.createElement("tbody",null,pe.excelOnly.filter(r=>{var w;const c=Ye(yt);return c?String(((w=r==null?void 0:r.group)==null?void 0:w.phoneNorm)||"").includes(c):!0}).slice(0,30).map(r=>{const c=r==null?void 0:r.group,w=Array.isArray(r==null?void 0:r.suggestions)?r.suggestions:[];return React.createElement("tr",{key:`eo-${String((c==null?void 0:c.key)||(c==null?void 0:c.rowIndexFirst)||Math.random())}`,className:"table-warning"},React.createElement("td",null,(c==null?void 0:c.rowIndexFirst)||"\u2014",Number((c==null?void 0:c.rowCount)||0)>1?` (+${Number(c.rowCount)-1})`:""),React.createElement("td",{className:"text-muted"},String((c==null?void 0:c.dateRaw)||"")),React.createElement("td",{className:"text-muted"},(c==null?void 0:c.phone)||"\u2014"),React.createElement("td",{style:{minWidth:280}},(c==null?void 0:c.productDisplay)||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(Number((c==null?void 0:c.cod)||0))),React.createElement("td",{className:"text-muted",style:{minWidth:280}},w.length?React.createElement("div",{className:"small"},w.map(p=>React.createElement("div",{key:`s-${p.id}`},"#",p.id," \xB7 ",window.KTM.money.formatNumber(p.cod)," \xB7 ",Math.round((p.score||0)*100),"%",React.createElement("br",null),React.createElement("span",{className:"text-muted"},Array.isArray(p.reasons)?p.reasons.join(" \xB7 "):"")))):"\u2014"))})))),pe.excelOnly.length>30&&React.createElement("div",{className:"text-muted small mt-2"},"\u0110ang hi\u1EC3n th\u1ECB 30/",pe.excelOnly.length," d\xF2ng."))))),Array.isArray(pe.matches)&&pe.matches.length>0&&React.createElement("div",{className:"card border-0 shadow-sm mt-3"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2"},React.createElement("div",{className:"fw-semibold"},"\u0110\u01A1n \u0111\xE3 kh\u1EDBp"),React.createElement("div",{className:"d-flex flex-wrap align-items-center gap-2"},oe?React.createElement("span",{className:"text-muted small"},oe):null,React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",disabled:ge||!(Me&&Me.size),onClick:yn},"\u0110\xE1nh d\u1EA5u \u0111\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:34}},React.createElement("input",{type:"checkbox",checked:(()=>{var w;const r=Ye(yt),c=(pe.matches||[]).filter(p=>{var q;const M=p==null?void 0:p.order;if(!(M!=null&&M.id))return!1;const z=String((M==null?void 0:M.status)||((q=M==null?void 0:M.raw)==null?void 0:q.status)||"").toLowerCase();return!(Et&&z==="paid"||r&&!String((M==null?void 0:M.phoneNorm)||"").includes(r))});if(!c.length)return!1;for(const p of c)if(!Me.has(String(((w=p==null?void 0:p.order)==null?void 0:w.id)||"")))return!1;return!0})(),onChange:r=>{const c=!!r.target.checked;N(w=>{var q;const p=new Set(w),M=Ye(yt),z=(pe.matches||[]).filter(b=>{var E;const x=b==null?void 0:b.order;if(!(x!=null&&x.id))return!1;const T=String((x==null?void 0:x.status)||((E=x==null?void 0:x.raw)==null?void 0:E.status)||"").toLowerCase();return!(Et&&T==="paid"||M&&!String((x==null?void 0:x.phoneNorm)||"").includes(M))});for(const b of z){const x=String(((q=b==null?void 0:b.order)==null?void 0:q.id)||"").trim();x&&(c?p.add(x):p.delete(x))}return p})}})),React.createElement("th",null,"Order ID"),React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"Excel"),React.createElement("th",null,"H\u1EC7 th\u1ED1ng"),React.createElement("th",{className:"text-end"},"Thu h\u1ED9"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"))),React.createElement("tbody",null,(pe.matches||[]).filter(r=>{var M;const c=r==null?void 0:r.order;if(!(c!=null&&c.id))return!1;const w=String((c==null?void 0:c.status)||((M=c==null?void 0:c.raw)==null?void 0:M.status)||"").toLowerCase();if(Et&&w==="paid")return!1;const p=Ye(yt);return!(p&&!String((c==null?void 0:c.phoneNorm)||"").includes(p))}).slice(0,50).map(r=>{var p,M,z,q;const c=r.order,w=String(c.id);return React.createElement("tr",{key:`match-${w}`},React.createElement("td",null,React.createElement("input",{type:"checkbox",checked:Me.has(w),onChange:b=>{const x=!!b.target.checked;N(T=>{const E=new Set(T);return x?E.add(w):E.delete(w),E})}})),React.createElement("td",null,React.createElement("button",{type:"button",className:"btn btn-link btn-sm p-0 text-decoration-none",onClick:()=>{Ie(c||null),J(!0)}},w)),React.createElement("td",{className:"text-muted"},window.KTM.date.formatDateTime(c.created_at)),React.createElement("td",{className:"text-muted"},c.phone||"\u2014"),React.createElement("td",{style:{minWidth:240}},((p=r==null?void 0:r.group)==null?void 0:p.productDisplay)||"\u2014"),React.createElement("td",{style:{minWidth:240}},c.productSummary||"\u2014"),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(c.cod)),React.createElement("td",null,React.createElement("span",{className:`badge ${String((c==null?void 0:c.status)||((M=c==null?void 0:c.raw)==null?void 0:M.status)||"").toLowerCase()==="paid"?"bg-primary":"bg-secondary"}`},String((c==null?void 0:c.status)||((z=c==null?void 0:c.raw)==null?void 0:z.status)||"").toLowerCase()==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":(c==null?void 0:c.status)||((q=c==null?void 0:c.raw)==null?void 0:q.status)||"\u2014")))})))),React.createElement("div",{className:"text-muted small mt-2"},"Hi\u1EC3n th\u1ECB t\u1ED1i \u0111a 50 \u0111\u01A1n. D\xF9ng l\u1ECDc S\u0110T \u0111\u1EC3 thu h\u1EB9p.")))))),React.createElement(AdminDrawer,{open:F,title:re?`Order #${re.id}`:"Order",subtitle:re?`${re.phone||""} \u2022 ${window.KTM.money.formatNumber(Number(re.cod||0))}`:"",onClose:()=>{J(!1),Ie(null)}},re?React.createElement("div",{className:"small"},React.createElement("div",{className:"mb-2"},React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Tr\u1EA1ng th\xE1i:")," ",re.status||"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"created_at:")," ",window.KTM.date.formatDateTime(re.created_at)),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"updated_at:")," ",re.updated_at?window.KTM.date.formatDateTime(re.updated_at):"\u2014"),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:")," ",re.productSummary||"\u2014")),React.createElement("div",{className:"fw-semibold mb-1"},"Line items"),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"#"),React.createElement("th",null,"product_id"),React.createElement("th",{className:"text-end"},"qty"),React.createElement("th",{className:"text-end"},"price"),React.createElement("th",{className:"text-end"},"total"))),React.createElement("tbody",null,(Array.isArray((lt=re==null?void 0:re.raw)==null?void 0:lt.items)?re.raw.items:[]).map((r,c)=>{var q,b,x,T,E,ee;const w=String((b=(q=r==null?void 0:r.product_id)!=null?q:r==null?void 0:r.id)!=null?b:"").trim(),p=Number((T=(x=r==null?void 0:r.qty)!=null?x:r==null?void 0:r.quantity)!=null?T:0)||0,M=Number((ee=(E=r==null?void 0:r.price)!=null?E:r==null?void 0:r.unit_price)!=null?ee:0)||0,z=p*M;return React.createElement("tr",{key:`li-${c}-${w}`},React.createElement("td",{className:"text-muted"},c+1),React.createElement("td",{className:"text-muted"},w||"\u2014"),React.createElement("td",{className:"text-end"},p),React.createElement("td",{className:"text-end"},window.KTM.money.formatNumber(M)),React.createElement("td",{className:"text-end fw-semibold"},window.KTM.money.formatNumber(z)))}))))):null))}function AdminApp(){const[_,R]=useState(!1),[L,ye]=useState(""),[ne,V]=useState(null),[H,Oe]=useState("search"),[Le,Ce]=useState(()=>loadAdminPins()),[Xe,tt]=useState(()=>loadAdminRecent()),[je,ze]=useState(null),[pe,Ke]=useState(""),[K,mt]=useState([]),[yt,wt]=useState(null),[He,et]=useState(!1),[De,gt]=useState(null),[Et,tn]=useState(!0),[Qe,Kt]=useState([]),[jt,A]=useState(!1),[S,B]=useState(null),[ge,Ne]=useState(!1),[oe,me]=useState(!1),[Me,N]=useState(""),[F,J]=useState(()=>loadAdminSettings()),[re,Ie]=useState(null),[Te,Ue]=useState([]);useEffect(()=>{const d=localStorage.getItem("ktm_admin_session");if(d)try{const X=JSON.parse(d);X.expiry>Date.now()?(R(!0),V(X.user)):localStorage.removeItem("ktm_admin_session")}catch(X){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{_&&Ct()},[_]),useEffect(()=>{const d=()=>{try{const Z=document.querySelector(".admin-topbar");if(!Z)return;const Re=Z.getBoundingClientRect(),Ee=Math.max(0,Math.round(Re.height));document.documentElement.style.setProperty("--ktm-admin-sticky-top",`${Ee+10}px`)}catch(Z){}};d(),window.addEventListener("resize",d);const X=setTimeout(d,0);return()=>{clearTimeout(X),window.removeEventListener("resize",d)}},[_,H]),useEffect(()=>{var Z,Re;const d=window.visualViewport,X=()=>{try{const Ee=Number(window.innerHeight)||0,Ve=Number(d==null?void 0:d.height)||Ee,vt=Number(d==null?void 0:d.offsetTop)||0,Ze=Math.max(0,Math.round(Ee-Ve-vt));document.documentElement.style.setProperty("--ktm-visual-inset-bottom",`${Ze}px`)}catch(Ee){}};X(),window.addEventListener("resize",X);try{(Z=d==null?void 0:d.addEventListener)==null||Z.call(d,"resize",X),(Re=d==null?void 0:d.addEventListener)==null||Re.call(d,"scroll",X)}catch(Ee){}return()=>{var Ee,Ve;window.removeEventListener("resize",X);try{(Ee=d==null?void 0:d.removeEventListener)==null||Ee.call(d,"resize",X),(Ve=d==null?void 0:d.removeEventListener)==null||Ve.call(d,"scroll",X)}catch(vt){}}},[]),useEffect(()=>{if(!_)return;const d=Z=>{if(!Z)return!1;const Re=String(Z.tagName||"").toLowerCase();return!!(Re==="input"||Re==="textarea"||Re==="select"||Z.isContentEditable)},X=Z=>{if(!Z||Z.ctrlKey||Z.metaKey||Z.altKey||d(Z.target))return;const Re=Z.key;(Re==="/"||Re==="N"||Re==="n"||Re==="Escape"||Re==="j"||Re==="J"||Re==="k"||Re==="K")&&(Re==="/"&&Z.preventDefault(),window.dispatchEvent(new CustomEvent("ktm-admin-hotkey",{detail:{key:Re}})))};return document.addEventListener("keydown",X),()=>document.removeEventListener("keydown",X)},[_]),useEffect(()=>{_&&tt(d=>{const X=Array.isArray(d)?d:[],Z=[H,...X.filter(Re=>Re!==H)].slice(0,8);return saveAdminRecent(Z),Z})},[_]);const We=d=>{const X=String(d||"").trim();X&&tt(Z=>{const Re=Array.isArray(Z)?Z:[],Ee=[X,...Re.filter(Ve=>Ve!==X)].slice(0,8);return saveAdminRecent(Ee),Ee})},St=d=>{const X=String(d||"").trim();X&&Ce(Z=>{const Re=Array.isArray(Z)?Z:[],Ve=Re.includes(X)?Re.filter(vt=>vt!==X):[X,...Re].slice(0,10);return saveAdminPins(Ve),Ve})};useEffect(()=>{if(!_)return;let d=!1;return(async()=>{try{const X=await fetchAdminSettingsFromServer();if(d)return;J(X),saveAdminSettings(X)}catch(X){}})(),()=>{d=!0}},[_]);const Rt=async(d,X)=>{ye("");try{const Z=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:d,password:X},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),Re={user:Z.user,token:Z.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(Re)),V(Z.user),R(!0)}catch(Z){ye(Z.message)}},_e=()=>{localStorage.removeItem("ktm_admin_session"),R(!1),V(null),mt([]),wt(null)},rt=(d,X="success",Z=null)=>{const Re=Date.now()+Math.floor(Math.random()*1e3);if(d&&typeof d=="object"){const Ve=d;Kt(vt=>[...vt,{id:Re,message:String(Ve.message||""),type:String(Ve.type||X||"success"),actionLabel:Ve.actionLabel||null,onAction:typeof Ve.onAction=="function"?Ve.onAction:null,durationMs:Ve.durationMs||null}]);return}const Ee=Z&&typeof Z=="object"?Z:null;Kt(Ve=>[...Ve,{id:Re,message:String(d||""),type:String(X||"success"),actionLabel:(Ee==null?void 0:Ee.actionLabel)||null,onAction:typeof(Ee==null?void 0:Ee.onAction)=="function"?Ee.onAction:null,durationMs:(Ee==null?void 0:Ee.durationMs)||null}])},Qt=d=>{Kt(X=>X.filter(Z=>Z.id!==d))},Ct=async(d=null)=>{tn(!0);try{const X=d?`${API_BASE}/api/albums?parent_id=${d}`:`${API_BASE}/api/albums?parent_id=root`,Z=await window.KTM.api.getJSON(X,"L\u1ED7i t\u1EA3i danh s\xE1ch album");mt(Array.isArray(Z)?Z:[])}catch(X){console.error(X),rt("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}tn(!1)},on=()=>{gt(null),et(!0)},Ft=d=>{Ye(d),Ne(!0)},un=async(d,X="modal")=>{try{const Z=De&&De.uuid;!Z&&re&&(d.parent_id=re.uuid);const Re=Z?`${API_BASE}/api/albums/${De.uuid||De.id}`:`${API_BASE}/api/albums`;Z?await window.KTM.api.putJSON(Re,d,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(Re,d,"L\u1ED7i t\u1EA1o"),rt(Z?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),X==="drawer"?(Ne(!1),gt(null),Ct(re==null?void 0:re.uuid),Z&&S&&B({...S,...d})):(et(!1),gt(null),Ct(re==null?void 0:re.uuid))}catch(Z){rt(Z.message,"danger")}},fn=d=>{wt(d)},$=d=>{if(d==="root")Ue([]),Ie(null),Ct(null);else if(d){const X=Te.findIndex(Z=>Z.uuid===d.uuid);X>=0&&(Ue(Te.slice(0,X+1)),Ie(d),Ct(d.uuid))}else{const X=[...Te];X.pop();const Z=X[X.length-1]||null;Ue(X),Ie(Z),Ct(Z==null?void 0:Z.uuid)}},ae=async d=>{const X=`X\xF3a folder "${d.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(X))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${d.uuid||d.id}`,"L\u1ED7i x\xF3a album"),rt("\u0110\xE3 x\xF3a","success"),Ct(re==null?void 0:re.uuid)}catch(Z){rt("L\u1ED7i x\xF3a album","danger")}},Ye=async d=>{d&&(A(!0),N(""),me(!1),Ne(!1),B(d))},qt=()=>{A(!1),me(!1),N(""),Ne(!1),B(null)},pn=d=>{Ne(!0)};if(!_)return React.createElement(LoginPage,{onLogin:Rt,error:L});const Xt=()=>{const d=new Date,X=d.getFullYear(),Z=String(d.getMonth()+1).padStart(2,"0");return`${X}-${Z}`};function Jt(){const[d,X]=useState(()=>{var Ve;return String((Ve=F==null?void 0:F.ship_percent)!=null?Ve:DEFAULT_SHIP_PERCENT)}),[Z,Re]=useState(!1);return useEffect(()=>{var Ve;X(String((Ve=F==null?void 0:F.ship_percent)!=null?Ve:DEFAULT_SHIP_PERCENT))},[F==null?void 0:F.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Ve=>{Ve.preventDefault(),Re(!0);const vt=saveAdminSettings({ship_percent:d});try{const Ze=await saveAdminSettingsToServer(vt);J(Ze),saveAdminSettings(Ze),rt("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Ze){J(vt),rt("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{Re(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:d,min:"0",max:"100",step:"0.01",onChange:Ve=>X(Ve.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:Z},Z?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function P(){const[d,X]=useState(Xt()),[Z,Re]=useState(!0),Ee=useRef(null),Ve=useRef(null),[vt,Ze]=useState(0),[cn,Vt]=useState(!1),nn=useRef(0),hn=()=>({statusCounts:{draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0},activeOrders:0,totalQty:0,totalRevenue:0,doneRevenue:0,tempCommission:0,tempCommissionAll:0,products:[],customers:[],days:[],uniqueCustomers:0,avgOrderValue:0,avgQtyPerOrder:0}),[nt,ln]=useState(hn),Mn=useRef(new Map),yn=normalizeShipPercent(F==null?void 0:F.ship_percent),{formatNumber:lt,formatVND:r}=window.KTM.money,c=async(C,te=!1)=>{var It,dn;const ce=String(C||"").trim();if(!ce)return hn();const pt=`${ce}|${yn}`,Tt=(It=Mn.current)==null?void 0:It.get(pt);if(!te&&Tt)return Tt;const at=`${API_BASE}/api/orders?resource=stats&month=${encodeURIComponent(ce)}&ship_percent=${encodeURIComponent(yn)}`,ft=await window.KTM.api.getJSON(at,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),$t=ft!=null&&ft.stats&&(ft!=null&&ft.meta)?ft.stats:ft,Lt=$t&&typeof $t=="object"?$t:hn();return(dn=Mn.current)==null||dn.set(pt,Lt),Lt},w=async(C=!1)=>{Re(!0);try{const te=await c(d,C);ln(te)}catch(te){console.error("Load stats error:",te),ln(hn())}finally{Re(!1)}};useEffect(()=>{w()},[d,yn]);const p=(C,te)=>{const ce=String(C||"").trim(),pt=ce.match(/^(\d{4})-(\d{2})$/);if(!pt)return ce;const Tt=Number(pt[1]),at=Number(pt[2])-1,ft=new Date(Tt,at,1);ft.setMonth(ft.getMonth()+Number(te||0));const $t=ft.getFullYear(),Lt=String(ft.getMonth()+1).padStart(2,"0");return`${$t}-${Lt}`},M=Xt(),z=p(M,-5),q=C=>{const te=String(C||"").trim();return te?te>=z&&te<=M:!1},b=C=>{const te=String(C||"").trim();return te&&(te<z?z:te>M?M:te)},x=C=>{const te=Date.now();te-Number(nn.current||0)<1200||(nn.current=te,rt(C==="future"?"Kh\xF4ng xem \u0111\u01B0\u1EE3c th\xE1ng t\u01B0\u01A1ng lai":"Ch\u1EC9 xem t\u1ED1i \u0111a 5 th\xE1ng g\u1EA7n nh\u1EA5t","warning"))},T=(C,te,ce)=>Math.max(te,Math.min(ce,C)),E=()=>{var C;return Math.max(320,Number((C=Ve.current)==null?void 0:C.clientWidth)||360)},ee=()=>{const C=E();return T(Math.floor(C*.35),110,180)},we=()=>{const C=E();return T(Math.floor(C*.22),70,140)},le=C=>{try{if(!(C!=null&&C.touches)||C.touches.length!==1||cn)return;const te=C.target;if(te&&typeof te.closest=="function"&&te.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Ee.current=null;return}const ce=C.touches[0];Ee.current={x:ce.clientX,y:ce.clientY,at:Date.now(),swiping:!1}}catch(te){Ee.current=null}},ve=C=>{const te=Ee.current;if(!te||cn)return;const ce=(C==null?void 0:C.touches)&&C.touches[0];if(!ce)return;const pt=ce.clientX-te.x,Tt=ce.clientY-te.y,at=Math.abs(pt),ft=Math.abs(Tt);if(!te.swiping)if(at>12&&at>ft*1.2)te.swiping=!0,Vt(!1);else return;const $t=ee();Ze(T(pt,-$t,$t))},Fe=C=>{const te=Ee.current;if(Ee.current=null,!te||cn||!te.swiping){Ze(0);return}const ce=(C==null?void 0:C.changedTouches)&&C.changedTouches[0];if(!ce)return;const pt=ce.clientX-te.x,Tt=ce.clientY-te.y,at=Date.now()-te.at,ft=Math.abs(pt),$t=Math.abs(Tt);if(at>1e3)return;if(ft<30){Ze(0);return}if(ft<$t*1.5)return;const Lt=we(),It=ft>=Lt,dn=pt>0?1:-1;if(!It){Vt(!0),Ze(0),setTimeout(()=>Vt(!1),220);return}const gn=dn>0?-1:1,_n=p(d,gn);if(!q(_n)){Vt(!0),Ze(dn*Math.floor(ee()*.55)),setTimeout(()=>{Ze(0),setTimeout(()=>Vt(!1),200)},140),x(_n>M?"future":"past");return}Vt(!0),Ze(dn*ee()),setTimeout(()=>{X(s=>p(s,gn)),Ze(-dn*ee()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ze(0),setTimeout(()=>Vt(!1),220)})})},140)},qe=()=>{Ee.current=null,Ze(0)},Se=C=>{var te,ce;try{if(!C||C.pointerType==="touch"||typeof C.button=="number"&&C.button!==0||cn)return;const pt=C.target;if(pt&&typeof pt.closest=="function"&&pt.closest('input, textarea, select, button, a, [role="button"], [contenteditable="true"], .dropdown-menu, .modal')){Ee.current=null;return}Ee.current={x:C.clientX,y:C.clientY,at:Date.now(),swiping:!1};try{(ce=(te=C.currentTarget)==null?void 0:te.setPointerCapture)==null||ce.call(te,C.pointerId)}catch(Tt){}}catch(pt){Ee.current=null}},it=C=>{try{if(!C||C.pointerType==="touch")return;const te=Ee.current;if(!te||cn)return;const ce=C.clientX-te.x,pt=C.clientY-te.y,Tt=Math.abs(ce),at=Math.abs(pt);if(!te.swiping)if(Tt>12&&Tt>at*1.2)te.swiping=!0,Vt(!1);else return;const ft=ee();Ze(T(ce,-ft,ft))}catch(te){}},de=C=>{try{if(!C||C.pointerType==="touch")return;const te=Ee.current;if(Ee.current=null,!te||cn||!te.swiping){Ze(0);return}const ce=C.clientX-te.x,pt=C.clientY-te.y,Tt=Date.now()-te.at,at=Math.abs(ce),ft=Math.abs(pt);if(Tt>1e3)return;if(at<30){Ze(0);return}if(at<ft*1.5)return;const $t=we(),Lt=at>=$t,It=ce>0?1:-1;if(!Lt){Vt(!0),Ze(0),setTimeout(()=>Vt(!1),220);return}const dn=It>0?-1:1,gn=p(d,dn);if(!q(gn)){Vt(!0),Ze(It*Math.floor(ee()*.55)),setTimeout(()=>{Ze(0),setTimeout(()=>Vt(!1),200)},140),x(gn>M?"future":"past");return}Vt(!0),Ze(It*ee()),setTimeout(()=>{X(_n=>p(_n,dn)),Ze(-It*ee()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ze(0),setTimeout(()=>Vt(!1),220)})})},140)}catch(te){Ee.current=null}},Ge=()=>{Ee.current=null,Ze(0)},At=vt>0?"Th\xE1ng tr\u01B0\u1EDBc":vt<0?"Th\xE1ng sau":"",dt=vt>0?p(d,-1):vt<0?p(d,1):"",xe=dt&&q(dt)?dt:"",se=Math.min(1,Math.abs(vt)/Math.max(1,we()));return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager",ref:Ve,style:{touchAction:"pan-y",transform:`translateX(${vt}px)`,transition:cn?"transform 220ms ease":"none",willChange:"transform"},onTouchStartCapture:le,onTouchMoveCapture:ve,onTouchEndCapture:Fe,onTouchCancelCapture:qe,onPointerDown:Se,onPointerMove:it,onPointerUp:de,onPointerCancel:Ge},!!At&&React.createElement("div",{"aria-hidden":"true",style:{position:"fixed",left:0,right:0,top:84,zIndex:1060,pointerEvents:"none",opacity:.15+.55*se,transform:"translateZ(0)"}},React.createElement("div",{className:"d-flex justify-content-center"},React.createElement("div",{className:"px-3 py-2 rounded-pill bg-dark text-white shadow-sm",style:{fontSize:13}},vt>0?"\u2190":"\u2192"," ",At," \xB7 ",xe))),React.createElement(Loading,{show:Z}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>w(!0),disabled:Z},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:d,onChange:C=>X(C.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",yn,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),lt(nt.activeOrders)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),lt(nt.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),lt(nt.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",lt(nt.statusCounts.paid),"/",lt(nt.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n (kh\xF4ng t\xEDnh h\u1EE7y/nh\xE1p)"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},lt(nt.activeOrders)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},r(nt.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},r(nt.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},r(nt.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},r(nt.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",nt.avgQtyPerOrder?nt.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-light bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Nh\xE1p"),React.createElement("div",{className:"fw-semibold"},lt(nt.statusCounts.draft)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},lt(nt.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},lt(nt.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},lt(nt.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},lt(nt.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},lt(nt.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},lt(nt.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Nh\xE1p"),React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,lt(nt.statusCounts.draft)),React.createElement("td",null,lt(nt.statusCounts.pending)),React.createElement("td",null,lt(nt.statusCounts.processing)),React.createElement("td",null,lt(nt.statusCounts.canceled)),React.createElement("td",null,lt(nt.statusCounts.done)),React.createElement("td",null,lt(nt.statusCounts.paid)),React.createElement("td",null,lt(nt.statusCounts.other)),React.createElement("td",null,lt(nt.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},nt.products.slice(0,10).map(C=>React.createElement("div",{key:C.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.product_name),React.createElement("div",{className:"text-muted small text-truncate"},C.product_code?`#${C.product_code} \u2022 `:"",lt(C.orders)," \u0111\u01A1n \u2022 ",lt(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},r(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,nt.products.slice(0,10).map(C=>React.createElement("tr",{key:C.product_id},React.createElement("td",null,C.product_name),React.createElement("td",null,C.product_code||"\u2014"),React.createElement("td",null,lt(C.orders)),React.createElement("td",null,lt(C.quantity)),React.createElement("td",{className:"fw-semibold"},r(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},nt.customers.slice(0,10).map(C=>React.createElement("div",{key:C.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},C.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},C.phone||"\u2014"," \u2022 ",lt(C.orders)," \u0111\u01A1n \u2022 ",lt(C.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},r(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,nt.customers.slice(0,10).map(C=>React.createElement("tr",{key:C.key},React.createElement("td",null,C.customer_name||"\u2014"),React.createElement("td",null,C.phone||"\u2014"),React.createElement("td",null,lt(C.orders)),React.createElement("td",null,lt(C.quantity)),React.createElement("td",{className:"fw-semibold"},r(C.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},nt.days.map(C=>React.createElement("div",{key:C.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},C.day),React.createElement("div",{className:"text-muted small"},lt(C.orders)," \u0111\u01A1n \u2022 ",lt(C.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",lt(C.doneOrders)," \u2022 ",r(C.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},r(C.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,nt.days.map(C=>React.createElement("tr",{key:C.day},React.createElement("td",null,C.day),React.createElement("td",null,lt(C.orders)),React.createElement("td",null,lt(C.quantity)),React.createElement("td",{className:"fw-semibold"},r(C.revenue)),React.createElement("td",null,lt(C.doneOrders)),React.createElement("td",{className:"fw-semibold"},r(C.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:H,onMenuChange:d=>{We(d),Oe(d),d==="albums"&&(Ie(null),Ue([]),Ct(null))},onLogout:_e,currentUser:ne,pinnedMenus:Le,recentMenus:Xe,onTogglePin:St}),React.createElement("div",{className:"main-content"},React.createElement("header",{className:"admin-topbar",role:"banner"},(()=>{const X={search:{title:"Tra c\u1EE9u",icon:"fa-search",sub:"T\xECm nhanh s\u1EA3n ph\u1EA9m/kh\xE1ch/\u0111\u01A1n"},albums:{title:"Album",icon:"fa-images",sub:"Qu\u1EA3n l\xFD \u1EA3nh & folder"},videos:{title:"Video",icon:"fa-video",sub:"Qu\u1EA3n l\xFD video & folder"},products:{title:"S\u1EA3n ph\u1EA9m",icon:"fa-box",sub:"Danh s\xE1ch, gi\xE1, m\xF4 t\u1EA3"},orders:{title:"\u0110\u01A1n h\xE0ng",icon:"fa-receipt",sub:"T\u1EA1o & theo d\xF5i tr\u1EA1ng th\xE1i"},recon:{title:"\u0110\u1ED1i so\xE1t Excel",icon:"fa-file-excel",sub:"\u0110\u1ED1i so\xE1t c\xF4ng n\u1EE3 t\u1EEB Excel"},stats:{title:"Th\u1ED1ng k\xEA",icon:"fa-chart-column",sub:"Doanh thu & hoa h\u1ED3ng"},settings:{title:"C\xE0i \u0111\u1EB7t",icon:"fa-cog",sub:"Tu\u1EF3 ch\u1EC9nh h\u1EC7 th\u1ED1ng"}}[H]||{title:"KTM Admin",icon:"fa-tractor",sub:""},Z=(ne==null?void 0:ne.username)||(ne==null?void 0:ne.name)||(ne==null?void 0:ne.email)||"Admin",Re=(()=>{if(H!=="albums")return"";const Ee=[];return Ee.push("Root"),Array.isArray(Te)&&Te.length>0&&Ee.push(...Te.map(Ve=>Ve==null?void 0:Ve.title).filter(Boolean)),yt!=null&&yt.title&&Ee.push(yt.title),Ee.length>0?Ee.join(" / "):""})();return React.createElement("div",{className:"admin-topbar-inner"},React.createElement("div",{className:"admin-topbar-left"},React.createElement("div",{className:"admin-page-icon","aria-hidden":"true"},React.createElement("i",{className:`fas ${X.icon}`})),React.createElement("div",{className:"admin-page-title"},React.createElement("div",{className:"admin-page-heading"},X.title),React.createElement("div",{className:"admin-page-subtitle"},Re||X.sub))),React.createElement("div",{className:"admin-topbar-right"},H==="albums"&&React.createElement("button",{className:"btn btn-warning btn-sm admin-topbar-action",onClick:on,title:"T\u1EA1o folder"},React.createElement("i",{className:"fas fa-plus me-2"}),React.createElement("span",{className:"d-none d-sm-inline"},"Folder")),React.createElement("a",{href:"/",className:"btn btn-outline-secondary btn-sm d-none d-md-inline-flex",title:"V\u1EC1 trang ch\u1EE7"},React.createElement("i",{className:"fas fa-home me-2"}),"Trang ch\u1EE7"),React.createElement("div",{className:"admin-user-chip",title:Z},React.createElement("i",{className:"fas fa-user-circle"}),React.createElement("span",{className:"admin-user-chip-name"},Z)),React.createElement("button",{className:"btn btn-outline-danger btn-sm d-md-none",onClick:_e,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"}))))})()),React.createElement("div",{className:"admin-page-body"},H==="albums"&&!yt&&React.createElement(AlbumList,{albums:K,loading:Et,currentFolder:re,breadcrumb:Te,onSelect:fn,onCreate:on,onEdit:Ft,onDelete:ae,onBack:$}),H==="search"&&React.createElement(SearchCenter,{showToast:rt,onNavigate:(d,X,Z)=>{Oe(d),d==="orders"&&X==="create"&&(ze(Date.now()),Ke((Z==null?void 0:Z.productId)||""))}}),H==="albums"&&yt&&React.createElement(AlbumDetail,{album:yt,parentAlbum:Te.length>0?Te[Te.length-1]:null,onBack:()=>{if(yt.parentId){const d=Te.findIndex(X=>X.uuid===yt.parentId);d>=0?wt(Te[d]):wt(null)}else wt(null)},onRefresh:()=>Ct(re==null?void 0:re.uuid),showToast:rt,onNavigateToFolder:d=>{Ue(X=>[...X,yt]),wt(d)},onEditSubfolder:d=>{gt(d),et(!0)}}),H==="videos"&&React.createElement(VideoList,{showToast:rt}),H==="products"&&React.createElement(ProductManager,{showToast:rt,settings:F}),H==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:je,autoOpenCreateProductId:pe,showToast:rt}),H==="recon"&&React.createElement(ReconExcelManager,{showToast:rt}),H==="stats"&&React.createElement(P,null),H==="settings"&&React.createElement(Jt,null))),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${H==="search"?"active":""}`,onClick:d=>{d.preventDefault(),Oe("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${H==="albums"?"active":""}`,onClick:d=>{d.preventDefault(),Oe("albums"),wt(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${H==="videos"?"active":""}`,onClick:d=>{d.preventDefault(),Oe("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${H==="products"?"active":""}`,onClick:d=>{d.preventDefault(),Oe("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${H==="orders"?"active":""}`,onClick:d=>{d.preventDefault(),Oe("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${H==="recon"?"active":""}`,onClick:d=>{d.preventDefault(),Oe("recon")}},React.createElement("i",{className:"fas fa-file-excel"}),React.createElement("span",null,"\u0110\u1ED1i so\xE1t")),React.createElement("a",{href:"#",className:`nav-item ${H==="stats"?"active":""}`,onClick:d=>{d.preventDefault(),Oe("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:He,album:De,parentId:re==null?void 0:re.uuid,onClose:()=>et(!1),onSave:un}),React.createElement(AdminDrawer,{open:jt,title:S?S.title:"Album",subtitle:S?`${S.subfolderCount||0} subfolder \u2022 ${S.count||0} \u1EA3nh`:"",onClose:qt,footer:ge?React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{Ne(!1)}},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>{S&&(gt(S),un({slug:S.id||"",title:S.title||"",description:S.description||"",cover_url:S.cover||"",parent_id:S.parentId||null},"drawer"))}},React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")):S?React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{window.KTM.clipboard.writeText(S.title),rt("\u0110\xE3 copy t\xEAn folder","success")}},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>pn(S)},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa"),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>{S&&confirm(`X\xF3a folder "${S.title}"?`)&&(ae(S),qt())}},React.createElement("i",{className:"fas fa-trash me-2"}),"X\xF3a"))):null},ge&&S?React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:S.title,onChange:d=>B({...S,title:d.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:S.description,onChange:d=>B({...S,description:d.target.value})}))):S?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"Th\xF4ng tin"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},S.title),React.createElement("div",{className:"k"},"Slug"),React.createElement("div",{className:"v font-monospace"},S.id),React.createElement("div",{className:"k"},"Subfolder"),React.createElement("div",{className:"v"},S.subfolderCount||0),React.createElement("div",{className:"k"},"\u1EA2nh"),React.createElement("div",{className:"v"},S.count||0))),S.description&&React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-note-sticky me-2 text-secondary"}),"M\xF4 t\u1EA3"),React.createElement("p",null,S.description))):React.createElement("div",{className:"text-muted"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u")),React.createElement("div",{className:"toast-container"},Qe.map(d=>React.createElement(Toast,{key:d.id,message:d.message,type:d.type,actionLabel:d.actionLabel,onAction:d.onAction,durationMs:d.durationMs,onClose:()=>Qt(d.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:_,autoOpenCreateProductId:R,showToast:L}){const[ye,ne]=useState([]),[V,H]=useState(0),[Oe,Le]=useState(!1),[Ce,Xe]=useState(!1),[tt,je]=useState([]),[ze,pe]=useState(!0),[Ke,K]=useState(!1),[mt,yt]=useState([]),[wt,He]=useState(!1),[et,De]=useState(""),[gt,Et]=useState([]),[tn,Qe]=useState(!1),[Kt,jt]=useState(""),[A,S]=useState(!1),[B,ge]=useState(null),[Ne,oe]=useState(null),[me,Me]=useState(!1),[N,F]=useState(()=>{const e=new Date,n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${n}-${t}`}),[J,re]=useState(""),[Ie,Te]=useState(!1),[Ue,We]=useState(!1),[St,Rt]=useState(!1),[_e,rt]=useState(null),[Qt,Ct]=useState(!1),[on,Ft]=useState(""),[un,fn]=useState(!1),$=useRef(0),[ae,Ye]=useState(!1),[qt,pn]=useState(null),[Xt,Jt]=useState(!1),[P,d]=useState(null),[X,Z]=useState(()=>({left:12,top:12,placement:"bottom"})),Re=useRef(null),Ee=useRef(!1),Ve=useRef({active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1}),[vt,Ze]=useState(()=>({id:null,dir:null})),cn=useRef(!1),Vt=useRef(new Map),nn=useRef(null),hn=useRef(null),nt="ktm_orders_status_sync_queue_v1",ln=useRef([]),Mn=useRef(!1),[yn,lt]=useState(()=>({})),[r,c]=useState(!1),[w,p]=useState(!1),[M,z]=useState(!1),[q,b]=useState(()=>new Set),[x,T]=useState(()=>({})),E="ktm_orders_pinned_v1",[ee,we]=useState(()=>new Set),[le,ve]=useState(!1),[Fe,qe]=useState(!1),[Se,it]=useState(!1),[de,Ge]=useState(""),[At,dt]=useState(()=>[]),xe=useRef(null),se=useRef(null),C=useRef(!1),te=useRef({active:!1,startY:0,startX:0,fired:!1}),[ce,pt]=useState(()=>{try{return((window==null?void 0:window.innerWidth)||1024)<768}catch(e){return!1}}),Tt=24,at=20,[ft,$t]=useState(Tt),Lt=useRef(null),It=useRef(null),dn=useRef(!1),gn=useRef(new Map),_n=useRef({timer:null,events:[]}),s=useRef(null),f="ktm_orders_phone_tip_v1",u="ktm_orders_search_history_v1",[j,W]=useState(null),[O,k]=useState(!1),[Y,ue]=useState([]),[Q,ie]=useState(!1),[Be,Je]=useState([]),[h,ke]=useState({customer_name:"",phone:"",address:"",note:"",items:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[xt,Mt]=useState([""]),[Ot,Bt]=useState(null),Ut=useRef({}),[zt,Wt]=useState([]),[bt,an]=useState(null),mn=useRef(null),sn=useRef(null),G=useRef(0),U=useRef(null),be=useRef(0),Pe=useRef(new Map),$e=useRef(null),Ae=useRef(0),ut=useRef(new Map),ot=useRef(new Map),Nt=useRef(""),Yt=useRef(null),rn=useRef(null),vn=useRef(0),Sn=useRef(null),wn=9,xn=150,$n=250,In=3*60*1e3,Dn=24*60*60*1e3,Bn=5*60*1e3,Ln="ktm_customer_lookup_cache_v1",fa=200,Rn=3,zn=3,Ka=1,Ds=24*60*60*1e3,Rs=120,Os=5*60*1e3,Ya=80,Qa=2,Za=4,es=60,st=React.useMemo(()=>String(et||"").trim().length>0,[et]),ia=React.useMemo(()=>[{value:"draft",label:"\u0110\u01A1n nh\xE1p"},{value:"pending",label:"Ch\u1EDD x\u1EED l\xFD"},{value:"processing",label:"\u0110ang v\u1EADn chuy\u1EC3n"},{value:"done",label:"Ho\xE0n th\xE0nh"},{value:"paid",label:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},{value:"canceled",label:"H\u1EE7y \u0111\u01A1n"}],[]),ts=e=>{pn(e),Ye(!0)},ns=(e,n)=>{var t,a,i,o;try{const g=(t=n==null?void 0:n.getBoundingClientRect)==null?void 0:t.call(n),m=window.innerWidth||360,I=window.innerHeight||640,y=230,l=280,v=Math.min(Math.max(10,Math.round((a=g==null?void 0:g.left)!=null?a:10)),Math.max(10,m-y-10));let D=Math.round(((i=g==null?void 0:g.bottom)!=null?i:10)+8),he="bottom";D+l>I-10&&(D=Math.max(10,Math.round(((o=g==null?void 0:g.top)!=null?o:10)-8-l)),he="top"),Z({left:v,top:D,placement:he})}catch(g){Z({left:12,top:12,placement:"bottom"})}d(e),Jt(!0)},Hn=()=>{Jt(!1),setTimeout(()=>d(null),120)};useEffect(()=>{if(!Xt)return;const e=n=>{n.key==="Escape"&&Hn()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Xt]);const Xn=()=>{Ye(!1),setTimeout(()=>pn(null),180)},Es=()=>{c(!0)},ba=()=>{c(!1)},as=e=>{const n=String(e||"").trim();n&&b(t=>{const a=new Set(t);return a.has(n)?a.delete(n):a.add(n),a})};useEffect(()=>{try{const e=localStorage.getItem(E);if(!e)return;const n=JSON.parse(e);if(!Array.isArray(n))return;we(new Set(n.map(t=>String(t||"").trim()).filter(Boolean)))}catch(e){}},[]),useEffect(()=>{try{const e=Array.from(ee||[]).map(n=>String(n||"").trim()).filter(Boolean);localStorage.setItem(E,JSON.stringify(e))}catch(e){}},[ee]);const Ks=e=>{const n=String(e||"").trim();n&&we(t=>{const a=new Set(t);return a.has(n)?a.delete(n):a.add(n),a})};useEffect(()=>{try{const e=localStorage.getItem(u);if(!e)return;const n=JSON.parse(e);if(!Array.isArray(n))return;dt(n.map(t=>String(t||"").trim()).filter(Boolean).slice(0,10))}catch(e){}},[]);const Ps=e=>{try{localStorage.setItem(u,JSON.stringify(e))}catch(n){}},oa=e=>{const n=String(e||"").trim();n&&dt(t=>{const a=Array.isArray(t)?t:[],i=[n,...a.filter(o=>String(o||"").trim().toLowerCase()!==n.toLowerCase())].slice(0,10);return Ps(i),i})},ss=e=>{var t;const n=String((t=e!=null?e:et)!=null?t:"").trim();Ge(n),it(!0),setTimeout(()=>{var a,i;try{(i=(a=xe.current)==null?void 0:a.focus)==null||i.call(a)}catch(o){}},0)},An=()=>{it(!1)};useEffect(()=>{if(!Se)return;const e=n=>{n.key==="Escape"&&An()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Se]),useEffect(()=>{if(!ce)return;const e=a=>{if(Se||(window.scrollY||0)>6)return;const i=a.touches&&a.touches[0];i&&(te.current={active:!0,startY:i.clientY,startX:i.clientX,fired:!1})},n=a=>{const i=te.current;if(!(i!=null&&i.active)||i.fired||(window.scrollY||0)>6)return;const o=a.touches&&a.touches[0];if(!o)return;const g=o.clientY-i.startY,m=o.clientX-i.startX;Math.abs(m)>24||g>92&&(i.fired=!0,ss(et))},t=()=>{te.current={active:!1,startY:0,startX:0,fired:!1}};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",n,{passive:!0}),window.addEventListener("touchend",t,{passive:!0}),window.addEventListener("touchcancel",t,{passive:!0}),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",n),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)}},[ce,Se,et]);const rs=e=>{try{const n=bn(e==null?void 0:e.status);if(!(n==="pending"||n==="processing"))return!1;const t=new Date(e==null?void 0:e.created_at);if(!Number.isFinite(t.getTime()))return!1;const a=new Date;return t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()}catch(n){return!1}};useEffect(()=>{var t;let e;const n=()=>{try{pt(e?!!e.matches:((window==null?void 0:window.innerWidth)||1024)<768)}catch(a){pt(!1)}};try{e=(t=window.matchMedia)==null?void 0:t.call(window,"(max-width: 767.98px)"),e!=null&&e.addEventListener?e.addEventListener("change",n):e!=null&&e.addListener&&e.addListener(n)}catch(a){e=null}return window.addEventListener("resize",n),n(),()=>{try{e!=null&&e.removeEventListener?e.removeEventListener("change",n):e!=null&&e.removeListener&&e.removeListener(n)}catch(a){}window.removeEventListener("resize",n)}},[]),useEffect(()=>{const e="admin-sheet-open";return ae||r||Xt?document.body.classList.add(e):document.body.classList.remove(e),()=>document.body.classList.remove(e)},[ae,r,Xt]),useEffect(()=>{if(!ae&&!r&&!Xt)return;const e=n=>{n.key==="Escape"&&(ae&&Xn(),r&&ba(),Xt&&Hn())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ae,r,Xt]);const Ls=()=>{try{if(localStorage.getItem(f))return;localStorage.setItem(f,"1"),typeof L=="function"&&L("Tip: Ch\u1EA1m S\u0110T \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy","info",{durationMs:7e3})}catch(e){}},is=e=>String((e==null?void 0:e.address)||"").replace(/\s*\n+\s*/g,", ").replace(/\s+/g," ").trim(),os=e=>String((e==null?void 0:e.note)||"").replace(/\s*\n+\s*/g," \u2014 ").replace(/\s+/g," ").trim(),cs=e=>{const n=Gt(String(e||"")).replace(/[^0-9+]/g,"");if(n)try{window.location.href=`tel:${n}`}catch(t){}},js=async e=>{var t,a,i;const n=Gt(String(e||"")).replace(/[^0-9+]/g,"");if(n)try{await((i=(a=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:a.call(t,n))!=null?i:Promise.reject(new Error("Clipboard not available"))),typeof L=="function"&&L("\u0110\xE3 copy S\u0110T","success")}catch(o){typeof L=="function"&&L("Kh\xF4ng copy \u0111\u01B0\u1EE3c S\u0110T","danger")}},Fs=()=>{try{const e=localStorage.getItem(nt),n=e?JSON.parse(e):[];return Array.isArray(n)?n:[]}catch(e){return[]}},ls=e=>{try{localStorage.setItem(nt,JSON.stringify(Array.isArray(e)?e:[]))}catch(n){}},ga=(e,n)=>{const t=String(e||"").trim();t&&lt(a=>{const i={...a||{}};return n?i[t]=!0:delete i[t],i})},qs=(e,n,t)=>{const a=String(e||"").trim(),i=bn(n),o=bn(t);if(!a||!i)return;const g=Array.isArray(ln.current)?ln.current:[],m=new Map(g.map(y=>[String((y==null?void 0:y.orderId)||""),y]));m.set(a,{orderId:a,nextStatus:i,prevStatus:o,ts:Date.now()});const I=Array.from(m.values()).sort((y,l)=>(Number(y.ts)||0)-(Number(l.ts)||0));ln.current=I,ls(I),ga(a,!0)},Pa=async()=>{if(Mn.current||!navigator.onLine)return;const e=Array.isArray(ln.current)?ln.current.slice():[];if(e.length){Mn.current=!0;try{for(const n of e){const t=String((n==null?void 0:n.orderId)||"").trim(),a=bn(n==null?void 0:n.nextStatus);if(!(!t||!a)){ga(t,!0);try{await Jn({id:t,status:(n==null?void 0:n.prevStatus)||""},a,{silentToast:!0,skipToastBatch:!0,fromSync:!0});const i=(Array.isArray(ln.current)?ln.current:[]).filter(o=>String((o==null?void 0:o.orderId)||"")!==t);ln.current=i,ls(i),ga(t,!1)}catch(i){if(!navigator.onLine)break}}}}finally{Mn.current=!1}}};useEffect(()=>{const e=Fs();ln.current=e;try{const n={};for(const t of e){const a=String((t==null?void 0:t.orderId)||"").trim();a&&(n[a]=!0)}lt(n)}catch(n){}setTimeout(()=>Pa(),600)},[]),useEffect(()=>{const e=()=>Pa();window.addEventListener("online",e);const n=setInterval(()=>Pa(),8e3);return()=>{clearInterval(n),window.removeEventListener("online",e)}},[]);const Bs=(e,n)=>{var t;(t=e==null?void 0:e.stopPropagation)==null||t.call(e),dn.current=!1,Ls();try{It.current&&clearTimeout(It.current)}catch(a){}It.current=setTimeout(()=>{dn.current=!0,js(n)},520)},ya=e=>{var n;(n=e==null?void 0:e.stopPropagation)==null||n.call(e);try{It.current&&clearTimeout(It.current)}catch(t){}It.current=null},zs=e=>{const n=String(e||"").trim();if(!n)return;T(i=>({...i,[n]:Date.now()}));const t=gn.current;try{const i=t.get(n);i&&clearTimeout(i)}catch(i){}const a=setTimeout(()=>{T(i=>{const o={...i||{}};return delete o[n],o});try{t.delete(n)}catch(i){}},9e3);t.set(n,a)},ds=e=>String(e||"").replace(/\s+/g," ").trim(),Hs=e=>String(e||"").replace(/[^0-9]+/g,""),ca=e=>{try{const n=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(n))return 0;const t=Date.now()-n;return!Number.isFinite(t)||t<=0?0:Math.floor(t/Ds)}catch(n){return 0}},va=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:ca(e)>=Rn,bn=e=>{const n=String(e!=null?e:"").trim().toLowerCase();return n==="cancelled"?"canceled":n},La=React.useMemo(()=>["draft","pending","processing","done","paid"],[]),Yn=(e,n)=>{const t=bn(e);if(!t||t==="canceled")return null;const a=La.indexOf(t);return a<0?null:n==="left"?La[a+1]||null:n==="right"&&La[a-1]||null},ms=e=>{var i;const n=bn(e);if(!n)return{label:"",icon:"fa-circle"};const t=((i=ia.find(o=>bn(o==null?void 0:o.value)===n))==null?void 0:i.label)||"",a=(()=>{switch(n){case"draft":return"fa-file-lines";case"pending":return"fa-hourglass-half";case"processing":return"fa-truck";case"done":return"fa-check";case"paid":return"fa-money-bill-wave";case"canceled":return"fa-ban";default:return"fa-circle"}})();return{label:t,icon:a}},Na=e=>{if(bn(e==null?void 0:e.status)!=="draft")return null;const t=zn-ca(e);return Number.isFinite(t)?t:null},wa=e=>{const n=Na(e);return Number.isFinite(n)?n>0&&n<=Ka:!1},Vn=e=>{ke({customer_name:"",phone:"",address:"",note:"",items:[{product_id:e||"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:[{amount:"",note:""}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Mt([""]),W(null),Bt(null)};useEffect(()=>{const e=n=>{var a;if(Ot==null)return;const t=(a=Ut.current)==null?void 0:a[Ot];t&&!t.contains(n.target)&&Bt(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Ot]);const us=e=>window.KTM.money.parseMoney(e),ps=e=>window.KTM.money.parseSignedMoney(e),Pt=e=>window.KTM.money.formatVND(e),On=e=>{const t=(Array.isArray(e)?e:[]).map(a=>{var i,o;return{amount:String((i=a==null?void 0:a.amount)!=null?i:""),note:String((o=a==null?void 0:a.note)!=null?o:"")}});return t.length?t:[{amount:"",note:""}]},Xs=e=>{try{const n=window.KTM.orders.getOrderAdjustmentItems(e),t=(Array.isArray(n)?n:[]).map(a=>{var i,o;return{amount:(a==null?void 0:a.amount)===0?"":String((i=a==null?void 0:a.amount)!=null?i:""),note:String((o=a==null?void 0:a.note)!=null?o:"").trim()}}).filter(a=>String(a.amount||"").trim()||String(a.note||"").trim());return t.length?t:[{amount:"",note:""}]}catch(n){return[{amount:"",note:""}]}},Qn=e=>(Array.isArray(e)?e:[]).map(t=>({amount:ps(t==null?void 0:t.amount),note:String((t==null?void 0:t.note)||"").trim()})).filter(t=>t.amount!==0||!!t.note),ja=e=>{const n=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],t=Qn(n),a=Zn(t),i=(()=>{if(!t.length)return"";const o=t.map(g=>String((g==null?void 0:g.note)||"").trim()).filter(Boolean);return o.length?o.join(" \u2022 "):t.length>1?`${t.length} m\u1EE5c`:""})();return{cleanAdjItems:t,amount:a,summaryText:i}},Zn=e=>(Array.isArray(e)?e:[]).reduce((t,a)=>t+(Number(a==null?void 0:a.amount)||0),0),Fa=e=>{const n=Array.isArray(e)?e:[];return n.length?JSON.stringify(n):""},hr=e=>window.KTM.money.parseShipFeeFromNote(e),ea=e=>window.KTM.phone.isValid(e),Gt=e=>window.KTM.phone.normalize(e),qa=async e=>{if(!e)return null;const n=await window.KTM.api.getJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");return n&&typeof n=="object"&&n.order&&typeof n.order=="object"?n.order:n},Vs=(e,n)=>{var o;const t=Array.isArray(e)?e:[],a=Array.isArray(n)?n:[];if(!t.length)return a;if(!a.length)return t;const i=new Map(t.map(g=>{var m;return[String((m=g==null?void 0:g.id)!=null?m:""),g]}));for(const g of a){const m=String((o=g==null?void 0:g.id)!=null?o:"");m&&i.set(m,g)}return Array.from(i.values())},Sa=async e=>{var n,t,a,i;if(!(e!=null&&e.id)||Array.isArray(e.items)&&e.items.length)return e;try{const o=(t=(n=Vt.current)==null?void 0:n.get)==null?void 0:t.call(n,String(e.id));if(o&&typeof o=="object"&&Array.isArray(o.items)&&o.items.length)return o}catch(o){}try{const o=await qa(e.id);if(o&&typeof o=="object"){try{(i=(a=Vt.current)==null?void 0:a.set)==null||i.call(a,String(e.id),o)}catch(g){}return ne(g=>Array.isArray(g)?g.map(m=>String(m==null?void 0:m.id)===String(e.id)?o:m):g),o}}catch(o){console.error("Fetch order by id error:",o)}return e},Ws=()=>{var e;try{const n=localStorage.getItem(Ln);if(!n)return;const t=JSON.parse(n);if(!t||typeof t!="object")return;const a=Object.entries(t);for(const[i,o]of a)!i||!o||typeof o!="object"||(e=ot.current)==null||e.set(String(i),o)}catch(n){}},Ba=()=>{try{const e=ot.current;if(!e||typeof e.entries!="function")return;const n=Array.from(e.entries()).filter(([a,i])=>a&&i&&typeof i=="object"&&Number.isFinite(i.ts)).sort((a,i)=>(Number(i[1].ts)||0)-(Number(a[1].ts)||0)).slice(0,fa),t={};for(const[a,i]of n)t[a]=i;localStorage.setItem(Ln,JSON.stringify(t))}catch(e){}};useEffect(()=>{Ws()},[]);const hs=e=>{const n=Gt(e);if(!n)return null;const t=Array.isArray(ye)?ye:[];let a=null,i=-1;for(const o of t){if(!o||Gt(o.phone||"")!==n)continue;const g=new Date(o.created_at).getTime(),m=Number.isFinite(g)?g:0;m>=i&&(i=m,a=o)}return a?{name:String(a.customer_name||"").trim(),address:String(a.address||"").trim()}:null},fs=(e,n)=>{e&&ke(t=>n&&Gt(t.phone)!==n?t:{...t,customer_name:e.name||t.customer_name,address:e.address||t.address})},Gs=e=>{const n=hs(e);if(!n)return;const t=Gt(e);ke(a=>{if(t&&Gt(a.phone)!==t)return a;const i={...a};return!String(a.customer_name||"").trim()&&n.name&&(i.customer_name=n.name),!String(a.address||"").trim()&&n.address&&(i.address=n.address),i})},Js=(e,n,t)=>{var a;try{const i=Gt(e);if(!i)return;const o=String(n||"").trim(),g=String(t||"").trim();if(!o&&!g)return;(a=ot.current)==null||a.set(i,{ts:Date.now(),status:"found",customer:{phone:i,name:o||null,address:g||null}}),Ba()}catch(i){}},xa=async e=>{var i,o,g;const n=Gt(e);if(!n)return;Gs(n);const t=(i=ot.current)==null?void 0:i.get(n);if(t&&Number.isFinite(t.ts)){const m=Date.now()-t.ts,I=t.status==="found"?Dn:Bn;if(m>=0&&m<=I){W({status:t.status,phone:n,customer:t.customer}),t.status==="found"&&t.customer&&fs(t.customer,n);return}}const a=++G.current;W({status:"loading",phone:n});try{const m=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(n)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(G.current!==a)return;if(m&&m.exists&&m.customer){(o=ot.current)==null||o.set(n,{ts:Date.now(),status:"found",customer:m.customer}),Ba(),W({status:"found",phone:n,customer:m.customer}),fs(m.customer,n);return}(g=ot.current)==null||g.set(n,{ts:Date.now(),status:"not-found",customer:null}),Ba(),W({status:"not-found",phone:n})}catch(m){if(G.current!==a)return;console.error("Customer lookup error:",m),W({status:"error",phone:n})}},bs=e=>{const n=Gt(e),t=hs(n);ke(i=>{const o={...i,phone:n};return t&&(!String(i.customer_name||"").trim()&&t.name&&(o.customer_name=t.name),!String(i.address||"").trim()&&t.address&&(o.address=t.address)),o}),k(!1),sn.current&&(clearTimeout(sn.current),sn.current=null);const a=n;if(a.length<wn){W(null);return}if(ea(a)&&a!==Nt.current){Nt.current=a,xa(a);return}sn.current=setTimeout(()=>{const i=Gt(n);ea(i)&&i!==Nt.current&&(Nt.current=i,xa(i))},xn)},gs=()=>{const e=Gt(h.phone);e.length<wn||ea(e)&&e!==Nt.current&&(Nt.current=e,xa(e))};useEffect(()=>(Ue?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[Ue]);const ka=Array.isArray(h.items)?h.items.length:0;useEffect(()=>{if(!Ue){vn.current=ka;return}ka>vn.current&&setTimeout(()=>{const e=Yt.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),vn.current=ka},[Ue,ka]),useEffect(()=>()=>{sn.current&&(clearTimeout(sn.current),sn.current=null),U.current&&(clearTimeout(U.current),U.current=null)},[]),useEffect(()=>{if(!Ue)return;U.current&&(clearTimeout(U.current),U.current=null);const e=Gt((h==null?void 0:h.phone)||"");if(!ea(e)){ue([]),ie(!1);return}return U.current=setTimeout(async()=>{var i;const n=String(e),t=(i=Pe.current)==null?void 0:i.get(n);if(t&&Number.isFinite(t.ts)&&Date.now()-t.ts<=In){ue(Array.isArray(t.orders)?t.orders:[]),ie(!1);return}const a=++be.current;ie(!0);try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(e)}`,g=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i l\u1ECBch s\u1EED \u0111\u01A1n theo S\u0110T");if(be.current!==a)return;const m=Array.isArray(g)?g:Array.isArray(g==null?void 0:g.orders)?g.orders:[];ue(m);try{const I=Pe.current;if(I&&typeof I.set=="function"&&(I.set(n,{ts:Date.now(),orders:m}),I.size>100)){const y=Array.from(I.entries()).sort((v,D)=>{var he,fe;return(Number((he=v==null?void 0:v[1])==null?void 0:he.ts)||0)-(Number((fe=D==null?void 0:D[1])==null?void 0:fe.ts)||0)}),l=Math.max(0,y.length-100);for(let v=0;v<l;v++)I.delete(y[v][0])}}catch(I){}}catch(o){if(be.current!==a)return;console.error("Phone history fetch error:",o),ue([])}finally{if(be.current!==a)return;ie(!1)}},$n),()=>{U.current&&(clearTimeout(U.current),U.current=null)}},[Ue,h==null?void 0:h.phone]),useEffect(()=>{Qs()},[]),useEffect(()=>{st||Wn()},[N,st]),useEffect(()=>{Ta()},[]),useEffect(()=>{_&&mn.current!==_&&(mn.current=_,Ma(R))},[_]);const Tn=e=>e==="draft"?"\u0110\u01A1n nh\xE1p":e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="cancelled"||e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",ta=e=>e==="draft"?"bg-light text-dark":e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="cancelled"||e==="canceled"?"bg-danger":"bg-light text-dark",jn=React.useMemo(()=>{const e=window.KTM.orders.sortOrders(ye),n=ee;if(!n||!(n instanceof Set)||n.size===0)return e;const t=Array.isArray(e)?e.slice():[];return t.sort((a,i)=>{var m,I;const o=n.has(String((m=a==null?void 0:a.id)!=null?m:""))?1:0;return(n.has(String((I=i==null?void 0:i.id)!=null?I:""))?1:0)-o}),t},[ye,ee]),za=React.useMemo(()=>window.KTM.orders.sortOrders(tt),[tt]),Ca=React.useMemo(()=>{const n=(Array.isArray(za)?za:[]).filter(t=>va(t));return n.sort((t,a)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(a==null?void 0:a.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),n},[za]),ys=React.useMemo(()=>{const n=(Array.isArray(mt)?mt:[]).filter(t=>wa(t));return n.sort((t,a)=>{const i=new Date(t==null?void 0:t.created_at).getTime(),o=new Date(a==null?void 0:a.created_at).getTime();return(Number.isFinite(i)?i:0)-(Number.isFinite(o)?o:0)}),n},[mt]),la=React.useMemo(()=>{if(Ie)return Ca;let e=jn;if(le){const n=ee;e=(Array.isArray(e)?e:[]).filter(t=>{var a,i;return(i=n==null?void 0:n.has)==null?void 0:i.call(n,String((a=t==null?void 0:t.id)!=null?a:""))})}return Fe&&(e=(Array.isArray(e)?e:[]).filter(n=>rs(n))),e},[Ie,Ca,jn,le,ee,Fe]),Aa=React.useMemo(()=>{if(Ie)return la;const e=String(J||"").trim();return e?(Array.isArray(la)?la:[]).filter(n=>String((n==null?void 0:n.status)||"").trim()===e):la},[la,J,Ie]),vs=React.useMemo(()=>window.KTM.orders.sortOrders(gt),[gt]),en=React.useMemo(()=>st?vs:Aa,[Aa,st,vs]),Ns=React.useMemo(()=>{const e=Array.isArray(en)?en:[];return ce?e.slice(0,Math.max(0,Number(ft)||0)):e},[ce,ft,en]);useEffect(()=>{ce&&$t(Tt)},[ce,J,Ie,N,et]),useEffect(()=>{if(!ce)return;const e=Array.isArray(en)?en.length:0;if(ft>=e)return;const n=Lt.current;if(!n)return;const t=new IntersectionObserver(a=>{Array.isArray(a)&&a.some(o=>o==null?void 0:o.isIntersecting)&&$t(o=>Math.min((Number(o)||0)+at,e))},{root:null,rootMargin:"520px 0px",threshold:0});return t.observe(n),()=>t.disconnect()},[ce,ft,en]),useEffect(()=>{if(!ce){p(!1),z(!1);return}const e=()=>{s.current||(s.current=window.requestAnimationFrame(()=>{s.current=null;const n=window.scrollY||document.documentElement.scrollTop||0;p(n>140),z(n>60)}))};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e),s.current&&(window.cancelAnimationFrame(s.current),s.current=null)}},[ce]),useEffect(()=>{if(!ce){try{document.documentElement.style.removeProperty("--ktm-mobile-bottom-nav-h")}catch(n){}return}const e=()=>{try{const n=document.querySelector(".mobile-bottom-nav"),t=n&&n.offsetHeight?n.offsetHeight:0;document.documentElement.style.setProperty("--ktm-mobile-bottom-nav-h",`${t}px`)}catch(n){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[ce]);const Fn=React.useMemo(()=>{const e=Array.isArray(en)?en:[],n={all:e.length,draft:0,pending:0,processing:0,done:0,paid:0,canceled:0,other:0};for(const t of e){const a=bn(t==null?void 0:t.status);a==="draft"?n.draft+=1:a==="pending"?n.pending+=1:a==="processing"?n.processing+=1:a==="done"?n.done+=1:a==="paid"?n.paid+=1:a==="canceled"?n.canceled+=1:n.other+=1}return n},[en]),Us=React.useMemo(()=>{const e=ee;return!e||e.size===0?0:(Array.isArray(jn)?jn:[]).reduce((n,t)=>{var a;return n+(e.has(String((a=t==null?void 0:t.id)!=null?a:""))?1:0)},0)},[ee,jn]),Ys=React.useMemo(()=>(Array.isArray(jn)?jn:[]).filter(e=>rs(e)).length,[jn]),ws=React.useMemo(()=>{const e=new Date,n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${n}-${t}`},[]),Pn=e=>{if(st&&De(""),e==="thisMonth"){Te(!1),re(""),F(ws);return}if(e==="overduePending"){F(""),Te(!0),re("pending");return}if(e==="draftExpiring"){Te(!1),re("draft"),F(""),Ta();return}if(e==="all"){Te(!1),re(""),F(ws);return}},na=e=>window.KTM.date.formatDateTime(e),Qs=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products?fields=order`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");Wt(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),Wt([])}},Wn=async()=>{pe(!0),Xe(!1);try{const n=new URLSearchParams;N&&n.set("month",String(N)),n.set("includeItems","0"),n.set("meta","1"),n.set("limit",String(es)),n.set("offset","0");const t=`${API_BASE}/api/orders?${n.toString()}`,a=await window.KTM.api.getJSON(t,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),i=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.orders)?a.orders:[],o=!Array.isArray(a)&&a&&typeof a=="object"&&a.meta||null;ne(Array.isArray(i)?i:[]),H(Array.isArray(i)?i.length:0),Le(!!(o!=null&&o.hasMore)),Ta()}catch(n){console.error("Load orders error:",n),ne([]),H(0),Le(!1)}finally{pe(!1),Xe(!1)}},Zs=async()=>{if(!(ze||Ce||st)&&Oe){Xe(!0);try{const e=new URLSearchParams;N&&e.set("month",String(N)),e.set("includeItems","0"),e.set("meta","1"),e.set("limit",String(es)),e.set("offset",String(V));const n=`${API_BASE}/api/orders?${e.toString()}`,t=await window.KTM.api.getJSON(n,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),a=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.orders)?t.orders:[],i=!Array.isArray(t)&&t&&typeof t=="object"&&t.meta||null;ne(o=>Vs(o,Array.isArray(a)?a:[])),H(o=>o+(Array.isArray(a)?a.length:0)),Le(!!(i!=null&&i.hasMore))}catch(e){console.error("Load more orders error:",e)}finally{Xe(!1)}}},Ss=async e=>{var i;const n=ds(e);if(!n){Et([]),jt(""),Qe(!1);return}const t=Hs(n);if(n.length<Qa&&t.length<Za){Et([]),jt(`Nh\u1EADp \xEDt nh\u1EA5t ${Qa} k\xFD t\u1EF1 (ho\u1EB7c ${Za} s\u1ED1) \u0111\u1EC3 search nhanh`),Qe(!1);return}try{const o=(i=ut.current)==null?void 0:i.get(n);if(o&&Number.isFinite(o.ts)&&Date.now()-o.ts<=Os){Et(Array.isArray(o.results)?o.results:[]),jt(""),Qe(!1);return}}catch(o){}const a=++Ae.current;Qe(!0),jt("");try{const o=`${API_BASE}/api/orders?search=${encodeURIComponent(n)}`,g=await window.KTM.api.getJSON(o,"L\u1ED7i search \u0111\u01A1n h\xE0ng");if(Ae.current!==a)return;const m=Array.isArray(g)?g:[];Et(m);try{const I=ut.current;if(I&&typeof I.set=="function"&&(I.set(n,{ts:Date.now(),results:m}),I.size>Ya)){const y=Array.from(I.entries()).sort((v,D)=>{var he,fe;return(Number((he=v==null?void 0:v[1])==null?void 0:he.ts)||0)-(Number((fe=D==null?void 0:D[1])==null?void 0:fe.ts)||0)}),l=Math.max(0,y.length-Ya);for(let v=0;v<l;v++)I.delete(y[v][0])}}catch(I){}}catch(o){if(Ae.current!==a)return;console.error("Order search error:",o),Et([]),jt((o==null?void 0:o.message)||"Search l\u1ED7i")}finally{if(Ae.current!==a)return;Qe(!1)}};useEffect(()=>{$e.current&&(clearTimeout($e.current),$e.current=null);const e=ds(et);if(!e){Et([]),jt(""),Qe(!1);return}return Ie&&Te(!1),$e.current=setTimeout(()=>{Ss(e)},Rs),()=>{$e.current&&(clearTimeout($e.current),$e.current=null)}},[et]);const Ta=async()=>{K(!0),He(!0);try{const[e,n]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?overdue=1&days=${encodeURIComponent(Rn)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng"),window.KTM.api.getJSON(`${API_BASE}/api/orders?draftExpiring=1&remainingDays=${encodeURIComponent(Ka)}&includeItems=0`,"L\u1ED7i t\u1EA3i \u0111\u01A1n nh\xE1p")]);je(Array.isArray(e)?e:[]),yt(Array.isArray(n)?n:[])}catch(e){console.error("Load all orders error:",e),je([]),yt([])}finally{K(!1),He(!1)}},Ha=async e=>{const n=await Sa(e);if(!n)return;an(n.id);const t=Array.isArray(n.items)&&n.items.length?n.items.map(m=>{var I,y,l,v;return{product_id:(m==null?void 0:m.product_id)||"",quantity:Number((I=m==null?void 0:m.quantity)!=null?I:1)||1,unit_price:(()=>{var fe;const D=(fe=m==null?void 0:m.unit_price)!=null?fe:m==null?void 0:m.unitPrice,he=D==null||D===""?NaN:Number(D);return Number.isFinite(he)?Math.trunc(he):null})(),variant:String((y=m==null?void 0:m.variant)!=null?y:"").trim(),variant_json:(v=(l=m==null?void 0:m.variant_json)!=null?l:m==null?void 0:m.variantJson)!=null?v:null}}).filter(m=>m.product_id):[{product_id:n.product_id||"",quantity:Number(n.quantity||1)||1,unit_price:null,variant:"",variant_json:null}],a=Xs(n),i=Qn(a),o=Zn(i),g=Fa(i);ke({customer_name:n.customer_name||"",phone:Gt(n.phone||""),address:n.address||"",note:(n==null?void 0:n.note)||"",items:t.length?t:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}],adjustment_items:a,adjustment_amount:o,adjustment_note:g||(n==null?void 0:n.adjustment_note)||"",status:n.status||"pending"}),Mt(new Array(t.length?t.length:1).fill("")),Je(new Array(t.length?t.length:1).fill(!0)),W(null),We(!1),rt(n),Rt(!0),Ft(""),Ct(!1),fn(!0),n.phone&&xa(Gt(n.phone))},da=async e=>{if(!e)return;Rt(!0),Ft(""),Ct(!0),fn(!1),rt(e);const n=++$.current;try{const t=await Sa(e);if($.current!==n)return;rt(t||e)}catch(t){if($.current!==n)return;Ft((t==null?void 0:t.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{if($.current!==n)return;Ct(!1)}},er=()=>{A||me||(Rt(!1),Ct(!1),Ft(""),fn(!1),an(null),Vn(""),k(!1),Je([]))};function Ma(e){Rt(!1),fn(!1),Ct(!1),Ft(""),an(null),Vn(e||""),k(!1),Je([]),We(!0)}const Xa=()=>{A||me||(We(!1),an(null),Vn(""),k(!1),Je([]))},xs=async()=>{var m,I,y;if(!bt||me||A)return;const e=(Array.isArray(ye)?ye:[]).find(l=>String(l==null?void 0:l.id)===String(bt))||null,n=String((e==null?void 0:e.status)||(h==null?void 0:h.status)||"").trim();if(n==="done"||n==="paid"||n==="canceled"){const l="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof L=="function"?L(l,"warning"):alert(l);return}const t=Gt(h.phone),i=(Array.isArray(h.items)?h.items:[]).map((l,v)=>{var D,he;return{idx:v,product_id:String((l==null?void 0:l.product_id)||"").trim(),quantity:Number((D=l==null?void 0:l.quantity)!=null?D:0),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(he=l==null?void 0:l.variant_json)!=null?he:null,unit_price:(()=>{const fe=l==null?void 0:l.unit_price,ht=fe===""||fe==null?NaN:Number(fe);if(Number.isFinite(ht))return Math.max(0,Math.trunc(ht));const ct=kn(l==null?void 0:l.product_id),Zt=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return aa(ct,Zt)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);if(i.length<2){const l="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof L=="function"?L(l,"warning"):alert(l);return}const o=[],g=[];for(const l of i){const v=!!Be[l.idx],D={product_id:l.product_id,quantity:l.quantity,unit_price:l.unit_price,variant:l.variant,variant_json:l.variant_json};v?o.push(D):g.push(D)}if(!o.length||!g.length){const l="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof L=="function"?L(l,"warning"):alert(l);return}Me(!0);try{const l=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],v=Qn(l),D=Zn(v),he=Fa(v),fe={customer_name:h.customer_name,phone:t,address:h.address,note:(h.note||"").trim(),adjustment_amount:D,adjustment_note:he,adjustment_items:v,status:"processing",items:o,product_id:o[0].product_id,quantity:o[0].quantity,split_seq:1},ht=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,fe,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),ct=(y=(I=ht==null?void 0:ht.id)!=null?I:(m=ht==null?void 0:ht.order)==null?void 0:m.id)!=null?y:null;if(!ct)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const Zt={id:bt,customer_name:h.customer_name,phone:t,address:h.address,note:(h.note||"").trim(),adjustment_amount:0,adjustment_note:"",adjustment_items:[],status:"pending",items:g,product_id:g[0].product_id,quantity:g[0].quantity,parent_order_id:String(ct),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${bt}`,Zt,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Xa(),Wn();const kt=ct?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${ct}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof L=="function"?L(kt,"success"):alert(kt)}catch(l){console.error(l);const v=(l==null?void 0:l.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof L=="function"?L(v,"danger"):alert(v)}finally{Me(!1)}},ks=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const n=String(e),t=zt.find(a=>String(a==null?void 0:a.id)===n);return t?`${t.name}${t.code?` (${t.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},En=e=>{try{return String(e!=null?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(n){return String(e!=null?e:"").toLowerCase()}},tr=e=>{const t=En(e).trim().split(/\s+/).filter(Boolean),a=t.join(" ");return{contentTokens:t,cleanedQuery:a}},Cs=React.useMemo(()=>(Array.isArray(zt)?zt:[]).map((e,n)=>{var y,l,v,D,he,fe;const t=En((y=e==null?void 0:e.name)!=null?y:""),a=En((l=e==null?void 0:e.code)!=null?l:""),i=En((v=e==null?void 0:e.category)!=null?v:""),o=En((D=e==null?void 0:e.note)!=null?D:""),g=En((he=e==null?void 0:e.id)!=null?he:""),m=En((fe=e==null?void 0:e.stt)!=null?fe:""),I=`${t} ${a} ${i} ${o} ${g} ${m}`.trim();return{p:e,originalIndex:n,name:t,code:a,category:i,note:o,haystackAll:I}}),[zt]),nr=(e,n,t)=>{var v,D,he,fe,ht;const a=Array.isArray(n)?n:[],i=En(t).trim();if(!a.length&&!i)return 0;const o=(v=e==null?void 0:e.name)!=null?v:"",g=(D=e==null?void 0:e.code)!=null?D:"",m=(he=e==null?void 0:e.category)!=null?he:"",I=(fe=e==null?void 0:e.note)!=null?fe:"";if(!((ht=e==null?void 0:e.haystackAll)!=null?ht:""))return 0;let l=0;i&&(o===i&&(l+=220),o.includes(i)&&(l+=140),o.startsWith(i)&&(l+=160),g&&g===i&&(l+=180),g&&g.includes(i)&&(l+=90));for(const ct of a){if(!ct)continue;const Zt=new RegExp(`(?:^|\\s)${ct.replace(/[.*+?^${}()|[\[\]\\]/g,"\\$&")}`);o.includes(ct)&&(l+=35),Zt.test(o)&&(l+=25),g&&g.includes(ct)&&(l+=20),g&&Zt.test(g)&&(l+=10),m&&m.includes(ct)&&(l+=12),I&&I.includes(ct)&&(l+=6)}return l>0&&o&&(l+=Math.max(0,10-Math.min(10,Math.floor(o.length/10)))),l},Va=(e,n)=>{const t=String(e||""),a=String(n||"");if(t===a)return 0;if(!t)return a.length;if(!a)return t.length;const i=t.length,o=a.length;if(o>i)return Va(a,t);let g=new Array(o+1),m=new Array(o+1);for(let I=0;I<=o;I++)g[I]=I;for(let I=1;I<=i;I++){m[0]=I;const y=t.charCodeAt(I-1);for(let v=1;v<=o;v++){const D=y===a.charCodeAt(v-1)?0:1;m[v]=Math.min(g[v]+1,m[v-1]+1,g[v-1]+D)}const l=g;g=m,m=l}return g[o]},ar=(e,n)=>{const t=String(e||"").trim(),a=String(n||"");if(!t||!a)return!1;if(a.includes(t))return!0;const i=a.split(/\s+/).filter(Boolean);if(!i.length)return!1;const o=t.length<=4?1:2;for(const g of i)if(!(Math.abs(g.length-t.length)>o)&&Va(t,g)<=o)return!0;return!1},_a=e=>{const n=En(e).replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();return n?n.split(" ").filter(Boolean):[]},sr=(e,n)=>{const t=Array.isArray(n)?n:[];if(!t.length)return 0;const a=_a((e==null?void 0:e.name)||""),i=_a((e==null?void 0:e.code)||""),o=_a((e==null?void 0:e.category)||""),g=_a((e==null?void 0:e.note)||""),m=(y,l,v)=>{const D=String(y||"").trim();if(!D||!l.length)return 0;const he=D.length<=4?1:2;let fe=1/0,ht=-1;for(let kt=0;kt<l.length;kt++){const Cn=l[kt];if(!Cn||Math.abs(Cn.length-D.length)>he)continue;const Ht=Va(D,Cn);if(Ht<fe&&(fe=Ht,ht=kt,Ht===0))break}if(fe===1/0||fe>he)return 0;let Zt=Math.round(v*(fe===0?1:fe===1?.65:.45));return ht===0?Zt+=Math.round(v*.25):ht===1&&(Zt+=Math.round(v*.12)),Zt};let I=0;for(const y of t){if(!y)continue;const l=m(y,a,180),v=m(y,i,120),D=m(y,o,60),he=m(y,g,30);I+=Math.max(l,v,D,he)}if(I>0){const y=((e==null?void 0:e.name)||"").length;I+=Math.max(0,60-Math.min(60,Math.floor(y/2)))}return I},Wa=React.useRef(new Map);React.useEffect(()=>{Wa.current=new Map},[zt]);const As=e=>{var y,l;const n=String(xt[e]||"").trim();if(!n)return zt;const{contentTokens:t,cleanedQuery:a}=tr(n);if(t.length===0)return zt;const i=En(n).trim(),o=Wa.current.get(i);if(o)return o;const g=[];for(const v of Cs){const D=v.haystackAll;D&&t.some(he=>D.includes(he))&&g.push(v)}let m=g;if(m.length<8&&t.length>0){const v=[],D=new Set(m.map(he=>{var fe,ht;return String((ht=(fe=he.p)==null?void 0:fe.id)!=null?ht:"")+":"+String(he.originalIndex)}));for(const he of Cs){const fe=String((l=(y=he.p)==null?void 0:y.id)!=null?l:"")+":"+String(he.originalIndex);if(D.has(fe))continue;const ht=he.haystackAll;ht&&t.some(ct=>ar(ct,ht))&&(v.push(he),D.add(fe))}v.length&&(m=m.concat(v))}const I=m.map(v=>({entry:v,score:nr(v,t,a)})).map(v=>{if(v.score>0)return v;const D=sr(v.entry,t);return D>0?{...v,score:D}:v}).filter(v=>v.score>0).sort((v,D)=>D.score!==v.score?D.score-v.score:v.entry.originalIndex-D.entry.originalIndex).slice(0,40).map(v=>v.entry.p);return Wa.current.set(i,I),I},kn=e=>{if(!e)return null;const n=String(e);return zt.find(t=>String(t==null?void 0:t.id)===n)||null},qn=e=>{if(e==null||e==="")return[];let n=e;if(typeof n=="string"){const t=n.trim();if(!t)return[];try{n=JSON.parse(t)}catch(a){return[]}}return Array.isArray(n)?n.map((t,a)=>{var g;if(!t||typeof t!="object")return null;const i=String((g=t.name)!=null?g:"").trim()||`Bi\u1EBFn th\u1EC3 ${a+1}`,o=(Array.isArray(t.options)?t.options:[]).map(m=>{var ht,ct,Zt,kt,Cn,Ht,Kn;if(!m||typeof m!="object")return null;const I=String((ht=m.label)!=null?ht:"").trim();if(!I)return null;const y=(Cn=(kt=(Zt=(ct=m.price)!=null?ct:m.priceValue)!=null?Zt:m.unit_price)!=null?kt:m.unitPrice)!=null?Cn:null,l=y==null||y===""?NaN:typeof y=="number"?y:typeof y=="string"?us(y):Number(y),v=Number.isFinite(l)?Math.trunc(l):null,D=(Kn=(Ht=m.price_delta)!=null?Ht:m.priceDelta)!=null?Kn:null,he=Number(D),fe=Number.isFinite(he)?Math.trunc(he):0;return{label:I,price:v,price_delta:fe}}).filter(Boolean);return{name:i,options:o}}).filter(Boolean):[]},fr=e=>{const n=kn(e);return qn(n==null?void 0:n.variants)},$a=e=>{if(!e||typeof e!="object")return"";const n=[];for(const[t,a]of Object.entries(e)){const i=String(t||"").trim(),o=String(a||"").trim();!i||!o||n.push(`${i}: ${o}`)}return n.join(", ")},aa=(e,n)=>{const t=us(e==null?void 0:e.price),a=qn(e==null?void 0:e.variants);if(!a.length||!n||typeof n!="object")return t;let i=t,o=!1;for(const g of a){const m=String((g==null?void 0:g.name)||"").trim(),I=String((n==null?void 0:n[m])||"").trim();if(!m||!I)continue;const y=(Array.isArray(g.options)?g.options:[]).find(fe=>String((fe==null?void 0:fe.label)||"").trim()===I);if(!y)continue;const l=y==null?void 0:y.price,v=l==null||l===""?NaN:Number(l);if(Number.isFinite(v)){i=Math.max(0,Math.trunc(v)),o=!0;continue}const D=y==null?void 0:y.price_delta,he=D==null||D===""?NaN:Number(D);Number.isFinite(he)&&(i+=Math.trunc(he))}return i},Ga=e=>window.KTM.orders.getOrderItems(e),Ts=e=>window.KTM.orders.getOrderTotalQty(e),sa=e=>window.KTM.orders.getOrderProductSummary(e,kn),Ia=e=>window.KTM.orders.getOrderItemRows(e,kn),ma=e=>window.KTM.orders.getOrderAdjustmentMoney(e),Gn=e=>window.KTM.orders.getOrderAdjustmentSummaryText(e),rr=e=>{const n=Ga(e),t=Ia(e),a=pa(n),i=ua(n),o=i.fee,g=ma(e),m=a+o+g,I=l=>{const v=Number(l)||0;return v>0?`+${Pt(v)}`:Pt(v)},y=[];if(e!=null&&e.customer_name&&y.push(`KH\xC1CH: ${e.customer_name}`),e!=null&&e.phone&&y.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&y.push(`\u0110\u1ECAA CH\u1EC8: ${e.address}`),((e==null?void 0:e.note)||"").trim()&&y.push(`GHI CH\xDA: ${(e.note||"").trim()}`),y.push(""),y.push("S\u1EA2N PH\u1EA8M:"),t.length)for(const l of t)y.push(`- ${l.name} (SL: ${l.qty})`);else{const l=sa(e);l&&l!=="\u2014"&&y.push(`- ${l}`)}y.push(""),y.push(`T\u1EA0M T\xCDNH: ${Pt(a)}`),i.found&&o!==0&&y.push(`SHIP: ${Pt(o)}`);{const l=window.KTM.orders.getOrderAdjustmentItems(e),v=(Array.isArray(l)?l:[]).map(fe=>{var ht;return{amount:Number((ht=fe==null?void 0:fe.amount)!=null?ht:0)||0,note:String((fe==null?void 0:fe.note)||"").trim()}}).filter(fe=>fe.amount!==0||!!fe.note),D=Gn(e);if(g!==0||v.length>0||!!D)if(v.length===1){const fe=v[0];y.push(`\u0110I\u1EC0U CH\u1EC8NH: ${I(g)}${fe.note?` \u2014 ${fe.note}`:""}`)}else{y.push(`\u0110I\u1EC0U CH\u1EC8NH: ${I(g)}${!v.length&&D?` \u2014 ${D}`:""}`);for(const fe of v)y.push(`- ${I(fe.amount)}${fe.note?`: ${fe.note}`:""}`)}}return y.push(`T\u1ED4NG: ${Pt(m)}`),y.filter(Boolean).join(`
`)},Da=async e=>{try{const n=await Sa(e),t=rr(n);await window.KTM.clipboard.writeText(t),typeof L=="function"?L("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(n){console.error(n),typeof L=="function"?L("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},ua=e=>window.KTM.orders.getOrderShipInfo(e,kn),pa=e=>window.KTM.orders.getItemsSubtotal(e,kn),Ja=e=>{try{const n=e instanceof Date?e:new Date(e);if(!n||Number.isNaN(n.getTime()))return"";const t=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0");return`${t}-${a}`}catch(n){return""}},Ua=()=>N?String(N):Ja(new Date),Ms=e=>{const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Gt((e==null?void 0:e.phone)||""),a=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ja(e).amount,g=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(m=>{var I;return{product_id:String((m==null?void 0:m.product_id)||"").trim(),quantity:Number((I=m==null?void 0:m.quantity)!=null?I:0),variant:String((m==null?void 0:m.variant)||"").trim()}}).filter(m=>m.product_id&&Number.isFinite(m.quantity)&&m.quantity>0).sort((m,I)=>m.product_id<I.product_id?-1:m.product_id>I.product_id?1:m.variant<I.variant?-1:m.variant>I.variant?1:m.quantity-I.quantity);return JSON.stringify({name:n,phone:t,address:a,items:g,adj:i})},Nn=React.useMemo(()=>{const e=Gt((h==null?void 0:h.phone)||"");if(!e)return{count:0,orders:[],monthKey:Ua()};const n=Ua(),a=(Array.isArray(Y)?Y:[]).filter(i=>{if(!i||bt&&String(i.id)===String(bt)||Gt(i.phone||"")!==e)return!1;const o=Ja(i.created_at);return o&&o===n}).sort((i,o)=>{const g=new Date(i.created_at).getTime(),m=new Date(o.created_at).getTime();return(Number.isFinite(m)?m:0)-(Number.isFinite(g)?g:0)});return{count:a.length,orders:a,monthKey:n}},[Y,h==null?void 0:h.phone,N,bt]),ir=e=>{var m;const n=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),t=Gt((e==null?void 0:e.phone)||""),a=String((e==null?void 0:e.address)||"").trim().toLowerCase(),i=ps((m=e==null?void 0:e.adjustment_amount)!=null?m:0),o=Ga(e),g=(Array.isArray(o)?o:[]).map(I=>{var y;return{product_id:String((I==null?void 0:I.product_id)||"").trim(),quantity:Number((y=I==null?void 0:I.quantity)!=null?y:0),variant:String((I==null?void 0:I.variant)||"").trim()}}).filter(I=>I.product_id&&Number.isFinite(I.quantity)&&I.quantity>0).sort((I,y)=>I.product_id<y.product_id?-1:I.product_id>y.product_id?1:I.variant<y.variant?-1:I.variant>y.variant?1:I.quantity-y.quantity);return JSON.stringify({name:n,phone:t,address:a,items:g,adj:i})},_s=React.useMemo(()=>{if(bt)return"";const e=Gt((h==null?void 0:h.phone)||"");if(!e)return"";const n=Ua(),t=Ms(h),a=Array.isArray(Y)?Y:[];for(const i of a){if(!i||bt&&String(i.id)===String(bt)||Gt(i.phone||"")!==e)continue;const o=Ja(i.created_at);if(!o||o!==n)continue;const g=ir(i);if(g&&g===t)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${n}${i!=null&&i.id?` (#${i.id})`:""}`}return""},[Y,h,N,bt]),$s=e=>{var Cn;const n=[],t=[],a=String((e==null?void 0:e.customer_name)||"").trim(),i=Gt((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim();a||n.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),i||n.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),i&&!ea(i)&&n.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),o||t.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const m=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ht=>Ht&&Ht.product_id);m.length===0&&n.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),m.some(Ht=>{var Un;const Kn=Number((Un=Ht==null?void 0:Ht.quantity)!=null?Un:0);return!Number.isFinite(Kn)||Kn<=0})&&n.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const y=new Set;let l=!1;for(const Ht of m){const Kn=String(Ht.product_id||"").trim(),Un=String((Ht==null?void 0:Ht.variant)||"").trim();if(!Kn)continue;const Dt=`${Kn}||${Un}`;if(y.has(Dt)){l=!0;break}y.add(Dt)}l&&t.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const v=pa(m),D=ua(m),he=D!=null&&D.found?Number((Cn=D==null?void 0:D.fee)!=null?Cn:0):0,fe=Array.isArray(e==null?void 0:e.adjustment_items)?e.adjustment_items:[],ht=Qn(fe),ct=Zn(ht),Zt=ht.some(Ht=>(Number(Ht==null?void 0:Ht.amount)||0)!==0&&!String((Ht==null?void 0:Ht.note)||"").trim());D!=null&&D.found&&(he>=2e5||v>0&&he>v*.6)&&t.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Pt(he)}`),Zt&&t.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const kt=Math.abs(ct);return(kt>=5e5||v>0&&kt>v*.5)&&ct!==0&&t.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Pt(ct)}`),{errors:n,warnings:t,canSubmit:n.length===0}},br=React.useMemo(()=>$s(h),[h,zt]),_t=React.useMemo(()=>{var Un;const e=String((h==null?void 0:h.customer_name)||"").trim(),n=Gt((h==null?void 0:h.phone)||""),t=String((h==null?void 0:h.address)||"").trim(),a=Array.isArray(h==null?void 0:h.items)?h.items:[],i=new Map;for(const Dt of a){const ra=String((Dt==null?void 0:Dt.product_id)||"").trim(),Oa=String((Dt==null?void 0:Dt.variant)||"").trim();if(!ra)continue;const Ea=`${ra}||${Oa}`;i.set(Ea,(i.get(Ea)||0)+1)}const o=a.map(Dt=>{var Is;const ra=String((Dt==null?void 0:Dt.product_id)||"").trim(),Oa=Number((Is=Dt==null?void 0:Dt.quantity)!=null?Is:0),Ea=ra?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",dr=Number.isFinite(Oa)&&Oa>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",mr=String((Dt==null?void 0:Dt.variant)||"").trim(),ur=`${ra}||${mr}`,pr=ra&&(i.get(ur)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Ea,qtyError:dr,dupWarn:pr}}),g=a.filter(Dt=>Dt&&Dt.product_id),m=pa(g),I=ua(g),y=I!=null&&I.found?Number((Un=I==null?void 0:I.fee)!=null?Un:0):0,l=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],v=Qn(l),D=Zn(v),he=v.some(Dt=>(Number(Dt==null?void 0:Dt.amount)||0)!==0&&!String((Dt==null?void 0:Dt.note)||"").trim()),fe=Math.abs(D),ht=he?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",ct=D!==0&&(fe>=5e5||m>0&&fe>m*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Pt(D)}`:"",Zt=I!=null&&I.found&&(y>=2e5||m>0&&y>m*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${Pt(y)}`:"",kt=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",Cn=n?ea(n)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ht=t?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",Kn=!kt&&!Cn&&o.every(Dt=>!Dt.productError&&!Dt.qtyError);return{nameError:kt,phoneError:Cn,addressWarn:Ht,items:o,shipAbnormalWarn:Zt,adjustmentNoteWarn:ht,adjustmentAbnormalWarn:ct,canSubmit:Kn}},[h,zt]),Ra=async e=>{var m,I,y;const n=(e==null?void 0:e.mode)||"close",t=(e==null?void 0:e.origin)||"modal",a=$s(h);if(!a.canSubmit){const l=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof L=="function"?L(l,"danger"):alert(l);return}if(!bt&&_s){const l=`${_s}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(l)){(Nn==null?void 0:Nn.count)>0&&k(!0),setTimeout(()=>{var he;const D=document.getElementById("order-phone-input");D&&typeof D.scrollIntoView=="function"&&(D.scrollIntoView({block:"center",behavior:"smooth"}),(he=D.focus)==null||he.call(D))},0);return}}const i=Gt(h.phone),g=(Array.isArray(h.items)?h.items:[]).map(l=>{var v,D;return{product_id:(l==null?void 0:l.product_id)||"",quantity:Number((v=l==null?void 0:l.quantity)!=null?v:1),variant:String((l==null?void 0:l.variant)||"").trim()||null,variant_json:(D=l==null?void 0:l.variant_json)!=null?D:null,unit_price:(()=>{const he=l==null?void 0:l.unit_price,fe=he===""||he==null?NaN:Number(he);if(Number.isFinite(fe))return Math.max(0,Math.trunc(fe));const ht=kn(l==null?void 0:l.product_id),ct=l!=null&&l.variant_json&&typeof l.variant_json=="object"?l.variant_json:null;return aa(ht,ct)})()}}).filter(l=>l.product_id&&Number.isFinite(l.quantity)&&l.quantity>0);S(!0);try{const l=bt,v=bt?`${API_BASE}/api/orders/${bt}`:`${API_BASE}/api/orders`,D=g[0],he=Array.isArray(h==null?void 0:h.adjustment_items)?h.adjustment_items:[],fe=Qn(he),ht=Zn(fe),ct=Fa(fe),Zt={customer_name:h.customer_name,phone:i,address:h.address,note:(h.note||"").trim(),adjustment_amount:ht,adjustment_note:ct,adjustment_items:fe,product_id:D.product_id,quantity:D.quantity,status:h.status,items:g,...bt?{id:bt}:{}};if(bt)await window.KTM.api.putJSON(v,Zt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const kt=await window.KTM.api.postJSON(v,Zt,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Sn.current={id:(y=(I=kt==null?void 0:kt.id)!=null?I:(m=kt==null?void 0:kt.order)==null?void 0:m.id)!=null?y:null,fingerprint:Ms(h),ts:Date.now()}}if(Js(i,h.customer_name,h.address),t==="drawer"){if(Vn(""),an(null),We(!1),fn(!1),k(!1),Je([]),Wn(),l){Ct(!0),Ft("");try{const kt=await qa(l);kt&&typeof kt=="object"&&rt(kt)}catch(kt){Ft((kt==null?void 0:kt.message)||"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c chi ti\u1EBFt \u0111\u01A1n")}finally{Ct(!1)}}}else n==="new"&&!bt?(Vn(""),an(null),We(!0)):(Vn(""),an(null),We(!1)),Wn()}catch(l){console.error(l),typeof L=="function"?L(l.message,"danger"):alert(l.message);return}finally{S(!1)}},ha=e=>window.KTM.orders.getOrderTotalMoney(e,kn),gr=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){ge(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Wn(),Ta()}catch(n){console.error(n),typeof L=="function"?L(n.message,"danger"):alert(n.message)}finally{ge(null)}}},or=()=>{const e=_n.current;if(!e)return;if(e.timer){try{clearTimeout(e.timer)}catch(o){}e.timer=null}const n=Array.isArray(e.events)?e.events.splice(0):[];if(!n.length||typeof L!="function")return;const t=new Map;for(const o of n){const g=String((o==null?void 0:o.orderId)||"").trim();g&&t.set(g,o)}const a=Array.from(t.values());if(!a.length)return;const i=o=>async()=>{try{for(const g of o)!(g!=null&&g.prevStatus)||!(g!=null&&g.orderId)||await Jn({id:g.orderId,status:g.nextStatus},g.prevStatus,{silentToast:!0,skipToastBatch:!0,fromUndo:!0});L(o.length>1?`\u0110\xE3 ho\xE0n t\xE1c ${o.length} \u0111\u01A1n`:"\u0110\xE3 ho\xE0n t\xE1c","info")}catch(g){L("Ho\xE0n t\xE1c th\u1EA5t b\u1EA1i","danger")}};if(a.length===1){const o=a[0],g=`${Tn(o.prevStatus)} \u2192 ${Tn(o.nextStatus)}`.trim();L(`\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: ${g}`,"success",{actionLabel:"Undo",durationMs:8500,onAction:i([o])});return}L(`\u0110\xE3 c\u1EADp nh\u1EADt ${a.length} \u0111\u01A1n`,"success",{actionLabel:"Undo",durationMs:9500,onAction:i(a)})},cr=e=>{const n=_n.current;n&&(Array.isArray(n.events)||(n.events=[]),n.events.push(e),!n.timer&&(n.timer=setTimeout(()=>or(),320)))};useEffect(()=>()=>{try{const e=_n.current;e!=null&&e.timer&&clearTimeout(e.timer)}catch(e){}},[]);const Jn=async(e,n,t={})=>{var g;const a=await Sa(e),i=a==null?void 0:a.id;if(!i||!n)return;const o=bn(a==null?void 0:a.status);oe(i);try{const m=Ga(a),I=(Array.isArray(m)?m:[]).map(v=>{var D,he;return{product_id:(v==null?void 0:v.product_id)||"",quantity:Number((D=v==null?void 0:v.quantity)!=null?D:1),variant:String((v==null?void 0:v.variant)||"").trim()||null,variant_json:(he=v==null?void 0:v.variant_json)!=null?he:null,unit_price:(()=>{var ct;const fe=(ct=v==null?void 0:v.unit_price)!=null?ct:v==null?void 0:v.unitPrice,ht=Number(fe);return Number.isFinite(ht)?Math.max(0,Math.trunc(ht)):null})()}}).filter(v=>v.product_id&&Number.isFinite(v.quantity)&&v.quantity>0);if(!I.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const y=I[0],l={id:i,customer_name:(a==null?void 0:a.customer_name)||"",phone:Gt((a==null?void 0:a.phone)||""),address:(a==null?void 0:a.address)||"",note:((a==null?void 0:a.note)||"").trim(),adjustment_amount:Number((g=a==null?void 0:a.adjustment_amount)!=null?g:0)||0,adjustment_note:(a==null?void 0:a.adjustment_note)||"",product_id:y.product_id,quantity:y.quantity,status:n,items:I};if(await window.KTM.api.putJSON(`${API_BASE}/api/orders/${i}`,l,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),ne(v=>Array.isArray(v)?v.map(D=>(D==null?void 0:D.id)===i?{...D,status:n}:D):v),je(v=>Array.isArray(v)?v.map(D=>(D==null?void 0:D.id)===i?{...D,status:n}:D):v),ga(i,!1),zs(i),t!=null&&t.silentToast)return;if(t!=null&&t.skipToastBatch){typeof L=="function"&&L("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success",{durationMs:4500});return}cr({orderId:i,prevStatus:o,nextStatus:bn(n)})}catch(m){if(console.error(m),(!navigator.onLine||(m==null?void 0:m.name)==="TypeError"||String((m==null?void 0:m.message)||"").toLowerCase().includes("failed to fetch"))&&!(t!=null&&t.fromSync)){ne(y=>Array.isArray(y)?y.map(l=>(l==null?void 0:l.id)===i?{...l,status:n}:l):y),je(y=>Array.isArray(y)?y.map(l=>(l==null?void 0:l.id)===i?{...l,status:n}:l):y),qs(i,n,o),typeof L=="function"&&L("M\u1EA5t m\u1EA1ng/timeout \u2022 \u0110\xE3 x\u1EBFp h\xE0ng \u0111\u1ED3ng b\u1ED9","info",{durationMs:6500});return}typeof L=="function"?L(m.message,"danger"):alert(m.message)}finally{oe(null)}};useEffect(()=>{const e=n=>{var a;const t=(a=n==null?void 0:n.detail)==null?void 0:a.key;if(t){if(t==="/"){setTimeout(()=>{var i,o;(o=(i=rn.current)==null?void 0:i.focus)==null||o.call(i)},0);return}if(t==="N"||t==="n"){Ma();return}if((t==="j"||t==="J"||t==="k"||t==="K")&&St&&(_e!=null&&_e.id)){const i=Array.isArray(en)?en:[],o=i.findIndex(I=>String(I==null?void 0:I.id)===String(_e==null?void 0:_e.id));if(o<0)return;const m=i[o+(t==="j"||t==="J"?-1:1)];m&&da(m)}}};return window.addEventListener("ktm-admin-hotkey",e),()=>window.removeEventListener("ktm-admin-hotkey",e)},[en,St,_e]);const lr=()=>React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:h.customer_name,onChange:e=>ke({...h,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!_t.nameError&&React.createElement("div",{className:"form-text text-danger"},_t.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:h.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!_t.phoneError&&React.createElement("div",{className:"form-text text-danger"},_t.phoneError),!_t.phoneError&&Nn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Nn.count," \u0111\u01A1n trong th\xE1ng ",Nn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>k(e=>!e)},O?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),O&&Nn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>k(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Nn.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ta(e.status)}`},Tn(e.status))),React.createElement("div",{className:"text-muted small"},na(e.created_at)," \u2022 ",Pt(ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Ha(e)}},"M\u1EDF")))),Nn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(j==null?void 0:j.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(j==null?void 0:j.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(j==null?void 0:j.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(j==null?void 0:j.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:h.status,onChange:e=>ke({...h,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:h.address,onChange:e=>ke({...h,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!_t.addressWarn&&React.createElement("div",{className:"form-text text-warning"},_t.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:h.note,onChange:e=>ke({...h,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ke(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},On(h.adjustment_items).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const a=t.target.value;ke(i=>{const o=On(i.adjustment_items);return o[n]={...o[n],amount:a},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const a=t.target.value;ke(i=>{const o=On(i.adjustment_items);return o[n]={...o[n],note:a},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{ke(t=>{const a=On(t.adjustment_items);return a.splice(n,1),{...t,adjustment_items:a.length?a:[{amount:"",note:""}]}})},disabled:A||On(h.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!_t.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},_t.adjustmentAbnormalWarn),!!_t.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},_t.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ke(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Mt(e=>[...Array.isArray(e)?e:[],""]),bt&&Je(e=>[...Array.isArray(e)?e:[],!0])},disabled:A},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(h.items)?h.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Ut.current[n]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Bt(t=>t===n?null:n),setTimeout(()=>{const t=document.getElementById(`order-product-search-${n}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Ot===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:xt[n]||"",onChange:t=>{const a=t.target.value;Mt(i=>{const o=Array.isArray(i)?[...i]:[];return o[n]=a,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(n);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(a.id),o=qn(a==null?void 0:a.variants),g={};for(const y of o){const l=String((y==null?void 0:y.name)||"").trim(),v=Array.isArray(y==null?void 0:y.options)?y.options[0]:null,D=String((v==null?void 0:v.label)||"").trim();l&&D&&(g[l]=D)}const m=$a(g),I=aa(a,g);ke(y=>{const l=Array.isArray(y.items)?[...y.items]:[];return l[n]={...l[n]||{quantity:1},product_id:i,variant_json:Object.keys(g).length?g:null,variant:m,unit_price:o.length?I:null},{...y,items:l}}),Bt(null)}},a.name,a.code?` (${a.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),zt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var a;const t=(a=_t.items)==null?void 0:a[n];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=kn(e.product_id),a=qn(t==null?void 0:t.variants);if(!a.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},a.map((o,g)=>{const m=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${g+1}`).trim(),I=String((i==null?void 0:i[m])||"").trim();return React.createElement("div",{key:m},React.createElement("label",{className:"form-label small text-muted mb-1"},m),React.createElement("select",{className:"form-select",value:I,onChange:y=>{const l=String(y.target.value||"").trim();ke(v=>{const D=Array.isArray(v.items)?[...v.items]:[],he={...D[n]||{}},fe=kn(he.product_id),ht=qn(fe==null?void 0:fe.variants),ct=he!=null&&he.variant_json&&typeof he.variant_json=="object"?{...he.variant_json}:{};l?ct[m]=l:delete ct[m];const Zt=$a(ct),kt=aa(fe,ct);return D[n]={...he,variant_json:Object.keys(ct).length?ct:null,variant:Zt,unit_price:kt},{...v,items:D}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",m," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(y=>React.createElement("option",{key:y.label,value:y.label},y.label,Number.isFinite(Number(y==null?void 0:y.price))?` (${Pt(Number(y.price))})`:Number(y==null?void 0:y.price_delta)?` (${y.price_delta>0?"+":""}${y.price_delta})`:""))))}))})(),bt&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!Be[n],onChange:t=>{const a=!!t.target.checked;Je(i=>{const o=Array.isArray(i)?[...i]:[],g=Array.isArray(h.items)?h.items.length:0;for(;o.length<g;)o.push(!0);return o[n]=a,o})},disabled:A||me}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const a=t.target.value;ke(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[n]={...o[n]||{product_id:""},quantity:a},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var a;const t=(a=_t.items)==null?void 0:a[n];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{ke(t=>{const a=Array.isArray(t.items)?[...t.items]:[];return a.splice(n,1),{...t,items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Mt(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a.length?a:[""]}),Je(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a}),Bt(t=>t==null?t:t===n?null:t>n?t-1:t)},disabled:A||me||(Array.isArray(h.items)?h.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(h.items)?h.items:[]).filter(m=>m==null?void 0:m.product_id),t=pa(n),a=ua(n),i=ja(h),o=i.amount,g=t+(a.found?a.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Pt(t))),a.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Pt(a.fee))),!!_t.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},_t.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Pt(o))),(h.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(h.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Pt(g)))))})());return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:A||!!B||!!Ne}),React.createElement("div",{className:"orders-ops-toolbar card p-3"},React.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h5",{className:"mb-0"},"\u0110\u01A1n h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.all," \u0111\u01A1n"),st&&React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-25 text-dark"},"Search mode")),React.createElement("div",{className:"text-muted small mt-1"},"Hotkeys: ",React.createElement("span",{className:"fw-semibold"},"/")," search \u2022 ",React.createElement("span",{className:"fw-semibold"},"N")," t\u1EA1o \u0111\u01A1n \u2022 ",React.createElement("span",{className:"fw-semibold"},"Esc")," \u0111\xF3ng drawer")),React.createElement("div",{className:"d-flex gap-2"},React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>st?Ss(et):Wn(),disabled:tn,title:"L\xE0m m\u1EDBi"},React.createElement("i",{className:"fas fa-rotate"})),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:()=>Ma(),disabled:A||!!B},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"))),React.createElement("div",{className:"orders-chip-row mt-3"},React.createElement("button",{type:"button",className:`orders-chip d-md-none ${le&&!Ie&&!st?"active":""}`,onClick:()=>{st&&De(""),Te(!1),qe(!1),ve(e=>!e)},title:"\u0110\u01A1n \u01B0u ti\xEAn (\u0111\xE3 ghim)"},React.createElement("i",{className:"fas fa-star me-1"}),"\u01AFu ti\xEAn"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Us)),React.createElement("button",{type:"button",className:`orders-chip d-md-none ${Fe&&!Ie&&!st?"active":""}`,onClick:()=>{st&&De(""),Te(!1),ve(!1),qe(e=>!e)},title:"\u0110\u01A1n c\u1EA7n x\u1EED l\xFD h\xF4m nay"},React.createElement("i",{className:"fas fa-calendar me-1"}),"H\xF4m nay"," ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Ys)),React.createElement("button",{type:"button",className:`orders-chip ${!J&&!Ie&&!st?"active":""}`,onClick:()=>{st&&De(""),Te(!1),re("")}},"T\u1EA5t c\u1EA3 ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.all)),React.createElement("button",{type:"button",className:`orders-chip ${J==="draft"&&!Ie&&!st?"active":""}`,onClick:()=>{st&&De(""),Te(!1),re("draft"),F("")}},"Nh\xE1p ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.draft)),React.createElement("button",{type:"button",className:`orders-chip ${J==="pending"&&!Ie&&!st?"active":""}`,onClick:()=>{st&&De(""),Te(!1),re("pending")}},"Ch\u1EDD x\u1EED l\xFD ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.pending)),React.createElement("button",{type:"button",className:`orders-chip ${J==="processing"&&!Ie&&!st?"active":""}`,onClick:()=>{st&&De(""),Te(!1),re("processing")}},"V\u1EADn chuy\u1EC3n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.processing)),React.createElement("button",{type:"button",className:`orders-chip ${J==="done"&&!Ie&&!st?"active":""}`,onClick:()=>{st&&De(""),Te(!1),re("done")}},"Ho\xE0n th\xE0nh ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.done)),React.createElement("button",{type:"button",className:`orders-chip ${J==="paid"&&!Ie&&!st?"active":""}`,onClick:()=>{st&&De(""),Te(!1),re("paid")}},"\u0110\xE3 nh\u1EADn ti\u1EC1n ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.paid)),React.createElement("button",{type:"button",className:`orders-chip ${J==="canceled"&&!Ie&&!st?"active":""}`,onClick:()=>{st&&De(""),Te(!1),re("canceled")}},"H\u1EE7y ",React.createElement("span",{className:"ms-1 badge rounded-pill bg-dark bg-opacity-10 text-dark"},Fn.canceled))),React.createElement("div",{className:"orders-presets mt-2 d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Pn("thisMonth"),disabled:st},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Pn("overduePending"),disabled:st},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm > ",Rn," ng\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Pn("draftExpiring"),disabled:st},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y"),(J||Ie||!N&&!st)&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Pn("all")},"Clear")),React.createElement("div",{className:"orders-filterbar mt-3 d-flex flex-wrap gap-2 align-items-center"},React.createElement("div",{className:"input-group input-group-sm orders-search"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:rn,type:"text",className:"form-control",value:et,onChange:e=>De(e.target.value),placeholder:"Search t\xEAn / S\u0110T\u2026 (nh\u1EA5n /)","aria-label":"Search \u0111\u01A1n h\xE0ng theo t\xEAn ho\u1EB7c S\u0110T"}),String(et||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>De(""),disabled:tn},React.createElement("i",{className:"fas fa-times"})),tn&&React.createElement("span",{className:"input-group-text",title:"\u0110ang search...","aria-label":"\u0110ang search"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning",role:"status","aria-hidden":"true"}))),React.createElement("div",{className:"input-group input-group-sm orders-month"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:N,onChange:e=>F(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:Ie||st})),React.createElement("div",{className:"text-muted small ms-auto"},st?"Search b\u1ECF qua filter":Ie?"\u0110ang xem \u0111\u01A1n ch\u1EADm":J?`L\u1ECDc: ${Tn(J)}`:""))),React.createElement("div",{className:`orders-context-header d-md-none ${M?"visible":""}`},React.createElement("div",{className:"orders-context-text"},(()=>{if(st){const e=String(et||"").trim();return`Search: ${e?`"${e}"`:""} \u2022 ${en.length} k\u1EBFt qu\u1EA3`}return Ie?`\u0110\u01A1n ch\u1EADm \u2022 ${en.length} \u0111\u01A1n`:le?`\u01AFu ti\xEAn \u2022 ${en.length} \u0111\u01A1n`:Fe?`H\xF4m nay \u2022 ${en.length} \u0111\u01A1n`:J?`L\u1ECDc: ${Tn(J)} \u2022 ${en.length} \u0111\u01A1n`:`T\u1EA5t c\u1EA3 \u2022 ${en.length} \u0111\u01A1n`})()),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{De(""),ve(!1),qe(!1),Pn("all")},"aria-label":"Clear"},"Clear")),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},st?`${en.length} k\u1EBFt qu\u1EA3`:J?`${Aa.length}/${ye.length} \u0111\u01A1n`:`${ye.length}${Oe?"+":""} \u0111\u01A1n`)),st&&Kt&&React.createElement("div",{className:"alert alert-danger mt-3 mb-0",role:"alert"},Kt),Ca.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,Ca.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",Rn," ng\xE0y.",Ke&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Te(!0),re("pending")}},"Xem ngay")),ys.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-clock me-2"}),"C\xF3 ",React.createElement("strong",null,ys.length)," \u0111\u01A1n ",React.createElement("strong",null,"Nh\xE1p")," s\u1EAFp t\u1EF1 h\u1EE7y (c\xF2n \u2264 ",Ka," ng\xE0y).",wt&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{Te(!1),re("draft"),F(""),Wn()}},"Xem ngay")),(st?tn:ze)?React.createElement("div",{className:"orders-skeleton-wrap mt-3"},React.createElement("div",{className:"d-md-none"},new Array(6).fill(0).map((e,n)=>React.createElement("div",{key:n,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"admin-skeleton-line w-50 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-75 mb-2"}),React.createElement("div",{className:"admin-skeleton-line w-35"}))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,new Array(10).fill(0).map((e,n)=>React.createElement("tr",{key:n},React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-60"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-70"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-85"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-30"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-50"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-55"})),React.createElement("td",null,React.createElement("div",{className:"admin-skeleton-line w-40"}))))))))):(st?en.length===0:ye.length===0)?React.createElement("div",{className:"text-center py-4 text-muted"},st?"Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3":"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):!st&&Aa.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},Ns.map(e=>{var n;return React.createElement("div",{key:e.id,className:`orders-mobile-swipe-shell mb-2 ${(vt==null?void 0:vt.id)===String(e.id)?`swipe-preview swipe-${(vt==null?void 0:vt.dir)||""}`:""}`,role:"button",tabIndex:0,onClick:()=>{if(cn.current){cn.current=!1;return}da(e)},onPointerDown:t=>{if(ae||r||Xt||t.button!=null&&t.button!==0)return;const a=String(e.id);cn.current=!1,Ve.current={active:!0,id:a,startX:t.clientX,startY:t.clientY,dx:0,dy:0,lock:null,pointerId:t.pointerId,captured:!1},Ze(i=>(i==null?void 0:i.id)===a?i:{id:a,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}try{nn.current&&clearTimeout(nn.current)}catch(i){}hn.current=a,nn.current=setTimeout(async()=>{var o,g,m,I;const i=hn.current;if(i)try{if((g=(o=Vt.current)==null?void 0:o.has)!=null&&g.call(o,i))return;const y=await qa(i);y&&typeof y=="object"&&((I=(m=Vt.current)==null?void 0:m.set)==null||I.call(m,i,y))}catch(y){}},150)},onPointerMove:t=>{const a=Ve.current;if(!(a!=null&&a.active)||String(a.id)!==String(e.id))return;const i=t.clientX-a.startX,o=t.clientY-a.startY;if(a.dx=i,a.dy=o,Math.abs(i)>14||Math.abs(o)>14){try{nn.current&&clearTimeout(nn.current)}catch(D){}nn.current=null,hn.current=null}if(!a.lock){const D=Math.abs(i),he=Math.abs(o);if((D>10||he>10)&&(a.lock=D>he*1.2?"x":"y",a.lock==="x"&&!a.captured))try{t.currentTarget.setPointerCapture(t.pointerId),a.captured=!0}catch(fe){}}if(a.lock!=="x"){try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(D){}Math.abs(o)>24&&Ze(D=>(D==null?void 0:D.id)===a.id?{id:a.id,dir:null}:D);return}const g=!!Yn(e==null?void 0:e.status,"right"),m=!!Yn(e==null?void 0:e.status,"left"),I=(D,he,fe)=>Math.max(he,Math.min(fe,D)),y=I(i,-140,140),l=y>0&&!g||y<0&&!m?y*.35:y,v=I(Math.abs(l)/88,0,1);try{t.currentTarget.classList.add("swiping"),t.currentTarget.style.setProperty("--swipe-x",`${l}px`),t.currentTarget.style.setProperty("--swipe-p",String(v)),t.currentTarget.style.setProperty("--swipe-l",l>0&&g?String(v):"0"),t.currentTarget.style.setProperty("--swipe-r",l<0&&m?String(v):"0")}catch(D){}Math.abs(l)>12&&(cn.current=!0),i>72&&g?Ze({id:a.id,dir:"right"}):i<-72&&m?Ze({id:a.id,dir:"left"}):Ze({id:a.id,dir:null})},onPointerCancel:t=>{try{nn.current&&clearTimeout(nn.current)}catch(i){}nn.current=null,hn.current=null;const a=Ve.current;try{a!=null&&a.captured&&(a==null?void 0:a.pointerId)!=null&&t.currentTarget.releasePointerCapture(a.pointerId)}catch(i){}Ve.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1},Ze({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(i){}},onPointerUp:t=>{try{nn.current&&clearTimeout(nn.current)}catch(l){}nn.current=null,hn.current=null;const a=Ve.current;if(!(a!=null&&a.active)||String(a.id)!==String(e.id)){Ze({id:null,dir:null});return}try{a!=null&&a.captured&&(a==null?void 0:a.pointerId)!=null&&t.currentTarget.releasePointerCapture(a.pointerId)}catch(l){}Ve.current={active:!1,id:null,startX:0,startY:0,dx:0,dy:0,lock:null,pointerId:null,captured:!1};const i=Number(a.dx)||0,o=Math.abs(i),g=a.lock==="x",m=bn(e==null?void 0:e.status);Ze({id:null,dir:null});try{t.currentTarget.classList.remove("swiping"),t.currentTarget.style.setProperty("--swipe-x","0px"),t.currentTarget.style.setProperty("--swipe-p","0"),t.currentTarget.style.setProperty("--swipe-l","0"),t.currentTarget.style.setProperty("--swipe-r","0")}catch(l){}if(g&&o>12&&(cn.current=!0),!g||o<88)return;t.preventDefault(),t.stopPropagation();const I=i>0?Yn(e==null?void 0:e.status,"right"):Yn(e==null?void 0:e.status,"left"),y=bn(I);!y||y===m||Jn(e,y)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),da(e))},title:"Xem chi ti\u1EBFt"},React.createElement("div",{className:"orders-mobile-swipe-bg","aria-hidden":"true"},React.createElement("div",{className:"orders-mobile-swipe-bg-left"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Yn(e==null?void 0:e.status,"right"),a=ms(t),i=(a==null?void 0:a.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${a.icon||"fa-circle"}`}),i):null})())),React.createElement("div",{className:"orders-mobile-swipe-bg-right"},React.createElement("div",{className:"orders-mobile-swipe-label"},(()=>{const t=Yn(e==null?void 0:e.status,"left"),a=ms(t),i=(a==null?void 0:a.label)||String(t||"").trim();return i?React.createElement(React.Fragment,null,React.createElement("i",{className:`fas ${a.icon||"fa-circle"}`}),i):null})()))),React.createElement("div",{className:`card orders-mobile-card ${x!=null&&x[String(e.id)]?"order-recent-updated":""}`},React.createElement("div",{className:"card-body p-3 order-card-mobile"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold order-customer-name"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace order-phone",role:"button",tabIndex:0,onPointerDown:t=>Bs(t,e.phone),onPointerMove:ya,onPointerUp:ya,onPointerCancel:ya,onPointerLeave:ya,onClick:t=>{if(t.stopPropagation(),dn.current){dn.current=!1;return}cs(e.phone)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),cs(e.phone))},title:"Ch\u1EA1m \u0111\u1EC3 g\u1ECDi \u2022 Gi\u1EEF \u0111\u1EC3 copy"},e.phone),Number((n=e==null?void 0:e.split_seq)!=null?n:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),(()=>{const t=is(e);if(!t)return null;const a=q.has(String(e.id)),i=t.length>84||os(e).length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-address ${a?"":"order-text-collapsed"}`},t),i&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:o=>{o.stopPropagation(),as(e.id)}},a?"Thu g\u1ECDn":"Xem th\xEAm"))})(),(()=>{const t=os(e);if(!t)return null;const a=q.has(String(e.id)),i=is(e).length,o=i>84||t.length>84;return React.createElement(React.Fragment,null,React.createElement("div",{className:`text-muted small order-note ${a?"":"order-text-collapsed"}`},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",t),o&&i<=0&&React.createElement("button",{type:"button",className:"btn btn-link p-0 order-expand-btn",onClick:g=>{g.stopPropagation(),as(e.id)}},a?"Thu g\u1ECDn":"Xem th\xEAm"))})()),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("button",{type:"button",className:`btn btn-sm btn-link order-pin-btn ${ee.has(String(e.id))?"active":""}`,onClick:t=>{t.stopPropagation(),Ks(e.id)},title:ee.has(String(e.id))?"B\u1ECF ghim":"Ghim","aria-label":ee.has(String(e.id))?"B\u1ECF ghim":"Ghim"},React.createElement("i",{className:ee.has(String(e.id))?"fas fa-star":"far fa-star"})),!!(yn!=null&&yn[String(e.id)])&&React.createElement("span",{className:"badge bg-info text-dark orders-sync-badge",title:"\u0110ang \u0111\u1ED3ng b\u1ED9","aria-label":"\u0110ang \u0111\u1ED3ng b\u1ED9"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sync"),React.createElement("button",{type:"button",className:`badge ${ta(e.status)} order-status-badge-btn`,onPointerDown:t=>{t.stopPropagation(),Ee.current=!1;try{Re.current&&clearTimeout(Re.current)}catch(a){}Re.current=setTimeout(()=>{Ee.current=!0,ns(e,t.currentTarget)},420)},onPointerUp:t=>{t.stopPropagation();try{Re.current&&clearTimeout(Re.current)}catch(a){}Re.current=null},onPointerCancel:t=>{t.stopPropagation();try{Re.current&&clearTimeout(Re.current)}catch(a){}Re.current=null},onClick:t=>{if(t.stopPropagation(),Ee.current){Ee.current=!1;return}Xt&&String(P==null?void 0:P.id)===String(e.id)?Hn():ns(e,t.currentTarget)},title:"\u0110\u1ED5i tr\u1EA1ng th\xE1i nhanh"},Tn(e.status)),va(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Rn} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(e),"d"),wa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${zn} ng\xE0y`},"\u23F3 C\xF2n ",Na(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const t=Ia(e);return t.length?React.createElement("div",{className:"mt-1"},t.map((a,i)=>React.createElement("div",{key:i,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},i+1,"."),a.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",a.qty,Number(a.unitPrice)>0?` \u2022 ${Pt(a.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sa(e))})()),(ma(e)!==0||Gn(e))&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Pt(ma(e))),Gn(e)?React.createElement("span",{className:"text-muted"}," ","(",Gn(e),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},Pt(ha(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",na(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2 align-items-center order-card-actions"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:t=>{t.stopPropagation(),Da(e)},disabled:A||!!B||Ne===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-dark orders-mobile-action",onClick:t=>{t.stopPropagation(),ts(e)},disabled:A||!!B||Ne===e.id,"aria-label":"M\u1EDF thao t\xE1c nhanh"},React.createElement("i",{className:"fas fa-bolt me-1"}),"Thao t\xE1c")))))}),React.createElement("div",{ref:Lt,className:"orders-mobile-sentinel","aria-hidden":"true"}),Array.isArray(en)&&Ns.length<en.length&&React.createElement("div",{className:"text-center text-muted small py-2"},"\u0110ang t\u1EA3i th\xEAm\u2026")),Xt&&P&&React.createElement("div",{className:"orders-status-popover-root",role:"dialog","aria-modal":"true",onClick:()=>Hn()},React.createElement("div",{className:`orders-status-popover ${(X==null?void 0:X.placement)||""}`,style:{left:X.left,top:X.top},onClick:e=>e.stopPropagation()},React.createElement("div",{className:"orders-status-popover-title"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0}},P.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Hn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-status-popover-grid"},ia.map(e=>{const n=bn(P.status)===bn(e.value),t=A||!!B||Ne===P.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${n?"active":""}`,onClick:()=>{n||(Jn(P,e.value),Hn())},disabled:t},e.label)})),React.createElement("div",{className:"orders-status-popover-footer"},React.createElement("button",{type:"button",className:"btn btn-sm btn-dark",onClick:()=>{ts(P),Hn()}},React.createElement("i",{className:"fas fa-bolt me-2"}),"Thao t\xE1c")))),ae&&qt&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>Xn()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},qt.customer_name||"\u0110\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small d-flex align-items-center gap-2",style:{flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},qt.phone||""),React.createElement("span",{className:`badge ${ta(qt.status)}`},Tn(qt.status)))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Xn(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"admin-sheet-actions"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Da(qt),Xn()},disabled:A||!!B||Ne===qt.id},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),!!String(qt.phone||"").trim()&&React.createElement("a",{className:"btn btn-outline-secondary",href:`tel:${String(qt.phone||"").trim()}`,onClick:()=>Xn()},React.createElement("i",{className:"fas fa-phone me-2"}),"G\u1ECDi"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>{da(qt),Xn()}},React.createElement("i",{className:"fas fa-eye me-2"}),"M\u1EDF chi ti\u1EBFt")),React.createElement("div",{className:"admin-sheet-section-title"},"\u0110\u1ED5i tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-status-grid"},ia.map(e=>{const n=bn(qt.status)===bn(e.value),t=A||!!B||Ne===qt.id;return React.createElement("button",{key:e.value,type:"button",className:`orders-status-chip ${n?"active":""}`,onClick:()=>{n||(Jn(qt,e.value),Xn())},disabled:t},e.label)})))),r&&React.createElement("div",{className:"admin-sheet-root",role:"dialog","aria-modal":"true",onClick:()=>ba()},React.createElement("div",{className:"admin-sheet",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"admin-sheet-handle"}),React.createElement("div",{className:"admin-sheet-header"},React.createElement("div",{style:{minWidth:0}},React.createElement("div",{className:"fw-semibold admin-sheet-title"},"L\u1ECDc \u0111\u01A1n h\xE0ng"),React.createElement("div",{className:"text-muted small"},"T\u1ED1i \u01B0u cho thao t\xE1c m\u1ED9t tay")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>ba(),"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"p-3"},React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>Pn("thisMonth"),disabled:st},React.createElement("i",{className:"fas fa-calendar me-2"}),"Th\xE1ng n\xE0y"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Pn("overduePending"),disabled:st},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Pn("draftExpiring"),disabled:st},React.createElement("i",{className:"fas fa-clock me-2"}),"Nh\xE1p s\u1EAFp h\u1EE7y")),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"fw-semibold mb-2"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${!J&&!Ie?"active":""}`,onClick:()=>{st&&De(""),Te(!1),re("")}},"T\u1EA5t c\u1EA3"),ia.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${J===e.value&&!Ie?"active":""}`,onClick:()=>{st&&De(""),Te(!1),re(e.value),e.value==="draft"&&F("")}},e.label)))),React.createElement("div",{className:"mt-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Th\xE1ng"),React.createElement("input",{type:"month",className:"form-control",value:N,onChange:e=>F(e.target.value),disabled:Ie||st}),React.createElement("div",{className:"form-text"},"B\u1EADt \u201CCh\u1EADm\u201D s\u1EBD b\u1ECF qua th\xE1ng.")),React.createElement("div",{className:"form-check mt-3"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"ordersOverdueOnly",checked:Ie,onChange:e=>{st&&De("");const n=!!e.target.checked;Te(n),n&&(F(""),re("pending"))},disabled:st}),React.createElement("label",{className:"form-check-label",htmlFor:"ordersOverdueOnly"},"Ch\u1EC9 xem \u0111\u01A1n ch\u1EADm > ",Rn," ng\xE0y")),React.createElement("div",{className:"d-flex gap-2 mt-4"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Pn("all"),disabled:st},"Reset"),React.createElement("button",{type:"button",className:"btn btn-dark flex-grow-1",onClick:()=>ba()},"Xong"))))),React.createElement("div",{className:`orders-mobile-toolbar d-md-none ${w?"visible":""}`},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>{if(!(e.button!=null&&e.button!==0)){C.current=!1;try{se.current&&clearTimeout(se.current)}catch(n){}se.current=setTimeout(()=>{C.current=!0,ss(et)},460)}},onPointerUp:()=>{try{se.current&&clearTimeout(se.current)}catch(e){}se.current=null},onPointerCancel:()=>{try{se.current&&clearTimeout(se.current)}catch(e){}se.current=null},onClick:()=>{if(C.current){C.current=!1;return}try{window.scrollTo({top:0,behavior:"smooth"})}catch(e){}setTimeout(()=>{var e,n;return(n=(e=rn.current)==null?void 0:e.focus)==null?void 0:n.call(e)},120)},"aria-label":"Search"},React.createElement("i",{className:"fas fa-search me-2"}),"Search"),React.createElement("button",{type:"button",className:"btn btn-dark",onClick:()=>Ma(),disabled:A||!!B,"aria-label":"T\u1EA1o \u0111\u01A1n"},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n"),React.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:()=>Es(),"aria-label":"L\u1ECDc"},React.createElement("i",{className:"fas fa-sliders me-2"}),"L\u1ECDc")),Se&&React.createElement("div",{className:"orders-search-palette-root",role:"dialog","aria-modal":"true",onClick:()=>{oa(de),An()}},React.createElement("div",{className:"orders-search-palette",onClick:e=>e.stopPropagation(),onTouchStart:e=>{const n=e.touches&&e.touches[0];n&&(te.current={active:!0,startY:n.clientY,startX:n.clientX,fired:!1})},onTouchMove:e=>{const n=te.current;if(!(n!=null&&n.active)||n.fired)return;const t=e.touches&&e.touches[0];if(!t)return;const a=t.clientY-n.startY,i=t.clientX-n.startX;Math.abs(i)>24||a>90&&(n.fired=!0,oa(de),An())},onTouchEnd:()=>{te.current={active:!1,startY:0,startX:0,fired:!1}}},React.createElement("div",{className:"orders-search-palette-header"},React.createElement("div",{className:"fw-semibold"},"T\xECm nhanh"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{oa(de),An()},"aria-label":"\u0110\xF3ng"},React.createElement("i",{className:"fas fa-xmark"}))),React.createElement("div",{className:"orders-search-palette-body"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search"})),React.createElement("input",{ref:xe,type:"text",className:"form-control",value:de,onChange:e=>{const n=e.target.value;Ge(n),De(n)},placeholder:"Nh\u1EADp t\xEAn / S\u0110T\u2026",onKeyDown:e=>{e.key==="Enter"&&(oa(de),An())}}),!!String(de||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{Ge(""),De("")}},React.createElement("i",{className:"fas fa-times"}))),Array.isArray(At)&&At.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"G\u1EA7n \u0111\xE2y"),React.createElement("div",{className:"orders-chip-row",style:{marginTop:0}},At.slice(0,8).map(e=>React.createElement("button",{key:e,type:"button",className:"orders-chip",onClick:()=>{Ge(e),De(e),oa(e),An()}},e)))),React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"text-muted small mb-2"},"Filter nhanh"),React.createElement("div",{className:"orders-filter-chip-grid"},React.createElement("button",{type:"button",className:`orders-filter-chip ${le?"active":""}`,onClick:()=>{De(""),Ge(""),Te(!1),qe(!1),ve(e=>!e),An()}},React.createElement("i",{className:"fas fa-star me-2"}),"\u01AFu ti\xEAn"),React.createElement("button",{type:"button",className:`orders-filter-chip ${Fe?"active":""}`,onClick:()=>{De(""),Ge(""),Te(!1),ve(!1),qe(e=>!e),An()}},React.createElement("i",{className:"fas fa-calendar me-2"}),"H\xF4m nay"),React.createElement("button",{type:"button",className:`orders-filter-chip ${Ie?"active":""}`,onClick:()=>{De(""),Ge(""),Te(e=>!e),Ie||(F(""),re("pending")),An()}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"Ch\u1EADm"),React.createElement("button",{type:"button",className:`orders-filter-chip ${!J&&!Ie&&!le&&!Fe?"active":""}`,onClick:()=>{De(""),Ge(""),Te(!1),ve(!1),qe(!1),re(""),An()}},"T\u1EA5t c\u1EA3"),ia.map(e=>React.createElement("button",{key:e.value,type:"button",className:`orders-filter-chip ${J===e.value&&!Ie?"active":""}`,onClick:()=>{De(""),Ge(""),Te(!1),ve(!1),qe(!1),re(e.value),e.value==="draft"&&F(""),An()}},e.label))))),React.createElement("div",{className:"orders-search-palette-hint text-muted small"},"Tip: Gi\u1EEF n\xFAt Search \u0111\u1EC3 m\u1EDF \u2022 Vu\u1ED1t xu\u1ED1ng \u0111\u1EC3 \u0111\xF3ng"))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("div",{className:"table-responsive orders-table-wrap mt-3"},React.createElement("table",{className:"table orders-table table-hover align-middle mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,en.map(e=>React.createElement("tr",{key:e.id,style:{cursor:"pointer"},onClick:()=>da(e),title:"Xem chi ti\u1EBFt"},React.createElement("td",null,React.createElement("div",{className:"fw-semibold"},e.customer_name),((e==null?void 0:e.note)||"").trim()&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(e.note||"").trim())),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const n=Ia(e);return n.length?React.createElement("div",{className:"d-grid gap-1"},n.map((t,a)=>React.createElement("div",{key:a,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},a+1,"."),React.createElement("span",{className:"fw-semibold"},t.name)," ",React.createElement("span",{className:"text-muted"},"x",t.qty),Number(t.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",Pt(t.unitPrice))))):sa(e)})()),React.createElement("td",null,Ts(e)),React.createElement("td",{className:"fw-semibold"},Pt(ha(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${ta(e.status)}`},Tn(e.status)),va(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Rn} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(e),"d"),wa(e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${zn} ng\xE0y`},"\u23F3 C\xF2n ",Na(e),"d"))),React.createElement("td",null,na(e.created_at)),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-2 justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:n=>{n.stopPropagation(),Da(e)},disabled:A||!!B||Ne===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("select",{className:"form-select form-select-sm orders-status-quick",defaultValue:"",onClick:n=>n.stopPropagation(),onChange:n=>{n.stopPropagation();const t=String(n.target.value||"").trim();n.target.value="",t&&Jn(e,t)},disabled:A||!!B||Ne===e.id,"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i"},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))))))),!st&&Oe&&!Ie&&React.createElement("div",{className:"d-flex justify-content-center mt-3"},React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:Zs,disabled:ze||Ce},Ce?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2","aria-hidden":"true"}),"\u0110ang t\u1EA3i th\xEAm..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-angle-down me-2"}),"T\u1EA3i th\xEAm \u0111\u01A1n"))))),React.createElement(AdminDrawer,{open:St,title:(()=>{const e=_e,n=e!=null&&e.id?`#${e.id}`:"",t=e!=null&&e.status?`\u2022 ${Tn(e.status)}`:"";return`\u0110\u01A1n h\xE0ng ${n} ${t}`.trim()})(),subtitle:(()=>{const e=_e,n=String((e==null?void 0:e.customer_name)||"").trim(),t=String((e==null?void 0:e.phone)||"").trim(),a=e!=null&&e.created_at?na(e.created_at):"";return[n||t||null,a||null].filter(Boolean).join(" \u2022 ")})(),onClose:er,footer:React.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between"},un?React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{fn(!1),an(null),Vn(""),k(!1),Je([])},disabled:A||me},React.createElement("i",{className:"fas fa-xmark me-2"}),"H\u1EE7y s\u1EEDa"),!!bt&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary fw-semibold",onClick:xs,disabled:A||me,title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch giao ngay"))),React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-warning fw-semibold",onClick:()=>Ra({mode:"close",origin:"drawer"}),disabled:A||me||!_t.canSubmit,style:{boxShadow:"0 4px 12px rgba(255,193,7,0.25)"}},A?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u")))):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-wrap gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>_e&&Da(_e),disabled:!_e||Qt||A||!!B},React.createElement("i",{className:"fas fa-copy me-2"}),"Copy"),React.createElement("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>_e&&Ha(_e),disabled:!_e||Qt||A||!!B},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa")),React.createElement("div",{className:"d-flex flex-wrap gap-2 align-items-center"},React.createElement("select",{className:"form-select form-select-sm",defaultValue:"",onChange:e=>{const n=String(e.target.value||"").trim();e.target.value="",n&&_e&&Jn(_e,n)},disabled:!_e||Qt||A||!!B||Ne===(_e==null?void 0:_e.id),"aria-label":"\u0110\u1ED5i tr\u1EA1ng th\xE1i",style:{minWidth:140}},React.createElement("option",{value:""},"Status\u2026"),React.createElement("option",{value:"pending"},"Pending"),React.createElement("option",{value:"processing"},"Processing"),React.createElement("option",{value:"done"},"Done"),React.createElement("option",{value:"paid"},"Paid"),React.createElement("option",{value:"canceled"},"H\u1EE7y")))))},un?React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ra({mode:"close",origin:"drawer"})}},React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-pen me-2 text-warning"}),"Ch\u1EC9nh s\u1EEDa"),lr())):Qt?React.createElement("div",{className:"admin-drawer-section"},React.createElement("div",{className:"text-muted small mb-2"},"\u0110ang t\u1EA3i chi ti\u1EBFt\u2026"),React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("span",{className:"spinner-border spinner-border-sm text-warning","aria-hidden":"true"}),React.createElement("span",{className:"text-muted"},"Vui l\xF2ng ch\u1EDD"))):on?React.createElement("div",{className:"alert alert-danger",role:"alert"},on):_e?React.createElement(React.Fragment,null,React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-circle-info me-2 text-warning"}),"T\u1ED5ng quan"),React.createElement("div",{className:"d-flex flex-wrap gap-2 mb-2"},React.createElement("span",{className:`badge ${ta(_e.status)}`},Tn(_e.status)),va(_e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${Rn} ng\xE0y`},"\u26A0 Ch\u1EADm ",ca(_e),"d"),wa(_e)&&React.createElement("span",{className:"badge bg-warning text-dark",title:`\u0110\u01A1n nh\xE1p s\u1EBD t\u1EF1 h\u1EE7y sau ${zn} ng\xE0y`},"\u23F3 C\xF2n ",Na(_e),"d")),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\u1ED5ng ti\u1EC1n"),React.createElement("div",{className:"v"},Pt(ha(_e))),React.createElement("div",{className:"k"},"S\u1ED1 l\u01B0\u1EE3ng"),React.createElement("div",{className:"v"},Ts(_e)),React.createElement("div",{className:"k"},"Th\u1EDDi gian"),React.createElement("div",{className:"v"},na(_e.created_at)))),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-user me-2 text-info"}),"Kh\xE1ch h\xE0ng"),React.createElement("div",{className:"admin-kv"},React.createElement("div",{className:"k"},"T\xEAn"),React.createElement("div",{className:"v"},_e.customer_name||"\u2014"),React.createElement("div",{className:"k"},"S\u0110T"),React.createElement("div",{className:"v",style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},React.createElement("span",{className:"font-monospace"},_e.phone||"\u2014"),!!String(_e.phone||"").trim()&&React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>window.KTM.clipboard.writeText(String(_e.phone||"").trim()),title:"Copy S\u0110T"},React.createElement("i",{className:"fas fa-copy"}))),React.createElement("div",{className:"k"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("div",{className:"v"},_e.address||"\u2014")),((_e==null?void 0:_e.note)||"").trim()&&React.createElement("div",{className:"mt-2 text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"fw-semibold"},"Ghi ch\xFA:")," ",(_e.note||"").trim())),React.createElement("div",{className:"admin-drawer-section"},React.createElement("h6",null,React.createElement("i",{className:"fas fa-boxes-stacked me-2 text-primary"}),"S\u1EA3n ph\u1EA9m"),(()=>{const e=Ia(_e);return e.length?React.createElement("div",{className:"d-grid gap-2"},e.map((n,t)=>React.createElement("div",{key:t,className:"d-flex justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted me-1"},t+1,"."),n.name),n.variant?React.createElement("div",{className:"text-muted small"},n.variant):null),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",n.qty,Number(n.unitPrice)>0?` \u2022 ${Pt(n.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},sa(_e)||"\u2014")})(),(ma(_e)!==0||Gn(_e))&&React.createElement("div",{className:"mt-2",style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},Pt(ma(_e))),Gn(_e)?React.createElement("span",{className:"text-muted"}," ","(",Gn(_e),")"):null))):React.createElement("div",{className:"text-muted"},"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u")),Ue&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),bt?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Xa})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Ra({mode:"close",origin:"modal"})}},React.createElement("div",{className:"modal-body",ref:Yt},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:h.customer_name,onChange:e=>ke({...h,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!_t.nameError&&React.createElement("div",{className:"form-text text-danger"},_t.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:h.phone,onChange:e=>bs(e.target.value),onBlur:gs,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!_t.phoneError&&React.createElement("div",{className:"form-text text-danger"},_t.phoneError),!_t.phoneError&&Nn.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",Nn.count," \u0111\u01A1n trong th\xE1ng ",Nn.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>k(e=>!e)},O?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),O&&Nn.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>k(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},Nn.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${ta(e.status)}`},Tn(e.status))),React.createElement("div",{className:"text-muted small"},na(e.created_at)," \u2022 ",Pt(ha(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},sa(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Ha(e)}},"M\u1EDF")))),Nn.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(j==null?void 0:j.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(j==null?void 0:j.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(j==null?void 0:j.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(j==null?void 0:j.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:h.status,onChange:e=>ke({...h,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"draft"},"\u0110\u01A1n nh\xE1p"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:h.address,onChange:e=>ke({...h,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!_t.addressWarn&&React.createElement("div",{className:"form-text text-warning"},_t.addressWarn)),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111\u01A1n h\xE0ng"),React.createElement("textarea",{className:"form-control",value:h.note,onChange:e=>ke({...h,note:e.target.value}),placeholder:"V\xED d\u1EE5: Giao gi\u1EDD h\xE0nh ch\xEDnh / G\u1ECDi tr\u01B0\u1EDBc khi giao...",rows:2,style:{borderRadius:10,padding:12,resize:"vertical"}})),React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ke(e=>({...e,adjustment_items:[...Array.isArray(e.adjustment_items)?e.adjustment_items:[{amount:"",note:""}],{amount:"",note:""}]}))}},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm \u0111i\u1EC1u ch\u1EC9nh")),React.createElement("div",{className:"d-grid gap-2"},On(h.adjustment_items).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-3"},React.createElement("label",{className:"form-label small text-muted mb-1"},"S\u1ED1 ti\u1EC1n"),React.createElement("input",{type:"text",inputMode:"numeric",className:"form-control",value:e.amount,onChange:t=>{const a=t.target.value;ke(i=>{const o=On(i.adjustment_items);return o[n]={...o[n],amount:a},{...i,adjustment_items:o}})},placeholder:"+500000 ho\u1EB7c -200000",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("label",{className:"form-label small text-muted mb-1"},"Ghi ch\xFA"),React.createElement("input",{className:"form-control",value:e.note,onChange:t=>{const a=t.target.value;ke(i=>{const o=On(i.adjustment_items);return o[n]={...o[n],note:a},{...i,adjustment_items:o}})},placeholder:"V\xED d\u1EE5: th\xEAm van 1 tay / gi\u1EA3m gi\xE1...",style:{borderRadius:10,padding:12}})),React.createElement("div",{className:"col-12 col-md-1 d-flex"},React.createElement("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>{ke(t=>{const a=On(t.adjustment_items);return a.splice(n,1),{...t,adjustment_items:a.length?a:[{amount:"",note:""}]}})},disabled:A||On(h.adjustment_items).length<=1,title:"X\xF3a \u0111i\u1EC1u ch\u1EC9nh",style:{borderRadius:10,padding:12}},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!_t.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},_t.adjustmentAbnormalWarn),!!_t.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},_t.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{ke(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]})),Mt(e=>[...Array.isArray(e)?e:[],""]),bt&&Je(e=>[...Array.isArray(e)?e:[],!0])},disabled:A},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(h.items)?h.items:[{product_id:"",quantity:1}]).map((e,n)=>React.createElement("div",{key:n,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:t=>{Ut.current[n]=t}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Bt(t=>t===n?null:n),setTimeout(()=>{const t=document.getElementById(`order-product-search-${n}`);t&&t.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},ks(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),Ot===n&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${n}`,className:"form-control",value:xt[n]||"",onChange:t=>{const a=t.target.value;Mt(i=>{const o=Array.isArray(i)?[...i]:[];return o[n]=a,o})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),(()=>{const t=As(n);return t.length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):t.map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const i=String(a.id),o=qn(a==null?void 0:a.variants),g={};for(const y of o){const l=String((y==null?void 0:y.name)||"").trim(),v=Array.isArray(y==null?void 0:y.options)?y.options[0]:null,D=String((v==null?void 0:v.label)||"").trim();l&&D&&(g[l]=D)}const m=$a(g),I=aa(a,g);ke(y=>{const l=Array.isArray(y.items)?[...y.items]:[];return l[n]={...l[n]||{quantity:1},product_id:i,variant_json:Object.keys(g).length?g:null,variant:m,unit_price:o.length?I:null},{...y,items:l}}),Bt(null)}},a.name,a.code?` (${a.code})`:""))})()),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),zt.map(t=>React.createElement("option",{key:t.id,value:t.id},t.name)))),(()=>{var a;const t=(a=_t.items)==null?void 0:a[n];return t?React.createElement(React.Fragment,null,!!t.productError&&React.createElement("div",{className:"form-text text-danger"},t.productError),!!t.dupWarn&&React.createElement("div",{className:"form-text text-warning"},t.dupWarn)):null})(),(()=>{if(!(e!=null&&e.product_id))return null;const t=kn(e.product_id),a=qn(t==null?void 0:t.variants);if(!a.length)return null;const i=e!=null&&e.variant_json&&typeof e.variant_json=="object"?e.variant_json:{};return React.createElement("div",{className:"mt-2 d-grid gap-2"},a.map((o,g)=>{const m=String((o==null?void 0:o.name)||`Bi\u1EBFn th\u1EC3 ${g+1}`).trim(),I=String((i==null?void 0:i[m])||"").trim();return React.createElement("div",{key:m},React.createElement("label",{className:"form-label small text-muted mb-1"},m),React.createElement("select",{className:"form-select",value:I,onChange:y=>{const l=String(y.target.value||"").trim();ke(v=>{const D=Array.isArray(v.items)?[...v.items]:[],he={...D[n]||{}},fe=kn(he.product_id),ht=qn(fe==null?void 0:fe.variants),ct=he!=null&&he.variant_json&&typeof he.variant_json=="object"?{...he.variant_json}:{};l?ct[m]=l:delete ct[m];const Zt=$a(ct),kt=aa(fe,ct);return D[n]={...he,variant_json:Object.keys(ct).length?ct:null,variant:Zt,unit_price:kt},{...v,items:D}})},style:{borderRadius:10,padding:12}},React.createElement("option",{value:""},"-- ch\u1ECDn ",m," --"),(Array.isArray(o==null?void 0:o.options)?o.options:[]).map(y=>React.createElement("option",{key:y.label,value:y.label},y.label,Number.isFinite(Number(y==null?void 0:y.price))?` (${Pt(Number(y.price))})`:Number(y==null?void 0:y.price_delta)?` (${y.price_delta>0?"+":""}${y.price_delta})`:""))))}))})(),bt&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${n}`,checked:!!Be[n],onChange:t=>{const a=!!t.target.checked;Je(i=>{const o=Array.isArray(i)?[...i]:[],g=Array.isArray(h.items)?h.items.length:0;for(;o.length<g;)o.push(!0);return o[n]=a,o})},disabled:A||me}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${n}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:t=>{const a=t.target.value;ke(i=>{const o=Array.isArray(i.items)?[...i.items]:[];return o[n]={...o[n]||{product_id:""},quantity:a},{...i,items:o}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var a;const t=(a=_t.items)==null?void 0:a[n];return t&&t.qtyError?React.createElement("div",{className:"form-text text-danger"},t.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{ke(t=>{const a=Array.isArray(t.items)?[...t.items]:[];return a.splice(n,1),{...t,items:a.length?a:[{product_id:"",quantity:1,unit_price:null,variant:"",variant_json:null}]}}),Mt(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a.length?a:[""]}),Je(t=>{const a=Array.isArray(t)?[...t]:[];return a.splice(n,1),a}),Bt(t=>t==null?t:t===n?null:t>n?t-1:t)},disabled:A||me||(Array.isArray(h.items)?h.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const n=(Array.isArray(h.items)?h.items:[]).filter(m=>m==null?void 0:m.product_id),t=pa(n),a=ua(n),i=ja(h),o=i.amount,g=t+(a.found?a.fee:0)+o;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},Pt(t))),a.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},Pt(a.fee))),!!_t.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},_t.shipAbnormalWarn),o!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},Pt(o))),(h.note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111\u01A1n: ",(h.note||"").trim()),!!i.summaryText&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ",i.summaryText),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},Pt(g)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Xa,disabled:A||me,style:{borderRadius:10}},"H\u1EE7y"),!!bt&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:xs,disabled:A||me,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},me?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!bt&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Ra({mode:"new",origin:"modal"}),disabled:A||!_t.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:A||me||!_t.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},A?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

