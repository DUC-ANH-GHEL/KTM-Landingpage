const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:y,error:u}){const[_,L]=useState(""),[M,r]=useState(""),[v,f]=useState(!1),[q,h]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),u&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),u),React.createElement("form",{onSubmit:async H=>{H.preventDefault(),f(!0),await y(_,M),f(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:_,onChange:H=>L(H.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:q?"text":"password",className:"form-control",value:M,onChange:H=>r(H.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>h(!q)},React.createElement("i",{className:`fas fa-eye${q?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:y,type:u,onClose:_}){return useEffect(()=>{const L=setTimeout(_,3e3);return()=>clearTimeout(L)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${u} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},y),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:_})))}function Loading({show:y}){return y?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:y,onMenuChange:u,onLogout:_,currentUser:L}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t",disabled:!0}].map(r=>React.createElement("a",{key:r.id,href:"#",className:`nav-link ${y===r.id?"active":""} ${r.disabled?"opacity-50":""} ${r.highlight?"text-warning":""}`,onClick:v=>{v.preventDefault(),r.disabled||u(r.id)}},React.createElement("i",{className:`fas ${r.icon}`})," ",r.label,r.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),r.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),_&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:_,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}function AlbumList({albums:y,onSelect:u,onCreate:_,onEdit:L,onDelete:M,loading:r,currentFolder:v,onBack:f,breadcrumb:q}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},v&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:f},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),v?v.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:_},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),q&&q.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:h=>{h.preventDefault(),f("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),q.map((h,z)=>React.createElement("li",{key:h.id,className:`breadcrumb-item ${z===q.length-1?"active":""}`},z===q.length-1?h.title:React.createElement("a",{href:"#",onClick:H=>{H.preventDefault(),f(h)},className:"text-warning"},h.title))))),r?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):y.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},v?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},y.map(h=>React.createElement("div",{key:h.uuid||h.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>u(h)},h.cover?React.createElement("img",{src:h.cover,className:"album-cover",alt:h.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},h.title),React.createElement("small",{className:"text-muted"},h.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),h.subfolderCount),h.subfolderCount>0&&h.count>0&&" \u2022 ",h.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),h.count),h.subfolderCount===0&&h.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:z=>{z.stopPropagation(),L(h)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:z=>{z.stopPropagation(),M(h)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:y,album:u,onClose:_,onSave:L,parentId:M}){const[r,v]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[f,q]=useState(!1),[h,z]=useState(!1),H=useRef(null);useEffect(()=>{v(u?{slug:u.id||"",title:u.title||"",description:u.description||"",cover_url:u.cover||"",parent_id:u.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:M||null})},[u,y,M]);const O=async R=>{R.preventDefault(),q(!0),await L(r),q(!1)},j=R=>R.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),G=async R=>{const X=R.type==="image/heic"||R.type==="image/heif"||/\.heic$/i.test(R.name);if(R.size<=2097152&&!X)return R;try{const ne=await createImageBitmap(R),Z=document.createElement("canvas");let n=ne.width,K=ne.height;const le=800;return(n>le||K>le)&&(n>K?(K=Math.round(K/n*le),n=le):(n=Math.round(n/K*le),K=le)),Z.width=n,Z.height=K,Z.getContext("2d").drawImage(ne,0,0,n,K),ne.close(),new Promise((ce,Y)=>{Z.toBlob(me=>{me?ce(new File([me],R.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Y(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ne){throw console.error("Compress cover error:",ne),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},se=async R=>{var ne;const U=R.target.files[0];if(!U)return;if(!(U.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(U.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}z(!0);try{const Z=await G(U),n=await window.KTM.cloudinary.uploadImage({file:Z,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!n.secure_url)throw console.error("Cloudinary error:",n),new Error(((ne=n.error)==null?void 0:ne.message)||"Upload failed");v(K=>({...K,cover_url:n.secure_url}))}catch(Z){console.error("Cover upload error:",Z),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+Z.message)}z(!1),R.target.value=""};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},u?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:_})),React.createElement("form",{onSubmit:O},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:r.title,onChange:R=>v({...r,title:R.target.value,slug:r.slug||j(R.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:r.slug,onChange:R=>v({...r,slug:R.target.value}),required:!0,disabled:!!u}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:r.description,onChange:R=>v({...r,description:R.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},r.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:r.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>v(R=>({...R,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:H,type:"file",accept:"image/*",className:"d-none",onChange:se}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var R;return(R=H.current)==null?void 0:R.click()},disabled:h},h?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:r.cover_url,onChange:R=>v({...r,cover_url:R.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:_},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:f||h},f?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:y,allAlbums:u,currentAlbumId:_,targetAlbum:L,onSelect:M,level:r=0}){const[v,f]=useState(!0),q=y.uuid||y.id,h=q===_,z=L===q,H=u.filter(j=>j.parentId===q),O=H.length>0;return React.createElement("div",{style:{marginLeft:r*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${z?"bg-info text-white":h?"bg-light text-muted":"hover-bg"}`,style:{cursor:h?"not-allowed":"pointer",opacity:h?.5:1,transition:"background 0.2s"},onClick:()=>!h&&M(q)},O&&React.createElement("i",{className:`fas fa-chevron-${v?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:j=>{j.stopPropagation(),f(!v)}}),!O&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${z?"-open":""} me-2 ${z?"":"text-warning"}`}),React.createElement("span",{className:"small"},y.title),h&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),y.count>0&&!h&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},y.count)),v&&O&&React.createElement("div",null,H.map(j=>React.createElement(FolderTreeItem,{key:j.uuid||j.id,folder:j,allAlbums:u,currentAlbumId:_,targetAlbum:L,onSelect:M,level:r+1}))))}function AlbumDetail({album:y,onBack:u,onRefresh:_,showToast:L,onNavigateToFolder:M,onEditSubfolder:r,parentAlbum:v}){const[f,q]=useState([]),[h,z]=useState([]),[H,O]=useState(!0),[j,G]=useState(!1),[se,R]=useState(""),[U,X]=useState([]),[ne,Z]=useState([]),[n,K]=useState({}),[le,C]=useState(null),[ce,Y]=useState(!1),[me,we]=useState(""),[be,F]=useState(!1),ue=useRef(null),ee=useRef(null),[pe,Te]=useState(!1),[ie,ve]=useState([]),[Ke,Ce]=useState([]),[Ie,Fe]=useState(""),[a,o]=useState(!1),A=async(l,$=2)=>{const te=$*1024*1024,ke=l.type==="image/heic"||l.type==="image/heif"||/\.heic$/i.test(l.name);if(l.size<=te&&!ke)return l;try{const Me=await createImageBitmap(l),Se=document.createElement("canvas");let Ae=Me.width,Ee=Me.height;const qe=1200;return(Ae>qe||Ee>qe)&&(Ae>Ee?(Ee=Math.round(Ee/Ae*qe),Ae=qe):(Ae=Math.round(Ae/Ee*qe),Ee=qe)),Se.width=Ae,Se.height=Ee,Se.getContext("2d").drawImage(Me,0,0,Ae,Ee),Me.close(),new Promise((Ye,Ve)=>{Se.toBlob(B=>{B?Ye(new File([B],l.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):Ve(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Me){throw console.error("Compress error:",Me),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{ge(),_e()},[y.id,y.uuid]);const ge=async()=>{O(!0);try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");q(l.images||[]);const $=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${y.uuid||y.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");z(Array.isArray($)?$:[])}catch(l){console.error(l),L("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}O(!1)},_e=async()=>{try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");Ce(Array.isArray(l)?l:[])}catch(l){console.error("Error loading albums:",l)}},Pe=l=>{ve($=>$.includes(l)?$.filter(te=>te!==l):[...$,l])},Le=async()=>{if(!Ie||ie.length===0){L("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}o(!0);let l=0;for(const $ of ie)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${$}`,{album_id:Ie},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),l++}catch(te){console.error("Move error:",te)}o(!1),Te(!1),ve([]),Fe(""),l>0?(L("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),ge(),_()):L("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[Oe,fe]=useState(!1),J=async()=>{if(ie.length===0||!confirm(`X\xF3a ${ie.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;fe(!0);let l=0;for(const $ of ie)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${$}`,"L\u1ED7i x\xF3a \u1EA3nh"),l++}catch(te){console.error("Delete error:",te)}fe(!1),ve([]),l>0?(L(`\u0110\xE3 x\xF3a ${l} \u1EA3nh!`,"success"),ge(),_()):L("X\xF3a th\u1EA5t b\u1EA1i","danger")},he=()=>{ie.length===f.length?ve([]):ve(f.map(l=>l.id))},re=async()=>{if(me.trim()){F(!0);try{const l=me.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:l+"-"+Date.now(),title:me,parent_id:y.uuid||y.id},"L\u1ED7i t\u1EA1o folder"),L("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),we(""),Y(!1),ge(),_()}catch(l){L(l.message,"danger")}F(!1)}},oe=async l=>{if(confirm(`X\xF3a folder "${l.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${l.uuid||l.id}`,"L\u1ED7i x\xF3a folder"),L("\u0110\xE3 x\xF3a folder","success"),ge(),_()}catch($){L("L\u1ED7i x\xF3a folder","danger")}},w=l=>{const $=Array.from(l).filter(te=>te.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(te.name));X(te=>[...te,...$]),$.forEach(te=>{const ke=new FileReader;ke.onload=Me=>{Z(Se=>[...Se,{file:te,preview:Me.target.result}])},ke.readAsDataURL(te)})},We=l=>{X($=>$.filter((te,ke)=>ke!==l)),Z($=>$.filter((te,ke)=>ke!==l))},Qe=async l=>{var te;const $=await window.KTM.cloudinary.uploadImage({file:l,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${y.id}`});if(!$.secure_url)throw console.error("Cloudinary error:",$),new Error(((te=$.error)==null?void 0:te.message)||"Upload failed");return $},Xe=async()=>{if(U.length===0)return;G(!0);let l=0;for(let $=0;$<U.length;$++)try{R(`\u0110ang x\u1EED l\xFD ${$+1}/${U.length}...`);const te=await A(U[$],2);R(`\u0110ang upload ${$+1}/${U.length}...`);const ke=await Qe(te);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${y.id}`,{url:ke.secure_url,caption:n[$]||U[$].name.replace(/\.[^/.]+$/,""),sort_order:f.length+$},"L\u1ED7i l\u01B0u \u1EA3nh"),l++}catch(te){console.error("Upload error:",te)}G(!1),R(""),X([]),Z([]),K({}),l>0?(L(`\u0110\xE3 upload ${l} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),ge(),_()):L("Upload th\u1EA5t b\u1EA1i","danger")},Be=async(l,$)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${l}`,"L\u1ED7i x\xF3a \u1EA3nh"),L("\u0110\xE3 x\xF3a \u1EA3nh","success"),ge(),_()}catch(te){L("L\u1ED7i x\xF3a \u1EA3nh","danger")}},Ue=l=>{var $;l.preventDefault(),($=ee.current)==null||$.classList.add("dragover")},Re=()=>{var l;(l=ee.current)==null||l.classList.remove("dragover")},He=l=>{var $;l.preventDefault(),($=ee.current)==null||$.classList.remove("dragover"),w(l.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:u},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},y.title),React.createElement("small",{className:"text-muted"},h.length>0&&React.createElement("span",null,h.length," folder \u2022 "),f.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>Y(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ce&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:me,onChange:l=>we(l.target.value),onKeyPress:l=>l.key==="Enter"&&re(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:re,disabled:be||!me.trim()},be?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{Y(!1),we("")}},"H\u1EE7y")))),h.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},h.map(l=>React.createElement("div",{key:l.uuid||l.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>M&&M(l)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},l.title),React.createElement("small",{className:"text-muted"},l.subfolderCount>0&&React.createElement("span",null,l.subfolderCount," folder"),l.subfolderCount>0&&l.count>0&&" \u2022 ",l.count>0&&React.createElement("span",null,l.count," \u1EA3nh"),l.subfolderCount===0&&l.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:$=>{$.stopPropagation(),r&&r(l)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:$=>{$.stopPropagation(),oe(l)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:ee,className:"upload-zone",onClick:()=>{var l;return(l=ue.current)==null?void 0:l.click()},onDragOver:Ue,onDragLeave:Re,onDrop:He},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:ue,type:"file",multiple:!0,accept:"image/*",onChange:l=>w(l.target.files)})),ne.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},ne.map((l,$)=>React.createElement("div",{key:$,className:"upload-preview-item"},React.createElement("img",{src:l.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>We($)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:Xe,disabled:j},j?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),se||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",U.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",f.length,")"),f.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:he},ie.length===f.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),ie.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},ie.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>Te(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:J,disabled:Oe},Oe?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ve([])},React.createElement("i",{className:"fas fa-times"})))),H?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):f.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},f.map((l,$)=>React.createElement("div",{key:$,className:`image-item ${ie.includes(l.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>Pe(l.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:ie.includes(l.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:ie.includes(l.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},ie.includes(l.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:l.src,alt:l.caption,style:{opacity:ie.includes(l.id)?.7:1,border:ie.includes(l.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:te=>{te.stopPropagation(),Be(l.id,$)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),l.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},l.caption)))))),pe&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",ie.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>Te(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},Ke.filter(l=>!l.parentId).map(l=>React.createElement(FolderTreeItem,{key:l.uuid||l.id,folder:l,allAlbums:Ke,currentAlbumId:y.uuid||y.id,targetAlbum:Ie,onSelect:Fe})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>Te(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:Le,disabled:!Ie||a},a?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),le&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>C(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>C(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:le.src,alt:le.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:l=>l.stopPropagation()}),le.caption&&React.createElement("div",{className:"text-white text-center mt-2"},le.caption)))))}function SearchCenter({showToast:y,onNavigate:u}){const[_,L]=useState(""),[M,r]=useState([]),[v,f]=useState([]),[q,h]=useState([]),[z,H]=useState("all"),[O,j]=useState(null),[G,se]=useState("list"),[R,U]=useState(!0),[X,ne]=useState([]),[Z,n]=useState([]),K=useRef(null),[le,C]=useState(!0),[ce,Y]=useState(!1),me=useRef(null),[we,be]=useState(!1),[F,ue]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[ee,pe]=useState(""),[Te,ie]=useState(!1),ve=useRef(null),Ke=useRef(null),[Ce,Ie]=useState(null),[Fe,a]=useState(!1),[o,A]=useState(null),[ge,_e]=useState(!1),[Pe,Le]=useState(!1),[Oe,fe]=useState(null),[J,he]=useState({name:"",code:"",price:"",image:"",category:"",note:""}),re=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],oe=t=>{t._type==="product"&&(A(t),he({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||""}),a(!0))},w=async()=>{if(o)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${o.id}`,J,"L\u1ED7i c\u1EADp nh\u1EADt"),y("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),a(!1),A(null),Ue()}catch(t){y(t.message,"danger")}},We=async t=>{const p=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${p} "${t.name}"?`))try{let g="";t._type==="product"?g=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?g=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(g=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(g,"L\u1ED7i x\xF3a"),y(`\u0110\xE3 x\xF3a ${p}`,"success"),Ue()}catch(g){y(g.message,"danger")}},Qe=async t=>{try{const p=Oe?`${API_BASE}/api/products?id=${Oe.id}`:`${API_BASE}/api/products`;Oe?await window.KTM.api.putJSON(p,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(p,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(Oe?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Le(!1),fe(null),Ue()}catch(p){y(p.message,"danger")}},Xe="ktm_admin_data_cache_v1",Be=1e3*60*10,Ue=async()=>{let t=null,p=!1;const g=window.KTM.cache.read(Xe,{ttlMs:Be,validate:Array.isArray});g.hit?(t=g.value,console.log("[CACHE] Using cache, items:",t.length),f(t),r(t),U(!1),p=!0):g.status==="miss"?console.log("[CACHE] No cache found"):g.status==="expired"||g.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):g.status==="error"&&console.error("[CACHE] Error parsing cache"),p||U(!0);try{const k=async(de,Ne)=>{try{const je=await window.KTM.api.getJSON(de,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return je!=null?je:Ne}catch(je){return Ne}},[I,b,m]=await Promise.all([k(`${API_BASE}/api/products`,[]),k(`${API_BASE}/api/albums`,[]),k(`${API_BASE}/api/video-folders?withVideos=true`,[])]),T=Array.isArray(I)?I.map(de=>({...de,_type:"product",_source:"database"})):[];ne(b);let E=[];Array.isArray(b)&&b.length>0&&(await Promise.all(b.map(Ne=>k(`${API_BASE}/api/albums/${Ne.id}`,{})))).forEach((Ne,je)=>{const Je=b[je];Ne.images&&Ne.images.length>0&&Ne.images.forEach(ae=>{E.push({id:ae.id,name:ae.caption||"\u1EA2nh t\u1EEB "+Je.title,image:ae.src,folder:Je.title,_type:"album",_source:"database"})})}),n(m);let W=[];Array.isArray(m)&&m.forEach(de=>{de.videos&&de.videos.forEach(Ne=>{W.push({id:Ne.id,name:Ne.title,folder:de.name,image:Ne.thumb,youtubeId:Ne.youtubeId,url:Ne.url,_type:"video",_source:"database"})})});const P=[...T,...E,...W];(!t||JSON.stringify(P)!==JSON.stringify(t))&&(f(P),r(P),window.KTM.cache.write(Xe,P))}catch(k){console.error("Song song fetch error:",k)}U(!1)};useEffect(()=>{Ue(),setTimeout(()=>{var t;return(t=K.current)==null?void 0:t.focus()},100)},[]);const Re=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(p){return String(t!=null?t:"").toLowerCase()}},He=t=>{const g=Re(t).trim().split(/\s+/).filter(Boolean),k=g.includes("anh"),I=g.includes("video"),b=g.filter(E=>E!=="anh"&&E!=="video"),m=b.join(" "),T=new Set(["product"]);return k&&T.add("album"),I&&T.add("video"),{allowedTypes:T,includeAlbum:k,includeVideo:I,contentTokens:b,cleanedQuery:m}},l=(t,p,g)=>{var de,Ne,je,Je,ae;const k=Array.isArray(p)?p:[],I=Re(g).trim();if(!k.length&&!I)return 0;const b=Re((de=t==null?void 0:t.name)!=null?de:""),m=Re((Ne=t==null?void 0:t.code)!=null?Ne:""),T=Re((je=t==null?void 0:t.category)!=null?je:""),E=Re((Je=t==null?void 0:t.note)!=null?Je:""),W=Re((ae=t==null?void 0:t.folder)!=null?ae:"");if(!`${b} ${m} ${T} ${E} ${W}`.trim())return 0;let S=0;I&&(b===I&&(S+=220),b.includes(I)&&(S+=140),b.startsWith(I)&&(S+=160),m&&m===I&&(S+=180),m&&m.includes(I)&&(S+=90));for(const ze of k){if(!ze)continue;const Ze=new RegExp(`(?:^|\\s)${ze.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);b.includes(ze)&&(S+=35),Ze.test(b)&&(S+=25),m&&m.includes(ze)&&(S+=20),m&&Ze.test(m)&&(S+=10),T&&T.includes(ze)&&(S+=12),W&&W.includes(ze)&&(S+=12),E&&E.includes(ze)&&(S+=6)}return S>0&&b&&(S+=Math.max(0,10-Math.min(10,Math.floor(b.length/10)))),S},$=(t,p,g)=>{const k=Array.isArray(t)?t:[];return k.length?k.map((b,m)=>({it:b,idx:m,score:l(b,p,g)})).sort((b,m)=>m.score!==b.score?m.score-b.score:b.idx-m.idx).map(b=>b.it):[]},te=async(t,p)=>{if(!(!le||p.length===0)){Y(!0);try{const g=p.map(I=>({id:I.id,name:I.name,price:I.price,category:I.category,note:I.note,folder:I.folder,_type:I._type})),k=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:g},"AI Search error");if(k&&k.matchedIds&&k.matchedIds.length>0){const{contentTokens:I,cleanedQuery:b}=He(t),m=new Set(k.matchedIds),T=p.filter(E=>m.has(E.id)).sort((E,W)=>l(W,I,b)-l(E,I,b));T.length>0&&r(T)}else k&&k.matchedIds&&k.matchedIds.length===0&&r([])}catch(g){console.error("AI Search error:",g)}Y(!1)}},ke=t=>{if(L(t),me.current&&clearTimeout(me.current),!t.trim()){Me(z);return}const{allowedTypes:p,contentTokens:g,cleanedQuery:k}=He(t),I=v.filter(m=>{if(!p.has(m==null?void 0:m._type))return!1;if(g.length===0)return!0;const T=Re(Object.entries(m).filter(([E])=>!E.startsWith("_")).map(([,E])=>String(E||"")).join(" "));return g.some(E=>T.includes(E))});let b=I;z!=="all"&&(b=I.filter(m=>(m.category||m._type)===z)),r($(b,g,k)),le&&k.length>=3&&(me.current=setTimeout(()=>{te(k,b)},500))},Me=t=>{H(t);const{allowedTypes:p,contentTokens:g}=He(_),{cleanedQuery:k}=He(_);let I=v.filter(b=>p.has(b==null?void 0:b._type));t!=="all"&&(I=I.filter(b=>(b.category||b._type)===t)),_.trim()&&g.length>0&&(I=I.filter(b=>{const m=Re(Object.entries(b).filter(([T])=>!T.startsWith("_")).map(([,T])=>String(T||"")).join(" "));return g.every(T=>m.includes(T))})),r($(I,g,k))},Se=(t,p)=>{window.KTM.clipboard.writeText(t).then(()=>{j(p),y("\u0110\xE3 copy!","success"),setTimeout(()=>j(null),1500)})},Ae=async(t,p)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),j(p+"-img"),y("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>j(null),1500)}catch(g){Se(t,p+"-img")}},Ee=t=>{let p=t.toLowerCase();const g=[],k=v.filter(m=>m._type==="product");if(p.includes("ty")||p.includes("xy lanh")){if(p.includes("gi\u1EEFa")||p.includes("giua")){const m=k.find(T=>{var E;return(E=T.name)==null?void 0:E.toLowerCase().includes("xy lanh gi\u1EEFa")});m&&!g.find(T=>T.id===m.id)&&g.push(m)}if(p.includes("nghi\xEAng")||p.includes("nghieng")){const m=k.find(T=>{var E;return(E=T.name)==null?void 0:E.toLowerCase().includes("xy lanh nghi\xEAng")});m&&!g.find(T=>T.id===m.id)&&g.push(m)}if(p.includes("\u1EE7i")||p.includes("ui")){const m=k.find(T=>{var E;return(E=T.name)==null?void 0:E.toLowerCase().includes("xy lanh \u1EE7i")});m&&!g.find(T=>T.id===m.id)&&g.push(m)}}const I=p.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(I){const m=I[1],T=I[2],E=k.find(W=>{var S;const P=((S=W.name)==null?void 0:S.toLowerCase())||"";return P.includes("combo")&&P.includes(`${m} tay`)&&(P.includes(`${T} xy`)||P.includes(`${T} xylanh`))});if(E&&!g.find(W=>W.id===E.id))g.push(E);else{const W=k.find(P=>{var de;const S=((de=P.name)==null?void 0:de.toLowerCase())||"";return S.includes("combo")&&S.includes(`${m} tay`)});W&&!g.find(P=>P.id===W.id)&&g.push(W)}}if(p.includes("combo")&&!I){const m=p.match(/combo.*?(\d+)\s*tay/);if(m){const T=m[1];k.filter(W=>{var S;const P=((S=W.name)==null?void 0:S.toLowerCase())||"";return P.includes("combo")&&P.includes(`${T} tay`)}).forEach(W=>{g.find(P=>P.id===W.id)||g.push(W)})}}const b=p.match(/van\s*(\d+)\s*tay/);if(b&&!p.includes("ty")&&!p.includes("combo")){const m=b[1],T=k.find(E=>{var P;const W=((P=E.name)==null?void 0:P.toLowerCase())||"";return W.includes(`van ${m} tay`)&&!W.includes("combo")});T&&!g.find(E=>E.id===T.id)&&g.push(T)}return g.slice(0,4)},qe=async t=>{if(!t.trim())return;const p={role:"user",content:t,attachments:[]};ue(k=>[...k,p]),pe(""),ie(!0);const g=Ee(t);setTimeout(()=>{var k;return(k=ve.current)==null?void 0:k.scrollIntoView({behavior:"smooth"})},100);try{const I=v.filter(P=>P._type==="product").map(P=>{let S=`- ${P.name}`;return P.code&&(S+=` (M\xE3: ${P.code})`),P.price&&(S+=` - Gi\xE1: ${P.price.replace(/[đ\s]/g,"")}\u0111`),P.category&&(S+=` [${P.category}]`),P.note&&(S+=` (${P.note})`),S}).join(`
`),m=F.slice(-6).map(P=>`${P.role==="user"?"Kh\xE1ch":"AI"}: ${P.content}`).join(`
`),T=m?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${m}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${I}`:I,W=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:T,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";ue(P=>[...P,{role:"assistant",content:W,attachments:g}])}catch(k){console.error("AI Error:",k);const I=t.toLowerCase(),b=v.filter(T=>{const E=Object.values(T).join(" ").toLowerCase();return I.split(" ").some(W=>E.includes(W))});let m="";b.length>0?(m=`T\xECm th\u1EA5y ${b.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,b.slice(0,5).forEach(T=>{m+=`\u2022 ${T.name}`,T.price&&(m+=` - ${T.price.replace(/[đ\s]/g,"")}\u0111`),T.note&&(m+=` (${T.note})`),m+=`
`}),b.length>5&&(m+=`
...v\xE0 ${b.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):m='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',ue(T=>[...T,{role:"assistant",content:m,attachments:b.slice(0,4)}])}ie(!1),setTimeout(()=>{var k,I;(k=ve.current)==null||k.scrollIntoView({behavior:"smooth"}),(I=Ke.current)==null||I.focus()},100)};function st({show:t,product:p,categories:g,onClose:k,onSave:I}){const[b,m]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[T,E]=useState(!1),[W,P]=useState(!1),S=useRef(null),de=e=>window.KTM.money.formatVNDInputDigits(e);useEffect(()=>{if(p)if(m({name:p.name||"",code:p.code||"",price:p.price||"",image:p.image||"",category:p.category||"",note:p.note||"",sort_order:p.sort_order||0}),p.price){const e=window.KTM.money.getDigits(p.price);ae(e),m(i=>({...i,price:de(e)}))}else ae("");else m({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),ae("")},[p,t]);const[Ne,je]=React.useState(""),[Je,ae]=React.useState(""),ze=e=>{const i=window.KTM.money.nextPriceInputState(e.target.value,Je);ae(i.digits),m({...b,price:i.price})},Ze=async(e,i=2)=>{const s=i*1024*1024;if(e.size<=s)return e;try{const c=await createImageBitmap(e),d=document.createElement("canvas");let x=c.width,Q=c.height;const D=1200;return(x>D||Q>D)&&(x>Q?(Q=Math.round(Q/x*D),x=D):(x=Math.round(x/Q*D),Q=D)),d.width=x,d.height=Q,d.getContext("2d").drawImage(c,0,0,x,Q),c.close(),new Promise((V,ye)=>{d.toBlob($e=>{$e?V(new File([$e],e.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):ye(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(c){throw console.error("Compress error:",c),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},rt=async e=>{var c;const i=e.target.files[0];if(!i)return;if(!(i.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(i.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}P(!0);try{const d=await Ze(i),x=await window.KTM.cloudinary.uploadImage({file:d,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!x.secure_url)throw console.error("Cloudinary error:",x),new Error(((c=x.error)==null?void 0:c.message)||"Upload failed");m(Q=>({...Q,image:x.secure_url}))}catch(d){console.error("Upload error:",d),alert("L\u1ED7i upload \u1EA3nh: "+d.message)}P(!1),e.target.value=""},et=async e=>{e.preventDefault(),E(!0),await I(b),E(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),p?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:k})),React.createElement("form",{onSubmit:et},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:b.name,onChange:e=>m({...b,name:e.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:b.code,onChange:e=>m({...b,code:e.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:b.price,onChange:ze,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:b.category,onChange:e=>m({...b,category:e.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),g.map(e=>React.createElement("option",{key:e,value:e},e)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:b.note,onChange:e=>m({...b,note:e.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},b.image?React.createElement(React.Fragment,null,React.createElement("img",{src:b.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>m({...b,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var e;return(e=S.current)==null?void 0:e.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:S,type:"file",accept:"image/*",className:"d-none",onChange:rt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var e;return(e=S.current)==null?void 0:e.click()},disabled:W,style:{borderRadius:"10px"}},W?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:b.image,onChange:e=>m({...b,image:e.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:k,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:T,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},T?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const Ye=(t,p)=>{const g=t._type==="product",k=t._type==="album",I=t._type==="video",b=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale"));return G==="grid"?React.createElement("div",{key:t.id||p,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>Ie({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${I?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${g?"product":k?"album":"video"}`},g?"SP":k?"\u1EA2nh":"Video"),b&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:O===t.id+"-img"?"copied":"",onClick:()=>Ae(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:O===t.id+"-price"?"copied":"",onClick:()=>Se(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||p,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${g?"product":k?"album":"video"}`},g?"S\u1EA3n ph\u1EA9m":k?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>Ie({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${I?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),b&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),I&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},g&&React.createElement("button",{onClick:()=>u&&u("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:O===t.id+"-price"?"copied":"",onClick:()=>Se(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:O===t.id+"-name"?"copied":"",onClick:()=>Se(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),I&&t.youtubeId&&React.createElement("button",{className:O===t.id+"-yt"?"copied":"",onClick:()=>Se(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),g&&React.createElement("button",{className:"action-edit",onClick:()=>oe(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>We(t)},React.createElement("i",{className:"fas fa-trash"}))))},[Ve,B]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,M.length)," k\u1EBFt qu\u1EA3",le&&_.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),z!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},z==="product"?"S\u1EA3n ph\u1EA9m":z==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${G==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>se("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${G==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>se("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},R?React.createElement("div",null,[...Array(8)].map((t,p)=>React.createElement("div",{key:p,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):M.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',_,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{L(""),ke("")}},"Xem t\u1EA5t c\u1EA3")):G==="grid"?React.createElement("div",{className:"product-grid-mobile"},M.map((t,p)=>Ye(t,p))):React.createElement("div",null,M.map((t,p)=>Ye(t,p)))),Ve&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>B(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${z==="all"?"active":""}`,onClick:()=>{Me("all"),B(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${z==="product"?"active":""}`,onClick:()=>{Me("product"),B(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${z==="album"?"active":""}`,onClick:()=>{Me("album"),B(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${z==="video"?"active":""}`,onClick:()=>{Me("video"),B(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:le,onChange:t=>C(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:K,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:_,onChange:t=>ke(t.target.value)}),React.createElement("button",{className:`filter-btn ${Ve||z!=="all"?"active":""}`,onClick:()=>B(!Ve)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:ge?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>be(!0),onTouchStart:()=>be(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),we&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>be(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},F.map((t,p)=>React.createElement("div",{key:p,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:O===`chat-${p}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:O===`chat-${p}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),j(`chat-${p}`),setTimeout(()=>j(null),1500)}},React.createElement("i",{className:`fas ${O===`chat-${p}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((g,k)=>React.createElement("div",{key:k,style:{width:70},className:"text-center"},g.image&&React.createElement("img",{src:g.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>Ie({url:g.image,name:g.name,price:g.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},g.name),g.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},g.price.replace(/[đ\s]/g,""),"\u0111"))))))),Te&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:ve})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>qe(t),disabled:Te,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),qe(ee)},className:"chat-input-wrap"},React.createElement("input",{ref:Ke,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:ee,onChange:t=>pe(t.target.value),disabled:Te}),React.createElement("button",{type:"submit",className:"send-btn",disabled:Te||!ee.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),Ce&&React.createElement("div",{className:"preview-modal",onClick:()=>Ie(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>Ie(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:Ce.url,alt:Ce.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},Ce.name),Ce.price&&React.createElement("div",{className:"price"},Ce.price.replace(/[đ\s]/g,""),"\u0111"),Ce.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},Ce.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:O==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:O==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>Ae(Ce.url,"preview")},React.createElement("i",{className:`fas ${O==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),Ce.price&&React.createElement("button",{className:O==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Se(Ce.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${O==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(st,{show:Pe,product:Oe,categories:q,onClose:()=>{Le(!1),fe(null)},onSave:Qe}),React.createElement("div",{className:`fab-container mobile-only ${ge?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{_e(!1),Le(!0),fe(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{_e(!1),u&&u("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${ge?"open":""}`,onClick:()=>_e(!ge)},React.createElement("i",{className:"fas fa-plus"}))),Fe&&o&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>a(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:J.name,onChange:t=>he({...J,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:J.code,onChange:t=>he({...J,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:J.price,onChange:t=>he({...J,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:J.category,onChange:t=>he({...J,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),re.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:J.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>he({...J,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>a(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:w},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:y,showToast:u}){const[_,L]=useState([]),[M,r]=useState([]),[v,f]=useState(!0),[q,h]=useState(null),[z,H]=useState(!1),[O,j]=useState(null),[G,se]=useState(!1),[R,U]=useState(null),[X,ne]=useState(null),[Z,n]=useState([]);useEffect(()=>{K()},[]);const K=async(a=null)=>{f(!0);try{const o=a?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${a}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,A=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");L(Array.isArray(A)?A:[])}catch(o){console.error(o),u("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}f(!1)},le=async a=>{try{const o=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${a}`,"L\u1ED7i t\u1EA3i video");r(Array.isArray(o)?o:[])}catch(o){console.error(o)}},C=async a=>{if(a===0)return;const o=[..._];[o[a-1],o[a]]=[o[a],o[a-1]],L(o),await Y(o)},ce=async a=>{if(a===_.length-1)return;const o=[..._];[o[a],o[a+1]]=[o[a+1],o[a]],L(o),await Y(o)},Y=async a=>{try{await Promise.all(a.map((o,A)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${o.id}`,{sortOrder:A},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),u("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(o){u("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),K(X==null?void 0:X.id)}},me=async a=>{if(a===0)return;const o=[...M];[o[a-1],o[a]]=[o[a],o[a-1]],r(o),await be(o)},we=async a=>{if(a===M.length-1)return;const o=[...M];[o[a],o[a+1]]=[o[a+1],o[a]],r(o),await be(o)},be=async a=>{try{await Promise.all(a.map((o,A)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${o.id}`,{sort_order:A},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),u("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(o){u("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),le(q.id)}},F=()=>{j(null),H(!0)},ue=a=>{j(a),H(!0)},ee=async a=>{try{!O&&X&&(a.parent_id=X.id);const o=O?`${API_BASE}/api/video-folders/${O.id}`:`${API_BASE}/api/video-folders`;O?await window.KTM.api.putJSON(o,a,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(o,a,"L\u1ED7i l\u01B0u folder"),u(O?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),H(!1),K(X==null?void 0:X.id)}catch(o){u(o.message,"danger")}},pe=async a=>{const o=a.subfolderCount>0?`X\xF3a folder "${a.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${a.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(o))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${a.id}`,"L\u1ED7i x\xF3a folder"),u("\u0110\xE3 x\xF3a folder","success"),h(null),K(X==null?void 0:X.id)}catch(A){u("L\u1ED7i x\xF3a folder","danger")}},Te=a=>{a.subfolderCount>0?(n(o=>[...o,a]),ne(a),K(a.id)):(h(a),r(a.videos||[]))},ie=a=>{if(a==="root")n([]),ne(null),K(null);else if(a){const o=Z.findIndex(A=>A.id===a.id);o>=0&&(n(Z.slice(0,o+1)),ne(a),K(a.id))}else{const o=[...Z];o.pop();const A=o[o.length-1]||null;n(o),ne(A),K(A==null?void 0:A.id)}},ve=()=>{U(null),se(!0)},Ke=a=>{U(a),se(!0)},Ce=async a=>{try{a.folder_id=q==null?void 0:q.id;const o=R?`${API_BASE}/api/videos/${R.id}`:`${API_BASE}/api/videos`;R?await window.KTM.api.putJSON(o,a,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(o,a,"L\u1ED7i l\u01B0u video"),u(R?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),se(!1),K(),q&&le(q.id)}catch(o){u(o.message,"danger")}},Ie=async a=>{if(confirm(`X\xF3a video "${a.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${a.id}`,"L\u1ED7i x\xF3a video"),u("\u0110\xE3 x\xF3a video","success"),K(),q&&le(q.id)}catch(o){u("L\u1ED7i x\xF3a video","danger")}},Fe=a=>{const o=`https://www.youtube.com/watch?v=${a.youtubeId}`;window.KTM.clipboard.writeText(o).then(()=>{u("\u0110\xE3 copy link!","success")}).catch(()=>{u("Kh\xF4ng th\u1EC3 copy link","danger")})};return q?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>h(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${q.slug==="shorts"?"text-danger":"text-warning"}`}),q.name)),React.createElement("button",{className:"btn btn-warning",onClick:ve},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),M.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},M.map((a,o)=>React.createElement("div",{key:a.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>me(o),disabled:o===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},o+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>we(o),disabled:o===M.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:a.thumb,className:"card-img-top",alt:a.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${a.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:a.title},a.title),React.createElement("small",{className:"text-muted"},a.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Fe(a),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>Ke(a),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Ie(a),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:G,video:R,onClose:()=>se(!1),onSave:Ce})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},X&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>ie()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),X?X.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:F},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),Z.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:a=>{a.preventDefault(),ie("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),Z.map((a,o)=>React.createElement("li",{key:a.id,className:`breadcrumb-item ${o===Z.length-1?"active":""}`},o===Z.length-1?a.name:React.createElement("a",{href:"#",onClick:A=>{A.preventDefault(),ie(a)},className:"text-warning"},a.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),v?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):_.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},X?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:F},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",X?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},_.map((a,o)=>{var A,ge,_e,Pe;return React.createElement("div",{key:a.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Le=>{Le.stopPropagation(),C(o)},disabled:o===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},o+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:Le=>{Le.stopPropagation(),ce(o)},disabled:o===_.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>Te(a),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${a.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},a.name),React.createElement("p",{className:"text-muted mb-0"},a.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),a.subfolderCount," folder"),a.subfolderCount>0&&(a.videoCount>0||((A=a.videos)==null?void 0:A.length)>0)&&" \u2022 ",(a.videoCount>0||((ge=a.videos)==null?void 0:ge.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),a.videoCount||((_e=a.videos)==null?void 0:_e.length)||0," videos"),a.subfolderCount===0&&!a.videoCount&&!((Pe=a.videos)!=null&&Pe.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Le=>{Le.stopPropagation(),ue(a)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:Le=>{Le.stopPropagation(),pe(a)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:z,folder:O,onClose:()=>H(!1),onSave:ee}))}function VideoFolderModal({show:y,folder:u,onClose:_,onSave:L}){const[M,r]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[v,f]=useState(!1),[q,h]=useState(!1);useEffect(()=>{r(u?{name:u.name||"",description:u.description||"",sortOrder:u.sortOrder||0,coverImage:u.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[u,y]);const z=async O=>{const j=O.target.files[0];if(j){h(!0);try{const G=await window.KTM.cloudinary.uploadImage({file:j,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});G.secure_url&&r(se=>({...se,coverImage:G.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(G){console.error("Cloudinary upload error:",G),alert("L\u1ED7i upload \u1EA3nh: "+(G.message||G))}finally{h(!1)}}},H=async O=>{O.preventDefault(),f(!0),await L(M),f(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},u?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:_})),React.createElement("form",{onSubmit:H},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:M.name,onChange:O=>r({...M,name:O.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:M.description,onChange:O=>r({...M,description:O.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:M.sortOrder,onChange:O=>r({...M,sortOrder:parseInt(O.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},M.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:M.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>r({...M,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:z,disabled:q}),q&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:M.coverImage,onChange:O=>r({...M,coverImage:O.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:_},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:y}){const[u,_]=useState([]),[L,M]=useState(!0),[r,v]=useState(!1),[f,q]=useState(null),[h,z]=useState(""),[H,O]=useState(""),j=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{G()},[]);const G=async()=>{M(!0);try{const n=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");_(Array.isArray(n)?n:[])}catch(n){console.error(n),y("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}M(!1)},se=()=>{q(null),v(!0)},R=n=>{q(n),v(!0)},U=async n=>{if(!(!n||!n.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:n},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),y(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),G()}catch(K){y("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},X=async n=>{try{const K=f?`${API_BASE}/api/products?id=${f.id}`:`${API_BASE}/api/products`;f?await window.KTM.api.putJSON(K,n,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(K,n,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),y(f?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),v(!1),G()}catch(K){y(K.message,"danger")}},ne=async n=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${n.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${n.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),y("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),G()}catch(K){y(K.message,"danger")}},Z=u.filter(n=>{const K=!h||n.name.toLowerCase().includes(h.toLowerCase())||n.code&&n.code.toLowerCase().includes(h.toLowerCase()),le=!H||n.category===H;return K&&le});return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:se},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:h,onChange:n=>z(n.target.value)})),React.createElement("span",{className:"product-count"},Z.length)),React.createElement("select",{className:"form-select",value:H,onChange:n=>O(n.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),j.map(n=>React.createElement("option",{key:n,value:n},n)))),L?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):Z.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:se},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},Z.map(n=>React.createElement("div",{key:n.id,className:"product-item d-flex align-items-center gap-3"},n.image?React.createElement("img",{src:n.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},n.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},n.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},n.category),n.code&&React.createElement("span",{className:"product-badge bg-secondary"},n.code)),React.createElement("div",{className:"product-price"},n.price?n.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),n.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},n.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>R(n),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>ne(n),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:r,product:f,categories:j,onClose:()=>v(!1),onSave:X}))}function ProductModal({show:y,product:u,categories:_,onClose:L,onSave:M}){const[r,v]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0}),[f,q]=useState(!1),[h,z]=useState(!1);useEffect(()=>{v(u?{name:u.name||"",code:u.code||"",price:u.price||"",image:u.image||"",category:u.category||"",note:u.note||"",sort_order:u.sort_order||0}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0})},[u,y]);const[H,O]=React.useState(""),j=C=>window.KTM.money.formatVNDInputDigits(C),[G,se]=React.useState(""),R=C=>{const ce=window.KTM.money.nextPriceInputState(C.target.value,G);se(ce.digits),v({...r,price:ce.price})},[U,X]=React.useState("");React.useEffect(()=>{u!=null&&u.image&&X(u.image)},[u]);const ne=async C=>{if(!(!C||!C.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:C},"L\u1ED7i x\xF3a \u1EA3nh")}catch(ce){console.error("Delete cloudinary image error:",ce)}},Z=async(C,ce=2,Y)=>{const me=ce*1024*1024,we=C.type==="image/heic"||C.type==="image/heif"||/\.heic$/i.test(C.name);if(C.size<=me&&!we)return C;Y==null||Y("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const be=await createImageBitmap(C);Y==null||Y("\u0110ang n\xE9n \u1EA3nh...");const F=document.createElement("canvas");let ue=be.width,ee=be.height;const pe=1200;return(ue>pe||ee>pe)&&(ue>ee?(ee=Math.round(ee/ue*pe),ue=pe):(ue=Math.round(ue/ee*pe),ee=pe)),F.width=ue,F.height=ee,F.getContext("2d").drawImage(be,0,0,ue,ee),be.close(),new Promise((ie,ve)=>{F.toBlob(Ke=>{Ke?(Y==null||Y("Ho\xE0n t\u1EA5t!"),ie(new File([Ke],C.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):ve(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(be){throw console.error("createImageBitmap error:",be),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},n=async C=>{var me,we;const ce=(me=C.target.files)==null?void 0:me[0];if(!ce)return;if(!(ce.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ce.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}z(!0),O("\u0110ang chu\u1EA9n b\u1ECB...");try{const be=(ce.size/1024/1024).toFixed(1);O(`File ${be}MB - \u0110ang n\xE9n...`);const F=await Z(ce,2,pe=>{O(pe)}),ue=(F.size/1024/1024).toFixed(1);O(`\u0110\xE3 n\xE9n: ${ue}MB - \u0110ang upload...`);const ee=await window.KTM.cloudinary.uploadImage({file:F,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});ee.secure_url?(r.image&&r.image!==U&&ne(r.image),v(pe=>({...pe,image:ee.secure_url})),O("")):(console.error("Cloudinary error:",ee),alert("Upload th\u1EA5t b\u1EA1i: "+(((we=ee.error)==null?void 0:we.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),O(""))}catch(be){console.error("Upload error:",be),alert("L\u1ED7i: "+be.message),O("")}z(!1),C.target.value=""},K=()=>{r.image&&(r.image!==U&&ne(r.image),v(C=>({...C,image:""})))},le=async C=>{C.preventDefault(),q(!0),U&&r.image&&U!==r.image&&await ne(U),U&&!r.image&&await ne(U),await M(r),q(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${u?"fa-edit":"fa-plus-circle"} me-2`}),u?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:L})),React.createElement("form",{onSubmit:le},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},r.image?React.createElement(React.Fragment,null,React.createElement("img",{src:r.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:K,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${h?"fa-spinner fa-spin":"fa-camera"} me-1`}),h?H||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:n,disabled:h,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),h&&H&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},H))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:r.name,onChange:C=>v({...r,name:C.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:r.code,onChange:C=>v({...r,code:C.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:r.price,onChange:R,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:r.category,onChange:C=>v({...r,category:C.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),_.map(C=>React.createElement("option",{key:C,value:C},C)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:r.note,onChange:C=>v({...r,note:C.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:r.image,onChange:C=>v({...r,image:C.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:L,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:f,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},f?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:y,video:u,onClose:_,onSave:L}){const[M,r]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[v,f]=useState(!1),[q,h]=useState("");useEffect(()=>{u?(r({title:u.title||"",youtube_url:`https://www.youtube.com/watch?v=${u.youtubeId}`,thumbnail_url:u.thumb||"",sort_order:u.sortOrder||0}),h(u.thumb)):(r({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),h(""))},[u,y]);const z=j=>{const G=j.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return G?G[1]:null},H=j=>{r({...M,youtube_url:j});const G=z(j);G&&h(`https://img.youtube.com/vi/${G}/hqdefault.jpg`)},O=async j=>{j.preventDefault(),f(!0),await L(M),f(!1)};return y?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},u?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:_})),React.createElement("form",{onSubmit:O},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:M.youtube_url,onChange:j=>H(j.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),q&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:q,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:M.title,onChange:j=>r({...M,title:j.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:M.sort_order,onChange:j=>r({...M,sort_order:parseInt(j.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:M.thumbnail_url,onChange:j=>r({...M,thumbnail_url:j.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:_},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:v},v?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[y,u]=useState(!1),[_,L]=useState(""),[M,r]=useState(null),[v,f]=useState("search"),[q,h]=useState(null),[z,H]=useState(""),[O,j]=useState([]),[G,se]=useState(null),[R,U]=useState(!1),[X,ne]=useState(null),[Z,n]=useState(!0),[K,le]=useState([]),[C,ce]=useState(null),[Y,me]=useState([]);useEffect(()=>{const a=localStorage.getItem("ktm_admin_session");if(a)try{const o=JSON.parse(a);o.expiry>Date.now()?(u(!0),r(o.user)):localStorage.removeItem("ktm_admin_session")}catch(o){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{y&&ee()},[y]);const we=async(a,o)=>{L("");try{const A=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:a,password:o},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),ge={user:A.user,token:A.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(ge)),r(A.user),u(!0)}catch(A){L(A.message)}},be=()=>{localStorage.removeItem("ktm_admin_session"),u(!1),r(null),j([]),se(null)},F=(a,o="success")=>{const A=Date.now();le(ge=>[...ge,{id:A,message:a,type:o}])},ue=a=>{le(o=>o.filter(A=>A.id!==a))},ee=async(a=null)=>{n(!0);try{const o=a?`${API_BASE}/api/albums?parent_id=${a}`:`${API_BASE}/api/albums?parent_id=root`,A=await window.KTM.api.getJSON(o,"L\u1ED7i t\u1EA3i danh s\xE1ch album");j(Array.isArray(A)?A:[])}catch(o){console.error(o),F("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}n(!1)},pe=()=>{ne(null),U(!0)},Te=a=>{ne(a),U(!0)},ie=async a=>{try{const o=X&&X.uuid;!o&&C&&(a.parent_id=C.uuid);const A=o?`${API_BASE}/api/albums/${X.uuid||X.id}`:`${API_BASE}/api/albums`;o?await window.KTM.api.putJSON(A,a,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(A,a,"L\u1ED7i t\u1EA1o"),F(o?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),U(!1),ee(C==null?void 0:C.uuid)}catch(o){F(o.message,"danger")}},ve=a=>{se(a)},Ke=a=>{if(a==="root")me([]),ce(null),ee(null);else if(a){const o=Y.findIndex(A=>A.uuid===a.uuid);o>=0&&(me(Y.slice(0,o+1)),ce(a),ee(a.uuid))}else{const o=[...Y];o.pop();const A=o[o.length-1]||null;me(o),ce(A),ee(A==null?void 0:A.uuid)}},Ce=async a=>{const o=`X\xF3a folder "${a.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(o))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${a.uuid||a.id}`,"L\u1ED7i x\xF3a album"),F("\u0110\xE3 x\xF3a","success"),ee(C==null?void 0:C.uuid)}catch(A){F("L\u1ED7i x\xF3a album","danger")}};if(!y)return React.createElement(LoginPage,{onLogin:we,error:_});const Ie=()=>{const a=new Date,o=a.getFullYear(),A=String(a.getMonth()+1).padStart(2,"0");return`${o}-${A}`};function Fe(){const[a,o]=useState(Ie()),[A,ge]=useState(!0),[_e,Pe]=useState([]),{parseMoney:Le,parseShipFeeFromNote:Oe,getShipFeeForItems:fe,formatNumber:J,formatVND:he}=window.KTM.money,re=async()=>{ge(!0);try{const w=await window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(a)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA");Pe(Array.isArray(w)?w:[])}catch(w){console.error("Load stats error:",w),Pe([])}finally{ge(!1)}};useEffect(()=>{re()},[a]);const oe=React.useMemo(()=>{var Ve;const w={pending:0,processing:0,done:0,paid:0,other:0};let We=0,Qe=0,Xe=0,Be=0,Ue=0;const Re=B=>B.customer_id||B.phone||"unknown",He=B=>window.KTM.orders.getOrderItems(B),l=new Map,$=new Map,te=new Map;for(const B of _e){const t=He(B);let p=0,g=0;for(const S of t){const de=Number((S==null?void 0:S.quantity)||0)||0,Ne=Le(S==null?void 0:S.product_price),je=de*Ne;p+=de,g+=je;const Je=(S==null?void 0:S.product_id)||"unknown",ae=l.get(Je)||{product_id:Je,product_name:(S==null?void 0:S.product_name)||"\u2014",product_code:(S==null?void 0:S.product_code)||"",orders:0,quantity:0,revenue:0};ae.orders+=1,ae.quantity+=de,ae.revenue+=je,l.set(Je,ae)}const k=fe(t),I=Number((Ve=B==null?void 0:B.adjustment_amount)!=null?Ve:0)||0,b=g+(k.found?k.fee:0)+I,m=g+I;We+=p,Qe+=b,Be+=m;const T=B.status==="done"||B.status==="paid";B.status==="pending"?w.pending+=1:B.status==="processing"?w.processing+=1:B.status==="paid"?(w.paid+=1,w.done+=1,Xe+=b,Ue+=m):B.status==="done"?(w.done+=1,Xe+=b,Ue+=m):w.other+=1;const E=Re(B),W=$.get(E)||{key:E,customer_name:B.customer_name||"",phone:B.phone||"",orders:0,quantity:0,revenue:0};W.orders+=1,W.quantity+=p,W.revenue+=b,!W.customer_name&&B.customer_name&&(W.customer_name=B.customer_name),!W.phone&&B.phone&&(W.phone=B.phone),$.set(E,W);const P=B.created_at?new Date(B.created_at):null;if(P&&!Number.isNaN(P.getTime())){const S=`${P.getFullYear()}-${String(P.getMonth()+1).padStart(2,"0")}-${String(P.getDate()).padStart(2,"0")}`,de=te.get(S)||{day:S,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};de.orders+=1,de.quantity+=p,de.revenue+=b,T&&(de.doneOrders+=1,de.doneRevenue+=b),te.set(S,de)}}const ke=Array.from(l.values()).sort((B,t)=>t.revenue-B.revenue),Me=Array.from($.values()).sort((B,t)=>t.revenue-B.revenue),Se=Array.from(te.values()).sort((B,t)=>B.day.localeCompare(t.day)),Ae=$.size,Ee=_e.length?Math.round(Qe/_e.length):0,qe=_e.length?We/_e.length:0,st=Math.round(Ue*.05),Ye=Math.round(Be*.05);return{statusCounts:w,totalQty:We,totalRevenue:Qe,doneRevenue:Xe,tempCommission:st,tempCommissionAll:Ye,products:ke,customers:Me,days:Se,uniqueCustomers:Ae,avgOrderValue:Ee,avgQtyPerOrder:qe}},[_e,a]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:A}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:re,disabled:A},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:a,onChange:w=>o(w.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),J(_e.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),J(oe.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),J(oe.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",J(oe.statusCounts.paid),"/",J(oe.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},J(_e.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},he(oe.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},he(oe.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},he(oe.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (t\u1EA1m t\xEDnh 5% - kh\xF4ng g\u1ED3m ship)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},he(oe.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",oe.avgQtyPerOrder?oe.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},J(oe.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},J(oe.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},J(oe.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},J(oe.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},J(oe.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,J(oe.statusCounts.pending)),React.createElement("td",null,J(oe.statusCounts.processing)),React.createElement("td",null,J(oe.statusCounts.done)),React.createElement("td",null,J(oe.statusCounts.paid)),React.createElement("td",null,J(oe.statusCounts.other)),React.createElement("td",null,J(oe.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},oe.products.slice(0,10).map(w=>React.createElement("div",{key:w.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},w.product_name),React.createElement("div",{className:"text-muted small text-truncate"},w.product_code?`#${w.product_code} \u2022 `:"",J(w.orders)," \u0111\u01A1n \u2022 ",J(w.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},he(w.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,oe.products.slice(0,10).map(w=>React.createElement("tr",{key:w.product_id},React.createElement("td",null,w.product_name),React.createElement("td",null,w.product_code||"\u2014"),React.createElement("td",null,J(w.orders)),React.createElement("td",null,J(w.quantity)),React.createElement("td",{className:"fw-semibold"},he(w.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},oe.customers.slice(0,10).map(w=>React.createElement("div",{key:w.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},w.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},w.phone||"\u2014"," \u2022 ",J(w.orders)," \u0111\u01A1n \u2022 ",J(w.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},he(w.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,oe.customers.slice(0,10).map(w=>React.createElement("tr",{key:w.key},React.createElement("td",null,w.customer_name||"\u2014"),React.createElement("td",null,w.phone||"\u2014"),React.createElement("td",null,J(w.orders)),React.createElement("td",null,J(w.quantity)),React.createElement("td",{className:"fw-semibold"},he(w.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},oe.days.map(w=>React.createElement("div",{key:w.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},w.day),React.createElement("div",{className:"text-muted small"},J(w.orders)," \u0111\u01A1n \u2022 ",J(w.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",J(w.doneOrders)," \u2022 ",he(w.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},he(w.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,oe.days.map(w=>React.createElement("tr",{key:w.day},React.createElement("td",null,w.day),React.createElement("td",null,J(w.orders)),React.createElement("td",null,J(w.quantity)),React.createElement("td",{className:"fw-semibold"},he(w.revenue)),React.createElement("td",null,J(w.doneOrders)),React.createElement("td",{className:"fw-semibold"},he(w.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:v,onMenuChange:a=>{f(a),a==="albums"&&(ce(null),me([]),ee(null))},onLogout:be,currentUser:M}),React.createElement("div",{className:"main-content"},v==="albums"&&!G&&React.createElement(AlbumList,{albums:O,loading:Z,currentFolder:C,breadcrumb:Y,onSelect:ve,onCreate:pe,onEdit:Te,onDelete:Ce,onBack:Ke}),v==="search"&&React.createElement(SearchCenter,{showToast:F,onNavigate:(a,o,A)=>{f(a),a==="orders"&&o==="create"&&(h(Date.now()),H((A==null?void 0:A.productId)||""))}}),v==="albums"&&G&&React.createElement(AlbumDetail,{album:G,parentAlbum:Y.length>0?Y[Y.length-1]:null,onBack:()=>{if(G.parentId){const a=Y.findIndex(o=>o.uuid===G.parentId);a>=0?se(Y[a]):se(null)}else se(null)},onRefresh:()=>ee(C==null?void 0:C.uuid),showToast:F,onNavigateToFolder:a=>{me(o=>[...o,G]),se(a)},onEditSubfolder:a=>{ne(a),U(!0)}}),v==="videos"&&React.createElement(VideoList,{showToast:F}),v==="products"&&React.createElement(ProductManager,{showToast:F}),v==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:q,autoOpenCreateProductId:z,showToast:F}),v==="stats"&&React.createElement(Fe,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${v==="search"?"active":""}`,onClick:a=>{a.preventDefault(),f("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${v==="albums"?"active":""}`,onClick:a=>{a.preventDefault(),f("albums"),se(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${v==="videos"?"active":""}`,onClick:a=>{a.preventDefault(),f("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${v==="products"?"active":""}`,onClick:a=>{a.preventDefault(),f("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${v==="orders"?"active":""}`,onClick:a=>{a.preventDefault(),f("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${v==="stats"?"active":""}`,onClick:a=>{a.preventDefault(),f("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:R,album:X,parentId:C==null?void 0:C.uuid,onClose:()=>U(!1),onSave:ie}),React.createElement("div",{className:"toast-container"},K.map(a=>React.createElement(Toast,{key:a.id,message:a.message,type:a.type,onClose:()=>ue(a.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:y,autoOpenCreateProductId:u,showToast:_}){const[L,M]=useState([]),[r,v]=useState(!0),[f,q]=useState(!1),[h,z]=useState(null),[H,O]=useState(null),[j,G]=useState(""),[se,R]=useState(!1),[U,X]=useState(null),[ne,Z]=useState(!1),[n,K]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[le,C]=useState([""]),[ce,Y]=useState(null),me=useRef({}),[we,be]=useState([]),[F,ue]=useState(null),ee=useRef(null),pe=useRef(null),Te=useRef(0),ie=useRef(new Map),ve=useRef(""),Ke=useRef(null),Ce=useRef(0),Ie=useRef(null),Fe=9,a=150,o=24*60*60*1e3,A=5*60*1e3,ge="ktm_customer_lookup_cache_v1",_e=200,Pe=e=>{K({customer_name:"",phone:"",address:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),C([""]),X(null),Y(null)};useEffect(()=>{const e=i=>{var c;if(ce==null)return;const s=(c=me.current)==null?void 0:c[ce];s&&!s.contains(i.target)&&Y(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ce]);const Le=e=>window.KTM.money.parseMoney(e),Oe=e=>window.KTM.money.parseSignedMoney(e),fe=e=>window.KTM.money.formatVND(e),J=e=>window.KTM.money.parseShipFeeFromNote(e),he=e=>window.KTM.phone.isValid(e),re=e=>window.KTM.phone.normalize(e),oe=()=>{var e;try{const i=localStorage.getItem(ge);if(!i)return;const s=JSON.parse(i);if(!s||typeof s!="object")return;const c=Object.entries(s);for(const[d,x]of c)!d||!x||typeof x!="object"||(e=ie.current)==null||e.set(String(d),x)}catch(i){}},w=()=>{try{const e=ie.current;if(!e||typeof e.entries!="function")return;const i=Array.from(e.entries()).filter(([c,d])=>c&&d&&typeof d=="object"&&Number.isFinite(d.ts)).sort((c,d)=>(Number(d[1].ts)||0)-(Number(c[1].ts)||0)).slice(0,_e),s={};for(const[c,d]of i)s[c]=d;localStorage.setItem(ge,JSON.stringify(s))}catch(e){}};useEffect(()=>{oe()},[]);const We=e=>{const i=re(e);if(!i)return null;const s=Array.isArray(L)?L:[];let c=null,d=-1;for(const x of s){if(!x||re(x.phone||"")!==i)continue;const Q=new Date(x.created_at).getTime(),D=Number.isFinite(Q)?Q:0;D>=d&&(d=D,c=x)}return c?{name:String(c.customer_name||"").trim(),address:String(c.address||"").trim()}:null},Qe=(e,i)=>{e&&K(s=>i&&re(s.phone)!==i?s:{...s,customer_name:e.name||s.customer_name,address:e.address||s.address})},Xe=e=>{const i=We(e);if(!i)return;const s=re(e);K(c=>{if(s&&re(c.phone)!==s)return c;const d={...c};return!String(c.customer_name||"").trim()&&i.name&&(d.customer_name=i.name),!String(c.address||"").trim()&&i.address&&(d.address=i.address),d})},Be=async e=>{var d,x,Q;const i=re(e);if(!i)return;Xe(i);const s=(d=ie.current)==null?void 0:d.get(i);if(s&&Number.isFinite(s.ts)){const D=Date.now()-s.ts,N=s.status==="found"?o:A;if(D>=0&&D<=N){X({status:s.status,phone:i,customer:s.customer}),s.status==="found"&&s.customer&&Qe(s.customer,i);return}}const c=++Te.current;X({status:"loading",phone:i});try{const D=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(i)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(Te.current!==c)return;if(D&&D.exists&&D.customer){(x=ie.current)==null||x.set(i,{ts:Date.now(),status:"found",customer:D.customer}),w(),X({status:"found",phone:i,customer:D.customer}),Qe(D.customer,i);return}(Q=ie.current)==null||Q.set(i,{ts:Date.now(),status:"not-found",customer:null}),w(),X({status:"not-found",phone:i})}catch(D){if(Te.current!==c)return;console.error("Customer lookup error:",D),X({status:"error",phone:i})}},Ue=e=>{const i=re(e),s=We(i);K(d=>{const x={...d,phone:i};return s&&(!String(d.customer_name||"").trim()&&s.name&&(x.customer_name=s.name),!String(d.address||"").trim()&&s.address&&(x.address=s.address)),x}),Z(!1),pe.current&&(clearTimeout(pe.current),pe.current=null);const c=i;if(c.length<Fe){X(null);return}if(he(c)&&c!==ve.current){ve.current=c,Be(c);return}pe.current=setTimeout(()=>{const d=re(i);he(d)&&d!==ve.current&&(ve.current=d,Be(d))},a)},Re=()=>{const e=re(n.phone);e.length<Fe||he(e)&&e!==ve.current&&(ve.current=e,Be(e))};useEffect(()=>(se?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[se]);const He=Array.isArray(n.items)?n.items.length:0;useEffect(()=>{if(!se){Ce.current=He;return}He>Ce.current&&setTimeout(()=>{const e=Ke.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Ce.current=He},[se,He]),useEffect(()=>()=>{pe.current&&(clearTimeout(pe.current),pe.current=null)},[]),useEffect(()=>{Me()},[]),useEffect(()=>{Se()},[j]),useEffect(()=>{y&&ee.current!==y&&(ee.current=y,Ee(u))},[y]);const l=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e||"",$=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":"bg-light text-dark",te=React.useMemo(()=>window.KTM.orders.sortOrders(L),[L]),ke=e=>window.KTM.date.formatDateTime(e),Me=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");be(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),be([])}},Se=async()=>{v(!0);try{let e=`${API_BASE}/api/orders`;j&&(e+=`?month=${j}`);const i=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");M(Array.isArray(i)?i:[])}catch(e){console.error("Load orders error:",e),M([])}finally{v(!1)}},Ae=e=>{var s;ue(e.id);const i=Array.isArray(e.items)&&e.items.length?e.items.map(c=>{var d;return{product_id:(c==null?void 0:c.product_id)||"",quantity:Number((d=c==null?void 0:c.quantity)!=null?d:1)||1}}).filter(c=>c.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];K({customer_name:e.customer_name||"",phone:re(e.phone||""),address:e.address||"",items:i.length?i:[{product_id:"",quantity:1}],adjustment_amount:Number((s=e==null?void 0:e.adjustment_amount)!=null?s:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),C(new Array(i.length?i.length:1).fill("")),X(null),R(!0),e.phone&&Be(re(e.phone))};function Ee(e){ue(null),Pe(e||""),Z(!1),R(!0)}const qe=()=>{f||(R(!1),ue(null),Pe(""),Z(!1))},st=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const i=String(e),s=we.find(c=>String(c==null?void 0:c.id)===i);return s?`${s.name}${s.code?` (${s.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Ye=e=>{const i=String(le[e]||"").trim().toLowerCase();return i?we.filter(s=>{const c=String((s==null?void 0:s.name)||"").toLowerCase(),d=String((s==null?void 0:s.code)||"").toLowerCase();return c.includes(i)||d.includes(i)}):we},Ve=e=>{if(!e)return null;const i=String(e);return we.find(s=>String(s==null?void 0:s.id)===i)||null},B=e=>window.KTM.orders.getOrderItems(e),t=e=>window.KTM.orders.getOrderTotalQty(e),p=e=>window.KTM.orders.getOrderProductSummary(e,Ve),g=e=>window.KTM.orders.getOrderItemRows(e,Ve),k=e=>window.KTM.orders.getOrderAdjustmentMoney(e),I=e=>{var V;const i=B(e),s=g(e),c=T(i),d=m(i),x=d.fee,Q=k(e),D=c+x+Q,N=[];if(N.push(`\u0110\u01A0N H\xC0NG #${(V=e==null?void 0:e.id)!=null?V:""}`.trim()),e!=null&&e.customer_name&&N.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&N.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&N.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),e!=null&&e.status&&N.push(`Tr\u1EA1ng th\xE1i: ${l(e.status)}`),e!=null&&e.created_at&&N.push(`Th\u1EDDi gian: ${ke(e.created_at)}`),N.push(""),N.push("S\u1EA3n ph\u1EA9m:"),s.length)for(const ye of s)N.push(`- ${ye.name} x${ye.qty}`);else{const ye=p(e);ye&&ye!=="\u2014"&&N.push(`- ${ye}`)}return N.push(""),N.push(`T\u1EA1m t\xEDnh: ${fe(c)}`),N.push(`Ship: ${fe(d.found?x:0)}`),Q!==0&&N.push(`\u0110i\u1EC1u ch\u1EC9nh: ${fe(Q)}`),e!=null&&e.adjustment_note&&N.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),N.push(`T\u1ED5ng: ${fe(D)}`),N.filter(Boolean).join(`
`)},b=async e=>{try{const i=I(e);await window.KTM.clipboard.writeText(i),typeof _=="function"?_("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(i){console.error(i),typeof _=="function"?_("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},m=e=>window.KTM.orders.getOrderShipInfo(e,Ve),T=e=>window.KTM.orders.getItemsSubtotal(e,Ve),E=e=>{try{const i=e instanceof Date?e:new Date(e);if(!i||Number.isNaN(i.getTime()))return"";const s=i.getFullYear(),c=String(i.getMonth()+1).padStart(2,"0");return`${s}-${c}`}catch(i){return""}},W=()=>j?String(j):E(new Date),P=e=>{const i=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),s=re((e==null?void 0:e.phone)||""),c=String((e==null?void 0:e.address)||"").trim().toLowerCase(),d=Oe(e==null?void 0:e.adjustment_amount),Q=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(D=>{var N;return{product_id:String((D==null?void 0:D.product_id)||"").trim(),quantity:Number((N=D==null?void 0:D.quantity)!=null?N:0)}}).filter(D=>D.product_id&&Number.isFinite(D.quantity)&&D.quantity>0).sort((D,N)=>D.product_id<N.product_id?-1:D.product_id>N.product_id?1:D.quantity-N.quantity);return JSON.stringify({name:i,phone:s,address:c,items:Q,adj:d})},S=React.useMemo(()=>{const e=re((n==null?void 0:n.phone)||"");if(!e)return{count:0,orders:[],monthKey:W()};const i=W(),s=(Array.isArray(L)?L:[]).filter(c=>{if(!c||F&&String(c.id)===String(F)||re(c.phone||"")!==e)return!1;const d=E(c.created_at);return d&&d===i}).sort((c,d)=>{const x=new Date(c.created_at).getTime(),Q=new Date(d.created_at).getTime();return(Number.isFinite(Q)?Q:0)-(Number.isFinite(x)?x:0)});return{count:s.length,orders:s,monthKey:i}},[L,n==null?void 0:n.phone,j,F]),de=e=>{var D;const i=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),s=re((e==null?void 0:e.phone)||""),c=String((e==null?void 0:e.address)||"").trim().toLowerCase(),d=Oe((D=e==null?void 0:e.adjustment_amount)!=null?D:0),x=B(e),Q=(Array.isArray(x)?x:[]).map(N=>{var V;return{product_id:String((N==null?void 0:N.product_id)||"").trim(),quantity:Number((V=N==null?void 0:N.quantity)!=null?V:0)}}).filter(N=>N.product_id&&Number.isFinite(N.quantity)&&N.quantity>0).sort((N,V)=>N.product_id<V.product_id?-1:N.product_id>V.product_id?1:N.quantity-V.quantity);return JSON.stringify({name:i,phone:s,address:c,items:Q,adj:d})},Ne=React.useMemo(()=>{if(F)return"";const e=re((n==null?void 0:n.phone)||"");if(!e)return"";const i=W(),s=P(n),c=Array.isArray(L)?L:[];for(const d of c){if(!d||F&&String(d.id)===String(F)||re(d.phone||"")!==e)continue;const x=E(d.created_at);if(!x||x!==i)continue;const Q=de(d);if(Q&&Q===s)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${i}${d!=null&&d.id?` (#${d.id})`:""}`}return""},[L,n,j,F]),je=e=>{var lt;const i=[],s=[],c=String((e==null?void 0:e.customer_name)||"").trim(),d=re((e==null?void 0:e.phone)||""),x=String((e==null?void 0:e.address)||"").trim();c||i.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),d||i.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),d&&!he(d)&&i.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),x||s.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const D=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(Ge=>Ge&&Ge.product_id);D.length===0&&i.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),D.some(Ge=>{var ct;const tt=Number((ct=Ge==null?void 0:Ge.quantity)!=null?ct:0);return!Number.isFinite(tt)||tt<=0})&&i.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const V=new Set;let ye=!1;for(const Ge of D){const tt=String(Ge.product_id||"").trim();if(tt){if(V.has(tt)){ye=!0;break}V.add(tt)}}ye&&s.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const $e=T(D),xe=m(D),it=xe!=null&&xe.found?Number((lt=xe==null?void 0:xe.fee)!=null?lt:0):0,nt=Oe(e==null?void 0:e.adjustment_amount),dt=String((e==null?void 0:e.adjustment_note)||"").trim();xe!=null&&xe.found&&(it>=2e5||$e>0&&it>$e*.6)&&s.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${fe(it)}`),nt!==0&&!dt&&s.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const ot=Math.abs(nt);return(ot>=5e5||$e>0&&ot>$e*.5)&&nt!==0&&s.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${fe(nt)}`),{errors:i,warnings:s,canSubmit:i.length===0}},Je=React.useMemo(()=>je(n),[n,we]),ae=React.useMemo(()=>{var ct;const e=String((n==null?void 0:n.customer_name)||"").trim(),i=re((n==null?void 0:n.phone)||""),s=String((n==null?void 0:n.address)||"").trim(),c=Array.isArray(n==null?void 0:n.items)?n.items:[],d=new Map;for(const De of c){const at=String((De==null?void 0:De.product_id)||"").trim();at&&d.set(at,(d.get(at)||0)+1)}const x=c.map(De=>{var ut;const at=String((De==null?void 0:De.product_id)||"").trim(),mt=Number((ut=De==null?void 0:De.quantity)!=null?ut:0),pt=at?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",ht=Number.isFinite(mt)&&mt>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",bt=at&&(d.get(at)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:pt,qtyError:ht,dupWarn:bt}}),Q=c.filter(De=>De&&De.product_id),D=T(Q),N=m(Q),V=N!=null&&N.found?Number((ct=N==null?void 0:N.fee)!=null?ct:0):0,ye=Oe(n==null?void 0:n.adjustment_amount),$e=String((n==null?void 0:n.adjustment_note)||"").trim(),xe=Math.abs(ye),it=ye!==0&&!$e?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",nt=ye!==0&&(xe>=5e5||D>0&&xe>D*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${fe(ye)}`:"",dt=N!=null&&N.found&&(V>=2e5||D>0&&V>D*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${fe(V)}`:"",ot=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",lt=i?he(i)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",Ge=s?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",tt=!ot&&!lt&&x.every(De=>!De.productError&&!De.qtyError);return{nameError:ot,phoneError:lt,addressWarn:Ge,items:x,shipAbnormalWarn:dt,adjustmentNoteWarn:it,adjustmentAbnormalWarn:nt,canSubmit:tt}},[n,we]),ze=async e=>{var Q,D,N;const i=(e==null?void 0:e.mode)||"close",s=je(n);if(!s.canSubmit){const V=s.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof _=="function"?_(V,"danger"):alert(V);return}if(!F&&Ne){const V=`${Ne}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(V)){(S==null?void 0:S.count)>0&&Z(!0),setTimeout(()=>{var xe;const $e=document.getElementById("order-phone-input");$e&&typeof $e.scrollIntoView=="function"&&($e.scrollIntoView({block:"center",behavior:"smooth"}),(xe=$e.focus)==null||xe.call($e))},0);return}}const c=re(n.phone),x=(Array.isArray(n.items)?n.items:[]).map(V=>{var ye;return{product_id:(V==null?void 0:V.product_id)||"",quantity:Number((ye=V==null?void 0:V.quantity)!=null?ye:1)}}).filter(V=>V.product_id&&Number.isFinite(V.quantity)&&V.quantity>0);q(!0);try{const V=F?`${API_BASE}/api/orders/${F}`:`${API_BASE}/api/orders`,ye=x[0],$e={customer_name:n.customer_name,phone:c,address:n.address,adjustment_amount:Oe(n.adjustment_amount),adjustment_note:(n.adjustment_note||"").trim(),product_id:ye.product_id,quantity:ye.quantity,status:n.status,items:x,...F?{id:F}:{}};if(F)await window.KTM.api.putJSON(V,$e,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const xe=await window.KTM.api.postJSON(V,$e,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Ie.current={id:(N=(D=xe==null?void 0:xe.id)!=null?D:(Q=xe==null?void 0:xe.order)==null?void 0:Q.id)!=null?N:null,fingerprint:P(n),ts:Date.now()}}i==="new"&&!F?(Pe(""),ue(null),R(!0)):(Pe(""),ue(null),R(!1)),Se()}catch(V){console.error(V),typeof _=="function"?_(V.message,"danger"):alert(V.message);return}finally{q(!1)}},Ze=e=>window.KTM.orders.getOrderTotalMoney(e,Ve),rt=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){z(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),Se()}catch(i){console.error(i),typeof _=="function"?_(i.message,"danger"):alert(i.message)}finally{z(null)}}},et=async(e,i)=>{var c;const s=e==null?void 0:e.id;if(!(!s||!i)){O(s);try{const d=B(e),x=(Array.isArray(d)?d:[]).map(N=>{var V;return{product_id:(N==null?void 0:N.product_id)||"",quantity:Number((V=N==null?void 0:N.quantity)!=null?V:1)}}).filter(N=>N.product_id&&Number.isFinite(N.quantity)&&N.quantity>0);if(!x.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const Q=x[0],D={id:s,customer_name:(e==null?void 0:e.customer_name)||"",phone:re((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",adjustment_amount:Number((c=e==null?void 0:e.adjustment_amount)!=null?c:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:Q.product_id,quantity:Q.quantity,status:i,items:x};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${s}`,D,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),M(N=>Array.isArray(N)?N.map(V=>(V==null?void 0:V.id)===s?{...V,status:i}:V):N),typeof _=="function"&&_("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(d){console.error(d),typeof _=="function"?_(d.message,"danger"):alert(d.message)}finally{O(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:r&&!se||f||!!h||!!H}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Ee,disabled:f||!!h},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:j,onChange:e=>G(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}),j&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{G("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:r},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:Se,disabled:r},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},L.length," \u0111\u01A1n")),r?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):L.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},te.map(e=>React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"text-muted small"},e.phone),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address)),React.createElement("span",{className:`badge ${$(e.status)}`},l(e.status))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const i=g(e);return i.length?React.createElement("div",{className:"mt-1"},i.map((s,c)=>React.createElement("div",{key:c,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},s.name),React.createElement("div",{className:"text-muted",style:{flexShrink:0}},"x",s.qty)))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},p(e))})()),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"S\u1ED1 l\u01B0\u1EE3ng:")," ",React.createElement("span",{className:"fw-semibold"},t(e))),(k(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},fe(k(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n:")," ",React.createElement("span",{className:"fw-semibold"},fe(Ze(e)))),React.createElement("div",null,React.createElement("span",{className:"text-muted"},"Th\u1EDDi gian:")," ",ke(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>Ae(e),disabled:f||!!h||H===e.id},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>b(e),disabled:f||!!h||H===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>rt(e.id),disabled:f||h===e.id||H===e.id},h===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>et(e,"processing"),disabled:f||!!h||H===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>et(e,"done"),disabled:f||!!h||H===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>et(e,"paid"),disabled:f||!!h||H===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid")))))),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,te.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,p(e)),React.createElement("td",null,t(e)),React.createElement("td",{className:"fw-semibold"},fe(Ze(e))),React.createElement("td",null,React.createElement("span",{className:`badge ${$(e.status)}`},l(e.status))),React.createElement("td",null,ke(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>Ae(e),disabled:f||!!h||H===e.id},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>b(e),disabled:f||!!h||H===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>et(e,"processing"),disabled:f||!!h||H===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>et(e,"done"),disabled:f||!!h||H===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>et(e,"paid"),disabled:f||!!h||H===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>rt(e.id),disabled:f||h===e.id},h===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),se&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),F?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:qe})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),ze({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:Ke},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:n.customer_name,onChange:e=>K({...n,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!ae.nameError&&React.createElement("div",{className:"form-text text-danger"},ae.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:n.phone,onChange:e=>Ue(e.target.value),onBlur:Re,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!ae.phoneError&&React.createElement("div",{className:"form-text text-danger"},ae.phoneError),!ae.phoneError&&S.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",S.count," \u0111\u01A1n trong th\xE1ng ",S.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Z(e=>!e)},ne?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),ne&&S.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Z(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},S.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${$(e.status)}`},l(e.status))),React.createElement("div",{className:"text-muted small"},ke(e.created_at)," \u2022 ",fe(Ze(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},p(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Ae(e)}},"M\u1EDF")))),S.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(U==null?void 0:U.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(U==null?void 0:U.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(U==null?void 0:U.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(U==null?void 0:U.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:n.status,onChange:e=>K({...n,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:n.address,onChange:e=>K({...n,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!ae.addressWarn&&React.createElement("div",{className:"form-text text-warning"},ae.addressWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:n.adjustment_amount,onChange:e=>K({...n,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!ae.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},ae.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:n.adjustment_note,onChange:e=>K({...n,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!ae.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},ae.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{K(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),C(e=>[...Array.isArray(e)?e:[],""])},disabled:f},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(n.items)?n.items:[{product_id:"",quantity:1}]).map((e,i)=>React.createElement("div",{key:i,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:s=>{me.current[i]=s}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Y(s=>s===i?null:i),setTimeout(()=>{const s=document.getElementById(`order-product-search-${i}`);s&&s.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},st(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),ce===i&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${i}`,className:"form-control",value:le[i]||"",onChange:s=>{const c=s.target.value;C(d=>{const x=Array.isArray(d)?[...d]:[];return x[i]=c,x})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),Ye(i).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):Ye(i).map(s=>React.createElement("button",{key:s.id,type:"button",className:"dropdown-item",onClick:()=>{const c=String(s.id);K(d=>{const x=Array.isArray(d.items)?[...d.items]:[];return x[i]={...x[i]||{quantity:1},product_id:c},{...d,items:x}}),Y(null)}},s.name,s.code?` (${s.code})`:""))),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),we.map(s=>React.createElement("option",{key:s.id,value:s.id},s.name)))),(()=>{var c;const s=(c=ae.items)==null?void 0:c[i];return s?React.createElement(React.Fragment,null,!!s.productError&&React.createElement("div",{className:"form-text text-danger"},s.productError),!!s.dupWarn&&React.createElement("div",{className:"form-text text-warning"},s.dupWarn)):null})()),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:s=>{const c=s.target.value;K(d=>{const x=Array.isArray(d.items)?[...d.items]:[];return x[i]={...x[i]||{product_id:""},quantity:c},{...d,items:x}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var c;const s=(c=ae.items)==null?void 0:c[i];return s&&s.qtyError?React.createElement("div",{className:"form-text text-danger"},s.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{K(s=>{const c=Array.isArray(s.items)?[...s.items]:[];return c.splice(i,1),{...s,items:c.length?c:[{product_id:"",quantity:1}]}}),C(s=>{const c=Array.isArray(s)?[...s]:[];return c.splice(i,1),c.length?c:[""]}),Y(s=>s==null?s:s===i?null:s>i?s-1:s)},disabled:f||(Array.isArray(n.items)?n.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const i=(Array.isArray(n.items)?n.items:[]).filter(Q=>Q==null?void 0:Q.product_id),s=T(i),c=m(i),d=Oe(n.adjustment_amount),x=s+(c.found?c.fee:0)+d;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},fe(s))),c.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},fe(c.fee))),!!ae.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},ae.shipAbnormalWarn),d!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},fe(d))),(n.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(n.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},fe(x)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:qe,disabled:f,style:{borderRadius:10}},"H\u1EE7y"),!F&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>ze({mode:"new"}),disabled:f||!ae.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:f||!ae.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},f?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

