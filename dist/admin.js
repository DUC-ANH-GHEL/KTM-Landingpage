const{useState,useEffect,useRef}=React,CLOUDINARY_CLOUD_NAME="diwxfpt92",CLOUDINARY_UPLOAD_PRESET="ktm_unsigned",API_BASE="";function LoginPage({onLogin:r,error:c}){const[p,M]=useState(""),[I,d]=useState(""),[C,P]=useState(!1),[F,S]=useState(!1);return React.createElement("div",{className:"login-page"},React.createElement("div",{className:"login-box"},React.createElement("div",{className:"text-center mb-4"},React.createElement("i",{className:"fas fa-tractor fa-3x text-warning mb-3"}),React.createElement("h4",{className:"text-dark"},"KTM Admin"),React.createElement("p",{className:"text-muted small"},"\u0110\u0103ng nh\u1EADp \u0111\u1EC3 qu\u1EA3n l\xFD")),c&&React.createElement("div",{className:"alert alert-danger py-2 small"},React.createElement("i",{className:"fas fa-exclamation-circle me-2"}),c),React.createElement("form",{onSubmit:async L=>{L.preventDefault(),P(!0),await r(p,I),P(!1)}},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small"},"T\xEAn \u0111\u0103ng nh\u1EADp"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-user"})),React.createElement("input",{type:"text",className:"form-control",value:p,onChange:L=>M(L.target.value),placeholder:"admin",required:!0,autoFocus:!0}))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"form-label small"},"M\u1EADt kh\u1EA9u"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-lock"})),React.createElement("input",{type:F?"text":"password",className:"form-control",value:I,onChange:L=>d(L.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>S(!F)},React.createElement("i",{className:`fas fa-eye${F?"-slash":""}`})))),React.createElement("button",{type:"submit",className:"btn btn-warning w-100",disabled:C},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang \u0111\u0103ng nh\u1EADp..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sign-in-alt me-2"}),"\u0110\u0103ng nh\u1EADp"))),React.createElement("div",{className:"text-center mt-4"},React.createElement("a",{href:"/",className:"text-muted small text-decoration-none"},React.createElement("i",{className:"fas fa-arrow-left me-1"}),"V\u1EC1 trang ch\u1EE7"))))}function Toast({message:r,type:c,onClose:p}){return useEffect(()=>{const M=setTimeout(p,3e3);return()=>clearTimeout(M)},[]),React.createElement("div",{className:`toast show align-items-center text-white bg-${c} border-0`,role:"alert"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"toast-body"},r),React.createElement("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:p})))}function Loading({show:r}){return r?React.createElement("div",{className:"loading-overlay"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"3rem",height:"3rem"}},React.createElement("span",{className:"visually-hidden"},"\u0110ang t\u1EA3i..."))):null}function Sidebar({activeMenu:r,onMenuChange:c,onLogout:p,currentUser:M}){return React.createElement("div",{className:"sidebar d-none d-md-block"},React.createElement("div",{className:"logo"},React.createElement("i",{className:"fas fa-tractor me-2"})," KTM Admin"),React.createElement("nav",{className:"nav flex-column mt-3"},[{id:"search",icon:"fa-search",label:"Tra c\u1EE9u nhanh",highlight:!0},{id:"albums",icon:"fa-images",label:"Qu\u1EA3n l\xFD Album"},{id:"videos",icon:"fa-video",label:"Qu\u1EA3n l\xFD Video"},{id:"products",icon:"fa-box",label:"S\u1EA3n ph\u1EA9m"},{id:"orders",icon:"fa-receipt",label:"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"},{id:"stats",icon:"fa-chart-column",label:"Th\u1ED1ng k\xEA"},{id:"settings",icon:"fa-cog",label:"C\xE0i \u0111\u1EB7t"}].map(d=>React.createElement("a",{key:d.id,href:"#",className:`nav-link ${r===d.id?"active":""} ${d.disabled?"opacity-50":""} ${d.highlight?"text-warning":""}`,onClick:C=>{C.preventDefault(),d.disabled||c(d.id)}},React.createElement("i",{className:`fas ${d.icon}`})," ",d.label,d.disabled&&React.createElement("span",{className:"badge bg-secondary ms-2"},"Soon"),d.highlight&&React.createElement("span",{className:"badge bg-warning text-dark ms-2"},"HOT")))),React.createElement("div",{className:"position-absolute bottom-0 w-100 p-3 border-top border-secondary"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("a",{href:"/",className:"text-white-50 text-decoration-none small"},React.createElement("i",{className:"fas fa-home me-1"})," Trang ch\u1EE7"),p&&React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:p,title:"\u0110\u0103ng xu\u1EA5t"},React.createElement("i",{className:"fas fa-sign-out-alt"})))))}const ADMIN_SETTINGS_STORAGE_KEY="ktm_admin_settings_v1",DEFAULT_SHIP_PERCENT=1.64;function normalizeShipPercent(r){const c=typeof r=="number"?r:parseFloat(String(r!=null?r:"").trim());return Number.isFinite(c)?Math.max(0,Math.min(100,c)):DEFAULT_SHIP_PERCENT}function loadAdminSettings(){var r;try{const c=localStorage.getItem(ADMIN_SETTINGS_STORAGE_KEY);if(!c)return{ship_percent:DEFAULT_SHIP_PERCENT};const p=JSON.parse(c);return{ship_percent:normalizeShipPercent((r=p==null?void 0:p.ship_percent)!=null?r:p==null?void 0:p.shipPercent)}}catch(c){return{ship_percent:DEFAULT_SHIP_PERCENT}}}function saveAdminSettings(r){var c;try{const p={ship_percent:normalizeShipPercent((c=r==null?void 0:r.ship_percent)!=null?c:r==null?void 0:r.shipPercent)};return localStorage.setItem(ADMIN_SETTINGS_STORAGE_KEY,JSON.stringify(p)),p}catch(p){return{ship_percent:DEFAULT_SHIP_PERCENT}}}async function fetchAdminSettingsFromServer(){var c;const r=await window.KTM.api.getJSON(`${API_BASE}/api/settings`,"Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t t\u1EEB DB");return{ship_percent:normalizeShipPercent((c=r==null?void 0:r.ship_percent)!=null?c:r==null?void 0:r.shipPercent)}}async function saveAdminSettingsToServer(r){var M,I,d;const c={ship_percent:normalizeShipPercent((M=r==null?void 0:r.ship_percent)!=null?M:r==null?void 0:r.shipPercent)},p=await window.KTM.api.putJSON(`${API_BASE}/api/settings`,c,"Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c c\xE0i \u0111\u1EB7t v\xE0o DB");return{ship_percent:normalizeShipPercent((d=(I=p==null?void 0:p.ship_percent)!=null?I:p==null?void 0:p.shipPercent)!=null?d:c.ship_percent)}}function AlbumList({albums:r,onSelect:c,onCreate:p,onEdit:M,onDelete:I,loading:d,currentFolder:C,onBack:P,breadcrumb:F}){return React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},C&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:P},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),C?C.title:"Th\u01B0 vi\u1EC7n \u1EA3nh")),React.createElement("button",{className:"btn btn-warning",onClick:p},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder")),F&&F.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:S=>{S.preventDefault(),P("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),F.map((S,Q)=>React.createElement("li",{key:S.id,className:`breadcrumb-item ${Q===F.length-1?"active":""}`},Q===F.length-1?S.title:React.createElement("a",{href:"#",onClick:L=>{L.preventDefault(),P(S)},className:"text-warning"},S.title))))),d?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):r.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},C?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder n\xE0o. H\xE3y t\u1EA1o folder \u0111\u1EA7u ti\xEAn!")):React.createElement("div",{className:"row g-3"},r.map(S=>React.createElement("div",{key:S.uuid||S.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card album-card h-100",onClick:()=>c(S)},S.cover?React.createElement("img",{src:S.cover,className:"album-cover",alt:S.title}):React.createElement("div",{className:"card-body text-center py-4"},React.createElement("i",{className:"fas fa-folder fa-3x text-warning mb-2"})),React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"card-title mb-1"},S.title),React.createElement("small",{className:"text-muted"},S.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),S.subfolderCount),S.subfolderCount>0&&S.count>0&&" \u2022 ",S.count>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-image me-1"}),S.count),S.subfolderCount===0&&S.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:Q=>{Q.stopPropagation(),M(S)},title:"S\u1EEDa album"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:Q=>{Q.stopPropagation(),I(S)},title:"X\xF3a album"},React.createElement("i",{className:"fas fa-trash"}))))))))}function AlbumModal({show:r,album:c,onClose:p,onSave:M,parentId:I}){const[d,C]=useState({slug:"",title:"",description:"",cover_url:"",parent_id:null}),[P,F]=useState(!1),[S,Q]=useState(!1),L=useRef(null);useEffect(()=>{C(c?{slug:c.id||"",title:c.title||"",description:c.description||"",cover_url:c.cover||"",parent_id:c.parentId||null}:{slug:"",title:"",description:"",cover_url:"",parent_id:I||null})},[c,r,I]);const K=async J=>{J.preventDefault(),F(!0),await M(d),F(!1)},$=J=>J.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Z=async J=>{const le=J.type==="image/heic"||J.type==="image/heif"||/\.heic$/i.test(J.name);if(J.size<=2097152&&!le)return J;try{const ae=await createImageBitmap(J),he=document.createElement("canvas");let ue=ae.width,b=ae.height;const U=800;return(ue>U||b>U)&&(ue>b?(b=Math.round(b/ue*U),ue=U):(ue=Math.round(ue/b*U),b=U)),he.width=ue,he.height=b,he.getContext("2d").drawImage(ae,0,0,ue,b),ae.close(),new Promise((ce,z)=>{he.toBlob(se=>{se?ce(new File([se],J.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):z(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(ae){throw console.error("Compress cover error:",ae),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ee=async J=>{var ae;const X=J.target.files[0];if(!X)return;if(!(X.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(X.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Q(!0);try{const he=await Z(X),ue=await window.KTM.cloudinary.uploadImage({file:he,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-albums/covers"});if(!ue.secure_url)throw console.error("Cloudinary error:",ue),new Error(((ae=ue.error)==null?void 0:ae.message)||"Upload failed");C(b=>({...b,cover_url:ue.secure_url}))}catch(he){console.error("Cover upload error:",he),alert("L\u1ED7i upload \u1EA3nh b\xECa: "+he.message)}Q(!1),J.target.value=""};return r?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa":"T\u1EA1o"," Folder"),React.createElement("button",{type:"button",className:"btn-close",onClick:p})),React.createElement("form",{onSubmit:K},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn Folder *"),React.createElement("input",{type:"text",className:"form-control",value:d.title,onChange:J=>C({...d,title:J.target.value,slug:d.slug||$(J.target.value)}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Slug (URL) *"),React.createElement("input",{type:"text",className:"form-control",value:d.slug,onChange:J=>C({...d,slug:J.target.value}),required:!0,disabled:!!c}),React.createElement("small",{className:"text-muted"},"VD: may-cay-kubota-l1501")),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",rows:"2",value:d.description,onChange:J=>C({...d,description:J.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex gap-2 align-items-start"},d.cover_url&&React.createElement("div",{className:"position-relative",style:{width:80,height:80}},React.createElement("img",{src:d.cover_url,alt:"Cover",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 6px",fontSize:10},onClick:()=>C(J=>({...J,cover_url:""}))},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{ref:L,type:"file",accept:"image/*",className:"d-none",onChange:ee}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100 mb-2",onClick:()=>{var J;return(J=L.current)==null?void 0:J.click()},disabled:S},S?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh b\xECa")),React.createElement("input",{type:"url",className:"form-control form-control-sm",value:d.cover_url,onChange:J=>C({...d,cover_url:J.target.value}),placeholder:"Ho\u1EB7c d\xE1n URL \u1EA3nh..."}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:p},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:P||S},P?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function FolderTreeItem({folder:r,allAlbums:c,currentAlbumId:p,targetAlbum:M,onSelect:I,level:d=0}){const[C,P]=useState(!0),F=r.uuid||r.id,S=F===p,Q=M===F,L=c.filter($=>$.parentId===F),K=L.length>0;return React.createElement("div",{style:{marginLeft:d*16+"px"}},React.createElement("div",{className:`d-flex align-items-center p-2 rounded mb-1 ${Q?"bg-info text-white":S?"bg-light text-muted":"hover-bg"}`,style:{cursor:S?"not-allowed":"pointer",opacity:S?.5:1,transition:"background 0.2s"},onClick:()=>!S&&I(F)},K&&React.createElement("i",{className:`fas fa-chevron-${C?"down":"right"} me-2`,style:{fontSize:"10px",width:"12px",cursor:"pointer"},onClick:$=>{$.stopPropagation(),P(!C)}}),!K&&React.createElement("span",{style:{width:"20px"}}),React.createElement("i",{className:`fas fa-folder${Q?"-open":""} me-2 ${Q?"":"text-warning"}`}),React.createElement("span",{className:"small"},r.title),S&&React.createElement("span",{className:"ms-2 badge bg-secondary",style:{fontSize:"9px"}},"Hi\u1EC7n t\u1EA1i"),r.count>0&&!S&&React.createElement("span",{className:"ms-auto badge bg-light text-muted",style:{fontSize:"10px"}},r.count)),C&&K&&React.createElement("div",null,L.map($=>React.createElement(FolderTreeItem,{key:$.uuid||$.id,folder:$,allAlbums:c,currentAlbumId:p,targetAlbum:M,onSelect:I,level:d+1}))))}function AlbumDetail({album:r,onBack:c,onRefresh:p,showToast:M,onNavigateToFolder:I,onEditSubfolder:d,parentAlbum:C}){const[P,F]=useState([]),[S,Q]=useState([]),[L,K]=useState(!0),[$,Z]=useState(!1),[ee,J]=useState(""),[X,le]=useState([]),[ae,he]=useState([]),[ue,b]=useState({}),[U,k]=useState(null),[ce,z]=useState(!1),[se,fe]=useState(""),[ve,Se]=useState(!1),Te=useRef(null),G=useRef(null),[m,re]=useState(!1),[Ne,Ie]=useState([]),[He,Me]=useState([]),[Ve,Be]=useState(""),[i,l]=useState(!1),be=async(n,j=2)=>{const ie=j*1024*1024,pe=n.type==="image/heic"||n.type==="image/heif"||/\.heic$/i.test(n.name);if(n.size<=ie&&!pe)return n;try{const Pe=await createImageBitmap(n),Ae=document.createElement("canvas");let de=Pe.width,Ye=Pe.height;const ze=1200;return(de>ze||Ye>ze)&&(de>Ye?(Ye=Math.round(Ye/de*ze),de=ze):(de=Math.round(de/Ye*ze),Ye=ze)),Ae.width=de,Ae.height=Ye,Ae.getContext("2d").drawImage(Pe,0,0,de,Ye),Pe.close(),new Promise((nt,it)=>{Ae.toBlob(Je=>{Je?nt(new File([Je],n.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):it(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(Pe){throw console.error("Compress error:",Pe),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh")}};useEffect(()=>{h(),A()},[r.id,r.uuid]);const h=async()=>{K(!0);try{const n=await window.KTM.api.getJSON(`${API_BASE}/api/albums/${r.uuid||r.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");F(n.images||[]);const j=await window.KTM.api.getJSON(`${API_BASE}/api/albums?parent_id=${r.uuid||r.id}`,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");Q(Array.isArray(j)?j:[])}catch(n){console.error(n),M("L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u","danger")}K(!1)},A=async()=>{try{const n=await window.KTM.api.getJSON(`${API_BASE}/api/albums`,"L\u1ED7i t\u1EA3i album");Me(Array.isArray(n)?n:[])}catch(n){console.error("Error loading albums:",n)}},B=n=>{Ie(j=>j.includes(n)?j.filter(ie=>ie!==n):[...j,n])},we=async()=>{if(!Ve||Ne.length===0){M("Vui l\xF2ng ch\u1ECDn folder \u0111\xEDch","warning");return}l(!0);let n=0;for(const j of Ne)try{await window.KTM.api.putJSON(`${API_BASE}/api/images/${j}`,{album_id:Ve},"L\u1ED7i di chuy\u1EC3n \u1EA3nh"),n++}catch(ie){console.error("Move error:",ie)}l(!1),re(!1),Ie([]),Be(""),n>0?(M("\u0110\xE3 di chuy\u1EC3n \u1EA3nh th\xE0nh c\xF4ng!","success"),h(),p()):M("Di chuy\u1EC3n th\u1EA5t b\u1EA1i","danger")},[_e,Le]=useState(!1),Ce=async()=>{if(Ne.length===0||!confirm(`X\xF3a ${Ne.length} \u1EA3nh \u0111\xE3 ch\u1ECDn? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c!`))return;Le(!0);let n=0;for(const j of Ne)try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${j}`,"L\u1ED7i x\xF3a \u1EA3nh"),n++}catch(ie){console.error("Delete error:",ie)}Le(!1),Ie([]),n>0?(M(`\u0110\xE3 x\xF3a ${n} \u1EA3nh!`,"success"),h(),p()):M("X\xF3a th\u1EA5t b\u1EA1i","danger")},Re=()=>{Ne.length===P.length?Ie([]):Ie(P.map(n=>n.id))},st=async()=>{if(se.trim()){Se(!0);try{const n=se.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await window.KTM.api.postJSON(`${API_BASE}/api/albums`,{slug:n+"-"+Date.now(),title:se,parent_id:r.uuid||r.id},"L\u1ED7i t\u1EA1o folder"),M("T\u1EA1o folder th\xE0nh c\xF4ng!","success"),fe(""),z(!1),h(),p()}catch(n){M(n.message,"danger")}Se(!1)}},gt=async n=>{if(confirm(`X\xF3a folder "${n.title}"? T\u1EA5t c\u1EA3 n\u1ED9i dung b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${n.uuid||n.id}`,"L\u1ED7i x\xF3a folder"),M("\u0110\xE3 x\xF3a folder","success"),h(),p()}catch(j){M("L\u1ED7i x\xF3a folder","danger")}},ft=n=>{const j=Array.from(n).filter(ie=>ie.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ie.name));le(ie=>[...ie,...j]),j.forEach(ie=>{const pe=new FileReader;pe.onload=Pe=>{he(Ae=>[...Ae,{file:ie,preview:Pe.target.result}])},pe.readAsDataURL(ie)})},vt=n=>{le(j=>j.filter((ie,pe)=>pe!==n)),he(j=>j.filter((ie,pe)=>pe!==n))},ne=async n=>{var ie;const j=await window.KTM.cloudinary.uploadImage({file:n,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:`ktm-albums/${r.id}`});if(!j.secure_url)throw console.error("Cloudinary error:",j),new Error(((ie=j.error)==null?void 0:ie.message)||"Upload failed");return j},je=async()=>{if(X.length===0)return;Z(!0);let n=0;for(let j=0;j<X.length;j++)try{J(`\u0110ang x\u1EED l\xFD ${j+1}/${X.length}...`);const ie=await be(X[j],2);J(`\u0110ang upload ${j+1}/${X.length}...`);const pe=await ne(ie);await window.KTM.api.postJSON(`${API_BASE}/api/albums/${r.id}`,{url:pe.secure_url,caption:ue[j]||X[j].name.replace(/\.[^/.]+$/,""),sort_order:P.length+j},"L\u1ED7i l\u01B0u \u1EA3nh"),n++}catch(ie){console.error("Upload error:",ie)}Z(!1),J(""),le([]),he([]),b({}),n>0?(M(`\u0110\xE3 upload ${n} \u1EA3nh th\xE0nh c\xF4ng!`,"success"),h(),p()):M("Upload th\u1EA5t b\u1EA1i","danger")},tt=async(n,j)=>{if(confirm("X\xF3a \u1EA3nh n\xE0y?"))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/images/${n}`,"L\u1ED7i x\xF3a \u1EA3nh"),M("\u0110\xE3 x\xF3a \u1EA3nh","success"),h(),p()}catch(ie){M("L\u1ED7i x\xF3a \u1EA3nh","danger")}},oe=n=>{var j;n.preventDefault(),(j=G.current)==null||j.classList.add("dragover")},x=()=>{var n;(n=G.current)==null||n.classList.remove("dragover")},Fe=n=>{var j;n.preventDefault(),(j=G.current)==null||j.classList.remove("dragover"),ft(n.dataTransfer.files)};return React.createElement("div",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:c},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("h4",{className:"m-0"},r.title),React.createElement("small",{className:"text-muted"},S.length>0&&React.createElement("span",null,S.length," folder \u2022 "),P.length," \u1EA3nh"))),React.createElement("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>z(!0)},React.createElement("i",{className:"fas fa-folder-plus me-1"}),"T\u1EA1o Folder con")),ce&&React.createElement("div",{className:"card mb-4 border-warning"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder-plus me-2 text-warning"}),"T\u1EA1o folder con"),React.createElement("div",{className:"d-flex gap-2"},React.createElement("input",{type:"text",className:"form-control",placeholder:"T\xEAn folder...",value:se,onChange:n=>fe(n.target.value),onKeyPress:n=>n.key==="Enter"&&st(),autoFocus:!0}),React.createElement("button",{className:"btn btn-warning",onClick:st,disabled:ve||!se.trim()},ve?React.createElement("span",{className:"spinner-border spinner-border-sm"}):"T\u1EA1o"),React.createElement("button",{className:"btn btn-secondary",onClick:()=>{z(!1),fe("")}},"H\u1EE7y")))),S.length>0&&React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-folder me-2 text-warning"}),"Folder con"),React.createElement("div",{className:"row g-2"},S.map(n=>React.createElement("div",{key:n.uuid||n.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-item",style:{cursor:"pointer"},onClick:()=>I&&I(n)},React.createElement("div",{className:"card-body text-center py-3"},React.createElement("i",{className:"fas fa-folder fa-2x text-warning mb-2"}),React.createElement("div",{className:"small fw-bold text-truncate"},n.title),React.createElement("small",{className:"text-muted"},n.subfolderCount>0&&React.createElement("span",null,n.subfolderCount," folder"),n.subfolderCount>0&&n.count>0&&" \u2022 ",n.count>0&&React.createElement("span",null,n.count," \u1EA3nh"),n.subfolderCount===0&&n.count===0&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0 text-center"},React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:j=>{j.stopPropagation(),d&&d(n)},title:"S\u1EEDa folder"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:j=>{j.stopPropagation(),gt(n)},title:"X\xF3a folder"},React.createElement("i",{className:"fas fa-trash"}))))))))),React.createElement("div",{className:"card mb-4"},React.createElement("div",{className:"card-body"},React.createElement("h6",{className:"mb-3"},React.createElement("i",{className:"fas fa-cloud-upload-alt me-2"}),"Upload \u1EA3nh m\u1EDBi"),React.createElement("div",{ref:G,className:"upload-zone",onClick:()=>{var n;return(n=Te.current)==null?void 0:n.click()},onDragOver:oe,onDragLeave:x,onDrop:Fe},React.createElement("i",{className:"fas fa-images fa-2x text-muted mb-2"}),React.createElement("p",{className:"mb-0"},"K\xE9o th\u1EA3 \u1EA3nh v\xE0o \u0111\xE2y ho\u1EB7c click \u0111\u1EC3 ch\u1ECDn"),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3 JPG, PNG, WebP"),React.createElement("input",{ref:Te,type:"file",multiple:!0,accept:"image/*",onChange:n=>ft(n.target.files)})),ae.length>0&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"upload-preview"},ae.map((n,j)=>React.createElement("div",{key:j,className:"upload-preview-item"},React.createElement("img",{src:n.preview,alt:""}),React.createElement("button",{className:"remove",onClick:()=>vt(j)},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"mt-3"},React.createElement("button",{className:"btn btn-warning",onClick:je,disabled:$},$?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),ee||"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload ",X.length," \u1EA3nh")))))),React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"},React.createElement("div",{className:"d-flex align-items-center gap-2"},React.createElement("h6",{className:"m-0"},React.createElement("i",{className:"fas fa-th me-2"}),"\u1EA2nh (",P.length,")"),P.length>0&&React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:Re},Ne.length===P.length?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3")),Ne.length>0&&React.createElement("div",{className:"d-flex align-items-center gap-2 flex-wrap"},React.createElement("span",{className:"badge bg-primary"},Ne.length," \u0111\xE3 ch\u1ECDn"),React.createElement("button",{className:"btn btn-sm btn-info",onClick:()=>re(!0)},React.createElement("i",{className:"fas fa-folder-open me-1"}),"Di chuy\u1EC3n"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:Ce,disabled:_e},_e?React.createElement("span",{className:"spinner-border spinner-border-sm"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-trash me-1"}),"X\xF3a")),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Ie([])},React.createElement("i",{className:"fas fa-times"})))),L?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):P.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},React.createElement("i",{className:"fas fa-image fa-2x mb-2"}),React.createElement("p",null,"Ch\u01B0a c\xF3 \u1EA3nh n\xE0o trong album n\xE0y")):React.createElement("div",{className:"image-grid"},P.map((n,j)=>React.createElement("div",{key:j,className:`image-item ${Ne.includes(n.id)?"selected":""}`,style:{position:"relative",cursor:"pointer"},onClick:()=>B(n.id)},React.createElement("div",{className:"select-checkbox",style:{position:"absolute",top:"6px",left:"6px",zIndex:10,width:"24px",height:"24px",borderRadius:"4px",background:Ne.includes(n.id)?"#0d6efd":"rgba(255,255,255,0.9)",border:Ne.includes(n.id)?"none":"2px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}},Ne.includes(n.id)&&React.createElement("i",{className:"fas fa-check",style:{color:"#fff",fontSize:"12px"}})),React.createElement("img",{src:n.src,alt:n.caption,style:{opacity:Ne.includes(n.id)?.7:1,border:Ne.includes(n.id)?"3px solid #0d6efd":"none",borderRadius:"8px"}}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn btn-sm btn-danger",onClick:ie=>{ie.stopPropagation(),tt(n.id,j)},title:"X\xF3a \u1EA3nh"},React.createElement("i",{className:"fas fa-trash"}))),n.caption&&React.createElement("div",{className:"p-2 bg-light small text-truncate"},n.caption)))))),m&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header bg-info text-white"},React.createElement("h5",{className:"modal-title"},React.createElement("i",{className:"fas fa-folder-open me-2"}),"Di chuy\u1EC3n ",Ne.length," \u1EA3nh"),React.createElement("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>re(!1)})),React.createElement("div",{className:"modal-body",style:{maxHeight:"400px",overflowY:"auto"}},React.createElement("p",{className:"text-muted small mb-3"},"Ch\u1ECDn th\u01B0 m\u1EE5c \u0111\xEDch:"),React.createElement("div",{className:"folder-tree"},He.filter(n=>!n.parentId).map(n=>React.createElement(FolderTreeItem,{key:n.uuid||n.id,folder:n,allAlbums:He,currentAlbumId:r.uuid||r.id,targetAlbum:Ve,onSelect:Be})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>re(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:we,disabled:!Ve||i},i?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang chuy\u1EC3n..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-1"}),"Di chuy\u1EC3n \u0111\u1EBFn \u0111\xE2y")))))),U&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)"},onClick:()=>k(null)},React.createElement("div",{className:"modal-dialog modal-fullscreen d-flex align-items-center justify-content-center"},React.createElement("div",{className:"position-relative",style:{maxWidth:"95vw",maxHeight:"95vh"}},React.createElement("button",{className:"btn btn-light position-absolute",style:{top:"-50px",right:"0",borderRadius:"50%",width:"40px",height:"40px"},onClick:()=>k(null)},React.createElement("i",{className:"fas fa-times"})),React.createElement("img",{src:U.src,alt:U.caption,style:{maxWidth:"95vw",maxHeight:"90vh",objectFit:"contain"},onClick:n=>n.stopPropagation()}),U.caption&&React.createElement("div",{className:"text-white text-center mt-2"},U.caption)))))}function SearchCenter({showToast:r,onNavigate:c}){const[p,M]=useState(""),[I,d]=useState([]),[C,P]=useState([]),[F,S]=useState([]),[Q,L]=useState("all"),[K,$]=useState(null),[Z,ee]=useState("list"),[J,X]=useState(!0),[le,ae]=useState([]),[he,ue]=useState([]),b=useRef(null),[U,k]=useState(!0),[ce,z]=useState(!1),se=useRef(null),[fe,ve]=useState(!1),[Se,Te]=useState([{role:"assistant",content:`Xin ch\xE0o! H\xE3y h\u1ECFi t\xF4i v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3... V\xED d\u1EE5:
\u2022 "Gi\xE1 van 2 tay?"
\u2022 "Combo r\u1EBB nh\u1EA5t?"
\u2022 "Freeship?"`,attachments:[]}]),[G,m]=useState(""),[re,Ne]=useState(!1),Ie=useRef(null),He=useRef(null),[Me,Ve]=useState(null),[Be,i]=useState(!1),[l,be]=useState(null),[h,A]=useState(!1),[B,we]=useState(!1),[_e,Le]=useState(null),[Ce,Re]=useState({name:"",code:"",price:"",image:"",category:"",note:"",commission_percent:""}),st=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"],gt=t=>{var f,v;t._type==="product"&&(be(t),Re({name:t.name||"",code:t.code||"",price:t.price||"",image:t.image||"",category:t.category||"",note:t.note||"",commission_percent:(v=(f=t.commission_percent)!=null?f:t.commissionPercent)!=null?v:""}),i(!0))},ft=async()=>{if(l)try{await window.KTM.api.putJSON(`${API_BASE}/api/products?id=${l.id}`,Ce,"L\u1ED7i c\u1EADp nh\u1EADt"),r("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),i(!1),be(null),oe()}catch(t){r(t.message,"danger")}},vt=async t=>{const f=t._type==="product"?"s\u1EA3n ph\u1EA9m":t._type==="album"?"\u1EA3nh":"video";if(confirm(`X\xF3a ${f} "${t.name}"?`))try{let v="";t._type==="product"?v=`${API_BASE}/api/products?id=${t.id}`:t._type==="album"?v=`${API_BASE}/api/images/${t.id}`:t._type==="video"&&(v=`${API_BASE}/api/videos/${t.id}`),await window.KTM.api.deleteJSON(v,"L\u1ED7i x\xF3a"),r(`\u0110\xE3 x\xF3a ${f}`,"success"),oe()}catch(v){r(v.message,"danger")}},ne=async t=>{try{const f=_e?`${API_BASE}/api/products?id=${_e.id}`:`${API_BASE}/api/products`;_e?await window.KTM.api.putJSON(f,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(f,t,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),r(_e?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),we(!1),Le(null),oe()}catch(f){r(f.message,"danger")}},je="ktm_admin_data_cache_v1",tt=1e3*60*10,oe=async()=>{let t=null,f=!1;const v=window.KTM.cache.read(je,{ttlMs:tt,validate:Array.isArray});v.hit?(t=v.value,console.log("[CACHE] Using cache, items:",t.length),P(t),d(t),X(!1),f=!0):v.status==="miss"?console.log("[CACHE] No cache found"):v.status==="expired"||v.status==="invalid"?console.log("[CACHE] Cache expired or invalid"):v.status==="error"&&console.error("[CACHE] Error parsing cache"),f||X(!0);try{const T=async(ge,xe)=>{try{const Ee=await window.KTM.api.getJSON(ge,"L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u");return Ee!=null?Ee:xe}catch(Ee){return xe}},[D,N,g]=await Promise.all([T(`${API_BASE}/api/products`,[]),T(`${API_BASE}/api/albums`,[]),T(`${API_BASE}/api/video-folders?withVideos=true`,[])]),O=Array.isArray(D)?D.map(ge=>({...ge,_type:"product",_source:"database"})):[];ae(N);let V=[];Array.isArray(N)&&N.length>0&&(await Promise.all(N.map(xe=>T(`${API_BASE}/api/albums/${xe.id}`,{})))).forEach((xe,Ee)=>{const Ze=N[Ee];xe.images&&xe.images.length>0&&xe.images.forEach(Oe=>{V.push({id:Oe.id,name:Oe.caption||"\u1EA2nh t\u1EEB "+Ze.title,image:Oe.src,folder:Ze.title,_type:"album",_source:"database"})})}),ue(g);let y=[];Array.isArray(g)&&g.forEach(ge=>{ge.videos&&ge.videos.forEach(xe=>{y.push({id:xe.id,name:xe.title,folder:ge.name,image:xe.thumb,youtubeId:xe.youtubeId,url:xe.url,_type:"video",_source:"database"})})});const R=[...O,...V,...y];(!t||JSON.stringify(R)!==JSON.stringify(t))&&(P(R),d(R),window.KTM.cache.write(je,R))}catch(T){console.error("Song song fetch error:",T)}X(!1)};useEffect(()=>{oe(),setTimeout(()=>{var t;return(t=b.current)==null?void 0:t.focus()},100)},[]);const x=t=>{try{return String(t!=null?t:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d")}catch(f){return String(t!=null?t:"").toLowerCase()}},Fe=t=>{const v=x(t).trim().split(/\s+/).filter(Boolean),T=v.includes("anh"),D=v.includes("video"),N=v.filter(V=>V!=="anh"&&V!=="video"),g=N.join(" "),O=new Set(["product"]);return T&&O.add("album"),D&&O.add("video"),{allowedTypes:O,includeAlbum:T,includeVideo:D,contentTokens:N,cleanedQuery:g}},n=(t,f,v)=>{var ge,xe,Ee,Ze,Oe;const T=Array.isArray(f)?f:[],D=x(v).trim();if(!T.length&&!D)return 0;const N=x((ge=t==null?void 0:t.name)!=null?ge:""),g=x((xe=t==null?void 0:t.code)!=null?xe:""),O=x((Ee=t==null?void 0:t.category)!=null?Ee:""),V=x((Ze=t==null?void 0:t.note)!=null?Ze:""),y=x((Oe=t==null?void 0:t.folder)!=null?Oe:"");if(!`${N} ${g} ${O} ${V} ${y}`.trim())return 0;let W=0;D&&(N===D&&(W+=220),N.includes(D)&&(W+=140),N.startsWith(D)&&(W+=160),g&&g===D&&(W+=180),g&&g.includes(D)&&(W+=90));for(const Qe of T){if(!Qe)continue;const mt=new RegExp(`(?:^|\\s)${Qe.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}`);N.includes(Qe)&&(W+=35),mt.test(N)&&(W+=25),g&&g.includes(Qe)&&(W+=20),g&&mt.test(g)&&(W+=10),O&&O.includes(Qe)&&(W+=12),y&&y.includes(Qe)&&(W+=12),V&&V.includes(Qe)&&(W+=6)}return W>0&&N&&(W+=Math.max(0,10-Math.min(10,Math.floor(N.length/10)))),W},j=(t,f,v)=>{const T=Array.isArray(t)?t:[];return T.length?T.map((N,g)=>({it:N,idx:g,score:n(N,f,v)})).sort((N,g)=>g.score!==N.score?g.score-N.score:N.idx-g.idx).map(N=>N.it):[]},ie=async(t,f)=>{if(!(!U||f.length===0)){z(!0);try{const v=f.map(D=>({id:D.id,name:D.name,price:D.price,category:D.category,note:D.note,folder:D.folder,_type:D._type})),T=await window.KTM.api.postJSON(`${API_BASE}/api/ai-search`,{query:t,products:v},"AI Search error");if(T&&T.matchedIds&&T.matchedIds.length>0){const{contentTokens:D,cleanedQuery:N}=Fe(t),g=new Set(T.matchedIds),O=f.filter(V=>g.has(V.id)).sort((V,y)=>n(y,D,N)-n(V,D,N));O.length>0&&d(O)}else T&&T.matchedIds&&T.matchedIds.length===0&&d([])}catch(v){console.error("AI Search error:",v)}z(!1)}},pe=t=>{if(M(t),se.current&&clearTimeout(se.current),!t.trim()){Pe(Q);return}const{allowedTypes:f,contentTokens:v,cleanedQuery:T}=Fe(t),D=C.filter(g=>{if(!f.has(g==null?void 0:g._type))return!1;if(v.length===0)return!0;const O=x(Object.entries(g).filter(([V])=>!V.startsWith("_")).map(([,V])=>String(V||"")).join(" "));return v.some(V=>O.includes(V))});let N=D;Q!=="all"&&(N=D.filter(g=>(g.category||g._type)===Q)),d(j(N,v,T)),U&&T.length>=3&&(se.current=setTimeout(()=>{ie(T,N)},500))},Pe=t=>{L(t);const{allowedTypes:f,contentTokens:v}=Fe(p),{cleanedQuery:T}=Fe(p);let D=C.filter(N=>f.has(N==null?void 0:N._type));t!=="all"&&(D=D.filter(N=>(N.category||N._type)===t)),p.trim()&&v.length>0&&(D=D.filter(N=>{const g=x(Object.entries(N).filter(([O])=>!O.startsWith("_")).map(([,O])=>String(O||"")).join(" "));return v.every(O=>g.includes(O))})),d(j(D,v,T))},Ae=(t,f)=>{window.KTM.clipboard.writeText(t).then(()=>{$(f),r("\u0110\xE3 copy!","success"),setTimeout(()=>$(null),1500)})},de=async(t,f)=>{try{await window.KTM.clipboard.writeImageFromUrl(t),$(f+"-img"),r("\u0110\xE3 copy \u1EA3nh!","success"),setTimeout(()=>$(null),1500)}catch(v){Ae(t,f+"-img")}},Ye=t=>{let f=t.toLowerCase();const v=[],T=C.filter(g=>g._type==="product");if(f.includes("ty")||f.includes("xy lanh")){if(f.includes("gi\u1EEFa")||f.includes("giua")){const g=T.find(O=>{var V;return(V=O.name)==null?void 0:V.toLowerCase().includes("xy lanh gi\u1EEFa")});g&&!v.find(O=>O.id===g.id)&&v.push(g)}if(f.includes("nghi\xEAng")||f.includes("nghieng")){const g=T.find(O=>{var V;return(V=O.name)==null?void 0:V.toLowerCase().includes("xy lanh nghi\xEAng")});g&&!v.find(O=>O.id===g.id)&&v.push(g)}if(f.includes("\u1EE7i")||f.includes("ui")){const g=T.find(O=>{var V;return(V=O.name)==null?void 0:V.toLowerCase().includes("xy lanh \u1EE7i")});g&&!v.find(O=>O.id===g.id)&&v.push(g)}}const D=f.match(/van\s*(\d+)\s*tay.*?(\d+)\s*ty/);if(D){const g=D[1],O=D[2],V=T.find(y=>{var W;const R=((W=y.name)==null?void 0:W.toLowerCase())||"";return R.includes("combo")&&R.includes(`${g} tay`)&&(R.includes(`${O} xy`)||R.includes(`${O} xylanh`))});if(V&&!v.find(y=>y.id===V.id))v.push(V);else{const y=T.find(R=>{var ge;const W=((ge=R.name)==null?void 0:ge.toLowerCase())||"";return W.includes("combo")&&W.includes(`${g} tay`)});y&&!v.find(R=>R.id===y.id)&&v.push(y)}}if(f.includes("combo")&&!D){const g=f.match(/combo.*?(\d+)\s*tay/);if(g){const O=g[1];T.filter(y=>{var W;const R=((W=y.name)==null?void 0:W.toLowerCase())||"";return R.includes("combo")&&R.includes(`${O} tay`)}).forEach(y=>{v.find(R=>R.id===y.id)||v.push(y)})}}const N=f.match(/van\s*(\d+)\s*tay/);if(N&&!f.includes("ty")&&!f.includes("combo")){const g=N[1],O=T.find(V=>{var R;const y=((R=V.name)==null?void 0:R.toLowerCase())||"";return y.includes(`van ${g} tay`)&&!y.includes("combo")});O&&!v.find(V=>V.id===O.id)&&v.push(O)}return v.slice(0,4)},ze=async t=>{if(!t.trim())return;const f={role:"user",content:t,attachments:[]};Te(T=>[...T,f]),m(""),Ne(!0);const v=Ye(t);setTimeout(()=>{var T;return(T=Ie.current)==null?void 0:T.scrollIntoView({behavior:"smooth"})},100);try{const D=C.filter(R=>R._type==="product").map(R=>{let W=`- ${R.name}`;return R.code&&(W+=` (M\xE3: ${R.code})`),R.price&&(W+=` - Gi\xE1: ${R.price.replace(/[đ\s]/g,"")}\u0111`),R.category&&(W+=` [${R.category}]`),R.note&&(W+=` (${R.note})`),W}).join(`
`),g=Se.slice(-6).map(R=>`${R.role==="user"?"Kh\xE1ch":"AI"}: ${R.content}`).join(`
`),O=g?`L\u1ECACH S\u1EEC H\u1ED8I THO\u1EA0I:
${g}

DANH S\xC1CH S\u1EA2N PH\u1EA8M:
${D}`:D,y=(await window.KTM.api.postJSON(`${API_BASE}/api/ai-chat`,{message:t,context:O,audience:"admin"},"API error")).response||"Xin l\u1ED7i, t\xF4i kh\xF4ng th\u1EC3 tr\u1EA3 l\u1EDDi l\xFAc n\xE0y.";Te(R=>[...R,{role:"assistant",content:y,attachments:v}])}catch(T){console.error("AI Error:",T);const D=t.toLowerCase(),N=C.filter(O=>{const V=Object.values(O).join(" ").toLowerCase();return D.split(" ").some(y=>V.includes(y))});let g="";N.length>0?(g=`T\xECm th\u1EA5y ${N.length} s\u1EA3n ph\u1EA9m li\xEAn quan:

`,N.slice(0,5).forEach(O=>{g+=`\u2022 ${O.name}`,O.price&&(g+=` - ${O.price.replace(/[đ\s]/g,"")}\u0111`),O.note&&(g+=` (${O.note})`),g+=`
`}),N.length>5&&(g+=`
...v\xE0 ${N.length-5} s\u1EA3n ph\u1EA9m kh\xE1c`)):g='Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p. H\xE3y th\u1EED t\u1EEB kh\xF3a kh\xE1c nh\u01B0 "van", "combo", "xy lanh"...',Te(O=>[...O,{role:"assistant",content:g,attachments:N.slice(0,4)}])}Ne(!1),setTimeout(()=>{var T,D;(T=Ie.current)==null||T.scrollIntoView({behavior:"smooth"}),(D=He.current)==null||D.focus()},100)};function ct({show:t,product:f,categories:v,onClose:T,onSave:D}){const[N,g]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[O,V]=useState(!1),[y,R]=useState(!1),W=useRef(null),ge=Y=>window.KTM.money.formatVNDInputDigits(Y);useEffect(()=>{var Y,qe;if(f)if(g({name:f.name||"",code:f.code||"",price:f.price||"",image:f.image||"",category:f.category||"",note:f.note||"",sort_order:f.sort_order||0,commission_percent:(qe=(Y=f.commission_percent)!=null?Y:f.commissionPercent)!=null?qe:5}),f.price){const Ke=window.KTM.money.getDigits(f.price);Oe(Ke),g(De=>({...De,price:ge(Ke)}))}else Oe("");else g({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),Oe("")},[f,t]);const[xe,Ee]=React.useState(""),[Ze,Oe]=React.useState(""),Qe=Y=>{const qe=window.KTM.money.nextPriceInputState(Y.target.value,Ze);Oe(qe.digits),g({...N,price:qe.price})},mt=async(Y,qe=2)=>{const Ke=qe*1024*1024;if(Y.size<=Ke)return Y;try{const De=await createImageBitmap(Y),me=document.createElement("canvas");let ke=De.width,Xe=De.height;const Ge=1200;return(ke>Ge||Xe>Ge)&&(ke>Xe?(Xe=Math.round(Xe/ke*Ge),ke=Ge):(ke=Math.round(ke/Xe*Ge),Xe=Ge)),me.width=ke,me.height=Xe,me.getContext("2d").drawImage(De,0,0,ke,Xe),De.close(),new Promise((yt,wt)=>{me.toBlob(ut=>{ut?yt(new File([ut],Y.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})):wt(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.8)})}catch(De){throw console.error("Compress error:",De),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},Nt=async Y=>{var De;const qe=Y.target.files[0];if(!qe)return;if(!(qe.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp)$/i.test(qe.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}R(!0);try{const me=await mt(qe),ke=await window.KTM.cloudinary.uploadImage({file:me,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET,folder:"ktm-products"});if(!ke.secure_url)throw console.error("Cloudinary error:",ke),new Error(((De=ke.error)==null?void 0:De.message)||"Upload failed");g(Xe=>({...Xe,image:ke.secure_url}))}catch(me){console.error("Upload error:",me),alert("L\u1ED7i upload \u1EA3nh: "+me.message)}R(!1),Y.target.value=""},ot=async Y=>{Y.preventDefault(),V(!0),await D(N),V(!1)};return t?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,border:"none",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark"},React.createElement("i",{className:"fas fa-box me-2"}),f?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:T})),React.createElement("form",{onSubmit:ot},React.createElement("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-tag me-1"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:N.name,onChange:Y=>g({...N,name:Y.target.value}),placeholder:"V\xED d\u1EE5: Xy lanh nghi\xEAng KTM",required:!0,style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-hashtag me-1"}),"M\xE3 s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:N.code,onChange:Y=>g({...N,code:Y.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1"}),"Gi\xE1 b\xE1n"),React.createElement("input",{type:"text",className:"form-control",value:N.price,onChange:Qe,placeholder:"1.950.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3 mt-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-percent me-1"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:N.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:Y=>g({...N,commission_percent:Y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-list me-1"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:N.category,onChange:Y=>g({...N,category:Y.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),v.map(Y=>React.createElement("option",{key:Y,value:Y},Y)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1"}),"Ghi ch\xFA"),React.createElement("textarea",{className:"form-control",rows:"2",value:N.note,onChange:Y=>g({...N,note:Y.target.value}),placeholder:"V\xED d\u1EE5: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"col-md-4"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-image me-1"}),"\u1EA2nh s\u1EA3n ph\u1EA9m"),React.createElement("div",{className:"mb-2"},N.image?React.createElement(React.Fragment,null,React.createElement("img",{src:N.image,alt:"Product",style:{width:"100%",height:150,objectFit:"cover",borderRadius:"12px",border:"2px solid #e9ecef"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>g({...N,image:""}),style:{borderRadius:"20px",fontSize:"0.75rem"}},React.createElement("i",{className:"fas fa-times me-1"}),"X\xF3a \u1EA3nh")):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:"100%",height:150,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd",cursor:"pointer"},onClick:()=>{var Y;return(Y=W.current)==null?void 0:Y.click()}},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-cloud-upload-alt fa-2x text-muted mb-2"}),React.createElement("div",{className:"small text-muted"},"Click \u0111\u1EC3 upload")))),React.createElement("input",{ref:W,type:"file",accept:"image/*",className:"d-none",onChange:Nt}),React.createElement("button",{type:"button",className:"btn btn-outline-secondary w-100",onClick:()=>{var Y;return(Y=W.current)==null?void 0:Y.click()},disabled:y,style:{borderRadius:"10px"}},y?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang upload..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-upload me-2"}),"Upload \u1EA3nh")),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"Ho\u1EB7c URL \u1EA3nh"),React.createElement("input",{type:"url",className:"form-control",value:N.image,onChange:Y=>g({...N,image:Y.target.value}),placeholder:"https://...",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"8px",fontSize:"0.875rem"}}))))),React.createElement("div",{className:"modal-footer",style:{border:"none",padding:"20px"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:T,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:O,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},O?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}const nt=(t,f)=>{const v=t._type==="product",T=t._type==="album",D=t._type==="video",N=t.note&&(t.note.toLowerCase().includes("free")||t.note.toLowerCase().includes("gi\u1EA3m")||t.note.toLowerCase().includes("sale"));return Z==="grid"?React.createElement("div",{key:t.id||f,className:"grid-card"},React.createElement("div",{className:"thumb-wrap",onClick:()=>Ve({url:t.image,name:t.name,price:t.price,note:t.note,item:t})},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy"}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${D?"fa-video":"fa-image"} fa-2x text-muted`})),t.price&&React.createElement("div",{className:"price-overlay"},t.price.replace(/[đ\s]/g,""),"\u0111"),React.createElement("span",{className:`type-badge ${v?"product":T?"album":"video"}`},v?"SP":T?"\u1EA2nh":"Video"),N&&React.createElement("span",{className:"promo-badge"},"\u{1F525} \u01AFU \u0110\xC3I")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"name"},t.name),t.note&&React.createElement("div",{className:"meta text-info",style:{fontSize:10}},t.note),React.createElement("div",{className:"quick-copy"},React.createElement("button",{className:K===t.id+"-img"?"copied":"",onClick:()=>de(t.image,t.id)},React.createElement("i",{className:"fas fa-image"})),t.price&&React.createElement("button",{className:K===t.id+"-price"?"copied":"",onClick:()=>Ae(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"}))))):React.createElement("div",{key:t.id||f,className:"product-card-mobile"},React.createElement("span",{className:`type-badge ${v?"product":T?"album":"video"}`},v?"S\u1EA3n ph\u1EA9m":T?"\u1EA2nh":"Video"),React.createElement("div",{className:"card-inner"},t.image?React.createElement("img",{src:t.image,alt:t.name,className:"thumb",loading:"lazy",onClick:()=>Ve({url:t.image,name:t.name,price:t.price,note:t.note,item:t})}):React.createElement("div",{className:"thumb d-flex align-items-center justify-content-center bg-light"},React.createElement("i",{className:`fas ${D?"fa-video":"fa-image"} fa-2x text-muted`})),React.createElement("div",{className:"info"},React.createElement("div",null,React.createElement("div",{className:"name"},t.name),React.createElement("div",{className:"price-row"},t.price&&React.createElement("span",{className:"price"},t.price.replace(/[đ\s]/g,""),"\u0111"),N&&React.createElement("span",{className:"badge-promo"},"\u{1F525} \u01AFU \u0110\xC3I"))),React.createElement("div",{className:"meta"},t.code&&React.createElement("span",{className:"meta-tag"},"#",t.code),t.category&&React.createElement("span",{className:"meta-tag"},t.category),t.note&&React.createElement("span",{className:"meta-tag highlight"},t.note),t.folder&&React.createElement("span",{className:"meta-tag"},t.folder),D&&React.createElement("span",{className:"meta-tag"},React.createElement("i",{className:"fab fa-youtube text-danger"})," Video")))),React.createElement("div",{className:"quick-actions"},v&&React.createElement("button",{onClick:()=>c&&c("orders","create",{productId:t.id})},React.createElement("i",{className:"fas fa-receipt"})," T\u1EA1o \u0111\u01A1n"),t.price&&React.createElement("button",{className:K===t.id+"-price"?"copied":"",onClick:()=>Ae(t.price.replace(/[đ\s]/g,""),t.id+"-price")},React.createElement("i",{className:"fas fa-tag"})," Gi\xE1"),React.createElement("button",{className:K===t.id+"-name"?"copied":"",onClick:()=>Ae(t.name,t.id+"-name")},React.createElement("i",{className:"fas fa-font"})," T\xEAn"),D&&t.youtubeId&&React.createElement("button",{className:K===t.id+"-yt"?"copied":"",onClick:()=>Ae(`https://www.youtube.com/watch?v=${t.youtubeId}`,t.id+"-yt")},React.createElement("i",{className:"fab fa-youtube"})),v&&React.createElement("button",{className:"action-edit",onClick:()=>gt(t)},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"action-delete",onClick:()=>vt(t)},React.createElement("i",{className:"fas fa-trash"}))))},[it,Je]=useState(!1);return React.createElement(React.Fragment,null,React.createElement("div",{className:"result-header"},React.createElement("span",null,React.createElement("strong",null,I.length)," k\u1EBFt qu\u1EA3",U&&p.length>=3&&React.createElement("span",{className:"ai-badge ms-2"},React.createElement("i",{className:"fas fa-robot"})," AI"),Q!=="all"&&React.createElement("span",{className:"ms-2 badge bg-warning text-dark"},Q==="product"?"S\u1EA3n ph\u1EA9m":Q==="album"?"\u1EA2nh":"Video")),React.createElement("div",{className:"d-flex gap-1 align-items-center"},React.createElement("button",{className:`btn btn-sm ${Z==="list"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ee("list"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-list"})),React.createElement("button",{className:`btn btn-sm ${Z==="grid"?"btn-dark":"btn-outline-secondary"}`,onClick:()=>ee("grid"),style:{padding:"4px 8px"}},React.createElement("i",{className:"fas fa-th"})))),React.createElement("div",{className:"search-results-area"},J?React.createElement("div",null,[...Array(8)].map((t,f)=>React.createElement("div",{key:f,className:"product-card-mobile mb-2",style:{opacity:.7}},React.createElement("div",{className:"card-inner"},React.createElement("div",{className:"thumb bg-light",style:{width:80,height:80,borderRadius:8}}),React.createElement("div",{className:"info",style:{flex:1,minWidth:0}},React.createElement("div",{className:"skeleton-box mb-2",style:{height:16,width:"60%",background:"#eee",borderRadius:4}}),React.createElement("div",{className:"skeleton-box mb-1",style:{height:12,width:"40%",background:"#f3f3f3",borderRadius:4}}),React.createElement("div",{className:"skeleton-box",style:{height:10,width:"30%",background:"#f3f3f3",borderRadius:4}})))))):I.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-search"}),React.createElement("p",null,'Kh\xF4ng t\xECm th\u1EA5y "',p,'"'),React.createElement("button",{className:"btn btn-warning",onClick:()=>{M(""),pe("")}},"Xem t\u1EA5t c\u1EA3")):Z==="grid"?React.createElement("div",{className:"product-grid-mobile"},I.map((t,f)=>nt(t,f))):React.createElement("div",null,I.map((t,f)=>nt(t,f)))),it&&React.createElement("div",{className:"filter-dropdown"},React.createElement("div",{className:"filter-header"},React.createElement("strong",null,"L\u1ECDc theo lo\u1EA1i"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>Je(!1)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"filter-chips"},React.createElement("span",{className:`filter-chip ${Q==="all"?"active":""}`,onClick:()=>{Pe("all"),Je(!1)}},"T\u1EA5t c\u1EA3"),React.createElement("span",{className:`filter-chip ${Q==="product"?"active":""}`,onClick:()=>{Pe("product"),Je(!1)}},React.createElement("i",{className:"fas fa-box me-1"}),"S\u1EA3n ph\u1EA9m"),React.createElement("span",{className:`filter-chip ${Q==="album"?"active":""}`,onClick:()=>{Pe("album"),Je(!1)}},React.createElement("i",{className:"fas fa-images me-1"}),"\u1EA2nh"),React.createElement("span",{className:`filter-chip ${Q==="video"?"active":""}`,onClick:()=>{Pe("video"),Je(!1)}},React.createElement("i",{className:"fas fa-video me-1"}),"Video")),React.createElement("div",{className:"mt-3 pt-3 border-top d-flex align-items-center justify-content-between"},React.createElement("span",null,"AI Search th\xF4ng minh"),React.createElement("div",{className:"form-check form-switch m-0"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:U,onChange:t=>k(t.target.checked),style:{width:40,height:20}})))),React.createElement("div",{className:"search-bar-bottom"},React.createElement("div",{className:"search-input-wrap"},React.createElement("input",{ref:b,type:"text",className:"search-input",placeholder:"\u{1F50D} T\xECm: van 3 tay, xylanh...",value:p,onChange:t=>pe(t.target.value)}),React.createElement("button",{className:`filter-btn ${it||Q!=="all"?"active":""}`,onClick:()=>Je(!it)},React.createElement("i",{className:"fas fa-filter"})))),React.createElement("button",{className:"btn btn-lg rounded-circle position-fixed shadow-lg",style:{bottom:h?320:130,right:16,width:56,height:56,zIndex:1050,transition:"bottom 0.2s ease",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",border:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer",outline:"none"},onClick:()=>ve(!0),onTouchStart:()=>ve(!0)},React.createElement("i",{className:"fas fa-robot fa-lg"})),fe&&React.createElement("div",{className:"ai-chat-mobile"},React.createElement("div",{className:"chat-header"},React.createElement("button",{className:"back-btn",onClick:()=>ve(!1)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",null,React.createElement("strong",null,"KTM AI Assistant"),React.createElement("div",{style:{fontSize:11,opacity:.8}},"H\u1ECFi v\u1EC1 s\u1EA3n ph\u1EA9m, gi\xE1 c\u1EA3..."))),React.createElement("div",{className:"chat-messages"},Se.map((t,f)=>React.createElement("div",{key:f,className:`mb-3 ${t.role==="user"?"d-flex justify-content-end":""}`},React.createElement("div",{className:`p-3 rounded-3 position-relative ${t.role==="user"?"text-white":"bg-white border"}`,style:{maxWidth:"85%",whiteSpace:"pre-wrap",background:t.role==="user"?"linear-gradient(135deg, #667eea, #764ba2)":void 0}},t.content,t.role==="assistant"&&React.createElement("button",{className:"btn btn-sm position-absolute",style:{top:4,right:4,padding:"2px 6px",fontSize:11,background:K===`chat-${f}`?"#28a745":"rgba(0,0,0,0.1)",border:"none",borderRadius:4,color:K===`chat-${f}`?"#fff":"#666"},onClick:()=>{window.KTM.clipboard.writeText(t.content),$(`chat-${f}`),setTimeout(()=>$(null),1500)}},React.createElement("i",{className:`fas ${K===`chat-${f}`?"fa-check":"fa-copy"}`})),t.attachments&&t.attachments.length>0&&React.createElement("div",{className:"mt-2 d-flex flex-wrap gap-2"},t.attachments.map((v,T)=>React.createElement("div",{key:T,style:{width:70},className:"text-center"},v.image&&React.createElement("img",{src:v.image,className:"rounded",style:{width:70,height:50,objectFit:"cover",cursor:"pointer"},onClick:()=>Ve({url:v.image,name:v.name,price:v.price})}),React.createElement("div",{style:{fontSize:9},className:"text-truncate"},v.name),v.price&&React.createElement("div",{style:{fontSize:10,color:"#dc3545",fontWeight:600}},v.price.replace(/[đ\s]/g,""),"\u0111"))))))),re&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"bg-white border p-3 rounded-3 d-inline-block"},React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang suy ngh\u0129...")),React.createElement("div",{ref:Ie})),React.createElement("div",{className:"px-3 py-2 border-top d-flex gap-2 overflow-auto"},["Gi\xE1 van 2 tay?","Combo r\u1EBB nh\u1EA5t?","Freeship?","Van 3 tay?"].map(t=>React.createElement("button",{key:t,className:"btn btn-sm btn-outline-secondary flex-shrink-0",onClick:()=>ze(t),disabled:re,style:{whiteSpace:"nowrap"}},t))),React.createElement("div",{className:"chat-input-area"},React.createElement("form",{onSubmit:t=>{t.preventDefault(),ze(G)},className:"chat-input-wrap"},React.createElement("input",{ref:He,type:"text",className:"chat-input",placeholder:"Nh\u1EADp c\xE2u h\u1ECFi...",value:G,onChange:t=>m(t.target.value),disabled:re}),React.createElement("button",{type:"submit",className:"send-btn",disabled:re||!G.trim()},React.createElement("i",{className:"fas fa-paper-plane"}))))),Me&&React.createElement("div",{className:"preview-modal",onClick:()=>Ve(null)},React.createElement("div",{className:"preview-header"},React.createElement("div",null),React.createElement("button",{className:"close-btn",onClick:()=>Ve(null)},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"preview-body",onClick:t=>t.stopPropagation()},React.createElement("img",{src:Me.url,alt:Me.name})),React.createElement("div",{className:"preview-footer",onClick:t=>t.stopPropagation()},React.createElement("div",{className:"name"},Me.name),Me.price&&React.createElement("div",{className:"price"},Me.price.replace(/[đ\s]/g,""),"\u0111"),Me.note&&React.createElement("div",{className:"mb-2",style:{fontSize:14,color:"#17a2b8"}},Me.note),React.createElement("div",{className:"action-btns"},React.createElement("button",{className:K==="preview-img"?"btn-success text-white":"btn-outline-light text-white",style:{background:K==="preview-img"?"#28a745":"rgba(255,255,255,0.2)"},onClick:()=>de(Me.url,"preview")},React.createElement("i",{className:`fas ${K==="preview-img"?"fa-check":"fa-copy"}`}),"Copy \u1EA3nh"),Me.price&&React.createElement("button",{className:K==="preview-price"?"btn-success text-white":"btn-warning",onClick:()=>Ae(Me.price.replace(/[đ\s]/g,""),"preview-price")},React.createElement("i",{className:`fas ${K==="preview-price"?"fa-check":"fa-tag"}`}),"Copy gi\xE1")))),React.createElement(ct,{show:B,product:_e,categories:F,onClose:()=>{we(!1),Le(null)},onSave:ne}),React.createElement("div",{className:`fab-container mobile-only ${h?"open":""}`},React.createElement("div",{className:"fab-actions"},React.createElement("button",{className:"fab-action product",onClick:()=>{A(!1),we(!0),Le(null)}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",{className:"tooltip"},"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("button",{className:"fab-action product",onClick:()=>{A(!1),c&&c("orders","create")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",{className:"tooltip"},"T\u1EA1o order nhanh"))),React.createElement("button",{className:`fab-main ${h?"open":""}`,onClick:()=>A(!h)},React.createElement("i",{className:"fas fa-plus"}))),Be&&l&&React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.6)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16,maxHeight:"90vh"}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ff9800)",border:"none"}},React.createElement("h6",{className:"modal-title fw-bold"},React.createElement("i",{className:"fas fa-pen me-2"}),"S\u1EEDa nhanh"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>i(!1)})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"T\xEAn s\u1EA3n ph\u1EA9m"),React.createElement("input",{type:"text",className:"form-control",value:Ce.name,onChange:t=>Re({...Ce,name:t.target.value})})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:Ce.code,onChange:t=>Re({...Ce,code:t.target.value})})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label small fw-semibold"},"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:Ce.price,onChange:t=>Re({...Ce,price:t.target.value})}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:Ce.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:t=>Re({...Ce,commission_percent:t.target.value})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:Ce.category,onChange:t=>Re({...Ce,category:t.target.value})},React.createElement("option",{value:""},"-- Ch\u1ECDn danh m\u1EE5c --"),st.map(t=>React.createElement("option",{key:t,value:t},t)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label small fw-semibold"},"Ghi ch\xFA (\u01B0u \u0111\xE3i)"),React.createElement("input",{type:"text",className:"form-control",value:Ce.note,placeholder:"VD: Free ship, Gi\u1EA3m 10%...",onChange:t=>Re({...Ce,note:t.target.value})}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>i(!1)},"H\u1EE7y"),React.createElement("button",{type:"button",className:"btn btn-warning",onClick:ft},React.createElement("i",{className:"fas fa-save me-1"}),"L\u01B0u"))))))}function VideoList({onRefresh:r,showToast:c}){const[p,M]=useState([]),[I,d]=useState([]),[C,P]=useState(!0),[F,S]=useState(null),[Q,L]=useState(!1),[K,$]=useState(null),[Z,ee]=useState(!1),[J,X]=useState(null),[le,ae]=useState(null),[he,ue]=useState([]);useEffect(()=>{b()},[]);const b=async(i=null)=>{P(!0);try{const l=i?`${API_BASE}/api/video-folders?withVideos=true&parent_id=${i}`:`${API_BASE}/api/video-folders?withVideos=true&parent_id=root`,be=await window.KTM.api.getJSON(l,"L\u1ED7i t\u1EA3i danh s\xE1ch folder");M(Array.isArray(be)?be:[])}catch(l){console.error(l),c("L\u1ED7i t\u1EA3i danh s\xE1ch folder","danger")}P(!1)},U=async i=>{try{const l=await window.KTM.api.getJSON(`${API_BASE}/api/videos?folderId=${i}`,"L\u1ED7i t\u1EA3i video");d(Array.isArray(l)?l:[])}catch(l){console.error(l)}},k=async i=>{if(i===0)return;const l=[...p];[l[i-1],l[i]]=[l[i],l[i-1]],M(l),await z(l)},ce=async i=>{if(i===p.length-1)return;const l=[...p];[l[i],l[i+1]]=[l[i+1],l[i]],M(l),await z(l)},z=async i=>{try{await Promise.all(i.map((l,be)=>window.KTM.api.putJSON(`${API_BASE}/api/video-folders/${l.id}`,{sortOrder:be},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),c("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(l){c("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),b(le==null?void 0:le.id)}},se=async i=>{if(i===0)return;const l=[...I];[l[i-1],l[i]]=[l[i],l[i-1]],d(l),await ve(l)},fe=async i=>{if(i===I.length-1)return;const l=[...I];[l[i],l[i+1]]=[l[i+1],l[i]],d(l),await ve(l)},ve=async i=>{try{await Promise.all(i.map((l,be)=>window.KTM.api.putJSON(`${API_BASE}/api/videos/${l.id}`,{sort_order:be},"L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1"))),c("\u0110\xE3 c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1!","success")}catch(l){c("L\u1ED7i c\u1EADp nh\u1EADt th\u1EE9 t\u1EF1","danger"),U(F.id)}},Se=()=>{$(null),L(!0)},Te=i=>{$(i),L(!0)},G=async i=>{try{!K&&le&&(i.parent_id=le.id);const l=K?`${API_BASE}/api/video-folders/${K.id}`:`${API_BASE}/api/video-folders`;K?await window.KTM.api.putJSON(l,i,"L\u1ED7i l\u01B0u folder"):await window.KTM.api.postJSON(l,i,"L\u1ED7i l\u01B0u folder"),c(K?"\u0110\xE3 c\u1EADp nh\u1EADt folder!":"\u0110\xE3 t\u1EA1o folder m\u1EDBi!","success"),L(!1),b(le==null?void 0:le.id)}catch(l){c(l.message,"danger")}},m=async i=>{const l=i.subfolderCount>0?`X\xF3a folder "${i.name}"? T\u1EA5t c\u1EA3 subfolder v\xE0 videos b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`:`X\xF3a folder "${i.name}"? Videos trong folder s\u1EBD kh\xF4ng b\u1ECB x\xF3a.`;if(confirm(l))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/video-folders/${i.id}`,"L\u1ED7i x\xF3a folder"),c("\u0110\xE3 x\xF3a folder","success"),S(null),b(le==null?void 0:le.id)}catch(be){c("L\u1ED7i x\xF3a folder","danger")}},re=i=>{i.subfolderCount>0?(ue(l=>[...l,i]),ae(i),b(i.id)):(S(i),d(i.videos||[]))},Ne=i=>{if(i==="root")ue([]),ae(null),b(null);else if(i){const l=he.findIndex(be=>be.id===i.id);l>=0&&(ue(he.slice(0,l+1)),ae(i),b(i.id))}else{const l=[...he];l.pop();const be=l[l.length-1]||null;ue(l),ae(be),b(be==null?void 0:be.id)}},Ie=()=>{X(null),ee(!0)},He=i=>{X(i),ee(!0)},Me=async i=>{try{i.folder_id=F==null?void 0:F.id;const l=J?`${API_BASE}/api/videos/${J.id}`:`${API_BASE}/api/videos`;J?await window.KTM.api.putJSON(l,i,"L\u1ED7i l\u01B0u video"):await window.KTM.api.postJSON(l,i,"L\u1ED7i l\u01B0u video"),c(J?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm video th\xE0nh c\xF4ng!","success"),ee(!1),b(),F&&U(F.id)}catch(l){c(l.message,"danger")}},Ve=async i=>{if(confirm(`X\xF3a video "${i.title}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/videos/${i.id}`,"L\u1ED7i x\xF3a video"),c("\u0110\xE3 x\xF3a video","success"),b(),F&&U(F.id)}catch(l){c("L\u1ED7i x\xF3a video","danger")}},Be=i=>{const l=`https://www.youtube.com/watch?v=${i.youtubeId}`;window.KTM.clipboard.writeText(l).then(()=>{c("\u0110\xE3 copy link!","success")}).catch(()=>{c("Kh\xF4ng th\u1EC3 copy link","danger")})};return F?React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},React.createElement("div",{className:"d-flex align-items-center"},React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>S(null)},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:`fas fa-folder-open me-2 ${F.slug==="shorts"?"text-danger":"text-warning"}`}),F.name)),React.createElement("button",{className:"btn btn-warning",onClick:Ie},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm Video")),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1 videos"),I.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-video fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},"Ch\u01B0a c\xF3 video trong folder n\xE0y")):React.createElement("div",{className:"row g-4"},I.map((i,l)=>React.createElement("div",{key:i.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>se(l),disabled:l===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},l+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:()=>fe(l),disabled:l===I.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"position-relative"},React.createElement("img",{src:i.thumb,className:"card-img-top",alt:i.title,style:{height:"120px",objectFit:"cover"}}),React.createElement("a",{href:`https://www.youtube.com/watch?v=${i.youtubeId}`,target:"_blank",className:"position-absolute top-50 start-50 translate-middle"},React.createElement("i",{className:"fas fa-play-circle fa-3x text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"}}))),React.createElement("div",{className:"card-body py-2"},React.createElement("h6",{className:"card-title small mb-1 text-truncate",title:i.title},i.title),React.createElement("small",{className:"text-muted"},i.youtubeId)),React.createElement("div",{className:"card-footer bg-transparent border-0 pt-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Be(i),title:"Copy link"},React.createElement("i",{className:"fas fa-link"})),React.createElement("button",{className:"btn btn-outline-secondary",onClick:()=>He(i),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-edit"})),React.createElement("button",{className:"btn btn-outline-danger",onClick:()=>Ve(i),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))))),React.createElement(VideoModal,{show:Z,video:J,onClose:()=>ee(!1),onSave:Me})):React.createElement("div",null,React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("div",{className:"d-flex align-items-center"},le&&React.createElement("button",{className:"btn btn-outline-secondary me-3",onClick:()=>Ne()},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("h4",{className:"m-0"},React.createElement("i",{className:"fas fa-video me-2 text-warning"}),le?le.name:"Qu\u1EA3n l\xFD Video")),React.createElement("button",{className:"btn btn-warning",onClick:Se},React.createElement("i",{className:"fas fa-folder-plus me-2"}),"T\u1EA1o Folder")),he.length>0&&React.createElement("nav",{"aria-label":"breadcrumb",className:"mb-3"},React.createElement("ol",{className:"breadcrumb mb-0"},React.createElement("li",{className:"breadcrumb-item"},React.createElement("a",{href:"#",onClick:i=>{i.preventDefault(),Ne("root")},className:"text-warning"},React.createElement("i",{className:"fas fa-home"}))),he.map((i,l)=>React.createElement("li",{key:i.id,className:`breadcrumb-item ${l===he.length-1?"active":""}`},l===he.length-1?i.name:React.createElement("a",{href:"#",onClick:be=>{be.preventDefault(),Ne(i)},className:"text-warning"},i.name))))),React.createElement("p",{className:"text-muted small mb-3"},React.createElement("i",{className:"fas fa-info-circle me-1"}),"D\xF9ng n\xFAt \u2191\u2193 \u0111\u1EC3 s\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1. Click v\xE0o folder \u0111\u1EC3 v\xE0o b\xEAn trong."),C?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning"})):p.length===0?React.createElement("div",{className:"text-center py-5"},React.createElement("i",{className:"fas fa-folder-open fa-3x text-muted mb-3"}),React.createElement("p",{className:"text-muted"},le?"Folder n\xE0y \u0111ang tr\u1ED1ng":"Ch\u01B0a c\xF3 folder video n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:Se},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o folder",le?" con":" \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"row g-3"},p.map((i,l)=>{var be,h,A,B;return React.createElement("div",{key:i.id,className:"col-6 col-md-4 col-lg-3"},React.createElement("div",{className:"card h-100 folder-card"},React.createElement("div",{className:"card-header bg-transparent py-1 d-flex justify-content-center gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:we=>{we.stopPropagation(),k(l)},disabled:l===0,title:"Di chuy\u1EC3n l\xEAn"},React.createElement("i",{className:"fas fa-chevron-up"})),React.createElement("span",{className:"text-muted small px-1"},l+1),React.createElement("button",{className:"btn btn-sm btn-outline-secondary px-2 py-0",onClick:we=>{we.stopPropagation(),ce(l)},disabled:l===p.length-1,title:"Di chuy\u1EC3n xu\u1ED1ng"},React.createElement("i",{className:"fas fa-chevron-down"}))),React.createElement("div",{className:"card-body text-center py-3",onClick:()=>re(i),style:{cursor:"pointer"}},React.createElement("i",{className:`fas fa-folder fa-3x mb-3 ${i.slug==="shorts"?"text-danger":"text-warning"}`}),React.createElement("h5",{className:"card-title"},i.name),React.createElement("p",{className:"text-muted mb-0"},i.subfolderCount>0&&React.createElement("span",null,React.createElement("i",{className:"fas fa-folder me-1"}),i.subfolderCount," folder"),i.subfolderCount>0&&(i.videoCount>0||((be=i.videos)==null?void 0:be.length)>0)&&" \u2022 ",(i.videoCount>0||((h=i.videos)==null?void 0:h.length)>0)&&React.createElement("span",null,React.createElement("i",{className:"fas fa-video me-1"}),i.videoCount||((A=i.videos)==null?void 0:A.length)||0," videos"),i.subfolderCount===0&&!i.videoCount&&!((B=i.videos)!=null&&B.length)&&"Tr\u1ED1ng")),React.createElement("div",{className:"card-footer bg-transparent border-0"},React.createElement("div",{className:"btn-group btn-group-sm w-100"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:we=>{we.stopPropagation(),Te(i)}},React.createElement("i",{className:"fas fa-edit"})," S\u1EEDa"),React.createElement("button",{className:"btn btn-outline-danger",onClick:we=>{we.stopPropagation(),m(i)}},React.createElement("i",{className:"fas fa-trash"})," X\xF3a")))))})),React.createElement(VideoFolderModal,{show:Q,folder:K,onClose:()=>L(!1),onSave:G}))}function VideoFolderModal({show:r,folder:c,onClose:p,onSave:M}){const[I,d]=useState({name:"",description:"",sortOrder:0,coverImage:""}),[C,P]=useState(!1),[F,S]=useState(!1);useEffect(()=>{d(c?{name:c.name||"",description:c.description||"",sortOrder:c.sortOrder||0,coverImage:c.coverImage||""}:{name:"",description:"",sortOrder:0,coverImage:""})},[c,r]);const Q=async K=>{const $=K.target.files[0];if($){S(!0);try{const Z=await window.KTM.cloudinary.uploadImage({file:$,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});Z.secure_url&&d(ee=>({...ee,coverImage:Z.secure_url})),window.KTM.cache.remove(CACHE_KEY),showToast("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!","success"),setShowQuickEdit(!1),setEditingItem(null),loadAllData()}catch(Z){console.error("Cloudinary upload error:",Z),alert("L\u1ED7i upload \u1EA3nh: "+(Z.message||Z))}finally{S(!1)}}},L=async K=>{K.preventDefault(),P(!0),await M(I),P(!1)};return r?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa Folder":"T\u1EA1o Folder m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:p})),React.createElement("form",{onSubmit:L},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"T\xEAn folder *"),React.createElement("input",{type:"text",className:"form-control",value:I.name,onChange:K=>d({...I,name:K.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"M\xF4 t\u1EA3"),React.createElement("textarea",{className:"form-control",value:I.description,onChange:K=>d({...I,description:K.target.value}),rows:"2"})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:I.sortOrder,onChange:K=>d({...I,sortOrder:parseInt(K.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"\u1EA2nh b\xECa"),React.createElement("div",{className:"d-flex align-items-start gap-3"},I.coverImage?React.createElement("div",{className:"position-relative"},React.createElement("img",{src:I.coverImage,alt:"Cover",className:"rounded",style:{width:120,height:80,objectFit:"cover"}}),React.createElement("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:()=>d({...I,coverImage:""}),style:{transform:"translate(30%, -30%)"}},React.createElement("i",{className:"fas fa-times"}))):React.createElement("div",{className:"bg-light rounded d-flex align-items-center justify-content-center text-muted",style:{width:120,height:80}},React.createElement("i",{className:"fas fa-image fa-2x"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("input",{type:"file",className:"form-control form-control-sm",accept:"image/*,image/jpeg,image/png,image/gif,image/webp",onChange:Q,disabled:F}),F&&React.createElement("div",{className:"mt-1 text-muted small"},React.createElement("span",{className:"spinner-border spinner-border-sm me-1"}),"\u0110ang upload..."),React.createElement("div",{className:"mt-1 text-muted small"},"Ho\u1EB7c d\xE1n URL:"),React.createElement("input",{type:"url",className:"form-control form-control-sm",placeholder:"https://...",value:I.coverImage,onChange:K=>d({...I,coverImage:K.target.value})}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:p},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:C},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function ProductManager({showToast:r}){const[c,p]=useState([]),[M,I]=useState(!0),[d,C]=useState(!1),[P,F]=useState(null),[S,Q]=useState(""),[L,K]=useState(""),$=["Ty xy lanh","Combo Van 1 tay","Combo Van 2 tay","Combo Van 3 tay","Combo Van 4 tay","Combo Van 5 tay","Trang g\u1EA1t","Ph\u1EE5 ki\u1EC7n","Van \u0111i\u1EC1u khi\u1EC3n"];useEffect(()=>{Z()},[]);const Z=async()=>{I(!0);try{const b=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");p(Array.isArray(b)?b:[])}catch(b){console.error(b),r("L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m","danger")}I(!1)},ee=()=>{F(null),C(!0)},J=b=>{F(b),C(!0)},X=async b=>{if(!(!b||!b.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:b},"L\u1ED7i x\xF3a \u1EA3nh"),window.KTM.cache.remove(CACHE_KEY),r(`\u0110\xE3 x\xF3a ${typeName}`,"success"),loadAllData(),Z()}catch(U){r("L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m","danger")}},le=async b=>{try{const U=P?`${API_BASE}/api/products?id=${P.id}`:`${API_BASE}/api/products`;P?await window.KTM.api.putJSON(U,b,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"):await window.KTM.api.postJSON(U,b,"L\u1ED7i l\u01B0u s\u1EA3n ph\u1EA9m"),r(P?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"Th\xEAm s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),C(!1),Z()}catch(U){r(U.message,"danger")}},ae=async b=>{if(confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a s\u1EA3n ph\u1EA9m "${b.name}"?`))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/products?id=${b.id}`,"L\u1ED7i x\xF3a s\u1EA3n ph\u1EA9m"),r("X\xF3a s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","success"),Z()}catch(U){r(U.message,"danger")}},he=c.filter(b=>{const U=!S||b.name.toLowerCase().includes(S.toLowerCase())||b.code&&b.code.toLowerCase().includes(S.toLowerCase()),k=!L||b.category===L;return U&&k}),ue=b=>{var se;const U=(se=b==null?void 0:b.commission_percent)!=null?se:b==null?void 0:b.commissionPercent,k=U===""||U==null?NaN:Number(U),ce=Number.isFinite(k)?Math.max(0,Math.min(100,k)):5;return`${Number.isInteger(ce)?String(ce):String(Math.round(ce*100)/100)}%`};return React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",null,React.createElement("i",{className:"fas fa-box me-2"}),"S\u1EA3n ph\u1EA9m"),React.createElement("button",{className:"btn-add-product",onClick:ee},React.createElement("i",{className:"fas fa-plus me-1"}),"Th\xEAm m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"d-flex gap-2 mb-2"},React.createElement("div",{className:"flex-grow-1 position-relative"},React.createElement("input",{type:"text",className:"form-control",placeholder:"\u{1F50D} T\xECm s\u1EA3n ph\u1EA9m...",value:S,onChange:b=>Q(b.target.value)})),React.createElement("span",{className:"product-count"},he.length)),React.createElement("select",{className:"form-select",value:L,onChange:b=>K(b.target.value)},React.createElement("option",{value:""},"\u{1F4C1} T\u1EA5t c\u1EA3 danh m\u1EE5c"),$.map(b=>React.createElement("option",{key:b,value:b},b)))),M?React.createElement("div",{className:"text-center py-5"},React.createElement("div",{className:"spinner-border text-warning",style:{width:"2.5rem",height:"2.5rem"}}),React.createElement("p",{className:"text-muted mt-3 mb-0"},"\u0110ang t\u1EA3i...")):he.length===0?React.createElement("div",{className:"empty-state"},React.createElement("i",{className:"fas fa-box-open"}),React.createElement("p",null,"Ch\u01B0a c\xF3 s\u1EA3n ph\u1EA9m n\xE0o"),React.createElement("button",{className:"btn btn-warning",onClick:ee},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m \u0111\u1EA7u ti\xEAn")):React.createElement("div",{className:"product-list"},he.map(b=>React.createElement("div",{key:b.id,className:"product-item d-flex align-items-center gap-3"},b.image?React.createElement("img",{src:b.image,alt:"",className:"product-img"}):React.createElement("div",{className:"product-img-placeholder"},React.createElement("i",{className:"fas fa-image text-muted"})),React.createElement("div",{className:"flex-grow-1 min-width-0"},React.createElement("div",{className:"product-name"},b.name),React.createElement("div",{className:"d-flex flex-wrap gap-1 mb-1"},b.category&&React.createElement("span",{className:"product-badge bg-info bg-opacity-75"},b.category),b.code&&React.createElement("span",{className:"product-badge bg-secondary"},b.code),React.createElement("span",{className:"product-badge bg-warning text-dark",title:"Hoa h\u1ED3ng (%)"},React.createElement("i",{className:"fas fa-percent me-1"}),ue(b))),React.createElement("div",{className:"product-price"},b.price?b.price.replace(/[đ\s]/g,"")+"\u0111":"Li\xEAn h\u1EC7"),b.note&&React.createElement("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"}},b.note)),React.createElement("div",{className:"product-actions"},React.createElement("button",{className:"btn btn-edit",onClick:()=>J(b),title:"S\u1EEDa"},React.createElement("i",{className:"fas fa-pen"})),React.createElement("button",{className:"btn btn-delete",onClick:()=>ae(b),title:"X\xF3a"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement(ProductModal,{show:d,product:P,categories:$,onClose:()=>C(!1),onSave:le}))}function ProductModal({show:r,product:c,categories:p,onClose:M,onSave:I}){const[d,C]=useState({name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5}),[P,F]=useState(!1),[S,Q]=useState(!1);useEffect(()=>{var k,ce;C(c?{name:c.name||"",code:c.code||"",price:c.price||"",image:c.image||"",category:c.category||"",note:c.note||"",sort_order:c.sort_order||0,commission_percent:(ce=(k=c.commission_percent)!=null?k:c.commissionPercent)!=null?ce:5}:{name:"",code:"",price:"",image:"",category:"",note:"",sort_order:0,commission_percent:5})},[c,r]);const[L,K]=React.useState(""),$=k=>window.KTM.money.formatVNDInputDigits(k),[Z,ee]=React.useState(""),J=k=>{const ce=window.KTM.money.nextPriceInputState(k.target.value,Z);ee(ce.digits),C({...d,price:ce.price})},[X,le]=React.useState("");React.useEffect(()=>{c!=null&&c.image&&le(c.image)},[c]);const ae=async k=>{if(!(!k||!k.includes("cloudinary.com")))try{await window.KTM.api.postJSON(`${API_BASE}/api/products?action=delete-image`,{url:k},"L\u1ED7i x\xF3a \u1EA3nh")}catch(ce){console.error("Delete cloudinary image error:",ce)}},he=async(k,ce=2,z)=>{const se=ce*1024*1024,fe=k.type==="image/heic"||k.type==="image/heif"||/\.heic$/i.test(k.name);if(k.size<=se&&!fe)return k;z==null||z("\u0110ang x\u1EED l\xFD \u1EA3nh...");try{const ve=await createImageBitmap(k);z==null||z("\u0110ang n\xE9n \u1EA3nh...");const Se=document.createElement("canvas");let Te=ve.width,G=ve.height;const m=1200;return(Te>m||G>m)&&(Te>G?(G=Math.round(G/Te*m),Te=m):(Te=Math.round(Te/G*m),G=m)),Se.width=Te,Se.height=G,Se.getContext("2d").drawImage(ve,0,0,Te,G),ve.close(),new Promise((Ne,Ie)=>{Se.toBlob(He=>{He?(z==null||z("Ho\xE0n t\u1EA5t!"),Ne(new File([He],k.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}))):Ie(new Error("Kh\xF4ng n\xE9n \u0111\u01B0\u1EE3c \u1EA3nh"))},"image/jpeg",.7)})}catch(ve){throw console.error("createImageBitmap error:",ve),new Error("Kh\xF4ng th\u1EC3 x\u1EED l\xFD \u1EA3nh. Th\u1EED ch\u1ECDn \u1EA3nh kh\xE1c.")}},ue=async k=>{var se,fe;const ce=(se=k.target.files)==null?void 0:se[0];if(!ce)return;if(!(ce.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(ce.name))){alert("Vui l\xF2ng ch\u1ECDn file \u1EA3nh!");return}Q(!0),K("\u0110ang chu\u1EA9n b\u1ECB...");try{const ve=(ce.size/1024/1024).toFixed(1);K(`File ${ve}MB - \u0110ang n\xE9n...`);const Se=await he(ce,2,m=>{K(m)}),Te=(Se.size/1024/1024).toFixed(1);K(`\u0110\xE3 n\xE9n: ${Te}MB - \u0110ang upload...`);const G=await window.KTM.cloudinary.uploadImage({file:Se,cloudName:CLOUDINARY_CLOUD_NAME,uploadPreset:CLOUDINARY_UPLOAD_PRESET});G.secure_url?(d.image&&d.image!==X&&ae(d.image),C(m=>({...m,image:G.secure_url})),K("")):(console.error("Cloudinary error:",G),alert("Upload th\u1EA5t b\u1EA1i: "+(((fe=G.error)==null?void 0:fe.message)||"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")),K(""))}catch(ve){console.error("Upload error:",ve),alert("L\u1ED7i: "+ve.message),K("")}Q(!1),k.target.value=""},b=()=>{d.image&&(d.image!==X&&ae(d.image),C(k=>({...k,image:""})))},U=async k=>{k.preventDefault(),F(!0),X&&d.image&&X!==d.image&&await ae(X),X&&!d.image&&await ae(X),await I(d),F(!1)};return r?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"},React.createElement("div",{className:"modal-content",style:{borderRadius:"16px",overflow:"hidden"}},React.createElement("div",{className:"modal-header border-0 py-3",style:{background:"linear-gradient(135deg, #ffc107 0%, #ffca2c 100%)"}},React.createElement("h6",{className:"modal-title fw-bold",style:{color:"#1a1a2e"}},React.createElement("i",{className:`fas ${c?"fa-edit":"fa-plus-circle"} me-2`}),c?"S\u1EEDa s\u1EA3n ph\u1EA9m":"Th\xEAm s\u1EA3n ph\u1EA9m m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:M})),React.createElement("form",{onSubmit:U},React.createElement("div",{className:"modal-body py-4",style:{maxHeight:"65vh",overflowY:"auto",background:"#f8f9fa"}},React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"position-relative d-inline-block"},d.image?React.createElement(React.Fragment,null,React.createElement("img",{src:d.image,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.15)"}}),React.createElement("button",{type:"button",className:"btn btn-danger position-absolute",onClick:b,style:{top:-10,right:-10,width:28,height:28,padding:0,borderRadius:"50%",boxShadow:"0 2px 8px rgba(220,53,69,0.4)"}},React.createElement("i",{className:"fas fa-times",style:{fontSize:"0.75rem"}}))):React.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{width:110,height:110,borderRadius:"12px",background:"linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)",border:"2px dashed #adb5bd"}},React.createElement("i",{className:"fas fa-image fa-2x text-muted"}))),React.createElement("div",{className:"mt-2"},React.createElement("label",{className:"btn btn-warning btn-sm px-3",style:{borderRadius:"20px"}},React.createElement("i",{className:`fas ${S?"fa-spinner fa-spin":"fa-camera"} me-1`}),S?L||"\u0110ang x\u1EED l\xFD...":"Ch\u1ECDn \u1EA3nh",React.createElement("input",{type:"file",accept:"image/*",onChange:ue,disabled:S,style:{position:"absolute",left:"-9999px",opacity:0,width:1,height:1}})),S&&L&&React.createElement("div",{className:"text-center mt-1",style:{fontSize:11,color:"#6c757d"}},L))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-tag me-1 text-warning"}),"T\xEAn s\u1EA3n ph\u1EA9m *"),React.createElement("input",{type:"text",className:"form-control",value:d.name,onChange:k=>C({...d,name:k.target.value}),required:!0,placeholder:"VD: Combo Van 3 tay + 2 xylanh",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"row g-2 mb-3"},React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-barcode me-1 text-info"}),"M\xE3 SP"),React.createElement("input",{type:"text",className:"form-control",value:d.code,onChange:k=>C({...d,code:k.target.value}),placeholder:"KTM-01",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"col-6"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-dollar-sign me-1 text-success"}),"Gi\xE1"),React.createElement("input",{type:"text",className:"form-control",value:d.price,onChange:J,placeholder:"1.950.000\u0111",inputMode:"numeric",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}}))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-percent me-1 text-secondary"}),"Hoa h\u1ED3ng (%)"),React.createElement("input",{type:"number",className:"form-control",value:d.commission_percent,min:0,max:100,step:.01,placeholder:"5",onChange:k=>C({...d,commission_percent:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-folder me-1 text-primary"}),"Danh m\u1EE5c"),React.createElement("select",{className:"form-select",value:d.category,onChange:k=>C({...d,category:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}},React.createElement("option",{value:""},"Ch\u1ECDn danh m\u1EE5c"),p.map(k=>React.createElement("option",{key:k,value:k},k)))),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label fw-semibold small text-dark mb-1"},React.createElement("i",{className:"fas fa-sticky-note me-1 text-secondary"}),"Ghi ch\xFA"),React.createElement("input",{type:"text",className:"form-control",value:d.note,onChange:k=>C({...d,note:k.target.value}),placeholder:"VD: Th\xEAm d\xE2y l\xE0 2.150.000\u0111",style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"12px"}})),React.createElement("div",{className:"mb-2"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},React.createElement("i",{className:"fas fa-link me-1"}),"URL \u1EA3nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",placeholder:"https://...",value:d.image,onChange:k=>C({...d,image:k.target.value}),style:{borderRadius:"10px",border:"1px solid #dee2e6",padding:"10px",fontSize:"0.9rem"}}))),React.createElement("div",{className:"modal-footer border-0 py-3",style:{background:"#fff"}},React.createElement("button",{type:"button",className:"btn btn-light px-4",onClick:M,style:{borderRadius:"10px"}},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning px-4 fw-semibold",disabled:P,style:{borderRadius:"10px",boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},P?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u s\u1EA3n ph\u1EA9m"))))))):null}function VideoModal({show:r,video:c,onClose:p,onSave:M}){const[I,d]=useState({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),[C,P]=useState(!1),[F,S]=useState("");useEffect(()=>{c?(d({title:c.title||"",youtube_url:`https://www.youtube.com/watch?v=${c.youtubeId}`,thumbnail_url:c.thumb||"",sort_order:c.sortOrder||0}),S(c.thumb)):(d({title:"",youtube_url:"",thumbnail_url:"",sort_order:0}),S(""))},[c,r]);const Q=$=>{const Z=$.match(/(?:youtube\.com\/(?:embed\/|watch\?v=|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return Z?Z[1]:null},L=$=>{d({...I,youtube_url:$});const Z=Q($);Z&&S(`https://img.youtube.com/vi/${Z}/hqdefault.jpg`)},K=async $=>{$.preventDefault(),P(!0),await M(I),P(!1)};return r?React.createElement("div",{className:"modal show d-block",style:{background:"rgba(0,0,0,0.5)"}},React.createElement("div",{className:"modal-dialog modal-dialog-centered"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},c?"S\u1EEDa Video":"Th\xEAm Video m\u1EDBi"),React.createElement("button",{type:"button",className:"btn-close",onClick:p})),React.createElement("form",{onSubmit:K},React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Link YouTube *"),React.createElement("input",{type:"url",className:"form-control",value:I.youtube_url,onChange:$=>L($.target.value),placeholder:"https://www.youtube.com/watch?v=... ho\u1EB7c shorts/...",required:!0}),React.createElement("small",{className:"text-muted"},"H\u1ED7 tr\u1EE3: youtube.com/watch, youtu.be, youtube.com/shorts")),F&&React.createElement("div",{className:"mb-3 text-center"},React.createElement("img",{src:F,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"150px"}})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ti\xEAu \u0111\u1EC1 *"),React.createElement("input",{type:"text",className:"form-control",value:I.title,onChange:$=>d({...I,title:$.target.value}),required:!0})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Th\u1EE9 t\u1EF1"),React.createElement("input",{type:"number",className:"form-control",value:I.sort_order,onChange:$=>d({...I,sort_order:parseInt($.target.value)||0})})),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Thumbnail t\xF9y ch\u1EC9nh (t\xF9y ch\u1ECDn)"),React.createElement("input",{type:"url",className:"form-control",value:I.thumbnail_url,onChange:$=>d({...I,thumbnail_url:$.target.value}),placeholder:"\u0110\u1EC3 tr\u1ED1ng s\u1EBD d\xF9ng thumbnail m\u1EB7c \u0111\u1ECBnh c\u1EE7a YouTube"}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:p},"H\u1EE7y"),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:C},C?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u")))))):null}function AdminApp(){const[r,c]=useState(!1),[p,M]=useState(""),[I,d]=useState(null),[C,P]=useState("search"),[F,S]=useState(null),[Q,L]=useState(""),[K,$]=useState([]),[Z,ee]=useState(null),[J,X]=useState(!1),[le,ae]=useState(null),[he,ue]=useState(!0),[b,U]=useState([]),[k,ce]=useState(()=>loadAdminSettings()),[z,se]=useState(null),[fe,ve]=useState([]);useEffect(()=>{const h=localStorage.getItem("ktm_admin_session");if(h)try{const A=JSON.parse(h);A.expiry>Date.now()?(c(!0),d(A.user)):localStorage.removeItem("ktm_admin_session")}catch(A){localStorage.removeItem("ktm_admin_session")}},[]),useEffect(()=>{r&&re()},[r]),useEffect(()=>{if(!r)return;let h=!1;return(async()=>{try{const A=await fetchAdminSettingsFromServer();if(h)return;ce(A),saveAdminSettings(A)}catch(A){}})(),()=>{h=!0}},[r]);const Se=async(h,A)=>{M("");try{const B=await window.KTM.api.postJSON(`${API_BASE}/api/auth/login`,{username:h,password:A},"\u0110\u0103ng nh\u1EADp th\u1EA5t b\u1EA1i"),we={user:B.user,token:B.token,expiry:Date.now()+100*365*24*60*60*1e3};localStorage.setItem("ktm_admin_session",JSON.stringify(we)),d(B.user),c(!0)}catch(B){M(B.message)}},Te=()=>{localStorage.removeItem("ktm_admin_session"),c(!1),d(null),$([]),ee(null)},G=(h,A="success")=>{const B=Date.now();U(we=>[...we,{id:B,message:h,type:A}])},m=h=>{U(A=>A.filter(B=>B.id!==h))},re=async(h=null)=>{ue(!0);try{const A=h?`${API_BASE}/api/albums?parent_id=${h}`:`${API_BASE}/api/albums?parent_id=root`,B=await window.KTM.api.getJSON(A,"L\u1ED7i t\u1EA3i danh s\xE1ch album");$(Array.isArray(B)?B:[])}catch(A){console.error(A),G("L\u1ED7i t\u1EA3i danh s\xE1ch album","danger")}ue(!1)},Ne=()=>{ae(null),X(!0)},Ie=h=>{ae(h),X(!0)},He=async h=>{try{const A=le&&le.uuid;!A&&z&&(h.parent_id=z.uuid);const B=A?`${API_BASE}/api/albums/${le.uuid||le.id}`:`${API_BASE}/api/albums`;A?await window.KTM.api.putJSON(B,h,"L\u1ED7i c\u1EADp nh\u1EADt"):await window.KTM.api.postJSON(B,h,"L\u1ED7i t\u1EA1o"),G(A?"C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!":"T\u1EA1o th\xE0nh c\xF4ng!","success"),X(!1),re(z==null?void 0:z.uuid)}catch(A){G(A.message,"danger")}},Me=h=>{ee(h)},Ve=h=>{if(h==="root")ve([]),se(null),re(null);else if(h){const A=fe.findIndex(B=>B.uuid===h.uuid);A>=0&&(ve(fe.slice(0,A+1)),se(h),re(h.uuid))}else{const A=[...fe];A.pop();const B=A[A.length-1]||null;ve(A),se(B),re(B==null?void 0:B.uuid)}},Be=async h=>{const A=`X\xF3a folder "${h.title}"? T\u1EA5t c\u1EA3 folder con v\xE0 \u1EA3nh b\xEAn trong s\u1EBD b\u1ECB x\xF3a!`;if(confirm(A))try{await window.KTM.api.deleteJSON(`${API_BASE}/api/albums/${h.uuid||h.id}`,"L\u1ED7i x\xF3a album"),G("\u0110\xE3 x\xF3a","success"),re(z==null?void 0:z.uuid)}catch(B){G("L\u1ED7i x\xF3a album","danger")}};if(!r)return React.createElement(LoginPage,{onLogin:Se,error:p});const i=()=>{const h=new Date,A=h.getFullYear(),B=String(h.getMonth()+1).padStart(2,"0");return`${A}-${B}`};function l(){const[h,A]=useState(()=>{var Le;return String((Le=k==null?void 0:k.ship_percent)!=null?Le:DEFAULT_SHIP_PERCENT)}),[B,we]=useState(!1);return useEffect(()=>{var Le;A(String((Le=k==null?void 0:k.ship_percent)!=null?Le:DEFAULT_SHIP_PERCENT))},[k==null?void 0:k.ship_percent]),React.createElement("div",{className:"product-manager pb-5 mb-4"},React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-cog me-2 text-warning"}),"C\xE0i \u0111\u1EB7t")),React.createElement("div",{className:"card p-3"},React.createElement("form",{onSubmit:async Le=>{Le.preventDefault(),we(!0);const Ce=saveAdminSettings({ship_percent:h});try{const Re=await saveAdminSettingsToServer(Ce);ce(Re),saveAdminSettings(Re),G("\u0110\xE3 l\u01B0u c\xE0i \u0111\u1EB7t v\xE0o DB","success")}catch(Re){ce(Ce),G("Kh\xF4ng l\u01B0u \u0111\u01B0\u1EE3c DB, \u0111\xE3 l\u01B0u t\u1EA1m tr\xEAn m\xE1y","warning")}finally{we(!1)}}},React.createElement("div",{className:"mb-2 text-muted small"},"\xC1p d\u1EE5ng cho th\u1ED1ng k\xEA hoa h\u1ED3ng khi \u0111\u01A1n h\xE0ng kh\xF4ng ghi ph\xED ship trong ghi ch\xFA s\u1EA3n ph\u1EA9m."),React.createElement("div",{className:"mb-3"},React.createElement("label",{className:"form-label"},"Ph\xED ship (%) khi kh\xF4ng c\xF3 ship"),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",value:h,min:"0",max:"100",step:"0.01",onChange:Le=>A(Le.target.value)}),React.createElement("span",{className:"input-group-text"},"%")),React.createElement("div",{className:"form-text"},"M\u1EB7c \u0111\u1ECBnh: ",DEFAULT_SHIP_PERCENT,"%")),React.createElement("button",{type:"submit",className:"btn btn-warning",disabled:B},B?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):"L\u01B0u c\xE0i \u0111\u1EB7t"))))}function be(){const[h,A]=useState(i()),[B,we]=useState(!0),[_e,Le]=useState([]),[Ce,Re]=useState([]),st=normalizeShipPercent(k==null?void 0:k.ship_percent),{parseMoney:gt,parseShipFeeFromNote:ft,getShipFeeForItems:vt,formatNumber:ne,formatVND:je}=window.KTM.money,tt=async()=>{we(!0);try{const[x,Fe]=await Promise.all([window.KTM.api.getJSON(`${API_BASE}/api/orders?month=${encodeURIComponent(h)}`,"L\u1ED7i t\u1EA3i th\u1ED1ng k\xEA"),window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m")]);Le(Array.isArray(x)?x:[]),Re(Array.isArray(Fe)?Fe:[])}catch(x){console.error("Load stats error:",x),Le([]),Re([])}finally{we(!1)}};useEffect(()=>{tt()},[h]);const oe=React.useMemo(()=>{var V;const x={pending:0,processing:0,done:0,paid:0,canceled:0,other:0};let Fe=0,n=0,j=0,ie=0,pe=0,Pe=0,Ae=0;const de=y=>y.customer_id||y.phone||"unknown",Ye=y=>window.KTM.orders.getOrderItems(y),ze=new Map,ct=new Map,nt=new Map,it=5,Je=new Map((Array.isArray(Ce)?Ce:[]).map(y=>{var xe;const R=(xe=y==null?void 0:y.commission_percent)!=null?xe:y==null?void 0:y.commissionPercent,W=Number(R),ge=Number.isFinite(W)?Math.max(0,Math.min(100,W)):it;return[String(y==null?void 0:y.id),ge]}));for(const y of _e){const R=Ye(y);let W=0,ge=0,xe=0;for(const me of R){const ke=Number((me==null?void 0:me.quantity)||0)||0,Xe=gt(me==null?void 0:me.product_price),Ge=ke*Xe,dt=String((me==null?void 0:me.product_id)||""),yt=Je.has(dt)?Je.get(dt):it,wt=(Number(yt)||0)/100;W+=ke,ge+=Ge,xe+=Ge*wt;const ut=(me==null?void 0:me.product_id)||"unknown",et=ze.get(dt)||{product_id:ut,product_name:(me==null?void 0:me.product_name)||"\u2014",product_code:(me==null?void 0:me.product_code)||"",orders:0,quantity:0,revenue:0};et.orders+=1,et.quantity+=ke,et.revenue+=Ge,ze.set(ut,et)}const Ee=vt(R),Ze=Number((V=y==null?void 0:y.adjustment_amount)!=null?V:0)||0,Oe=ge+(Ee.found?Ee.fee:0)+Ze,Qe=ge+Ze,mt=!Ee.found&&st>0&&ge>0?ge*st/100:0,Nt=ge>0?xe/ge:it/100,ot=xe+Ze*Nt-mt*Nt;Fe+=W,n+=Oe,ie+=Qe,Pe+=ot;const Y=y.status==="done"||y.status==="paid";y.status==="pending"?x.pending+=1:y.status==="processing"?x.processing+=1:y.status==="canceled"?x.canceled+=1:y.status==="paid"?(x.paid+=1,x.done+=1,j+=Oe,pe+=Qe,Ae+=ot):y.status==="done"?(x.done+=1,j+=Oe,pe+=Qe,Ae+=ot):x.other+=1;const qe=de(y),Ke=ct.get(qe)||{key:qe,customer_name:y.customer_name||"",phone:y.phone||"",orders:0,quantity:0,revenue:0};Ke.orders+=1,Ke.quantity+=W,Ke.revenue+=Oe,!Ke.customer_name&&y.customer_name&&(Ke.customer_name=y.customer_name),!Ke.phone&&y.phone&&(Ke.phone=y.phone),ct.set(qe,Ke);const De=y.created_at?new Date(y.created_at):null;if(De&&!Number.isNaN(De.getTime())){const me=`${De.getFullYear()}-${String(De.getMonth()+1).padStart(2,"0")}-${String(De.getDate()).padStart(2,"0")}`,ke=nt.get(me)||{day:me,orders:0,quantity:0,revenue:0,doneOrders:0,doneRevenue:0};ke.orders+=1,ke.quantity+=W,ke.revenue+=Oe,Y&&(ke.doneOrders+=1,ke.doneRevenue+=Oe),nt.set(me,ke)}}const t=Array.from(ze.values()).sort((y,R)=>R.revenue-y.revenue),f=Array.from(ct.values()).sort((y,R)=>R.revenue-y.revenue),v=Array.from(nt.values()).sort((y,R)=>y.day.localeCompare(R.day)),T=ct.size,D=_e.length?Math.round(n/_e.length):0,N=_e.length?Fe/_e.length:0,g=Math.round(Ae),O=Math.round(Pe);return{statusCounts:x,totalQty:Fe,totalRevenue:n,doneRevenue:j,tempCommission:g,tempCommissionAll:O,products:t,customers:f,days:v,uniqueCustomers:T,avgOrderValue:D,avgQtyPerOrder:N}},[_e,Ce,h]);return React.createElement("div",{className:"product-manager pb-5 mb-4 stats-manager"},React.createElement(Loading,{show:B}),React.createElement("div",{className:"product-header"},React.createElement("h5",{className:"mb-0"},React.createElement("i",{className:"fas fa-chart-column me-2 text-warning"}),"Th\u1ED1ng k\xEA"),React.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:tt,disabled:B},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"Ch\u1ECDn th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:h,onChange:x=>A(x.target.value),"aria-label":"Ch\u1ECDn th\xE1ng"}))),React.createElement("div",{className:"col-12 col-md-7 d-flex gap-2 justify-content-md-end"},React.createElement("div",{className:"d-flex flex-wrap gap-2 align-self-center"},React.createElement("span",{className:"badge rounded-pill bg-secondary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-truck me-1"}),"Ship \u01B0\u1EDBc t\xEDnh: ",st,"%"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-receipt me-1"}),ne(_e.length)," \u0111\u01A1n"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-user me-1"}),ne(oe.uniqueCustomers)," kh\xE1ch"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-boxes-stacked me-1"}),ne(oe.totalQty)," SL"),React.createElement("span",{className:"badge rounded-pill bg-primary bg-opacity-10 text-dark"},React.createElement("i",{className:"fas fa-hand-holding-dollar me-1"}),"\u0110\xE3 nh\u1EADn ti\u1EC1n: ",ne(oe.statusCounts.paid),"/",ne(oe.statusCounts.done)))))),React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng \u0111\u01A1n"),React.createElement("i",{className:"fas fa-receipt text-dark"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},ne(_e.length)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (t\u1EA1m t\xEDnh)"),React.createElement("i",{className:"fas fa-sack-dollar text-warning"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},je(oe.totalRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Doanh thu (Ho\xE0n th\xE0nh)"),React.createElement("i",{className:"fas fa-circle-check text-success"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},je(oe.doneRevenue)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-info bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng s\u1EBD nh\u1EADn (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-chart-line text-info"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},je(oe.tempCommission)))),React.createElement("div",{className:"col-6 col-md-3"},React.createElement("div",{className:"card p-3 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"text-muted small"},"Hoa h\u1ED3ng t\u1ED5ng (theo % SP - tr\u1EEB ship \u01B0\u1EDBc t\xEDnh)"),React.createElement("i",{className:"fas fa-coins text-primary"})),React.createElement("div",{className:"fs-4 fw-semibold text-dark"},je(oe.tempCommissionAll))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-layer-group me-2 text-warning"}),"T\u1ED5ng quan tr\u1EA1ng th\xE1i"),React.createElement("span",{className:"badge rounded-pill bg-dark bg-opacity-10 text-dark"},"SL TB/\u0111\u01A1n: ",oe.avgQtyPerOrder?oe.avgQtyPerOrder.toFixed(2):"0.00")),React.createElement("div",{className:"d-md-none mt-2"},React.createElement("div",{className:"row g-2"},React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-secondary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("div",{className:"fw-semibold"},ne(oe.statusCounts.pending)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-warning bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("div",{className:"fw-semibold"},ne(oe.statusCounts.processing)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-danger bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"H\u1EE7y \u0111\u01A1n"),React.createElement("div",{className:"fw-semibold"},ne(oe.statusCounts.canceled)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-success bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh"),React.createElement("div",{className:"fw-semibold"},ne(oe.statusCounts.done)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-primary bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("div",{className:"fw-semibold"},ne(oe.statusCounts.paid)))),React.createElement("div",{className:"col-6"},React.createElement("div",{className:"card p-2 border-0 shadow-sm bg-dark bg-opacity-10"},React.createElement("div",{className:"text-muted small"},"T\u1ED5ng SL"),React.createElement("div",{className:"fw-semibold"},ne(oe.totalQty)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ch\u1EDD x\u1EED l\xFD"),React.createElement("th",null,"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("th",null,"H\u1EE7y \u0111\u01A1n"),React.createElement("th",null,"Ho\xE0n th\xE0nh"),React.createElement("th",null,"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("th",null,"Kh\xE1c"),React.createElement("th",null,"T\u1ED5ng SL"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,ne(oe.statusCounts.pending)),React.createElement("td",null,ne(oe.statusCounts.processing)),React.createElement("td",null,ne(oe.statusCounts.canceled)),React.createElement("td",null,ne(oe.statusCounts.done)),React.createElement("td",null,ne(oe.statusCounts.paid)),React.createElement("td",null,ne(oe.statusCounts.other)),React.createElement("td",null,ne(oe.totalQty))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-box me-2 text-info"}),"Top s\u1EA3n ph\u1EA9m"),React.createElement("span",{className:"badge rounded-pill bg-info bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},oe.products.slice(0,10).map(x=>React.createElement("div",{key:x.product_id,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-info"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},x.product_name),React.createElement("div",{className:"text-muted small text-truncate"},x.product_code?`#${x.product_code} \u2022 `:"",ne(x.orders)," \u0111\u01A1n \u2022 ",ne(x.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},je(x.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"M\xE3"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,oe.products.slice(0,10).map(x=>React.createElement("tr",{key:x.product_id},React.createElement("td",null,x.product_name),React.createElement("td",null,x.product_code||"\u2014"),React.createElement("td",null,ne(x.orders)),React.createElement("td",null,ne(x.quantity)),React.createElement("td",{className:"fw-semibold"},je(x.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-user-group me-2 text-warning"}),"Top kh\xE1ch h\xE0ng"),React.createElement("span",{className:"badge rounded-pill bg-warning bg-opacity-10 text-dark"},"Theo doanh thu \u2022 Top 10")),React.createElement("div",{className:"d-md-none mt-2"},oe.customers.slice(0,10).map(x=>React.createElement("div",{key:x.key,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-warning"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,flex:1}},React.createElement("div",{className:"text-truncate"},x.customer_name||"\u2014"),React.createElement("div",{className:"text-muted small text-truncate"},x.phone||"\u2014"," \u2022 ",ne(x.orders)," \u0111\u01A1n \u2022 ",ne(x.quantity)," SL")),React.createElement("div",{className:"fw-semibold text-nowrap"},je(x.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"Doanh thu"))),React.createElement("tbody",null,oe.customers.slice(0,10).map(x=>React.createElement("tr",{key:x.key},React.createElement("td",null,x.customer_name||"\u2014"),React.createElement("td",null,x.phone||"\u2014"),React.createElement("td",null,ne(x.orders)),React.createElement("td",null,ne(x.quantity)),React.createElement("td",{className:"fw-semibold"},je(x.revenue)))))))),React.createElement("div",{className:"card p-3 mt-3 mb-4"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},React.createElement("i",{className:"fas fa-calendar-day me-2 text-success"}),"Theo ng\xE0y"),React.createElement("span",{className:"badge rounded-pill bg-success bg-opacity-10 text-dark"},"DT (t\u1EA1m t\xEDnh) & ho\xE0n th\xE0nh")),React.createElement("div",{className:"d-md-none mt-2"},oe.days.map(x=>React.createElement("div",{key:x.day,className:"card mb-2 p-2 border-0 shadow-sm border-start border-4 border-success"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"fw-semibold"},x.day),React.createElement("div",{className:"text-muted small"},ne(x.orders)," \u0111\u01A1n \u2022 ",ne(x.quantity)," SL"),React.createElement("div",{className:"text-muted small"},"Ho\xE0n th\xE0nh: ",ne(x.doneOrders)," \u2022 ",je(x.doneRevenue))),React.createElement("div",{className:"fw-semibold text-nowrap"},je(x.revenue)))))),React.createElement("div",{className:"d-none d-md-block table-responsive mt-2"},React.createElement("table",{className:"table table-bordered mb-0"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Ng\xE0y"),React.createElement("th",null,"\u0110\u01A1n"),React.createElement("th",null,"SL"),React.createElement("th",null,"DT (t\u1EA1m t\xEDnh)"),React.createElement("th",null,"\u0110\u01A1n ho\xE0n th\xE0nh"),React.createElement("th",null,"DT ho\xE0n th\xE0nh"))),React.createElement("tbody",null,oe.days.map(x=>React.createElement("tr",{key:x.day},React.createElement("td",null,x.day),React.createElement("td",null,ne(x.orders)),React.createElement("td",null,ne(x.quantity)),React.createElement("td",{className:"fw-semibold"},je(x.revenue)),React.createElement("td",null,ne(x.doneOrders)),React.createElement("td",{className:"fw-semibold"},je(x.doneRevenue)))))))))}return React.createElement("div",null,React.createElement(Sidebar,{activeMenu:C,onMenuChange:h=>{P(h),h==="albums"&&(se(null),ve([]),re(null))},onLogout:Te,currentUser:I}),React.createElement("div",{className:"main-content"},C==="albums"&&!Z&&React.createElement(AlbumList,{albums:K,loading:he,currentFolder:z,breadcrumb:fe,onSelect:Me,onCreate:Ne,onEdit:Ie,onDelete:Be,onBack:Ve}),C==="search"&&React.createElement(SearchCenter,{showToast:G,onNavigate:(h,A,B)=>{P(h),h==="orders"&&A==="create"&&(S(Date.now()),L((B==null?void 0:B.productId)||""))}}),C==="albums"&&Z&&React.createElement(AlbumDetail,{album:Z,parentAlbum:fe.length>0?fe[fe.length-1]:null,onBack:()=>{if(Z.parentId){const h=fe.findIndex(A=>A.uuid===Z.parentId);h>=0?ee(fe[h]):ee(null)}else ee(null)},onRefresh:()=>re(z==null?void 0:z.uuid),showToast:G,onNavigateToFolder:h=>{ve(A=>[...A,Z]),ee(h)},onEditSubfolder:h=>{ae(h),X(!0)}}),C==="videos"&&React.createElement(VideoList,{showToast:G}),C==="products"&&React.createElement(ProductManager,{showToast:G}),C==="orders"&&React.createElement(OrderManager,{autoOpenCreateToken:F,autoOpenCreateProductId:Q,showToast:G}),C==="stats"&&React.createElement(be,null),C==="settings"&&React.createElement(l,null)),React.createElement("nav",{className:"mobile-bottom-nav"},React.createElement("div",{className:"nav-items"},React.createElement("a",{href:"#",className:`nav-item ${C==="search"?"active":""}`,onClick:h=>{h.preventDefault(),P("search")}},React.createElement("i",{className:"fas fa-search"}),React.createElement("span",null,"Tra c\u1EE9u")),React.createElement("a",{href:"#",className:`nav-item ${C==="albums"?"active":""}`,onClick:h=>{h.preventDefault(),P("albums"),ee(null)}},React.createElement("i",{className:"fas fa-images"}),React.createElement("span",null,"Album")),React.createElement("a",{href:"#",className:`nav-item ${C==="videos"?"active":""}`,onClick:h=>{h.preventDefault(),P("videos")}},React.createElement("i",{className:"fas fa-video"}),React.createElement("span",null,"Video")),React.createElement("a",{href:"#",className:`nav-item ${C==="products"?"active":""}`,onClick:h=>{h.preventDefault(),P("products")}},React.createElement("i",{className:"fas fa-box"}),React.createElement("span",null,"S\u1EA3n ph\u1EA9m")),React.createElement("a",{href:"#",className:`nav-item ${C==="orders"?"active":""}`,onClick:h=>{h.preventDefault(),P("orders")}},React.createElement("i",{className:"fas fa-receipt"}),React.createElement("span",null,"\u0110\u01A1n h\xE0ng")),React.createElement("a",{href:"#",className:`nav-item ${C==="stats"?"active":""}`,onClick:h=>{h.preventDefault(),P("stats")}},React.createElement("i",{className:"fas fa-chart-column"}),React.createElement("span",null,"Th\u1ED1ng k\xEA")))),React.createElement(AlbumModal,{show:J,album:le,parentId:z==null?void 0:z.uuid,onClose:()=>X(!1),onSave:He}),React.createElement("div",{className:"toast-container"},b.map(h=>React.createElement(Toast,{key:h.id,message:h.message,type:h.type,onClose:()=>m(h.id)}))))}ReactDOM.render(React.createElement(AdminApp,null),document.getElementById("root"));function OrderManager({autoOpenCreateToken:r,autoOpenCreateProductId:c,showToast:p}){const[M,I]=useState([]),[d,C]=useState([]),[P,F]=useState(!0),[S,Q]=useState(!1),[L,K]=useState(!1),[$,Z]=useState(null),[ee,J]=useState(null),[X,le]=useState(!1),[ae,he]=useState(""),[ue,b]=useState(""),[U,k]=useState(!1),[ce,z]=useState(!1),[se,fe]=useState(null),[ve,Se]=useState(!1),[Te,G]=useState([]),[m,re]=useState({customer_name:"",phone:"",address:"",items:[{product_id:"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),[Ne,Ie]=useState([""]),[He,Me]=useState(null),Ve=useRef({}),[Be,i]=useState([]),[l,be]=useState(null),h=useRef(null),A=useRef(null),B=useRef(0),we=useRef(new Map),_e=useRef(""),Le=useRef(null),Ce=useRef(0),Re=useRef(null),st=9,gt=150,ft=24*60*60*1e3,vt=5*60*1e3,ne="ktm_customer_lookup_cache_v1",je=200,tt=3,oe=24*60*60*1e3,x=e=>{try{const s=new Date(e==null?void 0:e.created_at).getTime();if(!Number.isFinite(s))return 0;const a=Date.now()-s;return!Number.isFinite(a)||a<=0?0:Math.floor(a/oe)}catch(s){return 0}},Fe=e=>String((e==null?void 0:e.status)||"").trim()!=="pending"?!1:x(e)>=tt,n=e=>{re({customer_name:"",phone:"",address:"",items:[{product_id:e||"",quantity:1}],adjustment_amount:0,adjustment_note:"",status:"pending"}),Ie([""]),fe(null),Me(null)};useEffect(()=>{const e=s=>{var o;if(He==null)return;const a=(o=Ve.current)==null?void 0:o[He];a&&!a.contains(s.target)&&Me(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[He]);const j=e=>window.KTM.money.parseMoney(e),ie=e=>window.KTM.money.parseSignedMoney(e),pe=e=>window.KTM.money.formatVND(e),Pe=e=>window.KTM.money.parseShipFeeFromNote(e),Ae=e=>window.KTM.phone.isValid(e),de=e=>window.KTM.phone.normalize(e),Ye=()=>{var e;try{const s=localStorage.getItem(ne);if(!s)return;const a=JSON.parse(s);if(!a||typeof a!="object")return;const o=Object.entries(a);for(const[u,_]of o)!u||!_||typeof _!="object"||(e=we.current)==null||e.set(String(u),_)}catch(s){}},ze=()=>{try{const e=we.current;if(!e||typeof e.entries!="function")return;const s=Array.from(e.entries()).filter(([o,u])=>o&&u&&typeof u=="object"&&Number.isFinite(u.ts)).sort((o,u)=>(Number(u[1].ts)||0)-(Number(o[1].ts)||0)).slice(0,je),a={};for(const[o,u]of s)a[o]=u;localStorage.setItem(ne,JSON.stringify(a))}catch(e){}};useEffect(()=>{Ye()},[]);const ct=e=>{const s=de(e);if(!s)return null;const a=Array.isArray(M)?M:[];let o=null,u=-1;for(const _ of a){if(!_||de(_.phone||"")!==s)continue;const te=new Date(_.created_at).getTime(),H=Number.isFinite(te)?te:0;H>=u&&(u=H,o=_)}return o?{name:String(o.customer_name||"").trim(),address:String(o.address||"").trim()}:null},nt=(e,s)=>{e&&re(a=>s&&de(a.phone)!==s?a:{...a,customer_name:e.name||a.customer_name,address:e.address||a.address})},it=e=>{const s=ct(e);if(!s)return;const a=de(e);re(o=>{if(a&&de(o.phone)!==a)return o;const u={...o};return!String(o.customer_name||"").trim()&&s.name&&(u.customer_name=s.name),!String(o.address||"").trim()&&s.address&&(u.address=s.address),u})},Je=async e=>{var u,_,te;const s=de(e);if(!s)return;it(s);const a=(u=we.current)==null?void 0:u.get(s);if(a&&Number.isFinite(a.ts)){const H=Date.now()-a.ts,w=a.status==="found"?ft:vt;if(H>=0&&H<=w){fe({status:a.status,phone:s,customer:a.customer}),a.status==="found"&&a.customer&&nt(a.customer,s);return}}const o=++B.current;fe({status:"loading",phone:s});try{const H=await window.KTM.api.getJSON(`${API_BASE}/api/customers?phone=${encodeURIComponent(s)}`,"L\u1ED7i tra c\u1EE9u kh\xE1ch");if(B.current!==o)return;if(H&&H.exists&&H.customer){(_=we.current)==null||_.set(s,{ts:Date.now(),status:"found",customer:H.customer}),ze(),fe({status:"found",phone:s,customer:H.customer}),nt(H.customer,s);return}(te=we.current)==null||te.set(s,{ts:Date.now(),status:"not-found",customer:null}),ze(),fe({status:"not-found",phone:s})}catch(H){if(B.current!==o)return;console.error("Customer lookup error:",H),fe({status:"error",phone:s})}},t=e=>{const s=de(e),a=ct(s);re(u=>{const _={...u,phone:s};return a&&(!String(u.customer_name||"").trim()&&a.name&&(_.customer_name=a.name),!String(u.address||"").trim()&&a.address&&(_.address=a.address)),_}),Se(!1),A.current&&(clearTimeout(A.current),A.current=null);const o=s;if(o.length<st){fe(null);return}if(Ae(o)&&o!==_e.current){_e.current=o,Je(o);return}A.current=setTimeout(()=>{const u=de(s);Ae(u)&&u!==_e.current&&(_e.current=u,Je(u))},gt)},f=()=>{const e=de(m.phone);e.length<st||Ae(e)&&e!==_e.current&&(_e.current=e,Je(e))};useEffect(()=>(ce?(document.body.classList.add("order-modal-open"),document.body.style.overflow="hidden"):(document.body.classList.remove("order-modal-open"),document.body.style.overflow=""),()=>{document.body.classList.remove("order-modal-open"),document.body.style.overflow=""}),[ce]);const v=Array.isArray(m.items)?m.items.length:0;useEffect(()=>{if(!ce){Ce.current=v;return}v>Ce.current&&setTimeout(()=>{const e=Le.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},0),Ce.current=v},[ce,v]),useEffect(()=>()=>{A.current&&(clearTimeout(A.current),A.current=null)},[]),useEffect(()=>{W()},[]),useEffect(()=>{ge()},[ae]),useEffect(()=>{xe()},[]),useEffect(()=>{r&&h.current!==r&&(h.current=r,Ze(c))},[r]);const T=e=>e==="pending"?"Ch\u1EDD x\u1EED l\xFD":e==="processing"?"\u0110ang v\u1EADn chuy\u1EC3n":e==="done"?"Ho\xE0n th\xE0nh":e==="paid"?"\u0110\xE3 nh\u1EADn ti\u1EC1n":e==="canceled"?"H\u1EE7y \u0111\u01A1n":e||"",D=e=>e==="pending"?"bg-secondary":e==="processing"?"bg-warning text-dark":e==="done"?"bg-success":e==="paid"?"bg-primary":e==="canceled"?"bg-danger":"bg-light text-dark",N=React.useMemo(()=>window.KTM.orders.sortOrders(M),[M]),g=React.useMemo(()=>window.KTM.orders.sortOrders(d),[d]),O=React.useMemo(()=>{const s=(Array.isArray(g)?g:[]).filter(a=>Fe(a));return s.sort((a,o)=>{const u=new Date(a==null?void 0:a.created_at).getTime(),_=new Date(o==null?void 0:o.created_at).getTime();return(Number.isFinite(u)?u:0)-(Number.isFinite(_)?_:0)}),s},[g]),V=React.useMemo(()=>U?O:N,[U,O,N]),y=React.useMemo(()=>{if(U)return V;const e=String(ue||"").trim();return e?(Array.isArray(V)?V:[]).filter(s=>String((s==null?void 0:s.status)||"").trim()===e):V},[V,ue,U]),R=e=>window.KTM.date.formatDateTime(e),W=async()=>{try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/products`,"L\u1ED7i t\u1EA3i s\u1EA3n ph\u1EA9m");i(Array.isArray(e)?e:[])}catch(e){console.error("Load products error:",e),i([])}},ge=async()=>{F(!0);try{let e=`${API_BASE}/api/orders`;ae&&(e+=`?month=${ae}`);const s=await window.KTM.api.getJSON(e,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");I(Array.isArray(s)?s:[]),xe()}catch(e){console.error("Load orders error:",e),I([])}finally{F(!1)}},xe=async()=>{Q(!0);try{const e=await window.KTM.api.getJSON(`${API_BASE}/api/orders`,"L\u1ED7i t\u1EA3i \u0111\u01A1n h\xE0ng");C(Array.isArray(e)?e:[])}catch(e){console.error("Load all orders error:",e),C([])}finally{Q(!1)}},Ee=e=>{var a;be(e.id);const s=Array.isArray(e.items)&&e.items.length?e.items.map(o=>{var u;return{product_id:(o==null?void 0:o.product_id)||"",quantity:Number((u=o==null?void 0:o.quantity)!=null?u:1)||1}}).filter(o=>o.product_id):[{product_id:e.product_id||"",quantity:Number(e.quantity||1)||1}];re({customer_name:e.customer_name||"",phone:de(e.phone||""),address:e.address||"",items:s.length?s:[{product_id:"",quantity:1}],adjustment_amount:Number((a=e==null?void 0:e.adjustment_amount)!=null?a:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",status:e.status||"pending"}),Ie(new Array(s.length?s.length:1).fill("")),G(new Array(s.length?s.length:1).fill(!0)),fe(null),z(!0),e.phone&&Je(de(e.phone))};function Ze(e){be(null),n(e||""),Se(!1),G([]),z(!0)}const Oe=()=>{L||X||(z(!1),be(null),n(""),Se(!1),G([]))},Qe=async()=>{var H,w,E;if(!l||X||L)return;const e=(Array.isArray(M)?M:[]).find(q=>String(q==null?void 0:q.id)===String(l))||null,s=String((e==null?void 0:e.status)||(m==null?void 0:m.status)||"").trim();if(s==="done"||s==="paid"||s==="canceled"){const q="Kh\xF4ng th\u1EC3 t\xE1ch: \u0111\u01A1n \u0111\xE3 ho\xE0n th\xE0nh/\u0111\xE3 nh\u1EADn ti\u1EC1n/\u0111\xE3 h\u1EE7y.";typeof p=="function"?p(q,"warning"):alert(q);return}const a=de(m.phone),u=(Array.isArray(m.items)?m.items:[]).map((q,$e)=>{var ye;return{idx:$e,product_id:String((q==null?void 0:q.product_id)||"").trim(),quantity:Number((ye=q==null?void 0:q.quantity)!=null?ye:0)}}).filter(q=>q.product_id&&Number.isFinite(q.quantity)&&q.quantity>0);if(u.length<2){const q="C\u1EA7n \xEDt nh\u1EA5t 2 s\u1EA3n ph\u1EA9m \u0111\u1EC3 t\xE1ch \u0111\u01A1n.";typeof p=="function"?p(q,"warning"):alert(q);return}const _=[],te=[];for(const q of u){const $e=!!Te[q.idx],ye={product_id:q.product_id,quantity:q.quantity};$e?_.push(ye):te.push(ye)}if(!_.length||!te.length){const q="Ch\u1ECDn m\u1ED9t s\u1ED1 s\u1EA3n ph\u1EA9m \u201CGiao \u0111\u1EE3t 1\u201D, v\xE0 \u0111\u1EC3 l\u1EA1i \xEDt nh\u1EA5t 1 s\u1EA3n ph\u1EA9m \u201CCh\u1EDD h\xE0ng\u201D.";typeof p=="function"?p(q,"warning"):alert(q);return}le(!0);try{const q=ie(m.adjustment_amount),$e=(m.adjustment_note||"").trim(),ye={customer_name:m.customer_name,phone:a,address:m.address,adjustment_amount:q,adjustment_note:$e,status:"processing",items:_,product_id:_[0].product_id,quantity:_[0].quantity,split_seq:1},at=await window.KTM.api.postJSON(`${API_BASE}/api/orders`,ye,"L\u1ED7i t\xE1ch \u0111\u01A1n (t\u1EA1o \u0111\u01A1n giao ngay)"),lt=(E=(w=at==null?void 0:at.id)!=null?w:(H=at==null?void 0:at.order)==null?void 0:H.id)!=null?E:null;if(!lt)throw new Error("T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i: kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c ID \u0111\u01A1n giao ngay");const Ct={id:l,customer_name:m.customer_name,phone:a,address:m.address,adjustment_amount:0,adjustment_note:"",status:"pending",items:te,product_id:te[0].product_id,quantity:te[0].quantity,parent_order_id:String(lt),split_seq:2};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${l}`,Ct,"L\u1ED7i t\xE1ch \u0111\u01A1n (c\u1EADp nh\u1EADt ph\u1EA7n ch\u1EDD h\xE0ng)"),Oe(),ge();const ht=lt?`\u0110\xE3 t\xE1ch \u0111\u01A1n. \u0110\u01A1n giao ngay: #${lt}`:"\u0110\xE3 t\xE1ch \u0111\u01A1n.";typeof p=="function"?p(ht,"success"):alert(ht)}catch(q){console.error(q);const $e=(q==null?void 0:q.message)||"T\xE1ch \u0111\u01A1n th\u1EA5t b\u1EA1i";typeof p=="function"?p($e,"danger"):alert($e)}finally{le(!1)}},mt=e=>{if(!e)return"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --";const s=String(e),a=Be.find(o=>String(o==null?void 0:o.id)===s);return a?`${a.name}${a.code?` (${a.code})`:""}`:"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"},Nt=e=>{const s=String(Ne[e]||"").trim().toLowerCase();return s?Be.filter(a=>{const o=String((a==null?void 0:a.name)||"").toLowerCase(),u=String((a==null?void 0:a.code)||"").toLowerCase();return o.includes(s)||u.includes(s)}):Be},ot=e=>{if(!e)return null;const s=String(e);return Be.find(a=>String(a==null?void 0:a.id)===s)||null},Y=e=>window.KTM.orders.getOrderItems(e),qe=e=>window.KTM.orders.getOrderTotalQty(e),Ke=e=>window.KTM.orders.getOrderProductSummary(e,ot),De=e=>window.KTM.orders.getOrderItemRows(e,ot),me=e=>window.KTM.orders.getOrderAdjustmentMoney(e),ke=e=>{var E;const s=Y(e),a=De(e),o=dt(s),u=Ge(s),_=u.fee,te=me(e),H=o+_+te,w=[];if(w.push(`\u0110\u01A0N H\xC0NG #${(E=e==null?void 0:e.id)!=null?E:""}`.trim()),e!=null&&e.customer_name&&w.push(`Kh\xE1ch: ${e.customer_name}`),e!=null&&e.phone&&w.push(`S\u0110T: ${e.phone}`),e!=null&&e.address&&w.push(`\u0110\u1ECBa ch\u1EC9: ${e.address}`),e!=null&&e.status&&w.push(`Tr\u1EA1ng th\xE1i: ${T(e.status)}`),e!=null&&e.created_at&&w.push(`Th\u1EDDi gian: ${R(e.created_at)}`),w.push(""),w.push("S\u1EA3n ph\u1EA9m:"),a.length)for(const q of a)w.push(`- ${q.name} x${q.qty}`);else{const q=Ke(e);q&&q!=="\u2014"&&w.push(`- ${q}`)}return w.push(""),w.push(`T\u1EA1m t\xEDnh: ${pe(o)}`),w.push(`Ship: ${pe(u.found?_:0)}`),te!==0&&w.push(`\u0110i\u1EC1u ch\u1EC9nh: ${pe(te)}`),e!=null&&e.adjustment_note&&w.push(`Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh: ${e.adjustment_note}`),w.push(`T\u1ED5ng: ${pe(H)}`),w.filter(Boolean).join(`
`)},Xe=async e=>{try{const s=ke(e);await window.KTM.clipboard.writeText(s),typeof p=="function"?p("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng","success"):alert("\u0110\xE3 copy th\xF4ng tin \u0111\u01A1n h\xE0ng")}catch(s){console.error(s),typeof p=="function"?p("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)","danger"):alert("Copy th\u1EA5t b\u1EA1i (tr\xECnh duy\u1EC7t ch\u1EB7n clipboard)")}},Ge=e=>window.KTM.orders.getOrderShipInfo(e,ot),dt=e=>window.KTM.orders.getItemsSubtotal(e,ot),yt=e=>{try{const s=e instanceof Date?e:new Date(e);if(!s||Number.isNaN(s.getTime()))return"";const a=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0");return`${a}-${o}`}catch(s){return""}},wt=()=>ae?String(ae):yt(new Date),ut=e=>{const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=de((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim().toLowerCase(),u=ie(e==null?void 0:e.adjustment_amount),te=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(H=>{var w;return{product_id:String((H==null?void 0:H.product_id)||"").trim(),quantity:Number((w=H==null?void 0:H.quantity)!=null?w:0)}}).filter(H=>H.product_id&&Number.isFinite(H.quantity)&&H.quantity>0).sort((H,w)=>H.product_id<w.product_id?-1:H.product_id>w.product_id?1:H.quantity-w.quantity);return JSON.stringify({name:s,phone:a,address:o,items:te,adj:u})},et=React.useMemo(()=>{const e=de((m==null?void 0:m.phone)||"");if(!e)return{count:0,orders:[],monthKey:wt()};const s=wt(),a=(Array.isArray(M)?M:[]).filter(o=>{if(!o||l&&String(o.id)===String(l)||de(o.phone||"")!==e)return!1;const u=yt(o.created_at);return u&&u===s}).sort((o,u)=>{const _=new Date(o.created_at).getTime(),te=new Date(u.created_at).getTime();return(Number.isFinite(te)?te:0)-(Number.isFinite(_)?_:0)});return{count:a.length,orders:a,monthKey:s}},[M,m==null?void 0:m.phone,ae,l]),Ot=e=>{var H;const s=String((e==null?void 0:e.customer_name)||"").trim().toLowerCase(),a=de((e==null?void 0:e.phone)||""),o=String((e==null?void 0:e.address)||"").trim().toLowerCase(),u=ie((H=e==null?void 0:e.adjustment_amount)!=null?H:0),_=Y(e),te=(Array.isArray(_)?_:[]).map(w=>{var E;return{product_id:String((w==null?void 0:w.product_id)||"").trim(),quantity:Number((E=w==null?void 0:w.quantity)!=null?E:0)}}).filter(w=>w.product_id&&Number.isFinite(w.quantity)&&w.quantity>0).sort((w,E)=>w.product_id<E.product_id?-1:w.product_id>E.product_id?1:w.quantity-E.quantity);return JSON.stringify({name:s,phone:a,address:o,items:te,adj:u})},$t=React.useMemo(()=>{if(l)return"";const e=de((m==null?void 0:m.phone)||"");if(!e)return"";const s=wt(),a=ut(m),o=Array.isArray(M)?M:[];for(const u of o){if(!u||l&&String(u.id)===String(l)||de(u.phone||"")!==e)continue;const _=yt(u.created_at);if(!_||_!==s)continue;const te=Ot(u);if(te&&te===a)return`\u0110\u01A1n n\xE0y gi\u1ED1ng 100% m\u1ED9t \u0111\u01A1n trong th\xE1ng ${s}${u!=null&&u.id?` (#${u.id})`:""}`}return""},[M,m,ae,l]),Tt=e=>{var kt;const s=[],a=[],o=String((e==null?void 0:e.customer_name)||"").trim(),u=de((e==null?void 0:e.phone)||""),_=String((e==null?void 0:e.address)||"").trim();o||s.push("Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng"),u||s.push("Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),u&&!Ae(u)&&s.push("S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)"),_||a.push("Thi\u1EBFu \u0111\u1ECBa ch\u1EC9");const H=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(rt=>rt&&rt.product_id);H.length===0&&s.push("Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m"),H.some(rt=>{var St;const bt=Number((St=rt==null?void 0:rt.quantity)!=null?St:0);return!Number.isFinite(bt)||bt<=0})&&s.push("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0");const E=new Set;let q=!1;for(const rt of H){const bt=String(rt.product_id||"").trim();if(bt){if(E.has(bt)){q=!0;break}E.add(bt)}}q&&a.push("S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)");const $e=dt(H),ye=Ge(H),at=ye!=null&&ye.found?Number((kt=ye==null?void 0:ye.fee)!=null?kt:0):0,lt=ie(e==null?void 0:e.adjustment_amount),Ct=String((e==null?void 0:e.adjustment_note)||"").trim();ye!=null&&ye.found&&(at>=2e5||$e>0&&at>$e*.6)&&a.push(`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${pe(at)}`),lt!==0&&!Ct&&a.push("C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh");const ht=Math.abs(lt);return(ht>=5e5||$e>0&&ht>$e*.5)&&lt!==0&&a.push(`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${pe(lt)}`),{errors:s,warnings:a,canSubmit:s.length===0}},Rt=React.useMemo(()=>Tt(m),[m,Be]),Ue=React.useMemo(()=>{var St;const e=String((m==null?void 0:m.customer_name)||"").trim(),s=de((m==null?void 0:m.phone)||""),a=String((m==null?void 0:m.address)||"").trim(),o=Array.isArray(m==null?void 0:m.items)?m.items:[],u=new Map;for(const We of o){const xt=String((We==null?void 0:We.product_id)||"").trim();xt&&u.set(xt,(u.get(xt)||0)+1)}const _=o.map(We=>{var Lt;const xt=String((We==null?void 0:We.product_id)||"").trim(),It=Number((Lt=We==null?void 0:We.quantity)!=null?Lt:0),Dt=xt?"":"Ch\u01B0a ch\u1ECDn s\u1EA3n ph\u1EA9m",jt=Number.isFinite(It)&&It>0?"":"S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i > 0",Kt=xt&&(u.get(xt)||0)>1?"S\u1EA3n ph\u1EA9m b\u1ECB tr\xF9ng d\xF2ng (n\xEAn g\u1ED9p s\u1ED1 l\u01B0\u1EE3ng)":"";return{productError:Dt,qtyError:jt,dupWarn:Kt}}),te=o.filter(We=>We&&We.product_id),H=dt(te),w=Ge(te),E=w!=null&&w.found?Number((St=w==null?void 0:w.fee)!=null?St:0):0,q=ie(m==null?void 0:m.adjustment_amount),$e=String((m==null?void 0:m.adjustment_note)||"").trim(),ye=Math.abs(q),at=q!==0&&!$e?"C\xF3 \u0111i\u1EC1u ch\u1EC9nh nh\u01B0ng thi\u1EBFu ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh":"",lt=q!==0&&(ye>=5e5||H>0&&ye>H*.5)?`\u0110i\u1EC1u ch\u1EC9nh c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${pe(q)}`:"",Ct=w!=null&&w.found&&(E>=2e5||H>0&&E>H*.6)?`Ship c\xF3 v\u1EBB b\u1EA5t th\u01B0\u1EDDng: ${pe(E)}`:"",ht=e?"":"Thi\u1EBFu t\xEAn kh\xE1ch h\xE0ng",kt=s?Ae(s)?"":"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng h\u1EE3p l\u1EC7 (c\u1EA7n 9-12 ch\u1EEF s\u1ED1)":"Thi\u1EBFu s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",rt=a?"":"Thi\u1EBFu \u0111\u1ECBa ch\u1EC9",bt=!ht&&!kt&&_.every(We=>!We.productError&&!We.qtyError);return{nameError:ht,phoneError:kt,addressWarn:rt,items:_,shipAbnormalWarn:Ct,adjustmentNoteWarn:at,adjustmentAbnormalWarn:lt,canSubmit:bt}},[m,Be]),Mt=async e=>{var te,H,w;const s=(e==null?void 0:e.mode)||"close",a=Tt(m);if(!a.canSubmit){const E=a.errors[0]||"Thi\u1EBFu d\u1EEF li\u1EC7u b\u1EAFt bu\u1ED9c";typeof p=="function"?p(E,"danger"):alert(E);return}if(!l&&$t){const E=`${$t}

B\u1EA1n c\xF3 mu\u1ED1n ti\u1EBFp t\u1EE5c l\u01B0u kh\xF4ng?`;if(!window.confirm(E)){(et==null?void 0:et.count)>0&&Se(!0),setTimeout(()=>{var ye;const $e=document.getElementById("order-phone-input");$e&&typeof $e.scrollIntoView=="function"&&($e.scrollIntoView({block:"center",behavior:"smooth"}),(ye=$e.focus)==null||ye.call($e))},0);return}}const o=de(m.phone),_=(Array.isArray(m.items)?m.items:[]).map(E=>{var q;return{product_id:(E==null?void 0:E.product_id)||"",quantity:Number((q=E==null?void 0:E.quantity)!=null?q:1)}}).filter(E=>E.product_id&&Number.isFinite(E.quantity)&&E.quantity>0);K(!0);try{const E=l?`${API_BASE}/api/orders/${l}`:`${API_BASE}/api/orders`,q=_[0],$e={customer_name:m.customer_name,phone:o,address:m.address,adjustment_amount:ie(m.adjustment_amount),adjustment_note:(m.adjustment_note||"").trim(),product_id:q.product_id,quantity:q.quantity,status:m.status,items:_,...l?{id:l}:{}};if(l)await window.KTM.api.putJSON(E,$e,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");else{const ye=await window.KTM.api.postJSON(E,$e,"L\u1ED7i l\u01B0u \u0111\u01A1n h\xE0ng");Re.current={id:(w=(H=ye==null?void 0:ye.id)!=null?H:(te=ye==null?void 0:ye.order)==null?void 0:te.id)!=null?w:null,fingerprint:ut(m),ts:Date.now()}}s==="new"&&!l?(n(""),be(null),z(!0)):(n(""),be(null),z(!1)),ge()}catch(E){console.error(E),typeof p=="function"?p(E.message,"danger"):alert(E.message);return}finally{K(!1)}},_t=e=>window.KTM.orders.getOrderTotalMoney(e,ot),At=async e=>{if(confirm("X\xF3a \u0111\u01A1n h\xE0ng n\xE0y?")){Z(e);try{await window.KTM.api.deleteJSON(`${API_BASE}/api/orders/${e}`,"L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng"),ge(),xe()}catch(s){console.error(s),typeof p=="function"?p(s.message,"danger"):alert(s.message)}finally{Z(null)}}},pt=async(e,s)=>{var o;const a=e==null?void 0:e.id;if(!(!a||!s)){J(a);try{const u=Y(e),_=(Array.isArray(u)?u:[]).map(w=>{var E;return{product_id:(w==null?void 0:w.product_id)||"",quantity:Number((E=w==null?void 0:w.quantity)!=null?E:1)}}).filter(w=>w.product_id&&Number.isFinite(w.quantity)&&w.quantity>0);if(!_.length)throw new Error("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i: \u0111\u01A1n kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7");const te=_[0],H={id:a,customer_name:(e==null?void 0:e.customer_name)||"",phone:de((e==null?void 0:e.phone)||""),address:(e==null?void 0:e.address)||"",adjustment_amount:Number((o=e==null?void 0:e.adjustment_amount)!=null?o:0)||0,adjustment_note:(e==null?void 0:e.adjustment_note)||"",product_id:te.product_id,quantity:te.quantity,status:s,items:_};await window.KTM.api.putJSON(`${API_BASE}/api/orders/${a}`,H,"L\u1ED7i c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),I(w=>Array.isArray(w)?w.map(E=>(E==null?void 0:E.id)===a?{...E,status:s}:E):w),C(w=>Array.isArray(w)?w.map(E=>(E==null?void 0:E.id)===a?{...E,status:s}:E):w),typeof p=="function"&&p("\u0110\xE3 c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i","success")}catch(u){console.error(u),typeof p=="function"?p(u.message,"danger"):alert(u.message)}finally{J(null)}}};return React.createElement("div",{className:"product-manager"},React.createElement(Loading,{show:P&&!ce||L||!!$||!!ee}),React.createElement("div",{className:"product-header"},React.createElement("h5",null,"Qu\u1EA3n l\xFD \u0111\u01A1n h\xE0ng"),React.createElement("button",{className:"btn btn-dark btn-sm",onClick:Ze,disabled:L||!!$},React.createElement("i",{className:"fas fa-plus me-2"}),"T\u1EA1o \u0111\u01A1n")),React.createElement("div",{className:"product-search"},React.createElement("div",{className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-5"},React.createElement("label",{className:"form-label mb-1"},"L\u1ECDc theo th\xE1ng"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-calendar-alt"})),React.createElement("input",{type:"month",className:"form-control",value:ae,onChange:e=>he(e.target.value),"aria-label":"Ch\u1ECDn th\xE1ng",disabled:U}),ae&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{he("")},title:"B\u1ECF l\u1ECDc","aria-label":"B\u1ECF l\u1ECDc",disabled:P},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"col-12 col-md-4"},React.createElement("label",{className:"form-label mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text","aria-hidden":"true"},React.createElement("i",{className:"fas fa-filter"})),React.createElement("select",{className:"form-select",value:ue,onChange:e=>b(e.target.value),"aria-label":"L\u1ECDc theo tr\u1EA1ng th\xE1i",disabled:U},React.createElement("option",{value:""},"T\u1EA5t c\u1EA3"),React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n")),ue&&React.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>b(""),title:"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i","aria-label":"B\u1ECF l\u1ECDc tr\u1EA1ng th\xE1i",disabled:P},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"form-check mt-2"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:"orders-overdue-only",checked:U,onChange:e=>{const s=!!e.target.checked;k(s),s&&b("pending")}}),React.createElement("label",{className:"form-check-label",htmlFor:"orders-overdue-only"},"Ch\u1EC9 hi\u1EC7n \u0111\u01A1n ch\u1EADm > ",tt," ng\xE0y (Ch\u1EDD x\u1EED l\xFD)"))),React.createElement("div",{className:"col-12 col-md-3 d-flex gap-2 justify-content-md-end"},React.createElement("button",{className:"btn btn-outline-secondary",onClick:ge,disabled:P},React.createElement("i",{className:"fas fa-rotate me-2"}),"L\xE0m m\u1EDBi")))),React.createElement("div",{className:"card p-3"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("h6",{className:"mb-0"},"Danh s\xE1ch \u0111\u01A1n h\xE0ng"),React.createElement("span",{className:"text-muted small"},ue?`${y.length}/${M.length} \u0111\u01A1n`:`${M.length} \u0111\u01A1n`)),O.length>0&&React.createElement("div",{className:"alert alert-warning d-flex align-items-center justify-content-between gap-2 mt-3 mb-0",role:"alert"},React.createElement("div",{style:{minWidth:0}},React.createElement("i",{className:"fas fa-triangle-exclamation me-2"}),"C\xF3 ",React.createElement("strong",null,O.length)," \u0111\u01A1n ",React.createElement("strong",null,"Ch\u1EDD x\u1EED l\xFD")," qu\xE1 ",tt," ng\xE0y.",S&&React.createElement("span",{className:"ms-2 text-muted small"},"(\u0111ang c\u1EADp nh\u1EADt...)")),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-dark",onClick:()=>{k(!0),b("pending")}},"Xem ngay")),P?React.createElement("div",{className:"text-center py-4"},React.createElement("div",{className:"spinner-border text-warning"})):M.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Ch\u01B0a c\xF3 \u0111\u01A1n h\xE0ng"):y.length===0?React.createElement("div",{className:"text-center py-4 text-muted"},"Kh\xF4ng c\xF3 \u0111\u01A1n ph\xF9 h\u1EE3p"):React.createElement(React.Fragment,null,React.createElement("div",{className:"d-md-none mt-3"},y.map(e=>{var s;return React.createElement("div",{key:e.id,className:"card mb-2"},React.createElement("div",{className:"card-body p-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-start gap-2"},React.createElement("div",{className:"flex-grow-1",style:{minWidth:0}},React.createElement("div",{className:"fw-semibold text-truncate"},e.customer_name),React.createElement("div",{className:"fw-bold font-monospace"},e.phone),Number((s=e==null?void 0:e.split_seq)!=null?s:0)>0&&React.createElement("div",{className:"text-muted small"},"\u0110\u1EE3t ",e.split_seq),e.address&&React.createElement("div",{className:"text-muted small",style:{whiteSpace:"normal",wordBreak:"break-word"}},e.address)),React.createElement("div",{className:"d-flex align-items-start gap-1 flex-shrink-0"},React.createElement("span",{className:`badge ${D(e.status)}`},T(e.status)),Fe(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${tt} ng\xE0y`},"\u26A0 Ch\u1EADm ",x(e),"d"))),React.createElement("div",{className:"mt-2 small"},React.createElement("div",null,React.createElement("div",{className:"text-muted"},"S\u1EA3n ph\u1EA9m:"),(()=>{const a=De(e);return a.length?React.createElement("div",{className:"mt-1"},a.map((o,u)=>React.createElement("div",{key:u,className:"d-flex justify-content-between gap-2",style:{lineHeight:1.25}},React.createElement("div",{className:"fw-semibold",style:{minWidth:0,whiteSpace:"normal",wordBreak:"break-word",flex:1}},React.createElement("span",{className:"text-muted me-1"},u+1,"."),o.name),React.createElement("div",{className:"text-muted small text-end text-nowrap",style:{flexShrink:0}},"x",o.qty,Number(o.unitPrice)>0?` \u2022 ${pe(o.unitPrice)}`:"")))):React.createElement("div",{className:"fw-semibold",style:{whiteSpace:"normal",wordBreak:"break-word"}},Ke(e))})()),(me(e)!==0||((e==null?void 0:e.adjustment_note)||"").trim())&&React.createElement("div",{style:{whiteSpace:"normal",wordBreak:"break-word"}},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh:")," ",React.createElement("span",{className:"fw-semibold"},pe(me(e))),((e==null?void 0:e.adjustment_note)||"").trim()?React.createElement("span",{className:"text-muted"}," ","(",(e.adjustment_note||"").trim(),")"):null),React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng ti\u1EC1n"),React.createElement("span",{className:"fw-bold"},pe(_t(e)))),React.createElement("div",{className:"text-muted"},React.createElement("span",null,"Th\u1EDDi gian:")," ",R(e.created_at))),React.createElement("div",{className:"mt-3 d-flex gap-2"},React.createElement("button",{className:"btn btn-sm btn-primary flex-fill",onClick:()=>Ee(e),disabled:L||!!$||ee===e.id},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary flex-fill",onClick:()=>Xe(e),disabled:L||!!$||ee===e.id},React.createElement("i",{className:"fas fa-copy me-1"}),"Copy"),React.createElement("button",{className:"btn btn-sm btn-danger flex-fill",onClick:()=>At(e.id),disabled:L||$===e.id||ee===e.id},$===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a")),React.createElement("div",{className:"mt-2 d-flex gap-2"},React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning flex-fill",onClick:()=>pt(e,"processing"),disabled:L||!!$||ee===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success flex-fill",onClick:()=>pt(e,"done"),disabled:L||!!$||ee===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary flex-fill",onClick:()=>pt(e,"paid"),disabled:L||!!$||ee===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger flex-fill",onClick:()=>pt(e,"canceled"),disabled:L||!!$||ee===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"))))})),React.createElement("div",{className:"d-none d-md-block"},React.createElement("table",{className:"table table-bordered mt-3"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Kh\xE1ch h\xE0ng"),React.createElement("th",null,"S\u0110T"),React.createElement("th",null,"S\u1EA3n ph\u1EA9m"),React.createElement("th",null,"SL"),React.createElement("th",null,"T\u1ED5ng ti\u1EC1n"),React.createElement("th",null,"Tr\u1EA1ng th\xE1i"),React.createElement("th",null,"Th\u1EDDi gian"),React.createElement("th",null))),React.createElement("tbody",null,y.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.customer_name),React.createElement("td",null,e.phone),React.createElement("td",null,(()=>{const s=De(e);return s.length?React.createElement("div",{className:"d-grid gap-1"},s.map((a,o)=>React.createElement("div",{key:o,className:"small",style:{whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.2}},React.createElement("span",{className:"text-muted me-1"},o+1,"."),React.createElement("span",{className:"fw-semibold"},a.name)," ",React.createElement("span",{className:"text-muted"},"x",a.qty),Number(a.unitPrice)>0&&React.createElement("span",{className:"text-muted"}," ","\u2022 ",pe(a.unitPrice))))):Ke(e)})()),React.createElement("td",null,qe(e)),React.createElement("td",{className:"fw-semibold"},pe(_t(e))),React.createElement("td",null,React.createElement("div",{className:"d-flex align-items-center gap-1 flex-wrap"},React.createElement("span",{className:`badge ${D(e.status)}`},T(e.status)),Fe(e)&&React.createElement("span",{className:"badge bg-danger",title:`Ch\u1EDD x\u1EED l\xFD qu\xE1 ${tt} ng\xE0y`},"\u26A0 Ch\u1EADm ",x(e),"d"))),React.createElement("td",null,R(e.created_at)),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-primary me-1",onClick:()=>Ee(e),disabled:L||!!$||ee===e.id},"S\u1EEDa"),React.createElement("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>Xe(e),disabled:L||!!$||ee===e.id},React.createElement("i",{className:"fas fa-copy"})),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning me-1",onClick:()=>pt(e,"processing"),disabled:L||!!$||ee===e.id||e.status==="processing",title:"\u0110ang v\u1EADn chuy\u1EC3n"},"Processing"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-success me-1",onClick:()=>pt(e,"done"),disabled:L||!!$||ee===e.id||e.status==="done",title:"Ho\xE0n th\xE0nh"},"Done"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-primary me-1",onClick:()=>pt(e,"paid"),disabled:L||!!$||ee===e.id||e.status==="paid",title:"\u0110\xE3 nh\u1EADn ti\u1EC1n"},"Paid"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-danger me-1",onClick:()=>pt(e,"canceled"),disabled:L||!!$||ee===e.id||e.status==="canceled",title:"H\u1EE7y \u0111\u01A1n"},"H\u1EE7y"),React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>At(e.id),disabled:L||$===e.id},$===e.id?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang x\xF3a"):"X\xF3a"))))))))),ce&&React.createElement("div",{className:"modal show d-block order-modal",style:{background:"rgba(0,0,0,0.6)"},role:"dialog","aria-modal":"true"},React.createElement("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},React.createElement("div",{className:"modal-content",style:{borderRadius:16}},React.createElement("div",{className:"modal-header",style:{background:"linear-gradient(135deg, #ffc107, #ffca2c)",border:"none",borderRadius:"16px 16px 0 0"}},React.createElement("h5",{className:"modal-title fw-bold text-dark mb-0"},React.createElement("i",{className:"fas fa-receipt me-2"}),l?"S\u1EEDa \u0111\u01A1n h\xE0ng":"T\u1EA1o \u0111\u01A1n h\xE0ng"),React.createElement("button",{type:"button",className:"btn-close",onClick:Oe})),React.createElement("form",{onSubmit:e=>{e.preventDefault(),Mt({mode:"close"})}},React.createElement("div",{className:"modal-body",ref:Le},React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"T\xEAn kh\xE1ch h\xE0ng *"),React.createElement("input",{className:"form-control",value:m.customer_name,onChange:e=>re({...m,customer_name:e.target.value}),placeholder:"Nh\u1EADp t\xEAn kh\xE1ch h\xE0ng",required:!0,style:{borderRadius:10,padding:12}}),!!Ue.nameError&&React.createElement("div",{className:"form-text text-danger"},Ue.nameError)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i *"),React.createElement("input",{className:"form-control",type:"tel",inputMode:"numeric",pattern:"[0-9+\\s-]*",id:"order-phone-input",value:m.phone,onChange:e=>t(e.target.value),onBlur:f,placeholder:"Nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",required:!0,style:{borderRadius:10,padding:12}}),!!Ue.phoneError&&React.createElement("div",{className:"form-text text-danger"},Ue.phoneError),!Ue.phoneError&&et.count>0&&React.createElement("div",{className:"form-text text-warning d-flex align-items-center justify-content-between gap-2"},React.createElement("span",null,"Kh\xE1ch n\xE0y \u0111\xE3 c\xF3 ",et.count," \u0111\u01A1n trong th\xE1ng ",et.monthKey,"."),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-warning",onClick:()=>Se(e=>!e)},ve?"\u1EA8n l\u1ECBch s\u1EED":"Xem l\u1ECBch s\u1EED")),ve&&et.orders.length>0&&React.createElement("div",{className:"mt-2 border rounded-3 p-2",style:{background:"#fff"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2"},React.createElement("div",{className:"small fw-semibold"},"L\u1ECBch s\u1EED \u0111\u01A1n (c\xF9ng th\xE1ng)"),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>Se(!1)},"\u1EA8n")),React.createElement("div",{className:"d-grid gap-2"},et.orders.slice(0,5).map(e=>React.createElement("div",{key:e.id,className:"d-flex align-items-start justify-content-between gap-2"},React.createElement("div",{style:{minWidth:0,flex:1}},React.createElement("div",{className:"small fw-semibold",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},"#",e.id," \u2022 ",React.createElement("span",{className:`badge ${D(e.status)}`},T(e.status))),React.createElement("div",{className:"text-muted small"},R(e.created_at)," \u2022 ",pe(_t(e))),React.createElement("div",{className:"text-muted small",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},Ke(e))),React.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{confirm(`M\u1EDF \u0111\u01A1n #${e.id}? D\u1EEF li\u1EC7u \u0111ang nh\u1EADp s\u1EBD m\u1EA5t.`)&&Ee(e)}},"M\u1EDF")))),et.orders.length>5&&React.createElement("div",{className:"text-muted small mt-2"},"Ch\u1EC9 hi\u1EC3n th\u1ECB 5 \u0111\u01A1n g\u1EA7n nh\u1EA5t.")),(se==null?void 0:se.status)==="loading"&&React.createElement("div",{className:"form-text"},"\u0110ang t\xECm kh\xE1ch theo S\u0110T..."),(se==null?void 0:se.status)==="found"&&React.createElement("div",{className:"form-text text-success"},"\u0110\xE3 c\xF3 kh\xE1ch, t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n th\xF4ng tin."),(se==null?void 0:se.status)==="not-found"&&React.createElement("div",{className:"form-text text-muted"},"Ch\u01B0a c\xF3 kh\xE1ch, s\u1EBD t\u1EA1o m\u1EDBi khi l\u01B0u \u0111\u01A1n."),(se==null?void 0:se.status)==="error"&&React.createElement("div",{className:"form-text text-danger"},"Kh\xF4ng tra \u0111\u01B0\u1EE3c kh\xE1ch (l\u1ED7i m\u1EA1ng/server).")),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Tr\u1EA1ng th\xE1i"),React.createElement("select",{className:"form-select",value:m.status,onChange:e=>re({...m,status:e.target.value}),style:{borderRadius:10,padding:12}},React.createElement("option",{value:"pending"},"Ch\u1EDD x\u1EED l\xFD"),React.createElement("option",{value:"processing"},"\u0110ang v\u1EADn chuy\u1EC3n"),React.createElement("option",{value:"done"},"Ho\xE0n th\xE0nh"),React.createElement("option",{value:"paid"},"\u0110\xE3 nh\u1EADn ti\u1EC1n"),React.createElement("option",{value:"canceled"},"H\u1EE7y \u0111\u01A1n"))),React.createElement("div",{className:"col-12"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110\u1ECBa ch\u1EC9"),React.createElement("input",{className:"form-control",value:m.address,onChange:e=>re({...m,address:e.target.value}),placeholder:"Nh\u1EADp \u0111\u1ECBa ch\u1EC9 (kh\xF4ng b\u1EAFt bu\u1ED9c)",style:{borderRadius:10,padding:12}}),!!Ue.addressWarn&&React.createElement("div",{className:"form-text text-warning"},Ue.addressWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"\u0110i\u1EC1u ch\u1EC9nh gi\xE1 (th\xEAm/b\u1EDBt)"),React.createElement("input",{type:"number",className:"form-control",value:m.adjustment_amount,onChange:e=>re({...m,adjustment_amount:e.target.value}),placeholder:"-20000 ho\u1EB7c 20000",step:"1000",style:{borderRadius:10,padding:12}}),React.createElement("div",{className:"form-text"},"\xC2m = gi\u1EA3m gi\xE1, d\u01B0\u01A1ng = c\u1ED9ng th\xEAm."),!!Ue.adjustmentAbnormalWarn&&React.createElement("div",{className:"form-text text-warning"},Ue.adjustmentAbnormalWarn)),React.createElement("div",{className:"col-12 col-md-6"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"Ghi ch\xFA \u0111i\u1EC1u ch\u1EC9nh"),React.createElement("input",{className:"form-control",value:m.adjustment_note,onChange:e=>re({...m,adjustment_note:e.target.value}),placeholder:"V\xED d\u1EE5: Gi\u1EA3m gi\xE1 cho kh\xE1ch / B\xF9 ph\xED \u0111\xF3ng g\xF3i...",style:{borderRadius:10,padding:12}}),!!Ue.adjustmentNoteWarn&&React.createElement("div",{className:"form-text text-warning"},Ue.adjustmentNoteWarn)),React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("label",{className:"form-label fw-semibold small text-muted mb-1"},"S\u1EA3n ph\u1EA9m *"),React.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{re(e=>({...e,items:[...Array.isArray(e.items)?e.items:[],{product_id:"",quantity:1}]})),Ie(e=>[...Array.isArray(e)?e:[],""]),l&&G(e=>[...Array.isArray(e)?e:[],!0])},disabled:L},React.createElement("i",{className:"fas fa-plus me-2"}),"Th\xEAm s\u1EA3n ph\u1EA9m")),React.createElement("div",{className:"d-grid gap-2"},(Array.isArray(m.items)?m.items:[{product_id:"",quantity:1}]).map((e,s)=>React.createElement("div",{key:s,className:"row g-2 align-items-end"},React.createElement("div",{className:"col-12 col-md-8"},React.createElement("div",{className:"dropdown w-100",ref:a=>{Ve.current[s]=a}},React.createElement("button",{type:"button",className:"form-control text-start d-flex align-items-center justify-content-between",style:{borderRadius:10,padding:12},onClick:()=>{Me(a=>a===s?null:s),setTimeout(()=>{const a=document.getElementById(`order-product-search-${s}`);a&&a.focus()},0)}},React.createElement("span",{className:e.product_id?"":"text-muted",style:{minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},mt(e.product_id)),React.createElement("i",{className:"fas fa-chevron-down text-muted",style:{marginLeft:8,flexShrink:0}})),He===s&&React.createElement("div",{className:"dropdown-menu show w-100 p-2",style:{maxHeight:320,overflowY:"auto"}},React.createElement("input",{id:`order-product-search-${s}`,className:"form-control",value:Ne[s]||"",onChange:a=>{const o=a.target.value;Ie(u=>{const _=Array.isArray(u)?[...u]:[];return _[s]=o,_})},placeholder:"T\xECm theo t\xEAn / m\xE3...",style:{borderRadius:10,padding:10}}),React.createElement("div",{className:"mt-2"}),Nt(s).length===0?React.createElement("div",{className:"text-muted small px-2 py-1"},"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m ph\xF9 h\u1EE3p"):Nt(s).map(a=>React.createElement("button",{key:a.id,type:"button",className:"dropdown-item",onClick:()=>{const o=String(a.id);re(u=>{const _=Array.isArray(u.items)?[...u.items]:[];return _[s]={..._[s]||{quantity:1},product_id:o},{...u,items:_}}),Me(null)}},a.name,a.code?` (${a.code})`:""))),React.createElement("select",{className:"form-select",value:e.product_id,onChange:()=>{},required:!0,style:{position:"absolute",opacity:0,height:0,pointerEvents:"none"},tabIndex:-1,"aria-hidden":"true"},React.createElement("option",{value:""},"-- ch\u1ECDn s\u1EA3n ph\u1EA9m --"),Be.map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),(()=>{var o;const a=(o=Ue.items)==null?void 0:o[s];return a?React.createElement(React.Fragment,null,!!a.productError&&React.createElement("div",{className:"form-text text-danger"},a.productError),!!a.dupWarn&&React.createElement("div",{className:"form-text text-warning"},a.dupWarn)):null})(),l&&React.createElement("div",{className:"form-check mt-1"},React.createElement("input",{className:"form-check-input",type:"checkbox",id:`order-split-deliver-${s}`,checked:!!Te[s],onChange:a=>{const o=!!a.target.checked;G(u=>{const _=Array.isArray(u)?[...u]:[],te=Array.isArray(m.items)?m.items.length:0;for(;_.length<te;)_.push(!0);return _[s]=o,_})},disabled:L||X}),React.createElement("label",{className:"form-check-label small text-muted",htmlFor:`order-split-deliver-${s}`},"Giao \u0111\u1EE3t 1"))),React.createElement("div",{className:"col-8 col-md-3"},React.createElement("input",{type:"number",className:"form-control",value:e.quantity,onChange:a=>{const o=a.target.value;re(u=>{const _=Array.isArray(u.items)?[...u.items]:[];return _[s]={..._[s]||{product_id:""},quantity:o},{...u,items:_}})},min:"1",style:{borderRadius:10,padding:12}}),(()=>{var o;const a=(o=Ue.items)==null?void 0:o[s];return a&&a.qtyError?React.createElement("div",{className:"form-text text-danger"},a.qtyError):null})()),React.createElement("div",{className:"col-4 col-md-1 d-flex justify-content-end"},React.createElement("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{re(a=>{const o=Array.isArray(a.items)?[...a.items]:[];return o.splice(s,1),{...a,items:o.length?o:[{product_id:"",quantity:1}]}}),Ie(a=>{const o=Array.isArray(a)?[...a]:[];return o.splice(s,1),o.length?o:[""]}),G(a=>{const o=Array.isArray(a)?[...a]:[];return o.splice(s,1),o}),Me(a=>a==null?a:a===s?null:a>s?a-1:a)},disabled:L||X||(Array.isArray(m.items)?m.items.length:1)<=1,title:"X\xF3a s\u1EA3n ph\u1EA9m",style:{borderRadius:10,padding:10}},React.createElement("i",{className:"fas fa-trash"}))))))),(()=>{const s=(Array.isArray(m.items)?m.items:[]).filter(te=>te==null?void 0:te.product_id),a=dt(s),o=Ge(s),u=ie(m.adjustment_amount),_=a+(o.found?o.fee:0)+u;return React.createElement("div",{className:"col-12"},React.createElement("div",{className:"d-flex flex-column gap-1 small bg-light rounded-3 p-3"},React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"T\u1EA1m t\xEDnh"),React.createElement("span",{className:"fw-semibold"},pe(a))),o.found&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"Ship"),React.createElement("span",{className:"fw-semibold"},pe(o.fee))),!!Ue.shipAbnormalWarn&&React.createElement("div",{className:"text-warning"},Ue.shipAbnormalWarn),u!==0&&React.createElement("div",{className:"d-flex justify-content-between"},React.createElement("span",{className:"text-muted"},"\u0110i\u1EC1u ch\u1EC9nh"),React.createElement("span",{className:"fw-semibold"},pe(u))),(m.adjustment_note||"").trim()&&React.createElement("div",{className:"text-muted",style:{whiteSpace:"normal",wordBreak:"break-word"}},"Ghi ch\xFA: ",(m.adjustment_note||"").trim()),React.createElement("div",{className:"d-flex justify-content-between pt-1 border-top"},React.createElement("span",{className:"text-muted"},"T\u1ED5ng"),React.createElement("span",{className:"fw-bold"},pe(_)))))})())),React.createElement("div",{className:"modal-footer",style:{border:"none"}},React.createElement("button",{type:"button",className:"btn btn-light",onClick:Oe,disabled:L||X,style:{borderRadius:10}},"H\u1EE7y"),!!l&&React.createElement("button",{type:"button",className:"btn btn-outline-primary fw-semibold",onClick:Qe,disabled:L||X,style:{borderRadius:10},title:"Ch\u1ECDn s\u1EA3n ph\u1EA9m giao \u0111\u1EE3t 1 v\xE0 t\xE1ch ph\u1EA7n c\xF2n l\u1EA1i sang \u0111\u01A1n ch\u1EDD h\xE0ng"},X?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang t\xE1ch..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-random me-2"}),"T\xE1ch \u0111\u01A1n giao ngay")),!l&&React.createElement("button",{type:"button",className:"btn btn-outline-warning fw-semibold",onClick:()=>Mt({mode:"new"}),disabled:L||!Ue.canSubmit,style:{borderRadius:10},title:"L\u01B0u xong gi\u1EEF form \u0111\u1EC3 t\u1EA1o \u0111\u01A1n m\u1EDBi"},React.createElement("i",{className:"fas fa-plus me-2"}),"L\u01B0u & t\u1EA1o \u0111\u01A1n m\u1EDBi"),React.createElement("button",{type:"submit",className:"btn btn-warning fw-semibold",disabled:L||X||!Ue.canSubmit,style:{borderRadius:10,boxShadow:"0 4px 12px rgba(255,193,7,0.3)"}},L?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01B0u..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-check me-2"}),"L\u01B0u"))))))))}

