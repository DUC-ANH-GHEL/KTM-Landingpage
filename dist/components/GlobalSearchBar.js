function GlobalSearchBar(){var{useState:m,useEffect:S,useRef:I}=React;const[p,D]=m(""),[i,N]=m([]),[o,$]=m(null),[B,d]=m(!1),[k,v]=m(-1),[L,C]=m({}),[E,F]=m(null),[V,T]=m(!1),[K,P]=m([]),f=I(null);S(()=>{(async()=>{try{const t=await fetch("/api/products");if(t.ok){const a=await t.json();P(a.map(s=>{var l;return{id:s.id,name:s.name,code:s.code||"",price:s.price||"",image:s.image||"",category:s.category||"",note:s.note||"",variants:(l=s.variants)!=null?l:null}}))}}catch(t){console.error("Error loading products:",t)}})()},[]);const R=e=>{var s,l;const t=Number(e);if(!Number.isFinite(t))return"";const a=Math.max(0,Math.trunc(t));if((l=(s=window.KTM)==null?void 0:s.money)!=null&&l.formatVND)return window.KTM.money.formatVND(a);try{return`${new Intl.NumberFormat("vi-VN").format(a)}\u0111`}catch(n){return`${String(a)}\u0111`}},z=e=>{if(e==null||e==="")return[];let t=e;if(typeof t=="string"){const a=t.trim();if(!a)return[];try{t=JSON.parse(a)}catch(s){return[]}}return Array.isArray(t)?t:[]},A=e=>{var s,l;const t=z(e);if(!t.length)return"";const a=[];for(const n of t){const c=String((s=n==null?void 0:n.name)!=null?s:"").trim(),g=Array.isArray(n==null?void 0:n.options)?n.options:[];if(!g.length)continue;const u=[];for(const r of g){const b=String((l=r==null?void 0:r.label)!=null?l:"").trim();if(!b)continue;const h=Number(r==null?void 0:r.price);if(Number.isFinite(h)&&h>=0?u.push(`${b} ${R(h)}`):u.push(b),u.length>=6)break}if(!u.length)continue;const x=c||"Bi\u1EBFn th\u1EC3",y=g.length>u.length?"\u2026":"";if(a.push(`${x}: ${u.join(", ")}${y}`),a.length>=2)break}return a.join(" \u2022 ")},w=(e="")=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),j=e=>{D(e.target.value),v(-1),$(null),T(!1)};S(()=>{if(V)return;if(!p||p.trim().length<1){N([]),d(!1);return}const t=setTimeout(()=>{const a=w(p.trim()),s=a.split(/\s+/).filter(Boolean),l=K.map(n=>{const c=w(n.name||""),g=w(n.code||""),u=w(n.category||""),x=`${c} ${g} ${u}`;let y=!1;if(s.length===1?y=x.includes(s[0]):y=s.every(h=>x.includes(h)),!y)return null;let r=0;c.includes(a)&&(r+=1e3),c.startsWith(a)&&(r+=500),c.startsWith(s[0])&&(r+=200),s.forEach(h=>{c.includes(h)&&(r+=50)}),g&&g.includes(a)&&(r+=100),r+=Math.max(0,50-c.length);const b=c.indexOf(a);return b>=0&&(r+=Math.max(0,100-b*5)),{...n,_score:r}}).filter(Boolean);l.sort((n,c)=>c._score-n._score),N(l),d(l.length>0)},120);return()=>clearTimeout(t)},[p]),S(()=>{if(!f.current||i.length===0){C({});return}const e=()=>{const t=f.current.getBoundingClientRect();C({position:"fixed",top:`${t.bottom}px`,left:`${t.left}px`,width:`${t.width}px`,zIndex:999999})};return e(),window.addEventListener("resize",e),window.addEventListener("scroll",e,{passive:!0}),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e)}},[i]);const M=e=>{$(e),D(e.name),d(!1),N([]),T(!0),setTimeout(()=>T(!1),300),v(-1),f.current&&f.current.focus()};return React.createElement("section",{className:"py-3 bg-light border-bottom global-search-bar-section"},React.createElement("div",{className:"container global-search-container"},React.createElement("div",{className:"row justify-content-center"},React.createElement("div",{className:"col-12 col-lg-8 search-wrapper"},React.createElement("label",{className:"form-label fw-semibold mb-2 d-flex align-items-center"},React.createElement("i",{className:"fas fa-search me-2 text-primary"}),"T\xECm nhanh gi\xE1 s\u1EA3n ph\u1EA9m KTM"),React.createElement("div",{className:"input-group position-relative"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search text-primary"})),React.createElement("input",{ref:f,type:"text",className:"form-control form-control-lg",placeholder:"Nh\u1EADp t\xEAn s\u1EA3n ph\u1EA9m (VD: van 3 tay, KTM-62, trang g\u1EADp...)",value:p,onChange:j,onKeyDown:e=>{!B||i.length===0||(e.key==="ArrowDown"?(e.preventDefault(),v(t=>t<i.length-1?t+1:0)):e.key==="ArrowUp"?(e.preventDefault(),v(t=>t>0?t-1:i.length-1)):e.key==="Enter"?(e.preventDefault(),k>=0?M(i[k]):i.length===1&&M(i[0])):e.key==="Escape"&&(d(!1),v(-1)))},onBlur:()=>setTimeout(()=>d(!1),150),onFocus:()=>i.length>0&&d(!0),autoComplete:"off"}),p&&React.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:()=>{D(""),N([]),$(null),d(!1),v(-1),f.current&&f.current.focus()}},React.createElement("i",{className:"fas fa-trash text-danger"})),B&&i.length>0&&React.createElement("div",{className:"suggestions-dropdown",style:{...L,maxHeight:"60vh",overflowY:"auto",background:"#fff"}},React.createElement("div",{className:"px-3 py-2 bg-light border-bottom small text-muted"},React.createElement("i",{className:"fas fa-list me-1"}),"T\xECm th\u1EA5y ",React.createElement("strong",{className:"text-primary"},i.length)," s\u1EA3n ph\u1EA9m"),i.map((e,t)=>(()=>{const a=A(e==null?void 0:e.variants);return React.createElement("div",{key:e.id,className:`suggestion-item ${t===k?"active":""}`,onMouseDown:s=>{s.preventDefault(),M(e)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:t<i.length-1?"1px solid #eee":"none"}},React.createElement("div",{className:"d-flex align-items-center gap-2"},e.image&&React.createElement("div",{className:"suggestion-thumb"},React.createElement("img",{src:e.image,alt:e.name,className:"suggestion-thumb-img"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("div",{className:"fw-semibold text-primary"},e.name),React.createElement("div",{className:"small text-muted"},e.code&&React.createElement("span",null,e.code," \xB7 "),React.createElement("span",{className:"text-danger fw-bold"},e.price)),a&&React.createElement("div",{className:"small text-muted",style:{marginTop:2}},React.createElement("i",{className:"fas fa-layer-group me-1"}),a))))})()))),o&&(()=>{const e=A(o==null?void 0:o.variants);return React.createElement("div",{className:"card mt-3 shadow-sm"},React.createElement("div",{className:"card-body d-flex flex-column flex-md-row align-items-start gap-3"},o.image&&React.createElement("img",{src:o.image,alt:o.name,style:{width:120,height:120,objectFit:"cover",borderRadius:8,cursor:"pointer"},onClick:()=>F(o.image),title:"Click \u0111\u1EC3 ph\xF3ng to \u1EA3nh"}),React.createElement("div",{className:"flex-grow-1"},React.createElement("h6",{className:"fw-bold text-primary mb-1"},o.name),o.code&&React.createElement("div",{className:"mb-1 small text-muted"},"M\xE3: ",o.code),React.createElement("div",{className:"mb-2"},React.createElement("span",{className:"text-muted small me-2"},"Gi\xE1:"),React.createElement("span",{className:"fw-bold text-danger fs-5"},o.price)),e&&React.createElement("div",{className:"mb-2 small text-muted"},React.createElement("i",{className:"fas fa-layer-group me-1"}),e),React.createElement("a",{href:`https://zalo.me/0966201140?message=${encodeURIComponent("T\xF4i mu\u1ED1n h\u1ECFi v\u1EC1: "+o.name+" - "+(o.price||""))}`,target:"_blank",rel:"noopener noreferrer",className:"btn btn-success btn-sm"},React.createElement("i",{className:"fas fa-comments me-1"})," H\u1ECFi nhanh B\xE1 \u0110\u1EE9c qua Zalo"))))})(),E&&React.createElement(ImageModal,{src:E,onClose:()=>F(null)})))))}

