function GlobalSearchBar(){var{useState:o,useEffect:p,useRef:$}=React;const[d,v]=o(""),[s,f]=o([]),[n,b]=o(null),[T,r]=o(!1),[w,u]=o(-1),[I,C]=o({}),[B,E]=o(null),[L,y]=o(!1),[R,z]=o([]),m=$(null);p(()=>{(async()=>{try{const t=await fetch("/api/products");if(t.ok){const l=await t.json();z(l.map(a=>({id:a.id,name:a.name,code:a.code||"",price:a.price||"",image:a.image||"",category:a.category||"",note:a.note||""})))}}catch(t){console.error("Error loading products:",t)}})()},[]);const h=(e="")=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),F=e=>{v(e.target.value),u(-1),b(null),y(!1)};p(()=>{if(L)return;if(!d||d.trim().length<1){f([]),r(!1);return}const t=setTimeout(()=>{const l=h(d.trim()),a=l.split(/\s+/).filter(Boolean),x=R.map(g=>{const i=h(g.name||""),S=h(g.code||""),K=h(g.category||""),M=`${i} ${S} ${K}`;let k=!1;if(a.length===1?k=M.includes(a[0]):k=a.every(D=>M.includes(D)),!k)return null;let c=0;i.includes(l)&&(c+=1e3),i.startsWith(l)&&(c+=500),i.startsWith(a[0])&&(c+=200),a.forEach(D=>{i.includes(D)&&(c+=50)}),S&&S.includes(l)&&(c+=100),c+=Math.max(0,50-i.length);const P=i.indexOf(l);return P>=0&&(c+=Math.max(0,100-P*5)),{...g,_score:c}}).filter(Boolean);x.sort((g,i)=>i._score-g._score),f(x),r(x.length>0)},120);return()=>clearTimeout(t)},[d]),p(()=>{if(!m.current||s.length===0){C({});return}const e=()=>{const t=m.current.getBoundingClientRect();C({position:"fixed",top:`${t.bottom}px`,left:`${t.left}px`,width:`${t.width}px`,zIndex:999999})};return e(),window.addEventListener("resize",e),window.addEventListener("scroll",e,{passive:!0}),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e)}},[s]);const N=e=>{b(e),v(e.name),r(!1),f([]),y(!0),setTimeout(()=>y(!1),300),u(-1),m.current&&m.current.focus()};return React.createElement("section",{className:"py-3 bg-light border-bottom global-search-bar-section"},React.createElement("div",{className:"container global-search-container"},React.createElement("div",{className:"row justify-content-center"},React.createElement("div",{className:"col-12 col-lg-8 search-wrapper"},React.createElement("label",{className:"form-label fw-semibold mb-2 d-flex align-items-center"},React.createElement("i",{className:"fas fa-search me-2 text-primary"}),"T\xECm nhanh gi\xE1 s\u1EA3n ph\u1EA9m KTM"),React.createElement("div",{className:"input-group position-relative"},React.createElement("span",{className:"input-group-text"},React.createElement("i",{className:"fas fa-search text-primary"})),React.createElement("input",{ref:m,type:"text",className:"form-control form-control-lg",placeholder:"Nh\u1EADp t\xEAn s\u1EA3n ph\u1EA9m (VD: van 3 tay, KTM-62, trang g\u1EADp...)",value:d,onChange:F,onKeyDown:e=>{!T||s.length===0||(e.key==="ArrowDown"?(e.preventDefault(),u(t=>t<s.length-1?t+1:0)):e.key==="ArrowUp"?(e.preventDefault(),u(t=>t>0?t-1:s.length-1)):e.key==="Enter"?(e.preventDefault(),w>=0?N(s[w]):s.length===1&&N(s[0])):e.key==="Escape"&&(r(!1),u(-1)))},onBlur:()=>setTimeout(()=>r(!1),150),onFocus:()=>s.length>0&&r(!0),autoComplete:"off"}),d&&React.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:()=>{v(""),f([]),b(null),r(!1),u(-1),m.current&&m.current.focus()}},React.createElement("i",{className:"fas fa-trash text-danger"})),T&&s.length>0&&React.createElement("div",{className:"suggestions-dropdown",style:{...I,maxHeight:"60vh",overflowY:"auto",background:"#fff"}},React.createElement("div",{className:"px-3 py-2 bg-light border-bottom small text-muted"},React.createElement("i",{className:"fas fa-list me-1"}),"T\xECm th\u1EA5y ",React.createElement("strong",{className:"text-primary"},s.length)," s\u1EA3n ph\u1EA9m"),s.map((e,t)=>React.createElement("div",{key:e.id,className:`suggestion-item ${t===w?"active":""}`,onMouseDown:l=>{l.preventDefault(),N(e)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:t<s.length-1?"1px solid #eee":"none"}},React.createElement("div",{className:"d-flex align-items-center gap-2"},e.image&&React.createElement("div",{className:"suggestion-thumb"},React.createElement("img",{src:e.image,alt:e.name,className:"suggestion-thumb-img"})),React.createElement("div",{className:"flex-grow-1"},React.createElement("div",{className:"fw-semibold text-primary"},e.name),React.createElement("div",{className:"small text-muted"},e.code&&React.createElement("span",null,e.code," \xB7 "),React.createElement("span",{className:"text-danger fw-bold"},e.price)))))))),n&&React.createElement("div",{className:"card mt-3 shadow-sm"},React.createElement("div",{className:"card-body d-flex flex-column flex-md-row align-items-start gap-3"},n.image&&React.createElement("img",{src:n.image,alt:n.name,style:{width:120,height:120,objectFit:"cover",borderRadius:8,cursor:"pointer"},onClick:()=>E(n.image),title:"Click \u0111\u1EC3 ph\xF3ng to \u1EA3nh"}),React.createElement("div",{className:"flex-grow-1"},React.createElement("h6",{className:"fw-bold text-primary mb-1"},n.name),n.code&&React.createElement("div",{className:"mb-1 small text-muted"},"M\xE3: ",n.code),React.createElement("div",{className:"mb-2"},React.createElement("span",{className:"text-muted small me-2"},"Gi\xE1:"),React.createElement("span",{className:"fw-bold text-danger fs-5"},n.price)),React.createElement("a",{href:`https://zalo.me/0966201140?message=${encodeURIComponent("T\xF4i mu\u1ED1n h\u1ECFi v\u1EC1: "+n.name+" - "+(n.price||""))}`,target:"_blank",rel:"noopener noreferrer",className:"btn btn-success btn-sm"},React.createElement("i",{className:"fas fa-comments me-1"})," H\u1ECFi nhanh B\xE1 \u0110\u1EE9c qua Zalo")))),B&&React.createElement(ImageModal,{src:B,onClose:()=>E(null)})))))}

