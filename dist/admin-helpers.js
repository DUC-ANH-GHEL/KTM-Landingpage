(function(){const I=typeof window!="undefined"?window:globalThis,h=I.KTM||(I.KTM={}),l=h.money||(h.money={});l.parseMoney=l.parseMoney||function(t){if(t==null||t==="")return 0;const e=String(t).replace(/[^0-9]/g,"");return e?Number(e):0},l.parseSignedMoney=l.parseSignedMoney||function(t){if(t==null||t==="")return 0;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):0;const e=String(t).trim();if(!e)return 0;const n=/^\s*-/.test(e),i=e.replace(/[^0-9]/g,""),r=i?Number(i):0;return n?-r:r},l.formatNumber=l.formatNumber||function(t){try{return Number(t||0).toLocaleString("vi-VN")}catch(e){return String(t||0)}},l.formatVND=l.formatVND||function(t){return`${l.formatNumber(t)}\u0111`},l.parseShipFeeFromNote=l.parseShipFeeFromNote||function(t){if(!t)return null;const e=String(t),n=e.toLowerCase();if(n.includes("freeship")||n.includes("free ship")||n.includes("mi\u1EC5n ph\xED ship")||n.includes("mien phi ship")||n.includes("mi\u1EC5n ph\xED v\u1EADn chuy\u1EC3n")||n.includes("mien phi van chuyen"))return 0;const i=e.match(/(?:ship|vận\s*chuyển|van\s*chuyen|\bvc\b)\s*[:=\-]?\s*([0-9][0-9\.,\s]*)(?:\s*(k|nghìn|nghin|tr|triệu|trieu|m))?/i);if(!i)return null;const r=String(i[1]||"").replace(/[^0-9]/g,"");if(!r)return null;let o=Number(r);const c=String(i[2]||"").toLowerCase();return c==="k"||c.startsWith("ngh")?o*=1e3:(c==="tr"||c.startsWith("tri")||c==="m")&&(o*=1e6),Number.isFinite(o)?o:null},l.getShipFeeForItems=l.getShipFeeForItems||function(t){const e=Array.isArray(t)?t:[];let n=!1,i=0;for(const r of e){const o=l.parseShipFeeFromNote(r==null?void 0:r.product_note);o!=null&&(n=!0,o>i&&(i=o))}return{found:n,fee:i}},l.getDigits=l.getDigits||function(t){return t==null?"":String(t).replace(/[^0-9]/g,"")},l.formatVNDInputDigits=l.formatVNDInputDigits||function(t){const e=String(t!=null?t:"").replace(/[^0-9]/g,"");return e?e.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""},l.nextPriceInputState=l.nextPriceInputState||function(t,e){const n=l.getDigits(t),i=String(e!=null?e:"");if(!n)return{digits:"",price:""};if(n===i&&n.length>0){const r=n.slice(0,-1);return{digits:r,price:l.formatVNDInputDigits(r)}}return{digits:n,price:l.formatVNDInputDigits(n)}};const m=h.orders||(h.orders={}),w=h.clipboard||(h.clipboard={});w.writeText=w.writeText||async function(t){var r;const e=typeof navigator!="undefined"?navigator:null;if((r=e==null?void 0:e.clipboard)!=null&&r.writeText){await e.clipboard.writeText(String(t!=null?t:""));return}const n=document.createElement("textarea");n.value=String(t!=null?t:""),n.setAttribute("readonly",""),n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select();const i=document.execCommand("copy");if(document.body.removeChild(n),!i)throw new Error("copy_failed")},w.writeImageFromUrl=w.writeImageFromUrl||async function(t){var o;const e=String(t!=null?t:"");if(!e)throw new Error("empty_url");const i=await(await fetch(e)).blob(),r=typeof navigator!="undefined"?navigator:null;if(!((o=r==null?void 0:r.clipboard)!=null&&o.write)||typeof ClipboardItem=="undefined")throw new Error("clipboard_image_unsupported");await r.clipboard.write([new ClipboardItem({[i.type]:i})])};const y=h.phone||(h.phone={});y.normalize=y.normalize||function(t){return t?String(t).replace(/[^0-9]/g,""):""},y.isValid=y.isValid||function(t){const e=y.normalize(t);return e.length>=9&&e.length<=12};const b=h.date||(h.date={});b.formatDateTime=b.formatDateTime||function(t){if(!t)return"";const e=new Date(t);if(Number.isNaN(e.getTime()))return String(t);try{return e.toLocaleString("vi-VN")}catch(n){return e.toISOString()}};const N=h.cache||(h.cache={});N.read=N.read||function(t,e){var o,c;const n=Number((o=e==null?void 0:e.ttlMs)!=null?o:0),i=typeof(e==null?void 0:e.validate)=="function"?e.validate:null,r=String(t!=null?t:"");if(!r)return{hit:!1,value:null,status:"invalid"};try{const u=localStorage.getItem(r);if(!u)return{hit:!1,value:null,status:"miss"};const a=JSON.parse(u),f=Number((c=a==null?void 0:a.timestamp)!=null?c:0),d=a==null?void 0:a.data;return!f||!Number.isFinite(f)?{hit:!1,value:null,status:"invalid"}:n>0&&Date.now()-f>=n?{hit:!1,value:null,status:"expired"}:i&&!i(d)?{hit:!1,value:null,status:"invalid"}:{hit:!0,value:d,status:"hit"}}catch(u){return{hit:!1,value:null,status:"error"}}},N.write=N.write||function(t,e){const n=String(t!=null?t:"");if(!n)return!1;try{return localStorage.setItem(n,JSON.stringify({data:e,timestamp:Date.now()})),!0}catch(i){return!1}},N.remove=N.remove||function(t){const e=String(t!=null?t:"");if(!e)return!1;try{return localStorage.removeItem(e),!0}catch(n){return!1}};const g=h.api||(h.api={});g.request=g.request||function(t,e){return fetch(String(t!=null?t:""),e)},g.requestJSON=g.requestJSON||async function(t,e,n){const i=await g.request(t,e);let r=null,o="";try{r=await i.json()}catch(c){try{o=await i.text()}catch(u){o=""}}if(!i.ok){const c=r&&typeof r=="object"&&(r.error||r.message)?String(r.error||r.message):typeof r=="string"&&r.trim()?r.trim():o&&o.trim()?o.trim():n||`API error (${i.status})`;throw new Error(c)}return r},g.getJSON=g.getJSON||function(t,e){return g.requestJSON(t,{method:"GET"},e)},g.postJSON=g.postJSON||function(t,e,n){return g.requestJSON(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e!=null?e:{})},n)},g.putJSON=g.putJSON||function(t,e,n){return g.requestJSON(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e!=null?e:{})},n)},g.deleteJSON=g.deleteJSON||function(t,e){return g.requestJSON(t,{method:"DELETE"},e)};const T=h.cloudinary||(h.cloudinary={});T.uploadImage=T.uploadImage||async function(t){var a,f;const e=String((a=t==null?void 0:t.cloudName)!=null?a:"").trim(),n=String((f=t==null?void 0:t.uploadPreset)!=null?f:"").trim(),i=(t==null?void 0:t.folder)!=null?String(t.folder).trim():"",r=t==null?void 0:t.file;if(!e)throw new Error("Thi\u1EBFu c\u1EA5u h\xECnh Cloudinary");if(!n)throw new Error("Thi\u1EBFu c\u1EA5u h\xECnh Cloudinary");if(!r)throw new Error("Thi\u1EBFu file upload");const o=new FormData;o.append("file",r),o.append("upload_preset",n),i&&o.append("folder",i);const c=await fetch(`https://api.cloudinary.com/v1_1/${encodeURIComponent(e)}/image/upload`,{method:"POST",body:o});let u=null;try{u=await c.json()}catch(d){u=null}if(!u)throw new Error("Upload failed");if(!c.ok){const d=typeof u=="object"&&u.error&&typeof u.error=="object"&&u.error.message?String(u.error.message):typeof u=="object"&&(u.message||u.error)?String(u.message||u.error):"Upload failed";throw new Error(d)}return u},m.getOrderItems=m.getOrderItems||function(t){return Array.isArray(t==null?void 0:t.items)&&t.items.length?t.items:t!=null&&t.product_id?[{product_id:t.product_id,quantity:Number(t.quantity||1)||1,product_price:t.product_price,product_name:t.product_name,product_code:t.product_code,product_note:t.product_note}]:[]},m.getOrderTotalQty=m.getOrderTotalQty||function(t){var r,o;const n=m.getOrderItems(t).reduce((c,u)=>c+(Number((u==null?void 0:u.quantity)||0)||0),0);if(n>0)return n;const i=Number((o=(r=t==null?void 0:t.total_quantity)!=null?r:t==null?void 0:t.quantity)!=null?o:0);return Number.isFinite(i)?i:0},m.getOrderAdjustmentMoney=m.getOrderAdjustmentMoney||function(t){const e=t==null?void 0:t.adjustment_amount;if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):0;const n=Number(e);return Number.isFinite(n)?Math.trunc(n):0},m.getOrderItemRows=m.getOrderItemRows||function(t,e){const n=m.getOrderItems(t);if(!n.length)return[];const i=typeof e=="function"?e:()=>null;return n.map(r=>{var F,M,D,J;const o=r==null?void 0:r.product_name,c=String((r==null?void 0:r.product_id)||""),u=i(c),a=(o||(u==null?void 0:u.name)||"").toString().trim(),f=String((F=r==null?void 0:r.variant)!=null?F:"").trim(),d=f?`${a} (${f})`:a,p=Number((M=r==null?void 0:r.quantity)!=null?M:1)||1,S=(D=r==null?void 0:r.unit_price)!=null?D:r==null?void 0:r.unitPrice,O=S==null||S===""?NaN:Number(S),_=Number.isFinite(O)?Math.trunc(O):l.parseMoney((J=r==null?void 0:r.product_price)!=null?J:u==null?void 0:u.price),q=p*_;return{name:d,qty:p,unitPrice:_,lineTotal:q}}).filter(r=>r.name)},m.getOrderProductSummary=m.getOrderProductSummary||function(t,e){const n=m.getOrderItems(t);if(!n.length)return"\u2014";const i=typeof e=="function"?e:()=>null,r=n.map(o=>{var f;const c=o==null?void 0:o.product_name,u=c?String(c):(()=>{const d=String((o==null?void 0:o.product_id)||""),p=i(d);return p!=null&&p.name?String(p.name):""})(),a=String((f=o==null?void 0:o.variant)!=null?f:"").trim();return a?`${u} (${a})`:u}).filter(Boolean);return r.length?r.join(" + "):(t==null?void 0:t.product_name)||"\u2014"},m.getItemsSubtotal=m.getItemsSubtotal||function(t,e){const n=Array.isArray(t)?t:[],i=typeof e=="function"?e:()=>null;return n.reduce((r,o)=>{var S,O;const c=Number((o==null?void 0:o.quantity)||0)||0,u=String((o==null?void 0:o.product_id)||""),a=i(u),f=(S=o==null?void 0:o.unit_price)!=null?S:o==null?void 0:o.unitPrice,d=f==null||f===""?NaN:Number(f),p=Number.isFinite(d)?Math.trunc(d):l.parseMoney((O=o==null?void 0:o.product_price)!=null?O:a==null?void 0:a.price);return r+c*p},0)},m.getOrderShipInfo=m.getOrderShipInfo||function(t,e){var c,u;const n=Array.isArray(t)?t:[],i=typeof e=="function"?e:()=>null;let r=!1,o=0;for(const a of n){const f=String((a==null?void 0:a.product_id)||""),d=i(f),p=(u=(c=a==null?void 0:a.product_note)!=null?c:d==null?void 0:d.note)!=null?u:null,S=l.parseShipFeeFromNote(p);S!=null&&(r=!0,S>o&&(o=S))}return{found:r,fee:o}},m.getOrderTotalMoney=m.getOrderTotalMoney||function(t,e){const n=m.getOrderItems(t),i=m.getItemsSubtotal(n,e),r=m.getOrderShipInfo(n,e).fee,o=m.getOrderAdjustmentMoney(t);return i+r+o},m.compareOrders=m.compareOrders||function(t,e){const n={draft:-1,pending:0,processing:1,done:2,paid:3},i=p=>p in n?n[p]:99,r=p=>{if(!p)return Number.POSITIVE_INFINITY;const S=new Date(p).getTime();return Number.isFinite(S)?S:Number.POSITIVE_INFINITY},o=i(t==null?void 0:t.status),c=i(e==null?void 0:e.status);if(o!==c)return o-c;const u=r(t==null?void 0:t.created_at),a=r(e==null?void 0:e.created_at);if(u!==a)return a-u;const f=Number(t==null?void 0:t.id),d=Number(e==null?void 0:e.id);return Number.isFinite(f)&&Number.isFinite(d)?d-f:String((t==null?void 0:t.id)||"").localeCompare(String((e==null?void 0:e.id)||""))},m.sortOrders=m.sortOrders||function(t){return[...t||[]].sort(m.compareOrders)}})();

