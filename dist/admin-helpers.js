(function(){const w=typeof window!="undefined"?window:globalThis,g=w.KTM||(w.KTM={}),l=g.money||(g.money={});l.parseMoney=l.parseMoney||function(t){if(t==null||t==="")return 0;const e=String(t).replace(/[^0-9]/g,"");return e?Number(e):0},l.parseSignedMoney=l.parseSignedMoney||function(t){if(t==null||t==="")return 0;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):0;const e=String(t).trim();if(!e)return 0;const r=/^\s*-/.test(e),o=e.replace(/[^0-9]/g,""),n=o?Number(o):0;return r?-n:n},l.formatNumber=l.formatNumber||function(t){try{return Number(t||0).toLocaleString("vi-VN")}catch(e){return String(t||0)}},l.formatVND=l.formatVND||function(t){return`${l.formatNumber(t)}\u0111`},l.parseShipFeeFromNote=l.parseShipFeeFromNote||function(t){if(!t)return null;const e=String(t),r=e.toLowerCase();if(r.includes("freeship")||r.includes("free ship")||r.includes("mi\u1EC5n ph\xED ship")||r.includes("mien phi ship")||r.includes("mi\u1EC5n ph\xED v\u1EADn chuy\u1EC3n")||r.includes("mien phi van chuyen"))return 0;const o=e.match(/(?:ship|vận\s*chuyển|van\s*chuyen|\bvc\b)\s*[:=\-]?\s*([0-9][0-9\.,\s]*)(?:\s*(k|nghìn|nghin|tr|triệu|trieu|m))?/i);if(!o)return null;const n=String(o[1]||"").replace(/[^0-9]/g,"");if(!n)return null;let i=Number(n);const a=String(o[2]||"").toLowerCase();return a==="k"||a.startsWith("ngh")?i*=1e3:(a==="tr"||a.startsWith("tri")||a==="m")&&(i*=1e6),Number.isFinite(i)?i:null},l.getShipFeeForItems=l.getShipFeeForItems||function(t){const e=Array.isArray(t)?t:[];let r=!1,o=0;for(const n of e){const i=l.parseShipFeeFromNote(n==null?void 0:n.product_note);i!=null&&(r=!0,i>o&&(o=i))}return{found:r,fee:o}},l.getDigits=l.getDigits||function(t){return t==null?"":String(t).replace(/[^0-9]/g,"")},l.formatVNDInputDigits=l.formatVNDInputDigits||function(t){const e=String(t!=null?t:"").replace(/[^0-9]/g,"");return e?e.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""},l.nextPriceInputState=l.nextPriceInputState||function(t,e){const r=l.getDigits(t),o=String(e!=null?e:"");if(!r)return{digits:"",price:""};if(r===o&&r.length>0){const n=r.slice(0,-1);return{digits:n,price:l.formatVNDInputDigits(n)}}return{digits:r,price:l.formatVNDInputDigits(r)}};const m=g.orders||(g.orders={}),O=g.clipboard||(g.clipboard={});O.writeText=O.writeText||async function(t){var n;const e=typeof navigator!="undefined"?navigator:null;if((n=e==null?void 0:e.clipboard)!=null&&n.writeText){await e.clipboard.writeText(String(t!=null?t:""));return}const r=document.createElement("textarea");r.value=String(t!=null?t:""),r.setAttribute("readonly",""),r.style.position="fixed",r.style.left="-9999px",document.body.appendChild(r),r.select();const o=document.execCommand("copy");if(document.body.removeChild(r),!o)throw new Error("copy_failed")},O.writeImageFromUrl=O.writeImageFromUrl||async function(t){var i;const e=String(t!=null?t:"");if(!e)throw new Error("empty_url");const o=await(await fetch(e)).blob(),n=typeof navigator!="undefined"?navigator:null;if(!((i=n==null?void 0:n.clipboard)!=null&&i.write)||typeof ClipboardItem=="undefined")throw new Error("clipboard_image_unsupported");await n.clipboard.write([new ClipboardItem({[o.type]:o})])};const y=g.phone||(g.phone={});y.normalize=y.normalize||function(t){return t?String(t).replace(/[^0-9]/g,""):""},y.isValid=y.isValid||function(t){const e=y.normalize(t);return e.length>=9&&e.length<=12};const I=g.date||(g.date={});I.formatDateTime=I.formatDateTime||function(t){if(!t)return"";const e=new Date(t);if(Number.isNaN(e.getTime()))return String(t);try{return e.toLocaleString("vi-VN")}catch(r){return e.toISOString()}};const S=g.cache||(g.cache={});S.read=S.read||function(t,e){var i,a;const r=Number((i=e==null?void 0:e.ttlMs)!=null?i:0),o=typeof(e==null?void 0:e.validate)=="function"?e.validate:null,n=String(t!=null?t:"");if(!n)return{hit:!1,value:null,status:"invalid"};try{const u=localStorage.getItem(n);if(!u)return{hit:!1,value:null,status:"miss"};const c=JSON.parse(u),p=Number((a=c==null?void 0:c.timestamp)!=null?a:0),f=c==null?void 0:c.data;return!p||!Number.isFinite(p)?{hit:!1,value:null,status:"invalid"}:r>0&&Date.now()-p>=r?{hit:!1,value:null,status:"expired"}:o&&!o(f)?{hit:!1,value:null,status:"invalid"}:{hit:!0,value:f,status:"hit"}}catch(u){return{hit:!1,value:null,status:"error"}}},S.write=S.write||function(t,e){const r=String(t!=null?t:"");if(!r)return!1;try{return localStorage.setItem(r,JSON.stringify({data:e,timestamp:Date.now()})),!0}catch(o){return!1}},S.remove=S.remove||function(t){const e=String(t!=null?t:"");if(!e)return!1;try{return localStorage.removeItem(e),!0}catch(r){return!1}};const d=g.api||(g.api={});d.request=d.request||function(t,e){return fetch(String(t!=null?t:""),e)},d.requestJSON=d.requestJSON||async function(t,e,r){const o=await d.request(t,e);let n=null,i="";try{n=await o.json()}catch(a){try{i=await o.text()}catch(u){i=""}}if(!o.ok){const a=n&&typeof n=="object"&&(n.error||n.message)?String(n.error||n.message):typeof n=="string"&&n.trim()?n.trim():i&&i.trim()?i.trim():r||`API error (${o.status})`;throw new Error(a)}return n},d.getJSON=d.getJSON||function(t,e){return d.requestJSON(t,{method:"GET"},e)},d.postJSON=d.postJSON||function(t,e,r){return d.requestJSON(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e!=null?e:{})},r)},d.putJSON=d.putJSON||function(t,e,r){return d.requestJSON(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e!=null?e:{})},r)},d.deleteJSON=d.deleteJSON||function(t,e){return d.requestJSON(t,{method:"DELETE"},e)};const b=g.cloudinary||(g.cloudinary={});b.uploadImage=b.uploadImage||async function(t){var c,p;const e=String((c=t==null?void 0:t.cloudName)!=null?c:"").trim(),r=String((p=t==null?void 0:t.uploadPreset)!=null?p:"").trim(),o=(t==null?void 0:t.folder)!=null?String(t.folder).trim():"",n=t==null?void 0:t.file;if(!e)throw new Error("Thi\u1EBFu c\u1EA5u h\xECnh Cloudinary");if(!r)throw new Error("Thi\u1EBFu c\u1EA5u h\xECnh Cloudinary");if(!n)throw new Error("Thi\u1EBFu file upload");const i=new FormData;i.append("file",n),i.append("upload_preset",r),o&&i.append("folder",o);const a=await fetch(`https://api.cloudinary.com/v1_1/${encodeURIComponent(e)}/image/upload`,{method:"POST",body:i});let u=null;try{u=await a.json()}catch(f){u=null}if(!u)throw new Error("Upload failed");if(!a.ok){const f=typeof u=="object"&&u.error&&typeof u.error=="object"&&u.error.message?String(u.error.message):typeof u=="object"&&(u.message||u.error)?String(u.message||u.error):"Upload failed";throw new Error(f)}return u},m.getOrderItems=m.getOrderItems||function(t){return Array.isArray(t==null?void 0:t.items)&&t.items.length?t.items:t!=null&&t.product_id?[{product_id:t.product_id,quantity:Number(t.quantity||1)||1,product_price:t.product_price,product_name:t.product_name,product_code:t.product_code,product_note:t.product_note}]:[]},m.getOrderTotalQty=m.getOrderTotalQty||function(t){var n,i;const r=m.getOrderItems(t).reduce((a,u)=>a+(Number((u==null?void 0:u.quantity)||0)||0),0);if(r>0)return r;const o=Number((i=(n=t==null?void 0:t.total_quantity)!=null?n:t==null?void 0:t.quantity)!=null?i:0);return Number.isFinite(o)?o:0},m.getOrderAdjustmentMoney=m.getOrderAdjustmentMoney||function(t){const e=t==null?void 0:t.adjustment_amount;if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):0;const r=Number(e);return Number.isFinite(r)?Math.trunc(r):0},m.getOrderItemRows=m.getOrderItemRows||function(t,e){const r=m.getOrderItems(t);if(!r.length)return[];const o=typeof e=="function"?e:()=>null;return r.map(n=>{var f;const i=n==null?void 0:n.product_name,a=String((n==null?void 0:n.product_id)||""),u=o(a),c=(i||(u==null?void 0:u.name)||"").toString().trim(),p=Number((f=n==null?void 0:n.quantity)!=null?f:1)||1;return{name:c,qty:p}}).filter(n=>n.name)},m.getOrderProductSummary=m.getOrderProductSummary||function(t,e){const r=m.getOrderItems(t);if(!r.length)return"\u2014";const o=typeof e=="function"?e:()=>null,n=r.map(i=>{const a=i==null?void 0:i.product_name;if(a)return String(a);const u=String((i==null?void 0:i.product_id)||""),c=o(u);return c!=null&&c.name?String(c.name):""}).filter(Boolean);return n.length?n.join(" + "):(t==null?void 0:t.product_name)||"\u2014"},m.getItemsSubtotal=m.getItemsSubtotal||function(t,e){const r=Array.isArray(t)?t:[],o=typeof e=="function"?e:()=>null;return r.reduce((n,i)=>{var f;const a=Number((i==null?void 0:i.quantity)||0)||0,u=String((i==null?void 0:i.product_id)||""),c=o(u),p=l.parseMoney((f=i==null?void 0:i.product_price)!=null?f:c==null?void 0:c.price);return n+a*p},0)},m.getOrderShipInfo=m.getOrderShipInfo||function(t,e){var a,u;const r=Array.isArray(t)?t:[],o=typeof e=="function"?e:()=>null;let n=!1,i=0;for(const c of r){const p=String((c==null?void 0:c.product_id)||""),f=o(p),h=(u=(a=c==null?void 0:c.product_note)!=null?a:f==null?void 0:f.note)!=null?u:null,N=l.parseShipFeeFromNote(h);N!=null&&(n=!0,N>i&&(i=N))}return{found:n,fee:i}},m.getOrderTotalMoney=m.getOrderTotalMoney||function(t,e){const r=m.getOrderItems(t),o=m.getItemsSubtotal(r,e),n=m.getOrderShipInfo(r,e).fee,i=m.getOrderAdjustmentMoney(t);return o+n+i},m.compareOrders=m.compareOrders||function(t,e){const r={pending:0,processing:1,done:2,paid:3},o=h=>h in r?r[h]:99,n=h=>{if(!h)return Number.POSITIVE_INFINITY;const N=new Date(h).getTime();return Number.isFinite(N)?N:Number.POSITIVE_INFINITY},i=o(t==null?void 0:t.status),a=o(e==null?void 0:e.status);if(i!==a)return i-a;const u=n(t==null?void 0:t.created_at),c=n(e==null?void 0:e.created_at);if(u!==c)return c-u;const p=Number(t==null?void 0:t.id),f=Number(e==null?void 0:e.id);return Number.isFinite(p)&&Number.isFinite(f)?f-p:String((t==null?void 0:t.id)||"").localeCompare(String((e==null?void 0:e.id)||""))},m.sortOrders=m.sortOrders||function(t){return[...t||[]].sort(m.compareOrders)}})();

