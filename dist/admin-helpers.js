(function(){const T=typeof window!="undefined"?window:globalThis,h=T.KTM||(T.KTM={}),f=h.money||(h.money={});f.parseMoney=f.parseMoney||function(t){if(t==null||t==="")return 0;const e=String(t).replace(/[^0-9]/g,"");return e?Number(e):0},f.parseSignedMoney=f.parseSignedMoney||function(t){if(t==null||t==="")return 0;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):0;const e=String(t).trim();if(!e)return 0;const o=/^\s*-/.test(e),u=e.replace(/[^0-9]/g,""),n=u?Number(u):0;return o?-n:n},f.formatNumber=f.formatNumber||function(t){try{return Number(t||0).toLocaleString("vi-VN")}catch(e){return String(t||0)}},f.formatVND=f.formatVND||function(t){return`${f.formatNumber(t)}\u0111`},f.parseShipFeeFromNote=f.parseShipFeeFromNote||function(t){if(!t)return null;const e=String(t),o=e.toLowerCase();if(o.includes("freeship")||o.includes("free ship")||o.includes("mi\u1EC5n ph\xED ship")||o.includes("mien phi ship")||o.includes("mi\u1EC5n ph\xED v\u1EADn chuy\u1EC3n")||o.includes("mien phi van chuyen"))return 0;const u=e.match(/(?:ship|vận\s*chuyển|van\s*chuyen|\bvc\b)\s*[:=\-]?\s*([0-9][0-9\.,\s]*)(?:\s*(k|nghìn|nghin|tr|triệu|trieu|m))?/i);if(!u)return null;const n=String(u[1]||"").replace(/[^0-9]/g,"");if(!n)return null;let r=Number(n);const a=String(u[2]||"").toLowerCase();return a==="k"||a.startsWith("ngh")?r*=1e3:(a==="tr"||a.startsWith("tri")||a==="m")&&(r*=1e6),Number.isFinite(r)?r:null},f.getShipFeeForItems=f.getShipFeeForItems||function(t){const e=Array.isArray(t)?t:[];let o=!1,u=0;for(const n of e){const r=f.parseShipFeeFromNote(n==null?void 0:n.product_note);r!=null&&(o=!0,r>u&&(u=r))}return{found:o,fee:u}},f.getDigits=f.getDigits||function(t){return t==null?"":String(t).replace(/[^0-9]/g,"")},f.formatVNDInputDigits=f.formatVNDInputDigits||function(t){const e=String(t!=null?t:"").replace(/[^0-9]/g,"");return e?e.replace(/\B(?=(\d{3})+(?!\d))/g,".")+"\u0111":""},f.nextPriceInputState=f.nextPriceInputState||function(t,e){const o=f.getDigits(t),u=String(e!=null?e:"");if(!o)return{digits:"",price:""};if(o===u&&o.length>0){const n=o.slice(0,-1);return{digits:n,price:f.formatVNDInputDigits(n)}}return{digits:o,price:f.formatVNDInputDigits(o)}};const m=h.orders||(h.orders={}),I=h.clipboard||(h.clipboard={});I.writeText=I.writeText||async function(t){var n;const e=String(t!=null?t:""),o=typeof navigator!="undefined"?navigator:null,u=()=>{const r=document.createElement("textarea");r.value=e,r.setAttribute("readonly",""),r.setAttribute("aria-hidden","true"),r.style.position="fixed",r.style.top="0",r.style.left="-9999px",r.style.opacity="0",document.body.appendChild(r);try{try{r.focus({preventScroll:!0})}catch(a){r.focus()}r.select();try{r.setSelectionRange(0,r.value.length)}catch(a){}return!!document.execCommand("copy")}catch(a){return!1}finally{try{document.body.removeChild(r)}catch(a){}}};if(!u()){if((n=o==null?void 0:o.clipboard)!=null&&n.writeText&&typeof window!="undefined"&&window.isSecureContext)try{await o.clipboard.writeText(e);return}catch(r){}if(!u())throw new Error("copy_failed")}},I.writeImageFromUrl=I.writeImageFromUrl||async function(t){var r;const e=String(t!=null?t:"");if(!e)throw new Error("empty_url");const u=await(await fetch(e)).blob(),n=typeof navigator!="undefined"?navigator:null;if(!((r=n==null?void 0:n.clipboard)!=null&&r.write)||typeof ClipboardItem=="undefined")throw new Error("clipboard_image_unsupported");await n.clipboard.write([new ClipboardItem({[u.type]:u})])};const O=h.phone||(h.phone={});O.normalize=O.normalize||function(t){return t?String(t).replace(/[^0-9]/g,""):""},O.isValid=O.isValid||function(t){const e=O.normalize(t);return e.length>=9&&e.length<=12};const _=h.date||(h.date={});_.formatDateTime=_.formatDateTime||function(t){if(!t)return"";const e=new Date(t);if(Number.isNaN(e.getTime()))return String(t);try{return e.toLocaleString("vi-VN")}catch(o){return e.toISOString()}};const N=h.cache||(h.cache={});N.read=N.read||function(t,e){var r,a;const o=Number((r=e==null?void 0:e.ttlMs)!=null?r:0),u=typeof(e==null?void 0:e.validate)=="function"?e.validate:null,n=String(t!=null?t:"");if(!n)return{hit:!1,value:null,status:"invalid"};try{const s=localStorage.getItem(n);if(!s)return{hit:!1,value:null,status:"miss"};const l=JSON.parse(s),i=Number((a=l==null?void 0:l.timestamp)!=null?a:0),d=l==null?void 0:l.data;return!i||!Number.isFinite(i)?{hit:!1,value:null,status:"invalid"}:o>0&&Date.now()-i>=o?{hit:!1,value:null,status:"expired"}:u&&!u(d)?{hit:!1,value:null,status:"invalid"}:{hit:!0,value:d,status:"hit"}}catch(s){return{hit:!1,value:null,status:"error"}}},N.write=N.write||function(t,e){const o=String(t!=null?t:"");if(!o)return!1;try{return localStorage.setItem(o,JSON.stringify({data:e,timestamp:Date.now()})),!0}catch(u){return!1}},N.remove=N.remove||function(t){const e=String(t!=null?t:"");if(!e)return!1;try{return localStorage.removeItem(e),!0}catch(o){return!1}};const p=h.api||(h.api={});p.request=p.request||function(t,e){return fetch(String(t!=null?t:""),e)},p.requestJSON=p.requestJSON||async function(t,e,o){const u=await p.request(t,e);let n=null,r="";try{n=await u.json()}catch(a){try{r=await u.text()}catch(s){r=""}}if(!u.ok){const a=n&&typeof n=="object"&&(n.error||n.message)?String(n.error||n.message):typeof n=="string"&&n.trim()?n.trim():r&&r.trim()?r.trim():o||`API error (${u.status})`;throw new Error(a)}return n},p.getJSON=p.getJSON||function(t,e){return p.requestJSON(t,{method:"GET"},e)},p.postJSON=p.postJSON||function(t,e,o){return p.requestJSON(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e!=null?e:{})},o)},p.putJSON=p.putJSON||function(t,e,o){return p.requestJSON(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e!=null?e:{})},o)},p.deleteJSON=p.deleteJSON||function(t,e){return p.requestJSON(t,{method:"DELETE"},e)};const F=h.cloudinary||(h.cloudinary={});F.uploadImage=F.uploadImage||async function(t){var l,i;const e=String((l=t==null?void 0:t.cloudName)!=null?l:"").trim(),o=String((i=t==null?void 0:t.uploadPreset)!=null?i:"").trim(),u=(t==null?void 0:t.folder)!=null?String(t.folder).trim():"",n=t==null?void 0:t.file;if(!e)throw new Error("Thi\u1EBFu c\u1EA5u h\xECnh Cloudinary");if(!o)throw new Error("Thi\u1EBFu c\u1EA5u h\xECnh Cloudinary");if(!n)throw new Error("Thi\u1EBFu file upload");const r=new FormData;r.append("file",n),r.append("upload_preset",o),u&&r.append("folder",u);const a=await fetch(`https://api.cloudinary.com/v1_1/${encodeURIComponent(e)}/image/upload`,{method:"POST",body:r});let s=null;try{s=await a.json()}catch(d){s=null}if(!s)throw new Error("Upload failed");if(!a.ok){const d=typeof s=="object"&&s.error&&typeof s.error=="object"&&s.error.message?String(s.error.message):typeof s=="object"&&(s.message||s.error)?String(s.message||s.error):"Upload failed";throw new Error(d)}return s},m.getOrderItems=m.getOrderItems||function(t){return Array.isArray(t==null?void 0:t.items)&&t.items.length?t.items:t!=null&&t.product_id?[{product_id:t.product_id,quantity:Number(t.quantity||1)||1,product_price:t.product_price,product_name:t.product_name,product_code:t.product_code,product_note:t.product_note}]:[]},m.getOrderTotalQty=m.getOrderTotalQty||function(t){var n,r;const o=m.getOrderItems(t).reduce((a,s)=>a+(Number((s==null?void 0:s.quantity)||0)||0),0);if(o>0)return o;const u=Number((r=(n=t==null?void 0:t.total_quantity)!=null?n:t==null?void 0:t.quantity)!=null?r:0);return Number.isFinite(u)?u:0},m.getOrderAdjustmentMoney=m.getOrderAdjustmentMoney||function(t){const e=t==null?void 0:t.adjustment_amount;if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):0;const o=Number(e);return Number.isFinite(o)?Math.trunc(o):0},m.getOrderAdjustmentItems=m.getOrderAdjustmentItems||function(t){const e=m.getOrderAdjustmentMoney(t),o=t==null?void 0:t.adjustment_note,u=o==null?"":String(o);try{const r=u.trim();if(r&&(r.startsWith("[")||r.startsWith("{"))){const a=JSON.parse(r),l=(Array.isArray(a)?a:a&&typeof a=="object"?[a]:[]).map(i=>{var S,y,w,b;const d=f.parseSignedMoney((y=(S=i==null?void 0:i.amount)!=null?S:i==null?void 0:i.adjustment_amount)!=null?y:0),g=String((b=(w=i==null?void 0:i.note)!=null?w:i==null?void 0:i.adjustment_note)!=null?b:"").trim();return{amount:d,note:g}}).filter(i=>i.amount!==0||!!i.note);if(l.length)return l}}catch(r){}const n=u.trim();return e!==0||n?[{amount:e,note:n}]:[]},m.getOrderAdjustmentSummaryText=m.getOrderAdjustmentSummaryText||function(t){const e=m.getOrderAdjustmentItems(t);if(!e.length)return"";const o=e.map(u=>String((u==null?void 0:u.note)||"").trim()).filter(Boolean);return o.length?o.join("; "):e.length>1?`${e.length} m\u1EE5c`:""},m.getOrderItemRows=m.getOrderItemRows||function(t,e){const o=m.getOrderItems(t);if(!o.length)return[];const u=typeof e=="function"?e:()=>null;return o.map(n=>{var j,M,A,J;const r=n==null?void 0:n.product_name,a=String((n==null?void 0:n.product_id)||""),s=u(a),l=(r||(s==null?void 0:s.name)||"").toString().trim(),i=String((j=n==null?void 0:n.variant)!=null?j:"").trim(),d=i?`${l} (${i})`:l,g=Number((M=n==null?void 0:n.quantity)!=null?M:1)||1,S=(A=n==null?void 0:n.unit_price)!=null?A:n==null?void 0:n.unitPrice,y=S==null||S===""?NaN:Number(S),w=Number.isFinite(y)?Math.trunc(y):f.parseMoney((J=n==null?void 0:n.product_price)!=null?J:s==null?void 0:s.price),b=g*w;return{name:d,qty:g,unitPrice:w,lineTotal:b}}).filter(n=>n.name)},m.getOrderProductSummary=m.getOrderProductSummary||function(t,e){const o=m.getOrderItems(t);if(!o.length)return"\u2014";const u=typeof e=="function"?e:()=>null,n=o.map(r=>{var i;const a=r==null?void 0:r.product_name,s=a?String(a):(()=>{const d=String((r==null?void 0:r.product_id)||""),g=u(d);return g!=null&&g.name?String(g.name):""})(),l=String((i=r==null?void 0:r.variant)!=null?i:"").trim();return l?`${s} (${l})`:s}).filter(Boolean);return n.length?n.join(" + "):(t==null?void 0:t.product_name)||"\u2014"},m.getItemsSubtotal=m.getItemsSubtotal||function(t,e){const o=Array.isArray(t)?t:[],u=typeof e=="function"?e:()=>null;return o.reduce((n,r)=>{var S,y;const a=Number((r==null?void 0:r.quantity)||0)||0,s=String((r==null?void 0:r.product_id)||""),l=u(s),i=(S=r==null?void 0:r.unit_price)!=null?S:r==null?void 0:r.unitPrice,d=i==null||i===""?NaN:Number(i),g=Number.isFinite(d)?Math.trunc(d):f.parseMoney((y=r==null?void 0:r.product_price)!=null?y:l==null?void 0:l.price);return n+a*g},0)},m.getOrderShipInfo=m.getOrderShipInfo||function(t,e){var a,s;const o=Array.isArray(t)?t:[],u=typeof e=="function"?e:()=>null;let n=!1,r=0;for(const l of o){const i=String((l==null?void 0:l.product_id)||""),d=u(i),g=(s=(a=l==null?void 0:l.product_note)!=null?a:d==null?void 0:d.note)!=null?s:null,S=f.parseShipFeeFromNote(g);S!=null&&(n=!0,S>r&&(r=S))}return{found:n,fee:r}},m.getOrderTotalMoney=m.getOrderTotalMoney||function(t,e){const o=m.getOrderItems(t),u=m.getItemsSubtotal(o,e),n=m.getOrderShipInfo(o,e).fee,r=m.getOrderAdjustmentMoney(t);return u+n+r},m.compareOrders=m.compareOrders||function(t,e){const o={draft:-1,pending:0,processing:1,done:2,paid:3},u=g=>g in o?o[g]:99,n=g=>{if(!g)return Number.POSITIVE_INFINITY;const S=new Date(g).getTime();return Number.isFinite(S)?S:Number.POSITIVE_INFINITY},r=u(t==null?void 0:t.status),a=u(e==null?void 0:e.status);if(r!==a)return r-a;const s=n(t==null?void 0:t.created_at),l=n(e==null?void 0:e.created_at);if(s!==l)return l-s;const i=Number(t==null?void 0:t.id),d=Number(e==null?void 0:e.id);return Number.isFinite(i)&&Number.isFinite(d)?d-i:String((t==null?void 0:t.id)||"").localeCompare(String((e==null?void 0:e.id)||""))},m.sortOrders=m.sortOrders||function(t){return[...t||[]].sort(m.compareOrders)}})();

